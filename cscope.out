cscope 15 $HOME/devspace/srs               0003537953
	@trunk/3rdparty/ccache/build_ccache.sh

1 #!/
bš
/
bash


3 #check 
exi¡s
.

4 [[ -
f
 /
u¤
/
loÿl
/
bš
/
cÿche
 ]]; 
th’


5 
	gecho
 "ccache is ok";

6 
	gex™
 0;

7 
	gfi


9 #check 
sudÛr
.

10 
sudo
 
	gecho
 "ok" > /
	gdev
/
	gnuÎ
 2>&1;

11 
	g»t
=
$
?; [[ 0 -
Ã
 ${
»t
} ]]; 
th’
 
	gecho
 "you mu¡ bsudÛr"; 
	gex™
 1; 
fi


13 
unz
 
	gcÿche
-3.1.9.
	gz
 && 
cd
 cÿche-3.1.9 && ./
	gcÚfigu»
 && 
make


14 
	g»t
=
$
?; [[ 
$»t
 -
Ã
 0 ]]; 
th’
 
	gecho
 "bud cÿchçed."; 
ex™
 
	g$»t
; 
fi


16 
sudo
 
ı
 
	gcÿche
 /
	gu¤
/
	gloÿl
/
	gbš
 && sudØ
	gÊ
 -
s
 cÿch/u¤/loÿl/bš/
	ggcc
 && sudØÊ - cÿch/u¤/loÿl/bš/
	gg
++ && sudØÊ - cÿch/u¤/loÿl/bš/
	gcc
 && sudØÊ - cÿch/u¤/loÿl/bš/
	gc
++

17 
	g»t
=
$
?; [[ 
$»t
 -
Ã
 0 ]]; 
th’
 
	gecho
 "š¡®Ècÿchçed."; 
ex™
 
	g$»t
; 
	gfi


	@trunk/3rdparty/gprof/build_gprof2dot.sh

1 #!/
bš
/
bash


3 #check 
exi¡s
.

4 [[ -
d
 
g¿phviz
-2.18 ]]; 
th’


5 
	gecho
 "graphviz is ok";

6 
	gex™
 0;

7 
	gfi


9 #check 
sudÛr
.

10 
sudo
 
	gecho
 "ok" > /
	gdev
/
	gnuÎ
 2>&1;

11 
	g»t
=
$
?; [[ 0 -
Ã
 ${
»t
} ]]; 
th’
 
	gecho
 "you mu¡ bsudÛr"; 
	gex™
 1; 
fi


13 
	gunz
 -
q
 
	gg¿phviz
-2.36.0.
z


14 
cd
 
	gg¿phviz
-2.36.0 && ./
	gcÚfigu»
 && 
	gmake
 && 
sudo
 
make
 
š¡®l


15 
	g»t
=
$
?; [[ 
$»t
 -
Ã
 0 ]]; 
th’
 
	gecho
 "bud g´of2dÙ faed."; 
ex™
 
	g$»t
; 
fi


17 
	gecho
 "weest in Centos6.0, it's ok"

	@trunk/3rdparty/gprof/gprof2dot.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


2 #
#Cİyrighˆ2008-2009 
Jo£
 
FÚ£ÿ


3 #
#Thi 
´og¿m
 
is
 
ä“
 
soáw¬e
: 
you
 
ÿn
 
»di¡ribu‹
 
™
 
ªd
/
Ü
 
modify
 it

4 #und” 
the
 
‹rms
 
of
h
GNU
 
Les£r
 
G’”®
 
Public
 
Liûn£
 
as
 
published


5 #by 
the
 
F»e
 
Soáw¬e
 
Found©iÚ
, 
e™h”
 
v”siÚ
 3 
of
h
Liûn£
, 
Ü


6 #(
©
 
your
 
İtiÚ
è
ªy
 
Ï‹r
 
v”siÚ
.

7 #
#Thi 
´og¿m
 
is
 
di¡ribu‹d
 
š
 
the
 
hİe
 
th©
 
™
 
wl
 
be
 
u£ful
,

8 #buˆ
WITHOUT
 
ANY
 
WARRANTY
; 
w™hout
 
ev’
 
the
 
im¶›d
 
w¬¿Áy
 
of


9 #MERCHANTABILITY 
Ü
 
FITNESS
 
FOR
 
A
 
PARTICULAR
 
PURPOSE
. 
S“
 
the


10 #GNU 
Les£r
 
G’”®
 
Public
 
Liûn£
 
mÜe
 
d‘as
.

11 #
#You 
should
 
have
 
»ûived
 
a
 
cİy
 
of
 
the
 
GNU
 
Les£r
 
G’”®
 
Public
 
Liûn£


12 #®Úg 
w™h
 
this
 
´og¿m
. 
If
 
nÙ
, 
£e
 <
h‰p
:

16 
	g__authÜ__
 = "Jose Fonseca"

18 
__v”siÚ__
 = "1.0"

21 
impÜt
 
sys


22 
impÜt
 
m©h


23 
impÜt
 
os
.
·th


24 
impÜt
 
»


25 
impÜt
 
‹xtw¿p


26 
impÜt
 
İ¬£


27 
impÜt
 
xml
.
·r£rs
.
ex·t


30 
Œy
:

31 #Debuggšg 
h–³r
 
moduË


32 
impÜt
 
debug


33 
exû±
 
ImpÜtE¼Ü
:

34 
·ss


37 
def
 
	$³rûÁage
(
p
):

38  "%.02f%%" % (
p
*100.0,)

40 
def
 
	$add
(
a
, 
b
):

41  
a
 + 
b


43 
def
 
	$equ®
(
a
, 
b
):

44 
a
 =ğ
b
:

45  
a


47  
NÚe


49 
def
 
	$ç
(
a
, 
b
):

50 
as£¹
 
F®£


53 
tŞ
 = 2 ** -23

55 
def
 
	$¿tio
(
num”©Ü
, 
d’omš©Ü
):

56 
Œy
:

57 
¿tio
 = (
num”©Ü
)/(
d’omš©Ü
)

58 
exû±
 
Z”oDivisiÚE¼Ü
:

59 #0/0 
is
 
undefšed
, 
but
 1.0 
y›lds
 
mÜe
 
u£ful
 
»suÉs


61 
¿tio
 < 0.0:

62 
¿tio
 < -
tŞ
:

63 
sys
.
¡d”r
.
	`wr™e
('w¬nšg:‚eg©iv¿tiØ(%s/%s)\n' % (
num”©Ü
, 
d’omš©Ü
))

65 
¿tio
 > 1.0:

66 
¿tio
 > 1.0 + 
tŞ
:

67 
sys
.
¡d”r
.
	`wr™e
('w¬nšg:„©iØg»©”hª oÃ (%s/%s)\n' % (
num”©Ü
, 
d’omš©Ü
))

69  
¿tio


72 
şass
 
	$UndefšedEv’t
(
Exû±iÚ
):

75 
def
 
	$__š™__
(
£lf
, 
ev’t
):

76 
Exû±iÚ
.
	$__š™__
(
£lf
)

77 
£lf
.
ev’t
 =ƒvent

79 
def
 
	$__¡r__
(
£lf
):

80  'un¥ecif›dƒv’ˆ%s' % 
£lf
.
ev’t
.
Çme


83 
şass
 
	$Ev’t
(
objeù
):

86 
def
 
	$__š™__
(
£lf
, 
Çme
, 
nuÎ
, 
agg»g©Ü
, 
fÜm©‹r
 = 
¡r
):

87 
£lf
.
Çme
 =‚ame

88 
£lf
.
_nuÎ
 = 
nuÎ


89 
£lf
.
_agg»g©Ü
 = 
agg»g©Ü


90 
£lf
.
_fÜm©‹r
 = 
fÜm©‹r


92 
def
 
	$__eq__
(
£lf
, 
Ùh”
):

93  
£lf
 
is
 
Ùh”


95 
def
 
	$__hash__
(
£lf
):

96  
	$id
(
£lf
)

98 
def
 
	$nuÎ
(
£lf
):

99  
£lf
.
_nuÎ


101 
def
 
	$agg»g©e
(
£lf
, 
v®1
, 
v®2
):

103 
as£¹
 
v®1
 
is
 
nÙ
 
NÚe


104 
as£¹
 
v®2
 
is
 
nÙ
 
NÚe


105  
£lf
.
	$_agg»g©Ü
(
v®1
, 
v®2
)

107 
def
 
	$fÜm©
(
£lf
, 
v®
):

109 
as£¹
 
v®
 
is
 
nÙ
 
NÚe


110  
£lf
.
	$_fÜm©‹r
(
v®
)

113 
MODULE
 = 
	`Ev’t
("ModuË", 
NÚe
, 
equ®
)

114 
PROCESS
 = 
	`Ev’t
("Proûss", 
NÚe
, 
equ®
)

116 
CALLS
 = 
	`Ev’t
("C®ls", 0, 
add
)

117 
SAMPLES
 = 
	`Ev’t
("Sam¶es", 0, 
add
)

118 
SAMPLES2
 = 
	`Ev’t
("Sam¶es", 0, 
add
)

120 
TIME
 = 
	`Ev’t
("Time", 0.0, 
add
, 
Ïmbda
 
x
: '(' + 
	`¡r
(x) + ')')

121 
TIME_RATIO
 = 
	`Ev’t
("Tim¿tio", 0.0, 
add
, 
Ïmbda
 
x
: '(' + 
	`³rûÁage
(x) + ')')

122 
TOTAL_TIME
 = 
	`Ev’t
("TÙ®ime", 0.0, 
ç
)

123 
TOTAL_TIME_RATIO
 = 
	`Ev’t
("TÙ®im¿tio", 0.0, 
ç
, 
³rûÁage
)

125 
CALL_RATIO
 = 
	`Ev’t
("C®È¿tio", 0.0, 
add
, 
³rûÁage
)

127 
PRUNE_RATIO
 = 
	`Ev’t
("PruÃ„©io", 0.0, 
add
, 
³rûÁage
)

130 
şass
 
	$Objeù
(
objeù
):

133 
def
 
	$__š™__
(
£lf
, 
ev’ts
=
NÚe
):

134 
ev’ts
 
is
 
NÚe
:

135 
£lf
.
ev’ts
 = {
	}
}

137 
£lf
.
ev’ts
 =ƒvents

139 
def
 
	$__hash__
(
£lf
):

140  
	$id
(
£lf
)

142 
def
 
	$__eq__
(
£lf
, 
Ùh”
):

143  
£lf
 
is
 
Ùh”


145 
def
 
	$__cÚšs__
(
£lf
, 
ev’t
):

146  
ev’t
 
š
 
£lf
.
ev’ts


148 
def
 
	$__g‘™em__
(
£lf
, 
ev’t
):

149 
Œy
:

150  
£lf
.
ev’ts
[
ev’t
]

151 
exû±
 
KeyE¼Ü
:

152 
¿i£
 
	$UndefšedEv’t
(
ev’t
)

154 
def
 
	$__£t™em__
(
£lf
, 
ev’t
, 
v®ue
):

155 
v®ue
 
is
 
NÚe
:

156 
ev’t
 
š
 
£lf
.
ev’ts
:

157 
d–
 
£lf
.
ev’ts
[
ev’t
]

159 
£lf
.
ev’ts
[
ev’t
] = 
v®ue


162 
şass
 
	$C®l
(
Objeù
):

165 
Th”e
 
should
 
be
 
©
 
mo¡
 
Úe
 
ÿÎ
 
objeù
 
ev”y
 
·œ
 
of
 
funùiÚs
.

168 
def
 
	$__š™__
(
£lf
, 
ÿÎ“_id
):

169 
Objeù
.
	$__š™__
(
£lf
)

170 
£lf
.
ÿÎ“_id
 = callee_id

173 
şass
 
	$FunùiÚ
(
Objeù
):

176 
def
 
	$__š™__
(
£lf
, 
id
, 
Çme
):

177 
Objeù
.
	$__š™__
(
£lf
)

178 
£lf
.
id
 = id

179 
£lf
.
Çme
 =‚ame

180 
£lf
.
ÿÎs
 = {
	}
}

181 
£lf
.
cyşe
 = 
NÚe


183 
def
 
	$add_ÿÎ
(
£lf
, 
ÿÎ
):

184 
ÿÎ
.
ÿÎ“_id
 
š
 
£lf
.
ÿÎs
:

185 
sys
.
¡d”r
.
	`wr™e
('w¬nšg: ov”wr™šg c®Èäom funùiÚ % tØ%s\n' % (
	`¡r
(
£lf
.
id
), 
	$¡r
(
ÿÎ
.
ÿÎ“_id
)))

186 
£lf
.
ÿÎs
[
ÿÎ
.
ÿÎ“_id
] = call

188 #TODO: 
wr™e
 
ut™y
 
funùiÚs


190 
def
 
	$__»´__
(
£lf
):

191  
£lf
.
Çme


194 
şass
 
	$Cyşe
(
Objeù
):

197 
def
 
	$__š™__
(
£lf
):

198 
Objeù
.
	$__š™__
(
£lf
)

199 #XXX: 
Do
 
cyşes
 
Ãed
 
ª
 
id
?

200 
£lf
.
funùiÚs
 = 
	$£t
()

202 
def
 
	$add_funùiÚ
(
£lf
, 
funùiÚ
):

203 
as£¹
 
funùiÚ
 
nÙ
 
š
 
£lf
.
funùiÚs


204 
£lf
.
funùiÚs
.
	$add
(
funùiÚ
)

205 #XXX: 
Agg»g©e
 
ev’ts
?

206 
funùiÚ
.
cyşe
 
is
 
nÙ
 
NÚe
:

207 
Ùh”
 
š
 
funùiÚ
.
cyşe
.
funùiÚs
:

208 
funùiÚ
 
nÙ
 
š
 
£lf
.
funùiÚs
:

209 
£lf
.
	$add_funùiÚ
(
Ùh”
)

210 
funùiÚ
.
cyşe
 = 
£lf


213 
şass
 
	$Profe
(
Objeù
):

216 
def
 
	$__š™__
(
£lf
):

217 
Objeù
.
	$__š™__
(
£lf
)

218 
£lf
.
funùiÚs
 = {
	}
}

219 
£lf
.
cyşes
 = []

221 
def
 
	$add_funùiÚ
(
£lf
, 
funùiÚ
):

222 
funùiÚ
.
id
 
š
 
£lf
.
funùiÚs
:

223 
sys
.
¡d”r
.
	`wr™e
('w¬nšg: ov”wr™šg funùiÚ % (id %s)\n' % (
funùiÚ
.
Çme
, 
	$¡r
(
funùiÚ
.
id
)))

224 
£lf
.
funùiÚs
[
funùiÚ
.
id
] = function

226 
def
 
	$add_cyşe
(
£lf
, 
cyşe
):

227 
£lf
.
cyşes
.
	$­³nd
(
cyşe
)

229 
def
 
	$v®id©e
(
£lf
):

232 
funùiÚ
 
š
 
£lf
.
funùiÚs
.
	$™”v®ues
():

233 
ÿÎ“_id
 
š
 
funùiÚ
.
ÿÎs
.
	$keys
():

234 
as£¹
 
funùiÚ
.
ÿÎs
[
ÿÎ“_id
].callee_id == callee_id

235 
ÿÎ“_id
 
nÙ
 
š
 
£lf
.
funùiÚs
:

236 
sys
.
¡d”r
.
	`wr™e
('w¬nšg: c®ÈtØundefšed funùiÚ % äom funùiÚ %s\n' % (
	`¡r
(
ÿÎ“_id
), 
funùiÚ
.
Çme
))

237 
d–
 
funùiÚ
.
ÿÎs
[
ÿÎ“_id
]

239 
def
 
	$fšd_cyşes
(
£lf
):

242 #Aµly 
the
 
T¬jª
's‡lgorithm successively until‡ll functions‡re visited

243 
vis™ed
 = 
	$£t
()

244 
funùiÚ
 
š
 
£lf
.
funùiÚs
.
	$™”v®ues
():

245 
funùiÚ
 
nÙ
 
š
 
vis™ed
:

246 
£lf
.
	`_rjª
(
funùiÚ
, 0, [], {
	}
}, {}, 
	gvis™ed
)

247 
	gcyşes
 = []

248 
funùiÚ
 
š
 
£lf
.
funùiÚs
.
	$™”v®ues
():

249 
funùiÚ
.
cyşe
 
is
 
nÙ
 
NÚe
 
ªd
 funùiÚ.cyşnÙ 
š
 
cyşes
:

250 
cyşes
.
	$­³nd
(
funùiÚ
.
cyşe
)

251 
£lf
.
cyşes
 = cycles

253 
cyşe
 
š
 
cyşes
:

254 
sys
.
¡d”r
.
	`wr™e
("Cycle:\n")

255 
memb”
 
š
 
cyşe
.
funùiÚs
:

256 
sys
.
¡d”r
.
	`wr™e
("\tFunùiÚ %s\n" % 
memb”
.
Çme
)

258 
def
 
	$_rjª
(
£lf
, 
funùiÚ
, 
Üd”
, 
¡ack
, 
Üd”s
, 
lowlšks
, 
vis™ed
):

261 
S“
 
®so
:

262 - 
h‰p
:

265 
vis™ed
.
	$add
(
funùiÚ
)

266 
Üd”s
[
funùiÚ
] = 
Üd”


267 
lowlšks
[
funùiÚ
] = 
Üd”


268 
Üd”
 += 1

269 
pos
 = 
	$Ën
(
¡ack
)

270 
¡ack
.
	$­³nd
(
funùiÚ
)

271 
ÿÎ
 
š
 
funùiÚ
.
ÿÎs
.
	$™”v®ues
():

272 
ÿÎ“
 = 
£lf
.
funùiÚs
[
ÿÎ
.
ÿÎ“_id
]

273 #TODO: 
u£
 
a
 
£t
 
to
 
İtimize
 
lookup


274 
ÿÎ“
 
nÙ
 
š
 
Üd”s
:

275 
Üd”
 = 
£lf
.
	$_rjª
(
ÿÎ“
, 
Üd”
, 
¡ack
, 
Üd”s
, 
lowlšks
, 
vis™ed
)

276 
lowlšks
[
funùiÚ
] = 
	$mš
(
lowlšks
[
funùiÚ
],†owlšks[
ÿÎ“
])

277 
–if
 
ÿÎ“
 
š
 
¡ack
:

278 
lowlšks
[
funùiÚ
] = 
	$mš
(
lowlšks
[
funùiÚ
], 
Üd”s
[
ÿÎ“
])

279 
lowlšks
[
funùiÚ
] =ğ
Üd”s
[function]:

280 #SŒÚgly 
cÚÃùed
 
compÚ’t
 
found


281 
memb”s
 = 
¡ack
[
pos
:]

282 
d–
 
¡ack
[
pos
:]

283 
	`Ën
(
memb”s
) > 1:

284 
cyşe
 = 
	$Cyşe
()

285 
memb”
 
š
 
memb”s
:

286 
cyşe
.
	$add_funùiÚ
(
memb”
)

287  
Üd”


289 
def
 
	$ÿÎ_¿tios
(
£lf
, 
ev’t
):

290 #Agg»g©
šcomšg
 
ÿÎs


291 
cyşe_tÙ®s
 = {
	}
}

292 
cyşe
 
š
 
£lf
.
cyşes
:

293 
cyşe_tÙ®s
[
cyşe
] = 0.0

294 
funùiÚ_tÙ®s
 = {}

295 
funùiÚ
 
š
 
£lf
.
funùiÚs
.
	$™”v®ues
():

296 
funùiÚ_tÙ®s
[
funùiÚ
] = 0.0

297 
funùiÚ
 
š
 
£lf
.
funùiÚs
.
	$™”v®ues
():

298 
ÿÎ
 
š
 
funùiÚ
.
ÿÎs
.
	$™”v®ues
():

299 
ÿÎ
.
ÿÎ“_id
 !ğ
funùiÚ
.
id
:

300 
ÿÎ“
 = 
£lf
.
funùiÚs
[
ÿÎ
.
ÿÎ“_id
]

301 
funùiÚ_tÙ®s
[
ÿÎ“
] +ğ
ÿÎ
[
ev’t
]

302 
ÿÎ“
.
cyşe
 
is
 
nÙ
 
NÚe
 
ªd
 c®Ëe.cyşi nÙ 
funùiÚ
.cycle:

303 
cyşe_tÙ®s
[
ÿÎ“
.
cyşe
] +ğ
ÿÎ
[
ev’t
]

305 #Compu‹ 
the
 
¿tios


306 
funùiÚ
 
š
 
£lf
.
funùiÚs
.
	$™”v®ues
():

307 
ÿÎ
 
š
 
funùiÚ
.
ÿÎs
.
	$™”v®ues
():

308 
as£¹
 
CALL_RATIO
 
nÙ
 
š
 
ÿÎ


309 
ÿÎ
.
ÿÎ“_id
 !ğ
funùiÚ
.
id
:

310 
ÿÎ“
 = 
£lf
.
funùiÚs
[
ÿÎ
.
ÿÎ“_id
]

311 
ÿÎ“
.
cyşe
 
is
 
nÙ
 
NÚe
 
ªd
 c®Ëe.cyşi nÙ 
funùiÚ
.cycle:

312 
tÙ®
 = 
cyşe_tÙ®s
[
ÿÎ“
.
cyşe
]

314 
tÙ®
 = 
funùiÚ_tÙ®s
[
ÿÎ“
]

315 
ÿÎ
[
CALL_RATIO
] = 
	$¿tio
(
ÿÎ
[
ev’t
], 
tÙ®
)

317 
def
 
	$š‹g¿‹
(
£lf
, 
ou‹v’t
, 
šev’t
):

320 
Mu¡
 
be
 
ÿÎed
 
aá”
 
fšdšg
 
the
 
cyşes
.

322 
S“
 
®so
:

323 - 
h‰p
:

326 #Sª™y 
checkšg


327 
as£¹
 
ou‹v’t
 
nÙ
 
š
 
£lf


328 
funùiÚ
 
š
 
£lf
.
funùiÚs
.
	$™”v®ues
():

329 
as£¹
 
ou‹v’t
 
nÙ
 
š
 
funùiÚ


330 
as£¹
 
šev’t
 
š
 
funùiÚ


331 
ÿÎ
 
š
 
funùiÚ
.
ÿÎs
.
	$™”v®ues
():

332 
as£¹
 
ou‹v’t
 
nÙ
 
š
 
ÿÎ


333 
ÿÎ
.
ÿÎ“_id
 !ğ
funùiÚ
.
id
:

334 
as£¹
 
CALL_RATIO
 
š
 
ÿÎ


336 #Agg»g©
the
 
šput
 
—ch
 
cyşe


337 
cyşe
 
š
 
£lf
.
cyşes
:

338 
tÙ®
 = 
šev’t
.
	$nuÎ
()

339 
funùiÚ
 
š
 
£lf
.
funùiÚs
.
	$™”v®ues
():

340 
tÙ®
 = 
šev’t
.
	$agg»g©e
(
tÙ®
, 
funùiÚ
[
šev’t
])

341 
£lf
[
šev’t
] = 
tÙ®


343 #IÁeg¿‹ 
®Úg
 
the
 
edges


344 
tÙ®
 = 
šev’t
.
	$nuÎ
()

345 
funùiÚ
 
š
 
£lf
.
funùiÚs
.
	$™”v®ues
():

346 
tÙ®
 = 
šev’t
.
	$agg»g©e
(
tÙ®
, 
funùiÚ
[
šev’t
])

347 
£lf
.
	$_š‹g¿‹_funùiÚ
(
funùiÚ
, 
ou‹v’t
, 
šev’t
)

348 
£lf
[
ou‹v’t
] = 
tÙ®


350 
def
 
	$_š‹g¿‹_funùiÚ
(
£lf
, 
funùiÚ
, 
ou‹v’t
, 
šev’t
):

351 
funùiÚ
.
cyşe
 
is
 
nÙ
 
NÚe
:

352  
£lf
.
	$_š‹g¿‹_cyşe
(
funùiÚ
.
cyşe
, 
ou‹v’t
, 
šev’t
)

354 
ou‹v’t
 
nÙ
 
š
 
funùiÚ
:

355 
tÙ®
 = 
funùiÚ
[
šev’t
]

356 
ÿÎ
 
š
 
funùiÚ
.
ÿÎs
.
	$™”v®ues
():

357 
ÿÎ
.
ÿÎ“_id
 !ğ
funùiÚ
.
id
:

358 
tÙ®
 +ğ
£lf
.
	$_š‹g¿‹_ÿÎ
(
ÿÎ
, 
ou‹v’t
, 
šev’t
)

359 
funùiÚ
[
ou‹v’t
] = 
tÙ®


360  
funùiÚ
[
ou‹v’t
]

362 
def
 
	$_š‹g¿‹_ÿÎ
(
£lf
, 
ÿÎ
, 
ou‹v’t
, 
šev’t
):

363 
as£¹
 
ou‹v’t
 
nÙ
 
š
 
ÿÎ


364 
as£¹
 
CALL_RATIO
 
š
 
ÿÎ


365 
ÿÎ“
 = 
£lf
.
funùiÚs
[
ÿÎ
.
ÿÎ“_id
]

366 
subtÙ®
 = 
ÿÎ
[
CALL_RATIO
]*
£lf
.
	$_š‹g¿‹_funùiÚ
(
ÿÎ“
, 
ou‹v’t
, 
šev’t
)

367 
ÿÎ
[
ou‹v’t
] = 
subtÙ®


368  
subtÙ®


370 
def
 
	$_š‹g¿‹_cyşe
(
£lf
, 
cyşe
, 
ou‹v’t
, 
šev’t
):

371 
ou‹v’t
 
nÙ
 
š
 
cyşe
:

373 #Compu‹ 
the
 
ou‹v’t
 th
whŞe
 
cyşe


374 
tÙ®
 = 
šev’t
.
	$nuÎ
()

375 
memb”
 
š
 
cyşe
.
funùiÚs
:

376 
subtÙ®
 = 
memb”
[
šev’t
]

377 
ÿÎ
 
š
 
memb”
.
ÿÎs
.
	$™”v®ues
():

378 
ÿÎ“
 = 
£lf
.
funùiÚs
[
ÿÎ
.
ÿÎ“_id
]

379 
ÿÎ“
.
cyşe
 
is
 
nÙ
 cycle:

380 
subtÙ®
 +ğ
£lf
.
	$_š‹g¿‹_ÿÎ
(
ÿÎ
, 
ou‹v’t
, 
šev’t
)

381 
tÙ®
 +ğ
subtÙ®


382 
cyşe
[
ou‹v’t
] = 
tÙ®


384 #Compu‹ 
the
 
time
 
´İag©ed
 
to
 
ÿÎ”s
 
of
 
this
 
cyşe


385 
ÿÎ“s
 = {
	}
}

386 
funùiÚ
 
š
 
£lf
.
funùiÚs
.
	$™”v®ues
():

387 
funùiÚ
.
cyşe
 
is
 
nÙ
 cycle:

388 
ÿÎ
 
š
 
funùiÚ
.
ÿÎs
.
	$™”v®ues
():

389 
ÿÎ“
 = 
£lf
.
funùiÚs
[
ÿÎ
.
ÿÎ“_id
]

390 
ÿÎ“
.
cyşe
 
is
 cycle:

391 
Œy
:

392 
ÿÎ“s
[
ÿÎ“
] +ğ
ÿÎ
[
CALL_RATIO
]

393 
exû±
 
KeyE¼Ü
:

394 
ÿÎ“s
[
ÿÎ“
] = 
ÿÎ
[
CALL_RATIO
]

396 
memb”
 
š
 
cyşe
.
funùiÚs
:

397 
memb”
[
ou‹v’t
] = ou‹v’t.
	$nuÎ
()

399 
ÿÎ“
, 
ÿÎ_¿tio
 
š
 
ÿÎ“s
.
	$™”™ems
():

400 
¿nks
 = {
	}
}

401 
ÿÎ_¿tios
 = {}

402 
·¹Ÿls
 = {}

403 
£lf
.
	$_¿nk_cyşe_funùiÚ
(
cyşe
, 
ÿÎ“
, 0, 
¿nks
)

404 
£lf
.
	`_ÿÎ_¿tios_cyşe
(
cyşe
, 
ÿÎ“
, 
¿nks
, 
ÿÎ_¿tios
, 
	$£t
())

405 
·¹Ÿl
 = 
£lf
.
	$_š‹g¿‹_cyşe_funùiÚ
(
cyşe
, 
ÿÎ“
, 
ÿÎ_¿tio
, 
·¹Ÿls
, 
¿nks
, 
ÿÎ_¿tios
, 
ou‹v’t
, 
šev’t
)

406 
as£¹
 
·¹Ÿl
 =ğ
	`max
(
·¹Ÿls
.
	$v®ues
())

407 
as£¹
 
nÙ
 
tÙ®
 
Ü
 
	`abs
(1.0 - 
·¹Ÿl
/(
ÿÎ_¿tio
*total)) <= 0.001

409  
cyşe
[
ou‹v’t
]

411 
def
 
	$_¿nk_cyşe_funùiÚ
(
£lf
, 
cyşe
, 
funùiÚ
, 
¿nk
, 
¿nks
):

412 
funùiÚ
 
nÙ
 
š
 
¿nks
 
Ü
„ªks[funùiÚ] > 
¿nk
:

413 
¿nks
[
funùiÚ
] = 
¿nk


414 
ÿÎ
 
š
 
funùiÚ
.
ÿÎs
.
	$™”v®ues
():

415 
ÿÎ
.
ÿÎ“_id
 !ğ
funùiÚ
.
id
:

416 
ÿÎ“
 = 
£lf
.
funùiÚs
[
ÿÎ
.
ÿÎ“_id
]

417 
ÿÎ“
.
cyşe
 
is
 cycle:

418 
£lf
.
	`_¿nk_cyşe_funùiÚ
(
cyşe
, 
ÿÎ“
, 
¿nk
 + 1, 
¿nks
)

420 
def
 
	$_ÿÎ_¿tios_cyşe
(
£lf
, 
cyşe
, 
funùiÚ
, 
¿nks
, 
ÿÎ_¿tios
, 
vis™ed
):

421 
funùiÚ
 
nÙ
 
š
 
vis™ed
:

422 
vis™ed
.
	$add
(
funùiÚ
)

423 
ÿÎ
 
š
 
funùiÚ
.
ÿÎs
.
	$™”v®ues
():

424 
ÿÎ
.
ÿÎ“_id
 !ğ
funùiÚ
.
id
:

425 
ÿÎ“
 = 
£lf
.
funùiÚs
[
ÿÎ
.
ÿÎ“_id
]

426 
ÿÎ“
.
cyşe
 
is
 cycle:

427 
¿nks
[
ÿÎ“
] >„ªks[
funùiÚ
]:

428 
ÿÎ_¿tios
[
ÿÎ“
] = c®l_¿tios.
	`g‘
(ÿÎ“, 0.0è+ 
ÿÎ
[
CALL_RATIO
]

429 
£lf
.
	$_ÿÎ_¿tios_cyşe
(
cyşe
, 
ÿÎ“
, 
¿nks
, 
ÿÎ_¿tios
, 
vis™ed
)

431 
def
 
	$_š‹g¿‹_cyşe_funùiÚ
(
£lf
, 
cyşe
, 
funùiÚ
, 
·¹Ÿl_¿tio
, 
·¹Ÿls
, 
¿nks
, 
ÿÎ_¿tios
, 
ou‹v’t
, 
šev’t
):

432 
funùiÚ
 
nÙ
 
š
 
·¹Ÿls
:

433 
·¹Ÿl
 = 
·¹Ÿl_¿tio
*
funùiÚ
[
šev’t
]

434 
ÿÎ
 
š
 
funùiÚ
.
ÿÎs
.
	$™”v®ues
():

435 
ÿÎ
.
ÿÎ“_id
 !ğ
funùiÚ
.
id
:

436 
ÿÎ“
 = 
£lf
.
funùiÚs
[
ÿÎ
.
ÿÎ“_id
]

437 
ÿÎ“
.
cyşe
 
is
 
nÙ
 cycle:

438 
as£¹
 
ou‹v’t
 
š
 
ÿÎ


439 
·¹Ÿl
 +ğ
·¹Ÿl_¿tio
*
ÿÎ
[
ou‹v’t
]

441 
¿nks
[
ÿÎ“
] >„ªks[
funùiÚ
]:

442 
ÿÎ“_·¹Ÿl
 = 
£lf
.
	$_š‹g¿‹_cyşe_funùiÚ
(
cyşe
, 
ÿÎ“
, 
·¹Ÿl_¿tio
, 
·¹Ÿls
, 
¿nks
, 
ÿÎ_¿tios
, 
ou‹v’t
, 
šev’t
)

443 
ÿÎ_¿tio
 = 
	$¿tio
(
ÿÎ
[
CALL_RATIO
], 
ÿÎ_¿tios
[
ÿÎ“
])

444 
ÿÎ_·¹Ÿl
 = 
ÿÎ_¿tio
*
ÿÎ“_·¹Ÿl


445 
Œy
:

446 
ÿÎ
[
ou‹v’t
] +ğ
ÿÎ_·¹Ÿl


447 
exû±
 
UndefšedEv’t
:

448 
ÿÎ
[
ou‹v’t
] = 
ÿÎ_·¹Ÿl


449 
·¹Ÿl
 +ğ
ÿÎ_·¹Ÿl


450 
·¹Ÿls
[
funùiÚ
] = 
·¹Ÿl


451 
Œy
:

452 
funùiÚ
[
ou‹v’t
] +ğ
·¹Ÿl


453 
exû±
 
UndefšedEv’t
:

454 
funùiÚ
[
ou‹v’t
] = 
·¹Ÿl


455  
·¹Ÿls
[
funùiÚ
]

457 
def
 
	$agg»g©e
(
£lf
, 
ev’t
):

460 
tÙ®
 = 
ev’t
.
	$nuÎ
()

461 
funùiÚ
 
š
 
£lf
.
funùiÚs
.
	$™”v®ues
():

462 
Œy
:

463 
tÙ®
 = 
ev’t
.
	$agg»g©e
(
tÙ®
, 
funùiÚ
[
ev’t
])

464 
exû±
 
UndefšedEv’t
:

466 
£lf
[
ev’t
] = 
tÙ®


468 
def
 
	$¿tio
(
£lf
, 
ou‹v’t
, 
šev’t
):

469 
as£¹
 
ou‹v’t
 
nÙ
 
š
 
£lf


470 
as£¹
 
šev’t
 
š
 
£lf


471 
funùiÚ
 
š
 
£lf
.
funùiÚs
.
	$™”v®ues
():

472 
as£¹
 
ou‹v’t
 
nÙ
 
š
 
funùiÚ


473 
as£¹
 
šev’t
 
š
 
funùiÚ


474 
funùiÚ
[
ou‹v’t
] = 
	$¿tio
(
funùiÚ
[
šev’t
], 
£lf
[inevent])

475 
ÿÎ
 
š
 
funùiÚ
.
ÿÎs
.
	$™”v®ues
():

476 
as£¹
 
ou‹v’t
 
nÙ
 
š
 
ÿÎ


477 
šev’t
 
š
 
ÿÎ
:

478 
ÿÎ
[
ou‹v’t
] = 
	$¿tio
(
ÿÎ
[
šev’t
], 
£lf
[inevent])

479 
£lf
[
ou‹v’t
] = 1.0

481 
def
 
	$´uÃ
(
£lf
, 
node_th»s
, 
edge_th»s
):

484 #compu‹ 
the
 
´uÃ
 
¿tios


485 
funùiÚ
 
š
 
£lf
.
funùiÚs
.
	$™”v®ues
():

486 
Œy
:

487 
funùiÚ
[
PRUNE_RATIO
] = funùiÚ[
TOTAL_TIME_RATIO
]

488 
exû±
 
UndefšedEv’t
:

489 
·ss


491 
ÿÎ
 
š
 
funùiÚ
.
ÿÎs
.
	$™”v®ues
():

492 
ÿÎ“
 = 
£lf
.
funùiÚs
[
ÿÎ
.
ÿÎ“_id
]

494 
TOTAL_TIME_RATIO
 
š
 
ÿÎ
:

495 #hªdË 
exaù
 
ÿ£s
 
fœ¡


496 
ÿÎ
[
PRUNE_RATIO
] = c®l[
TOTAL_TIME_RATIO
]

498 
Œy
:

499 #mak
a
 
§ã
 
e¡im©e


500 
ÿÎ
[
PRUNE_RATIO
] = 
	$mš
(
funùiÚ
[
TOTAL_TIME_RATIO
], 
ÿÎ“
[TOTAL_TIME_RATIO])

501 
exû±
 
UndefšedEv’t
:

502 
·ss


504 #´uÃ 
the
 
nodes


505 
funùiÚ_id
 
š
 
£lf
.
funùiÚs
.
	$keys
():

506 
funùiÚ
 = 
£lf
.
funùiÚs
[
funùiÚ_id
]

507 
Œy
:

508 
funùiÚ
[
PRUNE_RATIO
] < 
node_th»s
:

509 
d–
 
£lf
.
funùiÚs
[
funùiÚ_id
]

510 
exû±
 
UndefšedEv’t
:

511 
·ss


513 #´uÃ 
the
 
egdes


514 
funùiÚ
 
š
 
£lf
.
funùiÚs
.
	$™”v®ues
():

515 
ÿÎ“_id
 
š
 
funùiÚ
.
ÿÎs
.
	$keys
():

516 
ÿÎ
 = 
funùiÚ
.
ÿÎs
[
ÿÎ“_id
]

517 
Œy
:

518 
ÿÎ“_id
 
nÙ
 
š
 
£lf
.
funùiÚs
 
Ü
 
ÿÎ
[
PRUNE_RATIO
] < 
edge_th»s
:

519 
d–
 
funùiÚ
.
ÿÎs
[
ÿÎ“_id
]

520 
exû±
 
UndefšedEv’t
:

521 
·ss


523 
def
 
	$dump
(
£lf
):

524 
funùiÚ
 
š
 
£lf
.
funùiÚs
.
	$™”v®ues
():

525 
sys
.
¡d”r
.
	`wr™e
('FunùiÚ %s:\n' % (
funùiÚ
.
Çme
,))

526 
£lf
.
	$_dump_ev’ts
(
funùiÚ
.
ev’ts
)

527 
ÿÎ
 
š
 
funùiÚ
.
ÿÎs
.
	$™”v®ues
():

528 
ÿÎ“
 = 
£lf
.
funùiÚs
[
ÿÎ
.
ÿÎ“_id
]

529 
sys
.
¡d”r
.
	`wr™e
(' C®È%s:\n' % (
ÿÎ“
.
Çme
,))

530 
£lf
.
	$_dump_ev’ts
(
ÿÎ
.
ev’ts
)

531 
cyşe
 
š
 
£lf
.
cyşes
:

532 
sys
.
¡d”r
.
	`wr™e
('Cycle:\n')

533 
£lf
.
	$_dump_ev’ts
(
cyşe
.
ev’ts
)

534 
funùiÚ
 
š
 
cyşe
.
funùiÚs
:

535 
sys
.
¡d”r
.
	`wr™e
(' FunùiÚ %s\n' % (
funùiÚ
.
Çme
,))

537 
def
 
	$_dump_ev’ts
(
£lf
, 
ev’ts
):

538 
ev’t
, 
v®ue
 
š
 
ev’ts
.
	$™”™ems
():

539 
sys
.
¡d”r
.
	`wr™e
(' %s: %s\n' % (
ev’t
.
Çme
,ƒv’t.
	$fÜm©
(
v®ue
)))

542 
şass
 
SŒuù
:

545 
def
 
	$__š™__
(
£lf
, 
©Œs
 = 
NÚe
):

546 
©Œs
 
is
 
NÚe
:

547 
©Œs
 = {
	}
}

548 
£lf
.
__diù__
['_©Œs'] = 
©Œs


550 
def
 
	$__g‘©Œ__
(
£lf
, 
Çme
):

551 
Œy
:

552  
£lf
.
_©Œs
[
Çme
]

553 
exû±
 
KeyE¼Ü
:

554 
¿i£
 
	$A‰ribu‹E¼Ü
(
Çme
)

556 
def
 
	$__£‰r__
(
£lf
, 
Çme
, 
v®ue
):

557 
£lf
.
_©Œs
[
Çme
] = 
v®ue


559 
def
 
	$__¡r__
(
£lf
):

560  
	$¡r
(
£lf
.
_©Œs
)

562 
def
 
	$__»´__
(
£lf
):

563  
	$»´
(
£lf
.
_©Œs
)

566 
şass
 
	$P¬£E¼Ü
(
Exû±iÚ
):

569 
def
 
	$__š™__
(
£lf
, 
msg
, 
lše
):

570 
£lf
.
msg
 = msg

571 #TODO: 
¡Üe
 
mÜe
 
sourû
 
lše
 
šfÜm©iÚ


572 
£lf
.
lše
 =†ine

574 
def
 
	$__¡r__
(
£lf
):

575  '%s: %r' % (
£lf
.
msg
, s–f.
lše
)

578 
şass
 
P¬£r
:

581 
def
 
	$__š™__
(
£lf
):

582 
·ss


584 
def
 
	$·r£
(
£lf
):

585 
¿i£
 
NÙIm¶em’‹dE¼Ü


588 
şass
 
	$LšeP¬£r
(
P¬£r
):

591 
def
 
	$__š™__
(
£lf
, 
fe
):

592 
P¬£r
.
	$__š™__
(
£lf
)

593 
£lf
.
_fe
 = 
fe


594 
£lf
.
__lše
 = 
NÚe


595 
£lf
.
__eof
 = 
F®£


597 
def
 
	$»adlše
(
£lf
):

598 
lše
 = 
£lf
.
_fe
.
	$»adlše
()

599 
nÙ
 
lše
:

600 
£lf
.
__lše
 = ''

601 
£lf
.
__eof
 = 
True


602 
£lf
.
__lše
 = 
lše
.
	`r¡r
('\r\n')

604 
def
 
	$lookah—d
(
£lf
):

605 
as£¹
 
£lf
.
__lše
 
is
 
nÙ
 
NÚe


606  
£lf
.
__lše


608 
def
 
	$cÚsume
(
£lf
):

609 
as£¹
 
£lf
.
__lše
 
is
 
nÙ
 
NÚe


610 
lše
 = 
£lf
.
__lše


611 
£lf
.
	$»adlše
()

612  
lše


614 
def
 
	$eof
(
£lf
):

615 
as£¹
 
£lf
.
__lše
 
is
 
nÙ
 
NÚe


616  
£lf
.
__eof


619 
XML_ELEMENT_START
, 
XML_ELEMENT_END
, 
XML_CHARACTER_DATA
, 
XML_EOF
 = 
	$¿nge
(4)

622 
şass
 
XmlTok’
:

624 
def
 
	$__š™__
(
£lf
, 
ty³
, 
Çme_Ü_d©a
, 
©Œs
 = 
NÚe
, 
lše
 = NÚe, 
cŞumn
 = None):

625 
as£¹
 
ty³
 
	$š
 (
XML_ELEMENT_START
, 
XML_ELEMENT_END
, 
XML_CHARACTER_DATA
, 
XML_EOF
)

626 
£lf
.
ty³
 =ype

627 
£lf
.
Çme_Ü_d©a
 =‚ame_or_data

628 
£lf
.
©Œs
 =‡ttrs

629 
£lf
.
lše
 =†ine

630 
£lf
.
cŞumn
 = column

632 
def
 
	$__¡r__
(
£lf
):

633 
£lf
.
ty³
 =ğ
XML_ELEMENT_START
:

634  '<' + 
£lf
.
Çme_Ü_d©a
 + ' ...>'

635 
£lf
.
ty³
 =ğ
XML_ELEMENT_END
:

636  '</' + 
£lf
.
Çme_Ü_d©a
 + '>'

637 
£lf
.
ty³
 =ğ
XML_CHARACTER_DATA
:

638  
£lf
.
Çme_Ü_d©a


639 
£lf
.
ty³
 =ğ
XML_EOF
:

641 
as£¹
 0

644 
şass
 
XmlTok’iz”
:

647 
def
 
	$__š™__
(
£lf
, 
å
, 
sk_ws
 = 
True
):

648 
£lf
.
å
 = fp

649 
£lf
.
tok’s
 = []

650 
£lf
.
šdex
 = 0

651 
£lf
.
fš®
 = 
F®£


652 
£lf
.
sk_ws
 = skip_ws

654 
£lf
.
ch¬aù”_pos
 = 0, 0

655 
£lf
.
ch¬aù”_d©a
 = ''

657 
£lf
.
·r£r
 = 
xml
.
·r£rs
.
ex·t
.
	$P¬£rC»©e
()

658 
£lf
.
·r£r
.
S¹EËm’tHªdËr
 = s–f.
hªdË_–em’t_¡¬t


659 
£lf
.
·r£r
.
EndEËm’tHªdËr
 = s–f.
hªdË_–em’t_’d


660 
£lf
.
·r£r
.
Ch¬aù”D©aHªdËr
 = s–f.
hªdË_ch¬aù”_d©a


662 
def
 
	$hªdË_–em’t_¡¬t
(
£lf
, 
Çme
, 
©Œibu‹s
):

663 
£lf
.
	$fšish_ch¬aù”_d©a
()

664 
lše
, 
cŞumn
 = 
£lf
.
	$pos
()

665 
tok’
 = 
	$XmlTok’
(
XML_ELEMENT_START
, 
Çme
, 
©Œibu‹s
, 
lše
, 
cŞumn
)

666 
£lf
.
tok’s
.
	$­³nd
(
tok’
)

668 
def
 
	$hªdË_–em’t_’d
(
£lf
, 
Çme
):

669 
£lf
.
	$fšish_ch¬aù”_d©a
()

670 
lše
, 
cŞumn
 = 
£lf
.
	$pos
()

671 
tok’
 = 
	$XmlTok’
(
XML_ELEMENT_END
, 
Çme
, 
NÚe
, 
lše
, 
cŞumn
)

672 
£lf
.
tok’s
.
	$­³nd
(
tok’
)

674 
def
 
	$hªdË_ch¬aù”_d©a
(
£lf
, 
d©a
):

675 
nÙ
 
£lf
.
ch¬aù”_d©a
:

676 
£lf
.
ch¬aù”_pos
 = s–f.
	$pos
()

677 
£lf
.
ch¬aù”_d©a
 +ğ
d©a


679 
def
 
	$fšish_ch¬aù”_d©a
(
£lf
):

680 
£lf
.
ch¬aù”_d©a
:

681 
nÙ
 
£lf
.
sk_ws
 
Ü
‚Ù s–f.
ch¬aù”_d©a
.
	$is¥aû
():

682 
lše
, 
cŞumn
 = 
£lf
.
ch¬aù”_pos


683 
tok’
 = 
	$XmlTok’
(
XML_CHARACTER_DATA
, 
£lf
.
ch¬aù”_d©a
, 
NÚe
, 
lše
, 
cŞumn
)

684 
£lf
.
tok’s
.
	$­³nd
(
tok’
)

685 
£lf
.
ch¬aù”_d©a
 = ''

687 
def
 
	$Ãxt
(
£lf
):

688 
size
 = 16*1024

689 
£lf
.
šdex
 >ğ
	$Ën
(
£lf
.
tok’s
è
ªd
 
nÙ
 s–f.
fš®
:

690 
£lf
.
tok’s
 = []

691 
£lf
.
šdex
 = 0

692 
d©a
 = 
£lf
.
å
.
	$»ad
(
size
)

693 
£lf
.
fš®
 = 
	`Ën
(
d©a
è< 
size


694 
Œy
:

695 
£lf
.
·r£r
.
	$P¬£
(
d©a
, 
£lf
.
fš®
)

696 
exû±
 
xml
.
·r£rs
.
ex·t
.
Ex·tE¼Ü
, 
e
:

697 #ià
e
.
code
 =ğ
xml
.
·r£rs
.
ex·t
.
”rÜs
.
XML_ERROR_NO_ELEMENTS
:

698 
e
.
code
 == 3:

699 
·ss


701 
¿i£
 
e


702 
£lf
.
šdex
 >ğ
	$Ën
(
£lf
.
tok’s
):

703 
lše
, 
cŞumn
 = 
£lf
.
	$pos
()

704 
tok’
 = 
	$XmlTok’
(
XML_EOF
, 
NÚe
, NÚe, 
lše
, 
cŞumn
)

706 
tok’
 = 
£lf
.
tok’s
[£lf.
šdex
]

707 
£lf
.
šdex
 += 1

708  
tok’


710 
def
 
	$pos
(
£lf
):

711  
£lf
.
·r£r
.
Cu¼’tLšeNumb”
, s–f.·r£r.
Cu¼’tCŞumnNumb”


714 
şass
 
	$XmlTok’Mism©ch
(
Exû±iÚ
):

716 
def
 
	$__š™__
(
£lf
, 
ex³ùed
, 
found
):

717 
£lf
.
ex³ùed
 =ƒxpected

718 
£lf
.
found
 = found

720 
def
 
	$__¡r__
(
£lf
):

721  '%u:%u: % ex³ùed, % found' % (
£lf
.
found
.
lše
, s–f.found.
cŞumn
, 
	`¡r
(£lf.
ex³ùed
), 
	$¡r
(
£lf
.
found
))

724 
şass
 
	$XmlP¬£r
(
P¬£r
):

727 
def
 
	$__š™__
(
£lf
, 
å
):

728 
P¬£r
.
	$__š™__
(
£lf
)

729 
£lf
.
tok’iz”
 = 
	$XmlTok’iz”
(
å
)

730 
£lf
.
	$cÚsume
()

732 
def
 
	$cÚsume
(
£lf
):

733 
£lf
.
tok’
 = s–f.
tok’iz”
.
	$Ãxt
()

735 
def
 
	$m©ch_–em’t_¡¬t
(
£lf
, 
Çme
):

736  
£lf
.
tok’
.
ty³
 =ğ
XML_ELEMENT_START
 
ªd
 s–f.tok’.
Çme_Ü_d©a
 =ğ
Çme


738 
def
 
	$m©ch_–em’t_’d
(
£lf
, 
Çme
):

739  
£lf
.
tok’
.
ty³
 =ğ
XML_ELEMENT_END
 
ªd
 s–f.tok’.
Çme_Ü_d©a
 =ğ
Çme


741 
def
 
	$–em’t_¡¬t
(
£lf
, 
Çme
):

742 
£lf
.
tok’
.
ty³
 =ğ
XML_CHARACTER_DATA
:

743 
£lf
.
	$cÚsume
()

744 
£lf
.
tok’
.
ty³
 !ğ
XML_ELEMENT_START
:

745 
¿i£
 
	`XmlTok’Mism©ch
(
	`XmlTok’
(
XML_ELEMENT_START
, 
Çme
), 
£lf
.
tok’
)

746 
£lf
.
tok’
.
Çme_Ü_d©a
 !ğ
Çme
:

747 
¿i£
 
	`XmlTok’Mism©ch
(
	`XmlTok’
(
XML_ELEMENT_START
, 
Çme
), 
£lf
.
tok’
)

748 
©Œs
 = 
£lf
.
tok’
.attrs

749 
£lf
.
	$cÚsume
()

750  
©Œs


752 
def
 
	$–em’t_’d
(
£lf
, 
Çme
):

753 
£lf
.
tok’
.
ty³
 =ğ
XML_CHARACTER_DATA
:

754 
£lf
.
	$cÚsume
()

755 
£lf
.
tok’
.
ty³
 !ğ
XML_ELEMENT_END
:

756 
¿i£
 
	`XmlTok’Mism©ch
(
	`XmlTok’
(
XML_ELEMENT_END
, 
Çme
), 
£lf
.
tok’
)

757 
£lf
.
tok’
.
Çme_Ü_d©a
 !ğ
Çme
:

758 
¿i£
 
	`XmlTok’Mism©ch
(
	`XmlTok’
(
XML_ELEMENT_END
, 
Çme
), 
£lf
.
tok’
)

759 
£lf
.
	$cÚsume
()

761 
def
 
	$ch¬aù”_d©a
(
£lf
, 
¡r
 = 
True
):

762 
d©a
 = ''

763 
£lf
.
tok’
.
ty³
 =ğ
XML_CHARACTER_DATA
:

764 
d©a
 +ğ
£lf
.
tok’
.
Çme_Ü_d©a


765 
£lf
.
	$cÚsume
()

766 
¡r
:

767 
d©a
 = d©a.
	$¡r
()

768  
d©a


771 
şass
 
	$G´ofP¬£r
(
P¬£r
):

774 
S“
 
®so
:

775 - 
Ch­‹r
 "IÁ”´‘šg g´of' Ouut" 
äom
 
the
 
GNU
 
g´of
 
mªu®


776 
h‰p
:

777 - 
Fe
 "cg_´št.c" 
äom
 
the
 
GNU
 
g´of
 
sourû
 
code


778 
h‰p
:

781 
def
 
	$__š™__
(
£lf
, 
å
):

782 
P¬£r
.
	$__š™__
(
£lf
)

783 
£lf
.
å
 = fp

784 
£lf
.
funùiÚs
 = {
	}
}

785 
£lf
.
cyşes
 = {}

787 
def
 
	$»adlše
(
£lf
):

788 
lše
 = 
£lf
.
å
.
	$»adlše
()

789 
nÙ
 
lše
:

790 
sys
.
¡d”r
.
	`wr™e
('error: unexpectedƒnd of file\n')

791 
sys
.
	$ex™
(1)

792 
lše
 =†še.
	`r¡r
('\r\n')

793  
lše


795 
_št_»
 = 
»
.
	`compe
(
r
'^\d+$')

796 
_æßt_»
 = 
»
.
	`compe
(
r
'^\d+\.\d+$')

798 
def
 
	$Œª¦©e
(
£lf
, 
mo
):

800 
©Œs
 = {
	}
}

801 
groupdiù
 = 
mo
.
	$groupdiù
()

802 
Çme
, 
v®ue
 
š
 
groupdiù
.
	$™”™ems
():

803 
v®ue
 
is
 
NÚe
:

804 
v®ue
 = 
NÚe


805 
–if
 
£lf
.
_št_»
.
	$m©ch
(
v®ue
):

806 
v®ue
 = (value)

807 
–if
 
£lf
.
_æßt_»
.
	$m©ch
(
v®ue
):

808 
v®ue
 = (value)

809 
©Œs
[
Çme
] = (
v®ue
)

810  
	$SŒuù
(
©Œs
)

812 
_cg_h—d”_»
 = 
»
.
	`compe
(

813 #Üigš® 
g´of
 
h—d”


814 
r
'^\s+called/total\s+parents\s*$|' +

815 
r
'^index\s+%time\s+self\s+descendents\s+called\+self\s+name\s+index\s*$|' +

816 
r
'^\s+called/total\s+children\s*$|' +

817 #GNU 
g´of
 
h—d”


818 
r
'^index\s+%\s+time\s+self\s+children\s+called\s+name\s*$'

821 
_cg_ignÜe_»
 = 
»
.
	`compe
(

823 
r
'^\s+<spontaneous>\s*$|'

824 #š‹º® 
	`ÿÎs
 (
such
 
as
 "mcount")

825 
r
'^.*\((\d+)\)$'

828 
_cg_´im¬y_»
 = 
»
.
	`compe
(

829 
r
'^\[(?P<index>\d+)\]?' +

830 
r
'\s+(?P<percentage_time>\d+\.\d+)' +

831 
r
'\s+(?P<self>\d+\.\d+)' +

832 
r
'\s+(?P<descendants>\d+\.\d+)' +

833 
r
'\s+(?:(?P<called>\d+)(?:\+(?P<called_self>\d+))?)?' +

834 
r
'\s+(?P<name>\S.*?)' +

835 
r
'(?:\s+<cycle\s(?P<cycle>\d+)>)?' +

836 
r
'\s\[(\d+)\]$'

839 
_cg_·»Á_»
 = 
»
.
	`compe
(

840 
r
'^\s+(?P<self>\d+\.\d+)?' +

841 
r
'\s+(?P<descendants>\d+\.\d+)?' +

842 
r
'\s+(?P<called>\d+)(?:/(?P<called_total>\d+))?' +

843 
r
'\s+(?P<name>\S.*?)' +

844 
r
'(?:\s+<cycle\s(?P<cycle>\d+)>)?' +

845 
r
'\s\[(?P<index>\d+)\]$'

848 
_cg_chd_»
 = 
_cg_·»Á_»


850 
_cg_cyşe_h—d”_»
 = 
»
.
	`compe
(

851 
r
'^\[(?P<index>\d+)\]?' +

852 
r
'\s+(?P<percentage_time>\d+\.\d+)' +

853 
r
'\s+(?P<self>\d+\.\d+)' +

854 
r
'\s+(?P<descendants>\d+\.\d+)' +

855 
r
'\s+(?:(?P<called>\d+)(?:\+(?P<called_self>\d+))?)?' +

856 
r
'\s+<cycle\s(?P<cycle>\d+)\sas\sa\swhole>' +

857 
r
'\s\[(\d+)\]$'

860 
_cg_cyşe_memb”_»
 = 
»
.
	`compe
(

861 
r
'^\s+(?P<self>\d+\.\d+)?' +

862 
r
'\s+(?P<descendants>\d+\.\d+)?' +

863 
r
'\s+(?P<called>\d+)(?:\+(?P<called_self>\d+))?' +

864 
r
'\s+(?P<name>\S.*?)' +

865 
r
'(?:\s+<cycle\s(?P<cycle>\d+)>)?' +

866 
r
'\s\[(?P<index>\d+)\]$'

869 
_cg_£p_»
 = 
»
.
	`compe
(
r
'^--+$')

871 
def
 
	$·r£_funùiÚ_’Œy
(
£lf
, 
lšes
):

872 
·»Ás
 = []

873 
chd»n
 = []

875 
True
:

876 
nÙ
 
lšes
:

877 
sys
.
¡d”r
.
	`wr™e
('warning: unexpectedƒnd ofƒntry\n')

878 
lše
 = 
lšes
.
	$pİ
(0)

879 
lše
.
	`¡¬tsw™h
('['):

882 #»ad 
funùiÚ
 
·»Á
 
lše


883 
mo
 = 
£lf
.
_cg_·»Á_»
.
	$m©ch
(
lše
)

884 
nÙ
 
mo
:

885 
£lf
.
_cg_ignÜe_»
.
	$m©ch
(
lše
):

887 
sys
.
¡d”r
.
	`wr™e
('w¬nšg: uÄecognized c®Èg¿phƒÁry: %r\n' % 
lše
)

889 
·»Á
 = 
£lf
.
	$Œª¦©e
(
mo
)

890 
·»Ás
.
	$­³nd
(
·»Á
)

892 #»ad 
´im¬y
 
lše


893 
mo
 = 
£lf
.
_cg_´im¬y_»
.
	$m©ch
(
lše
)

894 
nÙ
 
mo
:

895 
sys
.
¡d”r
.
	`wr™e
('w¬nšg: uÄecognized c®Èg¿phƒÁry: %r\n' % 
lše
)

898 
funùiÚ
 = 
£lf
.
	$Œª¦©e
(
mo
)

900 
lšes
:

901 
lše
 = 
lšes
.
	$pİ
(0)

903 #»ad 
funùiÚ
 
subroutše
 
lše


904 
mo
 = 
£lf
.
_cg_chd_»
.
	$m©ch
(
lše
)

905 
nÙ
 
mo
:

906 
£lf
.
_cg_ignÜe_»
.
	$m©ch
(
lše
):

908 
sys
.
¡d”r
.
	`wr™e
('w¬nšg: uÄecognized c®Èg¿phƒÁry: %r\n' % 
lše
)

910 
chd
 = 
£lf
.
	$Œª¦©e
(
mo
)

911 
chd»n
.
	$­³nd
(
chd
)

913 
funùiÚ
.
·»Ás
 =…arents

914 
funùiÚ
.
chd»n
 = children

916 
£lf
.
funùiÚs
[
funùiÚ
.
šdex
] = function

918 
def
 
	$·r£_cyşe_’Œy
(
£lf
, 
lšes
):

920 #»ad 
cyşe
 
h—d”
 
lše


921 
lše
 = 
lšes
[0]

922 
mo
 = 
£lf
.
_cg_cyşe_h—d”_»
.
	$m©ch
(
lše
)

923 
nÙ
 
mo
:

924 
sys
.
¡d”r
.
	`wr™e
('w¬nšg: uÄecognized c®Èg¿phƒÁry: %r\n' % 
lše
)

926 
cyşe
 = 
£lf
.
	$Œª¦©e
(
mo
)

928 #»ad 
cyşe
 
memb”
 
lšes


929 
cyşe
.
funùiÚs
 = []

930 
lše
 
š
 
lšes
[1:]:

931 
mo
 = 
£lf
.
_cg_cyşe_memb”_»
.
	$m©ch
(
lše
)

932 
nÙ
 
mo
:

933 
sys
.
¡d”r
.
	`wr™e
('w¬nšg: uÄecognized c®Èg¿phƒÁry: %r\n' % 
lše
)

935 
ÿÎ
 = 
£lf
.
	$Œª¦©e
(
mo
)

936 
cyşe
.
funùiÚs
.
	$­³nd
(
ÿÎ
)

938 
£lf
.
cyşes
[
cyşe
.cycle] = cycle

940 
def
 
	$·r£_cg_’Œy
(
£lf
, 
lšes
):

941 
lšes
[0].
	`¡¬tsw™h
("["):

942 
£lf
.
	$·r£_cyşe_’Œy
(
lšes
)

944 
£lf
.
	$·r£_funùiÚ_’Œy
(
lšes
)

946 
def
 
	$·r£_cg
(
£lf
):

949 #sk 
ÿÎ
 
g¿ph
 
h—d”


950 
nÙ
 
£lf
.
_cg_h—d”_»
.
	`m©ch
(£lf.
	$»adlše
()):

951 
·ss


952 
lše
 = 
£lf
.
	$»adlše
()

953 
£lf
.
_cg_h—d”_»
.
	$m©ch
(
lše
):

954 
lše
 = 
£lf
.
	$»adlše
()

956 #´oûs 
ÿÎ
 
g¿ph
 
’Œ›s


957 
’Œy_lšes
 = []

958 
lše
 !ğ'\014': #fÜm 
ãed


959 
lše
 
ªd
 
nÙ
†še.
	$is¥aû
():

960 
£lf
.
_cg_£p_»
.
	$m©ch
(
lše
):

961 
£lf
.
	$·r£_cg_’Œy
(
’Œy_lšes
)

962 
’Œy_lšes
 = []

964 
’Œy_lšes
.
	$­³nd
(
lše
)

965 
lše
 = 
£lf
.
	$»adlše
()

967 
def
 
	$·r£
(
£lf
):

968 
£lf
.
	$·r£_cg
()

969 
£lf
.
å
.
	$şo£
()

971 
´ofe
 = 
	$Profe
()

972 
´ofe
[
TIME
] = 0.0

974 
cyşes
 = {
	}
}

975 
šdex
 
š
 
£lf
.
cyşes
.
	$™”keys
():

976 
cyşes
[
šdex
] = 
	$Cyşe
()

978 
’Œy
 
š
 
£lf
.
funùiÚs
.
	$™”v®ues
():

979 #pİuÏ‹ 
the
 
funùiÚ


980 
funùiÚ
 = 
	$FunùiÚ
(
’Œy
.
šdex
,ƒÁry.
Çme
)

981 
funùiÚ
[
TIME
] = 
’Œy
.
£lf


982 
’Œy
.
ÿÎed
 
is
 
nÙ
 
NÚe
:

983 
funùiÚ
[
CALLS
] = 
’Œy
.
ÿÎed


984 
’Œy
.
ÿÎed_£lf
 
is
 
nÙ
 
NÚe
:

985 
ÿÎ
 = 
	$C®l
(
’Œy
.
šdex
)

986 
ÿÎ
[
CALLS
] = 
’Œy
.
ÿÎed_£lf


987 
funùiÚ
[
CALLS
] +ğ
’Œy
.
ÿÎed_£lf


989 #pİuÏ‹ 
the
 
funùiÚ
 
ÿÎs


990 
chd
 
š
 
’Œy
.
chd»n
:

991 
ÿÎ
 = 
	$C®l
(
chd
.
šdex
)

993 
as£¹
 
chd
.
ÿÎed
 
is
 
nÙ
 
NÚe


994 
ÿÎ
[
CALLS
] = 
chd
.
ÿÎed


996 
chd
.
šdex
 
nÙ
 
š
 
£lf
.
funùiÚs
:

997 #NOTE: 
funùiÚs
 
th©
 
w”e
 
Ãv”
 
ÿÎed
 
but
 w”
discov”ed
 
by
 
g´of
's

998 #¡©iø
ÿÎ
 
g¿ph
 
ª®ysis
 
dÚt
 
have
 
a
 c®Èg¿ph 
’Œy
 
so
 
we
 
Ãed


999 #tØ
add
 
them
 
h”e


1000 
missšg
 = 
	$FunùiÚ
(
chd
.
šdex
, chd.
Çme
)

1001 
funùiÚ
[
TIME
] = 0.0

1002 
funùiÚ
[
CALLS
] = 0

1003 
´ofe
.
	$add_funùiÚ
(
missšg
)

1005 
funùiÚ
.
	$add_ÿÎ
(
ÿÎ
)

1007 
´ofe
.
	$add_funùiÚ
(
funùiÚ
)

1009 
’Œy
.
cyşe
 
is
 
nÙ
 
NÚe
:

1010 
Œy
:

1011 
cyşe
 = 
cyşes
[
’Œy
.cycle]

1012 
exû±
 
KeyE¼Ü
:

1013 
sys
.
¡d”r
.
	`wr™e
('w¬nšg: <cyş%u‡ ¨whŞe>ƒÁry missšg\n' % 
’Œy
.
cyşe
)

1014 
cyşe
 = 
	$Cyşe
()

1015 
cyşes
[
’Œy
.
cyşe
] = cycle

1016 
cyşe
.
	$add_funùiÚ
(
funùiÚ
)

1018 
´ofe
[
TIME
] =…rofe[TIME] + 
funùiÚ
[TIME]

1020 
cyşe
 
š
 
cyşes
.
	$™”v®ues
():

1021 
´ofe
.
	$add_cyşe
(
cyşe
)

1023 #Compu‹ 
d”ived
 
ev’ts


1024 
´ofe
.
	$v®id©e
()

1025 
´ofe
.
	$¿tio
(
TIME_RATIO
, 
TIME
)

1026 
´ofe
.
	$ÿÎ_¿tios
(
CALLS
)

1027 
´ofe
.
	$š‹g¿‹
(
TOTAL_TIME
, 
TIME
)

1028 
´ofe
.
	$¿tio
(
TOTAL_TIME_RATIO
, 
TOTAL_TIME
)

1030  
´ofe


1033 
şass
 
	$O´ofeP¬£r
(
LšeP¬£r
):

1036 
S“
 
®so
:

1037 - 
h‰p
:

1040 
_f›lds_»
 = {

1041 '§m¶es': 
r
'(?P<samples>\d+)',

1042 '%': 
r
'(?P<percentage>\S+)',

1043 'lš’¸šfo': 
r
'(?P<source>\(no†ocation information\)|\S+:\d+)',

1044 'imagÇme': 
r
'(?P<image>\S+(?:\s\(tgid:[^)]*\))?)',

1045 '­°Çme': 
r
'(?P<application>\S+)',

1046 'symbŞ‚ame': 
r
'(?P<symbol>\(no symbols\)|.+?)',

1047 
	}
}

1049 
def
 
	$__š™__
(
£lf
, 
šfe
):

1050 
LšeP¬£r
.
	$__š™__
(
£lf
, 
šfe
)

1051 
£lf
.
’Œ›s
 = {
	}
}

1052 
£lf
.
’Œy_»
 = 
NÚe


1054 
def
 
	$add_’Œy
(
£lf
, 
ÿÎ”s
, 
funùiÚ
, 
ÿÎ“s
):

1055 
Œy
:

1056 
’Œy
 = 
£lf
.
’Œ›s
[
funùiÚ
.
id
]

1057 
exû±
 
KeyE¼Ü
:

1058 
£lf
.
’Œ›s
[
funùiÚ
.
id
] = (
ÿÎ”s
, funùiÚ, 
ÿÎ“s
)

1060 
ÿÎ”s_tÙ®
, 
funùiÚ_tÙ®
, 
ÿÎ“s_tÙ®
 = 
’Œy


1061 
£lf
.
	$upd©e_sub’Œ›s_diù
(
ÿÎ”s_tÙ®
, 
ÿÎ”s
)

1062 
funùiÚ_tÙ®
.
§m¶es
 +ğ
funùiÚ
.samples

1063 
£lf
.
	$upd©e_sub’Œ›s_diù
(
ÿÎ“s_tÙ®
, 
ÿÎ“s
)

1065 
def
 
	$upd©e_sub’Œ›s_diù
(
£lf
, 
tÙ®s
, 
·¹Ÿls
):

1066 
·¹Ÿl
 
š
 
·¹Ÿls
.
	$™”v®ues
():

1067 
Œy
:

1068 
tÙ®
 = 
tÙ®s
[
·¹Ÿl
.
id
]

1069 
exû±
 
KeyE¼Ü
:

1070 
tÙ®s
[
·¹Ÿl
.
id
] =…artial

1072 
tÙ®
.
§m¶es
 +ğ
·¹Ÿl
.samples

1074 
def
 
	$·r£
(
£lf
):

1075 #»ad 
lookah—d


1076 
£lf
.
	$»adlše
()

1078 
£lf
.
	$·r£_h—d”
()

1079 
£lf
.
	$lookah—d
():

1080 
£lf
.
	$·r£_’Œy
()

1082 
´ofe
 = 
	$Profe
()

1084 
»v”£_ÿÎ_§m¶es
 = {
	}
}

1086 #pİuÏ‹ 
the
 
´ofe


1087 
´ofe
[
SAMPLES
] = 0

1088 
_ÿÎ”s
, 
	g_funùiÚ
, 
_ÿÎ“s
 
š
 
	g£lf
.
	g’Œ›s
.
	$™”v®ues
():

1089 
funùiÚ
 = 
	$FunùiÚ
(
_funùiÚ
.
id
, _funùiÚ.
Çme
)

1090 
funùiÚ
[
SAMPLES
] = 
_funùiÚ
.
§m¶es


1091 
´ofe
.
	$add_funùiÚ
(
funùiÚ
)

1092 
´ofe
[
SAMPLES
] +ğ
_funùiÚ
.
§m¶es


1094 
_funùiÚ
.
­¶iÿtiÚ
:

1095 
funùiÚ
[
PROCESS
] = 
os
.
·th
.
	$ba£Çme
(
_funùiÚ
.
­¶iÿtiÚ
)

1096 
_funùiÚ
.
image
:

1097 
funùiÚ
[
MODULE
] = 
os
.
·th
.
	$ba£Çme
(
_funùiÚ
.
image
)

1099 
tÙ®_ÿÎ“_§m¶es
 = 0

1100 
_ÿÎ“
 
š
 
_ÿÎ“s
.
	$™”v®ues
():

1101 
tÙ®_ÿÎ“_§m¶es
 +ğ
_ÿÎ“
.
§m¶es


1103 
_ÿÎ“
 
š
 
_ÿÎ“s
.
	$™”v®ues
():

1104 
nÙ
 
_ÿÎ“
.
£lf
:

1105 
ÿÎ
 = 
	$C®l
(
_ÿÎ“
.
id
)

1106 
ÿÎ
[
SAMPLES2
] = 
_ÿÎ“
.
§m¶es


1107 
funùiÚ
.
	$add_ÿÎ
(
ÿÎ
)

1109 #compu‹ 
d”ived
 
d©a


1110 
´ofe
.
	$v®id©e
()

1111 
´ofe
.
	$fšd_cyşes
()

1112 
´ofe
.
	$¿tio
(
TIME_RATIO
, 
SAMPLES
)

1113 
´ofe
.
	$ÿÎ_¿tios
(
SAMPLES2
)

1114 
´ofe
.
	$š‹g¿‹
(
TOTAL_TIME_RATIO
, 
TIME_RATIO
)

1116  
´ofe


1118 
def
 
	$·r£_h—d”
(
£lf
):

1119 
nÙ
 
£lf
.
	$m©ch_h—d”
():

1120 
£lf
.
	$cÚsume
()

1121 
lše
 = 
£lf
.
	$lookah—d
()

1122 
f›lds
 = 
»
.
	`¥l™
(
r
'\s\s+', 
lše
)

1123 
’Œy_»
 = 
r
'^\s*' +„'\s+'.
	`još
([
£lf
.
_f›lds_»
[
f›ld
] f›ld 
š
 
f›lds
]) +„'(?P<self>\s+\[self\])?$'

1124 
£lf
.
’Œy_»
 = 
»
.
	$compe
(
’Œy_»
)

1125 
£lf
.
	$sk_£·¿tÜ
()

1127 
def
 
	$·r£_’Œy
(
£lf
):

1128 
ÿÎ”s
 = 
£lf
.
	$·r£_sub’Œ›s
()

1129 
£lf
.
	$m©ch_´im¬y
():

1130 
funùiÚ
 = 
£lf
.
	$·r£_sub’Œy
()

1131 
funùiÚ
 
is
 
nÙ
 
NÚe
:

1132 
ÿÎ“s
 = 
£lf
.
	$·r£_sub’Œ›s
()

1133 
£lf
.
	$add_’Œy
(
ÿÎ”s
, 
funùiÚ
, 
ÿÎ“s
)

1134 
£lf
.
	$sk_£·¿tÜ
()

1136 
def
 
	$·r£_sub’Œ›s
(
£lf
):

1137 
sub’Œ›s
 = {
	}
}

1138 
£lf
.
	$m©ch_£cÚd¬y
():

1139 
sub’Œy
 = 
£lf
.
	$·r£_sub’Œy
()

1140 
sub’Œ›s
[
sub’Œy
.
id
] = subentry

1141  
sub’Œ›s


1143 
def
 
	$·r£_sub’Œy
(
£lf
):

1144 
’Œy
 = 
	$SŒuù
()

1145 
lše
 = 
£lf
.
	$cÚsume
()

1146 
mo
 = 
£lf
.
’Œy_»
.
	$m©ch
(
lše
)

1147 
nÙ
 
mo
:

1148 
¿i£
 
	`P¬£E¼Ü
('çedØ·r£', 
lše
)

1149 
f›lds
 = 
mo
.
	$groupdiù
()

1150 
’Œy
.
§m¶es
 = (
f›lds
.
	`g‘
('samples', 0))

1151 
’Œy
.
³rûÁage
 = (
f›lds
.
	`g‘
('percentage', 0.0))

1152 'sourû' 
š
 
f›lds
 
ªd
 fields['source'] != '(no†ocation information)':

1153 
sourû
 = 
f›lds
['source']

1154 
f’ame
, 
lš’o
 = 
sourû
.
	`¥l™
(':')

1155 
’Œy
.
f’ame
 = filename

1156 
’Œy
.
lš’o
 = (lineno)

1158 
sourû
 = ''

1159 
’Œy
.
f’ame
 = 
NÚe


1160 
’Œy
.
lš’o
 = 
NÚe


1161 
’Œy
.
image
 = 
f›lds
.
	`g‘
('image', '')

1162 
’Œy
.
­¶iÿtiÚ
 = 
f›lds
.
	`g‘
('application', '')

1163 'symbŞ' 
š
 
f›lds
 
ªd
 fields['symbol'] != '(no symbols)':

1164 
’Œy
.
symbŞ
 = 
f›lds
['symbol']

1166 
’Œy
.
symbŞ
 = ''

1167 
’Œy
.
symbŞ
.
	`¡¬tsw™h
('"'è
ªd
ƒÁry.symbŞ.
	`’dsw™h
('"'):

1168 
’Œy
.
symbŞ
 =ƒntry.symbol[1:-1]

1169 
’Œy
.
id
 = ':'.
	`još
(ÓÁry.
­¶iÿtiÚ
,ƒÁry.
image
, 
sourû
,ƒÁry.
symbŞ
))

1170 
’Œy
.
£lf
 = 
f›lds
.
	`g‘
('£lf', 
NÚe
) != None

1171 
’Œy
.
£lf
:

1172 
’Œy
.
id
 += ':self'

1173 
’Œy
.
symbŞ
:

1174 
’Œy
.
Çme
 =ƒÁry.
symbŞ


1176 
’Œy
.
Çme
 =ƒÁry.
image


1177  
’Œy


1179 
def
 
	$sk_£·¿tÜ
(
£lf
):

1180 
nÙ
 
£lf
.
	$m©ch_£·¿tÜ
():

1181 
£lf
.
	$cÚsume
()

1182 
£lf
.
	$cÚsume
()

1184 
def
 
	$m©ch_h—d”
(
£lf
):

1185 
lše
 = 
£lf
.
	$lookah—d
()

1186  
lše
.
	`¡¬tsw™h
('samples')

1188 
def
 
	$m©ch_£·¿tÜ
(
£lf
):

1189 
lše
 = 
£lf
.
	$lookah—d
()

1190  
lše
 =ğ'-'*
	$Ën
(
lše
)

1192 
def
 
	$m©ch_´im¬y
(
£lf
):

1193 
lše
 = 
£lf
.
	$lookah—d
()

1194  
nÙ
 
lše
[:1].
	$is¥aû
()

1196 
def
 
	$m©ch_£cÚd¬y
(
£lf
):

1197 
lše
 = 
£lf
.
	$lookah—d
()

1198  
lše
[:1].
	$is¥aû
()

1201 
şass
 
	$Sy¥rofP¬£r
(
XmlP¬£r
):

1203 
def
 
	$__š™__
(
£lf
, 
¡»am
):

1204 
XmlP¬£r
.
	$__š™__
(
£lf
, 
¡»am
)

1206 
def
 
	$·r£
(
£lf
):

1207 
objeùs
 = {
	}
}

1208 
nodes
 = {}

1210 
£lf
.
–em’t_¡¬t
('profile')

1211 
£lf
.
tok’
.
ty³
 =ğ
XML_ELEMENT_START
:

1212 
£lf
.
tok’
.
Çme_Ü_d©a
 == 'objects':

1213 
as£¹
 
nÙ
 
objeùs


1214 
objeùs
 = 
£lf
.
·r£_™ems
('objects')

1215 
–if
 
£lf
.
tok’
.
Çme_Ü_d©a
 == 'nodes':

1216 
as£¹
 
nÙ
 
nodes


1217 
nodes
 = 
£lf
.
·r£_™ems
('nodes')

1219 
£lf
.
	$·r£_v®ue
(
£lf
.
tok’
.
Çme_Ü_d©a
)

1220 
£lf
.
	`–em’t_’d
('profile')

1222  
£lf
.
	$bud_´ofe
(
objeùs
, 
nodes
)

1224 
def
 
	$·r£_™ems
(
£lf
, 
Çme
):

1225 
as£¹
 
Çme
[-1] == 's'

1226 
™ems
 = {
	}
}

1227 
£lf
.
	$–em’t_¡¬t
(
Çme
)

1228 
£lf
.
tok’
.
ty³
 =ğ
XML_ELEMENT_START
:

1229 
id
, 
v®ues
 = 
£lf
.
	`·r£_™em
(
Çme
[:-1])

1230 
as£¹
 
id
 
nÙ
 
š
 
™ems


1231 
™ems
[
id
] = 
v®ues


1232 
£lf
.
	$–em’t_’d
(
Çme
)

1233  
™ems


1235 
def
 
	$·r£_™em
(
£lf
, 
Çme
):

1236 
©Œs
 = 
£lf
.
	$–em’t_¡¬t
(
Çme
)

1237 
id
 = (
©Œs
['id'])

1238 
v®ues
 = 
£lf
.
	$·r£_v®ues
()

1239 
£lf
.
	$–em’t_’d
(
Çme
)

1240  
id
, 
v®ues


1242 
def
 
	$·r£_v®ues
(
£lf
):

1243 
v®ues
 = {
	}
}

1244 
£lf
.
tok’
.
ty³
 =ğ
XML_ELEMENT_START
:

1245 
Çme
 = 
£lf
.
tok’
.
Çme_Ü_d©a


1246 
v®ue
 = 
£lf
.
	$·r£_v®ue
(
Çme
)

1247 
as£¹
 
Çme
 
nÙ
 
š
 
v®ues


1248 
v®ues
[
Çme
] = 
v®ue


1249  
v®ues


1251 
def
 
	$·r£_v®ue
(
£lf
, 
g
):

1252 
£lf
.
	$–em’t_¡¬t
(
g
)

1253 
v®ue
 = 
£lf
.
	$ch¬aù”_d©a
()

1254 
£lf
.
	$–em’t_’d
(
g
)

1255 
v®ue
.
	$isdig™
():

1256  (
v®ue
)

1257 
v®ue
.
	`¡¬tsw™h
('"'è
ªd
 v®ue.
	`’dsw™h
('"'):

1258  
v®ue
[1:-1]

1259  
v®ue


1261 
def
 
	$bud_´ofe
(
£lf
, 
objeùs
, 
nodes
):

1262 
´ofe
 = 
	$Profe
()

1264 
´ofe
[
SAMPLES
] = 0

1265 
id
, 
objeù
 
š
 
objeùs
.
	$™”™ems
():

1266 #IgnÜ
çke
 
	`objeùs
 (
´oûss
 
Çmes
, 
moduËs
, "Ev”ythšg", "k”Ãl", 
‘c
.)

1267 
objeù
['self'] == 0:

1270 
funùiÚ
 = 
	`FunùiÚ
(
id
, 
objeù
['name'])

1271 
funùiÚ
[
SAMPLES
] = 
objeù
['self']

1272 
´ofe
.
	$add_funùiÚ
(
funùiÚ
)

1273 
´ofe
[
SAMPLES
] +ğ
funùiÚ
[SAMPLES]

1275 
id
, 
node
 
š
 
nodes
.
	$™”™ems
():

1276 #IgnÜ
çke
 
ÿÎs


1277 
node
['self'] == 0:

1280 #Fšd 
a
 
nÚ
-
ignÜed
 
·»Á


1281 
·»Á_id
 = 
node
['parent']

1282 
·»Á_id
 != 0:

1283 
·»Á
 = 
nodes
[
·»Á_id
]

1284 
ÿÎ”_id
 = 
·»Á
['object']

1285 
objeùs
[
ÿÎ”_id
]['self'] != 0:

1287 
·»Á_id
 = 
·»Á
['parent']

1288 
·»Á_id
 == 0:

1291 
ÿÎ“_id
 = 
node
['object']

1293 
as£¹
 
objeùs
[
ÿÎ”_id
]['self']

1294 
as£¹
 
objeùs
[
ÿÎ“_id
]['self']

1296 
funùiÚ
 = 
´ofe
.
funùiÚs
[
ÿÎ”_id
]

1298 
§m¶es
 = 
node
['self']

1299 
Œy
:

1300 
ÿÎ
 = 
funùiÚ
.
ÿÎs
[
ÿÎ“_id
]

1301 
exû±
 
KeyE¼Ü
:

1302 
ÿÎ
 = 
	$C®l
(
ÿÎ“_id
)

1303 
ÿÎ
[
SAMPLES2
] = 
§m¶es


1304 
funùiÚ
.
	$add_ÿÎ
(
ÿÎ
)

1306 
ÿÎ
[
SAMPLES2
] +ğ
§m¶es


1308 #Compu‹ 
d”ived
 
ev’ts


1309 
´ofe
.
	$v®id©e
()

1310 
´ofe
.
	$fšd_cyşes
()

1311 
´ofe
.
	$¿tio
(
TIME_RATIO
, 
SAMPLES
)

1312 
´ofe
.
	$ÿÎ_¿tios
(
SAMPLES2
)

1313 
´ofe
.
	$š‹g¿‹
(
TOTAL_TIME_RATIO
, 
TIME_RATIO
)

1315  
´ofe


1318 
şass
 
	$Sh¬kP¬£r
(
LšeP¬£r
):

1321 
AuthÜ
: 
tom
@
db£rviû
.
com


1324 
def
 
	$__š™__
(
£lf
, 
šfe
):

1325 
LšeP¬£r
.
	$__š™__
(
£lf
, 
šfe
)

1326 
£lf
.
¡ack
 = []

1327 
£lf
.
’Œ›s
 = {
	}
}

1329 
def
 
	$add_’Œy
(
£lf
, 
funùiÚ
):

1330 
Œy
:

1331 
’Œy
 = 
£lf
.
’Œ›s
[
funùiÚ
.
id
]

1332 
exû±
 
KeyE¼Ü
:

1333 
£lf
.
’Œ›s
[
funùiÚ
.
id
] = (funùiÚ, { 
	}
})

1335 
funùiÚ_tÙ®
, 
	gÿÎ“s_tÙ®
 = 
’Œy


1336 
funùiÚ_tÙ®
.
§m¶es
 +ğ
funùiÚ
.samples

1338 
def
 
	$add_ÿÎ“
(
£lf
, 
funùiÚ
, 
ÿÎ“
):

1339 
func
, 
ÿÎ“s
 = 
£lf
.
’Œ›s
[
funùiÚ
.
id
]

1340 
Œy
:

1341 
’Œy
 = 
ÿÎ“s
[
ÿÎ“
.
id
]

1342 
exû±
 
KeyE¼Ü
:

1343 
ÿÎ“s
[
ÿÎ“
.
id
] = callee

1345 
’Œy
.
§m¶es
 +ğ
ÿÎ“
.samples

1347 
def
 
	$·r£
(
£lf
):

1348 
£lf
.
	$»adlše
()

1349 
£lf
.
	$»adlše
()

1350 
£lf
.
	$»adlše
()

1351 
£lf
.
	$»adlše
()

1353 
m©ch
 = 
»
.
	`compe
(
r
'(?P<prefix>[|+ ]*)(?P<samples>\d+), (?P<symbol>[^,]+), (?P<image>.*)')

1355 
£lf
.
	$lookah—d
():

1356 
lše
 = 
£lf
.
	$cÚsume
()

1357 
mo
 = 
m©ch
.
	$m©ch
(
lše
)

1358 
nÙ
 
mo
:

1359 
¿i£
 
	`P¬£E¼Ü
('çedØ·r£', 
lše
)

1361 
f›lds
 = 
mo
.
	$groupdiù
()

1362 
´efix
 = 
	`Ën
(
f›lds
.
	`g‘
('prefix', 0)) / 2 - 1

1364 
symbŞ
 = 
	`¡r
(
f›lds
.
	`g‘
('symbol', 0))

1365 
image
 = 
	`¡r
(
f›lds
.
	`g‘
('image', 0))

1367 
’Œy
 = 
	$SŒuù
()

1368 
’Œy
.
id
 = ':'.
	$još
([
symbŞ
, 
image
])

1369 
’Œy
.
§m¶es
 = (
f›lds
.
	`g‘
('samples', 0))

1371 
’Œy
.
Çme
 = 
symbŞ


1372 
’Œy
.
image
 = image

1374 #adju¡ 
the
 
ÿÎ¡ack


1375 
´efix
 < 
	$Ën
(
£lf
.
¡ack
):

1376 
d–
 
£lf
.
¡ack
[
´efix
:]

1378 
´efix
 =ğ
	$Ën
(
£lf
.
¡ack
):

1379 
£lf
.
¡ack
.
	$­³nd
(
’Œy
)

1381 #ià
the
 
ÿÎ¡ack
 
has
 
had
 
ª
 
’Œy
, 
™
'shis functions caller

1382 
´efix
 > 0:

1383 
£lf
.
	`add_ÿÎ“
(£lf.
¡ack
[
´efix
 - 1], 
’Œy
)

1385 
£lf
.
	$add_’Œy
(
’Œy
)

1387 
´ofe
 = 
	$Profe
()

1388 
´ofe
[
SAMPLES
] = 0

1389 
_funùiÚ
, 
_ÿÎ“s
 
š
 
£lf
.
’Œ›s
.
	$™”v®ues
():

1390 
funùiÚ
 = 
	$FunùiÚ
(
_funùiÚ
.
id
, _funùiÚ.
Çme
)

1391 
funùiÚ
[
SAMPLES
] = 
_funùiÚ
.
§m¶es


1392 
´ofe
.
	$add_funùiÚ
(
funùiÚ
)

1393 
´ofe
[
SAMPLES
] +ğ
_funùiÚ
.
§m¶es


1395 
_funùiÚ
.
image
:

1396 
funùiÚ
[
MODULE
] = 
os
.
·th
.
	$ba£Çme
(
_funùiÚ
.
image
)

1398 
_ÿÎ“
 
š
 
_ÿÎ“s
.
	$™”v®ues
():

1399 
ÿÎ
 = 
	$C®l
(
_ÿÎ“
.
id
)

1400 
ÿÎ
[
SAMPLES
] = 
_ÿÎ“
.
§m¶es


1401 
funùiÚ
.
	$add_ÿÎ
(
ÿÎ
)

1403 #compu‹ 
d”ived
 
d©a


1404 
´ofe
.
	$v®id©e
()

1405 
´ofe
.
	$fšd_cyşes
()

1406 
´ofe
.
	$¿tio
(
TIME_RATIO
, 
SAMPLES
)

1407 
´ofe
.
	$ÿÎ_¿tios
(
SAMPLES
)

1408 
´ofe
.
	$š‹g¿‹
(
TOTAL_TIME_RATIO
, 
TIME_RATIO
)

1410  
´ofe


1413 
şass
 
	$SË•yP¬£r
(
P¬£r
):

1416 
S“
 
®so
:

1417 - 
h‰p
:

1418 - 
h‰p
:

1421 
def
 
	$__š™__
(
£lf
, 
f’ame
):

1422 
P¬£r
.
	$__š™__
(
£lf
)

1424 
äom
 
zfe
 
impÜt
 
ZFe


1426 
£lf
.
d©aba£
 = 
	$ZFe
(
f’ame
)

1428 
£lf
.
symbŞs
 = {
	}
}

1429 
£lf
.
ÿÎs
 = {}

1431 
£lf
.
´ofe
 = 
	$Profe
()

1433 
_symbŞ_»
 = 
»
.
	`compe
(

1434 
r
'^(?P<id>\w+)' +

1435 
r
'\s+"(?P<module>[^"]*)"' +

1436 
r
'\s+"(?P<procname>[^"]*)"' +

1437 
r
'\s+"(?P<sourcefile>[^"]*)"' +

1438 
r
'\s+(?P<sourceline>\d+)$'

1441 
def
 
	$·r£_symbŞs
(
£lf
):

1442 
lšes
 = 
£lf
.
d©aba£
.
	`»ad
('symbŞs.txt').
	$¥l™lšes
()

1443 
lše
 
š
 
lšes
:

1444 
mo
 = 
£lf
.
_symbŞ_»
.
	$m©ch
(
lše
)

1445 
mo
:

1446 
symbŞ_id
, 
moduË
, 
´oúame
, 
sourûfe
, 
sourûlše
 = 
mo
.
	$groups
()

1448 
funùiÚ_id
 = ':'.
	$još
([
moduË
, 
´oúame
])

1450 
Œy
:

1451 
funùiÚ
 = 
£lf
.
´ofe
.
funùiÚs
[
funùiÚ_id
]

1452 
exû±
 
KeyE¼Ü
:

1453 
funùiÚ
 = 
	$FunùiÚ
(
funùiÚ_id
, 
´oúame
)

1454 
funùiÚ
[
SAMPLES
] = 0

1455 
£lf
.
´ofe
.
	$add_funùiÚ
(
funùiÚ
)

1457 
£lf
.
symbŞs
[
symbŞ_id
] = 
funùiÚ


1459 
def
 
	$·r£_ÿÎ¡acks
(
£lf
):

1460 
lšes
 = 
£lf
.
d©aba£
.
	`»ad
("ÿÎ¡acks.txt").
	$¥l™lšes
()

1461 
lše
 
š
 
lšes
:

1462 
f›lds
 = 
lše
.
	$¥l™
()

1463 
§m¶es
 = (
f›lds
[0])

1464 
ÿÎ¡ack
 = 
f›lds
[1:]

1466 
ÿÎ¡ack
 = [
£lf
.
symbŞs
[
symbŞ_id
] symbŞ_id 
š
 callstack]

1468 
ÿÎ“
 = 
ÿÎ¡ack
[0]

1470 
ÿÎ“
[
SAMPLES
] +ğ
§m¶es


1471 
£lf
.
´ofe
[
SAMPLES
] +ğ
§m¶es


1473 
ÿÎ”
 
š
 
ÿÎ¡ack
[1:]:

1474 
Œy
:

1475 
ÿÎ
 = 
ÿÎ”
.
ÿÎs
[
ÿÎ“
.
id
]

1476 
exû±
 
KeyE¼Ü
:

1477 
ÿÎ
 = 
	$C®l
(
ÿÎ“
.
id
)

1478 
ÿÎ
[
SAMPLES2
] = 
§m¶es


1479 
ÿÎ”
.
	$add_ÿÎ
(
ÿÎ
)

1481 
ÿÎ
[
SAMPLES2
] +ğ
§m¶es


1483 
ÿÎ“
 = 
ÿÎ”


1485 
def
 
	$·r£
(
£lf
):

1486 
´ofe
 = 
£lf
.profile

1487 
´ofe
[
SAMPLES
] = 0

1489 
£lf
.
	$·r£_symbŞs
()

1490 
£lf
.
	$·r£_ÿÎ¡acks
()

1492 #Compu‹ 
d”ived
 
ev’ts


1493 
´ofe
.
	$v®id©e
()

1494 
´ofe
.
	$fšd_cyşes
()

1495 
´ofe
.
	$¿tio
(
TIME_RATIO
, 
SAMPLES
)

1496 
´ofe
.
	$ÿÎ_¿tios
(
SAMPLES2
)

1497 
´ofe
.
	$š‹g¿‹
(
TOTAL_TIME_RATIO
, 
TIME_RATIO
)

1499  
´ofe


1502 
şass
 
AQtimeTabË
:

1504 
def
 
	$__š™__
(
£lf
, 
Çme
, 
f›lds
):

1505 
£lf
.
Çme
 =‚ame

1507 
£lf
.
f›lds
 = fields

1508 
£lf
.
f›ld_cŞumn
 = {
	}
}

1509 
cŞumn
 
š
 
¿nge
(
	$Ën
(
f›lds
)):

1510 
£lf
.
f›ld_cŞumn
[
f›lds
[
cŞumn
]] = column

1511 
£lf
.
rows
 = []

1513 
def
 
	$__Ën__
(
£lf
):

1514  
	$Ën
(
£lf
.
rows
)

1516 
def
 
	$__™”__
(
£lf
):

1517 
v®ues
, 
chd»n
 
š
 
£lf
.
rows
:

1518 
f›lds
 = {
	}
}

1519 
Çme
, 
v®ue
 
š
 
	$z
(
£lf
.
f›lds
, 
v®ues
):

1520 
f›lds
[
Çme
] = 
v®ue


1521 
chd»n
 = 
	`diù
([(
chd
.
Çme
, chdèchd 
š
 children])

1522 
y›ld
 
f›lds
, 
chd»n


1523 
¿i£
 
StİI‹¿tiÚ


1525 
def
 
	`add_row
(
£lf
, 
v®ues
, 
chd»n
=()):

1526 
£lf
.
rows
.
	`­³nd
((
v®ues
, 
chd»n
))

1529 
şass
 
	$AQtimeP¬£r
(
XmlP¬£r
):

1531 
def
 
	$__š™__
(
£lf
, 
¡»am
):

1532 
XmlP¬£r
.
	$__š™__
(
£lf
, 
¡»am
)

1533 
£lf
.
bËs
 = {
	}
}

1535 
def
 
	$·r£
(
£lf
):

1536 
£lf
.
	`–em’t_¡¬t
('AQtime_Results')

1537 
£lf
.
	$·r£_h—d”s
()

1538 
»suÉs
 = 
£lf
.
	$·r£_»suÉs
()

1539 
£lf
.
	`–em’t_’d
('AQtime_Results')

1540  
£lf
.
	$bud_´ofe
(
»suÉs
)

1542 
def
 
	$·r£_h—d”s
(
£lf
):

1543 
£lf
.
	`–em’t_¡¬t
('HEADERS')

1544 
£lf
.
tok’
.
ty³
 =ğ
XML_ELEMENT_START
:

1545 
£lf
.
	$·r£_bË_h—d”
()

1546 
£lf
.
	`–em’t_’d
('HEADERS')

1548 
def
 
	$·r£_bË_h—d”
(
£lf
):

1549 
©Œs
 = 
£lf
.
	`–em’t_¡¬t
('TABLE_HEADER')

1550 
Çme
 = 
©Œs
['NAME']

1551 
id
 = (
©Œs
['ID'])

1552 
f›ld_ty³s
 = []

1553 
f›ld_Çmes
 = []

1554 
£lf
.
tok’
.
ty³
 =ğ
XML_ELEMENT_START
:

1555 
f›ld_ty³
, 
f›ld_Çme
 = 
£lf
.
	$·r£_bË_f›ld
()

1556 
f›ld_ty³s
.
	$­³nd
(
f›ld_ty³
)

1557 
f›ld_Çmes
.
	$­³nd
(
f›ld_Çme
)

1558 
£lf
.
	`–em’t_’d
('TABLE_HEADER')

1559 
£lf
.
bËs
[
id
] = 
Çme
, 
f›ld_ty³s
, 
f›ld_Çmes


1561 
def
 
	$·r£_bË_f›ld
(
£lf
):

1562 
©Œs
 = 
£lf
.
	`–em’t_¡¬t
('TABLE_FIELD')

1563 
ty³
 = 
©Œs
['TYPE']

1564 
Çme
 = 
£lf
.
	$ch¬aù”_d©a
()

1565 
£lf
.
	`–em’t_’d
('TABLE_FIELD')

1566  
ty³
, 
Çme


1568 
def
 
	$·r£_»suÉs
(
£lf
):

1569 
£lf
.
	`–em’t_¡¬t
('RESULTS')

1570 
bË
 = 
£lf
.
	$·r£_d©a
()

1571 
£lf
.
	`–em’t_’d
('RESULTS')

1572  
bË


1574 
def
 
	$·r£_d©a
(
£lf
):

1575 
rows
 = []

1576 
©Œs
 = 
£lf
.
	`–em’t_¡¬t
('DATA')

1577 
bË_id
 = (
©Œs
['TABLE_ID'])

1578 
bË_Çme
, 
f›ld_ty³s
, 
f›ld_Çmes
 = 
£lf
.
bËs
[
bË_id
]

1579 
bË
 = 
	$AQtimeTabË
(
bË_Çme
, 
f›ld_Çmes
)

1580 
£lf
.
tok’
.
ty³
 =ğ
XML_ELEMENT_START
:

1581 
row
, 
chd»n
 = 
£lf
.
	$·r£_row
(
f›ld_ty³s
)

1582 
bË
.
	$add_row
(
row
, 
chd»n
)

1583 
£lf
.
	`–em’t_’d
('DATA')

1584  
bË


1586 
def
 
	$·r£_row
(
£lf
, 
f›ld_ty³s
):

1587 
row
 = [
NÚe
]*
	$Ën
(
f›ld_ty³s
)

1588 
chd»n
 = []

1589 
£lf
.
	`–em’t_¡¬t
('ROW')

1590 
£lf
.
tok’
.
ty³
 =ğ
XML_ELEMENT_START
:

1591 
£lf
.
tok’
.
Çme_Ü_d©a
 == 'FIELD':

1592 
f›ld_id
, 
f›ld_v®ue
 = 
£lf
.
	$·r£_f›ld
(
f›ld_ty³s
)

1593 
row
[
f›ld_id
] = 
f›ld_v®ue


1594 
–if
 
£lf
.
tok’
.
Çme_Ü_d©a
 == 'CHILDREN':

1595 
chd»n
 = 
£lf
.
	$·r£_chd»n
()

1597 
¿i£
 
	`XmlTok’Mism©ch
("<FIELD ...> o¸<CHILDREN ...>", 
£lf
.
tok’
)

1598 
£lf
.
	`–em’t_’d
('ROW')

1599  
row
, 
chd»n


1601 
def
 
	$·r£_f›ld
(
£lf
, 
f›ld_ty³s
):

1602 
©Œs
 = 
£lf
.
	`–em’t_¡¬t
('FIELD')

1603 
id
 = (
©Œs
['ID'])

1604 
ty³
 = 
f›ld_ty³s
[
id
]

1605 
v®ue
 = 
£lf
.
	$ch¬aù”_d©a
()

1606 
ty³
 == 'Integer':

1607 
v®ue
 = (value)

1608 
–if
 
ty³
 == 'Float':

1609 
v®ue
 = (value)

1610 
–if
 
ty³
 == 'Address':

1611 
v®ue
 = (value)

1612 
–if
 
ty³
 == 'String':

1613 
·ss


1615 
as£¹
 
F®£


1616 
£lf
.
	`–em’t_’d
('FIELD')

1617  
id
, 
v®ue


1619 
def
 
	$·r£_chd»n
(
£lf
):

1620 
chd»n
 = []

1621 
£lf
.
	`–em’t_¡¬t
('CHILDREN')

1622 
£lf
.
tok’
.
ty³
 =ğ
XML_ELEMENT_START
:

1623 
bË
 = 
£lf
.
	$·r£_d©a
()

1624 
as£¹
 
bË
.
Çme
 
nÙ
 
š
 
chd»n


1625 
chd»n
.
	$­³nd
(
bË
)

1626 
£lf
.
	`–em’t_’d
('CHILDREN')

1627  
chd»n


1629 
def
 
	$bud_´ofe
(
£lf
, 
»suÉs
):

1630 
as£¹
 
»suÉs
.
Çme
 == 'Routines'

1631 
´ofe
 = 
	$Profe
()

1632 
´ofe
[
TIME
] = 0.0

1633 
f›lds
, 
bËs
 
š
 
»suÉs
:

1634 
funùiÚ
 = 
£lf
.
	$bud_funùiÚ
(
f›lds
)

1635 
chd»n
 = 
bËs
['Children']

1636 
f›lds
, 
_
 
š
 
chd»n
:

1637 
ÿÎ
 = 
£lf
.
	$bud_ÿÎ
(
f›lds
)

1638 
funùiÚ
.
	$add_ÿÎ
(
ÿÎ
)

1639 
´ofe
.
	$add_funùiÚ
(
funùiÚ
)

1640 
´ofe
[
TIME
] =…rofe[TIME] + 
funùiÚ
[TIME]

1641 
´ofe
[
TOTAL_TIME
] =…rofe[
TIME
]

1642 
´ofe
.
	$¿tio
(
TOTAL_TIME_RATIO
, 
TOTAL_TIME
)

1643  
´ofe


1645 
def
 
	$bud_funùiÚ
(
£lf
, 
f›lds
):

1646 
funùiÚ
 = 
	`FunùiÚ
(
£lf
.
	`bud_id
(
f›lds
), s–f.
	$bud_Çme
(
f›lds
))

1647 
funùiÚ
[
TIME
] = 
f›lds
['Time']

1648 
funùiÚ
[
TOTAL_TIME
] = 
f›lds
['Time with Children']

1649 #funùiÚ[
TIME_RATIO
] = 
f›lds
['% Time']/100.0

1650 #funùiÚ[
TOTAL_TIME_RATIO
] = 
f›lds
['% with Children']/100.0

1651  
funùiÚ


1653 
def
 
	$bud_ÿÎ
(
£lf
, 
f›lds
):

1654 
ÿÎ
 = 
	`C®l
(
£lf
.
	$bud_id
(
f›lds
))

1655 
ÿÎ
[
TIME
] = 
f›lds
['Time']

1656 
ÿÎ
[
TOTAL_TIME
] = 
f›lds
['Time with Children']

1657 #ÿÎ[
TIME_RATIO
] = 
f›lds
['% Time']/100.0

1658 #ÿÎ[
TOTAL_TIME_RATIO
] = 
f›lds
['% with Children']/100.0

1659  
ÿÎ


1661 
def
 
	$bud_id
(
£lf
, 
f›lds
):

1662  ':'.
	`još
([
f›lds
['Module Name'], fields['Unit Name'], fields['Routine Name']])

1664 
def
 
	$bud_Çme
(
£lf
, 
f›lds
):

1665 #TODO: 
u£
 
mÜe
 
f›lds


1666  
f›lds
['Routine Name']

1669 
şass
 
P¡©sP¬£r
:

1672 
def
 
	$__š™__
(
£lf
, *
f’ame
):

1673 
impÜt
 
p¡©s


1674 
Œy
:

1675 
£lf
.
¡©s
 = 
p¡©s
.
	$Sts
(*
f’ame
)

1676 
exû±
 
V®ueE¼Ü
:

1677 
impÜt
 
hÙshÙ
.
¡©s


1678 
£lf
.
¡©s
 = 
hÙshÙ
.¡©s.
	$lßd
(
f’ame
[0])

1679 
£lf
.
´ofe
 = 
	$Profe
()

1680 
£lf
.
funùiÚ_ids
 = {
	}
}

1682 
def
 
g‘_funùiÚ_Çme
(
£lf
, (
f’ame
, 
lše
, 
Çme
)):

1683 
moduË
 = 
os
.
·th
.
¥l™ext
(
f’ame
)[0]

1684 
moduË
 = 
os
.
·th
.
	$ba£Çme
(
moduË
)

1685  "%s:%d:%s" % (
moduË
, 
lše
, 
Çme
)

1687 
def
 
	$g‘_funùiÚ
(
£lf
, 
key
):

1688 
Œy
:

1689 
id
 = 
£lf
.
funùiÚ_ids
[
key
]

1690 
exû±
 
KeyE¼Ü
:

1691 
id
 = 
	$Ën
(
£lf
.
funùiÚ_ids
)

1692 
Çme
 = 
£lf
.
	$g‘_funùiÚ_Çme
(
key
)

1693 
funùiÚ
 = 
	$FunùiÚ
(
id
, 
Çme
)

1694 
£lf
.
´ofe
.
funùiÚs
[
id
] = 
funùiÚ


1695 
£lf
.
funùiÚ_ids
[
key
] = 
id


1697 
funùiÚ
 = 
£lf
.
´ofe
.
funùiÚs
[
id
]

1698  
funùiÚ


1700 
def
 
	$·r£
(
£lf
):

1701 
£lf
.
´ofe
[
TIME
] = 0.0

1702 
£lf
.
´ofe
[
TOTAL_TIME
] = s–f.
¡©s
.
tÙ®_‰


1703 
â
, (
cc
, 
nc
, 
‰
, 
ù
, 
ÿÎ”s
è
š
 
£lf
.
¡©s
.¡©s.
	$™”™ems
():

1704 
ÿÎ“
 = 
£lf
.
	$g‘_funùiÚ
(
â
)

1705 
ÿÎ“
[
CALLS
] = 
nc


1706 
ÿÎ“
[
TOTAL_TIME
] = 
ù


1707 
ÿÎ“
[
TIME
] = 
‰


1708 
£lf
.
´ofe
[
TIME
] +ğ
‰


1709 
£lf
.
´ofe
[
TOTAL_TIME
] = 
	$max
(
£lf
.
´ofe
[
TOTAL_TIME
], 
ù
)

1710 
â
, 
v®ue
 
š
 
ÿÎ”s
.
	$™”™ems
():

1711 
ÿÎ”
 = 
£lf
.
	$g‘_funùiÚ
(
â
)

1712 
ÿÎ
 = 
	$C®l
(
ÿÎ“
.
id
)

1713 
	$isš¡ªû
(
v®ue
, 
tu¶e
):

1714 
i
 
š
 
	`x¿nge
(0, 
	`Ën
(
v®ue
), 4):

1715 
nc
, 
cc
, 
‰
, 
ù
 = 
v®ue
[
i
:i+4]

1716 
CALLS
 
š
 
ÿÎ
:

1717 
ÿÎ
[
CALLS
] +ğ
cc


1719 
ÿÎ
[
CALLS
] = 
cc


1721 
TOTAL_TIME
 
š
 
ÿÎ
:

1722 
ÿÎ
[
TOTAL_TIME
] +ğ
ù


1724 
ÿÎ
[
TOTAL_TIME
] = 
ù


1727 
ÿÎ
[
CALLS
] = 
v®ue


1728 
ÿÎ
[
TOTAL_TIME
] = 
	`¿tio
(
v®ue
, 
nc
)*
ù


1730 
ÿÎ”
.
	$add_ÿÎ
(
ÿÎ
)

1731 #£lf.
¡©s
.
	`´št_¡©s
()

1732 #£lf.
¡©s
.
	`´št_ÿÎ“s
()

1734 #Compu‹ 
d”ived
 
ev’ts


1735 
£lf
.
´ofe
.
	$v®id©e
()

1736 
£lf
.
´ofe
.
	$¿tio
(
TIME_RATIO
, 
TIME
)

1737 
£lf
.
´ofe
.
	$¿tio
(
TOTAL_TIME_RATIO
, 
TOTAL_TIME
)

1739  
£lf
.
´ofe


1742 
şass
 
Theme
:

1744 
def
 
	`__š™__
(
£lf
,

1745 
bgcŞÜ
 = (0.0, 0.0, 1.0),

1746 
mšcŞÜ
 = (0.0, 0.0, 0.0),

1747 
maxcŞÜ
 = (0.0, 0.0, 1.0),

1748 
fÚŠame
 = "Arial",

1749 
mšfÚtsize
 = 10.0,

1750 
maxfÚtsize
 = 10.0,

1751 
mš³nwidth
 = 0.5,

1752 
max³nwidth
 = 4.0,

1753 
gamma
 = 2.2,

1754 
skew
 = 1.0):

1755 
£lf
.
bgcŞÜ
 = bgcolor

1756 
£lf
.
mšcŞÜ
 = mincolor

1757 
£lf
.
maxcŞÜ
 = maxcolor

1758 
£lf
.
fÚŠame
 = fontname

1759 
£lf
.
mšfÚtsize
 = minfontsize

1760 
£lf
.
maxfÚtsize
 = maxfontsize

1761 
£lf
.
mš³nwidth
 = minpenwidth

1762 
£lf
.
max³nwidth
 = maxpenwidth

1763 
£lf
.
gamma
 = gamma

1764 
£lf
.
skew
 = skew

1766 
def
 
	$g¿ph_bgcŞÜ
(
£lf
):

1767  
£lf
.
	$h¦_to_rgb
(*
£lf
.
bgcŞÜ
)

1769 
def
 
	$g¿ph_fÚŠame
(
£lf
):

1770  
£lf
.
fÚŠame


1772 
def
 
	$g¿ph_fÚtsize
(
£lf
):

1773  
£lf
.
mšfÚtsize


1775 
def
 
	$node_bgcŞÜ
(
£lf
, 
weight
):

1776  
£lf
.
	$cŞÜ
(
weight
)

1778 
def
 
	$node_fgcŞÜ
(
£lf
, 
weight
):

1779  
£lf
.
	$g¿ph_bgcŞÜ
()

1781 
def
 
	$node_fÚtsize
(
£lf
, 
weight
):

1782  
£lf
.
	$fÚtsize
(
weight
)

1784 
def
 
	$edge_cŞÜ
(
£lf
, 
weight
):

1785  
£lf
.
	$cŞÜ
(
weight
)

1787 
def
 
	$edge_fÚtsize
(
£lf
, 
weight
):

1788  
£lf
.
	$fÚtsize
(
weight
)

1790 
def
 
	$edge_³nwidth
(
£lf
, 
weight
):

1791  
	$max
(
weight
*
£lf
.
max³nwidth
, s–f.
mš³nwidth
)

1793 
def
 
	$edge_¬rowsize
(
£lf
, 
weight
):

1794  0.5 * 
m©h
.
	`sq¹
(
£lf
.
	$edge_³nwidth
(
weight
))

1796 
def
 
	$fÚtsize
(
£lf
, 
weight
):

1797  
	$max
(
weight
**2 * 
£lf
.
maxfÚtsize
, s–f.
mšfÚtsize
)

1799 
def
 
	$cŞÜ
(
£lf
, 
weight
):

1800 
weight
 = 
	`mš
(
	`max
(weight, 0.0), 1.0)

1802 
hmš
, 
smš
, 
lmš
 = 
£lf
.
mšcŞÜ


1803 
hmax
, 
smax
, 
lmax
 = 
£lf
.
maxcŞÜ


1805 
£lf
.
skew
 < 0:

1806 
¿i£
 
	`V®ueE¼Ü
("Skew must be greaterhan 0")

1807 
–if
 
£lf
.
skew
 == 1.0:

1808 
h
 = 
hmš
 + 
weight
*(
hmax
 - hmin)

1809 
s
 = 
smš
 + 
weight
*(
smax
 - smin)

1810 
l
 = 
lmš
 + 
weight
*(
lmax
 -†min)

1812 
ba£
 = 
£lf
.
skew


1813 
h
 = 
hmš
 + ((
hmax
-hmš)*(-1.0 + (
ba£
 ** 
weight
)) / (base - 1.0))

1814 
s
 = 
smš
 + ((
smax
-smš)*(-1.0 + (
ba£
 ** 
weight
)) / (base - 1.0))

1815 
l
 = 
lmš
 + ((
lmax
-lmš)*(-1.0 + (
ba£
 ** 
weight
)) / (base - 1.0))

1817  
£lf
.
	$h¦_to_rgb
(
h
, 
s
, 
l
)

1819 
def
 
	$h¦_to_rgb
(
£lf
, 
h
, 
s
, 
l
):

1822 
S“
 
®so
:

1823 - 
h‰p
:

1826 
h
 = h % 1.0

1827 
s
 = 
	`mš
(
	`max
(s, 0.0), 1.0)

1828 
l
 = 
	`mš
(
	`max
(l, 0.0), 1.0)

1830 
l
 <= 0.5:

1831 
m2
 = 
l
*(
s
 + 1.0)

1833 
m2
 = 
l
 + 
s
 -†*s

1834 
m1
 = 
l
*2.0 - 
m2


1835 
r
 = 
£lf
.
	`_hue_to_rgb
(
m1
, 
m2
, 
h
 + 1.0/3.0)

1836 
g
 = 
£lf
.
	$_hue_to_rgb
(
m1
, 
m2
, 
h
)

1837 
b
 = 
£lf
.
	`_hue_to_rgb
(
m1
, 
m2
, 
h
 - 1.0/3.0)

1839 #Aµly 
gamma
 
cÜ»ùiÚ


1840 
r
 **ğ
£lf
.
gamma


1841 
g
 **ğ
£lf
.
gamma


1842 
b
 **ğ
£lf
.
gamma


1844  (
r
, 
g
, 
b
)

1846 
def
 
	$_hue_to_rgb
(
£lf
, 
m1
, 
m2
, 
h
):

1847 
h
 < 0.0:

1848 
h
 += 1.0

1849 
–if
 
h
 > 1.0:

1850 
h
 -= 1.0

1851 
h
*6 < 1.0:

1852  
m1
 + (
m2
 - m1)*
h
*6.0

1853 
–if
 
h
*2 < 1.0:

1854  
m2


1855 
–if
 
h
*3 < 2.0:

1856  
m1
 + (
m2
 - m1)*(2.0/3.0 - 
h
)*6.0

1858  
m1


1861 
TEMPERATURE_COLORMAP
 = 
	`Theme
(

1862 
mšcŞÜ
 = (2.0/3.0, 0.80, 0.25), #d¬k 
blue


1863 
maxcŞÜ
 = (0.0, 1.0, 0.5), #§tu»d 
»d


1864 
gamma
 = 1.0

1867 
PINK_COLORMAP
 = 
	`Theme
(

1868 
mšcŞÜ
 = (0.0, 1.0, 0.90), #pink

1869 
maxcŞÜ
 = (0.0, 1.0, 0.5), #§tu»d 
»d


1872 
GRAY_COLORMAP
 = 
	`Theme
(

1873 
mšcŞÜ
 = (0.0, 0.0, 0.85), #lighˆ
g¿y


1874 
maxcŞÜ
 = (0.0, 0.0, 0.0), #black

1877 
BW_COLORMAP
 = 
	`Theme
(

1878 
mšfÚtsize
 = 8.0,

1879 
maxfÚtsize
 = 24.0,

1880 
mšcŞÜ
 = (0.0, 0.0, 0.0), #black

1881 
maxcŞÜ
 = (0.0, 0.0, 0.0), #black

1882 
mš³nwidth
 = 0.1,

1883 
max³nwidth
 = 8.0,

1887 
şass
 
DÙWr™”
:

1890 
S“
 
®so
:

1891 - "ThDOT Lªguage" 
¥ecifiÿtiÚ


1892 
h‰p
:

1895 
def
 
	$__š™__
(
£lf
, 
å
):

1896 
£lf
.
å
 = fp

1898 
def
 
	$g¿ph
(
£lf
, 
´ofe
, 
theme
):

1899 
£lf
.
	$begš_g¿ph
()

1901 
fÚŠame
 = 
theme
.
	$g¿ph_fÚŠame
()

1903 
£lf
.
	`©Œ
('g¿ph', 
fÚŠame
=fÚŠame, 
¿nk£p
=0.25, 
node£p
=0.125)

1904 
£lf
.
	`©Œ
('node', 
fÚŠame
=fÚŠame, 
sh­e
="box", 
¡yË
="fËd", 
fÚtcŞÜ
="wh™e", 
width
=0, 
height
=0)

1905 
£lf
.
	`©Œ
('edge', 
fÚŠame
=fontname)

1907 
funùiÚ
 
š
 
´ofe
.
funùiÚs
.
	$™”v®ues
():

1908 
Ïb–s
 = []

1909 
ev’t
 
š
 
PROCESS
, 
MODULE
:

1910 
ev’t
 
š
 
funùiÚ
.
ev’ts
:

1911 
Ïb–
 = 
ev’t
.
	$fÜm©
(
funùiÚ
[
ev’t
])

1912 
Ïb–s
.
	$­³nd
(
Ïb–
)

1913 
Ïb–s
.
	$­³nd
(
funùiÚ
.
Çme
)

1914 
ev’t
 
š
 
TOTAL_TIME_RATIO
, 
TIME_RATIO
, 
CALLS
:

1915 
ev’t
 
š
 
funùiÚ
.
ev’ts
:

1916 
Ïb–
 = 
ev’t
.
	$fÜm©
(
funùiÚ
[
ev’t
])

1917 
Ïb–s
.
	$­³nd
(
Ïb–
)

1919 
Œy
:

1920 
weight
 = 
funùiÚ
[
PRUNE_RATIO
]

1921 
exû±
 
UndefšedEv’t
:

1922 
weight
 = 0.0

1924 
Ïb–
 = '\n'.
	$još
(
Ïb–s
)

1925 
£lf
.
	`node
(
funùiÚ
.
id
,

1926 
Ïb–
 =†abel,

1927 
cŞÜ
 = 
£lf
.
	`cŞÜ
(
theme
.
	`node_bgcŞÜ
(
weight
)),

1928 
fÚtcŞÜ
 = 
£lf
.
	`cŞÜ
(
theme
.
	`node_fgcŞÜ
(
weight
)),

1929 
fÚtsize
 = "%.2f" % 
theme
.
	`node_fÚtsize
(
weight
),

1932 
ÿÎ
 
š
 
funùiÚ
.
ÿÎs
.
	$™”v®ues
():

1933 
ÿÎ“
 = 
´ofe
.
funùiÚs
[
ÿÎ
.
ÿÎ“_id
]

1935 
Ïb–s
 = []

1936 
ev’t
 
š
 
TOTAL_TIME_RATIO
, 
CALLS
:

1937 
ev’t
 
š
 
ÿÎ
.
ev’ts
:

1938 
Ïb–
 = 
ev’t
.
	$fÜm©
(
ÿÎ
[
ev’t
])

1939 
Ïb–s
.
	$­³nd
(
Ïb–
)

1941 
Œy
:

1942 
weight
 = 
ÿÎ
[
PRUNE_RATIO
]

1943 
exû±
 
UndefšedEv’t
:

1944 
Œy
:

1945 
weight
 = 
ÿÎ“
[
PRUNE_RATIO
]

1946 
exû±
 
UndefšedEv’t
:

1947 
weight
 = 0.0

1949 
Ïb–
 = '\n'.
	$još
(
Ïb–s
)

1951 
£lf
.
	`edge
(
funùiÚ
.
id
, 
ÿÎ
.
ÿÎ“_id
,

1952 
Ïb–
 =†abel,

1953 
cŞÜ
 = 
£lf
.
	`cŞÜ
(
theme
.
	`edge_cŞÜ
(
weight
)),

1954 
fÚtcŞÜ
 = 
£lf
.
	`cŞÜ
(
theme
.
	`edge_cŞÜ
(
weight
)),

1955 
fÚtsize
 = "%.2f" % 
theme
.
	`edge_fÚtsize
(
weight
),

1956 
³nwidth
 = "%.2f" % 
theme
.
	`edge_³nwidth
(
weight
),

1957 
Ïb–di¡ªû
 = "%.2f" % 
theme
.
	`edge_³nwidth
(
weight
),

1958 
¬rowsize
 = "%.2f" % 
theme
.
	`edge_¬rowsize
(
weight
),

1961 
£lf
.
	$’d_g¿ph
()

1963 
def
 
	$begš_g¿ph
(
£lf
):

1964 
£lf
.
	`wr™e
('digraph {\n')

1966 
def
 
	$’d_g¿ph
(
£lf
):

1967 
£lf
.
	`wr™e
('}\n')

1969 
def
 
	$©Œ
(
£lf
, 
wh©
, **
©Œs
):

1970 
£lf
.
	`wr™e
("\t")

1971 
£lf
.
	$wr™e
(
wh©
)

1972 
£lf
.
	$©Œ_li¡
(
©Œs
)

1973 
£lf
.
	`wr™e
(";\n")

1975 
def
 
	$node
(
£lf
, 
node
, **
©Œs
):

1976 
£lf
.
	`wr™e
("\t")

1977 
£lf
.
	$id
(
node
)

1978 
£lf
.
	$©Œ_li¡
(
©Œs
)

1979 
£lf
.
	`wr™e
(";\n")

1981 
def
 
	$edge
(
£lf
, 
¤c
, 
d¡
, **
©Œs
):

1982 
£lf
.
	`wr™e
("\t")

1983 
£lf
.
	$id
(
¤c
)

1984 
£lf
.
	`wr™e
(" -> ")

1985 
£lf
.
	$id
(
d¡
)

1986 
£lf
.
	$©Œ_li¡
(
©Œs
)

1987 
£lf
.
	`wr™e
(";\n")

1989 
def
 
	$©Œ_li¡
(
£lf
, 
©Œs
):

1990 
nÙ
 
©Œs
:

1992 
£lf
.
	`wr™e
(' [')

1993 
fœ¡
 = 
True


1994 
Çme
, 
v®ue
 
š
 
©Œs
.
	$™”™ems
():

1995 
fœ¡
:

1996 
fœ¡
 = 
F®£


1998 
£lf
.
	`wr™e
(", ")

1999 
£lf
.
	$id
(
Çme
)

2000 
£lf
.
	`wr™e
('=')

2001 
£lf
.
	$id
(
v®ue
)

2002 
£lf
.
	`wr™e
(']')

2004 
def
 
	$id
(
£lf
, 
id
):

2005 
	`isš¡ªû
(
id
, (, )):

2006 
s
 = 
	$¡r
(
id
)

2007 
–if
 
	$isš¡ªû
(
id
, 
ba£¡ršg
):

2008 
id
.
	$i§Êum
():

2009 
s
 = 
id


2011 
s
 = 
£lf
.
	$esÿ³
(
id
)

2013 
¿i£
 
Ty³E¼Ü


2014 
£lf
.
	$wr™e
(
s
)

2016 
def
 
	`cŞÜ
(
£lf
, (
r
, 
g
, 
b
)):

2018 
def
 
	$æßt2št
(
f
):

2019 
f
 <= 0.0:

2021 
f
 >= 1.0:

2023  (255.0*
f
 + 0.5)

2025  "#" + "".
	`još
(["%02x" % 
	$æßt2št
(
c
èø
	`š
 (
r
, 
g
, 
b
)])

2027 
def
 
	$esÿ³
(
£lf
, 
s
):

2028 
s
 = s.
	`’code
('utf-8')

2029 
s
 = s.
	`»¶aû
('\\', 
r
'\\')

2030 
s
 = s.
	`»¶aû
('\n', 
r
'\n')

2031 
s
 = s.
	`»¶aû
('\t', 
r
'\t')

2032 
s
 = s.
	`»¶aû
('"', 
r
'\"')

2033  '"' + 
s
 + '"'

2035 
def
 
	$wr™e
(
£lf
, 
s
):

2036 
£lf
.
å
.
	$wr™e
(
s
)

2039 
şass
 
Maš
:

2042 
themes
 = {

2043 "cŞÜ": 
TEMPERATURE_COLORMAP
,

2044 "pšk": 
PINK_COLORMAP
,

2045 "g¿y": 
GRAY_COLORMAP
,

2046 "bw": 
BW_COLORMAP
,

2047 
	}
}

2049 
def
 
	$maš
(
£lf
):

2052 
·r£r
 = 
İ¬£
.
	`O±iÚP¬£r
(

2053 
u§ge
="\n\t%prog [options] [file] ...",

2054 
v”siÚ
="%%´og %s" % 
__v”siÚ__
)

2055 
·r£r
.
	`add_İtiÚ
(

2056 '-o', '--ouut', 
m‘av¬
='FILE',

2057 
ty³
="¡ršg", 
de¡
="output",

2058 
h–p
="output filename [stdout]")

2059 
·r£r
.
	`add_İtiÚ
(

2060 '-n', '--node-th»s', 
m‘av¬
='PERCENTAGE',

2061 
ty³
="æßt", 
de¡
="node_thres", =0.5,

2062 
h–p
="eliminate‚odes belowhishreshold [default: %default]")

2063 
·r£r
.
	`add_İtiÚ
(

2064 '-e', '--edge-th»s', 
m‘av¬
='PERCENTAGE',

2065 
ty³
="æßt", 
de¡
="edge_thres", =0.1,

2066 
h–p
="eliminateƒdges belowhishreshold [default: %default]")

2067 
·r£r
.
	`add_İtiÚ
(

2069 
ty³
="choiû", 
choiûs
=('prof', 'oprofile', 'sysprof', 'pstats', 'shark', 'sleepy', 'aqtime'),

2070 
de¡
="format", ="prof",

2071 
h–p
="profile format:…rof, oprofile, sysprof, shark, sleepy,‡qtime, or…stats [default: %default]")

2072 
·r£r
.
	`add_İtiÚ
(

2074 
ty³
="choiû", 
choiûs
=('color', 'pink', 'gray', 'bw'),

2075 
de¡
="theme", ="color",

2076 
h–p
="color map: color,…ink, gray, or bw [default: %default]")

2077 
·r£r
.
	`add_İtiÚ
(

2079 
aùiÚ
="store_true",

2080 
de¡
="¡r", =
F®£
,

2081 
h–p
="strip function…arameters,emplate…arameters,‡nd const modifiers from demangled C++ function‚ames")

2082 
·r£r
.
	`add_İtiÚ
(

2084 
aùiÚ
="store_true",

2085 
de¡
="w¿p", =
F®£
,

2086 
h–p
="wrap function‚ames")

2087 #add 
a
 
Ãw
 
İtiÚ
 
to
 
cÚŒŞ
 
skew
 
of
 
the
 
cŞÜiz©iÚ
 
curve


2088 
·r£r
.
	`add_İtiÚ
(

2090 
ty³
="æßt", 
de¡
="theme_skew", =1.0,

2091 
h–p
="skewhe colorization curve. Values < 1.0 give more varietyo†ower…ercentages. Value > 1.0 give†ess varietyo†ower…ercentages")

2092 (
£lf
.
İtiÚs
, s–f.
¬gs
èğ
·r£r
.
	`·r£_¬gs
(
sys
.
¬gv
[1:])

2094 
	`Ën
(
£lf
.
¬gs
è> 1 
ªd
 s–f.
İtiÚs
.
fÜm©
 != 'pstats':

2095 
·r£r
.
	`”rÜ
('incorrect‚umber of‡rguments')

2097 
Œy
:

2098 
£lf
.
theme
 = s–f.
themes
[£lf.
İtiÚs
.theme]

2099 
exû±
 
KeyE¼Ü
:

2100 
·r£r
.
	`”rÜ
('šv®id cŞÜm­ \'%s\'' % 
£lf
.
İtiÚs
.
theme
)

2102 #£ˆ
skew
 
Ú
 
the
 
theme
 
now
 
th©
 
™
 
has
 
b“n
 
picked
.

2103 
£lf
.
İtiÚs
.
theme_skew
:

2104 
£lf
.
theme
.
skew
 = s–f.
İtiÚs
.
theme_skew


2106 
£lf
.
İtiÚs
.
fÜm©
 == 'prof':

2107 
nÙ
 
£lf
.
¬gs
:

2108 
å
 = 
sys
.
¡dš


2110 
å
 = 
	`İ’
(
£lf
.
¬gs
[0], 'rt')

2111 
·r£r
 = 
	$G´ofP¬£r
(
å
)

2112 
–if
 
£lf
.
İtiÚs
.
fÜm©
 == 'oprofile':

2113 
nÙ
 
£lf
.
¬gs
:

2114 
å
 = 
sys
.
¡dš


2116 
å
 = 
	`İ’
(
£lf
.
¬gs
[0], 'rt')

2117 
·r£r
 = 
	$O´ofeP¬£r
(
å
)

2118 
–if
 
£lf
.
İtiÚs
.
fÜm©
 == 'sysprof':

2119 
nÙ
 
£lf
.
¬gs
:

2120 
å
 = 
sys
.
¡dš


2122 
å
 = 
	`İ’
(
£lf
.
¬gs
[0], 'rt')

2123 
·r£r
 = 
	$Sy¥rofP¬£r
(
å
)

2124 
–if
 
£lf
.
İtiÚs
.
fÜm©
 == 'pstats':

2125 
nÙ
 
£lf
.
¬gs
:

2126 
·r£r
.
	`”rÜ
('at†east‡ file must be specified for…stats input')

2127 
·r£r
 = 
	$P¡©sP¬£r
(*
£lf
.
¬gs
)

2128 
–if
 
£lf
.
İtiÚs
.
fÜm©
 == 'shark':

2129 
nÙ
 
£lf
.
¬gs
:

2130 
å
 = 
sys
.
¡dš


2132 
å
 = 
	`İ’
(
£lf
.
¬gs
[0], 'rt')

2133 
·r£r
 = 
	$Sh¬kP¬£r
(
å
)

2134 
–if
 
£lf
.
İtiÚs
.
fÜm©
 == 'sleepy':

2135 
	`Ën
(
£lf
.
¬gs
) != 1:

2136 
·r£r
.
	`”rÜ
('exactly one file must be specified for sleepy input')

2137 
·r£r
 = 
	$SË•yP¬£r
(
£lf
.
¬gs
[0])

2138 
–if
 
£lf
.
İtiÚs
.
fÜm©
 == 'aqtime':

2139 
nÙ
 
£lf
.
¬gs
:

2140 
å
 = 
sys
.
¡dš


2142 
å
 = 
	`İ’
(
£lf
.
¬gs
[0], 'rt')

2143 
·r£r
 = 
	$AQtimeP¬£r
(
å
)

2145 
·r£r
.
	`”rÜ
('šv®id fÜm© \'%s\'' % 
£lf
.
İtiÚs
.
fÜm©
)

2147 
£lf
.
´ofe
 = 
·r£r
.
	$·r£
()

2149 
£lf
.
İtiÚs
.
ouut
 
is
 
NÚe
:

2150 
£lf
.
ouut
 = 
sys
.
¡dout


2152 
£lf
.
ouut
 = 
	`İ’
(£lf.
İtiÚs
.output, 'wt')

2154 
£lf
.
	$wr™e_g¿ph
()

2156 
_·»Áhesis_»
 = 
»
.
	`compe
(
r
'\([^()]*\)')

2157 
_ªgËs_»
 = 
»
.
	`compe
(
r
'<[^<>]*>')

2158 
_cÚ¡_»
 = 
»
.
	`compe
(
r
'\s+const$')

2160 
def
 
	$¡r_funùiÚ_Çme
(
£lf
, 
Çme
):

2163 #SŒ 
funùiÚ
 
·¿m‘”s
 
äom
 
Çme
 
by
 
»cursiv–y
 
»movšg
 
·œed
 
·»Áhesis


2164 
True
:

2165 
Çme
, 
n
 = 
£lf
.
_·»Áhesis_»
.
	`subn
('',‚ame)

2166 
nÙ
 
n
:

2169 #SŒ cÚ¡ 
qu®if›r


2170 
Çme
 = 
£lf
.
_cÚ¡_»
.
	`sub
('',‚ame)

2172 #SŒ 
‹m¶©e
 
·¿m‘”s
 
äom
 
Çme
 
by
 
»cursiv–y
 
»movšg
 
·œed
 
ªgËs


2173 
True
:

2174 
Çme
, 
n
 = 
£lf
.
_ªgËs_»
.
	`subn
('',‚ame)

2175 
nÙ
 
n
:

2178  
Çme


2180 
def
 
	$w¿p_funùiÚ_Çme
(
£lf
, 
Çme
):

2183 
	`Ën
(
Çme
) > 32:

2184 
¿tio
 = 2.0/3.0

2185 
height
 = 
	`max
((
	`Ën
(
Çme
)/(1.0 - 
¿tio
) + 0.5), 1)

2186 
width
 = 
	`max
(
	`Ën
(
Çme
)/
height
, 32)

2187 #TODO:  
lšes
 
š
 
symbŞs


2188 
Çme
 = 
‹xtw¿p
.
	$fl
(
Çme
, 
width
, 
b»ak_lÚg_wÜds
=
F®£
)

2190 #Tak
away
 
¥aûs


2191 
Çme
 =‚ame.
	`»¶aû
(", ", ",")

2192 
Çme
 =‚ame.
	`»¶aû
("> >", ">>")

2193 
Çme
 =‚ame.
	`»¶aû
("> >", ">>"è#ÿtch 
cÚ£cutive


2195  
Çme


2197 
def
 
	$com´ess_funùiÚ_Çme
(
£lf
, 
Çme
):

2200 
£lf
.
İtiÚs
.
¡r
:

2201 
Çme
 = 
£lf
.
	$¡r_funùiÚ_Çme
(
Çme
)

2203 
£lf
.
İtiÚs
.
w¿p
:

2204 
Çme
 = 
£lf
.
	$w¿p_funùiÚ_Çme
(
Çme
)

2206 #TODO: 
m”ge
 
funùiÚs
 
w™h
 
§me
 
»suÉšg
 
Çme


2208  
Çme


2210 
def
 
	$wr™e_g¿ph
(
£lf
):

2211 
dÙ
 = 
	$DÙWr™”
(
£lf
.
ouut
)

2212 
´ofe
 = 
£lf
.profile

2213 
´ofe
.
	`´uÃ
(
£lf
.
İtiÚs
.
node_th»s
/100.0, s–f.İtiÚs.
edge_th»s
/100.0)

2215 
funùiÚ
 
š
 
´ofe
.
funùiÚs
.
	$™”v®ues
():

2216 
funùiÚ
.
Çme
 = 
£lf
.
	$com´ess_funùiÚ_Çme
(
funùiÚ
.
Çme
)

2218 
dÙ
.
	$g¿ph
(
´ofe
, 
£lf
.
theme
)

2221 
__Çme__
 == '__main__':

2222 
	`Maš
().
	`maš
()

	@trunk/auto/apps.sh

1 #g’”©
the
 
bš¬y


3 #$SRS_OBJS 
the
 
objs
 
dœeùÜy
 
to
 
¡Üe
h
Makefe
. 
›
. ./objs

4 #$SRS_OBJS_DIR 
the
 
objs
 
dœeùÜy
 
Makefe
. 
›
. objs

5 #$SRS_MAKEFILE 
the
 
makefe
 
Çme
. 
›
. 
Makefe


6 #
#$MAIN_ENTRANCES 
¬¿y
, 
di§bË
 
®l
 
exû±
 
the
 
$APP_MAIN
 
™£lf
. 
›
. ["srs_main_server" "srs_main_bandcheck"]

7 #$APP_MAIN 
the
 
objeù
 
fe
 
th©
 
cÚšs
 
maš
 
funùiÚ
. 
›
. 
¤s_maš_£rv”


8 #$BUILD_KEY 
a
 
¡ršg
 
šdiÿ‹s
 
the
 
bud
 
key
 
Makefe
. 
›
. 
¤s


9 #$APP_NAME 
the
 
­p
 
Çme
 
to
 
ouut
. 
›
. 
¤s


10 #$MODULE_OBJS 
¬¿y
, 
the
 
objeùs
 
to
 
compe
h
­p
.

11 #$ModuËLibFe 
¬¿y
, 
the
 3
rd·¹
 
lib¿ry
 
fe
 
to
 
lšk
 
w™h
. 
›
. [
objs
/
¡
-1.9/
obj
/
lib¡
.
a
 objs/
libx264
/obj/libx264.a]

12 #$LINK_OPTIONS 
the
 
lšk”
 
İtiÚs
. 
›
. -
ldl


14 
	gFILE
=
$
{
SRS_OBJS
}/${
SRS_MAKEFILE
}

16 
APP_TARGET
="${SRS_OBJS_DIR}/${APP_NAME}"

18 
echo
 "generate‡pp ${APP_NAME} depends...";

20 
	gecho
 "# bud ${APP_TARGET}" >> 
	g$
{
	gFILE
}

21 #g’”©
the
 
bš¬y
 
d•’ds
, 
exam¶e
:

22 #¤s: 
objs
/
¤s


23 
	gecho
 "${BUILD_KEY}: ${APP_TARGET}" >> 
	g$
{
	gFILE
}

24 #th
lšk
 
commªds
, 
exam¶e
:

25 #objs/
¤s
: 
objs
/
¤c
/
cÜe
/
¤s_cÜe
.
o


26 
	gecho
 -
	gn
 "${APP_TARGET}: " >> 
	g$
{
	gFILE
}

27 
™em
 
š
 
	g$
{
	gMODULE_OBJS
[*]}; do

28 
	gFILE_NAME
=`
ba£Çme
 
$™em
`

29 
FILE_NAME
=
$
{FILE_NAME%.*}

31 
ignÜed
=0

32 
di§bËd_™em
 
š
 
$
{
MAIN_ENTRANCES
[*]}; do

33 [[ 
$
{
FILE_NAME
} =ğ${
di§bËd_™em
} && ${FILE_NAME} !ğ${
APP_MAIN
} ]]; 
th’


34 
	gignÜed
=1

36 
fi


37 
dÚe


39 [ ! -
f
 
$
{
™em
} ]; 
th’


40 
	gignÜed
=1

41 
fi


43 [ 
$
{
ignÜed
} =ğ1 ]; 
th’


45 
fi


47 
	gOBJ_FILE
=
$
{
SRS_OBJS_DIR
}/
$™em


48 
OBJ_FILE
="${OBJ_FILE%.*}.o"

49 
echo
 -
n
 "${OBJ_FILE} " >> 
$
{
FILE
}

50 
dÚe


51 
echo
 "" >> 
$
{
FILE
}

53 
echo
 "generate‡pp ${APP_NAME}†ink...";

55 #g’”—‹ 
the
 
aùu®
 
lšk
 
commªd
, 
exam¶e
:

56 #$(
LINK
è-
o
 
objs
/
¤s
 objs/
¤c
/
cÜe
/
¤s_cÜe
.Ø-
ldl


57 
	gecho
 -
	gn
 " \$(LINKè-Ø${APP_TARGET} " >> 
	g$
{
	gFILE
}

58 
™em
 
š
 
	g$
{
	gMODULE_OBJS
[*]}; do

59 
	gFILE_NAME
=`
ba£Çme
 
$™em
`

60 
FILE_NAME
=
$
{FILE_NAME%.*}

62 
ignÜed
=0

63 
di§bËd_™em
 
š
 
$
{
MAIN_ENTRANCES
[*]}; do

64 [[ 
$
{
FILE_NAME
} =ğ${
di§bËd_™em
} && ${FILE_NAME} !ğ${
APP_MAIN
} ]]; 
th’


65 
	gignÜed
=1

67 
fi


68 
dÚe


70 [ ! -
f
 
$
{
™em
} ]; 
th’


71 
	gignÜed
=1

72 
fi


74 [ 
$
{
ignÜed
} =ğ1 ]; 
th’


76 
fi


78 
	gOBJ_FILE
=
$
{
SRS_OBJS_DIR
}/
$™em


79 
OBJ_FILE
="${OBJ_FILE%.*}.o"

80 
echo
 -
n
 "${OBJ_FILE} " >> 
$
{
FILE
}

81 
dÚe


82 #3
rd·¹
 
lib¿ry
 
lšk
.

83 
™em
 
š
 
$
{
ModuËLibFes
[*]}; do

84 
	gecho
 -
	gn
 "$™em " >> 
	g$
{
	gFILE
}

85 
	gdÚe


86 #lšk 
İtiÚs
.

87 
	gecho
 -
	gn
 "${LINK_OPTIONS}" >> 
	g$
{
	gFILE
}

88 
	gecho
 "" >> 
	g$
{
	gFILE
}

90 
	gecho
 -
	gn
 "generate‡pp ${APP_NAME} ok";ƒcho '!';

	@trunk/auto/auto_headers.sh

1 #!/
bš
/
bash


3 #ouuˆ
v¬ŸbËs
:

4 #SRS_AUTO_HEADERS_H: 
the
‡utØ
g’”©ed
 
h—d”
 
fe
.

6 
	gSRS_AUTO_HEADERS_H
="${SRS_OBJS}/srs_auto_headers.hpp"

8 #wr™
u£r
 
İtiÚs
 
to
 
h—d”s


9 
echo
 "//‡utØg’”©ed by cÚfigu»" > 
$SRS_AUTO_HEADERS_H


10 
echo
 "#iâdeàSRS_AUTO_HEADER_HPP" >> 
$SRS_AUTO_HEADERS_H


11 
echo
 "#defšSRS_AUTO_HEADER_HPP" >> 
$SRS_AUTO_HEADERS_H


12 
echo
 "" >> 
$SRS_AUTO_HEADERS_H


14 
echo
 "#defšSRS_AUTO_BUILD_TS \"`d©+%s`\"" >> 
$SRS_AUTO_HEADERS_H


15 
echo
 "#defšSRS_AUTO_BUILD_DATE \"`d©\"+%Y-%m-%d %H:%M:%S\"`\"" >> 
$SRS_AUTO_HEADERS_H


16 
echo
 "#defšSRS_AUTO_UNAME \"`uÇm-a`\"" >> 
$SRS_AUTO_HEADERS_H


17 
echo
 "#defšSRS_AUTO_USER_CONFIGURE \"${SRS_AUTO_USER_CONFIGURE}\"" >> 
$SRS_AUTO_HEADERS_H


18 
echo
 "#defšSRS_AUTO_CONFIGURE \"${SRS_AUTO_CONFIGURE}\"" >> 
$SRS_AUTO_HEADERS_H


19 
echo
 "" >> 
$SRS_AUTO_HEADERS_H


21 #expÜˆ
the
 
´e£t
.

22 [ 
$SRS_OSX
 = 
YES
 ]; 
th’


23 
	gecho
 "#defšSRS_OSX" >> 
$SRS_AUTO_HEADERS_H


24 
fi


25 [ 
$SRS_X86_X64
 = 
YES
 ]; 
th’


26 
	gecho
 "#defšSRS_X86_X64" >> 
$SRS_AUTO_HEADERS_H


27 
fi


28 [ 
$SRS_ARM_UBUNTU12
 = 
YES
 ]; 
th’


29 
	gecho
 "#defšSRS_ARM_UBUNTU12" >> 
$SRS_AUTO_HEADERS_H


30 
fi


31 [ 
$SRS_MIPS_UBUNTU12
 = 
YES
 ]; 
th’


32 
	gecho
 "#defšSRS_MIPS_UBUNTU12" >> 
$SRS_AUTO_HEADERS_H


33 
fi


34 [ 
$SRS_PI
 = 
YES
 ]; 
th’


35 
	gecho
 "#defšSRS_PI" >> 
$SRS_AUTO_HEADERS_H


36 
fi


37 [ 
$SRS_CUBIE
 = 
YES
 ]; 
th’


38 
	gecho
 "#defšSRS_CUBIE" >> 
$SRS_AUTO_HEADERS_H


39 
fi


40 [ 
$SRS_EXPORT_LIBRTMP_PROJECT
 !ğ
NO
 ]; 
th’


41 
	gecho
 "#defšSRS_EXPORT_LIBRTMP" >> 
$SRS_AUTO_HEADERS_H


43 
	gecho
 "#undeàSRS_EXPORT_LIBRTMP" >> 
$SRS_AUTO_HEADERS_H


44 
fi


46 
	gecho
 "" >> 
	g$SRS_AUTO_HEADERS_H


48 #####################################################################################
#g’”©autØ
h—d”s
 
fe
, 
d•’ds
 
Ú
 
the
 
fšished
 
of
 
İtiÚs
.
sh


49 #####################################################################################
#wr™
to
 
sourû
 
fe


50 [ 
$SRS_CROSS_BUILD
 = 
YES
 ]; 
th’


51 
	gecho
 "cc=$SrsArmCC gcc=$SrsArmGCC g++=$SrsArmCXX‡r=$SrsArmAR†d=$SrsArmLD„andlib=$SrsArmRANDLIB"

52 
	gecho
 "#defšSRS_AUTO_EMBEDED_TOOL_CHAIN \"cc=$SrsArmCC gcc=$SrsArmGCC g++=$SrsArmCXX‡r=$SrsArmAR†d=$SrsArmLD„ªdlib=$SrsArmRANDLIB\"" >> 
$SRS_AUTO_HEADERS_H


54 
	gecho
 "#defšSRS_AUTO_EMBEDED_TOOL_CHAIN \"nÜm® x86/x64 gcc\"" >> 
$SRS_AUTO_HEADERS_H


55 
fi


56 
	gecho
 "" >> 
	g$SRS_AUTO_HEADERS_H


58 #autØ
h—d”s
 
š
 
d•’ds
.

59 [ 
$SRS_HTTP_CORE
 = 
YES
 ]; 
th’


60 
	gecho
 "#defšSRS_AUTO_HTTP_CORE" >> 
$SRS_AUTO_HEADERS_H


62 
	gecho
 "#undeàSRS_AUTO_HTTP_CORE" >> 
$SRS_AUTO_HEADERS_H


63 
fi


65 [ 
$SRS_HTTP_SERVER
 = 
YES
 ]; 
th’


66 
	gecho
 "#defšSRS_AUTO_HTTP_SERVER" >> 
$SRS_AUTO_HEADERS_H


68 
	gecho
 "#undeàSRS_AUTO_HTTP_SERVER" >> 
$SRS_AUTO_HEADERS_H


69 
fi


71 [ 
$SRS_STREAM_CASTER
 = 
YES
 ]; 
th’


72 
	gecho
 "#defšSRS_AUTO_STREAM_CASTER" >> 
$SRS_AUTO_HEADERS_H


74 
	gecho
 "#undeàSRS_AUTO_STREAM_CASTER" >> 
$SRS_AUTO_HEADERS_H


75 
fi


77 [ 
$SRS_HTTP_API
 = 
YES
 ]; 
th’


78 
	gecho
 "#defšSRS_AUTO_HTTP_API" >> 
$SRS_AUTO_HEADERS_H


80 
	gecho
 "#undeàSRS_AUTO_HTTP_API" >> 
$SRS_AUTO_HEADERS_H


81 
fi


83 [ 
$SRS_NGINX
 = 
YES
 ]; 
th’


84 
	gecho
 "#defšSRS_AUTO_NGINX" >> 
$SRS_AUTO_HEADERS_H


86 
	gecho
 "#undeàSRS_AUTO_NGINX" >> 
$SRS_AUTO_HEADERS_H


87 
fi


89 [ 
$SRS_DVR
 = 
YES
 ]; 
th’


90 
	gecho
 "#defšSRS_AUTO_DVR" >> 
$SRS_AUTO_HEADERS_H


92 
	gecho
 "#undeàSRS_AUTO_DVR" >> 
$SRS_AUTO_HEADERS_H


93 
fi


95 [ 
$SRS_HLS
 = 
YES
 ]; 
th’


96 
	gecho
 "#defšSRS_AUTO_HLS" >> 
$SRS_AUTO_HEADERS_H


98 
	gecho
 "#undeàSRS_AUTO_HLS" >> 
$SRS_AUTO_HEADERS_H


99 
fi


101 [ 
$SRS_HDS
 = 
YES
 ]; 
th’


102 
	gecho
 "#defšSRS_AUTO_HDS" >> 
$SRS_AUTO_HEADERS_H


104 
	gecho
 "#undeàSRS_AUTO_HDS" >> 
$SRS_AUTO_HEADERS_H


105 
fi


107 [ 
$SRS_HTTP_CALLBACK
 = 
YES
 ]; 
th’


108 
	gecho
 "#defšSRS_AUTO_HTTP_CALLBACK" >> 
$SRS_AUTO_HEADERS_H


110 
	gecho
 "#undeàSRS_AUTO_HTTP_CALLBACK" >> 
$SRS_AUTO_HEADERS_H


111 
fi


113 [ 
$SRS_SSL
 = 
YES
 ]; 
th’


114 
	gecho
 "#defšSRS_AUTO_SSL" >> 
$SRS_AUTO_HEADERS_H


116 
	gecho
 "#undeàSRS_AUTO_SSL" >> 
$SRS_AUTO_HEADERS_H


117 
fi


119 [ 
$SRS_MEM_WATCH
 = 
YES
 ]; 
th’


120 
	gecho
 "#defšSRS_AUTO_MEM_WATCH" >> 
$SRS_AUTO_HEADERS_H


122 
	gecho
 "#undeàSRS_AUTO_MEM_WATCH" >> 
$SRS_AUTO_HEADERS_H


123 
	gfi


125 #wh‘h” 
compe
 
ffm³g
 
toŞ


126 [ 
$SRS_FFMPEG_TOOL
 = 
YES
 ]; 
th’


127 
	gecho
 "#defšSRS_AUTO_FFMPEG_TOOL" >> 
$SRS_AUTO_HEADERS_H


129 
	gecho
 "#undeàSRS_AUTO_FFMPEG_TOOL" >> 
$SRS_AUTO_HEADERS_H


130 
	gfi


132 #wh©ev” 
the
 
FFMPEG
 
toŞs
, 
Œªscode
 
ªd
 
šge¡
 
¥ecif›d
,

133 #¤ 
®ways
 
compe
 
the
 
FFMPEG
 
toŞ
 
¡ub
 
which
 
u£d
 
to
 
¡¬t
hFFMPEG 
´oûss
.

134 [ 
$SRS_FFMPEG_STUB
 = 
YES
 ]; 
th’


135 
	gecho
 "#defšSRS_AUTO_FFMPEG_STUB" >> 
$SRS_AUTO_HEADERS_H


137 
	gecho
 "#undeàSRS_AUTO_FFMPEG_STUB" >> 
$SRS_AUTO_HEADERS_H


138 
fi


140 [ 
$SRS_TRANSCODE
 = 
YES
 ]; 
th’


141 
	gecho
 "#defšSRS_AUTO_TRANSCODE" >> 
$SRS_AUTO_HEADERS_H


143 
	gecho
 "#undeàSRS_AUTO_TRANSCODE" >> 
$SRS_AUTO_HEADERS_H


144 
fi


146 [ 
$SRS_INGEST
 = 
YES
 ]; 
th’


147 
	gecho
 "#defšSRS_AUTO_INGEST" >> 
$SRS_AUTO_HEADERS_H


149 
	gecho
 "#undeàSRS_AUTO_INGEST" >> 
$SRS_AUTO_HEADERS_H


150 
	gfi


152 #fÜ 
¡©i¡ic
.

153 [ 
$SRS_STAT
 = 
YES
 ]; 
th’


154 
	gecho
 "#defšSRS_AUTO_STAT" >> 
$SRS_AUTO_HEADERS_H


156 
	gecho
 "#undeàSRS_AUTO_STAT" >> 
$SRS_AUTO_HEADERS_H


157 
fi


159 [ 
$SRS_GPERF
 = 
YES
 ]; 
th’


160 
	gecho
 "#defšSRS_AUTO_GPERF" >> 
$SRS_AUTO_HEADERS_H


162 
	gecho
 "#undeàSRS_AUTO_GPERF" >> 
$SRS_AUTO_HEADERS_H


163 
fi


164 [ 
$SRS_GPERF_MC
 = 
YES
 ]; 
th’


165 
	gecho
 "#defšSRS_AUTO_GPERF_MC" >> 
$SRS_AUTO_HEADERS_H


167 
	gecho
 "#undeàSRS_AUTO_GPERF_MC" >> 
$SRS_AUTO_HEADERS_H


168 
fi


169 [ 
$SRS_GPERF_MP
 = 
YES
 ]; 
th’


170 
	gecho
 "#defšSRS_AUTO_GPERF_MP" >> 
$SRS_AUTO_HEADERS_H


172 
	gecho
 "#undeàSRS_AUTO_GPERF_MP" >> 
$SRS_AUTO_HEADERS_H


173 
fi


174 [ 
$SRS_GPERF_CP
 = 
YES
 ]; 
th’


175 
	gecho
 "#defšSRS_AUTO_GPERF_CP" >> 
$SRS_AUTO_HEADERS_H


177 
	gecho
 "#undeàSRS_AUTO_GPERF_CP" >> 
$SRS_AUTO_HEADERS_H


178 
	gfi


180 #####################################################################################
#fÜ 
embeded
.

181 #####################################################################################
[ 
$SRS_CROSS_BUILD
 = 
YES
 ]; 
th’


182 
	gecho
 "#defšSRS_AUTO_EMBEDED_CPU" >> 
$SRS_AUTO_HEADERS_H


184 
	gecho
 "#undeàSRS_AUTO_EMBEDED_CPU" >> 
$SRS_AUTO_HEADERS_H


185 
	gfi


188 [ 
$SRS_ARM_UBUNTU12
 = 
YES
 ]; 
th’


189 
	gecho
 "#defšSRS_AUTO_ARM_UBUNTU12" >> 
$SRS_AUTO_HEADERS_H


191 
	gecho
 "#undeàSRS_AUTO_ARM_UBUNTU12" >> 
$SRS_AUTO_HEADERS_H


192 
	gfi


195 [ 
$SRS_MIPS_UBUNTU12
 = 
YES
 ]; 
th’


196 
	gecho
 "#defšSRS_AUTO_MIPS_UBUNTU12" >> 
$SRS_AUTO_HEADERS_H


198 
	gecho
 "#undeàSRS_AUTO_MIPS_UBUNTU12" >> 
$SRS_AUTO_HEADERS_H


199 
fi


201 
	gecho
 "" >> 
	g$SRS_AUTO_HEADERS_H


202 #fÜ 
log
 
Ëv–
 
compe
 
£‰šgs


203 [ 
$SRS_LOG_VERBOSE
 = 
YES
 ]; 
th’


204 
	gecho
 "#defšSRS_AUTO_VERBOSE" >> 
$SRS_AUTO_HEADERS_H


206 
	gecho
 "#undeàSRS_AUTO_VERBOSE" >> 
$SRS_AUTO_HEADERS_H


207 
fi


208 [ 
$SRS_LOG_INFO
 = 
YES
 ]; 
th’


209 
	gecho
 "#defšSRS_AUTO_INFO" >> 
$SRS_AUTO_HEADERS_H


211 
	gecho
 "#undeàSRS_AUTO_INFO" >> 
$SRS_AUTO_HEADERS_H


212 
fi


213 [ 
$SRS_LOG_TRACE
 = 
YES
 ]; 
th’


214 
	gecho
 "#defšSRS_AUTO_TRACE" >> 
$SRS_AUTO_HEADERS_H


216 
	gecho
 "#undeàSRS_AUTO_TRACE" >> 
$SRS_AUTO_HEADERS_H


217 
	gfi


220 
	gecho
 "" >> 
$SRS_AUTO_HEADERS_H


221 
	gecho
 "#defšSRS_AUTO_PREFIX \"${SRS_PREFIX}\"" >> 
$SRS_AUTO_HEADERS_H


223 
	gecho
 "" >> 
	g$SRS_AUTO_HEADERS_H


225 #####################################################################################
#g’”©ed 
the
 
cÚŒibutÜs
 
äom
 
AUTHORS
.
txt


226 #####################################################################################
_CONSTRIBUTORS=`ÿˆ../AUTHORS.txt|g»°"*"|awk '{´šˆ$2}'`

227 
	gecho
 "#defšSRS_AUTO_CONSTRIBUTORS \"\\" >> 
$SRS_AUTO_HEADERS_H


228 
CONTRIBUTOR
 
š
 
	g$SRS_CONSTRIBUTORS
; do

229 
	gecho
 "${CONTRIBUTOR} \\" >> 
$SRS_AUTO_HEADERS_H


230 
dÚe


231 
	gecho
 "\"" >> 
	g$SRS_AUTO_HEADERS_H


233 #Ãw 
em±y
 
lše
 
to
‡utØ
h—d”s
 
fe
.

234 
	gecho
 "" >> 
	g$SRS_AUTO_HEADERS_H


236 #autØ
h—d”
 
EOF
.

237 
	gecho
 "#’dif" >> 
$SRS_AUTO_HEADERS_H


238 
	gecho
 "" >> 
	g$SRS_AUTO_HEADERS_H


	@trunk/auto/build_ffmpeg.sh

1 #!/
bš
/
bash


3 
	gff_¤c_dœ
="../../3rdparty"

5 #th
jobs
 
to
 
make
 
ffm³g


6 [[ "" =ğ
$SRS_JOBS
 ]]; 
th’


7 
expÜt
 
	gSRS_JOBS
="--jobs=1"

8 
fi


10 
ff_cu¼’t_dœ
=
$
(
pwd
 -
P
)

11 
ff_bud_dœ
="${ff_current_dir}/_build"

12 
ff_»Ëa£_dœ
="${ff_current_dir}/_release"

13 
echo
 "starto buildheools forranscode system:"

14 
echo
 "current_dir: ${ff_current_dir}"

15 
echo
 "build_dir: ${ff_build_dir}"

16 
echo
 "release_dir: ${ff_release_dir}"

17 
echo
 "SRS_JOBS: ${SRS_JOBS}"

19 
mkdœ
 -
p
 
$
{
ff_bud_dœ
}

20 
mkdœ
 -
p
 
$
{
ff_»Ëa£_dœ
}

22 #yasm 
libx264


23 
ff_yasm_bš
=
$
{
ff_»Ëa£_dœ
}/
bš
/
yasm


24 [[ -
f
 
$
{
ff_yasm_bš
} ]]; 
th’


25 
	gecho
 "yasm is ok"

27 
	gecho
 "build yasm-1.2.0"

28 
cd
 
	g$ff_cu¼’t_dœ
 &&

29 
	grm
 -
rf
 
	gyasm
-1.2.0 && 
	gunz
 -
q
 
	g$
{
	gff_¤c_dœ
}/yasm-1.2.0.
	gz
 &&

30 
cd
 
	gyasm
-1.2.0 && ./
	gcÚfigu»
 --
	g´efix
=
$
{
ff_»Ëa£_dœ
} &&

31 
make
 && mak
š¡®l


32 
»t
=
$
?; [[ 0 -
Ã
 ${»t} ]]; 
th’
 
	gecho
 "bud yasm-1.2.0 faed"; 
	gex™
 1; 
fi


33 
	gfi


34 #add 
yasm
 
to
 
·th
, 
x264
Ø
u£
 yasm 
dœeùly
.

35 #ffm³g 
ÿn
 
¥ecif›s
 
the
 
yasm
 
·th
 
wh’
 
cÚfigu»
 
™
.

36 
expÜt
 
	gPATH
=
$
{
PATH
}:${
ff_»Ëa£_dœ
}/
bš


38 #libfdk-
¯c


39 [[ -
f
 
$
{
ff_»Ëa£_dœ
}/
lib
/
libfdk
-
¯c
.
a
 ]]; 
th’


40 
	gecho
 "libfdk_aac is ok"

42 
	gecho
 "build fdk-aac-0.1.3"

43 
cd
 
	g$ff_cu¼’t_dœ
 &&

44 
	grm
 -
rf
 
	gfdk
-
	g¯c
-0.1.3 && 
	gunz
 -
q
 
	g$
{
	gff_¤c_dœ
}/fdk-¯c-0.1.3.
	gz
 &&

45 
cd
 
	gfdk
-
	g¯c
-0.1.3 && 
bash
 
	gautog’
.
	gsh
 && ./
	gcÚfigu»
 --
	g´efix
=
$
{
ff_»Ëa£_dœ
} --
’abË
-&& 
make
 ${
SRS_JOBS
} && mak
š¡®l
 &&

46 
»t
=
$
?; [[ 0 -
Ã
 ${»t} ]]; 
th’
 
	gecho
 "bud fdk-¯c-0.1.3 faed"; 
	gex™
 1; 
fi


47 
	gfi


50 [[ -
f
 
$
{
ff_»Ëa£_dœ
}/
lib
/
libmp3Ïme
.
a
 ]]; 
th’


51 
	gecho
 "libmp3lame is ok"

53 
	gecho
 "build†ame-3.99.5"

54 
cd
 
	g$ff_cu¼’t_dœ
 &&

55 
	grm
 -
rf
 
	gÏme
-3.99.5 && 
	gunz
 -
q
 
	g$
{
	gff_¤c_dœ
}/Ïme-3.99.5.
	gz
 &&

56 
cd
 
	gÏme
-3.99.5 && ./
	gcÚfigu»
 --
	g´efix
=
$
{
ff_»Ëa£_dœ
} --
’abË
-&& 
make
 ${
SRS_JOBS
} && mak
š¡®l


57 
»t
=
$
?; [[ 0 -
Ã
 ${»t} ]]; 
th’
 
	gecho
 "bud†ame-3.99.5 faed"; 
	gex™
 1; 
fi


58 
	gfi


60 #¥“x-1.2
rc1


61 [[ -
f
 
$
{
ff_»Ëa£_dœ
}/
lib
/
lib¥“x
.
a
 ]]; 
th’


62 
	gecho
 "libspeex is ok"

64 
	gecho
 "build speex-1.2rc1"

65 
cd
 
	g$ff_cu¼’t_dœ
 &&

66 
	grm
 -
rf
 
	g¥“x
-1.2
	grc1
 && 
	gunz
 -
q
 
	g$
{
	gff_¤c_dœ
}/¥“x-1.2rc1.
	gz
 &&

67 
cd
 
	g¥“x
-1.2
	grc1
 && ./
	gcÚfigu»
 --
	g´efix
=
$
{
ff_»Ëa£_dœ
} --
’abË
-&& 
make
 ${
SRS_JOBS
} && mak
š¡®l


68 
»t
=
$
?; [[ 0 -
Ã
 ${»t} ]]; 
th’
 
	gecho
 "bud s³ex-1.2rc1 faed"; 
	gex™
 1; 
fi


69 
	gfi


71 #x264 
cÜe
.138

72 [[ -
f
 
$
{
ff_»Ëa£_dœ
}/
lib
/
libx264
.
a
 ]]; 
th’


73 
	gecho
 "x264 is ok"

75 
	gecho
 "build x264"

76 
cd
 
	g$ff_cu¼’t_dœ
 &&

77 
	grm
 -
rf
 
	gx264
-
	g¢­shÙ
-20131129-2245-
	g¡abË
 && 
	gunz
 -
q
 
	g$
{
	gff_¤c_dœ
}/x264-¢­shÙ-20131129-2245-¡abË.
	gz
 &&

78 
cd
 
	gx264
-
	g¢­shÙ
-20131129-2245-
	g¡abË
 &&

79 
	gchmod
 +
w
 
	gcÚfigu»
 && 
	g·tch
 -
	gp0
 <../../../3
	grd·¹y
/
	g·tches
/5.x264.
	gosx
.
	ggcc
.patch &&

80 ./
	gcÚfigu»
 --
	g´efix
=
$
{
ff_»Ëa£_dœ
} --
di§bË
-
İ’ş
 --
b™
-
d•th
=8 \

81 --
’abË
---
di§bË
-
avs
 --di§bË-
swsÿË
 --di§bË-
Ïvf
 \

82 --
di§bË
-
ffms
 --di§bË-
g·c
 &&

83 
make
 
$
{
SRS_JOBS
} && mak
š¡®l


84 
»t
=
$
?; [[ 0 -
Ã
 ${»t} ]]; 
th’
 
	gecho
 "bud x264 faed"; 
	gex™
 1; 
fi


85 
	gfi


88 [[ -
f
 
$
{
ff_»Ëa£_dœ
}/
bš
/
ffm³g
 ]]; 
th’


89 
	gecho
 "ffmpeg-2.1.1 is ok"

91 
	gecho
 "build ffmpeg-2.1.1"

92 
cd
 
	g$ff_cu¼’t_dœ
 &&

93 
	grm
 -
rf
 
	gffm³g
-2.1.1 && 
	gunz
 -
q
 
	g$
{
	gff_¤c_dœ
}/ffm³g-2.1.1.
	gz
 &&

94 
	gecho
 "remove‡ll soo forcehe ffmpego build in static" &&

95 
	grm
 -
f
 
	g$
{
	gff_»Ëa£_dœ
}/
	glib


	@trunk/auto/depends.sh

1 #!/
bš
/
bash


3 #v¬ŸbËs, 
·»Á
 
süt
 
mu¡
 
£t
 
™
:

4 #SRS_JOBS: 
the
 
bud
 
jobs
.

5 #SrsArmMakeO±iÚs: 
the
 
¬m
 
make
 
İtiÚs
 
ubuÁu12
(
¬mhf
, 
v7ıu
)

7 #####################################################################################
#####################################################################################
#´•¬
the
 
d•’ds
 
toŞs
 
ªd
 
lib¿r›s


8 #DEPENDS: 
İtiÚs
.
sh
, 
Úly
 
wh’
 
u£r
 o±iÚ 
·r£d
, 
the
 
d•’ds
 
toŞs
 
¬e
 
known
.

11 #####################################################################################
„equœe_sudÛr()

13 
sudo
 
	gecho
 "" >/
	gdev
/
	gnuÎ
 2>&1

15 
	g»t
=
$
?; [[ 0 -
Ã
 
$»t
 ]]; 
th’


16 
	gecho
 "\"$1\"„equire sudoer failed.„et=$ret";

17 
ex™
 
	g$»t
;

18 
	gfi


21 #TODO: 
check
 
gcc
/
g
++

22 
	gecho
 "check gcc/g++/gdb/make"

23 
	gecho
 "dependsools‡re ok"

24 #####################################################################################
#fÜ 
UbuÁu
,‡utØ
š¡®l
 
toŞs
 
by
 
­t
-
g‘


25 #####################################################################################
_IS_UBUNTU=NO

26 
funùiÚ
 
	$UbuÁu_´•¬e
()

28 [ 
$SRS_CUBIE
 = 
YES
 ]; 
th’


29 
echo
 "for cubieboard, use ubuntu…repare"

31 
uÇme
 -
v
|
g»p
 
UbuÁu
 >/
dev
/
nuÎ
 2>&1

32 
»t
=
$
?; [[ 0 -
Ã
 
$»t
 ]]; 
th’


33 #fÜ 
debŸn
, 
we
 
thšk
 
™
's ubuntu‡lso.

34 #fÜ 
exam¶e
, 
the
 
wh“zy
/
sid
 
which
 
is
 
debŸn
 
¬mv7
 
lšux
, 
ÿn
 
nÙ
 
id’tif›d
 
by
 
uÇme
 -
v
.

35 [[ ! -
f
 /
‘c
/
debŸn_v”siÚ
 ]]; 
th’


37 
fi


38 
fi


39 
fi


41 #üos 
bud
 
¬m
, 
š¡®l
 
the
 
üoss
 bud 
toŞ
 
chaš
.

42 [ 
$SRS_ARM_UBUNTU12
 = 
YES
 ]; 
th’


43 
$SrsArmCC
 --
h–p
 >/
dev
/
nuÎ
 2>&1; 
»t
=
$
?; [[ 0 -
Ã
 
$»t
 ]]; 
th’


44 
echo
 "install gcc-arm-linux-gnueabi g++-arm-linux-gnueabi"

45 
»quœe_sudÛr
 "sudo‡pt-get install -y --force-yes gcc-arm-linux-gnueabi g++-arm-linux-gnueabi"

46 
sudo
 
­t
-
g‘
 
š¡®l
 -
y
 --
fÜû
-
yes
 
gcc
-
¬m
-
lšux
-
gnu—bi
 
g
++-¬m-lšux-gnu—bi; 
»t
=
$
?; [[ 0 -
Ã
 
$»t
 ]]; 
th’
  $»t; 
fi


47 
echo
 "install gcc-arm-linux-gnueabi g++-arm-linux-gnueabi success"

48 
fi


49 
fi


51 #üos 
bud
 
ms
, 
u£r
 
mu¡
 
š¡®Ëd
 
the
 
toŞ
 
chaš
.

52 [ 
$SRS_MIPS_UBUNTU12
 = 
YES
 ]; 
th’


53 
$SrsArmCC
 --
h–p
 >/
dev
/
nuÎ
 2>&1; 
»t
=
$
?; [[ 0 -
Ã
 
$»t
 ]]; 
th’


54 
echo
 "user must installheool chain: $SrsArmCC"

56 
fi


57 
fi


59 
OS_IS_UBUNTU
=
YES


60 
echo
 "Ubuntu detected, installools if‚eeded"

62 
gcc
 --
h–p
 >/
dev
/
nuÎ
 2>&1; 
»t
=
$
?; [[ 0 -
Ã
 
$»t
 ]]; 
th’


63 
echo
 "install gcc"

64 
»quœe_sudÛr
 "sudo‡pt-get install -y --force-yes gcc"

65 
sudo
 
­t
-
g‘
 
š¡®l
 -
y
 --
fÜû
-
yes
 
gcc
; 
»t
=
$
?; [[ 0 -
Ã
 
$»t
 ]]; 
th’
  $»t; 
fi


66 
echo
 "install gcc success"

67 
fi


69 
g
++ --
h–p
 >/
dev
/
nuÎ
 2>&1; 
»t
=
$
?; [[ 0 -
Ã
 
$»t
 ]]; 
th’


70 
echo
 "install g++"

71 
»quœe_sudÛr
 "sudo‡pt-get install -y --force-yes g++"

72 
sudo
 
­t
-
g‘
 
š¡®l
 -
y
 --
fÜû
-
yes
 
g
++; 
»t
=
$
?; [[ 0 -
Ã
 
$»t
 ]]; 
th’
  $»t; 
fi


73 
echo
 "install g++ success"

74 
fi


76 
make
 --
h–p
 >/
dev
/
nuÎ
 2>&1; 
»t
=
$
?; [[ 0 -
Ã
 
$»t
 ]]; 
th’


77 
echo
 "install make"

78 
»quœe_sudÛr
 "sudo‡pt-get install -y --force-yes make"

79 
sudo
 
­t
-
g‘
 
š¡®l
 -
y
 --
fÜû
-
yes
 
make
; 
»t
=
$
?; [[ 0 -
Ã
 
$»t
 ]]; 
th’
  $»t; 
fi


80 
echo
 "install make success"

81 
fi


83 
·tch
 --
h–p
 >/
dev
/
nuÎ
 2>&1; 
»t
=
$
?; [[ 0 -
Ã
 
$»t
 ]]; 
th’


84 
echo
 "install…atch"

85 
»quœe_sudÛr
 "sudo‡pt-get install -y --force-yes…atch"

86 
sudo
 
­t
-
g‘
 
š¡®l
 -
y
 --
fÜû
-
yes
 
·tch
; 
»t
=
$
?; [[ 0 -
Ã
 
$»t
 ]]; 
th’
  $»t; 
fi


87 
echo
 "install…atch success"

88 
fi


90 
unz
 --
h–p
 >/
dev
/
nuÎ
 2>&1; 
»t
=
$
?; [[ 0 -
Ã
 
$»t
 ]]; 
th’


91 
echo
 "install unzip"

92 
»quœe_sudÛr
 "sudo‡pt-get install -y --force-yes unzip"

93 
sudo
 
­t
-
g‘
 
š¡®l
 -
y
 --
fÜû
-
yes
 
unz
; 
»t
=
$
?; [[ 0 -
Ã
 
$»t
 ]]; 
th’
  $»t; 
fi


94 
echo
 "install unzip success"

95 
fi


97 [ 
$SRS_NGINX
 = 
YES
 ]; 
th’


98 [[ ! -
f
 /
u¤
/
šşude
/
püe
.
h
 ]]; 
th’


99 
echo
 "install†ibpcre3-dev"

100 
»quœe_sudÛr
 "sudo‡pt-get install -y --force-yes†ibpcre3-dev"

101 
sudo
 
­t
-
g‘
 
š¡®l
 -
y
 --
fÜû
-
yes
 
libpüe3
-
dev
; 
»t
=
$
?; [[ 0 -
Ã
 
$»t
 ]]; 
th’
  $»t; 
fi


102 
echo
 "install†ibpcre3-dev success"

103 
fi


104 
fi


106 [ 
$SRS_FFMPEG_TOOL
 = 
YES
 ]; 
th’


107 
autocÚf
 --
h–p
 >/
dev
/
nuÎ
 2>&1; 
»t
=
$
?; [[ 0 -
Ã
 
$»t
 ]]; 
th’


108 
echo
 "install‡utoconf"

109 
»quœe_sudÛr
 "sudo‡pt-get install -y --force-yes‡utoconf"

110 
sudo
 
­t
-
g‘
 
š¡®l
 -
y
 --
fÜû
-
yes
 
autocÚf
; 
»t
=
$
?; [[ 0 -
Ã
 
$»t
 ]]; 
th’
  $»t; 
fi


111 
echo
 "install‡utoconf success"

112 
fi


114 
libtoŞ
 --
h–p
 >/
dev
/
nuÎ
 2>&1; 
»t
=
$
?; [[ 0 -
Ã
 
$»t
 ]]; 
th’


115 
echo
 "install†ibtool"

116 
»quœe_sudÛr
 "sudo‡pt-get install -y --force-yes†ibtool"

117 
sudo
 
­t
-
g‘
 
š¡®l
 -
y
 --
fÜû
-
yes
 
libtoŞ
; 
»t
=
$
?; [[ 0 -
Ã
 
$»t
 ]]; 
th’
  $»t; 
fi


118 
echo
 "install†ibtool success"

119 
fi


121 [[ ! -
f
 /
u¤
/
šşude
/
zlib
.
h
 ]]; 
th’


122 
echo
 "install zlib1g-dev"

123 
»quœe_sudÛr
 "sudo‡pt-get install -y --force-yes zlib1g-dev"

124 
sudo
 
­t
-
g‘
 
š¡®l
 -
y
 --
fÜû
-
yes
 
zlib1g
-
dev
; 
»t
=
$
?; [[ 0 -
Ã
 
$»t
 ]]; 
th’
  $»t; 
fi


125 
echo
 "install zlib1g-dev success"

126 
fi


127 
fi


129 
echo
 "Ubuntu installools success"

131 
	}
}

132 #dÚÙ 
´•¬e
 
toŞs
, 
¤s
-
lib¹mp
 
d•’ds
 
Úly
 
gcc
 
ªd
 
g
++.

133 [ 
$SRS_EXPORT_LIBRTMP_PROJECT
 = 
NO
 ]; 
th’


134 
	gUbuÁu_´•¬e
; 
	g»t
=
$
?; [[ 0 -
Ã
 
$»t
 ]]; 
th’
 
	gecho
 "UbuÁu…»·» faed,„‘=$»t"; 
ex™
 
	g$»t
; 
fi


135 
	gfi


136 #####################################################################################
#fÜ 
C’tos
,‡utØ
š¡®l
 
toŞs
 
by
 
yum


137 #####################################################################################
_IS_CENTOS=NO

138 
funùiÚ
 
	$C’tos_´•¬e
()

140 [[ ! -
f
 /
‘c
/
»dh©
-
»Ëa£
 ]]; 
th’


142 
fi


144 #üos 
bud
 
¬m
, 
š¡®l
 
the
 
üoss
 bud 
toŞ
 
chaš
.

145 [ 
$SRS_CROSS_BUILD
 = 
YES
 ]; 
th’


146 
echo
 "embeded(arm/mips) is invalid for CentOS"

148 
fi


150 
OS_IS_CENTOS
=
YES


151 
echo
 "Centos detected, installools if‚eeded"

153 
gcc
 --
h–p
 >/
dev
/
nuÎ
 2>&1; 
»t
=
$
?; [[ 0 -
Ã
 
$»t
 ]]; 
th’


154 
echo
 "install gcc"

155 
»quœe_sudÛr
 "sudo yum install -y gcc"

156 
sudo
 
yum
 
š¡®l
 -
y
 
gcc
; 
»t
=
$
?; [[ 0 -
Ã
 
$»t
 ]]; 
th’
  $»t; 
fi


157 
echo
 "install gcc success"

158 
fi


160 
g
++ --
h–p
 >/
dev
/
nuÎ
 2>&1; 
»t
=
$
?; [[ 0 -
Ã
 
$»t
 ]]; 
th’


161 
echo
 "install gcc-c++"

162 
»quœe_sudÛr
 "sudo yum install -y gcc-c++"

163 
sudo
 
yum
 
š¡®l
 -
y
 
gcc
-
c
++; 
»t
=
$
?; [[ 0 -
Ã
 
$»t
 ]]; 
th’
  $»t; 
fi


164 
echo
 "install gcc-c++ success"

165 
fi


167 
make
 --
h–p
 >/
dev
/
nuÎ
 2>&1; 
»t
=
$
?; [[ 0 -
Ã
 
$»t
 ]]; 
th’


168 
echo
 "install make"

169 
»quœe_sudÛr
 "sudo yum install -y make"

170 
sudo
 
yum
 
š¡®l
 -
y
 
make
; 
»t
=
$
?; [[ 0 -
Ã
 
$»t
 ]]; 
th’
  $»t; 
fi


171 
echo
 "install make success"

172 
fi


174 
·tch
 --
h–p
 >/
dev
/
nuÎ
 2>&1; 
»t
=
$
?; [[ 0 -
Ã
 
$»t
 ]]; 
th’


175 
echo
 "install…atch"

176 
»quœe_sudÛr
 "sudo yum install -y…atch"

177 
sudo
 
yum
 
š¡®l
 -
y
 
·tch
; 
»t
=
$
?; [[ 0 -
Ã
 
$»t
 ]]; 
th’
  $»t; 
fi


178 
echo
 "install…atch success"

179 
fi


181 
unz
 --
h–p
 >/
dev
/
nuÎ
 2>&1; 
»t
=
$
?; [[ 0 -
Ã
 
$»t
 ]]; 
th’


182 
echo
 "install unzip"

183 
»quœe_sudÛr
 "sudo yum install -y unzip"

184 
sudo
 
yum
 
š¡®l
 -
y
 
unz
; 
»t
=
$
?; [[ 0 -
Ã
 
$»t
 ]]; 
th’
  $»t; 
fi


185 
echo
 "install unzip success"

186 
fi


188 [ 
$SRS_NGINX
 = 
YES
 ]; 
th’


189 [[ ! -
f
 /
u¤
/
šşude
/
püe
.
h
 ]]; 
th’


190 
echo
 "install…cre-devel"

191 
»quœe_sudÛr
 "sudo yum install -y…cre-devel"

192 
sudo
 
yum
 
š¡®l
 -
y
 
püe
-
dev–
; 
»t
=
$
?; [[ 0 -
Ã
 
$»t
 ]]; 
th’
  $»t; 
fi


193 
echo
 "install…cre-devel success"

194 
fi


195 
fi


197 [ 
$SRS_FFMPEG_TOOL
 = 
YES
 ]; 
th’


198 
automake
 --
h–p
 >/
dev
/
nuÎ
 2>&1; 
»t
=
$
?; [[ 0 -
Ã
 
$»t
 ]]; 
th’


199 
echo
 "install‡utomake"

200 
»quœe_sudÛr
 "sudo yum install -y‡utomake"

201 
sudo
 
yum
 
š¡®l
 -
y
 
automake
; 
»t
=
$
?; [[ 0 -
Ã
 
$»t
 ]]; 
th’
  $»t; 
fi


202 
echo
 "install‡utomake success"

203 
fi


205 
autocÚf
 --
h–p
 >/
dev
/
nuÎ
 2>&1; 
»t
=
$
?; [[ 0 -
Ã
 
$»t
 ]]; 
th’


206 
echo
 "install‡utoconf"

207 
»quœe_sudÛr
 "sudo yum install -y‡utoconf"

208 
sudo
 
yum
 
š¡®l
 -
y
 
autocÚf
; 
»t
=
$
?; [[ 0 -
Ã
 
$»t
 ]]; 
th’
  $»t; 
fi


209 
echo
 "install‡utoconf success"

210 
fi


212 
libtoŞ
 --
h–p
 >/
dev
/
nuÎ
 2>&1; 
»t
=
$
?; [[ 0 -
Ã
 
$»t
 ]]; 
th’


213 
echo
 "install†ibtool"

214 
»quœe_sudÛr
 "sudo yum install -y†ibtool"

215 
sudo
 
yum
 
š¡®l
 -
y
 
libtoŞ
; 
»t
=
$
?; [[ 0 -
Ã
 
$»t
 ]]; 
th’
  $»t; 
fi


216 
echo
 "install†ibtool success"

217 
fi


219 [[ ! -
f
 /
u¤
/
šşude
/
zlib
.
h
 ]]; 
th’


220 
echo
 "install zlib-devel"

221 
»quœe_sudÛr
 "sudo yum install -y zlib-devel"

222 
sudo
 
yum
 
š¡®l
 -
y
 
zlib
-
dev–
; 
»t
=
$
?; [[ 0 -
Ã
 
$»t
 ]]; 
th’
  $»t; 
fi


223 
echo
 "install zlib-devel success"

224 
fi


225 
fi


227 
echo
 "Centos installools success"

229 
	}
}

230 #dÚÙ 
´•¬e
 
toŞs
, 
¤s
-
lib¹mp
 
d•’ds
 
Úly
 
gcc
 
ªd
 
g
++.

231 [ 
$SRS_EXPORT_LIBRTMP_PROJECT
 = 
NO
 ]; 
th’


232 
	gC’tos_´•¬e
; 
	g»t
=
$
?; [[ 0 -
Ã
 
$»t
 ]]; 
th’
 
	gecho
 "C’tOS…»·» faed,„‘=$»t"; 
ex™
 
	g$»t
; 
fi


233 
	gfi


234 #####################################################################################
#fÜ 
C’tos
,‡utØ
š¡®l
 
toŞs
 
by
 
yum


235 #####################################################################################
_IS_OSX=NO

236 
funùiÚ
 
	$OSX_´•¬e
()

238 
uÇme
 -
s
|
g»p
 
D¬wš
 >/
dev
/
nuÎ
 2>&1

239 
»t
=
$
?; [[ 0 -
Ã
 
$»t
 ]]; 
th’


240 [ 
$SRS_OSX
 = 
YES
 ]; 
th’


241 
echo
 "OSX check failed,‡ctual is `uname -s`"

242 
ex™
 1;

243 
fi


245 
fi


247 #üos 
bud
 
¬m
, 
š¡®l
 
the
 
üoss
 bud 
toŞ
 
chaš
.

248 [ 
$SRS_CROSS_BUILD
 = 
YES
 ]; 
th’


249 
echo
 "embeded(arm/mips) is invalid for OSX"

251 
fi


253 
OS_IS_OSX
=
YES


254 
echo
 "OSX detected, installools if‚eeded"

255 #»quœe 
the
 
osx
 
wh’
 
os


256 [ 
$OS_IS_OSX
 = 
YES
 ]; 
th’


257 [ 
$SRS_OSX
 = 
NO
 ]; 
th’


258 
echo
 "OSX detected, must specifieshe --osx"

259 
ex™
 1

260 
fi


261 
fi


263 
b»w
 --
h–p
 >/
dev
/
nuÎ
 2>&1; 
»t
=
$
?; [[ 0 -
Ã
 
$»t
 ]]; 
th’


264 
echo
 "install brew"

265 
echo
 "ruby -e \"$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)\""

266 
ruby
 -
e
 "$(cu¾ -fsSL h‰ps://¿w.g™hubu£rcÚ‹Á.com/Homeb»w/š¡®l/ma¡”/š¡®l)"; 
»t
=
$
?; [[ 0 -
Ã
 
$»t
 ]]; 
th’
  $»t; 
fi


267 
echo
 "install brew success"

268 
fi


270 
gcc
 --
h–p
 >/
dev
/
nuÎ
 2>&1; 
»t
=
$
?; [[ 0 -
Ã
 
$»t
 ]]; 
th’


271 
echo
 "install gcc"

272 
echo
 "brew install gcc"

273 
b»w
 
š¡®l
 
gcc
; 
»t
=
$
?; [[ 0 -
Ã
 
$»t
 ]]; 
th’
  $»t; 
fi


274 
echo
 "install gcc success"

275 
fi


277 
g
++ --
h–p
 >/
dev
/
nuÎ
 2>&1; 
»t
=
$
?; [[ 0 -
Ã
 
$»t
 ]]; 
th’


278 
echo
 "install gcc-c++"

279 
echo
 "brew install gcc-c++"

280 
b»w
 
š¡®l
 
gcc
-
c
++; 
»t
=
$
?; [[ 0 -
Ã
 
$»t
 ]]; 
th’
  $»t; 
fi


281 
echo
 "install gcc-c++ success"

282 
fi


284 
make
 --
h–p
 >/
dev
/
nuÎ
 2>&1; 
»t
=
$
?; [[ 0 -
Ã
 
$»t
 ]]; 
th’


285 
echo
 "install make"

286 
echo
 "brew install make"

287 
b»w
 
š¡®l
 
make
; 
»t
=
$
?; [[ 0 -
Ã
 
$»t
 ]]; 
th’
  $»t; 
fi


288 
echo
 "install make success"

289 
fi


291 
·tch
 --
h–p
 >/
dev
/
nuÎ
 2>&1; 
»t
=
$
?; [[ 0 -
Ã
 
$»t
 ]]; 
th’


292 
echo
 "install…atch"

293 
echo
 "brew install…atch"

294 
b»w
 
š¡®l
 
·tch
; 
»t
=
$
?; [[ 0 -
Ã
 
$»t
 ]]; 
th’
  $»t; 
fi


295 
echo
 "install…atch success"

296 
fi


298 
unz
 --
h–p
 >/
dev
/
nuÎ
 2>&1; 
»t
=
$
?; [[ 0 -
Ã
 
$»t
 ]]; 
th’


299 
echo
 "install unzip"

300 
echo
 "brew install unzip"

301 
b»w
 
š¡®l
 
unz
; 
»t
=
$
?; [[ 0 -
Ã
 
$»t
 ]]; 
th’
  $»t; 
fi


302 
echo
 "install unzip success"

303 
fi


305 [ 
$SRS_NGINX
 = 
YES
 ]; 
th’


306 [[ ! -
f
 /
u¤
/
loÿl
/
šşude
/
püe
.
h
 ]]; 
th’


307 
echo
 "install…cre"

308 
echo
 "brew install…cre"

309 
b»w
 
š¡®l
 
püe
; 
»t
=
$
?; [[ 0 -
Ã
 
$»t
 ]]; 
th’
  $»t; 
fi


310 
echo
 "install…cre success"

311 
fi


312 
fi


314 [ 
$SRS_FFMPEG_TOOL
 = 
YES
 ]; 
th’


315 
automake
 --
h–p
 >/
dev
/
nuÎ
 2>&1; 
»t
=
$
?; [[ 0 -
Ã
 
$»t
 ]]; 
th’


316 
echo
 "install‡utomake"

317 
echo
 "brew install‡utomake"

318 
b»w
 
š¡®l
 
automake
; 
»t
=
$
?; [[ 0 -
Ã
 
$»t
 ]]; 
th’
  $»t; 
fi


319 
echo
 "install‡utomake success"

320 
fi


322 
autocÚf
 --
h–p
 >/
dev
/
nuÎ
 2>&1; 
»t
=
$
?; [[ 0 -
Ã
 
$»t
 ]]; 
th’


323 
echo
 "install‡utoconf"

324 
echo
 "brew install‡utoconf"

325 
b»w
 
š¡®l
 
autocÚf
; 
»t
=
$
?; [[ 0 -
Ã
 
$»t
 ]]; 
th’
  $»t; 
fi


326 
echo
 "install‡utoconf success"

327 
fi


329 
which
 
libtoŞ
 >/
dev
/
nuÎ
 2>&1; 
»t
=
$
?; [[ 0 -
Ã
 
$»t
 ]]; 
th’


330 
echo
 "install†ibtool"

331 
echo
 "brew install†ibtool"

332 
b»w
 
š¡®l
 
libtoŞ
; 
»t
=
$
?; [[ 0 -
Ã
 
$»t
 ]]; 
th’
  $»t; 
fi


333 
echo
 "install†ibtool success"

334 
fi


336 
b»w
 
šfo
 
zlib
 >/
dev
/
nuÎ
 2>&1; 
»t
=
$
?; [[ 0 -
Ã
 
$»t
 ]]; 
th’


337 
echo
 "install zlib"

338 
echo
 "brew install zlib"

339 
b»w
 
š¡®l
 
zlib
; 
»t
=
$
?; [[ 0 -
Ã
 
$»t
 ]]; 
th’
  $»t; 
fi


340 
echo
 "install zlib success"

341 
fi


342 
fi


344 
echo
 "OSX installools success"

346 
	}
}

347 #dÚÙ 
´•¬e
 
toŞs
, 
¤s
-
lib¹mp
 
d•’ds
 
Úly
 
gcc
 
ªd
 
g
++.

348 [ 
$SRS_EXPORT_LIBRTMP_PROJECT
 = 
NO
 ]; 
th’


349 
	gOSX_´•¬e
; 
	g»t
=
$
?; [[ 0 -
Ã
 
$»t
 ]]; 
th’
 
	gecho
 "OSX…»·» faed,„‘=$»t"; 
ex™
 
	g$»t
; 
fi


350 
	gfi


352 #th
£d
 
commªd


353 
	gSED
="£d -i" && [ 
$OS_IS_OSX
 = 
YES
 ]; 
th’
 SED="£d -˜''"; 
	gfi


355 #####################################################################################
#check 
the
 
os
.

356 #####################################################################################
#u£¸
mu¡
 
¥ecif›s
 
som‘hšg
 
wh©
 
a
 
fuck
, 
we
 
suµpÜt
 
fŞlowšg
 
os
:

357 #ûÁos/
ubuÁu
/
osx
,

358 #üos 
bud
 
embeded
 
sy¡em
, 
exam¶e
, 
ms
 
Ü
 
¬m
,

359 #dœeùly 
bud
 
Ú
 
¬m
/
ms
, 
exam¶e
, 
pi
 
Ü
 
cub›
,

360 #expÜˆ
¤s
-
lib¹mp


361 #Ùh” 
is
 
šv®id
.

362 [[ 
$OS_IS_UBUNTU
 = 
NO
 && 
$OS_IS_CENTOS
 = NO && 
$OS_IS_OSX
 = NO && 
$SRS_EXPORT_LIBRTMP_PROJECT
 = NO ]]; 
th’


363 [[ 
$SRS_PI
 = 
NO
 && 
$SRS_CUBIE
 = NO && 
$SRS_CROSS_BUILD
 = NO ]]; 
th’


364 
	gecho
 "what‡ fuck, os‚ot supported."

365 
	gex™
 1

366 
fi


367 
	gfi


370 #####################################################################################
[ 
$SRS_EXPORT_LIBRTMP_PROJECT
 = 
NO
 ]; 
th’


371 #check 
the
 
üoss
 
bud
 
æag
 
fe
, æag 
chªged
, 
Ãed
 
to
 
»bud
h
¡
.

372 
	g_ST_MAKE
=
lšux
-
debug
 && 
_ST_EXTRA_CFLAGS
="-DMD_HAVE_EPOLL"

373 #fÜ 
osx
, 
u£
 
d¬wš
 
¡
, 
dÚÙ
 u£ 
•Şl
.

374 [ 
$OS_IS_OSX
 = 
YES
 ]; 
th’


375 
	g_ST_MAKE
=
d¬wš
-
debug
 && 
_ST_EXTRA_CFLAGS
="-DMD_HAVE_KQUEUE"

376 
fi


377 #memÜy 
Ëak
 
lšux
-
İtimized


378 #@
£e
: 
h‰ps
:

379 [ 
$SRS_CROSS_BUILD
 = 
YES
 ]; 
	gth’


380 #ok, 
¬m
 
¥ecif›d
, 
the
 
æag
 
fed
 
dÛs
 
nÙ
 
exi¡s
, 
Ãed
 
to
 
»bud
.

381 [[ -
f
 
$
{
SRS_OBJS
}/
_æag
.
¡
.
üoss
.
bud
.
tmp
 && -à${SRS_OBJS}/¡/
lib¡
.
a
 ]]; 
th’


382 
	gecho
 "st-1.9t for‡rm is ok.";

384 #TODO: 
FIXME
: 
·tch
 
the
 
bug
.

385 #·tch 
¡
 
¬m
, @
£e
: 
h‰ps
:

386 
	gecho
 "build st-1.9t for‡rm";

388 
	grm
 -
rf
 
	g$
{
	gSRS_OBJS
}/
	g¡
-1.9 && 
cd
 ${SRS_OBJS} &&

389 
	gunz
 -
	gq
 ../3
	grd·¹y
/
	g¡
-1.9.
	gz
 && 
cd
 st-1.9 && 
	gchmod
 +
	gw
 * &&

390 
	g·tch
 -
	gp0
 < ../../3
	grd·¹y
/
	g·tches
/1.
	g¡
.
	g¬m
.patch &&

391 
	g·tch
 -
	gp0
 < ../../3
	grd·¹y
/
	g·tches
/3.
	g¡
.
	gosx
.
	gkqueue
.patch &&

392 
	g·tch
 -
	gp0
 < ../../3
	grd·¹y
/
	g·tches
/4.
	g¡
.
	gdi§bË
.
	gexam¶es
.patch &&

393 
make
 
	g$
{
	g_ST_MAKE
} 
	gCC
=
$
{
SrsArmCC
} 
AR
=${
SrsArmAR
} 
LD
=${
SrsArmLD
} 
RANDLIB
=${
SrsArmRANDLIB
} 
EXTRA_CFLAGS
="${_ST_EXTRA_CFLAGS}" &&

394 
cd
 .. && 
rm
 -
rf
 
¡
 && 
Ê
 -
sf
 st-1.9/
obj
 st &&

395 
cd
 .. && 
touch
 
$
{
SRS_OBJS
}/
_æag
.
¡
.
üoss
.
bud
.
tmp


397 
fi


399 [[ ! -
f
 
$
{
SRS_OBJS
}/
_æag
.
¡
.
üoss
.
bud
.
tmp
 && -à${SRS_OBJS}/¡/
lib¡
.
a
 ]]; 
th’


400 
	gecho
 "st-1.9t is ok.";

402 #·tch 
¡
 
¬m
, @
£e
: 
h‰ps
:

403 
	gecho
 "build st-1.9t";

405 
	grm
 -
rf
 
	g$
{
	gSRS_OBJS
}/
	g¡
-1.9 && 
cd
 ${SRS_OBJS} &&

406 
	gunz
 -
	gq
 ../3
	grd·¹y
/
	g¡
-1.9.
	gz
 && 
cd
 st-1.9 && 
	gchmod
 +
	gw
 * &&

407 
	g·tch
 -
	gp0
 < ../../3
	grd·¹y
/
	g·tches
/1.
	g¡
.
	g¬m
.patch &&

408 
	g·tch
 -
	gp0
 < ../../3
	grd·¹y
/
	g·tches
/3.
	g¡
.
	gosx
.
	gkqueue
.patch &&

409 
	g·tch
 -
	gp0
 < ../../3
	grd·¹y
/
	g·tches
/4.
	g¡
.
	gdi§bË
.
	gexam¶es
.patch &&

410 
make
 
	g$
{
	g_ST_MAKE
} 
	gEXTRA_CFLAGS
="${_ST_EXTRA_CFLAGS}" &&

411 
cd
 .. && 
rm
 -
rf
 
¡
 && 
Ê
 -
sf
 st-1.9/
obj
 st &&

412 
cd
 .. && 
rm
 -
f
 
$
{
SRS_OBJS
}/
_æag
.
¡
.
üoss
.
bud
.
tmp


414 
fi


415 
fi


416 #check 
¡©us


417 
»t
=
$
?; [[ 
$»t
 -
Ã
 0 ]]; 
th’
 
	gecho
 "bud st-1.9 faed,„‘=$»t"; 
ex™
 
	g$»t
; 
fi


418 [ ! -
f
 
$
{
SRS_OBJS
}/
¡
/
lib¡
.
a
 ]; 
th’
 
	gecho
 "bud st-1.9 stiølib faed."; 
	gex™
 -1; 
fi


419 
	gfi


421 #####################################################################################
#h‰p-
·r£r
-2.1

422 #####################################################################################
#check 
the
 
üoss
 
bud
 
æag
 
fe
, æag 
chªged
, 
Ãed
 
to
 
»bud
h
¡
.

423 [ 
$SRS_HTTP_CORE
 = 
YES
 ]; 
	gth’


424 #ok, 
¬m
 
¥ecif›d
, 
the
 
æag
 
fed
 
dÛs
 
nÙ
 
exi¡s
, 
Ãed
 
to
 
»bud
.

425 [ 
$SRS_CROSS_BUILD
 = 
YES
 ]; 
th’


426 [[ -
f
 
$
{
SRS_OBJS
}/
_æag
.
¡
.
hp
.
tmp
 && -à${SRS_OBJS}/hp/
h‰p_·r£r
.
h
 && -à${SRS_OBJS}/hp/
libh‰p_·r£r
.
a
 ]]; 
th’


427 
	gecho
 "http-parser-2.1 for‡rm is ok.";

429 
	gecho
 "build http-parser-2.1 for‡rm";

431 
	grm
 -
rf
 
	g$
{
	gSRS_OBJS
}/
	gh‰p
-
	g·r£r
-2.1 && 
cd
 ${SRS_OBJS} && 
	gunz
 -
	gq
 ../3
	grd·¹y
/h‰p-·r£r-2.1.
	gz
 &&

432 
cd
 
	gh‰p
-
	g·r£r
-2.1 &&

433 
	g·tch
 -
	gp0
 < ../../3
	grd·¹y
/
	g·tches
/2.
	gh‰p
.
	g·r£r
.patch &&

434 
make
 
	gCC
=
$
{
SrsArmCC
} 
AR
=${
SrsArmAR
} 
·ckage
 &&

435 
cd
 .. && 
rm
 -
rf
 
hp
 && 
Ê
 -
sf
 
h‰p
-
·r£r
-2.1 hp &&

436 
cd
 .. && 
touch
 
$
{
SRS_OBJS
}/
_æag
.
¡
.
hp
.
tmp


438 
fi


440 #üos 
bud
 
nÙ
 
¥ecif›d
, 
exi¡s
 
æag
, 
Ãed
 
to
 
»bud
 
no
-
¬m
 
¶©fÜm
.

441 [[ ! -
f
 
$
{
SRS_OBJS
}/
_æag
.
¡
.
hp
.
tmp
 && -à${SRS_OBJS}/hp/
h‰p_·r£r
.
h
 && -à${SRS_OBJS}/hp/
libh‰p_·r£r
.
a
 ]]; 
th’


442 
	gecho
 "http-parser-2.1 is ok.";

444 
	gecho
 "build http-parser-2.1";

446 
	grm
 -
rf
 
	g$
{
	gSRS_OBJS
}/
	gh‰p
-
	g·r£r
-2.1 && 
cd
 ${SRS_OBJS} && 
	gunz
 -
	gq
 ../3
	grd·¹y
/h‰p-·r£r-2.1.
	gz
 &&

447 
cd
 
	gh‰p
-
	g·r£r
-2.1 &&

448 
	g·tch
 -
	gp0
 < ../../3
	grd·¹y
/
	g·tches
/2.
	gh‰p
.
	g·r£r
.patch &&

449 
make
 
	g·ckage
 &&

450 
	gcd
 .. && 
	grm
 -
rf
 
	ghp
 && 
	gÊ
 -
sf
 
	gh‰p
-
	g·r£r
-2.1 hp &&

451 
	gcd
 .. && 
	grm
 -
f
 
	g$
{
	gSRS_OBJS
}/
	g_æag
.
	g¡
.
	ghp
.
	gtmp


453 
fi


454 
	gfi


456 #check 
¡©us


457 
	g»t
=
$
?; [[ 
$»t
 -
Ã
 0 ]]; 
th’
 
	gecho
 "bud h‰p-·r£r-2.1 faed,„‘=$»t"; 
ex™
 
	g$»t
; 
fi


458 [[ ! -
f
 
$
{
SRS_OBJS
}/
hp
/
h‰p_·r£r
.
h
 ]]; 
th’
 
	gecho
 "bud h‰p-·r£r-2.1 faed"; 
	gex™
 -1; 
fi


459 [[ ! -
f
 
$
{
SRS_OBJS
}/
hp
/
libh‰p_·r£r
.
a
 ]]; 
th’
 
	gecho
 "bud h‰p-·r£r-2.1 faed"; 
	gex™
 -1; 
fi


460 
	gfi


462 #####################################################################################
#ngšx 
HLS
, 
ngšx
-1.5.0

463 #####################################################################################
 wr™e_ngšx_html5()

465 
	gÿt
<<
	gEND
 > 
	g$
{
	ghtml_fe
}

466 <
video
 
	gwidth
="640" 
height
="360"

467 
autİÏy
 
cÚŒŞs
 
autobufãr


468 
¤c
="${hls_stream}"

469 
ty³
="application/vnd.apple.mpegurl">

470 </
video
>

471 
END


473 #ü—‹ 
the
 
ngšx
 
dœ
, 
h‰p
-
£rv”
 
nÙ
 
bud
‚ginx

474 [ 
$SRS_EXPORT_LIBRTMP_PROJECT
 = 
NO
 ]; 
th’


475 
	gmkdœ
 -
p
 
	g$
{
	gSRS_OBJS
}/
ngšx


476 
	gfi


477 #mak
ngšx


478 
	g__SRS_BUILD_NGINX
=
NO
; [ 
$SRS_CROSS_BUILD
 = NO ]; 
th’
 [ 
$SRS_NGINX
 = 
YES
 ];h’ __SRS_BUILD_NGINX=YES; 
fi
 fi

479 [ 
$__SRS_BUILD_NGINX
 = 
YES
 ]; 
th’


480 [[ -
f
 
$
{
SRS_OBJS
}/
ngšx
/
sbš
/ngšx ]]; 
th’


481 
	gecho
 "nginx-1.5.7 is ok.";

483 
	gecho
 "build‚ginx-1.5.7";

485 
	grm
 -
rf
 
	g$
{
	gSRS_OBJS
}/
	gngšx
-1.5.7 && 
cd
 ${SRS_OBJS} &&

486 
	gunz
 -
	gq
 ../3
	grd·¹y
/
	gngšx
-1.5.7.
	gz
 && 
cd
‚ginx-1.5.7 &&

487 ./
	gcÚfigu»
 --
	g´efix
=`
pwd
`/
_»Ëa£
 && 
make
 
$
{
SRS_JOBS
} && mak
š¡®l
 &&

488 
cd
 .. && 
rm
 -
rf
 
ngšx
 && 
Ê
 -
sf
‚gšx-1.5.7/
_»Ëa£
‚ginx

490 
fi


491 #check 
¡©us


492 
»t
=
$
?; [[ 
$»t
 -
Ã
 0 ]]; 
th’
 
	gecho
 "bud‚gšx-1.5.7 faed,„‘=$»t"; 
ex™
 
	g$»t
; 
fi


493 [ ! -
f
 
$
{
SRS_OBJS
}/
ngšx
/
sbš
/ngšx ]; 
th’
 
	gecho
 "bud‚gšx-1.5.7 faed."; 
	gex™
 -1; 
	gfi


495 #u£ 
cu¼’t
 
u£r
 
to
 
cÚfig
 
ngšx
,

496 #¤ 
wl
 
wr™e
 
ts
/
m3u8
 
fe
 
u£
 
cu¼’t
 
u£r
,

497 #ngšx  
u£
 
nobody
, 
so
 
ÿÂÙ
 
»ad
 
the
 
ts
/
m3u8
 
ü—‹d
 
by
 
¤s
.

498 
ı
 
	g$
{
	gSRS_OBJS
}/
	gngšx
/
	gcÚf
/ngšx.
cÚf
 ${SRS_OBJS}/ngšx/cÚf/ngšx.cÚf.
bk


499 
	g$SED
 "s/^.u£¸‚obody;/u£¸`whßmi`;/g" 
	g$
{
	gSRS_OBJS
}/
	gngšx
/
	gcÚf
/ngšx.
cÚf


500 
	gfi


502 #th
demo
 
dœ
.

503 [ 
$SRS_EXPORT_LIBRTMP_PROJECT
 = 
NO
 ]; 
	gth’


504 #ü—‹ 
fÜw¬d
 
dœ


505 
	gmkdœ
 -
p
 
	g$
{
	gSRS_OBJS
}/
	gngšx
/
	ghtml
/
	glive
 &&

506 
	gmkdœ
 -
p
 
	g$
{
	gSRS_OBJS
}/
	gngšx
/
	ghtml
/
	gfÜw¬d
/
	glive


508 #g’”© 
html
 
·ges
 
ªdroid
.

509 
	ghtml_fe
=
$
{
SRS_OBJS
}/
ngšx
/
html
/
live
/
demo
.htmÈ&& 
hls_¡»am
=demo.
m3u8
 && 
wr™e_ngšx_html5


510 
html_fe
=
$
{
SRS_OBJS
}/
ngšx
/
html
/
live
/
live¡»am
.htmÈ&& 
hls_¡»am
öive¡»am.
m3u8
 && 
wr™e_ngšx_html5


511 
html_fe
=
$
{
SRS_OBJS
}/
ngšx
/
html
/
live
/
live¡»am_ld
.htmÈ&& 
hls_¡»am
öive¡»am_ld.
m3u8
 && 
wr™e_ngšx_html5


512 
html_fe
=
$
{
SRS_OBJS
}/
ngšx
/
html
/
live
/
live¡»am_sd
.htmÈ&& 
hls_¡»am
öive¡»am_sd.
m3u8
 && 
wr™e_ngšx_html5


513 
html_fe
=
$
{
SRS_OBJS
}/
ngšx
/
html
/
fÜw¬d
/
live
/
live¡»am
.htmÈ&& 
hls_¡»am
öive¡»am.
m3u8
 && 
wr™e_ngšx_html5


514 
html_fe
=
$
{
SRS_OBJS
}/
ngšx
/
html
/
fÜw¬d
/
live
/
live¡»am_ld
.htmÈ&& 
hls_¡»am
öive¡»am_ld.
m3u8
 && 
wr™e_ngšx_html5


515 
html_fe
=
$
{
SRS_OBJS
}/
ngšx
/
html
/
fÜw¬d
/
live
/
live¡»am_sd
.htmÈ&& 
hls_¡»am
öive¡»am_sd.
m3u8
 && 
wr™e_ngšx_html5


517 #cİy 
¶ay”s
 
to
 
ngšx
 
html
 
dœ
.

518 
rm
 -
rf
 
$
{
SRS_OBJS
}/
ngšx
/
html
/
¶ay”s
 &&

519 
Ê
 -
sf
 `
pwd
`/
»£¬ch
/
¶ay”s
 
$
{
SRS_OBJS
}/
ngšx
/
html
/players &&

520 
rm
 -
f
 
$
{
SRS_OBJS
}/
ngšx
/
üossdomaš
.
xml
 &&

521 
Ê
 -
sf
 `
pwd
`/
»£¬ch
/
¶ay”s
/
üossdomaš
.
xml
 
$
{
SRS_OBJS
}/
ngšx
/
html
/crossdomain.xml

523 #fÜ 
çvicÚ
.
ico


524 
rm
 -
rf
 
$
{
SRS_OBJS
}/
ngšx
/
html
/
çvicÚ
.
ico
 &&

525 
Ê
 -
sf
 `
pwd
`/
»£¬ch
/
­i
-
£rv”
/-
dœ
/
çvicÚ
.
ico
 
$
{
SRS_OBJS
}/
ngšx
/
html
/favicon.ico

527 #ngšx.
html
 
to
 
d‘eù
 
wh‘h”
 
ngšx
 
is
 
®ive


528 
echo
 "ngšx i ok" > 
$
{
SRS_OBJS
}/
ngšx
/
html
/nginx.html

529 
fi


531 #####################################################################################
#ch”rypy 
h‰p
 
hooks
 
ÿÎback
, 
Ch”ryPy
-3.2.4

532 #####################################################################################
[ 
$SRS_HTTP_CALLBACK
 = 
YES
 ]; 
th’


533 [[ -
f
 
$
{
SRS_OBJS
}/
Ch”ryPy
-3.2.4/
£tup
.
py
 ]]; 
th’


534 
	gecho
 "CherryPy-3.2.4 is ok.";

536 
	g»quœe_sudÛr
 "install CherryPy-3.2.4"

537 
	gecho
 "install CherryPy-3.2.4";

539 
sudo
 
	grm
 -
rf
 
	g$
{
	gSRS_OBJS
}/
	gCh”ryPy
-3.2.4 && 
cd
 ${SRS_OBJS} &&

540 
	gunz
 -
	gq
 ../3
	grd·¹y
/
	gCh”ryPy
-3.2.4.
	gz
 && 
cd
 CherryPy-3.2.4 &&

541 
sudo
 
pythÚ
 
	g£tup
.
py
 
	gš¡®l


543 
	gfi


544 #check 
¡©us


545 
	g»t
=
$
?; [[ 
$»t
 -
Ã
 0 ]]; 
th’
 
	gecho
 "bud Ch”ryPy-3.2.4 faed,„‘=$»t"; 
ex™
 
	g$»t
; 
fi


546 [ ! -
f
 
$
{
SRS_OBJS
}/
Ch”ryPy
-3.2.4/
£tup
.
py
 ]; 
th’
 
	gecho
 "bud Ch”ryPy-3.2.4 faed."; 
	gex™
 -1; 
fi


547 
fi


549 [ 
$SRS_EXPORT_LIBRTMP_PROJECT
 = 
NO
 ]; 
th’


550 
	gecho
 "link…layerso cherrypy static-dir"

551 
	grm
 -
rf
 
	g»£¬ch
/
	g­i
-
	g£rv”
/-
	gdœ
/
	g¶ay”s
 &&

552 
	gÊ
 -
	gsf
 `
	gpwd
`/
	g»£¬ch
/
¶ay”s
„e£¬ch/
	g­i
-
	g£rv”
/-
	gdœ
/
	g¶ay”s
 &&

553 
	grm
 -
f
 
	g»£¬ch
/
	g­i
-
	g£rv”
/-
	gdœ
/
	güossdomaš
.
	gxml
 &&

554 
	gÊ
 -
	gsf
 `
	gpwd
`/
	g»£¬ch
/
	g¶ay”s
/
	güossdomaš
.
xml
„e£¬ch/
	g­i
-
	g£rv”
/-
	gdœ
/üossdomaš.
	gxml
 &&

555 
	grm
 -
rf
 
	g»£¬ch
/
	g­i
-
	g£rv”
/-
	gdœ
/
	glive
 &&

556 
	gmkdœ
 -
	gp
 `
	gpwd
`/
	g$
{
	gSRS_OBJS
}/
	gngšx
/
	ghtml
/
	glive
 &&

557 
	gÊ
 -
	gsf
 `
	gpwd
`/
	g$
{
	gSRS_OBJS
}/
	gngšx
/
	ghtml
/
live
 
	g»£¬ch
/
	g­i
-
	g£rv”
/-
	gdœ
/
	glive
 &&

558 
	grm
 -
rf
 
	g»£¬ch
/
	g­i
-
	g£rv”
/-
	gdœ
/
	gfÜw¬d
 &&

559 
	gmkdœ
 -
	gp
 `
	gpwd
`/
	g$
{
	gSRS_OBJS
}/
	gngšx
/
	ghtml
/
	gfÜw¬d
 &&

560 
	gÊ
 -
	gsf
 `
	gpwd
`/
	g$
{
	gSRS_OBJS
}/
	gngšx
/
	ghtml
/
fÜw¬d
 
	g»£¬ch
/
	g­i
-
	g£rv”
/-
	gdœ
/forward

561 
	g»t
=
$
?; [[ 
$»t
 -
Ã
 0 ]]; 
th’
 
	gecho
 "[w¬n]†šk…Ïy” tØch”rypy stic-dœ faed"; 
fi


562 
	gfi


564 #####################################################################################
#g’”©
demo
 
šdex
.
html


565 #####################################################################################
#ià
ngšx
 
’®bed
, 
g’”©e
‚gšx 
šdex
 
fe
.

566 [ 
$__SRS_BUILD_NGINX
 = 
YES
 ]; 
th’


567 
	grm
 -
f
 
	g$
{
	gSRS_OBJS
}/
	gngšx
/
	ghtml
/
	gšdex
.html &&

568 
	gÊ
 -
	gsf
 `
	gpwd
`/
	g»£¬ch
/
	g¶ay”s
/
	gngšx_šdex
.
html
 
	g$
{
	gSRS_OBJS
}/
	gngšx
/
	ghtml
/
	gšdex
.html

569 
	gfi


570 #ià
h‰p
-
£rv”
 
’®bed
, 
u£
 
¤s
 
embeded
 http-server

571 [ 
$SRS_HTTP_SERVER
 = 
YES
 ]; 
th’


572 
	grm
 -
f
 
	g$
{
	gSRS_OBJS
}/
	gngšx
/
	ghtml
/
	gšdex
.html &&

573 
	gÊ
 -
	gsf
 `
	gpwd
`/
	g»£¬ch
/
	g¶ay”s
/
	g¤s
-
	gh‰p
-
	g£rv”_šdex
.
html
 
	g$
{
	gSRS_OBJS
}/
	gngšx
/
	ghtml
/
	gšdex
.html

574 
	gfi


575 #ià
­i
-
£rv”
 
’abËd
, 
g’”©e
 api server.

576 [ 
$SRS_HTTP_CALLBACK
 = 
YES
 ]; 
th’


577 
	grm
 -
f
 
	g$
{
	gSRS_OBJS
}/
	gngšx
/
	ghtml
/
	gšdex
.html &&

578 
	gÊ
 -
	gsf
 `
	gpwd
`/
	g»£¬ch
/
	g¶ay”s
/
	g­i
-
	g£rv”_šdex
.
html
 
	g$
{
	gSRS_OBJS
}/
	gngšx
/
	ghtml
/
	gšdex
.html

579 
	gfi


581 #####################################################################################
#İ’s¦, 
¹mp
 
com¶ex
 
hªdshake


582 #####################################################################################
#exŒ¨
cÚfigu»
 
İtiÚs


583 
	gCONFIGURE_TOOL
="./config"

584 [ 
$SRS_CROSS_BUILD
 = 
YES
 ]; 
th’


585 
	gCONFIGURE_TOOL
="./Configure†inux-armv4"

586 
fi


587 [ 
$SRS_OSX
 = 
YES
 ]; 
th’


588 
	gCONFIGURE_TOOL
="./Configure darwin64-`uname -m`-cc"

589 
fi


590 
OPENSSL_HOTFIX
="-DOPENSSL_NO_HEARTBEATS"

591 #@
£e
 
h‰p
:

592 #Afãùed 
u£rs
 
should
 
upg¿de
 
to
 
O³nSSL
 1.0.1
g
. 
U£rs
 
uÇbË
Ø
immedŸ‹ly


593 #upg¿d
ÿn
 
®‹º©iv–y
 
»compe
 
O³nSSL
 
w™h
 -
DOPENSSL_NO_HEARTBEATS
.

594 [ 
$SRS_SSL
 = 
YES
 ]; 
th’


595 [ 
$SRS_USE_SYS_SSL
 = 
YES
 ]; 
th’


596 
	gecho
 "warning: donot compile ssl, use system ssl"

598 #check 
the
 
üoss
 
bud
 
æag
 
fe
, æag 
chªged
, 
Ãed
 
to
 
»bud
h
¡
.

599 [ 
$SRS_CROSS_BUILD
 = 
YES
 ]; 
	gth’


600 #ok, 
¬m
 
¥ecif›d
, 
the
 
æag
 
fed
 
dÛs
 
nÙ
 
exi¡s
, 
Ãed
 
to
 
»bud
.

601 [[ -
f
 
$
{
SRS_OBJS
}/
_æag
.
s¦
.
üoss
.
bud
.
tmp
 && -à${SRS_OBJS}/
İ’s¦
/
lib
/
libs¦
.
a
 ]]; 
th’


602 
	gecho
 "openssl-1.0.1f for‡rm is ok.";

604 
	gecho
 "build openssl-1.0.1f for‡rm";

606 
	grm
 -
rf
 
	g$
{
	gSRS_OBJS
}/
	gİ’s¦
-1.0.1à&& 
cd
 ${SRS_OBJS} &&

607 
	gunz
 -
	gq
 ../3
	grd·¹y
/
	gİ’s¦
-1.0.1f.
	gz
 && 
cd
 openssl-1.0.1f &&

608 
	g$CONFIGURE_TOOL
 --
	g´efix
=`
pwd
`/
_»Ëa£
 -
no
-
sh¬ed
‚o-
asm
 
$OPENSSL_HOTFIX
 &&

609 
make
 
CC
=
$
{
SrsArmCC
} 
GCC
=${
SrsArmGCC
} 
AR
="${SrsArmAR}„" \

610 
LD
=
$
{
SrsArmLD
} 
LINK
=${
SrsArmGCC
} 
RANDLIB
=${
SrsArmRANDLIB
} &&

611 
make
 
š¡®l_sw
 &&

612 
cd
 .. && 
rm
 -
rf
 
İ’s¦
 && 
Ê
 -
sf
 o³ns¦-1.0.1f/
_»Ëa£
 openssl &&

613 
cd
 .. && 
touch
 
$
{
SRS_OBJS
}/
_æag
.
s¦
.
üoss
.
bud
.
tmp


615 
fi


617 #üos 
bud
 
nÙ
 
¥ecif›d
, 
exi¡s
 
æag
, 
Ãed
 
to
 
»bud
 
no
-
¬m
 
¶©fÜm
.

618 [[ ! -
f
 
$
{
SRS_OBJS
}/
_æag
.
s¦
.
üoss
.
bud
.
tmp
 && -à${SRS_OBJS}/
İ’s¦
/
lib
/
libs¦
.
a
 ]]; 
th’


619 
	gecho
 "openssl-1.0.1f is ok.";

621 
	gecho
 "build openssl-1.0.1f";

623 
	grm
 -
rf
 
	g$
{
	gSRS_OBJS
}/
	gİ’s¦
-1.0.1à&& 
cd
 ${SRS_OBJS} &&

624 
	gunz
 -
	gq
 ../3
	grd·¹y
/
	gİ’s¦
-1.0.1f.
	gz
 && 
cd
 openssl-1.0.1f &&

625 
	g$CONFIGURE_TOOL
 --
	g´efix
=`
pwd
`/
_»Ëa£
 -
no
-
sh¬ed
 
$OPENSSL_HOTFIX
 &&

626 
make
 && mak
š¡®l_sw
 &&

627 
cd
 .. && 
rm
 -
rf
 
İ’s¦
 && 
Ê
 -
sf
 o³ns¦-1.0.1f/
_»Ëa£
 openssl &&

628 
cd
 .. && 
rm
 -
f
 
$
{
SRS_OBJS
}/
_æag
.
s¦
.
üoss
.
bud
.
tmp


630 
fi


631 
fi


632 #check 
¡©us


633 
»t
=
$
?; [[ 
$»t
 -
Ã
 0 ]]; 
th’
 
	gecho
 "bud o³ns¦-1.0.1àçed,„‘=$»t"; 
ex™
 
	g$»t
; 
fi


634 [ ! -
f
 
$
{
SRS_OBJS
}/
İ’s¦
/
lib
/
libs¦
.
a
 ]; 
th’
 
	gecho
 "bud o³ns¦-1.0.1àçed."; 
	gex™
 -1; 
fi


635 
fi


636 
	gfi


638 #####################################################################################
#liv
Œªscodšg
, 
ffm³g
-2.1, 
x264
-
cÜe138
, 
Ïme
-3.99.5, 
lib¯ılus
-2.0.2.

639 #####################################################################################
[ 
$SRS_FFMPEG_TOOL
 = 
YES
 ]; 
th’


640 [[ -
f
 
$
{
SRS_OBJS
}/
ffm³g
/
bš
/ffm³g ]]; 
th’


641 
	gecho
 "ffmpeg-2.1 is ok.";

643 
	gecho
 "build ffmpeg-2.1";

645 
cd
 
	g$
{
	gSRS_OBJS
} && 
	gpwd_dœ
=`
pwd
` &&

646 
rm
 -
rf
 
ffm•g
.
¤c
 && 
mkdœ
 -
p
 
ffm³g
.¤ø&& 
cd
 ffmpeg.src &&

647 
rm
 -
f
 
bud_ffm³g
.
sh
 && 
Ê
 -
sf
 ../../auto/build_ffmpeg.sh && . build_ffmpeg.sh &&

648 
cd
 
$
{
pwd_dœ
} && 
rm
 -
rf
 
ffm³g
 && 
Ê
 -
sf
 ffm³g.
¤c
/
_»Ëa£
 ffmpeg

650 
fi


651 #check 
¡©us


652 
»t
=
$
?; [[ 
$»t
 -
Ã
 0 ]]; 
th’
 
	gecho
 "bud ffm³g-2.1 faed,„‘=$»t"; 
ex™
 
	g$»t
; 
fi


653 [ ! -
f
 
$
{
SRS_OBJS
}/
ffm³g
/
bš
/ffm³g ]; 
th’
 
	gecho
 "bud ffm³g-2.1 faed."; 
	gex™
 -1; 
fi


654 
	gfi


656 #####################################################################################
#bud 
»£¬ch
 
code
, 
lib¹mp


657 #####################################################################################
[ 
$SRS_EXPORT_LIBRTMP_PROJECT
 = 
NO
 ]; 
th’


658 [ 
$SRS_RESEARCH
 = 
YES
 ]; 
th’


659 
	gmkdœ
 -
p
 
	g$
{
	gSRS_OBJS
}/
	g»£¬ch


661 (
cd
 
	g$
{
	gSRS_WORKDIR
}/
	g»£¬ch
/
	ghls
 && 
make
 ${
	gSRS_JOBS
} && 
mv
 
	gts_šfo
 ../../${
	gSRS_OBJS_DIR
}/research)

662 
	g»t
=
$
?; [[ 
$»t
 -
Ã
 0 ]]; 
th’
 
	gecho
 "bud„e£¬ch/hl çed,„‘=$»t"; 
ex™
 
	g$»t
; 
	gfi


664 (
cd
 
	g»£¬ch
/
	gfãm±y
 && 
make
 
	g$
{
	gSRS_JOBS
} && 
mv
 fãm±y ../../${
	gSRS_OBJS_DIR
}/research)

665 
	g»t
=
$
?; [[ 
$»t
 -
Ã
 0 ]]; 
th’
 
	gecho
 "bud„e£¬ch/fãm±y faed,„‘=$»t"; 
ex™
 
	g$»t
; 
fi


666 
fi


667 
fi


669 [ 
$SRS_LIBRTMP
 = 
YES
 ]; 
th’


670 
	gmkdœ
 -
p
 
	g$
{
	gSRS_OBJS
}/
	g»£¬ch


673 (
cd
 
	g$
{
	gSRS_WORKDIR
}/
	g»£¬ch
/
	glib¹mp
 && 
	gmkdœ
 -
p
 
	gobjs
 && 
	gÊ
 -
	gsf
 `
	gpwd
`/obj ../../${
	gSRS_OBJS_DIR
}/research/librtmp)

674 
	g»t
=
$
?; [[ 
$»t
 -
Ã
 0 ]]; 
th’
 
	gecho
 "lšk„e£¬ch/lib¹m°çed,„‘=$»t"; 
ex™
 
	g$»t
; 
fi


675 
	gfi


677 #####################################################################################
#bud 
u‹¡
 
code


678 #####################################################################################
[ 
$SRS_UTEST
 = 
YES
 ]; 
th’


679 [[ -
f
 
$
{
SRS_OBJS
}/
g‹¡
/
šşude
/g‹¡/g‹¡.
h
 ]]; 
th’


680 
	gecho
 "gtest-1.6.0 is ok.";

682 
	gecho
 "build gtest-1.6.0";

684 
	grm
 -
rf
 
	g$
{
	gSRS_OBJS
}/
	gg‹¡
-1.6.0 && 
cd
 ${SRS_OBJS} &&

685 
	gunz
 -
	gq
 ../3
	grd·¹y
/
	gg‹¡
-1.6.0.
	gz
 &&

686 
	grm
 -
rf
 
	gg‹¡
 && 
	gÊ
 -
sf
 gtest-1.6.0 gtest

688 
	gfi


689 #check 
¡©us


690 
	g»t
=
$
?; [[ 
$»t
 -
Ã
 0 ]]; 
th’
 
	gecho
 "bud g‹¡-1.6.0 faed,„‘=$»t"; 
ex™
 
	g$»t
; 
fi


691 [ ! -
f
 
$
{
SRS_OBJS
}/
g‹¡
/
šşude
/g‹¡/g‹¡.
h
 ]; 
th’
 
	gecho
 "bud g‹¡-1.6.0 faed."; 
	gex™
 -1; 
fi


692 
	gfi


694 #####################################################################################
#bud 
g³rf
 
code


695 #####################################################################################
[ 
$SRS_GPERF
 = 
YES
 ]; 
th’


696 [[ -
f
 
$
{
SRS_OBJS
}/
g³rf
/
bš
/
µrof
 ]]; 
th’


697 
	gecho
 "gperftools-2.1 is ok.";

699 
	gecho
 "build gperftools-2.1";

701 
	grm
 -
rf
 
	g$
{
	gSRS_OBJS
}/
	gg³ráoŞs
-2.1 && 
cd
 ${SRS_OBJS} &&

702 
	gunz
 -
	gq
 ../3
	grd·¹y
/
	gg³ráoŞs
-2.1.
	gz
 && 
cd
 gperftools-2.1 &&

703 ./
	gcÚfigu»
 --
	g´efix
=`
pwd
`/
_»Ëa£
 --
’abË
-
äame
-
poš‹rs
 && 
make
 
$
{
SRS_JOBS
} && mak
š¡®l
 &&

704 
cd
 .. && 
rm
 -
rf
 
g³rf
 && 
Ê
 -
sf
 
g³ráoŞs
-2.1/
_»Ëa£
 gperf &&

705 
rm
 -
rf
 
µrof
 && 
Ê
 -
sf
 
g³rf
/
bš
/pprof…prof

707 
fi


708 #check 
¡©us


709 
»t
=
$
?; [[ 
$»t
 -
Ã
 0 ]]; 
th’
 
	gecho
 "bud g³ráoŞs-2.1 faed,„‘=$»t"; 
ex™
 
	g$»t
; 
fi


710 [ ! -
f
 
$
{
SRS_OBJS
}/
g³rf
/
bš
/
µrof
 ]; 
th’
 
	gecho
 "bud g³ráoŞs-2.1 faed."; 
	gex™
 -1; 
fi


711 
	gfi


713 #####################################################################################
#g’”©ed 
the
 
‹¡
 
süt


714 #####################################################################################
 -rà${SRS_OBJS}/¤s.‹¡ &&†À-sà`pwd`/süts/¤s.‹¡ objs/¤s.‹¡

	@trunk/auto/generate-srs-librtmp-project.sh

1 #!/
bš
/
bash


3 #wh’ 
expÜt
 
¤s
-
lib¹mp
 
´ojeù


4 #£ˆ
the
 
SRS_WORKDIR
 
ªd
 
SRS_OBJS
,

5 #th’ 
cİy
 
the
 
¤s
-
lib¹mp
 
Ãeded
 
fes
.

7 #$SRS_WORKDIR 
the
 
wÜk
 
dœ
. 
›
. .

8 #$SRS_OBJS 
the
 
objs
 
dœeùÜy
 
to
 
¡Üe
h
Makefe
. 
›
. ./objs

9 #$SRS_OBJS_DIR 
the
 
objs
 
dœeùÜy
 
Makefe
. 
›
. objs

10 #$SRS_EXPORT_LIBRTMP_PROJECT 
the
 
expÜt
 
¤s
-
lib¹mp
 
´ojeù
 
·th
. 
›
. srs-librtmp

12 [ 
$SRS_EXPORT_LIBRTMP_PROJECT
 !ğ
NO
 ]; 
th’


13 [[ -
d
 
$
{
SRS_EXPORT_LIBRTMP_PROJECT
} ]]; 
th’


14 
	gecho
 -
	ge
 "${RED}srs-librtmparget dirƒxists: ${SRS_EXPORT_LIBRTMP_PROJECT}. ${BLACK}"

15 
	gex™
 1

16 
	gfi


17 #ü—‹ 
rg‘


18 
	gSRS_WORKDIR
=
$
{
SRS_EXPORT_LIBRTMP_PROJECT
} && 
SRS_OBJS
=${
SRS_WORKDIR
}/${
SRS_OBJS_DIR
} && 
mkdœ
 -
p
 ${SRS_OBJS} &&

19 #cİy 
¤c
 
to
 
rg‘


20 
_CPT
=
$
{
SRS_EXPORT_LIBRTMP_PROJECT
}/
»£¬ch
/
lib¹mp
 && 
mkdœ
 -
p
 ${_CPT} && 
ı
„esearch/librtmp

	@trunk/auto/generate-srs-librtmp-single.sh

1 #!/
bš
/
bash


3 
	gOS_IS_OSX
=
NO


4 
uÇme
 -
s
|
g»p
 
D¬wš
 >/
dev
/
nuÎ
 2>&1

5 
»t
=
$
?; [[ 0 -
eq
 
$»t
 ]]; 
th’


6 
	gOS_IS_OSX
=
YES


7 
fi


8 
echo
 "Is OSX: ${OS_IS_OSX}"

10 #wh’ 
expÜt
 
¤s
-
lib¹mp
 
sšgË
 
fes


11 #·ckag
the
 
whŞe
 
´ojeù
 
to
 
¤s_lib¹mp
.
h
 
ªd
 srs_lib¹mp.
ıp


13 #$SRS_OBJS_DIR 
the
 
objs
 
dœeùÜy
 
Makefe
. 
›
. objs

14 #$SRS_EXPORT_LIBRTMP_SINGLE 
the
 
expÜt
 
¤s
-
lib¹mp
 
sšgË
 
·th
. 
›
. srs-librtmp

16 #th
rg‘
 
dœ
 
mu¡
 
ü—‹d


17 [[ ! -
d
 
$SRS_EXPORT_LIBRTMP_SINGLE
 ]]; 
th’


18 
	gecho
 -
	ge
 "${RED}error,arget dir‚ot created: $SRS_EXPORT_LIBRTMP_SINGLE${BLACK}"

19 
	gex™
 -1

20 
	gfi


22 #g’”©
the
 
¤s_lib¹mp
.
h


23 
ı
 
	g$SRS_EXPORT_LIBRTMP_SINGLE
/
	g¤c
/
	glibs
/
	g¤s_lib¹mp
.
hµ
 $SRS_EXPORT_LIBRTMP_SINGLE/¤s_lib¹mp.
	gh


25 #ü—‹ 
¤s_lib¹mp
.
ıp


26 
	gFILE
=
$SRS_EXPORT_LIBRTMP_SINGLE
/
¤s_lib¹mp
.
ıp


27 
ÿt
 << 
END
 >
$FILE


51 
	~"¤s_lib¹mp.h
"

53 
END


54 #bud 
objs
‡utØ
fes
 
to
 
ıp


55 
ÿt
 
$SRS_EXPORT_LIBRTMP_SINGLE
/
$SRS_OBJS_DIR
/
¤s_auto_h—d”s
.
hµ
 >>
$FILE


56 
»t
=
$
?; [[ 
$»t
 -
Ã
 0 ]]; 
th’


57 
	gecho
 -
	ge
 "${RED}failedo generatehe srs_librtmp.cpp${BLACK}"

58 
ex™
 
$»t


59 
	gfi


60 #moduË 
to
 
ıp
 
fes
.

61 
funùiÚ
 
	$bud_moduË_hµ
()

63 
echo
 "build files ${SRS_LIBRTMP_OBJS}o $FILE"

64 
™em
 
š
 
$
{
SRS_LIBRTMP_OBJS
[*]}; do

65 
FILE_NAME
="${item%.*}"

66 
echo
 "// fŞlowšg i g’”©ed by ${FILE_NAME}.hµ" >> 
$FILE
 &&

67 
$SED
 "s|#šşud<¤s_|//#šşud<¤s_|g" 
$SRS_EXPORT_LIBRTMP_SINGLE
/
$
{
FILE_NAME
}.
hµ
 &&

68 
ÿt
 
$SRS_EXPORT_LIBRTMP_SINGLE
/
$
{
FILE_NAME
}.
hµ
 >>
$FILE


69 
»t
=
$
?; [[ 
$»t
 -
Ã
 0 ]]; 
th’


70 
echo
 -
e
 "${RED}failedo generatehe srs_librtmp.cpp by ${FILE_NAME}.hpp. {${BLACK}"

71 
ex™
 
$»t


72 
fi


73 
dÚe


74 
	}
}

75 
	gSRS_LIBRTMP_OBJS
="${CORE_OBJS[@]}" && 
bud_moduË_hµ


76 
SRS_LIBRTMP_OBJS
="${KERNEL_OBJS[@]}" && 
bud_moduË_hµ


77 
SRS_LIBRTMP_OBJS
="${PROTOCOL_OBJS[@]}" && 
bud_moduË_hµ


78 
SRS_LIBRTMP_OBJS
="${LIBS_OBJS[@]}" && 
bud_moduË_hµ


79 #moduË 
to
 
ıp
 
fes
.

80 
funùiÚ
 
	$bud_moduË_ıp
()

82 
echo
 "build files ${SRS_LIBRTMP_OBJS}o $FILE"

83 
™em
 
š
 
$
{
SRS_LIBRTMP_OBJS
[*]}; do

84 
FILE_NAME
="${item%.*}"

85 
echo
 "// fŞlowšg i g’”©ed by ${FILE_NAME}.ıp" >> 
$FILE
 &&

86 
$SED
 "s|#šşud<¤s_|//#šşud<¤s_|g" 
$SRS_EXPORT_LIBRTMP_SINGLE
/
$
{
FILE_NAME
}.
ıp
 &&

87 
ÿt
 
$SRS_EXPORT_LIBRTMP_SINGLE
/
$
{
FILE_NAME
}.
ıp
 >>
$FILE


88 
»t
=
$
?; [[ 
$»t
 -
Ã
 0 ]]; 
th’


89 
echo
 -
e
 "${RED}failedo generatehe srs_librtmp.cpp by ${FILE_NAME}.cpp. {${BLACK}"

90 
ex™
 
$»t


91 
fi


92 
dÚe


93 
	}
}

94 
	gSRS_LIBRTMP_OBJS
="${CORE_OBJS[@]}" && 
bud_moduË_ıp


95 
SRS_LIBRTMP_OBJS
="${KERNEL_OBJS[@]}" && 
bud_moduË_ıp


96 
SRS_LIBRTMP_OBJS
="${PROTOCOL_OBJS[@]}" && 
bud_moduË_ıp


97 
SRS_LIBRTMP_OBJS
="${LIBS_OBJS[@]}" && 
bud_moduË_ıp


99 #ü—‹ 
exam¶e
.
ıp


100 
FILE
=
$SRS_EXPORT_LIBRTMP_SINGLE
/
exam¶e
.
c


101 
SRS_SINGLE_LIBRTMP_COMPILE
='gccƒxample.c srs_librtmp.cpp -g -O0 -lstdc++ -oƒxample'

102 
ÿt
 << 
END
 >
$FILE


108 
	~<¡dio.h
>

109 
	~"¤s_lib¹mp.h
"

111 
	$maš
(
¬gc
, ** 
¬gv
)

113 
¤s_¹mp_t
 
¹mp
;

115 
	`´štf
("Example for srs-librtmp\n");

116 
	`´štf
("SRS(ossrs) client†ibrtmp†ibrary.\n");

117 
	`´štf
("v”siÚ: %d.%d.%d\n", 
	`¤s_v”siÚ_majÜ
(), 
	`¤s_v”siÚ_mšÜ
(), 
	`¤s_v”siÚ_»visiÚ
());

119 
¹mp
 = 
	`¤s_¹mp_ü—‹
("rtmp://ossrs.net/live/livestream");

120 
	`¤s_humª_Œaû
("create„tmp success");

121 
	`¤s_¹mp_de¡roy
(
¹mp
);

124 
	}
}

126 
	gEND


128 #comp
the
 
exam¶e


129 (
cd
 
	g$SRS_EXPORT_LIBRTMP_SINGLE
 && 
	gecho
 "${SRS_SINGLE_LIBRTMP_COMPILE}" &&

130 `
	g$
{
	gSRS_SINGLE_LIBRTMP_COMPILE
}` && ./
	gexam¶e
 && 
	grm
 -
f
ƒxample)

131 
	g»t
=
$
?; [[ 
$»t
 -
Ã
 0 ]]; 
th’


132 
	gecho
 "(cd $SRS_EXPORT_LIBRTMP_SINGLE && ${SRS_SINGLE_LIBRTMP_COMPILE} && ./example &&„m -fƒxample)"

133 
	gecho
 -
	ge
 "${RED}failedo compileƒxample.${BLACK}"

134 
ex™
 
$»t


135 
	gfi


137 #ş—¸
the
 
fes
 
¤s
-
lib¹mp
 
´ojeù
, 
g’”©ed
 
by
 
g’”©e
-¤s-lib¹mp-´ojeù.
sh


138 (
cd
 
	g$SRS_EXPORT_LIBRTMP_SINGLE
 && 
	grm
 -
rf
‡utØ
$SRS_OBJS_DIR
 
»£¬ch
 
¤c
 
	gMakefe
)

	@trunk/auto/generate_header.sh

1 #!/
bš
/
bash


2 #g’”—‹ 
the
 
lib¿ry
 
h—d”
 
fe
.

4 
	gobjs
=
$1


6 
rm
 -
f
 
$objs
/
šşude
/
¤s_lib¹mp
.
h
 &&

7 
ı
 
$objs
/../
¤c
/
libs
/
¤s_lib¹mp
.
hµ
 $objs/
šşude
/¤s_lib¹mp.
h


8 
echo
 "genereate srs-librtmp headers success"

	@trunk/auto/libs.sh

1 #g’”©
the
 
lib¿ry
 
lšk
.

3 #$SRS_OBJS 
the
 
objs
 
dœeùÜy
 
to
 
¡Üe
h
Makefe
. 
›
. ./objs

4 #$SRS_OBJS_DIR 
the
 
objs
 
dœeùÜy
 
Makefe
. 
›
. objs

5 #$SRS_MAKEFILE 
the
 
makefe
 
Çme
. 
›
. 
Makefe


6 #
#$BUILD_KEY 
a
 
¡ršg
 
šdiÿ‹s
 
the
 
bud
 
key
 
Makefe
. 
›
. 
dump


7 #$LIB_NAME 
the
 
­p
 
Çme
 
to
 
ouut
. 
›
. 
sm¬t_£rv”


8 #$MODULE_OBJS 
¬¿y
, 
the
 
objeùs
 
to
 
compe
h
­p
.

10 
	gFILE
=
$
{
SRS_OBJS
}/${
SRS_MAKEFILE
}

12 
LIB_TARGET
="${SRS_OBJS_DIR}/${LIB_NAME}"

13 
LIB_TAGET_STATIC
="${LIB_TARGET}.a"

15 
echo
 "generate†ib ${LIB_NAME} depends..."

17 
echo
 "" >> 
$
{
FILE
}

18 
echo
 "#‡rchivlib¿ry ${LIB_TAGET_STATIC}" >> 
$
{
FILE
}

19 
echo
 "${BUILD_KEY}: ${LIB_TAGET_STATIC}" >> 
$
{
FILE
}

21 #bud 
d•’ds


22 
echo
 -
n
 "${LIB_TAGET_STATIC}: " >> 
$
{
FILE
}

23 
™em
 
š
 
$
{
MODULE_OBJS
[*]}; do

24 
	gFILE_NAME
=`
ba£Çme
 
$™em
`

25 
FILE_NAME
=
$
{FILE_NAME%.*}

27 [ ! -
f
 
$
{
™em
} ]; 
th’


29 
fi


31 
	gOBJ_FILE
=
$
{
SRS_OBJS_DIR
}/
$™em


32 
OBJ_FILE
="${OBJ_FILE%.*}.o"

33 
echo
 -
n
 "${OBJ_FILE} " >> 
$
{
FILE
}

34 
dÚe


35 
echo
 "" >> 
$
{
FILE
}

37 #bud 
h—d”
 
fe


38 
echo
 -
n
 " @bash‡uto/g’”©e_h—d”.sh ${SRS_OBJS_DIR}" >> 
$
{
FILE
}

39 
echo
 "" >> 
$
{
FILE
}

41 #¬chiv
lib¹mp
.
a


42 
echo
 -
n
 " \$(ARè-r ${LIB_TAGET_STATIC} " >> 
$
{
FILE
}

43 
™em
 
š
 
$
{
MODULE_OBJS
[*]}; do

44 
	gFILE_NAME
=`
ba£Çme
 
$™em
`

45 
FILE_NAME
=
$
{FILE_NAME%.*}

47 [ ! -
f
 
$
{
™em
} ]; 
th’


49 
fi


51 
	gOBJ_FILE
=
$
{
SRS_OBJS_DIR
}/
$™em


52 
OBJ_FILE
="${OBJ_FILE%.*}.o"

53 
echo
 -
n
 "${OBJ_FILE} " >> 
$
{
FILE
}

54 
dÚe


55 
echo
 "" >> 
$
{
FILE
}

57 #·»Á 
Makefe
, 
to
 
ü—‹
 
moduË
 
ouut
 
dœ
 
befÜe
 
compe
 
™
.

58 
	gecho
 " @mkdœ -°${SRS_OBJS_DIR}/šşude" >> 
	g$
{
	gSRS_WORKDIR
}/${
	gSRS_MAKEFILE
}

59 
	gecho
 " @mkdœ -°${SRS_OBJS_DIR}/lib" >> 
	g$
{
	gSRS_WORKDIR
}/${
	gSRS_MAKEFILE
}

61 
	gecho
 -
	gn
 "generate†ib ${LIB_NAME} ok";ƒcho '!';

	@trunk/auto/local_ip.sh

1 
	g
=`
ifcÚfig
 2>&1|
g»p
 'š‘‡ddr'|g»°-
v
 '127.0.0.1'|
awk
 'NR==1 {´šˆ$2}'|awk -
F
 ':' '{print $2}'`

2 [[ -
z
 
$
 ]]; 
th’


3 
	gecho
 "127.0.0.1"

5 
echo
 
$


6 
	gfi


	@trunk/auto/modules.sh

1 #g’”©
the
 
moduË
 
šfo
 
to
 
Makefe


3 #$SRS_OBJS 
the
 
objs
 
dœeùÜy
 
to
 
¡Üe
h
Makefe
. 
›
. ./objs

4 #$SRS_OBJS_DIR 
the
 
objs
 
dœeùÜy
 
Makefe
. 
›
. objs

5 #$SRS_MAKEFILE 
the
 
makefe
 
Çme
. 
›
. 
Makefe


6 #
#$MODULE_DIR 
the
 
moduË
 
dœ
. 
›
. 
¤c
/
os
/
lšux


7 #$MODULE_ID 
the
 
id
 
of
 
moduË
. 
›
. 
CORE


8 #$MODULE_DEPENDS 
¬¿y
, 
the
 
d’³nd
 
MODULEs
 
id
. 
›
. (
CORE
 
OS
)

9 #$ModuËLibInc 
¬¿y
, 
the
 
d•’d
 3
rd·¹
 
lib¿ry
 
šşudes
. 
›
. (
objs
/
¡
-1.9/
obj
 objs/
libx264
/obj)

10 #$MODULE_FILES 
¬¿y
, 
the
 
h—d
/
ıp
 
fes
 
of
 
moduËs
. 
›
. (
public
 
log
)

11 #$DEFINES 
¡ršg
, 
the
 
bud
 
maüo
 
defšes
. 
›
. "-DMY_SRS"

13 #$MODULE_OBJS 
¬¿y
, 
the
 
objeùs
 
of
h
moduËs
, 
u£d
 
lšk
h
bš¬y


15 
	gFILE
=
$
{
SRS_OBJS
}/${
SRS_MAKEFILE
}

16 
echo
 "#####################################################################################" >> 
$
{
FILE
}

17 
echo
 "#h${MODULE_ID} moduË." >> 
$
{
FILE
}

18 
echo
 "#####################################################################################" >> 
$
{
FILE
}

19 
echo
 >> 
$
{
FILE
}

22 
echo
 "# INCS fÜ ${MODULE_ID}, h—d” oàmoduË‡nd it d•’d tØcompe" >> 
$
{
FILE
}

23 #
#th
public
 
šşude
 
fes
, 
exam¶e
:

24 #CORE_MODULE_INCS = -
I¤c
/
cÜe


25 
	gecho
 "${MODULE_ID}_MODULE_INCS = -I${MODULE_DIR} " >> 
	g$
{
	gFILE
}

26 #
#th
´iv©e
 
šşude
 
fes
, 
exam¶e
:

27 #CORE_INCS = -
I¤c
/
cÜe
 -
Iobjs
/
¡
 -Iobj -Iobjs/
hp
 -Iobjs

28 #MAIN_INCS = -
I¤c
/
maš
 
$
(
CORE_MODULE_INCS
è-
Iobjs
/
¡
 -Iobjs

29 #wh”
the
 
public
 
wl
 
be
 
u£d
 
Ùh”
 
moduËs
 
which
 
d•’ds
 
Ú
 
™
.

30 
	gINCS_NAME
="${MODULE_ID}_INCS"

31 #
#cu¼’ˆ
moduË
 
h—d”
 
fes


32 
echo
 -
n
 "${INCS_NAME} = -I${MODULE_DIR} " >> 
$
{
FILE
}

33 #
#d•’d 
moduË
 
h—d”
 
fes


34 
™em
 
š
 
$
{
MODULE_DEPENDS
[*]}; do

35 
	gDEP_INCS_NAME
="${item}_INCS"do

36 
DEP_INCS_NAME
="${item}_MODULE_INCS"

37 
echo
 -
n
 "\$(${DEP_INCS_NAME}è" >> 
$
{
FILE
}

38 
dÚe


39 #
#d•’d 
lib¿ry
 
h—d”
 
fes


40 
™em
 
š
 
$
{
ModuËLibIncs
[*]}; do

41 
	gecho
 -
	gn
 "-I${™em} " >> 
	g$
{
	gFILE
}

42 
dÚe


43 
	gecho
 "" >> 
	g$
{
	gFILE
};ƒcho "" >> ${FILE}

46 
	gecho
 "# DEPS fÜ ${MODULE_ID},hd•’d oàmakschema" >> 
	g$
{
	gFILE
}

47 #d•’d 
Ú
 
h—d”s
 
of
 
£lf
 
moduË
, 
exam¶e
:

48 #CORE_DEPS = 
¤c
/
cÜe
/
¤s_cÜe
.
hµ


49 
	gDEPS_NAME
="${MODULE_ID}_DEPS"

50 
echo
 -
n
 "${DEPS_NAME} = " >> 
$
{
FILE
}

51 
™em
 
š
 
$
{
MODULE_FILES
[*]}; do

52 
	gHEADER_FILE
="${MODULE_DIR}/${item}.hpp"

53 [ -
f
 
$
{
HEADER_FILE
} ]; 
th’


54 
	gecho
 -
	gn
 " ${HEADER_FILE}" >> 
	g$
{
	gFILE
}

55 
fi


56 
	gdÚe


57 #d•’d 
Ú
 
Ùh”
 
moduËs
, 
exam¶e
:

58 #MAIN_DEPS = 
$
(
CORE_DEPS
)

59 
™em
 
š
 
	g$
{
	gMODULE_DEPENDS
[*]}; do

60 
	gDEP_DEPS_NAME
="${item}_DEPS"

61 
echo
 -
n
 " \$(${DEP_DEPS_NAME}è" >> 
$
{
FILE
}

62 
dÚe


63 
echo
 "" >> 
$
{
FILE
}; 
	gecho
 "" >> 
	g$
{
	gFILE
}

66 
	gecho
 "# OBJ fÜ ${MODULE_ID},ƒach objeù fe" >> 
	g$
{
	gFILE
}

67 
	gMODULE_OBJS
=()

68 
™em
 
š
 
$
{
MODULE_FILES
[*]}; do

69 
	gCPP_FILE
="${MODULE_DIR}/${item}.cpp"

70 
OBJ_FILE
="${SRS_OBJS_DIR}/${MODULE_DIR}/${item}.o"

71 
MODULE_OBJS
="${MODULE_OBJS[@]} ${CPP_FILE}"

72 [ -
f
 
$
{
CPP_FILE
} ]; 
th’


73 
	gecho
 "${OBJ_FILE}: \$(${DEPS_NAME}è${CPP_FILE} " >> 
	g$
{
	gFILE
}

74 
	gecho
 " \$(CXXè-ø\$(CXXFLAGSè${DEFINES} \$(${INCS_NAME})\\" >> 
	g$
{
	gFILE
}

75 
	gecho
 " -Ø${OBJ_FILE} ${CPP_FILE}" >> 
	g$
{
	gFILE
}

76 
fi


77 
dÚe


78 
	gecho
 "" >> 
	g$
{
	gFILE
}

80 #·»Á 
Makefe
, 
to
 
ü—‹
 
moduË
 
ouut
 
dœ
 
befÜe
 
compe
 
™
.

81 
	gecho
 " @mkdœ -°${SRS_OBJS_DIR}/${MODULE_DIR}" >> 
	g$
{
	gSRS_WORKDIR
}/${
	gSRS_MAKEFILE
}

83 
	gecho
 -
	gn
 "generate module ${MODULE_ID} ok";ƒcho '!';

	@trunk/auto/options.sh

1 #!/
bš
/
bash


3 #v¬ŸbËs, 
·»Á
 
süt
 
mu¡
 
£t
 
™
:

5 #####################################################################################
#####################################################################################
#·r£ 
u£r
 
İtiÚs
, dØ
this
 
©
 
fœ¡


7 #####################################################################################
#ouuˆ
v¬ŸbËs


8 #####################################################################################
òo

11 #ã©u» 
İtiÚs


12 
	gSRS_HLS
=
RESERVED


13 
SRS_HDS
=
RESERVED


14 
SRS_DVR
=
RESERVED


15 
SRS_NGINX
=
RESERVED


16 
SRS_SSL
=
RESERVED


17 
SRS_FFMPEG_TOOL
=
RESERVED


18 
SRS_TRANSCODE
=
RESERVED


19 
SRS_INGEST
=
RESERVED


20 
SRS_STAT
=
RESERVED


21 
SRS_HTTP_CALLBACK
=
RESERVED


22 
SRS_HTTP_SERVER
=
RESERVED


23 
SRS_STREAM_CASTER
=
RESERVED


24 
SRS_HTTP_API
=
RESERVED


25 
SRS_LIBRTMP
=
RESERVED


26 
SRS_RESEARCH
=
RESERVED


27 
SRS_UTEST
=
RESERVED


29 
SRS_GPERF
=
RESERVED


30 #g³rà
memÜy
 
check


31 
SRS_GPERF_MC
=
RESERVED


32 #g³rà
memÜy
 
´ofe


33 
SRS_GPERF_MP
=
RESERVED


34 #g³rà
ıu
 
´ofe


35 
SRS_GPERF_CP
=
RESERVED


37 
SRS_GPROF
=
RESERVED


40 
SRS_FFMPEG_STUB
=
RESERVED


41 
SRS_HTTP_CORE
=
RESERVED


43 
SRS_PREFIX
=/
u¤
/
loÿl
/
¤s


44 
SRS_JOBS
=1

45 
SRS_STATIC
=
RESERVED


46 #wh‘h” 
’abË
 
the
 
log
 
v”bo£
/
šfo
/
Œaû
 
Ëv–
.

47 #®way 
’abË
 
the
 
w¬n
/
”rÜ
 
Ëv–
.

48 
SRS_LOG_VERBOSE
=
RESERVED


49 
SRS_LOG_INFO
=
RESERVED


50 
SRS_LOG_TRACE
=
RESERVED


53 #dÚÙ 
compe
 
s¦
, 
u£
 
sy¡em
 s¦(-
ls¦
è
»quœed
.

54 
	gSRS_USE_SYS_SSL
=
NO


55 #’abË 
memÜy
 
w©ch
, 
d‘eù
 memÜy 
Ëak
,

56 #sim¬ 
to
 
gmc
, 
should
 
di§bË
 
š
 
»Ëa£
 
v”siÚ
 
hu¹s
 
³rfÜmªû
.

57 
	gSRS_MEM_WATCH
=
NO


58 #expÜˆ
the
 
¤s
-
lib¹mp
 
to
 
¥ecif›d
 
´ojeù
, 
NO
Ø
di§bË
 
™
.

59 
	gSRS_EXPORT_LIBRTMP_PROJECT
=
NO


60 #expÜˆ
the
 
¤s
-
lib¹mp
 
to
 
a
 
sšgË
 .
h
 
ªd
 .
c
, 
NO
Ø
di§bË
 
™
.

61 
	gSRS_EXPORT_LIBRTMP_SINGLE
=
NO


64 #fÜ 
x86
/
x64
 
pc
/
£rv”s


65 
SRS_X86_X64
=
NO


66 #fÜ 
osx
 
sy¡em


67 
SRS_OSX
=
NO


68 #¬mhf(
v7ıu
è
but
 
Ú
 
ubuÁu12


69 
SRS_ARM_UBUNTU12
=
NO


70 #m 
but
 
Ú
 
ubuÁu12


71 
SRS_MIPS_UBUNTU12
=
NO


72 #dev, 
İ’
 
®l
 
ã©u»s
 
dev
, 
no
 
g³rf
/
´of
/
¬m
.

73 
	gSRS_DEV
=
NO


74 #dev, 
İ’
 
maš
 
£rv”
 
ã©u»
 
dev
, 
no
 
u‹¡
/
»£¬ch
/
lib¹mp


75 
	gSRS_FAST_DEV
=
NO


76 #demo, 
the
 
demo
 
of
 
¤s
, @
£e
: 
h‰ps
:

77 
	gSRS_DEMO
=
NO


78 #¿¥b”ry-
pi
, 
İ’
 
hls
/
s¦
/

79 
	gSRS_PI
=
NO


80 #cub›bßrd, 
dÚÙ
 
İ’
 
ffm³g
/
ngšx
.

81 
	gSRS_CUBIE
=
NO


82 #th
mo¡
 
ç¡
 
compe
, 
nÙhšg
, 
Úly
 
suµÜt
 
vp6
 
RTMP
.

83 
	gSRS_FAST
=
NO


84 #Úly 
suµÜt
 
RTMP
 
w™h
 
s¦
.

85 
SRS_PURE_RTMP
=
NO


86 #Úly 
suµÜt
 
RTMP
+
HLS
 
w™h
 
s¦
.

87 
SRS_RTMP_HLS
=
NO


88 #th
mo¡
 
ç¡
 
compe
, 
nÙhšg
, 
Úly
 
suµÜt
 
vp6
 
RTMP
.

89 
	gSRS_DISABLE_ALL
=
NO


90 #®È
ã©u»s
 
is
 
Ú


91 
SRS_ENABLE_ALL
=
NO


93 #wh‘h” 
üoss
 
bud
 
embed
 
ıu
, 
¬m
/
ms


94 
	gSRS_CROSS_BUILD
=
NO


97 #####################################################################################
 show_h–p(è{

98 
ÿt
 << 
END


100 
O±iÚs
:

101 -
h
, --
h–p
 
´št
 
this
 
mes§ge


103 --
w™h
-
s¦
 
’abË
 
¹mp
 
com¶ex
 
hªdshake
, 
»quœes
 
İ’s¦
-
dev–
 
š¡®Ëd
.

104 
to
 
d–iv”y
 
h264
 
video
 
ªd
 
¯c
 
audio
Ø
æash
 
¶ay”
.

105 --
w™h
-
hls
 
’abË
 hl 
¡»amšg
, 
mux
 
RTMP
 
to
 
m3u8
/
ts
 
fes
.

106 --
w™h
-
hds
 
’abË
 hd 
¡»amšg
, 
mux
 
RTMP
 
to
 
f4m
/
f4v
 
fes
.

107 --
w™h
-
dvr
 
’abË
 dvr, 
mux
 
RTMP
 
to
 
æv
 
fes
.

108 --
w™h
-
ngšx
 
’abË
 
d–iv”y
 
HTTP
 
¡»am
 with‚ginx.

109 
bud
 
ngšx
 
©
: ./
objs
/ngšx/
sbš
/nginx

110 --
w™h
-
h‰p
-
ÿÎback
 
’abË
 h‰°
hooks
, 
bud
 
ch”rypy
 
as
 
demo
 
­i
 
£rv”
.

111 --
w™h
-
h‰p
-
£rv”
 
’abË
 h‰°£rv” 
to
 
d–iv”y
 h‰°
¡»am
.

112 --
w™h
-
¡»am
-
ÿ¡”
 
’abË
 sŒ—m ca¡” 
to
 
£rve
 
Ùh”
 sŒ—m 
ov”
 oth” 
´ÙocŞ
.

113 --
w™h
-
h‰p
-
­i
 
’abË
 h‰°­i, 
to
 
mªage
 
SRS
 
by
 http‡pi.

114 --
w™h
-
ffm³g
 
’abË
 
Œªscodšg
 
toŞ
 ffmpeg.

115 
bud
 
ffm³g
 
©
: ./
objs
/ffm³g/
bš
/ffmpeg

116 --
w™h
-
Œªscode
 
’abË
 
Œªscodšg
 
ã©u»s
.

117 
u£r
 
mu¡
 
¥ecif›s
 
the
 
Œªscode
 
toŞs
 
š
 
cÚf
.

118 --
w™h
-
šge¡
 
’abË
 inge¡ 
ã©u»s
.

119 
u£r
 
mu¡
 
¥ecif›s
 
the
 
šge¡
 
toŞs
 
š
 
cÚf
.

120 --
w™h
-
¡©
 
’abË
 
the
 
d©a
 
¡©i¡ic
, 
h‰p
 
­i
.

121 --
w™h
-
lib¹mp
 
’abË
 
¤s
-lib¹mp, 
lib¿ry
 
ş›Á
.

122 --
w™h
-
»£¬ch
 
bud
 
the
„e£¬ch 
toŞs
.

123 --
w™h
-
u‹¡
 
bud
 
the
 u‹¡ 
SRS
.

124 --
w™h
-
g³rf
 
bud
 
SRS
 w™h g³rà
toŞs
(
no
 
gmc
/
gmp
/
gı
, w™h 
tcm®loc
 
Úly
).

125 --
w™h
-
gmc
 
bud
 
memÜy
 
check
 
SRS
 w™h 
g³rf
 
toŞs
.

126 --
w™h
-
gmp
 
bud
 
memÜy
 
´ofe
 
SRS
 w™h 
g³rf
 
toŞs
.

127 --
w™h
-
gı
 
bud
 
ıu
 
´ofe
 
SRS
 w™h 
g³rf
 
toŞs
.

128 --
w™h
-
g´of
 
bud
 
SRS
 w™h g´of(
GNU
 
´ofe
 
toŞ
).

129 --
w™h
-
¬m
-
ubuÁu12
 
üoss
 
bud
 
SRS
 
Ú
 ubuÁu12 
¬mhf
(
v7ıu
).

131 --
w™hout
-
s¦
 
di§bË
 
¹mp
 
com¶ex
 
hªdshake
.

132 --
w™hout
-
hls
 
di§bË
 hls, 
the
 
­¶e
 
h‰p
 
live
 
¡»amšg
.

133 --
w™hout
-
hds
 
di§bË
 hds, 
the
 
adobe
 
h‰p
 
dyÇmic
 
¡»amšg
.

134 --
w™hout
-
dvr
 
di§bË
 dvr, 
dÚÙ
 
suµÜt
 
»cÜd
 
RTMP
 
¡»am
 
to
 
æv
.

135 --
w™hout
-
ngšx
 
di§bË
 
d–iv”y
 
HTTP
 
¡»am
 
w™h
‚ginx.

136 --
w™hout
-
h‰p
-
ÿÎback
 
di§bË
 h‰p, h‰°
hooks
 callback.

137 --
w™hout
-
h‰p
-
£rv”
 
di§bË
 h‰°£rv”, 
u£
 
ex‹º®
 s”v” 
to
 
d–iv”y
 h‰°
¡»am
.

138 --
w™hout
-
¡»am
-
ÿ¡”
 
di§bË
 sŒ—m ca¡”, 
Úly
 
li¡’
 
ªd
 
£rve
 
RTMP
/
HTTP
.

139 --
w™hout
-
h‰p
-
­i
 
di§bË
 h‰°­i, 
Úly
 
u£
 
cÚsŞe
 
to
 
mªage
 
SRS
 
´oûss
.

140 --
w™hout
-
ffm³g
 
di§bË
 
the
 ffm³g 
Œªscode
 
toŞ
 
ã©u»
.

141 --
w™hout
-
Œªscode
 
di§bË
 
the
 
Œªscodšg
 
ã©u»
.

142 --
w™hout
-
šge¡
 
di§bË
 
the
 inge¡ 
ã©u»
.

143 --
w™hout
-
¡©
 
di§bË
 
the
 
d©a
 
¡©i¡ic
 
ã©u»
.

144 --
w™hout
-
lib¹mp
 
di§bË
 
¤s
-lib¹mp, 
lib¿ry
 
ş›Á
.

145 --
w™hout
-
»£¬ch
 dØ
nÙ
 
bud
 
the
„e£¬ch 
toŞs
.

146 --
w™hout
-
u‹¡
 dØ
nÙ
 
bud
 
the
 u‹¡ 
SRS
.

147 --
w™hout
-
g³rf
 dØ
nÙ
 
bud
 
SRS
 
w™h
 g³rà
toŞs
(w™houˆ
tcm®loc
 
ªd
 
gmc
/
gmp
/
gı
).

148 --
w™hout
-
gmc
 dØ
nÙ
 
bud
 
memÜy
 
check
 
SRS
 
w™h
 
g³rf
 
toŞs
.

149 --
w™hout
-
gmp
 dØ
nÙ
 
bud
 
memÜy
 
´ofe
 
SRS
 
w™h
 
g³rf
 
toŞs
.

150 --
w™hout
-
gı
 dØ
nÙ
 
bud
 
ıu
 
´ofe
 
SRS
 
w™h
 
g³rf
 
toŞs
.

151 --
w™hout
-
g´of
 dØ
nÙ
 
bud
 
¤s
 
w™h
 g´of(
GNU
 
´ofe
 
toŞ
).

152 --
w™hout
-
¬m
-
ubuÁu12
 dØ
nÙ
 
üoss
 
bud
 
¤s
 
Ú
 ubuÁu12 
¬mhf
(
v7ıu
).

154 --
´efix
=<
·th
> 
the
 
absŞu‹
 
š¡®l
…©h 
¤s
.

155 --
wh‘h”
 
add
 '-¡©ic' 
to
 
lšk
 
İtiÚs
.

156 --
jobs
[=
N
] 
AÎow
 N job 
©
 
Úû
; 
šfš™e
 job 
w™h
 
no
 
	g¬g
.

157 
u£d
 
make
 
š
 
the
 
	gcÚfigu»
, 
	gexam¶e
, 
to
 mak
	gffm³g
.

158 --
	glog
-
v”bo£
 
wh‘h”
 
’abË
 
the
 
log
 v”bo£ 
	gËv–
. : 
no
.

159 --
log
-
šfo
 
wh‘h”
 
’abË
 
the
†og infØ
Ëv–
. : 
no
.

160 --
log
-
Œaû
 
wh‘h”
 
’abË
 
the
†og¿û 
Ëv–
. : 
yes
.

162 
P»£ts
:

163 --
x86
-
x64
 [] x86/x64 
ıu
, 
commÚ
 
pc
 
ªd
 
	g£rv”s
.

164 --
osx
 osx(
d¬wš
è
sy¡em
 
to
 
bud
 
	gSRS
.

165 --
pi
 
	g¿¥b”ry
-pi(
dœeùly
 
bud
), 
İ’
 
ã©u»s
 
	ghls
/
	gs¦
/.

166 --
cub›
 
cub›bßrd
(
dœeùly
 
bud
), 
İ’
 
ã©u»s
 
exû±
 
	gffm³g
/
	gngšx
.

167 --
¬m
 
®Ÿs
 --
	gw™h
-
	g¬m
-
	gubuÁu12
, ubuÁu12,‡rm 
	güossbud


168 --
ms
 
®Ÿs
 --
	gw™h
-
	gms
-
	gubuÁu12
, ubuÁu12, m 
	güossbud


169 --
ç¡
 
the
 
mo¡
 fa¡ 
	gcompe
, 
	gnÙhšg
, 
Úly
 
suµÜt
 
vp6
 
	gRTMP
.

170 --
	gpu»
-
¹mp
 
Úly
 
suµÜt
 
RTMP
 
w™h
 
	gs¦
.

171 --
	g¹mp
-
hls
 
Úly
 
suµÜt
 
	gRTMP
+
HLS
 
w™h
 
	gs¦
.

172 --
	gdi§bË
-
®l
 
di§bË
‡Î 
	gã©u»s
, 
Úly
 
suµÜt
 
vp6
 
	gRTMP
.

173 --
dev
 
	gdev
, 
İ’
 
®l
 
	gã©u»s
, 
no
 
	gngšx
/
	gg³rf
/
	gg´of
/
	g¬m
.

174 --
	gç¡
-
dev
 dev 
ç¡
 
	gcompe
, 
the
 
RTMP
 
	g£rv”
, 
w™hout
 
	glib¹mp
/
	gu‹¡
/
	g»£¬ch
.

175 --
demo
 
¤s
 
	gdemo
, @
	g£e
: 
h‰ps
:

176 --
fuÎ
 
’abË
 
®l
 
ã©u»s
, 
no
 
	gg³rf
/
	gg´of
/
	g¬m
.

178 
	gCÚæiùs
:

179 1. --
w™h
-
gmc
 
vs
 --w™h-
gmp
:

180 @
£e
: 
h‰p
:

181 2. --
w™h
-
g³rf
/
gmc
/
gmp
 
vs
 --w™h-
g´of
:

182 
g³ráoŞs
 
nÙ
 
com·tibË
 
w™h
 
g´of
.

183 3. --
¬m
 
vs
 --
w™h
-
ffm³g
/
g³rf
/
gmc
/
gmp
/
g´of
:

184 
the
 
com¶ex
 
toŞs
 
nÙ
 
avaabË
 
¬m
.

186 
Ex³¹s
:

187 --
u£
-
sys
-
s¦
 
dÚÙ
 
compe
 s¦, u£ 
sy¡em
 s¦(-
ls¦
è
	g»quœed
.

188 --
	gmemÜy
-
w©ch
 
’abË
 
memÜy
 w©ch 
to
 
d‘eù
 memÜy 
Ëakšg
(
hu¹s
 
³rfÜmªû
).

189 --
	gexpÜt
-
	glib¹mp
-
	g´ojeù
=<
·th
> 
expÜt
 
¤s
-
lib¹mp
 
to
 
¥ecif›d
 
´ojeù
 
š
…ath.

190 --
expÜt
-
lib¹mp
-
sšgË
=<
·th
>ƒxpÜˆ
¤s
-lib¹m°
to
 
a
 sšgË 
fe
(.
h
+.
ıp
è
š
…ath.

192 
WÜkæow
:

193 1. 
­¶y
 "P»£ts". 
nÙ
 
¥ecif›d
, 
u£
  
	g´e£t
.

194 2. 
	g­¶y
 "O±iÚs". 
u£r
 
¥ecif›d
 
İtiÚ
 
wl
 
ov”ride
 
the
 
	g´e£t
.

195 3. 
check
 
	gcÚæiùs
. @
£e
 
CÚæiùs
 
	g£ùiÚ
.

196 4. 
g’”©e
 
d‘a
 
	gã©u»s
.

198 
	gEND


201 
funùiÚ
 
	$·r£_u£r_İtiÚ
() {

202 "$İtiÚ" 
š


203 -
h
è
h–p
=
yes
 ;;

204 --
h–p
èh–p=
yes
 ;;

206 --
w™h
-
s¦
è
SRS_SSL
=
YES
 ;;

207 --
w™h
-
hls
è
SRS_HLS
=
YES
 ;;

208 --
w™h
-
hds
è
SRS_HDS
=
YES
 ;;

209 --
w™h
-
dvr
è
SRS_DVR
=
YES
 ;;

210 --
w™h
-
ngšx
è
SRS_NGINX
=
YES
 ;;

211 --
w™h
-
ffm³g
è
SRS_FFMPEG_TOOL
=
YES
 ;;

212 --
w™h
-
Œªscode
è
SRS_TRANSCODE
=
YES
 ;;

213 --
w™h
-
šge¡
è
SRS_INGEST
=
YES
 ;;

214 --
w™h
-
¡©
è
SRS_STAT
=
YES
 ;;

215 --
w™h
-
h‰p
-
ÿÎback
è
SRS_HTTP_CALLBACK
=
YES
 ;;

216 --
w™h
-
h‰p
-
£rv”
è
SRS_HTTP_SERVER
=
YES
 ;;

217 --
w™h
-
¡»am
-
ÿ¡”
è
SRS_STREAM_CASTER
=
YES
 ;;

218 --
w™h
-
h‰p
-
­i
è
SRS_HTTP_API
=
YES
 ;;

219 --
w™h
-
lib¹mp
è
SRS_LIBRTMP
=
YES
 ;;

220 --
w™h
-
»£¬ch
è
SRS_RESEARCH
=
YES
 ;;

221 --
w™h
-
u‹¡
è
SRS_UTEST
=
YES
 ;;

222 --
w™h
-
g³rf
è
SRS_GPERF
=
YES
 ;;

223 --
w™h
-
gmc
è
SRS_GPERF_MC
=
YES
 ;;

224 --
w™h
-
gmp
è
SRS_GPERF_MP
=
YES
 ;;

225 --
w™h
-
gı
è
SRS_GPERF_CP
=
YES
 ;;

226 --
w™h
-
g´of
è
SRS_GPROF
=
YES
 ;;

227 --
w™h
-
¬m
-
ubuÁu12
è
SRS_ARM_UBUNTU12
=
YES
 ;;

228 --
w™h
-
ms
-
ubuÁu12
è
SRS_MIPS_UBUNTU12
=
YES
 ;;

230 --
w™hout
-
s¦
è
SRS_SSL
=
NO
 ;;

231 --
w™hout
-
hls
è
SRS_HLS
=
NO
 ;;

232 --
w™hout
-
hds
è
SRS_HDS
=
NO
 ;;

233 --
w™hout
-
dvr
è
SRS_DVR
=
NO
 ;;

234 --
w™hout
-
ngšx
è
SRS_NGINX
=
NO
 ;;

235 --
w™hout
-
ffm³g
è
SRS_FFMPEG_TOOL
=
NO
 ;;

236 --
w™hout
-
Œªscode
è
SRS_TRANSCODE
=
NO
 ;;

237 --
w™hout
-
šge¡
è
SRS_INGEST
=
NO
 ;;

238 --
w™hout
-
¡©
è
SRS_STAT
=
NO
 ;;

239 --
w™hout
-
h‰p
-
ÿÎback
è
SRS_HTTP_CALLBACK
=
NO
 ;;

240 --
w™hout
-
h‰p
-
£rv”
è
SRS_HTTP_SERVER
=
NO
 ;;

241 --
w™hout
-
¡»am
-
ÿ¡”
è
SRS_STREAM_CASTER
=
NO
 ;;

242 --
w™hout
-
h‰p
-
­i
è
SRS_HTTP_API
=
NO
 ;;

243 --
w™hout
-
lib¹mp
è
SRS_LIBRTMP
=
NO
 ;;

244 --
w™hout
-
»£¬ch
è
SRS_RESEARCH
=
NO
 ;;

245 --
w™hout
-
u‹¡
è
SRS_UTEST
=
NO
 ;;

246 --
w™hout
-
g³rf
è
SRS_GPERF
=
NO
 ;;

247 --
w™hout
-
gmc
è
SRS_GPERF_MC
=
NO
 ;;

248 --
w™hout
-
gmp
è
SRS_GPERF_MP
=
NO
 ;;

249 --
w™hout
-
gı
è
SRS_GPERF_CP
=
NO
 ;;

250 --
w™hout
-
g´of
è
SRS_GPROF
=
NO
 ;;

251 --
w™hout
-
¬m
-
ubuÁu12
è
SRS_ARM_UBUNTU12
=
NO
 ;;

252 --
w™hout
-
ms
-
ubuÁu12
è
SRS_MIPS_UBUNTU12
=
NO
 ;;

254 --
jobs
è
SRS_JOBS
=
$
{
v®ue
} ;;

255 --
´efix
è
SRS_PREFIX
=
$
{
v®ue
} ;;

256 --è
SRS_STATIC
=
YES
 ;;

257 --
log
-
v”bo£
è
SRS_LOG_VERBOSE
=
YES
 ;;

258 --
log
-
šfo
è
SRS_LOG_INFO
=
YES
 ;;

259 --
log
-
Œaû
è
SRS_LOG_TRACE
=
YES
 ;;

261 --
x86
-
x64
è
SRS_X86_X64
=
YES
 ;;

262 --
osx
è
SRS_OSX
=
YES
 ;;

263 --
¬m
è
SRS_ARM_UBUNTU12
=
YES
 ;;

264 --
ms
è
SRS_MIPS_UBUNTU12
=
YES
 ;;

265 --
pi
è
SRS_PI
=
YES
 ;;

266 --
cub›
è
SRS_CUBIE
=
YES
 ;;

267 --
dev
è
SRS_DEV
=
YES
 ;;

268 --
ç¡
-
dev
è
SRS_FAST_DEV
=
YES
 ;;

269 --
demo
è
SRS_DEMO
=
YES
 ;;

270 --
ç¡
è
SRS_FAST
=
YES
 ;;

271 --
di§bË
-
®l
è
SRS_DISABLE_ALL
=
YES
 ;;

272 --
pu»
-
¹mp
è
SRS_PURE_RTMP
=
YES
 ;;

273 --
¹mp
-
hls
è
SRS_RTMP_HLS
=
YES
 ;;

274 --
fuÎ
è
SRS_ENABLE_ALL
=
YES
 ;;

276 --
u£
-
sys
-
s¦
è
SRS_USE_SYS_SSL
=
YES
 ;;

277 --
memÜy
-
w©ch
è
SRS_MEM_WATCH
=
YES
 ;;

278 --
expÜt
-
lib¹mp
-
´ojeù
è
SRS_EXPORT_LIBRTMP_PROJECT
=
$
{
v®ue
} ;;

279 --
expÜt
-
lib¹mp
-
sšgË
è
SRS_EXPORT_LIBRTMP_SINGLE
=
$
{
v®ue
} ;;

282 
echo
 "$0:ƒrror: invalid option \"$option\""

283 
ex™
 1

285 
e§c


286 
	}
}

288 
funùiÚ
 
	$·r£_u£r_İtiÚ_to_v®ue_ªd_İtiÚ
() {

289 "$İtiÚ" 
š


291 
v®ue
=`
echo
 "$İtiÚ" | 
£d
 -
e
 's|[-_a-zA-Z0-9/]*=||'`

292 
İtiÚ
=`
echo
 "$İtiÚ" | 
£d
 -
e
 's|=[-_a-zA-Z0-9/.]*||'`

294 *è
v®ue
="" ;;

295 
e§c


296 
	}
}

298 #####################################################################################
#·r£ 
´e£t
 
İtiÚs


299 #####################################################################################
=

301 
İtiÚ


303 
	gİt
="$opt `echo $option | sed -e \"s/\(--[^=]*=\)\(.* .*\)/\1'\2'/\"`"

304 
·r£_u£r_İtiÚ_to_v®ue_ªd_İtiÚ


305 
·r£_u£r_İtiÚ


306 
dÚe


308 [ 
$h–p
 = 
yes
 ]; 
th’


309 
show_h–p


310 
	gex™
 0

311 
fi


313 
funùiÚ
 
	$­¶y_u£r_´e£ts
() {

314 #®way 
£t
 
the
 
log
 
Ëv–
 
®l
 
´e£ts
.

315 
SRS_LOG_VERBOSE
=
NO


316 
SRS_LOG_INFO
=
NO


317 
SRS_LOG_TRACE
=
YES


319 #£ˆ 
´e£t
 
nÙ
 
¥ecif›s


320 [ 
$SRS_RTMP_HLS
 = 
NO
 ]; 
th’


321 [ 
$SRS_PURE_RTMP
 = 
NO
 ]; 
th’


322 [ 
$SRS_FAST
 = 
NO
 ]; 
th’


323 [ 
$SRS_DISABLE_ALL
 = 
NO
 ]; 
th’


324 [ 
$SRS_ENABLE_ALL
 = 
NO
 ]; 
th’


325 [ 
$SRS_DEV
 = 
NO
 ]; 
th’


326 [ 
$SRS_FAST_DEV
 = 
NO
 ]; 
th’


327 [ 
$SRS_DEMO
 = 
NO
 ]; 
th’


328 [ 
$SRS_ARM_UBUNTU12
 = 
NO
 ]; 
th’


329 [ 
$SRS_MIPS_UBUNTU12
 = 
NO
 ]; 
th’


330 [ 
$SRS_PI
 = 
NO
 ]; 
th’


331 [ 
$SRS_CUBIE
 = 
NO
 ]; 
th’


332 [ 
$SRS_X86_X64
 = 
NO
 ]; 
th’


333 [ 
$SRS_OSX
 = 
NO
 ]; 
th’


334 
SRS_X86_X64
=
YES
; 
İt
="--x86-x64 $opt";

335 
fi


336 
fi


337 
fi


338 
fi


339 
fi


340 
fi


341 
fi


342 
fi


343 
fi


344 
fi


345 
fi


346 
fi


347 
fi


348 
fi


350 #wh‘h” 
embeded
 
ıu
.

351 [ 
$SRS_ARM_UBUNTU12
 = 
YES
 ]; 
th’


352 
SRS_CROSS_BUILD
=
YES


353 
fi


354 [ 
$SRS_MIPS_UBUNTU12
 = 
YES
 ]; 
th’


355 
SRS_CROSS_BUILD
=
YES


356 
fi


358 #®È
di§bËd
.

359 [ 
$SRS_DISABLE_ALL
 = 
YES
 ]; 
th’


360 
SRS_HLS
=
NO


361 
SRS_HDS
=
NO


362 
SRS_DVR
=
NO


363 
SRS_NGINX
=
NO


364 
SRS_SSL
=
NO


365 
SRS_FFMPEG_TOOL
=
NO


366 
SRS_TRANSCODE
=
NO


367 
SRS_INGEST
=
NO


368 
SRS_STAT
=
NO


369 
SRS_HTTP_CORE
=
NO


370 
SRS_HTTP_CALLBACK
=
NO


371 
SRS_HTTP_SERVER
=
NO


372 
SRS_STREAM_CASTER
=
NO


373 
SRS_HTTP_API
=
NO


374 
SRS_LIBRTMP
=
NO


375 
SRS_RESEARCH
=
NO


376 
SRS_UTEST
=
NO


377 
SRS_GPERF
=
NO


378 
SRS_GPERF_MC
=
NO


379 
SRS_GPERF_MP
=
NO


380 
SRS_GPERF_CP
=
NO


381 
SRS_GPROF
=
NO


382 
SRS_STATIC
=
NO


383 
fi


385 #®È
’abËd
.

386 [ 
$SRS_ENABLE_ALL
 = 
YES
 ]; 
th’


387 
SRS_HLS
=
YES


388 
SRS_HDS
=
YES


389 
SRS_DVR
=
YES


390 
SRS_NGINX
=
YES


391 
SRS_SSL
=
YES


392 
SRS_FFMPEG_TOOL
=
YES


393 
SRS_TRANSCODE
=
YES


394 
SRS_INGEST
=
YES


395 
SRS_STAT
=
YES


396 
SRS_HTTP_CORE
=
YES


397 
SRS_HTTP_CALLBACK
=
YES


398 
SRS_HTTP_SERVER
=
YES


399 
SRS_STREAM_CASTER
=
YES


400 
SRS_HTTP_API
=
YES


401 
SRS_LIBRTMP
=
YES


402 
SRS_RESEARCH
=
YES


403 
SRS_UTEST
=
YES


404 
SRS_GPERF
=
NO


405 
SRS_GPERF_MC
=
NO


406 
SRS_GPERF_MP
=
NO


407 
SRS_GPERF_CP
=
NO


408 
SRS_GPROF
=
NO


409 
SRS_STATIC
=
NO


410 
fi


412 #Úly 
¹mp
 
vp6


413 [ 
$SRS_FAST
 = 
YES
 ]; 
th’


414 
SRS_HLS
=
NO


415 
SRS_HDS
=
NO


416 
SRS_DVR
=
NO


417 
SRS_NGINX
=
NO


418 
SRS_SSL
=
NO


419 
SRS_FFMPEG_TOOL
=
NO


420 
SRS_TRANSCODE
=
NO


421 
SRS_INGEST
=
NO


422 
SRS_STAT
=
NO


423 
SRS_HTTP_CORE
=
NO


424 
SRS_HTTP_CALLBACK
=
NO


425 
SRS_HTTP_SERVER
=
NO


426 
SRS_STREAM_CASTER
=
NO


427 
SRS_HTTP_API
=
NO


428 
SRS_LIBRTMP
=
NO


429 
SRS_RESEARCH
=
NO


430 
SRS_UTEST
=
NO


431 
SRS_GPERF
=
NO


432 
SRS_GPERF_MC
=
NO


433 
SRS_GPERF_MP
=
NO


434 
SRS_GPERF_CP
=
NO


435 
SRS_GPROF
=
NO


436 
SRS_STATIC
=
NO


437 
fi


439 #®È
di§bËd
.

440 [ 
$SRS_RTMP_HLS
 = 
YES
 ]; 
th’


441 
SRS_HLS
=
YES


442 
SRS_HDS
=
YES


443 
SRS_DVR
=
NO


444 
SRS_NGINX
=
NO


445 
SRS_SSL
=
YES


446 
SRS_FFMPEG_TOOL
=
NO


447 
SRS_TRANSCODE
=
NO


448 
SRS_INGEST
=
NO


449 
SRS_STAT
=
NO


450 
SRS_HTTP_CORE
=
NO


451 
SRS_HTTP_CALLBACK
=
NO


452 
SRS_HTTP_SERVER
=
NO


453 
SRS_STREAM_CASTER
=
NO


454 
SRS_HTTP_API
=
NO


455 
SRS_LIBRTMP
=
NO


456 
SRS_RESEARCH
=
NO


457 
SRS_UTEST
=
NO


458 
SRS_GPERF
=
NO


459 
SRS_GPERF_MC
=
NO


460 
SRS_GPERF_MP
=
NO


461 
SRS_GPERF_CP
=
NO


462 
SRS_GPROF
=
NO


463 
SRS_STATIC
=
NO


464 
fi


466 #Úly 
s¦
 
RTMP
 
w™h
 
com¶ex
 
hªdshake
.

467 [ 
$SRS_PURE_RTMP
 = 
YES
 ]; 
th’


468 
SRS_HLS
=
NO


469 
SRS_HDS
=
NO


470 
SRS_DVR
=
NO


471 
SRS_NGINX
=
NO


472 
SRS_SSL
=
YES


473 
SRS_FFMPEG_TOOL
=
NO


474 
SRS_TRANSCODE
=
NO


475 
SRS_INGEST
=
NO


476 
SRS_STAT
=
NO


477 
SRS_HTTP_CORE
=
NO


478 
SRS_HTTP_CALLBACK
=
NO


479 
SRS_HTTP_SERVER
=
NO


480 
SRS_STREAM_CASTER
=
NO


481 
SRS_HTTP_API
=
NO


482 
SRS_LIBRTMP
=
NO


483 
SRS_RESEARCH
=
NO


484 
SRS_UTEST
=
NO


485 
SRS_GPERF
=
NO


486 
SRS_GPERF_MC
=
NO


487 
SRS_GPERF_MP
=
NO


488 
SRS_GPERF_CP
=
NO


489 
SRS_GPROF
=
NO


490 
SRS_STATIC
=
NO


491 
fi


493 #ià
¬m
 
¥ecif›d
, 
£t
 
some
  
to
 
di§bËd
.

494 [ 
$SRS_ARM_UBUNTU12
 = 
YES
 ]; 
th’


495 
SRS_HLS
=
YES


496 
SRS_HDS
=
YES


497 
SRS_DVR
=
YES


498 
SRS_NGINX
=
NO


499 
SRS_SSL
=
YES


500 
SRS_FFMPEG_TOOL
=
NO


501 
SRS_TRANSCODE
=
YES


502 
SRS_INGEST
=
YES


503 
SRS_STAT
=
YES


504 
SRS_HTTP_CORE
=
YES


505 
SRS_HTTP_CALLBACK
=
YES


506 
SRS_HTTP_SERVER
=
YES


507 
SRS_STREAM_CASTER
=
NO


508 
SRS_HTTP_API
=
YES


509 
SRS_LIBRTMP
=
YES


510 
SRS_RESEARCH
=
NO


511 
SRS_UTEST
=
NO


512 
SRS_GPERF
=
NO


513 
SRS_GPERF_MC
=
NO


514 
SRS_GPERF_MP
=
NO


515 
SRS_GPERF_CP
=
NO


516 
SRS_GPROF
=
NO


517 #TODO: 
FIXME
: 
Ãed
 ? 
maybe
 
dÚÙ
.

518 
SRS_STATIC
=
YES


519 
fi


521 #ià
ms
 
¥ecif›d
, 
£t
 
some
  
to
 
di§bËd
.

522 [ 
$SRS_MIPS_UBUNTU12
 = 
YES
 ]; 
th’


523 
SRS_HLS
=
YES


524 
SRS_HDS
=
YES


525 
SRS_DVR
=
YES


526 
SRS_NGINX
=
NO


527 
SRS_SSL
=
YES


528 
SRS_FFMPEG_TOOL
=
NO


529 
SRS_TRANSCODE
=
YES


530 
SRS_INGEST
=
YES


531 
SRS_STAT
=
YES


532 
SRS_HTTP_CORE
=
YES


533 
SRS_HTTP_CALLBACK
=
YES


534 
SRS_HTTP_SERVER
=
YES


535 
SRS_STREAM_CASTER
=
NO


536 
SRS_HTTP_API
=
YES


537 
SRS_LIBRTMP
=
YES


538 
SRS_RESEARCH
=
NO


539 
SRS_UTEST
=
NO


540 
SRS_GPERF
=
NO


541 
SRS_GPERF_MC
=
NO


542 
SRS_GPERF_MP
=
NO


543 
SRS_GPERF_CP
=
NO


544 
SRS_GPROF
=
NO


545 
SRS_STATIC
=
NO


546 
fi


548 #deçuÉ 
x86
/
x64


549 [ 
$SRS_X86_X64
 = 
YES
 ]; 
th’


550 
SRS_HLS
=
YES


551 
SRS_HDS
=
YES


552 
SRS_DVR
=
YES


553 
SRS_NGINX
=
NO


554 
SRS_SSL
=
YES


555 
SRS_FFMPEG_TOOL
=
NO


556 
SRS_TRANSCODE
=
YES


557 
SRS_INGEST
=
YES


558 
SRS_STAT
=
YES


559 
SRS_HTTP_CORE
=
YES


560 
SRS_HTTP_CALLBACK
=
YES


561 
SRS_HTTP_SERVER
=
YES


562 
SRS_STREAM_CASTER
=
NO


563 
SRS_HTTP_API
=
YES


564 
SRS_LIBRTMP
=
YES


565 
SRS_RESEARCH
=
NO


566 
SRS_UTEST
=
YES


567 
SRS_GPERF
=
NO


568 
SRS_GPERF_MC
=
NO


569 
SRS_GPERF_MP
=
NO


570 
SRS_GPERF_CP
=
NO


571 
SRS_GPROF
=
NO


572 
SRS_STATIC
=
NO


573 
fi


575 #fÜ 
	`osx
(
d¬wš
)

576 [ 
$SRS_OSX
 = 
YES
 ]; 
th’


577 
SRS_HLS
=
YES


578 
SRS_HDS
=
YES


579 
SRS_DVR
=
YES


580 
SRS_NGINX
=
NO


581 
SRS_SSL
=
YES


582 
SRS_FFMPEG_TOOL
=
NO


583 
SRS_TRANSCODE
=
YES


584 
SRS_INGEST
=
YES


585 
SRS_STAT
=
YES


586 
SRS_HTTP_CORE
=
YES


587 
SRS_HTTP_CALLBACK
=
YES


588 
SRS_HTTP_SERVER
=
YES


589 
SRS_STREAM_CASTER
=
NO


590 
SRS_HTTP_API
=
YES


591 
SRS_LIBRTMP
=
YES


592 
SRS_RESEARCH
=
NO


593 
SRS_UTEST
=
NO


594 
SRS_GPERF
=
NO


595 
SRS_GPERF_MC
=
NO


596 
SRS_GPERF_MP
=
NO


597 
SRS_GPERF_CP
=
NO


598 
SRS_GPROF
=
NO


599 
SRS_STATIC
=
NO


600 
fi


602 #ià
dev
 
¥ecif›d
, 
İ’
 
ã©u»s
 
possibË
.

603 [ 
$SRS_DEV
 = 
YES
 ]; 
th’


604 
SRS_HLS
=
YES


605 
SRS_HDS
=
YES


606 
SRS_DVR
=
YES


607 
SRS_NGINX
=
NO


608 
SRS_SSL
=
YES


609 
SRS_FFMPEG_TOOL
=
YES


610 
SRS_TRANSCODE
=
YES


611 
SRS_INGEST
=
YES


612 
SRS_STAT
=
YES


613 
SRS_HTTP_CORE
=
YES


614 
SRS_HTTP_CALLBACK
=
YES


615 
SRS_HTTP_SERVER
=
YES


616 
SRS_STREAM_CASTER
=
NO


617 
SRS_HTTP_API
=
YES


618 
SRS_LIBRTMP
=
YES


619 
SRS_RESEARCH
=
YES


620 
SRS_UTEST
=
YES


621 
SRS_GPERF
=
NO


622 
SRS_GPERF_MC
=
NO


623 
SRS_GPERF_MP
=
NO


624 
SRS_GPERF_CP
=
NO


625 
SRS_GPROF
=
NO


626 
SRS_STATIC
=
NO


627 
fi


629 #ià
ç¡
 
dev
 
¥ecif›d
, 
İ’
 
maš
 
£rv”
 
ã©u»s
.

630 [ 
$SRS_FAST_DEV
 = 
YES
 ]; 
th’


631 
SRS_HLS
=
YES


632 
SRS_HDS
=
YES


633 
SRS_DVR
=
YES


634 
SRS_NGINX
=
NO


635 
SRS_SSL
=
YES


636 
SRS_FFMPEG_TOOL
=
NO


637 
SRS_TRANSCODE
=
YES


638 
SRS_INGEST
=
YES


639 
SRS_STAT
=
YES


640 
SRS_HTTP_CORE
=
YES


641 
SRS_HTTP_CALLBACK
=
YES


642 
SRS_HTTP_SERVER
=
YES


643 
SRS_STREAM_CASTER
=
NO


644 
SRS_HTTP_API
=
YES


645 
SRS_LIBRTMP
=
NO


646 
SRS_RESEARCH
=
NO


647 
SRS_UTEST
=
NO


648 
SRS_GPERF
=
NO


649 
SRS_GPERF_MC
=
NO


650 
SRS_GPERF_MP
=
NO


651 
SRS_GPERF_CP
=
NO


652 
SRS_GPROF
=
NO


653 
SRS_STATIC
=
NO


654 
fi


656 #fÜ 
¤s
 
demo


657 [ 
$SRS_DEMO
 = 
YES
 ]; 
th’


658 
SRS_HLS
=
YES


659 
SRS_HDS
=
YES


660 
SRS_DVR
=
YES


661 
SRS_NGINX
=
NO


662 
SRS_SSL
=
YES


663 
SRS_FFMPEG_TOOL
=
YES


664 
SRS_TRANSCODE
=
YES


665 
SRS_INGEST
=
YES


666 
SRS_STAT
=
YES


667 
SRS_HTTP_CORE
=
YES


668 
SRS_HTTP_CALLBACK
=
YES


669 
SRS_HTTP_SERVER
=
YES


670 
SRS_STREAM_CASTER
=
NO


671 
SRS_HTTP_API
=
YES


672 
SRS_LIBRTMP
=
YES


673 
SRS_RESEARCH
=
NO


674 
SRS_UTEST
=
YES


675 
SRS_GPERF
=
NO


676 
SRS_GPERF_MC
=
NO


677 
SRS_GPERF_MP
=
NO


678 
SRS_GPERF_CP
=
NO


679 
SRS_GPROF
=
NO


680 
SRS_STATIC
=
NO


681 
fi


683 #ià
¿¥b”ry
-
pi
 
¥ecif›d
, 
İ’
 
s¦
/
hls
/
ã©u»s


684 [ 
$SRS_PI
 = 
YES
 ]; 
th’


685 
SRS_HLS
=
YES


686 
SRS_HDS
=
YES


687 
SRS_DVR
=
YES


688 
SRS_NGINX
=
NO


689 
SRS_SSL
=
YES


690 
SRS_FFMPEG_TOOL
=
NO


691 
SRS_TRANSCODE
=
YES


692 
SRS_INGEST
=
YES


693 
SRS_STAT
=
YES


694 
SRS_HTTP_CORE
=
YES


695 
SRS_HTTP_CALLBACK
=
YES


696 
SRS_HTTP_SERVER
=
YES


697 
SRS_STREAM_CASTER
=
NO


698 
SRS_HTTP_API
=
YES


699 
SRS_LIBRTMP
=
YES


700 
SRS_RESEARCH
=
NO


701 
SRS_UTEST
=
NO


702 
SRS_GPERF
=
NO


703 
SRS_GPERF_MC
=
NO


704 
SRS_GPERF_MP
=
NO


705 
SRS_GPERF_CP
=
NO


706 
SRS_GPROF
=
NO


707 
SRS_STATIC
=
NO


708 
fi


710 #ià
cub›bßrd
 
¥ecif›d
, 
İ’
 
ã©u»s
 
exû±
 
ffm³g
/
ngšx
.

711 [ 
$SRS_CUBIE
 = 
YES
 ]; 
th’


712 
SRS_HLS
=
YES


713 
SRS_HDS
=
YES


714 
SRS_DVR
=
YES


715 
SRS_NGINX
=
NO


716 
SRS_SSL
=
YES


717 
SRS_FFMPEG_TOOL
=
YES


718 
SRS_TRANSCODE
=
YES


719 
SRS_INGEST
=
YES


720 
SRS_STAT
=
YES


721 
SRS_HTTP_CORE
=
YES


722 
SRS_HTTP_CALLBACK
=
YES


723 
SRS_HTTP_SERVER
=
YES


724 
SRS_STREAM_CASTER
=
NO


725 
SRS_HTTP_API
=
YES


726 
SRS_LIBRTMP
=
YES


727 
SRS_RESEARCH
=
NO


728 
SRS_UTEST
=
NO


729 
SRS_GPERF
=
NO


730 
SRS_GPERF_MC
=
NO


731 
SRS_GPERF_MP
=
NO


732 
SRS_GPERF_CP
=
NO


733 
SRS_GPROF
=
NO


734 
SRS_STATIC
=
NO


735 
fi


736 
	}
}

737 
	g­¶y_u£r_´e£ts


739 #####################################################################################
#·r£ 
d‘a
 
ã©u»
 
İtiÚs


740 #####################################################################################

İtiÚ


742 
·r£_u£r_İtiÚ_to_v®ue_ªd_İtiÚ


743 
·r£_u£r_İtiÚ


744 
dÚe


746 
funùiÚ
 
	$­¶y_u£r_d‘a_İtiÚs
() {

747 #ià
Œªscode
/
šge¡
 
¥ecif›d
, 
»quœes
 
the
 
ffm³g
 
¡ub
 
şas£s
.

748 
SRS_FFMPEG_STUB
=
NO


749 [ 
$SRS_TRANSCODE
 = 
YES
 ]; 
th’
 
SRS_FFMPEG_STUB
=YES; 
fi


750 [ 
$SRS_INGEST
 = 
YES
 ]; 
th’
 
SRS_FFMPEG_STUB
=YES; 
fi


752 #ià
h‰p
-
xxxx
 
¥ecif›d
, 
İ’
 
the
 
SRS_HTTP_CORE


753 
SRS_HTTP_CORE
=
NO


754 [ 
$SRS_HTTP_CALLBACK
 = 
YES
 ]; 
th’
 
SRS_HTTP_CORE
=YES; 
fi


755 [ 
$SRS_HTTP_SERVER
 = 
YES
 ]; 
th’
 
SRS_HTTP_CORE
=YES; 
fi


756 [ 
$SRS_HTTP_API
 = 
YES
 ]; 
th’
 
SRS_HTTP_CORE
=YES; 
fi


758 #·r£ 
the
 
jobs
 
make


759 [[ "" -
eq
 
SRS_JOBS
 ]]; 
th’


760 
expÜt
 
SRS_JOBS
="--jobs=1"

762 
expÜt
 
SRS_JOBS
="--jobs=${SRS_JOBS}"

763 
fi


765 #ià
¥ecif›d
 
expÜt
 
sšgË
 
fe
,ƒxpÜˆ
´ojeù
 
fœ¡
.

766 [ 
$SRS_EXPORT_LIBRTMP_SINGLE
 !ğ
NO
 ]; 
th’


767 
SRS_EXPORT_LIBRTMP_PROJECT
=
$SRS_EXPORT_LIBRTMP_SINGLE


768 
fi


770 #di§bË 
®mo¡
 
®l
 
ã©u»s
 
expÜt
 
¤s
-
lib¹mp
.

771 [ 
$SRS_EXPORT_LIBRTMP_PROJECT
 !ğ
NO
 ]; 
th’


772 
SRS_HLS
=
NO


773 
SRS_HDS
=
NO


774 
SRS_DVR
=
NO


775 
SRS_NGINX
=
NO


776 
SRS_SSL
=
NO


777 
SRS_FFMPEG_TOOL
=
NO


778 
SRS_TRANSCODE
=
NO


779 
SRS_INGEST
=
NO


780 
SRS_STAT
=
NO


781 
SRS_HTTP_CORE
=
NO


782 
SRS_HTTP_CALLBACK
=
NO


783 
SRS_HTTP_SERVER
=
NO


784 
SRS_STREAM_CASTER
=
NO


785 
SRS_HTTP_API
=
NO


786 
SRS_LIBRTMP
=
YES


787 
SRS_RESEARCH
=
YES


788 
SRS_UTEST
=
NO


789 
SRS_GPERF
=
NO


790 
SRS_GPERF_MC
=
NO


791 
SRS_GPERF_MP
=
NO


792 
SRS_GPERF_CP
=
NO


793 
SRS_GPROF
=
NO


794 
SRS_STATIC
=
NO


795 
fi


796 
	}
}

797 
­¶y_u£r_d‘a_İtiÚs


799 
funùiÚ
 
	$»g’”©e_İtiÚs
() {

800 #§v
®l
 
cÚfig
 
İtiÚs
 
to
 
maüo
Ø
wr™e
ØautØ
h—d”s
 
fe


801 
SRS_AUTO_USER_CONFIGURE
="$opt"

802 #»g’”©
the
 
İtiÚs
  
v®ues
.

803 
SRS_AUTO_CONFIGURE
="--prefix=${SRS_PREFIX}"

804 [ 
$SRS_HLS
 = 
YES
 ]; 
th’
 
SRS_AUTO_CONFIGURE
="${SRS_AUTO_CONFIGURE} --w™h-hls"; SRS_AUTO_CONFIGURE="${SRS_AUTO_CONFIGURE} --w™hout-hls"; 
fi


805 [ 
$SRS_HDS
 = 
YES
 ]; 
th’
 
SRS_AUTO_CONFIGURE
="${SRS_AUTO_CONFIGURE} --w™h-hds"; SRS_AUTO_CONFIGURE="${SRS_AUTO_CONFIGURE} --w™hout-hds"; 
fi


806 [ 
$SRS_DVR
 = 
YES
 ]; 
th’
 
SRS_AUTO_CONFIGURE
="${SRS_AUTO_CONFIGURE} --w™h-dvr"; SRS_AUTO_CONFIGURE="${SRS_AUTO_CONFIGURE} --w™hout-dvr"; 
fi


807 [ 
$SRS_NGINX
 = 
YES
 ]; 
th’
 
SRS_AUTO_CONFIGURE
="${SRS_AUTO_CONFIGURE} --w™h-ngšx"; SRS_AUTO_CONFIGURE="${SRS_AUTO_CONFIGURE} --w™hout-ngšx"; 
fi


808 [ 
$SRS_SSL
 = 
YES
 ]; 
th’
 
SRS_AUTO_CONFIGURE
="${SRS_AUTO_CONFIGURE} --w™h-s¦"; SRS_AUTO_CONFIGURE="${SRS_AUTO_CONFIGURE} --w™hout-s¦"; 
fi


809 [ 
$SRS_FFMPEG_TOOL
 = 
YES
 ]; 
th’
 
SRS_AUTO_CONFIGURE
="${SRS_AUTO_CONFIGURE} --w™h-ffm³g"; SRS_AUTO_CONFIGURE="${SRS_AUTO_CONFIGURE} --w™hout-ffm³g"; 
fi


810 [ 
$SRS_TRANSCODE
 = 
YES
 ]; 
th’
 
SRS_AUTO_CONFIGURE
="${SRS_AUTO_CONFIGURE} --w™h-Œªscode"; SRS_AUTO_CONFIGURE="${SRS_AUTO_CONFIGURE} --w™hout-Œªscode"; 
fi


811 [ 
$SRS_INGEST
 = 
YES
 ]; 
th’
 
SRS_AUTO_CONFIGURE
="${SRS_AUTO_CONFIGURE} --w™h-šge¡"; SRS_AUTO_CONFIGURE="${SRS_AUTO_CONFIGURE} --w™hout-šge¡"; 
fi


812 [ 
$SRS_STAT
 = 
YES
 ]; 
th’
 
SRS_AUTO_CONFIGURE
="${SRS_AUTO_CONFIGURE} --w™h-¡©"; SRS_AUTO_CONFIGURE="${SRS_AUTO_CONFIGURE} --w™hout-¡©"; 
fi


813 [ 
$SRS_HTTP_CALLBACK
 = 
YES
 ]; 
th’
 
SRS_AUTO_CONFIGURE
="${SRS_AUTO_CONFIGURE} --w™h-h‰p-ÿÎback"; SRS_AUTO_CONFIGURE="${SRS_AUTO_CONFIGURE} --w™hout-h‰p-ÿÎback"; 
fi


814 [ 
$SRS_HTTP_SERVER
 = 
YES
 ]; 
th’
 
SRS_AUTO_CONFIGURE
="${SRS_AUTO_CONFIGURE} --w™h-h‰p-£rv”"; SRS_AUTO_CONFIGURE="${SRS_AUTO_CONFIGURE} --w™hout-h‰p-£rv”"; 
fi


815 [ 
$SRS_STREAM_CASTER
 = 
YES
 ]; 
th’
 
SRS_AUTO_CONFIGURE
="${SRS_AUTO_CONFIGURE} --w™h-¡»am-ÿ¡”"; SRS_AUTO_CONFIGURE="${SRS_AUTO_CONFIGURE} --w™hout-¡»am-ÿ¡”"; 
fi


816 [ 
$SRS_HTTP_API
 = 
YES
 ]; 
th’
 
SRS_AUTO_CONFIGURE
="${SRS_AUTO_CONFIGURE} --w™h-h‰p-­i"; SRS_AUTO_CONFIGURE="${SRS_AUTO_CONFIGURE} --w™hout-h‰p-­i"; 
fi


817 [ 
$SRS_LIBRTMP
 = 
YES
 ]; 
th’
 
SRS_AUTO_CONFIGURE
="${SRS_AUTO_CONFIGURE} --w™h-lib¹mp"; SRS_AUTO_CONFIGURE="${SRS_AUTO_CONFIGURE} --w™hout-lib¹mp"; 
fi


818 [ 
$SRS_RESEARCH
 = 
YES
 ]; 
th’
 
SRS_AUTO_CONFIGURE
="${SRS_AUTO_CONFIGURE} --w™h-»£¬ch"; SRS_AUTO_CONFIGURE="${SRS_AUTO_CONFIGURE} --w™hout-»£¬ch"; 
fi


819 [ 
$SRS_UTEST
 = 
YES
 ]; 
th’
 
SRS_AUTO_CONFIGURE
="${SRS_AUTO_CONFIGURE} --w™h-u‹¡"; SRS_AUTO_CONFIGURE="${SRS_AUTO_CONFIGURE} --w™hout-u‹¡"; 
fi


820 [ 
$SRS_GPERF
 = 
YES
 ]; 
th’
 
SRS_AUTO_CONFIGURE
="${SRS_AUTO_CONFIGURE} --w™h-g³rf"; SRS_AUTO_CONFIGURE="${SRS_AUTO_CONFIGURE} --w™hout-g³rf"; 
fi


821 [ 
$SRS_GPERF_MC
 = 
YES
 ]; 
th’
 
SRS_AUTO_CONFIGURE
="${SRS_AUTO_CONFIGURE} --w™h-gmc"; SRS_AUTO_CONFIGURE="${SRS_AUTO_CONFIGURE} --w™hout-gmc"; 
fi


822 [ 
$SRS_GPERF_MP
 = 
YES
 ]; 
th’
 
SRS_AUTO_CONFIGURE
="${SRS_AUTO_CONFIGURE} --w™h-gmp"; SRS_AUTO_CONFIGURE="${SRS_AUTO_CONFIGURE} --w™hout-gmp"; 
fi


823 [ 
$SRS_GPERF_CP
 = 
YES
 ]; 
th’
 
SRS_AUTO_CONFIGURE
="${SRS_AUTO_CONFIGURE} --w™h-gı"; SRS_AUTO_CONFIGURE="${SRS_AUTO_CONFIGURE} --w™hout-gı"; 
fi


824 [ 
$SRS_GPROF
 = 
YES
 ]; 
th’
 
SRS_AUTO_CONFIGURE
="${SRS_AUTO_CONFIGURE} --w™h-g´of"; SRS_AUTO_CONFIGURE="${SRS_AUTO_CONFIGURE} --w™hout-g´of"; 
fi


825 [ 
$SRS_ARM_UBUNTU12
 = 
YES
 ]; 
th’
 
SRS_AUTO_CONFIGURE
="${SRS_AUTO_CONFIGURE} --w™h-¬m-ubuÁu12"; SRS_AUTO_CONFIGURE="${SRS_AUTO_CONFIGURE} --w™hout-¬m-ubuÁu12"; 
fi


826 [ 
$SRS_MIPS_UBUNTU12
 = 
YES
 ]; 
th’
 
SRS_AUTO_CONFIGURE
="${SRS_AUTO_CONFIGURE} --w™h-ms-ubuÁu12"; SRS_AUTO_CONFIGURE="${SRS_AUTO_CONFIGURE} --w™hout-ms-ubuÁu12"; 
fi


827 [ 
$SRS_STATIC
 = 
YES
 ]; 
th’
 
SRS_AUTO_CONFIGURE
="${SRS_AUTO_CONFIGURE} --¡©ic"; 
fi


828 [ 
$SRS_LOG_VERBOSE
 = 
YES
 ]; 
th’
 
SRS_AUTO_CONFIGURE
="${SRS_AUTO_CONFIGURE} --log-v”bo£"; 
fi


829 [ 
$SRS_LOG_INFO
 = 
YES
 ]; 
th’
 
SRS_AUTO_CONFIGURE
="${SRS_AUTO_CONFIGURE} --log-šfo"; 
fi


830 [ 
$SRS_LOG_TRACE
 = 
YES
 ]; 
th’
 
SRS_AUTO_CONFIGURE
="${SRS_AUTO_CONFIGURE} --log-Œaû"; 
fi


831 
echo
 "regenerate config: ${SRS_AUTO_CONFIGURE}"

832 
	}
}

833 
	g»g’”©e_İtiÚs


835 #####################################################################################
#check 
u£r
 
İtiÚs


836 #####################################################################################
 check_İtiÚ_cÚæiùs(è{

837 
	g__check_ok
=
YES


838 #check 
cÚæiù


839 [ 
$SRS_GPERF
 = 
NO
 ]; 
th’


840 [ 
$SRS_GPERF_MC
 = 
YES
 ]; 
th’
 
	gecho
 "g³rf-mød•’d Ú g³rf, s“: ./cÚfigu» --h–p"; 
	g__check_ok
=
NO
; 
fi


841 [ 
$SRS_GPERF_MP
 = 
YES
 ]; 
th’
 
	gecho
 "g³rf-m°d•’d Ú g³rf, s“: ./cÚfigu» --h–p"; 
	g__check_ok
=
NO
; 
fi


842 [ 
$SRS_GPERF_CP
 = 
YES
 ]; 
th’
 
	gecho
 "g³rf-ı d•’d Ú g³rf, s“: ./cÚfigu» --h–p"; 
	g__check_ok
=
NO
; 
fi


843 
fi


844 [[ 
$SRS_GPERF_MC
 = 
YES
 && 
$SRS_GPERF_MP
 = YES ]]; 
th’


845 
	gecho
 "gperf-mc‚ot compatible with gperf-mp, see: ./configure --help";

846 
	gecho
 "@see: http://google-perftools.googlecode.com/svn/trunk/doc/heap_checker.html";

847 
	gecho
 "Notehat sincehe heap-checker useshe heap-profiling framework internally, it is‚ot…ossibleo„un bothhe heap-checker‡nd heap…rofiler‡the sameime";

848 
	g__check_ok
=
NO


849 
fi


850 [[ 
$SRS_HTTP_CORE
 = 
NO
 && 
$SRS_STREAM_CASTER
 = 
YES
 ]]; 
th’


851 
	gecho
 "¡»am-ÿ¡” d•’d Ú h‰p-­˜Ü h‰p-£rv”, s“: ./cÚfigu» --h–p"; 
	g__check_ok
=
NO
;

852 
	gfi


853 #g’”©
the
 
group
 
İtiÚ
: 
SRS_GPERF


854 
	g__g³rf_¦ow
=
NO


855 [ 
$SRS_GPERF_MC
 = 
YES
 ]; 
th’
 
	gSRS_GPERF
=YES; 
	g__g³rf_¦ow
=YES; 
fi


856 [ 
$SRS_GPERF_MP
 = 
YES
 ]; 
th’
 
	gSRS_GPERF
=YES; 
	g__g³rf_¦ow
=YES; 
fi


857 [ 
$SRS_GPERF_CP
 = 
YES
 ]; 
th’
 
	gSRS_GPERF
=YES; 
	g__g³rf_¦ow
=YES; 
fi


858 [ 
$__g³rf_¦ow
 = 
YES
 ]; 
th’
 [ 
$SRS_GPROF
 = YES ];hen

859 
	gecho
 "gmc/gmp/gı‚Ù com·tibË w™h g´of, s“: ./cÚfigu» --h–p"; 
	g__check_ok
=
NO
;

860 
fi
 
	gfi


862 #check 
embeded
(
¬m
/
ms
), embeded 
’abËd
, 
Úly
 
®low
 
¡
/
s¦
/
lib¹mp
,

863 #u£¸
should
 
di§bË
 
®l
 
Ùh”
 
ã©u»s


864 [ 
$SRS_CROSS_BUILD
 = 
YES
 ]; 
th’


865 [ 
$SRS_FFMPEG_TOOL
 = 
YES
 ]; 
th’
 
	gecho
 "ffm³g fÜ‡rm i nÙ‡vaabË, s“: ./cÚfigu» --h–p"; 
	g__check_ok
=
NO
; 
fi


866 [ 
$SRS_RESEARCH
 = 
YES
 ]; 
th’
 
	gecho
 "»£¬ch fÜ‡rm i nÙ‡vaabË, s“: ./cÚfigu» --h–p"; 
	g__check_ok
=
NO
; 
fi


867 [ 
$SRS_GPERF
 = 
YES
 ]; 
th’
 
	gecho
 "g³ràfÜ‡rm i nÙ‡vaabË, s“: ./cÚfigu» --h–p"; 
	g__check_ok
=
NO
; 
fi


868 [ 
$SRS_GPERF_MC
 = 
YES
 ]; 
th’
 
	gecho
 "gmøfÜ‡rm i nÙ‡vaabË, s“: ./cÚfigu» --h–p"; 
	g__check_ok
=
NO
; 
fi


869 [ 
$SRS_GPERF_MP
 = 
YES
 ]; 
th’
 
	gecho
 "gm°fÜ‡rm i nÙ‡vaabË, s“: ./cÚfigu» --h–p"; 
	g__check_ok
=
NO
; 
fi


870 [ 
$SRS_GPERF_CP
 = 
YES
 ]; 
th’
 
	gecho
 "gı fÜ‡rm i nÙ‡vaabË, s“: ./cÚfigu» --h–p"; 
	g__check_ok
=
NO
; 
fi


871 [ 
$SRS_GPROF
 = 
YES
 ]; 
th’
 
	gecho
 "g´oàfÜ‡rm i nÙ‡vaabË, s“: ./cÚfigu» --h–p"; 
	g__check_ok
=
NO
; 
fi


872 
	gfi


874 #ià
x86
/
x64
 
Ü
 
dœeùly
 
bud
, 
Ãv”
 
u£
 

875 [[ 
$SRS_X86_X64
 = 
YES
 && 
$SRS_STATIC
 = YES ]]; 
th’


876 
	gecho
 "x86/x64 should‚ev” u£ stic, s“: ./cÚfigu» --h–p"; 
	g__check_ok
=
NO
;

877 
	gfi


879 #TODO: 
FIXME
: 
check
 
mÜe
 
os
.

881 #check 
v¬ŸbË
 
Ãcûs§ry


882 [ 
$SRS_HLS
 = 
RESERVED
 ]; 
th’
 
	gecho
 "you mu¡ s³cif› thhls, s“: ./cÚfigu» --h–p"; 
	g__check_ok
=
NO
; 
fi


883 [ 
$SRS_HDS
 = 
RESERVED
 ]; 
th’
 
	gecho
 "you mu¡ s³cif› thhds, s“: ./cÚfigu» --h–p"; 
	g__check_ok
=
NO
; 
fi


884 [ 
$SRS_DVR
 = 
RESERVED
 ]; 
th’
 
	gecho
 "you mu¡ s³cif› thdvr, s“: ./cÚfigu» --h–p"; 
	g__check_ok
=
NO
; 
fi


885 [ 
$SRS_NGINX
 = 
RESERVED
 ]; 
th’
 
	gecho
 "you mu¡ s³cif› thngšx, s“: ./cÚfigu» --h–p"; 
	g__check_ok
=
NO
; 
fi


886 [ 
$SRS_SSL
 = 
RESERVED
 ]; 
th’
 
	gecho
 "you mu¡ s³cif› ths¦, s“: ./cÚfigu» --h–p"; 
	g__check_ok
=
NO
; 
fi


887 [ 
$SRS_FFMPEG_TOOL
 = 
RESERVED
 ]; 
th’
 
	gecho
 "you mu¡ s³cif› thffm³g, s“: ./cÚfigu» --h–p"; 
	g__check_ok
=
NO
; 
fi


888 [ 
$SRS_HTTP_CALLBACK
 = 
RESERVED
 ]; 
th’
 
	gecho
 "you mu¡ s³cif› thh‰p-ÿÎback, s“: ./cÚfigu» --h–p"; 
	g__check_ok
=
NO
; 
fi


889 [ 
$SRS_HTTP_SERVER
 = 
RESERVED
 ]; 
th’
 
	gecho
 "you mu¡ s³cif› thh‰p-£rv”, s“: ./cÚfigu» --h–p"; 
	g__check_ok
=
NO
; 
fi


890 [ 
$SRS_STREAM_CASTER
 = 
RESERVED
 ]; 
th’
 
	gecho
 "you mu¡ s³cif› th¡»am-ÿ¡”, s“: ./cÚfigu» --h–p"; 
	g__check_ok
=
NO
; 
fi


891 [ 
$SRS_HTTP_API
 = 
RESERVED
 ]; 
th’
 
	gecho
 "you mu¡ s³cif› thh‰p-­i, s“: ./cÚfigu» --h–p"; 
	g__check_ok
=
NO
; 
fi


892 [ 
$SRS_LIBRTMP
 = 
RESERVED
 ]; 
th’
 
	gecho
 "you mu¡ s³cif› thlib¹mp, s“: ./cÚfigu» --h–p"; 
	g__check_ok
=
NO
; 
fi


893 [ 
$SRS_RESEARCH
 = 
RESERVED
 ]; 
th’
 
	gecho
 "you mu¡ s³cif› th»£¬ch, s“: ./cÚfigu» --h–p"; 
	g__check_ok
=
NO
; 
fi


894 [ 
$SRS_UTEST
 = 
RESERVED
 ]; 
th’
 
	gecho
 "you mu¡ s³cif› thu‹¡, s“: ./cÚfigu» --h–p"; 
	g__check_ok
=
NO
; 
fi


895 [ 
$SRS_GPERF
 = 
RESERVED
 ]; 
th’
 
	gecho
 "you mu¡ s³cif› thg³rf, s“: ./cÚfigu» --h–p"; 
	g__check_ok
=
NO
; 
fi


896 [ 
$SRS_GPERF_MC
 = 
RESERVED
 ]; 
th’
 
	gecho
 "you mu¡ s³cif› thg³rf-mc, s“: ./cÚfigu» --h–p"; 
	g__check_ok
=
NO
; 
fi


897 [ 
$SRS_GPERF_MP
 = 
RESERVED
 ]; 
th’
 
	gecho
 "you mu¡ s³cif› thg³rf-mp, s“: ./cÚfigu» --h–p"; 
	g__check_ok
=
NO
; 
fi


898 [ 
$SRS_GPERF_CP
 = 
RESERVED
 ]; 
th’
 
	gecho
 "you mu¡ s³cif› thg³rf-ı, s“: ./cÚfigu» --h–p"; 
	g__check_ok
=
NO
; 
fi


899 [ 
$SRS_GPROF
 = 
RESERVED
 ]; 
th’
 
	gecho
 "you mu¡ s³cif› thg´of, s“: ./cÚfigu» --h–p"; 
	g__check_ok
=
NO
; 
fi


900 [ 
$SRS_ARM_UBUNTU12
 = 
RESERVED
 ]; 
th’
 
	gecho
 "you mu¡ s³cif› th¬m-ubuÁu12, s“: ./cÚfigu» --h–p"; 
	g__check_ok
=
NO
; 
fi


901 [ 
$SRS_MIPS_UBUNTU12
 = 
RESERVED
 ]; 
th’
 
	gecho
 "you mu¡ s³cif› thms-ubuÁu12, s“: ./cÚfigu» --h–p"; 
	g__check_ok
=
NO
; 
fi


902 [[ -
z
 
$SRS_PREFIX
 ]]; 
th’
 
	gecho
 "you mu¡ s³cif› th´efix, s“: ./cÚfigu» --´efix"; 
	g__check_ok
=
NO
; 
fi


903 [ 
$__check_ok
 = 
NO
 ]; 
th’


904 
	gex™
 1;

905 
	gfi


907 
	gcheck_İtiÚ_cÚæiùs


	@trunk/auto/setup_variables.sh

1 #!/
bš
/
bash


3 #wh’ 
İtiÚs
 
·r£d
, 
£tup
 
some
 
v¬ŸbËs
, 
th’
 
bud
 
the
 
d•’ds
.

5 #wh’ 
¬m
 
¥ecif›d
, 
£tup
 
the
 
üoss
 
bud
 
v¬ŸbËs
.

6 [ 
$SRS_ARM_UBUNTU12
 = 
YES
 ]; 
th’


7 
	g__SrsArmCC
="arm-linux-gnueabi-gcc";

8 
	g__SrsArmGCC
="arm-linux-gnueabi-gcc";

9 
	g__SrsArmCXX
="arm-linux-gnueabi-g++";

10 
	g__SrsArmAR
="arm-linux-gnueabi-ar";

11 
	g__SrsArmLD
="arm-linux-gnueabi-ld";

12 
	g__SrsArmRANDLIB
="arm-linux-gnueabi-ranlib";

13 
fi


15 [ 
$SRS_MIPS_UBUNTU12
 = 
YES
 ]; 
th’


16 
	g__SrsArmCC
="mipsel-openwrt-linux-gcc";

17 
	g__SrsArmGCC
="mipsel-openwrt-linux-gcc";

18 
	g__SrsArmCXX
="mipsel-openwrt-linux-g++";

19 
	g__SrsArmAR
="mipsel-openwrt-linux-ar";

20 
	g__SrsArmLD
="mipsel-openwrt-linux-ld";

21 
	g__SrsArmRANDLIB
="mipsel-openwrt-linux-ranlib";

22 
	gfi


24 #th
¬m
-
ubuÁu12
 
İtiÚs
 
make
 
d•’ds


25 [[ -
z
 
$SrsArmCC
 ]]; 
th’
 
	gSrsArmCC
=
$__SrsArmCC
; 
fi


26 [[ -
z
 
$SrsArmGCC
 ]]; 
th’
 
	gSrsArmGCC
=
$__SrsArmGCC
; 
fi


27 [[ -
z
 
$SrsArmCXX
 ]]; 
th’
 
	gSrsArmCXX
=
$__SrsArmCXX
; 
fi


28 [[ -
z
 
$SrsArmAR
 ]]; 
th’
 
	gSrsArmAR
=
$__SrsArmAR
; 
fi


29 [[ -
z
 
$SrsArmLD
 ]]; 
th’
 
	gSrsArmLD
=
$__SrsArmLD
; 
fi


30 [[ -
z
 
$SrsArmRANDLIB
 ]]; 
th’
 
	gSrsArmRANDLIB
=
$__SrsArmRANDLIB
; 
	gfi


	@trunk/auto/summary.sh

1 #!/
bš
/
bash


3 #cŞÜfuÈ
summ¬y


4 
	gSrsHlsSumm¬yCŞÜ
="\${YELLOW}{di§bËd} "; [ 
$SRS_HLS
 = 
YES
 ]; 
th’
 SrsHlsSumm¬yCŞÜ="\${GREEN}"; 
fi


5 
	gSrsDvrSumm¬yCŞÜ
="\${YELLOW}{di§bËd} "; [ 
$SRS_DVR
 = 
YES
 ]; 
th’
 SrsDvrSumm¬yCŞÜ="\${GREEN}"; 
fi


6 
	gSrsNgšxSumm¬yCŞÜ
="\${GREEN}{di§bËd} "; [ 
$SRS_NGINX
 = 
YES
 ]; 
th’
 SrsNgšxSumm¬yCŞÜ="\${GREEN}"; 
fi


7 
	gSrsS¦Summ¬yCŞÜ
="\${YELLOW}{di§bËd} "; [ 
$SRS_SSL
 = 
YES
 ]; 
th’
 SrsS¦Summ¬yCŞÜ="\${GREEN}"; 
fi


8 
	gSrsFfm³gSumm¬yCŞÜ
="\${YELLOW}{di§bËd} "; [ 
$SRS_FFMPEG_TOOL
 = 
YES
 ]; 
th’
 SrsFfm³gSumm¬yCŞÜ="\${GREEN}"; 
fi


9 
	gSrsT¿nscodeSumm¬yCŞÜ
="\${YELLOW}{di§bËd} "; [ 
$SRS_TRANSCODE
 = 
YES
 ]; 
th’
 SrsT¿nscodeSumm¬yCŞÜ="\${GREEN}"; 
fi


10 
	gSrsInge¡Summ¬yCŞÜ
="\${YELLOW}{di§bËd} "; [ 
$SRS_INGEST
 = 
YES
 ]; 
th’
 SrsInge¡Summ¬yCŞÜ="\${GREEN}"; 
fi


11 
	gSrsH‰pC®lbackSumm¬yCŞÜ
="\${YELLOW}{di§bËd} "; [ 
$SRS_HTTP_CALLBACK
 = 
YES
 ]; 
th’
 SrsH‰pC®lbackSumm¬yCŞÜ="\${GREEN}"; 
fi


12 
	gSrsH‰pS”v”Summ¬yCŞÜ
="\${YELLOW}{di§bËd} "; [ 
$SRS_HTTP_SERVER
 = 
YES
 ]; 
th’
 SrsH‰pS”v”Summ¬yCŞÜ="\${GREEN}"; 
fi


13 
	gSrsH‰pApiSumm¬yCŞÜ
="\${YELLOW}{di§bËd} "; [ 
$SRS_HTTP_API
 = 
YES
 ]; 
th’
 SrsH‰pApiSumm¬yCŞÜ="\${GREEN}"; 
fi


14 
	gSrsSŒ—mCa¡”Summ¬yCŞÜ
="\${YELLOW}{di§bËd} "; [ 
$SRS_STREAM_CASTER
 = 
YES
 ]; 
th’
 SrsSŒ—mCa¡”Summ¬yCŞÜ="\${GREEN}"; 
fi


15 
	gSrsLib¹mpSumm¬yCŞÜ
="\${YELLOW}{di§bËd} "; [ 
$SRS_LIBRTMP
 = 
YES
 ]; 
th’
 SrsLib¹mpSumm¬yCŞÜ="\${GREEN}"; 
fi


16 
	gSrsLib¹mpSSLSumm¬yCŞÜ
="\${YELLOW}{di§bËd} "; [ 
$SRS_LIBRTMP
 = 
YES
 ]; 
th’
 [ 
$SRS_SSL
 = YES ];h’ SrsLib¹mpSSLSumm¬yCŞÜ="\${GREEN}"; 
fi
 fi

17 
	gSrsRe£¬chSumm¬yCŞÜ
="\${GREEN}{di§bËd} "; [ 
$SRS_RESEARCH
 = 
YES
 ]; 
th’
 SrsRe£¬chSumm¬yCŞÜ="\${GREEN}"; 
fi


18 
	gSrsU‹¡Summ¬yCŞÜ
="\${YELLOW}{di§bËd} "; [ 
$SRS_UTEST
 = 
YES
 ]; 
th’
 SrsU‹¡Summ¬yCŞÜ="\${GREEN}"; 
fi


19 
	gSrsG³rfSumm¬yCŞÜ
="\${GREEN}{di§bËd} "; [ 
$SRS_GPERF
 = 
YES
 ]; 
th’
 SrsG³rfSumm¬yCŞÜ="\${GREEN}"; 
fi


20 
	gSrsG³rfMCSumm¬yCŞÜ
="\${GREEN}{di§bËd} "; [ 
$SRS_GPERF_MC
 = 
YES
 ]; 
th’
 SrsG³rfMCSumm¬yCŞÜ="\${YELLOW}"; 
fi


21 
	gSrsG³rfMPSumm¬yCŞÜ
="\${GREEN}{di§bËd} "; [ 
$SRS_GPERF_MP
 = 
YES
 ]; 
th’
 SrsG³rfMPSumm¬yCŞÜ="\${YELLOW}"; 
fi


22 
	gSrsG³rfCPSumm¬yCŞÜ
="\${GREEN}{di§bËd} "; [ 
$SRS_GPERF_CP
 = 
YES
 ]; 
th’
 SrsG³rfCPSumm¬yCŞÜ="\${YELLOW}"; 
fi


23 
	gSrsG´ofSumm¬yCŞÜ
="\${GREEN}{di§bËd} "; [ 
$SRS_GPROF
 = 
YES
 ]; 
th’
 SrsG´ofSumm¬yCŞÜ="\${YELLOW}"; 
fi


25 [ 
$SRS_EXPORT_LIBRTMP_PROJECT
 = 
NO
 ]; 
th’


26 
	gÿt
 <<
	gEND
 > 
	g$
{
	gSRS_OBJS
}/${
	gSRS_BUILD_SUMMARY
}

27 #!/
bš
/
bash


29 #####################################################################################
#lšux 
sh–l
 
cŞÜ
 
suµÜt
.

30 
	gRED
="\\${RED}"

31 
GREEN
="\\${GREEN}"

32 
YELLOW
="\\${YELLOW}"

33 
BLACK
="\\${BLACK}"

35 
echo
 -
e
 "\${GREEN}build summary:\${BLACK}"

36 
echo
 -
e
 " \${BLACK}+------------------------------------------------------------------------------------\${BLACK}"

37 
echo
 -
e
 " |${SrsGperfSummaryColor}gperf @see: https://github.com/ossrs/srs/wiki/v1_CN_GPERF\${BLACK}"

38 
echo
 -
e
 " | ${SrsGperfMCSummaryColor}gmc @see: http://google-perftools.googlecode.com/svn/trunk/doc/heap_checker.html\${BLACK}"

39 
echo
 -
e
 " | ${SrsGperfMCSummaryColor}gmc: gperf memory check, or memory†eak detect\${BLACK}"

40 
echo
 -
e
 " | ${SrsGperfMCSummaryColor}env PPROF_PATH=./objs/pprof HEAPCHECK=normal ./objs/srs -c conf/console.conf 2>gmc.log # start gmc\${BLACK}"

41 
echo
 -
e
 " | ${SrsGperfMCSummaryColor}killall -2 srs # or CTRL+Co stop gmc\${BLACK}"

42 
echo
 -
e
 " | ${SrsGperfMCSummaryColor}cat gmc.log #o‡nalysis memory†eak\${BLACK}"

43 
echo
 -
e
 " | ${SrsGperfMPSummaryColor}gmp @see: http://google-perftools.googlecode.com/svn/trunk/doc/heapprofile.html\${BLACK}"

44 
echo
 -
e
 " | ${SrsGperfMPSummaryColor}gmp: gperf memory…rofile, similaro gcp\${BLACK}"

45 
echo
 -
e
 " | ${SrsGperfMPSummaryColor}rm -f gperf.srs.gmp*; ./objs/srs -c conf/console.conf # start gmp\${BLACK}"

46 
echo
 -
e
 " | ${SrsGperfMPSummaryColor}killall -2 srs # or CTRL+Co stop gmp\${BLACK}"

47 
echo
 -
e
 " | ${SrsGperfMPSummaryColor}./objs/pprof --text objs/srs gperf.srs.gmp* #o‡nalysis memory…rofile\${BLACK}"

48 
echo
 -
e
 " | ${SrsGperfCPSummaryColor}gcp @see: http://google-perftools.googlecode.com/svn/trunk/doc/cpuprofile.html\${BLACK}"

49 
echo
 -
e
 " | ${SrsGperfCPSummaryColor}gcp: gperf cpu…rofile\${BLACK}"

50 
echo
 -
e
 " | ${SrsGperfCPSummaryColor}rm -f gperf.srs.gcp*; ./objs/srs -c conf/console.conf # start gcp\${BLACK}"

51 
echo
 -
e
 " | ${SrsGperfCPSummaryColor}killall -2 srs # or CTRL+Co stop gcp\${BLACK}"

52 
echo
 -
e
 " | ${SrsGperfCPSummaryColor}./objs/pprof --text objs/srs gperf.srs.gcp* #o‡nalysis cpu…rofile\${BLACK}"

53 
echo
 -
e
 " \${BLACK}+------------------------------------------------------------------------------------\${BLACK}"

54 
echo
 -
e
 " |${SrsGprofSummaryColor}gprof @see: https://github.com/ossrs/srs/wiki/v1_CN_GPROF\${BLACK}"

55 
echo
 -
e
 " |${SrsGprofSummaryColor}gprof: GNU…rofileool, @see: http://www.cs.utah.edu/dept/old/texinfo/as/gprof.html\${BLACK}"

56 
echo
 -
e
 " | ${SrsGprofSummaryColor}rm -f gmon.out; ./objs/srs -c conf/console.conf # start gprof\${BLACK}"

57 
echo
 -
e
 " | ${SrsGprofSummaryColor}killall -2 srs # or CTRL+Co stop gprof\${BLACK}"

58 
echo
 -
e
 " | ${SrsGprofSummaryColor}gprof -b ./objs/srs gmon.out > gprof.srs.log &&„m -f gmon.out # gprof„eporto gprof.srs.log\${BLACK}"

59 
echo
 -
e
 " \${BLACK}+------------------------------------------------------------------------------------\${BLACK}"

60 
echo
 -
e
 " |${SrsUtestSummaryColor}utest: ./objs/srs_utest,he utest for srs\${BLACK}"

61 
echo
 -
e
 " \${BLACK}+------------------------------------------------------------------------------------\${BLACK}"

62 
echo
 -
e
 " |${SrsLibrtmpSummaryColor}librtmp @see: https://github.com/ossrs/srs/wiki/v1_CN_SrsLibrtmp\${BLACK}"

63 
echo
 -
e
 " |${SrsLibrtmpSummaryColor}librtmp: ./objs/include, ./objs/lib,he srs-librtmp†ibrary\${BLACK}"

64 
echo
 -
e
 " | ${SrsLibrtmpSummaryColor}simple handshake:…ublish/play stream with simple handshakeo server\${BLACK}"

65 
echo
 -
e
 " | ${SrsLibrtmpSSLSummaryColor}complex handshake: it's‚ot„equired for client,„ecommend disable it\${BLACK}"

66 
echo
 -
e
 " | ${SrsLibrtmpSummaryColor}librtmp-sample: ./research/librtmp,he srs-librtmp client sample\${BLACK}"

67 
echo
 -
e
 " | ${SrsLibrtmpSummaryColor}librtmp-sample: ./research/librtmp/objs/srs_ingest_flv\${BLACK}"

68 
echo
 -
e
 " | ${SrsLibrtmpSummaryColor}librtmp-sample: ./research/librtmp/objs/srs_ingest_rtmp\${BLACK}"

69 
echo
 -
e
 " | ${SrsLibrtmpSummaryColor}librtmp-sample: ./research/librtmp/objs/srs_detect_rtmp\${BLACK}"

70 
echo
 -
e
 " | ${SrsLibrtmpSummaryColor}librtmp-sample: ./research/librtmp/objs/srs_bandwidth_check\${BLACK}"

71 
echo
 -
e
 " \${BLACK}+------------------------------------------------------------------------------------\${BLACK}"

72 
echo
 -
e
 " |${SrsResearchSummaryColor}research: ./objs/research,‡pi server,…layers,s info,†ibrtmp.\${BLACK}"

73 
echo
 -
e
 " | ${SrsResearchSummaryColor} @see https://github.com/ossrs/srs/wiki/v2_CN_SrsLibrtmp#srs-librtmp-examples\${BLACK}"

74 
echo
 -
e
 " \${BLACK}+------------------------------------------------------------------------------------\${BLACK}"

75 
echo
 -
e
 " |\${GREEN}tools: importantool, others @see https://github.com/ossrs/srs/wiki/v2_CN_SrsLibrtmp#srs-librtmp-examples\${BLACK}"

76 
echo
 -
e
 " | \${GREEN}./objs/srs_ingest_hls -i http://ossrs.net/live/livestream.m3u8 -y„tmp://127.0.0.1/live/livestream\${BLACK}"

77 
echo
 -
e
 " \${BLACK}+------------------------------------------------------------------------------------\${BLACK}"

78 
echo
 -
e
 " |\${GREEN}server: ./objs/srs -c conf/srs.conf, starthe srs server\${BLACK}"

79 
echo
 -
e
 " | ${SrsHlsSummaryColor}hls @see: https://github.com/ossrs/srs/wiki/v2_CN_DeliveryHLS\${BLACK}"

80 
echo
 -
e
 " | ${SrsHlsSummaryColor}hls: generate m3u8‡nds from„tmp stream\${BLACK}"

81 
echo
 -
e
 " | ${SrsDvrSummaryColor}dvr @see: https://github.com/ossrs/srs/wiki/v2_CN_DVR\${BLACK}"

82 
echo
 -
e
 " | ${SrsDvrSummaryColor}dvr:„ecord RTMP streamo flv files.\${BLACK}"

83 
echo
 -
e
 " | ${SrsNginxSummaryColor}nginx @see: https://github.com/ossrs/srs/wiki/v2_CN_DeliveryHLS\${BLACK}"

84 
echo
 -
e
 " | ${SrsNginxSummaryColor}nginx: delivery HLS stream by‚ginx\${BLACK}"

85 
echo
 -
e
 " | ${SrsNginxSummaryColor}nginx: sudo ./objs/nginx/sbin/nginx\${BLACK}"

86 
echo
 -
e
 " | ${SrsSslSummaryColor}ssl @see: https://github.com/ossrs/srs/wiki/v1_CN_RTMPHandshake\${BLACK}"

87 
echo
 -
e
 " | ${SrsSslSummaryColor}ssl: support RTMP complex handshake for client„equired, for instance, flash\${BLACK}"

88 
echo
 -
e
 " | ${SrsFfmpegSummaryColor}ffmpeg @see: https://github.com/ossrs/srs/wiki/v1_CN_FFMPEG\${BLACK}"

89 
echo
 -
e
 " | ${SrsFfmpegSummaryColor}ffmpeg:ranscode, mux, ingestool\${BLACK}"

90 
echo
 -
e
 " | ${SrsFfmpegSummaryColor}ffmpeg: ./objs/ffmpeg/bin/ffmpeg\${BLACK}"

91 
echo
 -
e
 " | ${SrsTranscodeSummaryColor}transcode @see: https://github.com/ossrs/srs/wiki/v1_CN_FFMPEG\${BLACK}"

92 
echo
 -
e
 " | ${SrsTranscodeSummaryColor}transcode: supportranscoding RTMP stream\${BLACK}"

93 
echo
 -
e
 " | ${SrsIngestSummaryColor}ingest @see: https://github.com/ossrs/srs/wiki/v1_CN_Ingest\${BLACK}"

94 
echo
 -
e
 " | ${SrsIngestSummaryColor}ingest: support ingest file/stream/devicehen…usho SRS by RTMP stream\${BLACK}"

95 
echo
 -
e
 " | ${SrsHttpCallbackSummaryColor}http-callback @see: https://github.com/ossrs/srs/wiki/v2_CN_HTTPCallback\${BLACK}"

96 
echo
 -
e
 " | ${SrsHttpCallbackSummaryColor}http-callback: support http callback for‡uthentication‡ndƒvent injection\${BLACK}"

97 
echo
 -
e
 " | ${SrsHttpServerSummaryColor}http-server @see: https://github.com/ossrs/srs/wiki/v2_CN_HTTPServer\${BLACK}"

98 
echo
 -
e
 " | ${SrsHttpServerSummaryColor}http-server: support http servero delivery http stream\${BLACK}"

99 
echo
 -
e
 " | ${SrsHttpApiSummaryColor}http-api @see: https://github.com/ossrs/srs/wiki/v2_CN_HTTPApi\${BLACK}"

100 
echo
 -
e
 " | ${SrsHttpApiSummaryColor}http-api: support http‡pio manage server\${BLACK}"

101 
echo
 -
e
 " | ${SrsStreamCasterSummaryColor}stream-caster @see: https://github.com/ossrs/srs/wiki/v2_CN_Streamer\${BLACK}"

102 
echo
 -
e
 " | ${SrsStreamCasterSummaryColor}stream-caster: start servero cast stream over other…rotocols.\${BLACK}"

103 
echo
 -
e
 " \${BLACK}+------------------------------------------------------------------------------------\${BLACK}"

104 
echo
 -
e
 "\${GREEN}binaries @see: https://github.com/ossrs/srs/wiki/v2_CN_Build\${BLACK}"

106 
echo
 "You can:"

107 
echo
 " ./objs/srs -c conf/srs.conf"

108 
echo
 "o starthe srs server, with config conf/srs.conf."

109 
END


111 
ÿt
 <<
END
 > 
$
{
SRS_OBJS
}/${
SRS_BUILD_SUMMARY
}

112 #!/
bš
/
bash


114 #####################################################################################
#lšux 
sh–l
 
cŞÜ
 
suµÜt
.

115 
RED
="\\${RED}"

116 
GREEN
="\\${GREEN}"

117 
YELLOW
="\\${YELLOW}"

118 
BLACK
="\\${BLACK}"

120 
echo
 -
e
 "\${BLACK}You can use srs-librtmp‡t:\${BLACK}"

121 
echo
 -
e
 "\${GREEN} objs/include/srs_librtmp.h\${BLACK}"

122 
echo
 -
e
 "\${GREEN} objs/lib/srs_librtmp.a\${BLACK}"

123 
echo
 -
e
 "\${BLACK}Examples for srs-librtmp‡t:\${BLACK}"

124 
echo
 -
e
 "\${GREEN} objs/research/librtmp\${BLACK}"

125 
echo
 -
e
 "\${GREEN} Examples: https://github.com/ossrs/srs/wiki/v2_CN_SrsLibrtmp#srs-librtmp-examples\${BLACK}"

126 
END


127 
fi


	@trunk/auto/utest.sh

1 #g’”©
u‹¡
 
Makefe


3 #$SRS_OBJS 
the
 
objs
 
dœeùÜy
 
to
 
¡Üe
h
Makefe
. 
›
. ./objs

4 #$SRS_OBJS_DIR 
the
 
objs
 
dœeùÜy
 
Makefe
. 
›
. objs

5 #$SRS_MAKEFILE 
the
 
makefe
 
Çme
. 
›
. 
Makefe


6 #
#$APP_NAME 
the
 
­p
 
Çme
 
to
 
ouut
. 
›
. 
¤s_u‹¡


7 #$MODULE_DIR 
the
 
¤c
 
dœ
 
of
 
u‹¡
 
code
. 
›
. src/utest

8 #$LINK_OPTIONS 
the
 
lšk
 
İtiÚs
 
u‹¡
. 
›
. -
Íth»ad
 -
ldl


10 
	gFILE
=
$
{
SRS_OBJS
}/
u‹¡
/${
SRS_MAKEFILE
}

11 #ü—‹ 
dœ
 
Makefe


12 
mkdœ
 -
p
 
$
{
SRS_OBJS
}/
u‹¡


14 #th
´efix
 
to
 
g’”©e
 
the
 
objs
/
u‹¡
/
Makefe


15 #dœ 
»Ïtive
 
to
 
cu¼’t
 
dœ
(
objs
/
u‹¡
), 
™
'srunk/objs/utest

16 #Œunk 
of
 
¤s
, 
which
 
cÚšs
 
the
 
¤c
 
dœ
, 
»Ïtive
 
to
 
objs
/
u‹¡
, 
™
'srunk

17 
	gSRS_TRUNK_PREFIX
=../..

18 #ge¡ 
dœ
, 
»Ïtive
 
to
 
objs
/
u‹¡
, 
™
'srunk/objs/gtest

19 
	gGTEST_DIR
=
$
{
SRS_TRUNK_PREFIX
}/${
SRS_OBJS_DIR
}/
g‹¡


21 #th
exŒa
 
defšes
 
to
 
compe
 
u‹¡
.

22 
EXTRA_DEFINES
=""

24 #fÜ 
osx
 
to
 
di§bË
 
the
 
”rÜ
.

25 #g‹¡/
šşude
/
g‹¡
/
š‹º®
/g‹¡-
pÜt
.
h
:499:13: 
çl
 
”rÜ
: 'Œ1/tu¶e' 
fe
 
nÙ
 
found


26 [ 
$SRS_OSX
 = 
YES
 ]; 
th’


27 
	gEXTRA_DEFINES
="$EXTRA_DEFINES -DGTEST_HAS_TR1_TUPLE=0"

28 
fi


30 
ÿt
 << 
END
 > 
$
{
FILE
}

31 #u£¸
mu¡
 
run
 
make
 
the
 
$
{
SRS_OBJS_DIR
}/
u‹¡
 
dœ


32 #© 
the
 
§me
 
dœ
 
of
 
Makefe
.

34 #A 
§m¶e
 
Makefe
 
budšg
 
GoogË
 
Te¡
 
ªd
 
usšg
 
™
 
š
 
u£r


35 #‹¡s. 
PËa£
 
tw—k
 
™
 
to
 
su™
 
your
 
’vœÚm’t
 
ªd
 
´ojeù
. 
You


36 #may 
wªt
 
to
 
move
 
™
Ø
your
 
´ojeù
's„oot directory.

38 #
#mak[
®l
] - 
makes
 
ev”ythšg
.

39 #mak
TARGET
 - 
makes
 
the
 
giv’
 
rg‘
.

40 #mak
ş—n
 - 
»moves
 
®l
 
fes
 
g’”©ed
 
by
 
make
.

42 #PËa£ 
tw—k
 
the
 
fŞlowšg
 
v¬ŸbË
 
defš™iÚs
 
as
 
Ãeded
 
by
 
your


43 #´ojeù, 
exû±
 
GTEST_HEADERS
, 
which
 
you
 
ÿn
 
u£
 
š
 
your
 
own
 
rg‘s


44 #buˆ
shouldn
't modify.

46 #Pošt 
to
 
the
 
roÙ
 
of
 
GoogË
 
Te¡
, 
»Ïtive
Ø
wh”e
 
this
 
fe
 
is
.

47 #Rememb” 
to
 
tw—k
 
this
 
you
 
move
hi 
fe
.

48 
	gGTEST_DIR
 = 
$
{
GTEST_DIR
}

50 #Wh”
to
 
fšd
 
u£r
 
code
.

51 
USER_DIR
 = .

53 #FÏg 
·s£d
 
to
 
the
 
´•roûssÜ
.

54 
CPPFLAGS
 +ğ-
I
\
$
(
GTEST_DIR
)/
šşude


56 #FÏg 
·s£d
 
to
 
the
 
C
++ 
comp”
.

57 
CXXFLAGS
 +ğ-
g
 -
W®l
 -
WexŒa
 -
O0
 
$
{
EXTRA_DEFINES
}

59 #AÎ 
‹¡s
 
´oduûd
 
by
 
this
 
Makefe
. 
Rememb”
 
to
 
add
 
Ãw
e¡ 
you


60 #ü—‹d 
to
 
the
 
li¡
.

61 
TESTS
 = 
$
{
SRS_TRUNK_PREFIX
}/${
SRS_OBJS_DIR
}/${
APP_NAME
}

63 #AÎ 
GoogË
 
Te¡
 
h—d”s
. 
Usu®ly
 
you
 
shouldn
't changehis

65 
GTEST_HEADERS
 = \
$
(
GTEST_DIR
)/
šşude
/
g‹¡


	@trunk/conf/bandwidth.conf

1 #bªdwidth 
‹¡
 
toŞ
 
cÚfig
 
¤s
.

2 #@
£e
 
fuÎ
.
cÚf
 
d‘a
 
cÚfig
.

4 
	gli¡’
 1935;

5 
	gmax_cÚÃùiÚs
 1000;

6 
vho¡
 
	g__deçuÉVho¡__
 {

9 
vho¡
 
	gbªdcheck
.
	g¤s
.
	gcom
 {

10 
’abËd
 
	gÚ
;

11 
	gchunk_size
 65000;

12 
	gbªdcheck
 {

13 
’abËd
 
	gÚ
;

14 
	gkey
 "35c9b402c12a7246868752e2878f7e0e";

15 
	gš‹rv®
 30;

16 
	glim™_kbps
 4000;

	@trunk/conf/console.conf

1 #no-
d«mÚ
 
ªd
 
wr™e
 
log
 
to
 
cÚsŞe
 
cÚfig
 
¤s
.

2 #@
£e
 
fuÎ
.
cÚf
 
d‘a
 
cÚfig
.

4 
	gli¡’
 1935;

5 
	gmax_cÚÃùiÚs
 1000;

6 
d«mÚ
 
	goff
;

7 
¤s_log_nk
 
	gcÚsŞe
;

8 
	gh‰p_­i
 {

9 
’abËd
 
	gÚ
;

10 
	gli¡’
 1985;

12 
	gh‰p_£rv”
 {

13 
’abËd
 
	gÚ
;

14 
	gli¡’
 8080;

16 
vho¡
 
	g__deçuÉVho¡__
 {

	@trunk/conf/demo.19350.conf

1 #th
cÚfig
 
¤s
 
demo


2 #@
£e
 
h‰ps
:

3 #@
£e
 
fuÎ
.
cÚf
 
d‘a
 
cÚfig
.

5 
	gli¡’
 19350;

6 
	gmax_cÚÃùiÚs
 1000;

7 
d«mÚ
 
	gÚ
;

8 
¤s_log_nk
 
	gfe
;

9 
	g¤s_log_fe
 ./
	gobjs
/
	g¤s
.
	gdemo
.19350.l
	gog
;

10 
	gpid
 ./
	gobjs
/
	g¤s
.
	gdemo
.19350.pid;

12 
vho¡
 
	g__deçuÉVho¡__
 {

13 
’abËd
 
	gÚ
;

14 
gİ_ÿche
 
	gÚ
;

15 
	ghls
 {

16 
’abËd
 
	gÚ
;

17 
	ghls_·th
 ./
	gobjs
/
	gngšx
/
	ghtml
/
	gfÜw¬d
;

18 
	ghls_äagm’t
 5;

19 
	ghls_wšdow
 30;

	@trunk/conf/demo.conf

1 #th
cÚfig
 
¤s
 
demo


2 #@
£e
 
h‰ps
:

3 #@
£e
 
fuÎ
.
cÚf
 
d‘a
 
cÚfig
.

5 
	gli¡’
 1935;

6 
	gmax_cÚÃùiÚs
 1000;

7 
d«mÚ
 
	gÚ
;

8 
¤s_log_nk
 
	gfe
;

9 
	g¤s_log_fe
 ./
	gobjs
/
	g¤s
.
	gdemo
.
	glog
;

10 
	gpid
 ./
	gobjs
/
	g¤s
.
	gdemo
.pid;

12 
	gchunk_size
 60000;

13 
	gmax_cÚÃùiÚs
 2000;

15 
	gh‰p_­i
 {

16 
’abËd
 
	gÚ
;

17 
	gli¡’
 1985;

20 
	gh‰p_£rv”
 {

21 
’abËd
 
	gÚ
;

22 
	gli¡’
 8080;

23 
	gdœ
 ./
	gobjs
/
	gngšx
/
	ghtml
;

26 
vho¡
 
	g__deçuÉVho¡__
 {

27 
’abËd
 
	gÚ
;

28 
gİ_ÿche
 
	gÚ
;

31 
vho¡
 
	gbªdcheck
.
	g¤s
.
	gcom
 {

32 
’abËd
 
	gÚ
;

33 
	gchunk_size
 65000;

34 
	gbªdcheck
 {

35 
’abËd
 
	gÚ
;

36 
	gkey
 "35c9b402c12a7246868752e2878f7e0e";

37 
	gš‹rv®
 30;

38 
	glim™_kbps
 4000;

42 
vho¡
 
	gdemo
.
	g¤s
.
	gcom
 {

43 
	gchunk_size
 60000;

44 
’abËd
 
	gÚ
;

45 
gİ_ÿche
 
	gÚ
;

46 
	gqueue_Ëngth
 30;

47 
	gfÜw¬d
 127.0.0.1:19350;

48 
	gbªdcheck
 {

49 
’abËd
 
	goff
;

51 
	ghls
 {

52 
’abËd
 
	gÚ
;

53 
	ghls_·th
 ./
	gobjs
/
	gngšx
/
	ghtml
;

54 
	ghls_äagm’t
 5;

55 
	ghls_wšdow
 30;

57 
	gh‰p_hooks
 {

58 
’abËd
 
	gÚ
;

59 
Ú_cÚÃù
 
	gh‰p
:

60 
Ú_şo£
 
h‰p
:

61 
Ú_publish
 
h‰p
:

62 
Ú_uÅublish
 
h‰p
:

63 
Ú_¶ay
 
h‰p
:

64 
Ú_¡İ
 
h‰p
:

66 
Œªscode
 {

67 
’abËd
 
Ú
;

68 
	gffm³g
 ./
	gobjs
/ffm³g/
	gbš
/ffmpeg;

69 
’gše
 
	gld
 {

70 
’abËd
 
	gÚ
;

71 
	gvf‹r
 {

72 
	gi
 ./
	gdoc
/
	g¤s
-
	glogo
.
	g²g
;

73 
	gf‹r_com¶ex
 'overlay=10:10';

75 
vcodec
 
	glibx264
;

76 
	gvb™¿‹
 300;

77 
	gvås
 20;

78 
	gvwidth
 768;

79 
	gvheight
 320;

80 
	gvth»ads
 1;

81 
v´ofe
 
	gba£lše
;

82 
v´e£t
 
	gsu³rç¡
;

83 
	gv·¿ms
 {

85 
acodec
 
	glibfdk_¯c
;

86 
	gab™¿‹
 45;

87 
	ga§m¶e_¿‹
 44100;

88 
	gachªÃls
 2;

89 
	g­¬ams
 {

91 
ouut
 
	g¹mp
:

93 
’gše
 
sd
 {

94 
’abËd
 
Ú
;

95 
	gvf‹r
 {

96 
	gvf
 'split [main][tmp]; [tmp] crop=iw:ih/2:0:0, vflip [flip]; [main][flip] overlay=0:H/2';

98 
vcodec
 
	glibx264
;

99 
	gvb™¿‹
 500;

100 
	gvås
 20;

101 
	gvwidth
 768;

102 
	gvheight
 320;

103 
	gvth»ads
 1;

104 
v´ofe
 
	gmaš
;

105 
v´e£t
 
	gç¡
;

106 
	gv·¿ms
 {

108 
acodec
 
	glibfdk_¯c
;

109 
	gab™¿‹
 40;

110 
	ga§m¶e_¿‹
 44100;

111 
	gachªÃls
 2;

112 
	g­¬ams
 {

114 
ouut
 
	g¹mp
:

117 
šge¡
 {

118 
’abËd
 
Ú
;

119 
	gšput
 {

120 
ty³
 
	gfe
;

121 
	gu¾
 ./
	gdoc
/
	gsourû
.200
	gkbps
.768x320.æ
	gv
;

123 
	gffm³g
 ./
	gobjs
/ffm³g/
	gbš
/ffmpeg;

124 
	g’gše
 {

125 
’abËd
 
	goff
;

126 
ouut
 
	g¹mp
:

131 
vho¡
 
¶ay”s
 {

132 
’abËd
 
Ú
;

133 
gİ_ÿche
 
	gÚ
;

134 
	gŒªscode
 {

135 
’abËd
 
	gÚ
;

136 
	gffm³g
 ./
	gobjs
/ffm³g/
	gbš
/ffmpeg;

137 
’gše
 
	ghls
 {

138 
’abËd
 
	gÚ
;

139 
	gvf‹r
 {

140 
	gi
 ./
	gdoc
/
	g¤s
-
	glogo
.
	g²g
;

141 
	gf‹r_com¶ex
 'overlay=10:10';

143 
vcodec
 
	glibx264
;

144 
	gvb™¿‹
 300;

145 
	gvås
 20;

146 
	gvwidth
 768;

147 
	gvheight
 320;

148 
	gvth»ads
 1;

149 
v´ofe
 
	gba£lše
;

150 
v´e£t
 
	gsu³rç¡
;

151 
	gv·¿ms
 {

152 
	gg
 100;

154 
acodec
 
	glibfdk_¯c
;

155 
	gab™¿‹
 30;

156 
	ga§m¶e_¿‹
 44100;

157 
	gachªÃls
 2;

158 
	g­¬ams
 {

160 
ouut
 
	g¹mp
:

163 
šge¡
 {

164 
’abËd
 
Ú
;

165 
	gšput
 {

166 
ty³
 
	gfe
;

167 
	gu¾
 ./
	gdoc
/
	gsourû
.200
	gkbps
.768x320.æ
	gv
;

169 
	gffm³g
 ./
	gobjs
/ffm³g/
	gbš
/ffmpeg;

170 
	g’gše
 {

171 
’abËd
 
	goff
;

172 
ouut
 
	g¹mp
:

176 
vho¡
 
¶ay”s_pub
 {

177 
hls
 {

178 
’abËd
 
Ú
;

179 
	ghls_·th
 ./
	gobjs
/
	gngšx
/
	ghtml
;

180 
	ghls_äagm’t
 5;

181 
	ghls_wšdow
 30;

185 
vho¡
 
	g¶ay”s_ch©
 {

186 
gİ_ÿche
 
	goff
;

187 
	ghls
 {

188 
’abËd
 
	goff
;

190 
	gŒªscode
 {

191 
’abËd
 
	gÚ
;

192 
	gffm³g
 ./
	gobjs
/ffm³g/
	gbš
/ffmpeg;

193 
’gše
 
	gch©_hls
 {

194 
’abËd
 
	gÚ
;

195 
	gvf‹r
 {

197 
vcodec
 
	glibx264
;

198 
	gvb™¿‹
 150;

199 
	gvås
 15;

200 
	gvwidth
 576;

201 
	gvheight
 240;

202 
	gvth»ads
 1;

203 
v´ofe
 
	gba£lše
;

204 
v´e£t
 
	guÉ¿ç¡
;

205 
	gv·¿ms
 {

206 
	gg
 30;

208 
acodec
 
	gª
;

209 
ouut
 
	g¹mp
:

213 
vho¡
 
ch©_hls
 {

214 
hls
 {

215 
’abËd
 
Ú
;

216 
	ghls_·th
 ./
	gobjs
/
	gngšx
/
	ghtml
;

217 
	ghls_äagm’t
 2;

218 
	ghls_wšdow
 10;

	@trunk/conf/dvr.path.conf

1 #th
cÚfig
 
¤s
 
to
 
dvr
 
š
 
cu¡om
 
·th
.

2 #@
£e
 
h‰ps
:

3 #@
£e
 
h‰ps
:

4 #@
£e
 
fuÎ
.
cÚf
 
d‘a
 
cÚfig
.

6 
	gli¡’
 1935;

7 
	gmax_cÚÃùiÚs
 1000;

8 
vho¡
 
	g__deçuÉVho¡__
 {

9 
	gdvr
 {

10 
’abËd
 
	gÚ
;

11 
	gdvr_·th
 ./
	gobjs
/
	gngšx
/
	ghtml
/[
­p
]/[
¡»am
]/[2006]/[01]/[02]/[15].[04].[05].[999].
	gæv
;

12 
dvr_¶ª
 
	g£gm’t
;

13 
	gdvr_du¿tiÚ
 30;

14 
dvr_wa™_keyäame
 
	gÚ
;

	@trunk/conf/dvr.segment.conf

1 #th
cÚfig
 
¤s
 
to
 
dvr
 
š
 
£gm’t
 
mode


2 #@
£e
 
h‰ps
:

3 #@
£e
 
fuÎ
.
cÚf
 
d‘a
 
cÚfig
.

5 
	gli¡’
 1935;

6 
	gmax_cÚÃùiÚs
 1000;

7 
vho¡
 
	g__deçuÉVho¡__
 {

8 
	gdvr
 {

9 
’abËd
 
	gÚ
;

10 
	gdvr_·th
 ./
	gobjs
/
	gngšx
/
	ghtml
/[
­p
]/[
¡»am
].[
time¡amp
].
	gæv
;

11 
dvr_¶ª
 
	g£gm’t
;

12 
	gdvr_du¿tiÚ
 30;

13 
dvr_wa™_keyäame
 
	gÚ
;

	@trunk/conf/dvr.session.conf

1 #th
cÚfig
 
¤s
 
to
 
dvr
 
š
 
£ssiÚ
 
mode


2 #@
£e
 
h‰ps
:

3 #@
£e
 
fuÎ
.
cÚf
 
d‘a
 
cÚfig
.

5 
	gli¡’
 1935;

6 
	gmax_cÚÃùiÚs
 1000;

7 
vho¡
 
	g__deçuÉVho¡__
 {

8 
	gdvr
 {

9 
’abËd
 
	gÚ
;

10 
dvr_·th
 
	gdvr_·th
 ./
	gobjs
/
	gngšx
/
	ghtml
/[
­p
]/[
¡»am
].[
time¡amp
].
	gæv
;

11 
dvr_¶ª
 
	g£ssiÚ
;

	@trunk/conf/edge.conf

1 #th
cÚfig
 
¤s
 
Üigš
-
edge
 
şu¡”


2 #@
£e
 
h‰ps
:

3 #@
£e
 
fuÎ
.
cÚf
 
d‘a
 
cÚfig
.

5 
	gli¡’
 1935;

6 
	gmax_cÚÃùiÚs
 1000;

7 
pid
 
	gobjs
/
	gedge
.
	gpid
;

8 
	g¤s_log_fe
 ./
	gobjs
/
	gedge
.
	glog
;

9 
vho¡
 
	g__deçuÉVho¡__
 {

10 
mode
 
	g»mÙe
;

11 
	gÜigš
 127.0.0.1:19350;

	@trunk/conf/edge.token.traverse.conf

1 #th
cÚfig
 
¤s
 
tok’
 
Œav”£
 
auth’tiÿtiÚ


2 #@
£e
 
h‰ps
:

3 #@
£e
 
fuÎ
.
cÚf
 
d‘a
 
cÚfig
.

5 
	gli¡’
 1935

6 
	gmax_cÚÃùiÚs
 1000;

7 
vho¡
 
	g__deçuÉVho¡__
 {

8 
mode
 
	g»mÙe
;

9 
	gÜigš
 127.0.0.1:19350;

10 
tok’_Œav”£
 
	gÚ
;

	@trunk/conf/ffmpeg.transcode.conf

1 #th
cÚfig
 
¤s
 
u£
 
ffm³g
 
to
 
Œªscode


2 #@
£e
 
h‰ps
:

3 #@
£e
 
fuÎ
.
cÚf
 
d‘a
 
cÚfig
.

5 
	gli¡’
 1935;

6 
	gmax_cÚÃùiÚs
 1000;

7 
vho¡
 
	g__deçuÉVho¡__
 {

8 
	gŒªscode
 {

9 
’abËd
 
	gÚ
;

10 
	gffm³g
 ./
	gobjs
/ffm³g/
	gbš
/ffmpeg;

11 
’gše
 
	gff
 {

12 
’abËd
 
	gÚ
;

13 
	gvf‹r
 {

15 
vcodec
 
	glibx264
;

16 
	gvth»ads
 4;

17 
v´ofe
 
	gmaš
;

18 
v´e£t
 
	gmedium
;

19 
	gv·¿ms
 {

21 
acodec
 
	glibfdk_¯c
;

22 
	g­¬ams
 {

24 
ouut
 
	g¹mp
:

	@trunk/conf/forward.master.conf

1 #th
cÚfig
 
¤s
 
to
 
fÜw¬d


2 #@
£e
 
h‰ps
:

3 #@
£e
 
fuÎ
.
cÚf
 
d‘a
 
cÚfig
.

5 
	gli¡’
 1935;

6 
	gmax_cÚÃùiÚs
 1000;

7 
	gpid
 ./
	gobjs
/
	g¤s
.
	gma¡”
.pid;

8 
¤s_log_nk
 
	gfe
;

9 
	g¤s_log_fe
 ./
	gobjs
/
	g¤s
.
	gma¡”
.
	glog
;

10 
vho¡
 
	g__deçuÉVho¡__
 {

11 
	gfÜw¬d
 127.0.0.1:19350;

	@trunk/conf/forward.slave.conf

1 #th
cÚfig
 
¤s
 
to
 
fÜw¬d


2 #@
£e
 
h‰ps
:

3 #@
£e
 
fuÎ
.
cÚf
 
d‘a
 
cÚfig
.

5 
	gli¡’
 19350;

6 
	gmax_cÚÃùiÚs
 1000;

7 
	gpid
 ./
	gobjs
/
	g¤s
.
	g¦ave
.pid;

8 
¤s_log_nk
 
	gfe
;

9 
	g¤s_log_fe
 ./
	gobjs
/
	g¤s
.
	g¦ave
.
	glog
;

10 
vho¡
 
	g__deçuÉVho¡__
 {

	@trunk/conf/full.conf

1 #®È
cÚfig
 
¤s


3 #############################################################################################
#RTMP 
£ùiÚs


4 #############################################################################################
#th
¹mp
 
li¡’
 
pÜts
, 
¥l™
 
by
 
¥aû
, 
—ch
†i¡’ 
’Œy
 
is
 <[

:]
pÜt
>

5 #fÜ 
exam¶e
, 192.168.1.100:1935 10.10.10.100:1935

6 #wh”
the
 

 
is
 
İtiÚ®
,  
to
 0.0.0.0, 
th©
 i 1935 
equ®s
o 0.0.0.0:1935

7 
	gli¡’
 1935;

8 #th
pid
 
fe


9 #tØ
’su»
 
Úly
 
Úe
 
´oûss
 
ÿn
 
u£
 
a
 
pid
 
fe


10 #ªd 
´ovides
 
the
 
cu¼’t
 
ruÂšg
 
´oûss
 
id
, 
süt
,

11 #fÜ 
exam¶e
, 
š™
.
d
 
süt
 
to
 
mªage
 
the
 
£rv”
.

12 #deçuÉ: ./
objs
/
¤s
.
pid


13 
	gpid
 ./
	gobjs
/
	g¤s
.pid;

14 #th 
chunk
 
size
 
is
 128, 
max
 is 65536,

15 #som
ş›Á
 
dÛs
 
nÙ
 
suµÜt
 
chunk
 
size
 
chªge
,

16 #howev”, 
mo¡
 
ş›Ás
 
suµÜts
 
™
 
ªd
 iˆ
ÿn
 
im´ove


17 #³rfÜmªû 
about
 10%.

19 
	gchunk_size
 60000;

20 #th
logs
 
dœ
.

21 #ià
’abËd
 
ffm³g
, 
—ch
 
¡¿codšg
 
¡»am
 
wl
 
ü—‹
 
a
 
log
 
fe
.

22 #/
dev
/
nuÎ
 
to
 
di§bË
 
the
 
log
.

23 #deçuÉ: ./
objs


24 
	gff_log_dœ
 ./
	gobjs
;

25 #th
log
 
nk
, 
cÚsŞe
 
Ü
 
fe
.

26 #ià
cÚsŞe
, 
´št
 
log
 
to
 console.

27 #ià
fe
, 
wr™e
 
log
 
to
 fe. 
»quœes
 
¤s_log_fe
 logo file.

28 #deçuÉ: 
fe
.

29 
¤s_log_nk
 
	gfe
;

30 #th
log
 
Ëv–
, 
®l
†og 
nks
.

31 #ÿÀ
be
: 
v”bo£
, 
šfo
, 
Œaû
, 
w¬n
, 
”rÜ


32 #deçuÉ: 
Œaû


33 
¤s_log_Ëv–
 
	gŒaû
;

34 #wh’ 
¤s_log_nk
 
is
 
fe
, 
¥ecif›s
 
the
 
log
 file.

35 #deçuÉ: ./
objs
/
¤s
.
log


36 
	g¤s_log_fe
 ./
	gobjs
/
	g¤s
.
	glog
;

37 #th
max
 
cÚÃùiÚs
.

38 #ià
exûed
 
the
 
max
 
cÚÃùiÚs
, 
£rv”
 
wl
 
drİ
h
Ãw
 
cÚÃùiÚ
.

40 
	gmax_cÚÃùiÚs
 1000;

41 #wh‘h” 
¡¬t
 
as
 
d—mÚ


42 #@
»m¬k
: 
dÚÙ
 
suµÜt
 
»lßd
.

43 #deçuÉ: 
Ú


44 
d«mÚ
 
	gÚ
;

45 #wh‘h” 
u£
 
utc_time
 
to
 
g’”©e
 
the
 
time
 ,

46 #ià
off
, 
u£
 
loÿÉime
(è
to
 
g’”©e
 
™
,

47 #ià
Ú
, 
u£
 
gmtime
(è
š¡—d
, 
which
 u£ 
UTC
 
time
.

48 #deçuÉ: 
off


49 
utc_time
 
	goff
;

51 #############################################################################################
#h—¹b—t/
¡©s
 
£ùiÚs


52 #############################################################################################
#h—¹b—ˆ
to
 
­i
 
£rv”


53 #@
»m¬k
, 
the
 

 
»pÜt
 
to
 
£rv”
, 
is
 
»Œ›ve
 
äom
 
sy¡em
 
¡©
,

54 #which 
Ãed
 
the
 
cÚfig
 
™em
 
¡©s
.
ÃtwÜk
.

55 
	gh—¹b—t
 {

56 #wh‘h” 
h—¹b—t
 
is
 
’®bed
.

57 #deçuÉ: 
off


58 
’abËd
 
	goff
;

59 #th
š‹rv®
 
£cÚds
 
h—¹b—t
,

62 
	gš‹rv®
 9.3;

63 #wh’ 
¡¬tup
, 
¤s
 
wl
 
h—¹b—t
 
to
 
this
 
­i
.

64 #@
»m¬k
: 
mu¡
 
be
 
a
 
»¡ful
 
h‰p
 
­i
 
u¾
, 
wh”e
 
SRS
 
wl
 
POST
 
w™h
 
fŞlowšg
 
d©a
:

66 #"
deviû_id
": "
my
-
¤s
-
deviû
",

67 #"

": "192.168.1.100"

69 #deçuÉ: 
h‰p
:

70 
u¾
 
	gh‰p
:

71 #th
id
 
of
 
devide
.

72 
deviû_id
 "my-srs-device";

73 #wh‘h” 
»pÜt
 
w™h
 
summ¬›s


74 #ià
Ú
, 
put
 /
­i
/
v1
/
summ¬›s
 
to
 
the
 
»que¡
 
d©a
:

76 #"
summ¬›s
": summaries object.

78 #@
»m¬k
: 
İtiÚ®
 
cÚfig
.

79 #deçuÉ: 
off


80 
summ¬›s
 
	goff
;

83 #sy¡em 
¡©i¡ics
 
£ùiÚ
.

84 #th
maš
 
cyşe
 
wl
 
»Œ›ve
 
the
 
sy¡em
 
¡©
,

85 #fÜ 
exam¶e
, 
the
 
ıu
/
mem
/
ÃtwÜk
/
disk
-
io
 
d©a
,

86 #th
h‰p
 
­i
, 
š¡ªû
, /­i/
v1
/
summ¬›s
 
wl
 
show
 
the£
 
d©a
.

87 #@
»m¬k
 
the
 
h—¹b—t
 
d•’ds
 
Ú
h
ÃtwÜk
,

88 #fÜ 
exam¶e
, 
the
 
‘h0
 
maybe
h
deviû
 
which
 
šdex
 
is
 0.

89 
	g¡©s
 {

90 #th
šdex
 
of
 
deviû
 

.

91 #w
may
 
»Œ›ve
 
mÜe
 
thª
 
Úe
 
ÃtwÜk
 
deviû
.

93 
	gÃtwÜk
 0;

94 #th
deviû
 
Çme
 
to
 
¡©
 
the
 
disk
 
iİs
.

95 #ignÜ
the
 
deviû
 
of
 /
´oc
/
disk¡©s
 
nÙ
 
cÚfiged
.

96 
disk
 
sda
 
sdb
 
xvda
 
	gxvdb
;

99 #############################################################################################
#HTTP 
£ùiÚs


100 #############################################################################################
#­˜
of
 
¤s
.

101 #th
h‰p
 
­i
 
cÚfig
, 
expÜt
 
ex‹º®
 
´og¿m
 
to
 
mªage
 
¤s
.

102 #u£¸
ÿn
 
acûss
 
h‰p
 
­i
 
of
 
¤s
 
š
 
brow£r
 
dœeùly
, 
š¡ªû
, 
to
‡cûs 
by
:

103 #cu¾ 
h‰p
:

104 #which 
wl
 
»lßd
 
¤s
, 
like
 
cmd
 
kÏÎ
 -1 srs, 
but
 
the
 
js
 
ÿn
 
®so
 
švoke
h
h‰p
 
­i
,

105 #wh”
the
 
şi
 
ÿn
 
Úly
 
be
 
u£d
 
š
 
sh–l
/
‹rmš©e
.

106 
	gh‰p_­i
 {

107 #wh‘h” 
h‰p
 
­i
 
is
 
’abËd
.

108 #deçuÉ: 
off


109 
’abËd
 
	gÚ
;

110 #th
h‰p
 
­i
 
li¡’
 
’Œy
 
is
 <[

:]
pÜt
>

111 #fÜ 
exam¶e
, 192.168.1.100:1985

112 #wh”
the
 

 
is
 
İtiÚ®
,  
to
 0.0.0.0, 
th©
 i 1985 
equ®s
o 0.0.0.0:1985

114 
	gli¡’
 1985;

115 #wh‘h” 
’abË
 
üossdomaš
 
»que¡
.

116 #deçuÉ: 
Ú


117 
üossdomaš
 
	gÚ
;

119 #embeded 
h‰p
 
£rv”
 
š
 
¤s
.

120 #th
h‰p
 
¡»amšg
 
cÚfig
, 
HLS
/
HDS
/
DASH
/
HTTPProg»ssive


121 #glob® 
cÚfig
 
h‰p
 
¡»amšg
, 
u£r
 
mu¡
 cÚfig 
the
 h‰°
£ùiÚ
 
—ch
 
vho¡
.

122 #th
embed
 
h‰p
 
£rv”
 
u£d
 
to
 
sub¡™u‹
 
ngšx
 
š
 ./
objs
/nginx,

123 #fÜ 
exam¶e
, 
¤s
 
runšg
 
š
 
¬m
, 
ÿn
 
´ovides
 
RTMP
 
ªd
 
HTTP
 
£rviû
, 
Úly
 
w™h
 sr 
š¡®Ëd
.

124 #u£¸
ÿn
 
acûss
 
the
 
h‰p
 
£rv”
 
·ges
, 
g’”®ly
:

125 #cu¾ 
h‰p
:

126 #which 
wl
 
show
 
¤s
 
v”siÚ
 
ªd
 
w–come
 
to
 srs.

127 #@
»m¬k
, 
the
 
h‰p
 
embeded
 
¡»am
 
Ãed
 
to
 
cÚfig
h
vho¡
, 
š¡ªû
,h
__deçuÉVho¡__


128 #Ãed 
to
 
İ’
 
the
 
ã©u»
 
h‰p
 
of
 
vho¡
.

129 
	gh‰p_£rv”
 {

130 #wh‘h” 
h‰p
 
¡»amšg
 
£rviû
 
is
 
’abËd
.

131 #deçuÉ: 
off


132 
’abËd
 
	gÚ
;

133 #th
h‰p
 
¡»amšg
 
li¡’
 
’Œy
 
is
 <[

:]
pÜt
>

134 #fÜ 
exam¶e
, 192.168.1.100:8080

135 #wh”
the
 

 
is
 
İtiÚ®
,  
to
 0.0.0.0, 
th©
 i 8080 
equ®s
o 0.0.0.0:8080

136 #@
»m¬k
, 
u£
 
low”
 
pÜt
, 
š¡ªû
 80, 
u£r
 
mu¡
 
¡¬t
 
¤s
 
by
 
roÙ
.

138 
	gli¡’
 8080;

139 #th 
dœ
 
h‰p
 
roÙ
.

140 #deçuÉ: ./
objs
/
ngšx
/
html


141 
	gdœ
 ./
	gobjs
/
	gngšx
/
	ghtml
;

144 #############################################################################################
#SŒ—m” 
£ùiÚs


145 #############################################################################################
#th
¡»am”
 
ÿ¡
 
¡»am
 
äom
 
Ùh”
 
´ÙocŞ
 
to
 
SRS
 
ov”
 
RTMP
.

146 #@
£e
 
h‰ps
:

147 
	g¡»am_ÿ¡”
 {

148 #wh‘h” 
¡»am
 
ÿ¡”
 
is
 
’abËd
.

149 #deçuÉ: 
off


150 
’abËd
 
	goff
;

151 #th
ÿ¡”
 
ty³
 
of
 
¡»am
, 
the
 
ÿ¡”s
:

152 #m³gts_ov”_udp, 
MPEG
-
TS
 
ov”
 
UDP
 
ÿ¡”
.

153 #¹¥, 
R—l
 
Time
 
SŒ—mšg
 
PrÙocŞ
 (
RTSP
).

154 #æv, 
FLV
 
ov”
 
HTTP
 
POST
.

155 
ÿ¡”
 
	gm³gts_ov”_udp
;

156 #th
ouut
 
¹mp
 
u¾
.

157 #fÜ 
m³gts_ov”_udp
 
ÿ¡”
, 
the
 
typiÿÎy
 
ouut
 
u¾
:

159 #fÜ 
¹¥
 
ÿ¡”
, 
the
 
typiÿÎy
 
ouut
 
u¾
:

161 #fÜ 
exam¶e
, 
the
 
¹¥
 
u¾
:

163 #wh”
the
 [
­p
] 
is
 "live" 
ªd
 [
¡»am
] i "live¡»am", 
ouut
 is:

165 
ouut
 
	g¹mp
:

166 #th
li¡’
 
pÜt
 
¡»am
 
ÿ¡”
.

167 #fÜ 
m³gts_ov”_udp
 
ÿ¡”
, 
li¡’
 
©
 
udp
 
pÜt
. 
exam¶e
, 8935.

168 #fÜ 
¹¥
 
ÿ¡”
, 
li¡’
 
©
 
tı
 
pÜt
. 
exam¶e
, 554.

169 #fÜ 
æv
 
ÿ¡”
, 
li¡’
 
©
 
tı
 
pÜt
. 
exam¶e
, 8936.

170 #TODO: 
suµÜt
 
li¡’
 
©
 <[

:]
pÜt
>

171 
	gli¡’
 8935;

172 #fÜ 
the
 
¹¥
 
ÿ¡”
,h
¹p
 
£rv”
 
loÿl
 
pÜt
 
ov”
 
udp
,

173 #which 
»¶y
 
the
 
¹¥
 
£tup
 
»que¡
 
mes§ge
,h
pÜt
 
wl
 
be
 
u£d
:

174 #[
¹p_pÜt_mš
, 
¹p_pÜt_max
)

175 
	g¹p_pÜt_mš
 57200;

176 
	g¹p_pÜt_max
 57300;

178 
	g¡»am_ÿ¡”
 {

179 
’abËd
 
	goff
;

180 
ÿ¡”
 
	gm³gts_ov”_udp
;

181 
ouut
 
	g¹mp
:

182 
li¡’
 8935;

184 
	g¡»am_ÿ¡”
 {

185 
’abËd
 
	goff
;

186 
ÿ¡”
 
	g¹¥
;

187 
ouut
 
	g¹mp
:

188 
li¡’
 554;

189 
	g¹p_pÜt_mš
 57200;

190 
	g¹p_pÜt_max
 57300;

192 
	g¡»am_ÿ¡”
 {

193 
’abËd
 
	goff
;

194 
ÿ¡”
 
	gæv
;

195 
ouut
 
	g¹mp
:

196 
li¡’
 8936;

199 #############################################################################################
#RTMP/
HTTP
 
VHOST
 
£ùiÚs


200 #############################################################################################
#vho¡ 
li¡
, 
the
 
__deçuÉVho¡__
 
is
h 
vho¡


201 #fÜ 
exam¶e
, 
u£r
 
u£
 

 
to
 
acûss
 
the
 
¡»am
: 
¹mp
:

202 #fÜ 
which
 
ÿÂÙ
 
id’tify
 
the
 
»quœed
 
vho¡
.

203 
vho¡
 
	g__deçuÉVho¡__
 {

206 #th
£cur™y
 
to
 
®low
 
Ü
 
d’y
 
ş›Ás
.

207 
vho¡
 
	g£cur™y
.
	g¤s
.
	gcom
 {

208 #£cur™y 
ho¡
 
to
 
®low
 
Ü
 
d’y
 
ş›Ás
.

209 #@
£e
 
h‰ps
:

210 
	g£cur™y
 {

211 #wh‘h” 
’abË
 
the
 
£cur™y
 
vho¡
.

212 #deçuÉ: 
off


213 
’abËd
 
	gÚ
;

214 #th
£cur™y
 
li¡
, 
—ch
 
™em
 
fÜm©
 
as
:

215 #®low|
d’y
 
publish
|
¶ay
 
®l
|<

>

216 #fÜ 
exam¶e
:

217 #®low 
publish
 
®l
;

218 #d’y 
publish
 
®l
;

219 #®low 
publish
 127.0.0.1;

220 #d’y 
publish
 127.0.0.1;

221 #®low 
¶ay
 
®l
;

222 #d’y 
¶ay
 
®l
;

223 #®low 
¶ay
 127.0.0.1;

224 #d’y 
¶ay
 127.0.0.1;

225 #SRS 
­¶y
 
the
 
fŞlowšg
 
sim¶e
 
¡¿‹g›s
 
Úe
 
by
 one:

226 #1. 
®low
 
®l
 
£cur™y
 
di§bËd
.

227 #2.  
to
 
d’y
 
®l
 
wh’
 
£cur™y
 
’abËd
.

228 #3. 
®low
 
m©ches
‡Îow 
¡¿‹gy
.

229 #4. 
d’y
 
m©ches
 d’y 
¡¿‹gy
.

230 
®low
 
¶ay
 
	g®l
;

231 
®low
 
publish
 
	g®l
;

235 #th
MR
(
m”ged
-
»ad
è
£‰šg
 
publish”
.

236 #th
MW
(
m”ged
-
wr™e
è
£‰šgs
 
¶ay”
.

237 
vho¡
 
	gmrw
.
	g¤s
.
	gcom
 {

238 #wh‘h” 
’abË
 
mš
 
d–ay
 
mode
 
vho¡
.

239 #fÜ 
mš
 
Ï‹nû
 
mode
:

240 #1. 
di§bË
 
the
 
mr
 
vho¡
.

241 #2. 
u£
 
timeout
 
cÚd
 
wa™
 
cÚsum”
 
queue
.

242 #@
£e
 
h‰ps
:

243 #deçuÉ: 
off


244 
mš_Ï‹ncy
 
	goff
;

245 #abouˆ
MR
, 
»ad
 
h‰ps
:

246 
	gmr
 {

247 #wh‘h” 
’abË
 
the
 
MR
(
m”ged
-
»ad
)

248 #deçuÉ: 
off


249 
’abËd
 
	gÚ
;

250 #th
Ï‹ncy
 
š
 
ms
 
MR
(
m”ged
-
»ad
),

251 #th
³rfÜmªû
+ 
wh’
 
Ï‹ncy
+, 
ªd
 
memÜy
+,

252 #memÜy(
bufãr
èğ
Ï‹ncy
 * 
kbps
 / 8

253 #fÜ 
exam¶e
, 
Ï‹ncy
=500
ms
, 
kbps
=3000kbps, 
—ch
 
publish
 
cÚÃùiÚ
 
wl
 
cÚsume


254 #memÜy = 500 * 3000 / 8 = 187500B = 183
KB


255 #wh’ 
th”e
 
¬e
 2500 
publish”
, 
the
 
tÙ®
 
memÜy
 
of
 
SRS
 
©Ëa¡
:

256 #183
KB
 * 2500 = 446
MB


257 #th
v®ue
 
»comm’t
 
is
 [300, 2000]

259 
	gÏ‹ncy
 350;

261 #£ˆ
the
 
MW
(
m”ged
-
wr™e
è
Ï‹ncy
 
š
 
ms
.

262 #SRS 
®ways
 
£t
 
mw
 
Ú
, 
so
 
we
 
ju¡
 s‘ 
the
 
Ï‹ncy
 
v®ue
.

263 #th
Ï‹ncy
 
of
 
¡»am
 >ğ
mw_Ï‹ncy
 + 
mr_Ï‹ncy


264 #th
v®ue
 
»comm’t
 
is
 [300, 1800]

266 
	gmw_Ï‹ncy
 350;

269 #vho¡ 
edge
,ƒdg
ªd
 
Üigš
 
is
 
the
 
§me
 
vho¡


270 
vho¡
 
	g§me
.
	gedge
.
	g¤s
.
	gcom
 {

271 #th
mode
 
of
 
vho¡
, 
loÿl
 
Ü
 
»mÙe
.

272 #loÿl: 
vho¡
 
is
 
Üigš
 vho¡, 
which
 
´ovides
 
¡»am
 
sourû
.

273 #»mÙe: 
vho¡
 
is
 
edge
 vho¡, 
which
 
puÎ
/
push
 
to
 
Üigš
.

274 #deçuÉ: 
loÿl


275 
mode
 
	g»mÙe
;

276 #fÜ 
edge
(
»mÙe
 
mode
), 
u£r
 
mu¡
 
¥ecif›s
 
the
 
Üigš
 
£rv”


277 #fÜm© 
as
: <
£rv”_Çme
|

>[:
pÜt
]

278 #@
»m¬k
 
u£r
 
ÿn
 
¥ecif›s
 
muÉË
 
Üigš
 
”rÜ
 
backup
, 
by
 
¥aû
,

279 #fÜ 
exam¶e
, 192.168.1.100:1935 192.168.1.101:1935 192.168.1.102:1935

280 
	gÜigš
 127.0.0.1:1935 
loÿlho¡
:1935;

281 #fÜ 
edge
, 
wh‘h”
 
İ’
 
the
 
tok’
 
Œav”£
 
mode
,

282 #ià
tok’
 
Œav”£
 
Ú
, 
®l
 
cÚÃùiÚs
 
of
 
edge
 
wl
 
fÜw¬d
 
to
 
Üigš
Ø
check
(
auth
),

284 #th
b‘‹r
 
way
 
is
 
u£
 
h‰p
 
ÿÎback
 
to
 dØ
the
 
tok’
 
auth
 
by
h
edge
,

285 #buˆ
u£r
 
´eãr
 
Üigš
 
check
(
auth
), 
the
 
tok’_Œav”£
 
b‘‹r
 
sŞutiÚ
.

286 #deçuÉ: 
off


287 
tok’_Œav”£
 
	goff
;

290 #vho¡ 
edge
,ƒdg
ŒªsfÜm
 
vho¡
 
to
 
ãtch
 
äom
 
ªÙh”
 vhost.

291 
vho¡
 
	gŒªsfÜm
.
	gedge
.
	g¤s
.
	gcom
 {

292 
mode
 
	g»mÙe
;

293 
	gÜigš
 127.0.0.1:1935;

294 #th
vho¡
 
to
 
ŒªsfÜm
 
edge
,

295 #tØ
ãtch
 
äom
 
the
 
¥ecif›d
 
vho¡
 
©
 
Üigš
,

296 #ià
nÙ
 
¥ecif›d
, 
u£
 
the
 
cu¼’t
 
vho¡
 
of
 
edge
 
š
 
Üigš
,h
v¬ŸbË
 [vhost].

297 #deçuÉ: [
vho¡
]

298 
vho¡
 
	g§me
.
	gedge
.
	g¤s
.
	gcom
;

301 #vho¡ 
dvr


302 
vho¡
 
	gdvr
.
	g¤s
.
	gcom
 {

303 #dv¸
RTMP
 
¡»am
 
to
 
fe
,

304 #¡¬ˆ
to
 
»cÜd
Ø
fe
 
wh’
 
’cod”
 
publish
,

305 #»­ 
æv
 
accÜdšg
 
by
 
¥ecif›d
 
dvr_¶ª
.

306 
	gdvr
 {

307 #wh‘h” 
’abËd
 
dvr
 
ã©u»s


308 #deçuÉ: 
off


309 
’abËd
 
	gÚ
;

310 #th
dvr
 
¶ª
. 
ÿnbe
:

311 #£ssiÚ 
»­
 
æv
 
wh’
 
£ssiÚ
 
’d
(
uÅublish
).

312 #£gm’ˆ
»­
 
æv
 
wh’
 flv 
du¿tiÚ
 
exûed
 
the
 
¥ecif›d
 
dvr_du¿tiÚ
.

313 #­³nd 
®ways
 
­³nd
 
to
 
æv
 
fe
, 
Ãv”
 
»­
 
™
.

314 #deçuÉ: 
£ssiÚ


315 
dvr_¶ª
 
	g£ssiÚ
;

316 #th
dvr
 
ouut
 
·th
.

317 #w
suµÜts
 
some
 
v¬ŸbËs
 
to
 
g’”©e
 
the
 
f’ame
.

318 #[
vho¡
], 
the
 vho¡ 
of
 
¡»am
.

319 #[
­p
], 
the
‡µ 
of
 
¡»am
.

320 #[
¡»am
], 
the
 sŒ—m 
Çme
 
of
 stream.

321 #[2006], 
»¶aû
 
this
 cÚ¡ 
to
 
cu¼’t
 
y—r
.

322 #[01], 
»¶aû
 
this
 cÚ¡ 
to
 
cu¼’t
 
mÚth
.

323 #[02], 
»¶aû
 
this
 cÚ¡ 
to
 
cu¼’t
 
d©e
.

324 #[15], 
»¶aû
 
this
 cÚ¡ 
to
 
cu¼’t
 
hour
.

325 #[04], 
»¶—û
 
this
 cÚ¡ 
to
 
cu¼’t
 
mšu‹
.

326 #[05], 
»¶—û
 
this
 cÚ¡ 
to
 
cu¼’t
 
£cÚd
.

327 #[999], 
»¶—û
 
this
 cÚ¡ 
to
 
cu¼’t
 
mli£cÚd
.

328 #[
time¡amp
],
»¶aû
 
this
 cÚ¡ 
to
 
cu¼’t
 
UNIX
ime¡am°
š
 
ms
.

329 #@
»m¬k
 
we
 
u£
 
gŞªg
 
time
 
fÜm©
 "2006-01-02 15:04:05.999" 
as
 "[2006]-[01]-[02]_[15].[04].[05]_[999]"

330 #fÜ 
exam¶e
, 
u¾
 
¹mp
:

331 #1. 
No
 
v¬ŸbËs
, 
the
 
ruË
 
of
 
SRS1
.0×utØ
add
 [
¡»am
].[
time¡amp
].
æv
 
as
 
f’ame
):

332 #dvr_·th ./
objs
/
ngšx
/
html
;

334 #dvr_·th ./
objs
/
ngšx
/
html
/
live
/
live¡»am
.1420254068776.æ
v
;

335 #2. 
U£
 
¡»am
 
ªd
 
d©e
 
as
 
dœ
 
Çme
, 
time
‡ 
f’ame
:

336 #dvr_·th /
d©a
/[
vho¡
]/[
­p
]/[
¡»am
]/[2006]/[01]/[02]/[15].[04].[05].[999].
æv
;

338 #dvr_·th /
d©a
/
os¤s
.
Ãt
/
live
/
live¡»am
/2015/01/03/10.57.30.776.æ
v
;

339 #3. 
U£
 
¡»am
 
ªd
 
y—r
/
mÚth
 
as
 
dœ
 
Çme
, 
d©e
‡nd 
time
‡ 
f’ame
:

340 #dvr_·th /
d©a
/[
vho¡
]/[
­p
]/[
¡»am
]/[2006]/[01]/[02]-[15].[04].[05].[999].
æv
;

342 #dvr_·th /
d©a
/
os¤s
.
Ãt
/
live
/
live¡»am
/2015/01/03-10.57.30.776.æ
v
;

343 #4. 
U£
 
vho¡
/
­p
 
ªd
 
y—r
/
mÚth
 
as
 
dœ
 
Çme
, 
¡»am
/
d©e
/
time
‡ 
f’ame
:

344 #dvr_·th /
d©a
/[
vho¡
]/[
­p
]/[2006]/[01]/[
¡»am
]-[02]-[15].[04].[05].[999].
æv
;

346 #dvr_·th /
d©a
/
os¤s
.
Ãt
/
live
/2015/01/
live¡»am
-03-10.57.30.776.æ
v
;

347 #@
£e
 
h‰ps
:

348 #@
£e
 
h‰ps
:

349 #£gm’t,
£ssiÚ
 
­¶y
 
™
.

350 #deçuÉ: ./
objs
/
ngšx
/
html
/[
­p
]/[
¡»am
].[
time¡amp
].
æv


351 
	gdvr_·th
 ./
	gobjs
/
	gngšx
/
	ghtml
/[
­p
]/[
¡»am
].[
time¡amp
].
	gæv
;

352 #th
du¿tiÚ
 
dvr
 
fe
, 
»­
 
ex“d
, 
š
 
£cÚds
.

353 #£gm’ˆ
­¶y
 
™
.

354 #£ssiÚ,
­³nd
 
ignÜe
.

356 
	gdvr_du¿tiÚ
 30;

357 #wh‘h” 
wa™
 
keyäame
 
to
 
»­
 
£gm’t
,

358 #ià
off
, 
»­
 
£gm’t
 
wh’
 
du¿tiÚ
 
exûed
 
the
 
dvr_du¿tiÚ
,

359 #ià
Ú
, 
»­
 
£gm’t
 
wh’
 
du¿tiÚ
 
exûed
 
ªd
 
gÙ
 
keyäame
.

360 #£gm’ˆ
­¶y
 
™
.

361 #£ssiÚ,
­³nd
 
ignÜe
.

362 #deçuÉ: 
Ú


363 
dvr_wa™_keyäame
 
	gÚ
;

364 #abouˆ
the
 
¡»am
 
mÚÙÚiÿÎy
 
šü—sšg
:

365 #1. 
video
 
time¡amp
 
is
 
mÚÙÚiÿÎy
 
šü—sšg
,

366 #2. 
audio
 
time¡amp
 
is
 
mÚÙÚiÿÎy
 
šü—sšg
,

367 #3. 
video
 
ªd
 
audio
 
time¡amp
 
is
 
š‹¾—ved
 
mÚÙÚiÿÎy
 
šü—sšg
.

369 #howev”, 
some
 
’cod”
 
ÿÂÙ
 
´ovides
 
this
 
ã©u»
, 
¶—£
 
£t
hi 
to
 
off
Ø
ignÜe
 
time
 
j™‹r
.

370 #th
time
 
j™‹r
 
®gÜ™hm
:

371 #1. 
fuÎ
, 
to
 
’su»
 
¡»am
 
¡¬t
 
©
 
z”o
, 
ªd
ƒnsu» sŒ—m 
mÚÙÚiÿÎy
 
šü—sšg
.

372 #2. 
z”o
, 
Úly
 
’su»
 
¡Œ—m
 
¡¬t
 
©
 z”o, 
ignÜe
 
time¡amp
 
j™‹r
.

373 #3. 
off
, 
di§bË
 
the
 
time
 
j™‹r
 
®gÜ™hm
, 
like
 
©c
.

374 #­¶y 
®l
 
dvr
 
¶ª
.

375 #deçuÉ: 
fuÎ


376 
time_j™‹r
 
	gfuÎ
;

378 #Ú_dvr, 
Ãv”
 
cÚfig
 
š
 
h”e
, 
should
 cÚfig iÀ
h‰p_hooks
.

379 #fÜ 
the
 
dvr
 
h‰p
 
ÿÎback
, @
£e
 
h‰p_hooks
.
Ú_dvr
 
of
 
vho¡
 
hooks
.ÿÎback.
¤s
.
com


380 #@
»ad
 
h‰ps
:

381 #@
»ad
 
h‰ps
:

385 #vho¡ 
šge¡


386 
vho¡
 
	gšge¡
.
	g¤s
.
	gcom
 {

387 #šge¡ 
fe
/
¡»am
/
deviû
 
th’
 
push
 
to
 
SRS
 
ov”
 
RTMP
.

388 #th
Çme
/
id
 
u£d
 
to
 
id’tify
 
the
 
šge¡
, 
mu¡
 
be
 
unique
 
š
 
glob®
.

389 #šge¡ 
id
 
is
 
u£d
 
š
 
»lßd
 
Ü
 
h‰p
 
­i
 
mªagem’t
.

390 
šge¡
 
	glive¡»am
 {

391 #wh‘h” 
’abËd
 
šge¡
 
ã©u»s


392 #deçuÉ: 
off


393 
’abËd
 
	gÚ
;

394 #špuˆ
fe
/
¡»am
/
deviû


395 #@
»m¬k
 
Úly
 
suµÜt
 
Úe
 
šput
.

396 
	gšput
 {

397 #th
ty³
 
of
 
šput
.

398 #ÿÀ
be
 
fe
/
¡»am
/
deviû
, 
th©
 
is
,

399 #fe: 
šge¡
 
fe
 
¥ecif›s
 
by
 
u¾
.

400 #¡»am: 
šge¡
 
¡»am
 
¥eciãis
 
by
 
u¾
.

401 #deviû: 
nÙ
 
suµÜt
 
y‘
.

402 #deçuÉ: 
fe


403 
ty³
 
	gfe
;

404 #th
u¾
 
of
 
fe
/
¡»am
.

405 
	gu¾
 ./
	gdoc
/
	gsourû
.200
	gkbps
.768x320.æ
	gv
;

407 #th
ffm³g


408 
	gffm³g
 ./
	gobjs
/ffm³g/
	gbš
/ffmpeg;

409 #th
Œªscode
 
’gše
, @
£e
 
®l
.Œªscode.
¤s
.
com


410 #@
»m¬k
, 
the
 
ouut
 
is
 
¥ecif›d
 
fŞlowšg
.

411 
	g’gše
 {

412 #@
£e
 
’abËd
 
of
 
Œªscode
 
’gše
.

413 #ià
di§bËd
 
Ü
 
vcodec
/
acodec
 
nÙ
 
¥ecif›d
, 
u£
 
cİy
.

414 #deçuÉ: 
off
.

415 
’abËd
 
	goff
;

416 #ouuˆ
¡»am
. 
v¬ŸbËs
:

417 #[
vho¡
] 
cu¼’t
 vho¡ 
which
 
¡¬t
 
the
 
šge¡
.

418 #[
pÜt
] 
sy¡em
 
RTMP
 
¡»am
…ort.

419 
ouut
 
	g¹mp
:

424 #vho¡ 
h‰p
 
ªd
 
æv
 
vod
 
¡»am
 
—ch
 
vho¡
.

425 
vho¡
 
h‰p
..
¤s
.
com
 {

426 #h‰°
vho¡
 
¥ecif›d
 
cÚfig


427 
h‰p_¡©ic
 {

428 #wh‘h” 
’abËd
 
the
 
h‰p
 
£rviû
 
vho¡
.

429 #deçuÉ: 
off


430 
’abËd
 
Ú
;

431 #th
u¾
 
to
 
mouÁ
o,

432 #typiÿÈ
mouÁ
 
to
 [
vho¡
]/

433 #th
v¬ŸbËs
:

434 #[
vho¡
] 
cu¼’t
 vho¡ 
h‰p
 
£rv”
.

435 #@
»m¬k
 
the
 [
vho¡
] 
is
 
İtiÚ®
, 
u£d
 
to
 
mouÁ
 
©
 
¥ecif›d
 vhost.

436 #@
»m¬k
 
the
 
h‰p
 
of
 
__deçuÉVho¡__
 
wl
 
ov”ride
h
h‰p_£rv”
 
£ùiÚ
.

437 #fÜ 
exam¶e
:

438 #mouÁ 
to
 [
vho¡
]/

439 #acûs 
by
 
h‰p
:

440 #mouÁ 
to
 [
vho¡
]/
hls


441 #acûs 
by
 
h‰p
:

442 #mouÁ 
to
 /

443 #acûs 
by
 
h‰p
:

444 #Ü 
by
 
h‰p
:

445 #mouÁ 
to
 /
hls


446 #acûs 
by
 
h‰p
:

447 #Ü 
by
 
h‰p
:

448 #@
»m¬k
 
the
 
pÜt
 
of
 
h‰p
 
is
 
¥ecif›d
 
by
 
h‰p_£rv”
 
£ùiÚ
.

449 #deçuÉ: [
vho¡
]/

450 
	gmouÁ
 [
vho¡
]/
	ghls
;

451 #maš 
dœ
 
of
 
vho¡
,

452 #tØ
d–iv”y
 
HTTP
 
¡»am
 
of
 
this
 
vho¡
.

453 #deçuÉ: ./
objs
/
ngšx
/
html


454 
	gdœ
 ./
	gobjs
/
	gngšx
/
	ghtml
/
	ghls
;

458 #vho¡ 
h‰p
 
æv
/
¯c
/
mp3
 
live
 
¡»am
 
—ch
 
vho¡
.

459 
vho¡
 
	gh‰p
.
	g»mux
.
	g¤s
.
	gcom
 {

460 #h‰°
æv
/
mp3
/
¯c
/
ts
 
¡»am
 
vho¡
 
¥ecif›d
 
cÚfig


461 
	gh‰p_»mux
 {

462 #wh‘h” 
’abË
 
the
 
h‰p
 
live
 
¡»amšg
 
£rviû
 
vho¡
.

463 #deçuÉ: 
off


464 
’abËd
 
	gÚ
;

465 #th
ç¡
 
ÿche
 
audio
 
¡»am
(
mp3
/
¯c
),

466 #tØ
ÿche
 
mÜe
 
audio
 
ªd
 
£nd
 
to
 
ş›Á
 
š
 
a
 
time
Ø
make
 
ªdroid
(
weixš
è
h­py
.

467 #@
»m¬k
 
the
 
æv
/
ts
 
¡»am
 
ignÜe
 
™


468 #@
»m¬k
 0 
to
 
di§bË
 
ç¡
 
ÿche
 
h‰p
 
audio
 
¡»am
.

470 
	gç¡_ÿche
 30;

471 #th
¡»am
 
mout
 
¹mp
 
to
 
»mux
Ø
live
 
¡»amšg
.

472 #typiÿÈ
mouÁ
 
to
 [
vho¡
]/[
­p
]/[
¡»am
].
æv


473 #th
v¬ŸbËs
:

474 #[
vho¡
] 
cu¼’t
 vho¡ 
h‰p
 
live
 
¡»am
.

475 #[
­p
] 
cu¼’t
‡µ 
h‰p
 
live
 
¡»am
.

476 #[
¡»am
] 
cu¼’t
 sŒ—m 
h‰p
 
live
 stream.

477 #@
»m¬k
 
the
 [
vho¡
] 
is
 
İtiÚ®
, 
u£d
 
to
 
mouÁ
 
©
 
¥ecif›d
 vhost.

478 #th
ex‹nsiÚ
:

479 #.
æv
 
mouÁ
 
h‰p
 
live
 flv 
¡»am
, 
u£
  
gİ
 
ÿche
.

480 #.
ts
 
mouÁ
 
h‰p
 
live
 
¡»am
, 
u£
  
gİ
 
ÿche
.

481 #.
mp3
 
mouÁ
 
h‰p
 
live
 mp3 
¡»am
, 
ignÜe
 
video
 
ªd
 
audio
 mp3 
codec
 
»quœed
.

482 #.
¯c
 
mouÁ
 
h‰p
 
live
‡aø
¡»am
, 
ignÜe
 
video
 
ªd
 
audio
‡aø
codec
 
»quœed
.

483 #fÜ 
exam¶e
:

484 #mouÁ 
to
 [
vho¡
]/[
­p
]/[
¡»am
].
æv


485 #acûs 
by
 
h‰p
:

486 #mouÁ 
to
 /[
­p
]/[
¡»am
].
æv


487 #acûs 
by
 
h‰p
:

488 #Ü 
by
 
h‰p
:

489 #mouÁ 
to
 [
vho¡
]/[
­p
]/[
¡»am
].
mp3


490 #acûs 
by
 
h‰p
:

491 #mouÁ 
to
 [
vho¡
]/[
­p
]/[
¡»am
].
¯c


492 #acûs 
by
 
h‰p
:

493 #mouÁ 
to
 [
vho¡
]/[
­p
]/[
¡»am
].
ts


494 #acûs 
by
 
h‰p
:

495 #@
»m¬k
 
the
 
pÜt
 
of
 
h‰p
 
is
 
¥ecif›d
 
by
 
h‰p_£rv”
 
£ùiÚ
.

496 #deçuÉ: [
vho¡
]/[
­p
]/[
¡»am
].
æv


497 
	gmouÁ
 [
vho¡
]/[
­p
]/[
¡»am
].
	gæv
;

498 #wh‘h” 
h‰p
 
¡»am
 
Œigg”
 
¹mp
 sŒ—m 
sourû
 
wh’
 
no
 sŒ—m 
avaabË
,

499 #fÜ 
exam¶e
, 
wh’
 
’cod”
 
has
 
nÙ
 
publish
 
¡»am
 
y‘
,

500 #u£¸
ÿn
 
¶ay
 
the
 
h‰p
 
æv
 
¡»am
 
ªd
 
wa™
 stream.

501 #deçuÉ: 
Ú


502 
h¡rs
 
	gÚ
;

506 #th
vho¡
 
w™h
 
hls
 
¥ecif›d
.

507 
vho¡
 
	gw™h
-
	ghls
.
	g¤s
.
	gcom
 {

508 
	ghls
 {

509 #wh‘h” 
the
 
hls
 
is
 
’abËd
.

510 #ià
off
, 
dÚÙ
 
wr™e
 
hls
(
ts
 
ªd
 
m3u8
è
wh’
 
publish
.

511 #deçuÉ: 
off


512 
’abËd
 
	gÚ
;

513 #th
hls
 
äagm’t
 
š
 
£cÚds
, 
the
 
du¿tiÚ
 
of
 
a
 
p›û
 oà
ts
.

515 
	ghls_äagm’t
 10;

516 #th
hls
 
m3u8
 
rg‘
 
du¿tiÚ
 
¿tio
,

517 #EXT-
X
-
TARGETDURATION
 = 
hls_td_¿tio
 * 
hls_äagm’t


518 #EXT-
X
-
TARGETDURATION
 = 
max
(
ts_du¿tiÚ
, 
EXT
-X-TARGETDURATION)

519 #@
£e
 
h‰ps
:

521 
	ghls_td_¿tio
 1.5;

522 #th
audio
 
ov”æow
 
¿tio
.

523 #fÜ 
pu»
 
audio
, 
the
 
du¿tiÚ
 
to
 
»­
h
£gm’t
.

524 #fÜ 
exam¶e
, 
the
 
hls_äagm’t
 
is
 10
s
, 
h¦_aof_¿tio
 is 2.0,

525 #th
£gemÁ
 
wl
 
»­
 
to
 20
s
 
pu»
 
audio
.

527 
	ghls_aof_¿tio
 2.0;

528 #th
hls
 
wšdow
 
š
 
£cÚds
, 
the
 
numb”
 
of
 
ts
 iÀ
m3u8
.

530 
	ghls_wšdow
 60;

531 #th
”rÜ
 
¡¿‹gy
. 
ÿnbe
:

532 #ignÜe, 
di§bË
 
the
 
hls
.

533 #discÚÃù, 
»quœe
 
’cod”
 
»publish
.

534 #cÚtšue, 
ignÜe
 
çed
 
Œy
 
to
  
ouut
 
hls
.

535 #@
£e
 
h‰ps
:

537 
hls_Ú_”rÜ
 ;

538 #th
hls
 
¡Üage
: 
disk
, 
¿m
 
Ü
 
bÙh
.

539 #disk, 
to
 
wr™e
 
hls
 
m3u8
/
ts
Ø
disk
.

540 #¿m, 
£rve
 
m3u8
/
ts
 
š
 
memÜy
, 
which
 
u£
 
embeded
 
h‰p
 
£rv”
 
to
 
d–iv”y
.

541 #bÙh, 
disk
 
ªd
 
¿m
.

542 #deçuÉ: 
disk


543 
hls_¡Üage
 
	gdisk
;

544 #th
hls
 
ouut
 
·th
.

545 #th
m3u8
 
fe
 
is
 
cÚfiged
 
by
 
hls_·th
/
hls_m3u8_fe
, 
the
  is:

546 #./
objs
/
ngšx
/
html
/[
­p
]/[
¡»am
].
m3u8


547 #th
ts
 
fe
 
is
 
cÚfiged
 
by
 
hls_·th
/
hls_ts_fe
, 
the
  is:

548 #./
objs
/
ngšx
/
html
/[
­p
]/[
¡»am
]-[
£q
].
ts


549 #@
»m¬k
 
the
 
hls_·th
 
is
 
com·tibË
 
w™h
 
¤s
 
v1
 
cÚfig
.

550 #deçuÉ: ./
objs
/
ngšx
/
html


551 
	ghls_·th
 ./
	gobjs
/
	gngšx
/
	ghtml
;

552 #th
hls
 
m3u8
 
fe
 
Çme
.

553 #w
suµÜts
 
some
 
v¬ŸbËs
 
to
 
g’”©e
 
the
 
f’ame
.

554 #[
vho¡
], 
the
 vho¡ 
of
 
¡»am
.

555 #[
­p
], 
the
‡µ 
of
 
¡»am
.

556 #[
¡»am
], 
the
 sŒ—m 
Çme
 
of
 stream.

557 #deçuÉ: [
­p
]/[
¡»am
].
m3u8


558 
	ghls_m3u8_fe
 [
­p
]/[
¡»am
].
	gm3u8
;

559 #th
hls
 
ts
 
fe
 
Çme
.

560 #w
suµÜts
 
some
 
v¬ŸbËs
 
to
 
g’”©e
 
the
 
f’ame
.

561 #[
vho¡
], 
the
 vho¡ 
of
 
¡»am
.

562 #[
­p
], 
the
‡µ 
of
 
¡»am
.

563 #[
¡»am
], 
the
 sŒ—m 
Çme
 
of
 stream.

564 #[2006], 
»¶aû
 
this
 cÚ¡ 
to
 
cu¼’t
 
y—r
.

565 #[01], 
»¶aû
 
this
 cÚ¡ 
to
 
cu¼’t
 
mÚth
.

566 #[02], 
»¶aû
 
this
 cÚ¡ 
to
 
cu¼’t
 
d©e
.

567 #[15], 
»¶aû
 
this
 cÚ¡ 
to
 
cu¼’t
 
hour
.

568 #[04], 
»¶—û
 
this
 cÚ¡ 
to
 
cu¼’t
 
mšu‹
.

569 #[05], 
»¶—û
 
this
 cÚ¡ 
to
 
cu¼’t
 
£cÚd
.

570 #[999], 
»¶—û
 
this
 cÚ¡ 
to
 
cu¼’t
 
mli£cÚd
.

571 #[
time¡amp
],
»¶aû
 
this
 cÚ¡ 
to
 
cu¼’t
 
UNIX
ime¡am°
š
 
ms
.

572 #[
£q
], 
the
 
£qu’û
 
numb”
 
of
 
ts
.

573 #@
£e
 
h‰ps
:

574 #@
£e
 
h‰ps
:

575 #deçuÉ: [
­p
]/[
¡»am
]-[
£q
].
ts


576 
	ghls_ts_fe
 [
­p
]/[
¡»am
]-[
£q
].
	gts
;

577 #wh‘h” 
u£
 
æoÜ
 
the
 
hls_ts_fe
 
·th
 
g’”©iÚ
.

578 #ià
Ú
, 
u£
 
æoÜ
(
time¡amp
/
hls_äagm’t
è
as
 
the
 
v¬ŸbË
 [timestamp],

579 #ªd 
u£
 
’ahªûd
 
®gÜ™hm
 
to
 
ÿlc
 
devŸtiÚ
 
£gm’t
.

580 #@
»m¬k
 
wh’
 
æoÜ
 
Ú
, 
»comm’d
 
the
 
hls_£gm’t
>=2*
gİ
.

581 #deçuÉ: 
off


582 
hls_ts_æoÜ
 
	goff
;

583 #th
hls
 
’Œy
 
´efix
, 
which
 
is
 
ba£
 
u¾
 
of
 
ts
 url.

584 #ià
¥ecif›d
, 
the
 
ts
 
·th
 
š
 
m3u8
 
wl
 
be
 
like
:

588 #İtiÚ®,  
to
 
em±y
 
¡ršg
.

589 
hls_’Œy_´efix
 
	gh‰p
:

590 #th
hls
 
mouÁ
 
hls_¡Üage
 
¿m
,

591 #which 
u£
 
¤s
 
embeded
 
h‰p
 
£rv”
 
to
 
d–iv”y
 
HLS
,

592 #wh”
the
 
mouÁ
 
¥ecif›s
h
HTTP
 
u¾
 
to
 mount.

593 #@
£e
 
the
 
mouÁ
 
of
 
h‰p_»mux
.

594 #@
»m¬k
 
the
 
hls_mouÁ
 
mu¡
 
’dsw™h
 .
m3u8
.

595 #deçuÉ: [
vho¡
]/[
­p
]/[
¡»am
].
m3u8


596 
	ghls_mouÁ
 [
vho¡
]/[
­p
]/[
¡»am
].
	gm3u8
;

597 #th 
audio
 
codec
 
of
 
hls
.

598 #wh’ 
codec
 
chªged
, 
wr™e
 
the
 
PAT
/
PMT
 
bË
, 
but
 
maybe
 
ok
 
ut
 
Ãxt
 
ts
.

599 #sØ
u£r
 
ÿn
 
£t
 
the
  
codec
 
mp3
.

600 #th
avaabË
 
audio
 
codec
:

601 #¯c, 
mp3
, 
ª


602 #deçuÉ: 
¯c


603 
hls_acodec
 
	g¯c
;

604 #th 
video
 
codec
 
of
 
hls
.

605 #wh’ 
codec
 
chªged
, 
wr™e
 
the
 
PAT
/
PMT
 
bË
, 
but
 
maybe
 
ok
 
ut
 
Ãxt
 
ts
.

606 #sØ
u£r
 
ÿn
 
£t
 
the
  
codec
 
pu»
 
audio
(
w™hout
 
video
è
to
 
vn
.

607 #th
avaabË
 
video
 
codec
:

608 #h264, 
vn


609 #deçuÉ: 
h264


610 
hls_vcodec
 
	gh264
;

611 #wh‘h” 
ş—nup
 
the
 
Şd
 
expœed
 
ts
 
fes
.

612 #deçuÉ: 
Ú


613 
hls_ş—nup
 
	gÚ
;

614 #th
timeout
 
š
 
£cÚds
 
to
 
di¥o£
 
the
 
hls
,

615 #di¥o£ 
is
 
to
 
»move
 
®l
 
hls
 
fes
, 
m3u8
 
ªd
 
ts
 files.

616 #wh’ 
publish”
 
timeout
 
di¥o£
 
hls
.

617 #@
»m¬k
 0 
to
 
di§bË
 
di¥o£
 
publish”
.

618 #@
»m¬k
 
­¶y
 
publish”
 
timeout
 
Úly
, "‘c/š™.d/¤ ¡İ" 
®ways
 
di¥o£
 
hls
.

620 
	ghls_di¥o£
 0;

621 #th
max
 
size
 
to
 
nÙify
 
hls
,

622 #tØ
»ad
 
max
 
by‹s
 
äom
 
ts
 
of
 
¥ecif›d
 
cdn
 
ÃtwÜk
,

623 #@
»m¬k
 
Úly
 
u£d
 
wh’
 
Ú_hls_nÙify
 
is
 
cÚfig
.

625 
	ghls_nb_nÙify
 64;

626 #wh‘h” 
wa™
 
keyäame
 
to
 
»­
 
£gm’t
,

627 #ià
off
, 
»­
 
£gm’t
 
wh’
 
du¿tiÚ
 
exûed
 
the
 
äagm’t
,

628 #ià
Ú
, 
»­
 
£gm’t
 
wh’
 
du¿tiÚ
 
exûed
 
ªd
 
gÙ
 
keyäame
.

629 #deçuÉ: 
Ú


630 
hls_wa™_keyäame
 
	gÚ
;

632 #Ú_hls, 
Ãv”
 
cÚfig
 
š
 
h”e
, 
should
 cÚfig iÀ
h‰p_hooks
.

633 #fÜ 
the
 
hls
 
h‰p
 
ÿÎback
, @
£e
 
h‰p_hooks
.
Ú_hls
 
of
 
vho¡
 
hooks
.ÿÎback.
¤s
.
com


634 #@
»ad
 
h‰ps
:

635 #@
»ad
 
h‰ps
:

637 #Ú_hls_nÙify, 
Ãv”
 
cÚfig
 
š
 
h”e
, 
should
 cÚfig iÀ
h‰p_hooks
.

638 #w
suµÜt
 
the
 
v¬ŸbËs
 
to
 
g’”©e
h
nÙify
 
u¾
:

639 #[
­p
], 
»¶aû
 
w™h
 
the
‡pp.

640 #[
¡»am
], 
»¶aû
 
w™h
 
the
 stream.

641 #[
ts_u¾
], 
»¶aû
 
w™h
 
the
 
ts
 
u¾
.

642 #fÜ 
the
 
hls
 
h‰p
 
ÿÎback
, @
£e
 
h‰p_hooks
.
Ú_hls_nÙify
 
of
 
vho¡
 
hooks
.ÿÎback.
¤s
.
com


643 #@
»ad
 
h‰ps
:

644 #@
»ad
 
h‰ps
:

647 #th
vho¡
 
w™h
 
hls
 
di§bËd
.

648 
vho¡
 
	gno
-
	ghls
.
	g¤s
.
	gcom
 {

649 
	ghls
 {

650 #wh‘h” 
the
 
hls
 
is
 
’abËd
.

651 #ià
off
, 
dÚÙ
 
wr™e
 
hls
(
ts
 
ªd
 
m3u8
è
wh’
 
publish
.

652 #deçuÉ: 
off


653 
’abËd
 
	goff
;

657 #th
vho¡
 
w™h
 
adobe
 
hds


658 
vho¡
 
	ghds
.
	g¤s
.
	gcom
 {

659 
	ghds
 {

660 #wh‘h” 
hds
 
’abËd


661 #deçuÉ: 
off


662 
’abËd
 
	gÚ
;

663 #th
hds
 
äagm’t
 
š
 
£cÚds
.

665 
	ghds_äagm’t
 10;

666 #th
hds
 
wšdow
 
š
 
£cÚds
, 
”a£
 
the
 
£gm’t
 
wh’
 
exûed
he window.

668 
	ghds_wšdow
 60;

669 #th
·th
 
to
 
¡Üe
 
the
 
hds
 
fes
.

670 #deçuÉ: ./
objs
/
ngšx
/
html


671 
	ghds_·th
 ./
	gobjs
/
	gngšx
/
	ghtml
;

675 #th
h‰p
 
hook
 
ÿÎback
 
vho¡
, 
¤s
 
wl
 
švoke
 
the
 
hooks
 
¥ecif›d
 
ev’ts
.

676 
vho¡
 
	ghooks
.
	gÿÎback
.
	g¤s
.
	gcom
 {

677 
	gh‰p_hooks
 {

678 #wh‘h” 
the
 
h‰p
 
hooks
 
’®be
.

679 #deçuÉ 
off
.

680 
’abËd
 
	gÚ
;

681 #wh’ 
ş›Á
 
cÚÃù
 
to
 
vho¡
/
­p
, 
ÿÎ
 
the
 
hook
,

682 #th
»que¡
 
š
 
the
 
POST
 
d©a
 
¡ršg
 
is
 
a
 
objeù
 
’code
 
by
 
jsÚ
:

684 #"
aùiÚ
": "
Ú_cÚÃù
",

685 #"
ş›Á_id
": 1985,

686 #"

": "192.168.1.10", "
vho¡
": "
video
.
‹¡
.
com
", "
­p
": "
live
",

687 #"
tcU¾
": "
¹mp
:

688 #"
·geU¾
": "
h‰p
:

690 #ià
v®id
, 
the
 
hook
 
mu¡
  
HTTP
 
code
 200(
Suts
 
OK
è
ªd
 
»¥Ú£


691 #ª 
v®ue
 
¥ecif›s
 
the
 
”rÜ
 
code
(0 
cÜ»¥Údšg
 
to
 
sucûss
):

693 #suµÜˆ
muÉË
 
­i
 
hooks
, 
fÜm©
:

694 #Ú_cÚÃù 
h‰p
:

695 
Ú_cÚÃù
 
	gh‰p
:

696 #wh’ 
ş›Á
 
şo£
/
discÚÃù
 
to
 
vho¡
/
­p
/
¡»am
, 
ÿÎ
 
the
 
hook
,

697 #th
»que¡
 
š
 
the
 
POST
 
d©a
 
¡ršg
 
is
 
a
 
objeù
 
’code
 
by
 
jsÚ
:

699 #"
aùiÚ
": "
Ú_şo£
",

700 #"
ş›Á_id
": 1985,

701 #"

": "192.168.1.10", "
vho¡
": "
video
.
‹¡
.
com
", "
­p
": "
live
",

702 #"
£nd_by‹s
": 10240, "
»cv_by‹s
": 10240

704 #ià
v®id
, 
the
 
hook
 
mu¡
  
HTTP
 
code
 200(
Suts
 
OK
è
ªd
 
»¥Ú£


705 #ª 
v®ue
 
¥ecif›s
 
the
 
”rÜ
 
code
(0 
cÜ»¥Údšg
 
to
 
sucûss
):

707 #suµÜˆ
muÉË
 
­i
 
hooks
, 
fÜm©
:

708 #Ú_şo£ 
h‰p
:

709 
Ú_şo£
 
	gh‰p
:

710 #wh’ 
ş›Á
(
’cod”
è
publish
 
to
 
vho¡
/
­p
/
¡»am
, 
ÿÎ
 
the
 
hook
,

711 #th
»que¡
 
š
 
the
 
POST
 
d©a
 
¡ršg
 
is
 
a
 
objeù
 
’code
 
by
 
jsÚ
:

713 #"
aùiÚ
": "
Ú_publish
",

714 #"
ş›Á_id
": 1985,

715 #"

": "192.168.1.10", "
vho¡
": "
video
.
‹¡
.
com
", "
­p
": "
live
",

716 #"
¡»am
": "
live¡»am
"

718 #ià
v®id
, 
the
 
hook
 
mu¡
  
HTTP
 
code
 200(
Suts
 
OK
è
ªd
 
»¥Ú£


719 #ª 
v®ue
 
¥ecif›s
 
the
 
”rÜ
 
code
(0 
cÜ»¥Údšg
 
to
 
sucûss
):

721 #suµÜˆ
muÉË
 
­i
 
hooks
, 
fÜm©
:

722 #Ú_publish 
h‰p
:

723 
Ú_publish
 
	gh‰p
:

724 #wh’ 
ş›Á
(
’cod”
è
¡İ
 
publish
 
to
 
vho¡
/
­p
/
¡»am
, 
ÿÎ
 
the
 
hook
,

725 #th
»que¡
 
š
 
the
 
POST
 
d©a
 
¡ršg
 
is
 
a
 
objeù
 
’code
 
by
 
jsÚ
:

727 #"
aùiÚ
": "
Ú_uÅublish
",

728 #"
ş›Á_id
": 1985,

729 #"

": "192.168.1.10", "
vho¡
": "
video
.
‹¡
.
com
", "
­p
": "
live
",

730 #"
¡»am
": "
live¡»am
"

732 #ià
v®id
, 
the
 
hook
 
mu¡
  
HTTP
 
code
 200(
Suts
 
OK
è
ªd
 
»¥Ú£


733 #ª 
v®ue
 
¥ecif›s
 
the
 
”rÜ
 
code
(0 
cÜ»¥Údšg
 
to
 
sucûss
):

735 #suµÜˆ
muÉË
 
­i
 
hooks
, 
fÜm©
:

736 #Ú_uÅublish 
h‰p
:

737 
Ú_uÅublish
 
	gh‰p
:

738 #wh’ 
ş›Á
 
¡¬t
 
to
 
¶ay
 
vho¡
/
­p
/
¡»am
, 
ÿÎ
 
the
 
hook
,

739 #th
»que¡
 
š
 
the
 
POST
 
d©a
 
¡ršg
 
is
 
a
 
objeù
 
’code
 
by
 
jsÚ
:

741 #"
aùiÚ
": "
Ú_¶ay
",

742 #"
ş›Á_id
": 1985,

743 #"

": "192.168.1.10", "
vho¡
": "
video
.
‹¡
.
com
", "
­p
": "
live
",

744 #"
¡»am
": "
live¡»am
",

745 #"
·geU¾
": "
h‰p
:

747 #ià
v®id
, 
the
 
hook
 
mu¡
  
HTTP
 
code
 200(
Suts
 
OK
è
ªd
 
»¥Ú£


748 #ª 
v®ue
 
¥ecif›s
 
the
 
”rÜ
 
code
(0 
cÜ»¥Údšg
 
to
 
sucûss
):

750 #suµÜˆ
muÉË
 
­i
 
hooks
, 
fÜm©
:

751 #Ú_¶ay 
h‰p
:

752 
Ú_¶ay
 
	gh‰p
:

753 #wh’ 
ş›Á
 
¡İ
 
to
 
¶ay
 
vho¡
/
­p
/
¡»am
, 
ÿÎ
 
the
 
hook
,

754 #th
»que¡
 
š
 
the
 
POST
 
d©a
 
¡ršg
 
is
 
a
 
objeù
 
’code
 
by
 
jsÚ
:

756 #"
aùiÚ
": "
Ú_¡İ
",

757 #"
ş›Á_id
": 1985,

758 #"

": "192.168.1.10", "
vho¡
": "
video
.
‹¡
.
com
", "
­p
": "
live
",

759 #"
¡»am
": "
live¡»am
"

761 #ià
v®id
, 
the
 
hook
 
mu¡
  
HTTP
 
code
 200(
Suts
 
OK
è
ªd
 
»¥Ú£


762 #ª 
v®ue
 
¥ecif›s
 
the
 
”rÜ
 
code
(0 
cÜ»¥Údšg
 
to
 
sucûss
):

764 #suµÜˆ
muÉË
 
­i
 
hooks
, 
fÜm©
:

765 #Ú_¡İ 
h‰p
:

766 
Ú_¡İ
 
	gh‰p
:

767 #wh’ 
¤s
 
»­
 
a
 
dvr
 
fe
, 
ÿÎ
 
the
 
hook
,

768 #th
»que¡
 
š
 
the
 
POST
 
d©a
 
¡ršg
 
is
 
a
 
objeù
 
’code
 
by
 
jsÚ
:

770 #"
aùiÚ
": "
Ú_dvr
",

771 #"
ş›Á_id
": 1985,

772 #"

": "192.168.1.10", "
vho¡
": "
video
.
‹¡
.
com
", "
­p
": "
live
",

773 #"
¡»am
": "
live¡»am
",

774 #"
cwd
": "/
u¤
/
loÿl
/
¤s
",

775 #"
fe
": "./
objs
/
ngšx
/
html
/
live
/
live¡»am
.1420254068776.æ
v
"

777 #ià
v®id
, 
the
 
hook
 
mu¡
  
HTTP
 
code
 200(
Suts
 
OK
è
ªd
 
»¥Ú£


778 #ª 
v®ue
 
¥ecif›s
 
the
 
”rÜ
 
code
(0 
cÜ»¥Údšg
 
to
 
sucûss
):

780 
Ú_dvr
 
	gh‰p
:

781 #wh’ 
¤s
 
»­
 
a
 
ts
 
fe
 
of
 
hls
, 
ÿÎ
 
the
 
hook
,

782 #th
»que¡
 
š
 
the
 
POST
 
d©a
 
¡ršg
 
is
 
a
 
objeù
 
’code
 
by
 
jsÚ
:

784 #"
aùiÚ
": "
Ú_hls
",

785 #"
ş›Á_id
": 1985,

786 #"

": "192.168.1.10", "
vho¡
": "
video
.
‹¡
.
com
", "
­p
": "
live
",

787 #"
¡»am
": "
live¡»am
",

788 #"
du¿tiÚ
": 9.36, // in seconds

789 #"
cwd
": "/
u¤
/
loÿl
/
¤s
",

790 #"
fe
": "./
objs
/
ngšx
/
html
/
live
/
live¡»am
/2015-04-23/01/476584165.
ts
",

791 #"
u¾
": "
live
/
live¡»am
/2015-04-23/01/476584165.
ts
",

792 #"
m3u8
": "./
objs
/
ngšx
/
html
/
live
/
live¡»am
/live.m3u8",

793 #"
m3u8_u¾
": "
live
/
live¡»am
/live.
m3u8
",

794 #"
£q_no
": 100

796 #ià
v®id
, 
the
 
hook
 
mu¡
  
HTTP
 
code
 200(
Suts
 
OK
è
ªd
 
»¥Ú£


797 #ª 
v®ue
 
¥ecif›s
 
the
 
”rÜ
 
code
(0 
cÜ»¥Údšg
 
to
 
sucûss
):

799 
Ú_hls
 
	gh‰p
:

800 #wh’ 
¤s
 
»­
 
a
 
ts
 
fe
 
of
 
hls
, 
ÿÎ
 
this
 
hook
,

801 #u£d 
to
 
push
 
fe
Ø
cdn
 
ÃtwÜk
, 
by
 
g‘
 
the
 
ts
 f
äom
 cdn‚etwork.

802 #sØ
we
 
u£
 
HTTP
 
GET
 
ªd
 u£ 
the
 
v¬ŸbË
 
fŞlowšg
:

803 #[
­p
], 
»¶aû
 
w™h
 
the
‡pp.

804 #[
¡»am
], 
»¶aû
 
w™h
 
the
 stream.

805 #[
ts_u¾
], 
»¶aû
 
w™h
 
the
 
ts
 
u¾
.

806 #ignÜ
ªy
  
d©a
 
of
 
£rv”
.

807 #@
»m¬k
 
¿ndom
 
£Ëù
 
a
 
u¾
 
to
 
»pÜt
, 
nÙ
„•Üˆ
®l
.

808 
Ú_hls_nÙify
 
	gh‰p
:

812 #th
vho¡
 
¤s
 
debug
 
šfo
, 
wh‘h”
 
£nd
 
¬gs
 
š
 
cÚÃù
(
tcU¾
).

813 
vho¡
 
	gdebug
.
	g¤s
.
	gcom
 {

814 #wh’ 
u²ode
(
fÜw¬d
 
to
, 
edge
 
push
o,ƒdg
puÎ
 
äom
è
is
 
¤s
,

816 #wh’ 
cÚÃù
 
to
 
u²ode
, 
™
 
wl
 
ke
 
the
 
debug
 
šfo
,

817 #fÜ 
exam¶e
, 
the
 
id
, 
sourû
 id, 
pid
.

818 #¶—£ 
£e
: 
h‰ps
:

819 #deçuÉ: 
Ú


820 
debug_¤s_u²ode
 
	gÚ
;

823 #th
vho¡
 
mš
 
d–ay
, 
dÚÙ
 
ÿche
 
ªy
 
¡»am
.

824 
vho¡
 
	gmš
.
	gd–ay
.
	gcom
 {

825 #@
£e
 
vho¡
 
mrw
.
¤s
.
com
 
d‘a
.

826 
mš_Ï‹ncy
 
	gÚ
;

827 
	gmr
 {

828 
’abËd
 
	goff
;

830 
	gmw_Ï‹ncy
 100;

831 #wh‘h” 
ÿche
 
the
 
Ï¡
 
gİ
.

832 #ià
Ú
, 
ÿche
 
the
 
Ï¡
 
gİ
 
ªd
 
di¥©ch
 
to
 
ş›Á
,

833 #tØ
’abËd
 
ç¡
 
¡¬tup
 
ş›Á
, cl›Á 
¶ay
 
immedŸ‹ly
.

834 #ià
off
, 
£nd
 
the
 
Ï‹¡
 
medŸ
 
d©a
 
to
 
ş›Á
,

835 #ş›Á 
Ãed
 
to
 
wa™
 
the
 
Ãxt
 
Iäame
Ø
decode
 
ªd
 
show
h
video
.

836 #£ˆ
to
 
off
 
»quœes
 
mš
 
d–ay
;

837 #£ˆ
to
 
Ú
 
»quœes
 
ş›Á
 
ç¡
 
¡¬tup
.

838 #deçuÉ: 
Ú


839 
gİ_ÿche
 
	goff
;

840 #th
max
 
live
 
queue
 
Ëngth
 
š
 
£cÚds
.

841 #ià
the
 
mes§ges
 
š
h
queue
 
exûed
h
max
 
Ëngth
,

842 #drİ 
the
 
Şd
 
whŞe
 
gİ
.

844 
	gqueue_Ëngth
 10;

845 #wh‘h” 
’abË
 
the
 
TCP_NODELAY


846 #ià
Ú
, 
£t
 
the
 
nod–ay
 
of
 
fd
 
by
 
£tsockİt


847 #deçuÉ: 
off


848 
tı_nod–ay
 
	gÚ
;

851 #wh‘h” 
di§bË
 
the
 
¥s
 
·r£
, th
»sŞutiÚ
 
of
 
video
.

852 
vho¡
 
	gno
.
	g·r£
.
	g¥s
.
	gcom
 {

853 
	gpublish
 {

854 #wh‘h” 
·r£
 
the
 
¥s
 
wh’
 
publish
 
¡»am
.

855 #w
ÿn
 
gÙ
 
the
 
»sŞutiÚ
 
of
 
video
 
¡©
 
­i
.

856 #buˆ
we
 
may
 
çed
 
to
 
ÿu£
 
publish
 failed.

857 #deçuÉ: 
Ú


858 
·r£_¥s
 
	gÚ
;

862 #th
vho¡
 
to
 
cÚŒŞ
 
the
 
¡»am
 
d–iv”y
 
ã©u»


863 
vho¡
 
	g¡»am
.
	gcÚŒŞ
.
	gcom
 {

864 #@
£e
 
vho¡
 
mrw
.
¤s
.
com
 
d‘a
.

865 
mš_Ï‹ncy
 
	gÚ
;

866 
	gmr
 {

867 
’abËd
 
	goff
;

869 
	gmw_Ï‹ncy
 100;

870 #@
£e
 
vho¡
 
mš
.
d–ay
.
com


871 
	gqueue_Ëngth
 10;

872 
tı_nod–ay
 
	gÚ
;

873 #th
mšim®
 
·ck‘s
 
£nd
 
š‹rv®
 
š
 
ms
,

874 #u£d 
to
 
cÚŒŞ
 
the
 
ndiff
 
of
 
¡»am
 
by
 
¤s_¹mp_dump
,

875 #fÜ 
exam¶e
, 
some
 
deviû
 
ÿn
 
Úly
 
acû±
 som
¡»am
 
which


876 #d–iv”y 
·ck‘s
 
š
 
cÚ¡ªt
 
š‹rv®
(
nÙ
 
cbr
).

877 #@
»m¬k
 0 
to
 
di§bË
 
the
 
mšim®
 
š‹rv®
.

878 #@
»m¬k
 >0 
to
 
make
 
the
 
¤s
Ø
£nd
 
mes§ge
 
Úe
 
by
 one.

879 #@
»m¬k
 
u£r
 
ÿn
 
g‘
 
the
 
right
 
·ck‘s
 
š‹rv®
 
š
 
ms
 
by
 
¤s_¹mp_dump
.

881 
	g£nd_mš_š‹rv®
 10.0;

882 #wh‘h” 
»duû
 
the
 
£qu’û
 
h—d”
,

883 #fÜ 
some
 
ş›Á
 
which
 
ÿÂÙ
 
gÙ
 
du¶iÿ‹d
 
£qu’û
 
h—d”
,

884 #wh
the
 
£qu’û
 
h—d”
 
is
 
nÙ
 
chªged
 
y‘
.

885 #deçuÉ: 
off


886 
»duû_£qu’û_h—d”
 
	gÚ
;

887 #th1
¡
 
·ck‘
 
timeout
 
š
 
ms
 
’cod”
.

889 
	gpublish_1¡pkt_timeout
 20000;

890 #th
nÜm®
 
·ck‘
 
timeout
 
š
 
ms
 
’cod”
.

892 
	gpublish_nÜm®_timeout
 7000;

895 #th
vho¡
 
ªtisuck
.

896 
vho¡
 
	g»ãr
.
	gªti_suck
.
	gcom
 {

897 #th
commÚ
 
»ãr
 
¶ay
 
ªd
 
publish
.

898 #ià
the
 
·ge
 
u¾
 
of
 
ş›Á
 
nÙ
 
š
h
»ãr
, 
acûss
 
d’›d
.

899 #ià
nÙ
 
¥ecif›d
 
this
 
f›ld
, 
®low
 
®l
.

900 #deçuÉ: 
nÙ
 
¥ecif›d
.

901 
»ãr
 
	gg™hub
.
com
 g™hub.
	gio
;

902 #»ã¸
publish
 
ş›Ás
 
¥ecif›d
.

903 #th
commÚ
 
»ãr
 
is
 
nÙ
 
ov”rided
 
by
 
this
.

904 #ià
nÙ
 
¥ecif›d
 
this
 
f›ld
, 
®low
 
®l
.

905 #deçuÉ: 
nÙ
 
¥ecif›d
.

906 
»ãr_publish
 
	gg™hub
.
com
 g™hub.
	gio
;

907 #»ã¸
¶ay
 
ş›Ás
 
¥ecif›d
.

908 #th
commÚ
 
»ãr
 
is
 
nÙ
 
ov”rided
 
by
 
this
.

909 #ià
nÙ
 
¥ecif›d
 
this
 
f›ld
, 
®low
 
®l
.

910 #deçuÉ: 
nÙ
 
¥ecif›d
.

911 
»ãr_¶ay
 
	gg™hub
.
com
 g™hub.
	gio
;

914 #th
vho¡
 
which
 
fÜw¬d
 
publish
 
¡»ams
.

915 
vho¡
 
	g§me
.
	gvho¡
.
	gfÜw¬d
.
	g¤s
.
	gcom
 {

916 #fÜw¬d 
®l
 
publish
 
¡»am
 
to
 
the
 
¥ecif›d
 
£rv”
.

917 #thi 
u£d
 
to
 
¥l™
/
fÜw¬d
 
the
 
cu¼’t
 
¡»am
 
şu¡”
 
aùive
-
¡ªdby
,

918 #aùive-
aùive
 
cdn
 
to
 
bud
 
high
 
avaabË
 
çuÉ
 
tŞ”ªû
 
sy¡em
.

919 #fÜm©: {

}:{
pÜt
} {
_N
}:{
pÜt_N
}

920 
	gfÜw¬d
 127.0.0.1:1936 127.0.0.1:1937;

923 #th
maš
 
comm’ts
 
Œªscode


924 
vho¡
 
	gexam¶e
.
	gŒªscode
.
	g¤s
.
	gcom
 {

925 #th
¡»amšg
 
Œªscode
 
cÚfigs
.

926 
	gŒªscode
 {

927 #wh‘h” 
the
 
Œªscode
 
’abËd
.

928 #ià
off
, 
dÚÙ
 
Œªscode
.

929 #deçuÉ: 
off
.

930 
’abËd
 
	gÚ
;

931 #th
ffm³g


932 
	gffm³g
 ./
	gobjs
/ffm³g/
	gbš
/ffmpeg;

933 #th
Œªscode
 
’gše
 
m©ched
 
¡»am
.

934 #®È
m©ched
 
¡»am
 
wl
 
Œªscoded
 
to
 
the
 
fŞlowšg
 stream.

935 #th
Œªscode
 
£t
 
Çme
(
›
. 
hd
è
is
 
İtiÚ®
 
ªd
 
nÙ
 
u£d
.

936 
’gše
 
	gexam¶e
 {

937 #wh‘h” 
the
 
’gše
 
is
 
’abËd


938 #deçuÉ: 
off
.

939 
’abËd
 
	gÚ
;

940 #špuˆ
fÜm©
, 
ÿn
 
be
:

941 #off, dØ
nÙ
 
¥ecif›s
 
the
 
fÜm©
, 
ffm³g
 
wl
 
guess
 
™
.

942 #æv, 
æv
 
Ü
 
RTMP
 
¡»am
.

943 #Ùh” 
fÜm©
, 
exam¶e
, 
mp4
/
¯c
 
wh©ev”
.

944 #deçuÉ: 
æv


945 
ifÜm©
 
	gæv
;

946 #ffm³g 
f‹rs
, 
fŞlows
 
the
 
maš
 
šput
.

947 
	gvf‹r
 {

948 #th
logo
 
šput
 
fe
.

949 
	gi
 ./
	gdoc
/
	gffm³g
-
	glogo
.
	g²g
;

950 #th
ffm³g
 
com¶ex
 
f‹r
.

951 #fÜ 
f‹rs
, @
£e
: 
h‰p
:

952 
	gf‹r_com¶ex
 'overlay=10:10';

954 #videØ
’cod”
 
Çme
. 
ÿn
 
be
:

955 #libx264: 
u£
 
h
.264(
libx264
è
video
 
’cod”
.

956 #cİy: 
dÚÙ
 
’cod”
 
the
 
video
 
¡»am
, 
cİy
 
™
.

957 #vn: 
di§bË
 
video
 
ouut
.

958 
vcodec
 
	glibx264
;

959 #videØ
b™¿‹
, 
š
 
kbps


960 #@
»m¬k
 0 
to
 
u£
 
sourû
 
video
 
b™¿‹
.

962 
	gvb™¿‹
 1500;

963 #videØ
äam”©e
.

964 #@
»m¬k
 0 
to
 
u£
 
sourû
 
video
 
ås
.

966 
	gvås
 25;

967 #videØ
width
, 
mu¡
 
be
 
ev’
 
numb”s
.

968 #@
»m¬k
 0 
to
 
u£
 
sourû
 
video
 
width
.

970 
	gvwidth
 768;

971 #videØ
height
, 
mu¡
 
be
 
ev’
 
numb”s
.

972 #@
»m¬k
 0 
to
 
u£
 
sourû
 
video
 
height
.

974 
	gvheight
 320;

975 #th
max
 
th»ads
 
ffm³g
 
to
 
u£d
.

977 
	gvth»ads
 12;

978 #x264 
´ofe
, @
£e
 
x264
 -
h–p
, 
ÿn
 
be
:

979 #high,
maš
,
ba£lše


980 
v´ofe
 
	gmaš
;

981 #x264 
´e£t
, @
£e
 
x264
 -
h–p
, 
ÿn
 
be
:

982 #uÉ¿ç¡,
su³rç¡
,
v”yç¡
,
ç¡”
,
ç¡


983 #medium,
¦ow
,
¦ow”
,
v”y¦ow
,
¶aûbo


984 
v´e£t
 
	gmedium
;

985 #Ùh” 
x264
 
Ü
 
ffm³g
 
video
 
·¿ms


986 
	gv·¿ms
 {

987 #ffm³g 
İtiÚs
, @
£e
: 
h‰p
:

988 
	gt
 100;

989 #264 
·¿ms
, @
£e
: 
h‰p
:

990 
	gcod”
 1;

991 
	gb_¡¿‹gy
 2;

992 
	gbf
 3;

993 
	g»fs
 10;

995 #audiØ
’cod”
 
Çme
. 
ÿn
 
be
:

996 #libfdk_¯c: 
u£
 
¯c
(
libfdk_¯c
è
audio
 
’cod”
.

997 #cİy: 
dÚÙ
 
’cod”
 
the
 
audio
 
¡»am
, 
cİy
 
™
.

998 #ª: 
di§bË
 
audio
 
ouut
.

999 
acodec
 
	glibfdk_¯c
;

1000 #audiØ
b™¿‹
, 
š
 
kbps
. [16, 72] 
libfdk_¯c
.

1001 #@
»m¬k
 0 
to
 
u£
 
sourû
 
audio
 
b™¿‹
.

1003 
	gab™¿‹
 70;

1004 #audiØ
§m¶e
 
¿‹
. 
æv
/
¹mp
, 
™
 
mu¡
 
be
:

1006 #@
»m¬k
 0 
to
 
u£
 
sourû
 
audio
 
§m¶e
 
¿‹
.

1008 
	ga§m¶e_¿‹
 44100;

1009 #audiØ
chªÃl
, 1 
mÚo
, 2 
¡”eo
.

1010 #@
»m¬k
 0 
to
 
u£
 
sourû
 
audio
 
chªÃls
.

1012 
	gachªÃls
 2;

1013 #Ùh” 
ffm³g
 
audio
 
·¿ms


1014 
	g­¬ams
 {

1015 #audiØ
·¿ms
, @
£e
: 
h‰p
:

1016 #@
»m¬k
 
SRS
 
suµÜ‹d
 
¯c
 
´ofe
 
HLS
 
is
: 
¯c_low
, 
¯c_he
, 
¯c_he_v2


1017 
	g´ofe
:
a
 
¯c_low
;

1018 
	gbsf
:
a
 
¯c_adt¡ßsc
;

1020 #ouuˆ
fÜm©
, 
ÿn
 
be
:

1021 #off, dØ
nÙ
 
¥ecif›s
 
the
 
fÜm©
, 
ffm³g
 
wl
 
guess
 
™
.

1022 #æv, 
æv
 
Ü
 
RTMP
 
¡»am
.

1023 #Ùh” 
fÜm©
, 
exam¶e
, 
mp4
/
¯c
 
wh©ev”
.

1024 #deçuÉ: 
æv


1025 
ofÜm©
 
	gæv
;

1026 #ouuˆ
¡»am
. 
v¬ŸbËs
:

1027 #[
vho¡
] 
the
 
šput
 
¡»am
 vhost.

1028 #[
pÜt
] 
the
 
šut
 
¡»am
…ort.

1029 #[
­p
] 
the
 
šput
 
¡»am
‡pp.

1030 #[
¡»am
] 
the
 
šput
 sŒ—m 
Çme
.

1031 #[
’gše
] 
the
 
nscode
ƒngš
Çme
.

1032 
ouut
 
	g¹mp
:

1036 #th
mœrÜ
 
f‹r
 
of
 
ffm³g
, @
£e
: 
h‰p
:

1037 
vho¡
 
	gmœrÜ
.
	gŒªscode
.
	g¤s
.
	gcom
 {

1038 
	gŒªscode
 {

1039 
’abËd
 
	gÚ
;

1040 
	gffm³g
 ./
	gobjs
/ffm³g/
	gbš
/ffmpeg;

1041 
’gše
 
	gmœrÜ
 {

1042 
’abËd
 
	gÚ
;

1043 
	gvf‹r
 {

1044 
	gvf
 'split [main][tmp]; [tmp] crop=iw:ih/2:0:0, vflip [flip]; [main][flip] overlay=0:H/2';

1046 
vcodec
 
	glibx264
;

1047 
	gvb™¿‹
 300;

1048 
	gvås
 20;

1049 
	gvwidth
 768;

1050 
	gvheight
 320;

1051 
	gvth»ads
 2;

1052 
v´ofe
 
	gba£lše
;

1053 
v´e£t
 
	gsu³rç¡
;

1054 
	gv·¿ms
 {

1056 
acodec
 
	glibfdk_¯c
;

1057 
	gab™¿‹
 45;

1058 
	ga§m¶e_¿‹
 44100;

1059 
	gachªÃls
 2;

1060 
	g­¬ams
 {

1062 
ouut
 
	g¹mp
:

1066 #th
d¿w‹xt
 
f‹r
 
of
 
ffm³g
, @
£e
: 
h‰p
:

1067 #»m¬k: 
we
 
»move
 
the
 
libä“ty³
 
which
 
®ways
 
ÿu£
 
bud
 
çed
, 
you
 
mu¡
 
add
 
™
 
mªu®
 
Ãeded
.

1068 #######################################################################################################
#th
üİ
 
f‹r
 
of
 
ffm³g
, @
£e
: 
h‰p
:

1069 
vho¡
 
	güİ
.
	gŒªscode
.
	g¤s
.
	gcom
 {

1070 
	gŒªscode
 {

1071 
’abËd
 
	gÚ
;

1072 
	gffm³g
 ./
	gobjs
/ffm³g/
	gbš
/ffmpeg;

1073 
’gše
 
	güİ
 {

1074 
’abËd
 
	gÚ
;

1075 
	gvf‹r
 {

1076 
	gvf
 'crop=in_w-20:in_h-160:10:80';

1078 
vcodec
 
	glibx264
;

1079 
	gvb™¿‹
 300;

1080 
	gvås
 20;

1081 
	gvwidth
 768;

1082 
	gvheight
 320;

1083 
	gvth»ads
 2;

1084 
v´ofe
 
	gba£lše
;

1085 
v´e£t
 
	gsu³rç¡
;

1086 
	gv·¿ms
 {

1088 
acodec
 
	glibfdk_¯c
;

1089 
	gab™¿‹
 45;

1090 
	ga§m¶e_¿‹
 44100;

1091 
	gachªÃls
 2;

1092 
	g­¬ams
 {

1094 
ouut
 
	g¹mp
:

1098 #th
logo
 
f‹r
 
of
 
ffm³g
, @
£e
: 
h‰p
:

1099 
vho¡
 
	glogo
.
	gŒªscode
.
	g¤s
.
	gcom
 {

1100 
	gŒªscode
 {

1101 
’abËd
 
	gÚ
;

1102 
	gffm³g
 ./
	gobjs
/ffm³g/
	gbš
/ffmpeg;

1103 
’gše
 
	glogo
 {

1104 
’abËd
 
	gÚ
;

1105 
	gvf‹r
 {

1106 
	gi
 ./
	gdoc
/
	gffm³g
-
	glogo
.
	g²g
;

1107 
	gf‹r_com¶ex
 'overlay=10:10';

1109 
vcodec
 
	glibx264
;

1110 
	gvb™¿‹
 300;

1111 
	gvås
 20;

1112 
	gvwidth
 768;

1113 
	gvheight
 320;

1114 
	gvth»ads
 2;

1115 
v´ofe
 
	gba£lše
;

1116 
v´e£t
 
	gsu³rç¡
;

1117 
	gv·¿ms
 {

1119 
acodec
 
	glibfdk_¯c
;

1120 
	gab™¿‹
 45;

1121 
	ga§m¶e_¿‹
 44100;

1122 
	gachªÃls
 2;

1123 
	g­¬ams
 {

1125 
ouut
 
	g¹mp
:

1129 #audiØ
Œªscode
 
Úly
.

1130 #fÜ 
exam¶e
, 
FMLE
 
publish
 
audio
 
codec
 
š
 
mp3
, 
ªd
 
dÚÙ
 
suµÜt
 
HLS
 
ouut
,

1131 #w
ÿn
 
Œªscode
 
the
 
audio
 
to
 
¯c
 
ªd
 
cİy
 
video
Øth
Ãw
 
¡»am
 
w™h
 
HLS
.

1132 
vho¡
 
	gaudio
.
	gŒªscode
.
	g¤s
.
	gcom
 {

1133 
	gŒªscode
 {

1134 
’abËd
 
	gÚ
;

1135 
	gffm³g
 ./
	gobjs
/ffm³g/
	gbš
/ffmpeg;

1136 
’gše
 
	gacodec
 {

1137 
’abËd
 
	gÚ
;

1138 
vcodec
 
	gcİy
;

1139 
acodec
 
	glibfdk_¯c
;

1140 
	gab™¿‹
 45;

1141 
	ga§m¶e_¿‹
 44100;

1142 
	gachªÃls
 2;

1143 
	g­¬ams
 {

1145 
ouut
 
	g¹mp
:

1149 #di§bË 
video
, 
Œªscode
/
cİy
 
audio
.

1150 #fÜ 
exam¶e
, 
publish
 
pu»
 
audio
 
¡»am
.

1151 
vho¡
 
	gvn
.
	gŒªscode
.
	g¤s
.
	gcom
 {

1152 
	gŒªscode
 {

1153 
’abËd
 
	gÚ
;

1154 
	gffm³g
 ./
	gobjs
/ffm³g/
	gbš
/ffmpeg;

1155 
’gše
 
	gvn
 {

1156 
’abËd
 
	gÚ
;

1157 
vcodec
 
	gvn
;

1158 
acodec
 
	glibfdk_¯c
;

1159 
	gab™¿‹
 45;

1160 
	ga§m¶e_¿‹
 44100;

1161 
	gachªÃls
 2;

1162 
	g­¬ams
 {

1164 
ouut
 
	g¹mp
:

1168 #ffm³g-
cİy
(
fÜw¬d
 
im¶em’ts
 
by
 
ffm³g
).

1169 #cİy 
the
 
video
 
ªd
 
audio
 
to
 
a
 
Ãw
 
¡»am
.

1170 
vho¡
 
cİy
.
Œªscode
.
¤s
.
com
 {

1171 
Œªscode
 {

1172 
’abËd
 
Ú
;

1173 
	gffm³g
 ./
	gobjs
/ffm³g/
	gbš
/ffmpeg;

1174 
’gše
 
	gcİy
 {

1175 
’abËd
 
	gÚ
;

1176 
vcodec
 
	gcİy
;

1177 
acodec
 
	gcİy
;

1178 
ouut
 
	g¹mp
:

1182 #Œªscod
®l
 
­p
 
ªd
 
¡»am
 
of
 
vho¡


1183 #th
comm’ts
, 
»ad
 
exam¶e
.
Œªscode
.
¤s
.
com


1184 
vho¡
 
	g®l
.
	gŒªscode
.
	g¤s
.
	gcom
 {

1185 
	gŒªscode
 {

1186 
’abËd
 
	gÚ
;

1187 
	gffm³g
 ./
	gobjs
/ffm³g/
	gbš
/ffmpeg;

1188 
’gše
 
	gffsu³r
 {

1189 
’abËd
 
	gÚ
;

1190 
ifÜm©
 
	gæv
;

1191 
	gvf‹r
 {

1192 
	gi
 ./
	gdoc
/
	gffm³g
-
	glogo
.
	g²g
;

1193 
	gf‹r_com¶ex
 'overlay=10:10';

1195 
vcodec
 
	glibx264
;

1196 
	gvb™¿‹
 1500;

1197 
	gvås
 25;

1198 
	gvwidth
 768;

1199 
	gvheight
 320;

1200 
	gvth»ads
 12;

1201 
v´ofe
 
	gmaš
;

1202 
v´e£t
 
	gmedium
;

1203 
	gv·¿ms
 {

1204 
	gt
 100;

1205 
	gcod”
 1;

1206 
	gb_¡¿‹gy
 2;

1207 
	gbf
 3;

1208 
	g»fs
 10;

1210 
acodec
 
	glibfdk_¯c
;

1211 
	gab™¿‹
 70;

1212 
	ga§m¶e_¿‹
 44100;

1213 
	gachªÃls
 2;

1214 
	g­¬ams
 {

1215 
	g´ofe
:
a
 
¯c_low
;

1217 
ofÜm©
 
	gæv
;

1218 
ouut
 
	g¹mp
:

1220 
’gše
 
ffhd
 {

1221 
’abËd
 
Ú
;

1222 
vcodec
 
	glibx264
;

1223 
	gvb™¿‹
 1200;

1224 
	gvås
 25;

1225 
	gvwidth
 1382;

1226 
	gvheight
 576;

1227 
	gvth»ads
 6;

1228 
v´ofe
 
	gmaš
;

1229 
v´e£t
 
	gmedium
;

1230 
	gv·¿ms
 {

1232 
acodec
 
	glibfdk_¯c
;

1233 
	gab™¿‹
 70;

1234 
	ga§m¶e_¿‹
 44100;

1235 
	gachªÃls
 2;

1236 
	g­¬ams
 {

1238 
ouut
 
	g¹mp
:

1240 
’gše
 
ffsd
 {

1241 
’abËd
 
Ú
;

1242 
vcodec
 
	glibx264
;

1243 
	gvb™¿‹
 800;

1244 
	gvås
 25;

1245 
	gvwidth
 1152;

1246 
	gvheight
 480;

1247 
	gvth»ads
 4;

1248 
v´ofe
 
	gmaš
;

1249 
v´e£t
 
	gç¡
;

1250 
	gv·¿ms
 {

1252 
acodec
 
	glibfdk_¯c
;

1253 
	gab™¿‹
 60;

1254 
	ga§m¶e_¿‹
 44100;

1255 
	gachªÃls
 2;

1256 
	g­¬ams
 {

1258 
ouut
 
	g¹mp
:

1260 
’gše
 
ffç¡
 {

1261 
’abËd
 
Ú
;

1262 
vcodec
 
	glibx264
;

1263 
	gvb™¿‹
 300;

1264 
	gvås
 20;

1265 
	gvwidth
 768;

1266 
	gvheight
 320;

1267 
	gvth»ads
 2;

1268 
v´ofe
 
	gba£lše
;

1269 
v´e£t
 
	gsu³rç¡
;

1270 
	gv·¿ms
 {

1272 
acodec
 
	glibfdk_¯c
;

1273 
	gab™¿‹
 45;

1274 
	ga§m¶e_¿‹
 44100;

1275 
	gachªÃls
 2;

1276 
	g­¬ams
 {

1278 
ouut
 
	g¹mp
:

1280 
’gše
 
vcİy
 {

1281 
’abËd
 
Ú
;

1282 
vcodec
 
	gcİy
;

1283 
acodec
 
	glibfdk_¯c
;

1284 
	gab™¿‹
 45;

1285 
	ga§m¶e_¿‹
 44100;

1286 
	gachªÃls
 2;

1287 
	g­¬ams
 {

1289 
ouut
 
	g¹mp
:

1291 
’gše
 
acİy
 {

1292 
’abËd
 
Ú
;

1293 
vcodec
 
	glibx264
;

1294 
	gvb™¿‹
 300;

1295 
	gvås
 20;

1296 
	gvwidth
 768;

1297 
	gvheight
 320;

1298 
	gvth»ads
 2;

1299 
v´ofe
 
	gba£lše
;

1300 
v´e£t
 
	gsu³rç¡
;

1301 
	gv·¿ms
 {

1303 
acodec
 
	gcİy
;

1304 
ouut
 
	g¹mp
:

1306 
’gše
 
cİy
 {

1307 
’abËd
 
Ú
;

1308 
vcodec
 
	gcİy
;

1309 
acodec
 
	gcİy
;

1310 
ouut
 
	g¹mp
:

1314 #Œªscod
®l
 
¡»am
 
usšg
 
the
 
em±y
 
ffm³g
 
demo
, 
dÚÙhšg
.

1315 
vho¡
 
	gfãm±y
.
	gŒªscode
.
	g¤s
.
	gcom
 {

1316 
	gŒªscode
 {

1317 
’abËd
 
	gÚ
;

1318 
	gffm³g
 ./
	gobjs
/
	g»£¬ch
/
	gfãm±y
;

1319 
’gše
 
	gem±y
 {

1320 
’abËd
 
	gÚ
;

1321 
vcodec
 
	glibx264
;

1322 
	gvb™¿‹
 300;

1323 
	gvås
 20;

1324 
	gvwidth
 768;

1325 
	gvheight
 320;

1326 
	gvth»ads
 2;

1327 
v´ofe
 
	gba£lše
;

1328 
v´e£t
 
	gsu³rç¡
;

1329 
	gv·¿ms
 {

1331 
acodec
 
	glibfdk_¯c
;

1332 
	gab™¿‹
 45;

1333 
	ga§m¶e_¿‹
 44100;

1334 
	gachªÃls
 2;

1335 
	g­¬ams
 {

1337 
ouut
 
	g¹mp
:

1341 #Œªscod
®l
 
­p
 
ªd
 
¡»am
 
of
‡pp

1342 
vho¡
 
­p
.
Œªscode
.
¤s
.
com
 {

1343 #th
¡»amšg
 
Œªscode
 
cÚfigs
.

1344 #ià
­p
 
¥ecif›d
, 
Œªscode
 
®l
 
¡»ams
 
of
‡pp.

1345 
Œªscode
 
	glive
 {

1346 
’abËd
 
	gÚ
;

1347 
	gffm³g
 ./
	gobjs
/ffm³g/
	gbš
/ffmpeg;

1348 
	g’gše
 {

1349 
’abËd
 
	goff
;

1353 #Œªscod
¥ecif›d
 
¡»am
.

1354 
vho¡
 
	g¡»am
.
	gŒªscode
.
	g¤s
.
	gcom
 {

1355 #th
¡»amšg
 
Œªscode
 
cÚfigs
.

1356 #ià
¡»am
 
¥ecif›d
, 
Œªscode
 
the
 
m©ched
 stream.

1357 
Œªscode
 
	glive
/
	glive¡»am
 {

1358 
’abËd
 
	gÚ
;

1359 
	gffm³g
 ./
	gobjs
/ffm³g/
	gbš
/ffmpeg;

1360 
	g’gše
 {

1361 
’abËd
 
	goff
;

1366 #vho¡ 
bªdwidth
 
check


1367 #g’”®ly, 
the
 
bªdcheck
 
vho¡
 
mu¡
 
be
: bªdcheck.
¤s
.
com
,

1368 #Ü 
Ãed
 
to
 
modify
 
the
 
vho¡
 
of
 
ş›Á
.

1369 
vho¡
 
	gbªdcheck
.
	g¤s
.
	gcom
 {

1370 
’abËd
 
	gÚ
;

1371 
	gchunk_size
 65000;

1372 #bªdwidth 
check
 
cÚfig
.

1373 
	gbªdcheck
 {

1374 #wh‘h” 
suµÜt
 
bªdwidth
 
check
,

1375 #deçuÉ: 
off
.

1376 
’abËd
 
	gÚ
;

1377 #th
key
 
£rv”
 
to
 
v®id
,

1378 #ià
šv®id
 
key
, 
£rv”
 
discÚÃù
 
ªd
 
abÜt
 
the
 
bªdwidth
 
check
.

1379 
	gkey
 "35c9b402c12a7246868752e2878f7e0e";

1380 #th
š‹rv®
 
š
 
£cÚds
 
bªdwidth
 
check
,

1381 #£rv” 
dÚÙ
 
®low
 
Ãw
 
‹¡
 
»que¡
.

1383 
	gš‹rv®
 30;

1384 #th
max
 
avaabË
 
check
 
bªdwidth
 
š
 
kbps
.

1385 #tØ
avoid
 
©ck
 
of
 
bªdwidth
 
check
.

1387 
	glim™_kbps
 4000;

1391 #£ˆ
the
 
chunk
 
size
 
of
 
vho¡
.

1392 
vho¡
 
	gchunksize
.
	g¤s
.
	gcom
 {

1393 #th 
chunk
 
size
 
is
 128, 
max
 is 65536,

1394 #som
ş›Á
 
dÛs
 
nÙ
 
suµÜt
 
chunk
 
size
 
chªge
,

1395 #vho¡ 
chunk
 
size
 
wl
 
ov”ride
 
the
 
glob®
 
v®ue
.

1396 #deçuÉ: 
glob®
 
chunk
 
size
.

1397 
	gchunk_size
 128;

1400 #vho¡ 
time
 
j™‹r


1401 
vho¡
 
	gj™‹r
.
	g¤s
.
	gcom
 {

1402 #abouˆ
the
 
¡»am
 
mÚÙÚiÿÎy
 
šü—sšg
:

1403 #1. 
video
 
time¡amp
 
is
 
mÚÙÚiÿÎy
 
šü—sšg
,

1404 #2. 
audio
 
time¡amp
 
is
 
mÚÙÚiÿÎy
 
šü—sšg
,

1405 #3. 
video
 
ªd
 
audio
 
time¡amp
 
is
 
š‹¾—ved
/
mixed
 
mÚÙÚiÿÎy
 
šü—sšg
.

1407 #howev”, 
some
 
’cod”
 
ÿÂÙ
 
´ovides
 
this
 
ã©u»
, 
¶—£
 
£t
hi 
to
 
off
Ø
ignÜe
 
time
 
j™‹r
.

1408 #th
time
 
j™‹r
 
®gÜ™hm
:

1409 #1. 
fuÎ
, 
to
 
’su»
 
¡»am
 
¡¬t
 
©
 
z”o
, 
ªd
ƒnsu» sŒ—m 
mÚÙÚiÿÎy
 
šü—sšg
.

1410 #2. 
z”o
, 
Úly
 
’su»
 
¡Œ—m
 
¡¬t
 
©
 z”o, 
ignÜe
 
time¡amp
 
j™‹r
.

1411 #3. 
off
, 
di§bË
 
the
 
time
 
j™‹r
 
®gÜ™hm
, 
like
 
©c
.

1412 #deçuÉ: 
fuÎ


1413 
time_j™‹r
 
	gfuÎ
;

1414 #wh‘h” 
u£
 
the
 
š‹¾—ved
/
mixed
 
®gÜ™hm
 
to
 
cÜ»ù
h
time¡amp
.

1415 #ià
Ú
, 
®ways
 
’su»
 
the
 
time¡amp
 
of
 
audio
+
video
 
is
 
š‹¾—ved
/
mixed
 
mÚÙÚiÿÎy
 
šü—£
.

1416 #ià
off
, 
u£
 
time_j™‹r
 
to
 
cÜ»ù
 
the
 
time¡amp
 
»quœed
.

1417 #deçuÉ: 
off


1418 
mix_cÜ»ù
 
	goff
;

1421 #vho¡ 
©c
.

1422 
vho¡
 
	g©c
.
	g¤s
.
	gcom
 {

1423 #vho¡ 
©c
 
hls
/
hds
/
¹mp
 
backup
.

1424 #g’”®ly, 
©c
  
to
 
off
, 
£rv”
 
d–iv”y
 
¹mp
 
¡»am
Ø
ş›Á
(
æash
è
time¡amp
 
äom
 0.

1425 #wh’ 
©c
 
is
 
Ú
, 
£rv”
 
d–iv”y
 
¹mp
 
¡»am
 
by
 
absŞu‹
 
time
.

1426 #©ø
is
 
u£d
, 
š¡ªû
, 
’cod”
 
wl
 
cİy
 
¡»am
 
to
 
ma¡”
 
ªd
 
¦ave
 
£rv”
,

1427 #£rv” 
u£
 
©c
 
to
 
d–iv”y
 
¡»am
Ø
edge
/
ş›Á
, 
wh”e
 sŒ—m 
time
 
äom
 
ma¡”
/
¦ave
 
£rv”


1428 #i 
®ways
 
the
 
§me
, 
ş›Á
/
toŞs
 
ÿn
 
¦iû
 
RTMP
 
¡»am
 
to
 
HLS
 
accÜdšg
Øth§m
time
,

1429 #ià
the
 
time
 
nÙ
h
§me
,h
HLS
 
¡»am
 
ÿÂÙ
 
¦iû
 
to
 
suµÜt
 
sy¡em
 
backup
.

1430 #
#@
£e
 
h‰p
:

1431 #@
£e
 
h‰p
:

1432 #
#deçuÉ: 
off


1433 
©c
 
	gÚ
;

1434 #wh‘h” 
’abË
 
the
‡utØ
©c
,

1435 #ià
’abËd
, 
d‘eù
 
the
 
b¿vo_©c
="Œue" 
š
 
ÚM‘aD©a
 
·ck‘
,

1436 #£ˆ
©c
 
to
 
Ú
 
m©ched
.

1437 #®way 
ignÜe
 
the
 
ÚM‘aD©a
 
©c_auto
 
is
 
off
.

1438 #deçuÉ: 
Ú


1439 
©c_auto
 
	gÚ
;

1442 #th
vho¡
 
di§bËd
.

1443 
vho¡
 
	g»moved
.
	g¤s
.
	gcom
 {

1444 #wh‘h” 
the
 
vho¡
 
is
 
’abËd
.

1445 #ià
off
, 
®l
 
»que¡
 
acûss
 
d’›d
.

1446 #deçuÉ: 
Ú


1447 
’abËd
 
	goff
;

1450 #cÚfig 
the
 
p™hy
 
´št
,

1451 #which 
®ways
 
´št
 
cÚ¡ªt
 
mes§ge
 
¥ecif›d
 
by
 
š‹rv®
,

1452 #wh©ev” 
the
 
ş›Ás
 
š
 
cÚcu¼’cy
.

1454 
	gp™hy_´št_ms
 10000;

	@trunk/conf/hds.conf

1 #th
cÚfig
 
¤s
 
to
 
d–iv”y
 
hds


2 #@
£e
 
h‰ps
:

3 #@
£e
 
fuÎ
.
cÚf
 
d‘a
 
cÚfig
.

5 
	gli¡’
 1935;

6 
	gmax_cÚÃùiÚs
 1000;

8 
d«mÚ
 
	goff
;

9 
¤s_log_nk
 
	gcÚsŞe
;

10 
¤s_log_Ëv–
 
	gŒaû
;

12 
vho¡
 
	g__deçuÉVho¡__
 {

13 
	ghds
 {

14 
’abËd
 
	gÚ
;

15 
	ghds_äagm’t
 10;

16 
	ghds_wšdow
 60;

17 
	ghds_·th
 ./
	gobjs
/
	gngšx
/
	ghtml
;

	@trunk/conf/hls.conf

1 #th
cÚfig
 
¤s
 
to
 
d–iv”y
 
hls


2 #@
£e
 
h‰ps
:

3 #@
£e
 
fuÎ
.
cÚf
 
d‘a
 
cÚfig
.

5 
	gli¡’
 1935;

6 
	gmax_cÚÃùiÚs
 1000;

7 
vho¡
 
	g__deçuÉVho¡__
 {

8 
	ghls
 {

9 
’abËd
 
	gÚ
;

10 
	ghls_äagm’t
 10;

11 
	ghls_wšdow
 60;

12 
	ghls_·th
 ./
	gobjs
/
	gngšx
/
	ghtml
;

13 
	ghls_m3u8_fe
 [
­p
]/[
¡»am
].
	gm3u8
;

14 
	ghls_ts_fe
 [
­p
]/[
¡»am
]-[
£q
].
	gts
;

	@trunk/conf/http.aac.live.conf

1 #th
cÚfig
 
¤s
 
to
 
»mux
 
¹mp
Ø
¯c
 
live
 
¡»am
.

2 #@
£e
 
h‰ps
:

3 #@
£e
 
fuÎ
.
cÚf
 
d‘a
 
cÚfig
.

5 
	gli¡’
 1935;

6 
	gmax_cÚÃùiÚs
 1000;

7 
	gh‰p_£rv”
 {

8 
’abËd
 
	gÚ
;

9 
	gli¡’
 8080;

10 
	gdœ
 ./
	gobjs
/
	gngšx
/
	ghtml
;

12 
vho¡
 
	g__deçuÉVho¡__
 {

13 
	gh‰p_»mux
 {

14 
’abËd
 
	gÚ
;

15 
	gç¡_ÿche
 30;

16 
	gmouÁ
 [
vho¡
]/[
­p
]/[
¡»am
].
	g¯c
;

17 
h¡rs
 
	gÚ
;

	@trunk/conf/http.flv.live.conf

1 #th
cÚfig
 
¤s
 
to
 
»mux
 
¹mp
Ø
æv
 
live
 
¡»am
.

2 #@
£e
 
h‰ps
:

3 #@
£e
 
fuÎ
.
cÚf
 
d‘a
 
cÚfig
.

5 
	gli¡’
 1935;

6 
	gmax_cÚÃùiÚs
 1000;

7 
	gh‰p_£rv”
 {

8 
’abËd
 
	gÚ
;

9 
	gli¡’
 8080;

10 
	gdœ
 ./
	gobjs
/
	gngšx
/
	ghtml
;

12 
vho¡
 
	g__deçuÉVho¡__
 {

13 
	gh‰p_»mux
 {

14 
’abËd
 
	gÚ
;

15 
	gmouÁ
 [
vho¡
]/[
­p
]/[
¡»am
].
	gæv
;

16 
h¡rs
 
	gÚ
;

	@trunk/conf/http.flv.live.edge1.conf

1 #th
cÚfig
 
¤s
 
to
 
»mux
 
¹mp
Ø
æv
 
live
 
¡»am
.

2 #@
£e
 
h‰ps
:

3 #@
£e
 
fuÎ
.
cÚf
 
d‘a
 
cÚfig
.

5 
	gli¡’
 19351;

6 
	gmax_cÚÃùiÚs
 1000;

7 
pid
 
	gobjs
/
	g¤s
.
	gæv
.19351.
	gpid
;

8 
¤s_log_fe
 
	gobjs
/
	g¤s
.
	gæv
.19351.l
	gog
;

9 
	gh‰p_£rv”
 {

10 
’abËd
 
	gÚ
;

11 
	gli¡’
 8081;

12 
	gdœ
 ./
	gobjs
/
	gngšx
/
	ghtml
;

14 
vho¡
 
	g__deçuÉVho¡__
 {

15 
mode
 
	g»mÙe
;

16 
	gÜigš
 127.0.0.1;

17 
	gh‰p_»mux
 {

18 
’abËd
 
	gÚ
;

19 
	gmouÁ
 [
vho¡
]/[
­p
]/[
¡»am
].
	gæv
;

20 
h¡rs
 
	gÚ
;

	@trunk/conf/http.flv.live.edge2.conf

1 #th
cÚfig
 
¤s
 
to
 
»mux
 
¹mp
Ø
æv
 
live
 
¡»am
.

2 #@
£e
 
h‰ps
:

3 #@
£e
 
fuÎ
.
cÚf
 
d‘a
 
cÚfig
.

5 
	gli¡’
 19352;

6 
	gmax_cÚÃùiÚs
 1000;

7 
pid
 
	gobjs
/
	g¤s
.
	gæv
.19352.
	gpid
;

8 
¤s_log_fe
 
	gobjs
/
	g¤s
.
	gæv
.19352.l
	gog
;

9 
	gh‰p_£rv”
 {

10 
’abËd
 
	gÚ
;

11 
	gli¡’
 8082;

12 
	gdœ
 ./
	gobjs
/
	gngšx
/
	ghtml
;

14 
vho¡
 
	g__deçuÉVho¡__
 {

15 
mode
 
	g»mÙe
;

16 
	gÜigš
 127.0.0.1;

17 
	gh‰p_»mux
 {

18 
’abËd
 
	gÚ
;

19 
	gmouÁ
 [
vho¡
]/[
­p
]/[
¡»am
].
	gæv
;

20 
h¡rs
 
	gÚ
;

	@trunk/conf/http.heartbeat.conf

1 #th
cÚfig
 
¤s
 
h‰p
 
h—¹b—t
, 
»pÜt
 
™s
 
šfo
 
to
 
­i
-
£rv”


2 #@
£e
 
fuÎ
.
cÚf
 
d‘a
 
cÚfig
.

4 
	gli¡’
 1935

5 
	gmax_cÚÃùiÚs
 1000;

6 
	gh—¹b—t
 {

7 
’abËd
 
	gÚ
;

8 
	gš‹rv®
 9.3;

9 #fÜ 
pythÚ
 
­i
-
£rv”


10 
u¾
 
	gh‰p
:

11 
deviû_id
 "my-srs-device";

12 #fÜ 
os¤s
.
Ãt
 
mÚ™Ü
, 
deviû_id
 
is
 
the
 
key
 
g’”—‹d
 
by
 
bsm
.

13 #u¾ 
h‰p
:

15 #w™h 
d‘a
 
summ¬›s


16 
summ¬›s
 
	gÚ
;

18 
	g¡©s
 {

19 
	gÃtwÜk
 0;

20 
disk
 
sda
 
sdb
 
xvda
 
	gxvdb
;

22 
vho¡
 
	g__deçuÉVho¡__
 {

	@trunk/conf/http.hls.conf

1 #th
cÚfig
 
¤s
 
to
 
d–iv”y
 
hls


2 #@
£e
 
h‰ps
:

3 #@
£e
 
fuÎ
.
cÚf
 
d‘a
 
cÚfig
.

5 
	gli¡’
 1935;

6 
	gmax_cÚÃùiÚs
 1000;

7 
	gh‰p_£rv”
 {

8 
’abËd
 
	gÚ
;

9 
	gli¡’
 8080;

10 
	gdœ
 ./
	gobjs
/
	gngšx
/
	ghtml
;

12 
vho¡
 
	g__deçuÉVho¡__
 {

13 
	ghls
 {

14 
’abËd
 
	gÚ
;

15 
	ghls_äagm’t
 10;

16 
	ghls_wšdow
 60;

17 
	ghls_·th
 ./
	gobjs
/
	gngšx
/
	ghtml
;

18 
	ghls_m3u8_fe
 [
­p
]/[
¡»am
].
	gm3u8
;

19 
	ghls_ts_fe
 [
­p
]/[
¡»am
]-[
£q
].
	gts
;

	@trunk/conf/http.hooks.callback.conf

1 #h‰p-
hooks
 
Ü
 
h‰p
-
ÿÎbacks
 
cÚfig
 
¤s
.

2 #@
£e
 
fuÎ
.
cÚf
 
d‘a
 
cÚfig
.

4 
	gli¡’
 1935;

5 
	gmax_cÚÃùiÚs
 1000;

6 
¤s_log_nk
 
	gfe
;

7 
	g¤s_log_fe
 ./
	gobjs
/
	g¤s
.
	glog
;

8 
vho¡
 
	g__deçuÉVho¡__
 {

9 
	gh‰p_hooks
 {

10 
’abËd
 
	gÚ
;

11 
Ú_cÚÃù
 
	gh‰p
:

12 
Ú_şo£
 
h‰p
:

13 
Ú_publish
 
h‰p
:

14 
Ú_uÅublish
 
h‰p
:

15 
Ú_¶ay
 
h‰p
:

16 
Ú_¡İ
 
h‰p
:

	@trunk/conf/http.mp3.live.conf

1 #th
cÚfig
 
¤s
 
to
 
»mux
 
¹mp
Ø
mp3
 
live
 
¡»am
.

2 #@
£e
 
h‰ps
:

3 #@
£e
 
fuÎ
.
cÚf
 
d‘a
 
cÚfig
.

5 
	gli¡’
 1935;

6 
	gmax_cÚÃùiÚs
 1000;

7 
	gh‰p_£rv”
 {

8 
’abËd
 
	gÚ
;

9 
	gli¡’
 8080;

10 
	gdœ
 ./
	gobjs
/
	gngšx
/
	ghtml
;

12 
vho¡
 
	g__deçuÉVho¡__
 {

13 
	gh‰p_»mux
 {

14 
’abËd
 
	gÚ
;

15 
	gç¡_ÿche
 30;

16 
	gmouÁ
 [
vho¡
]/[
­p
]/[
¡»am
].
	gmp3
;

17 
h¡rs
 
	gÚ
;

	@trunk/conf/http.server.conf

1 #th
cÚfig
 
¤s
 
to
 
£rve
 
as
 
h‰p
 
£rv”


2 #@
£e
 
fuÎ
.
cÚf
 
d‘a
 
cÚfig
.

4 
	gli¡’
 1935;

5 
	gmax_cÚÃùiÚs
 1000;

6 
	gh‰p_£rv”
 {

7 
’abËd
 
	gÚ
;

8 
	gli¡’
 8080;

9 
	gdœ
 ./
	gobjs
/
	gngšx
/
	ghtml
;

11 
vho¡
 
	gos¤s
.
	gÃt
 {

12 
	gh‰p
 {

13 
’abËd
 
	gÚ
;

14 
	gmouÁ
 [
vho¡
]/;

15 
	gdœ
 ./
	gobjs
/
	gngšx
/
	ghtml
;

	@trunk/conf/http.ts.live.conf

1 #th
cÚfig
 
¤s
 
to
 
»mux
 
¹mp
Ø
ts
 
live
 
¡»am
.

2 #@
£e
 
h‰ps
:

3 #@
£e
 
fuÎ
.
cÚf
 
d‘a
 
cÚfig
.

5 
	gli¡’
 1935;

6 
	gmax_cÚÃùiÚs
 1000;

7 
	gh‰p_£rv”
 {

8 
’abËd
 
	gÚ
;

9 
	gli¡’
 8080;

10 
	gdœ
 ./
	gobjs
/
	gngšx
/
	ghtml
;

12 
vho¡
 
	g__deçuÉVho¡__
 {

13 
	gh‰p_»mux
 {

14 
’abËd
 
	gÚ
;

15 
	gmouÁ
 [
vho¡
]/[
­p
]/[
¡»am
].
	gts
;

16 
h¡rs
 
	gÚ
;

	@trunk/conf/ingest.conf

1 #u£ 
ffm³g
 
to
 
šge¡
 
fe
/
¡»am
/
deviû
Ø
SRS


2 #@
£e
 
h‰ps
:

3 #@
£e
 
fuÎ
.
cÚf
 
d‘a
 
cÚfig
.

5 
	gli¡’
 1935;

6 
	gmax_cÚÃùiÚs
 1000;

7 
vho¡
 
	g__deçuÉVho¡__
 {

8 
	gšge¡
 2bc67c53b4a05e194cb9b11e0046ec2b {

9 
’abËd
 
	gÚ
;

10 
	gšput
 {

11 
ty³
 
	g¡»am
;

12 #u¾ ./
doc
/
sourû
.200
kbps
.768x320.æ
v
;

13 
u¾
 
	g¹mp
:

14 #u¾ 
áp
:

19 
ffm³g
 ./
objs
/ffm³g/
bš
/ffmpeg;

20 
	g’gše
 {

21 
’abËd
 
	gÚ
;

22 
acodec
 
	glibfdk_¯c
;

23 
	gab™¿‹
 70;

24 
	ga§m¶e_¿‹
 44100;

25 
	gachªÃls
 2;

26 
	g­¬ams
{

27 
	gvŞ
=512;

29 #ouuˆ
¹mp
:

30 #ouuˆ
¹mp
:

31 
ouut
 
	g¹mp
:

	@trunk/conf/mac.dev.conf

1 #no-
d«mÚ
 
ªd
 
wr™e
 
log
 
to
 
cÚsŞe
 
cÚfig
 
¤s
.

2 #@
£e
 
fuÎ
.
cÚf
 
d‘a
 
cÚfig
.

4 
	gli¡’
 1935;

5 
	gmax_cÚÃùiÚs
 1000;

6 
d«mÚ
 
	goff
;

7 
¤s_log_nk
 
	gcÚsŞe
;

8 
	gh‰p_­i
 {

9 
’abËd
 
	gÚ
;

10 
	gli¡’
 1985;

12 
	gh‰p_£rv”
 {

13 
’abËd
 
	gÚ
;

14 
	gli¡’
 8080;

16 
vho¡
 
	g__deçuÉVho¡__
 {

17 
	ghls
 {

18 
’abËd
 
	gÚ
;

19 
	ghls_äagm’t
 10;

20 
	ghls_wšdow
 60;

21 
	ghls_·th
 ./
	gobjs
/
	gngšx
/
	ghtml
;

23 
šge¡
 
	glive¡»am
 {

24 
’abËd
 
	gÚ
;

25 
	gšput
 {

26 
ty³
 
	gfe
;

27 
	gu¾
 ./
	gdoc
/
	gsourû
.200
	gkbps
.768x320.æ
	gv
;

29 #ffm³g ./
objs
/
ffm³g
/
bš
/ffmpeg;

30 
	gffm³g
 ./
	gobjs
/
	g»£¬ch
/
	glib¹mp
/
	g¤s_šge¡_æv
;

31 
	g’gše
 {

32 
’abËd
 
	goff
;

33 
ouut
 
	g¹mp
:

	@trunk/conf/origin.conf

1 #th
cÚfig
 
¤s
 
Üigš
-
edge
 
şu¡”


2 #@
£e
 
h‰ps
:

3 #@
£e
 
fuÎ
.
cÚf
 
d‘a
 
cÚfig
.

5 
	gli¡’
 19350;

6 
	gmax_cÚÃùiÚs
 1000;

7 
pid
 
	gobjs
/
	gÜigš
.
	gpid
;

8 
	g¤s_log_fe
 ./
	gobjs
/
	gÜigš
.
	glog
;

9 
vho¡
 
	g__deçuÉVho¡__
 {

	@trunk/conf/push.flv.conf

1 #push 
HTTP
 
FLV
 
to
 
SRS
.

2 #@
£e
 
h‰ps
:

3 #@
£e
 
fuÎ
.
cÚf
 
d‘a
 
cÚfig
.

5 
	gli¡’
 1935;

6 
	gmax_cÚÃùiÚs
 1000;

7 
	gh‰p_£rv”
 {

8 
’abËd
 
	gÚ
;

9 
	gli¡’
 8080;

10 
	gdœ
 ./
	gobjs
/
	gngšx
/
	ghtml
;

12 
	g¡»am_ÿ¡”
 {

13 
’abËd
 
	gÚ
;

14 
ÿ¡”
 
	gæv
;

15 
ouut
 
	g¹mp
:

16 
li¡’
 8936;

18 
vho¡
 
	g__deçuÉVho¡__
 {

19 
	ghls
 {

20 
’abËd
 
	gÚ
;

21 
	ghls_äagm’t
 10;

22 
	ghls_wšdow
 60;

23 
	ghls_·th
 ./
	gobjs
/
	gngšx
/
	ghtml
;

24 
	ghls_m3u8_fe
 [
­p
]/[
¡»am
].
	gm3u8
;

25 
	ghls_ts_fe
 [
­p
]/[
¡»am
]-[
£q
].
	gts
;

	@trunk/conf/push.mpegts.over.udp.conf

1 #push 
MPEG
-
TS
 
ov”
 
UDP
 
to
 
SRS
.

2 #@
£e
 
h‰ps
:

3 #@
£e
 
h‰ps
:

4 #@
£e
 
fuÎ
.
cÚf
 
d‘a
 
cÚfig
.

6 
	gli¡’
 1935;

7 
	gmax_cÚÃùiÚs
 1000;

8 
	g¡»am_ÿ¡”
 {

9 
’abËd
 
	gÚ
;

10 
ÿ¡”
 
	gm³gts_ov”_udp
;

11 
ouut
 
	g¹mp
:

12 
li¡’
 1935;

14 
vho¡
 
	g__deçuÉVho¡__
 {

	@trunk/conf/push.rtsp.conf

1 #push 
MPEG
-
TS
 
ov”
 
UDP
 
to
 
SRS
.

2 #@
£e
 
h‰ps
:

3 #@
£e
 
h‰ps
:

4 #@
£e
 
fuÎ
.
cÚf
 
d‘a
 
cÚfig
.

6 
	gli¡’
 1935;

7 
	gmax_cÚÃùiÚs
 1000;

8 
	g¡»am_ÿ¡”
 {

9 
’abËd
 
	gÚ
;

10 
ÿ¡”
 
	g¹¥
;

11 
ouut
 
	g¹mp
:

12 
li¡’
 554;

13 
	g¹p_pÜt_mš
 57200;

14 
	g¹p_pÜt_max
 57300;

16 
vho¡
 
	g__deçuÉVho¡__
 {

	@trunk/conf/ram.hls.conf

1 #th
cÚfig
 
¤s
 
to
 
d–iv”y
 
hls


2 #@
£e
 
h‰ps
:

3 #@
£e
 
fuÎ
.
cÚf
 
d‘a
 
cÚfig
.

5 
	gli¡’
 1935;

6 
	gmax_cÚÃùiÚs
 1000;

7 
	gh‰p_£rv”
 {

8 
’abËd
 
	gÚ
;

9 
	gli¡’
 8080;

10 
	gdœ
 ./
	gobjs
/
	gngšx
/
	ghtml
;

12 
vho¡
 
	g__deçuÉVho¡__
 {

13 
	ghls
 {

14 
’abËd
 
	gÚ
;

15 
	ghls_äagm’t
 10;

16 
	ghls_wšdow
 60;

17 
hls_¡Üage
 
	g¿m
;

18 
	ghls_mouÁ
 /[
­p
]/[
¡»am
].
	gm3u8
;

	@trunk/conf/realtime.conf

1 #th
cÚfig
 
¤s
 
to
 
d–iv”y
 
»®time
 
RTMP
 
¡»am


2 #@
£e
 
h‰ps
:

3 #@
£e
 
fuÎ
.
cÚf
 
d‘a
 
cÚfig
.

5 
	gli¡’
 1935;

6 
	gmax_cÚÃùiÚs
 1000;

7 
vho¡
 
	g__deçuÉVho¡__
 {

8 
gİ_ÿche
 
	goff
;

9 
	gqueue_Ëngth
 10;

10 
mš_Ï‹ncy
 
	gÚ
;

11 
	gmr
 {

12 
’abËd
 
	goff
;

14 
	gmw_Ï‹ncy
 100;

15 
tı_nod–ay
 
	gÚ
;

	@trunk/conf/rtmp.conf

1 #th
cÚfig
 
¤s
 
to
 
d–iv”y
 
RTMP


2 #@
£e
 
h‰ps
:

3 #@
£e
 
fuÎ
.
cÚf
 
d‘a
 
cÚfig
.

5 
	gli¡’
 1935;

6 
	gmax_cÚÃùiÚs
 1000;

7 
vho¡
 
	g__deçuÉVho¡__
 {

	@trunk/conf/security.deny.publish.conf

1 #£cur™y 
cÚfig
 
¤s
, 
®low
 
¶ay
 
ªd
 
d’y
 
publish
.

2 #@
£e
 
h‰ps
:

3 #@
£e
 
fuÎ
.
cÚf
 
d‘a
 
cÚfig
.

5 
	gli¡’
 1935;

6 
	gmax_cÚÃùiÚs
 1000;

7 
vho¡
 
	g__deçuÉVho¡__
 {

8 
	g£cur™y
 {

9 
’abËd
 
	gÚ
;

10 
d’y
 
publish
 
	g®l
;

11 
®low
 
¶ay
 
	g®l
;

	@trunk/conf/srs.conf

1 #maš 
cÚfig
 
¤s
.

2 #@
£e
 
fuÎ
.
cÚf
 
d‘a
 
cÚfig
.

4 
	gli¡’
 1935;

5 
	gmax_cÚÃùiÚs
 1000;

6 
¤s_log_nk
 
	gfe
;

7 
	g¤s_log_fe
 ./
	gobjs
/
	g¤s
.
	glog
;

8 
	gh‰p_­i
 {

9 
’abËd
 
	gÚ
;

10 
	gli¡’
 1985;

12 
	gh‰p_£rv”
 {

13 
’abËd
 
	gÚ
;

14 
	gli¡’
 8080;

15 
	gdœ
 ./
	gobjs
/
	gngšx
/
	ghtml
;

17 
	g¡©s
 {

18 
	gÃtwÜk
 0;

19 
disk
 
sda
 
sdb
 
xvda
 
	gxvdb
;

21 
vho¡
 
	g__deçuÉVho¡__
 {

	@trunk/conf/transcode2hls.audio.only.conf

1 #th
cÚfig
 
¤s
 
to
 
d–iv”y
 
hls


2 #@
£e
 
h‰ps
:

3 #@
£e
 
fuÎ
.
cÚf
 
d‘a
 
cÚfig
.

5 
	gli¡’
 1935;

6 
	gmax_cÚÃùiÚs
 1000;

7 
vho¡
 
	g__deçuÉVho¡__
 {

8 
	ghls
 {

9 
’abËd
 
	gÚ
;

10 
	ghls_äagm’t
 10;

11 
	ghls_wšdow
 60;

12 
	ghls_·th
 ./
	gobjs
/
	gngšx
/
	ghtml
;

13 
	ghls_m3u8_fe
 [
­p
]/[
¡»am
].
	gm3u8
;

14 
	ghls_ts_fe
 [
­p
]/[
¡»am
]-[
£q
].
	gts
;

16 
	gŒªscode
 {

17 
’abËd
 
	gÚ
;

18 
	gffm³g
 ./
	gobjs
/ffm³g/
	gbš
/ffmpeg;

19 
’gše
 
	gff
 {

20 
’abËd
 
	gÚ
;

21 
vcodec
 
	gcİy
;

22 
acodec
 
	glibfdk_¯c
;

23 
	g­¬ams
 {

25 
ouut
 
	g¹mp
:

	@trunk/conf/transform.edge.conf

1 #th
cÚfig
 
¤s
 
Üigš
-
edge
 
şu¡”


2 #@
£e
 
h‰ps
:

3 #@
£e
 
fuÎ
.
cÚf
 
d‘a
 
cÚfig
.

5 
	gli¡’
 1935;

6 
	gmax_cÚÃùiÚs
 1000;

7 
vho¡
 
	g__deçuÉVho¡__
 {

9 
vho¡
 
	gsourû
.
	g¤s
.
	gcom
 {

10 
šge¡
 
	glive¡»am
 {

11 
’abËd
 
	gÚ
;

12 
	gšput
 {

13 
ty³
 
	gfe
;

14 
	gu¾
 ./
	gdoc
/
	gsourû
.200
	gkbps
.768x320.æ
	gv
;

16 
	gffm³g
 ./
	gobjs
/ffm³g/
	gbš
/ffmpeg;

17 
	g’gše
 {

18 
’abËd
 
	goff
;

19 
ouut
 
	g¹mp
:

23 
vho¡
 
ŒªsfÜm
.
¤s
.
edge
.
com
 {

24 
mode
 
»mÙe
;

25 
	gÜigš
 127.0.0.1:1935;

26 
vho¡
 
	gsourû
.
	g¤s
.
	gcom
;

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/__init__.py

4 
Ch”ryPy
 
cÚsi¡s
 
of
 
nÙ
 
	gÚe
, 
but
 
four
 
£·¿‹
 
API
 
	gÏy”s
.

6 
The
 
APPLICATION
 
LAYER
 
is
 
the
 
	gsim¶e¡
. 
Ch”ryPy
 
­¶iÿtiÚs
 
¬e
 
wr™‹n
 
as


7 
a
 
Œ“
 
of
 
şas£s
 
ªd
 
	gm‘hods
, 
wh”e
 
—ch
 
b¿nch
 
š
 
the
»
cÜ»¥Úds
 
to


8 
a
 
b¿nch
 
š
 
the
 
URL
 
	g·th
. 
Each
 
m‘hod
 
is
 
	ga
 '·ghªdËr', 
which
 
»ûives


9 
GET
 
ªd
 
POST
 
·¿ms
 
as
 
keywÜd
 
	g¬gum’ts
,‡nd 
»tuºs
 
Ü
 
y›lds
 
	$the
 (
HTML
)

10 
body
 
of
 
the
 
»¥Ú£
. 
The
 
¥ecŸl
 
m‘hod
 
Çme
 'šdex' 
is
 
u£d
 
·ths


11 
th©
 
’d
 
š
 
a
 
¦ash
, 
ªd
 
the
 
¥ecŸl
 
m‘hod
 
Çme
 'deçuÉ' 
is
 
u£d
 
to


12 
hªdË
 
muÉË
 
·ths
 
vŸ
 
a
 
sšgË
 
hªdËr
. 
This
 
Ïy”
 
®so
 
šşudes
:

14 * 
the
 'expo£d' 
	`©Œibu‹
 (
ªd
 
ch”rypy
.
expo£
)

15 * 
ch”rypy
.
	`quick¡¬t
()

16 * 
_ı_cÚfig
 
©Œibu‹s


17 * 
ch”rypy
.
	`toŞs
 (
šşudšg
 ch”rypy.
£ssiÚ
)

18 * 
ch”rypy
.
	$u¾
()

20 
The
 
ENVIRONMENT
 
LAYER
 
is
 
u£d
 
by
 
dev–İ”s
 
©
 
®l
 
Ëv–s
. 
It
 
´ovides


21 
šfÜm©iÚ
 
about
 
the
 
cu¼’t
 
»que¡
 
ªd
 
»¥Ú£
, 
¶us
h
­¶iÿtiÚ


22 
ªd
 
£rv”
 
’vœÚm’t
, 
vŸ
 
	$a
 (è
£t
 
of
 
tİ
-
Ëv–
 
objeùs
:

24 * 
ch”rypy
.
»que¡


25 * 
ch”rypy
.
»¥Ú£


26 * 
ch”rypy
.
’gše


27 * 
ch”rypy
.
£rv”


28 * 
ch”rypy
.
Œ“


29 * 
ch”rypy
.
cÚfig


30 * 
ch”rypy
.
th»ad_d©a


31 * 
ch”rypy
.
log


32 * 
ch”rypy
.
HTTPE¼Ü
, 
NÙFound
, 
ªd
 
HTTPRedœeù


33 * 
ch”rypy
.
lib


35 
The
 
EXTENSION
 
LAYER
 
®lows
 
advªûd
 
u£rs
 
to
 
cÚ¡ruù
 
ªd
 
sh¬e
 
theœ
 
own


36 
¶ugšs
. 
It
 
cÚsi¡s
 
of
:

38 * 
Hook
 
API


39 * 
ToŞ
 
API


40 * 
ToŞbox
 
API


41 * 
Di¥©ch
 
API


42 * 
CÚfig
 
Name¥aû
 
API


44 
Fš®ly
, 
th”e
 
is
 
the
 
CORE
 
LAYER
, 
which
 
u£s
h
cÜe
 
API
'so construct

45 
the
  
compÚ’ts
 
which
 
¬e
 
avaabË
 
©
 
high”
 
Ïy”s
. 
You
 
ÿn
 
thšk


46 
of
 
the
  
compÚ’ts
 
as
h'»ã»nû im¶em’tiÚ' 
Ch”ryPy
.

47 
	$MegaäamewÜks
 (
ªd
 
advªûd
 
u£rs
è
may
 
»¶aû
 
the
  
compÚ’ts


48 
w™h
 
cu¡omized
 
Ü
 
ex‹nded
 
compÚ’ts
. 
The
 
cÜe
 
API
's‡re:

50 * 
AµliÿtiÚ
 
API


51 * 
Engše
 
API


52 * 
Reque¡
 
API


53 * 
S”v”
 
API


54 * 
WSGI
 
API


56 
The£
 
API
's‡re described inhe CherryPy specification:

57 
h‰p
:

60 
__v”siÚ__
 = "3.2.4"

62 
äom
 
ch”rypy
.
_ıcom·t
 
impÜt
 
u¾još
 
as
 
_u¾još
, 
u¾’code
‡ 
_u¾’code


63 
äom
 
ch”rypy
.
_ıcom·t
 
impÜt
 
ba£¡ršg
, 
unicode¡r
, 
£t


65 
äom
 
ch”rypy
.
_ı”rÜ
 
impÜt
 
HTTPE¼Ü
, 
HTTPRedœeù
, 
IÁ”ÇlRedœeù


66 
äom
 
ch”rypy
.
_ı”rÜ
 
impÜt
 
NÙFound
, 
Ch”ryPyExû±iÚ
, 
TimeoutE¼Ü


68 
äom
 
ch”rypy
 
impÜt
 
_ıdi¥©ch
 
as
 
di¥©ch


70 
äom
 
ch”rypy
 
impÜt
 
_ıtoŞs


71 
toŞs
 = 
_ıtoŞs
.
deçuÉ_toŞbox


72 
ToŞ
 = 
_ıtoŞs
.Tool

74 
äom
 
ch”rypy
 
impÜt
 
_ı»que¡


75 
äom
 
ch”rypy
.
lib
 
impÜt
 
h‰put
 
as
 
_h‰put


77 
äom
 
ch”rypy
 
impÜt
 
_ıŒ“


78 
Œ“
 = 
_ıŒ“
.
	$T»e
()

79 
äom
 
ch”rypy
.
_ıŒ“
 
impÜt
 
AµliÿtiÚ


80 
äom
 
ch”rypy
 
impÜt
 
_ıwsgi
 
as
 
wsgi


82 
äom
 
ch”rypy
 
impÜt
 
´oûss


83 
Œy
:

84 
äom
 
ch”rypy
.
´oûss
 
impÜt
 
wš32


85 
’gše
 = 
wš32
.
	$Wš32Bus
()

86 
’gše
.
cÚsŞe_cÚŒŞ_hªdËr
 = 
wš32
.
	$CÚsŞeCŒlHªdËr
(
’gše
)

87 
d–
 
wš32


88 
exû±
 
ImpÜtE¼Ü
:

89 
’gše
 = 
´oûss
.
bus


92 #Timeouˆ
mÚ™Ü
. 
We
 
add
 
two
 
chªÃls
 
to
 
the
 
’gše


93 #tØ
which
 
ch”rypy
.
AµliÿtiÚ
 
wl
 
publish
.

94 
’gše
.
li¡’”s
['befÜe_»que¡'] = 
	$£t
()

95 
’gše
.
li¡’”s
['aá”_»que¡'] = 
	$£t
()

97 
şass
 
	$_TimeoutMÚ™Ü
(
´oûss
.
¶ugšs
.
MÚ™Ü
):

99 
def
 
	$__š™__
(
£lf
, 
bus
):

100 
£lf
.
£rvšgs
 = []

101 
´oûss
.
¶ugšs
.
MÚ™Ü
.
	$__š™__
(
£lf
, 
bus
, s–f.
run
)

103 
def
 
	$befÜe_»que¡
(
£lf
):

104 
£lf
.
£rvšgs
.
	`­³nd
((
£rvšg
.
»que¡
, s”všg.
»¥Ú£
))

106 
def
 
	$aá”_»que¡
(
£lf
):

107 
Œy
:

108 
£lf
.
£rvšgs
.
	`»move
((
£rvšg
.
»que¡
, s”všg.
»¥Ú£
))

109 
exû±
 
V®ueE¼Ü
:

110 
·ss


112 
def
 
	$run
(
£lf
):

114 
»q
, 
»¥
 
š
 
£lf
.
£rvšgs
:

115 
»¥
.
	$check_timeout
()

116 
’gše
.
timeout_mÚ™Ü
 = 
	$_TimeoutMÚ™Ü
(
’gše
)

117 
’gše
.
timeout_mÚ™Ü
.
	$subsüibe
()

119 
’gše
.
autÜ–ßd
 = 
´oûss
.
¶ugšs
.
	$AutÜ–ßd”
(
’gše
)

120 
’gše
.
autÜ–ßd
.
	$subsüibe
()

122 
’gše
.
th»ad_mªag”
 = 
´oûss
.
¶ugšs
.
	$Th»adMªag”
(
’gše
)

123 
’gše
.
th»ad_mªag”
.
	$subsüibe
()

125 
’gše
.
sigÇl_hªdËr
 = 
´oûss
.
¶ugšs
.
	$SigÇlHªdËr
(
’gše
)

128 
şass
 
	$_HªdËSigÇlsPlugš
(
objeù
):

130 
¶©fÜm
 
hªdËrs
 
above
."""

132 
def
 
	$__š™__
(
£lf
, 
bus
):

133 
£lf
.
bus
 = bus

135 
def
 
	$subsüibe
(
£lf
):

137 
	`ha§‰r
(
£lf
.
bus
, "signal_handler"):

138 
£lf
.
bus
.
sigÇl_hªdËr
.
	$subsüibe
()

139 
	`ha§‰r
(
£lf
.
bus
, "console_control_handler"):

140 
£lf
.
bus
.
cÚsŞe_cÚŒŞ_hªdËr
.
	$subsüibe
()

142 
’gše
.
sigÇls
 = 
	$_HªdËSigÇlsPlugš
(
’gše
)

145 
äom
 
ch”rypy
 
impÜt
 
_ı£rv”


146 
£rv”
 = 
_ı£rv”
.
	$S”v”
()

147 
£rv”
.
	$subsüibe
()

150 
def
 
	`quick¡¬t
(
roÙ
=
NÚe
, 
süt_Çme
="", 
cÚfig
=None):

153 
roÙ
: 
ª
 
š¡ªû
 
of
 
a
 "cÚŒŞË¸şass" (¨
cŞËùiÚ
 oà
·ge
 
hªdËr


154 
m‘hods
è
which
 
»´e£Ás
 
the
 
roÙ
 
of
h
­¶iÿtiÚ
.

155 
süt_Çme
: 
a
 
¡ršg
 
cÚššg
 
the
 "mouÁ…ošt" 
of
h
­¶iÿtiÚ
.

156 
This
 
should
 
¡¬t
 
w™h
 
a
 
¦ash
, 
ªd
 
be
 
the
 
·th
 
pÜtiÚ
 
of
h
URL


157 
©
 
which
 
to
 
mouÁ
 
the
 
giv’
 
roÙ
. 
FÜ
 
exam¶e
, roÙ.
	$šdex
(è
wl


158 
hªdË
 
»que¡s
 
to
 "h‰p://www.exam¶e.com:8080/d•t/­p1/", 
th’


159 
the
 
süt_Çme
 
¬gum’t
 
would
 
be
 "/dept/app1".

161 
It
 
MUST
 
NOT
 
’d
 
š
 
a
 
¦ash
. 
If
 
the
 
süt_Çme
 
»ãrs
 
to
h
roÙ


162 
of
 
the
 
URI
, 
™
 
MUST
 
be
 
ª
 
em±y
 
	`¡ršg
 (
nÙ
 "/").

163 
cÚfig
: 
a
 
fe
 
Ü
 
diù
 
cÚššg
 
­¶iÿtiÚ
 cÚfig. 
If
 
this
 
cÚšs


164 
a
 [
glob®
] 
£ùiÚ
, 
tho£
 
’Œ›s
 
wl
 
be
 
u£d
 
š
 
the
 global

165 (
s™e
-
wide
è
cÚfig
.

167 
cÚfig
:

168 
_glob®_cÚf_®Ÿs
.
	$upd©e
(
cÚfig
)

170 
Œ“
.
	$mouÁ
(
roÙ
, 
süt_Çme
, 
cÚfig
)

172 
’gše
.
sigÇls
.
	$subsüibe
()

173 
’gše
.
	$¡¬t
()

174 
’gše
.
	$block
()

177 
äom
 
ch”rypy
.
_ıcom·t
 
impÜt
 
th»adloÿl
 
as
 
_loÿl


179 
şass
 
	$_S”všg
(
_loÿl
):

182 
R©h”
 
thª
 
have
 
a
 
£·¿‹
 "th»ad†oÿl" 
objeù
 
the
 
»que¡
 
ªd


183 
the
 
»¥Ú£
, 
this
 
şass
 
wÜks
 
as
 
a
 
sšgË
 
th»adloÿl
 
cÚš”
 

184 
bÙh
 
	`objeùs
 (
ªd
 
ªy
 
Ùh”s
 
which
 
dev–İ”s
 
wish
 
to
 
defše
). 
In
 
this


185 
way
, 
we
 
ÿn
 
—sy
 
dump
 
tho£
 
objeùs
 
wh’
 w
¡İ
/
¡¬t
 
a
 
Ãw
 
HTTP


186 
cÚv”§tiÚ
, 
y‘
 
¡l
 
»ãr
 
to
 
them
 
as
 
moduË
-
Ëv–
 
glob®s
 
š
 
a


187 
th»ad
-
§ã
 
way
.

190 
»que¡
 = 
_ı»que¡
.
	`Reque¡
(
_h‰put
.
	`Ho¡
("127.0.0.1", 80),

191 
_h‰put
.
	`Ho¡
("127.0.0.1", 1111))

193 
The
 
»que¡
 
objeù
 
the
 
cu¼’t
 
th»ad
. 
In
h
maš
hread,

194 
ªd
 
ªy
 
th»ads
 
which
 
¬e
 
nÙ
 
»ûivšg
 
HTTP
 
»que¡s
, 
this
 
is
 
NÚe
."""

196 
»¥Ú£
 = 
_ı»que¡
.
	`Re¥Ú£
()

198 
The
 
»¥Ú£
 
objeù
 
the
 
cu¼’t
 
th»ad
. 
In
h
maš
hread,

199 
ªd
 
ªy
 
th»ads
 
which
 
¬e
 
nÙ
 
»ûivšg
 
HTTP
 
»que¡s
, 
this
 
is
 
NÚe
."""

201 
def
 
	$lßd
(
£lf
, 
»que¡
, 
»¥Ú£
):

202 
£lf
.
»que¡
 =„equest

203 
£lf
.
»¥Ú£
 =„esponse

205 
def
 
	$ş—r
(
£lf
):

207 
£lf
.
__diù__
.
	$ş—r
()

209 
£rvšg
 = 
	$_S”všg
()

212 
şass
 
	$_Th»adLoÿlProxy
(
objeù
):

214 
__¦Ùs__
 = ['__attrname__', '__dict__']

216 
def
 
	$__š™__
(
£lf
, 
©ŒÇme
):

217 
£lf
.
__©ŒÇme__
 = 
©ŒÇme


219 
def
 
	$__g‘©Œ__
(
£lf
, 
Çme
):

220 
chd
 = 
	$g‘©Œ
(
£rvšg
, 
£lf
.
__©ŒÇme__
)

221  
	$g‘©Œ
(
chd
, 
Çme
)

223 
def
 
	$__£‰r__
(
£lf
, 
Çme
, 
v®ue
):

224 
Çme
 
	`š
 ("__attrname__", ):

225 
objeù
.
	$__£‰r__
(
£lf
, 
Çme
, 
v®ue
)

227 
chd
 = 
	$g‘©Œ
(
£rvšg
, 
£lf
.
__©ŒÇme__
)

228 
	$£‰r
(
chd
, 
Çme
, 
v®ue
)

230 
def
 
	$__d–©Œ__
(
£lf
, 
Çme
):

231 
chd
 = 
	$g‘©Œ
(
£rvšg
, 
£lf
.
__©ŒÇme__
)

232 
	$d–©Œ
(
chd
, 
Çme
)

234 
def
 
	$_g‘_diù
(
£lf
):

235 
chd
 = 
	$g‘©Œ
(
£rvšg
, 
£lf
.
__©ŒÇme__
)

236 
d
 = 
chd
.
__şass__
.
__diù__
.
	$cİy
()

237 
d
.
	$upd©e
(
chd
.
__diù__
)

238  
d


239 
__diù__
 = 
	$´İ”ty
(
_g‘_diù
)

241 
def
 
	$__g‘™em__
(
£lf
, 
key
):

242 
chd
 = 
	$g‘©Œ
(
£rvšg
, 
£lf
.
__©ŒÇme__
)

243  
chd
[
key
]

245 
def
 
	$__£t™em__
(
£lf
, 
key
, 
v®ue
):

246 
chd
 = 
	$g‘©Œ
(
£rvšg
, 
£lf
.
__©ŒÇme__
)

247 
chd
[
key
] = 
v®ue


249 
def
 
	$__d–™em__
(
£lf
, 
key
):

250 
chd
 = 
	$g‘©Œ
(
£rvšg
, 
£lf
.
__©ŒÇme__
)

251 
d–
 
chd
[
key
]

253 
def
 
	$__cÚšs__
(
£lf
, 
key
):

254 
chd
 = 
	$g‘©Œ
(
£rvšg
, 
£lf
.
__©ŒÇme__
)

255  
key
 
š
 
chd


257 
def
 
	$__Ën__
(
£lf
):

258 
chd
 = 
	$g‘©Œ
(
£rvšg
, 
£lf
.
__©ŒÇme__
)

259  
	$Ën
(
chd
)

261 
def
 
	$__nÚz”o__
(
£lf
):

262 
chd
 = 
	$g‘©Œ
(
£rvšg
, 
£lf
.
__©ŒÇme__
)

263  
	$boŞ
(
chd
)

265 
__boŞ__
 = 
__nÚz”o__


267 #C»©
»que¡
 
ªd
 
»¥Ú£
 
	`objeù
 (
the
 
§me
 
objeùs
 
wl
 
be
 
u£d


268 #throughouˆ
the
 
’tœe
 
liã
 
of
h
web£rv”
, 
but
 
wl
 
»dœeù


269 #tØ
the
 "£rvšg" 
objeù
)

270 
»que¡
 = 
	`_Th»adLoÿlProxy
('request')

271 
»¥Ú£
 = 
	`_Th»adLoÿlProxy
('response')

273 #C»©
th»ad_d©a
 
objeù
 
as
 
a
 
th»ad
-
¥ecific
 
®l
-
pu½o£
 
¡Üage


274 
şass
 
	$_Th»adD©a
(
_loÿl
):

276 
th»ad_d©a
 = 
	$_Th»adD©a
()

279 #MÚkey·tch 
pydoc
 
to
 
®low
 
	`h–p
(ètØ
go
 
through
 
the
 
th»adloÿl
 
´oxy
.

280 #Jª 2007: 
no
 
GoogËabË
 
exam¶es
 
of
 
ªyÚe
 
»¶acšg
 
pydoc
.
»sŞve
.

281 #Th
Úly
 
Ùh”
 
way
 
would
 
be
 
to
 
chªge
 
wh©
 
is
 
»tuºed
 
äom
 
	`ty³
(
»que¡
)

282 #ªd 
th©
' nÙ…ossibË iÀpu» PythÚ (you'
d
 
have
 
to
 
çke
 
ob_ty³
).

283 
def
 
	$_ch”rypy_pydoc_»sŞve
(
thšg
, 
fÜûlßd
=0):

285 
	$isš¡ªû
(
thšg
, 
_Th»adLoÿlProxy
):

286 
thšg
 = 
	$g‘©Œ
(
£rvšg
, 
thšg
.
__©ŒÇme__
)

287  
_pydoc
.
	$_butš_»sŞve
(
thšg
, 
fÜûlßd
)

289 
Œy
:

290 
impÜt
 
pydoc
 
as
 
_pydoc


291 
_pydoc
.
_butš_»sŞve
 = _pydoc.
»sŞve


292 
_pydoc
.
»sŞve
 = 
_ch”rypy_pydoc_»sŞve


293 
exû±
 
ImpÜtE¼Ü
:

294 
·ss


297 
äom
 
ch”rypy
 
impÜt
 
_ıloggšg


299 
şass
 
	$_Glob®LogMªag”
(
_ıloggšg
.
LogMªag”
):

302 
This
 :
şass
:`
LogMªag”
<
ch”rypy
.
_ıloggšg
.LogMªag”>` 
im¶em’ts


303 
ch”rypy
.
	$log
(è
ªd
 
ch”rypy
.
log
.
	`acûss
(). 
If
 
e™h”


304 
funùiÚ
 
is
 
ÿÎed
 
duršg
 
a
 
»que¡
, 
the
 
mes§ge
 
wl
 
be
 
£Á
 
to
he

305 
logg”
 
the
 
cu¼’t
 
AµliÿtiÚ
. 
If
 
they
 
¬e
 
ÿÎed
 
outside
 
of
 
a


306 
»que¡
, 
the
 
mes§ge
 
wl
 
be
 
£Á
 
to
h
s™e
-
wide
 
logg”
.

309 
def
 
	$__ÿÎ__
(
£lf
, *
¬gs
, **
kw¬gs
):

311 #DØ
NOT
 
u£
 
Œy
/
exû±
 
h”e
. 
S“
 
h‰p
:

312 
	`ha§‰r
(
»que¡
, '­p'è
ªd
 ha§‰rÔeque¡.
­p
, 'log'):

313 
log
 = 
»que¡
.
­p
.log

315 
log
 = 
£lf


316  
log
.
	$”rÜ
(*
¬gs
, **
kw¬gs
)

318 
def
 
	$acûss
(
£lf
):

320 
Œy
:

321  
»que¡
.
­p
.
log
.
	$acûss
()

322 
exû±
 
A‰ribu‹E¼Ü
:

323  
_ıloggšg
.
LogMªag”
.
	$acûss
(
£lf
)

326 
log
 = 
	$_Glob®LogMªag”
()

327 #S‘ 
a
  
sü“n
 
hªdËr
 
Ú
 
the
 
glob®
 
log
.

328 
log
.
sü“n
 = 
True


329 
log
.
”rÜ_fe
 = ''

330 #Usšg 
ª
 
acûss
 
fe
 
makes
 
CP
 
about
 10% 
¦ow”
. 
L—ve
 
off
 
by
 .

331 
log
.
acûss_fe
 = ''

333 
def
 
	$_bu¦og
(
msg
, 
Ëv–
):

334 
log
.
	`”rÜ
(
msg
, 'ENGINE', 
£v”™y
=
Ëv–
)

335 
’gše
.
	`subsüibe
('log', 
_bu¦og
)

337 #H–³¸
funùiÚs
 
CP
 
­ps
 #


339 
def
 
	$expo£
(
func
=
NÚe
, 
®Ÿs
=None):

341 
def
 
	$expo£_
(
func
):

342 
func
.
expo£d
 = 
True


343 
®Ÿs
 
is
 
nÙ
 
NÚe
:

344 
	$isš¡ªû
(
®Ÿs
, 
ba£¡ršg
):

345 
·»Ás
[
®Ÿs
.
	`»¶aû
(".", "_")] = 
func


347 
a
 
š
 
®Ÿs
:

348 
·»Ás
[
a
.
	`»¶aû
(".", "_")] = 
func


349  
func


351 
impÜt
 
sys
, 
ty³s


352 
	`isš¡ªû
(
func
, (
ty³s
.
FunùiÚTy³
,y³s.
M‘hodTy³
)):

353 
®Ÿs
 
is
 
NÚe
:

354 #@
expo£


355 
func
.
expo£d
 = 
True


356  
func


358 #funøğ
	`expo£
(
func
, 
®Ÿs
)

359 
·»Ás
 = 
sys
.
	`_g‘äame
(1).
f_loÿls


360  
	$expo£_
(
func
)

361 
–if
 
func
 
is
 
NÚe
:

362 
®Ÿs
 
is
 
NÚe
:

363 #@
	`expo£
()

364 
·»Ás
 = 
sys
.
	`_g‘äame
(1).
f_loÿls


365  
expo£_


367 #@
	`expo£
(
®Ÿs
="®Ÿs"è
Ü


368 #@
	`expo£
(
®Ÿs
=["alias1", "alias2"])

369 
·»Ás
 = 
sys
.
	`_g‘äame
(1).
f_loÿls


370  
expo£_


372 #@
	`expo£
("®Ÿs"è
Ü


373 #@
	`expo£
(["alias1", "alias2"])

374 
·»Ás
 = 
sys
.
	`_g‘äame
(1).
f_loÿls


375 
®Ÿs
 = 
func


376  
expo£_


378 
def
 
	$pİ¬gs
(*
¬gs
, **
kw¬gs
):

380 (
ch”rypy
.
di¥©ch
.
Di¥©ch”
.
di¥©ch_m‘hod_Çme
).

382 
O±iÚ®
 
keywÜd
 
¬gum’t
: 
hªdËr
=(
Objeù
 
Ü
 
FunùiÚ
)

384 
Provides
 
a
 
_ı_di¥©ch
 
funùiÚ
 
th©
 
pİs
 
off
 
·th
 
£gm’ts
 
što


385 
ch”rypy
.
»que¡
.
·¿ms
 
und”
 
the
 
Çmes
 
¥ecif›d
. 
The
 
di¥©ch


386 
is
 
th’
 
fÜw¬ded
 
Ú
 
to
 
the
 
Ãxt
 
v·th
 
–em’t
.

388 
NÙe
 
th©
 
ªy
 
	$exi¡šg
 (
ªd
 
expo£d
è
memb”
 
funùiÚ
 
of
 
the
 
şass
 
th©


389 
pİ¬gs
 
is
 
­¶›d
 
to
 
wl
 
ov”ride
 
th©
 
v®ue
 
of
 
the
 
¬gum’t
. 
FÜ


390 
š¡ªû
, 
you
 
have
 
a
 
m‘hod
 
Çmed
 "li¡" 
Ú
 
the
 
şass
 
decÜ©ed
 
w™h


391 
pİ¬gs
, 
th’
 
acûssšg
 "/li¡" 
wl
 
ÿÎ
 
th©
 
funùiÚ
 
š¡—d
 
of
 
pİpšg


392 
™
 
off
 
as
 
the
 
»que¡ed
 
·¿m‘”
. 
This
 
»¡riùiÚ
 
­¶›s
 
to
 
®l


393 
_ı_di¥©ch
 
funùiÚs
. 
The
 
Úly
 
way
 
¬ound
 
this
 
»¡riùiÚ
 
is
 
to
 
ü—‹


394 
a
 "bÏnk cÏss" 
who£
 
Úly
 
funùiÚ
 
is
 
to
 
´ovide
 
_ı_di¥©ch
.

396 
If
 
th”e
 
¬e
 
·th
 
–em’ts
 
aá”
 
the
 
¬gum’ts
, 
Ü
 
mÜe
‡rguments

397 
¬e
 
»que¡ed
 
thª
‡» 
avaabË
 
š
 
the
 
v·th
, 
th’
he 'handler'

398 
keywÜd
 
¬gum’t
 
¥ecif›s
 
the
 
Ãxt
 
objeù
 
to
 
hªdË
h
·¿m‘”ized


399 
»que¡
. 
If
 
hªdËr
 
is
 
nÙ
 
¥ecif›d
 
Ü
 i 
NÚe
, 
th’
 
£lf
 i 
u£d
.

400 
If
 
hªdËr
 
is
 
a
 
funùiÚ
 
¿th”
 
thª
 
ª
 
š¡ªû
, 
th’
 
th©
 function

401 
wl
 
be
 
ÿÎed
 
w™h
 
the
 
¬gs
 
¥ecif›d
 
ªd
h 
v®ue
 
äom
 
th©


402 
funùiÚ
 
u£d
 
as
 
the
 
Ãxt
 
objeù
 
INSTEAD
 
of
 
addšg
h
·¿m‘”s
 
to


403 
ch”rypy
.
»que¡
.
¬gs
.

405 
This
 
decÜ©Ü
 
may
 
be
 
u£d
 
š
 
Úe
 
of
 
two
 
ways
:

407 
As
 
a
 
şass
 
decÜ©Ü
:

408 @
ch”rypy
.
	`pİ¬gs
('year', 'month', 'day')

409 
şass
 
Blog
:

410 
def
 
	$šdex
(
£lf
, 
y—r
=
NÚe
, 
mÚth
=NÚe, 
day
=None):

411 #Proûs 
the
 
·¿m‘”s
 
h”e
; 
ªy
 
u¾
 
like


412 #/, /2009, /2009/12, 
Ü
 /2009/12/31

413 #wÈ
fl
 
š
 
the
 
­´İrŸ‹
 
·¿m‘”s
.

415 
def
 
	$ü—‹
(
£lf
):

416 #Thi 
lšk
 
wl
 
¡l
 
be
 
avaabË
 
©
 /
ü—‹
. 
Defšed
 
funùiÚs


417 #k
´eûd’û
 
ov”
 
¬gum’ts
.

419 
Or
 
as
 
a
 
memb”
 
of
‡ 
şass
:

420 
şass
 
Blog
:

421 
_ı_di¥©ch
 = 
ch”rypy
.
	`pİ¬gs
('year', 'month', 'day')

424 
The
 
hªdËr
 
¬gum’t
 
may
 
be
 
u£d
 
to
 
mix
 
¬gum’ts
 
w™h
 
but
 
š
 
funùiÚs
.

425 
FÜ
 
š¡ªû
, 
the
 
fŞlowšg
 
£tup
 
®lows
 
difã»Á
 
aùiv™›s
 
©
he

426 
day
, 
mÚth
, 
ªd
 
y—r
 
Ëv–
:

428 
şass
 
DayHªdËr
:

429 
def
 
	$šdex
(
£lf
, 
y—r
, 
mÚth
, 
day
):

430 #DØ
som‘hšg
 
w™h
 
this
 
day
; 
´obably
 
li¡
 
’Œ›s


432 
def
 
	$d–‘e
(
£lf
, 
y—r
, 
mÚth
, 
day
):

433 #D–‘
®l
 
’Œ›s
 
this
 
day


435 @
ch”rypy
.
	`pİ¬gs
('day', 
hªdËr
=
	$DayHªdËr
())

436 
şass
 
MÚthHªdËr
:

437 
def
 
	$šdex
(
£lf
, 
y—r
, 
mÚth
):

438 #DØ
som‘hšg
 
w™h
 
this
 
mÚth
; 
´obably
 
li¡
 
’Œ›s


440 
def
 
	$d–‘e
(
£lf
, 
y—r
, 
mÚth
):

441 #D–‘
®l
 
’Œ›s
 
this
 
mÚth


443 @
ch”rypy
.
	`pİ¬gs
('mÚth', 
hªdËr
=
	$MÚthHªdËr
())

444 
şass
 
Y—rHªdËr
:

445 
def
 
	$šdex
(
£lf
, 
y—r
):

446 #DØ
som‘hšg
 
w™h
 
this
 
y—r


450 @
ch”rypy
.
	`pİ¬gs
('y—r', 
hªdËr
=
	$Y—rHªdËr
())

451 
şass
 
RoÙ
:

452 
def
 
	$šdex
(
£lf
):

457 #Sšû 
keywÜd
 
¬g
 
comes
 
aá”
 *
¬gs
, 
we
 
have
 
to
 
´oûss
 
™
 
our£lves


458 #fÜ 
low”
 
v”siÚs
 
of
 
pythÚ
.

460 
hªdËr
 = 
NÚe


461 
hªdËr_ÿÎ
 = 
F®£


462 
k
,
v
 
š
 
kw¬gs
.
	$™ems
():

463 
k
 == 'handler':

464 
hªdËr
 = 
v


466 
¿i£
 
	`Ty³E¼Ü
(

468 .
	$fÜm©
(
k
)

471 
impÜt
 
š¥eù


473 
hªdËr
 
is
 
nÙ
 
NÚe
 \

474 
	`ªd
 (
	`ha§‰r
(
hªdËr
, '__ÿÎ__'è
Ü
 
š¥eù
.
	$isşass
(
hªdËr
)):

475 
hªdËr_ÿÎ
 = 
True


477 
def
 
	$decÜ©ed
(
şs_Ü_£lf
=
NÚe
, 
v·th
=None):

478 
š¥eù
.
	$isşass
(
şs_Ü_£lf
):

479 #ch”rypy.
pİ¬gs
 
is
 
a
 
şass
 
decÜ©Ü


480 
şs
 = 
şs_Ü_£lf


481 
	$£‰r
(
şs
, 
di¥©ch
.
Di¥©ch”
.
di¥©ch_m‘hod_Çme
, 
decÜ©ed
)

482  
şs


485 
£lf
 = 
şs_Ü_£lf


486 
·rms
 = {
	}
}

487 
¬g
 
š
 
¬gs
:

488 
nÙ
 
v·th
:

490 
·rms
[
¬g
] = 
v·th
.
	$pİ
(0)

492 
hªdËr
 
is
 
nÙ
 
NÚe
:

493 
hªdËr_ÿÎ
:

494  
	$hªdËr
(**
·rms
)

496 
»que¡
.
·¿ms
.
	$upd©e
(
·rms
)

497  
hªdËr


499 
»que¡
.
·¿ms
.
	$upd©e
(
·rms
)

501 #Ià
we
 
¬e
 
the
 
uÉim©e
 
hªdËr
, 
th’
 
to
 
´ev’t
 
our
 
_ı_di¥©ch


502 #äom 
bešg
 
ÿÎed
 
agaš
, 
we
 
wl
 
»sŞve
 
»maššg
 
–em’ts
 
through


503 #g‘©Œ(è
dœeùly
.

504 
v·th
:

505  
	`g‘©Œ
(
£lf
, 
v·th
.
	`pİ
(0), 
NÚe
)

507  
£lf


509  
decÜ©ed


511 
def
 
	`u¾
(
·th
="", 
qs
="", 
süt_Çme
=
NÚe
, 
ba£
=NÚe, 
»Ïtive
=None):

514 
If
 '·th' 
¡¬ts
 
w™h
 
a
 
	`¦ash
 ('/'), 
this
 
wl
 

515 (
ba£
 + 
süt_Çme
 + 
·th
 + 
qs
).

516 
If
 
™
 
dÛs
 
nÙ
 
¡¬t
 
w™h
 
a
 
¦ash
, 
this
 
»tuºs


517 (
ba£
 + 
süt_Çme
 [+ 
»que¡
.
·th_šfo
] + 
·th
 + 
qs
).

519 
If
 
süt_Çme
 
is
 
NÚe
, 
ch”rypy
.
»que¡
 
wl
 
be
 
u£d


520 
to
 
fšd
 
a
 
süt_Çme
, 
avaabË
.

522 
If
 
ba£
 
is
 
NÚe
, 
ch”rypy
.
»que¡
.ba£ 
wl
 
be
 
	`u£d
 (
avaabË
).

523 
NÙe
 
th©
 
you
 
ÿn
 
u£
 
ch”rypy
.
toŞs
.
´oxy
 
to
 
chªge
 
this
.

525 
Fš®ly
, 
nÙe
 
th©
 
this
 
funùiÚ
 
ÿn
 
be
 
u£d
 
to
 
obš
 
ª
 
absŞu‹
 
URL


526 
the
 
cu¼’t
 
»que¡
 
	$·th
 (
mšus
 
the
 
qu”y¡ršg
è
by
 
·ssšg
 
no
 
¬gs
.

527 
If
 
you
 
ÿÎ
 
	`u¾
(
qs
=
ch”rypy
.
»que¡
.
qu”y_¡ršg
), you 
should
 
g‘
 
the


528 
Üigš®
 
brow£r
 
	`URL
 (
assumšg
 
no
 
š‹º®
 
»dœeùiÚs
).

530 
If
 
»Ïtive
 
is
 
NÚe
 
Ü
 
nÙ
 
´ovided
, 
»que¡
.
­p
.
»Ïtive_u¾s
 
wl


531 
be
 
	`u£d
 (
avaabË
, 
F®£
). 
If
 F®£, 
the
 
ouut
 
wl
 b
ª


532 
absŞu‹
 
	`URL
 (
šşudšg
 
the
 
scheme
, 
ho¡
, 
vho¡
, 
ªd
 
süt_Çme
).

533 
If
 
True
, 
the
 
ouut
 
wl
 
š¡—d
 
be
 
a
 
URL
 
th©
 
is
 
»Ïtive
 
to
he

534 
cu¼’t
 
»que¡
 
·th
, 
³rh­s
 
šşudšg
 '..' 
©oms
. 
If
 
»Ïtive
 
is


535 
the
 
¡ršg
 '£rv”',h
ouut
 
wl
 
š¡—d
 
be
 
a
 
URL
 
th©
 
is


536 
»Ïtive
 
to
 
the
 
£rv”
 
roÙ
; 
i
.
e
., 
™
 
wl
 
¡¬t
 
w™h
 
a
 
¦ash
.

538 
	`isš¡ªû
(
qs
, (
tu¶e
, 
li¡
, 
diù
)):

539 
qs
 = 
	$_u¾’code
(
qs
)

540 
qs
:

541 
qs
 = '?' + qs

543 
»que¡
.
­p
:

544 
nÙ
 
·th
.
	`¡¬tsw™h
("/"):

545 #Aµ’d/
»move
 
Œašg
 
¦ash
 
äom
 
·th_šfo
 
as
 
Ãeded


546 #(
this
 
is
 
to
 
suµÜt
 
mi¡y³d
 
URL
's without„edirecting;

547 #ià
you
 
wªt
 
to
 
»dœeù
, 
u£
 
toŞs
.
Œašg_¦ash
).

548 
pi
 = 
»que¡
.
·th_šfo


549 
»que¡
.
is_šdex
 
is
 
True
:

550 
nÙ
 
pi
.
	`’dsw™h
('/'):

551 
pi
 =…i + '/'

552 
–if
 
»que¡
.
is_šdex
 
is
 
F®£
:

553 
pi
.
	`’dsw™h
('/'è
ªd
…i != '/':

554 
pi
 =…i[:-1]

556 
·th
 == "":

557 
·th
 = 
pi


559 
·th
 = 
	$_u¾još
(
pi
, 
·th
)

561 
süt_Çme
 
is
 
NÚe
:

562 
süt_Çme
 = 
»que¡
.script_name

563 
ba£
 
is
 
NÚe
:

564 
ba£
 = 
»que¡
.base

566 
Ãwu¾
 = 
ba£
 + 
süt_Çme
 + 
·th
 + 
qs


568 #NØ
»que¡
.
	`­p
 (
we
're being called outside‡„equest).

570 #Thi 
wl
 
´oduû
 
v”y
 
difã»Á
 
»suÉs
 
äom
 
the
 
above


571 #ià
you
're using vhosts orools.proxy.

572 
ba£
 
is
 
NÚe
:

573 
ba£
 = 
£rv”
.
	$ba£
()

575 
·th
 = (
süt_Çme
 
Ü
 "") +…ath

576 
Ãwu¾
 = 
ba£
 + 
·th
 + 
qs


578 './' 
š
 
Ãwu¾
:

579 #NÜm®iz
the
 
URL
 
by
 
»movšg
 ./ 
ªd
 ../

580 
©oms
 = []

581 
©om
 
š
 
Ãwu¾
.
	`¥l™
('/'):

582 
©om
 == '.':

583 
·ss


584 
–if
 
©om
 == '..':

585 
©oms
.
	$pİ
()

587 
©oms
.
	$­³nd
(
©om
)

588 
Ãwu¾
 = '/'.
	$još
(
©oms
)

590 #Aˆ
this
 
pošt
, 
we
 
should
 
have
 
a
 
fuÎy
-
qu®if›d
 
absŞu‹
 
URL
.

592 
»Ïtive
 
is
 
NÚe
:

593 
»Ïtive
 = 
	`g‘©Œ
(
»que¡
.
­p
, "»Ïtive_u¾s", 
F®£
)

595 #S“ 
h‰p
:

596 
»Ïtive
 == 'server':

597 #"
A
 
»Ïtive
 
»ã»nû
 
begšnšg
 
w™h
 
a
 
sšgË
 
¦ash
 
ch¬aù”
 
is


598 #‹rmed 
ª
 
absŞu‹
-
·th
 
»ã»nû
, 
as
 
defšed
 
by
 <
abs_·th
>..."

599 #Thi 
is
 
®so
 
som‘imes
 
ÿÎed
 "server-relative".

600 
Ãwu¾
 = '/' + '/'.
	`još
Òewu¾.
	`¥l™
('/', 3)[3:])

601 
–if
 
»Ïtive
:

602 #"
A
 
»Ïtive
 
»ã»nû
 
th©
 
dÛs
 
nÙ
 
begš
 
w™h
 
a
 
scheme
 
Çme


603 #Ü 
a
 
¦ash
 
ch¬aù”
 
is
 
‹rmed
‡ 
»Ïtive
-
·th
 
»ã»nû
."

604 
Şd
 = 
	`u¾
(
»Ïtive
=
F®£
).
	`¥l™
('/')[:-1]

605 
Ãw
 = 
Ãwu¾
.
	`¥l™
('/')

606 
Şd
 
ªd
 
Ãw
:

607 
a
, 
b
 = 
Şd
[0], 
Ãw
[0]

608 
a
 !ğ
b
:

610 
Şd
.
	$pİ
(0)

611 
Ãw
.
	$pİ
(0)

612 
Ãw
 = (['..'] * 
	`Ën
(
Şd
)) +‚ew

613 
Ãwu¾
 = '/'.
	$još
(
Ãw
)

615  
Ãwu¾


618 #impÜˆ
_ıcÚfig
 
Ï¡
 
so
 
™
 
ÿn
 
»ã»nû
 
Ùh”
 
tİ
-
Ëv–
 
objeùs


619 
äom
 
ch”rypy
 
impÜt
 
_ıcÚfig


620 #U£ 
_glob®_cÚf_®Ÿs
 
so
 
quick¡¬t
 
ÿn
 
u£
 'cÚfig' 
as
 
ª
 
¬g


621 #w™houˆ
shadowšg
 
ch”rypy
.
cÚfig
.

622 
cÚfig
 = 
_glob®_cÚf_®Ÿs
 = 
_ıcÚfig
.
	$CÚfig
()

623 
cÚfig
.
deçuÉs
 = {

624 'toŞs.log_Œaûbacks.Ú': 
True
,

625 'toŞs.log_h—d”s.Ú': 
True
,

626 'toŞs.Œašg_¦ash.Ú': 
True
,

627 'toŞs.’code.Ú': 
True


628 
	}
}

629 
cÚfig
.
Çme¥aûs
["log"] = 
Ïmbda
 
k
, 
	gv
: 
	$£‰r
(
log
, 
k
, 
v
)

630 
cÚfig
.
Çme¥aûs
["check”"] = 
Ïmbda
 
k
, 
v
: 
	$£‰r
(
check”
, 
k
, 
v
)

631 #Mu¡ 
»£t
 
to
 
g‘
 
our
 
deçuÉs
 
­¶›d
.

632 
cÚfig
.
	$»£t
()

634 
äom
 
ch”rypy
 
impÜt
 
_ıcheck”


635 
check”
 = 
_ıcheck”
.
	$Check”
()

636 
’gše
.
	`subsüibe
('¡¬t', 
check”
)

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/_cpchecker.py

1 
impÜt
 
os


2 
impÜt
 
w¬nšgs


4 
impÜt
 
ch”rypy


5 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
	g™”™ems
, 
	gcİykeys
, 
butšs


8 
şass
 
	$Check”
(
objeù
):

11 
Wh’
 
this
 
objeù
 
is
 
ÿÎed
 
©
 
’gše
 
¡¬tup
, 
™
 
execu‹s
 
—ch


12 
of
 
™s
 
own
 
m‘hods
 
who£
 
Çmes
 
¡¬t
 
w™h
 ``
check_
``. 
If
 
you
 
wish


13 
to
 
di§bË
 
£Ëùed
 
checks
, 
sim¶y
 
add
 
a
 
lše
 
š
 
your
 
glob®


14 
cÚfig
 
which
 
£ts
 
the
 
­´İrŸ‹
 
m‘hod
 
to
 
F®£
::

16 [
glob®
]

17 
check”
.
check_sk³d_­p_cÚfig
 = 
F®£


19 
You
 
may
 
®so
 
dyÇmiÿÎy
 
add
 
Ü
 
»¶aû
 ``
check_
*`` 
m‘hods
 
š
 
this
 
way
.

22 
Ú
 = 
True


26 
def
 
	$__š™__
(
£lf
):

27 
£lf
.
	$_pİuÏ‹_known_ty³s
()

29 
def
 
	$__ÿÎ__
(
£lf
):

31 
£lf
.
Ú
:

32 
ŞdfÜm©w¬nšg
 = 
w¬nšgs
.
fÜm©w¬nšg


33 
w¬nšgs
.
fÜm©w¬nšg
 = 
£lf
.formatwarning

34 
Œy
:

35 
Çme
 
š
 
	$dœ
(
£lf
):

36 
Çme
.
	`¡¬tsw™h
("check_"):

37 
m‘hod
 = 
	$g‘©Œ
(
£lf
, 
Çme
)

38 
m‘hod
 
ªd
 
	`ha§‰r
(method, '__call__'):

39 
	$m‘hod
()

40 
fš®ly
:

41 
w¬nšgs
.
fÜm©w¬nšg
 = 
ŞdfÜm©w¬nšg


43 
def
 
	$fÜm©w¬nšg
(
£lf
, 
mes§ge
, 
ÿ‹gÜy
, 
f’ame
, 
lš’o
, 
lše
=
NÚe
):

45  "Ch”ryPy Check”:\n%s\n\n" % 
mes§ge


47 #Thi 
v®ue
 
should
 
be
 
£t
 
šside
 
_ıcÚfig
.

48 
glob®_cÚfig_cÚšed_·ths
 = 
F®£


50 
def
 
	$check_­p_cÚfig_’Œ›s_dÚt_¡¬t_w™h_süt_Çme
(
£lf
):

52 
¢
, 
­p
 
š
 
ch”rypy
.
Œ“
.
­ps
.
	$™ems
():

53 
nÙ
 
	$isš¡ªû
(
­p
, 
ch”rypy
.
AµliÿtiÚ
):

55 
nÙ
 
­p
.
cÚfig
:

57 
¢
 == '':

59 
¢_©oms
 = 
¢
.
	`¡r
("/").
	`¥l™
("/")

60 
key
 
š
 
­p
.
cÚfig
.
	$keys
():

61 
key_©oms
 = 
key
.
	`¡r
("/").
	`¥l™
("/")

62 
key_©oms
[:
	`Ën
(
¢_©oms
)] == sn_atoms:

63 
w¬nšgs
.
	`w¬n
(

65 "’Œ› th© s¹ w™h it süˆÇme: %r" % (
¢
, 
key
))

67 
def
 
	$check_s™e_cÚfig_’Œ›s_š_­p_cÚfig
(
£lf
):

69 
¢
, 
­p
 
š
 
	$™”™ems
(
ch”rypy
.
Œ“
.
­ps
):

70 
nÙ
 
	$isš¡ªû
(
­p
, 
ch”rypy
.
AµliÿtiÚ
):

73 
msg
 = []

74 
£ùiÚ
, 
’Œ›s
 
š
 
	$™”™ems
(
­p
.
cÚfig
):

75 
£ùiÚ
.
	`¡¬tsw™h
('/'):

76 
key
, 
v®ue
 
š
 
	$™”™ems
(
’Œ›s
):

77 
n
 
	`š
 ("engine.", "server.", "tree.", "checker."):

78 
key
.
	$¡¬tsw™h
(
n
):

79 
msg
.
	`­³nd
("[%s] % ğ%s" % (
£ùiÚ
, 
key
, 
v®ue
))

80 
msg
:

81 
msg
.
	`š£¹
(0,

85 "tØch”rypy.cÚfig.upd©e(èš¡—d oàŒ“.mouÁ()." % 
¢
)

86 
w¬nšgs
.
	`w¬n
(
os
.
lše£p
.
	$još
(
msg
))

88 
def
 
	$check_sk³d_­p_cÚfig
(
£lf
):

90 
¢
, 
­p
 
š
 
ch”rypy
.
Œ“
.
­ps
.
	$™ems
():

91 
nÙ
 
	$isš¡ªû
(
­p
, 
ch”rypy
.
AµliÿtiÚ
):

93 
nÙ
 
­p
.
cÚfig
:

94 
msg
 = "ThAµliÿtiÚ mouÁed‡ˆ%¸ha ªƒm±y cÚfig." % 
¢


95 
£lf
.
glob®_cÚfig_cÚšed_·ths
:

96 
msg
 += (" It†ooks†ikehe config you…assedo "

101 
w¬nšgs
.
	$w¬n
(
msg
)

104 
def
 
	$check_­p_cÚfig_b¿ck‘s
(
£lf
):

106 
¢
, 
­p
 
š
 
ch”rypy
.
Œ“
.
­ps
.
	$™ems
():

107 
nÙ
 
	$isš¡ªû
(
­p
, 
ch”rypy
.
AµliÿtiÚ
):

109 
nÙ
 
­p
.
cÚfig
:

111 
key
 
š
 
­p
.
cÚfig
.
	$keys
():

112 
key
.
	`¡¬tsw™h
("["è
Ü
 key.
	`’dsw™h
("]"):

113 
w¬nšgs
.
	`w¬n
(

117 "Ó.g.…as£dØŒ“.mouÁèdØnÙ." % (
¢
, 
key
))

119 
def
 
	$check_¡©ic_·ths
(
£lf
):

121 #U£ 
the
 
dummy
 
Reque¡
 
objeù
 
š
h
maš
 
th»ad
.

122 
»que¡
 = 
ch”rypy
.request

123 
¢
, 
­p
 
š
 
ch”rypy
.
Œ“
.
­ps
.
	$™ems
():

124 
nÙ
 
	$isš¡ªû
(
­p
, 
ch”rypy
.
AµliÿtiÚ
):

126 
»que¡
.
­p
 =‡pp

127 
£ùiÚ
 
š
 
­p
.
cÚfig
:

128 #g‘_»sourû 
wl
 
pİuÏ‹
 
»que¡
.
cÚfig


129 
»que¡
.
	`g‘_»sourû
(
£ùiÚ
 + "/dummy.html")

130 
cÚf
 = 
»que¡
.
cÚfig
.
g‘


132 
	`cÚf
("toŞs.¡©icdœ.Ú", 
F®£
):

133 
msg
 = ""

134 
roÙ
 = 
	`cÚf
("tools.staticdir.root")

135 
dœ
 = 
	`cÚf
("tools.staticdir.dir")

136 
dœ
 
is
 
NÚe
:

137 
msg
 = "tools.staticdir.dir is‚ot set."

139 
fuÎdœ
 = ""

140 
os
.
·th
.
	$i§bs
(
dœ
):

141 
fuÎdœ
 = 
dœ


142 
roÙ
:

143 
msg
 = ("dir is‡n‡bsolute…ath,ƒven "

145 
‹¡dœ
 = 
os
.
·th
.
	`još
(
roÙ
, 
dœ
[1:])

146 
os
.
·th
.
	$exi¡s
(
‹¡dœ
):

147 
msg
 += ("\nIf you meanto servehe "

149 "thËadšg sÏsh from dœ." % 
‹¡dœ
)

151 
nÙ
 
roÙ
:

152 
msg
 = "dir is‡„elative…ath‡nd‚o„oot…rovided."

154 
fuÎdœ
 = 
os
.
·th
.
	$još
(
roÙ
, 
dœ
)

155 
nÙ
 
os
.
·th
.
	$i§bs
(
fuÎdœ
):

156 
msg
 = "%¸i nÙ‡ÀabsŞu‹…©h." % 
fuÎdœ


158 
fuÎdœ
 
ªd
 
nÙ
 
os
.
·th
.
	$exi¡s
(
fuÎdœ
):

159 
msg
:

160 
msg
 += "\n"

161 
msg
 += ("%r (root + dir) is‚ot‡nƒxisting "

162 "fesy¡em…©h." % 
fuÎdœ
)

164 
msg
:

165 
w¬nšgs
.
	`w¬n
("%s\nsection: [%s]\nroot: %r\ndir: %r"

166 % (
msg
, 
£ùiÚ
, 
roÙ
, 
dœ
))

169 #-------------------------- 
Com·tib™y
 -------------------------- #


170 
obsŞ‘e
 = {

173 'log_cÚfig_İtiÚs': 
NÚe
,

175 'log_fe_nÙ_found': 
NÚe
,

182 
	}
}

184 
d•»ÿ‹d
 = {}

186 
def
 
	$_com·t
(
£lf
, 
cÚfig
):

188 
£ùiÚ
, 
cÚf
 
š
 
cÚfig
.
	$™ems
():

189 
	$isš¡ªû
(
cÚf
, 
diù
):

190 
k
, 
v
 
š
 
cÚf
.
	$™ems
():

191 
k
 
š
 
£lf
.
obsŞ‘e
:

192 
w¬nšgs
.
	`w¬n
("%r is obsolete. Use %r instead.\n"

194 (
k
, 
£lf
.
obsŞ‘e
[k], 
£ùiÚ
))

195 
–if
 
k
 
š
 
£lf
.
d•»ÿ‹d
:

196 
w¬nšgs
.
	`w¬n
("%r is deprecated. Use %r instead.\n"

198 (
k
, 
£lf
.
d•»ÿ‹d
[k], 
£ùiÚ
))

200 
£ùiÚ
 
š
 
£lf
.
obsŞ‘e
:

201 
w¬nšgs
.
	`w¬n
("%r is obsolete. Use %r instead."

202 % (
£ùiÚ
, 
£lf
.
obsŞ‘e
[section]))

203 
–if
 
£ùiÚ
 
š
 
£lf
.
d•»ÿ‹d
:

204 
w¬nšgs
.
	`w¬n
("%r is deprecated. Use %r instead."

205 % (
£ùiÚ
, 
£lf
.
d•»ÿ‹d
[section]))

207 
def
 
	$check_com·tib™y
(
£lf
):

209 
£lf
.
	$_com·t
(
ch”rypy
.
cÚfig
)

210 
¢
, 
­p
 
š
 
ch”rypy
.
Œ“
.
­ps
.
	$™ems
():

211 
nÙ
 
	$isš¡ªû
(
­p
, 
ch”rypy
.
AµliÿtiÚ
):

213 
£lf
.
	$_com·t
(
­p
.
cÚfig
)

216 #------------------------ 
Known
 
Name¥aûs
 ------------------------ #


217 
exŒa_cÚfig_Çme¥aûs
 = []

219 
def
 
	$_known_ns
(
£lf
, 
­p
):

220 
ns
 = ["wsgi"]

221 
ns
.
	`ex‹nd
(
	$cİykeys
(
­p
.
toŞboxes
))

222 
ns
.
	`ex‹nd
(
	$cİykeys
(
­p
.
Çme¥aûs
))

223 
ns
.
	`ex‹nd
(
	$cİykeys
(
­p
.
»que¡_şass
.
Çme¥aûs
))

224 
ns
.
	`ex‹nd
(
	$cİykeys
(
ch”rypy
.
cÚfig
.
Çme¥aûs
))

225 
ns
 +ğ
£lf
.
exŒa_cÚfig_Çme¥aûs


227 
£ùiÚ
, 
cÚf
 
š
 
­p
.
cÚfig
.
	$™ems
():

228 
is_·th_£ùiÚ
 = 
£ùiÚ
.
	`¡¬tsw™h
("/")

229 
is_·th_£ùiÚ
 
ªd
 
	$isš¡ªû
(
cÚf
, 
diù
):

230 
k
, 
v
 
š
 
cÚf
.
	$™ems
():

231 
©oms
 = 
k
.
	`¥l™
(".")

232 
	`Ën
(
©oms
) > 1:

233 
©oms
[0] 
nÙ
 
š
 
ns
:

234 #Sp™ 
out
 
a
 
¥ecŸl
 
w¬nšg
 ¨
known


235 #Çme¥aû 
is
 
´eûded
 
by
 "cherrypy."

236 ià(
©oms
[0] =ğ"ch”rypy" 
ªd
‡toms[1] 
š
 
ns
):

237 
msg
 = ("The configƒntry %r is invalid; "

239 % (
k
, ".".
	`još
(
©oms
[1:]), 
£ùiÚ
))

241 
msg
 = ("The configƒntry %r is invalid, because "

243 "£ùiÚ: [%s]" % (
k
, 
©oms
[0], 
£ùiÚ
))

244 
w¬nšgs
.
	$w¬n
(
msg
)

245 
–if
 
©oms
[0] == "tools":

246 
©oms
[1] 
nÙ
 
š
 
	$dœ
(
ch”rypy
.
toŞs
):

247 
msg
 = ("The configƒntry %r may be invalid, "

249 "£ùiÚ: [%s]" % (
k
, 
©oms
[1], 
£ùiÚ
))

250 
w¬nšgs
.
	$w¬n
(
msg
)

252 
def
 
	$check_cÚfig_Çme¥aûs
(
£lf
):

254 
¢
, 
­p
 
š
 
ch”rypy
.
Œ“
.
­ps
.
	$™ems
():

255 
nÙ
 
	$isš¡ªû
(
­p
, 
ch”rypy
.
AµliÿtiÚ
):

257 
£lf
.
	$_known_ns
(
­p
)

262 #-------------------------- 
CÚfig
 
Ty³s
 -------------------------- #


263 
known_cÚfig_ty³s
 = {
	}
}

265 
def
 
	$_pİuÏ‹_known_ty³s
(
£lf
):

266 
b
 = [
x
 x 
š
 
	`v¬s
(
butšs
).
	$v®ues
()

267 
	$ty³
(
x
è
is
 
	`ty³
(
¡r
)]

269 
def
 
	$Œav”£
(
obj
, 
Çme¥aû
):

270 
Çme
 
š
 
	$dœ
(
obj
):

272 
Çme
 == 'body_params':

274 
vty³
 = 
	`ty³
(
	$g‘©Œ
(
obj
, 
Çme
, 
NÚe
))

275 
vty³
 
š
 
b
:

276 
£lf
.
known_cÚfig_ty³s
[
Çme¥aû
 + "." + 
Çme
] = 
vty³


278 
	`Œav”£
(
ch”rypy
.
»que¡
, "request")

279 
	`Œav”£
(
ch”rypy
.
»¥Ú£
, "response")

280 
	`Œav”£
(
ch”rypy
.
£rv”
, "server")

281 
	`Œav”£
(
ch”rypy
.
’gše
, "engine")

282 
	`Œav”£
(
ch”rypy
.
log
, "log")

284 
def
 
	$_known_ty³s
(
£lf
, 
cÚfig
):

285 
msg
 = ("The configƒntry %r in section %r is ofype %r, "

288 
£ùiÚ
, 
cÚf
 
š
 
cÚfig
.
	$™ems
():

289 
	$isš¡ªû
(
cÚf
, 
diù
):

290 
k
, 
v
 
š
 
cÚf
.
	$™ems
():

291 
v
 
is
 
nÙ
 
NÚe
:

292 
ex³ùed_ty³
 = 
£lf
.
known_cÚfig_ty³s
.
	$g‘
(
k
, 
NÚe
)

293 
vty³
 = 
	$ty³
(
v
)

294 
ex³ùed_ty³
 
ªd
 
vty³
 !=ƒxpected_type:

295 
w¬nšgs
.
	`w¬n
(
msg
 % (
k
, 
£ùiÚ
, 
vty³
.
__Çme__
,

296 
ex³ùed_ty³
.
__Çme__
))

298 
k
, 
v
 = 
£ùiÚ
, 
cÚf


299 
v
 
is
 
nÙ
 
NÚe
:

300 
ex³ùed_ty³
 = 
£lf
.
known_cÚfig_ty³s
.
	$g‘
(
k
, 
NÚe
)

301 
vty³
 = 
	$ty³
(
v
)

302 
ex³ùed_ty³
 
ªd
 
vty³
 !=ƒxpected_type:

303 
w¬nšgs
.
	`w¬n
(
msg
 % (
k
, 
£ùiÚ
, 
vty³
.
__Çme__
,

304 
ex³ùed_ty³
.
__Çme__
))

306 
def
 
	$check_cÚfig_ty³s
(
£lf
):

308 
£lf
.
	$_known_ty³s
(
ch”rypy
.
cÚfig
)

309 
¢
, 
­p
 
š
 
ch”rypy
.
Œ“
.
­ps
.
	$™ems
():

310 
nÙ
 
	$isš¡ªû
(
­p
, 
ch”rypy
.
AµliÿtiÚ
):

312 
£lf
.
	$_known_ty³s
(
­p
.
cÚfig
)

315 #-------------------- 
S³cific
 
cÚfig
 
w¬nšgs
 -------------------- #


316 
def
 
	$check_loÿlho¡
(
£lf
):

318 
k
, 
v
 
š
 
ch”rypy
.
cÚfig
.
	$™ems
():

319 
k
 =ğ'£rv”.sock‘_ho¡' 
ªd
 
v
 == 'localhost':

320 
w¬nšgs
.
	`w¬n
("The use of 'localhost'‡s‡ socket host can "

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/_cpcompat.py

3 
	gCh”ryPy
 3.2 
is
 
com·tibË
 
w™h
 
PythÚ
 
	gv”siÚs
 2.3+. 
This
 
moduË
 
´ovides
 
a


4 
u£ful
 
ab¡¿ùiÚ
 
ov”
 
the
 
difã»nûs
 
b‘w“n
 
PythÚ
 
	gv”siÚs
, 
som‘imes
 
by


5 
´eã¼šg
 
a
 
Ãw”
 
	gidiom
, 
som‘imes
 
ª
 
Şd”
 
	gÚe
, 
ªd
 som‘ime ¨
cu¡om
 one.

7 
In
 
	g·¹icuÏr
, 
	gPythÚ
 2 
u£s
 
¡r
 
	gªd
 '' 
by‹
 
	g¡ršgs
, Python 3

8 
u£s
 
¡r
 
	gªd
 '' 
unicode
 
	g¡ršgs
. 
We
 
wl
 
ÿÎ
 
—ch
 
of
 
the£
 
	gthe
 'native

9 
	g¡ršg
'ype forƒach version. Because ofhis major difference,his module

10 
´ovides
 
	gÃw
 'by‹¡r', 'unicode¡r', 
	gªd
 'Çtive¡r' 
	g©Œibu‹s
, 
as
 
w–l
‡s

11 
two
 
	gfunùiÚs
: 'Áob', 
which
 
Œª¦©es
 
Çtive
 
¡ršgs
 (
of
 
ty³
 '¡r'è
što


12 
by‹
 
¡ršgs
 
»g¬dËss
 
of
 
PythÚ
 
	gv”siÚ
, 
	gªd
 'Áou', 
which
 
Œª¦©es
 
Çtive


13 
¡ršgs
 
to
 
unicode
 
	g¡ršgs
. 
This
 
®so
 
´ovides
 
	ga
 'By‹sIO' 
Çme
 
d—lšg


14 
¥ecifiÿÎy
 
w™h
 
	gby‹s
, 
ªd
 
	ga
 'SŒšgIO' 
Çme
 
d—lšg
 w™h 
Çtive
 
	g¡ršgs
.

15 
It
 
®so
 
´ovides
 
	ga
 'ba£64_decode' 
funùiÚ
 
w™h
 
Çtive
 
¡ršgs
 
as
 
šput
 
ªd


16 
	gouut
.

18 
impÜt
 
os


19 
impÜt
 
»


20 
impÜt
 
sys


21 
impÜt
 
th»adšg


23 
	gsys
.
	gv”siÚ_šfo
 >= (3, 0):

24 
py3k
 = 
True


25 
by‹¡r
 = 
by‹s


26 
unicode¡r
 = 
¡r


27 
Çtive¡r
 = 
unicode¡r


28 
ba£¡ršg
 = (
by‹s
, 
	g¡r
)

29 
def
 
Áob
(
n
, 
’codšg
='ISO-8859-1'):

31 
	$as£¹_Çtive
(
n
)

32 #IÀ
PythÚ
 3, 
the
 
Çtive
 
¡ršg
 
ty³
 
is
 
unicode


33  
n
.
	$’code
(
’codšg
)

34 
def
 
	`Áou
(
n
, 
’codšg
='ISO-8859-1'):

36 
	$as£¹_Çtive
(
n
)

37 #IÀ
PythÚ
 3, 
the
 
Çtive
 
¡ršg
 
ty³
 
is
 
unicode


38  
n


39 
def
 
	`tÚ©ive
(
n
, 
’codšg
='ISO-8859-1'):

41 #IÀ
PythÚ
 3, 
the
 
Çtive
 
¡ršg
 
ty³
 
is
 
unicode


42 
	$isš¡ªû
(
n
, 
by‹s
):

43  
n
.
	$decode
(
’codšg
)

44  
n


46 
äom
 
io
 
impÜt
 
SŒšgIO


48 
äom
 
io
 
impÜt
 
By‹sIO
 
as
 BytesIO

51 
py3k
 = 
F®£


52 
by‹¡r
 = 
¡r


53 
unicode¡r
 = 
unicode


54 
Çtive¡r
 = 
by‹¡r


55 
ba£¡ršg
 = basestring

56 
def
 
	`Áob
(
n
, 
’codšg
='ISO-8859-1'):

58 
	$as£¹_Çtive
(
n
)

59 #IÀ
PythÚ
 2, 
the
 
Çtive
 
¡ršg
 
ty³
 
is
 
by‹s
. 
Assume
 
™
's‡lready

60 #š 
the
 
giv’
 
’codšg
, 
which
 
ISO
-8859-1 
is
 
®mo¡
 
®ways
 
wh©


61 #wa 
š‹nded
.

62  
n


63 
def
 
	`Áou
(
n
, 
’codšg
='ISO-8859-1'):

65 
	$as£¹_Çtive
(
n
)

66 #IÀ
PythÚ
 2, 
the
 
Çtive
 
¡ršg
 
ty³
 
is
 
by‹s
.

67 #Fœ¡, 
check
 
the
 
¥ecŸl
 
’codšg
 'esÿ³'. 
The
 
‹¡
 
su™e
 
u£s
 
this


68 #tØ
sigÇl
 
th©
 
™
 
wªts
 
to
 
·ss
 
a
 
¡ršg
 
w™h
 
embedded
 \
uXXXX
 
esÿ³s
,

69 #buˆ
w™hout
 
havšg
 
to
 
´efix
 
™
 
w™h
 
u
'' 
PythÚ
 2, 
but
 
no
…refix

70 #fÜ 
PythÚ
 3.

71 
’codšg
 == 'escape':

72  
	`unicode
(

73 
»
.
	`sub
(
r
'\\u([0-9a-zA-Z]{4})',

74 
Ïmbda
 
m
: 
	`unichr
((m.
	`group
(1), 16)),

75 
n
.
	`decode
('ISO-8859-1')))

76 #Assum
™
's‡lready inhe givenƒncoding, which for ISO-8859-1 is‡lmost

77 #®way 
wh©
 
was
 
š‹nded
.

78  
n
.
	$decode
(
’codšg
)

79 
def
 
	`tÚ©ive
(
n
, 
’codšg
='ISO-8859-1'):

81 #IÀ
PythÚ
 2, 
the
 
Çtive
 
¡ršg
 
ty³
 
is
 
by‹s
.

82 
	$isš¡ªû
(
n
, 
unicode
):

83  
n
.
	$’code
(
’codšg
)

84  
n


85 
Œy
:

87 
äom
 
cSŒšgIO
 
impÜt
 
SŒšgIO


88 
exû±
 
ImpÜtE¼Ü
:

90 
äom
 
SŒšgIO
 
impÜt
 StringIO

92 
By‹sIO
 = 
SŒšgIO


94 
def
 
	$as£¹_Çtive
(
n
):

95 
nÙ
 
	$isš¡ªû
(
n
, 
Çtive¡r
):

96 
¿i£
 
	`Ty³E¼Ü
("Àmu¡ b¨Çtiv¡¸(gÙ %s)" % 
	`ty³
(
n
).
__Çme__
)

98 
Œy
:

99 
£t
 = set

100 
exû±
 
NameE¼Ü
:

101 
äom
 
£ts
 
impÜt
 
S‘
 
as
 
£t


103 
Œy
:

105 
äom
 
ba£64
 
impÜt
 
decodeby‹s
 
as
 
_ba£64_decodeby‹s


106 
exû±
 
ImpÜtE¼Ü
:

108 #sšû 
Ch”ryPy
 
şaims
 
com·b™y
 
w™h
 
PythÚ
 2.3, 
we
 
mu¡
 
u£


109 #th
Ëgacy
 
API
 
of
 
ba£64


110 
äom
 
ba£64
 
impÜt
 
decode¡ršg
 
as
 
_ba£64_decodeby‹s


112 
def
 
	`ba£64_decode
(
n
, 
’codšg
='ISO-8859-1'):

114 
	$isš¡ªû
(
n
, 
unicode¡r
):

115 
b
 = 
n
.
	$’code
(
’codšg
)

117 
b
 = 
n


118 
b
 = 
	$_ba£64_decodeby‹s
(
b
)

119 
Çtive¡r
 
is
 
unicode¡r
:

120  
b
.
	$decode
(
’codšg
)

122  
b


124 
Œy
:

126 
äom
 
hashlib
 
impÜt
 
md5


127 
exû±
 
ImpÜtE¼Ü
:

128 
äom
 
md5
 
impÜt
 
Ãw
 
as
 md5

130 
Œy
:

132 
äom
 
hashlib
 
impÜt
 
sha1
 
as
 
sha


133 
exû±
 
ImpÜtE¼Ü
:

134 
äom
 
sha
 
impÜt
 
Ãw
 
as
 sha

136 
Œy
:

137 
sÜ‹d
 = sorted

138 
exû±
 
NameE¼Ü
:

139 
def
 
	$sÜ‹d
(
i
):

140 
i
 = i[:]

141 
i
.
	$sÜt
()

142  
i


144 
Œy
:

145 
»v”£d
 =„eversed

146 
exû±
 
NameE¼Ü
:

147 
def
 
	$»v”£d
(
x
):

148 
i
 = 
	$Ën
(
x
)

149 
i
 > 0:

150 
i
 -= 1

151 
y›ld
 
x
[
i
]

153 
Œy
:

155 
äom
 
u¾lib
.
·r£
 
impÜt
 
u¾još
, 
u¾’code


156 
äom
 
u¾lib
.
·r£
 
impÜt
 
quÙe
, 
quÙe_¶us


157 
äom
 
u¾lib
.
»que¡
 
impÜt
 
unquÙe
, 
u¾İ’


158 
äom
 
u¾lib
.
»que¡
 
impÜt
 
·r£_h‰p_li¡
, 
·r£_keqv_li¡


159 
exû±
 
ImpÜtE¼Ü
:

161 
äom
 
u¾·r£
 
impÜt
 
u¾još


162 
äom
 
u¾lib
 
impÜt
 
u¾’code
, 
u¾İ’


163 
äom
 
u¾lib
 
impÜt
 
quÙe
, 
quÙe_¶us


164 
äom
 
u¾lib
 
impÜt
 
unquÙe


165 
äom
 
u¾lib2
 
impÜt
 
·r£_h‰p_li¡
, 
·r£_keqv_li¡


167 
Œy
:

168 
äom
 
th»adšg
 
impÜt
 
loÿl
 
as
 
th»adloÿl


169 
exû±
 
ImpÜtE¼Ü
:

170 
äom
 
ch”rypy
.
_ıth»adšgloÿl
 
impÜt
 
loÿl
 
as
 
th»adloÿl


172 
Œy
:

173 
diù
.
™”™ems


175 
™”™ems
 = 
Ïmbda
 
d
: d.
	$™”™ems
()

176 
cİy™ems
 = 
Ïmbda
 
d
: d.
	$™ems
()

177 
exû±
 
A‰ribu‹E¼Ü
:

179 
™”™ems
 = 
Ïmbda
 
d
: d.
	$™ems
()

180 
cİy™ems
 = 
Ïmbda
 
d
: 
	`li¡
(d.
	$™ems
())

182 
Œy
:

183 
diù
.
™”keys


185 
™”keys
 = 
Ïmbda
 
d
: d.
	$™”keys
()

186 
cİykeys
 = 
Ïmbda
 
d
: d.
	$keys
()

187 
exû±
 
A‰ribu‹E¼Ü
:

189 
™”keys
 = 
Ïmbda
 
d
: d.
	$keys
()

190 
cİykeys
 = 
Ïmbda
 
d
: 
	`li¡
(d.
	$keys
())

192 
Œy
:

193 
diù
.
™”v®ues


195 
™”v®ues
 = 
Ïmbda
 
d
: d.
	$™”v®ues
()

196 
cİyv®ues
 = 
Ïmbda
 
d
: d.
	$v®ues
()

197 
exû±
 
A‰ribu‹E¼Ü
:

199 
™”v®ues
 = 
Ïmbda
 
d
: d.
	$v®ues
()

200 
cİyv®ues
 = 
Ïmbda
 
d
: 
	`li¡
(d.
	$v®ues
())

202 
Œy
:

204 
impÜt
 
butšs


205 
exû±
 
ImpÜtE¼Ü
:

207 
impÜt
 
__butš__
 
as
 
butšs


209 
Œy
:

210 #PythÚ 2. 
We
 
Œy
 
PythÚ
 2 
fœ¡
 
ş›Ás
 
Ú
 Python 2

211 #dÚ'ˆŒyØimpÜˆth'
h‰p
' module from cherrypy.lib

212 
äom
 
Cook›
 
impÜt
 
Sim¶eCook›
, 
Cook›E¼Ü


213 
äom
 
h‰¶ib
 
impÜt
 
BadStusLše
, 
HTTPCÚÃùiÚ
, 
Incom¶‘eR—d
, 
NÙCÚÃùed


214 
äom
 
Ba£HTTPS”v”
 
impÜt
 
Ba£HTTPReque¡HªdËr


215 
exû±
 
ImpÜtE¼Ü
:

217 
äom
 
h‰p
.
cook›s
 
impÜt
 
Sim¶eCook›
, 
Cook›E¼Ü


218 
äom
 
h‰p
.
ş›Á
 
impÜt
 
BadStusLše
, 
HTTPCÚÃùiÚ
, 
Incom¶‘eR—d
, 
NÙCÚÃùed


219 
äom
 
h‰p
.
£rv”
 
impÜt
 
Ba£HTTPReque¡HªdËr


221 #Som
¶©fÜms
 
dÚ
'tƒxpose HTTPSConnection, so handle it separately

222 
py3k
:

223 
Œy
:

224 
äom
 
h‰p
.
ş›Á
 
impÜt
 
HTTPSCÚÃùiÚ


225 
exû±
 
ImpÜtE¼Ü
:

226 #Som
¶©fÜms
 
which
 
dÚ
'ˆhavSSL dÚ'
t
 
expo£
 
HTTPSCÚÃùiÚ


227 
HTTPSCÚÃùiÚ
 = 
NÚe


229 
Œy
:

230 
äom
 
h‰¶ib
 
impÜt
 
HTTPSCÚÃùiÚ


231 
exû±
 
ImpÜtE¼Ü
:

232 
HTTPSCÚÃùiÚ
 = 
NÚe


234 
Œy
:

236 
x¿nge
 = xrange

237 
exû±
 
NameE¼Ü
:

239 
x¿nge
 = 
¿nge


241 
impÜt
 
th»adšg


242 
	`ha§‰r
(
th»adšg
.
Th»ad
, "daemon"):

244 
def
 
	$g‘_d«mÚ
(
t
):

245  
t
.
d«mÚ


246 
def
 
	$£t_d«mÚ
(
t
, 
v®
):

247 
t
.
d«mÚ
 = 
v®


249 
def
 
	$g‘_d«mÚ
(
t
):

250  
t
.
	$isD«mÚ
()

251 
def
 
	$£t_d«mÚ
(
t
, 
v®
):

252 
t
.
	$£tD«mÚ
(
v®
)

254 
Œy
:

255 
äom
 
ema
.
uts
 
impÜt
 
fÜm©d©e


256 
def
 
	$HTTPD©e
(
timev®
=
NÚe
):

257  
	$fÜm©d©e
(
timev®
, 
u£gmt
=
True
)

258 
exû±
 
ImpÜtE¼Ü
:

259 
äom
 
rfc822
 
impÜt
 
fÜm©d©e
 
as
 
HTTPD©e


261 
Œy
:

263 
äom
 
u¾lib
.
·r£
 
impÜt
 
unquÙe
 
as
 
·r£_unquÙe


264 
def
 
	`unquÙe_qs
(
©om
, 
’codšg
, 
”rÜs
='strict'):

265  
	`·r£_unquÙe
(
©om
.
	`»¶aû
('+', ' '), 
’codšg
óncodšg, 
”rÜs
=errors)

266 
exû±
 
ImpÜtE¼Ü
:

268 
äom
 
u¾lib
 
impÜt
 
unquÙe
 
as
 
·r£_unquÙe


269 
def
 
	`unquÙe_qs
(
©om
, 
’codšg
, 
”rÜs
='strict'):

270  
	`·r£_unquÙe
(
©om
.
	`»¶aû
('+', ' ')).
	$decode
(
’codšg
, 
”rÜs
)

272 
Œy
:

273 #P»ã¸
sim¶ejsÚ
, 
which
 
is
 
usu®ly
 
mÜe
 
advªûd
 
thª
 
the
 
butš
 
moduË
.

274 
impÜt
 
sim¶ejsÚ
 
as
 
jsÚ


275 
jsÚ_decode
 = 
jsÚ
.
	`JSONDecod”
().
decode


276 
jsÚ_’code
 = 
jsÚ
.
	`JSONEncod”
().
™”’code


277 
exû±
 
ImpÜtE¼Ü
:

278 
py3k
:

279 #PythÚ 3.0: 
jsÚ
 
is
 
·¹
 
of
 
the
 
¡ªd¬d
 
lib¿ry
,

280 #buˆ
ouuts
 
unicode
. 
We
 
Ãed
 
by‹s
.

281 
impÜt
 
jsÚ


282 
jsÚ_decode
 = 
jsÚ
.
	`JSONDecod”
().
decode


283 
_jsÚ_’code
 = 
jsÚ
.
	`JSONEncod”
().
™”’code


284 
def
 
	$jsÚ_’code
(
v®ue
):

285 
chunk
 
š
 
	$_jsÚ_’code
(
v®ue
):

286 
y›ld
 
chunk
.
	`’code
('utf8')

287 
–if
 
sys
.
v”siÚ_šfo
 >= (2, 6):

288 #PythÚ 2.6: 
jsÚ
 
is
 
·¹
 
of
 
the
 
¡ªd¬d
 
lib¿ry


289 
impÜt
 
jsÚ


290 
jsÚ_decode
 = 
jsÚ
.
	`JSONDecod”
().
decode


291 
jsÚ_’code
 = 
jsÚ
.
	`JSONEncod”
().
™”’code


293 
jsÚ
 = 
NÚe


294 
def
 
	$jsÚ_decode
(
s
):

295 
¿i£
 
	`V®ueE¼Ü
('No JSON†ibrary is‡vailable')

296 
def
 
	$jsÚ_’code
(
s
):

297 
¿i£
 
	`V®ueE¼Ü
('No JSON†ibrary is‡vailable')

299 
Œy
:

300 
impÜt
 
cPickË
 
as
 
pickË


301 
exû±
 
ImpÜtE¼Ü
:

302 #IÀ
PythÚ
 2, 
pickË
 
is
 
a
 PythÚ 
v”siÚ
.

303 #IÀ
PythÚ
 3, 
pickË
 
is
 
the
 
¥ed
-
up
 
C
 
v”siÚ
.

304 
impÜt
 
pickË


306 
Œy
:

307 
os
.
	$u¿ndom
(20)

308 
impÜt
 
bšascii


309 
def
 
	$¿ndom20
():

310  
bšascii
.
	`hexlify
(
os
.
	`u¿ndom
(20)).
	`decode
('ascii')

311 
	$exû±
 (
A‰ribu‹E¼Ü
, 
NÙIm¶em’‹dE¼Ü
):

312 
impÜt
 
¿ndom


313 #os.
u¿ndom
 
nÙ
 
avaabË
 
uÁ
 
PythÚ
 2.4. 
F®l
 
back
 
to
 
¿ndom
.random.

314 
def
 
	$¿ndom20
():

315  
	`sha
('%s' % 
¿ndom
.
	`¿ndom
()).
	$hexdige¡
()

317 
Œy
:

318 
äom
 
_th»ad
 
impÜt
 
g‘_id’t
 
as
 
g‘_th»ad_id’t


319 
exû±
 
ImpÜtE¼Ü
:

320 
äom
 
th»ad
 
impÜt
 
g‘_id’t
 
as
 
g‘_th»ad_id’t


322 
Œy
:

324 
Ãxt
 =‚ext

325 
exû±
 
NameE¼Ü
:

327 
def
 
	$Ãxt
(
i
):

328  
i
.
	$Ãxt
()

330 
sys
.
v”siÚ_šfo
 >= (3,3):

331 
Tim”
 = 
th»adšg
.Timer

332 
Ev’t
 = 
th»adšg
.Event

334 #PythÚ 3.2 
ªd
 
—¾›r


335 
Tim”
 = 
th»adšg
.
_Tim”


336 
Ev’t
 = 
th»adšg
.
_Ev’t


338 #PriÜ 
to
 
PythÚ
 2.6, 
the
 
Th»ad
 
şass
 
did
 
nÙ
 
have
 
a
 .
d«mÚ
 
´İ”ty
.

339 #Thi 
mix
-
š
 
adds
 
th©
 
´İ”ty
.

340 
şass
 
S‘D«mÚPrİ”ty
:

341 
def
 
	$__g‘_d«mÚ
(
£lf
):

342  
£lf
.
	$isD«mÚ
()

343 
def
 
	$__£t_d«mÚ
(
£lf
, 
d«mÚ
):

344 
£lf
.
	$£tD«mÚ
(
d«mÚ
)

346 
sys
.
v”siÚ_šfo
 < (2,6):

347 
d«mÚ
 = 
	$´İ”ty
(
__g‘_d«mÚ
, 
__£t_d«mÚ
)

349 #U£ 
sub´oûss
 
moduË
 
äom
 
PythÚ
 2.7 
Ú
 Python 2.3-2.6

350 
sys
.
v”siÚ_šfo
 < (2,7):

351 
impÜt
 
ch”rypy
.
_ıcom·t_sub´oûss
 
as
 
sub´oûss


353 
impÜt
 
sub´oûss


	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/_cpcompat_subprocess.py

1 #sub´oûs - 
Sub´oûs£s
 
w™h
 
acûssibË
 
I
/
O
 
¡»ams


2 #
#FÜ 
mÜe
 
šfÜm©iÚ
 
about
 
this
 
moduË
, 
£e
 
PEP
 324.

3 #
#Thi 
moduË
 
should
 
»maš
 
com·tibË
 
w™h
 
PythÚ
 2.2, 
£e
 
PEP
 291.

4 #
#Cİyrighˆ(
c
è2003-2005 
by
 
P‘”
 
A¡¿nd
 <
a¡¿nd
@
ly§tÜ
.
liu
.
£
>

5 #
#Liûn£d 
to
 
PSF
 
und”
 
a
 
CÚŒibutÜ
 
Ag»em’t
.

6 #S“ 
h‰p
:

8 
	gr
"""subprocess - Subprocesses with‡ccessible I/O streams

10 
This
 
moduË
 
®lows
 
you
 
to
 
¥awn
 
	g´oûs£s
, 
cÚÃù
Ø
theœ


11 
	gšput
/
	gouut
/
”rÜ
 
	gpes
, 
ªd
 
obš
 
theœ
  
	gcodes
. 
This
 
moduË


12 
š‹nds
 
to
 
»¶aû
 
£v”®
 
	gÙh”
, 
Şd”
 
moduËs
 
ªd
 
	gfunùiÚs
, 
	glike
:

14 
os
.
sy¡em


15 
os
.
¥awn
*

16 
os
.
pİ’
*

17 
pİ’2
.*

18 
commªds
.*

20 
InfÜm©iÚ
 
about
 
how
 
the
 
sub´oûss
 
moduË
 
ÿn
 
be
 
u£d
 
to
 
»¶aû
 
the£


21 
moduËs
 
ªd
 
funùiÚs
 
ÿn
 
be
 
found
 
b–ow
.

25 
Usšg
 
the
 
sub´oûss
 
moduË


27 
This
 
moduË
 
defšes
 
Úe
 
şass
 
ÿÎed
 
Pİ’
:

29 
şass
 
	$Pİ’
(
¬gs
, 
bufsize
=0, 
execubË
=
NÚe
,

30 
¡dš
=
NÚe
, 
¡dout
=NÚe, 
¡d”r
=None,

31 
´“xec_â
=
NÚe
, 
şo£_fds
=
F®£
, 
sh–l
=False,

32 
cwd
=
NÚe
, 
’v
=NÚe, 
univ”§l_Ãwlšes
=
F®£
,

33 
¡¬tupšfo
=
NÚe
, 
ü—tiÚæags
=0):

36 
Argum’ts
 
¬e
:

38 
¬gs
 
should
 
be
 
a
 
¡ršg
, 
Ü
‡ 
£qu’û
 
of
 
´og¿m
 
¬gum’ts
. 
The


39 
´og¿m
 
to
 
execu‹
 
is
 
nÜm®ly
 
the
 
fœ¡
 
™em
 
š
h
¬gs
 
£qu’û
 
Ü


40 
¡ršg
, 
but
 
ÿn
 
be
 
ex¶ic™ly
 
£t
 
by
 
usšg
 
the
 
execubË
 
¬gum’t
.

42 
On
 
UNIX
, 
w™h
 
sh–l
=
	$F®£
 (): 
In
 
this
 , 
the
 
Pİ’
 
şass


43 
u£s
 
os
.
	$execvp
(è
to
 
execu‹
 
the
 
chd
 
´og¿m
. 
¬gs
 
should
 
nÜm®ly


44 
be
 
a
 
£qu’û
. 
A
 
¡ršg
 
wl
 b
Œ—‹d
 
as
‡ sequ’û 
w™h
 
the
 string

45 
as
 
the
 
Úly
 
	`™em
 (th
´og¿m
 
to
 
execu‹
).

47 
On
 
UNIX
, 
w™h
 
sh–l
=
True
: 
If
 
¬gs
 
is
 
a
 
¡ršg
, 
™
 
¥ecif›s
 
the


48 
commªd
 
¡ršg
 
to
 
execu‹
 
through
 
the
 
sh–l
. 
If
 
¬gs
 
is
 
a
 
£qu’û
,

49 
the
 
fœ¡
 
™em
 
¥ecif›s
h
commªd
 
¡ršg
, 
ªd
 
ªy
 
add™iÚ®
 
™ems


50 
wl
 
be
 
Œ—‹d
 
as
 
add™iÚ®
 
sh–l
 
¬gum’ts
.

52 
On
 
Wšdows
: 
the
 
Pİ’
 
şass
 
u£s
 
	$C»©eProûss
(è
to
 
execu‹
 
the
 
chd


53 
´og¿m
, 
which
 
İ”©es
 
Ú
 
¡ršgs
. 
If
 
¬gs
 
is
 
a
 
£qu’û
, 
™
 
wl
 
be


54 
cÚv”‹d
 
to
 
a
 
¡ršg
 
usšg
 
the
 
li¡2cmdlše
 
m‘hod
. 
PËa£
 
nÙe
 
th©


55 
nÙ
 
®l
 
MS
 
Wšdows
 
­¶iÿtiÚs
 
š‹½»t
 
the
 
commªd
 
lše
h
§me


56 
way
: 
The
 
li¡2cmdlše
 
is
 
desigÃd
 
­¶iÿtiÚs
 
usšg
 
the
 
§me


57 
ruËs
 
as
 
the
 
MS
 
C
 
ruÁime
.

59 
bufsize
, 
giv’
, 
has
 
the
 
§me
 
m—nšg
 
as
h
cÜ»¥Údšg
 
¬gum’t


60 
to
 
the
 
but
-
š
 
	$İ’
(è
funùiÚ
: 0 
m—ns
 
unbufã»d
, 1 m—n 
lše


61 
bufã»d
, 
ªy
 
Ùh”
 
pos™ive
 
v®ue
 
m—ns
 
u£
 
a
 
bufãr
 
of


62 (
­´oxim©–y
è
th©
 
size
. 
A
 
Ãg©ive
 
bufsize
 
m—ns
 
to
 
u£
 
the
 
sy¡em


63 , 
which
 
usu®ly
 
m—ns
 
fuÎy
 
bufã»d
. 
The
  
v®ue
 

64 
bufsize
 
is
 0 (
unbufã»d
).

66 
¡dš
, 
¡dout
 
ªd
 
¡d”r
 
¥ecify
 
the
 
execu‹d
 
´og¿ms
' standard

67 
šput
, 
¡ªd¬d
 
ouut
 
ªd
 snd¬d 
”rÜ
 
fe
 
hªdËs
, 
»¥eùiv–y
.

68 
V®id
 
v®ues
 
¬e
 
PIPE
, 
ª
 
exi¡šg
 
fe
 
	`desütÜ
 (
a
 
pos™ive


69 
š‹g”
), 
ª
 
exi¡šg
 
fe
 
objeù
, 
ªd
 
NÚe
. 
PIPE
 
šdiÿ‹s
 
th©
 
a


70 
Ãw
 
pe
 
to
 
the
 
chd
 
should
 
be
 
ü—‹d
. 
W™h
 
NÚe
, 
no
 
»dœeùiÚ


71 
wl
 
occur
; 
the
 
chd
's file handles will be inherited fromhe

72 
·»Á
. 
Add™iÚ®ly
, 
¡d”r
 
ÿn
 
be
 
STDOUT
, 
which
 
šdiÿ‹s
 
th©
 
the


73 
¡d”r
 
d©a
 
äom
 
the
 
­¶iÿtiÚs
 
should
 
be
 
ÿ±u»d
 
što
h
§me


74 
fe
 
hªdË
 
as
 
¡dout
.

76 
If
 
´“xec_â
 
is
 
£t
 
to
 
a
 
ÿÎabË
 
objeù
, 
this
 objeù 
wl
 
be
 
ÿÎed


77 
š
 
the
 
chd
 
´oûss
 
ju¡
 
befÜe
hchd 
is
 
execu‹d
.

79 
If
 
şo£_fds
 
is
 
Œue
, 
®l
 
fe
 
desütÜs
 
exû±
 0, 1 
ªd
 2 
wl
 
be


80 
şo£d
 
befÜe
 
the
 
chd
 
´oûss
 
is
 
execu‹d
.

82 
sh–l
 
is
 
Œue
, 
the
 
¥ecif›d
 
commªd
 
wl
 
be
 
execu‹d
 
through
he

83 
sh–l
.

85 
If
 
cwd
 
is
 
nÙ
 
NÚe
, 
the
 
cu¼’t
 
dœeùÜy
 
wl
 
be
 
chªged
 
to
 cwd

86 
befÜe
 
the
 
chd
 
is
 
execu‹d
.

88 
If
 
’v
 
is
 
nÙ
 
NÚe
, 
™
 
defšes
 
the
 
’vœÚm’t
 
v¬ŸbËs
 th
Ãw


89 
´oûss
.

91 
If
 
univ”§l_Ãwlšes
 
is
 
Œue
, 
the
 
fe
 
objeùs
 
¡dout
 
ªd
 
¡d”r
 
¬e


92 
İ’ed
 
as
 
a
 
‹xt
 
fes
, 
but
 
lšes
 
may
 
be
 
‹rmš©ed
 
by
 
ªy
 
of
 '\n',

93 
the
 
Unix
 
’d
-
of
-
lše
 
cÚv’tiÚ
, '\r',h
Macštosh
 cÚv’tiÚ 
Ü


94 '\r\n', 
the
 
Wšdows
 
cÚv’tiÚ
. 
AÎ
 
of
 
the£
 
ex‹º®
 
»´e£Á©iÚs


95 
¬e
 
£’
 
as
 '\n' 
by
 
the
 
PythÚ
 
´og¿m
. 
NÙe
: 
This
 
ã©u»
 
is
 
Úly


96 
avaabË
 
PythÚ
 
is
 
but
 
w™h
 
univ”§l
 
Ãwlše
 
	`suµÜt
 (
the


97 ). 
Also
, 
the
 
Ãwlšes
 
©Œibu‹
 
of
h
fe
 
objeùs
 
¡dout
,

98 
¡dš
 
ªd
 
¡d”r
 
¬e
 
nÙ
 
upd©ed
 
by
 
the
 
	$communiÿ‹
(è
m‘hod
.

100 
The
 
¡¬tupšfo
 
ªd
 
ü—tiÚæags
, 
giv’
, 
wl
 
be
 
·s£d
 
to
 
the


101 
und”lyšg
 
	$C»©eProûss
(è
funùiÚ
. 
They
 
ÿn
 
¥ecify
 
thšgs
 
such
 
as


102 
­³¬ªû
 
of
 
the
 
maš
 
wšdow
 
ªd
 
´iÜ™y
 th
Ãw
 
´oûss
.

103 (
Wšdows
 
Úly
)

106 
This
 
moduË
 
®so
 
defšes
 
some
 
shÜtcut
 
funùiÚs
:

108 
	$ÿÎ
(*
pİ’¬gs
, **
kw¬gs
):

109 
Run
 
commªd
 
w™h
 
¬gum’ts
. 
Wa™
 commªd 
to
 
com¶‘e
, 
th’


110  
the
 
»tuºcode
 
©Œibu‹
.

112 
The
 
¬gum’ts
 
¬e
 
the
 
§me
 
as
 th
Pİ’
 
cÚ¡ruùÜ
. 
Exam¶e
:

114 
»tcode
 = 
	`ÿÎ
(["ls", "-l"])

116 
	$check_ÿÎ
(*
pİ’¬gs
, **
kw¬gs
):

117 
Run
 
commªd
 
w™h
 
¬gum’ts
. 
Wa™
 commªd 
to
 
com¶‘e
. 
If
 
the


118 
ex™
 
code
 
was
 
z”o
 
th’
 , 
Ùh”wi£
 
¿i£


119 
C®ËdProûssE¼Ü
. 
The
 C®ËdProûssE¼Ü 
objeù
 
wl
 
have
 
the


120  
code
 
š
 
the
 
»tuºcode
 
©Œibu‹
.

122 
The
 
¬gum’ts
 
¬e
 
the
 
§me
 
as
 th
Pİ’
 
cÚ¡ruùÜ
. 
Exam¶e
:

124 
	`check_ÿÎ
(["ls", "-l"])

126 
	$check_ouut
(*
pİ’¬gs
, **
kw¬gs
):

127 
Run
 
commªd
 
w™h
 
¬gum’ts
 
ªd
  
™s
 
ouut
 
as
 
a
 
by‹
 
¡ršg
.

129 
If
 
the
 
ex™
 
code
 
was
 
nÚ
-
z”o
 
™
 
¿i£s
 
a
 
C®ËdProûssE¼Ü
. 
The


130 
C®ËdProûssE¼Ü
 
objeù
 
wl
 
have
 
the
  
code
 
š
h
»tuºcode


131 
©Œibu‹
 
ªd
 
ouut
 
š
 
the
 output‡ttribute.

133 
The
 
¬gum’ts
 
¬e
 
the
 
§me
 
as
 th
Pİ’
 
cÚ¡ruùÜ
. 
Exam¶e
:

135 
ouut
 = 
	`check_ouut
(["ls", "-l", "/dev/null"])

138 
Exû±iÚs


140 
Exû±iÚs
 
¿i£d
 
š
 
the
 
chd
 
´oûss
, 
befÜe
h
Ãw
 
´og¿m
 
has


141 
¡¬‹d
 
to
 
execu‹
, 
wl
 
be
 
»
-
¿i£d
 
š
 
the
 
·»Á
. 
Add™iÚ®ly
,

142 
the
 
exû±iÚ
 
objeù
 
wl
 
have
 
Úe
 
exŒa
 
©Œibu‹
 
ÿÎed


143 'chd_Œaûback', 
which
 
is
 
a
 
¡ršg
 
cÚššg
 
Œaûback
 
šfÜm©iÚ


144 
äom
 
the
 
chds
 
pošt
 
of
 
v›w
.

146 
The
 
mo¡
 
commÚ
 
exû±iÚ
 
¿i£d
 
is
 
OSE¼Ü
. 
This
 
occurs
, 

147 
exam¶e
, 
wh’
 
Œyšg
 
to
 
execu‹
 
a
 
nÚ
-
exi¡’t
 
fe
. 
AµliÿtiÚs


148 
should
 
´•¬e
 
OSE¼Üs
.

150 
A
 
V®ueE¼Ü
 
wl
 
be
 
¿i£d
 
Pİ’
 
is
 
ÿÎed
 
w™h
 
šv®id
 
¬gum’ts
.

152 
	$check_ÿÎ
(è
ªd
 
	$check_ouut
(è
wl
 
¿i£
 
C®ËdProûssE¼Ü
, 
the


153 
ÿÎed
 
´oûss
 
»tuºs
 
a
 
nÚ
-
z”o
  
code
.

156 
Secur™y


158 
UÆike
 
some
 
Ùh”
 
pİ’
 
funùiÚs
, 
this
 
im¶em’tiÚ
 
wl
 
Ãv”
 
ÿÎ


159 /
bš
/
sh
 
im¶ic™ly
. 
This
 
m—ns
 
th©
 
®l
 
ch¬aù”s
, 
šşudšg
 
sh–l


160 
m‘ach¬aù”s
, 
ÿn
 
§ãly
 
be
 
·s£d
 
to
 
chd
 
´oûs£s
.

163 
Pİ’
 
objeùs


165 
In¡ªûs
 
of
 
the
 
Pİ’
 
şass
 
have
h
fŞlowšg
 
m‘hods
:

167 
	$pŞl
()

168 
Check
 
chd
 
´oûss
 
has
 
‹rmš©ed
. 
R‘uºs
 
»tuºcode


169 
©Œibu‹
.

171 
	$wa™
()

172 
Wa™
 
chd
 
´oûss
 
to
 
‹rmš©e
. 
R‘uºs
 
»tuºcode
 
©Œibu‹
.

174 
	$communiÿ‹
(
šput
=
NÚe
)

175 
IÁ”aù
 
w™h
 
´oûss
: 
S’d
 
d©a
 
to
 
¡dš
. 
R—d
 d©¨
äom
 
¡dout


176 
ªd
 
¡d”r
, 
uÁ
 
’d
-
of
-
fe
 
is
 
»ached
. 
Wa™
 
´oûss
 
to


177 
‹rmš©e
. 
The
 
İtiÚ®
 
šput
 
¬gum’t
 
should
 
be
 
a
 
¡ršg
 
to
 be

178 
£Á
 
to
 
the
 
chd
 
´oûss
, 
Ü
 
NÚe
, 
no
 
d©a
 
should
 
be
 sento

179 
the
 
chd
.

181 
	$communiÿ‹
(è
»tuºs
 
a
 
	`tu¶e
 (
¡dout
, 
¡d”r
).

183 
NÙe
: 
The
 
d©a
 
»ad
 
is
 
bufã»d
 
š
 
memÜy
, 
so
 dØ
nÙ
 
u£
 
this


184 
m‘hod
 
the
 
d©a
 
size
 
is
 
Ïrge
 
Ü
 
uÆim™ed
.

186 
The
 
fŞlowšg
 
©Œibu‹s
 
¬e
 
®so
 
avaabË
:

188 
¡dš


189 
If
 
the
 
¡dš
 
¬gum’t
 
is
 
PIPE
, 
this
 
©Œibu‹
 i 
a
 
fe
 
objeù


190 
th©
 
´ovides
 
šput
 
to
 
the
 
chd
 
´oûss
. 
Oth”wi£
, 
™
 
is
 
NÚe
.

192 
¡dout


193 
If
 
the
 
¡dout
 
¬gum’t
 
is
 
PIPE
, 
this
 
©Œibu‹
 i 
a
 
fe
 
objeù


194 
th©
 
´ovides
 
ouut
 
äom
 
the
 
chd
 
´oûss
. 
Oth”wi£
, 
™
 
is


195 
NÚe
.

197 
¡d”r


198 
If
 
the
 
¡d”r
 
¬gum’t
 
is
 
PIPE
, 
this
 
©Œibu‹
 i 
fe
 
objeù
 
th©


199 
´ovides
 
”rÜ
 
ouut
 
äom
 
the
 
chd
 
´oûss
. 
Oth”wi£
, 
™
 
is


200 
NÚe
.

202 
pid


203 
The
 
´oûss
 
ID
 
of
 
the
 
chd
…rocess.

205 
»tuºcode


206 
The
 
chd
  
code
. 
A
 
NÚe
 
v®ue
 
šdiÿ‹s
 
th©
 
the
 
´oûss


207 
ha¢
'terminated yet. A‚egative value -N indicateshathe

208 
chd
 
was
 
‹rmš©ed
 
by
 
sigÇl
 
	`N
 (
UNIX
 
Úly
).

211 
R•Ïcšg
 
Şd”
 
funùiÚs
 
w™h
 
the
 
sub´oûss
 
moduË


213 
In
 
this
 
£ùiÚ
, "¨==> b" 
m—ns
 
th©
 
b
 
ÿn
 
be
 
u£d
 
as
 
a
 
»¶aûm’t


214 
a
.

216 
NÙe
: 
AÎ
 
funùiÚs
 
š
 
this
 
£ùiÚ
 
	$ç
 (
mÜe
 
Ü
 
Ëss
è
s’y
 

217 
the
 
execu‹d
 
´og¿m
 
ÿÂÙ
 
be
 
found
; 
this
 
moduË
 
¿i£s
 
ª
 
OSE¼Ü


218 
exû±iÚ
.

220 
In
 
the
 
fŞlowšg
 
exam¶es
, 
we
 
assume
 
th©
h
sub´oûss
 
moduË
 
is


221 
impÜ‹d
 
w™h
 "from subprocess import *".

224 
R•Ïcšg
 /
bš
/
sh
 
sh–l
 
backquÙe


226 
ouut
=`
mycmd
 
my¬g
`

228 
ouut
 = 
	`Pİ’
(["mycmd", "my¬g"], 
¡dout
=
PIPE
).
	`communiÿ‹
()[0]

231 
R•Ïcšg
 
sh–l
 
pe
 
lše


233 
ouut
=`
dmesg
 | 
g»p
 
hda
`

235 
p1
 = 
	`Pİ’
(["dmesg"], 
¡dout
=
PIPE
)

236 
p2
 = 
	`Pİ’
(["g»p", "hda"], 
¡dš
=
p1
.
¡dout
, stdout=
PIPE
)

237 
ouut
 = 
p2
.
	`communiÿ‹
()[0]

240 
R•Ïcšg
 
os
.
	`sy¡em
()

242 
¡s
 = 
os
.
	`sy¡em
("mycmd" + " myarg")

244 
p
 = 
	`Pİ’
("mycmd" + " my¬g", 
sh–l
=
True
)

245 
pid
, 
¡s
 = 
os
.
	$wa™pid
(
p
.
pid
, 0)

247 
NÙe
:

249 * 
C®lšg
 
the
 
´og¿m
 
through
h
sh–l
 
is
 
usu®ly
 
nÙ
 
»quœed
.

251 * 
It
'sƒasiero†ook‡the„eturncode‡ttributehanhe

252 
ex™¡©us
.

254 
A
 
mÜe
 
»®
-
wÜld
 
exam¶e
 
would
 
look
 
like
 
this
:

256 
Œy
:

257 
»tcode
 = 
	`ÿÎ
("mycmd" + " my¬g", 
sh–l
=
True
)

258 
»tcode
 < 0:

259 
´št
 >>
sys
.
¡d”r
, "Chd wa ‹rmš©ed by sigÇl", -
»tcode


261 
´št
 >>
sys
.
¡d”r
, "Chd„‘uºed", 
»tcode


262 
exû±
 
OSE¼Ü
, 
e
:

263 
´št
 >>
sys
.
¡d”r
, "ExecutiÚ faed:", 
e


266 
R•Ïcšg
 
os
.
¥awn
*

268 
P_NOWAIT
 
exam¶e
:

270 
pid
 = 
os
.
	`¥awÆp
(os.
P_NOWAIT
, "/bin/mycmd", "mycmd", "myarg")

272 
pid
 = 
	`Pİ’
(["/bin/mycmd", "myarg"]).pid

275 
P_WAIT
 
exam¶e
:

277 
»tcode
 = 
os
.
	`¥awÆp
(os.
P_WAIT
, "/bin/mycmd", "mycmd", "myarg")

279 
»tcode
 = 
	`ÿÎ
(["/bin/mycmd", "myarg"])

282 
VeùÜ
 
exam¶e
:

284 
os
.
	`¥awnvp
(os.
P_NOWAIT
, 
·th
, 
¬gs
)

286 
	`Pİ’
([
·th
] + 
¬gs
[1:])

289 
EnvœÚm’t
 
exam¶e
:

291 
os
.
	`¥awÆ³
(os.
P_NOWAIT
, "/bš/mycmd", "mycmd", "my¬g", 
’v
)

293 
	`Pİ’
(["/bš/mycmd", "my¬g"], 
’v
={"PATH": "/u¤/bš"
	}
})

296 
R•Ïcšg
 
os
.
pİ’
*

298 
pe
 = 
os
.
pİ’
("cmd", 
mode
='r', 
bufsize
)

300 
pe
 = 
Pİ’
("cmd", 
sh–l
=
True
, 
bufsize
=bufsize, 
¡dout
=
PIPE
).stdout

302 
pe
 = 
os
.
pİ’
("cmd", 
mode
='w', 
bufsize
)

304 
pe
 = 
Pİ’
("cmd", 
sh–l
=
True
, 
bufsize
=bufsize, 
¡dš
=
PIPE
).stdin

307 (
chd_¡dš
, 
	gchd_¡dout
èğ
os
.
pİ’2
("cmd", 
mode
, 
bufsize
)

309 
p
 = 
Pİ’
("cmd", 
sh–l
=
True
, 
bufsize
=bufsize,

310 
¡dš
=
PIPE
, 
¡dout
=PIPE, 
şo£_fds
=
True
)

311 (
chd_¡dš
, 
	gchd_¡dout
èğ(
p
.
¡dš
, 
	gp
.
	g¡dout
)

314 (
	gchd_¡dš
,

315 
	gchd_¡dout
,

316 
	gchd_¡d”r
èğ
os
.
pİ’3
("cmd", 
mode
, 
bufsize
)

318 
p
 = 
Pİ’
("cmd", 
sh–l
=
True
, 
bufsize
=bufsize,

319 
¡dš
=
PIPE
, 
¡dout
=PIPE, 
¡d”r
=PIPE, 
şo£_fds
=
True
)

320 (
chd_¡dš
,

321 
	gchd_¡dout
,

322 
	gchd_¡d”r
èğ(
p
.
¡dš
, 
	gp
.
	g¡dout
,….
	g¡d”r
)

325 (
	gchd_¡dš
, 
	gchd_¡dout_ªd_¡d”r
èğ
os
.
pİ’4
("cmd", 
mode
,

326 
bufsize
)

328 
p
 = 
Pİ’
("cmd", 
sh–l
=
True
, 
bufsize
=bufsize,

329 
¡dš
=
PIPE
, 
¡dout
=PIPE, 
¡d”r
=
STDOUT
, 
şo£_fds
=
True
)

330 (
chd_¡dš
, 
	gchd_¡dout_ªd_¡d”r
èğ(
p
.
¡dš
, 
	gp
.
	g¡dout
)

332 
On
 
	gUnix
, 
	gos
.
	gpİ’2
, os.
pİ’3
 
ªd
 os.
pİ’4
 
®so
 
acû±
 
a
 
£qu’û
 
as


333 
the
 
commªd
 
to
 
	gexecu‹
, 
š
 
which
 
¬gum’ts
 
wl
 
be
 
·s£d


334 
dœeùly
 
to
 
the
 
´og¿m
 
w™hout
 
sh–l
 
	gš‹rv’tiÚ
. 
This
 
u§ge
 
ÿn
 
be


335 
»¶aûd
 
as
 
	gfŞlows
:

337 (
chd_¡dš
, 
	gchd_¡dout
èğ
os
.
pİ’2
(["/bš/ls", "-l"], 
mode
,

338 
bufsize
)

340 
p
 = 
Pİ’
(["/bš/ls", "-l"], 
bufsize
=bufsize, 
¡dš
=
PIPE
, 
¡dout
=PIPE)

341 (
chd_¡dš
, 
	gchd_¡dout
èğ(
p
.
¡dš
, 
	gp
.
	g¡dout
)

343 
R‘uº
 
code
 
hªdlšg
 
Œª¦©es
 
as
 
	gfŞlows
:

345 
pe
 = 
os
.
pİ’
("cmd", 'w')

347 
	grc
 = 
pe
.
	$şo£
()

348 
rc
 
is
 
nÙ
 
NÚe
 
ªd
„c % 256:

349 
´št
 "There were someƒrrors"

351 
´oûss
 = 
	`Pİ’
("cmd", 'w', 
sh–l
=
True
, 
¡dš
=
PIPE
)

353 
´oûss
.
¡dš
.
	$şo£
()

354 
´oûss
.
	`wa™
() != 0:

355 
´št
 "There were someƒrrors"

358 
R•Ïcšg
 
pİ’2
.*

360 (
chd_¡dout
, 
chd_¡dš
èğ
pİ’2
.
	`pİ’2
("some¡ršg", 
bufsize
, 
mode
)

362 
p
 = 
	`Pİ’
(["some¡ršg"], 
sh–l
=
True
, 
bufsize
=bufsize

363 
¡dš
=
PIPE
, 
¡dout
=PIPE, 
şo£_fds
=
True
)

364 (
chd_¡dout
, 
chd_¡dš
èğ(
p
.
¡dout
,….
¡dš
)

366 
On
 
Unix
, 
pİ’2
 
®so
 
acû±s
 
a
 
£qu’û
 
as
 
the
 
commªd
 
to
 
execu‹
, 
š


367 
which
 
¬gum’ts
 
wl
 
be
 
·s£d
 
dœeùly
 
to
 
the
 
´og¿m
 
w™hout


368 
sh–l
 
š‹rv’tiÚ
. 
This
 
u§ge
 
ÿn
 
be
 
»¶aûd
 
as
 
fŞlows
:

370 (
chd_¡dout
, 
chd_¡dš
èğ
pİ’2
.
	`pİ’2
(["mycmd", "my¬g"], 
bufsize
,

371 
mode
)

373 
p
 = 
	`Pİ’
(["mycmd", "my¬g"], 
bufsize
=bufsize,

374 
¡dš
=
PIPE
, 
¡dout
=PIPE, 
şo£_fds
=
True
)

375 (
chd_¡dout
, 
chd_¡dš
èğ(
p
.
¡dout
,….
¡dš
)

377 
The
 
pİ’2
.
Pİ’3
 
ªd
…İ’2.
Pİ’4
 
basiÿÎy
 
wÜks
 
as
 
sub´oûss
.
Pİ’
,

378 
exû±
 
th©
:

380 * 
sub´oûss
.
Pİ’
 
¿i£s
 
ª
 
exû±iÚ
 
the
 
executiÚ
 
çs


381 * 
the
 
ÿ±u»¡d”r
 
¬gum’t
 
is
 
»¶aûd
 
w™h
h
¡d”r
‡rgument.

382 * 
¡dš
=
PIPE
 
ªd
 
¡dout
=PIPE 
mu¡
 
be
 
¥ecif›d
.

383 * 
pİ’2
 
şo£s
 
®l
 
fedesütÜs
 
by
 , 
but
 
you
 
have
 
to
 
¥ecify


384 
şo£_fds
=
True
 
w™h
 
sub´oûss
.
Pİ’
.

387 
impÜt
 
sys


388 
mswšdows
 = (
sys
.
¶©fÜm
 == "win32")

390 
impÜt
 
os


391 
impÜt
 
ty³s


392 
impÜt
 
Œaûback


393 
impÜt
 
gc


394 
impÜt
 
sigÇl


395 
impÜt
 
”ºo


397 
Œy
:

398 
£t


399 
exû±
 
NameE¼Ü
:

400 
äom
 
£ts
 
impÜt
 
S‘
 
as
 
£t


402 #Exû±iÚ 
şas£s
 
u£d
 
by
 
this
 
moduË
.

403 
şass
 
	$C®ËdProûssE¼Ü
(
Exû±iÚ
):

405 
	$check_ouut
(è
»tuºs
 
a
 
nÚ
-
z”o
 
ex™
 
¡©us
.

406 
The
 
ex™
 
¡©us
 
wl
 
be
 
¡Üed
 
š
 
the
 
»tuºcode
 
©Œibu‹
;

407 
	$check_ouut
(è
wl
 
®so
 
¡Üe
 
the
 
ouut
 
š
houuˆ
©Œibu‹
.

409 
def
 
	$__š™__
(
£lf
, 
»tuºcode
, 
cmd
, 
ouut
=
NÚe
):

410 
£lf
.
»tuºcode
 =„eturncode

411 
£lf
.
cmd
 = cmd

412 
£lf
.
ouut
 = output

413 
def
 
	$__¡r__
(
£lf
):

414  "Commªd '%s'„‘uºed‚Ú-z”Øex™ stu %d" % (
£lf
.
cmd
, s–f.
»tuºcode
)

417 
mswšdows
:

418 
impÜt
 
th»adšg


419 
impÜt
 
msvüt


420 
impÜt
 
_sub´oûss


421 
şass
 
STARTUPINFO
:

422 
dwFÏgs
 = 0

423 
hStdIÅut
 = 
NÚe


424 
hStdOuut
 = 
NÚe


425 
hStdE¼Ü
 = 
NÚe


426 
wShowWšdow
 = 0

427 
şass
 
pywšty³s
:

428 
”rÜ
 = 
IOE¼Ü


430 
impÜt
 
£Ëù


431 
_has_pŞl
 = 
	`ha§‰r
(
£Ëù
, 'poll')

432 
impÜt
 
fú


433 
impÜt
 
pickË


435 #Wh’ 
£Ëù
 
Ü
 
pŞl
 
has
 
šdiÿ‹d
 
th©
 
the
 
fe
 
is
 
wr™abË
,

436 #w
ÿn
 
wr™e
 
up
 
to
 
_PIPE_BUF
 
by‹s
 
w™hout
 
risk
 
of
 
blockšg
.

437 #POSIX 
defšes
 
PIPE_BUF
 
as
 >= 512.

438 
_PIPE_BUF
 = 
	`g‘©Œ
(
£Ëù
, 'PIPE_BUF', 512)

441 
__®l__
 = ["Popen", "PIPE", "STDOUT", "call", "check_call",

444 
mswšdows
:

445 
äom
 
_sub´oûss
 
impÜt
 
CREATE_NEW_CONSOLE
, 
CREATE_NEW_PROCESS_GROUP
, \

446 
STD_INPUT_HANDLE
, 
STD_OUTPUT_HANDLE
, \

447 
STD_ERROR_HANDLE
, 
SW_HIDE
, \

448 
STARTF_USESTDHANDLES
, 
STARTF_USESHOWWINDOW


450 
__®l__
.
	`ex‹nd
(["CREATE_NEW_CONSOLE", "CREATE_NEW_PROCESS_GROUP",

454 
Œy
:

455 
MAXFD
 = 
os
.
	`syscÚf
("SC_OPEN_MAX")

456 
exû±
:

457 
MAXFD
 = 256

459 
_aùive
 = []

461 
def
 
	$_ş—nup
():

462 
š¡
 
š
 
_aùive
[:]:

463 
»s
 = 
š¡
.
	$_š‹º®_pŞl
(
_d—d¡©e
=
sys
.
maxšt
)

464 
»s
 
is
 
nÙ
 
NÚe
:

465 
Œy
:

466 
_aùive
.
	$»move
(
š¡
)

467 
exû±
 
V®ueE¼Ü
:

468 #Thi 
ÿn
 
h­³n
 
two
 
th»ads
 
ü—‹
 
a
 
Ãw
 
Pİ’
 
š¡ªû
.

470 
·ss


472 
PIPE
 = -1

473 
STDOUT
 = -2

476 
def
 
	$_ešŒ_»Œy_ÿÎ
(
func
, *
¬gs
):

477 
True
:

478 
Œy
:

479  
	$func
(*
¬gs
)

480 
	`exû±
 (
OSE¼Ü
, 
IOE¼Ü
), 
e
:

481 
e
.
”ºo
 =ğ”ºo.
EINTR
:

483 
¿i£


486 
def
 
	$ÿÎ
(*
pİ’¬gs
, **
kw¬gs
):

488  
the
 
»tuºcode
 
©Œibu‹
.

490 
The
 
¬gum’ts
 
¬e
 
the
 
§me
 
as
 th
Pİ’
 
cÚ¡ruùÜ
. 
Exam¶e
:

492 
»tcode
 = 
	`ÿÎ
(["ls", "-l"])

494  
	`Pİ’
(*
pİ’¬gs
, **
kw¬gs
).
	$wa™
()

497 
def
 
	$check_ÿÎ
(*
pİ’¬gs
, **
kw¬gs
):

499 
the
 
ex™
 
code
 
was
 
z”o
 
th’
 , 
Ùh”wi£
 
¿i£


500 
C®ËdProûssE¼Ü
. 
The
 C®ËdProûssE¼Ü 
objeù
 
wl
 
have
 
the


501  
code
 
š
 
the
 
»tuºcode
 
©Œibu‹
.

503 
The
 
¬gum’ts
 
¬e
 
the
 
§me
 
as
 th
Pİ’
 
cÚ¡ruùÜ
. 
Exam¶e
:

505 
	`check_ÿÎ
(["ls", "-l"])

507 
»tcode
 = 
	$ÿÎ
(*
pİ’¬gs
, **
kw¬gs
)

508 
»tcode
:

509 
cmd
 = 
kw¬gs
.
	`g‘
("args")

510 
cmd
 
is
 
NÚe
:

511 
cmd
 = 
pİ’¬gs
[0]

512 
¿i£
 
	$C®ËdProûssE¼Ü
(
»tcode
, 
cmd
)

516 
def
 
	$check_ouut
(*
pİ’¬gs
, **
kw¬gs
):

517 
r
"""Run command with‡rguments‡nd„eturn its output‡s‡ byte string.

519 
If
 
the
 
ex™
 
code
 
was
 
nÚ
-
z”o
 
™
 
¿i£s
 
a
 
C®ËdProûssE¼Ü
. 
The


520 
C®ËdProûssE¼Ü
 
objeù
 
wl
 
have
 
the
  
code
 
š
h
»tuºcode


521 
©Œibu‹
 
ªd
 
ouut
 
š
 
the
 output‡ttribute.

523 
The
 
¬gum’ts
 
¬e
 
the
 
§me
 
as
 th
Pİ’
 
cÚ¡ruùÜ
. 
Exam¶e
:

525 >>> 
	`check_ouut
(["ls", "-l", "/dev/null"])

528 
The
 
¡dout
 
¬gum’t
 
is
 
nÙ
 
®lowed
 
as
 
™
 i 
u£d
 
š‹º®ly
.

529 
To
 
ÿ±u»
 
¡ªd¬d
 
”rÜ
 
š
 
the
 
»suÉ
, 
u£
 
¡d”r
=
STDOUT
.

531 >>> 
	`check_ouut
(["/bin/sh", "-c",

533 ... 
¡d”r
=
STDOUT
)

536 '¡dout' 
š
 
kw¬gs
:

537 
¿i£
 
	`V®ueE¼Ü
('stdout‡rgument‚ot‡llowed, it will be overridden.')

538 
´oûss
 = 
	$Pİ’
(
¡dout
=
PIPE
, *
pİ’¬gs
, **
kw¬gs
)

539 
ouut
, 
unu£d_”r
 = 
´oûss
.
	$communiÿ‹
()

540 
»tcode
 = 
´oûss
.
	$pŞl
()

541 
»tcode
:

542 
cmd
 = 
kw¬gs
.
	`g‘
("args")

543 
cmd
 
is
 
NÚe
:

544 
cmd
 = 
pİ’¬gs
[0]

545 
¿i£
 
	$C®ËdProûssE¼Ü
(
»tcode
, 
cmd
, 
ouut
=output)

546  
ouut


549 
def
 
	$li¡2cmdlše
(
£q
):

551 
T¿n¦©e
 
a
 
£qu’û
 
of
 
¬gum’ts
 
što
‡ 
commªd
 
lše


552 
¡ršg
, 
usšg
 
the
 
§me
 
ruËs
 
as
h
MS
 
C
 
ruÁime
:

554 1è
Argum’ts
 
¬e
 
d–im™ed
 
by
 
wh™e
 
¥aû
, 
which
 
is
 
e™h”
 
a


555 
¥aû
 
Ü
 
a
 
b
.

557 2è
A
 
¡ršg
 
su¼ounded
 
by
 
quÙ©iÚ
 
m¬ks
 
is


558 
š‹½»‹d
 
as
 
a
 
sšgË
 
¬gum’t
, 
»g¬dËss
 
of
 
wh™e
 
¥aû


559 
cÚšed
 
w™hš
. 
A
 
quÙed
 
¡ršg
 
ÿn
 
be
 
embedded
 
š
 
ª


560 
¬gum’t
.

562 3è
A
 
quÙ©iÚ
 
m¬k
 
´eûded
 
by
 
a
 
back¦ash
 
is


563 
š‹½»‹d
 
as
 
a
 
l™”®
 
quÙ©iÚ
 
m¬k
.

565 4è
Back¦ashes
 
¬e
 
š‹½»‹d
 
l™”®ly
, 
uÆess
 
they


566 
immedŸ‹ly
 
´eûde
 
a
 
quÙ©iÚ
 
m¬k
.

568 5è
If
 
back¦ashes
 
immedŸ‹ly
 
´eûde
 
a
 
quÙ©iÚ
 
m¬k
,

569 
ev”y
 
·œ
 
of
 
back¦ashes
 
is
 
š‹½»‹d
 
as
 
a
 
l™”®


570 
back¦ash
. 
If
 
the
 
numb”
 
of
 
back¦ashes
 
is
 
odd
,h
Ï¡


571 
back¦ash
 
esÿ³s
 
the
 
Ãxt
 
quÙ©iÚ
 
m¬k
 
as


572 
desüibed
 
š
 
ruË
 3.

577 #Ü 
£¬ch
 
h‰p
:

578 #"
P¬sšg
 
C
++ 
Commªd
-
Lše
 
Argum’ts
"

579 
»suÉ
 = []

580 
ÃedquÙe
 = 
F®£


581 
¬g
 
š
 
£q
:

582 
bs_buf
 = []

584 #Add 
a
 
¥aû
 
to
 
£·¿‹
 
this
 
¬gum’t
 
äom
 
the
 
Ùh”s


585 
»suÉ
:

586 
»suÉ
.
	`­³nd
(' ')

588 
ÃedquÙe
 = (" " 
š
 
¬g
è
	`Ü
 ("\t" iÀ¬gè
Ü
 
nÙ
‡rg

589 
ÃedquÙe
:

590 
»suÉ
.
	`­³nd
('"')

592 
c
 
š
 
¬g
:

593 
c
 == '\\':

595 
bs_buf
.
	$­³nd
(
c
)

596 
–if
 
c
 == '"':

597 #DoubË 
back¦ashes
.

598 
»suÉ
.
	`­³nd
('\\' * 
	`Ën
(
bs_buf
)*2)

599 
bs_buf
 = []

600 
»suÉ
.
	`­³nd
('\\"')

603 
bs_buf
:

604 
»suÉ
.
	$ex‹nd
(
bs_buf
)

605 
bs_buf
 = []

606 
»suÉ
.
	$­³nd
(
c
)

608 #Add 
»maššg
 
back¦ashes
, 
ªy
.

609 
bs_buf
:

610 
»suÉ
.
	$ex‹nd
(
bs_buf
)

612 
ÃedquÙe
:

613 
»suÉ
.
	$ex‹nd
(
bs_buf
)

614 
»suÉ
.
	`­³nd
('"')

616  ''.
	$još
(
»suÉ
)

619 
şass
 
	$Pİ’
(
objeù
):

620 
def
 
	$__š™__
(
£lf
, 
¬gs
, 
bufsize
=0, 
execubË
=
NÚe
,

621 
¡dš
=
NÚe
, 
¡dout
=NÚe, 
¡d”r
=None,

622 
´“xec_â
=
NÚe
, 
şo£_fds
=
F®£
, 
sh–l
=False,

623 
cwd
=
NÚe
, 
’v
=NÚe, 
univ”§l_Ãwlšes
=
F®£
,

624 
¡¬tupšfo
=
NÚe
, 
ü—tiÚæags
=0):

626 
	$_ş—nup
()

628 
£lf
.
_chd_ü—‹d
 = 
F®£


629 
nÙ
 
	`isš¡ªû
(
bufsize
, (, )):

630 
¿i£
 
	`Ty³E¼Ü
("bufsize must be‡n integer")

632 
mswšdows
:

633 
´“xec_â
 
is
 
nÙ
 
NÚe
:

634 
¿i£
 
	`V®ueE¼Ü
("preexec_fn is‚ot supported on Windows "

636 
şo£_fds
 
	$ªd
 (
¡dš
 
is
 
nÙ
 
NÚe
 
Ü
 
¡dout
 is‚ot None or

637 
¡d”r
 
is
 
nÙ
 
NÚe
):

638 
¿i£
 
	`V®ueE¼Ü
("close_fds is‚ot supported on Windows "

642 
¡¬tupšfo
 
is
 
nÙ
 
NÚe
:

643 
¿i£
 
	`V®ueE¼Ü
("startupinfo is only supported on Windows "

645 
ü—tiÚæags
 != 0:

646 
¿i£
 
	`V®ueE¼Ü
("creationflags is only supported on Windows "

649 
£lf
.
¡dš
 = 
NÚe


650 
£lf
.
¡dout
 = 
NÚe


651 
£lf
.
¡d”r
 = 
NÚe


652 
£lf
.
pid
 = 
NÚe


653 
£lf
.
»tuºcode
 = 
NÚe


654 
£lf
.
univ”§l_Ãwlšes
 = universal_newlines

656 #IÅuˆ
ªd
 
ouut
 
objeùs
. 
The
 
g’”®
 
´šcË
 
is
 
like


658 #
#P¬’ˆ
Chd


660 #p2cwr™---
¡dš
---> 
p2ü—d


661 #c2´—d <--
¡dout
--- 
c2pwr™e


662 #”¼—d <--
¡d”r
--- 
”rwr™e


663 #
#OÀ
POSIX
, 
the
 
chd
 
objeùs
 
¬e
 
fe
 
desütÜs
. 
On


664 #Wšdows, 
the£
 
¬e
 
Wšdows
 
fe
 
hªdËs
. 
The
 
·»Á
 
objeùs


665 #¬
fe
 
desütÜs
 
Ú
 
bÙh
 
¶©fÜms
. 
The
 
·»Á
 
objeùs


666 #¬
NÚe
 
wh’
 
nÙ
 
usšg
 
PIPEs
. 
The
 
chd
 
objeùs
 
¬e
 None

667 #wh’ 
nÙ
 
»dœeùšg
.

669 (
p2ü—d
, 
p2cwr™e
,

670 
c2´—d
, 
c2pwr™e
,

671 
”¼—d
, 
”rwr™e
èğ
£lf
.
	$_g‘_hªdËs
(
¡dš
, 
¡dout
, 
¡d”r
)

673 
£lf
.
	$_execu‹_chd
(
¬gs
, 
execubË
, 
´“xec_â
, 
şo£_fds
,

674 
cwd
, 
’v
, 
univ”§l_Ãwlšes
,

675 
¡¬tupšfo
, 
ü—tiÚæags
, 
sh–l
,

676 
p2ü—d
, 
p2cwr™e
,

677 
c2´—d
, 
c2pwr™e
,

678 
”¼—d
, 
”rwr™e
)

680 
mswšdows
:

681 
p2cwr™e
 
is
 
nÙ
 
NÚe
:

682 
p2cwr™e
 = 
msvüt
.
	`İ’_osfhªdË
Õ2cwr™e.
	`D‘ach
(), 0)

683 
c2´—d
 
is
 
nÙ
 
NÚe
:

684 
c2´—d
 = 
msvüt
.
	`İ’_osfhªdË
(c2´—d.
	`D‘ach
(), 0)

685 
”¼—d
 
is
 
nÙ
 
NÚe
:

686 
”¼—d
 = 
msvüt
.
	`İ’_osfhªdË
Ó¼»ad.
	`D‘ach
(), 0)

688 
p2cwr™e
 
is
 
nÙ
 
NÚe
:

689 
£lf
.
¡dš
 = 
os
.
	`fdİ’
(
p2cwr™e
, 'wb', 
bufsize
)

690 
c2´—d
 
is
 
nÙ
 
NÚe
:

691 
univ”§l_Ãwlšes
:

692 
£lf
.
¡dout
 = 
os
.
	`fdİ’
(
c2´—d
, 'rU', 
bufsize
)

694 
£lf
.
¡dout
 = 
os
.
	`fdİ’
(
c2´—d
, 'rb', 
bufsize
)

695 
”¼—d
 
is
 
nÙ
 
NÚe
:

696 
univ”§l_Ãwlšes
:

697 
£lf
.
¡d”r
 = 
os
.
	`fdİ’
(
”¼—d
, 'rU', 
bufsize
)

699 
£lf
.
¡d”r
 = 
os
.
	`fdİ’
(
”¼—d
, 'rb', 
bufsize
)

702 
def
 
	$_Œª¦©e_Ãwlšes
(
£lf
, 
d©a
):

703 
d©a
 = d©a.
	`»¶aû
("\r\n", "\n")

704 
d©a
 = d©a.
	`»¶aû
("\r", "\n")

705  
d©a


708 
def
 
	$__d–__
(
£lf
, 
_maxšt
=
sys
.
maxšt
, 
_aùive
=_active):

709 #Ià
__š™__
 
ha¢
't had‡ chanceoƒxecute (e.g. if it

710 #wa 
·s£d
 
ª
 
undeş¬ed
 
keywÜd
 
¬gum’t
), 
we
 
dÚ
't

711 #hav
a
 
_chd_ü—‹d
 
©Œibu‹
 
©
 
®l
.

712 
nÙ
 
	`g‘©Œ
(
£lf
, '_chd_ü—‹d', 
F®£
):

713 #W
didn
't geto successfully create‡ child…rocess.

715 #IÀ
the
 
chd
 
ha¢
'ˆb“Àwa™ed on, check ià™'
s
 
dÚe
.

716 
£lf
.
	$_š‹º®_pŞl
(
_d—d¡©e
=
_maxšt
)

717 
£lf
.
»tuºcode
 
is
 
NÚe
 
ªd
 
_aùive
 i 
nÙ
 None:

718 #Chd 
is
 
¡l
 
ruÂšg
, 
k“p
 
us
 
®ive
 
uÁ
 
we
 
ÿn
 
wa™
 
Ú
 
™
.

719 
_aùive
.
	$­³nd
(
£lf
)

722 
def
 
	$communiÿ‹
(
£lf
, 
šput
=
NÚe
):

724 
¡dout
 
ªd
 
¡d”r
, 
uÁ
 
’d
-
of
-
fe
 
is
 
»ached
. 
Wa™
 

725 
´oûss
 
to
 
‹rmš©e
. 
The
 
İtiÚ®
 
šput
 
¬gum’t
 
should
 
be
 
a


726 
¡ršg
 
to
 
be
 
£Á
Ø
the
 
chd
 
´oûss
, 
Ü
 
NÚe
, 
no
 
d©a


727 
should
 
be
 
£Á
 
to
 
the
 
chd
.

729 
	$communiÿ‹
(è
»tuºs
 
a
 
	`tu¶e
 (
¡dout
, 
¡d”r
)."""

731 #O±imiz©iÚ: 
If
 
we
 
¬e
 
Úly
 
usšg
 
Úe
 
pe
, 
Ü
 
no
…
©


732 #®l, 
usšg
 
	`£Ëù
(è
Ü
 
th»ads
 
is
 
uÂeûs§ry
.

733 [
£lf
.
¡dš
, s–f.
¡dout
, s–f.
¡d”r
].
	`couÁ
(
NÚe
) >= 2:

734 
¡dout
 = 
NÚe


735 
¡d”r
 = 
NÚe


736 
£lf
.
¡dš
:

737 
šput
:

738 
Œy
:

739 
£lf
.
¡dš
.
	$wr™e
(
šput
)

740 
exû±
 
IOE¼Ü
, 
e
:

741 
e
.
”ºo
 !ğ”ºo.
EPIPE
 
ªd
ƒ.”ºØ!ğ”ºo.
EINVAL
:

742 
¿i£


743 
£lf
.
¡dš
.
	$şo£
()

744 
–if
 
£lf
.
¡dout
:

745 
¡dout
 = 
	$_ešŒ_»Œy_ÿÎ
(
£lf
.
¡dout
.
»ad
)

746 
£lf
.
¡dout
.
	$şo£
()

747 
–if
 
£lf
.
¡d”r
:

748 
¡d”r
 = 
	$_ešŒ_»Œy_ÿÎ
(
£lf
.
¡d”r
.
»ad
)

749 
£lf
.
¡d”r
.
	$şo£
()

750 
£lf
.
	$wa™
()

751  (
¡dout
, 
¡d”r
)

753  
£lf
.
	$_communiÿ‹
(
šput
)

756 
def
 
	$pŞl
(
£lf
):

757  
£lf
.
	$_š‹º®_pŞl
()

760 
mswšdows
:

761 #
#Wšdow 
m‘hods


762 #
 _g‘_hªdËs(£lf, stdš, stdout, std”r):

764 
p2ü—d
, 
p2cwr™e
, 
c2´—d
, 
c2pwr™e
, 
”¼—d
, 
”rwr™e


766 
¡dš
 
is
 
NÚe
 
ªd
 
¡dout
 i NÚªd 
¡d”r
 is None:

767  (
NÚe
, None, None, None, None, None)

769 
p2ü—d
, 
p2cwr™e
 = 
NÚe
, None

770 
c2´—d
, 
c2pwr™e
 = 
NÚe
, None

771 
”¼—d
, 
”rwr™e
 = 
NÚe
, None

773 
¡dš
 
is
 
NÚe
:

774 
p2ü—d
 = 
_sub´oûss
.
	$G‘StdHªdË
(
_sub´oûss
.
STD_INPUT_HANDLE
)

775 
p2ü—d
 
is
 
NÚe
:

776 
p2ü—d
, 
_
 = 
_sub´oûss
.
	$C»©ePe
(
NÚe
, 0)

777 
–if
 
¡dš
 =ğ
PIPE
:

778 
p2ü—d
, 
p2cwr™e
 = 
_sub´oûss
.
	$C»©ePe
(
NÚe
, 0)

779 
–if
 
	$isš¡ªû
(
¡dš
, ):

780 
p2ü—d
 = 
msvüt
.
	$g‘_osfhªdË
(
¡dš
)

782 #Assumšg 
fe
-
like
 
objeù


783 
p2ü—d
 = 
msvüt
.
	`g‘_osfhªdË
(
¡dš
.
	$f’o
())

784 
p2ü—d
 = 
£lf
.
	$_make_šh”™abË
(
p2ü—d
)

786 
¡dout
 
is
 
NÚe
:

787 
c2pwr™e
 = 
_sub´oûss
.
	$G‘StdHªdË
(
_sub´oûss
.
STD_OUTPUT_HANDLE
)

788 
c2pwr™e
 
is
 
NÚe
:

789 
_
, 
c2pwr™e
 = 
_sub´oûss
.
	$C»©ePe
(
NÚe
, 0)

790 
–if
 
¡dout
 =ğ
PIPE
:

791 
c2´—d
, 
c2pwr™e
 = 
_sub´oûss
.
	$C»©ePe
(
NÚe
, 0)

792 
–if
 
	$isš¡ªû
(
¡dout
, ):

793 
c2pwr™e
 = 
msvüt
.
	$g‘_osfhªdË
(
¡dout
)

795 #Assumšg 
fe
-
like
 
objeù


796 
c2pwr™e
 = 
msvüt
.
	`g‘_osfhªdË
(
¡dout
.
	$f’o
())

797 
c2pwr™e
 = 
£lf
.
	$_make_šh”™abË
(
c2pwr™e
)

799 
¡d”r
 
is
 
NÚe
:

800 
”rwr™e
 = 
_sub´oûss
.
	$G‘StdHªdË
(
_sub´oûss
.
STD_ERROR_HANDLE
)

801 
”rwr™e
 
is
 
NÚe
:

802 
_
, 
”rwr™e
 = 
_sub´oûss
.
	$C»©ePe
(
NÚe
, 0)

803 
–if
 
¡d”r
 =ğ
PIPE
:

804 
”¼—d
, 
”rwr™e
 = 
_sub´oûss
.
	$C»©ePe
(
NÚe
, 0)

805 
–if
 
¡d”r
 =ğ
STDOUT
:

806 
”rwr™e
 = 
c2pwr™e


807 
–if
 
	$isš¡ªû
(
¡d”r
, ):

808 
”rwr™e
 = 
msvüt
.
	$g‘_osfhªdË
(
¡d”r
)

810 #Assumšg 
fe
-
like
 
objeù


811 
”rwr™e
 = 
msvüt
.
	`g‘_osfhªdË
(
¡d”r
.
	$f’o
())

812 
”rwr™e
 = 
£lf
.
	$_make_šh”™abË
(
”rwr™e
)

814  (
p2ü—d
, 
p2cwr™e
,

815 
c2´—d
, 
c2pwr™e
,

816 
”¼—d
, 
”rwr™e
)

819 
def
 
	$_make_šh”™abË
(
£lf
, 
hªdË
):

821  
_sub´oûss
.
	`Du¶iÿ‹HªdË
(_sub´oûss.
	`G‘Cu¼’tProûss
(),

822 
hªdË
, 
_sub´oûss
.
	`G‘Cu¼’tProûss
(), 0, 1,

823 
_sub´oûss
.
DUPLICATE_SAME_ACCESS
)

826 
def
 
	$_fšd_w9xpİ’
(
£lf
):

828 
w9xpİ’
 = 
os
.
·th
.
	`još
(

829 
os
.
·th
.
	`dœÇme
(
_sub´oûss
.
	`G‘ModuËFeName
(0)),

831 
nÙ
 
os
.
·th
.
	$exi¡s
(
w9xpİ’
):

832 #E“k - 
fe
-
nÙ
-
found
 - 
possibly
 
ª
 
embeddšg


833 #s™u©iÚ - 
£e
 
we
 
ÿn
 
loÿ‹
 
™
 
š
 
sys
.
exec_´efix


834 
w9xpİ’
 = 
os
.
·th
.
	`još
(os.·th.
	`dœÇme
(
sys
.
exec_´efix
),

836 
nÙ
 
os
.
·th
.
	$exi¡s
(
w9xpİ’
):

837 
¿i£
 
	`RuÁimeE¼Ü
("Cannot†ocate w9xpopen.exe, which is "

840  
w9xpİ’


843 
def
 
	$_execu‹_chd
(
£lf
, 
¬gs
, 
execubË
, 
´“xec_â
, 
şo£_fds
,

844 
cwd
, 
’v
, 
univ”§l_Ãwlšes
,

845 
¡¬tupšfo
, 
ü—tiÚæags
, 
sh–l
,

846 
p2ü—d
, 
p2cwr™e
,

847 
c2´—d
, 
c2pwr™e
,

848 
”¼—d
, 
”rwr™e
):

851 
nÙ
 
	$isš¡ªû
(
¬gs
, 
ty³s
.
SŒšgTy³s
):

852 
¬gs
 = 
	$li¡2cmdlše
(
¬gs
)

854 #Proûs 
¡¬tup
 
d‘as


855 
¡¬tupšfo
 
is
 
NÚe
:

856 
¡¬tupšfo
 = 
	$STARTUPINFO
()

857 
NÚe
 
nÙ
 
	$š
 (
p2ü—d
, 
c2pwr™e
, 
”rwr™e
):

858 
¡¬tupšfo
.
dwFÏgs
 |ğ
_sub´oûss
.
STARTF_USESTDHANDLES


859 
¡¬tupšfo
.
hStdIÅut
 = 
p2ü—d


860 
¡¬tupšfo
.
hStdOuut
 = 
c2pwr™e


861 
¡¬tupšfo
.
hStdE¼Ü
 = 
”rwr™e


863 
sh–l
:

864 
¡¬tupšfo
.
dwFÏgs
 |ğ
_sub´oûss
.
STARTF_USESHOWWINDOW


865 
¡¬tupšfo
.
wShowWšdow
 = 
_sub´oûss
.
SW_HIDE


866 
com¥ec
 = 
os
.
’vœÚ
.
	`g‘
("COMSPEC", "cmd.exe")

867 
¬gs
 = '{} /ø"{}"'.
	$fÜm©
 (
com¥ec
, 
¬gs
)

868 ià(
_sub´oûss
.
	`G‘V”siÚ
(è>ğ0x80000000 
Ü


869 
os
.
·th
.
	`ba£Çme
(
com¥ec
).
	`low”
() == "command.com"):

870 #Wš9x, 
Ü
 
usšg
 
commªd
.
com
 
Ú
 
NT
. 
We
 
Ãed
 
to


871 #u£ 
the
 
w9xpİ’
 
š‹rmedŸ‹
 
´og¿m
. 
FÜ
 
mÜe


872 #šfÜm©iÚ, 
£e
 
KB
 
Q150956


873 #(
h‰p
:

874 
w9xpİ’
 = 
£lf
.
	$_fšd_w9xpİ’
()

875 
¬gs
 = '"%s" %s' % (
w9xpİ’
,‡rgs)

876 #NÙ 
·ssšg
 
CREATE_NEW_CONSOLE
 
has
 
b“n
 
known
 
to


877 #ÿu£ 
¿ndom
 
çu»s
 
Ú
 
wš9x
. 
S³cifiÿÎy
 
a


879 #u£ 
©
 
xxx
"‡nd‡ hopeful warning‡bouthe

880 #¡ab™y 
of
 
your
 
sy¡em
. 
Co¡
 
is
 
CŒl
+
C
 
wÚt


881 #kÈ
chd»n
.

882 
ü—tiÚæags
 |ğ
_sub´oûss
.
CREATE_NEW_CONSOLE


884 #S¹ 
the
 
´oûss


885 
Œy
:

886 
Œy
:

887 
hp
, 
ht
, 
pid
, 
tid
 = 
_sub´oûss
.
	`C»©eProûss
(
execubË
, 
¬gs
,

888 #nØ
¥ecŸl
 
£cur™y


889 
NÚe
, None,

890 (
nÙ
 
şo£_fds
),

891 
ü—tiÚæags
,

892 
’v
,

893 
cwd
,

894 
¡¬tupšfo
)

895 
exû±
 
pywšty³s
.
”rÜ
, 
e
:

896 #T¿n¦©
pywšty³s
.
”rÜ
 
to
 
WšdowsE¼Ü
, 
which
 
is


897 #¨
subşass
 
of
 
OSE¼Ü
. 
FIXME
: 
We
 
should
 
»®ly


898 #Œª¦©
”ºo
 
usšg
 
	`_sys_”¾i¡
 (
Ü
 
sim¬
), 
but


899 #how 
ÿn
 
this
 
be
 
dÚe
 
äom
 
PythÚ
?

900 
¿i£
 
	$WšdowsE¼Ü
(*
e
.
¬gs
)

901 
fš®ly
:

902 #Chd 
is
 
Ïunched
. 
Clo£
 
the
 
·»Á
's copy ofhose…ipe

903 #hªdË 
th©
 
Úly
 
the
 
chd
 
should
 
have
 
İ’
. 
You
 
Ãed


904 #tØ
make
 
su»
 
th©
 
no
 
hªdËs
 
to
 
the
 
wr™e
 
’d
 
of
he

905 #ouuˆ
pe
 
¬e
 
maššed
 
š
 
this
 
´oûss
 
Ü
 
the


906 #p
wl
 
nÙ
 
şo£
 
wh’
 
the
 
chd
 
´oûss
 
ex™s
 
ªd
he

907 #R—dF
wl
 
hªg
.

908 
p2ü—d
 
is
 
nÙ
 
NÚe
:

909 
p2ü—d
.
	$Clo£
()

910 
c2pwr™e
 
is
 
nÙ
 
NÚe
:

911 
c2pwr™e
.
	$Clo£
()

912 
”rwr™e
 
is
 
nÙ
 
NÚe
:

913 
”rwr™e
.
	$Clo£
()

915 #R‘aš 
the
 
´oûss
 
hªdË
, 
but
 
şo£
h
th»ad
 handle

916 
£lf
.
_chd_ü—‹d
 = 
True


917 
£lf
.
_hªdË
 = 
hp


918 
£lf
.
pid
 =…id

919 
ht
.
	$Clo£
()

921 
def
 
	$_š‹º®_pŞl
(
£lf
, 
_d—d¡©e
=
NÚe
,

922 
_Wa™FÜSšgËObjeù
=
_sub´oûss
.
Wa™FÜSšgËObjeù
,

923 
_WAIT_OBJECT_0
=
_sub´oûss
.
WAIT_OBJECT_0
,

924 
_G‘Ex™CodeProûss
=
_sub´oûss
.
G‘Ex™CodeProûss
):

926 
©Œibu‹
.

928 
This
 
m‘hod
 
is
 
ÿÎed
 
by
 
__d–__
, 
so
 
™
 
ÿn
 
Úly
 
»ãr
 
to
 
objeùs


929 
š
 
™s
 
loÿl
 
scİe
.

932 
£lf
.
»tuºcode
 
is
 
NÚe
:

933 
	`_Wa™FÜSšgËObjeù
(
£lf
.
_hªdË
, 0è=ğ
_WAIT_OBJECT_0
:

934 
£lf
.
»tuºcode
 = 
	$_G‘Ex™CodeProûss
(
£lf
.
_hªdË
)

935  
£lf
.
»tuºcode


938 
def
 
	$wa™
(
£lf
):

940 
©Œibu‹
."""

941 
£lf
.
»tuºcode
 
is
 
NÚe
:

942 
_sub´oûss
.
	$Wa™FÜSšgËObjeù
(
£lf
.
_hªdË
,

943 
_sub´oûss
.
INFINITE
)

944 
£lf
.
»tuºcode
 = 
_sub´oûss
.
	$G‘Ex™CodeProûss
(
£lf
.
_hªdË
)

945  
£lf
.
»tuºcode


948 
def
 
	$_»ad”th»ad
(
£lf
, 
fh
, 
bufãr
):

949 
bufãr
.
	`­³nd
(
fh
.
	$»ad
())

952 
def
 
	$_communiÿ‹
(
£lf
, 
šput
):

953 
¡dout
 = 
NÚe
 #Return

954 
¡d”r
 = 
NÚe
 #Return

956 
£lf
.
¡dout
:

957 
¡dout
 = []

958 
¡dout_th»ad
 = 
th»adšg
.
	`Th»ad
(
rg‘
=
£lf
.
_»ad”th»ad
,

959 
¬gs
=(
£lf
.
¡dout
, stdout))

960 
¡dout_th»ad
.
	$£tD«mÚ
(
True
)

961 
¡dout_th»ad
.
	$¡¬t
()

962 
£lf
.
¡d”r
:

963 
¡d”r
 = []

964 
¡d”r_th»ad
 = 
th»adšg
.
	`Th»ad
(
rg‘
=
£lf
.
_»ad”th»ad
,

965 
¬gs
=(
£lf
.
¡d”r
, stderr))

966 
¡d”r_th»ad
.
	$£tD«mÚ
(
True
)

967 
¡d”r_th»ad
.
	$¡¬t
()

969 
£lf
.
¡dš
:

970 
šput
 
is
 
nÙ
 
NÚe
:

971 
Œy
:

972 
£lf
.
¡dš
.
	$wr™e
(
šput
)

973 
exû±
 
IOE¼Ü
, 
e
:

974 
e
.
”ºo
 !ğ”ºo.
EPIPE
:

975 
¿i£


976 
£lf
.
¡dš
.
	$şo£
()

978 
£lf
.
¡dout
:

979 
¡dout_th»ad
.
	$još
()

980 
£lf
.
¡d”r
:

981 
¡d”r_th»ad
.
	$još
()

983 #AÎ 
d©a
 
exchªged
. 
T¿n¦©e
 
li¡s
 
što
 
¡ršgs
.

984 
¡dout
 
is
 
nÙ
 
NÚe
:

985 
¡dout
 = stdout[0]

986 
¡d”r
 
is
 
nÙ
 
NÚe
:

987 
¡d”r
 = stderr[0]

989 #T¿n¦©
Ãwlšes
, 
»que¡ed
. 
We
 
ÿÂÙ
 
Ët
 
the
 
fe


990 #objeù dØ
the
 
Œª¦©iÚ
: 
It
 
is
 
ba£d
 
Ú
 
¡dio
, 
which
 is

991 #impossibË 
to
 
combše
 
w™h
 
	`£Ëù
 (
uÆess
 
fÜcšg
 
no


993 
£lf
.
univ”§l_Ãwlšes
 
ªd
 
	`ha§‰r
(
fe
, 'newlines'):

994 
¡dout
:

995 
¡dout
 = 
£lf
.
	$_Œª¦©e_Ãwlšes
(
¡dout
)

996 
¡d”r
:

997 
¡d”r
 = 
£lf
.
	$_Œª¦©e_Ãwlšes
(
¡d”r
)

999 
£lf
.
	$wa™
()

1000  (
¡dout
, 
¡d”r
)

1002 
def
 
	$£nd_sigÇl
(
£lf
, 
sig
):

1005 
sig
 =ğ
sigÇl
.
SIGTERM
:

1006 
£lf
.
	$‹rmš©e
()

1007 
–if
 
sig
 =ğ
sigÇl
.
CTRL_C_EVENT
:

1008 
os
.
	$kl
(
£lf
.
pid
, 
sigÇl
.
CTRL_C_EVENT
)

1009 
–if
 
sig
 =ğ
sigÇl
.
CTRL_BREAK_EVENT
:

1010 
os
.
	$kl
(
£lf
.
pid
, 
sigÇl
.
CTRL_BREAK_EVENT
)

1012 
¿i£
 
	`V®ueE¼Ü
("UnsuµÜ‹d sigÇl: {}".
	$fÜm©
(
sig
))

1014 
def
 
	$‹rmš©e
(
£lf
):

1017 
_sub´oûss
.
	$T”mš©eProûss
(
£lf
.
_hªdË
, 1)

1019 
kl
 = 
‹rmš©e


1022 #
#POSIX 
m‘hods


1023 #
 _g‘_hªdËs(£lf, stdš, stdout, std”r):

1025 
p2ü—d
, 
p2cwr™e
, 
c2´—d
, 
c2pwr™e
, 
”¼—d
, 
”rwr™e


1027 
p2ü—d
, 
p2cwr™e
 = 
NÚe
, None

1028 
c2´—d
, 
c2pwr™e
 = 
NÚe
, None

1029 
”¼—d
, 
”rwr™e
 = 
NÚe
, None

1031 
¡dš
 
is
 
NÚe
:

1032 
·ss


1033 
–if
 
¡dš
 =ğ
PIPE
:

1034 
p2ü—d
, 
p2cwr™e
 = 
£lf
.
	$pe_şÛxec
()

1035 
–if
 
	$isš¡ªû
(
¡dš
, ):

1036 
p2ü—d
 = 
¡dš


1038 #Assumšg 
fe
-
like
 
objeù


1039 
p2ü—d
 = 
¡dš
.
	$f’o
()

1041 
¡dout
 
is
 
NÚe
:

1042 
·ss


1043 
–if
 
¡dout
 =ğ
PIPE
:

1044 
c2´—d
, 
c2pwr™e
 = 
£lf
.
	$pe_şÛxec
()

1045 
–if
 
	$isš¡ªû
(
¡dout
, ):

1046 
c2pwr™e
 = 
¡dout


1048 #Assumšg 
fe
-
like
 
objeù


1049 
c2pwr™e
 = 
¡dout
.
	$f’o
()

1051 
¡d”r
 
is
 
NÚe
:

1052 
·ss


1053 
–if
 
¡d”r
 =ğ
PIPE
:

1054 
”¼—d
, 
”rwr™e
 = 
£lf
.
	$pe_şÛxec
()

1055 
–if
 
¡d”r
 =ğ
STDOUT
:

1056 
”rwr™e
 = 
c2pwr™e


1057 
–if
 
	$isš¡ªû
(
¡d”r
, ):

1058 
”rwr™e
 = 
¡d”r


1060 #Assumšg 
fe
-
like
 
objeù


1061 
”rwr™e
 = 
¡d”r
.
	$f’o
()

1063  (
p2ü—d
, 
p2cwr™e
,

1064 
c2´—d
, 
c2pwr™e
,

1065 
”¼—d
, 
”rwr™e
)

1068 
def
 
	$_£t_şÛxec_æag
(
£lf
, 
fd
, 
şÛxec
=
True
):

1069 
Œy
:

1070 
şÛxec_æag
 = 
fú
.
FD_CLOEXEC


1071 
exû±
 
A‰ribu‹E¼Ü
:

1072 
şÛxec_æag
 = 1

1074 
Şd
 = 
fú
.
	$fú
(
fd
, 
fú
.
F_GETFD
)

1075 
şÛxec
:

1076 
fú
.
	`fú
(
fd
, fú.
F_SETFD
, 
Şd
 | 
şÛxec_æag
)

1078 
fú
.
	`fú
(
fd
, fú.
F_SETFD
, 
Şd
 & ~
şÛxec_æag
)

1081 
def
 
	$pe_şÛxec
(
£lf
):

1083 #Pes' FD ¬£ˆCLOEXEC by deçuÉ beÿu£ wdÚ'
t
 
wªt
 
them


1084 #tØ
be
 
šh”™ed
 
by
 
Ùh”
 
sub´oûs£s
: 
the
 
CLOEXEC
 
æag
 
is
 
»moved


1085 #äom 
the
 
chd
's FDs by _dup2(), between fork()‡ndƒxec().

1086 #Thi 
is
 
nÙ
 
©omic
: 
we
 
would
 
Ãed
 
the
 
	`pe2
(è
sysÿÎ
 
th©
.

1087 
r
, 
w
 = 
os
.
	$pe
()

1088 
£lf
.
	$_£t_şÛxec_æag
(
r
)

1089 
£lf
.
	$_£t_şÛxec_æag
(
w
)

1090  
r
, 
w


1093 
def
 
	$_şo£_fds
(
£lf
, 
but
):

1094 
	`ha§‰r
(
os
, 'closerange'):

1095 
os
.
	$şo£¿nge
(3, 
but
)

1096 
os
.
	`şo£¿nge
(
but
 + 1, 
MAXFD
)

1098 
i
 
š
 
	$x¿nge
(3, 
MAXFD
):

1099 
i
 =ğ
but
:

1101 
Œy
:

1102 
os
.
	$şo£
(
i
)

1103 
exû±
:

1104 
·ss


1107 
def
 
	$_execu‹_chd
(
£lf
, 
¬gs
, 
execubË
, 
´“xec_â
, 
şo£_fds
,

1108 
cwd
, 
’v
, 
univ”§l_Ãwlšes
,

1109 
¡¬tupšfo
, 
ü—tiÚæags
, 
sh–l
,

1110 
p2ü—d
, 
p2cwr™e
,

1111 
c2´—d
, 
c2pwr™e
,

1112 
”¼—d
, 
”rwr™e
):

1115 
	$isš¡ªû
(
¬gs
, 
ty³s
.
SŒšgTy³s
):

1116 
¬gs
 = [args]

1118 
¬gs
 = 
	$li¡
(
¬gs
)

1120 
sh–l
:

1121 
¬gs
 = ["/bin/sh", "-c"] +‡rgs

1122 
execubË
:

1123 
¬gs
[0] = 
execubË


1125 
execubË
 
is
 
NÚe
:

1126 
execubË
 = 
¬gs
[0]

1128 #FÜ 
Œªsã¼šg
 
possibË
 
exec
 
çu»
 
äom
 
chd
 
to
 
·»Á


1129 #Th
fœ¡
 
¥ecif›s
 
the
 
exû±iÚ
 
ty³
: 0 
m—ns


1130 #OSE¼Ü, 1 
m—ns
 
some
 
Ùh”
 
”rÜ
.

1131 
”½e_»ad
, 
”½e_wr™e
 = 
£lf
.
	$pe_şÛxec
()

1132 
Œy
:

1133 
Œy
:

1134 
gc_was_’abËd
 = 
gc
.
	$i£ÇbËd
()

1135 #Di§bË 
gc
 
to
 
avoid
 
bug
 
wh”e
 gø-> 
fe_d—Îoc
 ->

1136 #wr™
to
 
¡d”r
 -> 
hªg
. 
h‰p
:

1137 
gc
.
	$di§bË
()

1138 
Œy
:

1139 
£lf
.
pid
 = 
os
.
	$fÜk
()

1140 
exû±
:

1141 
gc_was_’abËd
:

1142 
gc
.
	$’abË
()

1143 
¿i£


1144 
£lf
.
_chd_ü—‹d
 = 
True


1145 
£lf
.
pid
 == 0:

1147 
Œy
:

1148 #Clo£ 
·»Á
's…ipeƒnds

1149 
p2cwr™e
 
is
 
nÙ
 
NÚe
:

1150 
os
.
	$şo£
(
p2cwr™e
)

1151 
c2´—d
 
is
 
nÙ
 
NÚe
:

1152 
os
.
	$şo£
(
c2´—d
)

1153 
”¼—d
 
is
 
nÙ
 
NÚe
:

1154 
os
.
	$şo£
(
”¼—d
)

1155 
os
.
	$şo£
(
”½e_»ad
)

1157 #Wh’ 
dupšg
 
fds
, 
th”e
 
¬i£s
 
a
 
s™u©iÚ


1158 #wh”
Úe
 
of
 
the
 
fds
 
is
 
e™h”
 0, 1 
Ü
 2, 
™


1159 #i 
possibË
 
th©
 
™
 
is
 
	`ov”wr™‹n
 (#12607).

1160 
c2pwr™e
 == 0:

1161 
c2pwr™e
 = 
os
.
	$dup
(
c2pwr™e
)

1162 
”rwr™e
 =ğ0 
Ü
ƒrrwrite == 1:

1163 
”rwr™e
 = 
os
.
	$dup
(
”rwr™e
)

1165 #Du°
fds
 
chd


1166 
def
 
	$_dup2
(
a
, 
b
):

1167 #dup2(è
»moves
 
the
 
CLOEXEC
 
æag
 
but


1168 #w
mu¡
 dØ
™
 
our£lves
 
	`dup2
()

1169 #would 
be
 
a
 
no
-
	`İ
 (
issue
 #10806).

1170 
a
 =ğ
b
:

1171 
£lf
.
	$_£t_şÛxec_æag
(
a
, 
F®£
)

1172 
–if
 
a
 
is
 
nÙ
 
NÚe
:

1173 
os
.
	$dup2
(
a
, 
b
)

1174 
	$_dup2
(
p2ü—d
, 0)

1175 
	$_dup2
(
c2pwr™e
, 1)

1176 
	$_dup2
(
”rwr™e
, 2)

1178 #Clo£ 
pe
 
fds
. 
Make
 
su»
 
we
 
dÚ
't closehe

1179 #§m
fd
 
mÜe
 
thª
 
Úû
, 
Ü
 
¡ªd¬d
 
fds
.

1180 
şo£d
 = 
	$£t
([
NÚe
])

1181 
fd
 
š
 [
p2ü—d
, 
c2pwr™e
, 
”rwr™e
]:

1182 
fd
 
nÙ
 
š
 
şo£d
 
ªd
 fd > 2:

1183 
os
.
	$şo£
(
fd
)

1184 
şo£d
.
	$add
(
fd
)

1186 #Clo£ 
®l
 
Ùh”
 
fds
, 
asked
 

1187 
şo£_fds
:

1188 
£lf
.
	$_şo£_fds
(
but
=
”½e_wr™e
)

1190 
cwd
 
is
 
nÙ
 
NÚe
:

1191 
os
.
	$chdœ
(
cwd
)

1193 
´“xec_â
:

1194 
	$´“xec_â
()

1196 
’v
 
is
 
NÚe
:

1197 
os
.
	$execvp
(
execubË
, 
¬gs
)

1199 
os
.
	$execv³
(
execubË
, 
¬gs
, 
’v
)

1201 
exû±
:

1202 
exc_ty³
, 
exc_v®ue
, 
tb
 = 
sys
.
	$exc_šfo
()

1203 #Sav
the
 
Œaûback
 
ªd
 
©ch
 
™
 
to
h
exû±iÚ
 
objeù


1204 
exc_lšes
 = 
Œaûback
.
	$fÜm©_exû±iÚ
(
exc_ty³
,

1205 
exc_v®ue
,

1206 
tb
)

1207 
exc_v®ue
.
chd_Œaûback
 = ''.
	$još
(
exc_lšes
)

1208 
os
.
	`wr™e
(
”½e_wr™e
, 
pickË
.
	$dumps
(
exc_v®ue
))

1210 #Thi 
ex™code
 
wÚ
't be„eportedo‡pplications, so it

1211 #»®ly 
dÛ¢
't matter what we„eturn.

1212 
os
.
	$_ex™
(255)

1215 
gc_was_’abËd
:

1216 
gc
.
	$’abË
()

1217 
fš®ly
:

1218 #b
su»
 
the
 
FD
 
is
 
şo£d
 
no
 
m©‹r
 
wh©


1219 
os
.
	$şo£
(
”½e_wr™e
)

1221 
p2ü—d
 
is
 
nÙ
 
NÚe
 
ªd
 
p2cwr™e
 is‚ot None:

1222 
os
.
	$şo£
(
p2ü—d
)

1223 
c2pwr™e
 
is
 
nÙ
 
NÚe
 
ªd
 
c2´—d
 is‚ot None:

1224 
os
.
	$şo£
(
c2pwr™e
)

1225 
”rwr™e
 
is
 
nÙ
 
NÚe
 
ªd
 
”¼—d
 is‚ot None:

1226 
os
.
	$şo£
(
”rwr™e
)

1228 #Wa™ 
exec
 
to
 
ç
 
Ü
 
sucûed
; 
possibly
 
¿isšg
 
exû±iÚ


1229 #Exû±iÚ 
lim™ed
 
to
 1
M


1230 
d©a
 = 
	$_ešŒ_»Œy_ÿÎ
(
os
.
»ad
, 
”½e_»ad
, 1048576)

1231 
fš®ly
:

1232 #b
su»
 
the
 
FD
 
is
 
şo£d
 
no
 
m©‹r
 
wh©


1233 
os
.
	$şo£
(
”½e_»ad
)

1235 
d©a
 != "":

1236 
Œy
:

1237 
	$_ešŒ_»Œy_ÿÎ
(
os
.
wa™pid
, 
£lf
.
pid
, 0)

1238 
exû±
 
OSE¼Ü
, 
e
:

1239 
e
.
”ºo
 !ğ”ºo.
ECHILD
:

1240 
¿i£


1241 
chd_exû±iÚ
 = 
pickË
.
	$lßds
(
d©a
)

1242 
fd
 
	$š
 (
p2cwr™e
, 
c2´—d
, 
”¼—d
):

1243 
fd
 
is
 
nÙ
 
NÚe
:

1244 
os
.
	$şo£
(
fd
)

1245 
¿i£
 
chd_exû±iÚ


1248 
def
 
	$_hªdË_ex™¡©us
(
£lf
, 
¡s
, 
_WIFSIGNALED
=
os
.
WIFSIGNALED
,

1249 
_WTERMSIG
=
os
.
WTERMSIG
, 
_WIFEXITED
=os.
WIFEXITED
,

1250 
_WEXITSTATUS
=
os
.
WEXITSTATUS
):

1251 #Thi 
m‘hod
 
is
 
	`ÿÎed
 (
šdœeùly
è
by
 
__d–__
, 
so
 
™
 
ÿÂÙ


1252 #»ã¸
to
 
ªythšg
 
outside
 
of
 
™s
 
loÿl
 
scİe
."""

1253 
	$_WIFSIGNALED
(
¡s
):

1254 
£lf
.
»tuºcode
 = -
	$_WTERMSIG
(
¡s
)

1255 
–if
 
	$_WIFEXITED
(
¡s
):

1256 
£lf
.
»tuºcode
 = 
	$_WEXITSTATUS
(
¡s
)

1258 #Should 
Ãv”
 
h­³n


1259 
¿i£
 
	`RuÁimeE¼Ü
("Unknown childƒxit status!")

1262 
def
 
	$_š‹º®_pŞl
(
£lf
, 
_d—d¡©e
=
NÚe
, 
_wa™pid
=
os
.
wa™pid
,

1263 
_WNOHANG
=
os
.
WNOHANG
, 
_os_”rÜ
=os.
”rÜ
):

1265 
©Œibu‹
.

1267 
This
 
m‘hod
 
is
 
ÿÎed
 
by
 
__d–__
, 
so
 
™
 
ÿÂÙ
 
»ã»nû
 
ªythšg


1268 
outside
 
of
 
the
 
loÿl
 
	`scİe
 (
nÜ
 
ÿn
 
ªy
 
m‘hods
 
™
 
ÿÎs
).

1271 
£lf
.
»tuºcode
 
is
 
NÚe
:

1272 
Œy
:

1273 
pid
, 
¡s
 = 
	$_wa™pid
(
£lf
.
pid
, 
_WNOHANG
)

1274 
pid
 =ğ
£lf
.pid:

1275 
£lf
.
	$_hªdË_ex™¡©us
(
¡s
)

1276 
exû±
 
_os_”rÜ
:

1277 
_d—d¡©e
 
is
 
nÙ
 
NÚe
:

1278 
£lf
.
»tuºcode
 = 
_d—d¡©e


1279  
£lf
.
»tuºcode


1282 
def
 
	$wa™
(
£lf
):

1284 
©Œibu‹
."""

1285 
£lf
.
»tuºcode
 
is
 
NÚe
:

1286 
Œy
:

1287 
pid
, 
¡s
 = 
	$_ešŒ_»Œy_ÿÎ
(
os
.
wa™pid
, 
£lf
.
pid
, 0)

1288 
exû±
 
OSE¼Ü
, 
e
:

1289 
e
.
”ºo
 !ğ”ºo.
ECHILD
:

1290 
¿i£


1291 #Thi 
h­³ns
 
SIGCLD
 
is
 
£t
 
to
 
be
 
ignÜed
 
Ü
 
wa™šg


1292 #fÜ 
chd
 
´oûs£s
 
has
 
Ùh”wi£
 
b“n
 
di§bËd
 
our


1293 #´oûss. 
This
 
chd
 
is
 
d—d
, 
we
 
ÿn
't gethe status.

1294 
¡s
 = 0

1295 
£lf
.
	$_hªdË_ex™¡©us
(
¡s
)

1296  
£lf
.
»tuºcode


1299 
def
 
	$_communiÿ‹
(
£lf
, 
šput
):

1300 
£lf
.
¡dš
:

1301 #Flush 
¡dio
 
bufãr
. 
This
 
might
 
block
, 
the
 
u£r
 
has


1302 #b“À
wr™šg
 
to
 .
¡dš
 
š
 
ª
 
uncÚŒŞËd
 
çshiÚ
.

1303 
£lf
.
¡dš
.
	$æush
()

1304 
nÙ
 
šput
:

1305 
£lf
.
¡dš
.
	$şo£
()

1307 
_has_pŞl
:

1308 
¡dout
, 
¡d”r
 = 
£lf
.
	$_communiÿ‹_w™h_pŞl
(
šput
)

1310 
¡dout
, 
¡d”r
 = 
£lf
.
	$_communiÿ‹_w™h_£Ëù
(
šput
)

1312 #AÎ 
d©a
 
exchªged
. 
T¿n¦©e
 
li¡s
 
što
 
¡ršgs
.

1313 
¡dout
 
is
 
nÙ
 
NÚe
:

1314 
¡dout
 = ''.
	$još
(
¡dout
)

1315 
¡d”r
 
is
 
nÙ
 
NÚe
:

1316 
¡d”r
 = ''.
	$još
(
¡d”r
)

1318 #T¿n¦©
Ãwlšes
, 
»que¡ed
. 
We
 
ÿÂÙ
 
Ët
 
the
 
fe


1319 #objeù dØ
the
 
Œª¦©iÚ
: 
It
 
is
 
ba£d
 
Ú
 
¡dio
, 
which
 is

1320 #impossibË 
to
 
combše
 
w™h
 
	`£Ëù
 (
uÆess
 
fÜcšg
 
no


1322 
£lf
.
univ”§l_Ãwlšes
 
ªd
 
	`ha§‰r
(
fe
, 'newlines'):

1323 
¡dout
:

1324 
¡dout
 = 
£lf
.
	$_Œª¦©e_Ãwlšes
(
¡dout
)

1325 
¡d”r
:

1326 
¡d”r
 = 
£lf
.
	$_Œª¦©e_Ãwlšes
(
¡d”r
)

1328 
£lf
.
	$wa™
()

1329  (
¡dout
, 
¡d”r
)

1332 
def
 
	$_communiÿ‹_w™h_pŞl
(
£lf
, 
šput
):

1333 
¡dout
 = 
NÚe
 #Return

1334 
¡d”r
 = 
NÚe
 #Return

1335 
fd2fe
 = {
	}
}

1336 
fd2ouut
 = {}

1338 
pŞËr
 = 
£Ëù
.
	$pŞl
()

1339 
def
 
	$»gi¡”_ªd_­³nd
(
fe_obj
, 
ev’tmask
):

1340 
pŞËr
.(
fe_obj
.
	`f’o
(), 
ev’tmask
)

1341 
fd2fe
[
fe_obj
.
	`f’o
()] = file_obj

1343 
def
 
	$şo£_uÄegi¡”_ªd_»move
(
fd
):

1344 
pŞËr
.
	$uÄegi¡”
(
fd
)

1345 
fd2fe
[
fd
].
	$şo£
()

1346 
fd2fe
.
	$pİ
(
fd
)

1348 
£lf
.
¡dš
 
ªd
 
šput
:

1349 
	$»gi¡”_ªd_­³nd
(
£lf
.
¡dš
, 
£Ëù
.
POLLOUT
)

1351 
£Ëù_POLLIN_POLLPRI
 = 
£Ëù
.
POLLIN
 | s–eù.
POLLPRI


1352 
£lf
.
¡dout
:

1353 
	$»gi¡”_ªd_­³nd
(
£lf
.
¡dout
, 
£Ëù_POLLIN_POLLPRI
)

1354 
fd2ouut
[
£lf
.
¡dout
.
	`f’o
()] = stdout = []

1355 
£lf
.
¡d”r
:

1356 
	$»gi¡”_ªd_­³nd
(
£lf
.
¡d”r
, 
£Ëù_POLLIN_POLLPRI
)

1357 
fd2ouut
[
£lf
.
¡d”r
.
	`f’o
()] = stderr = []

1359 
šput_off£t
 = 0

1360 
fd2fe
:

1361 
Œy
:

1362 
»ady
 = 
pŞËr
.
	$pŞl
()

1363 
exû±
 
£Ëù
.
”rÜ
, 
e
:

1364 
e
.
¬gs
[0] =ğ
”ºo
.
EINTR
:

1366 
¿i£


1368 
fd
, 
mode
 
š
 
»ady
:

1369 
mode
 & 
£Ëù
.
POLLOUT
:

1370 
chunk
 = 
šput
[
šput_off£t
 : iÅut_off£ˆ+ 
_PIPE_BUF
]

1371 
Œy
:

1372 
šput_off£t
 +ğ
os
.
	$wr™e
(
fd
, 
chunk
)

1373 
exû±
 
OSE¼Ü
, 
e
:

1374 
e
.
”ºo
 =ğ”ºo.
EPIPE
:

1375 
	$şo£_uÄegi¡”_ªd_»move
(
fd
)

1377 
¿i£


1379 
šput_off£t
 >ğ
	$Ën
(
šput
):

1380 
	$şo£_uÄegi¡”_ªd_»move
(
fd
)

1381 
–if
 
mode
 & 
£Ëù_POLLIN_POLLPRI
:

1382 
d©a
 = 
os
.
	$»ad
(
fd
, 4096)

1383 
nÙ
 
d©a
:

1384 
	$şo£_uÄegi¡”_ªd_»move
(
fd
)

1385 
fd2ouut
[
fd
].
	$­³nd
(
d©a
)

1387 #IgnÜ
hªg
 
up
 
Ü
 
”rÜs
.

1388 
	$şo£_uÄegi¡”_ªd_»move
(
fd
)

1390  (
¡dout
, 
¡d”r
)

1393 
def
 
	$_communiÿ‹_w™h_£Ëù
(
£lf
, 
šput
):

1394 
»ad_£t
 = []

1395 
wr™e_£t
 = []

1396 
¡dout
 = 
NÚe
 #Return

1397 
¡d”r
 = 
NÚe
 #Return

1399 
£lf
.
¡dš
 
ªd
 
šput
:

1400 
wr™e_£t
.
	$­³nd
(
£lf
.
¡dš
)

1401 
£lf
.
¡dout
:

1402 
»ad_£t
.
	$­³nd
(
£lf
.
¡dout
)

1403 
¡dout
 = []

1404 
£lf
.
¡d”r
:

1405 
»ad_£t
.
	$­³nd
(
£lf
.
¡d”r
)

1406 
¡d”r
 = []

1408 
šput_off£t
 = 0

1409 
»ad_£t
 
Ü
 
wr™e_£t
:

1410 
Œy
:

1411 
¾i¡
, 
wli¡
, 
xli¡
 = 
£Ëù
.
	$£Ëù
(
»ad_£t
, 
wr™e_£t
, [])

1412 
exû±
 
£Ëù
.
”rÜ
, 
e
:

1413 
e
.
¬gs
[0] =ğ
”ºo
.
EINTR
:

1415 
¿i£


1417 
£lf
.
¡dš
 
š
 
wli¡
:

1418 
chunk
 = 
šput
[
šput_off£t
 : iÅut_off£ˆ+ 
_PIPE_BUF
]

1419 
Œy
:

1420 
by‹s_wr™‹n
 = 
os
.
	`wr™e
(
£lf
.
¡dš
.
	`f’o
(), 
chunk
)

1421 
exû±
 
OSE¼Ü
, 
e
:

1422 
e
.
”ºo
 =ğ”ºo.
EPIPE
:

1423 
£lf
.
¡dš
.
	$şo£
()

1424 
wr™e_£t
.
	$»move
(
£lf
.
¡dš
)

1426 
¿i£


1428 
šput_off£t
 +ğ
by‹s_wr™‹n


1429 
šput_off£t
 >ğ
	$Ën
(
šput
):

1430 
£lf
.
¡dš
.
	$şo£
()

1431 
wr™e_£t
.
	$»move
(
£lf
.
¡dš
)

1433 
£lf
.
¡dout
 
š
 
¾i¡
:

1434 
d©a
 = 
os
.
	`»ad
(
£lf
.
¡dout
.
	`f’o
(), 1024)

1435 
d©a
 == "":

1436 
£lf
.
¡dout
.
	$şo£
()

1437 
»ad_£t
.
	$»move
(
£lf
.
¡dout
)

1438 
¡dout
.
	$­³nd
(
d©a
)

1440 
£lf
.
¡d”r
 
š
 
¾i¡
:

1441 
d©a
 = 
os
.
	`»ad
(
£lf
.
¡d”r
.
	`f’o
(), 1024)

1442 
d©a
 == "":

1443 
£lf
.
¡d”r
.
	$şo£
()

1444 
»ad_£t
.
	$»move
(
£lf
.
¡d”r
)

1445 
¡d”r
.
	$­³nd
(
d©a
)

1447  (
¡dout
, 
¡d”r
)

1450 
def
 
	$£nd_sigÇl
(
£lf
, 
sig
):

1453 
os
.
	$kl
(
£lf
.
pid
, 
sig
)

1455 
def
 
	$‹rmš©e
(
£lf
):

1458 
£lf
.
	$£nd_sigÇl
(
sigÇl
.
SIGTERM
)

1460 
def
 
	$kl
(
£lf
):

1463 
£lf
.
	$£nd_sigÇl
(
sigÇl
.
SIGKILL
)

1466 
def
 
	$_demo_posix
():

1467 #
#Exam¶1: 
Sim¶e
 
»dœeùiÚ
: 
G‘
 
´oûss
 
li¡


1468 #
 = Pİ’(["ps"], stdout=PIPE).communiÿ‹()[0]

1469 
´št
 "Process†ist:"

1470 
´št
 
¶i¡


1472 #
#Exam¶2: 
Chªge
 
uid
 
befÜe
 
executšg
 
chd


1473 #

os
.
	`g‘uid
() == 0:

1474 
p
 = 
	`Pİ’
(["id"], 
´“xec_â
=
Ïmbda
: 
os
.
	$£tuid
(100))

1475 
p
.
	$wa™
()

1477 #
#Exam¶3: 
CÚÃùšg
 
£v”®
 
sub´oûs£s


1478 #
 "Lookšg fÜ 'hda'..."

1479 
p1
 = 
	`Pİ’
(["dmesg"], 
¡dout
=
PIPE
)

1480 
p2
 = 
	`Pİ’
(["g»p", "hda"], 
¡dš
=
p1
.
¡dout
, stdout=
PIPE
)

1481 
´št
 
	`»´
(
p2
.
	`communiÿ‹
()[0])

1483 #
#Exam¶4: 
C©ch
 
executiÚ
 
”rÜ


1484 #


1485 
´št
 "Trying‡ weird file..."

1486 
Œy
:

1487 
´št
 
	`Pİ’
(["/this/·th/dÛs/nÙ/exi¡"]).
	$communiÿ‹
()

1488 
exû±
 
OSE¼Ü
, 
e
:

1489 
e
.
”ºo
 =ğ”ºo.
ENOENT
:

1490 
´št
 "The file didn'tƒxist. Ihought so..."

1491 
´št
 "Childraceback:"

1492 
´št
 
e
.
chd_Œaûback


1494 
´št
 "E¼Ü", 
e
.
”ºo


1496 
´št
 >>
sys
.
¡d”r
, "Gosh. Noƒrror."

1499 
def
 
	$_demo_wšdows
():

1500 #
#Exam¶1: 
CÚÃùšg
 
£v”®
 
sub´oûs£s


1501 #
 "Lookšg fÜ 'PROMPT' iÀ£ˆouut..."

1502 
p1
 = 
	`Pİ’
("£t", 
¡dout
=
PIPE
, 
sh–l
=
True
)

1503 
p2
 = 
	`Pİ’
('fšd "PROMPT"', 
¡dš
=
p1
.
¡dout
, stdout=
PIPE
)

1504 
´št
 
	`»´
(
p2
.
	`communiÿ‹
()[0])

1506 #
#Exam¶2: 
Sim¶e
 
executiÚ
 
of
 
´og¿m


1507 #
 "Executšg c®c..."

1508 
p
 = 
	`Pİ’
("calc")

1509 
p
.
	$wa™
()

1512 
__Çme__
 == "__main__":

1513 
mswšdows
:

1514 
	$_demo_wšdows
()

1516 
	`_demo_posix
()

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/_cpconfig.py

2 
CÚfigu¿tiÚ
 
sy¡em
 
	gCh”ryPy
.

4 
CÚfigu¿tiÚ
 
š
 
Ch”ryPy
 
is
 
im¶em’‹d
 
vŸ
 
	gdiùiÚ¬›s
. 
Keys
 
¬e
 
¡ršgs


5 
which
 
Çme
 
the
 
m­³d
 
	gv®ue
, which 
may
 
be
 
of
 
ªy
 
	gty³
.

8 
	gArch™eùu»


11 
Ch”ryPy
 
Reque¡s
 
¬e
 
·¹
 
of
 
ª
 
	gAµliÿtiÚ
, 
which
 
runs
 
š
 
a
 
glob®
 
	gcÚ‹xt
,

12 
ªd
 
cÚfigu¿tiÚ
 
d©a
 
may
 
­¶y
 
to
 
ªy
 
of
 
tho£
 
th»e
 
	gscİes
:

14 
Glob®


15 
CÚfigu¿tiÚ
 
’Œ›s
 
which
 
­¶y
 
ev”ywh”e
 
¬e
 
¡Üed
 
š


16 
ch”rypy
.
cÚfig
.

18 
AµliÿtiÚ


19 
EÁr›s
 
which
 
­¶y
 
to
 
—ch
 
mouÁed
 
­¶iÿtiÚ
 
¬e
 
¡Üed


20 
Ú
 
the
 
AµliÿtiÚ
 
objeù
 
™£lf
, 
	gas
 '­p.cÚfig'. 
This
 
is
 
a
 
	gtwo
-
Ëv–


21 
diù
 
wh”e
 
—ch
 
key
 
is
 
a
 
	g·th
, 
	gÜ
 "»ÏtivURL" (
	gexam¶e
, "/" or

22 "/·th/to/my/·ge"), 
ªd
 
—ch
 
v®ue
 
is
 
a
 
cÚfig
 
	gdiù
. 
	gUsu®ly
, 
this


23 
d©a
 
is
 
´ovided
 
š
 
the
 
ÿÎ
 
to
 
	gŒ“
.
mouÁ
(
roÙ
(), 
cÚfig
=
cÚf
),

24 
®though
 
you
 
may
 
®so
 
u£
 
	g­p
.
m”ge
(
cÚf
).

26 
Reque¡


27 
Each
 
Reque¡
 
objeù
 
pos£s£s
 
a
 
	gsšgË
 'Reque¡.cÚfig' 
	gdiù
.

28 
E¬ly
 
š
 
the
 
»que¡
 
	g´oûss
, 
this
 
diù
 
is
 
pİuÏ‹d
 
by
 
m”gšg
 
glob®


29 
cÚfig
 
	g’Œ›s
, 
AµliÿtiÚ
 
’Œ›s
 (
who£
 
·th
 
equ®s
 
Ü
 
is
 
a
 
·»Á


30 
of
 
Reque¡
.
·th_šfo
), 
ªd
 
ªy
 
cÚfig
 
acquœed
 
lookšg
 
up
 
the


31 
·ge
 
hªdËr
 (
£e
 
Ãxt
).

34 
	gDeş¬©iÚ


37 
CÚfigu¿tiÚ
 
d©a
 
may
 
be
 
suµl›d
 
as
 
a
 
PythÚ
 
	gdiùiÚ¬y
,‡ ¨
	gf’ame
,

38 
Ü
 
as
 
ª
 
İ’
 
fe
 
	gobjeù
. 
Wh’
 
you
 
suµly
 
a
 
f’ame
 o¸
	gfe
, 
Ch”ryPy


39 
u£s
 
	gPythÚ
's builtin ConfigParser; you declare Application config by

40 
wr™šg
 
—ch
 
·th
 
as
 
a
 
£ùiÚ
 
	gh—d”
::

42 [/
·th
/
to
/
my
/
·ge
]

43 
»que¡
.
¡»am
 = 
True


45 
To
 
deş¬e
 
glob®
 
cÚfigu¿tiÚ
 
’Œ›s
, 
¶aû
 
them
 
š
 
	ga
 [glob®] 
	g£ùiÚ
.

47 
You
 
may
 
®so
 
deş¬e
 
cÚfig
 
’Œ›s
 
dœeùly
 
Ú
 
the
 
şas£s
 
ªd
 
	gm‘hods


48 (
·ge
 
	ghªdËrs
è
th©
 
make
 
up
 
your
 
Ch”ryPy
 
­¶iÿtiÚ
 
vŸ
 
	gthe
 ``
	g_ı_cÚfig
``

49 
	g©Œibu‹
. 
FÜ
 
	gexam¶e
::

51 
şass
 
Demo
:

52 
_ı_cÚfig
 = {'toŞs.gz.Ú': 
True
}

54 
def
 
	$šdex
(
£lf
):

56 
šdex
.
expo£d
 = 
True


57 
šdex
.
_ı_cÚfig
 = {'»que¡.show_Œaûbacks': 
F®£
}

59 .. 
nÙe
::

61 
This
 
behaviÜ
 
is
 
Úly
 
gu¬ª‹ed
 
the
  
di¥©ch”
.

62 
Oth”
 
di¥©ch”s
 
may
 
have
 
difã»Á
 
»¡riùiÚs
 
Ú
 
wh”e


63 
you
 
ÿn
 
©ch
 
_ı_cÚfig
 
©Œibu‹s
.

66 
Name¥aûs


69 
CÚfigu¿tiÚ
 
keys
 
¬e
 
£·¿‹d
 
što
 
Çme¥aûs
 
by
 
the
 
fœ¡
 "." 
š
h
key
.

70 
Cu¼’t
 
Çme¥aûs
:

72 
’gše


73 
CÚŒŞs
 
the
 '­¶iÿtiÚƒngše', 
šşudšg
 
	gautÜ–ßd
.

74 
The£
 
ÿn
 
Úly
 
be
 
deş¬ed
 
š
 
the
 
glob®
 
	gcÚfig
.

76 
Œ“


77 
G¿ás
 
	gch”rypy
.
AµliÿtiÚ
 
objeùs
 
Úto
 ch”rypy.
	gŒ“
.

78 
The£
 
ÿn
 
Úly
 
be
 
deş¬ed
 
š
 
the
 
glob®
 
	gcÚfig
.

80 
hooks


81 
Deş¬es
 
add™iÚ®
 
	g»que¡
-
´oûssšg
 
	gfunùiÚs
.

83 
log


84 
CÚfigu»s
 
the
 
loggšg
 
—ch
 
	g­¶iÿtiÚ
.

85 
The£
 
ÿn
 
Úly
 
be
 
deş¬ed
 
š
 
the
 
glob®
 
	gÜ
 / 
	gcÚfig
.

87 
»que¡


88 
Adds
 
©Œibu‹s
 
to
 
—ch
 
	gReque¡
.

90 
»¥Ú£


91 
Adds
 
©Œibu‹s
 
to
 
—ch
 
	gRe¥Ú£
.

93 
£rv”


94 
CÚŒŞs
 
the
  
HTTP
 
£rv”
 
vŸ
 
	gch”rypy
.
	g£rv”
.

95 
The£
 
ÿn
 
Úly
 
be
 
deş¬ed
 
š
 
the
 
glob®
 
	gcÚfig
.

97 
toŞs


98 
Runs
 
ªd
 
cÚfigu»s
 
add™iÚ®
 
	g»que¡
-
´oûssšg
 
	g·ckages
.

100 
wsgi


101 
Adds
 
WSGI
 
middËw¬e
 
to
 
ª
 
	gAµliÿtiÚ
's "pipeline".

102 
The£
 
ÿn
 
Úly
 
be
 
deş¬ed
 
š
 
the
 
	g­p
's„oot config ("/").

104 
check”


105 
CÚŒŞs
 
	gthe
 'check”', 
which
 
looks
 
commÚ
 
”rÜs
 
š


106 
­p
 
	$¡©e
 (
šşudšg
 
cÚfig
è
wh’
 
the
 
’gše
 
¡¬ts
.

107 
Glob®
 
cÚfig
 
Úly
.

109 
The
 
Úly
 
key
 
th©
 
dÛs
 
nÙ
 
exi¡
 
š
 
a
 
Çme¥aû
 
is
 
the
 "’vœÚm’t" 
’Œy
.

110 
This
 
¥ecŸl
 
’Œy
 'impÜts' 
Ùh”
 
cÚfig
 
’Œ›s
 
äom
 
a
 
‹m¶©e
 
¡Üed
 
š


111 
ch”rypy
.
_ıcÚfig
.
’vœÚm’ts
[
’vœÚm’t
]. 
It
 
Úly
 
­¶›s
 
to
 
the
 
glob®


112 
cÚfig
, 
ªd
 
Úly
 
wh’
 
you
 
u£
 
ch”rypy
.cÚfig.
upd©e
.

114 
You
 
ÿn
 
defše
 
your
 
own
 
Çme¥aûs
 
to
 
be
 
ÿÎed
 
©
 
the
 
Glob®
, 
AµliÿtiÚ
,

115 
Ü
 
Reque¡
 
Ëv–
, 
by
 
addšg
 
a
 
Çmed
 
hªdËr
 
to
 
ch”rypy
.
cÚfig
.
Çme¥aûs
,

116 
­p
.
Çme¥aûs
, 
Ü
‡µ.
»que¡_şass
.Çme¥aûs. 
The
 
Çme
 
ÿn


117 
be
 
ªy
 
¡ršg
, 
ªd
 
the
 
hªdËr
 
mu¡
 b
e™h”
 
a
 
ÿÎabË
 
Ü
 
	$a
 (
PythÚ
 2.5

118 
¡yË
è
cÚ‹xt
 
mªag”
.

121 
impÜt
 
ch”rypy


122 
äom
 
ch”rypy
.
_ıcom·t
 
impÜt
 
£t
, 
ba£¡ršg


123 
äom
 
ch”rypy
.
lib
 
impÜt
 
»´cÚf


125 #D•»ÿ‹d 
š
 
Ch”ryPy
 3.2--
»move
 in 3.3

126 
Name¥aûS‘
 = 
»´cÚf
.NamespaceSet

128 
def
 
	$m”ge
(
ba£
, 
Ùh”
):

131 
If
 
the
 
giv’
 
cÚfig
 
is
 
a
 
f’ame
, 
™
 
wl
 
be
 
­³nded
 
to


132 
the
 
li¡
 
of
 
fes
 
to
 
mÚ™Ü
 "autÜ–ßd" 
chªges
.

134 
	$isš¡ªû
(
Ùh”
, 
ba£¡ršg
):

135 
ch”rypy
.
’gše
.
autÜ–ßd
.
fes
.
	$add
(
Ùh”
)

137 #Lßd 
Ùh”
 
što
 
ba£


138 
£ùiÚ
, 
v®ue_m­
 
š
 
»´cÚf
.
	`as_diù
(
Ùh”
).
	$™ems
():

139 
nÙ
 
	$isš¡ªû
(
v®ue_m­
, 
diù
):

140 
¿i£
 
	`V®ueE¼Ü
(

145 
ba£
.
	`£tdeçuÉ
(
£ùiÚ
, {
	}
}).
	$upd©e
(
v®ue_m­
)

148 
şass
 
	$CÚfig
(
»´cÚf
.
CÚfig
):

151 
def
 
	$upd©e
(
£lf
, 
cÚfig
):

153 
	$isš¡ªû
(
cÚfig
, 
ba£¡ršg
):

155 
ch”rypy
.
’gše
.
autÜ–ßd
.
fes
.
	$add
(
cÚfig
)

156 
»´cÚf
.
CÚfig
.
	$upd©e
(
£lf
, 
cÚfig
)

158 
def
 
	$_­¶y
(
£lf
, 
cÚfig
):

160 
	`isš¡ªû
(
cÚfig
.
	`g‘
("glob®", 
NÚe
), 
diù
):

161 
	`Ën
(
cÚfig
) > 1:

162 
ch”rypy
.
check”
.
glob®_cÚfig_cÚšed_·ths
 = 
True


163 
cÚfig
 = config["global"]

164 'toŞs.¡©icdœ.dœ' 
š
 
cÚfig
:

165 
cÚfig
['tools.staticdir.section'] = "global"

166 
»´cÚf
.
CÚfig
.
	$_­¶y
(
£lf
, 
cÚfig
)

168 
def
 
	$__ÿÎ__
(
£lf
, *
¬gs
, **
kw¬gs
):

170 
¬gs
:

171 
¿i£
 
	`Ty³E¼Ü
(

174 
def
 
	$toŞ_decÜ©Ü
(
f
):

175 
nÙ
 
	`ha§‰r
(
f
, "_cp_config"):

176 
f
.
_ı_cÚfig
 = {
	}
}

177 
k
, 
v
 
š
 
	gkw¬gs
.
	$™ems
():

178 
f
.
_ı_cÚfig
[
k
] = 
v


179  
f


180  
toŞ_decÜ©Ü


183 
CÚfig
.
’vœÚm’ts
 =ƒnvironments = {

185 '’gše.autÜ–ßd_Ú': 
F®£
,

186 'check”.Ú': 
F®£
,

187 'toŞs.log_h—d”s.Ú': 
F®£
,

188 '»que¡.show_Œaûbacks': 
F®£
,

189 '»que¡.show_mism©ched_·¿ms': 
F®£
,

192 '’gše.autÜ–ßd_Ú': 
F®£
,

193 'check”.Ú': 
F®£
,

194 'toŞs.log_h—d”s.Ú': 
F®£
,

195 '»que¡.show_Œaûbacks': 
F®£
,

196 '»que¡.show_mism©ched_·¿ms': 
F®£
,

197 'log.sü“n': 
F®£
,

200 #FÜ 
u£
 
w™h
 
Ch”ryPy
 
embedded
 
š
 
ªÙh”
 
d•loym’t
 
¡ack
.

201 '’gše.autÜ–ßd_Ú': 
F®£
,

202 'check”.Ú': 
F®£
,

203 'toŞs.log_h—d”s.Ú': 
F®£
,

204 '»que¡.show_Œaûbacks': 
F®£
,

205 '»que¡.show_mism©ched_·¿ms': 
F®£
,

206 'log.sü“n': 
F®£
,

207 '’gše.SIGHUP': 
NÚe
,

208 '’gše.SIGTERM': 
NÚe
,

211 '’gše.autÜ–ßd_Ú': 
F®£
,

212 'check”.Ú': 
F®£
,

213 'toŞs.log_h—d”s.Ú': 
F®£
,

214 '»que¡.show_Œaûbacks': 
True
,

215 '»que¡.show_mism©ched_·¿ms': 
True
,

216 'log.sü“n': 
F®£
,

218 
	}
}

221 
def
 
	$_£rv”_Çme¥aû_hªdËr
(
k
, 
v
):

222 """CÚfig hªdË¸fÜh"
£rv”
"‚amespace."""

223 
©oms
 = 
k
.
	`¥l™
(".", 1)

224 
	`Ën
(
©oms
) > 1:

225 #S³cŸl-
cÚfig
 
keys
 
of
 
the
 
fÜm
 'server.servername.socket_port'

226 #tØ
cÚfigu»
 
add™iÚ®
 
HTTP
 
£rv”s
.

227 
nÙ
 
	`ha§‰r
(
ch”rypy
, "servers"):

228 
ch”rypy
.
£rv”s
 = {
	}
}

230 
£rv”Çme
, 
	gk
 = 
©oms


231 
£rv”Çme
 
nÙ
 
š
 
ch”rypy
.
£rv”s
:

232 
äom
 
ch”rypy
 
impÜt
 
_ı£rv”


233 
ch”rypy
.
£rv”s
[
£rv”Çme
] = 
_ı£rv”
.
	$S”v”
()

234 #OÀ
by
 , 
but
 'Ú = F®£' 
ÿn
 
unsubsüibe
 
	`™
 (
£e
 
b–ow
).

235 
ch”rypy
.
£rv”s
[
£rv”Çme
].
	$subsüibe
()

237 
k
 == 'on':

238 
v
:

239 
ch”rypy
.
£rv”s
[
£rv”Çme
].
	$subsüibe
()

241 
ch”rypy
.
£rv”s
[
£rv”Çme
].
	$unsubsüibe
()

243 
	$£‰r
(
ch”rypy
.
£rv”s
[
£rv”Çme
], 
k
, 
v
)

245 
	$£‰r
(
ch”rypy
.
£rv”
, 
k
, 
v
)

246 
CÚfig
.
Çme¥aûs
["£rv”"] = 
_£rv”_Çme¥aû_hªdËr


248 
def
 
	$_’gše_Çme¥aû_hªdËr
(
k
, 
v
):

249 """Backw¬d com·tib™y hªdË¸fÜh"
’gše
"‚amespace."""

250 
’gše
 = 
ch”rypy
.engine

251 
k
 == 'autoreload_on':

252 
v
:

253 
’gše
.
autÜ–ßd
.
	$subsüibe
()

255 
’gše
.
autÜ–ßd
.
	$unsubsüibe
()

256 
–if
 
k
 == 'autoreload_frequency':

257 
’gše
.
autÜ–ßd
.
äequ’cy
 = 
v


258 
–if
 
k
 == 'autoreload_match':

259 
’gše
.
autÜ–ßd
.
m©ch
 = 
v


260 
–if
 
k
 == 'reload_files':

261 
’gše
.
autÜ–ßd
.
fes
 = 
	$£t
(
v
)

262 
–if
 
k
 == 'deadlock_poll_freq':

263 
’gše
.
timeout_mÚ™Ü
.
äequ’cy
 = 
v


264 
–if
 
k
 == 'SIGHUP':

265 
’gše
.
li¡’”s
['SIGHUP'] = 
	$£t
([
v
])

266 
–if
 
k
 == 'SIGTERM':

267 
’gše
.
li¡’”s
['SIGTERM'] = 
	$£t
([
v
])

268 
–if
 "." 
š
 
k
:

269 
¶ugš
, 
©ŒÇme
 = 
k
.
	`¥l™
(".", 1)

270 
¶ugš
 = 
	$g‘©Œ
(
’gše
, 
¶ugš
)

271 
©ŒÇme
 == 'on':

272 
v
 
ªd
 
	`ha§‰r
(
	`g‘©Œ
(
¶ugš
, 'subsüibe', 
NÚe
), '__call__'):

273 
¶ugš
.
	$subsüibe
()

275 
	$–if
 (
nÙ
 
v
è
ªd
 
	`ha§‰r
(
	`g‘©Œ
(
¶ugš
, 'unsubsüibe', 
NÚe
), '__call__'):

276 
¶ugš
.
	$unsubsüibe
()

278 
	$£‰r
(
¶ugš
, 
©ŒÇme
, 
v
)

280 
	$£‰r
(
’gše
, 
k
, 
v
)

281 
CÚfig
.
Çme¥aûs
["’gše"] = 
_’gše_Çme¥aû_hªdËr


284 
def
 
	$_Œ“_Çme¥aû_hªdËr
(
k
, 
v
):

286 
	$isš¡ªû
(
v
, 
diù
):

287 
süt_Çme
, 
­p
 
š
 
v
.
	$™ems
():

288 
ch”rypy
.
Œ“
.
	$g¿á
(
­p
, 
süt_Çme
)

289 
ch”rypy
.
’gše
.
	`log
("MouÁed: % Ú %s" % (
­p
, 
süt_Çme
 
Ü
 "/"))

291 
ch”rypy
.
Œ“
.
	$g¿á
(
v
, v.
süt_Çme
)

292 
ch”rypy
.
’gše
.
	`log
("MouÁed: % Ú %s" % (
v
, v.
süt_Çme
 
Ü
 "/"))

293 
CÚfig
.
Çme¥aûs
["Œ“"] = 
_Œ“_Çme¥aû_hªdËr


	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/_cpdispatch.py

3 
	gA
 'di¥©ch”' 
is
 
the
 
objeù
 
which
 
looks
 
up
 
	gthe
 '·ghªdËr' 
ÿÎabË


4 
ªd
 
cŞËùs
 
cÚfig
 
the
 
cu¼’t
 
»que¡
 
ba£d
 
Ú
h
	g·th_šfo
, 
Ùh”


5 
»que¡
 
	g©Œibu‹s
, 
ªd
 
the
 
­¶iÿtiÚ
 
	g¬ch™eùu»
. 
The
 
cÜe
 
ÿÎs
he

6 
di¥©ch”
 
as
 
—¾y
‡ 
	gpossibË
, 
·ssšg
 
™
 
	ga
 '·th_šfo' 
	g¬gum’t
.

8 
The
  
di¥©ch”
 
discov”s
 
the
 
·ge
 
hªdËr
 
by
 
m©chšg
 
·th_šfo


9 
to
 
a
 
h›¿rchiÿl
 
¬¿ngem’t
 
of
 
	gobjeùs
, 
¡¬tšg
 
©
 
	g»que¡
.
	g­p
.
	groÙ
.

12 
impÜt
 
¡ršg


13 
impÜt
 
sys


14 
impÜt
 
ty³s


15 
	gŒy
:

16 
şas¡y³
 = (
ty³
, 
	gty³s
.
	gCÏssTy³
)

17 
exû±
 
	gA‰ribu‹E¼Ü
:

18 
şas¡y³
 = 
ty³


20 
impÜt
 
ch”rypy


21 
äom
 
ch”rypy
.
_ıcom·t
 
impÜt
 
£t


24 
şass
 
	$PageHªdËr
(
objeù
):

27 
def
 
	$__š™__
(
£lf
, 
ÿÎabË
, *
¬gs
, **
kw¬gs
):

28 
£lf
.
ÿÎabË
 = callable

29 
£lf
.
¬gs
 =‡rgs

30 
£lf
.
kw¬gs
 = kwargs

32 
def
 
	$__ÿÎ__
(
£lf
):

33 
Œy
:

34  
£lf
.
	$ÿÎabË
(*
£lf
.
¬gs
, **£lf.
kw¬gs
)

35 
exû±
 
Ty³E¼Ü
:

36 
x
 = 
sys
.
	`exc_šfo
()[1]

37 
Œy
:

38 
	$‹¡_ÿÎabË_¥ec
(
£lf
.
ÿÎabË
, s–f.
¬gs
, s–f.
kw¬gs
)

39 
exû±
 
ch”rypy
.
HTTPE¼Ü
:

40 
¿i£
 
sys
.
	`exc_šfo
()[1]

41 
exû±
:

42 
¿i£
 
x


43 
¿i£


46 
def
 
	$‹¡_ÿÎabË_¥ec
(
ÿÎabË
, 
ÿÎabË_¬gs
, 
ÿÎabË_kw¬gs
):

48 
In¥eù
 
ÿÎabË
 
ªd
 
‹¡
 
to
 
£e
 
the
 
giv’
 
¬gs
 
¬e
 
su™abË
 
™
.

50 
Wh’
 
ª
 
”rÜ
 
occurs
 
duršg
 
the
 
hªdËr
's invoking stagehere‡re 2

51 
”rÚeous
 
ÿ£s
:

52 1. 
Too
 
mªy
 
·¿m‘”s
 
·s£d
 
to
 
a
 
funùiÚ
 
which
 
dÛ¢
't define

53 
Úe
 
of
 *
¬gs
 
Ü
 **
kw¬gs
.

54 2. 
Too
 
l™e
 
·¿m‘”s
 
¬e
 
·s£d
 
to
 
the
 
funùiÚ
.

56 
Th”e
 
¬e
 3 
sourûs
 
of
 
·¿m‘”s
 
to
 
a
 
ch”rypy
 
hªdËr
.

57 1. 
qu”y
 
¡ršg
 
·¿m‘”s
 
¬e
 
·s£d
 
as
 
keywÜd
…¬am‘” 
to
 
the
 
hªdËr
.

58 2. 
body
 
·¿m‘”s
 
¬e
 
®so
 
·s£d
 
as
 
keywÜd
…arameters.

59 3. 
wh’
 
·¹Ÿl
 
m©chšg
 
occurs
, 
the
 
fš®
 
·th
 
©oms
 
¬e
 
·s£d
 
as


60 
pos™iÚ®
 
¬gs
.

61 
BÙh
 
the
 
qu”y
 
¡ršg
 
ªd
 
·th
 
©oms
 
¬e
 
·¹
 
of
h
URI
. 
If
 
they
‡re

62 
šcÜ»ù
, 
th’
 
a
 404 
NÙ
 
Found
 
should
 
be
 
¿i£d
. 
CÚv”£ly
 
the
 
body


63 
·¿m‘”s
 
¬e
 
·¹
 
of
 
the
 
»que¡
; 
they
‡» 
šv®id
 
a
 400 
Bad
 
Reque¡
.

65 
show_mism©ched_·¿ms
 = 
	`g‘©Œ
(

66 
ch”rypy
.
£rvšg
.
»que¡
, 'show_mism©ched_·¿ms', 
F®£
)

67 
Œy
:

68 (
¬gs
, 
v¬¬gs
, 
v¬kw
, 
deçuÉs
èğ
š¥eù
.
	$g‘¬g¥ec
(
ÿÎabË
)

69 
exû±
 
Ty³E¼Ü
:

70 
	$isš¡ªû
(
ÿÎabË
, 
objeù
è
ªd
 
	`ha§‰r
(callable, '__call__'):

71 (
¬gs
, 
v¬¬gs
, 
v¬kw
, 
deçuÉs
èğ
š¥eù
.
	$g‘¬g¥ec
(
ÿÎabË
.
__ÿÎ__
)

73 #Ià
™
 
wa¢
't one of our ownypes,„e-raise

74 #th
Üigš®
 
”rÜ


75 
¿i£


77 
¬gs
 
ªd
‡rgs[0] == 'self':

78 
¬gs
 =‡rgs[1:]

80 
¬g_u§ge
 = 
	`diù
([(
¬g
, 0,è¬g 
š
 
¬gs
])

81 
v¬¬g_u§ge
 = 0

82 
v¬kw_u§ge
 = 0

83 
exŒa_kw¬gs
 = 
	$£t
()

85 
i
, 
v®ue
 
š
 
	$’um”©e
(
ÿÎabË_¬gs
):

86 
Œy
:

87 
¬g_u§ge
[
¬gs
[
i
]] += 1

88 
exû±
 
IndexE¼Ü
:

89 
v¬¬g_u§ge
 += 1

91 
key
 
š
 
ÿÎabË_kw¬gs
.
	$keys
():

92 
Œy
:

93 
¬g_u§ge
[
key
] += 1

94 
exû±
 
KeyE¼Ü
:

95 
v¬kw_u§ge
 += 1

96 
exŒa_kw¬gs
.
	$add
(
key
)

98 #figu» 
out
 
which
 
¬gs
 
have
 
deçuÉs
.

99 
¬gs_w™h_deçuÉs
 = 
¬gs
[-
	$Ën
(
deçuÉs
 
Ü
 []):]

100 
i
, 
v®
 
š
 
	$’um”©e
(
deçuÉs
 
Ü
 []):

101 #DeçuÉ 
ke
 
efãù
 
Úly
 
wh’
 
the
 
¬g
 
ha¢
't been used yet.

102 
¬g_u§ge
[
¬gs_w™h_deçuÉs
[
i
]] == 0:

103 
¬g_u§ge
[
¬gs_w™h_deçuÉs
[
i
]] += 1

105 
missšg_¬gs
 = []

106 
muÉË_¬gs
 = []

107 
key
, 
u§ge
 
š
 
¬g_u§ge
.
	$™ems
():

108 
u§ge
 == 0:

109 
missšg_¬gs
.
	$­³nd
(
key
)

110 
–if
 
u§ge
 > 1:

111 
muÉË_¬gs
.
	$­³nd
(
key
)

113 
missšg_¬gs
:

114 #IÀ
the
 
wh”e
h
m‘hod
 
®lows
 
body
 
¬gum’ts


115 #th”
¬e
 3 
pÙ’tŸl
 
”rÜs
:

116 #1. 
nÙ
 
’ough
 
qu”y
 
¡ršg
 
·¿m‘”s
 -> 404

117 #2. 
nÙ
 
’ough
 
body
 
·¿m‘”s
 -> 400

118 #3. 
nÙ
 
’ough
 
·th
 
	`·¹s
 (
·¹Ÿl
 
m©ches
) -> 404

119 #
#W
ÿn
't‡ctuallyell which case it is,

120 #sØ
I
'm„aising‡ 404 becausehat covers 2/3 ofhe

122 #
#IÀ
the
 
wh”e
h
m‘hod
 
dÛs
 
nÙ
 
®low
 
body


123 #¬gum’t 
™
's definitely‡ 404.

124 
mes§ge
 = 
NÚe


125 
show_mism©ched_·¿ms
:

126 
mes§ge
="Missšg…¬am‘”s: %s" % ",".
	$još
(
missšg_¬gs
)

127 
¿i£
 
ch”rypy
.
	$HTTPE¼Ü
(404, 
mes§ge
=message)

129 #th
exŒa
 
pos™iÚ®
 
¬gum’ts
 
come
 
äom
 
the
 
·th
 - 404 
NÙ
 
Found


130 
nÙ
 
v¬¬gs
 
ªd
 
v¬¬g_u§ge
 > 0:

131 
¿i£
 
ch”rypy
.
	$HTTPE¼Ü
(404)

133 
body_·¿ms
 = 
ch”rypy
.
£rvšg
.
»que¡
.
body
.
·¿ms
 
Ü
 {
	}
}

134 
body_·¿ms
 = 
£t
(body_·¿ms.
	$keys
())

135 
qs_·¿ms
 = 
	`£t
(
ÿÎabË_kw¬gs
.
	`keys
()è- 
body_·¿ms


137 
muÉË_¬gs
:

138 
qs_·¿ms
.
	`š‹r£ùiÚ
(
	$£t
(
muÉË_¬gs
)):

139 #Ià
ªy
 
of
 
the
 
muÉË
 
·¿m‘”s
 
ÿme
 
äom
h
qu”y
 
¡ršg
 
th’


141 
”rÜ
 = 404

143 #Oth”wi£ 
™
's‡ 400 Bad Request

144 
”rÜ
 = 400

146 
mes§ge
 = 
NÚe


147 
show_mism©ched_·¿ms
:

148 
mes§ge
="Multiple values for…arameters: "\

149 "%s" % ",".
	$još
(
muÉË_¬gs
)

150 
¿i£
 
ch”rypy
.
	$HTTPE¼Ü
(
”rÜ
, 
mes§ge
=message)

152 
nÙ
 
v¬kw
 
ªd
 
v¬kw_u§ge
 > 0:

154 #Ià
th”e
 
w”e
 
exŒa
 
qu”y
 
¡ršg
 
·¿m‘”s
, 
™
's‡ 404 Not Found

155 
exŒa_qs_·¿ms
 = 
	`£t
(
qs_·¿ms
).
	$š‹r£ùiÚ
(
exŒa_kw¬gs
)

156 
exŒa_qs_·¿ms
:

157 
mes§ge
 = 
NÚe


158 
show_mism©ched_·¿ms
:

159 
mes§ge
="Unexpected query string "\

160 "·¿m‘”s: %s" % ", ".
	$još
(
exŒa_qs_·¿ms
)

161 
¿i£
 
ch”rypy
.
	$HTTPE¼Ü
(404, 
mes§ge
=message)

163 #Ià
th”e
 
w”e
 
ªy
 
exŒa
 
body
 
·¿m‘”s
, 
™
's‡ 400 Not Found

164 
exŒa_body_·¿ms
 = 
	`£t
(
body_·¿ms
).
	$š‹r£ùiÚ
(
exŒa_kw¬gs
)

165 
exŒa_body_·¿ms
:

166 
mes§ge
 = 
NÚe


167 
show_mism©ched_·¿ms
:

168 
mes§ge
="Unexpected body…arameters: "\

169 "%s" % ", ".
	$još
(
exŒa_body_·¿ms
)

170 
¿i£
 
ch”rypy
.
	$HTTPE¼Ü
(400, 
mes§ge
=message)

173 
Œy
:

174 
impÜt
 
š¥eù


175 
exû±
 
ImpÜtE¼Ü
:

176 
‹¡_ÿÎabË_¥ec
 = 
Ïmbda
 
ÿÎabË
, 
¬gs
, 
kw¬gs
: 
NÚe


180 
şass
 
	$L©eP¬amPageHªdËr
(
PageHªdËr
):

182 
wªt
 
to
 
ÿ±u»
 
th©
 
diù
 
too
 
—¾y
; 
we
 wªˆtØ
give
 
toŞs
 
like
 
the


183 
decodšg
 
toŞ
 
a
 
chªû
 
to
 
modify
 
the
 
·¿ms
 
diù
 
š
-
b‘w“n
h
lookup


184 
of
 
the
 
hªdËr
 
ªd
h
aùu®
 
ÿÎšg
 oàthhªdËr. 
This
 
subşass


185 
kes
 
th©
 
što
 
accouÁ
, 
ªd
 
®lows
 
»que¡
.
·¿ms
 
to
 
be
 'bound†ate'

186 (
™
' mÜcom¶iÿ‹dhªh©, buˆth©'
s
 
the
 
efãù
).

189 
def
 
	$_g‘_kw¬gs
(
£lf
):

190 
kw¬gs
 = 
ch”rypy
.
£rvšg
.
»que¡
.
·¿ms
.
	$cİy
()

191 
£lf
.
_kw¬gs
:

192 
kw¬gs
.
	$upd©e
(
£lf
.
_kw¬gs
)

193  
kw¬gs


195 
def
 
	$_£t_kw¬gs
(
£lf
, 
kw¬gs
):

196 
£lf
.
_kw¬gs
 = 
kw¬gs


198 
kw¬gs
 = 
	`´İ”ty
(
_g‘_kw¬gs
, 
_£t_kw¬gs
,

199 
doc
='page handler kwargs (with '

203 
sys
.
v”siÚ_šfo
 < (3, 0):

204 
punùu©iÚ_to_und”scÜes
 = 
¡ršg
.
	`mak‘¿ns
(

205 
¡ršg
.
punùu©iÚ
, '_' * 
	$Ën
(
¡ršg
.
punùu©iÚ
))

206 
def
 
	$v®id©e_Œª¦©Ü
(
t
):

207 
nÙ
 
	$isš¡ªû
(
t
, 
¡r
è
Ü
 
	`Ën
(t) != 256:

208 
¿i£
 
	`V®ueE¼Ü
("Theranslate‡rgument must be‡ str of†en 256.")

210 
punùu©iÚ_to_und”scÜes
 = 
¡r
.
	`mak‘¿ns
(

211 
¡ršg
.
punùu©iÚ
, '_' * 
	$Ën
(
¡ršg
.
punùu©iÚ
))

212 
def
 
	$v®id©e_Œª¦©Ü
(
t
):

213 
nÙ
 
	$isš¡ªû
(
t
, 
diù
):

214 
¿i£
 
	`V®ueE¼Ü
("Theranslate‡rgument must be‡ dict.")

216 
şass
 
	$Di¥©ch”
(
objeù
):

219 
The
 
Œ“
 
is
 
roÙed
 
©
 
ch”rypy
.
»que¡
.
­p
.
roÙ
, 
ªd
 
—ch
 
h›¿rchiÿl


220 
compÚ’t
 
š
 
the
 
·th_šfo
 
¬gum’t
 
is
 
m©ched
 
to
 
a
 
cÜ»¥Údšg
 
Ã¡ed


221 
©Œibu‹
 
of
 
the
 
roÙ
 
objeù
. 
M©chšg
 
hªdËrs
 
mu¡
 
have
 
ª
 'exposed'

222 
©Œibu‹
 
which
 
ev®u©es
 
to
 
True
. 
The
 
¥ecŸl
 
m‘hod
 
Çme
 "index"

223 
m©ches
 
a
 
URI
 
which
 
’ds
 
š
‡ 
	`¦ash
 ("/"). 
The
 
¥ecŸl
 
m‘hod
 
Çme


224 "deçuÉ" 
may
 
m©ch
 
a
 
pÜtiÚ
 
of
 
the
 
	`·th_šfo
 (
but
 
Úly
 
wh’
 
no
 
lÚg”


225 
sub¡ršg
 
of
 
the
 
·th_šfo
 
m©ches
 
some
 
Ùh”
 
objeù
).

227 
This
 
is
 
the
 , 
but
-
š
 
di¥©ch”
 
Ch”ryPy
.

230 
di¥©ch_m‘hod_Çme
 = '_cp_dispatch'

232 
The
 
Çme
 
of
 
the
 
di¥©ch
 
m‘hod
 
th©
 
nodes
 
may
 
İtiÚ®ly
 
im¶em’t


233 
to
 
´ovide
 
theœ
 
own
 
dyÇmic
 
di¥©ch
 
®gÜ™hm
.

236 
def
 
	$__š™__
(
£lf
, 
di¥©ch_m‘hod_Çme
=
NÚe
,

237 
Œª¦©e
=
punùu©iÚ_to_und”scÜes
):

238 
	$v®id©e_Œª¦©Ü
(
Œª¦©e
)

239 
£lf
.
Œª¦©e
 =ranslate

240 
di¥©ch_m‘hod_Çme
:

241 
£lf
.
di¥©ch_m‘hod_Çme
 = dispatch_method_name

243 
def
 
	$__ÿÎ__
(
£lf
, 
·th_šfo
):

245 
»que¡
 = 
ch”rypy
.
£rvšg
.request

246 
func
, 
v·th
 = 
£lf
.
	$fšd_hªdËr
(
·th_šfo
)

248 
func
:

249 #Decod
ªy
 
Ëáov”
 %2F 
š
 
the
 
vœtu®_·th
 
©oms
.

250 
v·th
 = [
x
.
	`»¶aû
("%2F", "/"èx 
š
 vpath]

251 
»que¡
.
hªdËr
 = 
	$L©eP¬amPageHªdËr
(
func
, *
v·th
)

253 
»que¡
.
hªdËr
 = 
ch”rypy
.
	$NÙFound
()

255 
def
 
	$fšd_hªdËr
(
£lf
, 
·th
):

258 
This
 
wl
  
two
 
objeùs
. 
The
 
fœ¡
 wÈ
be
 
a
 
ÿÎabË
,

259 
which
 
ÿn
 
be
 
u£d
 
to
 
g’”©e
 
·ge
 
ouut
. 
Any
 
·¿m‘”s
 
äom


260 
the
 
qu”y
 
¡ršg
 
Ü
 
»que¡
 
body
 
wl
 
be
 
£Á
 
to
 
th©
 
ÿÎabË


261 
as
 
keywÜd
 
¬gum’ts
.

263 
The
 
ÿÎabË
 
is
 
found
 
by
 
Œav”sšg
 
the
 
­¶iÿtiÚ
'sree,

264 
¡¬tšg
 
äom
 
ch”rypy
.
»que¡
.
­p
.
roÙ
, 
ªd
 
m©chšg
 
·th


265 
compÚ’ts
 
to
 
sucûssive
 
objeùs
 
š
 
the
 
Œ“
. 
FÜ
 
exam¶e
,he

266 
URL
 "/·th/to/hªdËr" 
might
  
roÙ
.
·th
.
to
.
hªdËr
.

268 
The
 
£cÚd
 
objeù
 
»tuºed
 
wl
 
be
 
a
 
li¡
 
of
 
Çmes
 
which
 
¬e


269 'vœtu®…©h' 
compÚ’ts
: 
·¹s
 
of
 
the
 
URL
 
which
 
¬e
 
dyÇmic
,

270 
ªd
 
w”e
 
nÙ
 
u£d
 
wh’
 
lookšg
 
up
 
the
 
hªdËr
.

271 
The£
 
vœtu®
 
·th
 
compÚ’ts
 
¬e
 
·s£d
 
to
 
the
 
hªdËr
 
as


272 
pos™iÚ®
 
¬gum’ts
.

274 
»que¡
 = 
ch”rypy
.
£rvšg
.request

275 
­p
 = 
»que¡
.app

276 
roÙ
 = 
­p
.root

277 
di¥©ch_Çme
 = 
£lf
.
di¥©ch_m‘hod_Çme


279 #G‘ 
cÚfig
 
the
 
roÙ
 
objeù
/
·th
.

280 
fuÎ·th
 = [
x
 x 
š
 
·th
.
	`¡r
('/').
	`¥l™
('/') x] + ['index']

281 
fuÎ·th_Ën
 = 
	$Ën
(
fuÎ·th
)

282 
£gËá
 = 
fuÎ·th_Ën


283 
nodecÚf
 = {
	}
}

284 
ha§‰r
(
roÙ
, "_cp_config"):

285 
nodecÚf
.
	$upd©e
(
roÙ
.
_ı_cÚfig
)

286 "/" 
š
 
­p
.
cÚfig
:

287 
nodecÚf
.
	`upd©e
(
­p
.
cÚfig
["/"])

288 
objeù_Œa
 = [['roÙ', 
roÙ
, 
nodecÚf
, 
£gËá
]]

290 
node
 = 
roÙ


291 
™”Çmes
 = 
fuÎ·th
[:]

292 
™”Çmes
:

293 
Çme
 = 
™”Çmes
[0]

294 #m­ 
to
 
Ëg®
 
PythÚ
 
	`id’tif›rs
 (
e
.
g
. 
»¶aû
 '.' 
w™h
 '_')

295 
objÇme
 = 
Çme
.
	$Œª¦©e
(
£lf
.
Œª¦©e
)

297 
nodecÚf
 = {
	}
}

298 
subnode
 = 
	$g‘©Œ
(
node
, 
objÇme
, 
NÚe
)

299 
´e_Ën
 = 
	$Ën
(
™”Çmes
)

300 
subnode
 
is
 
NÚe
:

301 
di¥©ch
 = 
	$g‘©Œ
(
node
, 
di¥©ch_Çme
, 
NÚe
)

302 
di¥©ch
 
ªd
 
	`ha§‰r
(di¥©ch, '__ÿÎ__'èªd 
nÙ
 \

303 
	`g‘©Œ
(
di¥©ch
, 'expo£d', 
F®£
è
ªd
 \

304 
´e_Ën
 > 1:

305 #DÚ'ˆexpo£hhidd’ '
šdex
'okeno _cp_dispatch

306 #W
sk
 
this
 
´e_Ën
 =ğ1 
sšû
 
™
 
makes
 
no
 
£n£


307 #tØ
ÿÎ
 
a
 
di¥©ch”
 
wh’
 
we
 
have
 
no
 
tok’s
 
Ëá
.

308 
šdex_Çme
 = 
™”Çmes
.
	$pİ
()

309 
subnode
 = 
	$di¥©ch
(
v·th
=
™”Çmes
)

310 
™”Çmes
.
	$­³nd
(
šdex_Çme
)

312 #W
didn
't find‡…ath, but keep…rocessing in casehere

313 #i 
a
 (è
hªdËr
.

314 
™”Çmes
.
	$pİ
(0)

316 #W
found
 
the
 
·th
, 
»move
h
v·th
 
’Œy


317 
™”Çmes
.
	$pİ
(0)

318 
£gËá
 = 
	$Ën
(
™”Çmes
)

319 
£gËá
 > 
´e_Ën
:

320 #NØ
·th
 
£gm’t
 
was
 
»moved
. 
Rai£
 
ª
 
”rÜ
.

321 
¿i£
 
ch”rypy
.
	`Ch”ryPyExû±iÚ
(

324 + "{0} iÀ{1}".
	$fÜm©
(
Çme
, 
fuÎ·th
)

326 
–if
 
£gËá
 =ğ
´e_Ën
:

327 #Assum
th©
 
the
 
hªdËr
 
u£d
h
cu¼’t
 
·th
 
£gm’t
, 
but


328 #did 
nÙ
 
pİ
 
™
. 
This
 
®lows
 
thšgs
 
like


329 #»tuº 
	`g‘©Œ
(
£lf
, 
v·th
[0], 
NÚe
)

330 
™”Çmes
.
	$pİ
(0)

331 
£gËá
 -= 1

332 
node
 = 
subnode


334 
node
 
is
 
nÙ
 
NÚe
:

335 #G‘ 
_ı_cÚfig
 
©ched
 
to
 
this
 
node
.

336 
	`ha§‰r
(
node
, "_cp_config"):

337 
nodecÚf
.
	$upd©e
(
node
.
_ı_cÚfig
)

339 #Mix 
š
 
v®ues
 
äom
 
­p
.
cÚfig
 
this
 
·th
.

340 
exi¡šg_Ën
 = 
fuÎ·th_Ën
 - 
´e_Ën


341 
exi¡šg_Ën
 != 0:

342 
cu½©h
 = '/' + '/'.
	`još
(
fuÎ·th
[0:
exi¡šg_Ën
])

344 
cu½©h
 = ''

345 
Ãw_£gs
 = 
fuÎ·th
[
fuÎ·th_Ën
 - 
´e_Ën
:fuÎ·th_ËÀ- 
£gËá
]

346 
£g
 
š
 
Ãw_£gs
:

347 
cu½©h
 +ğ'/' + 
£g


348 
cu½©h
 
š
 
­p
.
cÚfig
:

349 
nodecÚf
.
	$upd©e
(
­p
.
cÚfig
[
cu½©h
])

351 
objeù_Œa
.
	$­³nd
([
Çme
, 
node
, 
nodecÚf
, 
£gËá
])

353 
def
 
	$£t_cÚf
():

355 
ba£
 = 
ch”rypy
.
cÚfig
.
	$cİy
()

356 #NÙ
th©
 
we
 
m”ge
 
the
 
cÚfig
 
äom
 
—ch
 
node


357 #ev’ 
th©
 
node
 
was
 
NÚe
.

358 
Çme
, 
obj
, 
cÚf
, 
£gËá
 
š
 
objeù_Œa
:

359 
ba£
.
	$upd©e
(
cÚf
)

360 'toŞs.¡©icdœ.dœ' 
š
 
cÚf
:

361 
ba£
['toŞs.¡©icdœ.£ùiÚ'] = '/' + '/'.
	`još
(
fuÎ·th
[0:
fuÎ·th_Ën
 - 
£gËá
])

362  
ba£


364 #Try 
sucûssive
 
	`objeùs
 (
»v”£
 
Üd”
)

365 
num_ÿndid©es
 = 
	`Ën
(
objeù_Œa
) - 1

366 
i
 
š
 
	`¿nge
(
num_ÿndid©es
, -1, -1):

368 
Çme
, 
ÿndid©e
, 
nodecÚf
, 
£gËá
 = 
objeù_Œa
[
i
]

369 
ÿndid©e
 
is
 
NÚe
:

372 #Try 
a
 "deçuÉ" 
m‘hod
 
Ú
 
the
 
cu¼’t
 
Ëaf
.

373 
	`ha§‰r
(
ÿndid©e
, "default"):

374 
defhªdËr
 = 
ÿndid©e
.

375 
	`g‘©Œ
(
defhªdËr
, 'expo£d', 
F®£
):

376 #In£¹ 
ªy
 
exŒa
 
_ı_cÚfig
 
äom
 
the
  
hªdËr
.

377 
cÚf
 = 
	`g‘©Œ
(
defhªdËr
, "_ı_cÚfig", {
	}
})

378 
	gobjeù_Œa
.
š£¹
(
i
+1, ["deçuÉ", 
defhªdËr
, 
cÚf
, 
£gËá
])

379 
	g»que¡
.
	gcÚfig
 = 
	$£t_cÚf
()

380 #S“ 
h‰p
:

381 
»que¡
.
is_šdex
 = 
·th
.
	`’dsw™h
("/")

382  
defhªdËr
, 
fuÎ·th
[
fuÎ·th_Ën
 - 
£gËá
:-1]

384 #Uncomm’ˆ
the
 
Ãxt
 
lše
 
to
 
»¡riù
 
pos™iÚ®
 
·¿ms
o "default".

385 #ià
i
 < 
num_ÿndid©es
 - 2: 

387 #Try 
the
 
cu¼’t
 
Ëaf
.

388 
	`g‘©Œ
(
ÿndid©e
, 'expo£d', 
F®£
):

389 
»que¡
.
cÚfig
 = 
	$£t_cÚf
()

390 
i
 =ğ
num_ÿndid©es
:

391 #W
found
 
the
 
exŒa
 ".šdex". 
M¬k
 
»que¡
 
so
 
toŞs


392 #ÿÀ
»dœeù
 
·th_šfo
 
has
 
no
 
Œašg
 
¦ash
.

393 
»que¡
.
is_šdex
 = 
True


395 #We'»‚Ù‡ˆª '
šdex
' handler. Mark„equest soools

396 #ÿÀ
»dœeù
 
·th_šfo
 
has
 
NO
 
Œašg
 
¦ash
.

397 #NÙ
th©
 
this
 
®so
 
šşudes
 
hªdËrs
 
which
 
ke


398 #pos™iÚ® 
	`·¿m‘”s
 (
vœtu®
 
·ths
).

399 
»que¡
.
is_šdex
 = 
F®£


400  
ÿndid©e
, 
fuÎ·th
[
fuÎ·th_Ën
 - 
£gËá
:-1]

402 #W
didn
't find‡nything

403 
»que¡
.
cÚfig
 = 
	$£t_cÚf
()

404  
NÚe
, []

407 
şass
 
	$M‘hodDi¥©ch”
(
Di¥©ch”
):

410 
M‘hods
 
Çmed
 
GET
, 
POST
, 
‘c
 
wl
 
be
 
ÿÎed
 
Ú
 
ª
 
expo£d
 
şass
.

411 
The
 
m‘hod
 
Çmes
 
mu¡
 
be
 
®l
 
ÿps
; 
the
 
­´İrŸ‹
 
AÎow
 
h—d”


412 
wl
 
be
 
ouut
 
showšg
 
®l
 
ÿp™®ized
 
m‘hod
 
Çmes
 
as
 
®lowabË


413 
HTTP
 
v”bs
.

415 
NÙe
 
th©
 
the
 
cÚššg
 
şass
 
mu¡
 
be
 
expo£d
, 
nÙ
h
m‘hods
.

418 
def
 
	$__ÿÎ__
(
£lf
, 
·th_šfo
):

420 
»que¡
 = 
ch”rypy
.
£rvšg
.request

421 
»sourû
, 
v·th
 = 
£lf
.
	$fšd_hªdËr
(
·th_šfo
)

423 
»sourû
:

424 #S‘ 
AÎow
 
h—d”


425 
ava
 = [
m
 m 
š
 
	$dœ
(
»sourû
è
m
.
	`isuµ”
()]

426 "GET" 
š
 
ava
 
ªd
 "HEAD" 
nÙ
 in‡vail:

427 
ava
.
	`­³nd
("HEAD")

428 
ava
.
	$sÜt
()

429 
ch”rypy
.
£rvšg
.
»¥Ú£
.
h—d”s
['AÎow'] = ", ".
	$još
(
ava
)

431 #Fšd 
the
 
subhªdËr


432 
m‘h
 = 
»que¡
.
m‘hod
.
	$uµ”
()

433 
func
 = 
	$g‘©Œ
(
»sourû
, 
m‘h
, 
NÚe
)

434 
func
 
is
 
NÚe
 
ªd
 
m‘h
 == "HEAD":

435 
func
 = 
	`g‘©Œ
(
»sourû
, "GET", 
NÚe
)

436 
func
:

437 #G¿b 
ªy
 
_ı_cÚfig
 
Ú
 
the
 
subhªdËr
.

438 
	`ha§‰r
(
func
, "_cp_config"):

439 
»que¡
.
cÚfig
.
	$upd©e
(
func
.
_ı_cÚfig
)

441 #Decod
ªy
 
Ëáov”
 %2F 
š
 
the
 
vœtu®_·th
 
©oms
.

442 
v·th
 = [
x
.
	`»¶aû
("%2F", "/"èx 
š
 vpath]

443 
»que¡
.
hªdËr
 = 
	$L©eP¬amPageHªdËr
(
func
, *
v·th
)

445 
»que¡
.
hªdËr
 = 
ch”rypy
.
	$HTTPE¼Ü
(405)

447 
»que¡
.
hªdËr
 = 
ch”rypy
.
	$NÙFound
()

450 
şass
 
	$Rou‹sDi¥©ch”
(
objeù
):

453 
def
 
	$__š™__
(
£lf
, 
fuÎ_»suÉ
=
F®£
):

455 
Rou‹s
 
di¥©ch”


457 
S‘
 
fuÎ_»suÉ
 
to
 
True
 
you
 
wish
 
the
 
cÚŒŞËr


458 
ªd
 
the
 
aùiÚ
 
to
 
be
 
·s£d
 
Ú
Øth
·ge
 
hªdËr


459 
·¿m‘”s
. 
By
  
they
 
wÚ
't be.

461 
impÜt
 
rou‹s


462 
£lf
.
fuÎ_»suÉ
 = full_result

463 
£lf
.
cÚŒŞËrs
 = {
	}
}

464 
£lf
.
m­³r
 = 
rou‹s
.
	$M­³r
()

465 
£lf
.
m­³r
.
cÚŒŞËr_sÿn
 = s–f.
cÚŒŞËrs
.
keys


467 
def
 
	$cÚÃù
(
£lf
, 
Çme
, 
rou‹
, 
cÚŒŞËr
, **
kw¬gs
):

468 
£lf
.
cÚŒŞËrs
[
Çme
] = 
cÚŒŞËr


469 
£lf
.
m­³r
.
	$cÚÃù
(
Çme
, 
rou‹
, 
cÚŒŞËr
òame, **
kw¬gs
)

471 
def
 
	$»dœeù
(
£lf
, 
u¾
):

472 
¿i£
 
ch”rypy
.
	$HTTPRedœeù
(
u¾
)

474 
def
 
	$__ÿÎ__
(
£lf
, 
·th_šfo
):

476 
func
 = 
£lf
.
	$fšd_hªdËr
(
·th_šfo
)

477 
func
:

478 
ch”rypy
.
£rvšg
.
»que¡
.
hªdËr
 = 
	$L©eP¬amPageHªdËr
(
func
)

480 
ch”rypy
.
£rvšg
.
»que¡
.
hªdËr
 = ch”rypy.
	$NÙFound
()

482 
def
 
	$fšd_hªdËr
(
£lf
, 
·th_šfo
):

484 
impÜt
 
rou‹s


486 
»que¡
 = 
ch”rypy
.
£rvšg
.request

488 
cÚfig
 = 
rou‹s
.
	$»que¡_cÚfig
()

489 
cÚfig
.
m­³r
 = 
£lf
.mapper

490 
	`ha§‰r
(
»que¡
, 'wsgi_environ'):

491 
cÚfig
.
’vœÚ
 = 
»que¡
.
wsgi_’vœÚ


492 
cÚfig
.
ho¡
 = 
»que¡
.
h—d”s
.
	`g‘
('Ho¡', 
NÚe
)

493 
cÚfig
.
´ÙocŞ
 = 
»que¡
.
scheme


494 
cÚfig
.
»dœeù
 = 
£lf
.redirect

496 
»suÉ
 = 
£lf
.
m­³r
.
	$m©ch
(
·th_šfo
)

498 
cÚfig
.
m­³r_diù
 = 
»suÉ


499 
·¿ms
 = {
	}
}

500 
»suÉ
:

501 
·¿ms
 = 
»suÉ
.
	$cİy
()

502 
nÙ
 
£lf
.
fuÎ_»suÉ
:

503 
·¿ms
.
	`pİ
('cÚŒŞËr', 
NÚe
)

504 
·¿ms
.
	`pİ
('aùiÚ', 
NÚe
)

505 
»que¡
.
·¿ms
.
	$upd©e
(
·¿ms
)

507 #G‘ 
cÚfig
 
the
 
roÙ
 
objeù
/
·th
.

508 
»que¡
.
cÚfig
 = 
ba£
 = 
ch”rypy
.cÚfig.
	$cİy
()

509 
cu½©h
 = ""

511 
def
 
	$m”ge
(
nodecÚf
):

512 'toŞs.¡©icdœ.dœ' 
š
 
nodecÚf
:

513 
nodecÚf
['toŞs.¡©icdœ.£ùiÚ'] = 
cu½©h
 
Ü
 "/"

514 
ba£
.
	$upd©e
(
nodecÚf
)

516 
­p
 = 
»que¡
.app

517 
roÙ
 = 
­p
.root

518 
	`ha§‰r
(
roÙ
, "_cp_config"):

519 
	$m”ge
(
roÙ
.
_ı_cÚfig
)

520 "/" 
š
 
­p
.
cÚfig
:

521 
	`m”ge
(
­p
.
cÚfig
["/"])

523 #Mix 
š
 
v®ues
 
äom
 
­p
.
cÚfig
.

524 
©oms
 = [
x
 x 
š
 
·th_šfo
.
	`¥l™
("/") x]

525 
©oms
:

526 
Ï¡
 = 
©oms
.
	$pİ
()

528 
Ï¡
 = 
NÚe


529 
©om
 
š
 
©oms
:

530 
cu½©h
 = "/".
	`još
((cu½©h, 
©om
))

531 
cu½©h
 
š
 
­p
.
cÚfig
:

532 
	$m”ge
(
­p
.
cÚfig
[
cu½©h
])

534 
hªdËr
 = 
NÚe


535 
»suÉ
:

536 
cÚŒŞËr
 = 
»suÉ
.
	`g‘
('controller')

537 
cÚŒŞËr
 = 
£lf
.
cÚŒŞËrs
.
	$g‘
(
cÚŒŞËr
, controller)

538 
cÚŒŞËr
:

539 
	$isš¡ªû
(
cÚŒŞËr
, 
şas¡y³
):

540 
cÚŒŞËr
 = 
	$cÚŒŞËr
()

541 #G‘ 
cÚfig
 
äom
 
the
 
cÚŒŞËr
.

542 
	`ha§‰r
(
cÚŒŞËr
, "_cp_config"):

543 
	$m”ge
(
cÚŒŞËr
.
_ı_cÚfig
)

545 
aùiÚ
 = 
»suÉ
.
	`g‘
('action')

546 
aùiÚ
 
is
 
nÙ
 
NÚe
:

547 
hªdËr
 = 
	$g‘©Œ
(
cÚŒŞËr
, 
aùiÚ
, 
NÚe
)

548 #G‘ 
cÚfig
 
äom
 
the
 
hªdËr


549 
	`ha§‰r
(
hªdËr
, "_cp_config"):

550 
	$m”ge
(
hªdËr
.
_ı_cÚfig
)

552 
hªdËr
 = 
cÚŒŞËr


554 #DØ
the
 
Ï¡
 
·th
 
©om
 
h”e
 
so
 
™
 
ÿn


555 #ov”rid
the
 
cÚŒŞËr
's _cp_config.

556 
Ï¡
:

557 
cu½©h
 = "/".
	`još
((cu½©h, 
Ï¡
))

558 
cu½©h
 
š
 
­p
.
cÚfig
:

559 
	$m”ge
(
­p
.
cÚfig
[
cu½©h
])

561  
hªdËr


564 
def
 
	`XMLRPCDi¥©ch”
(
Ãxt_di¥©ch”
=
	$Di¥©ch”
()):

565 
äom
 
ch”rypy
.
lib
 
impÜt
 
xmÌpcut


566 
def
 
	$xmÌpc_di¥©ch
(
·th_šfo
):

567 
·th_šfo
 = 
xmÌpcut
.
	$·tched_·th
(
·th_šfo
)

568  
	$Ãxt_di¥©ch”
(
·th_šfo
)

569  
xmÌpc_di¥©ch


572 
def
 
	`Vœtu®Ho¡
(
Ãxt_di¥©ch”
=
	`Di¥©ch”
(), 
u£_x_fÜw¬ded_ho¡
=
True
, **
domašs
):

574 
S–eù
 
a
 
difã»Á
 
hªdËr
 
ba£d
 
Ú
 
the
 
Ho¡
 
h—d”
.

576 
This
 
ÿn
 
be
 
u£ful
 
wh’
 
ruÂšg
 
muÉË
 
s™es
 
w™hš
 
Úe
 
CP
 
£rv”
.

577 
It
 
®lows
 
£v”®
 
domašs
 
to
 
pošt
Ø
difã»Á
 
·¹s
 
of
 
a
 
sšgË


578 
webs™e
 
¡ruùu»
. 
FÜ
 
exam¶e
::

580 
h‰p
:

581 
h‰p
:

582 
h‰p
:

584 
ÿn
 
be
 
accom¶ished
 
vŸ
 
the
 
fŞlowšg
 
cÚfig
::

587 
»que¡
.
di¥©ch
 = 
ch”rypy
.di¥©ch.
	`Vœtu®Ho¡
(

590 
	}
})

592 
Ãxt_di¥©ch”


593 
The
 
Ãxt
 
di¥©ch”
 
objeù
 
š
 
the
 
di¥©ch
 
chaš
.

594 
The
 
Vœtu®Ho¡
 
di¥©ch”
 
adds
 
a
 
´efix
 
to
 
the
 
URL
 
ªd
 
ÿÎs


595 
ªÙh”
 
di¥©ch”
. 
DeçuÉs
 
to
 
ch”rypy
.
di¥©ch
.
Di¥©ch”
().

597 
u£_x_fÜw¬ded_ho¡


598 
If
 
True
 (
the
 ), 
	gªy
 "X-Forwarded-Host"

599 
»que¡
 
h—d”
 
wl
 
be
 
u£d
 
š¡—d
 
of
 
	gthe
 "Ho¡" 
	gh—d”
. 
This


600 
is
 
commÚly
 
added
 
by
 
HTTP
 
	$£rv”s
 (
such
 
as
 
A·che
è
wh’
 
´oxyšg
.

602 ``**
domašs
``

603 
A
 
diù
 
of
 {
ho¡
 
h—d”
 
v®ue
: 
vœtu®
 
´efix
}…aœs.

604 
The
 
šcomšg
 "Ho¡" 
»que¡
 
h—d”
 
is
 
looked
 
up
 
š
 
this
 
diù
,

605 
	gªd
, 
a
 
m©ch
 
is
 
	gfound
, 
the
 
	gcÜ»¥Údšg
 "virtual…refix"

606 
v®ue
 
wl
 
be
 
´•’ded
 
to
 
the
 
URL
 
·th
 
befÜe
 
ÿÎšg
he

607 
Ãxt
 
	gdi¥©ch”
. 
NÙe
 
th©
 
you
 
oá’
 
Ãed
 
£·¿‹
 
’Œ›s


608 "exam¶e.com" 
	gªd
 "www.exam¶e.com". 
In
 
	gadd™iÚ
, "Host"

609 
h—d”s
 
may
 
cÚš
 
the
 
pÜt
 
	gnumb”
.

611 
äom
 
	gch”rypy
.
lib
 
impÜt
 
h‰put


612 
def
 
	$vho¡_di¥©ch
(
·th_šfo
):

613 
»que¡
 = 
ch”rypy
.
£rvšg
.request

614 
h—d”
 = 
»que¡
.
h—d”s
.
g‘


616 
domaš
 = 
	`h—d”
('Host', '')

617 
u£_x_fÜw¬ded_ho¡
:

618 
domaš
 = 
	`h—d”
("X-Forwarded-Host", domain)

620 
´efix
 = 
domašs
.
	`g‘
(
domaš
, "")

621 
´efix
:

622 
·th_šfo
 = 
h‰put
.
	$u¾još
(
´efix
, 
·th_šfo
)

624 
»suÉ
 = 
	$Ãxt_di¥©ch”
(
·th_šfo
)

626 #Touch 
up
 
¡©icdœ
 
cÚfig
. 
S“
 
h‰p
:

627 
£ùiÚ
 = 
»que¡
.
cÚfig
.
	`g‘
('tools.staticdir.section')

628 
£ùiÚ
:

629 
£ùiÚ
 = seùiÚ[
	$Ën
(
´efix
):]

630 
»que¡
.
cÚfig
['toŞs.¡©icdœ.£ùiÚ'] = 
£ùiÚ


632  
»suÉ


633  
vho¡_di¥©ch


	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/_cperror.py

3 
Ch”ryPy
 
	$´ovides
 (
ªd
 
u£s
è
exû±iÚs
 
deş¬šg
 
th©
 
the
 
HTTP
 
»¥Ú£


4 
should
 
be
 
a
 
¡©us
 
Ùh”
 
thª
 
the
  "200 OK". 
You
 
ÿn
 ``
¿i£
`` 
them
 
like


5 
nÜm®
 
PythÚ
 
exû±iÚs
. 
You
 
ÿn
 
®so
 
ÿÎ
 
them
 
ªd
 
they
 
wl
 
¿i£
 
them£lves
;

6 
this
 
m—ns
 
you
 
ÿn
 
£t
 
ª
 :
şass
:`
HTTPE¼Ü
<
ch”rypy
.
_ı”rÜ
.HTTPError>`

7 
Ü
 :
şass
:`
HTTPRedœeù
<
ch”rypy
.
_ı”rÜ
.HTTPRedœeù>` 
as
 
the


8 :
©Œ
:`
»que¡
.
hªdËr
<
ch”rypy
.
_ı»que¡
.
Reque¡
.handler>`.

10 .. 
_»dœeùšgpo¡
:

12 
Redœeùšg
 
POST


15 
Wh’
 
you
 
GET
 
a
 
»sourû
 
ªd
 
¬e
 
»dœeùed
 
by
 
the
 
£rv”
 
to
 
ªÙh”
 
LoÿtiÚ
,

16 
th”e
's generally‚o…roblem since GET is both‡ "safe method" (there should

17 
be
 
no
 
side
-
efãùs
è
ªd
 
ª
 "idempÙ’ˆm‘hod" (
muÉË
 
ÿÎs
 
¬e
‚Ø
difã»Á


18 
thª
 
a
 
sšgË
 
ÿÎ
).

20 
POST
, 
howev”
, 
is
 
Ã™h”
 
§ã
 
nÜ
 
idempÙ’t
--
you


21 
ch¬ge
 
a
 
üed™
 
ÿrd
, 
you
 
dÚ
't wanto be chargedwice by‡„edirect!

23 
FÜ
 
this
 
»asÚ
, *
nÚe
* 
of
 
the
 3xx 
»¥Ú£s
 
³rm™
 
a
 
u£r
-
	$ag’t
 (
brow£r
è
to


24 
»subm™
 
a
 
POST
 
Ú
 
»dœeùiÚ
 
w™hout
 
fœ¡
 
cÚfœmšg
 
the
 
aùiÚ
 
w™h
h
u£r
:

27 300 
MuÉË
 
Choiûs
 
CÚfœm
 
w™h
 
the
 
u£r


28 301 
Moved
 
P”mª’y
 
CÚfœm
 
w™h
 
the
 
u£r


29 302 
	$Found
 (
Objeù
 
moved
 
‹mpÜ¬y
è
CÚfœm
 
w™h
 
the
 
u£r


30 303 
S“
 
Oth”
 
GET
 
the
 
Ãw
 
URI
--
no
 
cÚfœm©iÚ


31 304 
NÙ
 
	`modif›d
 (
cÚd™iÚ®
 
GET
 
Úly
--
POST
 
should
 
nÙ
 
¿i£
 
this
 
”rÜ
)

32 305 
U£
 
Proxy
 
CÚfœm
 
w™h
 
the
 
u£r


33 307 
TempÜ¬y
 
Redœeù
 
CÚfœm
 
w™h
 
the
 
u£r


36 
Howev”
, 
brow£rs
 
have
 
hi¡ÜiÿÎy
 
im¶em’‹d
 
the£
 
»¡riùiÚs
 
poÜly
;

37 
š
 
·¹icuÏr
, 
mªy
 
brow£rs
 dØ
nÙ
 
fÜû
 
the
 
u£r
 
to
 
cÚfœm
 301, 302

38 
Ü
 307 
wh’
 
»dœeùšg
 
POST
. 
FÜ
 
this
 
»asÚ
, 
Ch”ryPy
 
deçuÉs
 
to
 303,

39 
which
 
mo¡
 
u£r
-
ag’ts
 
­³¬
 
to
 
have
 
im¶em’‹d
 
cÜ»ùly
. 
Th”efÜe
, 

40 
you
 
¿i£
 
HTTPRedœeù
 
a
 
POST
 
»que¡
, 
the
 
u£r
-
ag’t
 
wl
 
mo¡
 
lik–y


41 
©‹m±
 
to
 
GET
 
the
 
Ãw
 
	`URI
 (
w™hout
 
askšg
 
cÚfœm©iÚ
 
äom
h
u£r
).

42 
We
 
»®ize
 
this
 
is
 
cÚfusšg
 
dev–İ”s
, 
but
 
™
'she safesthing we

43 
could
 do. 
You
 
¬e
 
of
 
cour£
 
ä“
 
to
 
¿i£
 ``
	`HTTPRedœeù
(
uri
, 
¡©us
=302)``

44 
Ü
 
ªy
 
Ùh”
 3xx 
¡©us
 
you
 
know
 
wh©
 you're doing, but givenhe

45 
’vœÚm’t
, 
we
 
couldn
't†et‡ny ofhose behe default.

47 
Cu¡om
 
E¼Ü
 
Hªdlšg


50 .. 
image
:: /
»fmª
/
ı”rÜs
.
gif


52 
AÁic©ed
 
HTTP
 
»¥Ú£s


55 
The
 '”rÜ_·ge' 
cÚfig
 
Çme¥aû
 
ÿn
 
be
 
u£d
 
to
 
´ovide
 
cu¡om
 
HTML
 
ouut
 

56 
ex³ùed
 
	`»¥Ú£s
 (
like
 404 
NÙ
 
Found
). 
Suµly
 
a
 
f’ame
 
äom
 
which
 
the
 
ouut


57 
wl
 
be
 
»ad
. 
The
 
cÚ‹Ás
 wÈb
š‹½Ş©ed
 
w™h
 
the
 
v®ues
 %(
¡©us
)
s
,

58 %(
mes§ge
)
s
, %(
Œaûback
)s, 
ªd
 %(
v”siÚ
) 
usšg
 
¶aš
 
Şd
 
PythÚ


59 `
¡ršg
 
fÜm©tšg
 <
h‰p
:

63 
_ı_cÚfig
 = {'”rÜ_·ge.404': 
os
.
·th
.
	`još
(
loÿlDœ
, "¡©ic/šdex.html")
	}
}

66 
Begšnšg
 
š
 
v”siÚ
 3.1, 
you
 
may
 
®so
 
´ovide
 
a
 
funùiÚ
 
Ü
 
Ùh”
 
ÿÎabË
 
as


67 
ª
 
”rÜ_·ge
 
	g’Œy
. 
It
 
wl
 
be
 
·s£d
 
the
 
§me
 
	g¡©us
, 
	gmes§ge
, 
Œaûback
 
ªd


68 
v”siÚ
 
¬gum’ts
 
th©
 
¬e
 
š‹½Ş©ed
 
što
 
	g‹m¶©es
::

70 
def
 
	$”rÜ_·ge_402
(
¡©us
, 
mes§ge
, 
Œaûback
, 
v”siÚ
):

71  "E¼Ü % - W–l, I'm v”y sÜry buˆyou hav’'ˆ·id!" % 
¡©us


72 
ch”rypy
.
cÚfig
.
	`upd©e
({'”rÜ_·ge.402': 
”rÜ_·ge_402
})

74 
Also
 
š
 3.1, iÀ
add™iÚ
 
to
 
the
 
numb”ed
 
”rÜ
 
	gcodes
, 
you
 
may
 
®so
 
	gsuµly


75 "”rÜ_·ge.deçuÉ" 
to
 
hªdË
 
®l
 
codes
 
which
 dØ
nÙ
 
have
 
theœ
 
own
 
”rÜ_·ge
 
	g’Œy
.

79 
UÇÁic©ed
 
	g”rÜs


82 
Ch”ryPy
 
®so
 
has
 
a
 
g’”ic
 
”rÜ
 
hªdlšg
 
	gmechªism
: 
wh’ev”
 
ª
 
uÇÁic©ed


83 
”rÜ
 
occurs
 
š
 
your
 
code
, 
™
 
wl
 
	gÿÎ


84 :
func
:`
Reque¡
.
”rÜ_»¥Ú£
<
ch”rypy
.
_ı»que¡
.Reque¡.”rÜ_»¥Ú£>` 
to
 
£t


85 
the
 
»¥Ú£
 
¡©us
, 
	gh—d”s
, 
ªd
 
	gbody
. 
By
 , 
this
 
is
h
§me
 
ouut
 
	gas


86 :
şass
:`
HTTPE¼Ü
(500è<
ch”rypy
.
_ı”rÜ
.HTTPE¼Ü>`. 
If
 
you
 
wªt
 
to
 
´ovide


87 
some
 
Ùh”
 
behaviÜ
, 
you
 
g’”®ly
 
	g»¶aû
 "request.error_response".

89 
H”e
 
is
 
some
 
§m¶e
 
code
 
th©
 
shows
 
how
 
to
 
di¥Ïy
 
a
 
cu¡om
 
”rÜ
 
mes§ge
 
ªd


90 
£nd
 
ª
 
	ge
-
ma
 
cÚššg
 
the
 
	g”rÜ
::

92 
äom
 
ch”rypy
 
impÜt
 
_ı”rÜ


94 
def
 
	$hªdË_”rÜ
():

95 
ch”rypy
.
»¥Ú£
.
¡©us
 = 500

96 
ch”rypy
.
»¥Ú£
.
body
 = ["<html><body>Sorry,‡nƒrror occured</body></html>"]

97 
	`£ndMa
('”rÜ@domaš.com', 'E¼Ü iÀyou¸web‡µ', 
_ı”rÜ
.
	$fÜm©_exc
())

99 
şass
 
RoÙ
:

100 
_ı_cÚfig
 = {'»que¡.”rÜ_»¥Ú£': 
hªdË_”rÜ
}

103 
NÙe
 
th©
 
you
 
have
 
to
 
ex¶ic™ly
 
£t
 :
©Œ
:`
»¥Ú£
.
body
 <
ch”rypy
.
_ı»que¡
.
Re¥Ú£
.body>`

104 
ªd
 
nÙ
 
sim¶y
  
ª
 
”rÜ
 
mes§ge
 
as
 
a
 
»suÉ
.

107 
äom
 
cgi
 
impÜt
 
esÿ³
 
as
 
_esÿ³


108 
äom
 
sys
 
impÜt
 
exc_šfo
 
as
 
_exc_šfo


109 
äom
 
Œaûback
 
impÜt
 
fÜm©_exû±iÚ
 
as
 
_fÜm©_exû±iÚ


110 
äom
 
ch”rypy
.
_ıcom·t
 
impÜt
 
ba£¡ršg
, 
	gby‹¡r
, 
	g™”™ems
, 
	gÁob
, 
	gtÚ©ive
, 
u¾još
 
as
 
_u¾još


111 
äom
 
	gch”rypy
.
lib
 
impÜt
 
h‰put
 
as
 
_h‰put


114 
şass
 
	$Ch”ryPyExû±iÚ
(
Exû±iÚ
):

116 
·ss


119 
şass
 
	$TimeoutE¼Ü
(
Ch”ryPyExû±iÚ
):

121 
·ss


124 
şass
 
	$IÁ”ÇlRedœeù
(
Ch”ryPyExû±iÚ
):

127 
This
 
exû±iÚ
 
wl
 
»dœeù
 
´oûssšg
 
to
 
ªÙh”
 
·th
 
w™hš
 
the
 
s™e


128 (
w™hout
 
šfÜmšg
 
the
 
ş›Á
). 
Provide
h
Ãw
 
·th
 
as
 
ª
 
¬gum’t
 
wh’


129 
¿isšg
 
the
 
exû±iÚ
. 
Provide
 
ªy
 
·¿ms
 
š
h
qu”y¡ršg
 th
Ãw
 
URL
.

132 
def
 
	`__š™__
(
£lf
, 
·th
, 
qu”y_¡ršg
=""):

133 
impÜt
 
ch”rypy


134 
£lf
.
»que¡
 = 
ch”rypy
.
£rvšg
.request

136 
£lf
.
qu”y_¡ršg
 = query_string

137 "?" 
š
 
·th
:

138 #S•¬©
ªy
 
·¿ms
 
šşuded
 
š
 
the
 
·th


139 
·th
, 
£lf
.
qu”y_¡ršg
 =…©h.
	`¥l™
("?", 1)

141 #NÙ
th©
 
u¾još
 
wl
 "dØthrighˆthšg" 
wh‘h”
 
u¾
 
is
:

142 #1. 
a
 
URL
 
»Ïtive
 
to
 
	`roÙ
 (
e
.
g
. "/dummy")

143 #2. 
a
 
URL
 
»Ïtive
 
to
 
the
 
cu¼’t
 
·th


144 #NÙ
th©
 
ªy
 
qu”y
 
¡ršg
 
wl
 
be
 
disÿrded
.

145 
·th
 = 
	$_u¾još
(
£lf
.
»que¡
.
·th_šfo
, 
·th
)

147 #S‘ 
a
 '·th' 
memb”
 
©Œibu‹
 
so
 
th©
 
code
 
which
 
Œ­s
 
this


148 #”rÜ 
ÿn
 
have
 
acûss
 
to
 
™
.

149 
£lf
.
·th
 =…ath

151 
Ch”ryPyExû±iÚ
.
	$__š™__
(
£lf
, 
·th
, s–f.
qu”y_¡ršg
)

154 
şass
 
	$HTTPRedœeù
(
Ch”ryPyExû±iÚ
):

157 
This
 
exû±iÚ
 
wl
 
fÜû
 
a
 
HTTP
 
»dœeù
 
to
 
the
 
URL
 
Ü
 URL's you give it.

158 
The
 
Ãw
 
URL
 
mu¡
 
be
 
·s£d
 
as
 
the
 
fœ¡
 
¬gum’t
 
to
h
Exû±iÚ
,

159 
e
.
g
., 
	`HTTPRedœeù
(
ÃwU¾
). 
MuÉË
 
URLs
 
¬e
 
®lowed
 
š
 
a
 
li¡
.

160 
If
 
a
 
URL
 
is
 
absŞu‹
, 
™
 
wl
 
be
 
u£d
 
as
-is. Ià™ i 
»Ïtive
, it is

161 
assumed
 
to
 
be
 
»Ïtive
Ø
the
 
cu¼’t
 
ch”rypy
.
»que¡
.
·th_šfo
.

163 
If
 
Úe
 
of
 
the
 
´ovided
 
URL
 
is
 
a
 
unicode
 
objeù
, 
™
 
wl
 
be
 
’coded


164 
usšg
 
the
  
’codšg
 
Ü
h
Úe
 
·s£d
 
š
 
·¿m‘”
.

166 
Th”e
 
¬e
 
muÉË
 
ty³s
 
of
 
»dœeù
, 
äom
 
which
 
you
 
ÿn
 
£Ëù
 
vŸ
 
the


167 ``
¡©us
`` 
¬gum’t
. 
If
 
you
 dØ
nÙ
 
´ovide
 
a
 ``¡©us`` 
¬g
, 
™
 
deçuÉs
 
to


168 303 (
Ü
 302 
»¥Údšg
 
w™h
 
HTTP
/1.0).

170 
Exam¶es
::

172 
¿i£
 
ch”rypy
.
	`HTTPRedœeù
("")

173 
¿i£
 
ch”rypy
.
	`HTTPRedœeù
("/abs/path", 307)

174 
¿i£
 
ch”rypy
.
	`HTTPRedœeù
(["path1", "path2?a=1&b=2"], 301)

176 
S“
 :
»f
:`
»dœeùšgpo¡
` 
add™iÚ®
 
ÿv—ts
.

179 
¡©us
 = 
NÚe


182 
u¾s
 = 
NÚe


185 
’codšg
 = 'utf-8'

188 
def
 
	$__š™__
(
£lf
, 
u¾s
, 
¡©us
=
NÚe
, 
’codšg
=None):

189 
impÜt
 
ch”rypy


190 
»que¡
 = 
ch”rypy
.
£rvšg
.request

192 
	$isš¡ªû
(
u¾s
, 
ba£¡ršg
):

193 
u¾s
 = [urls]

195 
abs_u¾s
 = []

196 
u¾
 
š
 
u¾s
:

197 
u¾
 = 
	$tÚ©ive
(
u¾
, 
’codšg
 
Ü
 
£lf
.encoding)

199 #NÙ
th©
 
u¾još
 
wl
 "dØthrighˆthšg" 
wh‘h”
 
u¾
 
is
:

200 #1. 
a
 
com¶‘e
 
URL
 
w™h
 
	`ho¡
 (
e
.
g
. "http://www.example.com/test")

201 #2. 
a
 
URL
 
»Ïtive
 
to
 
	`roÙ
 (
e
.
g
. "/dummy")

202 #3. 
a
 
URL
 
»Ïtive
 
to
 
the
 
cu¼’t
 
·th


203 #NÙ
th©
 
ªy
 
qu”y
 
¡ršg
 
š
 
ch”rypy
.
»que¡
 
is
 
disÿrded
.

204 
u¾
 = 
	`_u¾još
(
ch”rypy
.
	`u¾
(), url)

205 
abs_u¾s
.
	$­³nd
(
u¾
)

206 
£lf
.
u¾s
 = 
abs_u¾s


208 #RFC 2616 
šdiÿ‹s
 
a
 301 
»¥Ú£
 
code
 
f™s
 
our
 
gßl
; 
howev”
,

209 #brow£¸
suµÜt
 301 
is
 
qu™e
 
messy
. 
Do
 302/303 
š¡—d
. 
S“


211 
¡©us
 
is
 
NÚe
:

212 
»que¡
.
´ÙocŞ
 >= (1, 1):

213 
¡©us
 = 303

215 
¡©us
 = 302

217 
¡©us
 = (status)

218 
¡©us
 < 300 
Ü
 status > 399:

219 
¿i£
 
	`V®ueE¼Ü
("status must be between 300‡nd 399.")

221 
£lf
.
¡©us
 = status

222 
Ch”ryPyExû±iÚ
.
	$__š™__
(
£lf
, 
abs_u¾s
, 
¡©us
)

224 
def
 
	$£t_»¥Ú£
(
£lf
):

227 
Ch”ryPy
 
u£s
 
this
 
š‹º®ly
, 
but
 
you
 
ÿn
 
®so
 
u£
 
™
 
to
 
ü—‹
 
ª


228 
HTTPRedœeù
 
objeù
 
ªd
 
£t
 
™s
 
ouut
 
w™hout
 *
¿isšg
* 
the
 
exû±iÚ
.

230 
impÜt
 
ch”rypy


231 
»¥Ú£
 = 
ch”rypy
.
£rvšg
.response

232 
»¥Ú£
.
¡©us
 = stu ğ
£lf
.status

234 
¡©us
 
	$š
 (300, 301, 302, 303, 307):

235 
»¥Ú£
.
h—d”s
['Content-Type'] = "text/html;charset=utf-8"

236 #"
The
 ... 
URI
 
SHOULD
 
be
 
giv’
 
by
 
the
 
LoÿtiÚ
 
f›ld


237 #š 
the
 
»¥Ú£
."

238 
»¥Ú£
.
h—d”s
['LoÿtiÚ'] = 
£lf
.
u¾s
[0]

240 #"
UÆess
 
the
 
»que¡
 
m‘hod
 
was
 
HEAD
,h
’t™y
 
of
h
»¥Ú£


241 #SHOULD 
cÚš
 
a
 
hy³¹ext
 
nÙe
 
w™h
‡ 
hy³¾šk
 
to
 
the


242 #Ãw 
	`URI
(
s
)."

243 
msg
 = {300: "This„esource can be found‡t <a href='%s'>%s</a>.",

248 
	}
}[
¡©us
]

249 
msgs
 = [
msg
 % (
u
, uèu 
š
 
£lf
.
u¾s
]

250 
	g»¥Ú£
.
	gbody
 = 
Áob
("<b¸/>\n".
još
(
msgs
), 'utf-8')

251 #P»viou 
code
 
may
 
have
 
£t
 
C
-
L
, 
so
 
we
 hav
to
 
»£t
 
™


252 #(
®low
 
fš®ize
 
to
 
£t
 
™
).

253 
	g»¥Ú£
.
	gh—d”s
.
pİ
('CÚ‹Á-L’gth', 
NÚe
)

254 
–if
 
	g¡©us
 == 304:

255 #NÙ 
Modif›d
.

256 #"
The
 
»¥Ú£
 
MUST
 
šşude
 
the
 
fŞlowšg
 
h—d”
 
f›lds
:

257 #D©e, 
uÆess
 
™s
 
omissiÚ
 
is
 
»quœed
 
by
 
£ùiÚ
 14.18.1"

258 #Th"D©e" 
h—d”
 
should
 
have
 
b“n
 
£t
 
š
 
Re¥Ú£
.
__š™__


260 #"...
the
 
»¥Ú£
 
SHOULD
 
NOT
 
šşude
 
Ùh”
 
’t™y
-
h—d”s
."

261 
key
 
š
 ('Allow', 'Content-Encoding', 'Content-Language',

265 
key
 
š
 
»¥Ú£
.
h—d”s
:

266 
d–
 
»¥Ú£
.
h—d”s
[
key
]

268 #"
The
 304 
»¥Ú£
 
MUST
 
NOT
 
cÚš
 
a
 
mes§ge
-
body
."

269 
»¥Ú£
.
body
 = 
NÚe


270 #P»viou 
code
 
may
 
have
 
£t
 
C
-
L
, 
so
 
we
 hav
to
 
»£t
 
™
.

271 
	g»¥Ú£
.
	gh—d”s
.
pİ
('CÚ‹Á-L’gth', 
NÚe
)

272 
–if
 
	g¡©us
 == 305:

273 #U£ 
Proxy
.

274 #£lf.
u¾s
[0] 
should
 
be
 
the
 
URI
 
of
h
´oxy
.

275 
»¥Ú£
.
h—d”s
['LoÿtiÚ'] = 
£lf
.
u¾s
[0]

276 
»¥Ú£
.
body
 = 
NÚe


277 #P»viou 
code
 
may
 
have
 
£t
 
C
-
L
, 
so
 
we
 hav
to
 
»£t
 
™
.

278 
	g»¥Ú£
.
	gh—d”s
.
pİ
('CÚ‹Á-L’gth', 
NÚe
)

280 
¿i£
 
V®ueE¼Ü
("Th% ¡©u codi unknown." % 
¡©us
)

282 
def
 
	$__ÿÎ__
(
£lf
):

284 
¿i£
 
£lf


287 
def
 
	$ş—n_h—d”s
(
¡©us
):

289 
impÜt
 
ch”rypy


291 
»¥Ú£
 = 
ch”rypy
.
£rvšg
.response

293 #Remov
h—d”s
 
which
 
­¶›d
 
to
 
the
 
Üigš®
 
cÚ‹Á
,

294 #buˆdØ
nÙ
 
­¶y
 
to
 
the
 
”rÜ
 
·ge
.

295 
»¥h—d”s
 = 
»¥Ú£
.
h—d”s


296 
key
 
š
 ["Accept-Ranges", "Age", "ETag", "Location", "Retry-After",

299 
key
 
š
 
»¥h—d”s
:

300 
d–
 
»¥h—d”s
[
key
]

302 
¡©us
 != 416:

303 #A 
£rv”
 
£ndšg
 
a
 
»¥Ú£
 
w™h
 
¡©us
 
code
 416 (
Reque¡ed


304 #¿ng
nÙ
 
§tisfŸbË
è
SHOULD
 
šşude
 
a
 
CÚ‹Á
-
Rªge
 
f›ld


305 #w™h 
a
 
by‹
-
¿nge
-
»¥
-
¥ec
 
of
 "*". 
The
 
š¡ªû
-
Ëngth


306 #¥ecif› 
the
 
cu¼’t
 
Ëngth
 
of
h
£Ëùed
 
»sourû
.

307 #A 
»¥Ú£
 
w™h
 
¡©us
 
code
 206 (
P¬tŸl
 
CÚ‹Á
è
MUST
 
NOT


308 #šşud
a
 
CÚ‹Á
-
Rªge
 
f›ld
 
w™h
‡ 
by‹
-
¿nge
- 
»¥
-
¥ec
 
of
 "*".

309 "CÚ‹Á-Rªge" 
š
 
»¥h—d”s
:

310 
d–
 
»¥h—d”s
["Content-Range"]

313 
şass
 
	$HTTPE¼Ü
(
Ch”ryPyExû±iÚ
):

316 
This
 
exû±iÚ
 
ÿn
 
be
 
u£d
 
to
 
autom©iÿÎy
 
£nd
 
a
 
»¥Ú£
 
usšg
‡ 
h‰p
 
¡©us


317 
code
, 
w™h
 
ª
 
­´İrŸ‹
 
”rÜ
 
·ge
. 
It
 
kes
‡À
İtiÚ®


318 ``
¡©us
`` 
	`¬gum’t
 (
which
 
mu¡
 
be
 
b‘w“n
 400 
ªd
 599); 
™
 
deçuÉs
 
to
 500

319 ("IÁ”ÇÈS”v” E¼Ü"). 
It
 
®so
 
kes
 
ª
 
İtiÚ®
 ``
mes§ge
`` 
¬gum’t
,

320 
which
 
wl
 
be
 
»tuºed
 
š
 
the
 
»¥Ú£
 
body
. 
S“


321 `
RFC
 2616 <
h‰p
:

322 
a
 
com¶‘e
 
li¡
 
of
 
avaabË
 
”rÜ
 
codes
 
ªd
 
wh’
 
to
 
u£
 
them
.

324 
Exam¶es
::

326 
¿i£
 
ch”rypy
.
	$HTTPE¼Ü
(403)

327 
¿i£
 
ch”rypy
.
	`HTTPE¼Ü
("403 Forbidden", "You‡re‚ot‡llowedo‡ccesshis„esource.")

330 
¡©us
 = 
NÚe


333 
code
 = 
NÚe


336 
»asÚ
 = 
NÚe


339 
def
 
	$__š™__
(
£lf
, 
¡©us
=500, 
mes§ge
=
NÚe
):

340 
£lf
.
¡©us
 = status

341 
Œy
:

342 
£lf
.
code
, s–f.
»asÚ
, 
deçuÉmsg
 = 
_h‰put
.
	$v®id_¡©us
(
¡©us
)

343 
exû±
 
V®ueE¼Ü
:

344 
¿i£
 
£lf
.
	`__şass__
(500, 
	`_exc_šfo
()[1].
¬gs
[0])

346 
£lf
.
code
 < 400 
Ü
 self.code > 599:

347 
¿i£
 
	`V®ueE¼Ü
("status must be between 400‡nd 599.")

349 #S“ 
h‰p
:

350 #£lf.
mes§ge
 = message

351 
£lf
.
_mes§ge
 = 
mes§ge
 
Ü
 
deçuÉmsg


352 
Ch”ryPyExû±iÚ
.
	$__š™__
(
£lf
, 
¡©us
, 
mes§ge
)

354 
def
 
	$£t_»¥Ú£
(
£lf
):

357 
Ch”ryPy
 
u£s
 
this
 
š‹º®ly
, 
but
 
you
 
ÿn
 
®so
 
u£
 
™
 
to
 
ü—‹
 
ª


358 
HTTPE¼Ü
 
objeù
 
ªd
 
£t
 
™s
 
ouut
 
w™hout
 *
¿isšg
* 
the
 
exû±iÚ
.

360 
impÜt
 
ch”rypy


362 
»¥Ú£
 = 
ch”rypy
.
£rvšg
.response

364 
	$ş—n_h—d”s
(
£lf
.
code
)

366 #IÀ
®l
 
ÿ£s
, 
fš®ize
 
wl
 
be
 
ÿÎed
 
aá”
 
this
 
m‘hod
,

367 #sØ
dÚ
't bother cleaning up„esponse values here.

368 
»¥Ú£
.
¡©us
 = 
£lf
.status

369 
tb
 = 
NÚe


370 
ch”rypy
.
£rvšg
.
»que¡
.
show_Œaûbacks
:

371 
tb
 = 
	$fÜm©_exc
()

372 
»¥Ú£
.
h—d”s
['Content-Type'] = "text/html;charset=utf-8"

373 
»¥Ú£
.
h—d”s
.
	`pİ
('CÚ‹Á-L’gth', 
NÚe
)

375 
cÚ‹Á
 = 
£lf
.
	`g‘_”rÜ_·ge
(£lf.
¡©us
, 
Œaûback
=
tb
,

376 
mes§ge
=
£lf
.
_mes§ge
).
	`’code
('utf-8')

377 
»¥Ú£
.
body
 = 
cÚ‹Á


379 
	$_be_›_unä›ndly
(
£lf
.
code
)

381 
def
 
	$g‘_”rÜ_·ge
(
£lf
, *
¬gs
, **
kw¬gs
):

382  
	$g‘_”rÜ_·ge
(*
¬gs
, **
kw¬gs
)

384 
def
 
	$__ÿÎ__
(
£lf
):

386 
¿i£
 
£lf


389 
şass
 
	$NÙFound
(
HTTPE¼Ü
):

392 
This
 
is
 
equiv®’t
 
to
 
¿isšg


393 :
şass
:`
	`HTTPE¼Ü
("404 NÙ Found"è<
ch”rypy
.
_ı”rÜ
.
HTTPE¼Ü
>`.

396 
def
 
	$__š™__
(
£lf
, 
·th
=
NÚe
):

397 
·th
 
is
 
NÚe
:

398 
impÜt
 
ch”rypy


399 
»que¡
 = 
ch”rypy
.
£rvšg
.request

400 
·th
 = 
»que¡
.
süt_Çme
 +„eque¡.
·th_šfo


401 
£lf
.
¬gs
 = (
·th
,)

402 
HTTPE¼Ü
.
	`__š™__
(
£lf
, 404, "Th·th '%s' wa nÙ found." % 
·th
)

405 
_HTTPE¼ÜTem¶©e
 = '''<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"

407 <
html
>

408 <
h—d
>

409 <
m‘a
 
h‰p
-
equiv
="CÚ‹Á-Ty³" 
cÚ‹Á
="text/html; charset=utf-8"></meta>

410 <
t™Ë
>%(
¡©us
)
s
</title>

411 <
¡yË
 
ty³
="text/css">

413 
m¬gš
-
tİ
: 20
px
;

414 
bÜd”
-
tİ
: 2
px
 
sŞid
 
bÏck
;

415 
fÚt
-
¡yË
: 
™®ic
;

416 
	}
}

419 
	gcŞÜ
: 
»d
;

421 </
	g¡yË
>

422 </
	gh—d
>

423 <
	gbody
>

424 <
	gh2
>%(
	g¡©us
)
	gs
</h2>

425 <
	gp
>%(
	gmes§ge
)
	gs
</p>

426 <
´e
 
	gid
="Œaûback">%(
Œaûback
)
s
</pre>

427 <
div
 
id
="powered_by">

428 <
¥ª
>
Pow”ed
 
by
 <
a
 
h»f
="h‰p://www.ch”rypy.Üg">
Ch”ryPy
 %(
v”siÚ
)
s
</a></span>

429 </
div
>

430 </
body
>

431 </
html
>

434 
def
 
	$g‘_”rÜ_·ge
(
¡©us
, **
kw¬gs
):

437 
¡©us
 
should
 
be
 
ª
 
Ü
 
a
 
¡r
.

438 
kw¬gs
 
wl
 
be
 
š‹½Ş©ed
 
što
 
the
 
·ge
 
‹m¶©e
.

440 
impÜt
 
ch”rypy


442 
Œy
:

443 
code
, 
»asÚ
, 
mes§ge
 = 
_h‰put
.
	$v®id_¡©us
(
¡©us
)

444 
exû±
 
V®ueE¼Ü
:

445 
¿i£
 
ch”rypy
.
	`HTTPE¼Ü
(500, 
	`_exc_šfo
()[1].
¬gs
[0])

447 #W
ÿn
't use setdefault here, because some

448 #ÿÎ” 
£nd
 
NÚe
 
kw¬g
 
v®ues
.

449 
kw¬gs
.
	`g‘
('¡©us'è
is
 
NÚe
:

450 
kw¬gs
['¡©us'] = "% %s" % (
code
, 
»asÚ
)

451 
kw¬gs
.
	`g‘
('mes§ge'è
is
 
NÚe
:

452 
kw¬gs
['mes§ge'] = 
mes§ge


453 
kw¬gs
.
	`g‘
('Œaûback'è
is
 
NÚe
:

454 
kw¬gs
['traceback'] = ''

455 
kw¬gs
.
	`g‘
('v”siÚ'è
is
 
NÚe
:

456 
kw¬gs
['v”siÚ'] = 
ch”rypy
.
__v”siÚ__


458 
k
, 
v
 
š
 
	$™”™ems
(
kw¬gs
):

459 
v
 
is
 
NÚe
:

460 
kw¬gs
[
k
] = ""

462 
kw¬gs
[
k
] = 
	$_esÿ³
(
kw¬gs
[
k
])

464 #U£ 
a
 
cu¡om
 
‹m¶©e
 
Ü
 
ÿÎabË
 
the
 
”rÜ
 
·ge
?

465 
·ges
 = 
ch”rypy
.
£rvšg
.
»que¡
.
”rÜ_·ge


466 
”rÜ_·ge
 = 
·ges
.
	$g‘
(
code
è
Ü
 
·ges
.
	`g‘
('default')

467 
”rÜ_·ge
:

468 
Œy
:

469 
	`ha§‰r
(
”rÜ_·ge
, '__call__'):

470  
	$”rÜ_·ge
(**
kw¬gs
)

472 
d©a
 = 
	`İ’
(
”rÜ_·ge
, 'rb').
	$»ad
()

473  
	`tÚ©ive
(
d©a
è% 
kw¬gs


474 
exû±
:

475 
e
 = 
	`_fÜm©_exû±iÚ
(*
	`_exc_šfo
())[-1]

476 
m
 = 
kw¬gs
['message']

477 
m
:

478 
m
 += "<br />"

479 
m
 +ğ"IÀadd™iÚ,hcu¡omƒ¼Ü…agçed:\n<b¸/>%s" % 
e


480 
kw¬gs
['mes§ge'] = 
m


482  
_HTTPE¼ÜTem¶©e
 % 
kw¬gs


485 
_›_ä›ndly_”rÜ_sizes
 = {

489 
	}
}

492 
def
 
	$_be_›_unä›ndly
(
¡©us
):

493 
impÜt
 
ch”rypy


494 
»¥Ú£
 = 
ch”rypy
.
£rvšg
.response

496 #FÜ 
some
 
¡©u£s
, 
IÁ”Ãt
 
Ex¶Ü”
 5+ 
shows
 "friendlyƒrror

498 #thª 
a
 
giv’
 
size
. 
Fix
 
this
 
by
 
»tuºšg
‡ 
body
 
ov”
 
th©
 size

499 #(
by
 
addšg
 
wh™e¥aû
).

500 #S“ 
h‰p
:

501 
s
 = 
_›_ä›ndly_”rÜ_sizes
.
	$g‘
(
¡©us
, 0)

502 
s
:

503 
s
 += 1

504 #Sšû 
we
 
¬e
 
issušg
 
ª
 
HTTP
 
”rÜ
 
¡©us
, w
assume
 
th©


505 #th
’t™y
 
is
 , 
ªd
 
we
 
should
 
ju¡
 
cŞÏp£
 
™
.

506 
cÚ‹Á
 = 
»¥Ú£
.
	$cŞÏp£_body
()

507 
l
 = 
	$Ën
(
cÚ‹Á
)

508 
l
 
ªd
† < 
s
:

509 #IN 
ADDITION
: 
the
 
»¥Ú£
 
mu¡
 
be
 
wr™‹n
 
to
 
IE


510 #š 
Úe
 
chunk
 
Ü
 
™
 
wl
 
¡l
 
g‘
 
»¶aûd
! 
Bah
.

511 
cÚ‹Á
 = cÚ‹Á + (
	`Áob
(" "è* (
s
 - 
l
))

512 
»¥Ú£
.
body
 = 
cÚ‹Á


513 
»¥Ú£
.
h—d”s
['CÚ‹Á-L’gth'] = 
	`¡r
(
	$Ën
(
cÚ‹Á
))

516 
def
 
	$fÜm©_exc
(
exc
=
NÚe
):

518 
Œy
:

519 
exc
 
is
 
NÚe
:

520 
exc
 = 
	$_exc_šfo
()

521 
exc
 =ğ(
NÚe
, None, None):

523 
impÜt
 
Œaûback


524  "".
	`još
(
Œaûback
.
	$fÜm©_exû±iÚ
(*
exc
))

525 
fš®ly
:

526 
d–
 
exc


528 
def
 
	$b¬e_”rÜ
(
exŒabody
=
NÚe
):

531 
R‘uºs
 
a
 
ŒË
 
w™hout
 
ÿÎšg
 
ªy
 
Ùh”
 
que¡iÚabË
 
funùiÚs
,

532 
so
 
™
 
should
 
be
 
as
 
”rÜ
-
ä“
‡ 
possibË
. 
C®l
 iˆ
äom
 
ª
 
HTTP
 
£rv”


533 
you
 
g‘
 
”rÜs
 
outside
 
of
 
the
 
»que¡
.

535 
If
 
exŒabody
 
is
 
NÚe
, 
a
 
ä›ndly
 
but
 
¿th”
 
unh–pful
 
”rÜ
 
mes§ge


536 
is
 
£t
 
š
 
the
 
body
. 
If
 
exŒabody
 i 
a
 
¡ršg
, 
™
 
wl
 
be
 
­³nded


537 
as
-
is
 
to
 
the
 
body
.

540 #Th
whŞe
 
pošt
 
of
 
this
 
funùiÚ
 
is
 
to
 
be
 
a
 
Ï¡
 
lše
-of-
deãn£


541 #š 
hªdlšg
 
”rÜs
. 
Th©
 
is
, 
™
 
mu¡
 
nÙ
 
¿i£
 
ªy
ƒ¼Ü 
™£lf
;

542 #™ 
ÿÂÙ
 
be
 
®lowed
 
to
 
ç
. 
Th”efÜe
, 
dÚ
't‡ddo it!

543 #IÀ
·¹icuÏr
, 
dÚ
't call‡ny other CP functions.

545 
body
 = 
	`Áob
("Unrecoverableƒrror inhe server.")

546 
exŒabody
 
is
 
nÙ
 
NÚe
:

547 
nÙ
 
	$isš¡ªû
(
exŒabody
, 
by‹¡r
):

548 
exŒabody
 =ƒxŒabody.
	`’code
('utf-8')

549 
body
 +ğ
	`Áob
("\n"è+ 
exŒabody


551  (
	`Áob
("500 Internal Server Error"),

552 [(
	`Áob
('Content-Type'),‚tob('text/plain')),

553 (
	`Áob
('CÚ‹Á-L’gth'),‚tob(
	`¡r
(
	`Ën
(
body
)),'ISO-8859-1'))],

554 [
body
])

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/_cplogging.py

2 
Sim¶e
 
	gcÚfig


5 
AÉhough
 
Ch”ryPy
 
u£s
 
the
 :
mod
:`
PythÚ
 
loggšg
 
moduË
 <loggšg>`, 
™
 
dÛs
 
so


6 
behšd
 
the
 
sûÃs
 
so
 
th©
 
sim¶e
 
loggšg
 
is
 
	gsim¶e
, 
but
 
com¶iÿ‹d
†ogging

7 
is
 
¡l
 
	gpossibË
. "Sim¶e" 
loggšg
 
m—ns
 
th©
 
you
 
ÿn
 
log
 
to
 
the
 
	gsü“n


8 (
	gi
.
	ge
. 
	gcÚsŞe
/
	g¡dout
è
Ü
 
to
 
a
 
	gfe
, 
ªd
 
th©
 
you
 
ÿn
 
—sy
 
have
 
£·¿‹


9 
”rÜ
 
ªd
 
acûss
 
log
 
	gfes
.

11 
H”e
 
¬e
 
the
 
sim¶if›d
 
loggšg
 
	g£‰šgs
. 
You
 
u£
 
the£
 
by
 
addšg
 
lšes
 
to


12 
your
 
cÚfig
 
fe
 
Ü
 
	gdiù
. 
You
 
should
 
£t
 
the£
 
©
 
e™h”
 
the
 
glob®
 
Ëv–
 or

13 
³r
 
­¶iÿtiÚ
 (
£e
 
Ãxt
), 
but
 
g’”®ly
 
nÙ
 
	gbÙh
.

15 * ``
	glog
.
	gsü“n
``: 
S‘
 
this
 
to
 
True
Ø
have
 
bÙh
 "”rÜ" 
ªd
 "acûss" 
mes§ges


16 
´š‹d
 
to
 
¡dout
.

17 * ``
log
.
acûss_fe
``: 
S‘
 
this
 
to
 
ª
 
absŞu‹
 
f’ame
 
wh”e
 
you
 
wªt


18 "acûss" 
mes§ges
 
wr™‹n
.

19 * ``
log
.
”rÜ_fe
``: 
S‘
 
this
 
to
 
ª
 
absŞu‹
 
f’ame
 
wh”e
 
you
 
wªt
 "error"

20 
mes§ges
 
wr™‹n
.

22 
Mªy
 
ev’ts
 
¬e
 
autom©iÿÎy
 
logged
; 
to
 
log
 
your
 
own
 
­¶iÿtiÚ
 
	gev’ts
, 
	gÿÎ


23 :
func
:`
ch”rypy
.
log
`.

25 
Arch™eùu»


28 
S•¬©e
 
scİes


31 
Ch”ryPy
 
´ovides
 
log
 
mªag”s
 
©
 
bÙh
 
the
 
glob®
 
ªd
 
­¶iÿtiÚ
 
Ïy”s
.

32 
This
 
m—ns
 
you
 
ÿn
 
have
 
Úe
 
£t
 
of
 
loggšg
 
ruËs
 
your
 
’tœe
 
s™e
,

33 
ªd
 
ªÙh”
 
£t
 
of
 
ruËs
 
¥ecific
 
to
 
—ch
 
	g­¶iÿtiÚ
. 
The
 
glob®
 
log


34 
mªag”
 
is
 
found
 
	g©
 :
func
:`
ch”rypy
.
log
`, 
ªd
 
the
†og mªag” 
—ch


35 
­¶iÿtiÚ
 
is
 
found
 
	g©
 :
©Œ
:`
­p
.
log
<
ch”rypy
.
_ıŒ“
.
AµliÿtiÚ
.log>`.

36 
If
 
you
're inside‡„equest,he†atter is„eachable from

37 ``
ch”rypy
.
»que¡
.
­p
.
log
``; 
	gyou
'» outsid¨»que¡, you'
Î
 
have
 
to
 
obš


38 
a
 
»ã»nû
 
to
 
	gthe
 ``
	g­p
``: 
e™h”
 
the
  
v®ue
 
of


39 :
func
:`
Œ“
.
mouÁ
()<
ch”rypy
.
_ıŒ“
.
T»e
.mouÁ>` 
Ü
, 
you
 
	gu£d


40 :
func
:`
quick¡¬t
()<
ch”rypy
.quick¡¬t>` 
š¡—d
, 
	gvŸ
 ``
	gch”rypy
.
	gŒ“
.
	g­ps
['/']``.

42 
By
 , 
the
 
glob®
 
logs
 
¬e
 
	gÇmed
 "ch”rypy.”rÜ" 
	gªd
 "cherrypy.access",

43 
ªd
 
the
 
­¶iÿtiÚ
 
logs
 
¬e
 
	gÇmed
 "ch”rypy.”rÜ.2378745" 
	gªd


44 "ch”rypy.acûss.2378745" (
the
 
numb”
 
is
h
id
 
of
h
AµliÿtiÚ
 
	gobjeù
).

45 
This
 
m—ns
 
th©
 
the
 
­¶iÿtiÚ
 
	glogs
 "bubbË up" 
to
h
s™e
†ogs, 
so
 
your


46 
­¶iÿtiÚ
 
has
 
no
 
log
 
	ghªdËrs
, 
the
 
	gs™e
-
Ëv–
 
hªdËrs
 
wl
 
¡l
†oghe

47 
	gmes§ges
.

49 
E¼Üs
 
	gvs
. 
	gAcûss


52 
Each
 
log
 
mªag”
 
hªdËs
 
	gbÙh
 "acûss" 
	$mes§ges
 (
Úe
 
³r
 
HTTP
 
»que¡
è
ªd


53 "”rÜ" 
	`mes§ges
 (
ev”ythšg
 ). 
NÙe
 
th©
 
the
 "”rÜ" 
log
 
is
 
nÙ
 
ju¡
 

54 
”rÜs
! 
The
 
fÜm©
 
of
 
acûss
 
mes§ges
 
is
 
highly
 
fÜm®ized
, 
but
 
the
 
”rÜ
 
log


55 
i¢
't--it„eceives messages from‡ variety of sources (including fullƒrror

56 
Œaûbacks
, 
’abËd
).

59 
Cu¡om
 
HªdËrs


62 
The
 
sim¶e
 
£‰šgs
 
above
 
wÜk
 
by
 
mªuÏtšg
 
PythÚ
's standard :mod:`logging`

63 
moduË
. 
So
 
wh’
 
you
 
Ãed
 
som‘hšg
 
mÜe
 
com¶ex
, 
the
 
fuÎ
 
pow”
 
of
h
¡ªd¬d


64 
moduË
 
is
 
yours
 
to
 
ex¶o™
. 
You
 
ÿn
 
bÜrow
 
Ü
 
ü—‹
 
cu¡om
 
hªdËrs
, 
fÜm©s
,

65 
f‹rs
, 
ªd
 
much
 
mÜe
. 
H”e
's‡nƒxamplehat skipshe standard FileHandler

66 
ªd
 
u£s
 
a
 
RÙ©šgFeHªdËr
 
š¡—d
:

71 
log
 = 
­p
.log

73 #Remov
the
  
FeHªdËrs
 
´e£Á
.

74 
log
.
”rÜ_fe
 = ""

75 
log
.
acûss_fe
 = ""

77 
maxBy‹s
 = 
	`g‘©Œ
(
log
, "rot_maxBytes", 10000000)

78 
backupCouÁ
 = 
	`g‘©Œ
(
log
, "rot_backupCount", 1000)

80 #Mak
a
 
Ãw
 
RÙ©šgFeHªdËr
 
the
 
”rÜ
 
log
.

81 
âame
 = 
	`g‘©Œ
(
log
, "rot_error_file", "error.log")

82 
h
 = 
hªdËrs
.
	`RÙ©šgFeHªdËr
(
âame
, 'a', 
maxBy‹s
, 
backupCouÁ
)

83 
h
.
	$£tLev–
(
DEBUG
)

84 
h
.
	$£tFÜm©‹r
(
_ıloggšg
.
logfmt
)

85 
log
.
”rÜ_log
.
	$addHªdËr
(
h
)

87 #Mak
a
 
Ãw
 
RÙ©šgFeHªdËr
 
the
 
acûss
 
log
.

88 
âame
 = 
	`g‘©Œ
(
log
, "rot_access_file", "access.log")

89 
h
 = 
hªdËrs
.
	`RÙ©šgFeHªdËr
(
âame
, 'a', 
maxBy‹s
, 
backupCouÁ
)

90 
h
.
	$£tLev–
(
DEBUG
)

91 
h
.
	$£tFÜm©‹r
(
_ıloggšg
.
logfmt
)

92 
log
.
acûss_log
.
	$addHªdËr
(
h
)

95 
The
 ``
rÙ_
*`` 
©Œibu‹s
 
¬e
 
puÎed
 
¡¿ight
 
äom
 
the
 
­¶iÿtiÚ
 
log
 
objeù
.

96 
Sšû
 "log.*" 
cÚfig
 
’Œ›s
 
sim¶y
 
£t
 
©Œibu‹s
 
Ú
 
the
 
log
 
objeù
, 
you
 
ÿn


97 
add
 
cu¡om
 
©Œibu‹s
 
to
 
your
 
h—¹
's content. Notehathese handlers‡re

98 
u£d
 ''
š¡—d
'' 
of
 
the
 , 
sim¶e
 
hªdËrs
 
oušed
 
	`above
 (
so
 
dÚ
't set

99 
the
 "log.”rÜ_fe" 
cÚfig
 
’Œy
, 
exam¶e
).

102 
impÜt
 
d©‘ime


103 
impÜt
 
loggšg


104 #S’û 
the
 
no
-
hªdËrs
 "w¬nšg" (
¡d”r
 
wr™e
!è
š
 
¡dlib
 
loggšg


105 
loggšg
.
Logg”
.
mªag”
.
em™‹dNoHªdËrW¬nšg
 = 1

106 
logfmt
 = 
loggšg
.
	`FÜm©‹r
("%(message)s")

107 
impÜt
 
os


108 
impÜt
 
sys


110 
impÜt
 
ch”rypy


111 
äom
 
ch”rypy
 
impÜt
 
_ı”rÜ


112 
äom
 
ch”rypy
.
_ıcom·t
 
impÜt
 
Áob
, 
py3k


115 
şass
 
	$NuÎHªdËr
(
loggšg
.
HªdËr
):

118 
def
 
	$hªdË
(
£lf
, 
»cÜd
):

119 
·ss


121 
def
 
	$em™
(
£lf
, 
»cÜd
):

122 
·ss


124 
def
 
	$ü—‹Lock
(
£lf
):

125 
£lf
.
lock
 = 
NÚe


128 
şass
 
	$LogMªag”
(
objeù
):

131 ``
ch”rypy
.
log
`` 
is
 
ª
 
š¡ªû
 
of
 
this
 
şass
.

134 
­pid
 = 
NÚe


136 
is
 
a
 
glob®
 
log
 
mªag”
, 
­pid
 i 
NÚe
."""

138 
”rÜ_log
 = 
NÚe


141 
acûss_log
 = 
NÚe


144 
py3k
:

145 
acûss_log_fÜm©
 = \

148 
acûss_log_fÜm©
 = \

151 
logg”_roÙ
 = 
NÚe


152 """Th"
tİ
-
Ëv–
"†ogger‚ame.

154 
This
 
¡ršg
 
wl
 
be
 
u£d
 
as
 
the
 
fœ¡
 
£gm’t
 
š
h
Logg”
 
Çmes
.

155 
The
  
is
 "ch”rypy", 
exam¶e
, 
š
 
which
 
the
 
Logg”
 
Çmes


156 
wl
 
be
 
of
 
the
 
fÜm
::

158 
ch”rypy
.
”rÜ
.<
­pid
>

159 
ch”rypy
.
acûss
.<
­pid
>

162 
def
 
	`__š™__
(
£lf
, 
­pid
=
NÚe
, 
logg”_roÙ
="cherrypy"):

163 
£lf
.
logg”_roÙ
 =†ogger_root

164 
£lf
.
­pid
 =‡ppid

165 
­pid
 
is
 
NÚe
:

166 
£lf
.
”rÜ_log
 = 
loggšg
.
	`g‘Logg”
("%s.”rÜ" % 
logg”_roÙ
)

167 
£lf
.
acûss_log
 = 
loggšg
.
	`g‘Logg”
("%s.acûss" % 
logg”_roÙ
)

169 
£lf
.
”rÜ_log
 = 
loggšg
.
	`g‘Logg”
("%s.”rÜ.%s" % (
logg”_roÙ
, 
­pid
))

170 
£lf
.
acûss_log
 = 
loggšg
.
	`g‘Logg”
("%s.acûss.%s" % (
logg”_roÙ
, 
­pid
))

171 
£lf
.
”rÜ_log
.
	$£tLev–
(
loggšg
.
INFO
)

172 
£lf
.
acûss_log
.
	$£tLev–
(
loggšg
.
INFO
)

174 #S’û 
the
 
no
-
hªdËrs
 "w¬nšg" (
¡d”r
 
wr™e
!è
š
 
¡dlib
 
loggšg


175 
£lf
.
”rÜ_log
.
	`addHªdËr
(
	$NuÎHªdËr
())

176 
£lf
.
acûss_log
.
	`addHªdËr
(
	$NuÎHªdËr
())

178 
ch”rypy
.
’gše
.
	`subsüibe
('g¿ûful', 
£lf
.
»İ’_fes
)

180 
def
 
	$»İ’_fes
(
£lf
):

182 
log
 
	$š
 (
£lf
.
”rÜ_log
, s–f.
acûss_log
):

183 
h
 
š
 
log
.
hªdËrs
:

184 
	$isš¡ªû
(
h
, 
loggšg
.
FeHªdËr
):

185 
h
.
	$acquœe
()

186 
h
.
¡»am
.
	$şo£
()

187 
h
.
¡»am
 = 
	$İ’
(
h
.
ba£F’ame
, h.
mode
)

188 
h
.
	$»Ëa£
()

190 
def
 
	`”rÜ
(
£lf
, 
msg
='', 
cÚ‹xt
='', 
£v”™y
=
loggšg
.
INFO
, 
Œaûback
=
F®£
):

193 
This
 
is
 
nÙ
 
ju¡
 
”rÜs
! 
AµliÿtiÚs
 
may
 
ÿÎ
 
this
 
©
 
ªy
 
time


194 
to
 
log
 
­¶iÿtiÚ
-
¥ecific
 
šfÜm©iÚ
.

196 
If
 ``
Œaûback
`` 
is
 
True
, 
the
¿ûback 
of
h
cu¼’t
 
exû±iÚ


197 (
ªy
è
wl
 
be
 
­³nded
 
to
 ``
msg
``.

199 
Œaûback
:

200 
msg
 +ğ
_ı”rÜ
.
	$fÜm©_exc
()

201 
£lf
.
”rÜ_log
.
	`log
(
£v”™y
, ' '.
	`još
((£lf.
	`time
(), 
cÚ‹xt
, 
msg
)))

203 
def
 
	$__ÿÎ__
(
£lf
, *
¬gs
, **
kw¬gs
):

205  
£lf
.
	$”rÜ
(*
¬gs
, **
kw¬gs
)

207 
def
 
	$acûss
(
£lf
):

210 
S“
 
h‰p
:

211 
d‘as
.

213 
Ch”ryPy
 
ÿÎs
 
this
 
autom©iÿÎy
 
you
. 
NÙe
 
th”e
 
¬e
 
no
 
¬gum’ts
;

214 
™
 
cŞËùs
 
the
 
d©a
 
™£lf
 
äom


215 :
şass
:`
ch”rypy
.
»que¡
<ch”rypy.
_ı»que¡
.
Reque¡
>`.

217 
Like
 
A·che
 
¡¬‹d
 
došg
 
š
 2.0.46, 
nÚ
-
´šbË
 
ªd
 
Ùh”
 
¥ecŸl


218 
ch¬aù”s
 
š
 %
	$r
 (
ªd
 
we
 
ex·nd
 
th©
 
to
 
®l
 
·¹s
è
¬e
 
esÿ³d
 
usšg


219 \\
xhh
 
£qu’ûs
, 
wh”e
 
hh
 
¡ªds
 
the
 
hexadecim®
 
»´e£Á©iÚ


220 
of
 
the
 
¿w
 
by‹
. 
Exû±iÚs
 
äom
 
this
 
ruË
 
¬e
 "‡nd \\, which‡re

221 
esÿ³d
 
by
 
´•’dšg
 
a
 
back¦ash
, 
ªd
 
®l
 
wh™e¥aû
 
ch¬aù”s
,

222 
which
 
¬e
 
wr™‹n
 
š
 
theœ
 
C
-
¡yË
 
	`nÙ©iÚ
 (\\
n
, \\
t
, 
‘c
).

224 
»que¡
 = 
ch”rypy
.
£rvšg
.request

225 
»mÙe
 = 
»que¡
.remote

226 
»¥Ú£
 = 
ch”rypy
.
£rvšg
.response

227 
outh—d”s
 = 
»¥Ú£
.
h—d”s


228 
šh—d”s
 = 
»que¡
.
h—d”s


229 
»¥Ú£
.
ouut_¡©us
 
is
 
NÚe
:

230 
¡©us
 = "-"

232 
¡©us
 = 
»¥Ú£
.
ouut_¡©us
.
	`¥l™
(
	`Áob
(" "), 1)[0]

233 
py3k
:

234 
¡©us
 = stus.
	`decode
('ISO-8859-1')

236 
©oms
 = {'h': 
»mÙe
.
Çme
 
Ü
„emÙe.

,

238 'u': 
	`g‘©Œ
(
»que¡
, "logš", 
NÚe
è
Ü
 "-",

239 't': 
£lf
.
	`time
(),

240 'r': 
»que¡
.
»que¡_lše
,

241 's': 
¡©us
,

242 'b': 
diù
.
	`g‘
(
outh—d”s
, 'CÚ‹Á-L’gth', ''è
Ü
 "-",

243 'f': 
diù
.
	`g‘
(
šh—d”s
, 'Referer', ''),

244 'a': 
diù
.
	`g‘
(
šh—d”s
, 'User-Agent', ''),

245 
	}
}

246 
py3k
:

247 
k
, 
v
 
š
 
	g©oms
.
	$™ems
():

248 
nÙ
 
	$isš¡ªû
(
v
, 
¡r
):

249 
v
 = 
	$¡r
(
v
)

250 
v
 = v.
	`»¶aû
('"', '\\"').
	`’code
('utf8')

251 #FÜtuÇ‹ly, 
	`»´
(
¡r
è
esÿ³s
 
uÅršbË
 
ch¬s
, \
n
, \
t
, 
‘c


252 #ªd 
back¦ash
 
us
. 
AÎ
 
we
 
have
 
to
 dØ
is
 
¡r
 
the
 
quÙes
.

253 
v
 = 
	`»´
(v)[2:-1]

255 #š 
pythÚ
 3.0 
the
 
»´
 
of
 
	`by‹s
 (
as
 
»tuºed
 
by
 
’code
)

257 #»suÉšg 
š
 
quadru¶e
 
¦ashes
. 
Remove
 
the
 
exŒa
 
Úe
 
h”e
.

258 
v
 = v.
	`»¶aû
('\\\\', '\\')

260 #Esÿ³ -
quÙe
.

261 
©oms
[
k
] = 
v


263 
Œy
:

264 
£lf
.
acûss_log
.
	`log
(
loggšg
.
INFO
, s–f.
acûss_log_fÜm©
.
	$fÜm©
(**
©oms
))

265 
exû±
:

266 
	$£lf
(
Œaûback
=
True
)

268 
k
, 
v
 
š
 
©oms
.
	$™ems
():

269 
	$isš¡ªû
(
v
, 
unicode
):

270 
v
 = v.
	`’code
('utf8')

271 
–if
 
nÙ
 
	$isš¡ªû
(
v
, 
¡r
):

272 
v
 = 
	$¡r
(
v
)

273 #FÜtuÇ‹ly, 
	`»´
(
¡r
è
esÿ³s
 
uÅršbË
 
ch¬s
, \
n
, \
t
, 
‘c


274 #ªd 
back¦ash
 
us
. 
AÎ
 
we
 
have
 
to
 dØ
is
 
¡r
 
the
 
quÙes
.

275 
v
 = 
	`»´
(v)[1:-1]

276 #Esÿ³ -
quÙe
.

277 
©oms
[
k
] = 
v
.
	`»¶aû
('"', '\\"')

279 
Œy
:

280 
£lf
.
acûss_log
.
	`log
(
loggšg
.
INFO
, s–f.
acûss_log_fÜm©
 % 
©oms
)

281 
exû±
:

282 
	$£lf
(
Œaûback
=
True
)

284 
def
 
	$time
(
£lf
):

286 
now
 = 
d©‘ime
.d©‘ime.
	$now
()

287 
mÚthÇmes
 = ['jan', 'feb', 'mar', 'apr', 'may', 'jun',

289 
mÚth
 = 
mÚthÇmes
[
now
.mÚth - 1].
	$ÿp™®ize
()

291 (
now
.
day
, 
mÚth
,‚ow.
y—r
,‚ow.
hour
,‚ow.
mšu‹
,‚ow.
£cÚd
))

293 
def
 
	$_g‘_butš_hªdËr
(
£lf
, 
log
, 
key
):

294 
h
 
š
 
log
.
hªdËrs
:

295 
	`g‘©Œ
(
h
, "_ıbutš", 
NÚe
è=ğ
key
:

296  
h


299 #------------------------- 
Sü“n
 
hªdËrs
 ------------------------- #


300 
def
 
	$_£t_sü“n_hªdËr
(
£lf
, 
log
, 
’abË
, 
¡»am
=
NÚe
):

301 
h
 = 
£lf
.
	`_g‘_butš_hªdËr
(
log
, "screen")

302 
’abË
:

303 
nÙ
 
h
:

304 
¡»am
 
is
 
NÚe
:

305 
¡»am
=
sys
.
¡d”r


306 
h
 = 
loggšg
.
	$SŒ—mHªdËr
(
¡»am
)

307 
h
.
	$£tFÜm©‹r
(
logfmt
)

308 
h
.
_ıbutš
 = "screen"

309 
log
.
	$addHªdËr
(
h
)

310 
–if
 
h
:

311 
log
.
hªdËrs
.
	$»move
(
h
)

313 
def
 
	$_g‘_sü“n
(
£lf
):

314 
h
 = 
£lf
.
_g‘_butš_hªdËr


315 
has_h
 = 
	`h
(
£lf
.
”rÜ_log
, "sü“n"è
Ü
 h(£lf.
acûss_log
, "screen")

316  
	$boŞ
(
has_h
)

318 
def
 
	$_£t_sü“n
(
£lf
, 
Ãwv®ue
):

319 
£lf
.
	$_£t_sü“n_hªdËr
(
£lf
.
”rÜ_log
, 
Ãwv®ue
, 
¡»am
=
sys
.
¡d”r
)

320 
£lf
.
	$_£t_sü“n_hªdËr
(
£lf
.
acûss_log
, 
Ãwv®ue
, 
¡»am
=
sys
.
¡dout
)

321 
sü“n
 = 
	`´İ”ty
(
_g‘_sü“n
, 
_£t_sü“n
,

322 
doc
="""Turn stderr/stdout†ogging on or off.

324 
If
 
you
 
£t
 
this
 
to
 
True
, 
™
'll‡ddhe‡ppropriate StreamHandler for

325 
you
. 
If
 you 
£t
 
™
 
to
 
F®£
, iˆ
wl
 
»move
 
the
 
hªdËr
.

328 #-------------------------- 
Fe
 
hªdËrs
 -------------------------- #


329 
def
 
	$_add_butš_fe_hªdËr
(
£lf
, 
log
, 
âame
):

330 
h
 = 
loggšg
.
	$FeHªdËr
(
âame
)

331 
h
.
	$£tFÜm©‹r
(
logfmt
)

332 
h
.
_ıbutš
 = "file"

333 
log
.
	$addHªdËr
(
h
)

335 
def
 
	$_£t_fe_hªdËr
(
£lf
, 
log
, 
f’ame
):

336 
h
 = 
£lf
.
	`_g‘_butš_hªdËr
(
log
, "file")

337 
f’ame
:

338 
h
:

339 
h
.
ba£F’ame
 !ğ
os
.
·th
.
	$ab¥©h
(
f’ame
):

340 
h
.
	$şo£
()

341 
log
.
hªdËrs
.
	$»move
(
h
)

342 
£lf
.
	$_add_butš_fe_hªdËr
(
log
, 
f’ame
)

344 
£lf
.
	$_add_butš_fe_hªdËr
(
log
, 
f’ame
)

346 
h
:

347 
h
.
	$şo£
()

348 
log
.
hªdËrs
.
	$»move
(
h
)

350 
def
 
	$_g‘_”rÜ_fe
(
£lf
):

351 
h
 = 
£lf
.
	`_g‘_butš_hªdËr
(£lf.
”rÜ_log
, "file")

352 
h
:

353  
h
.
ba£F’ame


355 
def
 
	$_£t_”rÜ_fe
(
£lf
, 
Ãwv®ue
):

356 
£lf
.
	$_£t_fe_hªdËr
(
£lf
.
”rÜ_log
, 
Ãwv®ue
)

357 
”rÜ_fe
 = 
	`´İ”ty
(
_g‘_”rÜ_fe
, 
_£t_”rÜ_fe
,

358 
doc
="""The filename for self.error_log.

360 
If
 
you
 
£t
 
this
 
to
 
a
 
¡ršg
, 
™
'll‡ddhe‡ppropriate FileHandler for

361 
you
. 
If
 you 
£t
 
™
 
to
 ``
NÚe
`` 
Ü
 ``''``, iˆ
wl
 
»move
 
the
 
hªdËr
.

364 
def
 
	$_g‘_acûss_fe
(
£lf
):

365 
h
 = 
£lf
.
	`_g‘_butš_hªdËr
(£lf.
acûss_log
, "file")

366 
h
:

367  
h
.
ba£F’ame


369 
def
 
	$_£t_acûss_fe
(
£lf
, 
Ãwv®ue
):

370 
£lf
.
	$_£t_fe_hªdËr
(
£lf
.
acûss_log
, 
Ãwv®ue
)

371 
acûss_fe
 = 
	`´İ”ty
(
_g‘_acûss_fe
, 
_£t_acûss_fe
,

372 
doc
="""The filename for self.access_log.

374 
If
 
you
 
£t
 
this
 
to
 
a
 
¡ršg
, 
™
'll‡ddhe‡ppropriate FileHandler for

375 
you
. 
If
 you 
£t
 
™
 
to
 ``
NÚe
`` 
Ü
 ``''``, iˆ
wl
 
»move
 
the
 
hªdËr
.

378 #------------------------- 
WSGI
 
hªdËrs
 ------------------------- #


379 
def
 
	$_£t_wsgi_hªdËr
(
£lf
, 
log
, 
’abË
):

380 
h
 = 
£lf
.
	`_g‘_butš_hªdËr
(
log
, "wsgi")

381 
’abË
:

382 
nÙ
 
h
:

383 
h
 = 
	$WSGIE¼ÜHªdËr
()

384 
h
.
	$£tFÜm©‹r
(
logfmt
)

385 
h
.
_ıbutš
 = "wsgi"

386 
log
.
	$addHªdËr
(
h
)

387 
–if
 
h
:

388 
log
.
hªdËrs
.
	$»move
(
h
)

390 
def
 
	$_g‘_wsgi
(
£lf
):

391  
	`boŞ
(
£lf
.
	`_g‘_butš_hªdËr
(£lf.
”rÜ_log
, "wsgi"))

393 
def
 
	$_£t_wsgi
(
£lf
, 
Ãwv®ue
):

394 
£lf
.
	$_£t_wsgi_hªdËr
(
£lf
.
”rÜ_log
, 
Ãwv®ue
)

395 
wsgi
 = 
	`´İ”ty
(
_g‘_wsgi
, 
_£t_wsgi
,

396 
doc
="""Writeƒrrorso wsgi.errors.

398 
If
 
you
 
£t
 
this
 
to
 
True
, 
™
'll‡ddhe‡ppropriate

399 :
şass
:`
WSGIE¼ÜHªdËr
<
ch”rypy
.
_ıloggšg
.WSGIE¼ÜHªdËr>` 
you


400 (
which
 
wr™es
 
”rÜs
 
to
 ``
wsgi
.errors``).

401 
If
 
you
 
£t
 
™
 
to
 
F®£
, iˆ
wl
 
»move
 
the
 
hªdËr
.

405 
şass
 
	$WSGIE¼ÜHªdËr
(
loggšg
.
HªdËr
):

408 
def
 
	$æush
(
£lf
):

410 
Œy
:

411 
¡»am
 = 
ch”rypy
.
£rvšg
.
»que¡
.
wsgi_’vœÚ
.
	`g‘
('wsgi.errors')

412 
	$exû±
 (
A‰ribu‹E¼Ü
, 
KeyE¼Ü
):

413 
·ss


415 
¡»am
.
	$æush
()

417 
def
 
	$em™
(
£lf
, 
»cÜd
):

419 
Œy
:

420 
¡»am
 = 
ch”rypy
.
£rvšg
.
»que¡
.
wsgi_’vœÚ
.
	`g‘
('wsgi.errors')

421 
	$exû±
 (
A‰ribu‹E¼Ü
, 
KeyE¼Ü
):

422 
·ss


424 
Œy
:

425 
msg
 = 
£lf
.
	$fÜm©
(
»cÜd
)

426 
fs
 = "%s\n"

427 
impÜt
 
ty³s


428 
nÙ
 
	`ha§‰r
(
ty³s
, "UnicodeTy³"): #ià
no
 
unicode
 
suµÜt
...

429 
¡»am
.
	`wr™e
(
fs
 % 
msg
)

431 
Œy
:

432 
¡»am
.
	`wr™e
(
fs
 % 
msg
)

433 
exû±
 
UnicodeE¼Ü
:

434 
¡»am
.
	`wr™e
(
fs
 % 
msg
.
	`’code
("UTF-8"))

435 
£lf
.
	$æush
()

436 
exû±
:

437 
£lf
.
	`hªdËE¼Ü
(
»cÜd
)

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/_cpmodpy.py

3 
Basic
 
	gu§ge
:

6 #AµliÿtiÚ 
š
 
a
 
moduË
 
ÿÎed
 
my­p
.
py


9 
impÜt
 
ch”rypy


11 
şass
 
RoÙ
:

12 @
ch”rypy
.
expo£


13 
def
 
	$šdex
(
£lf
):

17 #W
wl
 
u£
 
this
 
m‘hod
 
äom
 
the
 
mod_pythÚ
 
cÚfigu¿tiÚ


18 #a 
the
 
’Œy
 
pošt
 
to
 
our
 
­¶iÿtiÚ


19 
def
 
	$£tup_£rv”
():

20 
ch”rypy
.
Œ“
.
	`mouÁ
(
	$RoÙ
())

21 
ch”rypy
.
cÚfig
.
	`upd©e
({'environment': 'production',

22 'log.sü“n': 
F®£
,

23 'show_Œaûbacks': 
F®£
})

26 #mod_pythÚ 
£‰šgs
 
­ache2


27 #Thi 
should
 
»side
 
š
 
your
 
h‰pd
.
cÚf


28 #Ü 
a
 
fe
 
th©
 
wl
 
be
 
lßded
 
©


29 #­ach
¡¬tup


33 
Docum’tRoÙ
 "/"

34 
Li¡’
 8080

35 
LßdModuË
 
pythÚ_moduË
 /
u¤
/
lib
/
­ache2
/
moduËs
/
mod_pythÚ
.
so


37 <
LoÿtiÚ
 "/">

38 
PythÚP©h
 "sys.path+['/path/to/my/application']"

39 
S‘HªdËr
 
pythÚ
-
´og¿m


40 
PythÚHªdËr
 
ch”rypy
.
_ımodpy
::
hªdËr


41 
PythÚO±iÚ
 
ch”rypy
.
£tup
 
my­p
::
£tup_£rv”


42 
PythÚDebug
 
On


43 </
LoÿtiÚ
>

46 
The
 
aùu®
 
·th
 
to
 
your
 
mod_pythÚ
.
so
 
is
 
d•’d’t
 
Ú
 your

47 
’vœÚm’t
. 
In
 
this
 
we
 
suµo£
 
a
 
glob®
 
mod_pythÚ


48 
š¡®ÏtiÚ
 
Ú
 
a
 
Lšux
 
di¡ributiÚ
 
such
 
as
 
UbuÁu
.

50 
We
 dØ
£t
 
the
 
PythÚP©h
 
cÚfigu¿tiÚ
 
£‰šg
 
so
 
th©


51 
your
 
­¶iÿtiÚ
 
ÿn
 
be
 
found
 
by
 
äom
 
the
 
u£r
 
ruÂšg


52 
the
 
­ache2
 
š¡ªû
. 
Of
 
cour£
 
your
 
­¶iÿtiÚ


53 
»sides
 
š
 
the
 
glob®
 
s™e
-
·ckage
 
this
 
wÚ
't be‚eeded.

55 
Th’
 
»¡¬t
 
­ache2
 
ªd
 
acûss
 
h‰p
:

58 
impÜt
 
loggšg


59 
impÜt
 
sys


61 
impÜt
 
ch”rypy


62 
äom
 
ch”rypy
.
_ıcom·t
 
impÜt
 
By‹sIO
, 
	gcİy™ems
, 
Áob


63 
äom
 
	gch”rypy
.
_ı”rÜ
 
impÜt
 
	gfÜm©_exc
, 
b¬e_”rÜ


64 
äom
 
	gch”rypy
.
lib
 
impÜt
 
	gh‰put


67 #------------------------------ 
Reque¡
-
hªdlšg


71 
def
 
	$£tup
(
»q
):

72 
äom
 
mod_pythÚ
 
impÜt
 
­ache


74 #RuÀ
ªy
 
£tup
 
funùiÚs
 
defšed
 
by
 
a
 "PythÚO±iÚ ch”rypy.£tup" 
dœeùive
.

75 
İtiÚs
 = 
»q
.
	$g‘_İtiÚs
()

76 'ch”rypy.£tup' 
š
 
İtiÚs
:

77 
funùiÚ
 
š
 
İtiÚs
['ch”rypy.£tup'].
	$¥l™
():

78 
©oms
 = 
funùiÚ
.
	`¥l™
('::', 1)

79 
	`Ën
(
©oms
) == 1:

80 
mod
 = 
	`__impÜt__
(
©oms
[0], 
	`glob®s
(), 
	$loÿls
())

82 
modÇme
, 
âame
 = 
©oms


83 
mod
 = 
	`__impÜt__
(
modÇme
, 
	`glob®s
(), 
	`loÿls
(), [
âame
])

84 
func
 = 
	$g‘©Œ
(
mod
, 
âame
)

85 
	$func
()

87 
ch”rypy
.
cÚfig
.
	`upd©e
({'log.sü“n': 
F®£
,

88 "toŞs.ignÜe_h—d”s.Ú": 
True
,

90 
	}
})

92 
	g’gše
 = 
ch”rypy
.
’gše


93 
ha§‰r
(
’gše
, "signal_handler"):

94 
’gše
.
sigÇl_hªdËr
.
	$unsubsüibe
()

95 
	`ha§‰r
(
’gše
, "console_control_handler"):

96 
’gše
.
cÚsŞe_cÚŒŞ_hªdËr
.
	$unsubsüibe
()

97 
’gše
.
autÜ–ßd
.
	$unsubsüibe
()

98 
ch”rypy
.
£rv”
.
	$unsubsüibe
()

100 
def
 
	$_log
(
msg
, 
Ëv–
):

101 
ÃwËv–
 = 
­ache
.
APLOG_ERR


102 
loggšg
.
DEBUG
 >ğ
Ëv–
:

103 
ÃwËv–
 = 
­ache
.
APLOG_DEBUG


104 
–if
 
loggšg
.
INFO
 >ğ
Ëv–
:

105 
ÃwËv–
 = 
­ache
.
APLOG_INFO


106 
–if
 
loggšg
.
WARNING
 >ğ
Ëv–
:

107 
ÃwËv–
 = 
­ache
.
APLOG_WARNING


108 #OÀ
Wšdows
, 
»q
.
£rv”
 
is
 
»quœed
 
Ü
 
the
 
msg
 
wl
 
vªish
. 
S“


111 
­ache
.
	$log_”rÜ
(
msg
, 
ÃwËv–
, 
»q
.
£rv”
)

112 
’gše
.
	`subsüibe
('log', 
_log
)

114 
’gše
.
	$¡¬t
()

116 
def
 
	$ch”rypy_ş—nup
(
d©a
):

117 
’gše
.
	$ex™
()

118 
Œy
:

119 #­ache.
»gi¡”_ş—nup
 
wa¢
't‡vailable until 3.1.4.

120 
­ache
.
	$»gi¡”_ş—nup
(
ch”rypy_ş—nup
)

121 
exû±
 
A‰ribu‹E¼Ü
:

122 
»q
.
£rv”
.
	$»gi¡”_ş—nup
(
»q
, 
ch”rypy_ş—nup
)

125 
şass
 
_R—dOÆyReque¡
:

126 
expo£
 = ('read', 'readline', 'readlines')

127 
def
 
	$__š™__
(
£lf
, 
»q
):

128 
m‘hod
 
š
 
£lf
.
expo£
:

129 
£lf
.
__diù__
[
m‘hod
] = 
	$g‘©Œ
(
»q
, 
m‘hod
)

132 
»cursive
 = 
F®£


134 
_isS‘Up
 = 
F®£


135 
def
 
	$hªdËr
(
»q
):

136 
äom
 
mod_pythÚ
 
impÜt
 
­ache


137 
Œy
:

138 
glob®
 
_isS‘Up


139 
nÙ
 
_isS‘Up
:

140 
	$£tup
(
»q
)

141 
_isS‘Up
 = 
True


143 #Obš 
a
 
Reque¡
 
objeù
 
äom
 
Ch”ryPy


144 
loÿl
 = 
»q
.
cÚÃùiÚ
.
loÿl_addr


145 
loÿl
 = 
h‰put
.
	`Ho¡
Öoÿl[0],†oÿl[1], 
»q
.
cÚÃùiÚ
.
loÿl_ho¡
 
Ü
 "")

146 
»mÙe
 = 
»q
.
cÚÃùiÚ
.
»mÙe_addr


147 
»mÙe
 = 
h‰put
.
	`Ho¡
ÔemÙe[0],„emÙe[1], 
»q
.
cÚÃùiÚ
.
»mÙe_ho¡
 
Ü
 "")

149 
scheme
 = 
»q
.
·r£d_uri
[0] 
Ü
 'http'

150 
»q
.
	$g‘_basic_auth_pw
()

152 
Œy
:

153 #­ache.
mpm_qu”y
 
Úly
 
beÿme
 
avaabË
 
š
 
mod_pythÚ
 3.1

154 
q
 = 
­ache
.
mpm_qu”y


155 
th»aded
 = 
	$q
(
­ache
.
AP_MPMQ_IS_THREADED
)

156 
fÜked
 = 
	$q
(
­ache
.
AP_MPMQ_IS_FORKED
)

157 
exû±
 
A‰ribu‹E¼Ü
:

158 
bad_v®ue
 = ("You must…rovide‡ PythonOption '%s', "

162 
th»aded
 = 
İtiÚs
.
	`g‘
('muÉ™h»ad', '').
	$low”
()

163 
th»aded
 == 'on':

164 
th»aded
 = 
True


165 
–if
 
th»aded
 == 'off':

166 
th»aded
 = 
F®£


168 
¿i£
 
	`V®ueE¼Ü
(
bad_v®ue
 % "multithread")

170 
fÜked
 = 
İtiÚs
.
	`g‘
('muÉroûss', '').
	$low”
()

171 
fÜked
 == 'on':

172 
fÜked
 = 
True


173 
–if
 
fÜked
 == 'off':

174 
fÜked
 = 
F®£


176 
¿i£
 
	`V®ueE¼Ü
(
bad_v®ue
 % "multiprocess")

178 
¢
 = 
ch”rypy
.
Œ“
.
	`süt_Çme
(
»q
.
uri
 
Ü
 "/")

179 
¢
 
is
 
NÚe
:

180 
	`£nd_»¥Ú£
(
»q
, '404 Not Found', [], '')

182 
­p
 = 
ch”rypy
.
Œ“
.
­ps
[
¢
]

183 
m‘hod
 = 
»q
.method

184 
·th
 = 
»q
.
uri


185 
qs
 = 
»q
.
¬gs
 
Ü
 ""

186 
»q´Ùo
 = 
»q
.
´ÙocŞ


187 
h—d”s
 = 
	$cİy™ems
(
»q
.
h—d”s_š
)

188 
rfe
 = 
	$_R—dOÆyReque¡
(
»q
)

189 
´ev
 = 
NÚe


191 
Œy
:

192 
»dœeùiÚs
 = []

193 
True
:

194 
»que¡
, 
»¥Ú£
 = 
­p
.
	`g‘_£rvšg
(
loÿl
, 
»mÙe
, 
scheme
,

196 
»que¡
.
logš
 = 
»q
.
u£r


197 
»que¡
.
muÉ™h»ad
 = 
	$boŞ
(
th»aded
)

198 
»que¡
.
muÉroûss
 = 
	$boŞ
(
fÜked
)

199 
»que¡
.
­p
 =‡pp

200 
»que¡
.
´ev
 =…rev

202 #RuÀ
the
 
Ch”ryPy
 
Reque¡
 
objeù
 
ªd
 
obš
h
»¥Ú£


203 
Œy
:

204 
»que¡
.
	$run
(
m‘hod
, 
·th
, 
qs
, 
»q´Ùo
, 
h—d”s
, 
rfe
)

206 
exû±
 
ch”rypy
.
IÁ”ÇlRedœeù
:

207 
œ
 = 
sys
.
	`exc_šfo
()[1]

208 
­p
.
	$»Ëa£_£rvšg
()

209 
´ev
 = 
»que¡


211 
nÙ
 
»cursive
:

212 
œ
.
·th
 
š
 
»dœeùiÚs
:

213 
¿i£
 
	`RuÁimeE¼Ü
("InternalRedirector visitedhe "

214 "§mURLwiû: %r" % 
œ
.
·th
)

216 #Add 
the
 *
´evious
* 
·th_šfo
 + 
qs
 
to
 
»dœeùiÚs
.

217 
qs
:

218 
qs
 = "?" + qs

219 
»dœeùiÚs
.
	`­³nd
(
¢
 + 
·th
 + 
qs
)

221 #Mung
’vœÚm’t
 
ªd
 
Œy
 
agaš
.

222 
m‘hod
 = "GET"

223 
·th
 = 
œ
.path

224 
qs
 = 
œ
.
qu”y_¡ršg


225 
rfe
 = 
	$By‹sIO
()

227 
	$£nd_»¥Ú£
(
»q
, 
»¥Ú£
.
ouut_¡©us
,„e¥Ú£.
h—d”_li¡
,

228 
»¥Ú£
.
body
,„e¥Ú£.
¡»am
)

229 
fš®ly
:

230 
­p
.
	$»Ëa£_£rvšg
()

231 
exû±
:

232 
tb
 = 
	$fÜm©_exc
()

233 
ch”rypy
.
	`log
(
tb
, 'MOD_PYTHON', 
£v”™y
=
loggšg
.
ERROR
)

234 
s
, 
h
, 
b
 = 
	$b¬e_”rÜ
()

235 
	$£nd_»¥Ú£
(
»q
, 
s
, 
h
, 
b
)

236  
­ache
.
OK


239 
def
 
	$£nd_»¥Ú£
(
»q
, 
¡©us
, 
h—d”s
, 
body
, 
¡»am
=
F®£
):

240 #S‘ 
»¥Ú£
 
¡©us


241 
»q
.
¡©us
 = (status[:3])

243 #S‘ 
»¥Ú£
 
h—d”s


244 
»q
.
cÚ‹Á_ty³
 = "text/plain"

245 
h—d”
, 
v®ue
 
š
 
h—d”s
:

246 
h—d”
.
	`low”
() == 'content-type':

247 
»q
.
cÚ‹Á_ty³
 = 
v®ue


249 
»q
.
h—d”s_out
.
	$add
(
h—d”
, 
v®ue
)

251 
¡»am
:

252 #Flush 
now
 
so
 
the
 
¡©us
 
ªd
 
h—d”s
 
¬e
 
£Á
 
immedŸ‹ly
.

253 
»q
.
	$æush
()

255 #S‘ 
»¥Ú£
 
body


256 
	$isš¡ªû
(
body
, 
ba£¡ršg
):

257 
»q
.
	$wr™e
(
body
)

259 
£g
 
š
 
body
:

260 
»q
.
	$wr™e
(
£g
)

264 #--------------- 
S¹up
 
toŞs
 
Ch”ryPy
 + 
mod_pythÚ
 --------------- #


266 
impÜt
 
os


267 
impÜt
 
»


268 
Œy
:

269 
impÜt
 
sub´oûss


270 
def
 
	$pİ’
(
fuÎcmd
):

271 
p
 = 
sub´oûss
.
	$Pİ’
(
fuÎcmd
, 
sh–l
=
True
,

272 
¡dout
=
sub´oûss
.
PIPE
, 
¡d”r
=sub´oûss.
STDOUT
,

273 
şo£_fds
=
True
)

274  
p
.
¡dout


275 
exû±
 
ImpÜtE¼Ü
:

276 
def
 
	$pİ’
(
fuÎcmd
):

277 
peš
, 
peout
 = 
os
.
	$pİ’4
(
fuÎcmd
)

278  
peout


281 
def
 
	`»ad_´oûss
(
cmd
, 
¬gs
=""):

282 
fuÎcmd
 = "% %s" % (
cmd
, 
¬gs
)

283 
peout
 = 
	$pİ’
(
fuÎcmd
)

284 
Œy
:

285 
fœ¡lše
 = 
peout
.
	$»adlše
()

286 ià(
»
.
	`£¬ch
(
	`Áob
("ÒÙ„ecognized|NØsuch fe|nÙ found)"), 
fœ¡lše
,

287 
»
.
IGNORECASE
)):

288 
¿i£
 
	`IOE¼Ü
('% mu¡ bÚ you¸sy¡em…©h.' % 
cmd
)

289 
ouut
 = 
fœ¡lše
 + 
peout
.
	$»ad
()

290 
fš®ly
:

291 
peout
.
	$şo£
()

292  
ouut


295 
şass
 
	$ModPythÚS”v”
(
objeù
):

297 
‹m¶©e
 = """

298 #A·che2 
£rv”
 
cÚfigu¿tiÚ
 
fe
 
ruÂšg
 
Ch”ryPy
 
w™h
 
mod_pythÚ
.

300 
Docum’tRoÙ
 "/"

301 
Li¡’
 %(
pÜt
)
s


302 
LßdModuË
 
pythÚ_moduË
 
moduËs
/
mod_pythÚ
.
so


304 <
LoÿtiÚ
 %(
loc
)
s
>

305 
S‘HªdËr
 
pythÚ
-
´og¿m


306 
PythÚHªdËr
 %(
hªdËr
)
s


307 
PythÚDebug
 
On


308 %(
İts
)
s


309 </
LoÿtiÚ
>

312 
def
 
	`__š™__
(
£lf
, 
loc
="/", 
pÜt
=80, 
İts
=
NÚe
, 
­ache_·th
="apache",

313 
hªdËr
="cherrypy._cpmodpy::handler"):

314 
£lf
.
loc
 =†oc

315 
£lf
.
pÜt
 =…ort

316 
£lf
.
İts
 = opts

317 
£lf
.
­ache_·th
 =‡pache_path

318 
£lf
.
hªdËr
 = handler

320 
def
 
	$¡¬t
(
£lf
):

321 
İts
 = "".
	`još
([" PythÚO±iÚ % %s\n" % (
k
, 
v
)

322 
k
, 
v
 
š
 
£lf
.
İts
])

323 
cÚf_d©a
 = 
£lf
.
‹m¶©e
 % {"pÜt": s–f.
pÜt
,

324 "loc": 
£lf
.
loc
,

325 "İts": 
İts
,

326 "hªdËr": 
£lf
.
hªdËr
,

327 
	}
}

329 
mpcÚf
 = 
os
.
·th
.
još
(os.·th.
dœÇme
(
__fe__
), "cpmodpy.conf")

330 
	gf
 = 
İ’
(
mpcÚf
, 'wb')

331 
	gŒy
:

332 
f
.
	$wr™e
(
cÚf_d©a
)

333 
fš®ly
:

334 
f
.
	$şo£
()

336 
»¥Ú£
 = 
	`»ad_´oûss
(
£lf
.
­ache_·th
, "-k s¹ -à%s" % 
mpcÚf
)

337 
£lf
.
»ady
 = 
True


338  
»¥Ú£


340 
def
 
	$¡İ
(
£lf
):

341 
os
.
	`pİ’
("apache -k stop")

342 
£lf
.
»ady
 = 
F®£


	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/_cpnative_server.py

3 
impÜt
 
loggšg


4 
impÜt
 
sys


6 
impÜt
 
ch”rypy


7 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
By‹sIO


8 
äom
 
	gch”rypy
.
_ı”rÜ
 
impÜt
 
	gfÜm©_exc
, 
b¬e_”rÜ


9 
äom
 
	gch”rypy
.
lib
 
impÜt
 
h‰put


10 
äom
 
ch”rypy
 
impÜt
 
wsgi£rv”


13 
şass
 
	$N©iveG©eway
(
wsgi£rv”
.
G©eway
):

15 
»cursive
 = 
F®£


17 
def
 
	$»¥Úd
(
£lf
):

18 
»q
 = 
£lf
.req

19 
Œy
:

20 #Obš 
a
 
Reque¡
 
objeù
 
äom
 
Ch”ryPy


21 
loÿl
 = 
»q
.
£rv”
.
bšd_addr


22 
loÿl
 = 
h‰put
.
	`Ho¡
(local[0],†ocal[1], "")

23 
»mÙe
 = 
»q
.
cÚn
.
»mÙe_addr
,„eq.cÚn.
»mÙe_pÜt


24 
»mÙe
 = 
h‰put
.
	`Ho¡
(remote[0],„emote[1], "")

26 
scheme
 = 
»q
.scheme

27 
¢
 = 
ch”rypy
.
Œ“
.
	`süt_Çme
(
»q
.
uri
 
Ü
 "/")

28 
¢
 
is
 
NÚe
:

29 
£lf
.
	`£nd_»¥Ú£
('404 Not Found', [], [''])

31 
­p
 = 
ch”rypy
.
Œ“
.
­ps
[
¢
]

32 
m‘hod
 = 
»q
.method

33 
·th
 = 
»q
.path

34 
qs
 = 
»q
.q 
Ü
 ""

35 
h—d”s
 = 
»q
.
šh—d”s
.
	$™ems
()

36 
rfe
 = 
»q
.rfile

37 
´ev
 = 
NÚe


39 
Œy
:

40 
»dœeùiÚs
 = []

41 
True
:

42 
»que¡
, 
»¥Ú£
 = 
­p
.
	`g‘_£rvšg
(

43 
loÿl
, 
»mÙe
, 
scheme
, "HTTP/1.1")

44 
»que¡
.
muÉ™h»ad
 = 
True


45 
»que¡
.
muÉroûss
 = 
F®£


46 
»que¡
.
­p
 =‡pp

47 
»que¡
.
´ev
 =…rev

49 #RuÀ
the
 
Ch”ryPy
 
Reque¡
 
objeù
 
ªd
 
obš
h
»¥Ú£


50 
Œy
:

51 
»que¡
.
	$run
(
m‘hod
, 
·th
, 
qs
, 
»q
.
»que¡_´ÙocŞ
, 
h—d”s
, 
rfe
)

53 
exû±
 
ch”rypy
.
IÁ”ÇlRedœeù
:

54 
œ
 = 
sys
.
	`exc_šfo
()[1]

55 
­p
.
	$»Ëa£_£rvšg
()

56 
´ev
 = 
»que¡


58 
nÙ
 
£lf
.
»cursive
:

59 
œ
.
·th
 
š
 
»dœeùiÚs
:

60 
¿i£
 
	`RuÁimeE¼Ü
("InternalRedirector visitedhe "

61 "§mURLwiû: %r" % 
œ
.
·th
)

63 #Add 
the
 *
´evious
* 
·th_šfo
 + 
qs
 
to
 
»dœeùiÚs
.

64 
qs
:

65 
qs
 = "?" + qs

66 
»dœeùiÚs
.
	`­³nd
(
¢
 + 
·th
 + 
qs
)

68 #Mung
’vœÚm’t
 
ªd
 
Œy
 
agaš
.

69 
m‘hod
 = "GET"

70 
·th
 = 
œ
.path

71 
qs
 = 
œ
.
qu”y_¡ršg


72 
rfe
 = 
	$By‹sIO
()

74 
£lf
.
	$£nd_»¥Ú£
(

75 
»¥Ú£
.
ouut_¡©us
,„e¥Ú£.
h—d”_li¡
,

76 
»¥Ú£
.
body
)

77 
fš®ly
:

78 
­p
.
	$»Ëa£_£rvšg
()

79 
exû±
:

80 
tb
 = 
	$fÜm©_exc
()

81 #´šˆ
tb


82 
ch”rypy
.
	`log
(
tb
, 'NATIVE_ADAPTER', 
£v”™y
=
loggšg
.
ERROR
)

83 
s
, 
h
, 
b
 = 
	$b¬e_”rÜ
()

84 
£lf
.
	$£nd_»¥Ú£
(
s
, 
h
, 
b
)

86 
def
 
	$£nd_»¥Ú£
(
£lf
, 
¡©us
, 
h—d”s
, 
body
):

87 
»q
 = 
£lf
.req

89 #S‘ 
»¥Ú£
 
¡©us


90 
»q
.
¡©us
 = 
	`¡r
(¡©u 
Ü
 "500 Server Error")

92 #S‘ 
»¥Ú£
 
h—d”s


93 
h—d”
, 
v®ue
 
š
 
h—d”s
:

94 
»q
.
outh—d”s
.
	`­³nd
((
h—d”
, 
v®ue
))

95 ià(
»q
.
»ady
 
ªd
 
nÙ
„eq.
£Á_h—d”s
):

96 
»q
.
£Á_h—d”s
 = 
True


97 
»q
.
	$£nd_h—d”s
()

99 #S‘ 
»¥Ú£
 
body


100 
£g
 
š
 
body
:

101 
»q
.
	$wr™e
(
£g
)

104 
şass
 
	$CPHTTPS”v”
(
wsgi£rv”
.
HTTPS”v”
):

107 
wsgi£rv”
 
has
 
b“n
 
desigÃd
 
to
 
nÙ
 
»ã»nû
 
Ch”ryPy
 
š
 
ªy
 
way
,

108 
so
 
th©
 
™
 
ÿn
 
be
 
u£d
 
š
 
Ùh”
 
äamewÜks
 
ªd
 
­¶iÿtiÚs
.

109 
Th”efÜe
, 
we
 
w¿p
 
™
 
h”e
, 
so
 w
ÿn
 
­¶y
 
some
 
©Œibu‹s


110 
äom
 
cÚfig
 -> 
ch”rypy
.
£rv”
 -> 
HTTPS”v”
.

113 
def
 
	$__š™__
(
£lf
, 
£rv”_ad­‹r
=
ch”rypy
.
£rv”
):

114 
£lf
.
£rv”_ad­‹r
 = server_adapter

116 
£rv”_Çme
 = (
£lf
.
£rv”_ad­‹r
.
sock‘_ho¡
 
Ü


117 
£lf
.
£rv”_ad­‹r
.
sock‘_fe
 
Ü


118 
NÚe
)

120 
wsgi£rv”
.
HTTPS”v”
.
	$__š™__
(

121 
£lf
, 
£rv”_ad­‹r
.
bšd_addr
, 
N©iveG©eway
,

122 
mšth»ads
=
£rv”_ad­‹r
.
th»ad_poŞ
,

123 
maxth»ads
=
£rv”_ad­‹r
.
th»ad_poŞ_max
,

124 
£rv”_Çme
=server_name)

126 
£lf
.
max_»que¡_h—d”_size
 = s–f.
£rv”_ad­‹r
.max_»que¡_h—d”_siz
Ü
 0

127 
£lf
.
max_»que¡_body_size
 = s–f.
£rv”_ad­‹r
.max_»que¡_body_siz
Ü
 0

128 
£lf
.
»que¡_queue_size
 = s–f.
£rv”_ad­‹r
.
sock‘_queue_size


129 
£lf
.
timeout
 = s–f.
£rv”_ad­‹r
.
sock‘_timeout


130 
£lf
.
shutdown_timeout
 = s–f.
£rv”_ad­‹r
.shutdown_timeout

131 
£lf
.
´ÙocŞ
 = s–f.
£rv”_ad­‹r
.
´ÙocŞ_v”siÚ


132 
£lf
.
nod–ay
 = s–f.
£rv”_ad­‹r
.nodelay

134 
s¦_moduË
 = 
£lf
.
£rv”_ad­‹r
.s¦_moduË 
Ü
 'pyopenssl'

135 
£lf
.
£rv”_ad­‹r
.
s¦_cÚ‹xt
:

136 
ad­‹r_şass
 = 
wsgi£rv”
.
	$g‘_s¦_ad­‹r_şass
(
s¦_moduË
)

137 
£lf
.
s¦_ad­‹r
 = 
	$ad­‹r_şass
(

138 
£lf
.
£rv”_ad­‹r
.
s¦_û¹ifiÿ‹
,

139 
£lf
.
£rv”_ad­‹r
.
s¦_´iv©e_key
,

140 
£lf
.
£rv”_ad­‹r
.
s¦_û¹ifiÿ‹_chaš
)

141 
£lf
.
s¦_ad­‹r
.
cÚ‹xt
 = s–f.
£rv”_ad­‹r
.
s¦_cÚ‹xt


142 
–if
 
£lf
.
£rv”_ad­‹r
.
s¦_û¹ifiÿ‹
:

143 
ad­‹r_şass
 = 
wsgi£rv”
.
	$g‘_s¦_ad­‹r_şass
(
s¦_moduË
)

144 
£lf
.
s¦_ad­‹r
 = 
	`ad­‹r_şass
(

145 
£lf
.
£rv”_ad­‹r
.
s¦_û¹ifiÿ‹
,

146 
£lf
.
£rv”_ad­‹r
.
s¦_´iv©e_key
,

147 
£lf
.
£rv”_ad­‹r
.
s¦_û¹ifiÿ‹_chaš
)

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/_cpreqbody.py

3 .. 
	gv”siÚadded
:: 3.2

5 
AµliÿtiÚ
 
authÜs
 
have
 
com¶‘e
 
cÚŒŞ
 
ov”
 
the
 
·rsšg
 
of
 
HTTP
 
»que¡


6 
’t™›s
. 
In
 , :
©Œ
:`
ch”rypy
.
»que¡
.
body
<ch”rypy.
_ı»que¡
.
Reque¡
.body>`

7 
is
 
now
 
®ways
 
£t
 
to
 
ª
 
š¡ªû
 
of
 :
şass
:`
Reque¡Body
<
ch”rypy
.
_ı»qbody
.RequestBody>`,

8 
ªd
 *
th©
* 
şass
 
is
 
a
 
subşass
 
	gof
 :şass:`
EÁ™y
<
ch”rypy
.
_ı»qbody
.Entity>`.

10 
Wh’
 
ª
 
HTTP
 
»que¡
 
šşudes
‡À
’t™y
 
body
, 
™
 
is
 
oá’
 
desœabË
 
to


11 
´ovide
 
th©
 
šfÜm©iÚ
 
to
 
­¶iÿtiÚs
 
š
 
a
 
fÜm
 
Ùh”
 
thª
 
the
 
¿w
 
	gby‹s
.

12 
Difã»Á
 
cÚ‹Á
 
ty³s
 
demªd
 
difã»Á
 
	g­´ßches
. 
	gExam¶es
:

14 * 
FÜ
 
a
 
GIF
 
fe
, 
we
 
wªt
 
the
 
¿w
 
by‹s
 
š
‡ 
	g¡»am
.

15 * 
An
 
HTML
 
fÜm
 
is
 
b‘‹r
 
·r£d
 
što
 
™s
 
compÚ’t
 
	gf›lds
, 
ªd
 
—ch
 
‹xt
 
f›ld


16 
decoded
 
äom
 
by‹s
 
to
 
	gunicode
.

17 * 
A
 
JSON
 
body
 
should
 
be
 
de£rŸlized
 
što
 
a
 
PythÚ
 
diù
 
Ü
 
	gli¡
.

19 
Wh’
 
the
 
»que¡
 
cÚšs
 
a
 
	gCÚ‹Á
-
Ty³
 
	gh—d”
,h
medŸ
 
ty³
 
is
 
u£d
 
as
‡

20 
key
 
to
 
look
 
up
 
a
 
v®ue
 
š
 
	gthe


21 :
©Œ
:`
»que¡
.
body
.
´oûssÜs
<
ch”rypy
.
_ı»qbody
.
EÁ™y
.´oûssÜs>` 
diù
.

22 
If
 
the
 
fuÎ
 
medŸ


23 
ty³
 
is
 
nÙ
 
found
, 
th’
 
the
 
majÜ
y³ i 
	gŒ›d
; 
	gexam¶e
, 
no
 
´oûssÜ


24 
is
 
found
 
	gthe
 'image/j³g' 
	gty³
, 
th’
 
we
 
look
 
a
 
´oûssÜ
 the 'image'

25 
ty³s
 
	g®tog‘h”
. 
If
 
Ã™h”
 
the
 
fuÎ
 
ty³
 
nÜ
h
majÜ
y³ 
has
 
a
 
m©chšg


26 
	g´oûssÜ
, 
th’
 
a
  
´oûssÜ
 
is
 
	gu£d


27 (:
func
:`
deçuÉ_´oc
<
ch”rypy
.
_ı»qbody
.
EÁ™y
.deçuÉ_´oc>`). 
FÜ
 
mo¡


28 
ty³s
, 
this
 
m—ns
 
no
 
´oûssšg
 
is
 
	gdÚe
, 
ªd
 
the
 
body
 i 
Ëá
 
uÄ—d
 
as
 
a


29 
¿w
 
by‹
 
	g¡»am
. 
ProûssÜs
 
¬e
 
cÚfigu¿bË
 
š
 
	gª
 'Ú_¡¬t_»sourû' 
	ghook
.

31 
Some
 
	g´oûssÜs
, 
e¥ecŸÎy
 
tho£
 
	gthe
 '‹xt' 
	gty³s
, 
©‹m±
 
to
 
decode
 
by‹s


32 
to
 
	gunicode
. 
If
 
the
 
	gCÚ‹Á
-
Ty³
 
»que¡
 
h—d”
 
šşudes
 
	ga
 'ch¬£t' 
	g·¿m‘”
,

33 
this
 
is
 
u£d
 
to
 
decode
 
the
 
	g’t™y
. 
	gOth”wi£
, 
Úe
 
Ü
 
mÜe
  
ch¬£ts
 
may


34 
be
 
	g©‹m±ed
, 
®though
 
this
 
decisiÚ
 
is
 
up
 
to
 
—ch
 
	g´oûssÜ
. 
If
 
a
 
´oûssÜ


35 
sucûssfuÎy
 
decodes
 
ª
 
EÁ™y
 
Ü
 
	gP¬t
, 
™
 
should
 
£t
 
	gthe


36 :
©Œ
:`
ch¬£t
<
ch”rypy
.
_ı»qbody
.
EÁ™y
.ch¬£t>` 
©Œibu‹


37 
Ú
 
the
 
EÁ™y
 
Ü
 
P¬t
 
to
h
Çme
 
of
h
sucûssful
 
ch¬£t
, 
so
 
th©


38 
­¶iÿtiÚs
 
ÿn
 
—sy
 
	g»
-
’code
 
Ü
 
Œªscode
 
the
 
v®ue
 
they
 
	gwish
.

40 
If
 
the
 
	gCÚ‹Á
-
Ty³
 
of
h
»que¡
 
’t™y
 
is
 oà
majÜ
 
	gty³
 'muÉ¬t', 
th’


41 
the
 
above
 
·rsšg
 
	g´oûss
, 
ªd
 
possibly
 
a
 
decodšg
…roûss, 
is
 
³rfÜmed
 

42 
—ch
 
	g·¹
.

44 
FÜ
 
bÙh
 
the
 
fuÎ
 
’t™y
 
ªd
 
muÉ¬t
 
	g·¹s
, 
a
 
	gCÚ‹Á
-
Di¥os™iÚ
 
h—d”
 
may


45 
be
 
u£d
 
to
 
	gfl
 :
©Œ
:`
Çme
<
ch”rypy
.
_ı»qbody
.
EÁ™y
.Çme>` 
ªd


46 :
©Œ
:`
f’ame
<
ch”rypy
.
_ı»qbody
.
EÁ™y
.f’ame>` 
©Œibu‹s
 
Ú
 
the


47 
»que¡
.
body
 
Ü
 
the
 
P¬t
.

49 .. 
_cu¡ombody´oûssÜs
:

51 
Cu¡om
 
ProûssÜs


54 
You
 
ÿn
 
add
 
your
 
own
 
´oûssÜs
 
ªy
 
¥ecific
 
Ü
 
majÜ
 
MIME
 
ty³
. 
Sim¶y
‡dd

55 
™
 
to
 
the
 :
©Œ
:`
´oûssÜs
<
ch”rypy
.
_ı»que¡
.
EÁ™y
.´oûssÜs>` 
diù
 
š
 
a


56 
hook
/
toŞ
 
th©
 
runs
 
©
 ``
Ú_¡¬t_»sourû
`` 
Ü
 ``
befÜe_»que¡_body
``.

57 
H”e
'she built-in JSONool for‡nƒxample::

59 
def
 
	$jsÚ_š
(
fÜû
=
True
, 
debug
=
F®£
):

60 
»que¡
 = 
ch”rypy
.
£rvšg
.request

61 
def
 
	$jsÚ_´oûssÜ
(
’t™y
):

63 
nÙ
 
’t™y
.
h—d”s
.
	`g‘
("Content-Length", ""):

64 
¿i£
 
ch”rypy
.
	$HTTPE¼Ü
(411)

66 
body
 = 
’t™y
.
å
.
	$»ad
()

67 
Œy
:

68 
»que¡
.
jsÚ
 = 
	$jsÚ_decode
(
body
)

69 
exû±
 
V®ueE¼Ü
:

70 
¿i£
 
ch”rypy
.
	`HTTPE¼Ü
(400, 'Invalid JSON document')

71 
fÜû
:

72 
»que¡
.
body
.
´oûssÜs
.
	$ş—r
()

73 
»que¡
.
body
.
deçuÉ_´oc
 = 
ch”rypy
.
	`HTTPE¼Ü
(

75 
»que¡
.
body
.
´oûssÜs
['­¶iÿtiÚ/jsÚ'] = 
jsÚ_´oûssÜ


77 
We
 
begš
 
by
 
defššg
 
a
 
Ãw
 ``
jsÚ_´oûssÜ
`` 
funùiÚ
 
to
 
¡ick
 
š
 
the
 ``
´oûssÜs
``

78 
diùiÚ¬y
. 
AÎ
 
´oûssÜ
 
funùiÚs
 
ke
 
a
 
sšgË
 
¬gum’t
, 
the
 ``
EÁ™y
`` 
š¡ªû


79 
they
 
¬e
 
to
 
´oûss
. 
It
 
wl
 
be
 
ÿÎed
 
wh’ev”
 
a
 
»que¡
 
is
 
	`»ûived
 (
tho£


80 
URI
's whereheool isurned on) which has‡ ``Content-Type`` of

83 
Fœ¡
, 
™
 
checks
 
a
 
v®id
 ``
CÚ‹Á
-
L’gth
`` (
¿isšg
 411 
nÙ
 v®id), 
th’


84 
»ads
 
the
 
»maššg
 
by‹s
 
Ú
h
sock‘
. 
The
 ``
å
`` 
objeù
 
knows
 
™s
 
own
 
Ëngth
, 
so


85 
™
 
wÚ
't hang waiting for datahat‚ever‡rrives. It will„eturn when‡ll data

86 
has
 
b“n
 
»ad
. 
Th’
, 
we
 
decode
 
tho£
 
by‹s
 
usšg
 
PythÚ
's built-in ``json`` module,

87 
ªd
 
¡ick
 
the
 
decoded
 
»suÉ
 
Úto
 ``
»que¡
.
jsÚ
`` . 
If
 
™
 
ÿÂÙ
 
be
 decoded, 
we


88 
¿i£
 400.

90 
If
 
the
 "fÜû" 
¬gum’t
 
is
 
	`True
 (th),h``
ToŞ
`` 
ş—rs
h``
´oûssÜs
``

91 
diù
 
so
 
th©
 
»que¡
 
’t™›s
 
of
 
Ùh”
 ``
CÚ‹Á
-
Ty³s
`` 
¬’
't…arsed‡t‡ll. Since

92 
th”e
's‚oƒntry forhose invalid MIMEypes,he ``default_proc`` method of ``cherrypy.request.body``

93 
is
 
ÿÎed
. 
But
 
this
 
dÛs
 
nÙhšg
 
by
  (
usu®ly
 
to
 
´ovide
 
the
 
·ge
 
hªdËr
 
ª
 
İpÜtun™y
Ø
hªdË
 
™
.)

94 
But
 
š
 
our
 , 
we
 
wªt
 
to
 
¿i£
 415, 
so
 w
»¶aû
 ``
»que¡
.
body
.
deçuÉ_´oc
``

95 
w™h
 
the
 
	`”rÜ
 (``
HTTPE¼Ü
`` 
š¡ªûs
, 
wh’
 
ÿÎed
, 
¿i£
 
them£lves
).

97 
If
 
we
 
w”e
 
defššg
 
a
 
cu¡om
 
´oûssÜ
, w
ÿn
 dØ
so
 
w™hout
 
makšg
‡ ``
ToŞ
``. 
Ju¡
 
add
 
the
 
cÚfig
 
’Œy
::

99 
»que¡
.
body
.
´oûssÜs
 = {'­¶iÿtiÚ/jsÚ': 
jsÚ_´oûssÜ
}

101 
NÙe
 
th©
 
you
 
ÿn
 
Úly
 
»¶aû
 
the
 ``
´oûssÜs
`` 
diù
 
whŞe§Ë
 
this
 
way
, 
nÙ
 
upd©e
h
exi¡šg
 
	gÚe
.

104 
	gŒy
:

105 
äom
 
io
 
impÜt
 
DEFAULT_BUFFER_SIZE


106 
exû±
 
ImpÜtE¼Ü
:

107 
DEFAULT_BUFFER_SIZE
 = 8192

108 
impÜt
 
»


109 
impÜt
 
sys


110 
impÜt
 
‹mpfe


111 
Œy
:

112 
äom
 
u¾lib
 
impÜt
 
unquÙe_¶us


113 
exû±
 
ImpÜtE¼Ü
:

114 
def
 
	$unquÙe_¶us
(
bs
):

116 
bs
 = bs.
	`»¶aû
(
	`Áob
('+'),‚tob(' '))

117 
©oms
 = 
bs
.
	`¥l™
(
	`Áob
('%'))

118 
i
 
š
 
	`¿nge
(1, 
	$Ën
(
©oms
)):

119 
™em
 = 
©oms
[
i
]

120 
Œy
:

121 
pù
 = (
™em
[:2], 16)

122 
©oms
[
i
] = 
	`by‹s
([
pù
]è+ 
™em
[2:]

123 
exû±
 
V®ueE¼Ü
:

124 
·ss


125  
	`Áob
('').
	$još
(
©oms
)

127 
impÜt
 
ch”rypy


128 
äom
 
ch”rypy
.
_ıcom·t
 
impÜt
 
ba£¡ršg
, 
Áob
, 
Áou


129 
äom
 
ch”rypy
.
lib
 
impÜt
 
h‰put


132 #-------------------------------- 
ProûssÜs
 -------------------------------- #


133 
def
 
	$´oûss_u¾’coded
(
’t™y
):

135 
qs
 = 
’t™y
.
å
.
	$»ad
()

136 
ch¬£t
 
š
 
’t™y
.
©‹m±_ch¬£ts
:

137 
Œy
:

138 
·¿ms
 = {
	}
}

139 
­¬am
 
š
 
qs
.
¥l™
(
Áob
('&')):

140 
·œ
 
š
 
­¬am
.
¥l™
(
Áob
(';')):

141 
nÙ
 
·œ
:

144 
©oms
 = 
·œ
.
¥l™
(
Áob
('='), 1)

145 
Ën
(
©oms
) == 1:

146 
©oms
.
­³nd
(
Áob
(''))

148 
key
 = 
unquÙe_¶us
(
©oms
[0]).
	$decode
(
ch¬£t
)

149 
v®ue
 = 
	`unquÙe_¶us
(
©oms
[1]).
	$decode
(
ch¬£t
)

151 
key
 
š
 
·¿ms
:

152 
nÙ
 
	$isš¡ªû
(
·¿ms
[
key
], 
li¡
):

153 
·¿ms
[
key
] = [params[key]]

154 
·¿ms
[
key
].
	$­³nd
(
v®ue
)

156 
·¿ms
[
key
] = 
v®ue


157 
exû±
 
UnicodeDecodeE¼Ü
:

158 
·ss


160 
’t™y
.
ch¬£t
 = charset

163 
¿i£
 
ch”rypy
.
	`HTTPE¼Ü
(

165 "ch¬£t w”©‹m±ed: %s" % 
	$»´
(
’t™y
.
©‹m±_ch¬£ts
))

167 #Now 
th©
 
®l
 
v®ues
 
have
 
b“n
 
sucûssfuÎy
 
·r£d
 
ªd
 
decoded
,

168 #­¶y 
them
 
to
 
the
 
’t™y
.
·¿ms
 
diù
.

169 
key
, 
v®ue
 
š
 
·¿ms
.
	$™ems
():

170 
key
 
š
 
’t™y
.
·¿ms
:

171 
nÙ
 
	$isš¡ªû
(
’t™y
.
·¿ms
[
key
], 
li¡
):

172 
’t™y
.
·¿ms
[
key
] = [entity.params[key]]

173 
’t™y
.
·¿ms
[
key
].
	$­³nd
(
v®ue
)

175 
’t™y
.
·¿ms
[
key
] = 
v®ue


178 
def
 
	$´oûss_muÉ¬t
(
’t™y
):

180 
ib
 = ""

181 'bound¬y' 
š
 
’t™y
.
cÚ‹Á_ty³
.
·¿ms
:

183 #"
The
 
g¿mm¬
 
·¿m‘”s
 
Ú
 
the
 
CÚ‹Á
-
ty³
 
f›ld
 
is
 
such
 
th©
 
™


184 #i 
oá’
 
Ãûs§ry
 
to
 
’şo£
 
the
 
bound¬y
 
·¿m‘”
 
v®ues
 
š
 
quÙes


185 #Ú 
the
 
CÚ‹Á
-
ty³
 
lše
"

186 
ib
 = 
’t™y
.
cÚ‹Á_ty³
.
·¿ms
['bound¬y'].
	`¡r
('"')

188 
nÙ
 
»
.
	`m©ch
("^[ -~]{0,200}[!-~]$", 
ib
):

189 
¿i£
 
	`V®ueE¼Ü
('Inv®id bound¬y iÀmuÉ¬ˆfÜm: %r' % (
ib
,))

191 
ib
 = ('--' + ib).
	`’code
('ascii')

193 #Fšd 
the
 
fœ¡
 
m¬k”


194 
True
:

195 
b
 = 
’t™y
.
	$»adlše
()

196 
nÙ
 
b
:

199 
b
 = b.
	$¡r
()

200 
b
 =ğ
ib
:

203 #R—d 
®l
 
·¹s


204 
True
:

205 
·¹
 = 
’t™y
.
·¹_şass
.
	$äom_å
(
’t™y
.
å
, 
ib
)

206 
’t™y
.
·¹s
.
	$­³nd
(
·¹
)

207 
·¹
.
	$´oûss
()

208 
·¹
.
å
.
dÚe
:

211 
def
 
	$´oûss_muÉ¬t_fÜm_d©a
(
’t™y
):

213 
	$´oûss_muÉ¬t
(
’t™y
)

215 
k•t_·¹s
 = []

216 
·¹
 
š
 
’t™y
.
·¹s
:

217 
·¹
.
Çme
 
is
 
NÚe
:

218 
k•t_·¹s
.
	$­³nd
(
·¹
)

220 
·¹
.
f’ame
 
is
 
NÚe
:

222 
v®ue
 = 
·¹
.
	$fuÎv®ue
()

225 #ha 
acûss
 
to
 
™s
 .
fe
 
ªd
 .
f’ame
 
©Œibu‹s
.

226 
v®ue
 = 
·¹


228 
·¹
.
Çme
 
š
 
’t™y
.
·¿ms
:

229 
nÙ
 
	$isš¡ªû
(
’t™y
.
·¿ms
[
·¹
.
Çme
], 
li¡
):

230 
’t™y
.
·¿ms
[
·¹
.
Çme
] = [entity.params[part.name]]

231 
’t™y
.
·¿ms
[
·¹
.
Çme
].
	$­³nd
(
v®ue
)

233 
’t™y
.
·¿ms
[
·¹
.
Çme
] = 
v®ue


235 
’t™y
.
·¹s
 = 
k•t_·¹s


237 
def
 
	$_Şd_´oûss_muÉ¬t
(
’t™y
):

239 
	$´oûss_muÉ¬t
(
’t™y
)

241 
·¿ms
 = 
’t™y
.params

243 
·¹
 
š
 
’t™y
.
·¹s
:

244 
·¹
.
Çme
 
is
 
NÚe
:

245 
key
 = 
	`Áou
('parts')

247 
key
 = 
·¹
.
Çme


249 
·¹
.
f’ame
 
is
 
NÚe
:

251 
v®ue
 = 
·¹
.
	$fuÎv®ue
()

254 #ha 
acûss
 
to
 
™s
 .
fe
 
ªd
 .
f’ame
 
©Œibu‹s
.

255 
v®ue
 = 
·¹


257 
key
 
š
 
·¿ms
:

258 
nÙ
 
	$isš¡ªû
(
·¿ms
[
key
], 
li¡
):

259 
·¿ms
[
key
] = [params[key]]

260 
·¿ms
[
key
].
	$­³nd
(
v®ue
)

262 
·¿ms
[
key
] = 
v®ue


266 #--------------------------------- 
EÁ™›s
 --------------------------------- #


268 
şass
 
	$EÁ™y
(
objeù
):

271 
This
 
şass
 
cŞËùs
 
šfÜm©iÚ
 
about
 
the
 
HTTP
 
»que¡
 
’t™y
. 
Wh’
 
a


272 
giv’
 
’t™y
 
is
 
of
 
MIME
 
ty³
 "muÉ¬t", 
—ch
 
·¹
 i 
·r£d
 
što
 
™s
 
own


273 
EÁ™y
 
š¡ªû
, 
ªd
 
the
 
£t
 
of
 
·¹s
 
¡Üed
 
š


274 :
©Œ
:`
’t™y
.
·¹s
<
ch”rypy
.
_ı»qbody
.
EÁ™y
.parts>`.

276 
B‘w“n
 
the
 ``
befÜe_»que¡_body
`` 
ªd
 ``
befÜe_hªdËr
`` 
toŞs
, 
Ch”ryPy


277 
Œ›s
 
to
 
´oûss
 
the
 
»que¡
 
	$body
 (
ªy
è
by
 
ÿÎšg


278 :
func
:`
»que¡
.
body
.
´oûss
<
ch”rypy
.
_ı»qbody
.
Reque¡Body
.process`.

279 
This
 
u£s
 
the
 ``
cÚ‹Á_ty³
`` 
of
h
EÁ™y
 
to
 
look
 
up
 
a
 
su™abË
 
´oûssÜ


280 
š
 :
©Œ
:`
EÁ™y
.
´oûssÜs
<
ch”rypy
.
_ı»qbody
.EÁ™y.´oûssÜs>`, 
a
 
diù
.

281 
If
 
a
 
m©chšg
 
´oûssÜ
 
ÿÂÙ
 
be
 
found
 
the
 
com¶‘e
 
CÚ‹Á
-
Ty³
,

282 
™
 
Œ›s
 
agaš
 
usšg
 
the
 
majÜ
 
ty³
. 
FÜ
 
exam¶e
, 
a
 
»que¡
 
w™h
 
ª


283 
’t™y
 
of
 
ty³
 "image/j³g" 
¬rives
, 
but
 
no
 
´oûssÜ
 
ÿn
 
be
 
found
 

284 
th©
 
com¶‘e
 
ty³
, 
th’
 
Úe
 
is
 
sought
 
the
 
majÜ
y³ "image". 
If
 
a


285 
´oûssÜ
 
is
 
¡l
 
nÙ
 
found
, 
th’
 
the


286 :
func
:`
deçuÉ_´oc
<
ch”rypy
.
_ı»qbody
.
EÁ™y
.deçuÉ_´oc>` 
m‘hod
 
of
 
the


287 
EÁ™y
 
is
 
	`ÿÎed
 (
which
 
dÛs
 
nÙhšg
 
by
 ; 
you
 
ÿn
 
ov”ride
 
this
 
too
).

289 
Ch”ryPy
 
šşudes
 
´oûssÜs
 
the
 "application/x-www-form-urlencoded"

290 
ty³
, 
the
 "muÉ¬t/fÜm-d©a"y³, 
ªd
h"muÉ¬t" 
majÜ
ype.

291 
Ch”ryPy
 3.2 
´oûs£s
 
the£
 
ty³s
 
®mo¡
 
exaùly
 
as
 
Şd”
 
v”siÚs
.

292 
P¬ts
 
¬e
 
·s£d
 
as
 
¬gum’ts
 
to
 
the
 
·ge
 
hªdËr
 
usšg
 
theœ


293 ``
CÚ‹Á
-
Di¥os™iÚ
.
Çme
`` 
giv’
, 
Ùh”wi£
 
š
 
a
 
g’”ic
 "parts"

294 
¬gum’t
. 
Each
 
such
 
·¹
 
is
 
e™h”
 
a
 
¡ršg
, 
Ü
 
the


295 :
şass
:`
P¬t
<
ch”rypy
.
_ı»qbody
.P¬t>` 
™£lf
 
™
's‡ file. (Inhis

296 
™
 
wl
 
have
 ``
fe
`` 
ªd
 ``
f’ame
`` 
©Œibu‹s
, 
Ü
 
possibly
 
a


297 ``
v®ue
`` 
©Œibu‹
). 
Each
 
P¬t
 
is
 
™£lf
 
a
 
subşass
 
of


298 
EÁ™y
, 
ªd
 
has
 
™s
 
own
 ``
´oûss
`` 
m‘hod
‡nd ``
´oûssÜs
`` 
diù
.

300 
Th”e
 
is
 
a
 
£·¿‹
 
´oûssÜ
 
the
 "muÉ¬t" 
majÜ
 
ty³
 
which
 i 
mÜe


301 
æexibË
, 
ªd
 
sim¶y
 
¡Ües
 
®l
 
muÉ¬t
 
·¹s
 
š


302 :
©Œ
:`
»que¡
.
body
.
·¹s
<
ch”rypy
.
_ı»qbody
.
EÁ™y
.·¹s>`. 
You
 
ÿn


303 
’abË
 
™
 
w™h
::

305 
ch”rypy
.
»que¡
.
body
.
´oûssÜs
['muÉ¬t'] = 
_ı»qbody
.
´oûss_muÉ¬t


307 
š
 
ª
 ``
Ú_¡¬t_»sourû
`` 
toŞ
.

311 #"
The
  
ch¬aù”
 
£t
, 
which
 
mu¡
 
be
 
assumed
 
š
 
the


312 #ab£nû 
of
 
a
 
ch¬£t
 
·¿m‘”
, 
is
 
US
-
ASCII
."

313 #Howev”, 
mªy
 
brow£rs
 
£nd
 
d©a
 
š
 
utf
-8 
w™h
 
no
 
ch¬£t
.

314 
©‹m±_ch¬£ts
 = ['utf-8']

317 
Wh’
 
the
 
CÚ‹Á
-
Ty³
 
of
h
»que¡
 
body
 
w¬¿Ás
 
™
, 
—ch
 oàth
giv’


318 
’codšgs
 
wl
 
be
 
Œ›d
 
š
 
Üd”
. 
The
 
fœ¡
 
Úe
 
to
 
sucûssfuÎy
 
decode
 
the


319 
’t™y
 
w™hout
 
¿isšg
 
ª
 
”rÜ
 
is
 
¡Üed
 
as


320 :
©Œ
:`
’t™y
.
ch¬£t
<
ch”rypy
.
_ı»qbody
.
EÁ™y
.ch¬£t>`. 
This
 
deçuÉs


321 
to
 ``['utf-8']`` (
¶us
 'ISO-8859-1' "‹xt/\*" 
ty³s
, 
as
 
»quœed
 
by


322 `
HTTP
/1.1 <
h‰p
:

323 
but
 ``['us-ascii', 'utf-8']`` 
muÉ¬t
 
·¹s
.

326 
ch¬£t
 = 
NÚe


327 """ThsucûssfuÈdecodšg; s“ "
©‹m±_ch¬£ts
"‡bove."""

329 
cÚ‹Á_ty³
 = 
NÚe


332 
If
 
the
 
EÁ™y
 
is
 
·¹
 
of
 
a
 
muÉ¬t
 
·ylßd
, 
this
 
wl
 
be
h
CÚ‹Á
-
Ty³


333 
giv’
 
š
 
the
 
MIME
 
h—d”s
 
this
 
·¹
.

336 
deçuÉ_cÚ‹Á_ty³
 = 'application/x-www-form-urlencoded'

338 
is
 
giv’
. 
The
 
em±y
 
¡ršg
 i 
u£d
 
Reque¡Body
, 
which
 
»suÉs
 
š
 
the


339 
»que¡
 
body
 
nÙ
 
bešg
 
»ad
 
Ü
 
·r£d
 
©
 
®l
. 
This
 
is
 
by
 
design
; 
a
 
missšg


340 ``
CÚ‹Á
-
Ty³
`` 
h—d”
 
š
 
the
 
HTTP
 
»que¡
 
’t™y
 
is
 
ª
 
”rÜ
 
©
 
be¡
,

341 
ªd
 
a
 
£cur™y
 
hŞe
 
©
 
wÜ¡
. 
FÜ
 
muÉ¬t
 
·¹s
, 
howev”
, 
the
 
MIME
 
¥ec


342 
deş¬es
 
th©
 
a
 
·¹
 
w™h
 
no
 
CÚ‹Á
-
Ty³
 
deçuÉs
 
to
 "text/plain"

343 (
£e
 :
şass
:`
P¬t
<
ch”rypy
.
_ı»qbody
.Part>`).

346 
f’ame
 = 
NÚe


349 
å
 = 
NÚe


352 
h—d”s
 = 
NÚe


355 
This
 
is
 
a
 
cİy
 
of
 
the
 ``
»que¡
.
h—d”s
`` th``»que¡.
body
``;

356 
muÉ¬t
 
·¹s
, 
™
 
is
 
the
 
£t
 
of
 
h—d”s
 
th©
 
·¹
.

359 
Ëngth
 = 
NÚe


362 
Çme
 = 
NÚe


363 """Th"
Çme
"…arameter ofhe ``Content-Disposition`` header, if‡ny."""

365 
·¿ms
 = 
NÚe


367 
If
 
the
 
»que¡
 
CÚ‹Á
-
Ty³
 
is
 '­¶iÿtiÚ/x-www-fÜm-u¾’coded' 
Ü


368 
muÉ¬t
, 
this
 
wl
 
be
 
a
 
diù
 
of
 
the
 
·¿ms
 
puÎed
 
äom
h
’t™y


369 
body
; 
th©
 
is
, 
™
 
wl
 
be
 
the
 
pÜtiÚ
 
of
 
»que¡
.
·¿ms
h© 
come


370 
äom
 
the
 
mes§ge
 
	`body
 (
som‘imes
 
ÿÎed
 "POST…¬ams", 
®though
 
they


371 
ÿn
 
be
 
£Á
 
w™h
 
v¬ious
 
HTTP
 
m‘hod
 
v”bs
). 
This
 
v®ue
 
is
 
£t
 
b‘w“n


372 
the
 'befÜe_»que¡_body' 
ªd
 'befÜe_hªdËr' 
	`hooks
 (
assumšg
 
th©


373 
´oûss_»que¡_body
 
is
 
True
)."""

375 
´oûssÜs
 = {'­¶iÿtiÚ/x-www-fÜm-u¾’coded': 
´oûss_u¾’coded
,

376 'muÉ¬t/fÜm-d©a': 
´oûss_muÉ¬t_fÜm_d©a
,

377 'muÉ¬t': 
´oûss_muÉ¬t
,

378 
	}
}

381 
·¹s
 = 
NÚe


382 """A†i¡ oàP¬ˆš¡ªû ià``CÚ‹Á-Ty³`` i oàmajÜy³ "
muÉ¬t
"."""

384 
·¹_şass
 = 
NÚe


387 
You
 
ÿn
 
»¶aû
 
this
 
w™h
 
cu¡om
 
subşas£s
 
to
 
®‹r
 
the
 
´oûssšg
 
of


388 
muÉ¬t
 
·¹s
.

391 
def
 
	$__š™__
(
£lf
, 
å
, 
h—d”s
, 
·¿ms
=
NÚe
, 
·¹s
=None):

392 #Mak
ª
 
š¡ªû
-
¥ecific
 
cİy
 
of
 
the
 
şass
 
´oûssÜs


393 #sØ
ToŞs
, 
‘c
. 
ÿn
 
»¶aû
 
them
 
³r
-
»que¡
.

394 
£lf
.
´oûssÜs
 = s–f.´oûssÜs.
	$cİy
()

396 
£lf
.
å
 = fp

397 
£lf
.
h—d”s
 = headers

399 
·¿ms
 
is
 
NÚe
:

400 
·¿ms
 = {
	}
}

401 
£lf
.
·¿ms
 =…arams

403 
·¹s
 
is
 
NÚe
:

404 
·¹s
 = []

405 
£lf
.
·¹s
 =…arts

407 #CÚ‹Á-
Ty³


408 
£lf
.
cÚ‹Á_ty³
 = 
h—d”s
.
–em’ts
('Content-Type')

409 
£lf
.
cÚ‹Á_ty³
:

410 
£lf
.
cÚ‹Á_ty³
 = self.content_type[0]

412 
£lf
.
cÚ‹Á_ty³
 = 
h‰put
.
H—d”EËm’t
.
	$äom_¡r
(

413 
£lf
.
deçuÉ_cÚ‹Á_ty³
)

415 #Cİy 
the
 
şass
 '©‹m±_ch¬£ts', 
´•’dšg
 
ªy
 
CÚ‹Á
-
Ty³
 
ch¬£t


416 
dec
 = 
£lf
.
cÚ‹Á_ty³
.
·¿ms
.
	`g‘
("ch¬£t", 
NÚe
)

417 
dec
:

418 
£lf
.
©‹m±_ch¬£ts
 = [
dec
] + [
c
 ø
š
 self.attempt_charsets

419 
c
 !ğ
dec
]

421 
£lf
.
©‹m±_ch¬£ts
 = self.attempt_charsets[:]

424 
£lf
.
Ëngth
 = 
NÚe


425 
ş’
 = 
h—d”s
.
	`g‘
('CÚ‹Á-L’gth', 
NÚe
)

426 #Ià
T¿nsãr
-
Encodšg
 
is
 'chunked', 
ignÜe
 
ªy
 
CÚ‹Á
-
L’gth
.

427 
ş’
 
is
 
nÙ
 
NÚe
 
ªd
 'chunked'‚Ù 
š
 
h—d”s
.
	`g‘
('Transfer-Encoding', ''):

428 
Œy
:

429 
£lf
.
Ëngth
 = (
ş’
)

430 
exû±
 
V®ueE¼Ü
:

431 
·ss


433 #CÚ‹Á-
Di¥os™iÚ


434 
£lf
.
Çme
 = 
NÚe


435 
£lf
.
f’ame
 = 
NÚe


436 
di¥
 = 
h—d”s
.
	`–em’ts
('Content-Disposition')

437 
di¥
:

438 
di¥
 = disp[0]

439 'Çme' 
š
 
di¥
.
·¿ms
:

440 
£lf
.
Çme
 = 
di¥
.
·¿ms
['name']

441 
£lf
.
Çme
.
	`¡¬tsw™h
('"'è
ªd
 s–f.Çme.
	`’dsw™h
('"'):

442 
£lf
.
Çme
 = self.name[1:-1]

443 'f’ame' 
š
 
di¥
.
·¿ms
:

444 
£lf
.
f’ame
 = 
di¥
.
·¿ms
['filename']

445 
£lf
.
f’ame
.
	`¡¬tsw™h
('"'è
ªd
 s–f.f’ame.
	`’dsw™h
('"'):

446 
£lf
.
f’ame
 = self.filename[1:-1]

448 #Th'ty³' 
©Œibu‹
 
is
 
d•»ÿ‹d
 
š
 3.2; 
»move
 
™
 in 3.3.

449 
ty³
 = 
	`´İ”ty
(
Ïmbda
 
£lf
: s–f.
cÚ‹Á_ty³
,

450 
doc
="""A deprecated‡lias for :attr:`content_type<cherrypy._cpreqbody.Entity.content_type>`.""")

452 
def
 
	$»ad
(
£lf
, 
size
=
NÚe
, 
å_out
=None):

453  
£lf
.
å
.
	$»ad
(
size
, 
å_out
)

455 
def
 
	$»adlše
(
£lf
, 
size
=
NÚe
):

456  
£lf
.
å
.
	$»adlše
(
size
)

458 
def
 
	$»adlšes
(
£lf
, 
sizehšt
=
NÚe
):

459  
£lf
.
å
.
	$»adlšes
(
sizehšt
)

461 
def
 
	$__™”__
(
£lf
):

462  
£lf


464 
def
 
	$__Ãxt__
(
£lf
):

465 
lše
 = 
£lf
.
	$»adlše
()

466 
nÙ
 
lše
:

467 
¿i£
 
StİI‹¿tiÚ


468  
lše


470 
def
 
	$Ãxt
(
£lf
):

471  
£lf
.
	$__Ãxt__
()

473 
def
 
	$»ad_što_fe
(
£lf
, 
å_out
=
NÚe
):

475 
å_out
 
is
 
NÚe
:

476 
å_out
 = 
£lf
.
	$make_fe
()

477 
£lf
.
	$»ad
(
å_out
=fp_out)

478  
å_out


480 
def
 
	$make_fe
(
£lf
):

483 
By
 , 
this
 
wl
  
a
 
TempÜ¬yFe
. 
Ov”ride
 
as
 
Ãeded
.

484 
S“
 
®so
 :
©Œ
:`
ch”rypy
.
_ı»qbody
.
P¬t
.
max¿mby‹s
`."""

485  
‹mpfe
.
	$TempÜ¬yFe
()

487 
def
 
	$fuÎv®ue
(
£lf
):

489 
£lf
.
fe
:

490 #Iˆ
was
 
¡Üed
 
š
 
a
 
‹mpfe
. 
R—d
 
™
.

491 
£lf
.
fe
.
	$£ek
(0)

492 
v®ue
 = 
£lf
.
fe
.
	$»ad
()

493 
£lf
.
fe
.
	$£ek
(0)

495 
v®ue
 = 
£lf
.value

496  
v®ue


498 
def
 
	$´oûss
(
£lf
):

500 
´oc
 = 
NÚe


501 
ù
 = 
£lf
.
cÚ‹Á_ty³
.
v®ue


502 
Œy
:

503 
´oc
 = 
£lf
.
´oûssÜs
[
ù
]

504 
exû±
 
KeyE¼Ü
:

505 
tİty³
 = 
ù
.
	`¥l™
('/', 1)[0]

506 
Œy
:

507 
´oc
 = 
£lf
.
´oûssÜs
[
tİty³
]

508 
exû±
 
KeyE¼Ü
:

509 
·ss


510 
´oc
 
is
 
NÚe
:

511 
£lf
.
	$deçuÉ_´oc
()

513 
	$´oc
(
£lf
)

515 
def
 
	$deçuÉ_´oc
(
£lf
):

517 #L—v
the
 
å
 
®Úe
 
someÚe
 
to
 
»ad
. 
This
 
wÜks
 
fše


518 #fÜ 
»que¡
.
body
, 
but
 
the
 
P¬t
 
subşas£s
 
Ãed
 
to
 
ov”ride
 
this


519 #sØ
they
 
ÿn
 
move
 
Ú
 
to
 
the
 
Ãxt
 
·¹
.

520 
·ss


523 
şass
 
	$P¬t
(
EÁ™y
):

526 #"
The
  
ch¬aù”
 
£t
, 
which
 
mu¡
 
be
 
assumed
 
š
 
the
 
ab£nû
 
of
 
a


527 #ch¬£ˆ
·¿m‘”
, 
is
 
US
-
ASCII
."

528 
©‹m±_ch¬£ts
 = ['us-ascii', 'utf-8']

531 
Wh’
 
the
 
CÚ‹Á
-
Ty³
 
of
h
»que¡
 
body
 
w¬¿Ás
 
™
, 
—ch
 oàth
giv’


532 
’codšgs
 
wl
 
be
 
Œ›d
 
š
 
Üd”
. 
The
 
fœ¡
 
Úe
 
to
 
sucûssfuÎy
 
decode
 
the


533 
’t™y
 
w™hout
 
¿isšg
 
ª
 
”rÜ
 
is
 
¡Üed
 
as


534 :
©Œ
:`
’t™y
.
ch¬£t
<
ch”rypy
.
_ı»qbody
.
EÁ™y
.ch¬£t>`. 
This
 
deçuÉs


535 
to
 ``['utf-8']`` (
¶us
 'ISO-8859-1' "‹xt/\*" 
ty³s
, 
as
 
»quœed
 
by


536 `
HTTP
/1.1 <
h‰p
:

537 
but
 ``['us-ascii', 'utf-8']`` 
muÉ¬t
 
·¹s
.

540 
bound¬y
 = 
NÚe


543 
deçuÉ_cÚ‹Á_ty³
 = 'text/plain'

545 
is
 
giv’
. 
The
 
em±y
 
¡ršg
 i 
u£d
 
Reque¡Body
, 
which
 
»suÉs
 
š
 
the


546 
»que¡
 
body
 
nÙ
 
bešg
 
»ad
 
Ü
 
·r£d
 
©
 
®l
. 
This
 
is
 
by
 
design
; 
a
 
missšg


547 ``
CÚ‹Á
-
Ty³
`` 
h—d”
 
š
 
the
 
HTTP
 
»que¡
 
’t™y
 
is
 
ª
 
”rÜ
 
©
 
be¡
,

548 
ªd
 
a
 
£cur™y
 
hŞe
 
©
 
wÜ¡
. 
FÜ
 
muÉ¬t
 
·¹s
, 
	`howev”
 (
this
 
şass
),

549 
the
 
MIME
 
¥ec
 
deş¬es
 
th©
 
a
 
·¹
 
w™h
 
no
 
CÚ‹Á
-
Ty³
 
deçuÉs
 
to


553 #Thi 
is
 
the
  
š
 
¡dlib
 
cgi
. 
We
 
may
 
wªt
 
to
 
šü—£
 
™
.

554 
max¿mby‹s
 = 1000

556 
š
 
a
 
	`fe
 (
g’”©ed
 
by
 :
func
:`
make_fe
<
ch”rypy
.
_ı»que¡
.
EÁ™y
.make_file>`)

557 
š¡—d
 
of
 
a
 
¡ršg
. 
DeçuÉs
 
to
 1000, 
ju¡
 
like
 
the
 :
mod
:`
cgi
` 
moduË
 
š


558 
PythÚ
's standard†ibrary.

561 
def
 
	$__š™__
(
£lf
, 
å
, 
h—d”s
, 
bound¬y
):

562 
EÁ™y
.
	$__š™__
(
£lf
, 
å
, 
h—d”s
)

563 
£lf
.
bound¬y
 = boundary

564 
£lf
.
fe
 = 
NÚe


565 
£lf
.
v®ue
 = 
NÚe


567 
def
 
	$äom_å
(
şs
, 
å
, 
bound¬y
):

568 
h—d”s
 = 
şs
.
	$»ad_h—d”s
(
å
)

569  
	$şs
(
å
, 
h—d”s
, 
bound¬y
)

570 
äom_å
 = 
	$şassm‘hod
(
äom_å
)

572 
def
 
	$»ad_h—d”s
(
şs
, 
å
):

573 
h—d”s
 = 
h‰put
.
	$H—d”M­
()

574 
True
:

575 
lše
 = 
å
.
	$»adlše
()

576 
nÙ
 
lše
:

577 #NØ
mÜe
 
d©a
--
Ëg®
 
’d
 
of
 
h—d”s


578 
¿i£
 
	`EOFE¼Ü
("Illegalƒnd of headers.")

580 
lše
 =ğ
	`Áob
('\r\n'):

581 #NÜm® 
’d
 
of
 
h—d”s


583 
nÙ
 
lše
.
	`’dsw™h
(
	`Áob
('\r\n')):

584 
¿i£
 
	`V®ueE¼Ü
("MIME„equœe CRLF”mš©Üs: %r" % 
lše
)

586 
lše
[0] 
š
 
	`Áob
(' \t'):

588 
v
 = 
lše
.
	`¡r
().
	`decode
('ISO-8859-1')

590 
k
, 
v
 = 
lše
.
	`¥l™
(
	`Áob
(":"), 1)

591 
k
 = k.
	`¡r
().
	`decode
('ISO-8859-1')

592 
v
 = v.
	`¡r
().
	`decode
('ISO-8859-1')

594 
exi¡šg
 = 
h—d”s
.
	$g‘
(
k
)

595 
exi¡šg
:

596 
v
 = ", ".
	`još
((
exi¡šg
, v))

597 
h—d”s
[
k
] = 
v


599  
h—d”s


600 
»ad_h—d”s
 = 
	$şassm‘hod
(
»ad_h—d”s
)

602 
def
 
	$»ad_lšes_to_bound¬y
(
£lf
, 
å_out
=
NÚe
):

605 
If
 
the
 'å_out' 
¬gum’t
 
is
 
	`NÚe
 (th), 
®l
 
by‹s
 
»ad
 
¬e


606 
»tuºed
 
š
 
a
 
sšgË
 
by‹
 
¡ršg
.

608 
If
 
the
 'å_out' 
¬gum’t
 
is
 
nÙ
 
NÚe
, 
™
 
mu¡
 
be
 
a
 
fe
-
like
 
objeù
 
th©


609 
suµÜts
 
the
 'wr™e' 
m‘hod
; 
®l
 
by‹s
 
»ad
 
wl
 
be
 
wr™‹n
 
to
h
å
,

610 
ªd
 
th©
 
å
 
is
 
»tuºed
.

612 
’dm¬k”
 = 
£lf
.
bound¬y
 + 
	`Áob
("--")

613 
d–im
 = 
	`Áob
("")

614 
´ev_lf
 = 
True


615 
lšes
 = []

616 
£’
 = 0

617 
True
:

618 
lše
 = 
£lf
.
å
.
	`»adlše
(1<<16)

619 
nÙ
 
lše
:

620 
¿i£
 
	`EOFE¼Ü
("Illegalƒnd of multipart body.")

621 
lše
.
	`¡¬tsw™h
(
	`Áob
("--")è
ªd
 
´ev_lf
:

622 
¡r³dlše
 = 
lše
.
	$¡r
()

623 
¡r³dlše
 =ğ
£lf
.
bound¬y
:

625 
¡r³dlše
 =ğ
’dm¬k”
:

626 
£lf
.
å
.
	$fšish
()

629 
lše
 = 
d–im
 +†ine

631 
lše
.
	`’dsw™h
(
	`Áob
("\r\n")):

632 
d–im
 = 
	`Áob
("\r\n")

633 
lše
 =†ine[:-2]

634 
´ev_lf
 = 
True


635 
–if
 
lše
.
	`’dsw™h
(
	`Áob
("\n")):

636 
d–im
 = 
	`Áob
("\n")

637 
lše
 =†ine[:-1]

638 
´ev_lf
 = 
True


640 
d–im
 = 
	`Áob
("")

641 
´ev_lf
 = 
F®£


643 
å_out
 
is
 
NÚe
:

644 
lšes
.
	$­³nd
(
lše
)

645 
£’
 +ğ
	$Ën
(
lše
)

646 
£’
 > 
£lf
.
max¿mby‹s
:

647 
å_out
 = 
£lf
.
	$make_fe
()

648 
lše
 
š
 
lšes
:

649 
å_out
.
	$wr™e
(
lše
)

651 
å_out
.
	$wr™e
(
lše
)

653 
å_out
 
is
 
NÚe
:

654 
»suÉ
 = 
	`Áob
('').
	$još
(
lšes
)

655 
ch¬£t
 
š
 
£lf
.
©‹m±_ch¬£ts
:

656 
Œy
:

657 
»suÉ
 =„esuÉ.
	$decode
(
ch¬£t
)

658 
exû±
 
UnicodeDecodeE¼Ü
:

659 
·ss


661 
£lf
.
ch¬£t
 = charset

662  
»suÉ


664 
¿i£
 
ch”rypy
.
	`HTTPE¼Ü
(

666 "ch¬£t w”©‹m±ed: %s" % 
	$»´
(
£lf
.
©‹m±_ch¬£ts
))

668 
å_out
.
	$£ek
(0)

669  
å_out


671 
def
 
	$deçuÉ_´oc
(
£lf
):

673 
£lf
.
f’ame
:

674 #Alway 
»ad
 
što
 
a
 
fe
 ¨.
f’ame
 
was
 
giv’
.

675 
£lf
.
fe
 = s–f.
	$»ad_što_fe
()

677 
»suÉ
 = 
£lf
.
	$»ad_lšes_to_bound¬y
()

678 
	$isš¡ªû
(
»suÉ
, 
ba£¡ršg
):

679 
£lf
.
v®ue
 = 
»suÉ


681 
£lf
.
fe
 = 
»suÉ


683 
def
 
	$»ad_što_fe
(
£lf
, 
å_out
=
NÚe
):

685 
å_out
 
is
 
NÚe
:

686 
å_out
 = 
£lf
.
	$make_fe
()

687 
£lf
.
	$»ad_lšes_to_bound¬y
(
å_out
=fp_out)

688  
å_out


690 
EÁ™y
.
·¹_şass
 = 
P¬t


692 
Œy
:

693 
šf
 = ('inf')

694 
exû±
 
V®ueE¼Ü
:

695 #PythÚ 2.4 
ªd
 
low”


696 
şass
 
	$Infš™y
(
objeù
):

697 
def
 
	$__cmp__
(
£lf
, 
Ùh”
):

699 
def
 
	$__sub__
(
£lf
, 
Ùh”
):

700  
£lf


701 
šf
 = 
	$Infš™y
()

704 
comma_£·¿‹d_h—d”s
 = ['Accept', 'Accept-Charset', 'Accept-Encoding',

711 
şass
 
SizedR—d”
:

713 
def
 
	$__š™__
(
£lf
, 
å
, 
Ëngth
, 
maxby‹s
, 
bufsize
=
DEFAULT_BUFFER_SIZE
, 
has_Œa”s
=
F®£
):

714 #W¿°
our
 
å
 
š
 
a
 
bufãr
 
so
 
	`³ek
(è
wÜks


715 
£lf
.
å
 = fp

716 
£lf
.
Ëngth
 =†ength

717 
£lf
.
maxby‹s
 = maxbytes

718 
£lf
.
bufãr
 = 
	`Áob
('')

719 
£lf
.
bufsize
 = bufsize

720 
£lf
.
by‹s_»ad
 = 0

721 
£lf
.
dÚe
 = 
F®£


722 
£lf
.
has_Œa”s
 = has_trailers

724 
def
 
	$»ad
(
£lf
, 
size
=
NÚe
, 
å_out
=None):

727 
A
 
numb”
 
of
 
by‹s
 
Ëss
 
thª
 
Ü
 
equ®
 
to
 
the
 'size' 
¬gum’t
 
¬e
 
»ad


728 
off
 
the
 
sock‘
. 
The
 
aùu®
 
numb”
 
of
 
by‹s
 
»ad
 
¬e
 
Œacked
 
š


729 
£lf
.
by‹s_»ad
. 
The
 
numb”
 
may
 
be
 
sm®Ër
 
thª
 'size' 
wh’
 1è
the


730 
ş›Á
 
£nds
 
ãw”
 
by‹s
, 2è
the
 'CÚ‹Á-L’gth' 
»que¡
 
h—d”


731 
¥ecif›s
 
ãw”
 
by‹s
 
thª
 
»que¡ed
, 
Ü
 3è
the
 
numb”
 
of
 by‹ 
»ad


732 
exûeds
 
£lf
.
	`maxby‹s
 (
š
 
which
 , 413 
is
 
¿i£d
).

734 
If
 
the
 'å_out' 
¬gum’t
 
is
 
	`NÚe
 (th), 
®l
 
by‹s
 
»ad
 
¬e


735 
»tuºed
 
š
 
a
 
sšgË
 
by‹
 
¡ršg
.

737 
If
 
the
 'å_out' 
¬gum’t
 
is
 
nÙ
 
NÚe
, 
™
 
mu¡
 
be
 
a
 
fe
-
like
 
objeù
 
th©


738 
suµÜts
 
the
 'wr™e' 
m‘hod
; 
®l
 
by‹s
 
»ad
 
wl
 
be
 
wr™‹n
 
to
h
å
,

739 
ªd
 
NÚe
 
is
 
»tuºed
.

742 
£lf
.
Ëngth
 
is
 
NÚe
:

743 
size
 
is
 
NÚe
:

744 
»maššg
 = 
šf


746 
»maššg
 = 
size


748 
»maššg
 = 
£lf
.
Ëngth
 - s–f.
by‹s_»ad


749 
size
 
ªd
 siz< 
»maššg
:

750 
»maššg
 = 
size


751 
»maššg
 == 0:

752 
£lf
.
	$fšish
()

753 
å_out
 
is
 
NÚe
:

754  
	`Áob
('')

756  
NÚe


758 
chunks
 = []

760 #R—d 
by‹s
 
äom
 
the
 
bufãr
.

761 
£lf
.
bufãr
:

762 
»maššg
 
is
 
šf
:

763 
d©a
 = 
£lf
.
bufãr


764 
£lf
.
bufãr
 = 
	`Áob
('')

766 
d©a
 = 
£lf
.
bufãr
[:
»maššg
]

767 
£lf
.
bufãr
 = s–f.bufãr[
»maššg
:]

768 
d©®’
 = 
	$Ën
(
d©a
)

769 
»maššg
 -ğ
d©®’


771 #Check 
Ëngths
.

772 
£lf
.
by‹s_»ad
 +ğ
d©®’


773 
£lf
.
maxby‹s
 
ªd
 s–f.
by‹s_»ad
 > self.maxbytes:

774 
¿i£
 
ch”rypy
.
	$HTTPE¼Ü
(413)

776 #StÜ
the
 
d©a
.

777 
å_out
 
is
 
NÚe
:

778 
chunks
.
	$­³nd
(
d©a
)

780 
å_out
.
	$wr™e
(
d©a
)

782 #R—d 
by‹s
 
äom
 
the
 
sock‘
.

783 
»maššg
 > 0:

784 
chunksize
 = 
	$mš
(
»maššg
, 
£lf
.
bufsize
)

785 
Œy
:

786 
d©a
 = 
£lf
.
å
.
	$»ad
(
chunksize
)

787 
exû±
 
Exû±iÚ
:

788 
e
 = 
sys
.
	`exc_šfo
()[1]

789 
e
.
__şass__
.
__Çme__
 == 'MaxSizeExceeded':

790 #Po¡ 
d©a
 
is
 
too
 
big


791 
¿i£
 
ch”rypy
.
	`HTTPE¼Ü
(

792 413, "Maximum„eque¡†’gth: %r" % 
e
.
¬gs
[1])

794 
¿i£


795 
nÙ
 
d©a
:

796 
£lf
.
	$fšish
()

798 
d©®’
 = 
	$Ën
(
d©a
)

799 
»maššg
 -ğ
d©®’


801 #Check 
Ëngths
.

802 
£lf
.
by‹s_»ad
 +ğ
d©®’


803 
£lf
.
maxby‹s
 
ªd
 s–f.
by‹s_»ad
 > self.maxbytes:

804 
¿i£
 
ch”rypy
.
	$HTTPE¼Ü
(413)

806 #StÜ
the
 
d©a
.

807 
å_out
 
is
 
NÚe
:

808 
chunks
.
	$­³nd
(
d©a
)

810 
å_out
.
	$wr™e
(
d©a
)

812 
å_out
 
is
 
NÚe
:

813  
	`Áob
('').
	$još
(
chunks
)

815 
def
 
	$»adlše
(
£lf
, 
size
=
NÚe
):

817 
chunks
 = []

818 
size
 
is
 
NÚe
 
Ü
 size > 0:

819 
chunksize
 = 
£lf
.
bufsize


820 
size
 
is
 
nÙ
 
NÚe
 
ªd
 siz< 
£lf
.
bufsize
:

821 
chunksize
 = 
size


822 
d©a
 = 
£lf
.
	$»ad
(
chunksize
)

823 
nÙ
 
d©a
:

825 
pos
 = 
d©a
.
	`fšd
(
	`Áob
('\n')) + 1

826 
pos
:

827 
chunks
.
	`­³nd
(
d©a
[:
pos
])

828 
»mašd”
 = 
d©a
[
pos
:]

829 
£lf
.
bufãr
 +ğ
»mašd”


830 
£lf
.
by‹s_»ad
 -ğ
	$Ën
(
»mašd”
)

833 
chunks
.
	$­³nd
(
d©a
)

834  
	`Áob
('').
	$još
(
chunks
)

836 
def
 
	$»adlšes
(
£lf
, 
sizehšt
=
NÚe
):

838 
£lf
.
Ëngth
 
is
 
nÙ
 
NÚe
:

839 
sizehšt
 
is
 
NÚe
:

840 
sizehšt
 = 
£lf
.
Ëngth
 - s–f.
by‹s_»ad


842 
sizehšt
 = 
	`mš
(sizehšt, 
£lf
.
Ëngth
 - s–f.
by‹s_»ad
)

844 
lšes
 = []

845 
£’
 = 0

846 
True
:

847 
lše
 = 
£lf
.
	$»adlše
()

848 
nÙ
 
lše
:

850 
lšes
.
	$­³nd
(
lše
)

851 
£’
 +ğ
	$Ën
(
lše
)

852 
£’
 >ğ
sizehšt
:

854  
lšes


856 
def
 
	$fšish
(
£lf
):

857 
£lf
.
dÚe
 = 
True


858 
£lf
.
has_Œa”s
 
ªd
 
	`ha§‰r
(£lf.
å
, 'read_trailer_lines'):

859 
£lf
.
Œa”s
 = {
	}
}

861 
Œy
:

862 
lše
 
š
 
£lf
.
å
.
	$»ad_Œa”_lšes
():

863 
lše
[0] 
š
 
	`Áob
(' \t'):

865 
v
 = 
lše
.
	$¡r
()

867 
Œy
:

868 
k
, 
v
 = 
lše
.
	`¥l™
(
	`Áob
(":"), 1)

869 
exû±
 
V®ueE¼Ü
:

870 
¿i£
 
	`V®ueE¼Ü
("Illegal header†ine.")

871 
k
 = k.
	`¡r
().
	$t™Ë
()

872 
v
 = v.
	$¡r
()

874 
k
 
š
 
comma_£·¿‹d_h—d”s
:

875 
exi¡šg
 = 
£lf
.
Œa”s
.
	$g‘
(
’vÇme
)

876 
exi¡šg
:

877 
v
 = 
	`Áob
(", ").
	`još
((
exi¡šg
, v))

878 
£lf
.
Œa”s
[
k
] = 
v


879 
exû±
 
Exû±iÚ
:

880 
e
 = 
sys
.
	`exc_šfo
()[1]

881 
e
.
__şass__
.
__Çme__
 == 'MaxSizeExceeded':

882 #Po¡ 
d©a
 
is
 
too
 
big


883 
¿i£
 
ch”rypy
.
	`HTTPE¼Ü
(

884 413, "Maximum„eque¡†’gth: %r" % 
e
.
¬gs
[1])

886 
¿i£


889 
şass
 
	$Reque¡Body
(
EÁ™y
):

892 
bufsize
 = 8 * 1024

895 #DÚ'ˆ·r£h»que¡ body‡ˆ®Èiàthş›Á didn'
t
 
´ovide


896 #¨
CÚ‹Á
-
Ty³
 
h—d”
. 
S“
 
h‰p
:

897 
deçuÉ_cÚ‹Á_ty³
 = ''

899 
is
 
giv’
. 
The
 
em±y
 
¡ršg
 i 
u£d
 
Reque¡Body
, 
which
 
»suÉs
 
š
 
the


900 
»que¡
 
body
 
nÙ
 
bešg
 
»ad
 
Ü
 
·r£d
 
©
 
®l
. 
This
 
is
 
by
 
design
; 
a
 
missšg


901 ``
CÚ‹Á
-
Ty³
`` 
h—d”
 
š
 
the
 
HTTP
 
»que¡
 
’t™y
 
is
 
ª
 
”rÜ
 
©
 
be¡
,

902 
ªd
 
a
 
£cur™y
 
hŞe
 
©
 
wÜ¡
. 
FÜ
 
muÉ¬t
 
·¹s
, 
howev”
, 
the
 
MIME
 
¥ec


903 
deş¬es
 
th©
 
a
 
·¹
 
w™h
 
no
 
CÚ‹Á
-
Ty³
 
deçuÉs
 
to
 "text/plain"

904 (
£e
 :
şass
:`
P¬t
<
ch”rypy
.
_ı»qbody
.Part>`).

907 
maxby‹s
 = 
NÚe


910 
def
 
	$__š™__
(
£lf
, 
å
, 
h—d”s
, 
·¿ms
=
NÚe
, 
»que¡_·¿ms
=None):

911 
EÁ™y
.
	$__š™__
(
£lf
, 
å
, 
h—d”s
, 
·¿ms
)

914 #Wh’ 
no
 
ex¶ic™
 
ch¬£t
 
·¿m‘”
 
is
 
´ovided
 
by
 
the


915 #£nd”, 
medŸ
 
subty³s
 
of
 
the
 "‹xt" 
ty³
 
¬e
 
defšed


916 #tØ
have
 
a
  
ch¬£t
 
v®ue
 
of
 "ISO-8859-1" 
wh’


917 #»ûived 
vŸ
 
HTTP
.

918 
£lf
.
cÚ‹Á_ty³
.
v®ue
.
	`¡¬tsw™h
('text/'):

919 
c
 
	`š
 ('ISO-8859-1', 'iso-8859-1', 'Latin-1', 'latin-1'):

920 
c
 
š
 
£lf
.
©‹m±_ch¬£ts
:

923 
£lf
.
©‹m±_ch¬£ts
.
	`­³nd
('ISO-8859-1')

925 #TempÜ¬y 
fix
 
d•»ÿtšg
 
·ssšg
 .
·¹s
 
as
 .
·¿ms
.

926 
£lf
.
´oûssÜs
['muÉ¬t'] = 
_Şd_´oûss_muÉ¬t


928 
»que¡_·¿ms
 
is
 
NÚe
:

929 
»que¡_·¿ms
 = {
	}
}

930 
£lf
.
»que¡_·¿ms
 =„equest_params

932 
def
 
	$´oûss
(
£lf
):

934 #"
The
 
´e£nû
 
of
 
a
 
mes§ge
-
body
 
š
‡ 
»que¡
 
is
 
sigÇËd
 
by
 
the


935 #šşusiÚ 
of
 
a
 
CÚ‹Á
-
L’gth
 
Ü
 
T¿nsãr
-
Encodšg
 
h—d”
 
f›ld
 
š


936 #th
»que¡
's message-headers."

937 #Iˆ
is
 
possibË
 
to
 
£nd
 
a
 
POST
 
»que¡
 
w™h
 
no
 
body
, 
exam¶e
;

938 #howev”, 
­p
 
dev–İ”s
 
¬e
 
»¥ÚsibË
 
š
 
th©
 
to
 
£t


939 #ch”rypy.
»que¡
.
´oûss_body
 
to
 
F®£
 
so
 
this
 
m‘hod
 
i¢
't called.

940 
h
 = 
ch”rypy
.
£rvšg
.
»que¡
.
h—d”s


941 'CÚ‹Á-L’gth' 
nÙ
 
š
 
h
 
ªd
 'Transfer-Encoding'‚ot in h:

942 
¿i£
 
ch”rypy
.
	$HTTPE¼Ü
(411)

944 
£lf
.
å
 = 
	`SizedR—d”
(£lf.å, s–f.
Ëngth
,

945 
£lf
.
maxby‹s
, 
bufsize
=self.bufsize,

946 
has_Œa”s
='T¿”' 
š
 
h
)

947 
	`su³r
(
Reque¡Body
, 
£lf
).
	$´oûss
()

949 #Body 
·¿ms
 
should
 
®so
 
be
 
a
 
·¹
 
of
 
the
 
»que¡_·¿ms


950 #add 
them
 
š
 
h”e
.

951 
»que¡_·¿ms
 = 
£lf
.request_params

952 
key
, 
v®ue
 
š
 
£lf
.
·¿ms
.
	$™ems
():

953 #PythÚ 2 
Úly
: 
keywÜd
 
¬gum’ts
 
mu¡
 
be
 
by‹
 
	`¡ršgs
 (
ty³
 'str').

954 
sys
.
v”siÚ_šfo
 < (3, 0):

955 
	$isš¡ªû
(
key
, 
unicode
):

956 
key
 = key.
	`’code
('ISO-8859-1')

958 
key
 
š
 
»que¡_·¿ms
:

959 
nÙ
 
	$isš¡ªû
(
»que¡_·¿ms
[
key
], 
li¡
):

960 
»que¡_·¿ms
[
key
] = [request_params[key]]

961 
»que¡_·¿ms
[
key
].
	$­³nd
(
v®ue
)

963 
»que¡_·¿ms
[
key
] = 
v®ue


	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/_cprequest.py

2 
impÜt
 
os


3 
impÜt
 
sys


4 
impÜt
 
time


5 
impÜt
 
w¬nšgs


7 
impÜt
 
ch”rypy


8 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
	gba£¡ršg
, 
	gcİykeys
, 
	gÁob
, 
unicode¡r


9 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
	gSim¶eCook›
, 
	gCook›E¼Ü
, 
py3k


10 
äom
 
ch”rypy
 
impÜt
 
	g_ı»qbody
, 
_ıcÚfig


11 
äom
 
	gch”rypy
.
_ı”rÜ
 
impÜt
 
	gfÜm©_exc
, 
b¬e_”rÜ


12 
äom
 
	gch”rypy
.
lib
 
impÜt
 
	gh‰put
, 
fe_g’”©Ü


15 
şass
 
	$Hook
(
objeù
):

18 
ÿÎback
 = 
NÚe


20 
The
 
b¬e
 
ÿÎabË
 
th©
 
this
 
Hook
 
objeù
 
is
 
w¿µšg
, 
which
 
wl


21 
be
 
ÿÎed
 
wh’
 
the
 
Hook
 
is
 called."""

23 
ç§ã
 = 
F®£


25 
If
 
True
, 
the
 
ÿÎback
 
is
 
gu¬ª‹ed
 
to
 
run
 
ev’
 
Ùh”
 
ÿÎbacks


26 
äom
 
the
 
§me
 
ÿÎ
 
pošt
 
¿i£
 
exû±iÚs
."""

28 
´iÜ™y
 = 50

30 
Defšes
 
the
 
Üd”
 
of
 
executiÚ
 
a
 
li¡
 oà
Hooks
. 
PriÜ™y
 
numb”s


31 
should
 
be
 
lim™ed
 
to
 
the
 
şo£d
 
š‹rv®
 [0, 100], 
but
 
v®ues
 
outside


32 
this
 
¿nge
 
¬e
 
acû±abË
, 
as
‡» 
äaùiÚ®
 
v®ues
."""

34 
kw¬gs
 = {
	}
}

36 
A
 
£t
 
of
 
keywÜd
 
¬gum’ts
 
th©
 
wl
 
be
 
·s£d
 
to
 
the


37 
ÿÎabË
 
Ú
 
—ch
 
ÿÎ
."""

39 
def
 
	$__š™__
(
£lf
, 
ÿÎback
, 
ç§ã
=
NÚe
, 
´iÜ™y
=NÚe, **
kw¬gs
):

40 
£lf
.
ÿÎback
 = callback

42 
ç§ã
 
is
 
NÚe
:

43 
ç§ã
 = 
	`g‘©Œ
(
ÿÎback
, "ç§ã", 
F®£
)

44 
£lf
.
ç§ã
 = failsafe

46 
´iÜ™y
 
is
 
NÚe
:

47 
´iÜ™y
 = 
	`g‘©Œ
(
ÿÎback
, "priority", 50)

48 
£lf
.
´iÜ™y
 =…riority

50 
£lf
.
kw¬gs
 = kwargs

52 
def
 
	$__É__
(
£lf
, 
Ùh”
):

54  
£lf
.
´iÜ™y
 < 
Ùh”
.priority

56 
def
 
	$__cmp__
(
£lf
, 
Ùh”
):

58  
	$cmp
(
£lf
.
´iÜ™y
, 
Ùh”
.priority)

60 
def
 
	$__ÿÎ__
(
£lf
):

62  
£lf
.
	$ÿÎback
(**
£lf
.
kw¬gs
)

64 
def
 
	$__»´__
(
£lf
):

65 
şs
 = 
£lf
.
__şass__


67 % (
şs
.
__moduË__
, cls.
__Çme__
, 
£lf
.
ÿÎback
,

68 
£lf
.
ç§ã
, s–f.
´iÜ™y
,

69 ", ".
	`još
(['%s=%r' % (
k
, 
v
)

70 
k
, 
v
 
š
 
£lf
.
kw¬gs
.
	`™ems
()])))

73 
şass
 
	$HookM­
(
diù
):

76 
def
 
	$__Ãw__
(
şs
, 
pošts
=
NÚe
):

77 
d
 = 
diù
.
	$__Ãw__
(
şs
)

78 
p
 
š
 
pošts
 
Ü
 []:

79 
d
[
p
] = []

80  
d


82 
def
 
	$__š™__
(
£lf
, *
a
, **
kw
):

83 
·ss


85 
def
 
	$©ch
(
£lf
, 
pošt
, 
ÿÎback
, 
ç§ã
=
NÚe
, 
´iÜ™y
=NÚe, **
kw¬gs
):

87 
£lf
[
pošt
].
	`­³nd
(
	$Hook
(
ÿÎback
, 
ç§ã
, 
´iÜ™y
, **
kw¬gs
))

89 
def
 
	$run
(
£lf
, 
pošt
):

91 
exc
 = 
NÚe


92 
hooks
 = 
£lf
[
pošt
]

93 
hooks
.
	$sÜt
()

94 
hook
 
š
 
hooks
:

95 #Som
hooks
 
¬e
 
gu¬ª‹ed
 
to
 
run
 
ev’
 
Ùh”s
 
©


96 #th
§me
 
hookpošt
 
ç
. 
We
 
wl
 
¡l
 
log
 
the
 
çu»
,

97 #buˆ
´oûed
 
Ú
 
to
 
the
 
Ãxt
 
hook
. 
The
 
Úly
 
way


98 #tØ
¡İ
 
®l
 
´oûssšg
 
äom
 
Úe
 
of
 
the£
 
hooks
 
is


99 #tØ
¿i£
 
Sy¡emEx™
 
ªd
 
¡İ
 
the
 
whŞe
 
£rv”
.

100 
exc
 
is
 
NÚe
 
Ü
 
hook
.
ç§ã
:

101 
Œy
:

102 
	$hook
()

103 
	$exû±
 (
KeybßrdIÁ”ru±
, 
Sy¡emEx™
):

104 
¿i£


105 
	$exû±
 (
ch”rypy
.
HTTPE¼Ü
, ch”rypy.
HTTPRedœeù
,

106 
ch”rypy
.
IÁ”ÇlRedœeù
):

107 
exc
 = 
sys
.
	`exc_šfo
()[1]

108 
exû±
:

109 
exc
 = 
sys
.
	`exc_šfo
()[1]

110 
ch”rypy
.
	$log
(
Œaûback
=
True
, 
£v”™y
=40)

111 
exc
:

112 
¿i£
 
exc


114 
def
 
	$__cİy__
(
£lf
):

115 
Ãwm­
 = 
£lf
.
	$__şass__
()

116 #W
ÿn
'ˆju¡ u£ '
upd©e
' because we want copies ofhe

117 #mubË 
	`v®ues
 (
—ch
 
is
 
a
 
li¡
è
as
 
w–l
.

118 
k
, 
v
 
š
 
£lf
.
	$™ems
():

119 
Ãwm­
[
k
] = 
v
[:]

120  
Ãwm­


121 
cİy
 = 
__cİy__


123 
def
 
	$__»´__
(
£lf
):

124 
şs
 = 
£lf
.
__şass__


125  "%s.%sÕošts=%r)" % (
şs
.
__moduË__
, cls.
__Çme__
, 
	$cİykeys
(
£lf
))

128 #CÚfig 
Çme¥aû
 
hªdËrs


130 
def
 
	$hooks_Çme¥aû
(
k
, 
v
):

132 #U£ 
¥l™
 
agaš
 
to
 
®low
 
muÉË
 
hooks
 
a
 
sšgË


133 #hookpošˆ
³r
 
	`·th
 (
e
.
g
. "hooks.before_handler.1").

134 #L™e-
known
 
çù
 
you
 
Úly
 
g‘
 
äom
 
»adšg
 
sourû
 ;)

135 
hookpošt
 = 
k
.
	`¥l™
(".", 1)[0]

136 
	$isš¡ªû
(
v
, 
ba£¡ršg
):

137 
v
 = 
ch”rypy
.
lib
.
	$©Œibu‹s
(
v
)

138 
nÙ
 
	$isš¡ªû
(
v
, 
Hook
):

139 
v
 = 
	$Hook
(
v
)

140 
ch”rypy
.
£rvšg
.
»que¡
.
hooks
[
hookpošt
].
	$­³nd
(
v
)

142 
def
 
	$»que¡_Çme¥aû
(
k
, 
v
):

144 #Provide 
cÚfig
 
’Œ›s
 
to
 
£t
 
»que¡
.
body
 
	`©Œs
 (
like
 
©‹m±_ch¬£ts
).

145 
k
[:5] == 'body.':

146 
	`£‰r
(
ch”rypy
.
£rvšg
.
»que¡
.
body
, 
k
[5:], 
v
)

148 
	$£‰r
(
ch”rypy
.
£rvšg
.
»que¡
, 
k
, 
v
)

150 
def
 
	$»¥Ú£_Çme¥aû
(
k
, 
v
):

152 #Provide 
cÚfig
 
’Œ›s
 
to
 
£t
  
»¥Ú£
 
h—d”s


154 
k
[:8] == 'headers.':

155 
ch”rypy
.
£rvšg
.
»¥Ú£
.
h—d”s
[
k
.
	`¥l™
('.', 1)[1]] = 
v


157 
	$£‰r
(
ch”rypy
.
£rvšg
.
»¥Ú£
, 
k
, 
v
)

159 
def
 
	$”rÜ_·ge_Çme¥aû
(
k
, 
v
):

161 
k
 != 'default':

162 
k
 = (k)

163 
ch”rypy
.
£rvšg
.
»que¡
.
”rÜ_·ge
[
k
] = 
v


166 
hookpošts
 = ['on_start_resource', 'before_request_body',

172 
şass
 
	$Reque¡
(
objeù
):

175 
This
 
objeù
 
»´e£Ás
 
the
 
m‘ad©a
 
of
 
ª
 
HTTP
 
»que¡
 
mes§ge
;

176 
th©
 
is
, 
™
 
cÚšs
 
©Œibu‹s
 
which
 
desüibe
 
the
 
’vœÚm’t


177 
š
 
which
 
the
 
»que¡
 
URL
, 
h—d”s
, 
ªd
 
body
 
w”e
 
	`£Á
 (
you


178 
wªt
 
toŞs
 
to
 
š‹½»t
 
the
 
h—d”s
 
ªd
 
body
, 
tho£
 
¬e
 
–£wh”e
,

179 
mo¡ly
 
š
 
ToŞs
). 
This
 'm‘ad©a' 
cÚsi¡s
 
of
 
sock‘
 
d©a
,

180 
Œª¥Üt
 
ch¬aù”i¡ics
, 
ªd
 
the
 
Reque¡
-
Lše
. 
This
 
objeù


181 
®so
 
cÚšs
 
d©a
 
»g¬dšg
 
the
 
cÚfigu¿tiÚ
 
š
 
efãù
 

182 
the
 
giv’
 
URL
, 
ªd
h
executiÚ
 
¶ª
 
g’”©šg
 
a
 
»¥Ú£
.

185 
´ev
 = 
NÚe


187 
The
 
´evious
 
Reque¡
 
	`objeù
 (
ªy
). 
This
 
should
 
be
 
NÚe


188 
uÆess
 
we
 
¬e
 
´oûssšg
 
ª
 
IÁ”ÇlRedœeù
."""

190 #CÚv”§tiÚ/
cÚÃùiÚ
 
©Œibu‹s


191 
loÿl
 = 
h‰put
.
	`Ho¡
("127.0.0.1", 80)

194 
»mÙe
 = 
h‰put
.
	`Ho¡
("127.0.0.1", 1111)

197 
scheme
 = "http"

199 
The
 
´ÙocŞ
 
u£d
 
b‘w“n
 
ş›Á
 
ªd
 
£rv”
. 
In
 
mo¡
 
ÿ£s
,

200 
this
 
wl
 
be
 
e™h”
 'h‰p' 
Ü
 'https'."""

202 
£rv”_´ÙocŞ
 = "HTTP/1.1"

204 
The
 
HTTP
 
v”siÚ
 
which
 
the
 HTTP 
£rv”
 
is
 
©
 
Ëa¡


205 
cÚd™iÚ®ly
 
com¶ŸÁ
."""

207 
ba£
 = ""

209 
In
 
some
 
	`ÿ£s
 (
e
.
g
. 
wh’
 
´oxyšg
 
vŸ
 
mod_»wr™e
), 
this
 
may
 
cÚš


210 
·th
 
£gm’ts
 
which
 
ch”rypy
.
u¾
 
u£s
 
wh’
 
cÚ¡ruùšg
 url's, but

211 
which
 
Ùh”wi£
 
¬e
 
ignÜed
 
by
 
Ch”ryPy
. 
Reg¬dËss
, 
this
 
v®ue


212 
MUST
 
NOT
 
’d
 
š
 
a
 
¦ash
."""

214 #Reque¡-
Lše
 
©Œibu‹s


215 
»que¡_lše
 = ""

217 
The
 
com¶‘e
 
Reque¡
-
Lše
 
»ûived
 
äom
 
the
 
ş›Á
. 
This
 
is
 
a


218 
sšgË
 
¡ršg
 
cÚsi¡šg
 
of
 
the
 
»que¡
 
m‘hod
, 
URI
, 
ªd
 
´ÙocŞ


219 
	`v”siÚ
 (
jošed
 
by
 
¥aûs
). 
Any
 
fš®
 
CRLF
 
is
 
»moved
."""

221 
m‘hod
 = "GET"

223 
Indiÿ‹s
 
the
 
HTTP
 
m‘hod
 
to
 
be
 
³rfÜmed
 
Ú
h
»sourû
 
id’tif›d


224 
by
 
the
 
Reque¡
-
URI
. 
CommÚ
 
m‘hods
 
šşude
 
GET
, 
HEAD
, 
POST
, 
PUT
, 
ªd


225 
DELETE
. 
Ch”ryPy
 
®lows
 
ªy
 
ex‹nsiÚ
 
m‘hod
; 
howev”
, 
v¬ious
 
HTTP


226 
£rv”s
 
ªd
 
g©eways
 
may
 
»¡riù
 
the
 
£t
 
of
 
®lowabË
 
m‘hods
.

227 
Ch”ryPy
 
­¶iÿtiÚs
 
SHOULD
 
»¡riù
 
the
 
	`£t
 (
Ú
 
a
 
³r
-
URI
 
basis
)."""

229 
qu”y_¡ršg
 = ""

231 
The
 
qu”y
 
compÚ’t
 
of
 
the
 
Reque¡
-
URI
, 
a
 
¡ršg
 oà
šfÜm©iÚ
 
to
 
be


232 
š‹½»‹d
 
by
 
the
 
»sourû
. 
The
 
qu”y
 
pÜtiÚ
 
of
 
a
 
URI
 
fŞlows
he

233 
·th
 
compÚ’t
, 
ªd
 
is
 
£·¿‹d
 
by
 
a
 '?'. 
FÜ
 
exam¶e
, 
the
 
URI


234 'h‰p://www.ch”rypy.Üg/wiki?a=3&b=4' 
has
 
the
 
qu”y
 
compÚ’t
,

237 
qu”y_¡ršg_’codšg
 = 'utf8'

239 
The
 
’codšg
 
ex³ùed
 
qu”y
 
¡ršg
 
¬gum’ts
 
aá”
 % 
HEX
 HEX 
decodšg
).

240 
If
 
a
 
qu”y
 
¡ršg
 
is
 
´ovided
 
th©
 
ÿÂÙ
 
be
 
decoded
 
w™h
 
this
 
’codšg
,

241 404 
is
 
	`¿i£d
 (
sšû
 
‹chniÿÎy
 
™
's‡ different URI). If you want

242 
¬b™¿ry
 
’codšgs
 
to
 
nÙ
 
”rÜ
, 
£t
 
this
Ø'L©š-1'; 
you
 
ÿn
 
th’


243 
’code
 
back
 
to
 
by‹s
 
ªd
 
»
-
decode
Ø
wh©ev”
 
’codšg
 
you
 
like
 
Ï‹r
.

246 
´ÙocŞ
 = (1, 1)

248 
of
 
ã©u»s
 
which
 
should
 
be
 
®lowed
 
š
 
the
 
»¥Ú£
. 
If
 
BOTH


249 
the
 
ş›Á
' »que¡ mes§gANDh£rv”'
s
 
Ëv–
 
of
 
HTTP


250 
com¶Ÿnû
 
is
 
HTTP
/1.1, 
this
 
©Œibu‹
 
wl
 
be
 
the
 
	`tu¶e
 (1, 1).

251 
If
 
e™h”
 
is
 1.0, 
this
 
©Œibu‹
 
wl
 
be
 
the
 
	`tu¶e
 (1, 0).

252 
Low”
 
HTTP
 
´ÙocŞ
 
v”siÚs
 
¬e
 
nÙ
 
ex¶ic™ly
 
suµÜ‹d
."""

254 
·¿ms
 = {
	}
}

256 
A
 
diù
 
which
 
combšes
 
qu”y
 
	$¡ršg
 (
GET
è
ªd
 
»que¡
 
	$’t™y
 (
POST
)

257 
v¬ŸbËs
. 
This
 
is
 
pİuÏ‹d
 
š
 
two
 
¡ages
: 
GET
 
·¿ms
 
¬e
 
added


258 
befÜe
 
the
 'Ú_¡¬t_»sourû' 
hook
, 
ªd
 
POST
 
·¿ms
 
¬e
 
added


259 
b‘w“n
 
the
 'befÜe_»que¡_body' 
ªd
 'befÜe_hªdËr' 
hooks
."""

261 #Mes§g
©Œibu‹s


262 
h—d”_li¡
 = []

264 
A
 
li¡
 
of
 
the
 
HTTP
 
»que¡
 
h—d”s
 
	$as
 (
Çme
, 
v®ue
è
tu¶es
.

265 
In
 
g’”®
, 
you
 
should
 
u£
 
»que¡
.
	$h—d”s
 (
a
 
diù
è
š¡—d
."""

267 
h—d”s
 = 
h‰put
.
	`H—d”M­
()

269 
A
 
diù
-
like
 
objeù
 
cÚššg
 
the
 
»que¡
 
h—d”s
. 
Keys
 
¬e
 
h—d”


270 
	`Çmes
 (
š
 
T™Ë
-
Ca£
 
fÜm©
); 
howev”
, 
you
 
may
 
g‘
 
ªd
 
£t
 
them
 in

271 
a
 -
š£ns™ive
 
mªÃr
. 
Th©
 
is
, 
h—d”s
['CÚ‹Á-Ty³'] 
ªd


272 
h—d”s
['cÚ‹Á-ty³'] 
»ãr
 
to
 
the
 
§me
 
v®ue
. 
V®ues
 
¬e
 
h—d”


273 
	`v®ues
 (
decoded
 
accÜdšg
 
to
 :
rfc
:`2047` 
Ãûs§ry
). 
S“
 
®so
:

274 
h‰put
.
H—d”M­
, h‰put.
H—d”EËm’t
."""

276 
cook›
 = 
	`Sim¶eCook›
()

279 
rfe
 = 
NÚe


281 
If
 
the
 
»que¡
 
šşuded
 
ª
 
	`’t™y
 (
body
), 
™
 
wl
 
be
 
avaabË


282 
as
 
a
 
¡»am
 
š
 
this
 
©Œibu‹
. 
Howev”
, 
the
 
rfe
 
wl
 
nÜm®ly


283 
be
 
»ad
 
you
 
b‘w“n
 
the
 'befÜe_»que¡_body' 
hook
 
ªd
he

284 'befÜe_hªdËr' 
hook
, 
ªd
 
the
 
»suÉšg
 
¡ršg
 
is
 
¶aûd
 
što


285 
e™h”
 
»que¡
.
·¿ms
 
Ü
 
the
„eque¡.
body
 
©Œibu‹
.

287 
You
 
may
 
di§bË
 
the
 
autom©ic
 
cÚsum±iÚ
 
of
h
rfe
 
by
 
£‰šg


288 
»que¡
.
´oûss_»que¡_body
 
to
 
F®£
, 
e™h”
 
š
 
cÚfig
 
the
 
desœed


289 
·th
, 
Ü
 
š
 
ª
 'Ú_¡¬t_»sourû' o¸'befÜe_»que¡_body' 
hook
.

291 
WARNING
: 
In
 
®mo¡
 
ev”y
 , 
you
 
should
 
nÙ
 
©‹m±
 
to
 
»ad
 
äom
 
the


292 
rfe
 
¡»am
 
aá”
 
Ch”ryPy
's‡utomatic mechanism has„ead it. If you

293 
tuº
 
off
 
the
 
autom©ic
 
·rsšg
 
of
 
rfe
, 
you
 
should
 
»ad
 
exaùly
he

294 
numb”
 
of
 
by‹s
 
¥ecif›d
 
š
 
»que¡
.
h—d”s
['Content-Length'].

295 
IgnÜšg
 
e™h”
 
of
 
the£
 
w¬nšgs
 
may
 
»suÉ
 
š
 
a
 
hung
 
»que¡
 
th»ad


296 
Ü
 
š
 
cÜru±iÚ
 
of
 
the
 
	$Ãxt
 (
p–šed
è
»que¡
.

299 
´oûss_»que¡_body
 = 
True


301 
If
 
True
, 
the
 
	$rfe
 (
ªy
è
is
 
autom©iÿÎy
 
»ad
 
ªd
 
·r£d
,

302 
ªd
 
the
 
»suÉ
 
¶aûd
 
što
 
»que¡
.
·¿ms
 
Ü
„eque¡.
body
."""

304 
m‘hods_w™h_bod›s
 = ("POST", "PUT")

306 
A
 
£qu’û
 
of
 
HTTP
 
m‘hods
 
which
 
Ch”ryPy
 
wl
 
autom©iÿÎy


307 
©‹m±
 
to
 
»ad
 
a
 
body
 
äom
 
the
 
rfe
."""

309 
body
 = 
NÚe


311 
If
 
the
 
»que¡
 
CÚ‹Á
-
Ty³
 
is
 'application/x-www-form-urlencoded'

312 
Ü
 
muÉ¬t
, 
this
 
wl
 
be
 
NÚe
. 
Oth”wi£
,hi wÈb
ª
 
š¡ªû


313 
of
 :
şass
:`
Reque¡Body
<
ch”rypy
.
_ı»qbody
.Reque¡Body>` (
which
 
you


314 
ÿn
 .
	`»ad
()); 
this
 
v®ue
 
is
 
£t
 
b‘w“n
 
the
 'befÜe_»que¡_body' 
ªd


315 'befÜe_hªdËr' 
	`hooks
 (
assumšg
 
th©
 
´oûss_»que¡_body
 
is
 
True
)."""

317 #Di¥©ch 
©Œibu‹s


318 
di¥©ch
 = 
ch”rypy
.di¥©ch.
	`Di¥©ch”
()

320 
The
 
objeù
 
which
 
looks
 
up
 
the
 '·ghªdËr' 
ÿÎabË
 
ªd
 
cŞËùs


321 
cÚfig
 
the
 
cu¼’t
 
»que¡
 
ba£d
 
Ú
h
·th_šfo
, 
Ùh”


322 
»que¡
 
©Œibu‹s
, 
ªd
 
the
 
­¶iÿtiÚ
 
¬ch™eùu»
. 
The
 
cÜe


323 
ÿÎs
 
the
 
di¥©ch”
 
as
 
—¾y
‡ 
possibË
, 
·ssšg
 
™
 
a
 'path_info'

324 
¬gum’t
.

326 
The
  
di¥©ch”
 
discov”s
 
the
 
·ge
 
hªdËr
 
by
 
m©chšg
 
·th_šfo


327 
to
 
a
 
h›¿rchiÿl
 
¬¿ngem’t
 
of
 
objeùs
, 
¡¬tšg
 
©
 
»que¡
.
­p
.
roÙ
.

328 
S“
 
	$h–p
(
ch”rypy
.
di¥©ch
è
mÜe
 
šfÜm©iÚ
."""

330 
süt_Çme
 = ""

332 
The
 'mouÁ…ošt' 
of
 
the
 
­¶iÿtiÚ
 
which
 
is
 
hªdlšg
 
this
 
»que¡
.

334 
This
 
©Œibu‹
 
MUST
 
NOT
 
’d
 
š
 
a
 
¦ash
. 
If
 
the
 
süt_Çme
 
»ãrs
 
to


335 
the
 
roÙ
 
of
h
URI
, 
™
 
MUST
 
be
 
ª
 
em±y
 
	`¡ršg
 (
nÙ
 "/").

338 
·th_šfo
 = "/"

340 
The
 '»Ïtiv·th' 
pÜtiÚ
 
of
 
the
 
Reque¡
-
URI
. 
This
 
is
 
»Ïtive


341 
to
 
the
 
	`süt_Çme
 ('mouÁ…ošt'è
of
h
­¶iÿtiÚ
 
which
 
is


342 
hªdlšg
 
this
 
»que¡
."""

344 
logš
 = 
NÚe


346 
Wh’
 
auth’tiÿtiÚ
 
is
 
u£d
 
duršg
 
the
 
»que¡
 
´oûssšg
 
this
 is

347 
£t
 
to
 'F®£' 
™
 
çed
 
ªd
Ø
the
 'u£ºame' 
v®ue
 ™ 
sucûeded
.

348 
The
  'NÚe' 
im¶›s
 
th©
 
no
 
auth’tiÿtiÚ
 
h­³Ãd
."""

350 #NÙ
th©
 
ch”rypy
.
u¾
 
u£s
 "ià»que¡.­p:" 
to
 
d‘”mše
 
wh‘h”


351 #th
ÿÎ
 
is
 
duršg
 
a
 
»®
 
HTTP
 
»que¡
 
Ü
 
nÙ
. 
So
 
Ëave
 
this
 
NÚe
.

352 
­p
 = 
NÚe


355 
hªdËr
 = 
NÚe


357 
The
 
funùiÚ
, 
m‘hod
, 
Ü
 
Ùh”
 
ÿÎabË
 
which
 
Ch”ryPy
 
wl
 
ÿÎ
 
to


358 
´oduû
 
the
 
»¥Ú£
. 
The
 
discov”y
 
of
h
hªdËr
 
ªd
h
¬gum’ts


359 
™
 
wl
 
»ûive
 
¬e
 
d‘”mšed
 
by
 
the
 
»que¡
.
di¥©ch
 
objeù
.

360 
By
 , 
the
 
hªdËr
 
is
 
discov”ed
 
by
 
w®kšg
 
a
 
Œ“
 
of
 
objeùs


361 
¡¬tšg
 
©
 
»que¡
.
­p
.
roÙ
, 
ªd
 
is
 
th’
 
·s£d
 
®l
 
HTTP
 
·¿ms


362 (
äom
 
the
 
qu”y
 
¡ršg
 
ªd
 
POST
 
body
è
as
 
keywÜd
 
¬gum’ts
."""

364 
toŞm­s
 = {
	}
}

366 
A
 
Ã¡ed
 
diù
 
of
 
®l
 
ToŞboxes
 
ªd
 
ToŞs
 
š
 
efãù
 
this
 
»que¡
,

367 
of
 
the
 
	gfÜm
: {
ToŞbox
.
Çme¥aû
: {
ToŞ
.
Çme
: 
cÚfig
 
diù
}}."""

369 
cÚfig
 = 
NÚe


371 
A
 
æ©
 
diù
 
of
 
®l
 
cÚfigu¿tiÚ
 
’Œ›s
 
which
 
­¶y
 
to
 
the


372 
cu¼’t
 
»que¡
. 
The£
 
’Œ›s
 
¬e
 
cŞËùed
 
äom
 
glob®
 
cÚfig
,

373 
­¶iÿtiÚ
 
cÚfig
 (
ba£d
 
Ú
 
»que¡
.
·th_šfo
), 
ªd
 
äom
 
hªdËr


374 
cÚfig
 (
exaùly
 
how
 
is
 
gov”Ãd
 
by
 
the
 
»que¡
.
di¥©ch
 
objeù
 
š


375 
efãù
 
this
 
»que¡
; 
by
 , 
hªdËr
 
cÚfig
 
ÿn
 
be
 
©ched


376 
ªywh”e
 
š
 
the
 
Œ“
 
b‘w“n
 
»que¡
.
­p
.
roÙ
 
ªd
h
fš®
 
hªdËr
,

377 
ªd
 
šh”™s
 
downw¬d
)."""

379 
	gis_šdex
 = 
NÚe


381 
This
 
wl
 
be
 
True
 
the
 
cu¼’t
 
»que¡
 
is
 
m­³d
 
to
 
ª
 'index'

382 
»sourû
 
hªdËr
 (
®so
, 
a
 'deçuÉ' hªdË¸
·th_šfo
 
’ds
 
w™h


383 
a
 
¦ash
). 
The
 
v®ue
 
may
 
be
 
u£d
 
to
 
autom©iÿÎy
 
»dœeù
 
the


384 
	gu£r
-
ag’t
 
to
 
	ga
 'mÜÿnÚiÿl' 
URL
 
which
 
e™h”
 
adds
 
Ü
 
»moves


385 
the
 
Œašg
 
	g¦ash
. 
S“
 
	gch”rypy
.
	gtoŞs
.
	gŒašg_¦ash
."""

387 
	ghooks
 = 
HookM­
(
hookpošts
)

389 
A
 
HookM­
 (
diù
-
like
 
objeù
è
of
 
the
 
fÜm
: {
hookpošt
: [
hook
, ...]}.

390 
Each
 
key
 
is
 
a
 
¡r
 
Çmšg
 
the
 
hook
 
pošt
, 
ªd
 
—ch
 
v®ue
 i ¨
li¡


391 
of
 
hooks
 
which
 
wl
 
be
 
ÿÎed
 
©
 
th©
 
hook
 
pošt
 
duršg
 
this
 
	g»que¡
.

392 
The
 
li¡
 
of
 
hooks
 
is
 
g’”®ly
 
pİuÏ‹d
 
as
 
—¾y
‡ 
possibË
 (
mo¡ly


393 
äom
 
ToŞs
 
¥ecif›d
 
š
 
cÚfig
), 
but
 
may
 
be
 
ex‹nded
 
©
 
ªy
 
	gtime
.

394 
S“
 
	g®so
: 
_ı»que¡
.
Hook
, 
	g_ı»que¡
.
	gHookM­
, 
ªd
 
	gch”rypy
.
	gtoŞs
."""

396 
	g”rÜ_»¥Ú£
 = 
ch”rypy
.
HTTPE¼Ü
(500).
£t_»¥Ú£


398 
The
 
no
-
¬g
 
ÿÎabË
 
which
 
wl
 
hªdË
 
uÃx³ùed
, 
uÁ¿µed
 
”rÜs


399 
duršg
 
»que¡
 
	g´oûssšg
. 
This
 
is
 
nÙ
 
u£d
 
ex³ùed
 
	gexû±iÚs


400 (
like
 
	gNÙFound
, 
	gHTTPE¼Ü
, 
Ü
 
	gHTTPRedœeù
è
which
 
¬e
 
¿i£d
 
š


401 
»¥Ú£
 
to
 
ex³ùed
 
cÚd™iÚs
 (
tho£
 
should
 
be
 
cu¡omized
 
e™h”


402 
vŸ
 
»que¡
.
”rÜ_·ge
 
Ü
 
by
 
ov”ridšg
 
HTTPE¼Ü
.
£t_»¥Ú£
).

403 
By
 , 
”rÜ_»¥Ú£
 
u£s
 
	$HTTPE¼Ü
(500è
to
  
a
 
g’”ic


404 
”rÜ
 
»¥Ú£
 
to
 
the
 
u£r
-
ag’t
."""

406 
”rÜ_·ge
 = {
	}
}

408 
A
 
diù
 
of
 {
”rÜ
 
code
: 
»¥Ú£
 
f’ame
 
Ü
 
ÿÎabË
} 
·œs
.

410 
The
 
”rÜ
 
code
 
mu¡
 
be
 
ª
 
»´e£Ášg
 
a
 
giv’
 
HTTP
ƒrror code,

411 
Ü
 
the
 
	g¡ršg
 'deçuÉ', 
which
 
wl
 
be
 
u£d
 
no
 
m©chšg
 
’Œy


412 
is
 
found
 
a
 
giv’
 
num”ic
 
	gcode
.

414 
If
 
a
 
f’ame
 
is
 
	g´ovided
, 
the
 
fe
 
should
 
cÚš
‡ 
PythÚ
 
	g¡ršg
-

415 
fÜm©tšg
 
	g‹m¶©e
, 
ªd
 
ÿn
 
ex³ù
 
by
  
to
 
»ûive
 
fÜm©


416 
v®ues
 
w™h
 
the
 
m­pšg
 
	gkeys
 %(
	g¡©us
)
	gs
, %(
	gmes§ge
)s, %(
	gŒaûback
)s,

417 
	gªd
 %(
	gv”siÚ
)
	gs
. 
The
 
£t
 
of
 
fÜm©
 
m­pšgs
 
ÿn
 
be
 
ex‹nded
 
by


418 
ov”ridšg
 
	gHTTPE¼Ü
.
	g£t_»¥Ú£
.

420 
If
 
a
 
ÿÎabË
 
is
 
	g´ovided
, 
™
 
wl
 
be
 
ÿÎed
 
by
  
w™h
 
keywÜd


421 
	g¬gum’ts
 '¡©us', 'mes§ge', 'Œaûback', 
	gªd
 'v”siÚ', 
as
 
a


422 
	g¡ršg
-
fÜm©tšg
 
	g‹m¶©e
. 
The
 
ÿÎabË
 
mu¡
  
a
 
¡ršg
 
Ü
 
™”abË
 
of


423 
¡ršgs
 
which
 
wl
 
be
 
£t
 
to
 
	g»¥Ú£
.
	gbody
. 
It
 
may
 
®so
 
ov”ride
 
h—d”s
 
Ü


424 
³rfÜm
 
ªy
 
Ùh”
 
	g´oûssšg
.

426 
If
 
no
 
’Œy
 
is
 
giv’
 
ª
 
”rÜ
 
	gcode
, 
ªd
 
	gno
 'deçuÉ'ƒÁry 
	gexi¡s
,

427 
a
  
‹m¶©e
 
wl
 
be
 
	gu£d
.

430 
	gshow_Œaûbacks
 = 
True


432 
If
 
True
, 
uÃx³ùed
 
”rÜs
 
’couÁ”ed
 
duršg
 
»que¡
 
´oûssšg
 
wl


433 
šşude
 
a
 
Œaûback
 
š
 
the
 
»¥Ú£
 
	gbody
."""

435 
	gshow_mism©ched_·¿ms
 = 
True


437 
If
 
True
, 
mism©ched
 
·¿m‘”s
 
’couÁ”ed
 
duršg
 
PageHªdËr
 
švoÿtiÚ


438 
´oûssšg
 
wl
 
be
 
šşuded
 
š
 
the
 
»¥Ú£
 
	gbody
."""

440 
	gthrows
 = (
KeybßrdIÁ”ru±
, 
	gSy¡emEx™
, 
	gch”rypy
.
	gIÁ”ÇlRedœeù
)

443 
	gthrow_”rÜs
 = 
F®£


445 
If
 
True
, 
	gReque¡
.
run
 
wl
 
nÙ
 
Œ­
 
ªy
 
”rÜs
 (
exû±
 
HTTPRedœeù
 
ªd


446 
HTTPE¼Ü
, 
which
 
¬e
 
mÜe
 
´İ”ly
 
ÿÎed
 'exû±iÚs', 
nÙ
 
”rÜs
)."""

448 
	gşo£d
 = 
F®£


451 
¡age
 = 
NÚe


453 
A
 
¡ršg
 
cÚššg
 
the
 
¡age
 
»ached
 
š
h
»que¡
-
hªdlšg
 
´oûss
.

454 
This
 
is
 
u£ful
 
wh’
 
debuggšg
 
a
 
live
 
£rv”
 
w™h
 
hung
 
»que¡s
."""

456 
Çme¥aûs
 = 
_ıcÚfig
.
Name¥aûS‘
(

457 **{"hooks": 
hooks_Çme¥aû
,

458 "»que¡": 
»que¡_Çme¥aû
,

459 "»¥Ú£": 
»¥Ú£_Çme¥aû
,

460 "”rÜ_·ge": 
”rÜ_·ge_Çme¥aû
,

461 "toŞs": 
ch”rypy
.
toŞs
,

464 
def
 
__š™__
(
£lf
, 
loÿl_ho¡
, 
»mÙe_ho¡
, 
scheme
="http",

465 
£rv”_´ÙocŞ
="HTTP/1.1"):

468 
loÿl_ho¡
 
should
 
be
 
ª
 
h‰put
.
Ho¡
 
objeù
 
w™h
 
the
 
£rv”
 
šfo
.

469 
»mÙe_ho¡
 
should
 
be
 
ª
 
h‰put
.
Ho¡
 
objeù
 
w™h
 
the
 
ş›Á
 
šfo
.

470 
scheme
 
should
 
be
 
a
 
¡ršg
, 
	ge™h”
 "h‰p" 
	gÜ
 "https".

472 
	g£lf
.
	gloÿl
 = 
loÿl_ho¡


473 
£lf
.
»mÙe
 = 
»mÙe_ho¡


474 
£lf
.
scheme
 = scheme

475 
£lf
.
£rv”_´ÙocŞ
 = server_protocol

477 
£lf
.
şo£d
 = 
F®£


479 #Puˆ
a
 *
cİy
* 
of
 
the
 
şass
 
”rÜ_·ge
 
što
 
£lf
.

480 
£lf
.
”rÜ_·ge
 = s–f.”rÜ_·ge.
	$cİy
()

482 #Puˆ
a
 *
cİy
* 
of
 
the
 
şass
 
Çme¥aûs
 
što
 
£lf
.

483 
£lf
.
Çme¥aûs
 = s–f.Çme¥aûs.
	$cİy
()

485 
£lf
.
¡age
 = 
NÚe


487 
def
 
	$şo£
(
£lf
):

489 
nÙ
 
£lf
.
şo£d
:

490 
£lf
.
şo£d
 = 
True


491 
£lf
.
¡age
 = 'on_end_request'

492 
£lf
.
hooks
.
	`run
('on_end_request')

493 
£lf
.
¡age
 = 'close'

495 
def
 
	$run
(
£lf
, 
m‘hod
, 
·th
, 
qu”y_¡ršg
, 
»q_´ÙocŞ
, 
h—d”s
, 
rfe
):

496 
r
"""Processhe Request. (Core)

498 
m‘hod
, 
·th
, 
qu”y_¡ršg
, 
ªd
 
»q_´ÙocŞ
 
should
 
be
 
puÎed
 
dœeùly


499 
äom
 
the
 
Reque¡
-
	`Lše
 (
e
.
g
. "GET /path?key=val HTTP/1.0").

501 
·th


502 
This
 
should
 
be
 %
XX
-
unquÙed
, 
but
 
qu”y_¡ršg
 should 
nÙ
 be.

504 
Wh’
 
usšg
 
PythÚ
 2, 
they
 
bÙh
 
MUST
 
be
 
by‹
 
¡ršgs
,

505 
nÙ
 
unicode
 
¡ršgs
.

507 
Wh’
 
usšg
 
PythÚ
 3, 
they
 
bÙh
 
MUST
 
be
 
unicode
 
¡ršgs
,

508 
nÙ
 
by‹
 
¡ršgs
, 
ªd
 
´eã¿bly
‚Ù 
by‹s
 \
x00
-\
xFF


509 
disgui£d
 
as
 
unicode
.

511 
h—d”s


512 
A
 
li¡
 
	$of
 (
Çme
, 
v®ue
è
tu¶es
.

514 
rfe


515 
A
 
fe
-
like
 
objeù
 
cÚššg
 
the
 
HTTP
 
»que¡
 
’t™y
.

517 
Wh’
 
	$run
(è
is
 
dÚe
, 
the
 
»tuºed
 
objeù
 
should
 
have
 3 
©Œibu‹s
:

519 * 
¡©us
, 
e
.
g
. "200 OK"

520 * 
h—d”_li¡
, 
a
 
li¡
 
	$of
 (
Çme
, 
v®ue
è
tu¶es


521 * 
body
, 
ª
 
™”abË
 
y›ldšg
 
¡ršgs


523 
CÚsum”
 
	$code
 (
HTTP
 
£rv”s
è
should
 
th’
 
acûss
 
the£
 
»¥Ú£


524 
©Œibu‹s
 
to
 
bud
 
the
 
outbound
 
¡»am
.

527 
»¥Ú£
 = 
ch”rypy
.
£rvšg
.response

528 
£lf
.
¡age
 = 'run'

529 
Œy
:

530 
£lf
.
”rÜ_»¥Ú£
 = 
ch”rypy
.
	`HTTPE¼Ü
(500).
£t_»¥Ú£


532 
£lf
.
m‘hod
 = method

533 
·th
 =…©h 
Ü
 "/"

534 
£lf
.
qu”y_¡ršg
 = qu”y_¡ršg 
Ü
 ''

535 
£lf
.
·¿ms
 = {
	}
}

537 #Com·» 
»que¡
 
ªd
 
£rv”
 
HTTP
 
´ÙocŞ
 
v”siÚs
, 
š
 
our


538 #£rv” 
dÛs
 
nÙ
 
suµÜt
 
the
 
»que¡ed
 
´ÙocŞ
. 
Lim™
 
our
 
ouut


539 #tØ
mš
(
»q
, 
£rv”
). 
We
 
wªt
 
the
 
fŞlowšg
 
ouut
:

540 #»que¡ 
£rv”
 
aùu®
 
wr™‹n
 
suµÜ‹d
 
»¥Ú£


541 #´ÙocŞ 
´ÙocŞ
 
»¥Ú£
…rÙocŞ 
ã©u»
 
£t


546 #NÙiû 
th©
, 
š
 (
b
), 
the
 
»¥Ú£
 
wl
 
be
 "HTTP/1.1" 
ev’
 
though


547 #th
ş›Á
 
Úly
 
und”¡ªds
 1.0. 
RFC
 2616 10.5.6 
§ys
 
we
 
should


548 #Úly  505 
the
 
_majÜ_
 
v”siÚ
 
is
 
difã»Á
.

549 
	g½
 = (
»q_´ÙocŞ
[5]), (req_protocol[7])

550 
¥
 = (
£lf
.
£rv”_´ÙocŞ
[5]), (self.server_protocol[7])

551 
£lf
.
´ÙocŞ
 = 
	$mš
(
½
, 
¥
)

552 
»¥Ú£
.
h—d”s
.
´ÙocŞ
 = 
£lf
.protocol

554 #Rebud 
fœ¡
 
lše
 
of
 
the
 
	`»que¡
 (
e
.
g
. "GET /path HTTP/1.0").

555 
u¾
 = 
·th


556 
qu”y_¡ršg
:

557 
u¾
 +ğ'?' + 
qu”y_¡ršg


558 
£lf
.
»que¡_lše
 = '% % %s' % (
m‘hod
, 
u¾
, 
»q_´ÙocŞ
)

560 
£lf
.
h—d”_li¡
 = 
	$li¡
(
h—d”s
)

561 
£lf
.
h—d”s
 = 
h‰put
.
	$H—d”M­
()

563 
£lf
.
rfe
 =„file

564 
£lf
.
body
 = 
NÚe


566 
£lf
.
cook›
 = 
	$Sim¶eCook›
()

567 
£lf
.
hªdËr
 = 
NÚe


569 #·th_šfØ
should
 
be
 
the
 
·th
 
äom
he

570 #­°
	`roÙ
 (
süt_Çme
è
to
 
the
 
hªdËr
.

571 
£lf
.
süt_Çme
 = s–f.
­p
.script_name

572 
£lf
.
·th_šfo
 = 
pi
 = 
·th
[
	$Ën
(
£lf
.
süt_Çme
):]

574 
£lf
.
¡age
 = 'respond'

575 
£lf
.
	$»¥Úd
(
pi
)

577 
exû±
 
£lf
.
throws
:

578 
¿i£


579 
exû±
:

580 
£lf
.
throw_”rÜs
:

581 
¿i£


583 #Fau» 
š
 
£tup
, 
”rÜ
 
hªdËr
 
Ü
 
fš®ize
. 
By·ss
 
them
.

585 
ch”rypy
.
	$log
(
Œaûback
=
True
, 
£v”™y
=40)

586 
£lf
.
show_Œaûbacks
:

587 
body
 = 
	$fÜm©_exc
()

589 
body
 = ""

590 
r
 = 
	$b¬e_”rÜ
(
body
)

591 
»¥Ú£
.
ouut_¡©us
,„e¥Ú£.
h—d”_li¡
,„e¥Ú£.
body
 = 
r


593 
£lf
.
m‘hod
 == "HEAD":

594 #HEAD 
»que¡s
 
MUST
 
NOT
  
a
 
mes§ge
-
body
 
š
 
the
 
»¥Ú£
.

595 
»¥Ú£
.
body
 = []

597 
Œy
:

598 
ch”rypy
.
log
.
	$acûss
()

599 
exû±
:

600 
ch”rypy
.
log
.
	$”rÜ
(
Œaûback
=
True
)

602 
»¥Ú£
.
timed_out
:

603 
¿i£
 
ch”rypy
.
	$TimeoutE¼Ü
()

605  
»¥Ú£


607 #Uncomm’ˆ
¡age
 
debuggšg


608 #¡agğ
	`´İ”ty
(
Ïmbda
 
£lf
: s–f.
_¡age
,†ambd¨£lf, 
v
: 
	`´št
(v))

610 
def
 
	$»¥Úd
(
£lf
, 
·th_šfo
):

612 
»¥Ú£
 = 
ch”rypy
.
£rvšg
.response

613 
Œy
:

614 
Œy
:

615 
Œy
:

616 
£lf
.
­p
 
is
 
NÚe
:

617 
¿i£
 
ch”rypy
.
	$NÙFound
()

619 #G‘ 
the
 'Ho¡' 
h—d”
, 
so
 
we
 
ÿn
 
HTTPRedœeù
 
´İ”ly
.

620 
£lf
.
¡age
 = 'process_headers'

621 
£lf
.
	$´oûss_h—d”s
()

623 #Mak
a
 
cİy
 
of
 
the
 
şass
 
hooks


624 
£lf
.
hooks
 = s–f.
__şass__
.hooks.
	$cİy
()

625 
£lf
.
toŞm­s
 = {
	}
}

627 
£lf
.
¡age
 = 'get_resource'

628 
£lf
.
	$g‘_»sourû
(
·th_šfo
)

630 
£lf
.
body
 = 
_ı»qbody
.
	$Reque¡Body
(

631 
£lf
.
rfe
, s–f.
h—d”s
, 
»que¡_·¿ms
=£lf.
·¿ms
)

633 
£lf
.
	$Çme¥aûs
(
£lf
.
cÚfig
)

635 
£lf
.
¡age
 = 'on_start_resource'

636 
£lf
.
hooks
.
	`run
('on_start_resource')

638 #P¬£ 
the
 
qu”y¡ršg


639 
£lf
.
¡age
 = 'process_query_string'

640 
£lf
.
	$´oûss_qu”y_¡ršg
()

642 #Proûs 
the
 
body


643 
£lf
.
´oûss_»que¡_body
:

644 
£lf
.
m‘hod
 
nÙ
 
š
 s–f.
m‘hods_w™h_bod›s
:

645 
£lf
.
´oûss_»que¡_body
 = 
F®£


646 
£lf
.
¡age
 = 'before_request_body'

647 
£lf
.
hooks
.
	`run
('before_request_body')

648 
£lf
.
´oûss_»que¡_body
:

649 
£lf
.
body
.
	$´oûss
()

651 #RuÀ
the
 
hªdËr


652 
£lf
.
¡age
 = 'before_handler'

653 
£lf
.
hooks
.
	`run
('before_handler')

654 
£lf
.
hªdËr
:

655 
£lf
.
¡age
 = 'handler'

656 
»¥Ú£
.
body
 = 
£lf
.
	$hªdËr
()

659 
£lf
.
¡age
 = 'before_finalize'

660 
£lf
.
hooks
.
	`run
('before_finalize')

661 
»¥Ú£
.
	$fš®ize
()

662 
	$exû±
 (
ch”rypy
.
HTTPRedœeù
, ch”rypy.
HTTPE¼Ü
):

663 
š¡
 = 
sys
.
	`exc_šfo
()[1]

664 
š¡
.
	$£t_»¥Ú£
()

665 
£lf
.
¡age
 = 'before_finalize (HTTPError)'

666 
£lf
.
hooks
.
	`run
('before_finalize')

667 
»¥Ú£
.
	$fš®ize
()

668 
fš®ly
:

669 
£lf
.
¡age
 = 'on_end_resource'

670 
£lf
.
hooks
.
	`run
('on_end_resource')

671 
exû±
 
£lf
.
throws
:

672 
¿i£


673 
exû±
:

674 
£lf
.
throw_”rÜs
:

675 
¿i£


676 
£lf
.
	$hªdË_”rÜ
()

678 
def
 
	$´oûss_qu”y_¡ršg
(
£lf
):

680 
Œy
:

681 
p
 = 
h‰put
.
	$·r£_qu”y_¡ršg
(

682 
£lf
.
qu”y_¡ršg
, 
’codšg
=£lf.
qu”y_¡ršg_’codšg
)

683 
exû±
 
UnicodeDecodeE¼Ü
:

684 
¿i£
 
ch”rypy
.
	`HTTPE¼Ü
(

687 
£lf
.
qu”y_¡ršg_’codšg
)

689 #PythÚ 2 
Úly
: 
keywÜd
 
¬gum’ts
 
mu¡
 
be
 
by‹
 
	`¡ršgs
 (
ty³
 'str').

690 
nÙ
 
py3k
:

691 
key
, 
v®ue
 
š
 
p
.
	$™ems
():

692 
	$isš¡ªû
(
key
, 
unicode
):

693 
d–
 
p
[
key
]

694 
p
[
key
.
	`’code
(
£lf
.
qu”y_¡ršg_’codšg
)] = 
v®ue


695 
£lf
.
·¿ms
.
	$upd©e
(
p
)

697 
def
 
	$´oûss_h—d”s
(
£lf
):

699 #Proûs 
the
 
h—d”s
 
što
 
£lf
.headers

700 
h—d”s
 = 
£lf
.headers

701 
Çme
, 
v®ue
 
š
 
£lf
.
h—d”_li¡
:

702 #C®È
	`t™Ë
(è
	`now
 (
ªd
 
u£
 
diù
.
	`__m‘hod__
(
h—d”s
))

703 #sØ
t™Ë
 
dÛ¢
't haveo be calledwice.

704 
Çme
 =‚ame.
	$t™Ë
()

705 
v®ue
 = v®ue.
	$¡r
()

707 #W¬nšg: 
th”e
 
is
 
mÜe
 
thª
 
Úe
 
h—d”
 
’Œy
 
	`cook›s
 (
AFAIK
,

708 #Úly 
KÚqu”Ü
 
dÛs
 
th©
), 
Úly
 
the
 
Ï¡
 
Úe
 
wl
 
»maš
 
š
 
h—d”s


709 #(
but
 
they
 
wl
 
be
 
cÜ»ùly
 
¡Üed
 
š
 
»que¡
.
cook›
).

710 "=?" 
š
 
v®ue
:

711 
diù
.
	`__£t™em__
(
h—d”s
, 
Çme
, 
h‰put
.
	$decode_TEXT
(
v®ue
))

713 
diù
.
	$__£t™em__
(
h—d”s
, 
Çme
, 
v®ue
)

715 #HªdË 
cook›s
 
difã»Ály
 
beÿu£
 
Ú
 
KÚqu”Ü
, 
muÉË


716 #cook› 
come
 
Ú
 
difã»Á
 
lšes
 
w™h
 
the
 
§me
 
key


717 
Çme
 == 'Cookie':

718 
Œy
:

719 
£lf
.
cook›
.
	$lßd
(
v®ue
)

720 
exû±
 
Cook›E¼Ü
:

721 
msg
 = "IÎeg® cook›‚am%s" % 
v®ue
.
	`¥l™
('=')[0]

722 
¿i£
 
ch”rypy
.
	$HTTPE¼Ü
(400, 
msg
)

724 
nÙ
 
diù
.
	`__cÚšs__
(
h—d”s
, 'Host'):

725 #AÎ 
IÁ”Ãt
-
ba£d
 
HTTP
/1.1 
£rv”s
 
MUST
 
»¥Úd
 
w™h
 
a
 400

726 #(
Bad
 
Reque¡
è
¡©us
 
code
 
to
 
ªy
 
HTTP
/1.1 
»que¡
 
mes§ge


727 #which 
Ïcks
 
a
 
Ho¡
 
h—d”
 
f›ld
.

728 
£lf
.
´ÙocŞ
 >= (1, 1):

729 
msg
 = "HTTP/1.1„equires‡ 'Host'„equest header."

730 
¿i£
 
ch”rypy
.
	$HTTPE¼Ü
(400, 
msg
)

731 
ho¡
 = 
diù
.
	`g‘
(
h—d”s
, 'Host')

732 
nÙ
 
ho¡
:

733 
ho¡
 = 
£lf
.
loÿl
.
Çme
 
Ü
 s–f.loÿl.



734 
£lf
.
ba£
 = "%s://%s" % (£lf.
scheme
, 
ho¡
)

736 
def
 
	$g‘_»sourû
(
£lf
, 
·th
):

738 #Fœ¡, 
£e
 
th”e
 
is
 
a
 
cu¡om
 
di¥©ch
 
©
 
this
 
URI
. 
Cu¡om


739 #di¥©ch” 
ÿn
 
Úly
 
be
 
¥ecif›d
 
š
 
­p
.
cÚfig
, 
nÙ
 iÀ
_ı_cÚfig


740 #(
sšû
 
cu¡om
 
di¥©ch”s
 
may
 
nÙ
 
ev’
 
have
 
ª
 
­p
.
roÙ
).

741 
di¥©ch
 = 
£lf
.
­p
.
	`fšd_cÚfig
(
·th
, "request.dispatch", self.dispatch)

743 #di¥©ch(è
should
 
£t
 
£lf
.
hªdËr
 
ªd
 s–f.
cÚfig


744 
	$di¥©ch
(
·th
)

746 
def
 
	$hªdË_”rÜ
(
£lf
):

748 
Œy
:

749 
£lf
.
hooks
.
	`run
("before_error_response")

750 
£lf
.
”rÜ_»¥Ú£
:

751 
£lf
.
	$”rÜ_»¥Ú£
()

752 
£lf
.
hooks
.
	`run
("after_error_response")

753 
ch”rypy
.
£rvšg
.
»¥Ú£
.
	$fš®ize
()

754 
exû±
 
ch”rypy
.
HTTPRedœeù
:

755 
š¡
 = 
sys
.
	`exc_šfo
()[1]

756 
š¡
.
	$£t_»¥Ú£
()

757 
ch”rypy
.
£rvšg
.
»¥Ú£
.
	$fš®ize
()

759 #------------------------- 
Prİ”t›s
 ------------------------- #


760 
def
 
	$_g‘_body_·¿ms
(
£lf
):

761 
w¬nšgs
.
	`w¬n
(

764 
D•»ÿtiÚW¬nšg


766  
£lf
.
body
.
·¿ms


767 
body_·¿ms
 = 
	`´İ”ty
(
_g‘_body_·¿ms
,

768 
doc
= """

769 
If
 
the
 
»que¡
 
CÚ‹Á
-
Ty³
 
is
 '­¶iÿtiÚ/x-www-fÜm-u¾’coded' 
Ü


770 
muÉ¬t
, 
this
 
wl
 
be
 
a
 
diù
 
of
 
the
 
·¿ms
 
puÎed
 
äom
h
’t™y


771 
body
; 
th©
 
is
, 
™
 
wl
 
be
 
the
 
pÜtiÚ
 
of
 
»que¡
.
·¿ms
h© 
come


772 
äom
 
the
 
mes§ge
 
	`body
 (
som‘imes
 
ÿÎed
 "POST…¬ams", 
®though
 
they


773 
ÿn
 
be
 
£Á
 
w™h
 
v¬ious
 
HTTP
 
m‘hod
 
v”bs
). 
This
 
v®ue
 
is
 
£t
 
b‘w“n


774 
the
 'befÜe_»que¡_body' 
ªd
 'befÜe_hªdËr' 
	`hooks
 (
assumšg
 
th©


775 
´oûss_»que¡_body
 
is
 
True
).

777 
D•»ÿ‹d
 
š
 3.2, 
wl
 
be
 
»moved
 3.3 iÀ
çvÜ
 
of


778 :
©Œ
:`
»que¡
.
body
.
·¿ms
<
ch”rypy
.
_ı»que¡
.
Reque¡Body
.params>`.""")

781 
şass
 
	$Re¥Ú£Body
(
objeù
):

784 
py3k
:

785 
unicode_”r
 = ("Page handlers MUST„eturn bytes. Useools.encode "

788 
def
 
	$__g‘__
(
£lf
, 
obj
, 
objşass
=
NÚe
):

789 
obj
 
is
 
NÚe
:

790 #Wh’ 
ÿÎšg
 
Ú
 
the
 
şass
 
š¡—d
 
of
 
ª
 
š¡ªû
...

791  
£lf


793  
obj
.
_body


795 
def
 
	$__£t__
(
£lf
, 
obj
, 
v®ue
):

796 #CÚv”ˆ
the
 
giv’
 
v®ue
 
to
 
ª
 
™”abË
 
objeù
.

797 
py3k
 
ªd
 
	$isš¡ªû
(
v®ue
, 
¡r
):

798 
¿i£
 
	$V®ueE¼Ü
(
£lf
.
unicode_”r
)

800 
	$isš¡ªû
(
v®ue
, 
ba£¡ršg
):

801 #¡ršg 
g‘
 
w¿µed
 
š
 
a
 
li¡
 
beÿu£
 
™”©šg
 
ov”
‡ 
sšgË


802 #™em 
li¡
 
is
 
much
 
ç¡”
 
thª
 
™”©šg
 
ov”
 
ev”y
 
ch¬aù”


803 #š 
a
 
¡ršg
.

804 
v®ue
:

805 
v®ue
 = [value]

807 #[''] 
dÛ¢
'tƒvaluateo False, so„eplace it with [].

808 
v®ue
 = []

809 
–if
 
py3k
 
ªd
 
	$isš¡ªû
(
v®ue
, 
li¡
):

810 #ev”y 
™em
 
š
 
a
 
li¡
 
mu¡
 
be
 
by‹s
...

811 
i
, 
™em
 
š
 
	$’um”©e
(
v®ue
):

812 
	$isš¡ªû
(
™em
, 
¡r
):

813 
¿i£
 
	$V®ueE¼Ü
(
£lf
.
unicode_”r
)

815 #1000 
times
 
as
 as, 
§y
, 
	`isš¡ªû
(
v®ue
, 
¡r
)

816 
–if
 
	`ha§‰r
(
v®ue
, 'read'):

817 
v®ue
 = 
	$fe_g’”©Ü
(
v®ue
)

818 
–if
 
v®ue
 
is
 
NÚe
:

819 
v®ue
 = []

820 
obj
.
_body
 = 
v®ue


823 
şass
 
	$Re¥Ú£
(
objeù
):

826 
¡©us
 = ""

829 
h—d”_li¡
 = []

831 
A
 
li¡
 
of
 
the
 
HTTP
 
»¥Ú£
 
h—d”s
 
	$as
 (
Çme
, 
v®ue
è
tu¶es
.

832 
In
 
g’”®
, 
you
 
should
 
u£
 
»¥Ú£
.
	$h—d”s
 (
a
 
diù
è
š¡—d
. 
This


833 
©Œibu‹
 
is
 
g’”©ed
 
äom
 
»¥Ú£
.
h—d”s
 
ªd
 i 
nÙ
 
v®id
 
uÁ


834 
aá”
 
the
 
fš®ize
 
pha£
."""

836 
h—d”s
 = 
h‰put
.
	`H—d”M­
()

838 
A
 
diù
-
like
 
objeù
 
cÚššg
 
the
 
»¥Ú£
 
h—d”s
. 
Keys
 
¬e
 
h—d”


839 
	`Çmes
 (
š
 
T™Ë
-
Ca£
 
fÜm©
); 
howev”
, 
you
 
may
 
g‘
 
ªd
 
£t
 
them
 in

840 
a
 -
š£ns™ive
 
mªÃr
. 
Th©
 
is
, 
h—d”s
['CÚ‹Á-Ty³'] 
ªd


841 
h—d”s
['cÚ‹Á-ty³'] 
»ãr
 
to
 
the
 
§me
 
v®ue
. 
V®ues
 
¬e
 
h—d”


842 
	`v®ues
 (
decoded
 
accÜdšg
 
to
 :
rfc
:`2047` 
Ãûs§ry
).

844 .. 
£—lso
:: 
şas£s
 :
şass
:`
H—d”M­
`, :şass:`
H—d”EËm’t
`

847 
cook›
 = 
	`Sim¶eCook›
()

850 
body
 = 
	`Re¥Ú£Body
()

853 
time
 = 
NÚe


856 
timeout
 = 300

859 
timed_out
 = 
F®£


861 
FÏg
 
to
 
šdiÿ‹
 
the
 
»¥Ú£
 
should
 
be
 
abÜ‹d
, 
beÿu£
 
™
 
has


862 
exûeded
 
™s
 
timeout
."""

864 
¡»am
 = 
F®£


867 
def
 
	$__š™__
(
£lf
):

868 
£lf
.
¡©us
 = 
NÚe


869 
£lf
.
h—d”_li¡
 = 
NÚe


870 
£lf
.
_body
 = []

871 
£lf
.
time
 =ime.
	$time
()

873 
£lf
.
h—d”s
 = 
h‰put
.
	$H—d”M­
()

874 #Sšû 
we
 
know
 
®l
 
our
 
keys
 
¬e
 
t™Ëd
 
¡ršgs
, w
ÿn


875 #by·s 
H—d”M­
.
upd©e
 
ªd
 
g‘
 
a
 
big
 
¥“d
 
boo¡
.

876 
diù
.
	`upd©e
(
£lf
.
h—d”s
, {

878 "S”v”": "Ch”ryPy/" + 
ch”rypy
.
__v”siÚ__
,

879 "D©e": 
h‰put
.
	`HTTPD©e
(
£lf
.
time
),

880 
	}
})

881 
	g£lf
.
	gcook›
 = 
	$Sim¶eCook›
()

883 
def
 
	$cŞÏp£_body
(
£lf
):

885 
	$isš¡ªû
(
£lf
.
body
, 
ba£¡ršg
):

886  
£lf
.
body


888 
Ãwbody
 = []

889 
chunk
 
š
 
£lf
.
body
:

890 
py3k
 
ªd
 
nÙ
 
	$isš¡ªû
(
chunk
, 
by‹s
):

891 
¿i£
 
	`Ty³E¼Ü
("Chunk % i nÙ oàty³ 'by‹s'." % 
	$»´
(
chunk
))

892 
Ãwbody
.
	$­³nd
(
chunk
)

893 
Ãwbody
 = 
	`Áob
('').
	$još
(
Ãwbody
)

895 
£lf
.
body
 = 
Ãwbody


896  
Ãwbody


898 
def
 
	$fš®ize
(
£lf
):

900 
Œy
:

901 
code
, 
»asÚ
, 
_
 = 
h‰put
.
	$v®id_¡©us
(
£lf
.
¡©us
)

902 
exû±
 
V®ueE¼Ü
:

903 
¿i£
 
ch”rypy
.
	`HTTPE¼Ü
(500, 
sys
.
	`exc_šfo
()[1].
¬gs
[0])

905 
h—d”s
 = 
£lf
.headers

907 
£lf
.
¡©us
 = "% %s" % (
code
, 
»asÚ
)

908 
£lf
.
ouut_¡©us
 = 
	`Áob
(
	`¡r
(
code
), 'ascii'è+‚tob(" "è+ 
h—d”s
.
	$’code
(
»asÚ
)

910 
£lf
.
¡»am
:

911 #Th
upshÙ
: 
wsgi£rv”
 
wl
 
chunk
 
the
 
»¥Ú£
 

912 #you 
pİ
 
CÚ‹Á
-
	`L’gth
 (
Ü
 
£t
 
™
 
ex¶ic™ly
 
to
 
NÚe
).

913 #NÙ
th©
 
lib
.
£ts
 
C
-
L
 
to
 
the
 
fe
's st_size.

914 
diù
.
	`g‘
(
h—d”s
, 'CÚ‹Á-L’gth'è
is
 
NÚe
:

915 
diù
.
	`pİ
(
h—d”s
, 'CÚ‹Á-L’gth', 
NÚe
)

916 
–if
 
code
 < 200 
Ü
 cod
	$š
 (204, 205, 304):

917 #"
AÎ
 1xx (
šfÜm©iÚ®
), 204 (
no
 
cÚ‹Á
),

918 #ªd 304 (
nÙ
 
modif›d
è
»¥Ú£s
 
MUST
 
NOT


919 #šşud
a
 
mes§ge
-
body
."

920 
diù
.
	`pİ
(
h—d”s
, 'CÚ‹Á-L’gth', 
NÚe
)

921 
£lf
.
body
 = 
	`Áob
("")

923 #Re¥Ú£ 
which
 
¬e
 
nÙ
 
¡»amed
 
should
 
have
 
a
 
CÚ‹Á
-
L’gth
,

924 #buˆ
®low
 
u£r
 
code
 
to
 
£t
 
CÚ‹Á
-
L’gth
 
desœed
.

925 
diù
.
	`g‘
(
h—d”s
, 'CÚ‹Á-L’gth'è
is
 
NÚe
:

926 
cÚ‹Á
 = 
£lf
.
	$cŞÏp£_body
()

927 
diù
.
	`__£t™em__
(
h—d”s
, 'CÚ‹Á-L’gth', 
	$Ën
(
cÚ‹Á
))

929 #T¿nsfÜm 
our
 
h—d”
 
diù
 
što
 
a
 
li¡
 
of
 
tu¶es
.

930 
£lf
.
h—d”_li¡
 = 
h
 = 
h—d”s
.
	$ouut
()

932 
cook›
 = 
£lf
.cook›.
	$ouut
()

933 
cook›
:

934 
lše
 
š
 
cook›
.
	`¥l™
("\n"):

935 
lše
.
	`’dsw™h
("\r"):

936 #PythÚ 2.4 
em™s
 
cook›s
 
jošed
 
by
 
LF
 
but
 2.5+ by 
CRLF
.

937 
lše
 =†ine[:-1]

938 
Çme
, 
v®ue
 = 
lše
.
	`¥l™
(": ", 1)

939 
	$isš¡ªû
(
Çme
, 
unicode¡r
):

940 
Çme
 =‚ame.
	`’code
("ISO-8859-1")

941 
	$isš¡ªû
(
v®ue
, 
unicode¡r
):

942 
v®ue
 = 
h—d”s
.
	$’code
(
v®ue
)

943 
h
.
	`­³nd
((
Çme
, 
v®ue
))

945 
def
 
	$check_timeout
(
£lf
):

948 
This
 
pu½o£fuÎy
 
£ts
 
a
 
æag
, 
¿th”
 
thª
 
¿isšg
 
ª
 
”rÜ
,

949 
so
 
th©
 
a
 
mÚ™Ü
 
th»ad
 
ÿn
 
š‹¼u±
 
the
 
Re¥Ú£
hread.

951 
time
.
	`time
(è> 
£lf
.tim+ s–f.
timeout
:

952 
£lf
.
timed_out
 = 
True


	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/_cpserver.py

3 
impÜt
 
w¬nšgs


5 
impÜt
 
ch”rypy


6 
äom
 
	gch”rypy
.
lib
 
impÜt
 
©Œibu‹s


7 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
	gba£¡ršg
, 
	gpy3k


9 #W
impÜt
 * 
beÿu£
 
we
 
wªt
 
to
 
expÜt
 
check_pÜt


10 #‘ 
®
 
as
 
©Œibu‹s
 
of
 
this
 
moduË
.

11 
äom
 
	gch”rypy
.
	g´oûss
.
£rv”s
 
impÜt
 *

14 
şass
 
	$S”v”
(
S”v”Ad­‹r
):

17 
You
 
ÿn
 
£t
 
	$©Œibu‹s
 (
like
 
sock‘_ho¡
 
ªd
 
sock‘_pÜt
)

18 
Ú
 *
this
* 
	`objeù
 (
which
 
is
 
´obably
 
ch”rypy
.
£rv”
), 
ªd
 
ÿÎ


19 
quick¡¬t
. 
FÜ
 
exam¶e
::

21 
ch”rypy
.
£rv”
.
sock‘_pÜt
 = 80

22 
ch”rypy
.
	`quick¡¬t
()

25 
sock‘_pÜt
 = 8080

28 
_sock‘_ho¡
 = '127.0.0.1'

29 
def
 
	$_g‘_sock‘_ho¡
(
£lf
):

30  
£lf
.
_sock‘_ho¡


31 
def
 
	$_£t_sock‘_ho¡
(
£lf
, 
v®ue
):

32 
v®ue
 == '':

33 
¿i£
 
	`V®ueE¼Ü
("Theƒmpty string ('') is‚ot‡n‡llowed value. "

36 
£lf
.
_sock‘_ho¡
 = 
v®ue


37 
sock‘_ho¡
 = 
	`´İ”ty
(
_g‘_sock‘_ho¡
, 
_£t_sock‘_ho¡
,

38 
doc
="""The hostname or IP‡ddress on whicho†isten for connections.

40 
Ho¡
 
v®ues
 
may
 
be
 
ªy
 
IPv4
 
Ü
 
IPv6
 
add»ss
, o¸ªy 
v®id
 
ho¡Çme
.

41 
The
 
¡ršg
 'loÿlho¡' 
is
 
a
 
synÚym
 '127.0.0.1' (
Ü
 '::1', 

42 
your
 
ho¡s
 
fe
 
´eãrs
 
IPv6
). 
The
 
¡ršg
 '0.0.0.0' 
is
 
a
 
¥ecŸl


43 
IPv4
 
’Œy
 
m—nšg
 "ªy‡ùivš‹rçû" (
INADDR_ANY
), 
ªd
 '::'

44 
is
 
the
 
sim¬
 
IN6ADDR_ANY
 
IPv6
. 
The
 
em±y
 
¡ršg
 
Ü
 
NÚe
 
¬e


45 
nÙ
 
®lowed
.""")

47 
sock‘_fe
 = 
NÚe


50 
Wh’
 
this
 
İtiÚ
 
is
 
nÙ
 
NÚe
, 
the
 `
sock‘_ho¡
` 
ªd
 `
sock‘_pÜt
` 
İtiÚs


51 
¬e
 
ignÜed
."""

53 
sock‘_queue_size
 = 5

55 
of
 
queued
 
	`cÚÃùiÚs
 ( 5)."""

57 
sock‘_timeout
 = 10

60 
shutdown_timeout
 = 5

63 
´ÙocŞ_v”siÚ
 = 'HTTP/1.1'

65 
exam¶e
, "HTTP/1.1" (
the
 ). 
D•’dšg
 
Ú
h
HTTP
 
£rv”
 
u£d
,

66 
this
 
should
 
®so
 
lim™
 
the
 
suµÜ‹d
 
ã©u»s
 
u£d
 
š
h
»¥Ú£
."""

68 
th»ad_poŞ
 = 10

71 
th»ad_poŞ_max
 = -1

74 
max_»que¡_h—d”_size
 = 500 * 1024

76 
the
 
HTTP
 
£rv”
 
should
  "413 Request Entity Too Large"."""

78 
max_»que¡_body_size
 = 100 * 1024 * 1024

80 
the
 
HTTP
 
£rv”
 
should
  "413 Request Entity Too Large"."""

82 
š¡ªû
 = 
NÚe


84 
CPWSGIS”v”
è
which
 
ch”rypy
.
£rv”
 
wl
 
cÚŒŞ
. 
U£
 
this
 
wh’
 
you
 
Ãed


85 
mÜe
 
cÚŒŞ
 
ov”
 
objeù
 
š¡ªtŸtiÚ
 
thª
 
is
 
avaabË
 
š
 
the
 
v¬ious


86 
cÚfigu¿tiÚ
 
İtiÚs
."""

88 
s¦_cÚ‹xt
 = 
NÚe


91 
s¦_û¹ifiÿ‹
 = 
NÚe


94 
s¦_û¹ifiÿ‹_chaš
 = 
NÚe


96 
CÚ‹xt
.
lßd_v”ify_loÿtiÚs
."""

98 
s¦_´iv©e_key
 = 
NÚe


101 
py3k
:

102 
s¦_moduË
 = 'builtin'

104 
WSGI
 
£rv”
. 
Butš
 
İtiÚs
 
¬e
: 'butš' (
to
 
u£
 
the
 
SSL
 
lib¿ry
 
but


105 
što
 
»ûÁ
 
v”siÚs
 
of
 
PythÚ
). 
You
 
may
 
®so
 
your


106 
own
 
şas£s
 
š
 
the
 
wsgi£rv”
.
s¦_ad­‹rs
 
diù
."""

108 
s¦_moduË
 = 'pyopenssl'

110 
WSGI
 
£rv”
. 
Butš
 
İtiÚs
 
¬e
 'butš' (
to
 
u£
 
the
 
SSL
 
lib¿ry
 
but


111 
što
 
»ûÁ
 
v”siÚs
 
of
 
PythÚ
è
ªd
 'pyİ’s¦' (
to
 
u£
 
the
 
PyO³nSSL


112 
´ojeù
, 
which
 
you
 
mu¡
 
š¡®l
 
£·¿‹ly
). 
You
 
may
 
®so
 
your


113 
own
 
şas£s
 
š
 
the
 
wsgi£rv”
.
s¦_ad­‹rs
 
diù
."""

115 
¡©i¡ics
 = 
F®£


118 
nod–ay
 = 
True


121 
wsgi_v”siÚ
 = (1, 0)

123 
The
 
´ovided
 
İtiÚs
 
	`¬e
 (1, 0è[
which
 
šşudes
 
suµÜt
 
PEP
 3333,

124 
which
 
deş¬es
 
™
 
cov”s
 
WSGI
 
v”siÚ
 1.0.1 
but
 
¡l
 
mªd©es
 
the


125 
wsgi
.
	`v”siÚ
 (1, 0)] 
	`ªd
 ('u', 0), 
ª
 
ex³rim’l
 
unicode
 
v”siÚ
.

126 
You
 
may
 
ü—‹
 
ªd
 
your
 
own
 
ex³rim’l
 
v”siÚs
 
of
 
the
 
WSGI


127 
´ÙocŞ
 
by
 
addšg
 
cu¡om
 
şas£s
 
to
 
the
 
wsgi£rv”
.
wsgi_g©eways
 
diù
."""

129 
def
 
	$__š™__
(
£lf
):

130 
£lf
.
bus
 = 
ch”rypy
.
’gše


131 
£lf
.
h‰p£rv”
 = 
NÚe


132 
£lf
.
š‹¼u±
 = 
NÚe


133 
£lf
.
ruÂšg
 = 
F®£


135 
def
 
	$h‰p£rv”_äom_£lf
(
£lf
, 
h‰p£rv”
=
NÚe
):

137 
h‰p£rv”
 
is
 
NÚe
:

138 
h‰p£rv”
 = 
£lf
.
š¡ªû


139 
h‰p£rv”
 
is
 
NÚe
:

140 
äom
 
ch”rypy
 
impÜt
 
_ıwsgi_£rv”


141 
h‰p£rv”
 = 
_ıwsgi_£rv”
.
	$CPWSGIS”v”
(
£lf
)

142 
	$isš¡ªû
(
h‰p£rv”
, 
ba£¡ršg
):

143 #I 
ªyÚe
 
usšg
 
this
? 
Cª
 
I
 
add
 
ª
 
¬g
?

144 
h‰p£rv”
 = 
	$©Œibu‹s
(
h‰p£rv”
)(
£lf
)

145  
h‰p£rv”
, 
£lf
.
bšd_addr


147 
def
 
	$¡¬t
(
£lf
):

149 
nÙ
 
£lf
.
h‰p£rv”
:

150 
£lf
.
h‰p£rv”
, s–f.
bšd_addr
 = s–f.
	$h‰p£rv”_äom_£lf
()

151 
S”v”Ad­‹r
.
	$¡¬t
(
£lf
)

152 
¡¬t
.
´iÜ™y
 = 75

154 
def
 
	$_g‘_bšd_addr
(
£lf
):

155 
£lf
.
sock‘_fe
:

156  
£lf
.
sock‘_fe


157 
£lf
.
sock‘_ho¡
 
is
 
NÚe
 
ªd
 s–f.
sock‘_pÜt
 is None:

158  
NÚe


159  (
£lf
.
sock‘_ho¡
, s–f.
sock‘_pÜt
)

160 
def
 
	$_£t_bšd_addr
(
£lf
, 
v®ue
):

161 
v®ue
 
is
 
NÚe
:

162 
£lf
.
sock‘_fe
 = 
NÚe


163 
£lf
.
sock‘_ho¡
 = 
NÚe


164 
£lf
.
sock‘_pÜt
 = 
NÚe


165 
–if
 
	$isš¡ªû
(
v®ue
, 
ba£¡ršg
):

166 
£lf
.
sock‘_fe
 = 
v®ue


167 
£lf
.
sock‘_ho¡
 = 
NÚe


168 
£lf
.
sock‘_pÜt
 = 
NÚe


170 
Œy
:

171 
£lf
.
sock‘_ho¡
, s–f.
sock‘_pÜt
 = 
v®ue


172 
£lf
.
sock‘_fe
 = 
NÚe


173 
exû±
 
V®ueE¼Ü
:

174 
¿i£
 
	`V®ueE¼Ü
("bind_addr must be‡ (host,…ort)uple "

176 "domaš sock‘s),‚Ù %r" % 
v®ue
)

177 
bšd_addr
 = 
	`´İ”ty
(
_g‘_bšd_addr
, 
_£t_bšd_addr
,

178 
doc
='A (host,…ort)uple for TCP sockets or‡ str for Unix domain sockets.')

180 
def
 
	$ba£
(
£lf
):

182 
£lf
.
sock‘_fe
:

183  
£lf
.
sock‘_fe


185 
ho¡
 = 
£lf
.
sock‘_ho¡


186 
ho¡
 
	`š
 ('0.0.0.0', '::'):

187 #0.0.0.0 
is
 
INADDR_ANY
 
ªd
 :: i 
IN6ADDR_ANY
.

188 #Look 
up
 
the
 
ho¡
 
Çme
, 
which
 
should
 
be
he

189 #§ã¡ 
thšg
 
to
 
¥™
 
out
 
š
 
a
 
URL
.

190 
impÜt
 
sock‘


191 
ho¡
 = 
sock‘
.
	$g‘ho¡Çme
()

193 
pÜt
 = 
£lf
.
sock‘_pÜt


195 
£lf
.
s¦_û¹ifiÿ‹
:

196 
scheme
 = "https"

197 
pÜt
 != 443:

198 
ho¡
 +ğ":%s" % 
pÜt


200 
scheme
 = "http"

201 
pÜt
 != 80:

202 
ho¡
 +ğ":%s" % 
pÜt


204  "%s://%s" % (
scheme
, 
ho¡
)

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/_cpthreadinglocal.py

1 #Thi 
is
 
a
 
backpÜt
 
of
 
PythÚ
-2.4'shreading.local() implementation

5 (
NÙe
 
th©
 
this
 
moduË
 
´ovides
 
a
 
PythÚ
 
v”siÚ
 
of
 
th»ad


6 
	gth»adšg
.
loÿl
 
	gşass
. 
D•’dšg
 
Ú
 
the
 
v”siÚ
 
of
 
PythÚ
 
	gyou
're

7 
	gusšg
, 
th”e
 
may
 
be
 
a
 
ç¡”
 
Úe
 
	gavaabË
. 
You
 
should
 
®ways
 
impÜt


8 
the
 
loÿl
 
şass
 
äom
 
	gth»adšg
.)

10 
	gTh»ad
-
loÿl
 
objeùs
 
suµÜt
 
the
 
mªagem’t
 
of
 
	gth»ad
-loÿÈ
	gd©a
.

11 
If
 
you
 
have
 
d©a
 
th©
 you 
wªt
 
to
 
be
 
loÿl
Ø
a
 
	gth»ad
, 
sim¶y
 
ü—‹


12 
a
 
	gth»ad
-
loÿl
 
objeù
 
ªd
 
u£
 
™s
 
	g©Œibu‹s
:

14 >>> 
myd©a
 = 
loÿl
()

15 >>> 
myd©a
.
numb”
 = 42

16 >>> 
myd©a
.
numb”


19 
You
 
ÿn
 
®so
 
acûss
 
the
 
loÿl
-
objeù
's dictionary:

21 >>> 
myd©a
.
__diù__


23 >>> 
myd©a
.
__diù__
.
£tdeçuÉ
('widgets', [])

25 >>> 
	gmyd©a
.
	gwidg‘s


28 
	gWh©
's important‡bouthread-local objects ishatheir data‡re

29 
loÿl
 
to
 
a
 
	gth»ad
. 
If
 
we
 
acûss
 
the
 
d©a
 
š
‡ 
difã»Á
hread:

31 >>> 
log
 = []

32 >>> 
def
 
	$f
():

33 ... 
™ems
 = 
myd©a
.
__diù__
.
	`™ems
()

34 ... 
™ems
.
	`sÜt
()

35 ... 
log
.
	`­³nd
(
™ems
)

36 ... 
myd©a
.
numb”
 = 11

37 ... 
log
.
	`­³nd
(
myd©a
.
numb”
)

39 >>> 
impÜt
 
th»adšg


40 >>> 
th»ad
 = 
th»adšg
.
	`Th»ad
(
rg‘
=
f
)

41 >>> 
th»ad
.
	`¡¬t
()

42 >>> 
th»ad
.
	`još
()

43 >>> 
log


46 
we
 
g‘
 
difã»Á
 
d©a
. 
Fu¹h”mÜe
, 
chªges
 
made
 
š
 
the
 
Ùh”
 
th»ad


47 
dÚ
't‡ffect data seen inhishread:

49 >>> 
myd©a
.
numb”


52 
Of
 
cour£
, 
v®ues
 
you
 
g‘
 
äom
 
a
 
loÿl
 
objeù
, 
šşudšg
‡ 
__diù__


53 
©Œibu‹
, 
¬e
 
wh©ev”
 
th»ad
 
was
 
cu¼’t
 
©
 
the
 
time
he

54 
©Œibu‹
 
was
 
»ad
. 
FÜ
 
th©
 
»asÚ
, 
you
 
g’”®ly
 
dÚ
't wanto save

55 
the£
 
v®ues
 
aüoss
 
th»ads
, 
as
 
they
 
­¶y
 
Úly
 
to
 
the
 
th»ad
hey

56 
ÿme
 
äom
.

58 
You
 
ÿn
 
ü—‹
 
cu¡om
 
loÿl
 
objeùs
 
by
 
subşassšg
 
the
†oÿÈ
şass
:

60 >>> 
şass
 
	$MyLoÿl
(
loÿl
):

61 ... 
numb”
 = 2

62 ... 
š™Ÿlized
 = 
F®£


63 ... 
def
 
	$__š™__
(
£lf
, **
kw
):

64 ... 
£lf
.
š™Ÿlized
:

65 ... 
¿i£
 
	`Sy¡emE¼Ü
('__init__ calledoo manyimes')

66 ... 
£lf
.
š™Ÿlized
 = 
True


67 ... 
£lf
.
__diù__
.
	`upd©e
(
kw
)

68 ... 
def
 
	$squ¬ed
(
£lf
):

69 ...  
£lf
.
numb”
 ** 2

71 
This
 
ÿn
 
be
 
u£ful
 
to
 
suµÜt
  
v®ues
, 
m‘hods
 
ªd


72 
š™Ÿliz©iÚ
. 
NÙe
 
th©
 
you
 
defše
 
ª
 
__š™__
 
m‘hod
, 
™
 
wl
 
be


73 
ÿÎed
 
—ch
 
time
 
the
 
loÿl
 
objeù
 
is
 
u£d
 
š
 
a
 
£·¿‹
 
th»ad
. 
This


74 
is
 
Ãûs§ry
 
to
 
š™Ÿlize
 
—ch
 
th»ad
's dictionary.

76 
Now
 
we
 
ü—‹
 
a
 
loÿl
 
objeù
:

78 >>> 
myd©a
 = 
	`MyLoÿl
(
cŞÜ
='red')

80 
Now
 
we
 
have
 
a
  
numb”
:

82 >>> 
myd©a
.
numb”


85 
ª
 
š™Ÿl
 
cŞÜ
:

87 >>> 
myd©a
.
cŞÜ


89 >>> 
d–
 
myd©a
.
cŞÜ


91 
And
 
a
 
m‘hod
 
th©
 
İ”©es
 
Ú
 
the
 
d©a
:

93 >>> 
myd©a
.
	`squ¬ed
()

96 
As
 
befÜe
, 
we
 
ÿn
 
acûss
 
the
 
d©a
 
š
 
a
 
£·¿‹
 
th»ad
:

98 >>> 
log
 = []

99 >>> 
th»ad
 = 
th»adšg
.
	`Th»ad
(
rg‘
=
f
)

100 >>> 
th»ad
.
	`¡¬t
()

101 >>> 
th»ad
.
	`još
()

102 >>> 
log


103 [[('cŞÜ', '»d'), ('š™Ÿlized', 
True
)], 11]

105 
w™hout
 
afãùšg
 
this
 
th»ad
's data:

107 >>> 
myd©a
.
numb”


109 >>> 
myd©a
.
cŞÜ


110 
	$T¿ûback
 (
mo¡
 
»ûÁ
 
ÿÎ
 
Ï¡
):

112 
A‰ribu‹E¼Ü
: 'MyLoÿl' 
objeù
 
has
 
no
 
©Œibu‹
 'color'

114 
NÙe
 
th©
 
subşas£s
 
ÿn
 
defše
 
¦Ùs
, 
but
 
they
 
¬e
 
nÙ
 
th»ad


115 
loÿl
. 
They
 
¬e
 
sh¬ed
 
aüoss
 
th»ads
:

117 >>> 
şass
 
	$MyLoÿl
(
loÿl
):

118 ... 
__¦Ùs__
 = 'number'

120 >>> 
myd©a
 = 
	`MyLoÿl
()

121 >>> 
myd©a
.
numb”
 = 42

122 >>> 
myd©a
.
cŞÜ
 = 'red'

124 
So
, 
the
 
£·¿‹
 
th»ad
:

126 >>> 
th»ad
 = 
th»adšg
.
	`Th»ad
(
rg‘
=
f
)

127 >>> 
th»ad
.
	`¡¬t
()

128 >>> 
th»ad
.
	$još
()

130 
afãùs
 
wh©
 
we
 
£e
:

132 >>> 
myd©a
.
numb”


135 >>> 
d–
 
myd©a


138 #Th»adšg 
impÜt
 
is
 
©
 
’d


140 
şass
 
	$_loÿlba£
(
objeù
):

141 
__¦Ùs__
 = '_local__key', '_local__args', '_local__lock'

143 
def
 
	$__Ãw__
(
şs
, *
¬gs
, **
kw
):

144 
£lf
 = 
objeù
.
	$__Ãw__
(
şs
)

145 
key
 = 'th»ad.loÿl.' + 
	`¡r
(
	$id
(
£lf
))

146 
objeù
.
	`__£‰r__
(
£lf
, '_loÿl__key', 
key
)

147 
objeù
.
	`__£‰r__
(
£lf
, '_loÿl__¬gs', (
¬gs
, 
kw
))

148 
objeù
.
	`__£‰r__
(
£lf
, '_loÿl__lock', 
	$RLock
())

150 
¬gs
 
Ü
 
kw
 
	$ªd
 (
şs
.
__š™__
 
is
 
objeù
.__init__):

151 
¿i£
 
	`Ty³E¼Ü
("Initialization‡rguments‡re‚ot supported")

153 #W
Ãed
 
to
 
ü—‹
 
the
 
th»ad
 
diù
 
š
 
ªtic©iÚ
 
of


154 #__š™__ 
bešg
 
ÿÎed
, 
to
 
make
 
su»
 
we
 
dÚ
't call it

155 #agaš 
our£lves
.

156 
diù
 = 
objeù
.
	`__g‘©Œibu‹__
(
£lf
, '__dict__')

157 
	`cu¼’tTh»ad
().
__diù__
[
key
] = 
diù


159  
£lf


161 
def
 
	$_·tch
(
£lf
):

162 
key
 = 
objeù
.
	`__g‘©Œibu‹__
(
£lf
, '_local__key')

163 
d
 = 
	`cu¼’tTh»ad
().
__diù__
.
	$g‘
(
key
)

164 
d
 
is
 
NÚe
:

165 
d
 = {
	}
}

166 
cu¼’tTh»ad
().
__diù__
[
key
] = 
d


167 
objeù
.
__£‰r__
(
£lf
, '__diù__', 
d
)

169 #w
have
 
a
 
Ãw
 
š¡ªû
 
diù
, 
so
 
ÿÎ
 
out
 
__š™__
 
we
 have

171 
	gşs
 = 
	$ty³
(
£lf
)

172 
şs
.
__š™__
 
is
 
nÙ
 
objeù
.__init__:

173 
¬gs
, 
kw
 = 
objeù
.
	`__g‘©Œibu‹__
(
£lf
, '_local__args')

174 
şs
.
	$__š™__
(
£lf
, *
¬gs
, **
kw
)

176 
objeù
.
	`__£‰r__
(
£lf
, '__diù__', 
d
)

178 
şass
 
	$loÿl
(
_loÿlba£
):

180 
def
 
	$__g‘©Œibu‹__
(
£lf
, 
Çme
):

181 
lock
 = 
objeù
.
	`__g‘©Œibu‹__
(
£lf
, '_local__lock')

182 
lock
.
	$acquœe
()

183 
Œy
:

184 
	$_·tch
(
£lf
)

185  
objeù
.
	$__g‘©Œibu‹__
(
£lf
, 
Çme
)

186 
fš®ly
:

187 
lock
.
	$»Ëa£
()

189 
def
 
	$__£‰r__
(
£lf
, 
Çme
, 
v®ue
):

190 
lock
 = 
objeù
.
	`__g‘©Œibu‹__
(
£lf
, '_local__lock')

191 
lock
.
	$acquœe
()

192 
Œy
:

193 
	$_·tch
(
£lf
)

194  
objeù
.
	$__£‰r__
(
£lf
, 
Çme
, 
v®ue
)

195 
fš®ly
:

196 
lock
.
	$»Ëa£
()

198 
def
 
	$__d–©Œ__
(
£lf
, 
Çme
):

199 
lock
 = 
objeù
.
	`__g‘©Œibu‹__
(
£lf
, '_local__lock')

200 
lock
.
	$acquœe
()

201 
Œy
:

202 
	$_·tch
(
£lf
)

203  
objeù
.
	$__d–©Œ__
(
£lf
, 
Çme
)

204 
fš®ly
:

205 
lock
.
	$»Ëa£
()

208 
def
 
	$__d–__
():

209 
th»adšg_’um”©e
 = 
’um”©e


210 
__g‘©Œibu‹__
 = 
objeù
.__getattribute__

212 
def
 
	$__d–__
(
£lf
):

213 
key
 = 
	`__g‘©Œibu‹__
(
£lf
, '_local__key')

215 
Œy
:

216 
th»ads
 = 
	`li¡
(
	$th»adšg_’um”©e
())

217 
exû±
:

218 #ià
’um”©e
 
çs
, 
as
 
™
 
£ems
 
to
 dØ
duršg


219 #shutdown, 
we
'll skip cleanup underhe‡ssumption

220 #th© 
th”e
 
is
 
nÙhšg
 
to
 
ş—n
 
up


223 
th»ad
 
š
 
th»ads
:

224 
Œy
:

225 
__diù__
 = 
th»ad
.__dict__

226 
exû±
 
A‰ribu‹E¼Ü
:

227 #Th»ad 
is
 
dyšg
, 
»¡
 
š
 
³aû


230 
key
 
š
 
__diù__
:

231 
Œy
:

232 
d–
 
__diù__
[
key
]

233 
exû±
 
KeyE¼Ü
:

234 
·ss
 #didn't have‡nything inhishread

236  
__d–__


237 
__d–__
 = 
	$__d–__
()

239 
äom
 
th»adšg
 
impÜt
 
cu¼’tTh»ad
, 
’um”©e
, 
RLock


	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/_cptools.py

1 """Ch”ryPyoŞs. A "
	gtoŞ
" is‡ny helper,‡daptedo CP.

3 
ToŞs
 
¬e
 
usu®ly
 
desigÃd
 
to
 
be
 
u£d
 
š
 
a
 
v¬›ty
 
of
 
	$ways
 (
®though
 
some


4 
may
 
Úly
 
ofãr
 
Úe
 
they
 
choo£
):

6 
Lib¿ry
 
ÿÎs


7 
AÎ
 
toŞs
 
¬e
 
ÿÎabËs
 
th©
 
ÿn
 
be
 
u£d
 
wh”ev”
 
Ãeded
.

8 
The
 
¬gum’ts
 
¬e
 
¡¿ightfÜw¬d
 
ªd
 
should
 
be
 
d‘aed
 
w™hš
 
the


9 
doc¡ršg
.

11 
FunùiÚ
 
decÜ©Üs


12 
AÎ
 
toŞs
, 
wh’
 
ÿÎed
, 
may
 
be
 
u£d
 
as
 
decÜ©Üs
 
which
 
cÚfigu»


13 
šdividu®
 
Ch”ryPy
 
·ge
 
	`hªdËrs
 (
m‘hods
 
Ú
 
the
 Ch”ryPy 
Œ“
).

14 
Th©
 
is
, "@toŞs.ªytoŞ()" 
should
 "tuº on" 
the
 
toŞ
 
vŸ
he

15 
decÜ©ed
 
funùiÚ
's _cp_config‡ttribute.

17 
Ch”ryPy
 
cÚfig


18 
If
 
a
 
toŞ
 
expo£s
‡ "_£tup" 
ÿÎabË
, 
™
 
wl
 
be
 
ÿÎed


19 
Úû
 
³r
 
	`Reque¡
 (
the
 
ã©u»
 
is
 "tuºed on" 
vŸ
 
cÚfig
).

21 
ToŞs
 
may
 
be
 
im¶em’‹d
 
as
 
ªy
 
objeù
 
w™h
 
a
 
Çme¥aû
. 
The
 
butšs


22 
¬e
 
g’”®ly
 
e™h”
 
moduËs
 
Ü
 
š¡ªûs
 
of
 
the
 
toŞs
.
ToŞ
 
şass
.

25 
impÜt
 
sys


26 
impÜt
 
w¬nšgs


28 
impÜt
 
ch”rypy


31 
def
 
	$_g‘¬gs
(
func
):

33 #U£ 
this
 
š¡—d
 
of
 
impÜtšg
 
š¥eù
 
Ëss
 
mem
 
ov”h—d
.

34 
impÜt
 
ty³s


35 
sys
.
v”siÚ_šfo
 >= (3, 0):

36 
	$isš¡ªû
(
func
, 
ty³s
.
M‘hodTy³
):

37 
func
 = func.
__func__


38 
co
 = 
func
.
__code__


40 
	$isš¡ªû
(
func
, 
ty³s
.
M‘hodTy³
):

41 
func
 = func.
im_func


42 
co
 = 
func
.
func_code


43  
co
.
co_v¬Çmes
[:co.
co_¬gcouÁ
]

46 
_©Œ_”rÜ
 = ("CherryPy Tools cannot beurned on directly. Instead,urnhem "

49 
şass
 
	$ToŞ
(
objeù
):

52 
	$h–p
(
toŞ
.
ÿÎabË
è
should
 
give
 
you
 
mÜe
 
šfÜm©iÚ
 
about
 
this
 
ToŞ
.

55 
Çme¥aû
 = "tools"

57 
def
 
	$__š™__
(
£lf
, 
pošt
, 
ÿÎabË
, 
Çme
=
NÚe
, 
´iÜ™y
=50):

58 
£lf
.
_pošt
 = 
pošt


59 
£lf
.
ÿÎabË
 = callable

60 
£lf
.
_Çme
 = 
Çme


61 
£lf
.
_´iÜ™y
 = 
´iÜ™y


62 
£lf
.
__doc__
 = s–f.
ÿÎabË
.__doc__

63 
£lf
.
	$_£rgs
()

65 
def
 
	$_g‘_Ú
(
£lf
):

66 
¿i£
 
	$A‰ribu‹E¼Ü
(
_©Œ_”rÜ
)

67 
def
 
	$_£t_Ú
(
£lf
, 
v®ue
):

68 
¿i£
 
	$A‰ribu‹E¼Ü
(
_©Œ_”rÜ
)

69 
Ú
 = 
	$´İ”ty
(
_g‘_Ú
, 
_£t_Ú
)

71 
def
 
	$_£rgs
(
£lf
):

73 
Œy
:

74 
¬g
 
š
 
	$_g‘¬gs
(
£lf
.
ÿÎabË
):

75 
	$£‰r
(
£lf
, 
¬g
, 
NÚe
)

76 
	$exû±
 (
Ty³E¼Ü
, 
A‰ribu‹E¼Ü
):

77 
	`ha§‰r
(
£lf
.
ÿÎabË
, "__call__"):

78 
¬g
 
š
 
	$_g‘¬gs
(
£lf
.
ÿÎabË
.
__ÿÎ__
):

79 
	$£‰r
(
£lf
, 
¬g
, 
NÚe
)

80 #IrÚPythÚ 1.0 
¿i£s
 
NÙIm¶em’‹dE¼Ü
 
beÿu£


81 #š¥eù.
g‘¬g¥ec
 
Œ›s
 
to
 
acûss
 
PythÚ
 
by‹code


82 #š 
co_code
 
©Œibu‹
.

83 
exû±
 
NÙIm¶em’‹dE¼Ü
:

84 
·ss


85 #IrÚPythÚ 1B1 
may
 
¿i£
 
IndexE¼Ü
 
š
 
some
 
ÿ£s
,

86 #buˆ
we
 
Œ­
 
™
 
h”e
 iˆ
dÛ¢
't…revent CP from working.

87 
exû±
 
IndexE¼Ü
:

88 
·ss


90 
def
 
	$_m”ged_¬gs
(
£lf
, 
d
=
NÚe
):

92 
d
:

93 
cÚf
 = 
d
.
	$cİy
()

95 
cÚf
 = {
	}
}

97 
tm
 = 
ch”rypy
.
£rvšg
.
»que¡
.
toŞm­s
[
£lf
.
Çme¥aû
]

98 
£lf
.
_Çme
 
š
 
tm
:

99 
cÚf
.
	$upd©e
(
tm
[
£lf
.
_Çme
])

101 "Ú" 
š
 
cÚf
:

102 
d–
 
cÚf
["on"]

104  
cÚf


106 
def
 
	$__ÿÎ__
(
£lf
, *
¬gs
, **
kw¬gs
):

109 
FÜ
 
exam¶e
::

111 @
toŞs
.
	$´oxy
()

112 
def
 
	$wh©s_my_ba£
(
£lf
):

113  
ch”rypy
.
»que¡
.
ba£


114 
wh©s_my_ba£
.
expo£d
 = 
True


116 
¬gs
:

117 
¿i£
 
	`Ty³E¼Ü
("The %r Tool does‚ot‡ccept…ositional "

119 % 
£lf
.
_Çme
)

120 
def
 
	$toŞ_decÜ©Ü
(
f
):

121 
nÙ
 
	`ha§‰r
(
f
, "_cp_config"):

122 
f
.
_ı_cÚfig
 = {
	}
}

123 
sub¥aû
 = 
£lf
.
Çme¥aû
 + "." + s–f.
_Çme
 + "."

124 
f
.
_ı_cÚfig
[
sub¥aû
 + "Ú"] = 
True


125 
k
, 
v
 
š
 
	gkw¬gs
.
	$™ems
():

126 
f
.
_ı_cÚfig
[
sub¥aû
 + 
k
] = 
v


127  
f


128  
toŞ_decÜ©Ü


130 
def
 
	$_£tup
(
£lf
):

133 
The
 
¡ªd¬d
 
Ch”ryPy
 
»que¡
 
objeù
 
wl
 
autom©iÿÎy
 
ÿÎ
 
this


134 
m‘hod
 
wh’
 
the
 
toŞ
 
is
 "tuºed on" 
š
 
cÚfig
.

136 
cÚf
 = 
£lf
.
	$_m”ged_¬gs
()

137 
p
 = 
cÚf
.
	`pİ
("´iÜ™y", 
NÚe
)

138 
p
 
is
 
NÚe
:

139 
p
 = 
	`g‘©Œ
(
£lf
.
ÿÎabË
, "´iÜ™y", s–f.
_´iÜ™y
)

140 
ch”rypy
.
£rvšg
.
»que¡
.
hooks
.
	$©ch
(
£lf
.
_pošt
, s–f.
ÿÎabË
,

141 
´iÜ™y
=
p
, **
cÚf
)

144 
şass
 
	$HªdËrToŞ
(
ToŞ
):

147 
If
 
the
 
toŞ
 
sucûssfuÎy
 
hªdËs
h
	`»que¡
 (
by
 
£‰šg
 
»¥Ú£
.
body
),

148 
should
  
True
. 
This
 
wl
 
ÿu£
 
Ch”ryPy
 
to
 
sk
 
ªy
 'nÜm®' 
·ge


149 
hªdËr
. 
If
 
the
 
toŞ
 
did
 
nÙ
 
hªdË
h
»que¡
, 
™
 
should
  
F®£


150 
to
 
‹Î
 
Ch”ryPy
Ø 
Ú
 
ªd
 
ÿÎ
 
the
 
nÜm®
 
·ge
 
hªdËr
. 
If
he

151 
toŞ
 
is
 
deş¬ed
 
AS
 
a
 
·ge
 
	`hªdËr
 (
£e
 
the
 'hªdËr' 
m‘hod
), 
»tuºšg


152 
F®£
 
wl
 
¿i£
 
NÙFound
.

155 
def
 
	$__š™__
(
£lf
, 
ÿÎabË
, 
Çme
=
NÚe
):

156 
ToŞ
.
	`__š™__
(
£lf
, 'befÜe_hªdËr', 
ÿÎabË
, 
Çme
)

158 
def
 
	$hªdËr
(
£lf
, *
¬gs
, **
kw¬gs
):

161 
FÜ
 
exam¶e
::

163 
şass
 
RoÙ
:

164 
Çv
 = 
toŞs
.
¡©icdœ
.
	`hªdËr
(
£ùiÚ
="/Çv", 
dœ
="nav",

165 
roÙ
=
absDœ
)

167 
def
 
	$hªdË_func
(*
a
, **
kw
):

168 
hªdËd
 = 
£lf
.
	`ÿÎabË
(*
¬gs
, **£lf.
	$_m”ged_¬gs
(
kw¬gs
))

169 
nÙ
 
hªdËd
:

170 
¿i£
 
ch”rypy
.
	$NÙFound
()

171  
ch”rypy
.
£rvšg
.
»¥Ú£
.
body


172 
hªdË_func
.
expo£d
 = 
True


173  
hªdË_func


175 
def
 
	$_w¿µ”
(
£lf
, **
kw¬gs
):

176 
£lf
.
	$ÿÎabË
(**
kw¬gs
):

177 
ch”rypy
.
£rvšg
.
»que¡
.
hªdËr
 = 
NÚe


179 
def
 
	$_£tup
(
£lf
):

182 
The
 
¡ªd¬d
 
Ch”ryPy
 
»que¡
 
objeù
 
wl
 
autom©iÿÎy
 
ÿÎ
 
this


183 
m‘hod
 
wh’
 
the
 
toŞ
 
is
 "tuºed on" 
š
 
cÚfig
.

185 
cÚf
 = 
£lf
.
	$_m”ged_¬gs
()

186 
p
 = 
cÚf
.
	`pİ
("´iÜ™y", 
NÚe
)

187 
p
 
is
 
NÚe
:

188 
p
 = 
	`g‘©Œ
(
£lf
.
ÿÎabË
, "´iÜ™y", s–f.
_´iÜ™y
)

189 
ch”rypy
.
£rvšg
.
»que¡
.
hooks
.
	$©ch
(
£lf
.
_pošt
, s–f.
_w¿µ”
,

190 
´iÜ™y
=
p
, **
cÚf
)

193 
şass
 
	$HªdËrW¿µ”ToŞ
(
ToŞ
):

196 
The
 'ÃwhªdËr' 
¬g
 
mu¡
 
be
 
a
 
hªdËr
 
w¿µ”
 
funùiÚ
 
th©
 
kes
‡

197 'Ãxt_hªdËr' 
¬gum’t
, 
¶us
 ``*
¬gs
`` 
ªd
 ``**
kw¬gs
``. 
Like
 
®l


198 
·ge
 
hªdËr


199 
funùiÚs
, 
™
 
mu¡
  
ª
 
™”abË
 
u£
 
as
 
ch”rypy
.
»¥Ú£
.
body
.

201 
FÜ
 
exam¶e
, 
to
 
®low
 
your
 'šÃr' 
·ge
 
hªdËrs
Ø 
diùs


202 
which
 
th’
 
g‘
 
š‹½Ş©ed
 
što
 
a
 
‹m¶©e
::

204 
def
 
	$š‹½Ş©Ü
(
Ãxt_hªdËr
, *
¬gs
, **
kw¬gs
):

205 
f’ame
 = 
ch”rypy
.
»que¡
.
cÚfig
.
	`g‘
('template')

206 
ch”rypy
.
»¥Ú£
.
‹m¶©e
 = 
’v
.
	$g‘_‹m¶©e
(
f’ame
)

207 
»¥Ú£_diù
 = 
	$Ãxt_hªdËr
(*
¬gs
, **
kw¬gs
)

208  
ch”rypy
.
»¥Ú£
.
‹m¶©e
.
	$»nd”
(**
»¥Ú£_diù
)

209 
ch”rypy
.
toŞs
.
jšja
 = 
	`HªdËrW¿µ”ToŞ
(
š‹½Ş©Ü
)

212 
def
 
	`__š™__
(
£lf
, 
ÃwhªdËr
, 
pošt
='befÜe_hªdËr', 
Çme
=
NÚe
, 
´iÜ™y
=50):

213 
£lf
.
ÃwhªdËr
 =‚ewhandler

214 
£lf
.
_pošt
 = 
pošt


215 
£lf
.
_Çme
 = 
Çme


216 
£lf
.
_´iÜ™y
 = 
´iÜ™y


218 
def
 
	$ÿÎabË
(
£lf
, 
debug
=
F®£
):

219 
šÃrfunc
 = 
ch”rypy
.
£rvšg
.
»que¡
.
hªdËr


220 
def
 
	$w¿p
(*
¬gs
, **
kw¬gs
):

221  
£lf
.
	$ÃwhªdËr
(
šÃrfunc
, *
¬gs
, **
kw¬gs
)

222 
ch”rypy
.
£rvšg
.
»que¡
.
hªdËr
 = 
w¿p


225 
şass
 
	$E¼ÜToŞ
(
ToŞ
):

228 
def
 
	$__š™__
(
£lf
, 
ÿÎabË
, 
Çme
=
NÚe
):

229 
ToŞ
.
	$__š™__
(
£lf
, 
NÚe
, 
ÿÎabË
, 
Çme
)

231 
def
 
	$_w¿µ”
(
£lf
):

232 
£lf
.
	`ÿÎabË
(**£lf.
	$_m”ged_¬gs
())

234 
def
 
	$_£tup
(
£lf
):

237 
The
 
¡ªd¬d
 
Ch”ryPy
 
»que¡
 
objeù
 
wl
 
autom©iÿÎy
 
ÿÎ
 
this


238 
m‘hod
 
wh’
 
the
 
toŞ
 
is
 "tuºed on" 
š
 
cÚfig
.

240 
ch”rypy
.
£rvšg
.
»que¡
.
”rÜ_»¥Ú£
 = 
£lf
.
_w¿µ”


243 #Butš 
toŞs
 #


244 
äom
 
ch”rypy
.
lib
 
impÜt
 
ıtoŞs
, 
’codšg
, 
auth
, , 
jsÚtoŞs


245 
äom
 
ch”rypy
.
lib
 
impÜt
 
£ssiÚs
 
as
 
_£ssiÚs
, 
xmÌpcut
‡ 
_xmÌpc


246 
äom
 
ch”rypy
.
lib
 
impÜt
 
ÿchšg
 
as
 
_ÿchšg


247 
äom
 
ch”rypy
.
lib
 
impÜt
 
auth_basic
, 
auth_dige¡


250 
şass
 
	$SessiÚToŞ
(
ToŞ
):

253 
£ssiÚs
.
lockšg


254 
Wh’
 'im¶ic™' (
the
 ),h
£ssiÚ
 
wl
 
be
 
locked
 
you
,

255 
ju¡
 
befÜe
 
ruÂšg
 
the
 
·ge
 
hªdËr
.

257 
Wh’
 '—¾y', 
the
 
£ssiÚ
 
wl
 
be
 
locked
 
befÜe
 
»adšg
h
»que¡


258 
body
. 
This
 
is
 
off
 
by
  
§ãty
 
»asÚs
; 
exam¶e
,

259 
a
 
Ïrge
 
u¶ßd
 
would
 
block
 
the
 
£ssiÚ
, 
d’yšg
 
ª
 
AJAX


260 
´og»ss
 
	`m‘”
 (
£e
 
h‰p
:

262 
Wh’
 'ex¶ic™' (
Ü
 
ªy
 
Ùh”
 
v®ue
), 
you
 
Ãed
 
to
 
ÿÎ


263 
ch”rypy
.
£ssiÚ
.
	$acquœe_lock
(è
your£lf
 
befÜe
 
usšg


264 
£ssiÚ
 
d©a
.

267 
def
 
	$__š™__
(
£lf
):

268 #_£ssiÚs.
š™
 
mu¡
 
be
 
bound
 
aá”
 
h—d”s
 
¬e
 
»ad


269 
ToŞ
.
	`__š™__
(
£lf
, 'befÜe_»que¡_body', 
_£ssiÚs
.
š™
)

271 
def
 
	$_lock_£ssiÚ
(
£lf
):

272 
ch”rypy
.
£rvšg
.
£ssiÚ
.
	$acquœe_lock
()

274 
def
 
	$_£tup
(
£lf
):

277 
The
 
¡ªd¬d
 
Ch”ryPy
 
»que¡
 
objeù
 
wl
 
autom©iÿÎy
 
ÿÎ
 
this


278 
m‘hod
 
wh’
 
the
 
toŞ
 
is
 "tuºed on" 
š
 
cÚfig
.

280 
hooks
 = 
ch”rypy
.
£rvšg
.
»que¡
.hooks

282 
cÚf
 = 
£lf
.
	$_m”ged_¬gs
()

284 
p
 = 
cÚf
.
	`pİ
("´iÜ™y", 
NÚe
)

285 
p
 
is
 
NÚe
:

286 
p
 = 
	`g‘©Œ
(
£lf
.
ÿÎabË
, "´iÜ™y", s–f.
_´iÜ™y
)

288 
hooks
.
	$©ch
(
£lf
.
_pošt
, s–f.
ÿÎabË
, 
´iÜ™y
=
p
, **
cÚf
)

290 
lockšg
 = 
cÚf
.
	`pİ
('locking', 'implicit')

291 
lockšg
 == 'implicit':

292 
hooks
.
	`©ch
('befÜe_hªdËr', 
£lf
.
_lock_£ssiÚ
)

293 
–if
 
lockšg
 == 'early':

294 #Lock 
befÜe
 
the
 
»que¡
 
	`body
 (
but
 
aá”
 
_£ssiÚs
.
š™
 
runs
!)

295 
hooks
.
	`©ch
('befÜe_»que¡_body', 
£lf
.
_lock_£ssiÚ
,

296 
´iÜ™y
=60)

299 
·ss


301 
hooks
.
	`©ch
('befÜe_fš®ize', 
_£ssiÚs
.
§ve
)

302 
hooks
.
	`©ch
('Ú_’d_»que¡', 
_£ssiÚs
.
şo£
)

304 
def
 
	$»g’”©e
(
£lf
):

306 
£ss
 = 
ch”rypy
.
£rvšg
.
£ssiÚ


307 
£ss
.
	$»g’”©e
()

309 #G¿b 
cook›
-
»Ëvªt
 
toŞ
 
¬gs


310 
cÚf
 = 
	`diù
([(
k
, 
v
èk, v 
š
 
£lf
.
	`_m”ged_¬gs
().
	$™ems
()

311 
k
 
	`š
 ('path', 'path_header', 'name', 'timeout',

313 
_£ssiÚs
.
	$£t_»¥Ú£_cook›
(**
cÚf
)

318 
şass
 
	$XMLRPCCÚŒŞËr
(
objeù
):

321 
To
 
u£
 
™
, 
have
 
your
 
cÚŒŞËrs
 
subşass
 
this
 
ba£
 
	`şass
 (™ 
wl


322 
tuº
 
Ú
 
the
 
toŞ
 
you
).

324 
You
 
ÿn
 
®so
 
suµly
 
the
 
fŞlowšg
 
İtiÚ®
 
cÚfig
 
’Œ›s
::

326 
toŞs
.
xmÌpc
.
’codšg
: 'utf-8'

327 
toŞs
.
xmÌpc
.
®low_nÚe
: 0

329 
XML
-
RPC
 
is
 
a
 
¿th”
 
discÚtšuous
 
Ïy”
 
ov”
 
HTTP
; 
di¥©chšg
 
to
 
the


330 
­´İrŸ‹
 
hªdËr
 
mu¡
 
fœ¡
 
be
 
³rfÜmed
 
accÜdšg
 
to
 
the
 
URL
, 
ªd


331 
th’
 
a
 
£cÚd
 
di¥©ch
 
¡•
 
mu¡
 
ke
 
¶aû
 
accÜdšg
 
to
 
the
 
RPC
 
m‘hod


332 
¥ecif›d
 
š
 
the
 
»que¡
 
body
. 
It
 
®so
 
®lows
 
a
 
su³ræuous
 "/RPC2"

333 
´efix
 
š
 
the
 
URL
, 
suµl›s
 
™s
 
own
 
hªdËr
 
¬gs
 iÀth
body
, 
ªd


334 
»quœes
 
a
 200 
OK
 "FauÉ" 
»¥Ú£
 
š¡—d
 
of
 404 
wh’
 
the
 
desœed


335 
m‘hod
 
is
 
nÙ
 
found
.

337 
Th”efÜe
, 
XML
-
RPC
 
ÿÂÙ
 
be
 
im¶em’‹d
 
Ch”ryPy
 
vŸ
 
a
 
ToŞ
 
®Úe
.

338 
This
 
CÚŒŞËr
 
aùs
 
as
 
the
 
di¥©ch
 
rg‘
 th
fœ¡
 
	`h®f
 (
ba£d


339 
Ú
 
the
 
URL
); 
™
 
th’
 
»ads
h
RPC
 
m‘hod
 
äom
h
»que¡
 
body
 
ªd


340 
dÛs
 
™s
 
own
 
£cÚd
 
di¥©ch
 
¡•
 
ba£d
 
Ú
 
th©
 
m‘hod
. 
It
 
®so
 
»ads


341 
body
 
·¿ms
, 
ªd
 
»tuºs
 
a
 
FauÉ
 
Ú
 
”rÜ
.

343 
The
 
XMLRPCDi¥©ch”
 
¡rs
 
ªy
 /
RPC2
 
´efix
; 
you
 
¬’
't using /RPC2

344 
š
 
your
 
URL
's, you can safely skipurning onhe XMLRPCDispatcher.

345 
Oth”wi£
, 
you
 
Ãed
 
to
 
u£
 
deş¬e
 
™
 
š
 
cÚfig
::

347 
»que¡
.
di¥©ch
: 
ch”rypy
.di¥©ch.
	`XMLRPCDi¥©ch”
()

350 #NÙ
we
'» h¬d-codšghi štØth'
toŞs
'‚amespace. We could do

351 #¨
huge
 
amouÁ
 
of
 
wÜk
 
to
 
make
 
™
 
»loÿbË
, 
but
 
the
 
Úly
 
»asÚ
 
why


352 #would 
be
 
someÚe
 
aùu®ly
 
di§bËd
 
the
 
deçuÉ_toŞbox
. 
Meh
.

353 
_ı_cÚfig
 = {'toŞs.xmÌpc.Ú': 
True
}

355 
def
 (
£lf
, *
v·th
, **
·¿ms
):

356 
½ı¬ams
, 
½cm‘hod
 = 
_xmÌpc
.
	$´oûss_body
()

358 
subhªdËr
 = 
£lf


359 
©Œ
 
š
 
	`¡r
(
½cm‘hod
).
	`¥l™
('.'):

360 
subhªdËr
 = 
	$g‘©Œ
(
subhªdËr
, 
©Œ
, 
NÚe
)

362 
subhªdËr
 
ªd
 
	`g‘©Œ
(subhªdËr, "expo£d", 
F®£
):

363 
body
 = 
	`subhªdËr
(*(
v·th
 + 
½ı¬ams
), **
·¿ms
)

367 #ià
a
 
m‘hod
 
is
 
nÙ
 
found
, 
ª
 
xmÌpşib
.
FauÉ
 
should
 
be
 
»tuºed


368 #¿isšg 
ª
 
exû±iÚ
 
h”e
 
wl
 dØ
th©
; 
£e


369 #ch”rypy.
lib
.
xmÌpcut
.
Ú_”rÜ


370 
¿i£
 
	`Exû±iÚ
('m‘hod "%s" i nÙ suµÜ‹d' % 
©Œ
)

372 
cÚf
 = 
ch”rypy
.
£rvšg
.
»que¡
.
toŞm­s
['toŞs'].
	`g‘
("xmÌpc", {
	}
})

373 
	g_xmÌpc
.
»¥Úd
(
body
,

374 
cÚf
.
g‘
('encoding', 'utf-8'),

375 
cÚf
.
g‘
('allow_none', 0))

376  
	gch”rypy
.
	g£rvšg
.
	g»¥Ú£
.
body


377 .
	gexpo£d
 = 
True


380 
şass
 
	$SessiÚAuthToŞ
(
HªdËrToŞ
):

382 
def
 
	$_£rgs
(
£lf
):

383 
Çme
 
š
 
	$dœ
(
ıtoŞs
.
SessiÚAuth
):

384 
nÙ
 
Çme
.
	`¡¬tsw™h
("__"):

385 
	$£‰r
(
£lf
, 
Çme
, 
NÚe
)

388 
şass
 
	$CachšgToŞ
(
ToŞ
):

391 
def
 
	$_w¿µ”
(
£lf
, **
kw¬gs
):

392 
»que¡
 = 
ch”rypy
.
£rvšg
.request

393 
_ÿchšg
.
	$g‘
(**
kw¬gs
):

394 
»que¡
.
hªdËr
 = 
NÚe


396 
»que¡
.
ÿch—bË
:

397 #NÙ
the
 
devious
 
‹chnique
 
h”e
 
of
 
addšg
 
hooks
 
Ú
h
æy


398 
»que¡
.
hooks
.
	`©ch
('befÜe_fš®ize', 
_ÿchšg
.
‹e_ouut
,

399 
´iÜ™y
 = 90)

400 
_w¿µ”
.
´iÜ™y
 = 20

402 
def
 
	$_£tup
(
£lf
):

404 
cÚf
 = 
£lf
.
	$_m”ged_¬gs
()

406 
p
 = 
cÚf
.
	`pİ
("´iÜ™y", 
NÚe
)

407 
ch”rypy
.
£rvšg
.
»que¡
.
hooks
.
	`©ch
('befÜe_hªdËr', 
£lf
.
_w¿µ”
,

408 
´iÜ™y
=
p
, **
cÚf
)

412 
şass
 
	$ToŞbox
(
objeù
):

415 
This
 
objeù
 
®so
 
funùiÚs
 
as
 
a
 
cÚfig
 
Çme¥aû
 
hªdËr
 
™£lf
.

416 
Cu¡om
 
toŞboxes
 
should
 
be
 
added
 
to
 
—ch
 
AµliÿtiÚ
'soolboxes dict.

419 
def
 
	$__š™__
(
£lf
, 
Çme¥aû
):

420 
£lf
.
Çme¥aû
 =‚amespace

422 
def
 
	$__£‰r__
(
£lf
, 
Çme
, 
v®ue
):

423 #Ià
the
 
ToŞ
.
_Çme
 
is
 
NÚe
, 
suµly
 
™
 
äom
h
©Œibu‹
 
Çme
.

424 
	$isš¡ªû
(
v®ue
, 
ToŞ
):

425 
v®ue
.
_Çme
 
is
 
NÚe
:

426 
v®ue
.
_Çme
 = 
Çme


427 
v®ue
.
Çme¥aû
 = 
£lf
.namespace

428 
objeù
.
	$__£‰r__
(
£lf
, 
Çme
, 
v®ue
)

430 
def
 
	$__’‹r__
(
£lf
):

432 
ch”rypy
.
£rvšg
.
»que¡
.
toŞm­s
[
£lf
.
Çme¥aû
] = 
m­
 = {
	}
}

433 
def
 
	$pİuÏ‹
(
k
, 
v
):

434 
toŞÇme
, 
¬g
 = 
k
.
	`¥l™
(".", 1)

435 
buck‘
 = 
m­
.
	`£tdeçuÉ
(
toŞÇme
, {
	}
})

436 
	gbuck‘
[
¬g
] = 
v


437  
pİuÏ‹


439 
def
 
	$__ex™__
(
£lf
, 
exc_ty³
, 
exc_v®
, 
exc_tb
):

441 
m­
 = 
ch”rypy
.
£rvšg
.
»que¡
.
toŞm­s
.
	$g‘
(
£lf
.
Çme¥aû
)

442 
m­
:

443 
Çme
, 
£‰šgs
 
š
 
m­
.
	$™ems
():

444 
£‰šgs
.
	`g‘
("Ú", 
F®£
):

445 
toŞ
 = 
	$g‘©Œ
(
£lf
, 
Çme
)

446 
toŞ
.
	$_£tup
()

449 
şass
 
	$D•»ÿ‹dToŞ
(
ToŞ
):

451 
_Çme
 = 
NÚe


452 
w¬nmsg
 = "This Tool is deprecated."

454 
def
 
	$__š™__
(
£lf
, 
pošt
, 
w¬nmsg
=
NÚe
):

455 
£lf
.
pošt
 =…oint

456 
w¬nmsg
 
is
 
nÙ
 
NÚe
:

457 
£lf
.
w¬nmsg
 = warnmsg

459 
def
 
	$__ÿÎ__
(
£lf
, *
¬gs
, **
kw¬gs
):

460 
w¬nšgs
.
	$w¬n
(
£lf
.
w¬nmsg
)

461 
def
 
	$toŞ_decÜ©Ü
(
f
):

462  
f


463  
toŞ_decÜ©Ü


465 
def
 
	$_£tup
(
£lf
):

466 
w¬nšgs
.
	$w¬n
(
£lf
.
w¬nmsg
)

469 
deçuÉ_toŞbox
 = 
_d
 = 
	`ToŞbox
("tools")

470 
_d
.
£ssiÚ_auth
 = 
	$SessiÚAuthToŞ
(
ıtoŞs
.
£ssiÚ_auth
)

471 
_d
.
®low
 = 
	`ToŞ
('Ú_¡¬t_»sourû', 
ıtoŞs
.allow)

472 
_d
.
´oxy
 = 
	`ToŞ
('befÜe_»que¡_body', 
ıtoŞs
.´oxy, 
´iÜ™y
=30)

473 
_d
.
»¥Ú£_h—d”s
 = 
	`ToŞ
('Ú_¡¬t_»sourû', 
ıtoŞs
.response_headers)

474 
_d
.
log_Œaûbacks
 = 
	`ToŞ
('befÜe_”rÜ_»¥Ú£', 
ıtoŞs
.
log_Œaûback
)

475 
_d
.
log_h—d”s
 = 
	`ToŞ
('befÜe_”rÜ_»¥Ú£', 
ıtoŞs
.
log_»que¡_h—d”s
)

476 
_d
.
log_hooks
 = 
	`ToŞ
('Ú_’d_»que¡', 
ıtoŞs
.log_hooks, 
´iÜ™y
=100)

477 
_d
.
”r_»dœeù
 = 
	$E¼ÜToŞ
(
ıtoŞs
.
»dœeù
)

478 
_d
.
‘ags
 = 
	`ToŞ
('befÜe_fš®ize', 
ıtoŞs
.
v®id©e_‘ags
, 
´iÜ™y
=75)

479 
_d
.
decode
 = 
	`ToŞ
('befÜe_»que¡_body', 
’codšg
.decode)

480 #th
Üd”
 
of
 
’codšg
, 
gz
, 
ÿchšg
 
is
 
impÜÁ


481 
_d
.
’code
 = 
	`ToŞ
('befÜe_hªdËr', 
’codšg
.
Re¥Ú£Encod”
, 
´iÜ™y
=70)

482 
_d
.
gz
 = 
	`ToŞ
('befÜe_fš®ize', 
’codšg
.gz, 
´iÜ™y
=80)

483 
_d
.
¡©icdœ
 = 
	$HªdËrToŞ
(.
¡©icdœ
)

484 
_d
.
¡©icfe
 = 
	$HªdËrToŞ
(.
¡©icfe
)

485 
_d
.
£ssiÚs
 = 
	$SessiÚToŞ
()

486 
_d
.
xmÌpc
 = 
	$E¼ÜToŞ
(
_xmÌpc
.
Ú_”rÜ
)

487 
_d
.
ÿchšg
 = 
	`CachšgToŞ
('befÜe_hªdËr', 
_ÿchšg
.
g‘
, 'caching')

488 
_d
.
expœes
 = 
	`ToŞ
('befÜe_fš®ize', 
_ÿchšg
.expires)

489 
_d
.
tidy
 = 
	`D•»ÿ‹dToŞ
('before_finalize',

492 
_d
.
nsgmls
 = 
	`D•»ÿ‹dToŞ
('before_finalize',

495 
_d
.
ignÜe_h—d”s
 = 
	`ToŞ
('befÜe_»que¡_body', 
ıtoŞs
.ignore_headers)

496 
_d
.
»ã»r
 = 
	`ToŞ
('befÜe_»que¡_body', 
ıtoŞs
.referer)

497 
_d
.
basic_auth
 = 
	`ToŞ
('Ú_¡¬t_»sourû', 
auth
.basic_auth)

498 
_d
.
dige¡_auth
 = 
	`ToŞ
('Ú_¡¬t_»sourû', 
auth
.digest_auth)

499 
_d
.
Œašg_¦ash
 = 
	`ToŞ
('befÜe_hªdËr', 
ıtoŞs
.Œašg_¦ash, 
´iÜ™y
=60)

500 
_d
.
æ©‹n
 = 
	`ToŞ
('befÜe_fš®ize', 
ıtoŞs
.flatten)

501 
_d
.
acû±
 = 
	`ToŞ
('Ú_¡¬t_»sourû', 
ıtoŞs
.accept)

502 
_d
.
»dœeù
 = 
	`ToŞ
('Ú_¡¬t_»sourû', 
ıtoŞs
.redirect)

503 
_d
.
autov¬y
 = 
	`ToŞ
('Ú_¡¬t_»sourû', 
ıtoŞs
.autov¬y, 
´iÜ™y
=0)

504 
_d
.
jsÚ_š
 = 
	`ToŞ
('befÜe_»que¡_body', 
jsÚtoŞs
.jsÚ_š, 
´iÜ™y
=30)

505 
_d
.
jsÚ_out
 = 
	`ToŞ
('befÜe_hªdËr', 
jsÚtoŞs
.jsÚ_out, 
´iÜ™y
=30)

506 
_d
.
auth_basic
 = 
	`ToŞ
('befÜe_hªdËr',‡uth_basic.
basic_auth
, 
´iÜ™y
=1)

507 
_d
.
auth_dige¡
 = 
	`ToŞ
('befÜe_hªdËr',‡uth_dige¡.
dige¡_auth
, 
´iÜ™y
=1)

509 
d–
 
_d
, 
ıtoŞs
, 
’codšg
, 
auth
, 

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/_cptree.py

3 
impÜt
 
os


4 
impÜt
 
sys


6 
impÜt
 
ch”rypy


7 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
	gÁou
, 
py3k


8 
äom
 
ch”rypy
 
impÜt
 
	g_ıcÚfig
, 
	g_ıloggšg
, 
	g_ı»que¡
, 
	g_ıwsgi
, 
toŞs


9 
äom
 
	gch”rypy
.
lib
 
impÜt
 
h‰put


12 
şass
 
	$AµliÿtiÚ
(
objeù
):

15 
S”v”s
 
ªd
 
g©eways
 
should
 
nÙ
 
š¡ªtŸ‹
 
Reque¡
 
objeùs
 
dœeùly
.

16 
In¡—d
, 
they
 
should
 
ask
 
ª
 
AµliÿtiÚ
 
objeù
 
a
 
»que¡
 object.

18 
An
 
š¡ªû
 
of
 
this
 
şass
 
may
 
®so
 
be
 
u£d
 
as
 
a
 
WSGI
 
ÿÎabË


19 (
WSGI
 
­¶iÿtiÚ
 
objeù
è
™£lf
.

22 
roÙ
 = 
NÚe


24 
be
 
¬¿nged
 
š
 
a
 
h›¿rchy
 
of
 
©Œibu‹s
, 
m©chšg
 
the
 
ex³ùed
 
URI


25 
h›¿rchy
; 
the
  
di¥©ch”
 
th’
 
£¬ches
 
this
 h›¿rchy 
a


26 
m©chšg
 
hªdËr
. 
Wh’
 
usšg
 
a
 
di¥©ch”
 
Ùh”
 
thª
 
the
 ,

27 
this
 
v®ue
 
may
 
be
 
NÚe
."""

29 
cÚfig
 = {
	}
}

31 
of
 {
key
: 
v®ue
} 
·œs
."""

33 
Çme¥aûs
 = 
_ıcÚfig
.
	$Name¥aûS‘
()

34 
toŞboxes
 = {'toŞs': 
ch”rypy
.
toŞs
}

36 
log
 = 
NÚe


39 
wsgŸµ
 = 
NÚe


42 
»que¡_şass
 = 
_ı»que¡
.
Reque¡


43 
»¥Ú£_şass
 = 
_ı»que¡
.
Re¥Ú£


45 
»Ïtive_u¾s
 = 
F®£


47 
def
 
__š™__
(
£lf
, 
roÙ
, 
süt_Çme
="", 
cÚfig
=
NÚe
):

48 
£lf
.
log
 = 
_ıloggšg
.
LogMªag”
(
id
(£lf), 
ch”rypy
.log.
logg”_roÙ
)

49 
	g£lf
.
	groÙ
 = 
roÙ


50 
£lf
.
süt_Çme
 = script_name

51 
£lf
.
wsgŸµ
 = 
_ıwsgi
.
	$CPWSGIAµ
(
£lf
)

53 
£lf
.
Çme¥aûs
 = s–f.Çme¥aûs.
	$cİy
()

54 
£lf
.
Çme¥aûs
["log"] = 
Ïmbda
 
k
, 
v
: 
	$£‰r
(
£lf
.
log
, 
k
, 
v
)

55 
£lf
.
Çme¥aûs
["wsgi"] = s–f.
wsgŸµ
.
Çme¥aû_hªdËr


57 
£lf
.
cÚfig
 = s–f.
__şass__
.cÚfig.
	$cİy
()

58 
cÚfig
:

59 
£lf
.
	$m”ge
(
cÚfig
)

61 
def
 
	$__»´__
(
£lf
):

62  "%s.%s(%r, %r)" % (
£lf
.
__moduË__
, s–f.
__şass__
.
__Çme__
,

63 
£lf
.
roÙ
, s–f.
süt_Çme
)

65 
süt_Çme_doc
 = """ThURI "
mouÁ
 
pošt
" forhis‡pp. A mount…oint ishat…ortion of

66 
the
 
URI
 
which
 
is
 
cÚ¡ªt
 
®l
 
URIs
 
th©
 
¬e
 
£rviûd
 
by
 
this


67 
­¶iÿtiÚ
; 
™
 
dÛs
 
nÙ
 
šşude
 
scheme
, 
ho¡
, 
Ü
 
	`´oxy
 ("virtual host")

68 
pÜtiÚs
 
of
 
the
 
URI
.

70 
FÜ
 
exam¶e
, 
süt_Çme
 
is
 "/my/coŞ/­p", 
th’
 
the
 
URL


71 "h‰p://www.exam¶e.com/my/coŞ/­p/·ge1" 
might
 
be
 
hªdËd
 
by
 
a


72 "·ge1" 
m‘hod
 
Ú
 
the
 
roÙ
 
objeù
.

74 
The
 
v®ue
 
of
 
süt_Çme
 
MUST
 
NOT
 
’d
 
š
 
a
 
¦ash
. 
If
 
the
 script_name

75 
»ãrs
 
to
 
the
 
roÙ
 
of
h
URI
, 
™
 
MUST
 
be
 
ª
 
em±y
 
	`¡ršg
 (
nÙ
 "/").

77 
If
 
süt_Çme
 
is
 
ex¶ic™ly
 
£t
 
to
 
NÚe
, 
th’
 
the
 süt_Çm
wl
 
be


78 
´ovided
 
—ch
 
ÿÎ
 
äom
 
»que¡
.
wsgi_’vœÚ
['SCRIPT_NAME'].

80 
def
 
	$_g‘_süt_Çme
(
£lf
):

81 
£lf
.
_süt_Çme
 
is
 
NÚe
:

82 #NÚ
sigÇls
 
th©
 
the
 
süt
 
Çme
 
should
 
be
 
puÎed
 
äom
 
WSGI
 
’vœÚ
.

83  
ch”rypy
.
£rvšg
.
»que¡
.
wsgi_’vœÚ
['SCRIPT_NAME'].
	`r¡r
("/")

84  
£lf
.
_süt_Çme


85 
def
 
	$_£t_süt_Çme
(
£lf
, 
v®ue
):

86 
v®ue
:

87 
v®ue
 = v®ue.
	`r¡r
("/")

88 
£lf
.
_süt_Çme
 = 
v®ue


89 
süt_Çme
 = 
	$´İ”ty
(
fg‘
=
_g‘_süt_Çme
, 
f£t
=
_£t_süt_Çme
,

90 
doc
=
süt_Çme_doc
)

92 
def
 
	$m”ge
(
£lf
, 
cÚfig
):

94 
_ıcÚfig
.
	$m”ge
(
£lf
.
cÚfig
, config)

96 #HªdË 
Çme¥aûs
 
¥ecif›d
 
š
 
cÚfig
.

97 
£lf
.
	`Çme¥aûs
(£lf.
cÚfig
.
	`g‘
("/", {
	}
}))

99 
def
 
	$fšd_cÚfig
(
£lf
, 
·th
, 
key
, =
NÚe
):

101 
Œa
 = 
·th
 
Ü
 "/"

102 
Œa
:

103 
nodecÚf
 = 
£lf
.
cÚfig
.
	`g‘
(
Œa
, {
	}
})

105 
key
 
š
 
	gnodecÚf
:

106  
nodecÚf
[
key
]

108 
Ï¡¦ash
 = 
Œa
.
rfšd
("/")

109 
Ï¡¦ash
 == -1:

111 
–if
 
Ï¡¦ash
 =ğ0 
ªd
 
Œa
 != "/":

112 
Œa
 = "/"

114 
Œa
 =¿[:
Ï¡¦ash
]

118 
def
 
	$g‘_£rvšg
(
£lf
, 
loÿl
, 
»mÙe
, 
scheme
, 
¥rÙo
):

120 
»q
 = 
£lf
.
	$»que¡_şass
(
loÿl
, 
»mÙe
, 
scheme
, 
¥rÙo
)

121 
»q
.
­p
 = 
£lf


123 
Çme
, 
toŞbox
 
š
 
£lf
.
toŞboxes
.
	$™ems
():

124 
»q
.
Çme¥aûs
[
Çme
] = 
toŞbox


126 
»¥
 = 
£lf
.
	$»¥Ú£_şass
()

127 
ch”rypy
.
£rvšg
.
	$lßd
(
»q
, 
»¥
)

128 
ch”rypy
.
’gše
.
	`publish
('acquire_thread')

129 
ch”rypy
.
’gše
.
	`publish
('before_request')

131  
»q
, 
»¥


133 
def
 
	$»Ëa£_£rvšg
(
£lf
):

135 
»q
 = 
ch”rypy
.
£rvšg
.
»que¡


137 
ch”rypy
.
’gše
.
	`publish
('after_request')

139 
Œy
:

140 
»q
.
	$şo£
()

141 
exû±
:

142 
ch”rypy
.
	$log
(
Œaûback
=
True
, 
£v”™y
=40)

144 
ch”rypy
.
£rvšg
.
	$ş—r
()

146 
def
 
	$__ÿÎ__
(
£lf
, 
’vœÚ
, 
¡¬t_»¥Ú£
):

147  
£lf
.
	$wsgŸµ
(
’vœÚ
, 
¡¬t_»¥Ú£
)

150 
şass
 
	$T»e
(
objeù
):

153 
An
 
š¡ªû
 
of
 
this
 
şass
 
may
 
®so
 
be
 
u£d
 
as
 
a
 
WSGI
 
ÿÎabË


154 (
WSGI
 
­¶iÿtiÚ
 
objeù
), 
š
 
which
 
™
 
di¥©ches
 
to
 
®l


155 
mouÁed
 
­ps
.

158 
­ps
 = {
	}
}

160 
A
 
diù
 
of
 
the
 
fÜm
 {
süt
 
Çme
: 
­¶iÿtiÚ
}, 
	gwh”e
 "script‚ame"

161 
is
 
a
 
¡ršg
 
deş¬šg
 
the
 
URI
 
mouÁ
 
pošt
 (
no
 
Œašg
 
¦ash
), 
	gªd


162 "­¶iÿtiÚ" 
is
 
ª
 
š¡ªû
 
of
 
	gch”rypy
.
AµliÿtiÚ
 (
Ü
‡À
¬b™¿ry


163 
WSGI
 
ÿÎabË
 
you
 
h­³n
 
to
 
be
 
usšg
 
a
 WSGI 
£rv”
)."""

165 
def
 
	$__š™__
(
£lf
):

166 
£lf
.
­ps
 = {
	}
}

168 
def
 
mouÁ
(
£lf
, 
roÙ
, 
süt_Çme
="", 
cÚfig
=
NÚe
):

171 
roÙ


172 
An
 
š¡ªû
 
of
 
a
 "cÚŒŞË¸şass" (¨
cŞËùiÚ
 oà
·ge


173 
hªdËr
 
m‘hods
è
which
 
»´e£Ás
 
the
 
roÙ
 
of
h
­¶iÿtiÚ
.

174 
This
 
may
 
®so
 
be
 
ª
 
AµliÿtiÚ
 
š¡ªû
, 
Ü
 
NÚe
 
usšg


175 
a
 
di¥©ch”
 
Ùh”
 
thª
 
the
 .

177 
süt_Çme


178 
A
 
¡ršg
 
cÚššg
 
	gthe
 "mouÁ…ošt" 
of
 
the
 
	g­¶iÿtiÚ
.

179 
This
 
should
 
¡¬t
 
w™h
 
a
 
	g¦ash
, 
ªd
 
be
 
the
 
·th
 
pÜtiÚ
 
of
he

180 
URL
 
©
 
which
 
to
 
mouÁ
 
the
 
giv’
 
	groÙ
. 
FÜ
 
	gexam¶e
, roÙ.
	$šdex
()

181 
wl
 
hªdË
 
»que¡s
 
to
 "http://www.example.com:8080/dept/app1/",

182 
th’
 
the
 
süt_Çme
 
¬gum’t
 
would
 
be
 "/dept/app1".

184 
It
 
MUST
 
NOT
 
’d
 
š
 
a
 
¦ash
. 
If
 
the
 
süt_Çme
 
»ãrs
 
to
he

185 
roÙ
 
of
 
the
 
URI
, 
™
 
MUST
 
be
 
ª
 
em±y
 
	`¡ršg
 (
nÙ
 "/").

187 
cÚfig


188 
A
 
fe
 
Ü
 
diù
 
cÚššg
 
­¶iÿtiÚ
 
cÚfig
.

190 
süt_Çme
 
is
 
NÚe
:

191 
¿i£
 
	`Ty³E¼Ü
(

198 #Nexˆ
lše
 
bÙh
 1è
¡rs
 
Œašg
 
¦ash
 
ªd
 2è
m­s
 "/" -> "".

199 
süt_Çme
 = süt_Çme.
	`r¡r
("/")

201 
	$isš¡ªû
(
roÙ
, 
AµliÿtiÚ
):

202 
­p
 = 
roÙ


203 
süt_Çme
 !ğ"" 
ªd
 süt_Çm!ğ
­p
.script_name:

204 
¿i£
 
	`V®ueE¼Ü
("Cannot specify‡ different script‚ame‡nd "

206 
süt_Çme
 = 
­p
.script_name

208 
­p
 = 
	$AµliÿtiÚ
(
roÙ
, 
süt_Çme
)

210 #Ià
mouÁed
 
©
 "", 
add
 
çvicÚ
.
ico


211 ià(
süt_Çme
 =ğ"" 
ªd
 
roÙ
 
is
 
nÙ
 
NÚe


212 
ªd
 
nÙ
 
	`ha§‰r
(
roÙ
, "favicon_ico")):

213 
çvicÚ
 = 
os
.
·th
.
	`još
(os.
	`g‘cwd
(), os.·th.
	`dœÇme
(
__fe__
),

215 
roÙ
.
çvicÚ_ico
 = 
toŞs
.
¡©icfe
.
	$hªdËr
(
çvicÚ
)

217 
cÚfig
:

218 
­p
.
	$m”ge
(
cÚfig
)

220 
£lf
.
­ps
[
süt_Çme
] = 
­p


222  
­p


224 
def
 
	`g¿á
(
£lf
, 
wsgi_ÿÎabË
, 
süt_Çme
=""):

226 #Nexˆ
lše
 
bÙh
 1è
¡rs
 
Œašg
 
¦ash
 
ªd
 2è
m­s
 "/" -> "".

227 
süt_Çme
 = süt_Çme.
	`r¡r
("/")

228 
£lf
.
­ps
[
süt_Çme
] = 
wsgi_ÿÎabË


230 
def
 
	$süt_Çme
(
£lf
, 
·th
=
NÚe
):

233 
If
 
·th
 
is
 
NÚe
, 
ch”rypy
.
»que¡
 i 
u£d
.

235 
·th
 
is
 
NÚe
:

236 
Œy
:

237 
»que¡
 = 
ch”rypy
.
£rvšg
.request

238 
·th
 = 
h‰put
.
	$u¾još
(
»que¡
.
süt_Çme
,

239 
»que¡
.
·th_šfo
)

240 
exû±
 
A‰ribu‹E¼Ü
:

241  
NÚe


243 
True
:

244 
·th
 
š
 
£lf
.
­ps
:

245  
·th


247 
·th
 == "":

248  
NÚe


250 #Mov
Úe
 
node
 
up
 
the
 
Œ“
 
ªd
 
Œy
 
agaš
.

251 
·th
 =…©h[:·th.
	`rfšd
("/")]

253 
def
 
	$__ÿÎ__
(
£lf
, 
’vœÚ
, 
¡¬t_»¥Ú£
):

254 #Ià
you
'» c®lšghis,h’ you'
»
 
´obably
 
£‰šg
 
SCRIPT_NAME


255 #tØ'' (
some
 
WSGI
 
£rv”s
 
®ways
 
£t
 
SCRIPT_NAME
 
to
 '').

256 #Try 
to
 
look
 
up
 
the
 
­p
 
usšg
h
fuÎ
 
·th
.

257 
’v1x
 = 
’vœÚ


258 
’vœÚ
.
	`g‘
(
	`Áou
('wsgi.version')) == (ntou('u'), 0):

259 
’v1x
 = 
_ıwsgi
.
	$downg¿de_wsgi_ux_to_1x
(
’vœÚ
)

260 
·th
 = 
h‰put
.
	`u¾još
(
’v1x
.
	`g‘
('SCRIPT_NAME', ''),

261 
’v1x
.
	`g‘
('PATH_INFO', ''))

262 
¢
 = 
£lf
.
	`süt_Çme
(
·th
 
Ü
 "/")

263 
¢
 
is
 
NÚe
:

264 
	`¡¬t_»¥Ú£
('404 Not Found', [])

267 
­p
 = 
£lf
.
­ps
[
¢
]

269 #CÜ»ù 
the
 
SCRIPT_NAME
 
ªd
 
PATH_INFO
 
’vœÚ
 
’Œ›s
.

270 
’vœÚ
 =ƒnvœÚ.
	$cİy
()

271 
nÙ
 
py3k
:

272 
’vœÚ
.
	`g‘
(
	`Áou
('wsgi.version')) == (ntou('u'), 0):

273 #PythÚ 2/
WSGI
 
u
.0: 
®l
 
¡ršgs
 
MUST
 
be
 
of
 
ty³
 
unicode


274 
’c
 = 
’vœÚ
[
	`Áou
('wsgi.url_encoding')]

275 
’vœÚ
[
	`Áou
('SCRIPT_NAME')] = 
¢
.
	$decode
(
’c
)

276 
’vœÚ
[
	`Áou
('PATH_INFO')] = 
·th
[
	`Ën
(
¢
.
	`r¡r
("/")):].
	$decode
(
’c
)

278 #PythÚ 2/
WSGI
 1.x: 
®l
 
¡ršgs
 
MUST
 
be
 
of
 
ty³
 
¡r


279 
’vœÚ
['SCRIPT_NAME'] = 
¢


280 
’vœÚ
['PATH_INFO'] = 
·th
[
	`Ën
(
¢
.
	`r¡r
("/")):]

282 
’vœÚ
.
	`g‘
(
	`Áou
('wsgi.version')) == (ntou('u'), 0):

283 #PythÚ 3/
WSGI
 
u
.0: 
®l
 
¡ršgs
 
MUST
 
be
 
fuÎ
 
unicode


284 
’vœÚ
['SCRIPT_NAME'] = 
¢


285 
’vœÚ
['PATH_INFO'] = 
·th
[
	`Ën
(
¢
.
	`r¡r
("/")):]

287 #PythÚ 3/
WSGI
 1.x: 
®l
 
¡ršgs
 
MUST
 
be
 
ISO
-8859-1 
¡r


288 
’vœÚ
['SCRIPT_NAME'] = 
¢
.
	`’code
('utf-8').
	`decode
('ISO-8859-1')

289 
’vœÚ
['PATH_INFO'] = 
·th
[
	`Ën
(
¢
.
	`r¡r
("/")):].
	`’code
('utf-8').
	`decode
('ISO-8859-1')

290  
	`­p
(
’vœÚ
, 
¡¬t_»¥Ú£
)

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/_cpwsgi.py

3 
NÙe
 
th©
 
WSGI
 
’vœÚ
 
keys
 
ªd
 
v®ues
 
	g¬e
 'Çtiv¡ršgs';h© 
	gis
,

4 
wh©ev”
 
the
 
ty³
 
	gof
 "" 
	gis
. 
FÜ
 
	gPythÚ
 2, 
	gth©
's‡ byte string; for Python 3,

5 
	g™
' ¨unicod¡ršg. BuˆPEP 3333 says: "ev’ iàPythÚ'
s
 
¡r
 
ty³
 
is


6 
aùu®ly
 
	gUnicode
 "und”hhood", 
the
 
cÚ‹Á
 
of
 
Çtive
 
¡ršgs
 
mu¡


7 
¡l
 
be
 
Œª¦©abË
 
to
 
by‹s
 
vŸ
 
the
 
	gL©š
-1 
	g’codšg
!"

10 
impÜt
 
sys
 
as
 
_sys


12 
impÜt
 
ch”rypy
 
as
 
_ch”rypy


13 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
	gBy‹sIO
, 
	gby‹¡r
, 
	gÁob
, 
	gÁou
, 
	gpy3k
, 
unicode¡r


14 
äom
 
ch”rypy
 
impÜt
 
_ı”rÜ


15 
äom
 
	gch”rypy
.
lib
 
impÜt
 
h‰put


18 
def
 
	$downg¿de_wsgi_ux_to_1x
(
’vœÚ
):

20 
’v1x
 = {
	}
}

22 
u¾_’codšg
 = 
’vœÚ
[
Áou
('wsgi.url_encoding')]

23 
k
, 
v
 
š
 
li¡
(
’vœÚ
.
	$™ems
()):

24 
k
 
š
 [
	`Áou
('PATH_INFO'),‚tou('SCRIPT_NAME'),‚tou('QUERY_STRING')]:

25 
v
 = v.
	$’code
(
u¾_’codšg
)

26 
–if
 
	$isš¡ªû
(
v
, 
unicode¡r
):

27 
v
 = v.
	`’code
('ISO-8859-1')

28 
’v1x
[
k
.
	`’code
('ISO-8859-1')] = 
v


30  
’v1x


33 
şass
 
	$Vœtu®Ho¡
(
objeù
):

36 
This
 
ÿn
 
be
 
u£ful
 
wh’
 
ruÂšg
 
muÉË
 
s™es
 
w™hš
 
Úe
 
CP
 
£rv”
.

37 
It
 
®lows
 
£v”®
 
domašs
 
to
 
pošt
Ø
difã»Á
 
­¶iÿtiÚs
. 
FÜ
 
exam¶e
::

39 
roÙ
 = 
	$RoÙ
()

40 
RoÙAµ
 = 
ch”rypy
.
	$AµliÿtiÚ
(
roÙ
)

41 
Domaš2Aµ
 = 
ch”rypy
.
	$AµliÿtiÚ
(
roÙ
)

42 
Secu»Aµ
 = 
ch”rypy
.
	`AµliÿtiÚ
(
	$Secu»
())

44 
vho¡
 = 
ch”rypy
.
_ıwsgi
.
	`Vœtu®Ho¡
(
RoÙAµ
,

45 
domašs
={'www.domaš2.exam¶e': 
Domaš2Aµ
,

46 'www.domaš2.exam¶e:443': 
Secu»Aµ
,

47 
	}
})

49 
ch”rypy
.
Œ“
.
g¿á
(
vho¡
)

51  = 
NÚe


54 
u£_x_fÜw¬ded_ho¡
 = 
True


55 """IàTruÑhdeçuÉ),‡ny "
X
-
FÜw¬ded
-
Ho¡
"

56 
»que¡
 
h—d”
 
wl
 
be
 
u£d
 
š¡—d
 
of
 
the
 "Ho¡" h—d”. 
This


57 
is
 
commÚly
 
added
 
by
 
HTTP
 
	$£rv”s
 (
such
 
as
 
A·che
è
wh’
 
´oxyšg
."""

59 
domašs
 = {
	}
}

61 
The
 
šcomšg
 "Ho¡" 
»que¡
 
h—d”
 
is
 
looked
 
up
 
š
 
this
 
diù
,

62 
	gªd
, 
a
 
m©ch
 
is
 
	gfound
, 
the
 
cÜ»¥Údšg
 
WSGI
 
­¶iÿtiÚ


63 
wl
 
be
 
ÿÎed
 
š¡—d
 
of
 
the
 . 
NÙe
 
th©
 
you
 
oá’
 
Ãed


64 
£·¿‹
 
’Œ›s
 "exam¶e.com" 
	gªd
 "www.example.com".

65 
In
 
	gadd™iÚ
, "Ho¡" 
h—d”s
 
may
 
cÚš
 
the
 
pÜt
 
	gnumb”
.

68 
def
 
	$__š™__
(
£lf
, , 
domašs
=
NÚe
, 
u£_x_fÜw¬ded_ho¡
=
True
):

69 
£lf
. = 

70 
£lf
.
domašs
 = domaš 
Ü
 {
	}
}

71 
£lf
.
u£_x_fÜw¬ded_ho¡
 = use_x_forwarded_host

73 
def
 
	$__ÿÎ__
(
£lf
, 
’vœÚ
, 
¡¬t_»¥Ú£
):

74 
domaš
 = 
’vœÚ
.
	`g‘
('HTTP_HOST', '')

75 
£lf
.
u£_x_fÜw¬ded_ho¡
:

76 
domaš
 = 
’vœÚ
.
	`g‘
("HTTP_X_FORWARDED_HOST", domain)

78 
Ãxµ
 = 
£lf
.
domašs
.
	$g‘
(
domaš
)

79 
Ãxµ
 
is
 
NÚe
:

80 
Ãxµ
 = 
£lf
.

81  
	$Ãxµ
(
’vœÚ
, 
¡¬t_»¥Ú£
)

84 
şass
 
	$IÁ”ÇlRedœeùÜ
(
objeù
):

87 
def
 
	$__š™__
(
£lf
, 
Ãxµ
, 
»cursive
=
F®£
):

88 
£lf
.
Ãxµ
 =‚extapp

89 
£lf
.
»cursive
 =„ecursive

91 
def
 
	$__ÿÎ__
(
£lf
, 
’vœÚ
, 
¡¬t_»¥Ú£
):

92 
»dœeùiÚs
 = []

93 
True
:

94 
’vœÚ
 =ƒnvœÚ.
	$cİy
()

95 
Œy
:

96  
£lf
.
	$Ãxµ
(
’vœÚ
, 
¡¬t_»¥Ú£
)

97 
exû±
 
_ch”rypy
.
IÁ”ÇlRedœeù
:

98 
œ
 = 
_sys
.
	`exc_šfo
()[1]

99 
¢
 = 
’vœÚ
.
	`g‘
('SCRIPT_NAME', '')

100 
·th
 = 
’vœÚ
.
	`g‘
('PATH_INFO', '')

101 
qs
 = 
’vœÚ
.
	`g‘
('QUERY_STRING', '')

103 #Add 
the
 *
´evious
* 
·th_šfo
 + 
qs
 
to
 
»dœeùiÚs
.

104 
Şd_uri
 = 
¢
 + 
·th


105 
qs
:

106 
Şd_uri
 +ğ"?" + 
qs


107 
»dœeùiÚs
.
	$­³nd
(
Şd_uri
)

109 
nÙ
 
£lf
.
»cursive
:

110 #Check 
to
 
£e
 
the
 
Ãw
 
URI
 
has
 
b“n
 
»dœeùed
Ø
®»ady


111 
Ãw_uri
 = 
¢
 + 
œ
.
·th


112 
œ
.
qu”y_¡ršg
:

113 
Ãw_uri
 +ğ"?" + 
œ
.
qu”y_¡ršg


114 
Ãw_uri
 
š
 
»dœeùiÚs
:

115 
œ
.
»que¡
.
	$şo£
()

116 
¿i£
 
	`RuÁimeE¼Ü
("InternalRedirector visitedhe "

117 "§mURLwiû: %r" % 
Ãw_uri
)

119 #Mung
the
 
’vœÚm’t
 
ªd
 
Œy
 
agaš
.

120 
’vœÚ
['REQUEST_METHOD'] = "GET"

121 
’vœÚ
['PATH_INFO'] = 
œ
.
·th


122 
’vœÚ
['QUERY_STRING'] = 
œ
.
qu”y_¡ršg


123 
’vœÚ
['wsgi.šput'] = 
	$By‹sIO
()

124 
’vœÚ
['CONTENT_LENGTH'] = "0"

125 
’vœÚ
['ch”rypy.´evious_»que¡'] = 
œ
.
»que¡


128 
şass
 
	$Exû±iÚT¿µ”
(
objeù
):

131 
def
 
	`__š™__
(
£lf
, 
Ãxµ
, 
throws
=(
KeybßrdIÁ”ru±
, 
Sy¡emEx™
)):

132 
£lf
.
Ãxµ
 =‚extapp

133 
£lf
.
throws
 =hrows

135 
def
 
	$__ÿÎ__
(
£lf
, 
’vœÚ
, 
¡¬t_»¥Ú£
):

136  
	$_T¿µedRe¥Ú£
(
£lf
.
Ãxµ
, 
’vœÚ
, 
¡¬t_»¥Ú£
, s–f.
throws
)

139 
şass
 
	$_T¿µedRe¥Ú£
(
objeù
):

141 
»¥Ú£
 = 
	$™”
([])

143 
def
 
	$__š™__
(
£lf
, 
Ãxµ
, 
’vœÚ
, 
¡¬t_»¥Ú£
, 
throws
):

144 
£lf
.
Ãxµ
 =‚extapp

145 
£lf
.
’vœÚ
 =ƒnviron

146 
£lf
.
¡¬t_»¥Ú£
 = start_response

147 
£lf
.
throws
 =hrows

148 
£lf
.
¡¬‹d_»¥Ú£
 = 
F®£


149 
£lf
.
»¥Ú£
 = s–f.
	$Œ­
(
£lf
.
Ãxµ
, s–f.
’vœÚ
, s–f.
¡¬t_»¥Ú£
)

150 
£lf
.
™”_»¥Ú£
 = 
	$™”
(
£lf
.
»¥Ú£
)

152 
def
 
	$__™”__
(
£lf
):

153 
£lf
.
¡¬‹d_»¥Ú£
 = 
True


154  
£lf


156 
py3k
:

157 
def
 
	$__Ãxt__
(
£lf
):

158  
£lf
.
	$Œ­
(
Ãxt
, 
£lf
.
™”_»¥Ú£
)

160 
def
 
	$Ãxt
(
£lf
):

161  
£lf
.
	$Œ­
(
£lf
.
™”_»¥Ú£
.
Ãxt
)

163 
def
 
	$şo£
(
£lf
):

164 
	`ha§‰r
(
£lf
.
»¥Ú£
, 'close'):

165 
£lf
.
»¥Ú£
.
	$şo£
()

167 
def
 
	$Œ­
(
£lf
, 
func
, *
¬gs
, **
kw¬gs
):

168 
Œy
:

169  
	$func
(*
¬gs
, **
kw¬gs
)

170 
exû±
 
£lf
.
throws
:

171 
¿i£


172 
exû±
 
StİI‹¿tiÚ
:

173 
¿i£


174 
exû±
:

175 
tb
 = 
_ı”rÜ
.
	$fÜm©_exc
()

176 #´št('Œ­³d (¡¬‹d %s):' % 
£lf
.
¡¬‹d_»¥Ú£
, 
tb
)

177 
_ch”rypy
.
	$log
(
tb
, 
£v”™y
=40)

178 
nÙ
 
_ch”rypy
.
»que¡
.
show_Œaûbacks
:

179 
tb
 = ""

180 
s
, 
h
, 
b
 = 
_ı”rÜ
.
	$b¬e_”rÜ
(
tb
)

181 
py3k
:

182 #Wh© 
fun
.

183 
s
 = s.
	`decode
('ISO-8859-1')

184 
h
 = [(
k
.
	`decode
('ISO-8859-1'), 
v
.decode('ISO-8859-1'))

185 
k
, 
v
 
š
 
h
]

186 
£lf
.
¡¬‹d_»¥Ú£
:

187 #Em±y 
our
 
	`™”abË
 (
so
 
futu»
 
ÿÎs
 
¿i£
 
StİI‹¿tiÚ
)

188 
£lf
.
™”_»¥Ú£
 = 
	$™”
([])

190 
£lf
.
™”_»¥Ú£
 = 
	$™”
(
b
)

192 
Œy
:

193 
£lf
.
	`¡¬t_»¥Ú£
(
s
, 
h
, 
_sys
.
	$exc_šfo
())

194 
exû±
:

195 #"
The
 
­¶iÿtiÚ
 
mu¡
 
nÙ
 
Œ­
 
ªy
 
exû±iÚs
 
¿i£d
 
by


196 #¡¬t_»¥Ú£, 
™
 
ÿÎed
 
¡¬t_»¥Ú£
 
w™h
 
exc_šfo
.

197 #In¡—d, 
™
 
should
 
®low
 
such
 
exû±iÚs
 
to
 
´İag©e


198 #back 
to
 
the
 
£rv”
 
Ü
 
g©eway
."

199 #Buˆ
we
 
¡l
 
log
 
ªd
 
ÿÎ
 
	`şo£
(è
to
 
ş—n
 
up
 
our£lves
.

200 
_ch”rypy
.
	$log
(
Œaûback
=
True
, 
£v”™y
=40)

201 
¿i£


203 
£lf
.
¡¬‹d_»¥Ú£
:

204  
	`Áob
("").
	$još
(
b
)

206  
b


209 #WSGI-
to
-
CP
 
Ad­‹r
 #


211 
şass
 
	$AµRe¥Ú£
(
objeù
):

214 
def
 
	$__š™__
(
£lf
, 
’vœÚ
, 
¡¬t_»¥Ú£
, 
ı­p
):

215 
£lf
.
ı­p
 = cpapp

216 
Œy
:

217 
nÙ
 
py3k
:

218 
’vœÚ
.
	`g‘
(
	`Áou
('wsgi.version')) == (ntou('u'), 0):

219 
’vœÚ
 = 
	$downg¿de_wsgi_ux_to_1x
(
’vœÚ
)

220 
£lf
.
’vœÚ
 =ƒnviron

221 
£lf
.
	$run
()

223 
r
 = 
_ch”rypy
.
£rvšg
.
»¥Ú£


225 
out¡©us
 = 
r
.
ouut_¡©us


226 
nÙ
 
	$isš¡ªû
(
out¡©us
, 
by‹¡r
):

227 
¿i£
 
	`Ty³E¼Ü
("response.output_status is‚ot‡ byte string.")

229 
outh—d”s
 = []

230 
k
, 
v
 
š
 
r
.
h—d”_li¡
:

231 
nÙ
 
	$isš¡ªû
(
k
, 
by‹¡r
):

232 
¿i£
 
	`Ty³E¼Ü
("»¥Ú£.h—d”_li¡ key %¸i nÙ‡ by‹ sŒšg." % 
k
)

233 
nÙ
 
	$isš¡ªû
(
v
, 
by‹¡r
):

234 
¿i£
 
	`Ty³E¼Ü
("»¥Ú£.h—d”_li¡ v®u%¸i nÙ‡ by‹ sŒšg." % 
v
)

235 
outh—d”s
.
	`­³nd
((
k
, 
v
))

237 
py3k
:

238 #AccÜdšg 
to
 
PEP
 3333, 
wh’
 
usšg
 
PythÚ
 3, 
the
 
»¥Ú£
 
¡©us


239 #ªd 
h—d”s
 
mu¡
 
be
 
by‹s
 
masqu”adšg
 
as
 
unicode
; 
th©
 
is
, 
they


240 #mu¡ 
be
 
of
 
ty³
 "¡r" 
but
 
¬e
 
»¡riùed
 
to
 
code
 
pošts
 
š
 
the


241 #"
Ïtš
-1" set.

242 
out¡©us
 = out¡©us.
	`decode
('ISO-8859-1')

243 
outh—d”s
 = [(
k
.
	`decode
('ISO-8859-1'), 
v
.decode('ISO-8859-1'))

244 
k
, 
v
 
š
 
outh—d”s
]

246 
£lf
.
™”_»¥Ú£
 = 
	$™”
(
r
.
body
)

247 
£lf
.
wr™e
 = 
	$¡¬t_»¥Ú£
(
out¡©us
, 
outh—d”s
)

248 
exû±
:

249 
£lf
.
	$şo£
()

250 
¿i£


252 
def
 
	$__™”__
(
£lf
):

253  
£lf


255 
py3k
:

256 
def
 
	$__Ãxt__
(
£lf
):

257  
	$Ãxt
(
£lf
.
™”_»¥Ú£
)

259 
def
 
	$Ãxt
(
£lf
):

260  
£lf
.
™”_»¥Ú£
.
	$Ãxt
()

262 
def
 
	$şo£
(
£lf
):

264 
£lf
.
ı­p
.
	$»Ëa£_£rvšg
()

266 
def
 
	$run
(
£lf
):

268 
’v
 = 
£lf
.
’vœÚ
.
g‘


270 
loÿl
 = 
h‰put
.
	`Ho¡
('', (
	`’v
('SERVER_PORT', 80)),

271 
	`’v
('SERVER_NAME', ''))

272 
»mÙe
 = 
h‰put
.
	`Ho¡
(
	`’v
('REMOTE_ADDR', ''),

273 (
	`’v
('REMOTE_PORT', -1è
Ü
 -1),

274 
	`’v
('REMOTE_HOST', ''))

275 
scheme
 = 
	`’v
('wsgi.url_scheme')

276 
¥rÙo
 = 
	`’v
('ACTUAL_SERVER_PROTOCOL', "HTTP/1.1")

277 
»que¡
, 
»¥
 = 
£lf
.
ı­p
.
	$g‘_£rvšg
(
loÿl
, 
»mÙe
, 
scheme
, 
¥rÙo
)

279 #LOGON_USER 
is
 
£rved
 
by
 
IIS
, 
ªd
 i 
the
 
Çme
 
of
he

280 #u£¸
aá”
 
havšg
 
b“n
 
m­³d
 
to
 
a
 
loÿl
 
accouÁ
.

281 #BÙh 
IIS
 
ªd
 
A·che
 
£t
 
REMOTE_USER
, 
wh’
 
possibË
.

282 
»que¡
.
logš
 = 
	`’v
('LOGON_USER'è
Ü
ƒnv('REMOTE_USER'èÜ 
NÚe


283 
»que¡
.
muÉ™h»ad
 = 
£lf
.
’vœÚ
['wsgi.multithread']

284 
»que¡
.
muÉroûss
 = 
£lf
.
’vœÚ
['wsgi.multiprocess']

285 
»que¡
.
wsgi_’vœÚ
 = 
£lf
.
’vœÚ


286 
»que¡
.
´ev
 = 
	`’v
('ch”rypy.´evious_»que¡', 
NÚe
)

288 
m‘h
 = 
£lf
.
’vœÚ
['REQUEST_METHOD']

290 
·th
 = 
h‰put
.
	`u¾još
(
£lf
.
’vœÚ
.
	`g‘
('SCRIPT_NAME', ''),

291 
£lf
.
’vœÚ
.
	`g‘
('PATH_INFO', ''))

292 
qs
 = 
£lf
.
’vœÚ
.
	`g‘
('QUERY_STRING', '')

294 
py3k
:

295 #Thi 
i¢
't…erfect; ifhe given PATH_INFO is inhe wrongƒncoding,

296 #™ 
may
 
ç
 
to
 
m©ch
 
the
 
­´İrŸ‹
 
cÚfig
 
£ùiÚ
 
URI
. 
But
 
meh
.

297 
Şd_’c
 = 
£lf
.
’vœÚ
.
	`g‘
('wsgi.url_encoding', 'ISO-8859-1')

298 
Ãw_’c
 = 
£lf
.
ı­p
.
	`fšd_cÚfig
(£lf.
’vœÚ
.
	`g‘
('PATH_INFO', ''),

300 
Ãw_’c
.
	`low”
(è!ğ
Şd_’c
.
	$low”
():

301 #Ev’ 
though
 
the
 
·th
 
ªd
 
qs
 
¬e
 
unicode
,h
WSGI
 
£rv”
 
is


302 #»quœed 
by
 
PEP
 3333 
to
 
cÛrû
 
them
Ø
ISO
-8859-1 
masqu”adšg


303 #a 
unicode
. 
So
 
we
 
have
 
to
 
’code
 
back
Ø
by‹s
 
ªd
 
th’
 
decode


304 #agaš 
usšg
 
the
 "cÜ»ù" 
’codšg
.

305 
Œy
:

306 
u_·th
 = 
·th
.
	`’code
(
Şd_’c
).
	$decode
(
Ãw_’c
)

307 
u_qs
 = 
qs
.
	`’code
(
Şd_’c
).
	$decode
(
Ãw_’c
)

308 
	$exû±
 (
UnicodeEncodeE¼Ü
, 
UnicodeDecodeE¼Ü
):

309 #Ju¡ 
·ss
 
them
 
through
 
w™hout
 
Œªscodšg
 
ªd
 
hİe
.

310 
·ss


312 #OÆy 
£t
 
Œªscoded
 
v®ues
 
they
 
bÙh
 
sucûed
.

313 
·th
 = 
u_·th


314 
qs
 = 
u_qs


316 
½rÙo
 = 
£lf
.
’vœÚ
.
	`g‘
('SERVER_PROTOCOL')

317 
h—d”s
 = 
£lf
.
	$Œª¦©e_h—d”s
(
£lf
.
’vœÚ
)

318 
rfe
 = 
£lf
.
’vœÚ
['wsgi.input']

319 
»que¡
.
	$run
(
m‘h
, 
·th
, 
qs
, 
½rÙo
, 
h—d”s
, 
rfe
)

321 
h—d”Names
 = {'HTTP_CGI_AUTHORIZATION': 'Authorization',

326 
	}
}

328 
def
 
	$Œª¦©e_h—d”s
(
£lf
, 
’vœÚ
):

330 
cgiName
 
š
 
’vœÚ
:

331 #W
assume
 
®l
 
šcomšg
 
h—d”
 
keys
 
¬e
 
uµ”ÿ£
 
®»ady
.

332 
cgiName
 
š
 
£lf
.
h—d”Names
:

333 
y›ld
 
£lf
.
h—d”Names
[
cgiName
], 
’vœÚ
[cgiName]

334 
–if
 
cgiName
[:5] == "HTTP_":

335 #Hackish 
©‹m±
 
©
 
»cov”šg
 
Üigš®
 
h—d”
 
Çmes
.

336 
Œª¦©edH—d”
 = 
cgiName
[5:].
	`»¶aû
("_", "-")

337 
y›ld
 
Œª¦©edH—d”
, 
’vœÚ
[
cgiName
]

340 
şass
 
	$CPWSGIAµ
(
objeù
):

343 
p–še
 = [('Exû±iÚT¿µ”', 
Exû±iÚT¿µ”
),

344 ('IÁ”ÇlRedœeùÜ', 
IÁ”ÇlRedœeùÜ
),

347 
cÚ¡ruùÜ
 
th©
 
kes
 
ª
 
š™Ÿl
, 
pos™iÚ®
 'Ãxµ' 
¬gum’t
,

348 
¶us
 
İtiÚ®
 
keywÜd
 
¬gum’ts
, 
ªd
 
»tuºs
 
a
 
WSGI
 
­¶iÿtiÚ


349 (
th©
 
kes
 
’vœÚ
 
ªd
 
¡¬t_»¥Ú£
 
¬gum’ts
). 
The
 'Çme' 
ÿn


350 
be
 
ªy
 
you
 
choo£
, 
ªd
 
wl
 
cÜ»¥Úd
 
to
 
keys
 
š
 
£lf
.
cÚfig
."""

352 
h—d
 = 
NÚe


354 
dÚe
 
the
 
fœ¡
 
time
, 
ªd
h
»suÉ
 
is
 
memoized
 
što
 
£lf
.
h—d
. 
S‘


355 
this
 
to
 
NÚe
 
agaš
 
you
 
chªge
 
£lf
.
p–še
 
aá”
 
ÿÎšg
 self."""

357 
cÚfig
 = {
	}
}

359 
v®ue
 
is
 
a
 
fu¹h”
 
diù
 
which
 
wl
 
be
 
·s£d
 
to
 
the
 
cÜ»¥Údšg


360 
Çmed
 
WSGI
 
	$ÿÎabË
 (
äom
 
the
 
p–še
è
as
 
keywÜd
 
¬gum’ts
."""

362 
»¥Ú£_şass
 = 
AµRe¥Ú£


365 
def
 
	$__š™__
(
£lf
, 
ı­p
, 
p–še
=
NÚe
):

366 
£lf
.
ı­p
 = cpapp

367 
£lf
.
p–še
 = self.pipeline[:]

368 
p–še
:

369 
£lf
.
p–še
.
	$ex‹nd
(
p–še
)

370 
£lf
.
cÚfig
 = s–f.cÚfig.
	$cİy
()

372 
def
 
	$
(
£lf
, 
’vœÚ
, 
¡¬t_»¥Ú£
):

375 
You
 
´obably
 
shouldn
't callhis; call self.__call__ instead,

376 
so
 
th©
 
ªy
 
WSGI
 
middËw¬e
 
š
 
£lf
.
p–še
 
ÿn
 
run
 
fœ¡
.

378  
£lf
.
	$»¥Ú£_şass
(
’vœÚ
, 
¡¬t_»¥Ú£
, 
£lf
.
ı­p
)

380 
def
 
	$__ÿÎ__
(
£lf
, 
’vœÚ
, 
¡¬t_»¥Ú£
):

381 
h—d
 = 
£lf
.head

382 
h—d
 
is
 
NÚe
:

383 #C»©
ªd
 
Ã¡
 
the
 
WSGI
 
­ps
 
š
 
our
 
	`p–še
 (š 
»v”£
 
Üd”
).

384 #Th’ 
memoize
 
the
 
»suÉ
 
š
 
£lf
.
h—d
.

385 
h—d
 = 
£lf
.



386 
Çme
, 
ÿÎabË
 
š
 
£lf
.
p–še
[::-1]:

387 
cÚf
 = 
£lf
.
cÚfig
.
	`g‘
(
Çme
, {
	}
})

388 
	gh—d
 = 
	$ÿÎabË
(
h—d
, **
cÚf
)

389 
£lf
.
h—d
 = head

390  
	$h—d
(
’vœÚ
, 
¡¬t_»¥Ú£
)

392 
def
 
	$Çme¥aû_hªdËr
(
£lf
, 
k
, 
v
):

394 
k
 == "pipeline":

395 #NÙ
this
 
®lows
 
muÉË
 'wsgi.p–še' 
cÚfig
 
’Œ›s


396 #(
but
 
—ch
 
’Œy
 
wl
 
be
 
´oûs£d
 
š
 
a
 '¿ndom' 
Üd”
).

397 #Iˆ
should
 
®so
 
®low
 
dev–İ”s
 
to
 
£t
  
middËw¬e


398 #š 
	`code
 (
·s£d
 
to
 
£lf
.
__š™__
è
th©
 
d•loy”s
 
ÿn
 
add
o

399 #(
but
 
nÙ
 
»move
è
vŸ
 
cÚfig
.

400 
£lf
.
p–še
.
	$ex‹nd
(
v
)

401 
–if
 
k
 == "response_class":

402 
£lf
.
»¥Ú£_şass
 = 
v


404 
Çme
, 
¬g
 = 
k
.
	`¥l™
(".", 1)

405 
buck‘
 = 
£lf
.
cÚfig
.
	`£tdeçuÉ
(
Çme
, {
	}
})

406 
	gbuck‘
[
¬g
] = 
v


	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/_cpwsgi_server.py

2 
the
 
	gäamewÜk
-
agno¡ic
 
wsgi£rv”
 
	g·ckage
.

4 
impÜt
 
sys


6 
impÜt
 
ch”rypy


7 
äom
 
ch”rypy
 
impÜt
 
wsgi£rv”


10 
şass
 
	$CPWSGIS”v”
(
wsgi£rv”
.
Ch”ryPyWSGIS”v”
):

13 
wsgi£rv”
 
has
 
b“n
 
desigÃd
 
to
 
nÙ
 
»ã»nû
 
Ch”ryPy
 
š
 
ªy
 
way
,

14 
so
 
th©
 
™
 
ÿn
 
be
 
u£d
 
š
 
Ùh”
 
äamewÜks
 
ªd
 
­¶iÿtiÚs
. 
Th”efÜe
,

15 
we
 
w¿p
 
™
 
h”e
, 
so
 w
ÿn
 
£t
 
our
 
own
 
mouÁ
 
pošts
 
äom
 
ch”rypy
.
Œ“


16 
ªd
 
­¶y
 
some
 
©Œibu‹s
 
äom
 
cÚfig
 -> 
ch”rypy
.
£rv”
 -> 
wsgi£rv”
.

19 
def
 
	$__š™__
(
£lf
, 
£rv”_ad­‹r
=
ch”rypy
.
£rv”
):

20 
£lf
.
£rv”_ad­‹r
 = server_adapter

21 
£lf
.
max_»que¡_h—d”_size
 = s–f.
£rv”_ad­‹r
.max_»que¡_h—d”_siz
Ü
 0

22 
£lf
.
max_»que¡_body_size
 = s–f.
£rv”_ad­‹r
.max_»que¡_body_siz
Ü
 0

24 
£rv”_Çme
 = (
£lf
.
£rv”_ad­‹r
.
sock‘_ho¡
 
Ü


25 
£lf
.
£rv”_ad­‹r
.
sock‘_fe
 
Ü


26 
NÚe
)

28 
£lf
.
wsgi_v”siÚ
 = s–f.
£rv”_ad­‹r
.wsgi_version

29 
s
 = 
wsgi£rv”
.
Ch”ryPyWSGIS”v”


30 
s
.
	$__š™__
(
£lf
, 
£rv”_ad­‹r
.
bšd_addr
, 
ch”rypy
.
Œ“
,

31 
£lf
.
£rv”_ad­‹r
.
th»ad_poŞ
,

32 
£rv”_Çme
,

33 
max
 = 
£lf
.
£rv”_ad­‹r
.
th»ad_poŞ_max
,

34 
»que¡_queue_size
 = 
£lf
.
£rv”_ad­‹r
.
sock‘_queue_size
,

35 
timeout
 = 
£lf
.
£rv”_ad­‹r
.
sock‘_timeout
,

36 
shutdown_timeout
 = 
£lf
.
£rv”_ad­‹r
.shutdown_timeout,

38 
£lf
.
´ÙocŞ
 = s–f.
£rv”_ad­‹r
.
´ÙocŞ_v”siÚ


39 
£lf
.
nod–ay
 = s–f.
£rv”_ad­‹r
.nodelay

41 
sys
.
v”siÚ_šfo
 >= (3, 0):

42 
s¦_moduË
 = 
£lf
.
£rv”_ad­‹r
.s¦_moduË 
Ü
 'builtin'

44 
s¦_moduË
 = 
£lf
.
£rv”_ad­‹r
.s¦_moduË 
Ü
 'pyopenssl'

45 
£lf
.
£rv”_ad­‹r
.
s¦_cÚ‹xt
:

46 
ad­‹r_şass
 = 
wsgi£rv”
.
	$g‘_s¦_ad­‹r_şass
(
s¦_moduË
)

47 
£lf
.
s¦_ad­‹r
 = 
	$ad­‹r_şass
(

48 
£lf
.
£rv”_ad­‹r
.
s¦_û¹ifiÿ‹
,

49 
£lf
.
£rv”_ad­‹r
.
s¦_´iv©e_key
,

50 
£lf
.
£rv”_ad­‹r
.
s¦_û¹ifiÿ‹_chaš
)

51 
£lf
.
s¦_ad­‹r
.
cÚ‹xt
 = s–f.
£rv”_ad­‹r
.
s¦_cÚ‹xt


52 
–if
 
£lf
.
£rv”_ad­‹r
.
s¦_û¹ifiÿ‹
:

53 
ad­‹r_şass
 = 
wsgi£rv”
.
	$g‘_s¦_ad­‹r_şass
(
s¦_moduË
)

54 
£lf
.
s¦_ad­‹r
 = 
	$ad­‹r_şass
(

55 
£lf
.
£rv”_ad­‹r
.
s¦_û¹ifiÿ‹
,

56 
£lf
.
£rv”_ad­‹r
.
s¦_´iv©e_key
,

57 
£lf
.
£rv”_ad­‹r
.
s¦_û¹ifiÿ‹_chaš
)

59 
£lf
.
¡©s
['EÇbËd'] = 
	`g‘©Œ
(£lf.
£rv”_ad­‹r
, '¡©i¡ics', 
F®£
)

61 
def
 
	`”rÜ_log
(
£lf
, 
msg
="", 
Ëv–
=20, 
Œaûback
=
F®£
):

62 
ch”rypy
.
’gše
.
	`log
(
msg
, 
Ëv–
, 
Œaûback
)

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/lib/__init__.py

3 #D•»ÿ‹d 
š
 
Ch”ryPy
 3.2 -- 
»move
 in CherryPy 3.3

4 
äom
 
	gch”rypy
.
	glib
.
»´cÚf
 
impÜt
 
	guÄ•r
, 
	gmoduËs
, 
©Œibu‹s


6 
şass
 
	$fe_g’”©Ü
(
objeù
):

9 
def
 
	$__š™__
(
£lf
, 
šput
, 
chunkSize
=65536):

10 
£lf
.
šput
 = input

11 
£lf
.
chunkSize
 = chunkSize

13 
def
 
	$__™”__
(
£lf
):

14  
£lf


16 
def
 
	$__Ãxt__
(
£lf
):

17 
chunk
 = 
£lf
.
šput
.
	$»ad
(
£lf
.
chunkSize
)

18 
chunk
:

19  
chunk


21 
	`ha§‰r
(
£lf
.
šput
, 'close'):

22 
£lf
.
šput
.
	$şo£
()

23 
¿i£
 
	$StİI‹¿tiÚ
()

24 
Ãxt
 = 
__Ãxt__


26 
def
 
	$fe_g’”©Ü_lim™ed
(
feobj
, 
couÁ
, 
chunk_size
=65536):

28 
by‹s
 
has
 
b“n
 
em™‹d
. 
DeçuÉ
 
chunk
 
size
 
is
 64
kB
. (
CÜe
)

30 
»maššg
 = 
couÁ


31 
»maššg
 > 0:

32 
chunk
 = 
feobj
.
	`»ad
(
	$mš
(
chunk_size
, 
»maššg
))

33 
chunkËn
 = 
	$Ën
(
chunk
)

34 
chunkËn
 == 0:

36 
»maššg
 -ğ
chunkËn


37 
y›ld
 
chunk


39 
def
 
	$£t_v¬y_h—d”
(
»¥Ú£
, 
h—d”_Çme
):

41 
v¬›s
 = 
»¥Ú£
.
h—d”s
.
	`g‘
("Vary", "")

42 
v¬›s
 = [
x
.
	$¡r
(è
x
 
š
 
v¬›s
.
	`¥l™
(","èx.
	`¡r
()]

43 
h—d”_Çme
 
nÙ
 
š
 
v¬›s
:

44 
v¬›s
.
	$­³nd
(
h—d”_Çme
)

45 
»¥Ú£
.
h—d”s
['V¬y'] = ", ".
	`još
(
v¬›s
)

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/lib/auth.py

1 
impÜt
 
ch”rypy


2 
äom
 
	gch”rypy
.
lib
 
impÜt
 
h‰·uth


5 
def
 
	$check_auth
(
u£rs
, 
’üy±
=
NÚe
, 
»®m
=None):

7 
»que¡
 = 
ch”rypy
.
£rvšg
.request

8 'authÜiz©iÚ' 
š
 
»que¡
.
h—d”s
:

9 #mak
su»
 
the
 
´ovided
 
üed’tŸls
 
¬e
 
cÜ»ùly
 
£t


10 
ah
 = 
h‰·uth
.
	`·r£AuthÜiz©iÚ
(
»que¡
.
h—d”s
['authorization'])

11 
ah
 
is
 
NÚe
:

12 
¿i£
 
ch”rypy
.
	`HTTPE¼Ü
(400, 'Bad Request')

14 
nÙ
 
’üy±
:

15 
’üy±
 = 
h‰·uth
.
DIGEST_AUTH_ENCODERS
[h‰·uth.
MD5
]

17 
	`ha§‰r
(
u£rs
, '__call__'):

18 
Œy
:

19 #backw¬d 
com·tib™y


20 
u£rs
 = 
	$u£rs
(è#ex³ù 
™
 
to
  
a
 
diùiÚ¬y


22 
nÙ
 
	$isš¡ªû
(
u£rs
, 
diù
):

23 
¿i£
 
	`V®ueE¼Ü
("Authentication users must be‡ dictionary")

25 #ãtch 
the
 
u£r
 
·sswÜd


26 
·sswÜd
 = 
u£rs
.
	`g‘
(
ah
["u£ºame"], 
NÚe
)

27 
exû±
 
Ty³E¼Ü
:

28 #»tuº 
a
 
	`·sswÜd
 (
’üy±ed
 
Ü
 
ş—r
 
‹xt
)

29 
·sswÜd
 = 
	`u£rs
(
ah
["username"])

31 
nÙ
 
	$isš¡ªû
(
u£rs
, 
diù
):

32 
¿i£
 
	`V®ueE¼Ü
("Authentication users must be‡ dictionary")

34 #ãtch 
the
 
u£r
 
·sswÜd


35 
·sswÜd
 = 
u£rs
.
	`g‘
(
ah
["u£ºame"], 
NÚe
)

37 #v®id©
the
 
authÜiz©iÚ
 
by
 
»
-
computšg
 
™
 
h”e


38 #ªd 
com·»
 
™
 
w™h
 
wh©
 
the
 
u£r
-
ag’t
 
´ovided


39 
h‰·uth
.
	$checkRe¥Ú£
(
ah
, 
·sswÜd
, 
m‘hod
=
»que¡
.method,

40 
’üy±
ónüy±, 
»®m
=realm):

41 
»que¡
.
logš
 = 
ah
["username"]

42  
True


44 
»que¡
.
logš
 = 
F®£


45  
F®£


47 
def
 
	$basic_auth
(
»®m
, 
u£rs
, 
’üy±
=
NÚe
, 
debug
=
F®£
):

50 
»®m


51 
A
 
¡ršg
 
cÚššg
 
the
 
auth’tiÿtiÚ
 
»®m
.

53 
u£rs


54 
A
 
diù
 
of
 
the
 
fÜm
: {
u£ºame
: 
·sswÜd
} o¸¨ÿÎabË„‘uºšg‡ diù.

56 
’üy±


57 
ÿÎabË
 
u£d
 
to
 
’üy±
 
the
 
·sswÜd
 
»tuºed
 
äom
h
u£r
-
ag’t
.

58 
NÚe
 
™
 
deçuÉs
 
to
 
a
 
md5
 
’üy±iÚ
.

61 
	$check_auth
(
u£rs
, 
’üy±
):

62 
debug
:

63 
ch”rypy
.
	`log
('Auth successful', 'TOOLS.BASIC_AUTH')

66 #šfÜm 
the
 
u£r
-
ag’t
 
this
 
·th
 
is
 
´Ùeùed


67 
ch”rypy
.
£rvšg
.
»¥Ú£
.
h—d”s
['www-auth’tiÿ‹'] = 
h‰·uth
.
	$basicAuth
(
»®m
)

69 
¿i£
 
ch”rypy
.
	`HTTPE¼Ü
(401, "You‡re‚ot‡uthorizedo‡ccesshat„esource")

71 
def
 
	$dige¡_auth
(
»®m
, 
u£rs
, 
debug
=
F®£
):

74 
»®m


75 
A
 
¡ršg
 
cÚššg
 
the
 
auth’tiÿtiÚ
 
»®m
.

76 
u£rs


77 
A
 
diù
 
of
 
the
 
fÜm
: {
u£ºame
: 
·sswÜd
} o¸¨ÿÎabË„‘uºšg‡ diù.

79 
	$check_auth
(
u£rs
, 
»®m
=realm):

80 
debug
:

81 
ch”rypy
.
	`log
('Auth successful', 'TOOLS.DIGEST_AUTH')

84 #šfÜm 
the
 
u£r
-
ag’t
 
this
 
·th
 
is
 
´Ùeùed


85 
ch”rypy
.
£rvšg
.
»¥Ú£
.
h—d”s
['www-auth’tiÿ‹'] = 
h‰·uth
.
	$dige¡Auth
(
»®m
)

87 
¿i£
 
ch”rypy
.
	`HTTPE¼Ü
(401, "You‡re‚ot‡uthorizedo‡ccesshat„esource")

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/lib/auth_basic.py

1 #Thi 
fe
 
is
 
·¹
 
of
 
Ch”ryPy
 <
h‰p
:

2 #-*- 
codšg
: 
utf
-8 -*-

3 #vim:
ts
=4:
sw
=4:
ex·ndb
:
f“ncodšg
=
utf
-8

5 
	g__doc__
 = """This module…rovides‡ CherryPy 3.xool which implements

6 
the
 
£rv”
-
side
 
of
 
HTTP
 
Basic
 
Acûss
 
Auth’tiÿtiÚ
, 
as
 
desüibed
 
	gš
 :
rfc
:`2617`.

8 
Exam¶e
 
u§ge
, 
usšg
 
the
 
	gbut
-
š
 
check·sswÜd_diù
 
funùiÚ
 
which
 
u£s
 
a
 
diù


9 
as
 
the
 
üed’tŸls
 
	g¡Üe
::

11 
u£½assdiù
 = {'bird' : 'bebop', 'ornette' : 'wayout'}

12 
check·sswÜd
 = 
ch”rypy
.
lib
.
auth_basic
.
	$check·sswÜd_diù
(
u£½assdiù
)

13 
basic_auth
 = {'toŞs.auth_basic.Ú': 
True
,

15 'toŞs.auth_basic.check·sswÜd': 
check·sswÜd
,

16 
	}
}

17 
­p_cÚfig
 = { '/' : 
basic_auth
 }

21 
__authÜ__
 = 'visteya'

22 
__d©e__
 = 'April 2009'

24 
impÜt
 
bšascii


25 
äom
 
ch”rypy
.
_ıcom·t
 
impÜt
 
ba£64_decode


26 
impÜt
 
ch”rypy


29 
def
 
	$check·sswÜd_diù
(
u£r_·sswÜd_diù
):

31 
agaš¡
 
a
 
diùiÚ¬y
 
of
 
the
 
fÜm
: {
u£ºame
 : 
·sswÜd
}.

33 
If
 
you
 
wªt
 
a
 
sim¶e
 
diùiÚ¬y
-
ba£d
 
auth’tiÿtiÚ
 
scheme
, 
u£


34 
	$check·sswÜd_diù
(
my_üed’tŸls_diù
è
as
 
the
 
v®ue
 the

35 
check·sswÜd
 
¬gum’t
 
to
 
	`basic_auth
().

37 
def
 
	$check·sswÜd
(
»®m
, 
u£r
, 
·sswÜd
):

38 
p
 = 
u£r_·sswÜd_diù
.
	$g‘
(
u£r
)

39  
p
 
ªd
… =ğ
·sswÜd
 
Ü
 
F®£


41  
check·sswÜd


44 
def
 
	$basic_auth
(
»®m
, 
check·sswÜd
, 
debug
=
F®£
):

46 
HTTP
 
Basic
 
Acûss
 
Auth’tiÿtiÚ
, 
as
 
¥ecif›d
 
š
 :
rfc
:`2617`.

48 
If
 
the
 
»que¡
 
has
 
ª
 'authÜiz©iÚ' 
h—d”
 
w™h
 
a
 'Basic' 
scheme
, 
this


49 
toŞ
 
©‹m±s
 
to
 
auth’tiÿ‹
 
the
 
üed’tŸls
 
suµl›d
 
š
 
th©
 
h—d”
. 
If


50 
the
 
»que¡
 
has
 
no
 'authÜiz©iÚ' 
h—d”
, 
Ü
 
™
 
dÛs
 
but
h
scheme
 
is


51 
nÙ
 'Basic', 
Ü
 
auth’tiÿtiÚ
 
çs
, 
the
 
toŞ
 
£nds
 
a
 401 
»¥Ú£
 
w™h


52 
a
 'WWW-Auth’tiÿ‹' 
Basic
 
h—d”
.

54 
»®m


55 
A
 
¡ršg
 
cÚššg
 
the
 
auth’tiÿtiÚ
 
»®m
.

57 
check·sswÜd


58 
A
 
ÿÎabË
 
which
 
checks
 
the
 
auth’tiÿtiÚ
 
üed’tŸls
.

59 
Its
 
sigÇtu»
 
is
 
	`check·sswÜd
(
»®m
, 
u£ºame
, 
·sswÜd
). 
wh”e


60 
u£ºame
 
ªd
 
·sswÜd
 
¬e
 
the
 
v®ues
 
obšed
 
äom
h
»que¡
's

61 'authÜiz©iÚ' 
h—d”
. 
If
 
auth’tiÿtiÚ
 
sucûeds
, 
check·sswÜd


62 
»tuºs
 
True
, 
™
„‘uº 
F®£
.

66 '"' 
š
 
»®m
:

67 
¿i£
 
	`V®ueE¼Ü
('Realm cannot containhe " (quote) character.')

68 
»que¡
 = 
ch”rypy
.
£rvšg
.request

70 
auth_h—d”
 = 
»que¡
.
h—d”s
.
	`g‘
('authorization')

71 
auth_h—d”
 
is
 
nÙ
 
NÚe
:

72 
Œy
:

73 
scheme
, 
·¿ms
 = 
auth_h—d”
.
	`¥l™
(' ', 1)

74 
scheme
.
	`low”
() == 'basic':

75 
u£ºame
, 
·sswÜd
 = 
	`ba£64_decode
(
·¿ms
).
	`¥l™
(':', 1)

76 
	$check·sswÜd
(
»®m
, 
u£ºame
, 
·sswÜd
):

77 
debug
:

78 
ch”rypy
.
	`log
('Auth succeeded', 'TOOLS.AUTH_BASIC')

79 
»que¡
.
logš
 = 
u£ºame


80  #sucûssfuÈ
auth’tiÿtiÚ


81 
	$exû±
 (
V®ueE¼Ü
, 
bšascii
.
E¼Ü
): #¥l™(è
”rÜ
, 
ba£64
.
	$decode¡ršg
(è
”rÜ


82 
¿i£
 
ch”rypy
.
	`HTTPE¼Ü
(400, 'Bad Request')

84 #Re¥Úd 
w™h
 401 
¡©us
 
ªd
 
a
 
WWW
-
Auth’tiÿ‹
 
h—d”


85 
ch”rypy
.
£rvšg
.
»¥Ú£
.
h—d”s
['www-auth’tiÿ‹'] = 'Basiø»®m="%s"' % 
»®m


86 
¿i£
 
ch”rypy
.
	`HTTPE¼Ü
(401, "You‡re‚ot‡uthorizedo‡ccesshat„esource")

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/lib/auth_digest.py

1 #Thi 
fe
 
is
 
·¹
 
of
 
Ch”ryPy
 <
h‰p
:

2 #-*- 
codšg
: 
utf
-8 -*-

3 #vim:
ts
=4:
sw
=4:
ex·ndb
:
f“ncodšg
=
utf
-8

5 
	g__doc__
 = """An implementation ofhe server-side of HTTP Digest Access

6 
Auth’tiÿtiÚ
, 
which
 
is
 
desüibed
 
	gš
 :
rfc
:`2617`.

8 
Exam¶e
 
u§ge
, 
usšg
 
the
 
	gbut
-
š
 
g‘_ha1_diù_¶aš
 
funùiÚ
 
which
 
u£s
 
a
 
diù


9 
of
 
¶aš‹xt
 
·sswÜds
 
as
 
the
 
üed’tŸls
 
	g¡Üe
::

11 
u£½assdiù
 = {'alice' : '4x5istwelve'}

12 
g‘_ha1
 = 
ch”rypy
.
lib
.
auth_dige¡
.
	$g‘_ha1_diù_¶aš
(
u£½assdiù
)

13 
dige¡_auth
 = {'toŞs.auth_dige¡.Ú': 
True
,

15 'toŞs.auth_dige¡.g‘_ha1': 
g‘_ha1
,

17 
	}
}

18 
­p_cÚfig
 = { '/' : 
dige¡_auth
 }

21 
__authÜ__
 = 'visteya'

22 
__d©e__
 = 'April 2009'

25 
impÜt
 
time


26 
äom
 
ch”rypy
.
_ıcom·t
 
impÜt
 
·r£_h‰p_li¡
, 
·r£_keqv_li¡


28 
impÜt
 
ch”rypy


29 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
	gmd5
, 
Áob


30 
	gmd5_hex
 = 
Ïmbda
 
s
: 
md5
(
Áob
(s)).
	$hexdige¡
()

32 
qİ_auth
 = 'auth'

33 
qİ_auth_št
 = 'auth-int'

34 
v®id_qİs
 = (
qİ_auth
, 
qİ_auth_št
)

36 
v®id_®gÜ™hms
 = ('MD5', 'MD5-sess')

39 
def
 
	$TRACE
(
msg
):

40 
ch”rypy
.
	`log
(
msg
, 
cÚ‹xt
='TOOLS.AUTH_DIGEST')

42 #Th»
h–³r
 
funùiÚs
 
u£rs
 
of
 
the
 
toŞ
, 
´ovidšg
 
th»e
 
v¬ŸÁs


43 #oà
	`g‘_ha1
(è
funùiÚs
 
th»e
 
difã»Á
 
kšds
 
of
 
üed’tŸl
 
¡Ües
.

44 
def
 
	$g‘_ha1_diù_¶aš
(
u£r_·sswÜd_diù
):

46 
diùiÚ¬y
 
of
 
the
 
fÜm
: {
u£ºame
 : 
·sswÜd
}.

48 
If
 
you
 
wªt
 
a
 
sim¶e
 
diùiÚ¬y
-
ba£d
 
auth’tiÿtiÚ
 
scheme
, 
w™h
 
¶aš‹xt


49 
	g·sswÜds
, 
u£
 
	$g‘_ha1_diù_¶aš
(
my_u£½ass_diù
è
as
 
the
 
v®ue
 the

50 
g‘_ha1
 
¬gum’t
 
to
 
	`dige¡_auth
().

52 
def
 
	$g‘_ha1
(
»®m
, 
u£ºame
):

53 
·sswÜd
 = 
u£r_·sswÜd_diù
.
	$g‘
(
u£ºame
)

54 
·sswÜd
:

55  
	`md5_hex
('%s:%s:%s' % (
u£ºame
, 
»®m
, 
·sswÜd
))

56  
NÚe


58  
g‘_ha1


60 
def
 
	$g‘_ha1_diù
(
u£r_ha1_diù
):

62 
diùiÚ¬y
 
of
 
the
 
fÜm
: {
u£ºame
 : 
HA1
}.

64 
If
 
you
 
wªt
 
a
 
diùiÚ¬y
-
ba£d
 
auth’tiÿtiÚ
 
scheme
, 
but
 
w™h


65 
	g´e
-
compu‹d
 
HA1
 
hashes
 
š¡—d
 
of
 
	g¶aš
-
‹xt
 
	g·sswÜds
, 
u£


66 
	$g‘_ha1_diù
(
my_u£rha1_diù
è
as
 
the
 
v®ue
 th
g‘_ha1


67 
¬gum’t
 
to
 
	`dige¡_auth
().

69 
def
 
	$g‘_ha1
(
»®m
, 
u£ºame
):

70  
u£r_ha1_diù
.
	$g‘
(
u£r
)

72  
g‘_ha1


74 
def
 
	$g‘_ha1_fe_htdige¡
(
f’ame
):

76 
æ©
 
fe
 
w™h
 
lšes
 
of
 
the
 
§me
 
fÜm©
 
as
 
th©
 
´oduûd
 
by
h
A·che


77 
htdige¡
 
ut™y
. 
FÜ
 
exam¶e
, 
»®m
 'wÚd”Ïnd', 
u£ºame
 'alice',

78 
ªd
 
·sswÜd
 '4x5i¡w–ve', 
the
 
htdige¡
 
lše
 
would
 
be
::

80 
®iû
:
wÚd”Ïnd
:3238cdfe91a8b2ed8e39646921a02d4c

82 
If
 
you
 
wªt
 
to
 
u£
 
ª
 
A·che
 
htdige¡
 
fe
 
as
 
the
 
üed’tŸls
 
¡Üe
,

83 
th’
 
u£
 
	$g‘_ha1_fe_htdige¡
(
my_htdige¡_fe
è
as
 
the
 
v®ue
 the

84 
g‘_ha1
 
¬gum’t
 
to
 
	`dige¡_auth
(). 
It
 
is
 
»comm’ded
 
th©
 
the
 
f’ame


85 
¬gum’t
 
be
 
ª
 
absŞu‹
 
·th
, 
to
 
avoid
 
´obËms
.

87 
def
 
	$g‘_ha1
(
»®m
, 
u£ºame
):

88 
»suÉ
 = 
NÚe


89 
f
 = 
	`İ’
(
f’ame
, 'r')

90 
lše
 
š
 
f
:

91 
u
, 
r
, 
ha1
 = 
lše
.
	`r¡r
().
	`¥l™
(':')

92 
u
 =ğ
u£ºame
 
ªd
 
r
 =ğ
»®m
:

93 
»suÉ
 = 
ha1


95 
f
.
	$şo£
()

96  
»suÉ


98  
g‘_ha1


101 
def
 
	$syÁhesize_nÚû
(
s
, 
key
, 
time¡amp
=
NÚe
):

103 
R‘uºs
 
a
 
¡ršg
 
su™abË
 
as
 
the
 
v®ue
 'nÚû' 
š
h
www
-
auth’tiÿ‹
 
h—d”
.

105 
s


106 
A
 
¡ršg
 
»Ï‹d
 
to
 
the
 
»sourû
, 
such
 
as
h
ho¡Çme
 
of
h
£rv”
.

108 
key


109 
A
 
£ü‘
 
¡ršg
 
known
 
Úly
 
to
 
the
 
£rv”
.

111 
time¡amp


112 
An
 
š‹g”
 
£cÚds
-
sšû
-
the
-
•och
 
time¡amp


115 
time¡amp
 
is
 
NÚe
:

116 
time¡amp
 = (
time
.
	$time
())

117 
h
 = 
	`md5_hex
('%s:%s:%s' % (
time¡amp
, 
s
, 
key
))

118 
nÚû
 = '%s:%s' % (
time¡amp
, 
h
)

119  
nÚû


122 
def
 
	$H
(
s
):

124  
	$md5_hex
(
s
)

127 
şass
 
	$H‰pDige¡AuthÜiz©iÚ
 (
objeù
):

129 
of
 
the
 
dige¡
.

132 
def
 
	$”rmsg
(
£lf
, 
s
):

133  'Dige¡ AuthÜiz©iÚ h—d”: %s' % 
s


135 
def
 
	$__š™__
(
£lf
, 
auth_h—d”
, 
h‰p_m‘hod
, 
debug
=
F®£
):

136 
£lf
.
h‰p_m‘hod
 = http_method

137 
£lf
.
debug
 = debug

138 
scheme
, 
·¿ms
 = 
auth_h—d”
.
	`¥l™
(" ", 1)

139 
£lf
.
scheme
 = scheme.
	$low”
()

140 
£lf
.
scheme
 != 'digest':

141 
¿i£
 
	`V®ueE¼Ü
('Authorization scheme is‚ot "Digest"')

143 
£lf
.
auth_h—d”
 =‡uth_header

145 #mak
a
 
diù
 
of
 
the
 
·¿ms


146 
™ems
 = 
	$·r£_h‰p_li¡
(
·¿ms
)

147 
·¿msd
 = 
	$·r£_keqv_li¡
(
™ems
)

149 
£lf
.
»®m
 = 
·¿msd
.
	`g‘
('realm')

150 
£lf
.
u£ºame
 = 
·¿msd
.
	`g‘
('username')

151 
£lf
.
nÚû
 = 
·¿msd
.
	`g‘
('nonce')

152 
£lf
.
uri
 = 
·¿msd
.
	`g‘
('uri')

153 
£lf
.
m‘hod
 = 
·¿msd
.
	`g‘
('method')

154 
£lf
.
»¥Ú£
 = 
·¿msd
.
	`g‘
('»¥Ú£'è#th»¥Ú£ 
dige¡


155 
£lf
.
®gÜ™hm
 = 
·¿msd
.
	`g‘
('algorithm', 'MD5')

156 
£lf
.
úÚû
 = 
·¿msd
.
	`g‘
('cnonce')

157 
£lf
.
İaque
 = 
·¿msd
.
	`g‘
('opaque')

158 
£lf
.
qİ
 = 
·¿msd
.
	`g‘
('qop') #qop

159 
£lf
.
nc
 = 
·¿msd
.
	`g‘
('nc'è#nÚû 
couÁ


161 #³rfÜm 
some
 
cÜ»ùÃss
 
checks


162 
£lf
.
®gÜ™hm
 
nÙ
 
š
 
v®id_®gÜ™hms
:

163 
¿i£
 
	`V®ueE¼Ü
(
£lf
.
	`”rmsg
("UnsuµÜ‹d v®ufÜ‡lgÜ™hm: '%s'" % s–f.
®gÜ™hm
))

165 
has_»qd
 = 
£lf
.
u£ºame
 
ªd
 \

166 
£lf
.
»®m
 
ªd
 \

167 
£lf
.
nÚû
 
ªd
 \

168 
£lf
.
uri
 
ªd
 \

169 
£lf
.
»¥Ú£


170 
nÙ
 
has_»qd
:

171 
¿i£
 
	`V®ueE¼Ü
(
£lf
.
	`”rmsg
("Not‡ll„equired…arameters‡re…resent."))

173 
£lf
.
qİ
:

174 
£lf
.
qİ
 
nÙ
 
š
 
v®id_qİs
:

175 
¿i£
 
	`V®ueE¼Ü
(
£lf
.
	`”rmsg
("UnsuµÜ‹d v®ufÜ qİ: '%s'" % s–f.
qİ
))

176 
	$nÙ
 (
£lf
.
úÚû
 
ªd
 s–f.
nc
):

177 
¿i£
 
	`V®ueE¼Ü
(
£lf
.
	`”rmsg
("If qop is senthen cnonce‡nd‚c MUST be…resent"))

179 
£lf
.
úÚû
 
Ü
 s–f.
nc
:

180 
¿i£
 
	`V®ueE¼Ü
(
£lf
.
	`”rmsg
("If qop is‚ot sent,‚either cnonce‚or‚c can be…resent"))

183 
def
 
	$__¡r__
(
£lf
):

184  'authÜiz©iÚ : %s' % 
£lf
.
auth_h—d”


186 
def
 
	$v®id©e_nÚû
(
£lf
, 
s
, 
key
):

188 
R‘uºs
 
True
 
nÚû
 
was
 
g’”©ed
 
by
 
	$syÁhesize_nÚû
(è
ªd
 
the
 
time¡amp


189 
is
 
nÙ
 
¥ooãd
, 
»tuºs
 
F®£
.

191 
s


192 
A
 
¡ršg
 
»Ï‹d
 
to
 
the
 
»sourû
, 
such
 
as
h
ho¡Çme
 
of
h
£rv”
.

194 
key


195 
A
 
£ü‘
 
¡ršg
 
known
 
Úly
 
to
 
the
 
£rv”
.

197 
BÙh
 
s
 
ªd
 
key
 
mu¡
 
be
 
the
 
§me
 
v®ues
 
which
 
w”e
 
u£d
 
to
 
syÁhesize
h
nÚû


198 
we
 
¬e
 
Œyšg
 
to
 
v®id©e
.

200 
Œy
:

201 
time¡amp
, 
hash·¹
 = 
£lf
.
nÚû
.
	`¥l™
(':', 1)

202 
s_time¡amp
, 
s_hash·¹
 = 
	`syÁhesize_nÚû
(
s
, 
key
, 
time¡amp
).
	`¥l™
(':', 1)

203 
is_v®id
 = 
s_hash·¹
 =ğ
hash·¹


204 
£lf
.
debug
:

205 
	`TRACE
('v®id©e_nÚû: %s' % 
is_v®id
)

206  
is_v®id


207 
exû±
 
V®ueE¼Ü
: #¥l™(è
”rÜ


208 
·ss


209  
F®£


212 
def
 
	$is_nÚû_¡®e
(
£lf
, 
max_age_£cÚds
=600):

214 
time¡amp
 
š
 
¶aš‹xt
 
ªd
 
®so
 
a
 
£cu»
 
hash
 
of
 
the
ime¡amp. 
You
 
should


215 
fœ¡
 
v®id©e
 
the
 
nÚû
 
to
 
’su»
h
¶aš‹xt
 
time¡amp
 
is
 
nÙ
 
¥ooãd
.

217 
Œy
:

218 
time¡amp
, 
hash·¹
 = 
£lf
.
nÚû
.
	`¥l™
(':', 1)

219 (
time¡amp
è+ 
max_age_£cÚds
 > (
time
.
	$time
()):

220  
F®£


221 
exû±
 
V®ueE¼Ü
: #št(è
”rÜ


222 
·ss


223 
£lf
.
debug
:

224 
	`TRACE
("nonce is stale")

225  
True


228 
def
 
	`HA2
(
£lf
, 
’t™y_body
=''):

231 #Ià
the
 "qİ" 
dœeùive
's value is "auth" or is unspecified,hen A2 is:

232 #A2 = 
m‘hod
 ":" 
dige¡
-
uri
-
v®ue


233 #
#Ià
the
 "qİ" 
v®ue
 
is
 "auth-št", 
th’
 
A2
 is:

234 #A2 = 
m‘hod
 ":" 
dige¡
-
uri
-
v®ue
 ":" 
	`H
(
’t™y
-
body
)

235 
£lf
.
qİ
 
is
 
NÚe
 
Ü
 self.qop == "auth":

236 
a2
 = '%s:%s' % (
£lf
.
h‰p_m‘hod
, s–f.
uri
)

237 
–if
 
£lf
.
qİ
 == "auth-int":

238 
a2
 = "%s:%s:%s" % (
£lf
.
h‰p_m‘hod
, s–f.
uri
, 
	$H
(
’t™y_body
))

240 #š 
theÜy
, 
this
 
should
 
Ãv”
 
h­³n
, 
sšû
 
I
 
v®id©e
 
qİ
 
š
 
	`__š™__
()

241 
¿i£
 
	`V®ueE¼Ü
(
£lf
.
	`”rmsg
("Unrecognized value for qop!"))

242  
	$H
(
a2
)

245 
def
 
	`»que¡_dige¡
(
£lf
, 
ha1
, 
’t™y_body
=''):

248 
ha1


249 
The
 
HA1
 
¡ršg
 
obšed
 
äom
 
the
 
üed’tŸls
 
¡Üe
.

251 
’t™y_body


252 
If
 'qİ' 
is
 
£t
 
to
 'auth-št', 
th’
 
A2
 
šşudes
 
a
 
hash


253 
of
 
the
 "’t™y body". 
The
 
’t™y
 
body
 
is
h
·¹
 ofhe

254 
mes§ge
 
which
 
fŞlows
 
the
 
HTTP
 
h—d”s
. 
S“
 :
rfc
:`2617` 
£ùiÚ


255 4.3. 
This
 
»ãrs
 
to
 
the
 
’t™y
h
u£r
 
ag’t
 
£Á
 
š
h
»que¡
 
which


256 
has
 
the
 
AuthÜiz©iÚ
 
h—d”
. 
TypiÿÎy
 
GET
 
»que¡s
 
dÚ
't have‡nƒntity,

257 
ªd
 
POST
 
»que¡s
 do.

260 
ha2
 = 
£lf
.
	$HA2
(
’t™y_body
)

261 #Reque¡-
Dige¡
 -- 
RFC
 2617 3.2.2.1

262 
£lf
.
qİ
:

263 
»q
 = "%s:%s:%s:%s:%s" % (
£lf
.
nÚû
, s–f.
nc
, s–f.
úÚû
, s–f.
qİ
, 
ha2
)

265 
»q
 = "%s:%s" % (
£lf
.
nÚû
, 
ha2
)

268 #
#Ià
the
 "®gÜ™hm" 
dœeùive
's value is "MD5" or is unspecified,hen A1 is:

269 #A1 = 
	`unq
(
u£ºame
-
v®ue
è":" unq(
»®m
-v®ueè":" 
·sswd


270 #
#Ià
the
 "®gÜ™hm" 
dœeùive
's value is "MD5-sess",hen A1 is

271 #ÿlcuÏ‹d 
Úly
 
Úû
 - 
Ú
 
the
 
fœ¡
 
»que¡
 
by
h
ş›Á
 
fŞlowšg


272 #»ûˆ
of
 
a
 
WWW
-
Auth’tiÿ‹
 
ch®Ënge
 
äom
 
the
 
£rv”
.

273 #A1 = 
	`H
Ğ
	`unq
(
u£ºame
-
v®ue
è":" unq(
»®m
-v®ueè":" 
·sswd
 )

275 
£lf
.
®gÜ™hm
 == 'MD5-sess':

276 
ha1
 = 
	`H
('%s:%s:%s' % (ha1, 
£lf
.
nÚû
, s–f.
úÚû
))

278 
dige¡
 = 
	`H
('%s:%s' % (
ha1
, 
»q
))

279  
dige¡


283 
def
 
	`www_auth’tiÿ‹
(
»®m
, 
key
, 
®gÜ™hm
='MD5', 
nÚû
=
NÚe
, 
qİ
=
qİ_auth
, 
¡®e
=
F®£
):

285 
qİ
 
nÙ
 
š
 
v®id_qİs
:

286 
¿i£
 
	`V®ueE¼Ü
("UnsuµÜ‹d v®ufÜ qİ: '%s'" % 
qİ
)

287 
®gÜ™hm
 
nÙ
 
š
 
v®id_®gÜ™hms
:

288 
¿i£
 
	`V®ueE¼Ü
("UnsuµÜ‹d v®ufÜ‡lgÜ™hm: '%s'" % 
®gÜ™hm
)

290 
nÚû
 
is
 
NÚe
:

291 
nÚû
 = 
	$syÁhesize_nÚû
(
»®m
, 
key
)

292 
s
 = 'Digest„ealm="%s",‚once="%s",‡lgorithm="%s", qop="%s"' % (

293 
»®m
, 
nÚû
, 
®gÜ™hm
, 
qİ
)

294 
¡®e
:

295 
s
 += ', stale="true"'

296  
s


299 
def
 
	$dige¡_auth
(
»®m
, 
g‘_ha1
, 
key
, 
debug
=
F®£
):

301 
HTTP
 
Dige¡
 
Acûss
 
Auth’tiÿtiÚ
, 
as
 
¥ecif›d
 
š
 :
rfc
:`2617`.

303 
If
 
the
 
»que¡
 
has
 
ª
 'authÜiz©iÚ' 
h—d”
 
w™h
 
a
 'Dige¡' 
scheme
, 
this


304 
toŞ
 
auth’tiÿ‹s
 
the
 
üed’tŸls
 
suµl›d
 
š
 
th©
 
h—d”
. 
If


305 
the
 
»que¡
 
has
 
no
 'authÜiz©iÚ' 
h—d”
, 
Ü
 
™
 
dÛs
 
but
h
scheme
 
is


306 
nÙ
 "Dige¡", 
Ü
 
auth’tiÿtiÚ
 
çs
, 
the
 
toŞ
 
£nds
 
a
 401 
»¥Ú£
 
w™h


307 
a
 'WWW-Auth’tiÿ‹' 
Dige¡
 
h—d”
.

309 
»®m


310 
A
 
¡ršg
 
cÚššg
 
the
 
auth’tiÿtiÚ
 
»®m
.

312 
g‘_ha1


313 
A
 
ÿÎabË
 
which
 
looks
 
up
 
a
 
u£ºame
 
š
‡ 
üed’tŸls
 
¡Üe


314 
ªd
 
»tuºs
 
the
 
HA1
 
¡ršg
, 
which
 
is
 
defšed
 
š
h
RFC
 
to
 
be


315 
	`MD5
(
u£ºame
 : 
»®m
 : 
·sswÜd
). 
The
 
funùiÚ
's signature is:

316 ``
	`g‘_ha1
(
»®m
, 
u£ºame
)``

317 
wh”e
 
u£ºame
 
is
 
obšed
 
äom
 
the
 
»que¡
' '
authÜiz©iÚ
' header.

318 
If
 
u£ºame
 
is
 
nÙ
 
found
 
š
 
the
 
üed’tŸls
 
¡Üe
, 
	$g‘_ha1
(è
»tuºs


319 
NÚe
.

321 
key


322 
A
 
£ü‘
 
¡ršg
 
known
 
Úly
 
to
 
the
 
£rv”
, 
u£d
 
š
h
syÁhesis
 
of
 
nÚûs
.

325 
»que¡
 = 
ch”rypy
.
£rvšg
.request

327 
auth_h—d”
 = 
»que¡
.
h—d”s
.
	`g‘
('authorization')

328 
nÚû_is_¡®e
 = 
F®£


329 
auth_h—d”
 
is
 
nÙ
 
NÚe
:

330 
Œy
:

331 
auth
 = 
	$H‰pDige¡AuthÜiz©iÚ
(
auth_h—d”
, 
»que¡
.
m‘hod
, 
debug
=debug)

332 
exû±
 
V®ueE¼Ü
:

333 
¿i£
 
ch”rypy
.
	`HTTPE¼Ü
(400, "The Authorization header could‚ot be…arsed.")

335 
debug
:

336 
	`TRACE
(
	$¡r
(
auth
))

338 
auth
.
	$v®id©e_nÚû
(
»®m
, 
key
):

339 
ha1
 = 
	$g‘_ha1
(
»®m
, 
auth
.
u£ºame
)

340 
ha1
 
is
 
nÙ
 
NÚe
:

341 #nÙ
th©
 
»que¡
.
body
 
to
 
be
 
avaabË
 
we
 
Ãed
Ø
hook
 
š
 
©


342 #befÜe_hªdËr, 
nÙ
 
Ú_¡¬t_»sourû
 
like
 3.1.x 
dige¡_auth
 
dÛs
.

343 
dige¡
 = 
auth
.
	$»que¡_dige¡
(
ha1
, 
’t™y_body
=
»que¡
.
body
)

344 
dige¡
 =ğ
auth
.
»¥Ú£
: #authenticated

345 
debug
:

346 
	`TRACE
("digest matches‡uth.response")

347 #Now 
check
 
nÚû
 
is
 
¡®e
.

348 #Th
choiû
 
of
 
‹n
 
mšu‹s
'†ifetime for‚once is somewhat‡rbitrary

349 
nÚû_is_¡®e
 = 
auth
.
	$is_nÚû_¡®e
(
max_age_£cÚds
=600)

350 
nÙ
 
nÚû_is_¡®e
:

351 
»que¡
.
logš
 = 
auth
.
u£ºame


352 
debug
:

353 
	`TRACE
("auth’tiÿtiÚ oà% sucûssful" % 
auth
.
u£ºame
)

356 #Re¥Úd 
w™h
 401 
¡©us
 
ªd
 
a
 
WWW
-
Auth’tiÿ‹
 
h—d”


357 
h—d”
 = 
	$www_auth’tiÿ‹
(
»®m
, 
key
, 
¡®e
=
nÚû_is_¡®e
)

358 
debug
:

359 
	$TRACE
(
h—d”
)

360 
ch”rypy
.
£rvšg
.
»¥Ú£
.
h—d”s
['WWW-Auth’tiÿ‹'] = 
h—d”


361 
¿i£
 
ch”rypy
.
	`HTTPE¼Ü
(401, "You‡re‚ot‡uthorizedo‡ccesshat„esource")

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/lib/caching.py

2 
Ch”ryPy
 
im¶em’ts
 
a
 
sim¶e
 
ÿchšg
 
sy¡em
 
as
‡ 
¶uggabË
 
	gToŞ
. 
This
 
toŞ
 
Œ›s


3 
to
 
be
 
ª
 (
š
-
´oûss
è
	gHTTP
/1.1-
com¶ŸÁ
 
	gÿche
. 
	gIt
's‚ot quitehere yet, but

4 
	g™
's…robably goodƒnough for most sites.

6 
In
 
	gg’”®
, 
GET
 
»¥Ú£s
 
¬e
 
	$ÿched
 (
®Úg
 
w™h
 
£Ëùšg
 
h—d”s
è
ªd
, 

7 
ªÙh”
 
»que¡
 
¬rives
 
the
 
§me
 
»sourû
,h
ÿchšg
 
ToŞ
 
wl
  304

8 
NÙ
 
Modif›d
 
possibË
, 
Ü
 
£rve
 
the
 
ÿched
 
»¥Ú£
 
Ùh”wi£
. 
It
 
®so
 
£ts


9 
»que¡
.
ÿched
 
to
 
True
 
£rvšg
 
a
 cached 
»´e£Á©iÚ
, 
ªd
 
£ts


10 
»que¡
.
ÿch—bË
 
to
 
	`F®£
 (
so
 
™
 
dÛ¢
't get cached‡gain).

12 
If
 
POST
, 
PUT
, 
Ü
 
DELETE
 
»que¡s
 
¬e
 
made
 
a
 
ÿched
 
»sourû
, 
they
 
šv®id©e


13 (
d–‘e
è
ªy
 
ÿched
 
»¥Ú£
.

15 
U§ge


18 
CÚfigu¿tiÚ
 
fe
 
exam¶e
::

21 
toŞs
.
ÿchšg
.
Ú
 = 
True


22 
toŞs
.
ÿchšg
.
d–ay
 = 3600

24 
You
 
may
 
u£
 
a
 
şass
 
Ùh”
 
thª
 
the
 

25 :
şass
:`
MemÜyCache
<
ch”rypy
.
lib
.
ÿchšg
.MemÜyCache>` 
by
 
suµlyšg
 
the
 
cÚfig


26 
’Œy
 ``
ÿche_şass
``; 
suµly
 
the
 
fuÎ
 
dÙ‹d
 
Çme
 
of
h
»¶aûm’t
 
şass


27 
as
 
the
 
cÚfig
 
v®ue
. 
It
 
mu¡
 
im¶em’t
h
basic
 
m‘hods
 ``
g‘
``, ``
put
``,

28 ``
d–‘e
``, 
ªd
 ``
ş—r
``.

30 
You
 
may
 
£t
 
ªy
 
©Œibu‹
, 
šşudšg
 
ov”ridšg
 
m‘hods
, 
Ú
 
the
 
ÿche


31 
š¡ªû
 
by
 
´ovidšg
 
them
 
š
 
cÚfig
. 
The
 
above
 
£ts
 
the


32 :
©Œ
:`
d–ay
<
ch”rypy
.
lib
.
ÿchšg
.
MemÜyCache
.d–ay>` 
©Œibu‹
, 
exam¶e
.

35 
impÜt
 
d©‘ime


36 
impÜt
 
sys


37 
impÜt
 
th»adšg


38 
impÜt
 
time


40 
impÜt
 
ch”rypy


41 
äom
 
ch”rypy
.
lib
 
impÜt
 
ıtoŞs
, 
h‰put


42 
äom
 
ch”rypy
.
_ıcom·t
 
impÜt
 
cİy™ems
, 
Áob
, 
£t_d«mÚ
, 
sÜ‹d
, 
Ev’t


45 
şass
 
	$Cache
(
objeù
):

48 
def
 
	$g‘
(
£lf
):

50 
¿i£
 
NÙIm¶em’‹d


52 
def
 
	$put
(
£lf
, 
obj
, 
size
):

54 
¿i£
 
NÙIm¶em’‹d


56 
def
 
	$d–‘e
(
£lf
):

58 
¿i£
 
NÙIm¶em’‹d


60 
def
 
	$ş—r
(
£lf
):

62 
¿i£
 
NÙIm¶em’‹d


66 #------------------------------- 
MemÜy
 
Cache
 ------------------------------- #


68 
şass
 
	$AÁiSm³deCache
(
diù
):

71 
def
 
	$wa™
(
£lf
, 
key
, 
timeout
=5, 
debug
=
F®£
):

74 
If
 
timeout
 
is
 
nÙ
 
NÚe
, 
ªd
 
the
 
v®ue
 i 
®»ady


75 
bešg
 
ÿlcuÏ‹d
 
by
 
ªÙh”
 
th»ad
, 
wa™
 
uÁ
 
the
 
giv’
 
timeout
 
has


76 
–­£d
. 
If
 
the
 
v®ue
 
is
 
avaabË
 
befÜe
h
timeout
 
expœes
, 
™
 is

77 
»tuºed
. 
If
 
nÙ
, 
NÚe
 
is
„‘uºed, 
ªd
 
a
 
£Áš–
 
¶aûd
 
š
 
the
 
ÿche


78 
to
 
sigÇl
 
Ùh”
 
th»ads
Ø
wa™
.

80 
If
 
timeout
 
is
 
NÚe
, 
no
 
wa™šg
 i 
³rfÜmed
 
nÜ
 
£Áš–s
 
u£d
.

82 
v®ue
 = 
£lf
.
	$g‘
(
key
)

83 
	$isš¡ªû
(
v®ue
, 
Ev’t
):

84 
timeout
 
is
 
NÚe
:

85 #IgnÜ
the
 
Ùh”
 
th»ad
 
ªd
 
»ÿlc
 
™
 
our£lves
.

86 
debug
:

87 
ch”rypy
.
	`log
('Noimeout', 'TOOLS.CACHING')

88  
NÚe


90 #Wa™ 
uÁ
 
™
's done orimes out.

91 
debug
:

92 
ch”rypy
.
	`log
('Wa™šg u°tØ% £cÚds' % 
timeout
, 'TOOLS.CACHING')

93 
v®ue
.
	$wa™
(
timeout
)

94 
v®ue
.
»suÉ
 
is
 
nÙ
 
NÚe
:

95 #Th
Ùh”
 
th»ad
 
fšished
 
™s
 
ÿlcuÏtiÚ
. 
U£
 
™
.

96 
debug
:

97 
ch”rypy
.
	`log
('Result!', 'TOOLS.CACHING')

98  
v®ue
.
»suÉ


99 #Timed 
out
. 
Stick
 
ª
 
Ev’t
 
š
 
the
 
¦Ù
 
so
 
Ùh”
 
th»ads
 
wa™


100 #Ú 
this
 
Úe
 
to
 
fšish
 
ÿlcuÏtšg
 
the
 
v®ue
.

101 
debug
:

102 
ch”rypy
.
	`log
('Timed out', 'TOOLS.CACHING')

103 
e
 = 
th»adšg
.
	$Ev’t
()

104 
e
.
»suÉ
 = 
NÚe


105 
diù
.
	$__£t™em__
(
£lf
, 
key
, 
e
)

107  
NÚe


108 
–if
 
v®ue
 
is
 
NÚe
:

109 #Stick 
ª
 
Ev’t
 
š
 
the
 
¦Ù
 
so
 
Ùh”
 
th»ads
 
wa™


110 #Ú 
this
 
Úe
 
to
 
fšish
 
ÿlcuÏtšg
 
the
 
v®ue
.

111 
debug
:

112 
ch”rypy
.
	`log
('Timed out', 'TOOLS.CACHING')

113 
e
 = 
th»adšg
.
	$Ev’t
()

114 
e
.
»suÉ
 = 
NÚe


115 
diù
.
	$__£t™em__
(
£lf
, 
key
, 
e
)

116  
v®ue


118 
def
 
	$__£t™em__
(
£lf
, 
key
, 
v®ue
):

120 
exi¡šg
 = 
£lf
.
	$g‘
(
key
)

121 
diù
.
	$__£t™em__
(
£lf
, 
key
, 
v®ue
)

122 
	$isš¡ªû
(
exi¡šg
, 
Ev’t
):

123 #S‘ 
Ev’t
.
»suÉ
 
so
 
Ùh”
 
th»ads
 
wa™šg
 
Ú
 
™
 
have


124 #immedŸ‹ 
acûss
 
w™hout
 
Ãedšg
 
to
 
pŞl
 
the
 
ÿche
 
agaš
.

125 
exi¡šg
.
»suÉ
 = 
v®ue


126 
exi¡šg
.
	$£t
()

129 
şass
 
	$MemÜyCache
(
Cache
):

132 
Each
 
key
 
š
 
£lf
.
¡Üe
 
is
 
a
 
URI
, 
ªd
 
—ch
 
v®ue
 i 
ª
 
AÁiSm³deCache
.

133 
The
 
»¥Ú£
 
ªy
 
giv’
 
URI
 
may
 
v¬y
 
ba£d
 
Ú
 
the
 
v®ues
 
of


134 "£Ëùšg„eque¡ h—d”s"; 
th©
 
is
, 
tho£
 
Çmed
 
š
 
the
 
V¬y


135 
»¥Ú£
 
h—d”
. 
We
 
assume
 
the
 
li¡
 
of
 h—d” 
Çmes
 
to
 
be
 
cÚ¡ªt


136 
—ch
 
URI
 
throughout
 
the
 
liãtime
 
of
h
­¶iÿtiÚ
, 
ªd
 
¡Üe


137 
th©
 
li¡
 
š
 ``
£lf
.
¡Üe
[
uri
].
£Ëùšg_h—d”s
``.

139 
The
 
™ems
 
cÚšed
 
š
 ``
£lf
.
¡Üe
[
uri
]`` 
have
 
keys
 
which
 
¬e
 
tu¶es
 
of


140 
»que¡
 
h—d”
 
	`v®ues
 (
š
 
the
 
§me
 
Üd”
 
as
h
Çmes
 iÀ
™s


141 
£Ëùšg_h—d”s
), 
ªd
 
v®ues
 
which
 
¬e
 
the
 
aùu®
 
»¥Ú£s
.

144 
maxobjeùs
 = 1000

147 
maxobj_size
 = 100000

150 
maxsize
 = 10000000

153 
d–ay
 = 600

156 
ªti¡am³de_timeout
 = 5

159 
expœe_äeq
 = 0.1

162 
debug
 = 
F®£


164 
def
 
	$__š™__
(
£lf
):

165 
£lf
.
	$ş—r
()

167 #RuÀ
£lf
.
expœe_ÿche
 
š
 
a
 
£·¿‹
 
d«mÚ
 
th»ad
.

168 
t
 = 
th»adšg
.
	`Th»ad
(
rg‘
=
£lf
.
expœe_ÿche
, 
Çme
='expire_cache')

169 
£lf
.
expœ©iÚ_th»ad
 = 
t


170 
	$£t_d«mÚ
(
t
, 
True
)

171 
t
.
	$¡¬t
()

173 
def
 
	$ş—r
(
£lf
):

175 
£lf
.
¡Üe
 = {
	}
}

176 
£lf
.
expœ©iÚs
 = {}

177 
£lf
.
tÙ_puts
 = 0

178 
£lf
.
tÙ_g‘s
 = 0

179 
£lf
.
tÙ_hi¡
 = 0

180 
£lf
.
tÙ_expœes
 = 0

181 
£lf
.
tÙ_nÚ_modif›d
 = 0

182 
£lf
.
cursize
 = 0

184 
def
 
	$expœe_ÿche
(
£lf
):

187 
This
 
funùiÚ
 
is
 
desigÃd
 
to
 
be
 
run
 
š
 
™s
 
own
 
d«mÚ
 
th»ad
,

188 
»ã»nûd
 
©
 ``
£lf
.
expœ©iÚ_th»ad
``.

191 #¬b™¿ry, 
so
 
we
 
check
 "whtime" 
to
 
avoid
 
exû±iÚs
.

192 #S“ 
tick‘s
 #99 
ªd
 #180 
mÜe
 
šfÜm©iÚ
.

193 
time
:

194 
now
 = 
time
.
	$time
()

195 #Mu¡ 
make
 
a
 
cİy
 
of
 
expœ©iÚs
 
so
 
™
 
dÛ¢
't change size

196 #duršg 
™”©iÚ


197 
expœ©iÚ_time
, 
objeùs
 
š
 
	$cİy™ems
(
£lf
.
expœ©iÚs
):

198 
expœ©iÚ_time
 <ğ
now
:

199 
obj_size
, 
uri
, 
£l_h—d”_v®ues
 
š
 
objeùs
:

200 
Œy
:

201 
d–
 
£lf
.
¡Üe
[
uri
][
	`tu¶e
(
£l_h—d”_v®ues
)]

202 
£lf
.
tÙ_expœes
 += 1

203 
£lf
.
cursize
 -ğ
obj_size


204 
exû±
 
KeyE¼Ü
:

205 #th
key
 
may
 
have
 
b“n
 
d–‘ed
 
–£wh”e


206 
·ss


207 
d–
 
£lf
.
expœ©iÚs
[
expœ©iÚ_time
]

208 
time
.
	$¦“p
(
£lf
.
expœe_äeq
)

210 
def
 
	$g‘
(
£lf
):

212 
»que¡
 = 
ch”rypy
.
£rvšg
.request

213 
£lf
.
tÙ_g‘s
 += 1

215 
uri
 = 
ch”rypy
.
	$u¾
(
qs
=
»que¡
.
qu”y_¡ršg
)

216 
uriÿche
 = 
£lf
.
¡Üe
.
	$g‘
(
uri
)

217 
uriÿche
 
is
 
NÚe
:

218  
NÚe


220 
h—d”_v®ues
 = [
»que¡
.
h—d”s
.
	`g‘
(
h
, '')

221 
h
 
š
 
uriÿche
.
£Ëùšg_h—d”s
]

222 
v¬ŸÁ
 = 
uriÿche
.
	`wa™
(
key
=
	`tu¶e
(
	`sÜ‹d
(
h—d”_v®ues
)),

223 
timeout
=
£lf
.
ªti¡am³de_timeout
,

224 
debug
=
£lf
.debug)

225 
v¬ŸÁ
 
is
 
nÙ
 
NÚe
:

226 
£lf
.
tÙ_hi¡
 += 1

227  
v¬ŸÁ


229 
def
 
	$put
(
£lf
, 
v¬ŸÁ
, 
size
):

231 
»que¡
 = 
ch”rypy
.
£rvšg
.request

232 
»¥Ú£
 = 
ch”rypy
.
£rvšg
.response

234 
uri
 = 
ch”rypy
.
	$u¾
(
qs
=
»que¡
.
qu”y_¡ršg
)

235 
uriÿche
 = 
£lf
.
¡Üe
.
	$g‘
(
uri
)

236 
uriÿche
 
is
 
NÚe
:

237 
uriÿche
 = 
	$AÁiSm³deCache
()

238 
uriÿche
.
£Ëùšg_h—d”s
 = [

239 
e
.
v®ue
 
š
 
»¥Ú£
.
h—d”s
.
	`–em’ts
('Vary')]

240 
£lf
.
¡Üe
[
uri
] = 
uriÿche


242 
	`Ën
(
£lf
.
¡Üe
è< s–f.
maxobjeùs
:

243 
tÙ®_size
 = 
£lf
.
cursize
 + 
size


245 #check 
th”e
's space forhe object

246 ià(
size
 < 
£lf
.
maxobj_size
 
ªd
 
tÙ®_size
 < s–f.
maxsize
):

247 #add 
to
 
the
 
expœ©iÚs
 
li¡


248 
expœ©iÚ_time
 = 
»¥Ú£
.
time
 + 
£lf
.
d–ay


249 
buck‘
 = 
£lf
.
expœ©iÚs
.
	$£tdeçuÉ
(
expœ©iÚ_time
, [])

250 
buck‘
.
	`­³nd
((
size
, 
uri
, 
uriÿche
.
£Ëùšg_h—d”s
))

252 #add 
to
 
the
 
ÿche


253 
h—d”_v®ues
 = [
»que¡
.
h—d”s
.
	`g‘
(
h
, '')

254 
h
 
š
 
uriÿche
.
£Ëùšg_h—d”s
]

255 
uriÿche
[
	`tu¶e
(
	`sÜ‹d
(
h—d”_v®ues
))] = 
v¬ŸÁ


256 
£lf
.
tÙ_puts
 += 1

257 
£lf
.
cursize
 = 
tÙ®_size


259 
def
 
	$d–‘e
(
£lf
):

261 
uri
 = 
ch”rypy
.
	$u¾
(
qs
=
ch”rypy
.
£rvšg
.
»que¡
.
qu”y_¡ršg
)

262 
£lf
.
¡Üe
.
	$pİ
(
uri
, 
NÚe
)

265 
def
 
	`g‘
(
šv®id_m‘hods
=("POST", "PUT", "DELETE"), 
debug
=
F®£
, **
kw¬gs
):

268 
If
 
POST
, 
PUT
, 
Ü
 
DELETE
:

269 * 
	$šv®id©es
 (
d–‘es
è
ªy
 
ÿched
 
»¥Ú£
 
this
 
»sourû


270 * 
£ts
 
»que¡
.
ÿched
 = 
F®£


271 * 
£ts
 
»que¡
.
ÿch—bË
 = 
F®£


273 
a
 
ÿched
 
cİy
 
exi¡s
:

274 * 
£ts
 
»que¡
.
ÿched
 = 
True


275 * 
£ts
 
»que¡
.
ÿch—bË
 = 
F®£


276 * 
£ts
 
»¥Ú£
.
h—d”s
 
to
 
the
 
ÿched
 
v®ues


277 * 
checks
 
the
 
ÿched
 
La¡
-
Modif›d
 
»¥Ú£
 
h—d”
 
agaš¡
he

278 
cu¼’t
 
If
-(
Un
)
Modif›d
-
Sšû
 
»que¡
 
h—d”s
; 
¿i£s
 304

279 
Ãûs§ry
.

280 * 
£ts
 
»¥Ú£
.
¡©us
 
ªd
„e¥Ú£.
body
 
to
 
the
 
ÿched
 
v®ues


281 * 
»tuºs
 
True


283 
Ùh”wi£
:

284 * 
£ts
 
»que¡
.
ÿched
 = 
F®£


285 * 
£ts
 
»que¡
.
ÿch—bË
 = 
True


286 * 
»tuºs
 
F®£


288 
»que¡
 = 
ch”rypy
.
£rvšg
.request

289 
»¥Ú£
 = 
ch”rypy
.
£rvšg
.response

291 
nÙ
 
	`ha§‰r
(
ch”rypy
, "_cache"):

292 #Mak
a
 
´oûss
-
wide
 
Cache
 
objeù
.

293 
ch”rypy
.
_ÿche
 = 
kw¬gs
.
	`pİ
("ÿche_şass", 
MemÜyCache
)()

295 #Tak
®l
 
»maššg
 
kw¬gs
 
ªd
 
£t
 
them
 
Ú
 
the
 
Cache
 
objeù
.

296 
k
, 
v
 
š
 
kw¬gs
.
	$™ems
():

297 
	$£‰r
(
ch”rypy
.
_ÿche
, 
k
, 
v
)

298 
ch”rypy
.
_ÿche
.
debug
 = debug

300 #POST, 
PUT
, 
DELETE
 
should
 
	`šv®id©e
 (
d–‘e
è
the
 
ÿched
 
cİy
.

301 #S“ 
h‰p
:

302 
»que¡
.
m‘hod
 
š
 
šv®id_m‘hods
:

303 
debug
:

304 
ch”rypy
.
	`log
('request.method %r in invalid_methods %r' %

305 (
»que¡
.
m‘hod
, 
šv®id_m‘hods
), 'TOOLS.CACHING')

306 
ch”rypy
.
_ÿche
.
	$d–‘e
()

307 
»que¡
.
ÿched
 = 
F®£


308 
»que¡
.
ÿch—bË
 = 
F®£


309  
F®£


311 'no-ÿche' 
š
 [
e
.
v®ue
 š 
»que¡
.
h—d”s
.
	`–em’ts
('Pragma')]:

312 
»que¡
.
ÿched
 = 
F®£


313 
»que¡
.
ÿch—bË
 = 
True


314  
F®£


316 
ÿche_d©a
 = 
ch”rypy
.
_ÿche
.
	$g‘
()

317 
»que¡
.
ÿched
 = 
	$boŞ
(
ÿche_d©a
)

318 
»que¡
.
ÿch—bË
 = 
nÙ
„eque¡.
ÿched


319 
»que¡
.
ÿched
:

320 #S”v
the
 
ÿched
 
cİy
.

321 
max_age
 = 
ch”rypy
.
_ÿche
.
d–ay


322 
v
 
š
 [
e
.
v®ue
 š 
»que¡
.
h—d”s
.
	`–em’ts
('Cache-Control')]:

323 
©oms
 = 
v
.
	`¥l™
('=', 1)

324 
dœeùive
 = 
©oms
.
	$pİ
(0)

325 
dœeùive
 == 'max-age':

326 
	`Ën
(
©oms
è!ğ1 
Ü
 
nÙ
‡toms[0].
	$isdig™
():

327 
¿i£
 
ch”rypy
.
	`HTTPE¼Ü
(400, "Invalid Cache-Control header")

328 
max_age
 = (
©oms
[0])

330 
–if
 
dœeùive
 == 'no-cache':

331 
debug
:

332 
ch”rypy
.
	`log
('Ignoring cache dueo Cache-Control:‚o-cache',

334 
»que¡
.
ÿched
 = 
F®£


335 
»que¡
.
ÿch—bË
 = 
True


336  
F®£


338 
debug
:

339 
ch”rypy
.
	`log
('Reading„esponse from cache', 'TOOLS.CACHING')

340 
s
, 
h
, 
b
, 
ü—‹_time
 = 
ÿche_d©a


341 
age
 = (
»¥Ú£
.
time
 - 
ü—‹_time
)

342 ià(
age
 > 
max_age
):

343 
debug
:

344 
ch”rypy
.
	`log
('IgnÜšg cachdutØag> %d' % 
max_age
,

346 
»que¡
.
ÿched
 = 
F®£


347 
»que¡
.
ÿch—bË
 = 
True


348  
F®£


350 #Cİy 
the
 
»¥Ú£
 
h—d”s
. 
S“
 
h‰p
:

351 
»¥Ú£
.
h—d”s
 = 
rh
 = 
h‰put
.
	$H—d”M­
()

352 
k
 
š
 
h
:

353 
diù
.
	`__£t™em__
(
rh
, 
k
, diù.
	$__g‘™em__
(
h
, 
k
))

355 #Add 
the
 
»quœed
 
Age
 
h—d”


356 
»¥Ú£
.
h—d”s
["Age"] = 
	$¡r
(
age
)

358 
Œy
:

359 #NÙ
th©
 
v®id©e_sšû
 
d•’ds
 
Ú
 
a
 
La¡
-
Modif›d
 
h—d”
;

360 #thi 
was
 
put
 
što
 
the
 
ÿched
 
cİy
, 
ªd
 
should
 
have
 
b“n


361 #»su¼eùed 
ju¡
 
	`above
 (
»¥Ú£
.
h—d”s
 = 
ÿche_d©a
[1]).

362 
ıtoŞs
.
	$v®id©e_sšû
()

363 
exû±
 
ch”rypy
.
HTTPRedœeù
:

364 
x
 = 
sys
.
	`exc_šfo
()[1]

365 
x
.
¡©us
 == 304:

366 
ch”rypy
.
_ÿche
.
tÙ_nÚ_modif›d
 += 1

367 
¿i£


369 #£rv
™
 & 
g‘
 
out
 
äom
 
the
 
»que¡


370 
»¥Ú£
.
¡©us
 = 
s


371 
»¥Ú£
.
body
 = 
b


373 
debug
:

374 
ch”rypy
.
	`log
('request is‚ot cached', 'TOOLS.CACHING')

375  
»que¡
.
ÿched


378 
def
 
	$‹e_ouut
():

380 #U£d 
by
 
CachšgToŞ
 by 
©chšg
 
to
 
»que¡
.
hooks


382 
»que¡
 = 
ch”rypy
.
£rvšg
.request

383 'no-¡Üe' 
š
 
»que¡
.
h—d”s
.
	`v®ues
('Cache-Control'):

386 
def
 
	$‹e
(
body
):

388 ià('no-ÿche' 
š
 
»¥Ú£
.
h—d”s
.
	`v®ues
('P¿gma'è
Ü


389 'no-¡Üe' 
š
 
»¥Ú£
.
h—d”s
.
	`v®ues
('Cache-Control')):

390 
chunk
 
š
 
body
:

391 
y›ld
 
chunk


394 
ouut
 = []

395 
chunk
 
š
 
body
:

396 
ouut
.
	$­³nd
(
chunk
)

397 
y›ld
 
chunk


399 #§v
the
 
ÿche
 
d©a


400 
body
 = 
	`Áob
('').
	$još
(
ouut
)

401 
ch”rypy
.
_ÿche
.
	`put
((
»¥Ú£
.
¡©us
,„e¥Ú£.
h—d”s
 
Ü
 {
	}
},

402 
	gbody
, 
	g»¥Ú£
.
	gtime
), 
	$Ën
(
body
))

404 
»¥Ú£
 = 
ch”rypy
.
£rvšg
.response

405 
»¥Ú£
.
body
 = 
	$‹e
(
»¥Ú£
.
body
)

408 
def
 
	$expœes
(
£cs
=0, 
fÜû
=
F®£
, 
debug
=False):

411 
£cs


412 
Mu¡
 
be
 
e™h”
 
ª
 
Ü
 
a
 
d©‘ime
.
timed–
, 
ªd
 
šdiÿ‹s
 
the


413 
numb”
 
of
 
£cÚds
 
b‘w“n
 
»¥Ú£
.
time
 
ªd
 
wh’
 
the
„e¥Ú£ 
should


414 
expœe
. 
The
 'Expœes' 
h—d”
 
wl
 
be
 
£t
 
to
 
»¥Ú£
.
time
 + 
£cs
.

415 
If
 
£cs
 
is
 
z”o
, 
the
 'Expœes' 
h—d”
 i 
£t
 
Úe
 
y—r
 
š
h
·¡
, 
ªd


416 
the
 
fŞlowšg
 "ÿch´ev’tiÚ" 
h—d”s
 
¬e
 
®so
 
£t
:

418 * 
P¿gma
: 
no
-
ÿche


419 * 
Cache
-
CÚŒŞ
':‚o-cache, must-revalidate

421 
fÜû


422 
If
 
F®£
, 
the
 
fŞlowšg
 
h—d”s
 
¬e
 
checked
:

424 * 
Eg


425 * 
La¡
-
Modif›d


426 * 
Age


427 * 
Expœes


429 
If
 
ªy
 
¬e
 
®»ady
 
´e£Á
, 
nÚe
 
of
 
the
 
above
 
»¥Ú£
 
h—d”s
‡» 
£t
.

433 
»¥Ú£
 = 
ch”rypy
.
£rvšg
.response

434 
h—d”s
 = 
»¥Ú£
.headers

436 
ÿch—bË
 = 
F®£


437 
nÙ
 
fÜû
:

438 #som
h—d”
 
Çmes
 
th©
 
šdiÿ‹
h© 
the
 
»¥Ú£
 
ÿn
 
be
 
ÿched


439 
šdiÿtÜ
 
	`š
 ('Etag', 'Last-Modified', 'Age', 'Expires'):

440 
šdiÿtÜ
 
š
 
h—d”s
:

441 
ÿch—bË
 = 
True


444 
nÙ
 
ÿch—bË
 
ªd
‚Ù 
fÜû
:

445 
debug
:

446 
ch”rypy
.
	`log
('request is‚ot cacheable', 'TOOLS.EXPIRES')

448 
debug
:

449 
ch”rypy
.
	`log
('request is cacheable', 'TOOLS.EXPIRES')

450 
	$isš¡ªû
(
£cs
, 
d©‘ime
.
timed–
):

451 
£cs
 = (86400 * secs.
days
è+ secs.
£cÚds


453 
£cs
 == 0:

454 
fÜû
 
	`Ü
 ("P¿gma" 
nÙ
 
š
 
h—d”s
):

455 
h—d”s
["Pragma"] = "no-cache"

456 
ch”rypy
.
£rvšg
.
»que¡
.
´ÙocŞ
 >= (1, 1):

457 
fÜû
 
Ü
 "Cache-CÚŒŞ" 
nÙ
 
š
 
h—d”s
:

458 
h—d”s
["Cache-Control"] = "no-cache, must-revalidate"

459 #S‘ 
ª
 
ex¶ic™
 
Expœes
 
d©e
 
š
 
the
 
·¡
.

460 
expœy
 = 
h‰put
.
	$HTTPD©e
(1169942400.0)

462 
expœy
 = 
h‰put
.
	`HTTPD©e
(
»¥Ú£
.
time
 + 
£cs
)

463 
fÜû
 
Ü
 "Expœes" 
nÙ
 
š
 
h—d”s
:

464 
h—d”s
["Expœes"] = 
expœy


	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/lib/covercp.py

3 
To
 
u£
 
this
 
	gmoduË
, 
Ü
 
the
 
cov”age
 
toŞs
 
š
h
‹¡
 
	gsu™e
,

4 
you
 
Ãed
 
to
 
	gdowÆßd
 'cov”age.py', 
e™h”
 
G¬‘h
 
	gR“s
' `original

5 
	gim¶em’tiÚ
 <
	gh‰p
:

6 
Ü
 
Ned
 
B©ch–d”
's `enhanced version:

7 <
h‰p
:

9 
To
 
tuº
 
Ú
 
cov”age
 
Œacšg
, 
u£
 
the
 
fŞlowšg
 
	gcode
::

11 
ch”rypy
.
’gše
.
subsüibe
('¡¬t', 
cov”ı
.
¡¬t
)

13 
DO
 
NOT
 
subsüibe
 
ªythšg
 
Ú
 
	gthe
 '¡¬t_th»ad' 
	gchªÃl
, 
as
 
´eviou¦y


14 
	g»comm’ded
. 
C®lšg
 
¡¬t
 
Úû
 
š
 
the
 
maš
 
th»ad
 
should
 
be
 
suffic›Á


15 
to
 
¡¬t
 
cov”age
 
Ú
 
®l
 
	gth»ads
. 
C®lšg
 s¹ 
agaš
 
š
 
—ch
 
th»ad


16 
efãùiv–y
 
ş—rs
 
ªy
 
cov”age
 
d©a
 
g©h”ed
 
up
 
to
 
th©
 
	gpošt
.

18 
Run
 
your
 
	gcode
, 
th’
 
u£
 
	gthe
 ``
	gcov”ı
.
£rve
()`` 
funùiÚ
 
to
 
brow£
 
the


19 
»suÉs
 
š
 
a
 
web
 
	gbrow£r
. 
If
 
you
 
run
 
this
 
moduË
 
äom
 
the
 
commªd
 
	glše
,

20 
™
 
wl
 
	gÿÎ
 ``
£rve
()`` 
	gyou
.

23 
impÜt
 
»


24 
impÜt
 
sys


25 
impÜt
 
cgi


26 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
quÙe_¶us


27 
impÜt
 
	gos
, os.
·th


28 
	gloÿlFe
 = 
os
.
·th
.
još
(os.·th.
dœÇme
(
__fe__
), "coverage.cache")

30 
	gthe_cov”age
 = 
NÚe


31 
Œy
:

32 
äom
 
cov”age
 
impÜt
 coverage

33 
the_cov”age
 = 
	$cov”age
(
d©a_fe
=
loÿlFe
)

34 
def
 
	$¡¬t
():

35 
the_cov”age
.
	$¡¬t
()

36 
exû±
 
ImpÜtE¼Ü
:

37 #S‘tšg 
the_cov”age
 
to
 
NÚe
 
wl
 
¿i£
 
”rÜs


38 #th© 
Ãed
 
to
 
be
 
Œ­³d
 
down¡»am
.

39 
the_cov”age
 = 
NÚe


41 
impÜt
 
w¬nšgs


42 
w¬nšgs
.
	`w¬n
("No code coverage will be…erformed; coverage.py could‚ot be imported.")

44 
def
 
	$¡¬t
():

45 
·ss


46 
¡¬t
.
´iÜ™y
 = 20

48 
TEMPLATE_MENU
 = """<html>

49 <
h—d
>

50 <
t™Ë
>
Ch”ryPy
 
Cov”age
 
M’u
</title>

51 <
¡yË
>

52 
body
 {
fÚt
: 9
±
 
ArŸl
, 
£rif
;
	}
}

54 
	gfÚt
-
	gsize
: 8
±
;

55 
	gfÚt
-
	gçmy
: 
And®e
 
MÚo
, 
	gmÚo¥aû
;

56 
	gwh™e
-
	g¥aû
: 
´e
;

58 #Œ“ 
a
:
aùive
,‡:
focus
 {

59 
	gbackground
-
	gcŞÜ
: 
bÏck
;

60 
	g·ddšg
: 1
px
;

61 
	gcŞÜ
: 
wh™e
;

62 
	gbÜd”
: 0
px
 
sŞid
 #9999FF;

63 -
	gmoz
-
	gouše
-
	g¡yË
: 
nÚe
;

65 .
	gç
 { 
	gcŞÜ
: 
»d
;}

66 .
	g·ss
 { 
	gcŞÜ
: #888;}

67 #pù { 
‹xt
-
®ign
: 
right
;}

68 
	gh3
 {

69 
	gfÚt
-
	gsize
: 
sm®l
;

70 
	gfÚt
-
	gweight
: 
bŞd
;

71 
	gfÚt
-
	g¡yË
: 
™®ic
;

72 
	gm¬gš
-
	gtİ
: 5
px
;

74 
	gšput
 { 
	gbÜd”
: 1
px
 
sŞid
 #ccc; 
	g·ddšg
: 2px; }

75 .
	gdœeùÜy
 {

76 
	gcŞÜ
: #933;

77 
	gfÚt
-
	g¡yË
: 
™®ic
;

78 
	gfÚt
-
	gweight
: 
bŞd
;

79 
	gfÚt
-
	gsize
: 10
±
;

81 .
	gfe
 {

82 
	gcŞÜ
: #400;

84 
	ga
 { 
	g‹xt
-
	gdecÜ©iÚ
: 
nÚe
; }

86 
	gcŞÜ
: 
wh™e
;

87 
	gfÚt
-
	gsize
: 8
±
;

88 
	gfÚt
-
	gçmy
: 
And®e
 
MÚo
, 
	gmÚo¥aû
;

89 
	gwidth
: 100%;

90 
	gbackground
-
	gcŞÜ
: 
bÏck
;

92 #üumb 
a
 {

93 
	gcŞÜ
: #f88;

96 
	glše
-
	gheight
: 2.3e
m
;

97 
	gbÜd”
: 1
px
 
sŞid
 
bÏck
;

98 
	gbackground
-
	gcŞÜ
: #eee;

99 
	g·ddšg
: 4
px
;

102 
	gwidth
: 100%;

103 
	gm¬gš
-
	gbÙtom
: 3
px
;

104 
	gbÜd”
: 1
px
 
sŞid
 #999;

107 
	gbackground
-
	gcŞÜ
: 
bÏck
;

108 
	gcŞÜ
: 
wh™e
;

109 
	gbÜd”
: 0;

110 
	gm¬gš
-
	gbÙtom
: -9
px
;

112 </
	g¡yË
>

113 </
	gh—d
>

114 <
	gbody
>

115 <
	gh2
>
Ch”ryPy
 
	gCov”age
</h2>"""

117 
	gTEMPLATE_FORM
 = """

118 <
div
 
id
="options">

119 <
fÜm
 
aùiÚ
='m’u' 
m‘hod
=
GET
>

120 <
šput
 
ty³
='hidd’' 
Çme
='ba£' 
v®ue
='%(base)s' />

121 
Show
 
³rûÁages
 <
šput
 
ty³
='checkbox' %(
showpù
)
s
 
Çme
='showpù' 
v®ue
='checked' /><
br
 />

122 
Hide
 
fes
 
ov”
 <
šput
 
ty³
='‹xt' 
id
='pù' 
Çme
='pù' 
v®ue
='%Õù)s' 
size
='3' />%%<
br
 />

123 
Exşude
 
fes
 
m©chšg
<
br
 />

124 <
šput
 
ty³
='‹xt' 
id
='exşude' 
Çme
='exşude' 
v®ue
='%Óxşude)s' 
size
='20' />

125 <
br
 />

127 <
šput
 
ty³
='subm™' 
v®ue
='Chªgv›w' 
id
="submit"/>

128 </
fÜm
>

129 </
div
>"""

131 
TEMPLATE_FRAMESET
 = """<html>

132 <
h—d
><
t™Ë
>
Ch”ryPy
 
cov”age
 
d©a
</title></head>

133 <
äame£t
 
cŞs
='250, 1*'>

134 <
äame
 
¤c
='menu?base=%s' />

135 <
äame
 
Çme
='maš' 
¤c
='' />

136 </
äame£t
>

137 </
html
>

140 
TEMPLATE_COVERAGE
 = """<html>

141 <
h—d
>

142 <
t™Ë
>
Cov”age
 %(
Çme
)
s
</title>

143 <
¡yË
>

144 
h2
 { 
m¬gš
-
bÙtom
: .25e
m
; }

145 
	gp
 { 
	gm¬gš
: .25e
m
; }

146 .
	gcov”ed
 { 
	gcŞÜ
: #000; 
	gbackground
-color: #fff; }

147 .
	gnÙcov”ed
 { 
	gcŞÜ
: #ãe; 
	gbackground
-color: #500; }

148 .
	gexşuded
 { 
	gcŞÜ
: #00f; 
	gbackground
-color: #fff; }

149 
	gbË
 .
	gcov”ed
,abË .
	gnÙcov”ed
,abË .
	gexşuded


150 { 
	gfÚt
-
	gçmy
: 
And®e
 
MÚo
, 
	gmÚo¥aû
;

151 
	gfÚt
-
	gsize
: 10
±
; 
	gwh™e
-
	g¥aû
: 
´e
; }

153 .
	glš’o
 { 
	gbackground
-
	gcŞÜ
: #eee;}

154 .
	gnÙcov”ed
 .
	glš’o
 { 
	gbackground
-
	gcŞÜ
: #000;}

155 
	gbË
 { 
	gbÜd”
-
	gcŞÏp£
: 
cŞÏp£
;

156 </
	g¡yË
>

157 </
	gh—d
>

158 <
	gbody
>

159 <
	gh2
>%(
	gÇme
)
	gs
</h2>

160 <
	gp
>%(
	gfuÎ·th
)
	gs
</p>

161 <
	gp
>
	gCov”age
: %(
pc
)
s
%%</
p
>"""

163 
TEMPLATE_LOC_COVERED
 = """<Œ cÏss="
cov”ed
">

164 <
td
 
şass
="lš’o">%
s
&
nb¥
;</
	gtd
>

165 <
	gtd
>%
	gs
</td>

166 </
	gŒ
>\
	gn
"""

167 
	gTEMPLATE_LOC_NOT_COVERED
 = """<Œ cÏss="
nÙcov”ed
">

168 <
td
 
şass
="lš’o">%
s
&
nb¥
;</
	gtd
>

169 <
	gtd
>%
	gs
</td>

170 </
	gŒ
>\
	gn
"""

171 
	gTEMPLATE_LOC_EXCLUDED
 = """<Œ cÏss="
exşuded
">

172 <
td
 
şass
="lš’o">%
s
&
nb¥
;</
	gtd
>

173 <
	gtd
>%
	gs
</td>

174 </
	gŒ
>\
	gn
"""

176 
	gTEMPLATE_ITEM
 = "%s%s<a class='file' href='report?name=%s'arget='main'>%s</a>\n"

178 
def
 
_³rûÁ
(
¡©em’ts
, 
missšg
):

179 
s
 = 
Ën
(
¡©em’ts
)

180 
e
 = 
s
 - 
Ën
(
missšg
)

181 
s
 > 0:

182  (
round
(100.0 * 
e
 / 
s
))

185 
def
 
_show_b¿nch
(
roÙ
, 
ba£
, 
·th
, 
pù
=0, 
showpù
=
F®£
, 
exşude
="",

186 
cov”age
=
the_cov”age
):

188 #Show 
the
 
dœeùÜy
 
Çme
 
ªd
 
ªy
 
of
 
our
 
chd»n


189 
dœs
 = [
k
 k, 
v
 
š
 
roÙ
.
™ems
() v]

190 
	gdœs
.
sÜt
()

191 
Çme
 
š
 
	gdœs
:

192 
Ãw·th
 = 
os
.
·th
.
još
Õ©h, 
Çme
)

194 
	gÃw·th
.
low”
().
¡¬tsw™h
(
ba£
):

195 
»Í©h
 = 
Ãw·th
[
Ën
(
ba£
):]

196 
y›ld
 "| " * 
»Í©h
.
couÁ
(
os
.
£p
)

197 
y›ld
 "<a class='directory' href='menu?base=%s&exclude=%s'>%s</a>\n" % \

198 (
Ãw·th
, 
quÙe_¶us
(
exşude
), 
	gÇme
)

200 
chunk
 
š
 
_show_b¿nch
(
roÙ
[
Çme
], 
ba£
, 
Ãw·th
, 
pù
, 
showpù
, 
exşude
, 
cov”age
=coverage):

201 
y›ld
 
chunk


203 #Now 
li¡
 
the
 
fes


204 
·th
.
low”
().
¡¬tsw™h
(
ba£
):

205 
»Í©h
 = 
·th
[
Ën
(
ba£
):]

206 
fes
 = [
k
 k, 
v
 
š
 
roÙ
.
™ems
(è
nÙ
 v]

207 
	gfes
.
sÜt
()

208 
Çme
 
š
 
	gfes
:

209 
Ãw·th
 = 
os
.
·th
.
još
Õ©h, 
Çme
)

211 
	gpc_¡r
 = ""

212 
showpù
:

213 
Œy
:

214 
_
, 
	g¡©em’ts
, 
	g_
, 
	gmissšg
, _ = 
cov”age
.
ª®ysis2
(
Ãw·th
)

215 
exû±
:

216 #Yes, 
we
 
»®ly
 
wªt
 
to
 
·ss
 
Ú
 
®l
 
”rÜs
.

217 
·ss


219 
pc
 = 
_³rûÁ
(
¡©em’ts
, 
missšg
)

220 
	gpc_¡r
 = ("%3d%% " % 
pc
).
»¶aû
(' ','&nbsp;')

221 
	gpc
 < (
	gpù
è
Ü
…c == -1:

222 
pc_¡r
 = "<span class='fail'>%s</span>" %…c_str

224 
pc_¡r
 = "<span class='pass'>%s</span>" %…c_str

226 
y›ld
 
TEMPLATE_ITEM
 % ("| " * (
»Í©h
.
couÁ
(
os
.
£p
) + 1),

227 
	gpc_¡r
, 
	gÃw·th
, 
	gÇme
)

229 
def
 
_sk_fe
(
·th
, 
exşude
):

230 
exşude
:

231  
boŞ
(
»
.
£¬ch
(
exşude
, 
·th
))

233 
def
 
_g¿á
(
·th
, 
Œ“
):

234 
d
 = 
Œ“


236 
p
 = 
·th


237 
©oms
 = []

238 
True
:

239 
p
, 
	g
 = 
os
.
·th
.
¥l™
(p)

240 
nÙ
 

:

242 
©oms
.
­³nd
(

)

243 
©oms
.
­³nd
(
p
)

244 
p
 != "/":

245 
©oms
.
­³nd
("/")

247 
©oms
.
»v”£
()

248 
node
 
š
 
©oms
:

249 
node
:

250 
d
 = d.
£tdeçuÉ
(
node
, {})

252 
def
 
g‘_Œ“
(
ba£
, 
exşude
, 
cov”age
=
the_cov”age
):

254 
Œ“
 = {}

255 
runs
 = 
cov”age
.
d©a
.
execu‹d_fes
()

256 
·th
 
š
 
runs
:

257 
nÙ
 
_sk_fe
(
·th
, 
exşude
è
ªd
‚Ù 
	gos
.
	g·th
.
isdœ
(path):

258 
_g¿á
(
·th
, 
Œ“
)

259  
Œ“


261 
şass
 
Cov”Sts
(
objeù
):

263 
def
 
__š™__
(
£lf
, 
cov”age
, 
roÙ
=
NÚe
):

264 
£lf
.
cov”age
 = coverage

265 
roÙ
 
is
 
NÚe
:

266 #Gues 
š™Ÿl
 
d•th
. 
Fes
 
outside
 
this
 
·th
 
wl
 
nÙ
 
be


267 #»achabË 
äom
 
the
 
web
 
š‹rçû
.

268 
impÜt
 
ch”rypy


269 
roÙ
 = 
os
.
·th
.
dœÇme
(
ch”rypy
.
__fe__
)

270 
£lf
.
roÙ
 =„oot

272 
def
 
šdex
(
£lf
):

273  
TEMPLATE_FRAMESET
 % 
£lf
.
roÙ
.
low”
()

274 
šdex
.
expo£d
 = 
True


276 
def
 
m’u
(
£lf
, 
ba£
="/", 
pù
="50", 
showpù
="",

277 
exşude
=
r
'python\d\.\d|test|tut\d|tutorial'):

279 #Th
cov”age
 
moduË
 
u£s
 
®l
-
low”
-
Çmes
.

280 
ba£
 = ba£.
low”
().
r¡r
(
os
.
£p
)

282 
y›ld
 
TEMPLATE_MENU


283 
y›ld
 
TEMPLATE_FORM
 % 
loÿls
()

285 #S¹ 
by
 
showšg
 
lšks
 
·»Á
 
·ths


286 
y›ld
 "<div id='crumbs'>"

287 
·th
 = ""

288 
©oms
 = 
ba£
.
¥l™
(
os
.
£p
)

289 
©oms
.
pİ
()

290 
©om
 
š
 
©oms
:

291 
·th
 +ğ
©om
 + 
os
.
£p


292 
y›ld
 ("<a href='menu?base=%s&exclude=%s'>%s</a> %s"

293 % (
·th
, 
quÙe_¶us
(
exşude
), 
©om
, 
os
.
£p
))

294 
	gy›ld
 "</div>"

296 
	gy›ld
 "<div id='tree'>"

298 #Th’ 
di¥Ïy
 
the
 
Œ“


299 
	gŒ“
 = 
g‘_Œ“
(
ba£
, 
exşude
, 
£lf
.
cov”age
)

300 
nÙ
 
	gŒ“
:

301 
y›ld
 "<p>No modules covered.</p>"

303 
chunk
 
š
 
_show_b¿nch
(
Œ“
, 
ba£
, "/", 
pù
,

304 
showpù
=='checked', 
exşude
, 
cov”age
=
£lf
.coverage):

305 
y›ld
 
chunk


307 
y›ld
 "</div>"

308 
y›ld
 "</body></html>"

309 
m’u
.
expo£d
 = 
True


311 
def
 
ªnÙ©ed_fe
(
£lf
, 
f’ame
, 
¡©em’ts
, 
exşuded
, 
missšg
):

312 
sourû
 = 
İ’
(
f’ame
, 'r')

313 
	gbufãr
 = []

314 
lš’o
, 
lše
 
š
 
’um”©e
(
sourû
.
»adlšes
()):

315 
lš’o
 += 1

316 
lše
 =†še.
¡r
("\n\r")

317 
em±y_the_bufãr
 = 
True


318 
lš’o
 
š
 
exşuded
:

319 
‹m¶©e
 = 
TEMPLATE_LOC_EXCLUDED


320 
–if
 
lš’o
 
š
 
missšg
:

321 
‹m¶©e
 = 
TEMPLATE_LOC_NOT_COVERED


322 
–if
 
lš’o
 
š
 
¡©em’ts
:

323 
‹m¶©e
 = 
TEMPLATE_LOC_COVERED


325 
em±y_the_bufãr
 = 
F®£


326 
bufãr
.
­³nd
((
lš’o
, 
lše
))

327 
	gem±y_the_bufãr
:

328 
Êo
, 
·¡lše
 
š
 
	gbufãr
:

329 
y›ld
 
‹m¶©e
 % (
Êo
, 
	gcgi
.
esÿ³
(
·¡lše
))

330 
	gbufãr
 = []

331 
y›ld
 
‹m¶©e
 % (
lš’o
, 
	gcgi
.
esÿ³
(
lše
))

333 
def
 
»pÜt
(
£lf
, 
Çme
):

334 
f’ame
, 
	g¡©em’ts
, 
	gexşuded
, 
	gmissšg
, 
	g_
 = 
£lf
.
cov”age
.
ª®ysis2
(
Çme
)

335 
pc
 = 
_³rûÁ
(
¡©em’ts
, 
missšg
)

336 
y›ld
 
	gTEMPLATE_COVERAGE
 % 
diù
(
Çme
=
os
.
·th
.
ba£Çme
(name),

337 
fuÎ·th
=
Çme
,

338 
pc
=pc)

339 
y›ld
 '<table>\n'

340 
lše
 
š
 
£lf
.
ªnÙ©ed_fe
(
f’ame
, 
¡©em’ts
, 
exşuded
,

341 
missšg
):

342 
y›ld
 
lše


343 
y›ld
 '</table>'

344 
y›ld
 '</body>'

345 
y›ld
 '</html>'

346 
»pÜt
.
expo£d
 = 
True


349 
def
 
£rve
(
·th
=
loÿlFe
, 
pÜt
=8080, 
roÙ
=
NÚe
):

350 
cov”age
 
is
 
NÚe
:

351 
¿i£
 
ImpÜtE¼Ü
("The coverage module could‚ot be imported.")

352 
äom
 
cov”age
 
impÜt
 coverage

353 
cov
 = 
cov”age
(
d©a_fe
 = 
·th
)

354 
cov
.
lßd
()

356 
impÜt
 
ch”rypy


357 
ch”rypy
.
cÚfig
.
upd©e
({'£rv”.sock‘_pÜt': (
pÜt
),

361 
ch”rypy
.
quick¡¬t
(
Cov”Sts
(
cov
, 
roÙ
))

363 
	g__Çme__
 == "__main__":

364 
£rve
(*
tu¶e
(
sys
.
¬gv
[1:]))

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/lib/cpstats.py

3 
	gOv”v›w


6 
Sti¡ics
 
about
 
´og¿m
 
İ”©iÚ
 
¬e
 
ª
 
šv®uabË
 
mÚ™Üšg
 
ªd
 
debuggšg


7 
toŞ
. 
UnfÜtuÇ‹ly
, 
the
 
g©h”šg
 
ªd
 
»pÜtšg
 
of
 
the£
 
ü™iÿl
 
v®ues
 
is


8 
usu®ly
 
	gad
-
	ghoc
. 
This
 
·ckage
 
aims
 
to
 
add
 
a
 
ûÁ¿lized
 
¶aû
 
g©h”šg


9 
¡©i¡iÿl
 
³rfÜmªû
 
	gd©a
, 
a
 
¡ruùu»
 
»cÜdšg
 
th©
 
d©a
 
which


10 
´ovides
 
exŒ­Ş©iÚ
 
of
 
th©
 
d©a
 
što
 
mÜe
 
u£ful
 
	gšfÜm©iÚ
,

11 
ªd
 
a
 
m‘hod
 
of
 
£rvšg
 
th©
 
d©a
 
to
 
bÙh
 
humª
 
šve¡ig©Üs
‡nd

12 
mÚ™Üšg
 
	gsoáw¬e
. 
	gL‘
'sƒxamineƒach ofhose in more detail.

14 
D©a
 
	gG©h”šg


17 
Ju¡
 
as
 
	gPythÚ
's `logging` module…rovides‡ common importable for gathering

18 
ªd
 
£ndšg
 
	gmes§ges
, 
³rfÜmªû
 
¡©i¡ics
 
would
 
b’ef™
 
äom
 
a
 
sim¬


19 
commÚ
 
	gmechªism
, 
ªd
 
Úe
 
th©
 
dÛs
 *
nÙ
* 
»quœe
 
—ch
 
·ckage
 
which
 
wishes


20 
to
 
cŞËù
 
¡©s
Ø
impÜt
 
a
 
	gthœd
-
·¹y
 
	gmoduË
. 
	gTh”efÜe
, 
we
 
choo£
o

21 
	g»
-
u£
 
	gthe
 `
	gloggšg
` 
moduË
 
by
 
addšg
 
	ga
 `
	g¡©i¡ics
` 
objeù
 
to
 
	g™
.

23 
	gTh©
 `
	gloggšg
.
	g¡©i¡ics
` 
objeù
 
is
 
a
 
Ã¡ed
 
	gdiù
. 
It
 i 
nÙ
‡ 
cu¡om
 
	gşass
,

24 
beÿu£
 
th©
 
	gwould
 1è
»quœe
 
lib¿r›s
 
ªd
 
­¶iÿtiÚs
 
to
 
impÜt
 
a
 
	gthœd
-

25 
·¹y
 
moduË
 
š
 
Üd”
 
to
 
	g·¹ic©e
, 2è
šhib™
 
šnov©iÚ
 iÀ
exŒ­Ş©iÚ


26 
­´ßches
 
ªd
 
š
 
»pÜtšg
 
	gtoŞs
, 
	gªd
 3è
be
 
	g¦ow
. 
Th”e
 
	g¬e
, 
	ghowev”
, 
some


27 
¥ecifiÿtiÚs
 
»g¬dšg
 
the
 
¡ruùu»
 
of
h
	gdiù
.

33 | 
Ïmbda
 
s
: s["In£¹s"] / (
time
() - s["Start"]),

34 | 
	gC
 +---"Table Statistics": {

35 | 
o
 | "widgets": {-----------+

36 
N
 | 
l
 | "Rows": 1.3
M
, | 
RecÜd


37 
	ga
 | 
	gl
 | "Inserts": 400, |

38 
	gm
 | 
	ge
 | },---------------------+

39 
	ge
 | 
	gc
 | "froobles": {

40 
s
 | 
t
 | "Rows": 7845,

41 
	gp
 | 
	gi
 | "Inserts": 0,

42 
	ga
 | 
	go
 | },

43 
	gc
 | 
	gn
 +---},

44 
	ge
 | "Slow Queries":

52 
	gThe
 `
	gloggšg
.
	g¡©i¡ics
` 
diù
 
has
 
four
 
	gËv–s
. 
The
 
tİmo¡
 
Ëv–
 
is
 
nÙhšg


53 
mÜe
 
thª
 
a
 
£t
 
of
 
Çmes
 
to
 
šŒoduû
 
	gmoduÏr™y
, 
usu®ly
 
®Úg
 
the
 
lšes
 of

54 
·ckage
 
	gÇmes
. 
If
 
the
 
SQLAlchemy
 
´ojeù
 
wª‹d
 
to
 
	g·¹ic©e
, 
	gexam¶e
,

55 
™
 
might
 
pİuÏ‹
 
the
 
	g™em
 `
	gloggšg
.
	g¡©i¡ics
['SQLAlchemy']`, 
who£
 
v®ue


56 
would
 
be
 
a
 
	g£cÚd
-
Ïy”
 
diù
 
we
 
ÿÎ
 
	ga
 "Çme¥aû". 
Name¥aûs
 
h–p
 
muÉË


57 
·ckages
 
to
 
avoid
 
cŞlisiÚs
 
ov”
 
key
 
	gÇmes
, 
ªd
 
make
 
»pÜts
 
—s›r
Ø
	g»ad
,

58 
to
 
	gboÙ
. 
The
 
mašš”s
 
of
 
SQLAlchemy
 
should
 
ã–
 
ä“
Ø
u£
 
mÜe
 
thª
 
Úe


59 
Çme¥aû
 
Ãeded
 (
such
 
as
 'SQLAlchemy ORM'). 
NÙe
 
th©
 
th”e
 
¬e
 
no
 

60 
Ü
 
Ùh”
 
syÁax
 
cÚ¡¿šts
 
Ú
 
the
 
Çme¥aû
 
	gÇmes
; 
they
 
should
 
be
 
cho£n


61 
to
 
be
 
maxim®ly
 
»adabË
 
by
 
humªs
 (
Ã™h”
 
too
 
nÜ
oo ).

63 
Each
 
	gÇme¥aû
, 
	gth’
, 
is
 
a
 
diù
 
of
 
Çmed
 
¡©i¡iÿl
 
	gv®ues
, 
such
 
	gas


64 'Reque¡s/£c' 
	gÜ
 'U±ime'. 
You
 
should
 
choo£
 
Çmes
 
which
 
wl
 
look


65 
good
 
Ú
 
a
 
	g»pÜt
: 
¥aûs
 
ªd
 
ÿp™®iz©iÚ
 
¬e
 
ju¡
 
fše
.

67 
In
 
add™iÚ
 
to
 
sÿÏrs
, 
v®ues
 
š
 
a
 
Çme¥aû
 
MAY
 
be
‡ (
thœd
-
Ïy”
)

68 
	gdiù
, 
Ü
 
a
 
	gli¡
, 
ÿÎed
 
	ga
 "cŞËùiÚ". 
FÜ
 
	gexam¶e
, 
the
 
Ch”ryPy
 
StsToŞ


69 
k“ps
 
Œack
 
of
 
wh©
 
—ch
 
»que¡
 
is
 
	$došg
 (
Ü
 
has
 
mo¡
 
»ûÁly
 
dÚe
)

70 
š
 
a
 'Reque¡s' 
cŞËùiÚ
, 
wh”e
 
—ch
 
key
 
is
‡ 
th»ad
 
ID
;ƒach

71 
v®ue
 
š
 
the
 
subdiù
 
MUST
 
be
 
a
 
fou¹h
 
	`diù
 (
whew
!è
of
 
¡©i¡iÿl
 
d©a
 
about


72 
—ch
 
th»ad
. 
We
 
ÿÎ
ƒach 
subdiù
 
š
 
the
 
cŞËùiÚ
 
a
 "»cÜd". 
Sim¬ly
,

73 
the
 
StsToŞ
 
®so
 
k“ps
 
a
 
li¡
 
of
 
¦ow
 
qu”›s
, 
wh”e
 
—ch
 
»cÜd
 
cÚšs


74 
d©a
 
about
 
—ch
 
¦ow
 
qu”y
, 
š
 
Üd”
.

76 
V®ues
 
š
 
a
 
Çme¥aû
 
Ü
 
»cÜd
 
may
 
®so
 
be
 
funùiÚs
, 
which
 
bršgs
 
us
 
to
:

78 
ExŒ­Ş©iÚ


81 
The
 
cŞËùiÚ
 
of
 
¡©i¡iÿl
 
d©a
 
Ãeds
 
to
 
be
 
ç¡
, 
as
 
şo£
Ø
uÂÙiûabË


82 
as
 
possibË
 
to
 
the
 
ho¡
 
´og¿m
. 
Th©
 
»quœes
 
us
Ø
mšimize
 
I
/
O
, 
exam¶e
,

83 
but
 
š
 
PythÚ
 
™
 
®so
 
m—ns
 
we
 
Ãed
 
to
 
mšimize
 
funùiÚ
 
ÿÎs
. 
So
 
wh’
 
you


84 
¬e
 
designšg
 
your
 
Çme¥aû
 
ªd
 
»cÜd
 
v®ues
, 
Œy
 
to
 
š£¹
 
the
 
mo¡
 
basic


85 
sÿÏr
 
v®ues
 
you
 
®»ady
 
have
 
Ú
 
hªd
.

87 
Wh’
 
™
 
comes
 
time
 
to
 
»pÜt
 
Ú
 
the
 
g©h”ed
 
d©a
, 
howev”
, 
we
 
usu®ly
 
have


88 
much
 
mÜe
 
ä“dom
 
š
 
wh©
 
we
 
ÿn
 
ÿlcuÏ‹
. 
Th”efÜe
, 
wh’ev”
 
»pÜtšg


89 
	$toŞs
 (
like
 
the
 
´ovided
 
StsPage
 
Ch”ryPy
 
şass
è
ãtch
h
cÚ‹Ás
 
of


90 `
loggšg
.
¡©i¡ics
` 
»pÜtšg
, 
they
 
fœ¡
 
ÿÎ
 `
exŒ­Ş©e_¡©i¡ics
`

91 (
·ssšg
 
the
 
whŞe
 `
¡©i¡ics
` 
diù
 
as
h
Úly
 
¬gum’t
). 
This
 
makes
 
a


92 
d“p
 
cİy
 
of
 
the
 
¡©i¡ics
 
diù
 
so
 
th©
h
»pÜtšg
 
toŞ
 
ÿn
 
bÙh
 
™”©e


93 
ov”
 
™
 
ªd
 
ev’
 
chªge
 iˆ
w™hout
 
h¬mšg
 
the
 
Üigš®
. 
But
 iˆ
®so
 
ex·nds


94 
ªy
 
funùiÚs
 
š
 
the
 
diù
 
by
 
ÿÎšg
 
them
. 
FÜ
 
exam¶e
, 
you
 
might
 
have
 
a


95 'Cu¼’ˆTime' 
’Œy
 
š
 
the
 
Çme¥aû
 
w™h
h
v®ue
 "lambda scope:ime.time()".

96 
The
 "scİe" 
·¿m‘”
 
is
 
the
 
cu¼’t
 
Çme¥aû
 
	`diù
 (
Ü
 
»cÜd
, 
we
're

97 
cu¼’y
 
ex·ndšg
 
Úe
 
of
 
tho£
 
š¡—d
), 
®lowšg
 
you
 
acûss
 
to
 
exi¡šg


98 
’Œ›s
. 
If
 
you
'rerulyƒvil, you canƒven modify morehan oneƒntry

99 
©
 
a
 
time
.

101 
Howev”
, 
dÚ
'tryo calculate‡nƒntry‡ndhen use its value in further

102 
exŒ­Ş©iÚs
; 
the
 
Üd”
 
š
 
which
h
funùiÚs
 
¬e
 
ÿÎed
 
is
 
nÙ
 
gu¬ª‹ed
.

103 
This
 
ÿn
 
Ëad
 
to
 
a
 
û¹aš
 
amouÁ
 
of
 
du¶iÿ‹d
 
	`wÜk
 (
Ü
‡ 
»design
 oà
your


104 
schema
), 
but
 
th©
's betterhan complicatinghe spec.

106 
Aá”
 
the
 
whŞe
 
thšg
 
has
 
b“n
 
exŒ­Ş©ed
, 
™
'sime for:

108 
R•Ütšg


111 
The
 
StsPage
 
şass
 
g¿bs
 
the
 `
loggšg
.
¡©i¡ics
` 
diù
, 
exŒ­Ş©es
 
™
 
®l
,

112 
ªd
 
th’
 
ŒªsfÜms
 
™
 
to
 
HTML
 
—sy
 
v›wšg
. 
Each
 
Çme¥aû
 
g‘s
 
™s
 
own


113 
h—d”
 
ªd
 
©Œibu‹
 
bË
, 
¶us
 
ª
 
exŒa
abË 
—ch
 
cŞËùiÚ
. 
This
 
is


114 
NOT
 
·¹
 
of
 
the
 
¡©i¡ics
 
¥ecifiÿtiÚ
; 
Ùh”
 
toŞs
 
ÿn
 
fÜm©
 
how
 
they
 
like
.

116 
You
 
ÿn
 
cÚŒŞ
 
which
 
cŞumns
 
¬e
 
ouut
 
ªd
 
how
 
they
‡» 
fÜm©‹d
 
by
 
upd©šg


117 
StsPage
.
fÜm©tšg
, 
which
 
is
 
a
 
diù
 
th©
 
mœrÜs
 
the
 
keys
 
ªd
 
Ã¡šg
 
of


118 `
loggšg
.
¡©i¡ics
`. 
The
 
difã»nû
 
is
 
th©
, 
š¡—d
 
of
 
d©a
 
v®ues
, 
™
 
has


119 
fÜm©tšg
 
v®ues
. 
U£
 
NÚe
 
a
 
giv’
 
key
 
to
 
šdiÿ‹
Ø
the
 
StsPage
 
th©
‡

120 
giv’
 
cŞumn
 
should
 
nÙ
 
be
 
ouut
. 
U£
 
a
 
¡ršg
 
w™h
 
	`fÜm©tšg
 (
such
 
as
 '%.3f')

121 
to
 
š‹½Ş©e
 
the
 
	`v®ue
(
s
), 
Ü
 
u£
 
a
 
	`ÿÎabË
 (
such
 
as
 
Ïmbda
 
v
: v.
	$isofÜm©
())

122 
mÜe
 
advªûd
 
fÜm©tšg
. 
Any
 
’Œy
 
which
 
is
 
nÙ
 
m’tiÚed
 
š
 
the
 formatting

123 
diù
 
is
 
ouut
 
unchªged
.

125 
MÚ™Üšg


128 
AÉhough
 
the
 
HTML
 
ouut
 
kes
 
·šs
 
to
 
assign
 
unique
 
id
'soƒach <td> with

129 
¡©i¡iÿl
 
d©a
, 
you
're…robably better off fetching /cpstats/data, which

130 
ouuts
 
the
 
	`whŞe
 (
exŒ­Ş©ed
è`
loggšg
.
¡©i¡ics
` 
diù
 
š
 
JSON
 
fÜm©
.

131 
Th©
 
is
 
´obably
 
—s›r
 
to
 
·r£
, 
ªd
 
dÛ¢
't have‡ny formatting controls,

132 
so
 
you
 
g‘
 
the
 "Üigš®" 
d©a
 
š
 
a
 
cÚsi¡’y
-
£rŸlized
 
fÜm©
.

133 
NÙe
: 
th”e
's‚oreatment yet for datetime objects. Tryime.time() instead

134 
now
 
you
 
ÿn
. 
Nagios
 
wl
 
´obably
 
thªk
 you.

136 
Tuºšg
 
CŞËùiÚ
 
Off


139 
It
 
is
 
»comm’ded
 
—ch
 
Çme¥aû
 
have
 
ª
 "EÇbËd" 
™em
 
which
, 
F®£
,

140 
¡İs
 
	$cŞËùiÚ
 (
but
 
nÙ
 
»pÜtšg
è
of
 
¡©i¡iÿl
 
d©a
. 
AµliÿtiÚs


141 
SHOULD
 
´ovide
 
cÚŒŞs
 
to
 
·u£
 
ªd
 
»sume
 
cŞËùiÚ
 
by
 
£‰šg
 
the£


142 
’Œ›s
 
to
 
F®£
 
Ü
 
True
, 
´e£Á
.

145 
U§ge


148 
To
 
cŞËù
 
¡©i¡ics
 
Ú
 
Ch”ryPy
 
­¶iÿtiÚs
:

150 
äom
 
ch”rypy
.
lib
 
impÜt
 
ı¡©s


151 
­pcÚfig
['/']['toŞs.ı¡©s.Ú'] = 
True


153 
To
 
cŞËù
 
¡©i¡ics
 
Ú
 
your
 
own
 
code
:

155 
impÜt
 
loggšg


156 #In™Ÿliz
the
 
»pos™Üy


157 
nÙ
 
	`ha§‰r
(
loggšg
, '¡©i¡ics'):†oggšg.
¡©i¡ics
 = {
	}
}

158 #In™Ÿliz
my
 
Çme¥aû


159 
my¡©s
 = 
loggšg
.
¡©i¡ics
.
£tdeçuÉ
('My Stuff', {})

160 #In™Ÿliz
my
 
Çme¥aû
's scalars‡nd collections

161 
	gmy¡©s
.
upd©e
({

162 'EÇbËd': 
True
,

163 'S¹ Time': 
time
.time(),

165 'Ev’ts/SecÚd': 
Ïmbda
 
s
: (

166 (
s
['ImpÜÁ Ev’ts'] / (
time
.time() - s['Start Time']))),

169 
ev’t
 
š
 
	gev’ts
:

171 #CŞËù 
¡©s


172 
my¡©s
.
g‘
('EÇbËd', 
F®£
):

173 
my¡©s
['Important Events'] += 1

175 
To
 
»pÜt
 
¡©i¡ics
:

177 
roÙ
.
ı¡©s
 = cp¡©s.
	$StsPage
()

179 
To
 
fÜm©
 
¡©i¡ics
 
»pÜts
:

181 
S“
 'R•Ütšg', 
above
.

185 #-------------------------------- 
Sti¡ics
 -------------------------------- #


186 
impÜt
 
loggšg


187 
nÙ
 
	`ha§‰r
(
loggšg
, '¡©i¡ics'):†oggšg.
¡©i¡ics
 = {
	}
}

189 
def
 
	$exŒ­Ş©e_¡©i¡ics
(
scİe
):

191 
c
 = {
	}
}

192 
k
, 
v
 
š
 
li¡
(
scİe
.
	$™ems
()):

193 
	$isš¡ªû
(
v
, 
diù
):

194 
v
 = 
	$exŒ­Ş©e_¡©i¡ics
(
v
)

195 
–if
 
	`isš¡ªû
(
v
, (
li¡
, 
tu¶e
)):

196 
v
 = [
	$exŒ­Ş©e_¡©i¡ics
(
»cÜd
è»cÜd 
š
 
v
]

197 
–if
 
	`ha§‰r
(
v
, '__call__'):

198 
v
 = 
	$v
(
scİe
)

199 
c
[
k
] = 
v


200  
c


203 #--------------------- 
Ch”ryPy
 
AµliÿtiÚs
 
Sti¡ics
 --------------------- #


204 
impÜt
 
th»adšg


205 
impÜt
 
time


207 
impÜt
 
ch”rypy


209 
­p¡©s
 = 
loggšg
.
¡©i¡ics
.
	`£tdeçuÉ
('Ch”ryPy AµliÿtiÚs', {
	}
})

210 
	g­p¡©s
.
upd©e
({

211 'EÇbËd': 
True
,

212 'By‹ R—d/Reque¡': 
Ïmbda
 
s
: (s['TÙ® Reque¡s'] 
ªd


213 (
s
['TÙ® By‹ R—d'] / (s['TÙ® Reque¡s'])è
Ü
 0.0),

214 'By‹ R—d/SecÚd': 
Ïmbda
 
s
: s['Total Bytes Read'] / s['Uptime'](s),

215 'By‹ Wr™‹n/Reque¡': 
Ïmbda
 
s
: (s['TÙ® Reque¡s'] 
ªd


216 (
s
['TÙ® By‹ Wr™‹n'] / (s['TÙ® Reque¡s'])è
Ü
 0.0),

217 'By‹ Wr™‹n/SecÚd': 
Ïmbda
 
s
: s['Total Bytes Written'] / s['Uptime'](s),

218 'Cu¼’ˆTime': 
Ïmbda
 
s
: 
time
.time(),

220 'Reque¡s/SecÚd': 
Ïmbda
 
s
: (s['Total Requests']) / s['Uptime'](s),

221 'S”v” V”siÚ': 
ch”rypy
.
__v”siÚ__
,

222 'S¹ Time': 
time
.time(),

227 'U±ime': 
Ïmbda
 
s
: 
time
.time() - s['Start Time'],

231 
	g´oc_time
 = 
Ïmbda
 
s
: 
time
.time() - s['Start Time']

234 
şass
 
	$By‹CouÁW¿µ”
(
objeù
):

237 
def
 
	$__š™__
(
£lf
, 
rfe
):

238 
£lf
.
rfe
 =„file

239 
£lf
.
by‹s_»ad
 = 0

241 
def
 
	`»ad
(
£lf
, 
size
=-1):

242 
d©a
 = 
£lf
.
rfe
.
	$»ad
(
size
)

243 
£lf
.
by‹s_»ad
 +ğ
	$Ën
(
d©a
)

244  
d©a


246 
def
 
	`»adlše
(
£lf
, 
size
=-1):

247 
d©a
 = 
£lf
.
rfe
.
	$»adlše
(
size
)

248 
£lf
.
by‹s_»ad
 +ğ
	$Ën
(
d©a
)

249  
d©a


251 
def
 
	$»adlšes
(
£lf
, 
sizehšt
=0):

252 #Sham–es¦y 
¡Ş’
 
äom
 
SŒšgIO


253 
tÙ®
 = 0

254 
lšes
 = []

255 
lše
 = 
£lf
.
	$»adlše
()

256 
lše
:

257 
lšes
.
	$­³nd
(
lše
)

258 
tÙ®
 +ğ
	$Ën
(
lše
)

259 0 < 
sizehšt
 <ğ
tÙ®
:

261 
lše
 = 
£lf
.
	$»adlše
()

262  
lšes


264 
def
 
	$şo£
(
£lf
):

265 
£lf
.
rfe
.
	$şo£
()

267 
def
 
	$__™”__
(
£lf
):

268  
£lf


270 
def
 
	$Ãxt
(
£lf
):

271 
d©a
 = 
£lf
.
rfe
.
	$Ãxt
()

272 
£lf
.
by‹s_»ad
 +ğ
	$Ën
(
d©a
)

273  
d©a


276 
av”age_uri£t_time
 = 
Ïmbda
 
s
: s['CouÁ'] 
	`ªd
 (s['Sum'] / s['CouÁ']è
Ü
 0

279 
şass
 
	$StsToŞ
(
ch”rypy
.
ToŞ
):

282 
def
 
	$__š™__
(
£lf
):

283 
ch”rypy
.
ToŞ
.
	`__š™__
(
£lf
, 'Ú_’d_»que¡', s–f.
»cÜd_¡İ
)

285 
def
 
	$_£tup
(
£lf
):

288 
The
 
¡ªd¬d
 
Ch”ryPy
 
»que¡
 
objeù
 
wl
 
autom©iÿÎy
 
ÿÎ
 
this


289 
m‘hod
 
wh’
 
the
 
toŞ
 
is
 "tuºed on" 
š
 
cÚfig
.

291 
­p¡©s
.
	`g‘
('EÇbËd', 
F®£
):

292 
ch”rypy
.
ToŞ
.
	$_£tup
(
£lf
)

293 
£lf
.
	$»cÜd_¡¬t
()

295 
def
 
	$»cÜd_¡¬t
(
£lf
):

297 
»que¡
 = 
ch”rypy
.
£rvšg
.request

298 
nÙ
 
	`ha§‰r
(
»que¡
.
rfe
, 'bytes_read'):

299 
»que¡
.
rfe
 = 
	$By‹CouÁW¿µ”
(
»que¡
.
rfe
)

300 
»que¡
.
body
.
å
 =„eque¡.
rfe


302 
r
 = 
»que¡
.
»mÙe


304 
­p¡©s
['Current Requests'] += 1

305 
­p¡©s
['Total Requests'] += 1

306 
­p¡©s
['Reque¡s'][
th»adšg
.
	`_g‘_id’t
()] = {

307 'By‹ R—d': 
NÚe
,

308 'By‹ Wr™‹n': 
NÚe
,

309 #U£ 
a
 
Ïmbda
 
so
 
the
 

 
g‘s
 
upd©ed
 
by
 
toŞs
.
´oxy
 
Ï‹r


310 'Cl›Á': 
Ïmbda
 
s
: '%s:%s' % (
r
.

,„.
pÜt
),

311 'End Time': 
NÚe
,

312 'Proûssšg Time': 
´oc_time
,

313 'Reque¡-Lše': 
»que¡
.
»que¡_lše
,

314 'Re¥Ú£ Stus': 
NÚe
,

315 'S¹ Time': 
time
.
	`time
(),

316 
	}
}

318 
def
 
	$»cÜd_¡İ
(
£lf
, 
uri£t
=
NÚe
, 
¦ow_qu”›s
=1.0, 
¦ow_qu”›s_couÁ
=100,

319 
debug
=
F®£
, **
kw¬gs
):

321 
»¥
 = 
ch”rypy
.
£rvšg
.
»¥Ú£


322 
w
 = 
­p¡©s
['Reque¡s'][
th»adšg
.
	`_g‘_id’t
()]

324 
r
 = 
ch”rypy
.
»que¡
.
rfe
.
by‹s_»ad


325 
w
['By‹ R—d'] = 
r


326 
­p¡©s
['TÙ® By‹ R—d'] +ğ
r


328 
»¥
.
¡»am
:

329 
w
['Bytes Written'] = 'chunked'

331 
ş
 = (
»¥
.
h—d”s
.
	`g‘
('Content-Length', 0))

332 
w
['By‹ Wr™‹n'] = 
ş


333 
­p¡©s
['TÙ® By‹ Wr™‹n'] +ğ
ş


335 
w
['Re¥Ú£ Stus'] = 
	`g‘©Œ
(
»¥
, 'ouut_¡©us', 
NÚe
è
Ü
„e¥.
¡©us


337 
w
['End Time'] = 
time
.
	$time
()

338 
p
 = 
w
['End Time'] - w['Start Time']

339 
w
['Proûssšg Time'] = 
p


340 
­p¡©s
['TÙ® Time'] +ğ
p


342 
­p¡©s
['Current Requests'] -= 1

344 
debug
:

345 
ch”rypy
.
	`log
('St »cÜded: %s' % 
	`»´
(
w
), 'TOOLS.CPSTATS')

347 
uri£t
:

348 
rs
 = 
­p¡©s
.
	`£tdeçuÉ
('URI S‘ T¿ckšg', {
	}
})

349 
	gr
 = 
rs
.
£tdeçuÉ
(
uri£t
, {

350 'Mš': 
NÚe
, 'Max': None, 'Count': 0, 'Sum': 0,

351 'Avg': 
av”age_uri£t_time
})

352 
r
['Mš'] 
is
 
NÚe
 
Ü
 
p
 <„['Min']:

353 
r
['Mš'] = 
p


354 
r
['Max'] 
is
 
NÚe
 
Ü
 
p
 >„['Max']:

355 
r
['Max'] = 
p


356 
r
['Count'] += 1

357 
r
['Sum'] +ğ
p


359 
¦ow_qu”›s
 
ªd
 
p
 > slow_queries:

360 
sq
 = 
­p¡©s
.
£tdeçuÉ
('Slow Queries', [])

361 
	gsq
.
­³nd
(
w
.
	$cİy
())

362 
	`Ën
(
sq
è> 
¦ow_qu”›s_couÁ
:

363 
sq
.
	$pİ
(0)

366 
impÜt
 
ch”rypy


367 
ch”rypy
.
toŞs
.
ı¡©s
 = 
	$StsToŞ
()

370 #---------------------- 
Ch”ryPy
 
Sti¡ics
 
R•Ütšg
 ---------------------- #


371 
impÜt
 
os


372 
thisdœ
 = 
os
.
·th
.
	`ab¥©h
(os.·th.
	$dœÇme
(
__fe__
))

374 
Œy
:

375 
impÜt
 
jsÚ


376 
exû±
 
ImpÜtE¼Ü
:

377 
Œy
:

378 
impÜt
 
sim¶ejsÚ
 
as
 
jsÚ


379 
exû±
 
ImpÜtE¼Ü
:

380 
jsÚ
 = 
NÚe


383 
missšg
 = 
	$objeù
()

385 
loÿË_d©e
 = 
Ïmbda
 
v
: 
time
.
	`¡ráime
('%c',ime.
	$gmtime
(
v
))

386 
iso_fÜm©
 = 
Ïmbda
 
v
: 
time
.
	`¡ráime
('%Y-%m-%d %H:%M:%S',ime.
	$gmtime
(
v
))

388 
def
 
	$·u£_»sume
(
ns
):

389 
def
 
	$_·u£_»sume
(
’abËd
):

390 
·u£_di§bËd
 = ''

391 
»sume_di§bËd
 = ''

392 
’abËd
:

393 
»sume_di§bËd
 = 'disabled="disabled" '

395 
·u£_di§bËd
 = 'disabled="disabled" '

397 <
fÜm
 
aùiÚ
="·u£" 
m‘hod
="POST" 
¡yË
="display:inline">

398 <
šput
 
ty³
="hidd’" 
Çme
="Çme¥aû" 
v®ue
="%s" />

399 <
šput
 
ty³
="subm™" 
v®ue
="Pau£" %
s
/>

400 </
fÜm
>

401 <
fÜm
 
aùiÚ
="»sume" 
m‘hod
="POST" 
¡yË
="display:inline">

402 <
šput
 
ty³
="hidd’" 
Çme
="Çme¥aû" 
v®ue
="%s" />

403 <
šput
 
ty³
="subm™" 
v®ue
="Resume" %
s
/>

404 </
fÜm
>

406  
_·u£_»sume


409 
şass
 
	$StsPage
(
objeù
):

411 
fÜm©tšg
 = {

413 'EÇbËd': 
	`·u£_»sume
('CherryPy Applications'),

418 'Cu¼’ˆTime': 
iso_fÜm©
,

420 'S¹ Time': 
iso_fÜm©
,

424 'End Time': 
NÚe
,

426 'S¹ Time': 
iso_fÜm©
,

437 'End Time': 
NÚe
,

439 'S¹ Time': 
NÚe
,

443 'EÇbËd': 
	`·u£_»sume
('CherryPy WSGIServer'),

445 'S¹ime': 
iso_fÜm©
,

447 
	}
}

450 
def
 
	$šdex
(
£lf
):

451 #T¿nsfÜm 
the
 
¿w
 
d©a
 
što
 
´‘ty
 
ouut
 
HTML


452 
y›ld
 """

453 <
html
>

454 <
h—d
>

455 <
t™Ë
>
Sti¡ics
</title>

456 <
¡yË
>

458 
th
, 
td
 {

459 
·ddšg
: 0.25e
m
 0.5em;

460 
bÜd”
: 1
px
 
sŞid
 #666699;

461 
	}
}

463 
	gbË
 {

464 
	gbÜd”
-
	gcŞÏp£
: 
cŞÏp£
;

467 
	gbË
.
	g¡©s1
 {

468 
	gwidth
: 100%;

471 
	gbË
.
¡©s1
 
	gth
 {

472 
	gfÚt
-
	gweight
: 
bŞd
;

473 
	g‹xt
-
	g®ign
: 
right
;

474 
	gbackground
-
	gcŞÜ
: #CCD5DD;

477 
	gbË
.
	g¡©s2
, 
	gh2
 {

478 
	gm¬gš
-
	gËá
: 50
px
;

481 
	gbË
.
¡©s2
 
	gth
 {

482 
	gfÚt
-
	gweight
: 
bŞd
;

483 
	g‹xt
-
	g®ign
: 
ûÁ”
;

484 
	gbackground
-
	gcŞÜ
: #CCD5DD;

487 </
	g¡yË
>

488 </
	gh—d
>

489 <
	gbody
>

491 
	gt™Ë
, 
	gsÿÏrs
, 
cŞËùiÚs
 
š
 
	g£lf
.
	$g‘_Çme¥aûs
():

492 
y›ld
 """

493 <
h1
>%
s
</h1>

495 <
bË
 
şass
='stats1'>

496 <
tbody
>

498 
i
, (
key
, 
v®ue
è
š
 
	$’um”©e
(
sÿÏrs
):

499 
cŞnum
 = 
i
 % 3

500 
cŞnum
 =ğ0: 
y›ld
 """

501 <
Œ
>"""

502 
y›ld
 """

503 <
th
>%(
key
)
s
</th><
td
 
id
='%Ñ™Ë)s-%(key)s'>%(
v®ue
)s</td>""" % vars()

504 
cŞnum
 =ğ2: 
y›ld
 """

505 </
Œ
>"""

507 
cŞnum
 =ğ0: 
y›ld
 """

508 <
th
></th><
td
></td>

509 <
th
></th><
td
></td>

510 </
Œ
>"""

511 
–if
 
cŞnum
 =ğ1: 
y›ld
 """

512 <
th
></th><
td
></td>

513 </
Œ
>"""

514 
y›ld
 """

515 </
tbody
>

516 </
bË
>"""

518 
subt™Ë
, 
h—d”s
, 
subrows
 
š
 
cŞËùiÚs
:

519 
y›ld
 """

520 <
h2
>%
s
</h2>

521 <
bË
 
şass
='stats2'>

522 <
th—d
>

523 <
Œ
>""" % subtitle

524 
key
 
š
 
h—d”s
:

525 
y›ld
 """

526 <
th
>%
s
</th>""" % key

527 
y›ld
 """

528 </
Œ
>

529 </
th—d
>

530 <
tbody
>"""

531 
subrow
 
š
 
subrows
:

532 
y›ld
 """

533 <
Œ
>"""

534 
v®ue
 
š
 
subrow
:

535 
y›ld
 """

536 <
td
>%
s
</td>""" % value

537 
y›ld
 """

538 </
Œ
>"""

539 
y›ld
 """

540 </
tbody
>

541 </
bË
>"""

542 
y›ld
 """

543 </
body
>

544 </
html
>

546 
šdex
.
expo£d
 = 
True


548 
def
 
	$g‘_Çme¥aûs
(
£lf
):

550 
s
 = 
	$exŒ­Ş©e_¡©i¡ics
(
loggšg
.
¡©i¡ics
)

551 
t™Ë
, 
ns
 
š
 
	`sÜ‹d
(
s
.
	$™ems
()):

552 
sÿÏrs
 = []

553 
cŞËùiÚs
 = []

554 
ns_fmt
 = 
£lf
.
fÜm©tšg
.
	`g‘
(
t™Ë
, {
	}
})

555 
	gk
, 
v
 
š
 
sÜ‹d
(
ns
.
	$™ems
()):

556 
fmt
 = 
ns_fmt
.
	`g‘
(
k
, {
	}
})

557 
	$isš¡ªû
(
v
, 
diù
):

558 
h—d”s
, 
subrows
 = 
£lf
.
	$g‘_diù_cŞËùiÚ
(
v
, 
fmt
)

559 
cŞËùiÚs
.
	`­³nd
((
k
, ['ID'] + 
h—d”s
, 
subrows
))

560 
–if
 
	`isš¡ªû
(
v
, (
li¡
, 
tu¶e
)):

561 
h—d”s
, 
subrows
 = 
£lf
.
	$g‘_li¡_cŞËùiÚ
(
v
, 
fmt
)

562 
cŞËùiÚs
.
	`­³nd
((
k
, 
h—d”s
, 
subrows
))

564 
fÜm©
 = 
ns_fmt
.
	$g‘
(
k
, 
missšg
)

565 
fÜm©
 
is
 
NÚe
:

568 
	`ha§‰r
(
fÜm©
, '__call__'):

569 
v
 = 
	$fÜm©
(
v
)

570 
–if
 
fÜm©
 
is
 
nÙ
 
missšg
:

571 
v
 = 
fÜm©
 % v

572 
sÿÏrs
.
	`­³nd
((
k
, 
v
))

573 
y›ld
 
t™Ë
, 
sÿÏrs
, 
cŞËùiÚs


575 
def
 
	$g‘_diù_cŞËùiÚ
(
£lf
, 
v
, 
fÜm©tšg
):

577 #E.
g
., 
the
 'Reque¡s' 
diù
.

578 
h—d”s
 = []

579 
»cÜd
 
š
 
v
.
	$™”v®ues
():

580 
k3
 
š
 
»cÜd
:

581 
fÜm©
 = 
fÜm©tšg
.
	$g‘
(
k3
, 
missšg
)

582 
fÜm©
 
is
 
NÚe
:

585 
k3
 
nÙ
 
š
 
h—d”s
:

586 
h—d”s
.
	$­³nd
(
k3
)

587 
h—d”s
.
	$sÜt
()

589 
subrows
 = []

590 
k2
, 
»cÜd
 
š
 
	`sÜ‹d
(
v
.
	$™ems
()):

591 
subrow
 = [
k2
]

592 
k3
 
š
 
h—d”s
:

593 
v3
 = 
»cÜd
.
	`g‘
(
k3
, '')

594 
fÜm©
 = 
fÜm©tšg
.
	$g‘
(
k3
, 
missšg
)

595 
fÜm©
 
is
 
NÚe
:

598 
	`ha§‰r
(
fÜm©
, '__call__'):

599 
v3
 = 
	$fÜm©
(
v3
)

600 
–if
 
fÜm©
 
is
 
nÙ
 
missšg
:

601 
v3
 = 
fÜm©
 % v3

602 
subrow
.
	$­³nd
(
v3
)

603 
subrows
.
	$­³nd
(
subrow
)

605  
h—d”s
, 
subrows


607 
def
 
	$g‘_li¡_cŞËùiÚ
(
£lf
, 
v
, 
fÜm©tšg
):

609 #E.
g
., 
the
 'Slow Qu”›s' 
li¡
.

610 
h—d”s
 = []

611 
»cÜd
 
š
 
v
:

612 
k3
 
š
 
»cÜd
:

613 
fÜm©
 = 
fÜm©tšg
.
	$g‘
(
k3
, 
missšg
)

614 
fÜm©
 
is
 
NÚe
:

617 
k3
 
nÙ
 
š
 
h—d”s
:

618 
h—d”s
.
	$­³nd
(
k3
)

619 
h—d”s
.
	$sÜt
()

621 
subrows
 = []

622 
»cÜd
 
š
 
v
:

623 
subrow
 = []

624 
k3
 
š
 
h—d”s
:

625 
v3
 = 
»cÜd
.
	`g‘
(
k3
, '')

626 
fÜm©
 = 
fÜm©tšg
.
	$g‘
(
k3
, 
missšg
)

627 
fÜm©
 
is
 
NÚe
:

630 
	`ha§‰r
(
fÜm©
, '__call__'):

631 
v3
 = 
	$fÜm©
(
v3
)

632 
–if
 
fÜm©
 
is
 
nÙ
 
missšg
:

633 
v3
 = 
fÜm©
 % v3

634 
subrow
.
	$­³nd
(
v3
)

635 
subrows
.
	$­³nd
(
subrow
)

637  
h—d”s
, 
subrows


639 
jsÚ
 
is
 
nÙ
 
NÚe
:

640 
def
 
	$d©a
(
£lf
):

641 
s
 = 
	$exŒ­Ş©e_¡©i¡ics
(
loggšg
.
¡©i¡ics
)

642 
ch”rypy
.
»¥Ú£
.
h—d”s
['Content-Type'] = 'application/json'

643  
jsÚ
.
	$dumps
(
s
, 
sÜt_keys
=
True
, 
šd’t
=4)

644 
d©a
.
expo£d
 = 
True


646 
def
 
	$·u£
(
£lf
, 
Çme¥aû
):

647 
loggšg
.
¡©i¡ics
.
	`g‘
(
Çme¥aû
, {
	}
})['EÇbËd'] = 
F®£


648 
¿i£
 
ch”rypy
.
HTTPRedœeù
('./')

649 
·u£
.
expo£d
 = 
True


650 
·u£
.
ı_cÚfig
 = {'toŞs.®low.Ú': 
True
,

653 
def
 
	$»sume
(
£lf
, 
Çme¥aû
):

654 
loggšg
.
¡©i¡ics
.
	`g‘
(
Çme¥aû
, {
	}
})['EÇbËd'] = 
True


655 
¿i£
 
ch”rypy
.
HTTPRedœeù
('./')

656 
»sume
.
expo£d
 = 
True


657 
»sume
.
ı_cÚfig
 = {'toŞs.®low.Ú': 
True
,

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/lib/cptools.py

3 
impÜt
 
loggšg


4 
impÜt
 
»


6 
impÜt
 
ch”rypy


7 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
	gba£¡ršg
, 
	gmd5
, 
	g£t
, 
unicode¡r


8 
äom
 
	gch”rypy
.
lib
 
impÜt
 
h‰put
 
as
 
	g_h‰put


11 #CÚd™iÚ® 
HTTP
 
»que¡
 
suµÜt
 #


12 
def
 
	$v®id©e_‘ags
(
autÙags
=
F®£
, 
debug
=False):

15 
If
 
autÙags
 
is
 
True
, 
ª
 
ETag
 
»¥Ú£
-
h—d”
 
v®ue
 
wl
 
be
 
´ovided


16 
äom
 
ª
 
MD5
 
hash
 
of
 
the
 
»¥Ú£
 
	`body
 (
uÆess
 
some
 
Ùh”
 
code
 
has


17 
®»ady
 
´ovided
 
ª
 
ETag
 
h—d”
). 
If
 
	`F®£
 (
the
 ),he ETag

18 
wl
 
nÙ
 
be
 
autom©ic
.

20 
WARNING
: 
the
 
autÙags
 
ã©u»
 
is
 
nÙ
 
desigÃd
 
URL
's which‡llow

21 
m‘hods
 
Ùh”
 
thª
 
GET
. 
FÜ
 
exam¶e
, 
a
 
POST
 
to
 
the
 
§me
 
URL
 
»tuºs


22 
no
 
cÚ‹Á
, 
the
 
autom©ic
 
ETag
 
wl
 
be
 
šcÜ»ù
, 
b»akšg
 
a
 
fundam’l


23 
u£
 
’t™y
 
gs
 
š
 
a
 
possibly
 
de¡ruùive
 
çshiÚ
. 
Likewi£
, 
you


24 
¿i£
 304 
NÙ
 
Modif›d
, 
the
 
»¥Ú£
 
body
 
wl
 
be
 
em±y
,h
ETag
 
hash


25 
wl
 
be
 
šcÜ»ù
, 
ªd
 
your
 
­¶iÿtiÚ
 will .

26 
S“
 :
rfc
:`2616` 
SeùiÚ
 14.24.

28 
»¥Ú£
 = 
ch”rypy
.
£rvšg
.response

30 #Gu¬d 
agaš¡
 
bešg
 
run
 
twiû
.

31 
	`ha§‰r
(
»¥Ú£
, "ETag"):

34 
¡©us
, 
»asÚ
, 
msg
 = 
_h‰put
.
	$v®id_¡©us
(
»¥Ú£
.
¡©us
)

36 
‘ag
 = 
»¥Ú£
.
h—d”s
.
	`g‘
('ETag')

38 #Autom©iø
ETag
 
g’”©iÚ
. 
S“
 
w¬nšg
 
š
 
doc¡ršg
.

39 
‘ag
:

40 
debug
:

41 
ch”rypy
.
	`log
('ETag‡Ì—dy s‘: %s' % 
‘ag
, 'TOOLS.ETAGS')

42 
–if
 
nÙ
 
autÙags
:

43 
debug
:

44 
ch”rypy
.
	`log
('Autotags off', 'TOOLS.ETAGS')

45 
–if
 
¡©us
 != 200:

46 
debug
:

47 
ch”rypy
.
	`log
('Status‚ot 200', 'TOOLS.ETAGS')

49 
‘ag
 = 
»¥Ú£
.
	$cŞÏp£_body
()

50 
‘ag
 = '"%s"' % 
	`md5
Óg).
	$hexdige¡
()

51 
debug
:

52 
ch”rypy
.
	`log
('S‘tšg ETag: %s' % 
‘ag
, 'TOOLS.ETAGS')

53 
»¥Ú£
.
h—d”s
['ETag'] = 
‘ag


55 
»¥Ú£
.
ETag
 = 
‘ag


57 #"
If
 
the
 
»que¡
 
would
, 
w™hout
hIf-
M©ch
 
h—d”
 
f›ld
, 
»suÉ
 
š


58 #ªythšg 
Ùh”
 
thª
 
a
 2xx 
Ü
 412 
¡©us
, 
th’
 
the
 
If
-
M©ch
 
h—d”


59 #MUST 
be
 
ignÜed
."

60 
debug
:

61 
ch”rypy
.
	`log
('Stus: %s' % 
¡©us
, 'TOOLS.ETAGS')

62 
¡©us
 >ğ200 
ªd
 status <= 299:

63 
»que¡
 = 
ch”rypy
.
£rvšg
.request

65 
cÚd™iÚs
 = 
»que¡
.
h—d”s
.
	`–em’ts
('If-M©ch'è
Ü
 []

66 
cÚd™iÚs
 = [
	$¡r
(
x
èx 
š
 
cÚd™iÚs
]

67 
debug
:

68 
ch”rypy
.
	`log
('If-M©ch cÚd™iÚs: %s' % 
	`»´
(
cÚd™iÚs
),

70 
cÚd™iÚs
 
ªd
 
	`nÙ
 (cÚd™iÚ =ğ["*"] 
Ü
 
‘ag
 
š
 conditions):

71 
¿i£
 
ch”rypy
.
	`HTTPE¼Ü
(412, "If-Match failed: ETag %r did "

72 "nÙ m©ch %r" % (
‘ag
, 
cÚd™iÚs
))

74 
cÚd™iÚs
 = 
»que¡
.
h—d”s
.
	`–em’ts
('If-NÚe-M©ch'è
Ü
 []

75 
cÚd™iÚs
 = [
	$¡r
(
x
èx 
š
 
cÚd™iÚs
]

76 
debug
:

77 
ch”rypy
.
	`log
('If-NÚe-M©ch cÚd™iÚs: %s' % 
	`»´
(
cÚd™iÚs
),

79 
cÚd™iÚs
 =ğ["*"] 
Ü
 
‘ag
 
š
 conditions:

80 
debug
:

81 
ch”rypy
.
	`log
('»que¡.m‘hod: %s' % 
»que¡
.
m‘hod
, 'TOOLS.ETAGS')

82 
»que¡
.
m‘hod
 
	`š
 ("GET", "HEAD"):

83 
¿i£
 
ch”rypy
.
	$HTTPRedœeù
([], 304)

85 
¿i£
 
ch”rypy
.
	`HTTPE¼Ü
(412, "If-None-Match failed: ETag %r "

86 "m©ched %r" % (
‘ag
, 
cÚd™iÚs
))

88 
def
 
	$v®id©e_sšû
():

91 
If
 
no
 
code
 
has
 
£t
 
the
 
La¡
-
Modif›d
 
»¥Ú£
 
h—d”
, 
th’
‚Ø
v®id©iÚ


92 
wl
 
be
 
³rfÜmed
.

94 
»¥Ú£
 = 
ch”rypy
.
£rvšg
.response

95 
Ï¡mod
 = 
»¥Ú£
.
h—d”s
.
	`g‘
('Last-Modified')

96 
Ï¡mod
:

97 
¡©us
, 
»asÚ
, 
msg
 = 
_h‰put
.
	$v®id_¡©us
(
»¥Ú£
.
¡©us
)

99 
»que¡
 = 
ch”rypy
.
£rvšg
.request

101 
sšû
 = 
»que¡
.
h—d”s
.
	`g‘
('If-Unmodified-Since')

102 
sšû
 
ªd
 sšû !ğ
Ï¡mod
:

103 ià(
¡©us
 >ğ200 
ªd
 stu <ğ299è
Ü
 status == 412:

104 
¿i£
 
ch”rypy
.
	$HTTPE¼Ü
(412)

106 
sšû
 = 
»que¡
.
h—d”s
.
	`g‘
('If-Modified-Since')

107 
sšû
 
ªd
 sšû =ğ
Ï¡mod
:

108 ià(
¡©us
 >ğ200 
ªd
 stu <ğ299è
Ü
 status == 304:

109 
»que¡
.
m‘hod
 
	`š
 ("GET", "HEAD"):

110 
¿i£
 
ch”rypy
.
	$HTTPRedœeù
([], 304)

112 
¿i£
 
ch”rypy
.
	$HTTPE¼Ü
(412)

115 #ToŞ 
code
 #


116 
def
 
	$®low
(
m‘hods
=
NÚe
, 
debug
=
F®£
):

119 
The
 
giv’
 
m‘hods
 
¬e
 -
š£ns™ive
, 
ªd
 
may
 
be
 
š
 
ªy
 
Üd”
.

120 
If
 
Úly
 
Úe
 
m‘hod
 
is
 
®lowed
, 
you
 
may
 
suµly
 
a
 
sšgË
 
¡ršg
;

121 
mÜe
 
thª
 
Úe
, 
suµly
 
a
 
li¡
 
of
 
¡ršgs
.

123 
Reg¬dËss
 
of
 
wh‘h”
 
the
 
cu¼’t
 
m‘hod
 
is
 
®lowed
 
Ü
 
nÙ
, 
this


124 
®so
 
em™s
 
ª
 'AÎow' 
»¥Ú£
 
h—d”
, 
cÚššg
 
the
 
giv’
 
m‘hods
.

126 
nÙ
 
	`isš¡ªû
(
m‘hods
, (
tu¶e
, 
li¡
)):

127 
m‘hods
 = [methods]

128 
m‘hods
 = [
m
.
	$uµ”
(è
m
 
š
 
m‘hods
 m]

129 
nÙ
 
m‘hods
:

130 
m‘hods
 = ['GET', 'HEAD']

131 
–if
 'GET' 
š
 
m‘hods
 
ªd
 'HEAD' 
nÙ
 in methods:

132 
m‘hods
.
	`­³nd
('HEAD')

134 
ch”rypy
.
»¥Ú£
.
h—d”s
['AÎow'] = ', '.
	$još
(
m‘hods
)

135 
ch”rypy
.
»que¡
.
m‘hod
 
nÙ
 
š
 
m‘hods
:

136 
debug
:

137 
ch”rypy
.
	`log
('request.method %r‚ot in methods %r' %

138 (
ch”rypy
.
»que¡
.
m‘hod
, 
m‘hods
), 'TOOLS.ALLOW')

139 
¿i£
 
ch”rypy
.
	$HTTPE¼Ü
(405)

141 
debug
:

142 
ch”rypy
.
	`log
('request.method %r in methods %r' %

143 (
ch”rypy
.
»que¡
.
m‘hod
, 
m‘hods
), 'TOOLS.ALLOW')

146 
def
 
	`´oxy
(
ba£
=
NÚe
, 
loÿl
='X-FÜw¬ded-Ho¡', 
»mÙe
='X-Forwarded-For',

147 
scheme
='X-FÜw¬ded-PrÙo', 
debug
=
F®£
):

150 
FÜ
 
ruÂšg
 
a
 
CP
 
£rv”
 
behšd
 
A·che
, 
ligh‰pd
, 
Ü
 
Ùh”
 
HTTP
 server.

152 
FÜ
 
A·che
 
ªd
 
ligh‰pd
, 
you
 
should
 
Ëave
 
the
 'loÿl' 
¬gum’t
 
©
he

153  
v®ue
 
of
 'X-FÜw¬ded-Ho¡'. 
FÜ
 
Squid
, 
you
 
´obably
 
wªt
 
to
 
£t


154 
toŞs
.
´oxy
.
loÿl
 = 'Origin'.

156 
If
 
you
 
wªt
 
the
 
Ãw
 
»que¡
.
ba£
 
to
 
šşude
 
·th
 
	`šfo
 (
nÙ
 
ju¡
h
ho¡
),

157 
you
 
mu¡
 
ex¶ic™ly
 
£t
 
ba£
 
to
 
the
 
fuÎ
 ba£ 
·th
, 
ªd
 
ALSO
 set 'local'

158 
to
 '', 
so
 
th©
 
the
 
X
-
FÜw¬ded
-
Ho¡
 
»que¡
 
	$h—d”
 (
which
 
Ãv”
 
šşudes


159 
·th
 
šfo
è
dÛs
 
nÙ
 
ov”ride
 
™
. 
Reg¬dËss
, 
the
 
v®ue
 'ba£' 
MUST


160 
NOT
 
’d
 
š
 
a
 
¦ash
.

162 
ch”rypy
.
»que¡
.
»mÙe
.
	$
 (
the
 
IP
 
add»ss
 
of
h
ş›Á
è
wl
 
be


163 
»wr™‹n
 
the
 
h—d”
 
¥ecif›d
 
by
h'»mÙe' 
¬g
 
is
 
v®id
.

164 
By
 , '»mÙe' 
is
 
£t
 
to
 'X-FÜw¬ded-FÜ'. 
If
 
you
 dØ
nÙ


165 
wªt
 
to
 
»wr™e
 
»mÙe
.

, 
£t
 
the
 '»mÙe' 
¬g
Ø
ª
 
em±y
 
¡ršg
.

168 
»que¡
 = 
ch”rypy
.
£rvšg
.request

170 
scheme
:

171 
s
 = 
»que¡
.
h—d”s
.
	$g‘
(
scheme
, 
NÚe
)

172 
debug
:

173 
ch”rypy
.
	`log
('Te¡šg schem%r:%r' % (
scheme
, 
s
), 'TOOLS.PROXY')

174 
s
 =ğ'Ú' 
ªd
 's¦' 
š
 
scheme
.
	$low”
():

175 #Thi 
hªdËs
 
e
.
g
. 
webçùiÚ
' '
X
-
FÜw¬ded
-
S¦
: 
Ú
' header

176 
scheme
 = 'https'

178 #Thi 
is
 
ligh‰pd
/
pound
/
MÚg»l
' '
X
-
FÜw¬ded
-
PrÙo
: 
h‰ps
'

179 
scheme
 = 
s


180 
nÙ
 
scheme
:

181 
scheme
 = 
»que¡
.
ba£
[:»que¡.ba£.
	`fšd
("://")]

183 
loÿl
:

184 
lba£
 = 
»que¡
.
h—d”s
.
	$g‘
(
loÿl
, 
NÚe
)

185 
debug
:

186 
ch”rypy
.
	`log
('Te¡šg†oÿÈ%r:%r' % (
loÿl
, 
lba£
), 'TOOLS.PROXY')

187 
lba£
 
is
 
nÙ
 
NÚe
:

188 
ba£
 = 
lba£
.
	`¥l™
(',')[0]

189 
nÙ
 
ba£
:

190 
pÜt
 = 
»que¡
.
loÿl
.port

191 
pÜt
 == 80:

192 
ba£
 = '127.0.0.1'

194 
ba£
 = '127.0.0.1:%s' % 
pÜt


196 
ba£
.
	`fšd
("://") == -1:

197 #add 
h‰p
:

198 
ba£
 = 
scheme
 + "://" + base

200 
»que¡
.
ba£
 = base

202 
»mÙe
:

203 
xff
 = 
»que¡
.
h—d”s
.
	$g‘
(
»mÙe
)

204 
debug
:

205 
ch”rypy
.
	`log
('Te¡šg„emÙ%r:%r' % (
»mÙe
, 
xff
), 'TOOLS.PROXY')

206 
xff
:

207 
»mÙe
 == 'X-Forwarded-For':

208 #S“ 
h‰p
:

209 
xff
 = xff.
	`¥l™
(',')[-1].
	$¡r
()

210 
»que¡
.
»mÙe
.

 = 
xff


213 
def
 
	`ignÜe_h—d”s
(
h—d”s
=('Rªge',), 
debug
=
F®£
):

216 
This
 
is
 
a
 
u£ful
 
toŞ
 
wÜkšg
 
behšd
 
û¹aš
 
HTTP
 
£rv”s
;

217 
exam¶e
, 
A·che
 
du¶iÿ‹s
 
the
 
wÜk
 
th©
 
CP
 
dÛs
 'Range'

218 
h—d”s
, 
ªd
 
wl
 
doubly
-
Œunÿ‹
 
the
 
»¥Ú£
.

220 
»que¡
 = 
ch”rypy
.
£rvšg
.request

221 
Çme
 
š
 
h—d”s
:

222 
Çme
 
š
 
»que¡
.
h—d”s
:

223 
debug
:

224 
ch”rypy
.
	`log
('IgnÜšg„eque¡ h—d” %r' % 
Çme
,

226 
d–
 
»que¡
.
h—d”s
[
Çme
]

229 
def
 
	$»¥Ú£_h—d”s
(
h—d”s
=
NÚe
, 
debug
=
F®£
):

231 
debug
:

232 
ch”rypy
.
	`log
('S‘tšg„e¥Ú£ h—d”s: %s' % 
	`»´
(
h—d”s
),

234 
Çme
, 
v®ue
 
	$š
 (
h—d”s
 
Ü
 []):

235 
ch”rypy
.
£rvšg
.
»¥Ú£
.
h—d”s
[
Çme
] = 
v®ue


236 
»¥Ú£_h—d”s
.
ç§ã
 = 
True


239 
def
 
	`»ã»r
(
·‰”n
, 
acû±
=
True
, 
acû±_missšg
=
F®£
, 
”rÜ
=403,

240 
mes§ge
='FÜbidd’ Reã»¸h—d”.', 
debug
=
F®£
):

243 
·‰”n


244 
A
 
»guÏr
 
ex´essiÚ
 
·‰”n
 
to
 
‹¡
 
agaš¡
 
the
 
Reã»r
.

246 
acû±


247 
If
 
True
, 
the
 
Reã»r
 
mu¡
 
m©ch
h
·‰”n
; 
F®£
,

248 
the
 
Reã»r
 
mu¡
 
NOT
 
m©ch
h
·‰”n
.

250 
acû±_missšg


251 
If
 
True
, 
³rm™
 
»que¡s
 
w™h
 
no
 
Reã»r
 
h—d”
.

253 
”rÜ


254 
The
 
HTTP
 
”rÜ
 
code
 
to
 Ø
the
 
ş›Á
 
Ú
 
çu»
.

256 
mes§ge


257 
A
 
¡ršg
 
to
 
šşude
 
š
 
the
 
»¥Ú£
 
body
 
Ú
 
çu»
.

260 
Œy
:

261 
»f
 = 
ch”rypy
.
£rvšg
.
»que¡
.
h—d”s
['Referer']

262 
m©ch
 = 
	`boŞ
(
»
.
	$m©ch
(
·‰”n
, 
»f
))

263 
debug
:

264 
ch”rypy
.
	`log
('Reã»¸%¸m©che %r' % (
»f
, 
·‰”n
),

266 
acû±
 =ğ
m©ch
:

268 
exû±
 
KeyE¼Ü
:

269 
debug
:

270 
ch”rypy
.
	`log
('No Referer header', 'TOOLS.REFERER')

271 
acû±_missšg
:

274 
¿i£
 
ch”rypy
.
	$HTTPE¼Ü
(
”rÜ
, 
mes§ge
)

277 
şass
 
	$SessiÚAuth
(
objeù
):

280 
£ssiÚ_key
 = "username"

281 
debug
 = 
F®£


283 
def
 
	$check_u£ºame_ªd_·sswÜd
(
£lf
, 
u£ºame
, 
·sswÜd
):

284 
·ss


286 
def
 
	$ªÚymous
(
£lf
):

288 
·ss


290 
def
 
	$Ú_logš
(
£lf
, 
u£ºame
):

291 
·ss


293 
def
 
	$Ú_logout
(
£lf
, 
u£ºame
):

294 
·ss


296 
def
 
	$Ú_check
(
£lf
, 
u£ºame
):

297 
·ss


299 
def
 
	`logš_sü“n
(
£lf
, 
äom_·ge
='..', 
u£ºame
='', 
”rÜ_msg
='', **
kw¬gs
):

300  (
	`unicode¡r
("""<html><body>

301 
Mes§ge
: %(
”rÜ_msg
)
s


302 <
fÜm
 
m‘hod
="po¡" 
aùiÚ
="do_login">

303 
Logš
: <
šput
 
ty³
="‹xt" 
Çme
="u£ºame" 
v®ue
="%(u£ºame)s" 
size
="10" /><
br
 />

304 
PasswÜd
: <
šput
 
ty³
="·sswÜd" 
Çme
="·sswÜd" 
size
="10" /><
br
 />

305 <
šput
 
ty³
="hidd’" 
Çme
="äom_·ge" 
v®ue
="%(äom_·ge)s" /><
br
 />

306 <
šput
 
ty³
="submit" />

307 </
fÜm
>

308 </
body
></
html
>"""è% v¬s()).’code("
utf
-8")

310 
def
 
	`do_logš
(
£lf
, 
u£ºame
, 
·sswÜd
, 
äom_·ge
='..', **
kw¬gs
):

312 
»¥Ú£
 = 
ch”rypy
.
£rvšg
.response

313 
”rÜ_msg
 = 
£lf
.
	$check_u£ºame_ªd_·sswÜd
(
u£ºame
, 
·sswÜd
)

314 
”rÜ_msg
:

315 
body
 = 
£lf
.
	$logš_sü“n
(
äom_·ge
, 
u£ºame
, 
”rÜ_msg
)

316 
»¥Ú£
.
body
 = body

317 "CÚ‹Á-L’gth" 
š
 
»¥Ú£
.
h—d”s
:

318 #D–‘
CÚ‹Á
-
L’gth
 
h—d”
 
so
 
	`fš®ize
(è
»ÿlcs
 
™
.

319 
d–
 
»¥Ú£
.
h—d”s
["Content-Length"]

320  
True


322 
ch”rypy
.
£rvšg
.
»que¡
.
logš
 = 
u£ºame


323 
ch”rypy
.
£ssiÚ
[
£lf
.
£ssiÚ_key
] = 
u£ºame


324 
£lf
.
	$Ú_logš
(
u£ºame
)

325 
¿i£
 
ch”rypy
.
	`HTTPRedœeù
(
äom_·ge
 
Ü
 "/")

327 
def
 
	`do_logout
(
£lf
, 
äom_·ge
='..', **
kw¬gs
):

329 
£ss
 = 
ch”rypy
.
£ssiÚ


330 
u£ºame
 = 
£ss
.
	$g‘
(
£lf
.
£ssiÚ_key
)

331 
£ss
[
£lf
.
£ssiÚ_key
] = 
NÚe


332 
u£ºame
:

333 
ch”rypy
.
£rvšg
.
»que¡
.
logš
 = 
NÚe


334 
£lf
.
	$Ú_logout
(
u£ºame
)

335 
¿i£
 
ch”rypy
.
	$HTTPRedœeù
(
äom_·ge
)

337 
def
 
	$do_check
(
£lf
):

339 
£ss
 = 
ch”rypy
.
£ssiÚ


340 
»que¡
 = 
ch”rypy
.
£rvšg
.request

341 
»¥Ú£
 = 
ch”rypy
.
£rvšg
.response

343 
u£ºame
 = 
£ss
.
	$g‘
(
£lf
.
£ssiÚ_key
)

344 
nÙ
 
u£ºame
:

345 
£ss
[
£lf
.
£ssiÚ_key
] = 
u£ºame
 = s–f.
	$ªÚymous
()

346 
£lf
.
debug
:

347 
ch”rypy
.
	`log
('No session[username],rying‡nonymous', 'TOOLS.SESSAUTH')

348 
nÙ
 
u£ºame
:

349 
u¾
 = 
ch”rypy
.
	$u¾
(
qs
=
»que¡
.
qu”y_¡ršg
)

350 
£lf
.
debug
:

351 
ch”rypy
.
	`log
('No username,„outingo†ogin_screen with '

352 'äom_·g%r' % 
u¾
, 'TOOLS.SESSAUTH')

353 
»¥Ú£
.
body
 = 
£lf
.
	$logš_sü“n
(
u¾
)

354 "CÚ‹Á-L’gth" 
š
 
»¥Ú£
.
h—d”s
:

355 #D–‘
CÚ‹Á
-
L’gth
 
h—d”
 
so
 
	`fš®ize
(è
»ÿlcs
 
™
.

356 
d–
 
»¥Ú£
.
h—d”s
["Content-Length"]

357  
True


358 
£lf
.
debug
:

359 
ch”rypy
.
	`log
('S‘tšg„eque¡.logšØ%r' % 
u£ºame
, 'TOOLS.SESSAUTH')

360 
»que¡
.
logš
 = 
u£ºame


361 
£lf
.
	$Ú_check
(
u£ºame
)

363 
def
 
	$run
(
£lf
):

364 
»que¡
 = 
ch”rypy
.
£rvšg
.request

365 
»¥Ú£
 = 
ch”rypy
.
£rvšg
.response

367 
·th
 = 
»que¡
.
·th_šfo


368 
·th
.
	`’dsw™h
('login_screen'):

369 
£lf
.
debug
:

370 
ch”rypy
.
	`log
('routšg %¸tØlogš_sü“n' % 
·th
, 'TOOLS.SESSAUTH')

371  
£lf
.
	$logš_sü“n
(**
»que¡
.
·¿ms
)

372 
–if
 
·th
.
	`’dsw™h
('do_login'):

373 
»que¡
.
m‘hod
 != 'POST':

374 
»¥Ú£
.
h—d”s
['Allow'] = "POST"

375 
£lf
.
debug
:

376 
ch”rypy
.
	`log
('do_login„equires POST', 'TOOLS.SESSAUTH')

377 
¿i£
 
ch”rypy
.
	$HTTPE¼Ü
(405)

378 
£lf
.
debug
:

379 
ch”rypy
.
	`log
('routšg %¸tØdo_logš' % 
·th
, 'TOOLS.SESSAUTH')

380  
£lf
.
	$do_logš
(**
»que¡
.
·¿ms
)

381 
–if
 
·th
.
	`’dsw™h
('do_logout'):

382 
»que¡
.
m‘hod
 != 'POST':

383 
»¥Ú£
.
h—d”s
['Allow'] = "POST"

384 
¿i£
 
ch”rypy
.
	$HTTPE¼Ü
(405)

385 
£lf
.
debug
:

386 
ch”rypy
.
	`log
('routšg %¸tØdo_logout' % 
·th
, 'TOOLS.SESSAUTH')

387  
£lf
.
	$do_logout
(**
»que¡
.
·¿ms
)

389 
£lf
.
debug
:

390 
ch”rypy
.
	`log
('No special…ath,„unning do_check', 'TOOLS.SESSAUTH')

391  
£lf
.
	$do_check
()

394 
def
 
	$£ssiÚ_auth
(**
kw¬gs
):

395 
§
 = 
	$SessiÚAuth
()

396 
k
, 
v
 
š
 
kw¬gs
.
	$™ems
():

397 
	$£‰r
(
§
, 
k
, 
v
)

398  
§
.
	$run
()

399 
£ssiÚ_auth
.
__doc__
 = """Session‡uthentication hook.

401 
Any
 
©Œibu‹
 
of
 
the
 
SessiÚAuth
 
şass
 
may
 
be
 
ov”ridd’
 
vŸ
 
a
 
keywÜd
 
¬g


402 
to
 
this
 
funùiÚ
:

404 """ + "\
n
".još(["%
s
: %s" % (k,ype(getattr(SessionAuth, k)).__name__)

405 
k
 
š
 
	$dœ
(
SessiÚAuth
è
nÙ
 
k
.
	`¡¬tsw™h
("__")])

408 
def
 
	$log_Œaûback
(
£v”™y
=
loggšg
.
ERROR
, 
debug
=
F®£
):

410 
ch”rypy
.
	`log
("", "HTTP", 
£v”™y
=£v”™y, 
Œaûback
=
True
)

412 
def
 
	$log_»que¡_h—d”s
(
debug
=
F®£
):

414 
h
 = [" %s: %s" % (
k
, 
v
èk, v 
š
 
ch”rypy
.
£rvšg
.
»que¡
.
h—d”_li¡
]

415 
ch”rypy
.
	`log
('\nReque¡ H—d”s:\n' + '\n'.
	`još
(
h
), "HTTP")

417 
def
 
	$log_hooks
(
debug
=
F®£
):

419 
»que¡
 = 
ch”rypy
.
£rvšg
.request

421 
msg
 = []

422 #SÜˆ
by
 
the
 
¡ªd¬d
 
pošts
 
possibË
.

423 
äom
 
ch”rypy
 
impÜt
 
_ı»que¡


424 
pošts
 = 
_ı»que¡
.
hookpošts


425 
k
 
š
 
»que¡
.
hooks
.
	$keys
():

426 
k
 
nÙ
 
š
 
pošts
:

427 
pošts
.
	$­³nd
(
k
)

429 
k
 
š
 
pošts
:

430 
msg
.
	`­³nd
(" %s:" % 
k
)

431 
v
 = 
»que¡
.
hooks
.
	$g‘
(
k
, [])

432 
v
.
	$sÜt
()

433 
h
 
š
 
v
:

434 
msg
.
	`­³nd
(" %r" % 
h
)

435 
ch”rypy
.
	`log
('\nReque¡ Hook fÜ ' + ch”rypy.
	`u¾
() +

436 ':\n' + '\n'.
	`još
(
msg
), "HTTP")

438 
def
 
	`»dœeù
(
u¾
='', 
š‹º®
=
True
, 
debug
=
F®£
):

440 
debug
:

441 
ch”rypy
.
	`log
('Redirecting %sto: %s' %

442 ({
True
: 'š‹º® ', 
F®£
: ''
	}
}[
š‹º®
], 
	gu¾
),

444 
	gš‹º®
:

445 
¿i£
 
ch”rypy
.
	$IÁ”ÇlRedœeù
(
u¾
)

447 
¿i£
 
ch”rypy
.
	$HTTPRedœeù
(
u¾
)

449 
def
 
	$Œašg_¦ash
(
missšg
=
True
, 
exŒa
=
F®£
, 
¡©us
=
NÚe
, 
debug
=False):

451 
»que¡
 = 
ch”rypy
.
£rvšg
.request

452 
pi
 = 
»que¡
.
·th_šfo


454 
debug
:

455 
ch”rypy
.
	`log
('is_index: %r, missing: %r,ƒxtra: %r,…ath_info: %r' %

456 (
»que¡
.
is_šdex
, 
missšg
, 
exŒa
, 
pi
),

458 
»que¡
.
is_šdex
 
is
 
True
:

459 
missšg
:

460 
nÙ
 
pi
.
	`’dsw™h
('/'):

461 
Ãw_u¾
 = 
ch”rypy
.
	`u¾
(
pi
 + '/', 
»que¡
.
qu”y_¡ršg
)

462 
¿i£
 
ch”rypy
.
	$HTTPRedœeù
(
Ãw_u¾
, 
¡©us
=¡©u 
Ü
 301)

463 
–if
 
»que¡
.
is_šdex
 
is
 
F®£
:

464 
exŒa
:

465 #Ià
pi
 =ğ'/', 
dÚ
't„edirecto ''!

466 
pi
.
	`’dsw™h
('/'è
ªd
…i != '/':

467 
Ãw_u¾
 = 
ch”rypy
.
	`u¾
(
pi
[:-1], 
»que¡
.
qu”y_¡ršg
)

468 
¿i£
 
ch”rypy
.
	$HTTPRedœeù
(
Ãw_u¾
, 
¡©us
=¡©u 
Ü
 301)

470 
def
 
	$æ©‹n
(
debug
=
F®£
):

473 
This
 
®lows
 
ch”rypy
.
»¥Ú£
.
body
 
to
 
cÚsi¡
 
of
 'nested generators';

474 
th©
 
is
, 
a
 
£t
 
of
 
g’”©Üs
h© 
y›ld
 generators.

476 
impÜt
 
ty³s


477 
def
 
	$æ©‹Ãr
(
šput
):

478 
numchunks
 = 0

479 
x
 
š
 
šput
:

480 
nÙ
 
	$isš¡ªû
(
x
, 
ty³s
.
G’”©ÜTy³
):

481 
numchunks
 += 1

482 
y›ld
 
x


484 
y
 
š
 
	$æ©‹Ãr
(
x
):

485 
numchunks
 += 1

486 
y›ld
 
y


487 
debug
:

488 
ch”rypy
.
	`log
('FÏ‰’ed %d chunks' % 
numchunks
, 'TOOLS.FLATTEN')

489 
»¥Ú£
 = 
ch”rypy
.
£rvšg
.response

490 
»¥Ú£
.
body
 = 
	$æ©‹Ãr
(
»¥Ú£
.
body
)

493 
def
 
	$acû±
(
medŸ
=
NÚe
, 
debug
=
F®£
):

496 
If
 'medŸ' 
is
 
	`NÚe
 (
the
 ), 
no
 
‹¡
 
wl
 
be
 
³rfÜmed
.

498 
If
 'medŸ' 
is
 
´ovided
, 
™
 
should
 
be
 
the
 
CÚ‹Á
-
Ty³
 
	$v®ue
 (
as
 
a
 
¡ršg
)

499 
Ü
 
	$v®ues
 (
as
 
a
 
li¡
 
Ü
 
tu¶e
 
of
 
¡ršgs
è
which
 
the
 
cu¼’t
 
»sourû


500 
ÿn
 
em™
. 
The
 
ş›Á
's‡cceptable media„anges (as declared inhe

501 
Acû±
 
»que¡
 
h—d”
è
wl
 
be
 
m©ched
 
š
 
Üd”
 
to
 
the£
 
CÚ‹Á
-
Ty³


502 
v®ues
; 
the
 
fœ¡
 
such
 
¡ršg
 
is
 
»tuºed
. 
Th©
 is,h 
v®ue


503 
wl
 
®ways
 
be
 
Úe
 
of
 
the
 
¡ršgs
 
´ovided
 
š
h'medŸ' 
	`¬g
 (
Ü
 
NÚe


504 'medŸ' 
is
 
NÚe
).

506 
If
 
no
 
m©ch
 
is
 
found
, 
th’
 
HTTPE¼Ü
 406 (
NÙ
 
Acû±abË
èi 
¿i£d
.

507 
NÙe
 
th©
 
mo¡
 
web
 
brow£rs
 
£nd
 *

536 #M©che 
ªy
 
ty³
 
Ü
 
subty³


537 
debug
:

538 
ch”rypy
.
	`log
('Match dueo */*', 'TOOLS.ACCEPT')

539  
medŸ
[0]

540 
–if
 
–em’t
.
v®ue
.
	`’dsw™h
("/*"):

541 #M©che 
ªy
 
subty³


542 
mty³
 = 
–em’t
.
v®ue
[:-1] #K“°
the
 
¦ash


543 
m
 
š
 
medŸ
:

544 
m
.
	$¡¬tsw™h
(
mty³
):

545 
debug
:

546 
ch”rypy
.
	`log
('M©ch dutØ%s' % 
–em’t
.
v®ue
,

548  
m


550 #M©che 
exaù
 
v®ue


551 
–em’t
.
v®ue
 
š
 
medŸ
:

552 
debug
:

553 
ch”rypy
.
	`log
('M©ch dutØ%s' % 
–em’t
.
v®ue
,

555  
–em’t
.
v®ue


557 #NØ
su™abË
 
medŸ
-
¿nge
 
found
.

558 
ah
 = 
»que¡
.
h—d”s
.
	`g‘
('Accept')

559 
ah
 
is
 
NÚe
:

560 
msg
 = "Your client did‚ot send‡n Accept header."

562 
msg
 = "You¸ş›Á s’ˆthi Acû± h—d”: %s." % 
ah


563 
msg
 += (" Buthis„esource onlyƒmitshese mediaypes: %s." %

564 ", ".
	$još
(
medŸ
))

565 
¿i£
 
ch”rypy
.
	$HTTPE¼Ü
(406, 
msg
)

568 
şass
 
	$MÚ™ÜedH—d”M­
(
_h‰put
.
H—d”M­
):

570 
def
 
	$__š™__
(
£lf
):

571 
£lf
.
acûs£d_h—d”s
 = 
	$£t
()

573 
def
 
	$__g‘™em__
(
£lf
, 
key
):

574 
£lf
.
acûs£d_h—d”s
.
	$add
(
key
)

575  
_h‰put
.
H—d”M­
.
	$__g‘™em__
(
£lf
, 
key
)

577 
def
 
	$__cÚšs__
(
£lf
, 
key
):

578 
£lf
.
acûs£d_h—d”s
.
	$add
(
key
)

579  
_h‰put
.
H—d”M­
.
	$__cÚšs__
(
£lf
, 
key
)

581 
def
 
	$g‘
(
£lf
, 
key
, =
NÚe
):

582 
£lf
.
acûs£d_h—d”s
.
	$add
(
key
)

583  
_h‰put
.
H—d”M­
.
	$g‘
(
£lf
, 
key
, =)

585 
	`ha§‰r
({
	}
}, 'has_key'):

587 
def
 
	$has_key
(
£lf
, 
key
):

588 
£lf
.
acûs£d_h—d”s
.
	$add
(
key
)

589  
_h‰put
.
H—d”M­
.
	$has_key
(
£lf
, 
key
)

592 
def
 
	$autov¬y
(
ignÜe
=
NÚe
, 
debug
=
F®£
):

594 
»que¡
 = 
ch”rypy
.
£rvšg
.request

596 
»q_h
 = 
»que¡
.
h—d”s


597 
»que¡
.
h—d”s
 = 
	$MÚ™ÜedH—d”M­
()

598 
»que¡
.
h—d”s
.
	$upd©e
(
»q_h
)

599 
ignÜe
 
is
 
NÚe
:

600 
ignÜe
 = 
	`£t
(['Content-Disposition', 'Content-Length', 'Content-Type'])

602 
def
 
	$£t_»¥Ú£_h—d”
():

603 
»¥_h
 = 
ch”rypy
.
£rvšg
.
»¥Ú£
.
h—d”s


604 
v
 = 
	`£t
([
e
.
v®ue
 
š
 
»¥_h
.
	`–em’ts
('Vary')])

605 
debug
:

606 
ch”rypy
.
	`log
('Acûs£d h—d”s: %s' % 
»que¡
.
h—d”s
.
acûs£d_h—d”s
,

608 
v
 = v.(
»que¡
.
h—d”s
.
acûs£d_h—d”s
)

609 
v
 = v.
	$difã»nû
(
ignÜe
)

610 
v
 = 
	$li¡
(
v
)

611 
v
.
	$sÜt
()

612 
»¥_h
['V¬y'] = ', '.
	$još
(
v
)

613 
»que¡
.
hooks
.
	`©ch
('befÜe_fš®ize', 
£t_»¥Ú£_h—d”
, 95)

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/lib/encoding.py

1 
impÜt
 

2 
impÜt
 
time


4 
impÜt
 
ch”rypy


5 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
	gba£¡ršg
, 
	gBy‹sIO
, 
	gÁob
, 
	g£t
, 
unicode¡r


6 
äom
 
	gch”rypy
.
lib
 
impÜt
 
fe_g’”©Ü


7 
äom
 
	gch”rypy
.
lib
 
impÜt
 
£t_v¬y_h—d”


10 
def
 
decode
(
’codšg
=
NÚe
, 
deçuÉ_’codšg
='utf-8'):

13 
E™h”
 
¬gum’t
 
may
 
be
 
a
 
sšgË
 
¡ršg
 
Ü
‡ 
li¡
 
of
 
¡ršgs
.

15 
’codšg


16 
If
 
nÙ
 
NÚe
, 
»¡riùs
 
the
 
£t
 
of
 
ch¬£ts
 
©‹m±ed
 
decodšg


17 
a
 
»que¡
 
’t™y
 
to
 
the
 
giv’
 
£t
 (
ev’
 ¨
difã»Á
 
ch¬£t
 
is
 giv’ 
š


18 
the
 
CÚ‹Á
-
Ty³
 
»que¡
 
h—d”
).

20 
deçuÉ_’codšg


21 
OÆy
 
š
 
efãù
 
	gthe
 '’codšg' 
¬gum’t
 
is
 
nÙ
 
	ggiv’
.

22 
If
 
	ggiv’
, 
the
 
£t
 
of
 
ch¬£ts
 
©‹m±ed
 
decodšg
 
a
 
»que¡
 
’t™y
 
is


23 *
ex‹nded
* 
w™h
 
the
 
giv’
 
v®ue
(
s
).

26 
	gbody
 = 
ch”rypy
.
»que¡
.
body


27 
’codšg
 
is
 
nÙ
 
NÚe
:

28 
nÙ
 
	$isš¡ªû
(
’codšg
, 
li¡
):

29 
’codšg
 = [encoding]

30 
body
.
©‹m±_ch¬£ts
 = 
’codšg


31 
–if
 
deçuÉ_’codšg
:

32 
nÙ
 
	$isš¡ªû
(
deçuÉ_’codšg
, 
li¡
):

33 
deçuÉ_’codšg
 = [default_encoding]

34 
body
.
©‹m±_ch¬£ts
 = body.©‹m±_ch¬£t + 
deçuÉ_’codšg


37 
şass
 
Re¥Ú£Encod”
:

39 
deçuÉ_’codšg
 = 'utf-8'

40 
çmsg
 = "Response body could‚ot beƒncoded with %r."

41 
’codšg
 = 
NÚe


42 
”rÜs
 = 'strict'

43 
‹xt_Úly
 = 
True


44 
add_ch¬£t
 = 
True


45 
debug
 = 
F®£


47 
def
 
	$__š™__
(
£lf
, **
kw¬gs
):

48 
k
, 
v
 
š
 
kw¬gs
.
	$™ems
():

49 
	$£‰r
(
£lf
, 
k
, 
v
)

51 
£lf
.
©‹m±ed_ch¬£ts
 = 
	$£t
()

52 
»que¡
 = 
ch”rypy
.
£rvšg
.request

53 
»que¡
.
hªdËr
 
is
 
nÙ
 
NÚe
:

54 #R•Ïû 
»que¡
.
hªdËr
 
w™h
 
£lf


55 
£lf
.
debug
:

56 
ch”rypy
.
	`log
('Replacing„equest.handler', 'TOOLS.ENCODE')

57 
£lf
.
ŞdhªdËr
 = 
»que¡
.
hªdËr


58 
»que¡
.
hªdËr
 = 
£lf


60 
def
 
	$’code_¡»am
(
£lf
, 
’codšg
):

63 
U£
 
a
 
g’”©Ü
 
w¿µ”
, 
ªd
 
ju¡
 
´ay
 
™
 
wÜks
 
as
 
the
 
¡»am
 
is


64 
bešg
 
wr™‹n
 
out
.

66 
’codšg
 
š
 
£lf
.
©‹m±ed_ch¬£ts
:

67  
F®£


68 
£lf
.
©‹m±ed_ch¬£ts
.
	$add
(
’codšg
)

70 
def
 
	$’cod”
(
body
):

71 
chunk
 
š
 
body
:

72 
	$isš¡ªû
(
chunk
, 
unicode¡r
):

73 
chunk
 = chunk.
	$’code
(
’codšg
, 
£lf
.
”rÜs
)

74 
y›ld
 
chunk


75 
£lf
.
body
 = 
	$’cod”
(
£lf
.
body
)

76  
True


78 
def
 
	$’code_¡ršg
(
£lf
, 
’codšg
):

80 
’codšg
 
š
 
£lf
.
©‹m±ed_ch¬£ts
:

81  
F®£


82 
£lf
.
©‹m±ed_ch¬£ts
.
	$add
(
’codšg
)

84 
Œy
:

85 
body
 = []

86 
chunk
 
š
 
£lf
.
body
:

87 
	$isš¡ªû
(
chunk
, 
unicode¡r
):

88 
chunk
 = chunk.
	$’code
(
’codšg
, 
£lf
.
”rÜs
)

89 
body
.
	$­³nd
(
chunk
)

90 
£lf
.
body
 = body

91 
	$exû±
 (
LookupE¼Ü
, 
UnicodeE¼Ü
):

92  
F®£


94  
True


96 
def
 
	$fšd_acû±abË_ch¬£t
(
£lf
):

97 
»que¡
 = 
ch”rypy
.
£rvšg
.request

98 
»¥Ú£
 = 
ch”rypy
.
£rvšg
.response

100 
£lf
.
debug
:

101 
ch”rypy
.
	`log
('»¥Ú£.¡»am %r' % 
»¥Ú£
.
¡»am
, 'TOOLS.ENCODE')

102 
»¥Ú£
.
¡»am
:

103 
’cod”
 = 
£lf
.
’code_¡»am


105 
’cod”
 = 
£lf
.
’code_¡ršg


106 "CÚ‹Á-L’gth" 
š
 
»¥Ú£
.
h—d”s
:

107 #D–‘
CÚ‹Á
-
L’gth
 
h—d”
 
so
 
	`fš®ize
(è
»ÿlcs
 
™
.

108 #Encoded 
¡ršgs
 
may
 
be
 
of
 
difã»Á
 
Ëngths
 
äom
 
theœ


109 #unicod
equiv®’ts
, 
ªd
 
ev’
 
äom
 
—ch
 
Ùh”
. 
FÜ
 
exam¶e
:

110 #>>> 
t
 = 
u
"\u7007\u3040"

111 #>>> 
	`Ën
(
t
)

113 #>>> 
	`Ën
(
t
.
	`’code
("UTF-8"))

115 #>>> 
	`Ën
(
t
.
	`’code
("utf7"))

117 
d–
 
»¥Ú£
.
h—d”s
["Content-Length"]

119 #P¬£ 
the
 
Acû±
-
Ch¬£t
 
»que¡
 
h—d”
, 
ªd
 
Œy
 
to
 
´ovide
 
Úe


120 #oà
the
 
»que¡ed
 
	`ch¬£ts
 (
š
 
Üd”
 
of
 
u£r
 
´eã»nû
).

121 
’cs
 = 
»que¡
.
h—d”s
.
	`–em’ts
('Accept-Charset')

122 
ch¬£ts
 = [
’c
.
v®ue
.
	$low”
(è
’c
 
š
 
’cs
]

123 
£lf
.
debug
:

124 
ch”rypy
.
	`log
('ch¬£t %s' % 
	`»´
(
ch¬£ts
), 'TOOLS.ENCODE')

126 
£lf
.
’codšg
 
is
 
nÙ
 
NÚe
:

127 #Ià
¥ecif›d
, 
fÜû
 
this
 
’codšg
 
to
 
be
 
u£d
, 
Ü
 
ç
.

128 
’codšg
 = 
£lf
.’codšg.
	$low”
()

129 
£lf
.
debug
:

130 
ch”rypy
.
	`log
('S³cif›dƒncodšg %r' % 
’codšg
, 'TOOLS.ENCODE')

131 ià(
nÙ
 
ch¬£ts
è
Ü
 "*" 
š
 ch¬£t Ü 
’codšg
 in charsets:

132 
£lf
.
debug
:

133 
ch”rypy
.
	`log
('A‰em±šgƒncodšg %r' % 
’codšg
, 'TOOLS.ENCODE')

134 
	$’cod”
(
’codšg
):

135  
’codšg


137 
nÙ
 
’cs
:

138 
£lf
.
debug
:

139 
ch”rypy
.
	`log
('Attempting defaultƒncoding %r' %

140 
£lf
.
deçuÉ_’codšg
, 'TOOLS.ENCODE')

141 #Any 
ch¬aù”
-
£t
 
is
 
acû±abË
.

142 
	$’cod”
(
£lf
.
deçuÉ_’codšg
):

143  
£lf
.
deçuÉ_’codšg


145 
¿i£
 
ch”rypy
.
	`HTTPE¼Ü
(500, 
£lf
.
çmsg
 % s–f.
deçuÉ_’codšg
)

147 
–em’t
 
š
 
’cs
:

148 
–em’t
.
qv®ue
 > 0:

149 
–em’t
.
v®ue
 == "*":

150 #M©che 
ªy
 
ch¬£t
. 
Try
 
our
 .

151 
£lf
.
debug
:

152 
ch”rypy
.
	`log
('Attempting defaultƒncoding due '

153 'tØ%r' % 
–em’t
, 'TOOLS.ENCODE')

154 
	$’cod”
(
£lf
.
deçuÉ_’codšg
):

155  
£lf
.
deçuÉ_’codšg


157 
’codšg
 = 
–em’t
.
v®ue


158 
£lf
.
debug
:

159 
ch”rypy
.
	`log
('Attemptingƒncoding %s (qvalue >'

160 '0)' % 
–em’t
, 'TOOLS.ENCODE')

161 
	$’cod”
(
’codšg
):

162  
’codšg


164 "*" 
nÙ
 
š
 
ch¬£ts
:

165 #Ià
no
 "*" 
is
 
´e£Á
 
š
 
ª
 
Acû±
-
Ch¬£t
 
f›ld
, 
th’
 
®l


166 #ch¬aù” 
£ts
 
nÙ
 
ex¶ic™ly
 
m’tiÚed
 
g‘
 
a
 
qu®™y


167 #v®u
of
 0, 
exû±
 
ISO
-8859-1, 
which
 
g‘s
 
a
 
qu®™y


168 #v®u
of
 1 
nÙ
 
ex¶ic™ly
 
m’tiÚed
.

169 
iso
 = 'iso-8859-1'

170 
iso
 
nÙ
 
š
 
ch¬£ts
:

171 
£lf
.
debug
:

172 
ch”rypy
.
	`log
('Attempting ISO-8859-1ƒncoding',

174 
	$’cod”
(
iso
):

175  
iso


177 #NØ
su™abË
 
’codšg
 
found
.

178 
ac
 = 
»que¡
.
h—d”s
.
	`g‘
('Accept-Charset')

179 
ac
 
is
 
NÚe
:

180 
msg
 = "Your client did‚ot send‡n Accept-Charset header."

182 
msg
 = "You¸ş›Á s’ˆthi Acû±-Ch¬£ˆh—d”: %s." % 
ac


183 
msg
 +ğ" WŒ›dhe£ ch¬£ts: %s." % ", ".
	$još
(
£lf
.
©‹m±ed_ch¬£ts
)

184 
¿i£
 
ch”rypy
.
	$HTTPE¼Ü
(406, 
msg
)

186 
def
 
	$__ÿÎ__
(
£lf
, *
¬gs
, **
kw¬gs
):

187 
»¥Ú£
 = 
ch”rypy
.
£rvšg
.response

188 
£lf
.
body
 = s–f.
	$ŞdhªdËr
(*
¬gs
, **
kw¬gs
)

190 
	$isš¡ªû
(
£lf
.
body
, 
ba£¡ršg
):

191 #¡ršg 
g‘
 
w¿µed
 
š
 
a
 
li¡
 
beÿu£
 
™”©šg
 
ov”
‡ 
sšgË


192 #™em 
li¡
 
is
 
much
 
ç¡”
 
thª
 
™”©šg
 
ov”
 
ev”y
 
ch¬aù”


193 #š 
a
 
¡ršg
.

194 
£lf
.
body
:

195 
£lf
.
body
 = [self.body]

197 #[''] 
dÛ¢
'tƒvaluateo False, so„eplace it with [].

198 
£lf
.
body
 = []

199 
–if
 
	`ha§‰r
(
£lf
.
body
, 'read'):

200 
£lf
.
body
 = 
	$fe_g’”©Ü
(
£lf
.
body
)

201 
–if
 
£lf
.
body
 
is
 
NÚe
:

202 
£lf
.
body
 = []

204 
ù
 = 
»¥Ú£
.
h—d”s
.
	`–em’ts
("Content-Type")

205 
£lf
.
debug
:

206 
ch”rypy
.
	`log
('CÚ‹Á-Ty³: %r' % [
	$¡r
(
h
èh 
š
 
ù
], 'TOOLS.ENCODE')

207 
ù
:

208 
ù
 = ct[0]

209 
£lf
.
‹xt_Úly
:

210 
ù
.
v®ue
.
	`low”
().
	`¡¬tsw™h
("text/"):

211 
£lf
.
debug
:

212 
ch”rypy
.
	`log
('CÚ‹Á-Ty³ % ¡¬t w™h "‹xt/"' % 
ù
,

214 
do_fšd
 = 
True


216 
£lf
.
debug
:

217 
ch”rypy
.
	`log
('Not finding because Content-Type %s does '

218 'nÙ s¹ w™h "‹xt/"' % 
ù
,

220 
do_fšd
 = 
F®£


222 
£lf
.
debug
:

223 
ch”rypy
.
	`log
('Finding because‚otext_only', 'TOOLS.ENCODE')

224 
do_fšd
 = 
True


226 
do_fšd
:

227 #S‘ "ch¬£t=..." 
·¿m
 
Ú
 
»¥Ú£
 
CÚ‹Á
-
Ty³
 
h—d”


228 
ù
.
·¿ms
['ch¬£t'] = 
£lf
.
	$fšd_acû±abË_ch¬£t
()

229 
£lf
.
add_ch¬£t
:

230 
£lf
.
debug
:

231 
ch”rypy
.
	`log
('S‘tšg CÚ‹Á-Ty³ %s' % 
ù
,

233 
»¥Ú£
.
h—d”s
["CÚ‹Á-Ty³"] = 
	$¡r
(
ù
)

235  
£lf
.
body


239 
def
 
	$com´ess
(
body
, 
com´ess_Ëv–
):

241 
impÜt
 
zlib


243 #S“ 
h‰p
:

244 
y›ld
 
	`Áob
('\x1f\x8b'è#ID1 
ªd
 
ID2
: 
gz
 
m¬k”


245 
y›ld
 
	`Áob
('\x08'è#CM: 
com´essiÚ
 
m‘hod


246 
y›ld
 
	`Áob
('\x00'è#FLG: 
nÚe
 
£t


247 #MTIME: 4 
by‹s


248 
y›ld
 .
	`·ck
("<L", (
time
.
	`time
()) & ('FFFFFFFF', 16))

249 
y›ld
 
	`Áob
('\x02'è#XFL: 
max
 
com´essiÚ
, 
¦owe¡
 
®go


250 
y›ld
 
	`Áob
('\xff'è#OS: 
unknown


252 
üc
 = 
zlib
.
	`üc32
(
	`Áob
(""))

253 
size
 = 0

254 
zobj
 = 
zlib
.
	`com´essobj
(
com´ess_Ëv–
,

255 
zlib
.
DEFLATED
, -zlib.
MAX_WBITS
,

256 
zlib
.
DEF_MEM_LEVEL
, 0)

257 
lše
 
š
 
body
:

258 
size
 +ğ
	$Ën
(
lše
)

259 
üc
 = 
zlib
.
	$üc32
(
lše
, 
üc
)

260 
y›ld
 
zobj
.
	$com´ess
(
lše
)

261 
y›ld
 
zobj
.
	$æush
()

263 #CRC32: 4 
by‹s


264 
y›ld
 .
	`·ck
("<L", 
üc
 & ('FFFFFFFF', 16))

265 #ISIZE: 4 
by‹s


266 
y›ld
 .
	`·ck
("<L", 
size
 & ('FFFFFFFF', 16))

268 
def
 
	$decom´ess
(
body
):

269 
impÜt
 
gz


271 
zbuf
 = 
	$By‹sIO
()

272 
zbuf
.
	$wr™e
(
body
)

273 
zbuf
.
	$£ek
(0)

274 
zfe
 = 
gz
.
	`GzFe
(
mode
='rb', 
feobj
=
zbuf
)

275 
d©a
 = 
zfe
.
	$»ad
()

276 
zfe
.
	$şo£
()

277  
d©a


280 
def
 
	`gz
(
com´ess_Ëv–
=5, 
mime_ty³s
=['‹xt/html', '‹xt/¶aš'], 
debug
=
F®£
):

283 
ch”rypy
.
»¥Ú£
.
h—d”s
['CÚ‹Á-Ty³'] 
mu¡
 
be
 
£t
 
to
 
Úe
 
of
 
the


284 
v®ues
 
š
 
the
 
mime_ty³s
 
¬g
 
befÜe
 
ÿÎšg
 
this
 
funùiÚ
.

286 
The
 
´ovided
 
li¡
 
of
 
mime
-
ty³s
 
mu¡
 
be
 oà
Úe
 oà
the
 
fŞlowšg
 
fÜm
:

287 * 
ty³
/
subty³


288 * 
ty³


	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/lib/gctools.py

1 
impÜt
 
gc


2 
impÜt
 
š¥eù


3 
impÜt
 
os


4 
impÜt
 
sys


5 
impÜt
 
time


7 
	gŒy
:

8 
impÜt
 
objg¿ph


9 
exû±
 
ImpÜtE¼Ü
:

10 
objg¿ph
 = 
NÚe


12 
impÜt
 
ch”rypy


13 
äom
 
ch”rypy
 
impÜt
 
_ı»que¡
, 
_ıwsgi


14 
äom
 
	gch”rypy
.
	g´oûss
.
¶ugšs
 
impÜt
 
Sim¶ePlugš


17 
şass
 
	$Reã¼”T»e
(
objeù
):

20 
³ek_Ëngth
 = 40

22 
def
 
	$__š™__
(
£lf
, 
ignÜe
=
NÚe
, 
maxd•th
=2, 
max·»Ás
=10):

23 
£lf
.
ignÜe
 = ignÜ
Ü
 []

24 
£lf
.
ignÜe
.
	`­³nd
(
š¥eù
.
	`cu¼’täame
().
f_back
)

25 
£lf
.
maxd•th
 = maxdepth

26 
£lf
.
max·»Ás
 = maxparents

28 
def
 
	$asûnd
(
£lf
, 
obj
, 
d•th
=1):

30 
d•th
 += 1

31 
·»Ás
 = []

33 #G©h” 
®l
 
»ã¼”s
 
š
 
Úe
 
¡•
 
to
 
mšimize


34 #ÿsÿdšg 
»ã»nûs
 
due
 
to
 
	`»´
(è
logic
.

35 
»fs
 = 
gc
.
	$g‘_»ã¼”s
(
obj
)

36 
£lf
.
ignÜe
.
	$­³nd
(
»fs
)

37 
	`Ën
(
»fs
è> 
£lf
.
max·»Ás
:

38  [("[% »ã¼”s]" % 
	`Ën
(
»fs
), [])]

40 
Œy
:

41 
asûndcode
 = 
£lf
.
asûnd
.
__code__


42 
exû±
 
A‰ribu‹E¼Ü
:

43 
asûndcode
 = 
£lf
.
asûnd
.
im_func
.
func_code


44 
·»Á
 
š
 
»fs
:

45 
š¥eù
.
	$isäame
(
·»Á
è
ªd
…¬’t.
f_code
 
is
 
asûndcode
:

47 
·»Á
 
š
 
£lf
.
ignÜe
:

49 
d•th
 <ğ
£lf
.
maxd•th
:

50 
·»Ás
.
	`­³nd
((
·»Á
, 
£lf
.
	$asûnd
(
·»Á
, 
d•th
)))

52 
·»Ás
.
	`­³nd
((
·»Á
, []))

54  
·»Ás


56 
def
 
	$³ek
(
£lf
, 
s
):

58 
	`Ën
(
s
è> (
£lf
.
³ek_Ëngth
 + 3):

59 
h®f
 = 
£lf
.
³ek_Ëngth


60  
s
[:
h®f
] + '...' + s[-half:]

62  
s


64 
def
 
	$_fÜm©
(
£lf
, 
obj
, 
desûnd
=
True
):

66 
š¥eù
.
	$isäame
(
obj
):

67 
f’ame
, 
lš’o
, 
func
, 
cÚ‹xt
, 
šdex
 = 
š¥eù
.
	$g‘äamešfo
(
obj
)

68  "<äamoàfunùiÚ '%s'>" % 
func


70 
nÙ
 
desûnd
:

71  
£lf
.
	`³ek
(
	$»´
(
obj
))

73 
	$isš¡ªû
(
obj
, 
diù
):

74  "{" + ", ".
	`još
(["%s: %s" % (
£lf
.
	`_fÜm©
(
k
, 
desûnd
=
F®£
),

75 
£lf
.
	$_fÜm©
(
v
, 
desûnd
=
F®£
))

76 
k
, 
v
 
š
 
obj
.
	`™ems
()]) + "}"

77 
–if
 
	$isš¡ªû
(
obj
, 
li¡
):

78  "[" + ", ".
	`još
([
£lf
.
	$_fÜm©
(
™em
, 
desûnd
=
F®£
)

79 
™em
 
š
 
obj
]) + "]"

80 
–if
 
	$isš¡ªû
(
obj
, 
tu¶e
):

81  "(" + ", ".
	`još
([
£lf
.
	$_fÜm©
(
™em
, 
desûnd
=
F®£
)

82 
™em
 
š
 
obj
]) + ")"

84 
r
 = 
£lf
.
	`³ek
(
	$»´
(
obj
))

85 
	`isš¡ªû
(
obj
, (
¡r
, , )):

86  
r


87  "%s: %s" % (
	`ty³
(
obj
), 
r
)

89 
def
 
	$fÜm©
(
£lf
, 
Œ“
):

91 
ouut
 = []

92 
def
 
	$asûnd
(
b¿nch
, 
d•th
=1):

93 
·»Á
, 
g¿nd·»Ás
 
š
 
b¿nch
:

94 
ouut
.
	`­³nd
((" " * 
d•th
è+ 
£lf
.
	$_fÜm©
(
·»Á
))

95 
g¿nd·»Ás
:

96 
	`asûnd
(
g¿nd·»Ás
, 
d•th
 + 1)

97 
	$asûnd
(
Œ“
)

98  
ouut


101 
def
 
	$g‘_š¡ªûs
(
şs
):

102  [
x
 x 
š
 
gc
.
	$g‘_objeùs
(è
	`isš¡ªû
(
x
, 
şs
)]

105 
şass
 
	$Reque¡CouÁ”
(
Sim¶ePlugš
):

107 
def
 
	$¡¬t
(
£lf
):

108 
£lf
.
couÁ
 = 0

110 
def
 
	$befÜe_»que¡
(
£lf
):

111 
£lf
.
couÁ
 += 1

113 
def
 
	$aá”_»que¡
(
£lf
):

114 
£lf
.
couÁ
 -=1

115 
»que¡_couÁ”
 = 
	$Reque¡CouÁ”
(
ch”rypy
.
’gše
)

116 
»que¡_couÁ”
.
	$subsüibe
()

119 
def
 
	$g‘_cÚ‹xt
(
obj
):

120 
	$isš¡ªû
(
obj
, 
_ı»que¡
.
Reque¡
):

121  "·th=%s;¡age=%s" % (
obj
.
·th_šfo
, obj.
¡age
)

122 
–if
 
	$isš¡ªû
(
obj
, 
_ı»que¡
.
Re¥Ú£
):

123  "¡©us=%s" % 
obj
.
¡©us


124 
–if
 
	$isš¡ªû
(
obj
, 
_ıwsgi
.
AµRe¥Ú£
):

125  "PATH_INFO=%s" % 
obj
.
’vœÚ
.
	`g‘
('PATH_INFO', '')

126 
–if
 
	`ha§‰r
(
obj
, "tb_lineno"):

127  "tb_lš’o=%s" % 
obj
.
tb_lš’o


131 
şass
 
	$GCRoÙ
(
objeù
):

134 
şas£s
 = [(
_ı»que¡
.
Reque¡
, 2, 2,

136 (
_ı»que¡
.
Re¥Ú£
, 2, 2,

138 (
_ıwsgi
.
AµRe¥Ú£
, 1, 1,

142 
def
 
	$šdex
(
£lf
):

144 
šdex
.
expo£d
 = 
True


146 
def
 
	$¡©s
(
£lf
):

147 
ouut
 = ["Statistics:"]

149 
ŒŸl
 
š
 
	$¿nge
(10):

150 
»que¡_couÁ”
.
couÁ
 > 0:

152 
time
.
	$¦“p
(0.5)

154 
ouut
.
	`­³nd
("\nNot‡ll„equests closed…roperly.")

156 #gc_cŞËù 
i¢
't…erfectly synchronous, because it may

157 #b»ak 
»ã»nû
 
cyşes
 
th©
 
th’
 
ke
 
time
 
to
 
fuÎy


158 #fš®ize. 
C®l
 
™
 
thriû
 
ªd
 
hİe
 
the
 
be¡
.

159 
gc
.
	$cŞËù
()

160 
gc
.
	$cŞËù
()

161 
uÄ—chabË
 = 
gc
.
	$cŞËù
()

162 
uÄ—chabË
:

163 
objg¿ph
 
is
 
nÙ
 
NÚe
:

164 
fš®
 = 
objg¿ph
.
	`by_ty³
('Nondestructible')

165 
fš®
:

166 
objg¿ph
.
	`show_back»fs
(
fš®
, 
f’ame
='finalizers.png')

168 
Œash
 = {
	}
}

169 
x
 
š
 
gc
.
g¬bage
:

170 
Œash
[
ty³
(
x
)] =¿sh.
g‘
(type(x), 0) + 1

171 
	gŒash
:

172 
ouut
.
š£¹
(0, "\n% uÄ—chabË objeùs:" % 
uÄ—chabË
)

173 
	gŒash
 = [(
v
, 
k
èk, v 
š
 
Œash
.
™ems
()]

174 
	gŒash
.
	$sÜt
()

175 
·œ
 
š
 
Œash
:

176 
ouut
.
	`­³nd
(" " + 
	$»´
(
·œ
))

178 #Check 
deş¬ed
 
şas£s
 
to
 
v”ify
 
uncŞËùed
 
š¡ªûs
.

179 #The£ 
dÚ
't haveo be…art of‡ cycle;hey can be

180 #ªy 
objeùs
 
th©
 
have
 
uÇÁic©ed
 
»ã¼”s
h© 
k“p


181 #them 
äom
 
bešg
 
cŞËùed
.

182 
®lobjs
 = {
	}
}

183 
şs
, 
	gmšobj
, 
	gmaxobj
, 
msg
 
š
 
	g£lf
.
	gşas£s
:

184 
®lobjs
[
şs
] = 
	$g‘_š¡ªûs
(
şs
)

186 
şs
, 
mšobj
, 
maxobj
, 
msg
 
š
 
£lf
.
şas£s
:

187 
objs
 = 
®lobjs
[
şs
]

188 
Ënobj
 = 
	$Ën
(
objs
)

189 
Ënobj
 < 
mšobj
 
Ü
†’obj > 
maxobj
:

190 
mšobj
 =ğ
maxobj
:

191 
ouut
.
	`­³nd
(

193 (
mšobj
, 
şs
, 
Ënobj
))

195 
ouut
.
	`­³nd
(

197 (
mšobj
, 
maxobj
, 
şs
, 
Ënobj
))

199 
obj
 
š
 
objs
:

200 
objg¿ph
 
is
 
nÙ
 
NÚe
:

201 
ig
 = [
	`id
(
objs
), id(
š¥eù
.
	`cu¼’täame
())]

202 
âame
 = "g¿ph_%s_%s.²g" % (
şs
.
__Çme__
, 
	$id
(
obj
))

203 
objg¿ph
.
	$show_back»fs
(

204 
obj
, 
exŒa_ignÜe
=
ig
, 
max_d•th
=4, 
too_mªy
=20,

205 
f’ame
=
âame
, 
exŒa_šfo
=
g‘_cÚ‹xt
)

206 
ouut
.
	`­³nd
("\nReferrers for %s (refcount=%s):" %

207 (
	`»´
(
obj
), 
sys
.
	$g‘»fcouÁ
(
obj
)))

208 
t
 = 
	$Reã¼”T»e
(
ignÜe
=[
objs
], 
maxd•th
=3)

209 
Œ“
 = 
t
.
	$asûnd
(
obj
)

210 
ouut
.
	`ex‹nd
(
t
.
	$fÜm©
(
Œ“
))

212  "\n".
	$još
(
ouut
)

213 
¡©s
.
expo£d
 = 
True


	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/lib/http.py

1 
impÜt
 
w¬nšgs


2 
	gw¬nšgs
.
w¬n
('cherrypy.lib.http has been deprecated‡nd will be„emoved '

4 
D•»ÿtiÚW¬nšg
)

6 
äom
 
	gch”rypy
.
	glib
.
h‰put
 
	gimpÜt
 *

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/lib/httpauth.py

2 
This
 
moduË
 
defšes
 
funùiÚs
 
to
 
im¶em’t
 
HTTP
 
Dige¡
 
Auth’tiÿtiÚ
 (:
rfc
:`2617`).

3 
This
 
has
 
fuÎ
 
com¶Ÿnû
 
w™h
 'Dige¡' 
ªd
 'Basic' 
auth’tiÿtiÚ
 
m‘hods
. 
In


4 'Dige¡' 
™
 
suµÜts
 
bÙh
 
MD5
 
ªd
 MD5-
£ss
 
®gÜ™hms
.

6 
U§ge
:

7 
Fœ¡
 
u£
 'doAuth' 
to
 
»que¡
 
the
 
ş›Á
 
auth’tiÿtiÚ
 
a


8 
û¹aš
 
»sourû
. 
You
 
should
 
£nd
 
ª
 
h‰¶ib
.
UNAUTHORIZED
 
»¥Ú£
 
to
 
the


9 
ş›Á
 
so
 
he
 
knows
 h
has
 
to
 
auth’tiÿ‹
 
™£lf
.

11 
Th’
 
u£
 '·r£AuthÜiz©iÚ' 
to
 
»Œ›ve
 
the
 'auth_m­' 
u£d
 
š


14 
To
 
u£
 'checkRe¥Ú£' 
you
 
mu¡
 
have
 
®»ady
 
v”if›d
 
the
 
·sswÜd
 
assocŸ‹d


15 
w™h
 
the
 'u£ºame' 
key
 
š
 'auth_m­' 
diù
. 
Th’
 
you
 
u£
he 'checkResponse'

16 
funùiÚ
 
to
 
v”ify
 
the
 
·sswÜd
 
m©ches
h
Úe
 
£Á
 
by
h
ş›Á
.

18 
SUPPORTED_ALGORITHM
 - 
li¡
 
of
 
suµÜ‹d
 'Dige¡' 
®gÜ™hms


19 
SUPPORTED_QOP
 - 
li¡
 
of
 
suµÜ‹d
 'Digest' 'qop'.

21 
__v”siÚ__
 = 1, 0, 1

22 
	g__authÜ__
 = "Tiago Cogumbreiro <cogumbreiro@users.sf.net>"

23 
__üed™s__
 = """

24 
P‘”
 
vª
 
Kam³n
 
™s
 
»ce
 
which
 
im¶em’t
 
mo¡
 
of
 
Dige¡
 
auth’tiÿtiÚ
:

25 
h‰p
:

28 
__liûn£__
 = """

29 
Cİyright
 (
c
è2005, 
TŸgo
 
	gCogumb»œo
 <
	gcogumb»œo
@
	gu£rs
.
	gsf
.
	gÃt
>

30 
AÎ
 
rights
 
	g»£rved
.

32 
Redi¡ributiÚ
 
ªd
 
u£
 
š
 
sourû
‡nd 
bš¬y
 
	gfÜms
, 
w™h
 
Ü
 
w™hout
 
	gmodifiÿtiÚ
,

33 
¬e
 
³rm™‹d
 
´ovided
 
th©
 
the
 
fŞlowšg
 
cÚd™iÚs
‡» 
	gm‘
:

35 * 
Redi¡ributiÚs
 
of
 
sourû
 
code
 
mu¡
 
»š
 
the
 
above
 
cİyright
 
nÙiû
,

36 
this
 
li¡
 
of
 
cÚd™iÚs
 
ªd
 
the
 
fŞlowšg
 
	gdisşaim”
.

37 * 
Redi¡ributiÚs
 
š
 
bš¬y
 
fÜm
 
mu¡
 
»´oduû
 
the
 
above
 
cİyright
 
	gnÙiû
,

38 
this
 
li¡
 
of
 
cÚd™iÚs
 
ªd
 
the
 
fŞlowšg
 
disşaim”
 
š
h
docum’tiÚ


39 
	gªd
/
Ü
 
Ùh”
 
m©”Ÿls
 
´ovided
 
w™h
 
the
 
	gdi¡ributiÚ
.

40 * 
Ne™h”
 
the
 
Çme
 
of
 
Sylvaš
 
H–Ëgou¬ch
 
nÜ
h
Çmes
 oà
his
 
cÚŒibutÜs


41 
may
 
be
 
u£d
 
to
 
’dÜ£
 
Ü
 
´omÙe
 
´oduùs
 
d”ived
 
äom
 
this
 
soáw¬e


42 
w™hout
 
¥ecific
 
´iÜ
 
wr™‹n
 
	g³rmissiÚ
.

44 
THIS
 
SOFTWARE
 
IS
 
PROVIDED
 
BY
 
THE
 
COPYRIGHT
 
HOLDERS
 
AND
 
	gCONTRIBUTORS
 "AS IS" AND

45 
ANY
 
EXPRESS
 
OR
 
IMPLIED
 
	gWARRANTIES
, 
	gINCLUDING
, 
BUT
 
NOT
 
LIMITED
 
	gTO
, 
THE
 IMPLIED

46 
WARRANTIES
 
OF
 
MERCHANTABILITY
 
AND
 
FITNESS
 
FOR
 
A
 
PARTICULAR
 
PURPOSE
 
ARE


47 
	gDISCLAIMED
. 
IN
 
NO
 
EVENT
 
SHALL
 
THE
 
COPYRIGHT
 
OWNER
 
OR
 
CONTRIBUTORS
 
BE
 
LIABLE


48 
FOR
 
ANY
 
	gDIRECT
, 
	gINDIRECT
, 
	gINCIDENTAL
, 
	gSPECIAL
, 
	gEXEMPLARY
, 
OR
 
CONSEQUENTIAL


49 
DAMAGES
 (
INCLUDING
, 
BUT
 
NOT
 
LIMITED
 
TO
, 
PROCUREMENT
 
OF
 
SUBSTITUTE
 
GOODS
 
OR


50 
SERVICES
; 
LOSS
 
OF
 
USE
, 
DATA
, 
OR
 
PROFITS
; OR 
BUSINESS
 
INTERRUPTION
è
HOWEVER


51 
CAUSED
 
AND
 
ON
 
ANY
 
THEORY
 
OF
 
	gLIABILITY
, 
WHETHER
 
IN
 
	gCONTRACT
, 
STRICT
 LIABILITY,

52 
OR
 
	$TORT
 (
INCLUDING
 
NEGLIGENCE
 
OR
 
OTHERWISE
è
ARISING
 
IN
 
ANY
 
WAY
 
OUT
 
OF
 
THE
 
USE


53 
OF
 
THIS
 
SOFTWARE
, 
EVEN
 
IF
 
ADVISED
 OF 
THE
 
POSSIBILITY
 OF 
SUCH
 
DAMAGE
.

56 
__®l__
 = ("digestAuth", "basicAuth", "doAuth", "checkResponse",

61 
impÜt
 
time


62 
äom
 
ch”rypy
.
_ıcom·t
 
impÜt
 
ba£64_decode
, 
Áob
, 
md5


63 
äom
 
ch”rypy
.
_ıcom·t
 
impÜt
 
·r£_h‰p_li¡
, 
·r£_keqv_li¡


65 
MD5
 = "MD5"

66 
MD5_SESS
 = "MD5-sess"

67 
AUTH
 = "auth"

68 
AUTH_INT
 = "auth-int"

70 
SUPPORTED_ALGORITHM
 = (
MD5
, 
MD5_SESS
)

71 
SUPPORTED_QOP
 = (
AUTH
, 
AUTH_INT
)

75 #
_AUTH_ENCODERS = {

76 
MD5
: 
Ïmbda
 
v®
: 
	`md5
(
	`Áob
(v®)).
	`hexdige¡
(),

77 
MD5_SESS
: 
Ïmbda
 
v®
: 
	`md5
(
	`Áob
(v®)).
	`hexdige¡
(),

78 #SHA: 
Ïmbda
 
v®
: 
sha
.
	`Ãw
(
	`Áob
(v®)).
	`hexdige¡
 (),

79 
	}
}

81 
def
 
	$ÿlcuÏ‹NÚû
 (
»®m
, 
®gÜ™hm
 = 
MD5
):

83 
to
 
hªdË
 
£ssiÚs
."""

85 
glob®
 
SUPPORTED_ALGORITHM
, 
DIGEST_AUTH_ENCODERS


86 
as£¹
 
®gÜ™hm
 
š
 
SUPPORTED_ALGORITHM


88 
Œy
:

89 
’cod”
 = 
DIGEST_AUTH_ENCODERS
[
®gÜ™hm
]

90 
exû±
 
KeyE¼Ü
:

91 
¿i£
 
	`NÙIm¶em’‹dE¼Ü
 ("The chosen‡lgorithm (%s) does‚ot have "\

92 "ª im¶em’tiÚ y‘" % 
®gÜ™hm
)

94  
	`’cod”
 ("%d:%s" % (
time
.
	`time
(), 
»®m
))

96 
def
 
	$dige¡Auth
 (
»®m
, 
®gÜ™hm
 = 
MD5
, 
nÚû
 = 
NÚe
, 
qİ
 = 
AUTH
):

98 
glob®
 
SUPPORTED_ALGORITHM
, 
DIGEST_AUTH_ENCODERS
, 
SUPPORTED_QOP


99 
as£¹
 
®gÜ™hm
 
š
 
SUPPORTED_ALGORITHM


100 
as£¹
 
qİ
 
š
 
SUPPORTED_QOP


102 
nÚû
 
is
 
NÚe
:

103 
nÚû
 = 
	$ÿlcuÏ‹NÚû
 (
»®m
, 
®gÜ™hm
)

106 
»®m
, 
nÚû
, 
®gÜ™hm
, 
qİ


109 
def
 
	$basicAuth
 (
»®m
):

111 
as£¹
 '"' 
nÙ
 
š
 
»®m
, "Realms cannot containhe \" (quote) character."

113  'Basiø»®m="%s"' % 
»®m


115 
def
 
	$doAuth
 (
»®m
):

117 
Dige¡
 
ªd
 
çÎback
 
to
 
Basic
 
auth’tiÿtiÚ
 
wh’
 
the
 
brow£r
 
dÛ¢
't

118 
suµÜt
 
the
 
fœ¡
 
Úe
.

120 
This
 
should
 
be
 
£t
 
š
 
the
 
HTTP
 
h—d”
 
und”
h
key
 'WWW-Authenticate'."""

122  
	`dige¡Auth
 (
»®m
è+ " " + 
	$basicAuth
 (
»®m
)

126 #P¬£ 
authÜiz©iÚ
 
·¿m‘”s


127 #
 _·r£Dige¡AuthÜiz©iÚ (auth_·¿ms):

128 #CÚv”ˆ
the
 
auth
 
·¿ms
 
to
 
a
 
diù


129 
™ems
 = 
	$·r£_h‰p_li¡
(
auth_·¿ms
)

130 
·¿ms
 = 
	$·r£_keqv_li¡
(
™ems
)

132 #Now 
v®id©e
 
the
 
·¿ms


134 #Check 
»quœed
 
·¿m‘”s


135 
»quœed
 = ["username", "realm", "nonce", "uri", "response"]

136 
k
 
š
 
»quœed
:

137 
k
 
nÙ
 
š
 
·¿ms
:

138  
NÚe


140 #Ià
qİ
 
is
 
£Á
 
th’
 
úÚû
 
ªd
 
nc
 
MUST
 
be
 
´e£Á


141 "qİ" 
š
 
·¿ms
 
ªd
 
	`nÙ
 ("cnonce" in…arams \

142 
ªd
 "nc" 
š
 
·¿ms
):

143  
NÚe


145 #Ià
qİ
 
is
 
nÙ
 
£Á
, 
Ã™h”
 
úÚû
 
nÜ
 
nc
 
ÿn
 
be
 
´e£Á


146 ià("úÚû" 
š
 
·¿ms
 
Ü
 "nc" iÀ·¿msè
ªd
 \

147 "qİ" 
nÙ
 
š
 
·¿ms
:

148  
NÚe


150  
·¿ms


153 
def
 
	$_·r£BasicAuthÜiz©iÚ
 (
auth_·¿ms
):

154 
u£ºame
, 
·sswÜd
 = 
	`ba£64_decode
(
auth_·¿ms
).
	`¥l™
(":", 1)

155  {"u£ºame": 
u£ºame
, "·sswÜd": 
·sswÜd
}

157 
AUTH_SCHEMES
 = {

158 "basic": 
_·r£BasicAuthÜiz©iÚ
,

159 "dige¡": 
_·r£Dige¡AuthÜiz©iÚ
,

162 
def
 
	$·r£AuthÜiz©iÚ
 (
üed’tŸls
):

164 
the
 
HTTP
 
h—d”
 
to
 
a
 
m­
 
™£lf
. 
If
h
·rsšg
 
çs
 'NÚe' 
is
 
»tuºed
.

167 
glob®
 
AUTH_SCHEMES


169 
auth_scheme
, 
auth_·¿ms
 = 
üed’tŸls
.
	`¥l™
(" ", 1)

170 
auth_scheme
 =‡uth_scheme.
	$low”
 ()

172 
·r£r
 = 
AUTH_SCHEMES
[
auth_scheme
]

173 
·¿ms
 = 
	$·r£r
 (
auth_·¿ms
)

175 
·¿ms
 
is
 
NÚe
:

178 
as£¹
 "auth_scheme" 
nÙ
 
š
 
·¿ms


179 
·¿ms
["auth_scheme"] = 
auth_scheme


180  
·¿ms


184 #Check 
´ovided
 
»¥Ú£
 
a
 
v®id
 
·sswÜd


185 #
 md5SessiÚKey (·¿ms,…asswÜd):

187 
If
 
the
 "®gÜ™hm" 
dœeùive
's value is "MD5-sess",hen A1

188 [
the
 
£ssiÚ
 
key
] 
is
 
ÿlcuÏ‹d
 
Úly
 
Úû
 - 
Ú
h
fœ¡
 
»que¡
 
by
he

189 
ş›Á
 
fŞlowšg
 
»ût
 
of
 
a
 
WWW
-
Auth’tiÿ‹
 
ch®Ënge
 
äom
 
the
 
£rv”
.

191 
This
 
ü—‹s
 
a
 '£ssiÚ key' 
the
 
auth’tiÿtiÚ
 
of
 
sub£qu’t


192 
»que¡s
 
ªd
 
»¥Ú£s
 
which
 
is
 
difã»Á
 
—ch
 "authentication

193 
£ssiÚ
",hus†imitinghe‡mount of material hashed with‡ny one

194 
key
.

196 
Beÿu£
 
the
 
£rv”
 
Ãed
 
Úly
 
u£
h
hash
 
of
h
u£r


197 
üed’tŸls
 
š
 
Üd”
 
to
 
ü—‹
 
the
 
A1
 
v®ue
, 
this
 
cÚ¡ruùiÚ
 
could


198 
be
 
u£d
 
š
 
cÚjunùiÚ
 
w™h
 
a
 
thœd
 
·¹y
 
auth’tiÿtiÚ
 
£rviû
 
so


199 
th©
 
the
 
web
 
£rv”
 
would
 
nÙ
 
Ãed
h
aùu®
 
·sswÜd
 
v®ue
. 
The


200 
¥ecifiÿtiÚ
 
of
 
such
 
a
 
´ÙocŞ
 
is
 
beyÚd
 
the
 
scİe
 oà
this


201 
¥ecifiÿtiÚ
.

204 
keys
 = ("username", "realm", "nonce", "cnonce")

205 
·¿ms_cİy
 = {
	}
}

206 
key
 
š
 
keys
:

207 
·¿ms_cİy
[
key
] = 
·¿ms
[key]

209 
·¿ms_cİy
["®gÜ™hm"] = 
MD5_SESS


210  
	$_A1
 (
·¿ms_cİy
, 
·sswÜd
)

212 
def
 
	$_A1
(
·¿ms
, 
·sswÜd
):

213 
®gÜ™hm
 = 
·¿ms
.
	`g‘
 ("®gÜ™hm", 
MD5
)

214 
H
 = 
DIGEST_AUTH_ENCODERS
[
®gÜ™hm
]

216 
®gÜ™hm
 =ğ
MD5
:

217 #Ià
the
 "®gÜ™hm" 
dœeùive
's value is "MD5" or is

218 #un¥ecif›d, 
th’
 
A1
 
is
:

219 #A1 = 
	`unq
(
u£ºame
-
v®ue
è":" unq(
»®m
-v®ueè":" 
·sswd


220  "%s:%s:%s" % (
·¿ms
["u£ºame"],…¬ams["»®m"], 
·sswÜd
)

222 
–if
 
®gÜ™hm
 =ğ
MD5_SESS
:

224 #Thi 
is
 
A1
 
qİ
 i 
£t


225 #A1 = 
	`H
Ğ
	`unq
(
u£ºame
-
v®ue
è":" unq(
»®m
-v®ueè":" 
·sswd
 )

227 
h_a1
 = 
	`H
 ("%s:%s:%s" % (
·¿ms
["u£ºame"],…¬ams["»®m"], 
·sswÜd
))

228  "%s:%s:%s" % (
h_a1
, 
·¿ms
["nonce"],…arams["cnonce"])

231 
def
 
	$_A2
(
·¿ms
, 
m‘hod
, 
kw¬gs
):

232 #Ià
the
 "qİ" 
dœeùive
's value is "auth" or is unspecified,hen A2 is:

233 #A2 = 
M‘hod
 ":" 
dige¡
-
uri
-
v®ue


235 
qİ
 = 
·¿ms
.
	`g‘
 ("qop", "auth")

236 
qİ
 == "auth":

237  
m‘hod
 + ":" + 
·¿ms
["uri"]

238 
–if
 
qİ
 == "auth-int":

239 #Ià
the
 "qİ" 
v®ue
 
is
 "auth-št", 
th’
 
A2
 is:

240 #A2 = 
M‘hod
 ":" 
dige¡
-
uri
-
v®ue
 ":" 
	`H
(
’t™y
-
body
)

241 
’t™y_body
 = 
kw¬gs
.
	`g‘
 ("entity_body", "")

242 
H
 = 
kw¬gs
["H"]

245 
m‘hod
,

246 
·¿ms
["uri"],

247 
	$H
(
’t™y_body
)

251 
¿i£
 
	`NÙIm¶em’‹dE¼Ü
 ("Th'qİ' m‘hod i unknown: %s" % 
qİ
)

253 
def
 
	`_compu‹Dige¡Re¥Ú£
(
auth_m­
, 
·sswÜd
, 
m‘hod
 = "GET", 
A1
 = 
NÚe
,**
kw¬gs
):

255 
G’”©es
 
a
 
»¥Ú£
 
»¥eùšg
 
the
 
®gÜ™hm
 
defšed
 
š
 
RFC
 2617

257 
·¿ms
 = 
auth_m­


259 
®gÜ™hm
 = 
·¿ms
.
	`g‘
 ("®gÜ™hm", 
MD5
)

261 
H
 = 
DIGEST_AUTH_ENCODERS
[
®gÜ™hm
]

262 
KD
 = 
Ïmbda
 
£ü‘
, 
d©a
: 
	`H
(secret + ":" + data)

264 
qİ
 = 
·¿ms
.
	`g‘
 ("qİ", 
NÚe
)

266 
H_A2
 = 
	`H
(
	$_A2
(
·¿ms
, 
m‘hod
, 
kw¬gs
))

268 
®gÜ™hm
 =ğ
MD5_SESS
 
ªd
 
A1
 
is
 
nÙ
 
NÚe
:

269 
H_A1
 = 
	$H
(
A1
)

271 
H_A1
 = 
	`H
(
	$_A1
(
·¿ms
, 
·sswÜd
))

273 
qİ
 
	`š
 ("auth", "auth-int"):

274 #Ià
the
 "qİ" 
v®ue
 
is
 "auth" 
Ü
 "auth-int":

275 #»que¡-
dige¡
 = <"> < KD ( H(A1), unq(nonce-value)

281 
»que¡
 = "%s:%s:%s:%s:%s" % (

282 
·¿ms
["nonce"],

283 
·¿ms
["nc"],

284 
·¿ms
["cnonce"],

285 
·¿ms
["qop"],

286 
H_A2
,

288 
–if
 
qİ
 
is
 
NÚe
:

289 #Ià
the
 "qİ" 
dœeùive
 
is
 
nÙ
 
	`´e£Á
 (
this
 
cÚ¡ruùiÚ
 is

290 #fÜ 
com·tib™y
 
w™h
 
RFC
 2069):

291 #»que¡-
dige¡
 =

293 
»que¡
 = "%s:%s" % (
·¿ms
["nÚû"], 
H_A2
)

295  
	$KD
(
H_A1
, 
»que¡
)

297 
def
 
	`_checkDige¡Re¥Ú£
(
auth_m­
, 
·sswÜd
, 
m‘hod
 = "GET", 
A1
 = 
NÚe
, **
kw¬gs
):

299 
he
 
Œ›s
 
to
 
auth’tiÿ‹
.

300 
O±iÚ®
 
¬gum’ts
:

301 
’t™y_body
 - 
wh’
 'qİ' 
is
 
£t
 
to
 'auth-št' 
you
 
MUST
 
´ovide
 
the


302 
¿w
 
d©a
 
you
 
¬e
 
gošg
 
to
 
£nd
Ø
the
 
	`ş›Á
 (
usu®ly
he

303 
HTML
 
·ge
.

304 
»que¡_uri
 - 
the
 
uri
 
äom
h
»que¡
 
lše
 
com·»d
 
w™h
he 'uri'

305 
dœeùive
 
of
 
the
 
authÜiz©iÚ
 
m­
. 
They
 
mu¡
 
»´e£Á


306 
the
 
§me
 
	`»sourû
 (
unu£d
 
©
 
this
 
time
).

309 
auth_m­
['»®m'] !ğ
kw¬gs
.
	`g‘
('»®m', 
NÚe
):

310  
F®£


312 
»¥Ú£
 = 
	$_compu‹Dige¡Re¥Ú£
(
auth_m­
, 
·sswÜd
, 
m‘hod
, 
A1
,**
kw¬gs
)

314  
»¥Ú£
 =ğ
auth_m­
["response"]

316 
def
 
	`_checkBasicRe¥Ú£
 (
auth_m­
, 
·sswÜd
, 
m‘hod
='GET', 
’üy±
=
NÚe
, **
kw¬gs
):

317 #NÙ
th©
 
the
 
Basic
 
»¥Ú£
 
dÛ¢
't…rovidehe„ealm value so we cannot

318 #‹¡ 
™


319 
Œy
:

320  
	`’üy±
(
auth_m­
["·sswÜd"],‡uth_m­["u£ºame"]è=ğ
·sswÜd


321 
exû±
 
Ty³E¼Ü
:

322  
	`’üy±
(
auth_m­
["·sswÜd"]è=ğ
·sswÜd


324 
AUTH_RESPONSES
 = {

325 "basic": 
_checkBasicRe¥Ú£
,

326 "dige¡": 
_checkDige¡Re¥Ú£
,

327 
	}
}

329 
def
 
checkRe¥Ú£
 (
auth_m­
, 
·sswÜd
, 
m‘hod
 = "GET", 
’üy±
=
NÚe
, **
kw¬gs
):

331 
Ùh”
 
¬gum’ts
 
th©
 
—ch
 
im¶em’tiÚ
 
might
 
Ãed
.

333 
If
 
the
 
»¥Ú£
 
is
 
of
 
ty³
 'Basic' 
th’
h
funùiÚ
 
has
h
fŞlowšg


334 
sigÇtu»
::

336 
checkBasicRe¥Ú£
 (
auth_m­
, 
·sswÜd
è-> 
boŞ


338 
If
 
the
 
»¥Ú£
 
is
 
of
 
	gty³
 'Dige¡' 
th’
h
funùiÚ
 
has
h
fŞlowšg


339 
	gsigÇtu»
::

341 
checkDige¡Re¥Ú£
 (
auth_m­
, 
·sswÜd
, 
m‘hod
 = 'GET', 
A1
 = 
NÚe
è-> 
boŞ


343 
The
 'A1' 
¬gum’t
 
is
 
Úly
 
u£d
 
š
 
MD5_SESS
 
®gÜ™hm
 
ba£d
 
»¥Ú£s
.

344 
Check
 
	$md5SessiÚKey
(è
mÜe
 
šfo
.

346 
check”
 = 
AUTH_RESPONSES
[
auth_m­
["auth_scheme"]]

347  
	`check”
 (
auth_m­
, 
·sswÜd
, 
m‘hod
=m‘hod, 
’üy±
ónüy±, **
kw¬gs
)

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/lib/httputil.py

3 
This
 
moduË
 
cÚšs
 
funùiÚs
 
budšg
 
ª
 
HTTP
 
­¶iÿtiÚ


4 
	gäamewÜk
: 
ªy
 
Úe
, 
nÙ
 
ju¡
 oÃ 
who£
 
Çme
 
¡¬ts
 
	gw™h
 "Ch". ;è
If
 
you


5 
»ã»nû
 
ªy
 
moduËs
 
äom
 
some
 
pİuÏr
 
äamewÜk
 
šside
 *
this
* 
	gmoduË
,

6 
FuMªChu
 
wl
 
³rsÚ®ly
 
hªg
 
you
 
up
 
by
 
your
 
thumbs
 
ªd
 
subm™
 you

7 
to
 
a
 
public
 
	gÿnšg
.

10 
äom
 
bšascii
 
impÜt
 
b2a_ba£64


11 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
	gBa£HTTPReque¡HªdËr
, 
	gHTTPD©e
, 
	gÁob
, 
	gÁou
, 
	g»v”£d
, 
sÜ‹d


12 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
	gba£¡ršg
, 
	gby‹¡r
, 
	g™”™ems
, 
	gÇtive¡r
, 
	gunicode¡r
, 
unquÙe_qs


13 
	g»¥Ú£_codes
 = 
Ba£HTTPReque¡HªdËr
.
»¥Ú£s
.
	$cİy
()

15 #From 
h‰p
:

16 
»¥Ú£_codes
[500] = ('Internal Server Error',

19 
»¥Ú£_codes
[503] = ('Service Unavailable',

24 
impÜt
 
»


25 
impÜt
 
u¾lib


29 
def
 
	$u¾još
(*
©oms
):

32 
This
 
wl
 
cÜ»ùly
 
još
 
a
 
SCRIPT_NAME
 
ªd
 
PATH_INFO
 
što
 
the


33 
Üigš®
 
URL
, 
ev’
 
e™h”
 
©om
 
is
 
bÏnk
.

35 
u¾
 = "/".
	$još
([
x
 x 
š
 
©oms
 x])

36 "//" 
š
 
u¾
:

37 
u¾
 = u¾.
	`»¶aû
("//", "/")

38 #S³cŸl-
the
 
fš®
 
u¾
 
of
 "", 
ªd
  "/" 
š¡—d
.

39  
u¾
 
Ü
 "/"

41 
def
 
	$u¾još_by‹s
(*
©oms
):

44 
This
 
wl
 
cÜ»ùly
 
još
 
a
 
SCRIPT_NAME
 
ªd
 
PATH_INFO
 
što
 
the


45 
Üigš®
 
URL
, 
ev’
 
e™h”
 
©om
 
is
 
bÏnk
.

47 
u¾
 = 
	`Áob
("/").
	$još
([
x
 x 
š
 
©oms
 x])

48 
	`Áob
("//"è
š
 
u¾
:

49 
u¾
 = u¾.
	`»¶aû
(
	`Áob
("//"),‚tob("/"))

50 #S³cŸl-
the
 
fš®
 
u¾
 
of
 "", 
ªd
  "/" 
š¡—d
.

51  
u¾
 
Ü
 
	`Áob
("/")

53 
def
 
	$´ÙocŞ_äom_h‰p
(
´ÙocŞ_¡r
):

55  (
´ÙocŞ_¡r
[5]), (protocol_str[7])

57 
def
 
	$g‘_¿nges
(
h—d”v®ue
, 
cÚ‹Á_Ëngth
):

60 
	$Each
 (
¡¬t
, 
¡İ
è
tu¶e
 
wl
 
be
 
compo£d
 
of
 
two
 
šts
, 
which
 
¬e
 
su™abË


61 
u£
 
š
 
a
 
¦icšg
 
İ”©iÚ
. 
Th©
 
is
, 
the
 
h—d”
 "Range: bytes=3-6",

62 
­¶›d
 
agaš¡
 
a
 
PythÚ
 
¡ršg
, 
is
 
»que¡šg
 
»sourû
[3:7]. 
This


63 
funùiÚ
 
wl
  
the
 
li¡
 [(3, 7)].

65 
If
 
this
 
funùiÚ
 
»tuºs
 
ª
 
em±y
 
li¡
, 
you
 
should
  
HTTP
 416.

68 
nÙ
 
h—d”v®ue
:

69  
NÚe


71 
»suÉ
 = []

72 
by‹sun™
, 
by‹¿nges
 = 
h—d”v®ue
.
	`¥l™
("=", 1)

73 
b¿nge
 
š
 
by‹¿nges
.
	`¥l™
(","):

74 
¡¬t
, 
¡İ
 = [
x
.
	$¡r
(è
x
 
š
 
b¿nge
.
	`¥l™
("-", 1)]

75 
¡¬t
:

76 
nÙ
 
¡İ
:

77 
¡İ
 = 
cÚ‹Á_Ëngth
 - 1

78 
¡¬t
, 
¡İ
 = (start), (stop)

79 
¡¬t
 >ğ
cÚ‹Á_Ëngth
:

80 #From 
rfc
 2616 
£c
 14.16:

81 #"
If
 
the
 
£rv”
 
»ûives
 
a
 
	`»que¡
 (
Ùh”
 
thª
 
Úe


82 #šşudšg 
ª
 
If
-
Rªge
 
»que¡
-
h—d”
 
f›ld
è
w™h
‡n

83 #un§tisfŸbË 
Rªge
 
»que¡
-
h—d”
 
	`f›ld
 (
th©
 
is
,

84 #®È
of
 
who£
 
by‹
-
¿nge
-
¥ec
 
v®ues
 
have
 
a
 
fœ¡
-by‹-
pos


85 #v®u
g»©”
 
thª
 
the
 
cu¼’t
 
Ëngth
 
of
h
£Ëùed


86 #»sourû), 
™
 
SHOULD
  
a
 
»¥Ú£
 
code
 
of
 416

87 #(
Reque¡ed
 
¿nge
 
nÙ
 
§tisfŸbË
)."

89 
¡İ
 < 
¡¬t
:

90 #From 
rfc
 2616 
£c
 14.16:

91 #"
If
 
the
 
£rv”
 
ignÜes
 
a
 
by‹
-
¿nge
-
¥ec
 
beÿu£
 
™


92 #i 
syÁaùiÿÎy
 
šv®id
, 
the
 
£rv”
 
SHOULD
 
Œ—t


93 #th
»que¡
 
as
 
the
 
šv®id
 
Rªge
 
h—d”
 
f›ld


94 #did 
nÙ
 
exi¡
. (
NÜm®ly
, 
this
 
m—ns
  
a
 200

95 #»¥Ú£ 
cÚššg
 
the
 
fuÎ
 
’t™y
)."

96  
NÚe


97 
»suÉ
.
	`­³nd
((
¡¬t
, 
¡İ
 + 1))

99 
nÙ
 
¡İ
:

100 #S“ 
rfc
 
quÙe
 
above
.

101  
NÚe


102 #Neg©iv
	`subsüt
 (
Ï¡
 
N
 
by‹s
)

103 
»suÉ
.
	`­³nd
((
cÚ‹Á_Ëngth
 - (
¡İ
), content_length))

105  
»suÉ


108 
şass
 
	$H—d”EËm’t
(
objeù
):

111 
def
 
	$__š™__
(
£lf
, 
v®ue
, 
·¿ms
=
NÚe
):

112 
£lf
.
v®ue
 = value

113 
·¿ms
 
is
 
NÚe
:

114 
·¿ms
 = {
	}
}

115 
£lf
.
·¿ms
 =…arams

117 
def
 
	$__cmp__
(
£lf
, 
Ùh”
):

118  
	$cmp
(
£lf
.
v®ue
, 
Ùh”
.value)

120 
def
 
	$__É__
(
£lf
, 
Ùh”
):

121  
£lf
.
v®ue
 < 
Ùh”
.value

123 
def
 
	$__¡r__
(
£lf
):

124 
p
 = [";%s=%s" % (
k
, 
v
èk, v 
š
 
	`™”™ems
(
£lf
.
·¿ms
)]

125  
	`¡r
("%s%s" % (
£lf
.
v®ue
, "".
	$još
(
p
)))

127 
def
 
	$__by‹s__
(
£lf
):

128  
	`Áob
(
£lf
.
	$__¡r__
())

130 
def
 
	$__unicode__
(
£lf
):

131  
	`Áou
(
£lf
.
	$__¡r__
())

133 
def
 
	$·r£
(
–em’t¡r
):

135 #S¶™ 
the
 
–em’t
 
što
 
a
 
v®ue
 
ªd
 
·¿m‘”s
. 
The
 'v®ue' 
may


136 #b
of
 
the
 
fÜm
, "tok’ñok’", 
but
 
we
 
dÚ
't splithat here.

137 
©oms
 = [
x
.
	$¡r
(è
x
 
š
 
–em’t¡r
.
	`¥l™
(";"èx.
	`¡r
()]

138 
nÙ
 
©oms
:

139 
š™Ÿl_v®ue
 = ''

141 
š™Ÿl_v®ue
 = 
©oms
.
	`pİ
(0).
	$¡r
()

142 
·¿ms
 = {
	}
}

143 
©om
 
š
 
©oms
:

144 
©om
 = [
x
.
	$¡r
(è
x
 
š
 
©om
.
	`¥l™
("=", 1èx.
	`¡r
()]

145 
key
 = 
©om
.
	$pİ
(0)

146 
©om
:

147 
v®
 = 
©om
[0]

149 
v®
 = ""

150 
·¿ms
[
key
] = 
v®


151  
š™Ÿl_v®ue
, 
·¿ms


152 
·r£
 = 
	$¡©icm‘hod
(
·r£
)

154 
def
 
	$äom_¡r
(
şs
, 
–em’t¡r
):

156 
iv®
, 
·¿ms
 = 
şs
.
	$·r£
(
–em’t¡r
)

157  
	$şs
(
iv®
, 
·¿ms
)

158 
äom_¡r
 = 
	$şassm‘hod
(
äom_¡r
)

161 
q_£·¿tÜ
 = 
»
.
	`compe
(
r
'; *q *=')

163 
şass
 
	$Acû±EËm’t
(
H—d”EËm’t
):

166 
Acû±EËm’t
 
objeùs
 
¬e
 
com·¿bË
; 
the
 
mÜe
-
´eã¼ed
 
objeù
 
wl
 
be


167 "Ës thª" 
the
 
Ëss
-
´eã¼ed
 
objeù
. 
They
 
¬e
 
®so
 
th”efÜe
 
sÜbË
;

168 
you
 
sÜt
 
a
 
li¡
 
of
 
Acû±EËm’t
 
objeùs
, 
they
 
wl
 
be
 
li¡ed
 
š


169 
´iÜ™y
 
Üd”
; 
the
 
mo¡
 
´eã¼ed
 
v®ue
 
wl
 
be
 
fœ¡
. 
Yes
, 
™
 
should


170 
have
 
b“n
 
the
 
Ùh”
 
way
 
¬ound
, 
but
 
™
'soo†ateo fix‚ow.

173 
def
 
	$äom_¡r
(
şs
, 
–em’t¡r
):

174 
qv®ue
 = 
NÚe


175 #Th
fœ¡
 "q" 
	`·¿m‘”
 (
ªy
è
£·¿‹s
 
the
 
š™Ÿl


176 #medŸ-
¿nge
 
	`·¿m‘”
(
s
è(
ªy
è
äom
 
the
 
acû±
-
·¿ms
.

177 
©oms
 = 
q_£·¿tÜ
.
	$¥l™
(
–em’t¡r
, 1)

178 
medŸ_¿nge
 = 
©oms
.
	`pİ
(0).
	$¡r
()

179 
©oms
:

180 #Th
qv®ue
 
ª
 
Acû±
 
h—d”
 
ÿn
 
have
 
ex‹nsiÚs
. 
The
 
Ùh”


181 #h—d” 
ÿÂÙ
, 
but
 
™
'sƒasiero…arsehem‡s ifhey did.

182 
qv®ue
 = 
H—d”EËm’t
.
	`äom_¡r
(
©oms
[0].
	$¡r
())

184 
medŸ_ty³
, 
·¿ms
 = 
şs
.
	$·r£
(
medŸ_¿nge
)

185 
qv®ue
 
is
 
nÙ
 
NÚe
:

186 
·¿ms
["q"] = 
qv®ue


187  
	$şs
(
medŸ_ty³
, 
·¿ms
)

188 
äom_¡r
 = 
	$şassm‘hod
(
äom_¡r
)

190 
def
 
	$qv®ue
(
£lf
):

191 
v®
 = 
£lf
.
·¿ms
.
	`g‘
("q", "1")

192 
	$isš¡ªû
(
v®
, 
H—d”EËm’t
):

193 
v®
 = v®.
v®ue


194  (
v®
)

195 
qv®ue
 = 
	`´İ”ty
(qv®ue, 
doc
="The qvalue, or…riority, ofhis value.")

197 
def
 
	$__cmp__
(
£lf
, 
Ùh”
):

198 
diff
 = 
	$cmp
(
£lf
.
qv®ue
, 
Ùh”
.qvalue)

199 
diff
 == 0:

200 
diff
 = 
	`cmp
(
	`¡r
(
£lf
), 
	$¡r
(
Ùh”
))

201  
diff


203 
def
 
	$__É__
(
£lf
, 
Ùh”
):

204 
£lf
.
qv®ue
 =ğ
Ùh”
.qvalue:

205  
	`¡r
(
£lf
è< 
	$¡r
(
Ùh”
)

207  
£lf
.
qv®ue
 < 
Ùh”
.qvalue

210 
def
 
	$h—d”_–em’ts
(
f›ldÇme
, 
f›ldv®ue
):

212 
nÙ
 
f›ldv®ue
:

215 
»suÉ
 = []

216 
–em’t
 
š
 
f›ldv®ue
.
	`¥l™
(","):

217 
f›ldÇme
.
	`¡¬tsw™h
("Acû±"è
Ü
 fieldname == 'TE':

218 
hv
 = 
Acû±EËm’t
.
	$äom_¡r
(
–em’t
)

220 
hv
 = 
H—d”EËm’t
.
	$äom_¡r
(
–em’t
)

221 
»suÉ
.
	$­³nd
(
hv
)

223  
	`li¡
(
	`»v”£d
(
	$sÜ‹d
(
»suÉ
)))

225 
def
 
	$decode_TEXT
(
v®ue
):

226 
r
"""Decod:rfc:`2047` TEXT (e.g. "=?
utf
-8?
q
?
f
=
C3
=
BCr
?=" -> "f\
xfü
")."""

227 
Œy
:

229 
äom
 
ema
.
h—d”
 
impÜt
 
decode_h—d”


230 
exû±
 
ImpÜtE¼Ü
:

231 
äom
 
ema
.
H—d”
 
impÜt
 
decode_h—d”


232 
©oms
 = 
	$decode_h—d”
(
v®ue
)

233 
decodedv®ue
 = ""

234 
©om
, 
ch¬£t
 
š
 
©oms
:

235 
ch¬£t
 
is
 
nÙ
 
NÚe
:

236 
©om
 =‡tom.
	$decode
(
ch¬£t
)

237 
decodedv®ue
 +ğ
©om


238  
decodedv®ue


240 
def
 
	$v®id_¡©us
(
¡©us
):

243 
The
 
¡©us
 
¬g
 
mu¡
 
be
 
ª
 , 
Ü
 
a
 
¡r
 
th©
 
begšs
 
w™h
‡n .

245 
If
 
¡©us
 
is
 
ª
 , 
Ü
 
a
 
¡r
 
ªd
 
no
 
»asÚ
-
ph¿£
 i 
suµl›d
,

246 
a
  
»asÚ
-
ph¿£
 
wl
 
be
 
´ovided
.

249 
nÙ
 
¡©us
:

250 
¡©us
 = 200

252 
¡©us
 = 
	$¡r
(
¡©us
)

253 
·¹s
 = 
¡©us
.
	`¥l™
(" ", 1)

254 
	`Ën
(
·¹s
) == 1:

255 #NØ
»asÚ
 
suµl›d
.

256 
code
, = 
·¹s


257 
»asÚ
 = 
NÚe


259 
code
, 
»asÚ
 = 
·¹s


260 
»asÚ
 =„—sÚ.
	$¡r
()

262 
Œy
:

263 
code
 = (code)

264 
exû±
 
V®ueE¼Ü
:

265 
¿i£
 
	`V®ueE¼Ü
("Illegal„esponse status from server "

266 "(% i nÚ-num”ic)." % 
	$»´
(
code
))

268 
code
 < 100 
Ü
 code > 599:

269 
¿i£
 
	`V®ueE¼Ü
("Illegal„esponse status from server "

270 "(% i ouˆoà¿nge)." % 
	$»´
(
code
))

272 
code
 
nÙ
 
š
 
»¥Ú£_codes
:

273 #cod
is
 
unknown
 
but
 
nÙ
 
Ëg®


274 
deçuÉ_»asÚ
, 
mes§ge
 = "", ""

276 
deçuÉ_»asÚ
, 
mes§ge
 = 
»¥Ú£_codes
[
code
]

278 
»asÚ
 
is
 
NÚe
:

279 
»asÚ
 = 
deçuÉ_»asÚ


281  
code
, 
»asÚ
, 
mes§ge


284 #NOTE: 
the
 
·r£_qs
 
funùiÚs
 
th©
 
fŞlow
 
¬e
 
modif›d
 
v”siÚ
 
of
 
tho£


285 #š 
the
 
pythÚ3
.0 
sourû
 - 
we
 
Ãed
 
to
 
·ss
 
through
 
ª
 
’codšg
Øth
unquÙe


286 #m‘hod, 
but
 
the
  
·r£_qs
 
funùiÚ
 
dÛ¢
't‡llow uso. These do.

288 
def
 
	`_·r£_qs
(
qs
, 
k“p_bÏnk_v®ues
=0, 
¡riù_·rsšg
=0, 
’codšg
='utf-8'):

291 
Argum’ts
:

293 
qs
: 
URL
-
’coded
 
qu”y
 
¡ršg
 
to
 
be
 
·r£d


295 
k“p_bÏnk_v®ues
: 
æag
 
šdiÿtšg
 
wh‘h”
 
bÏnk
 
v®ues
 
š


296 
URL
 
’coded
 
qu”›s
 
should
 
be
 
Œ—‹d
 
as
 
bÏnk
 
¡ršgs
. 
A


297 
Œue
 
v®ue
 
šdiÿ‹s
 
th©
 
bÏnks
 
should
 
be
 
»šed
 
as
 
bÏnk


298 
¡ršgs
. 
The
  
çl£
 
v®ue
 
šdiÿ‹s
 
th©
 
bÏnk
 
v®ues


299 
¬e
 
to
 
be
 
ignÜed
 
ªd
 
Œ—‹d
 
as
 
they
 
w”e
 
nÙ
 
šşuded
.

301 
¡riù_·rsšg
: 
æag
 
šdiÿtšg
 
wh©
 
to
 dØ
w™h
 
·rsšg
 
”rÜs
. 
If


302 
	`çl£
 (
the
 ), 
”rÜs
 
¬e
 
s’y
 
ignÜed
. 
If
 
Œue
,

303 
”rÜs
 
¿i£
 
a
 
V®ueE¼Ü
 
exû±iÚ
.

305 
R‘uºs
 
a
 
diù
, 
as
 
G
-
d
 
š‹nded
.

307 
·œs
 = [
s2
 
s1
 
š
 
qs
.
	`¥l™
('&') s2 in s1.split(';')]

308 
d
 = {
	}
}

309 
Çme_v®ue
 
š
 
·œs
:

310 
nÙ
 
Çme_v®ue
 
ªd
‚Ù 
¡riù_·rsšg
:

312 
nv
 = 
Çme_v®ue
.
¥l™
('=', 1)

313 
Ën
(
nv
) != 2:

314 
¡riù_·rsšg
:

315 
¿i£
 
V®ueE¼Ü
("bad qu”y f›ld: %r" % (
Çme_v®ue
,))

316 #HªdË 
of
 
a
 
cÚŒŞ
-
Çme
 
w™h
 
no
 
equ®
 
sign


317 
	gk“p_bÏnk_v®ues
:

318 
nv
.
­³nd
('')

321 
	$Ën
(
nv
[1]è
Ü
 
k“p_bÏnk_v®ues
:

322 
Çme
 = 
	$unquÙe_qs
(
nv
[0], 
’codšg
)

323 
v®ue
 = 
	$unquÙe_qs
(
nv
[1], 
’codšg
)

324 
Çme
 
š
 
d
:

325 
nÙ
 
	$isš¡ªû
(
d
[
Çme
], 
li¡
):

326 
d
[
Çme
] = [d[name]]

327 
d
[
Çme
].
	$­³nd
(
v®ue
)

329 
d
[
Çme
] = 
v®ue


330  
d


333 
image_m­_·‰”n
 = 
»
.
	`compe
(
r
"[0-9]+,[0-9]+")

335 
def
 
	`·r£_qu”y_¡ršg
(
qu”y_¡ršg
, 
k“p_bÏnk_v®ues
=
True
, 
’codšg
='utf-8'):

338 
Du¶iÿ‹
 
key
/
v®ue
 
·œs
 
š
 
the
 
´ovided
 
qu”y_¡ršg
 
wl
 
be


339 
»tuºed
 
as
 {'key': [
v®1
, 
v®2
, ...]
	}
}. 
SšgË
 
key
/
v®ues
 
wl


340 
be
 
»tuºed
 
as
 
¡ršgs
: {'key': 'value'}.

342 
image_m­_·‰”n
.
	$m©ch
(
qu”y_¡ršg
):

343 #S”v”-
side
 
image
 
m­
. 
M­
 
the
 
coÜds
 
to
 'x' 
ªd
 'y'

344 #(
like
 
CGI
::
Reque¡
 
dÛs
).

345 
pm
 = 
qu”y_¡ršg
.
	`¥l™
(",")

346 
pm
 = {'x': Õm[0]), 'y': Õm[1])
	}
}

348 
pm
 = 
	$_·r£_qs
(
qu”y_¡ršg
, 
k“p_bÏnk_v®ues
, 
’codšg
=encoding)

349  
pm


352 
şass
 
	$Ca£In£ns™iveDiù
(
diù
):

355 
Each
 
key
 
is
 
chªged
 
Ú
 
’Œy
 
to
 
	`¡r
(key).
	`t™Ë
().

358 
def
 
	$__g‘™em__
(
£lf
, 
key
):

359  
diù
.
	`__g‘™em__
(
£lf
, 
	`¡r
(
key
).
	$t™Ë
())

361 
def
 
	$__£t™em__
(
£lf
, 
key
, 
v®ue
):

362 
diù
.
	`__£t™em__
(
£lf
, 
	`¡r
(
key
).
	`t™Ë
(), 
v®ue
)

364 
def
 
	$__d–™em__
(
£lf
, 
key
):

365 
diù
.
	`__d–™em__
(
£lf
, 
	`¡r
(
key
).
	$t™Ë
())

367 
def
 
	$__cÚšs__
(
£lf
, 
key
):

368  
diù
.
	`__cÚšs__
(
£lf
, 
	`¡r
(
key
).
	$t™Ë
())

370 
def
 
	$g‘
(
£lf
, 
key
, =
NÚe
):

371  
diù
.
	`g‘
(
£lf
, 
	`¡r
(
key
).
	`t™Ë
(), )

373 
	`ha§‰r
({
	}
}, 'has_key'):

374 
def
 
	$has_key
(
£lf
, 
key
):

375  
diù
.
	`has_key
(
£lf
, 
	`¡r
(
key
).
	$t™Ë
())

377 
def
 
	$upd©e
(
£lf
, 
E
):

378 
k
 
š
 
E
.
	$keys
():

379 
£lf
[
	`¡r
(
k
).
	`t™Ë
()] = 
E
[k]

381 
def
 
	$äomkeys
(
şs
, 
£q
, 
v®ue
=
NÚe
):

382 
Ãwdiù
 = 
	$şs
()

383 
k
 
š
 
£q
:

384 
Ãwdiù
[
	`¡r
(
k
).
	`t™Ë
()] = 
v®ue


385  
Ãwdiù


386 
äomkeys
 = 
	$şassm‘hod
(
äomkeys
)

388 
def
 
	$£tdeçuÉ
(
£lf
, 
key
, 
x
=
NÚe
):

389 
key
 = 
	`¡r
(key).
	$t™Ë
()

390 
Œy
:

391  
£lf
[
key
]

392 
exû±
 
KeyE¼Ü
:

393 
£lf
[
key
] = 
x


394  
x


396 
def
 
	$pİ
(
£lf
, 
key
, ):

397  
diù
.
	`pİ
(
£lf
, 
	`¡r
(
key
).
	`t™Ë
(), )

400 #TEXT = <
ªy
 
OCTET
 
exû±
 
CTLs
, 
but
 
šşudšg
 
LWS
>

401 #
#A 
CRLF
 
is
 
®lowed
 
š
 
the
 
defš™iÚ
 
of
 
TEXT
 
Úly
 
as
 
·¹
 oà
a
 
h—d”


402 #f›ld 
cÚtšu©iÚ
. 
It
 
is
 
ex³ùed
 
th©
 
the
 
fŞdšg
 
LWS
 
wl
 
be


403 #»¶aûd 
w™h
 
a
 
sšgË
 
SP
 
befÜe
 
š‹½»tiÚ
 
of
 
the
 
TEXT
 
v®ue
."

404 
Çtive¡r
 =ğ
by‹¡r
:

405 
h—d”_Œª¦©e_bË
 = ''.
	`još
([
	$chr
(
i
è˜
š
 
	`x¿nge
(256)])

406 
h—d”_Œª¦©e_d–‘ech¬s
 = ''.
	`još
([
	$chr
(
i
è˜
š
 
	`x¿nge
(32)]è+ 
	$chr
(127)

408 
h—d”_Œª¦©e_bË
 = 
NÚe


409 
h—d”_Œª¦©e_d–‘ech¬s
 = 
	`by‹s
(
	`¿nge
(32)è+ 
	$by‹s
([127])

412 
şass
 
	$H—d”M­
(
Ca£In£ns™iveDiù
):

415 
Each
 
key
 
is
 
chªged
 
Ú
 
’Œy
 
to
 
	`¡r
(key).
	`t™Ë
(). 
This
 
®lows
 
h—d”s


416 
to
 
be
 -
š£ns™ive
 
ªd
 
avoid
 
du¶iÿ‹s
.

418 
V®ues
 
¬e
 
h—d”
 
	`v®ues
 (
decoded
 
accÜdšg
 
to
 :
rfc
:`2047` 
Ãûs§ry
).

421 
´ÙocŞ
=(1, 1)

422 
’codšgs
 = ["ISO-8859-1"]

424 #Someday, 
wh’
 
h‰p
-
bis
 
is
 
dÚe
, 
this
 
wl
 
´obably
 
g‘
 
drİ³d


425 #sšû 
ãw
 
£rv”s
, 
ş›Ás
, 
Ü
 
š‹rmedŸr›s
 dØ
™
. 
But
 
uÁ
 
th’
,

427 #"
WÜds
 
of
 *
TEXT
 
MAY
 
cÚš
 
ch¬aù”s
 
äom
 
ch¬aù”
 
£ts
 
Ùh”
 
thª


428 #ISO-8859-1 
Úly
 
wh’
 
’coded
 
accÜdšg
 
to
 
the
 
ruËs
 
of
 
RFC
 2047."

429 
u£_rfc_2047
 = 
True


431 
def
 
	$–em’ts
(
£lf
, 
key
):

433 
key
 = 
	`¡r
(key).
	$t™Ë
()

434 
v®ue
 = 
£lf
.
	$g‘
(
key
)

435  
	$h—d”_–em’ts
(
key
, 
v®ue
)

437 
def
 
	$v®ues
(
£lf
, 
key
):

439  [
e
.
v®ue
 
š
 
£lf
.
	`–em’ts
(
key
)]

441 
def
 
	$ouut
(
£lf
):

443  
	`li¡
(
£lf
.
	`’code_h—d”_™ems
(£lf.
	$™ems
()))

445 
def
 
	$’code_h—d”_™ems
(
şs
, 
h—d”_™ems
):

447 
P»·»
 
the
 
£qu’û
 
of
 
Çme
, 
v®ue
 
tu¶es
 
što
 
a
 
fÜm
 
su™abË
 

448 
Œªsm™tšg
 
Ú
 
the
 
wœe
 
HTTP
.

450 
k
, 
v
 
š
 
h—d”_™ems
:

451 
	$isš¡ªû
(
k
, 
unicode¡r
):

452 
k
 = 
şs
.
	$’code
(
k
)

454 
nÙ
 
	$isš¡ªû
(
v
, 
ba£¡ršg
):

455 
v
 = 
	$¡r
(
v
)

457 
	$isš¡ªû
(
v
, 
unicode¡r
):

458 
v
 = 
şs
.
	$’code
(
v
)

460 #S“ 
h—d”_Œª¦©e_
* 
cÚ¡ªts
 
above
.

461 #R•Ïû 
Úly
 
you
 
»®ly
 
know
 
wh©
 you're doing.

462 
k
 = k.
	$Œª¦©e
(
h—d”_Œª¦©e_bË
, 
h—d”_Œª¦©e_d–‘ech¬s
)

463 
v
 = v.
	$Œª¦©e
(
h—d”_Œª¦©e_bË
, 
h—d”_Œª¦©e_d–‘ech¬s
)

465 
	$y›ld
 (
k
, 
v
)

466 
’code_h—d”_™ems
 = 
	$şassm‘hod
(
’code_h—d”_™ems
)

468 
def
 
	$’code
(
şs
, 
v
):

470 
’c
 
š
 
şs
.
’codšgs
:

471 
Œy
:

472  
v
.
	$’code
(
’c
)

473 
exû±
 
UnicodeEncodeE¼Ü
:

476 
şs
.
´ÙocŞ
 =ğ(1, 1è
ªd
 cls.
u£_rfc_2047
:

477 #Encod
RFC
-2047 
TEXT


478 #(
e
.
g
. 
u
"\u8200" -> "=?utf-8?b?6IiA?=").

479 #WdØ
our
 
own
 
h”e
 
š¡—d
 
of
 
usšg
 
the
 
ema
 
moduË


480 #beÿu£ 
we
 
Ãv”
 
wªt
 
to
 
fŞd
 
lšes
--
fŞdšg
 
has


481 #b“À
d•»ÿ‹d
 
by
 
the
 
HTTP
 
wÜkšg
 
group
.

482 
v
 = 
	`b2a_ba£64
(v.
	`’code
('utf-8'))

483  (
	`Áob
('=?utf-8?b?'è+ 
v
.
	`¡r
(ntob('\n')) +‚tob('?='))

485 
¿i£
 
	`V®ueE¼Ü
("Could‚otƒncode header…art %r using "

487 (
v
, 
şs
.
’codšgs
))

488 
’code
 = 
	$şassm‘hod
(
’code
)

490 
şass
 
	$Ho¡
(
objeù
):

493 
Çme


494 
Should
 
be
 
the
 
ş›Á
's host‚ame. If‚ot‡vailable (because‚o DNS

495 
lookup
 
is
 
³rfÜmed
), 
the
 
IP
 
add»ss
 
should
 
be
 
u£d
 
š¡—d
.

499 

 = "0.0.0.0"

500 
pÜt
 = 80

501 
Çme
 = "unknown.tld"

503 
def
 
	$__š™__
(
£lf
, 

, 
pÜt
, 
Çme
=
NÚe
):

504 
£lf
.

 = ip

505 
£lf
.
pÜt
 =…ort

506 
Çme
 
is
 
NÚe
:

507 
Çme
 = 



508 
£lf
.
Çme
 =‚ame

510 
def
 
	$__»´__
(
£lf
):

511  "h‰put.Ho¡(%r, %r, %r)" % (
£lf
.

, s–f.
pÜt
, s–f.
Çme
)

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/lib/jsontools.py

1 
impÜt
 
sys


2 
impÜt
 
ch”rypy


3 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
	gba£¡ršg
, 
	gÁou
, 
	gjsÚ
, 
	gjsÚ_’code
, 
jsÚ_decode


5 
def
 
	$jsÚ_´oûssÜ
(
’t™y
):

7 
nÙ
 
’t™y
.
h—d”s
.
	`g‘
(
	`Áou
("Content-Length"),‚tou("")):

8 
¿i£
 
ch”rypy
.
	$HTTPE¼Ü
(411)

10 
body
 = 
’t™y
.
å
.
	$»ad
()

11 
Œy
:

12 
ch”rypy
.
£rvšg
.
»que¡
.
jsÚ
 = 
	`jsÚ_decode
(
body
.
	`decode
('utf-8'))

13 
exû±
 
V®ueE¼Ü
:

14 
¿i£
 
ch”rypy
.
	`HTTPE¼Ü
(400, 'Invalid JSON document')

16 
def
 
	`jsÚ_š
(
cÚ‹Á_ty³
=[
	`Áou
('application/json'),‚tou('text/javascript')],

17 
fÜû
=
True
, 
debug
=
F®£
, 
´oûssÜ
 = 
jsÚ_´oûssÜ
):

19 
The
  
´oûssÜ
 
¶aûs
 
the
 
·r£d
 
d©a
 
što
 
»que¡
.
jsÚ
.

21 
Incomšg
 
»que¡
 
’t™›s
 
which
 
m©ch
 
the
 
giv’
 
	$cÚ‹Á_ty³
(
s
è
wl


22 
be
 
de£rŸlized
 
äom
 
JSON
 
to
 
the
 
PythÚ
 
equiv®’t
, 
ªd
h
»suÉ


23 
¡Üed
 
©
 
ch”rypy
.
»que¡
.
jsÚ
. 
The
 'cÚ‹Á_ty³' 
¬gum’t
 
may


24 
be
 
a
 
CÚ‹Á
-
Ty³
 
¡ršg
 
Ü
‡ 
li¡
 
of
 
®lowabË
 CÚ‹Á-Ty³ 
¡ršgs
.

26 
If
 
the
 'fÜû' 
¬gum’t
 
is
 
	`True
 (th), 
th’
 
’t™›s
 
of
 
Ùh”


27 
cÚ‹Á
 
ty³s
 
wl
 
nÙ
 
be
 
®lowed
; "415 UnsuµÜ‹d MedŸ Ty³" 
is


28 
¿i£d
 
š¡—d
.

30 
Suµly
 
your
 
own
 
´oûssÜ
 
to
 
u£
 
a
 
cu¡om
 
decod”
, 
Ü
Ø
hªdË
 
the
 
·r£d


31 
d©a
 
difã»Ály
. 
The
 
´oûssÜ
 
ÿn
 
be
 
cÚfigu»d
 
vŸ


32 
toŞs
.
jsÚ_š
.
´oûssÜ
 
Ü
 
vŸ
 
the
 
decÜ©Ü
 
m‘hod
.

34 
NÙe
 
th©
 
the
 
de£rŸliz”
 
»quœes
h
ş›Á
 
£nd
 
a
 
CÚ‹Á
-
L’gth


35 
»que¡
 
h—d”
, 
Ü
 
™
 
wl
 
¿i£
 "411 L’gth Requœed". 
If
 
ªy


36 
Ùh”
 
»asÚ
 
the
 
»que¡
 
’t™y
 
ÿÂÙ
 
be
 
de£rŸlized
 
äom
 
JSON
,

37 
™
 
wl
 
¿i£
 "400 Bad Request: Invalid JSON document".

39 
You
 
mu¡
 
be
 
usšg
 
PythÚ
 2.6 
Ü
 
g»©”
, o¸
have
 
the
 'simplejson'

40 
·ckage
 
impÜbË
; 
Ùh”wi£
, 
V®ueE¼Ü
 
is
 
¿i£d
 
duršg
 
´oûssšg
.

42 
»que¡
 = 
ch”rypy
.
£rvšg
.request

43 
	$isš¡ªû
(
cÚ‹Á_ty³
, 
ba£¡ršg
):

44 
cÚ‹Á_ty³
 = [content_type]

46 
fÜû
:

47 
debug
:

48 
ch”rypy
.
	`log
('Removing body…rocessors %s' %

49 
	`»´
(
»que¡
.
body
.
´oûssÜs
.
	`keys
()), 'TOOLS.JSON_IN')

50 
»que¡
.
body
.
´oûssÜs
.
	$ş—r
()

51 
»que¡
.
body
.
deçuÉ_´oc
 = 
ch”rypy
.
	`HTTPE¼Ü
(

53 ', '.
	$još
(
cÚ‹Á_ty³
))

55 
ù
 
š
 
cÚ‹Á_ty³
:

56 
debug
:

57 
ch”rypy
.
	`log
('Addšg body…roûssÜ fÜ %s' % 
ù
, 'TOOLS.JSON_IN')

58 
»que¡
.
body
.
´oûssÜs
[
ù
] = 
´oûssÜ


60 
def
 
	$jsÚ_hªdËr
(*
¬gs
, **
kw¬gs
):

61 
v®ue
 = 
ch”rypy
.
£rvšg
.
»que¡
.
	$_jsÚ_šÃr_hªdËr
(*
¬gs
, **
kw¬gs
)

62  
	$jsÚ_’code
(
v®ue
)

64 
def
 
	`jsÚ_out
(
cÚ‹Á_ty³
='­¶iÿtiÚ/jsÚ', 
debug
=
F®£
, 
hªdËr
=
jsÚ_hªdËr
):

67 
If
 
the
 
giv’
 
cÚ‹Á_ty³
 
is
 
NÚe
,h
CÚ‹Á
-
Ty³
 
»¥Ú£
 
h—d”


68 
is
 
nÙ
 
£t
.

70 
Provide
 
your
 
own
 
hªdËr
 
to
 
u£
 
a
 
cu¡om
 
’cod”
. 
FÜ
 
exam¶e


71 
ch”rypy
.
cÚfig
['toŞs.jsÚ_out.hªdËr'] = <
funùiÚ
>, 
Ü


72 @
	`jsÚ_out
(
hªdËr
=
funùiÚ
).

74 
You
 
mu¡
 
be
 
usšg
 
PythÚ
 2.6 
Ü
 
g»©”
, o¸
have
 
the
 'simplejson'

75 
·ckage
 
impÜbË
; 
Ùh”wi£
, 
V®ueE¼Ü
 
is
 
¿i£d
 
duršg
 
´oûssšg
.

77 
»que¡
 = 
ch”rypy
.
£rvšg
.request

78 
debug
:

79 
ch”rypy
.
	`log
('R•Ïcšg % w™h JSON hªdËr' % 
»que¡
.
hªdËr
,

81 
»que¡
.
_jsÚ_šÃr_hªdËr
 =„eque¡.
hªdËr


82 
»que¡
.
hªdËr
 = handler

83 
cÚ‹Á_ty³
 
is
 
nÙ
 
NÚe
:

84 
debug
:

85 
ch”rypy
.
	`log
('S‘tšg CÚ‹Á-Ty³Ø%s' % 
cÚ‹Á_ty³
, 'TOOLS.JSON_OUT')

86 
ch”rypy
.
£rvšg
.
»¥Ú£
.
h—d”s
['CÚ‹Á-Ty³'] = 
cÚ‹Á_ty³


	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/lib/profiler.py

3 
Ch”ryPy
 
	gu£rs


6 
You
 
ÿn
 
´ofe
 
ªy
 
of
 
your
 
·ges
 
as
 
fŞlows
::

8 
äom
 
ch”rypy
.
lib
 
impÜt
 
´of”


10 
şass
 
RoÙ
:

11 
p
 = 
´ofe
.
Prof”
("/path/to/profile/dir")

13 
def
 
	$šdex
(
£lf
):

14 
£lf
.
p
.
	$run
(
£lf
.
_šdex
)

15 
šdex
.
expo£d
 = 
True


17 
def
 
	$_šdex
(
£lf
):

20 
ch”rypy
.
Œ“
.
	`mouÁ
(
	$RoÙ
())

22 
You
 
ÿn
 
®so
 
tuº
 
Ú
 
´ofšg
 
®l
 
»que¡s


23 
usšg
 
the
 ``
make_­p
`` 
funùiÚ
 
as
 
WSGI
 
middËw¬e
.

25 
Ch”ryPy
 
dev–İ”s


28 
This
 
moduË
 
ÿn
 
be
 
u£d
 
wh’ev”
 
you
 
make
 
chªges
 
to
 
Ch”ryPy
,

29 
to
 
g‘
 
a
 
quick
 
§n™y
-
check
 
Ú
 
ov”®l
 
CP
 
³rfÜmªû
. 
U£
 
the


30 ``--
´ofe
`` 
æag
 
wh’
 
ruÂšg
 
the
 
‹¡
 
su™e
. 
Th’
, 
u£
h``
	`£rve
()``

31 
funùiÚ
 
to
 
brow£
 
the
 
»suÉs
 
š
 
a
 
web
 
brow£r
. 
If
 
you
 
run
 
this


32 
moduË
 
äom
 
the
 
commªd
 
lše
, 
™
 
wl
 
ÿÎ
 ``
	`£rve
()`` 
you
.

37 
def
 
	$Ãw_func_¡r_·th
(
func_Çme
):

39 
f’ame
, 
lše
, 
Çme
 = 
func_Çme


40 
f’ame
.
	`’dsw™h
("__init__.py"):

41  
os
.
·th
.
	`ba£Çme
(
f’ame
[:-12]è+ f’ame[-12:], 
lše
, 
Çme


42  
os
.
·th
.
	`ba£Çme
(
f’ame
), 
lše
, 
Çme


44 
Œy
:

45 
impÜt
 
´ofe


46 
impÜt
 
p¡©s


47 
p¡©s
.
func_¡r_·th
 = 
Ãw_func_¡r_·th


48 
exû±
 
ImpÜtE¼Ü
:

49 
´ofe
 = 
NÚe


50 
p¡©s
 = 
NÚe


52 
impÜt
 
os
, os.
·th


53 
impÜt
 
sys


54 
impÜt
 
w¬nšgs


56 
äom
 
ch”rypy
.
_ıcom·t
 
impÜt
 
By‹sIO


58 
_couÁ
 = 0

60 
şass
 
	$Prof”
(
objeù
):

62 
def
 
	$__š™__
(
£lf
, 
·th
=
NÚe
):

63 
nÙ
 
·th
:

64 
·th
 = 
os
.·th.
	`još
(os.·th.
	`dœÇme
(
__fe__
), "profile")

65 
£lf
.
·th
 =…ath

66 
nÙ
 
os
.
·th
.
	$exi¡s
(
·th
):

67 
os
.
	$makedœs
(
·th
)

69 
def
 
	$run
(
£lf
, 
func
, *
¬gs
, **
·¿ms
):

71 
glob®
 
_couÁ


72 
c
 = 
_couÁ
 = _count + 1

73 
·th
 = 
os
.·th.
	`još
(
£lf
.·th, "ı_%04d.´of" % 
c
)

74 
´of
 = 
´ofe
.
	$Profe
()

75 
»suÉ
 = 
´of
.
	$runÿÎ
(
func
, *
¬gs
, **
·¿ms
)

76 
´of
.
	$dump_¡©s
(
·th
)

77  
»suÉ


79 
def
 
	$¡©fes
(
£lf
):

82  [
f
 à
š
 
os
.
	$li¡dœ
(
£lf
.
·th
)

83 
f
.
	`¡¬tsw™h
("ı_"è
ªd
 f.
	`’dsw™h
(".prof")]

85 
def
 
	`¡©s
(
£lf
, 
f’ame
, 
sÜtby
='cumulative'):

88 
sio
 = 
	$By‹sIO
()

89 
sys
.
v”siÚ_šfo
 >= (2, 5):

90 
s
 = 
p¡©s
.
	`Sts
(
os
.
·th
.
	`još
(
£lf
.·th, 
f’ame
), 
¡»am
=
sio
)

91 
s
.
	$¡r_dœs
()

92 
s
.
	$sÜt_¡©s
(
sÜtby
)

93 
s
.
	$´št_¡©s
()

95 #p¡©s.
Sts
 
befÜe
 
PythÚ
 2.5 
didn
'ˆk¨'
¡»am
'‡rg,

96 #buˆ
ju¡
 
´š‹d
 
to
 
¡dout
. 
So
 
»
-
rou‹
 stdout.

97 
s
 = 
p¡©s
.
	`Sts
(
os
.
·th
.
	$još
(
£lf
.
·th
, 
f’ame
))

98 
s
.
	$¡r_dœs
()

99 
s
.
	$sÜt_¡©s
(
sÜtby
)

100 
Şdout
 = 
sys
.
¡dout


101 
Œy
:

102 
sys
.
¡dout
 = 
sio


103 
s
.
	$´št_¡©s
()

104 
fš®ly
:

105 
sys
.
¡dout
 = 
Şdout


106 
»¥Ú£
 = 
sio
.
	$g‘v®ue
()

107 
sio
.
	$şo£
()

108  
»¥Ú£


110 
def
 
	$šdex
(
£lf
):

112 <
h—d
><
t™Ë
>
Ch”ryPy
 
´ofe
 
d©a
</title></head>

113 <
äame£t
 
cŞs
='200, 1*'>

114 <
äame
 
¤c
='menu' />

115 <
äame
 
Çme
='maš' 
¤c
='' />

116 </
äame£t
>

117 </
html
>

119 
šdex
.
expo£d
 = 
True


121 
def
 
	$m’u
(
£lf
):

122 
y›ld
 "<h2>Profiling„uns</h2>"

123 
y›ld
 "<p>Click on one ofhe„uns belowo see…rofiling data.</p>"

124 
runs
 = 
£lf
.
	$¡©fes
()

125 
runs
.
	$sÜt
()

126 
i
 
š
 
runs
:

127 
y›ld
 "<¨h»f='»pÜt?f’ame=%s'¬g‘='maš'>%s</a><b¸/>" % (
i
, i)

128 
m’u
.
expo£d
 = 
True


130 
def
 
	$»pÜt
(
£lf
, 
f’ame
):

131 
impÜt
 
ch”rypy


132 
ch”rypy
.
»¥Ú£
.
h—d”s
['Content-Type'] = 'text/plain'

133  
£lf
.
	$¡©s
(
f’ame
)

134 
»pÜt
.
expo£d
 = 
True


137 
şass
 
	$ProfeAgg»g©Ü
(
Prof”
):

139 
def
 
	$__š™__
(
£lf
, 
·th
=
NÚe
):

140 
Prof”
.
	$__š™__
(
£lf
, 
·th
)

141 
glob®
 
_couÁ


142 
£lf
.
couÁ
 = 
_couÁ
 = _count + 1

143 
£lf
.
´of”
 = 
´ofe
.
	$Profe
()

145 
def
 
	$run
(
£lf
, 
func
, *
¬gs
):

146 
·th
 = 
os
.·th.
	`još
(
£lf
.·th, "ı_%04d.´of" % s–f.
couÁ
)

147 
»suÉ
 = 
£lf
.
´of”
.
	$runÿÎ
(
func
, *
¬gs
)

148 
£lf
.
´of”
.
	$dump_¡©s
(
·th
)

149  
»suÉ


152 
şass
 
make_­p
:

153 
def
 
	$__š™__
(
£lf
, 
Ãxµ
, 
·th
=
NÚe
, 
agg»g©e
=
F®£
):

156 
Ãxµ


157 
the
 
WSGI
 
­¶iÿtiÚ
 
to
 
w¿p
, 
usu®ly
 
ª
 
š¡ªû
 
of


158 
ch”rypy
.
AµliÿtiÚ
.

160 
·th


161 
wh”e
 
to
 
dump
 
the
 
´ofšg
 
ouut
.

163 
agg»g©e


164 
True
, 
´ofe
 
d©a
 
®l
 
HTTP
 
»que¡s
 
wl
 
go
 
š


165 
a
 
sšgË
 
fe
. 
If
 
	`F®£
 (
the
 ), 
—ch
 
HTTP
 
»que¡
 
wl


166 
dump
 
™s
 
´ofe
 
d©a
 
što
 
a
 
£·¿‹
 
fe
.

169 
´ofe
 
is
 
NÚe
 
Ü
 
p¡©s
 is None:

170 
msg
 = ("Your installation of Python does‚ot have‡…rofile module. "

173 
w¬nšgs
.
	$w¬n
(
msg
)

175 
£lf
.
Ãxµ
 =‚extapp

176 
£lf
.
agg»g©e
 =‡ggregate

177 
agg»g©e
:

178 
£lf
.
´of”
 = 
	$ProfeAgg»g©Ü
(
·th
)

180 
£lf
.
´of”
 = 
	$Prof”
(
·th
)

182 
def
 
	$__ÿÎ__
(
£lf
, 
’vœÚ
, 
¡¬t_»¥Ú£
):

183 
def
 
	$g©h”
():

184 
»suÉ
 = []

185 
lše
 
š
 
£lf
.
	$Ãxµ
(
’vœÚ
, 
¡¬t_»¥Ú£
):

186 
»suÉ
.
	$­³nd
(
lše
)

187  
»suÉ


188  
£lf
.
´of”
.
	$run
(
g©h”
)

191 
def
 
	$£rve
(
·th
=
NÚe
, 
pÜt
=8080):

192 
´ofe
 
is
 
NÚe
 
Ü
 
p¡©s
 is None:

193 
msg
 = ("Your installation of Python does‚ot have‡…rofile module. "

196 
w¬nšgs
.
	$w¬n
(
msg
)

198 
impÜt
 
ch”rypy


199 
ch”rypy
.
cÚfig
.
	`upd©e
({'£rv”.sock‘_pÜt': (
pÜt
),

202 
	}
})

203 
ch”rypy
.
quick¡¬t
(
	$Prof”
(
·th
))

206 
__Çme__
 == "__main__":

207 
	`£rve
(*
	`tu¶e
(
sys
.
¬gv
[1:]))

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/lib/reprconf.py

3 
CÚfigu¿tiÚ
 
d©a
 
may
 
be
 
suµl›d
 
as
 
a
 
PythÚ
 
	gdiùiÚ¬y
,‡ ¨
	gf’ame
,

4 
Ü
 
as
 
ª
 
İ’
 
fe
 
	gobjeù
. 
Wh’
 
you
 
suµly
 
a
 
f’ame
 o¸
	gfe
, 
	gPythÚ
's

5 
butš
 
CÚfigP¬£r
 
is
 
u£d
 (
w™h
 
some
 
ex‹nsiÚs
).

7 
	gName¥aûs


10 
CÚfigu¿tiÚ
 
keys
 
¬e
 
£·¿‹d
 
što
 
Çme¥aûs
 
by
 
the
 
	gfœ¡
 "." 
š
h
	gkey
.

12 
The
 
Úly
 
key
 
th©
 
ÿÂÙ
 
exi¡
 
š
 
a
 
Çme¥aû
 
is
 
	gthe
 "’vœÚm’t" 
	g’Œy
.

13 
This
 
¥ecŸl
 
	g’Œy
 'impÜts' 
Ùh”
 
cÚfig
 
’Œ›s
 
äom
 
a
 
‹m¶©e
 
¡Üed
 
š


14 
the
 
	gCÚfig
.
’vœÚm’ts
 
	gdiù
.

16 
You
 
ÿn
 
defše
 
your
 
own
 
Çme¥aûs
 
to
 
be
 
ÿÎed
 
wh’
 
Ãw
 
cÚfig
 
is
 
m”ged


17 
by
 
addšg
 
a
 
Çmed
 
hªdËr
 
to
 
	gCÚfig
.
	gÇme¥aûs
. 
The
 
Çme
 
ÿn
 
be
 
ªy
 
	g¡ršg
,

18 
ªd
 
the
 
hªdËr
 
mu¡
 
be
 
e™h”
 
a
 
ÿÎabË
 
Ü
‡ 
cÚ‹xt
 
	gmªag”
.

21 
	gŒy
:

23 
äom
 
cÚfig·r£r
 
impÜt
 
CÚfigP¬£r


24 
exû±
 
ImpÜtE¼Ü
:

25 
äom
 
CÚfigP¬£r
 
impÜt
 ConfigParser

27 
Œy
:

28 
£t


29 
exû±
 
NameE¼Ü
:

30 
äom
 
£ts
 
impÜt
 
S‘
 
as
 
£t


32 
Œy
:

33 
ba£¡ršg


34 
exû±
 
NameE¼Ü
:

35 
ba£¡ršg
 = 
¡r


37 
Œy
:

39 
impÜt
 
butšs


40 
exû±
 
ImpÜtE¼Ü
:

42 
impÜt
 
__butš__
 
as
 
butšs


44 
impÜt
 
İ”©Ü
 
as
 
_İ”©Ü


45 
impÜt
 
sys


47 
def
 
	$as_diù
(
cÚfig
):

49 
	$isš¡ªû
(
cÚfig
, 
ba£¡ršg
):

50 
cÚfig
 = 
	`P¬£r
().
	$diù_äom_fe
(
cÚfig
)

51 
–if
 
	`ha§‰r
(
cÚfig
, 'read'):

52 
cÚfig
 = 
	`P¬£r
().
	$diù_äom_fe
(
cÚfig
)

53  
cÚfig


56 
şass
 
	$Name¥aûS‘
(
diù
):

59 
Each
 
cÚfig
 
’Œy
 
should
 
begš
 
w™h
 
a
 
Çme¥aû
 
Çme
; 
the
 
cÜ»¥Údšg


60 
Çme¥aû
 
hªdËr
 
wl
 
be
 
ÿÎed
 
Úû
 
—ch
 
cÚfig
 
’Œy
 
š
 
th©


61 
Çme¥aû
, 
ªd
 
wl
 
be
 
·s£d
 
two
 
¬gum’ts
: 
the
 
cÚfig
 
	$key
 (
w™h
 
the


62 
Çme¥aû
 
»moved
è
ªd
 
the
 
cÚfig
 
v®ue
.

64 
Name¥aû
 
hªdËrs
 
may
 
be
 
ªy
 
PythÚ
 
ÿÎabË
; 
they
 may 
®so
 be

65 
PythÚ
 2.5-
¡yË
 'cÚ‹xˆmªag”s', 
š
 
which
 
theœ
 
__’‹r__


66 
m‘hod
 
should
  
a
 
ÿÎabË
 
to
 
be
 
u£d
 
as
 
the
 
hªdËr
.

67 
S“
 
ch”rypy
.
	$toŞs
 (
the
 
ToŞbox
 
şass
è
ª
 
exam¶e
.

70 
def
 
	$__ÿÎ__
(
£lf
, 
cÚfig
):

73 
cÚfig


74 
A
 
æ©
 
diù
, 
wh”e
 
keys
 
u£
 
dÙs
 
to
 
£·¿‹


75 
Çme¥aûs
, 
ªd
 
v®ues
 
¬e
 
¬b™¿ry
.

77 
The
 
fœ¡
 
Çme
 
š
 
—ch
 
cÚfig
 
key
 
is
 
u£d
 
to
 
look
 
up
 
the
 
cÜ»¥Údšg


78 
Çme¥aû
 
hªdËr
. 
FÜ
 
exam¶e
, 
a
 
cÚfig
 
’Œy
 
of
 {'toŞs.gz.Ú': 
v
}

79 
wl
 
ÿÎ
 
the
 'toŞs' 
Çme¥aû
 
hªdËr
 
w™h
h
¬gs
: ('gz.Ú', 
	gv
)

81 #S•¬©
the
 
giv’
 
cÚfig
 
što
 
Çme¥aûs


82 
	gns_cÚfs
 = {}

83 
k
 
š
 
cÚfig
:

84 "." 
š
 
k
:

85 
ns
, 
	gÇme
 = 
k
.
¥l™
(".", 1)

86 
	gbuck‘
 = 
ns_cÚfs
.
£tdeçuÉ
(
ns
, {})

87 
	gbuck‘
[
Çme
] = 
cÚfig
[
k
]

89 #I 
cho£
 
__’‹r__
 
ªd
 
__ex™__
 
so
 
someday
 
this
 
could
 
be


90 #»wr™‹À
usšg
 
PythÚ
 2.5' '
w™h
' statement:

91 #fÜ 
ns
, 
hªdËr
 
š
 
£lf
.
™”™ems
():

92 #w™h 
hªdËr
 
as
 
ÿÎabË
:

93 #fÜ 
k
, 
v
 
š
 
ns_cÚfs
.
g‘
(
ns
, {}).
™”™ems
():

94 #ÿÎabË(
k
, 
v
)

95 
	gns
, 
hªdËr
 
š
 
	g£lf
.
	$™ems
():

96 
ex™
 = 
	`g‘©Œ
(
hªdËr
, "__ex™__", 
NÚe
)

97 
ex™
:

98 
ÿÎabË
 = 
hªdËr
.
	$__’‹r__
()

99 
no_exc
 = 
True


100 
Œy
:

101 
Œy
:

102 
k
, 
v
 
š
 
ns_cÚfs
.
	`g‘
(
ns
, {
	}
}).
	$™ems
():

103 
	$ÿÎabË
(
k
, 
v
)

104 
exû±
:

105 #Th
exû±iÚ®
 
is
 
hªdËd
 
h”e


106 
no_exc
 = 
F®£


107 
ex™
 
is
 
NÚe
:

108 
¿i£


109 
nÙ
 
	`ex™
(*
sys
.
	$exc_šfo
()):

110 
¿i£


111 #Th
exû±iÚ
 
is
 
sw®lowed
 
	`ex™
(è
»tuºs
 
Œue


112 
fš®ly
:

113 #Th
nÜm®
 
ªd
 
nÚ
-
loÿl
-
ÿ£s
 
¬e
 
hªdËd
 
h”e


114 
no_exc
 
ªd
 
ex™
:

115 
	$ex™
(
NÚe
, None, None)

117 
k
, 
v
 
š
 
ns_cÚfs
.
	`g‘
(
ns
, {
	}
}).
	$™ems
():

118 
	$hªdËr
(
k
, 
v
)

120 
def
 
	$__»´__
(
£lf
):

121  "%s.%s(%s)" % (
£lf
.
__moduË__
, s–f.
__şass__
.
__Çme__
,

122 
diù
.
	$__»´__
(
£lf
))

124 
def
 
	$__cİy__
(
£lf
):

125 
Ãwobj
 = 
£lf
.
	$__şass__
()

126 
Ãwobj
.
	$upd©e
(
£lf
)

127  
Ãwobj


128 
cİy
 = 
__cİy__


131 
şass
 
	$CÚfig
(
diù
):

134 
May
 
ke
 
a
 
fe
, 
f’ame
, 
Ü
 
diù
.

137 
deçuÉs
 = {
	}
}

138 
’vœÚm’ts
 = {}

139 
Çme¥aûs
 = 
	$Name¥aûS‘
()

141 
def
 
	$__š™__
(
£lf
, 
fe
=
NÚe
, **
kw¬gs
):

142 
£lf
.
	$»£t
()

143 
fe
 
is
 
nÙ
 
NÚe
:

144 
£lf
.
	$upd©e
(
fe
)

145 
kw¬gs
:

146 
£lf
.
	$upd©e
(
kw¬gs
)

148 
def
 
	$»£t
(
£lf
):

150 
£lf
.
	$ş—r
()

151 
diù
.
	$upd©e
(
£lf
, s–f.
deçuÉs
)

153 
def
 
	$upd©e
(
£lf
, 
cÚfig
):

155 
	$isš¡ªû
(
cÚfig
, 
ba£¡ršg
):

157 
cÚfig
 = 
	`P¬£r
().
	$diù_äom_fe
(
cÚfig
)

158 
–if
 
	`ha§‰r
(
cÚfig
, 'read'):

159 #O³À
fe
 
objeù


160 
cÚfig
 = 
	`P¬£r
().
	$diù_äom_fe
(
cÚfig
)

162 
cÚfig
 = cÚfig.
	$cİy
()

163 
£lf
.
	$_­¶y
(
cÚfig
)

165 
def
 
	$_­¶y
(
£lf
, 
cÚfig
):

167 
which_’v
 = 
cÚfig
.
	`g‘
('environment')

168 
which_’v
:

169 
’v
 = 
£lf
.
’vœÚm’ts
[
which_’v
]

170 
k
 
š
 
’v
:

171 
k
 
nÙ
 
š
 
cÚfig
:

172 
cÚfig
[
k
] = 
’v
[k]

174 
diù
.
	$upd©e
(
£lf
, 
cÚfig
)

175 
£lf
.
	$Çme¥aûs
(
cÚfig
)

177 
def
 
	$__£t™em__
(
£lf
, 
k
, 
v
):

178 
diù
.
	$__£t™em__
(
£lf
, 
k
, 
v
)

179 
£lf
.
	`Çme¥aûs
({
k
: 
v
})

182 
şass
 
	$P¬£r
(
CÚfigP¬£r
):

184 
¿i£s
 
ª
 
exû±iÚ
 
the
 
fe
 
ÿÂÙ
 
be
 
»ad
.

187 
def
 
	$İtiÚxfÜm
(
£lf
, 
İtiÚ¡r
):

188  
İtiÚ¡r


190 
def
 
	$»ad
(
£lf
, 
f’ames
):

191 
	$isš¡ªû
(
f’ames
, 
ba£¡ršg
):

192 
f’ames
 = [filenames]

193 
f’ame
 
š
 
f’ames
:

195 #å = 
	`İ’
(
f’ame
)

196 #exû± 
IOE¼Ü
:

198 
å
 = 
	$İ’
(
f’ame
)

199 
Œy
:

200 
£lf
.
	$_»ad
(
å
, 
f’ame
)

201 
fš®ly
:

202 
å
.
	$şo£
()

204 
def
 
	$as_diù
(
£lf
, 
¿w
=
F®£
, 
v¬s
=
NÚe
):

206 #Lßd 
INI
 
fe
 
što
 
a
 
diù


207 
»suÉ
 = {
	}
}

208 
£ùiÚ
 
š
 
£lf
.
	$£ùiÚs
():

209 
£ùiÚ
 
nÙ
 
š
 
»suÉ
:

210 
»suÉ
[
£ùiÚ
] = {
	}
}

211 
İtiÚ
 
š
 
£lf
.
	$İtiÚs
(
£ùiÚ
):

212 
v®ue
 = 
£lf
.
	$g‘
(
£ùiÚ
, 
İtiÚ
, 
¿w
ôaw, 
v¬s
=vars)

213 
Œy
:

214 
v®ue
 = 
	$uÄ•r
(
v®ue
)

215 
exû±
 
Exû±iÚ
:

216 
x
 = 
sys
.
	`exc_šfo
()[1]

217 
msg
 = ("Configƒrror in section: %r, option: %r, "

219 (
£ùiÚ
, 
İtiÚ
, 
v®ue
))

220 
¿i£
 
	$V®ueE¼Ü
(
msg
, 
x
.
__şass__
.
__Çme__
, x.
¬gs
)

221 
»suÉ
[
£ùiÚ
][
İtiÚ
] = 
v®ue


222  
»suÉ


224 
def
 
	$diù_äom_fe
(
£lf
, 
fe
):

225 
	`ha§‰r
(
fe
, 'read'):

226 
£lf
.
	$»adå
(
fe
)

228 
£lf
.
	$»ad
(
fe
)

229  
£lf
.
	$as_diù
()

232 #publiø
domaš
 "uÄ•r" 
im¶em’tiÚ
, 
found
 
Ú
 
the
 
web
 
ªd
 
th’
 
im´oved
.

235 
şass
 
_Bud”2
:

237 
def
 
	$bud
(
£lf
, 
o
):

238 
m
 = 
	`g‘©Œ
(
£lf
, 'bud_' + 
o
.
__şass__
.
__Çme__
, 
NÚe
)

239 
m
 
is
 
NÚe
:

240 
¿i£
 
	`Ty³E¼Ü
("unrepr does‚ot„ecognize %s" %

241 
	$»´
(
o
.
__şass__
.
__Çme__
))

242  
	$m
(
o
)

244 
def
 
	$a¡node
(
£lf
, 
s
):

246 
Œy
:

247 
impÜt
 
comp”


248 
exû±
 
ImpÜtE¼Ü
:

249 #F®lback 
to
 
ev®
 
wh’
 
comp”
 
·ckage
 
is
 
nÙ
 
avaabË
,

250 #e.
g
. 
IrÚPythÚ
 1.0.

251  
	$ev®
(
s
)

253 
p
 = 
comp”
.
	`·r£
("__‹mpv®ue__ = " + 
s
)

254  
p
.
	`g‘Chd»n
()[1].getChildren()[0].getChildren()[1]

256 
def
 
	$bud_Subsüt
(
£lf
, 
o
):

257 
ex´
, 
æags
, 
subs
 = 
o
.
	$g‘Chd»n
()

258 
ex´
 = 
£lf
.
	$bud
(
ex´
)

259 
subs
 = 
£lf
.
	$bud
(
subs
)

260  
ex´
[
subs
]

262 
def
 
	$bud_C®lFunc
(
£lf
, 
o
):

263 
chd»n
 = 
	`m­
(
£lf
.
bud
, 
o
.
	$g‘Chd»n
())

264 
ÿÎ“
 = 
chd»n
.
	$pİ
(0)

265 
kw¬gs
 = 
chd»n
.
	$pİ
(è
Ü
 {
	}
}

266 
¡¬¬gs
 = 
chd»n
.
	$pİ
(è
	$Ü
 ()

267 
¬gs
 = 
	`tu¶e
(
chd»n
è+ 
	$tu¶e
(
¡¬¬gs
)

268  
	$ÿÎ“
(*
¬gs
, **
kw¬gs
)

270 
def
 
	$bud_Li¡
(
£lf
, 
o
):

271  
	`m­
(
£lf
.
bud
, 
o
.
	$g‘Chd»n
())

273 
def
 
	$bud_CÚ¡
(
£lf
, 
o
):

274  
o
.
v®ue


276 
def
 
	$bud_Diù
(
£lf
, 
o
):

277 
d
 = {
	}
}

278 
i
 = 
™”
(
m­
(
£lf
.
bud
, 
o
.
	$g‘Chd»n
()))

279 
–
 
š
 
i
:

280 
d
[
–
] = 
i
.
	$Ãxt
()

281  
d


283 
def
 
	$bud_Tu¶e
(
£lf
, 
o
):

284  
	`tu¶e
(
£lf
.
	$bud_Li¡
(
o
))

286 
def
 
	$bud_Name
(
£lf
, 
o
):

287 
Çme
 = 
o
.name

288 
Çme
 == 'None':

289  
NÚe


290 
Çme
 == 'True':

291  
True


292 
Çme
 == 'False':

293  
F®£


295 #S“ 
the
 
Name
 
is
 
a
 
·ckage
 
Ü
 
moduË
. 
If
 
™
 is, 
impÜt
 it.

296 
Œy
:

297  
	$moduËs
(
Çme
)

298 
exû±
 
ImpÜtE¼Ü
:

299 
·ss


301 #S“ 
the
 
Name
 
is
 
š
 
butšs
.

302 
Œy
:

303  
	$g‘©Œ
(
butšs
, 
Çme
)

304 
exû±
 
A‰ribu‹E¼Ü
:

305 
·ss


307 
¿i£
 
	`Ty³E¼Ü
("uÄ•¸could‚Ù„esŞvthÇm%s" % 
	$»´
(
Çme
))

309 
def
 
	$bud_Add
(
£lf
, 
o
):

310 
Ëá
, 
right
 = 
	`m­
(
£lf
.
bud
, 
o
.
	$g‘Chd»n
())

311  
Ëá
 + 
right


313 
def
 
	$bud_Mul
(
£lf
, 
o
):

314 
Ëá
, 
right
 = 
	`m­
(
£lf
.
bud
, 
o
.
	$g‘Chd»n
())

315  
Ëá
 * 
right


317 
def
 
	$bud_G‘©Œ
(
£lf
, 
o
):

318 
·»Á
 = 
£lf
.
	$bud
(
o
.
ex´
)

319  
	$g‘©Œ
(
·»Á
, 
o
.
©ŒÇme
)

321 
def
 
	$bud_NÚeTy³
(
£lf
, 
o
):

322  
NÚe


324 
def
 
	$bud_UÇrySub
(
£lf
, 
o
):

325  -
£lf
.
	`bud
(
o
.
	`g‘Chd»n
()[0])

327 
def
 
	$bud_UÇryAdd
(
£lf
, 
o
):

328  
£lf
.
	`bud
(
o
.
	`g‘Chd»n
()[0])

331 
şass
 
_Bud”3
:

333 
def
 
	$bud
(
£lf
, 
o
):

334 
m
 = 
	`g‘©Œ
(
£lf
, 'bud_' + 
o
.
__şass__
.
__Çme__
, 
NÚe
)

335 
m
 
is
 
NÚe
:

336 
¿i£
 
	`Ty³E¼Ü
("unrepr does‚ot„ecognize %s" %

337 
	$»´
(
o
.
__şass__
.
__Çme__
))

338  
	$m
(
o
)

340 
def
 
	$a¡node
(
£lf
, 
s
):

342 
Œy
:

343 
impÜt
 
a¡


344 
exû±
 
ImpÜtE¼Ü
:

345 #F®lback 
to
 
ev®
 
wh’
 
a¡
 
·ckage
 
is
 
nÙ
 
avaabË
,

346 #e.
g
. 
IrÚPythÚ
 1.0.

347  
	$ev®
(
s
)

349 
p
 = 
a¡
.
	`·r£
("__‹mpv®ue__ = " + 
s
)

350  
p
.
body
[0].
v®ue


352 
def
 
	$bud_Subsüt
(
£lf
, 
o
):

353  
£lf
.
	`bud
(
o
.
v®ue
)[£lf.bud(o.
¦iû
)]

355 
def
 
	$bud_Index
(
£lf
, 
o
):

356  
£lf
.
	$bud
(
o
.
v®ue
)

358 
def
 
	$bud_C®l
(
£lf
, 
o
):

359 
ÿÎ“
 = 
£lf
.
	$bud
(
o
.
func
)

361 
o
.
¬gs
 
is
 
NÚe
:

362 
¬gs
 = ()

364 
¬gs
 = 
	`tu¶e
([
£lf
.
	$bud
(
a
è¨
š
 
o
.
¬gs
])

366 
o
.
¡¬¬gs
 
is
 
NÚe
:

367 
¡¬¬gs
 = ()

369 
¡¬¬gs
 = 
£lf
.
	$bud
(
o
.
¡¬¬gs
)

371 
o
.
kw¬gs
 
is
 
NÚe
:

372 
kw¬gs
 = {
	}
}

374 
kw¬gs
 = 
£lf
.
	$bud
(
o
.
kw¬gs
)

376  
	`ÿÎ“
(*(
¬gs
 + 
¡¬¬gs
), **
kw¬gs
)

378 
def
 
	$bud_Li¡
(
£lf
, 
o
):

379  
	`li¡
(
	$m­
(
£lf
.
bud
, 
o
.
–ts
))

381 
def
 
	$bud_SŒ
(
£lf
, 
o
):

382  
o
.
s


384 
def
 
	$bud_Num
(
£lf
, 
o
):

385  
o
.
n


387 
def
 
	$bud_Diù
(
£lf
, 
o
):

388  
	`diù
([(
£lf
.
	`bud
(
k
), s–f.
	$bud
(
v
))

389 
k
, 
v
 
š
 
	`z
(
o
.
keys
, o.
v®ues
)])

391 
def
 
	$bud_Tu¶e
(
£lf
, 
o
):

392  
	`tu¶e
(
£lf
.
	$bud_Li¡
(
o
))

394 
def
 
	$bud_Name
(
£lf
, 
o
):

395 
Çme
 = 
o
.
id


396 
Çme
 == 'None':

397  
NÚe


398 
Çme
 == 'True':

399  
True


400 
Çme
 == 'False':

401  
F®£


403 #S“ 
the
 
Name
 
is
 
a
 
·ckage
 
Ü
 
moduË
. 
If
 
™
 is, 
impÜt
 it.

404 
Œy
:

405  
	$moduËs
(
Çme
)

406 
exû±
 
ImpÜtE¼Ü
:

407 
·ss


409 #S“ 
the
 
Name
 
is
 
š
 
butšs
.

410 
Œy
:

411 
impÜt
 
butšs


412  
	$g‘©Œ
(
butšs
, 
Çme
)

413 
exû±
 
A‰ribu‹E¼Ü
:

414 
·ss


416 
¿i£
 
	`Ty³E¼Ü
("uÄ•¸could‚Ù„esŞvthÇm%s" % 
	$»´
(
Çme
))

418 
def
 
	$bud_UÇryOp
(
£lf
, 
o
):

419 
İ
, 
İ”ªd
 = 
	$m­
(
£lf
.
bud
, [
o
.
İ
, o.
İ”ªd
])

420  
	$İ
(
İ”ªd
)

422 
def
 
	$bud_BšOp
(
£lf
, 
o
):

423 
Ëá
, 
İ
, 
right
 = 
	$m­
(
£lf
.
bud
, [
o
.
Ëá
, o.
İ
, o.
right
])

424  
	$İ
(
Ëá
, 
right
)

426 
def
 
	$bud_Add
(
£lf
, 
o
):

427  
_İ”©Ü
.
add


429 
def
 
	$bud_MuÉ
(
£lf
, 
o
):

430  
_İ”©Ü
.
mul


432 
def
 
	$bud_USub
(
£lf
, 
o
):

433  
_İ”©Ü
.
Ãg


435 
def
 
	$bud_A‰ribu‹
(
£lf
, 
o
):

436 
·»Á
 = 
£lf
.
	$bud
(
o
.
v®ue
)

437  
	$g‘©Œ
(
·»Á
, 
o
.
©Œ
)

439 
def
 
	$bud_NÚeTy³
(
£lf
, 
o
):

440  
NÚe


443 
def
 
	$uÄ•r
(
s
):

445 
nÙ
 
s
:

446  
s


447 
sys
.
v”siÚ_šfo
 < (3, 0):

448 
b
 = 
	$_Bud”2
()

450 
b
 = 
	$_Bud”3
()

451 
obj
 = 
b
.
	$a¡node
(
s
)

452  
b
.
	$bud
(
obj
)

455 
def
 
	$moduËs
(
moduËP©h
):

457 
Œy
:

458 
mod
 = 
sys
.
moduËs
[
moduËP©h
]

459 
mod
 
is
 
NÚe
:

460 
¿i£
 
	$KeyE¼Ü
()

461 
exû±
 
KeyE¼Ü
:

462 
	$__impÜt__
(
moduËP©h
)

463 
mod
 = 
sys
.
moduËs
[
moduËP©h
]

464  
mod


466 
def
 
	$©Œibu‹s
(
fuÎ_©Œibu‹_Çme
):

469 #P¬£ 
out
 
the
 
·th
, 
moduË
, 
ªd
 
©Œibu‹


470 
Ï¡_dÙ
 = 
fuÎ_©Œibu‹_Çme
.
	`rfšd
(".")

471 
©Œ_Çme
 = 
fuÎ_©Œibu‹_Çme
[
Ï¡_dÙ
 + 1:]

472 
mod_·th
 = 
fuÎ_©Œibu‹_Çme
[:
Ï¡_dÙ
]

474 
mod
 = 
	$moduËs
(
mod_·th
)

475 #L‘ 
ª
 
A‰ribu‹E¼Ü
 
´İag©e
 
outw¬d
.

476 
Œy
:

477 
©Œ
 = 
	$g‘©Œ
(
mod
, 
©Œ_Çme
)

478 
exû±
 
A‰ribu‹E¼Ü
:

479 
¿i£
 
	`A‰ribu‹E¼Ü
("'%s' object has‚o‡ttribute '%s'"

480 % (
mod_·th
, 
©Œ_Çme
))

482 #R‘uº 
a
 
»ã»nû
 
to
 
the
 
©Œibu‹
.

483  
©Œ


	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/lib/sessions.py

3 
You
 
Ãed
 
to
 
ed™
 
your
 
cÚfig
 
fe
Ø
u£
 
	g£ssiÚs
. 
	gH”e
's‡nƒxample::

6 
	gtoŞs
.
	g£ssiÚs
.
	gÚ
 = 
True


7 
toŞs
.
£ssiÚs
.
¡Üage_ty³
 = "file"

8 
toŞs
.
£ssiÚs
.
¡Üage_·th
 = "/home/site/sessions"

9 
toŞs
.
£ssiÚs
.
timeout
 = 60

11 
This
 
£ts
 
the
 
£ssiÚ
 
to
 
be
 
¡Üed
 
š
 
fes
 iÀth
dœeùÜy
 /
home
/
s™e
/
£ssiÚs
,

12 
ªd
 
the
 
£ssiÚ
 
timeout
 
	gto
 60 
	gmšu‹s
. 
If
 
you
 
	gom™
 ``
	g¡Üage_ty³
``h
£ssiÚs


13 
wl
 
be
 
§ved
 
š
 
	gRAM
. ``
	gtoŞs
.
	g£ssiÚs
.
	gÚ
`` 
is
 
the
 
Úly
 
»quœed
 
lše
 

14 
wÜkšg
 
	g£ssiÚs
, 
the
 
»¡
 
¬e
 
	gİtiÚ®
.

16 
By
 , 
the
 
£ssiÚ
 
ID
 
is
 
·s£d
 
š
 
a
 
	gcook›
, 
so
h
	gş›Á
's browser must

17 
have
 
cook›s
 
’abËd
 
your
 
	gs™e
.

19 
To
 
£t
 
d©a
 
the
 
cu¼’t
 
	g£ssiÚ
, 
	gu£


20 ``
	gch”rypy
.
	g£ssiÚ
['fieldname'] = 'fieldvalue'``;

21 
to
 
g‘
 
d©a
 
	gu£
 ``
	gch”rypy
.
	g£ssiÚ
.get('fieldname')``.

24 
Lockšg
 
£ssiÚs


27 
By
 , 
	gthe
 ``'lockšg'`` 
mode
 
of
 
£ssiÚs
 
	gis
 ``'im¶ic™'``, 
which
 
m—ns


28 
the
 
£ssiÚ
 
is
 
locked
 
—¾y
 
ªd
 
uÆocked
 
	gÏ‹
. 
If
 
you
 
wªt
 
to
 
cÚŒŞ
 
wh’
he

29 
£ssiÚ
 
d©a
 
is
 
locked
 
ªd
 
	guÆocked
, 
	g£t
 ``
	gtoŞs
.
	g£ssiÚs
.
	glockšg
 = 'explicit'``.

30 
Th’
 
ÿÎ
 ``
ch”rypy
.
£ssiÚ
.
acquœe_lock
()`` 
ªd
 ``ch”rypy.£ssiÚ.
»Ëa£_lock
()``.

31 
Reg¬dËss
 
of
 
which
 
mode
 
you
 
u£
, 
the
 
£ssiÚ
 
is
 
gu¬ª‹ed
 
to
 
be
 
uÆocked
 
wh’


32 
the
 
»que¡
 
is
 
	gcom¶‘e
.

35 
Expœšg
 
SessiÚs


38 
You
 
ÿn
 
fÜû
 
a
 
£ssiÚ
 
to
 
expœe
 
w™h
 :
func
:`
ch”rypy
.
lib
.
£ssiÚs
.expire`.

39 
Sim¶y
 
ÿÎ
 
th©
 
funùiÚ
 
©
 
the
 
pošt
 
you
 
wªt
h
£ssiÚ
 
to
 
expœe
, 
ªd
 
™


40 
wl
 
ÿu£
 
the
 
£ssiÚ
 
cook›
 
to
 
expœe
 
	gş›Á
-
	gside
.

43 
SessiÚ
 
Fix©iÚ
 
PrÙeùiÚ


46 
If
 
Ch”ryPy
 
»ûives
, 
vŸ
 
a
 
»que¡
 
	gcook›
,‡ 
£ssiÚ
 
id
 
th©
 
™
 
dÛs
 
nÙ


47 
	g»cognize
, 
™
 
wl
 
»jeù
 
th©
 
id
 
ªd
 
ü—‹
 
a
 
Ãw
 
Úe
 
to
  
š
 
the


48 
»¥Ú£
 
	gcook›
. 
	gThis
 `
h–ps
 
´ev’t
 
£ssiÚ
 
fix©iÚ
 
	g©cks


49 <
	gh‰p
:

50 
Howev”
, 
	gCh”ryPy
 "»cognizes" 
a
 
£ssiÚ
 
id
 
by
 
lookšg
 
up
 
the
 
§ved
 session

51 
d©a
 
th©
 
	gid
. 
	gTh”efÜe
, 
you
 
Ãv”
 
§ve
 
ªy
 
£ssiÚ
 
	gd©a
,

52 **
you
 
wl
 
g‘
 
a
 
Ãw
 
£ssiÚ
 
id
 
ev”y
 
	g»que¡
**.

55 
Sh¬šg
 
SessiÚs


58 
If
 
you
 
run
 
muÉË
 
š¡ªûs
 
of
 
Ch”ryPy
 (
exam¶e
 
vŸ
 
mod_pythÚ
 
behšd


59 
A·che
 
´efÜk
), 
you
 
mo¡
 
lik–y
 
ÿÂÙ
 
u£
 
the
 
RAM
 
£ssiÚ
 
	gback’d
, 
sšû
 
—ch


60 
š¡ªû
 
of
 
Ch”ryPy
 
wl
 
have
 
™s
 
own
 
memÜy
 
	g¥aû
. 
U£
 
a
 
difã»Á
 
back’d


61 
	gš¡—d
, 
ªd
 
v”ify
 
th©
 
®l
 
š¡ªûs
 
¬e
 
poštšg
 
©
 
the
 
§me
 
fe
 
Ü
 
db


62 
	gloÿtiÚ
. 
	gAÉ”Ç‹ly
, 
you
 
might
 
Œy
 
a
 
lßd
 
b®ªûr
 
which
 
makes
 
	g£ssiÚs


63 "¡icky". 
GoogË
 
is
 
your
 
	gä›nd
, 
	gth”e
.

66 
Expœ©iÚ
 
D©es


69 
The
 
»¥Ú£
 
cook›
 
wl
 
pos£ss
 
ª
 
expœ©iÚ
 
d©e
 
to
 
šfÜm
 
the
 
ş›Á
 
©


70 
which
 
pošt
 
to
 
¡İ
 
£ndšg
 
the
 
cook›
 
back
 
š
 
»que¡s
. 
If
h
£rv”
 
time


71 
ªd
 
ş›Á
 
time
 
difãr
, 
ex³ù
 
£ssiÚs
 
to
 
be
 
	guÄ–ŸbË
. **
Make
 
su»
 
the


72 
sy¡em
 
time
 
of
 
your
 
£rv”
 
is
 
	gaccu¿‹
**.

74 
Ch”ryPy
 
deçuÉs
 
to
 
	ga
 60-
mšu‹
 
£ssiÚ
 
	gtimeout
, 
which
 
®so
 
­¶›s
Ø
the


75 
cook›
 
which
 
is
 
£Á
 
to
 
the
 
	gş›Á
. 
	gUnfÜtuÇ‹ly
, 
some
 
v”siÚs
 
of
 
	gSaçri


76 ("4…ubliøb‘a" 
Ú
 
Wšdows
 
XP
 
©
 
	gËa¡
è
­³¬
 
to
 
have
 
a
 
bug
 
š
 
theœ
 
·rsšg


77 
of
 
the
 
GMT
 
expœ©iÚ
 
	gd©e
--
they
 
­³¬
 
to
 
š‹½»t
h
d©e
 
as
 
Úe
 
hour
 
š


78 
the
 
	g·¡
. 
Sixty
 
mšu‹s
 
mšus
 
Úe
 
hour
 
is
 
´‘ty
 
şo£
 
to
 
	gz”o
, 
so
 
you
 
may


79 
ex³r›nû
 
this
 
bug
 
as
 
a
 
Ãw
 
£ssiÚ
 
id
 
ev”y
 
	g»que¡
, 
uÆess
 
the
 
»que¡s


80 
¬e
 
Ëss
 
thª
 
Úe
 
£cÚd
 
	g­¬t
. 
To
 
	gfix
, 
Œy
 
šü—sšg
 
the
 
	g£ssiÚ
.
	gtimeout
.

82 
On
 
the
 
Ùh”
 
	gexŒeme
, 
some
 
u£rs
 
»pÜt
 
Fœefox
 
£ndšg
 
cook›s
 
aá”
 
theœ


83 
expœ©iÚ
 
	gd©e
, 
®though
 
this
 
was
 
Ú
 
a
 
sy¡em
 
w™h
 
ª
 
šaccu¿‹
 sy¡em 
	gtime
.

84 
Maybe
 
FF
 
	gdÛ¢
'trust systemime.

87 
impÜt
 
d©‘ime


88 
impÜt
 
os


89 
impÜt
 
¿ndom


90 
impÜt
 
time


91 
impÜt
 
th»adšg


92 
impÜt
 
ty³s


93 
äom
 
w¬nšgs
 
impÜt
 
w¬n


95 
impÜt
 
ch”rypy


96 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
	gcİy™ems
, 
	gpickË
, 
	g¿ndom20
, 
unicode¡r


97 
äom
 
	gch”rypy
.
lib
 
impÜt
 
h‰put


100 
	gmissšg
 = 
	$objeù
()

102 
şass
 
	$SessiÚ
(
objeù
):

105 
_id
 = 
NÚe


107 
id_ob£rv”s
 = 
NÚe


110 
def
 
	$_g‘_id
(
£lf
):

111  
£lf
.
_id


112 
def
 
	$_£t_id
(
£lf
, 
v®ue
):

113 
£lf
.
_id
 = 
v®ue


114 
o
 
š
 
£lf
.
id_ob£rv”s
:

115 
	$o
(
v®ue
)

116 
id
 = 
	`´İ”ty
(
_g‘_id
, 
_£t_id
, 
doc
="The current session ID.")

118 
timeout
 = 60

121 
locked
 = 
F®£


123 
If
 
True
, 
this
 
£ssiÚ
 
š¡ªû
 
has
 
exşusive
 
»ad
/
wr™e
 
acûss


124 
to
 
£ssiÚ
 
d©a
."""

126 
lßded
 = 
F®£


128 
If
 
True
, 
d©a
 
has
 
b“n
 
»Œ›ved
 
äom
 
¡Üage
. 
This
 
should
 
h­³n


129 
autom©iÿÎy
 
Ú
 
the
 
fœ¡
 
©‹m±
 
to
 
acûss
 
£ssiÚ
 
d©a
."""

131 
ş—n_th»ad
 = 
NÚe


134 
ş—n_äeq
 = 5

137 
Üigš®id
 = 
NÚe


140 
missšg
 = 
F®£


143 
»g’”©ed
 = 
F®£


145 
True
 
the
 
­¶iÿtiÚ
 
ÿÎed
 
£ssiÚ
.
	`»g’”©e
(). 
This
 
is
 
nÙ
 
£t
 
by


146 
š‹º®
 
ÿÎs
 
to
 
»g’”©e
 
the
 
£ssiÚ
 
id
."""

148 
debug
=
F®£


150 
def
 
	$__š™__
(
£lf
, 
id
=
NÚe
, **
kw¬gs
):

151 
£lf
.
id_ob£rv”s
 = []

152 
£lf
.
_d©a
 = {
	}
}

154 
k
, 
v
 
š
 
	gkw¬gs
.
	$™ems
():

155 
	$£‰r
(
£lf
, 
k
, 
v
)

157 
£lf
.
Üigš®id
 = 
id


158 
£lf
.
missšg
 = 
F®£


159 
id
 
is
 
NÚe
:

160 
£lf
.
debug
:

161 
ch”rypy
.
	`log
('No id given; making‡‚ew one', 'TOOLS.SESSIONS')

162 
£lf
.
	$_»g’”©e
()

164 
£lf
.
id
 = id

165 
nÙ
 
£lf
.
	$_exi¡s
():

166 
£lf
.
debug
:

167 
ch”rypy
.
	`log
('Expired or malicious session %r; '

168 'makšg‡‚ew oÃ' % 
id
, 'TOOLS.SESSIONS')

169 #Expœed 
Ü
 
m®icious
 
£ssiÚ
. 
Make
 
a
 
Ãw
 
Úe
.

170 #S“ 
h‰p
:

171 
£lf
.
id
 = 
NÚe


172 
£lf
.
missšg
 = 
True


173 
£lf
.
	$_»g’”©e
()

175 
def
 
	$now
(
£lf
):

178 
Oth”
 
£ssiÚ
 
´ovid”s
 
ÿn
 
ov”ride
 
this
 
to
 
u£
 
®‹º©ive
,

179 
possibly
 
timezÚe
 
aw¬e
, 
v”siÚs
 
of
 'now'.

181  
d©‘ime
.d©‘ime.
	$now
()

183 
def
 
	$»g’”©e
(
£lf
):

185 
£lf
.
»g’”©ed
 = 
True


186 
£lf
.
	$_»g’”©e
()

188 
def
 
	$_»g’”©e
(
£lf
):

189 
£lf
.
id
 
is
 
nÙ
 
NÚe
:

190 
£lf
.
	$d–‘e
()

192 
Şd_£ssiÚ_was_locked
 = 
£lf
.
locked


193 
Şd_£ssiÚ_was_locked
:

194 
£lf
.
	$»Ëa£_lock
()

196 
£lf
.
id
 = 
NÚe


197 
£lf
.
id
 
is
 
NÚe
:

198 
£lf
.
id
 = s–f.
	$g’”©e_id
()

199 #As£¹ 
th©
 
the
 
g’”©ed
 
id
 
is
 
nÙ
 
®»ady
 
¡Üed
.

200 
£lf
.
	$_exi¡s
():

201 
£lf
.
id
 = 
NÚe


203 
Şd_£ssiÚ_was_locked
:

204 
£lf
.
	$acquœe_lock
()

206 
def
 
	$ş—n_up
(
£lf
):

208 
·ss


210 
def
 
	$g’”©e_id
(
£lf
):

212  
	$¿ndom20
()

214 
def
 
	$§ve
(
£lf
):

216 
Œy
:

217 #Ià
£ssiÚ
 
d©a
 
has
 
Ãv”
 
b“n
 
lßded
 
th’
 
™
's‚ever been

218 #acûs£d: 
no
 
Ãed
 
to
 
§ve
 
™


219 
£lf
.
lßded
:

220 
t
 = 
d©‘ime
.
	$timed–
(
£cÚds
 = 
£lf
.
timeout
 * 60)

221 
expœ©iÚ_time
 = 
£lf
.
	`now
(è+ 
t


222 
£lf
.
debug
:

223 
ch”rypy
.
	`log
('Savšg w™hƒxpœy %s' % 
expœ©iÚ_time
,

225 
£lf
.
	$_§ve
(
expœ©iÚ_time
)

227 
fš®ly
:

228 
£lf
.
locked
:

229 #Alway 
»Ëa£
 
the
 
lock
 th
u£r
 
didn
't„elease it

230 
£lf
.
	$»Ëa£_lock
()

232 
def
 
	$lßd
(
£lf
):

234 
d©a
 = 
£lf
.
	$_lßd
()

235 #d©¨
is
 
e™h”
 
NÚe
 
Ü
 
a
 
	`tu¶e
 (
£ssiÚ_d©a
, 
expœ©iÚ_time
)

236 
d©a
 
is
 
NÚe
 
Ü
 d©a[1] < 
£lf
.
	$now
():

237 
£lf
.
debug
:

238 
ch”rypy
.
	`log
('Expired session, flushing data', 'TOOLS.SESSIONS')

239 
£lf
.
_d©a
 = {
	}
}

241 
£lf
.
_d©a
 = 
d©a
[0]

242 
£lf
.
lßded
 = 
True


244 #Stick 
the
 
ş—n_th»ad
 
š
h
şass
, 
nÙ
h
š¡ªû
.

245 #Th
š¡ªûs
 
¬e
 
ü—‹d
 
ªd
 
de¡royed
 
³r
-
»que¡
.

246 
	gşs
 = 
£lf
.
__şass__


247 
£lf
.
ş—n_äeq
 
ªd
 
nÙ
 
şs
.
ş—n_th»ad
:

248 #ş—n_u°
is
 
š
 
š¡ªûm‘hod
 
ªd
 
nÙ
 
a
 
şassm‘hod
,

249 #sØ
th©
 
toŞ
 
cÚfig
 
ÿn
 
be
 
acûs£d
 
šside
 
the
 
m‘hod
.

250 
	gt
 = 
ch”rypy
.
´oûss
.
¶ugšs
.
MÚ™Ü
(

251 
ch”rypy
.
’gše
, 
£lf
.
ş—n_up
, s–f.
ş—n_äeq
 * 60,

252 
Çme
='Session cleanup')

253 
t
.
	$subsüibe
()

254 
şs
.
ş—n_th»ad
 = 
t


255 
t
.
	$¡¬t
()

257 
def
 
	$d–‘e
(
£lf
):

259 
£lf
.
	$_d–‘e
()

261 
def
 
	$__g‘™em__
(
£lf
, 
key
):

262 
nÙ
 
£lf
.
lßded
: s–f.
	$lßd
()

263  
£lf
.
_d©a
[
key
]

265 
def
 
	$__£t™em__
(
£lf
, 
key
, 
v®ue
):

266 
nÙ
 
£lf
.
lßded
: s–f.
	$lßd
()

267 
£lf
.
_d©a
[
key
] = 
v®ue


269 
def
 
	$__d–™em__
(
£lf
, 
key
):

270 
nÙ
 
£lf
.
lßded
: s–f.
	$lßd
()

271 
d–
 
£lf
.
_d©a
[
key
]

273 
def
 
	$pİ
(
£lf
, 
key
, =
missšg
):

275 
If
 
key
 
is
 
nÙ
 
found
,  i 
»tuºed
 
giv’
,

276 
Ùh”wi£
 
KeyE¼Ü
 
is
 
¿i£d
.

278 
nÙ
 
£lf
.
lßded
: s–f.
	$lßd
()

279  
is
 
missšg
:

280  
£lf
.
_d©a
.
	$pİ
(
key
)

282  
£lf
.
_d©a
.
	$pİ
(
key
, )

284 
def
 
	$__cÚšs__
(
£lf
, 
key
):

285 
nÙ
 
£lf
.
lßded
: s–f.
	$lßd
()

286  
key
 
š
 
£lf
.
_d©a


288 
	`ha§‰r
({
	}
}, 'has_key'):

289 
def
 
	$has_key
(
£lf
, 
key
):

291 
nÙ
 
£lf
.
lßded
: s–f.
	$lßd
()

292  
key
 
š
 
£lf
.
_d©a


294 
def
 
	$g‘
(
£lf
, 
key
, =
NÚe
):

296 
nÙ
 
£lf
.
lßded
: s–f.
	$lßd
()

297  
£lf
.
_d©a
.
	$g‘
(
key
, )

299 
def
 
	$upd©e
(
£lf
, 
d
):

301 
nÙ
 
£lf
.
lßded
: s–f.
	$lßd
()

302 
£lf
.
_d©a
.
	$upd©e
(
d
)

304 
def
 
	$£tdeçuÉ
(
£lf
, 
key
, =
NÚe
):

306 
nÙ
 
£lf
.
lßded
: s–f.
	$lßd
()

307  
£lf
.
_d©a
.
	$£tdeçuÉ
(
key
, )

309 
def
 
	$ş—r
(
£lf
):

311 
nÙ
 
£lf
.
lßded
: s–f.
	$lßd
()

312 
£lf
.
_d©a
.
	$ş—r
()

314 
def
 
	$keys
(
£lf
):

316 
nÙ
 
£lf
.
lßded
: s–f.
	$lßd
()

317  
£lf
.
_d©a
.
	$keys
()

319 
def
 
	$™ems
(
£lf
):

321 
nÙ
 
£lf
.
lßded
: s–f.
	$lßd
()

322  
£lf
.
_d©a
.
	$™ems
()

324 
def
 
	$v®ues
(
£lf
):

326 
nÙ
 
£lf
.
lßded
: s–f.
	$lßd
()

327  
£lf
.
_d©a
.
	$v®ues
()

330 
şass
 
	$RamSessiÚ
(
SessiÚ
):

332 #CÏss-
Ëv–
 
objeùs
. 
DÚ
't„ebindhese!

333 
ÿche
 = {
	}
}

334 
locks
 = {}

336 
def
 
	$ş—n_up
(
£lf
):

338 
now
 = 
£lf
.
	$now
()

339 
id
, (
d©a
, 
expœ©iÚ_time
è
š
 
	$cİy™ems
(
£lf
.
ÿche
):

340 
expœ©iÚ_time
 <ğ
now
:

341 
Œy
:

342 
d–
 
£lf
.
ÿche
[
id
]

343 
exû±
 
KeyE¼Ü
:

344 
·ss


345 
Œy
:

346 
d–
 
£lf
.
locks
[
id
]

347 
exû±
 
KeyE¼Ü
:

348 
·ss


350 #added 
to
 
»move
 
obsŞ‘e
 
lock
 
objeùs


351 
id
 
š
 
	$li¡
(
£lf
.
locks
):

352 
id
 
nÙ
 
š
 
£lf
.
ÿche
:

353 
£lf
.
locks
.
	$pİ
(
id
, 
NÚe
)

355 
def
 
	$_exi¡s
(
£lf
):

356  
£lf
.
id
 
š
 s–f.
ÿche


358 
def
 
	$_lßd
(
£lf
):

359  
£lf
.
ÿche
.
	$g‘
(
£lf
.
id
)

361 
def
 
	$_§ve
(
£lf
, 
expœ©iÚ_time
):

362 
£lf
.
ÿche
[£lf.
id
] = (£lf.
_d©a
, 
expœ©iÚ_time
)

364 
def
 
	$_d–‘e
(
£lf
):

365 
£lf
.
ÿche
.
	$pİ
(
£lf
.
id
, 
NÚe
)

367 
def
 
	$acquœe_lock
(
£lf
):

369 
£lf
.
locked
 = 
True


370 
£lf
.
locks
.
	`£tdeçuÉ
(£lf.
id
, 
th»adšg
.
	`RLock
()).
	$acquœe
()

372 
def
 
	$»Ëa£_lock
(
£lf
):

374 
£lf
.
locks
[£lf.
id
].
	$»Ëa£
()

375 
£lf
.
locked
 = 
F®£


377 
def
 
	$__Ën__
(
£lf
):

379  
	$Ën
(
£lf
.
ÿche
)

382 
şass
 
	$FeSessiÚ
(
SessiÚ
):

385 
¡Üage_·th


386 
The
 
fŞd”
 
wh”e
 
£ssiÚ
 
d©a
 
wl
 
be
 
§ved
. 
Each
 session

387 
wl
 
be
 
§ved
 
as
 
pickË
.
	$dump
(
d©a
, 
expœ©iÚ_time
è
š
 
™s
 
own
 
fe
;

388 
the
 
f’ame
 
wl
 
be
 
£lf
.
SESSION_PREFIX
 + s–f.
id
.

392 
SESSION_PREFIX
 = 'session-'

393 
LOCK_SUFFIX
 = '.lock'

394 
pickË_´ÙocŞ
 = 
pickË
.
HIGHEST_PROTOCOL


396 
def
 
	$__š™__
(
£lf
, 
id
=
NÚe
, **
kw¬gs
):

397 #Th'¡Üage_·th' 
¬g
 
is
 
»quœed
 
fe
-
ba£d
 
£ssiÚs
.

398 
kw¬gs
['¡Üage_·th'] = 
os
.
·th
.
	`ab¥©h
(kwargs['storage_path'])

399 
SessiÚ
.
	$__š™__
(
£lf
, 
id
=id, **
kw¬gs
)

401 
def
 
	$£tup
(
şs
, **
kw¬gs
):

404 
This
 
should
 
Úly
 
be
 
ÿÎed
 
Úû
 
³r
 
´oûss
; 
this
 
wl
 b
dÚe


405 
autom©iÿÎy
 
wh’
 
usšg
 
£ssiÚs
.
	`š™
 (
as
 
the
 
but
-
š
 
ToŞ
 
dÛs
).

407 #Th'¡Üage_·th' 
¬g
 
is
 
»quœed
 
fe
-
ba£d
 
£ssiÚs
.

408 
kw¬gs
['¡Üage_·th'] = 
os
.
·th
.
	`ab¥©h
(kwargs['storage_path'])

410 
k
, 
v
 
š
 
kw¬gs
.
	$™ems
():

411 
	$£‰r
(
şs
, 
k
, 
v
)

413 #W¬À
ªy
 
lock
 
fes
 
exi¡
 
©
 
¡¬tup
.

414 
lockfes
 = [
âame
 âam
š
 
os
.
	$li¡dœ
(
şs
.
¡Üage_·th
)

415 ià(
âame
.
	$¡¬tsw™h
(
şs
.
SESSION_PREFIX
)

416 
ªd
 
âame
.
	`’dsw™h
(
şs
.
LOCK_SUFFIX
))]

417 
lockfes
:

418 
¶u¿l
 = ('', 's')[
	`Ën
(
lockfes
) > 1]

419 
	`w¬n
("%s session†ockfile%s found‡t startup. If you‡re "

422 % (
	`Ën
(
lockfes
), 
¶u¿l
, 
şs
.
¡Üage_·th
))

423 
£tup
 = 
	$şassm‘hod
(
£tup
)

425 
def
 
	$_g‘_fe_·th
(
£lf
):

426 
f
 = 
os
.
·th
.
	`još
(
£lf
.
¡Üage_·th
, s–f.
SESSION_PREFIX
 + s–f.
id
)

427 
nÙ
 
os
.
·th
.
	`ab¥©h
(
f
).
	$¡¬tsw™h
(
£lf
.
¡Üage_·th
):

428 
¿i£
 
ch”rypy
.
	`HTTPE¼Ü
(400, "Invalid session id in cookie.")

429  
f


431 
def
 
	$_exi¡s
(
£lf
):

432 
·th
 = 
£lf
.
	$_g‘_fe_·th
()

433  
os
.
·th
.
	$exi¡s
(
·th
)

435 
def
 
	$_lßd
(
£lf
, 
·th
=
NÚe
):

436 
·th
 
is
 
NÚe
:

437 
·th
 = 
£lf
.
	$_g‘_fe_·th
()

438 
Œy
:

439 
f
 = 
	`İ’
(
·th
, "rb")

440 
Œy
:

441  
pickË
.
	$lßd
(
f
)

442 
fš®ly
:

443 
f
.
	$şo£
()

444 
	$exû±
 (
IOE¼Ü
, 
EOFE¼Ü
):

445  
NÚe


447 
def
 
	$_§ve
(
£lf
, 
expœ©iÚ_time
):

448 
f
 = 
	`İ’
(
£lf
.
	`_g‘_fe_·th
(), "wb")

449 
Œy
:

450 
pickË
.
	`dump
((
£lf
.
_d©a
, 
expœ©iÚ_time
), 
f
, s–f.
pickË_´ÙocŞ
)

451 
fš®ly
:

452 
f
.
	$şo£
()

454 
def
 
	$_d–‘e
(
£lf
):

455 
Œy
:

456 
os
.
	`uÆšk
(
£lf
.
	$_g‘_fe_·th
())

457 
exû±
 
OSE¼Ü
:

458 
·ss


460 
def
 
	$acquœe_lock
(
£lf
, 
·th
=
NÚe
):

462 
·th
 
is
 
NÚe
:

463 
·th
 = 
£lf
.
	$_g‘_fe_·th
()

464 
·th
 +ğ
£lf
.
LOCK_SUFFIX


465 
True
:

466 
Œy
:

467 
lockfd
 = 
os
.
	`İ’
(
·th
, os.
O_CREAT
|os.
O_WRONLY
|os.
O_EXCL
)

468 
exû±
 
OSE¼Ü
:

469 
time
.
	$¦“p
(0.1)

471 
os
.
	$şo£
(
lockfd
)

473 
£lf
.
locked
 = 
True


475 
def
 
	$»Ëa£_lock
(
£lf
, 
·th
=
NÚe
):

477 
·th
 
is
 
NÚe
:

478 
·th
 = 
£lf
.
	$_g‘_fe_·th
()

479 
os
.
	`uÆšk
(
·th
 + 
£lf
.
LOCK_SUFFIX
)

480 
£lf
.
locked
 = 
F®£


482 
def
 
	$ş—n_up
(
£lf
):

484 
now
 = 
£lf
.
	$now
()

485 #I‹¿‹ 
ov”
 
®l
 
£ssiÚ
 
fes
 
š
 
£lf
.
¡Üage_·th


486 
âame
 
š
 
os
.
	$li¡dœ
(
£lf
.
¡Üage_·th
):

487 ià(
âame
.
	$¡¬tsw™h
(
£lf
.
SESSION_PREFIX
)

488 
ªd
 
nÙ
 
âame
.
	$’dsw™h
(
£lf
.
LOCK_SUFFIX
)):

489 #W
have
 
a
 
£ssiÚ
 
fe
: 
lock
 
ªd
 
lßd
 
™
‡nd 
check


490 #ià
™
'sƒxpired. If it fails,‚evermind.

491 
·th
 = 
os
.·th.
	$još
(
£lf
.
¡Üage_·th
, 
âame
)

492 
£lf
.
	$acquœe_lock
(
·th
)

493 
Œy
:

494 
cÚ‹Ás
 = 
£lf
.
	$_lßd
(
·th
)

495 #_lßd 
»tuºs
 
NÚe
 
Ú
 
IOE¼Ü


496 
cÚ‹Ás
 
is
 
nÙ
 
NÚe
:

497 
d©a
, 
expœ©iÚ_time
 = 
cÚ‹Ás


498 
expœ©iÚ_time
 < 
now
:

499 #SessiÚ 
expœed
: 
d–‘šg
 
™


500 
os
.
	$uÆšk
(
·th
)

501 
fš®ly
:

502 
£lf
.
	$»Ëa£_lock
(
·th
)

504 
def
 
	$__Ën__
(
£lf
):

506  
	`Ën
([
âame
 âam
š
 
os
.
	$li¡dœ
(
£lf
.
¡Üage_·th
)

507 ià(
âame
.
	$¡¬tsw™h
(
£lf
.
SESSION_PREFIX
)

508 
ªd
 
nÙ
 
âame
.
	`’dsw™h
(
£lf
.
LOCK_SUFFIX
))])

511 
şass
 
	$Po¡g»sqlSessiÚ
(
SessiÚ
):

513 
a
 
bË
 
like
 
this
::

515 
ü—‹
 
bË
 
	`£ssiÚ
 (

516 
id
 
	`v¬ch¬
(40),

517 
d©a
 
‹xt
,

518 
expœ©iÚ_time
 
time¡amp


521 
You
 
mu¡
 
´ovide
 
your
 
own
 
g‘_db
 
funùiÚ
.

524 
pickË_´ÙocŞ
 = 
pickË
.
HIGHEST_PROTOCOL


526 
def
 
	$__š™__
(
£lf
, 
id
=
NÚe
, **
kw¬gs
):

527 
SessiÚ
.
	$__š™__
(
£lf
, 
id
, **
kw¬gs
)

528 
£lf
.
cursÜ
 = s–f.
db
.
	$cursÜ
()

530 
def
 
	$£tup
(
şs
, **
kw¬gs
):

533 
This
 
should
 
Úly
 
be
 
ÿÎed
 
Úû
 
³r
 
´oûss
; 
this
 
wl
 b
dÚe


534 
autom©iÿÎy
 
wh’
 
usšg
 
£ssiÚs
.
	`š™
 (
as
 
the
 
but
-
š
 
ToŞ
 
dÛs
).

536 
k
, 
v
 
š
 
kw¬gs
.
	$™ems
():

537 
	$£‰r
(
şs
, 
k
, 
v
)

539 
£lf
.
db
 = s–f.
	$g‘_db
()

540 
£tup
 = 
	$şassm‘hod
(
£tup
)

542 
def
 
	$__d–__
(
£lf
):

543 
£lf
.
cursÜ
:

544 
£lf
.
cursÜ
.
	$şo£
()

545 
£lf
.
db
.
	$comm™
()

547 
def
 
	$_exi¡s
(
£lf
):

548 #S–eù 
£ssiÚ
 
d©a
 
äom
 
bË


549 
£lf
.
cursÜ
.
	`execu‹
('select data,ƒxpiration_time from session '

550 'wh”id=%s', (
£lf
.
id
,))

551 
rows
 = 
£lf
.
cursÜ
.
	$ãtch®l
()

552  
	$boŞ
(
rows
)

554 
def
 
	$_lßd
(
£lf
):

555 #S–eù 
£ssiÚ
 
d©a
 
äom
 
bË


556 
£lf
.
cursÜ
.
	`execu‹
('select data,ƒxpiration_time from session '

557 'wh”id=%s', (
£lf
.
id
,))

558 
rows
 = 
£lf
.
cursÜ
.
	$ãtch®l
()

559 
nÙ
 
rows
:

560  
NÚe


562 
pickËd_d©a
, 
expœ©iÚ_time
 = 
rows
[0]

563 
d©a
 = 
pickË
.
	$lßds
(
pickËd_d©a
)

564  
d©a
, 
expœ©iÚ_time


566 
def
 
	$_§ve
(
£lf
, 
expœ©iÚ_time
):

567 
pickËd_d©a
 = 
pickË
.
	$dumps
(
£lf
.
_d©a
, s–f.
pickË_´ÙocŞ
)

568 
£lf
.
cursÜ
.
	`execu‹
('update session set data = %s, '

570 (
pickËd_d©a
, 
expœ©iÚ_time
, 
£lf
.
id
))

572 
def
 
	$_d–‘e
(
£lf
):

573 
£lf
.
cursÜ
.
	`execu‹
('d–‘äom sessiÚ wh”id=%s', (£lf.
id
,))

575 
def
 
	$acquœe_lock
(
£lf
):

577 #W
u£
 
the
 "fÜ upd©e" 
şau£
 
to
 
lock
h
row


578 
£lf
.
locked
 = 
True


579 
£lf
.
cursÜ
.
	`execu‹
('select id from session where id=%s for update',

580 (
£lf
.
id
,))

582 
def
 
	$»Ëa£_lock
(
£lf
):

584 #W
ju¡
 
şo£
 
the
 
cursÜ
 
ªd
 
th©
 
wl
 
»move
h
lock


585 #šŒoduûd 
by
 
the
 "fÜ upd©e" 
şau£


586 
£lf
.
cursÜ
.
	$şo£
()

587 
£lf
.
locked
 = 
F®£


589 
def
 
	$ş—n_up
(
£lf
):

591 
£lf
.
cursÜ
.
	`execu‹
('delete from session whereƒxpiration_time < %s',

592 (
£lf
.
	`now
(),))

595 
şass
 
	$MemÿchedSessiÚ
(
SessiÚ
):

597 #Th
mo¡
 
pİuÏr
 
memÿched
 
ş›Á
 
PythÚ
 
i¢
'thread-safe.

598 #W¿°
®l
 .
g‘
 
ªd
 .
£t
 
İ”©iÚs
 
š
 
a
 
sšgË
 
lock
.

599 
mc_lock
 = 
th»adšg
.
	$RLock
()

601 #Thi 
is
 
a
 
£³¿‹
 
£t
 
of
 
locks
 
³r
 
£ssiÚ
 
id
.

602 
locks
 = {
	}
}

604 
£rv”s
 = ['127.0.0.1:11211']

606 
def
 
	$£tup
(
şs
, **
kw¬gs
):

609 
This
 
should
 
Úly
 
be
 
ÿÎed
 
Úû
 
³r
 
´oûss
; 
this
 
wl
 b
dÚe


610 
autom©iÿÎy
 
wh’
 
usšg
 
£ssiÚs
.
	`š™
 (
as
 
the
 
but
-
š
 
ToŞ
 
dÛs
).

612 
k
, 
v
 
š
 
kw¬gs
.
	$™ems
():

613 
	$£‰r
(
şs
, 
k
, 
v
)

615 
impÜt
 
memÿche


616 
şs
.
ÿche
 = 
memÿche
.
	$Cl›Á
(
şs
.
£rv”s
)

617 
£tup
 = 
	$şassm‘hod
(
£tup
)

619 
def
 
	$_g‘_id
(
£lf
):

620  
£lf
.
_id


621 
def
 
	$_£t_id
(
£lf
, 
v®ue
):

622 #Thi 
	`’code
(è
ÿÎ
 
is
 
wh”e
 
we
 
difãr
 
äom
 
the
 
su³rşass
.

623 #Memÿch
keys
 
MUST
 
be
 
by‹
 
¡ršgs
, 
nÙ
 
unicode
.

624 
	$isš¡ªû
(
v®ue
, 
unicode¡r
):

625 
v®ue
 = v®ue.
	`’code
('utf-8')

627 
£lf
.
_id
 = 
v®ue


628 
o
 
š
 
£lf
.
id_ob£rv”s
:

629 
	$o
(
v®ue
)

630 
id
 = 
	`´İ”ty
(
_g‘_id
, 
_£t_id
, 
doc
="The current session ID.")

632 
def
 
	$_exi¡s
(
£lf
):

633 
£lf
.
mc_lock
.
	$acquœe
()

634 
Œy
:

635  
	`boŞ
(
£lf
.
ÿche
.
	$g‘
(
£lf
.
id
))

636 
fš®ly
:

637 
£lf
.
mc_lock
.
	$»Ëa£
()

639 
def
 
	$_lßd
(
£lf
):

640 
£lf
.
mc_lock
.
	$acquœe
()

641 
Œy
:

642  
£lf
.
ÿche
.
	$g‘
(
£lf
.
id
)

643 
fš®ly
:

644 
£lf
.
mc_lock
.
	$»Ëa£
()

646 
def
 
	$_§ve
(
£lf
, 
expœ©iÚ_time
):

647 #S’d 
the
 
expœ©iÚ
 
time
 
as
 "Unixime" (
£cÚds
 
sšû
 1/1/1970)

648 
td
 = (
time
.
	`mktime
(
expœ©iÚ_time
.
	$tim‘u¶e
()))

649 
£lf
.
mc_lock
.
	$acquœe
()

650 
Œy
:

651 
nÙ
 
£lf
.
ÿche
.
	`£t
(£lf.
id
, (£lf.
_d©a
, 
expœ©iÚ_time
), 
td
):

652 
¿i£
 
	`As£¹iÚE¼Ü
("SessiÚ d©¨fÜ id %¸nÙ s‘." % 
£lf
.
id
)

653 
fš®ly
:

654 
£lf
.
mc_lock
.
	$»Ëa£
()

656 
def
 
	$_d–‘e
(
£lf
):

657 
£lf
.
ÿche
.
	$d–‘e
(
£lf
.
id
)

659 
def
 
	$acquœe_lock
(
£lf
):

661 
£lf
.
locked
 = 
True


662 
£lf
.
locks
.
	`£tdeçuÉ
(£lf.
id
, 
th»adšg
.
	`RLock
()).
	$acquœe
()

664 
def
 
	$»Ëa£_lock
(
£lf
):

666 
£lf
.
locks
[£lf.
id
].
	$»Ëa£
()

667 
£lf
.
locked
 = 
F®£


669 
def
 
	$__Ën__
(
£lf
):

671 
¿i£
 
NÙIm¶em’‹dE¼Ü


674 #Hook 
	`funùiÚs
 (
Ch”ryPy
 
toŞs
)

676 
def
 
	$§ve
():

679 
nÙ
 
	`ha§‰r
(
ch”rypy
.
£rvšg
, "session"):

681 
»que¡
 = 
ch”rypy
.
£rvšg
.request

682 
»¥Ú£
 = 
ch”rypy
.
£rvšg
.response

684 #Gu¬d 
agaš¡
 
ruÂšg
 
twiû


685 
	`ha§‰r
(
»que¡
, "_sessionsaved"):

687 
»que¡
.
_£ssiÚ§ved
 = 
True


689 
»¥Ú£
.
¡»am
:

690 #Ià
the
 
body
 
is
 
bešg
 
¡»amed
, 
we
 
have
 
to
 
§ve
h
d©a


691 #*
aá”
* 
the
 
»¥Ú£
 
has
 
b“n
 
wr™‹n
 
out


692 
»que¡
.
hooks
.
	`©ch
('Ú_’d_»que¡', 
ch”rypy
.
£ssiÚ
.
§ve
)

694 #Ià
the
 
body
 
is
 
nÙ
 
bešg
 
¡»amed
, 
we
 
§ve
h
d©a
 
now


695 #(
so
 
we
 
ÿn
 
»Ëa£
 
the
 
lock
).

696 
	$isš¡ªû
(
»¥Ú£
.
body
, 
ty³s
.
G’”©ÜTy³
):

697 
»¥Ú£
.
	$cŞÏp£_body
()

698 
ch”rypy
.
£ssiÚ
.
	$§ve
()

699 
§ve
.
ç§ã
 = 
True


701 
def
 
	$şo£
():

703 
£ss
 = 
	`g‘©Œ
(
ch”rypy
.
£rvšg
, "£ssiÚ", 
NÚe
)

704 
	`g‘©Œ
(
£ss
, "locked", 
F®£
):

705 #Ià
the
 
£ssiÚ
 
is
 
¡l
 
locked
 
we
 
»Ëa£
h
lock


706 
£ss
.
	$»Ëa£_lock
()

707 
şo£
.
ç§ã
 = 
True


708 
şo£
.
´iÜ™y
 = 90

711 
def
 
	`š™
(
¡Üage_ty³
='¿m', 
·th
=
NÚe
, 
·th_h—d”
=NÚe, 
Çme
='session_id',

712 
timeout
=60, 
domaš
=
NÚe
, 
£cu»
=
F®£
, 
ş—n_äeq
=5,

713 
³rsi¡’t
=
True
, 
h‰pÚly
=
F®£
, 
debug
=F®£, **
kw¬gs
):

716 
¡Üage_ty³


717 
OÃ
 
of
 '¿m', 'fe', 'po¡g»sql', 'memÿched'. 
This
 
wl
 
be


718 
u£d
 
to
 
look
 
up
 
the
 
cÜ»¥Údšg
 
şass
 
š
 
ch”rypy
.
lib
.
£ssiÚs


719 
glob®s
. 
FÜ
 
exam¶e
, 'fe' 
wl
 
u£
 
the
 
FeSessiÚ
 
şass
.

721 
·th


722 
The
 '·th' 
v®ue
 
to
 
¡ick
 
š
 
the
 
»¥Ú£
 
cook›
 
m‘ad©a
.

724 
·th_h—d”


725 
If
 '·th' 
is
 
	`NÚe
 (
the
 ), 
th’
h
»¥Ú£


726 
cook›
 '·th' 
wl
 
be
 
puÎed
 
äom
 
»que¡
.
h—d”s
[
·th_h—d”
].

728 
Çme


729 
The
 
Çme
 
of
 
the
 
cook›
.

731 
timeout


732 
The
 
expœ©iÚ
 
	$timeout
 (
š
 
mšu‹s
è
the
 
¡Üed
 
£ssiÚ
 
d©a
.

733 
If
 '³rsi¡’t' 
is
 
	`True
 (
the
 ), 
this
 i 
®so
h
timeout


734 
the
 
cook›
.

736 
domaš


737 
The
 
cook›
 
domaš
.

739 
£cu»


740 
If
 
	$F®£
 (
the
 èth
cook›
 '£cu»' 
v®ue
 
wl
 
nÙ


741 
be
 
£t
. 
If
 
True
, 
the
 
cook›
 '£cu»' 
v®ue
 
wl
 b
	`£t
 (
to
 1).

743 
	$ş—n_äeq
 (
mšu‹s
)

744 
The
 
pŞl
 
¿‹
 
expœed
 
£ssiÚ
 
ş—nup
.

746 
³rsi¡’t


747 
If
 
	`True
 (
the
 ),h'timeout' 
¬gum’t
 
wl
 
be
 
u£d


748 
to
 
expœe
 
the
 
cook›
. 
If
 
F®£
,hcook› 
wl
 
nÙ
 
have
 
ª
 
expœy
,

749 
ªd
 
the
 
cook›
 
wl
 
be
 
a
 "£ssiÚ cook›" 
which
 
expœes
 
wh’
he

750 
brow£r
 
is
 
şo£d
.

752 
h‰pÚly


753 
If
 
	$F®£
 (
the
 èth
cook›
 'h‰pÚly' 
v®ue
 
wl
 
nÙ
 
be
 
£t
.

754 
If
 
True
, 
the
 
cook›
 'h‰pÚly' 
v®ue
 
wl
 
be
 
	`£t
 (
to
 1).

756 
Any
 
add™iÚ®
 
kw¬gs
 
wl
 
be
 
bound
 
to
 
the
 
Ãw
 
SessiÚ
 
š¡ªû
,

757 
ªd
 
may
 
be
 
¥ecific
 
to
 
the
 
¡Üage
 
ty³
. 
S“
h
subşass
 
of
 
SessiÚ


758 
you
're using for more information.

761 
»que¡
 = 
ch”rypy
.
£rvšg
.request

763 #Gu¬d 
agaš¡
 
ruÂšg
 
twiû


764 
	`ha§‰r
(
»que¡
, "_session_init_flag"):

766 
»que¡
.
_£ssiÚ_š™_æag
 = 
True


768 #Check 
»que¡
 
ÿme
 
w™h
 
a
 
£ssiÚ
 
ID


769 
id
 = 
NÚe


770 
Çme
 
š
 
»que¡
.
cook›
:

771 
id
 = 
»que¡
.
cook›
[
Çme
].
v®ue


772 
debug
:

773 
ch”rypy
.
	`log
('ID obšed from„eque¡.cook›: %r' % 
id
,

776 #Fšd 
the
 
¡Üage
 
şass
 
ªd
 
ÿÎ
 
	`£tup
 (
fœ¡
 
time
 
Úly
).

777 
¡Üage_şass
 = 
¡Üage_ty³
.
	`t™Ë
() + 'Session'

778 
¡Üage_şass
 = 
	`glob®s
()[storage_class]

779 
nÙ
 
	`ha§‰r
(
ch”rypy
, "session"):

780 
	`ha§‰r
(
¡Üage_şass
, "setup"):

781 
¡Üage_şass
.
	$£tup
(**
kw¬gs
)

783 #C»©
ªd
 
©ch
 
a
 
Ãw
 
SessiÚ
 
š¡ªû
 
to
 
ch”rypy
.
£rvšg
.

784 #Iˆ
wl
 
pos£ss
 
a
 
»ã»nû
 
	`to
 (
ªd
 
lock
,‡nd 
Ïzy
 
lßd
)

785 #th
»que¡ed
 
£ssiÚ
 
d©a
.

786 
kw¬gs
['timeout'] = 
timeout


787 
kw¬gs
['ş—n_äeq'] = 
ş—n_äeq


788 
ch”rypy
.
£rvšg
.
£ssiÚ
 = 
£ss
 = 
	$¡Üage_şass
(
id
, **
kw¬gs
)

789 
£ss
.
debug
 = debug

790 
def
 
	$upd©e_cook›
(
id
):

792 
ch”rypy
.
£rvšg
.
»¥Ú£
.
cook›
[
Çme
] = 
id


793 
£ss
.
id_ob£rv”s
.
	$­³nd
(
upd©e_cook›
)

795 #C»©
ch”rypy
.
£ssiÚ
 
which
 
wl
 
´oxy
 
to
 ch”rypy.
£rvšg
.session

796 
nÙ
 
	`ha§‰r
(
ch”rypy
, "session"):

797 
ch”rypy
.
£ssiÚ
 = ch”rypy.
	`_Th»adLoÿlProxy
('session')

799 
³rsi¡’t
:

800 
cook›_timeout
 = 
timeout


802 #S“ 
h‰p
:

803 #ªd 
h‰p
:

804 
cook›_timeout
 = 
NÚe


805 
	$£t_»¥Ú£_cook›
(
·th
õ©h, 
·th_h—d”
õ©h_h—d”, 
Çme
=name,

806 
timeout
=
cook›_timeout
, 
domaš
=domaš, 
£cu»
=secure,

807 
h‰pÚly
=httponly)

810 
def
 
	`£t_»¥Ú£_cook›
(
·th
=
NÚe
, 
·th_h—d”
=NÚe, 
Çme
='session_id',

811 
timeout
=60, 
domaš
=
NÚe
, 
£cu»
=
F®£
, 
h‰pÚly
=False):

814 
·th


815 
the
 '·th' 
v®ue
 
to
 
¡ick
 
š
h
»¥Ú£
 
cook›
 
m‘ad©a
.

817 
·th_h—d”


818 '·th' 
is
 
	`NÚe
 (
the
 ), 
th’
h
»¥Ú£


819 
cook›
 '·th' 
wl
 
be
 
puÎed
 
äom
 
»que¡
.
h—d”s
[
·th_h—d”
].

821 
Çme


822 
the
 
Çme
 
of
h
cook›
.

824 
timeout


825 
the
 
expœ©iÚ
 
timeout
 th
cook›
. 
If
 0 
Ü
 
Ùh”
 
boŞ—n


826 
F®£
, 
no
 'expœes' 
·¿m
 
wl
 
be
 
£t
, 
ªd
 
the
 
cook›
 wÈb
a


827 "£ssiÚ cook›" 
which
 
expœes
 
wh’
 
the
 
brow£r
 
is
 
şo£d
.

829 
domaš


830 
the
 
cook›
 
domaš
.

832 
£cu»


833 
	$F®£
 (
the
 èth
cook›
 '£cu»' 
v®ue
 
wl
 
nÙ


834 
be
 
£t
. 
If
 
True
, 
the
 
cook›
 '£cu»' 
v®ue
 
wl
 b
	`£t
 (
to
 1).

836 
h‰pÚly


837 
If
 
	$F®£
 (
the
 èth
cook›
 'h‰pÚly' 
v®ue
 
wl
 
nÙ
 
be
 
£t
.

838 
If
 
True
, 
the
 
cook›
 'h‰pÚly' 
v®ue
 
wl
 
be
 
	`£t
 (
to
 1).

841 #S‘ 
»¥Ú£
 
cook›


842 
cook›
 = 
ch”rypy
.
£rvšg
.
»¥Ú£
.cookie

843 
cook›
[
Çme
] = 
ch”rypy
.
£rvšg
.
£ssiÚ
.
id


844 
cook›
[
Çme
]['·th'] = (
·th
 
Ü
 
ch”rypy
.
£rvšg
.
»que¡
.
h—d”s
.
	$g‘
(
·th_h—d”
)

845 
Ü
 '/')

849 #§v
™
 
to
 
disk
 
ªd
 
the
 
£ssiÚ
 
is
 
lo¡
 
³İË
 
şo£


850 #th
brow£r
. 
So
 
we
 
have
 
to
 
u£
 
the
 
Şd
 "expœes" ... 
sigh
 ...

851 ## 
cook›
[
Çme
]['max-age'] = 
timeout
 * 60

852 
timeout
:

853 
e
 = 
time
.
	`time
(è+ (
timeout
 * 60)

854 
cook›
[
Çme
]['expœes'] = 
h‰put
.
	$HTTPD©e
(
e
)

855 
domaš
 
is
 
nÙ
 
NÚe
:

856 
cook›
[
Çme
]['domaš'] = 
domaš


857 
£cu»
:

858 
cook›
[
Çme
]['secure'] = 1

859 
h‰pÚly
:

860 
nÙ
 
cook›
[
Çme
].
	`isRe£rvedKey
('httponly'):

861 
¿i£
 
	`V®ueE¼Ü
("The httponly cookieoken is‚ot supported.")

862 
cook›
[
Çme
]['httponly'] = 1

864 
def
 
	$expœe
():

866 
Çme
 = 
ch”rypy
.
£rvšg
.
»que¡
.
cÚfig
.
	`g‘
('tools.sessions.name', 'session_id')

867 
Úe_y—r
 = 60 * 60 * 24 * 365

868 
e
 = 
time
.
	`time
(è- 
Úe_y—r


869 
ch”rypy
.
£rvšg
.
»¥Ú£
.
cook›
[
Çme
]['expœes'] = 
h‰put
.
	`HTTPD©e
(
e
)

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/lib/static.py

1 
	gŒy
:

2 
äom
 
io
 
impÜt
 
UnsuµÜ‹dO³¿tiÚ


3 
exû±
 
ImpÜtE¼Ü
:

4 
UnsuµÜ‹dO³¿tiÚ
 = 
	$objeù
()

5 
impÜt
 
loggšg


6 
impÜt
 
mim‘y³s


7 
mim‘y³s
.
	$š™
()

8 
mim‘y³s
.
ty³s_m­
['.dwg']='image/x-dwg'

9 
mim‘y³s
.
ty³s_m­
['.ico']='image/x-icon'

10 
mim‘y³s
.
ty³s_m­
['.bz2']='application/x-bzip2'

11 
mim‘y³s
.
ty³s_m­
['.gz']='application/x-gzip'

13 
impÜt
 
os


14 
impÜt
 
»


15 
impÜt
 
¡©


16 
impÜt
 
time


18 
impÜt
 
ch”rypy


19 
äom
 
ch”rypy
.
_ıcom·t
 
impÜt
 
Áob
, 
unquÙe


20 
äom
 
ch”rypy
.
lib
 
impÜt
 
ıtoŞs
, 
h‰put
, 
fe_g’”©Ü_lim™ed


23 
def
 
	$£rve_fe
(
·th
, 
cÚ‹Á_ty³
=
NÚe
, 
di¥os™iÚ
=NÚe, 
Çme
=NÚe, 
debug
=
F®£
):

26 
The
 
CÚ‹Á
-
Ty³
 
h—d”
 
wl
 
be
 
£t
 
to
 
the
 
cÚ‹Á_ty³
 
¬g
, 
´ovided
.

27 
If
 
nÙ
 
´ovided
, 
the
 
CÚ‹Á
-
Ty³
 
wl
 
be
 
gues£d
 
by
h
fe
 
ex‹nsiÚ


28 
of
 
the
 '·th' 
¬gum’t
.

30 
If
 
di¥os™iÚ
 
is
 
nÙ
 
NÚe
, 
the
 
CÚ‹Á
-
Di¥os™iÚ
 
h—d”
 
wl
 
be
 
£t


31 
to
 "<di¥os™iÚ>; f’ame=<Çme>". 
If
 
Çme
 
is
 
NÚe
, 
™
 
wl
 
be
 
£t


32 
to
 
the
 
ba£Çme
 
of
 
·th
. 
If
 
di¥os™iÚ
 
is
 
NÚe
, 
no
 
CÚ‹Á
-
Di¥os™iÚ


33 
h—d”
 
wl
 
be
 
wr™‹n
.

36 
»¥Ú£
 = 
ch”rypy
.
£rvšg
.response

38 #Ià
·th
 
is
 
»Ïtive
, 
u£rs
 
should
 
fix
 
™
 
by
 
makšg
…©h 
absŞu‹
.

39 #Th© 
is
, 
Ch”ryPy
 
should
 
nÙ
 
guess
 
wh”e
 
the
 
­¶iÿtiÚ
 
roÙ
 is.

40 #Iˆ
û¹ašly
 
should
 *
nÙ
* 
u£
 
	`cwd
 (
sšû
 
CP
 
may
 
be
 
švoked
 
äom
 
a


41 #v¬›ty 
of
 
·ths
). 
If
 
usšg
 
toŞs
.
¡©icdœ
, 
you
 
ÿn
 
make
 
your
 
»Ïtive


42 #·th 
become
 
absŞu‹
 
by
 
suµlyšg
 
a
 
v®ue
 "tools.staticdir.root".

43 
nÙ
 
os
.
·th
.
	$i§bs
(
·th
):

44 
msg
 = "'%s' i nÙ‡ÀabsŞu‹…©h." % 
·th


45 
debug
:

46 
ch”rypy
.
	`log
(
msg
, 'TOOLS.STATICFILE')

47 
¿i£
 
	$V®ueE¼Ü
(
msg
)

49 
Œy
:

50 
¡
 = 
os
.
	$¡©
(
·th
)

51 
exû±
 
OSE¼Ü
:

52 
debug
:

53 
ch”rypy
.
	`log
('os.¡©(%rèçed' % 
·th
, 'TOOLS.STATIC')

54 
¿i£
 
ch”rypy
.
	$NÙFound
()

56 #Check 
·th
 
is
 
a
 
dœeùÜy
.

57 
¡©
.
	$S_ISDIR
(
¡
.
¡_mode
):

58 #L‘ 
the
 
ÿÎ”
 
d—l
 
w™h
 
™
 
as
 
they
 
like
.

59 
debug
:

60 
ch”rypy
.
	`log
('%¸i ¨dœeùÜy' % 
·th
, 'TOOLS.STATIC')

61 
¿i£
 
ch”rypy
.
	$NÙFound
()

63 #S‘ 
the
 
La¡
-
Modif›d
 
»¥Ú£
 
h—d”
, 
so
 
th©


64 #modif›d-
sšû
 
v®id©iÚ
 
code
 
ÿn
 
wÜk
.

65 
»¥Ú£
.
h—d”s
['La¡-Modif›d'] = 
h‰put
.
	$HTTPD©e
(
¡
.
¡_mtime
)

66 
ıtoŞs
.
	$v®id©e_sšû
()

68 
cÚ‹Á_ty³
 
is
 
NÚe
:

69 #S‘ 
cÚ‹Á
-
ty³
 
ba£d
 
Ú
 
f’ame
 
ex‹nsiÚ


70 
ext
 = ""

71 
i
 = 
·th
.
	`rfšd
('.')

72 
i
 != -1:

73 
ext
 = 
·th
[
i
:].
	$low”
()

74 
cÚ‹Á_ty³
 = 
mim‘y³s
.
ty³s_m­
.
	$g‘
(
ext
, 
NÚe
)

75 
cÚ‹Á_ty³
 
is
 
nÙ
 
NÚe
:

76 
»¥Ú£
.
h—d”s
['CÚ‹Á-Ty³'] = 
cÚ‹Á_ty³


77 
debug
:

78 
ch”rypy
.
	`log
('CÚ‹Á-Ty³: %r' % 
cÚ‹Á_ty³
, 'TOOLS.STATIC')

80 
cd
 = 
NÚe


81 
di¥os™iÚ
 
is
 
nÙ
 
NÚe
:

82 
Çme
 
is
 
NÚe
:

83 
Çme
 = 
os
.
·th
.
	$ba£Çme
(
·th
)

84 
cd
 = '%s; f’ame="%s"' % (
di¥os™iÚ
, 
Çme
)

85 
»¥Ú£
.
h—d”s
["CÚ‹Á-Di¥os™iÚ"] = 
cd


86 
debug
:

87 
ch”rypy
.
	`log
('CÚ‹Á-Di¥os™iÚ: %r' % 
cd
, 'TOOLS.STATIC')

89 #S‘ 
CÚ‹Á
-
L’gth
 
ªd
 
u£
 
ª
 
	`™”abË
 (
fe
 
objeù
)

90 #thi 
way
 
CP
 
wÚ
't†oadhe whole file in memory

91 
cÚ‹Á_Ëngth
 = 
¡
.
¡_size


92 
feobj
 = 
	`İ’
(
·th
, 'rb')

93  
	$_£rve_feobj
(
feobj
, 
cÚ‹Á_ty³
, 
cÚ‹Á_Ëngth
, 
debug
=debug)

95 
def
 
	$£rve_feobj
(
feobj
, 
cÚ‹Á_ty³
=
NÚe
, 
di¥os™iÚ
=NÚe, 
Çme
=None,

96 
debug
=
F®£
):

99 
The
 
CÚ‹Á
-
Ty³
 
h—d”
 
wl
 
be
 
£t
 
to
 
the
 
cÚ‹Á_ty³
 
¬g
, 
´ovided
.

101 
If
 
di¥os™iÚ
 
is
 
nÙ
 
NÚe
, 
the
 
CÚ‹Á
-
Di¥os™iÚ
 
h—d”
 
wl
 
be
 
£t


102 
to
 "<di¥os™iÚ>; f’ame=<Çme>". 
If
 
Çme
 
is
 
NÚe
, 'f’ame' 
wl


103 
nÙ
 
be
 
£t
. 
If
 
di¥os™iÚ
 
is
 
NÚe
, 
no
 
CÚ‹Á
-
Di¥os™iÚ
 
h—d”
 
wl


104 
be
 
wr™‹n
.

106 
CAUTION
: 
If
 
the
 
»que¡
 
cÚšs
 
a
 'Rªge' 
h—d”
, 
Úe
 
Ü
 
mÜe
 
	$£ek
()
s
 
wl


107 
be
 
³rfÜmed
 
Ú
 
the
 
fe
 
objeù
. 
This
 
may
 
ÿu£
 
undesœed
 
behaviÜ
 

108 
the
 
fe
 
objeù
 
is
 
nÙ
 
£ekabË
. 
It
 
could
 
®so
 
´oduû
 
undesœed
 
»suÉs


109 
the
 
ÿÎ”
 
£t
h
»ad
 
pos™iÚ
 
of
h
fe
 
objeù
 
´iÜ
 
to
 
ÿÎšg


110 
	`£rve_feobj
(), 
ex³ùšg
 
th©
 
the
 
d©a
 
would
 
be
 
£rved
 
¡¬tšg
 
äom
hat

111 
pos™iÚ
.

114 
»¥Ú£
 = 
ch”rypy
.
£rvšg
.response

116 
Œy
:

117 
¡
 = 
os
.
	`f¡©
(
feobj
.
	$f’o
())

118 
exû±
 
A‰ribu‹E¼Ü
:

119 
debug
:

120 
ch”rypy
.
	`log
('os has‚o fstat‡ttribute', 'TOOLS.STATIC')

121 
cÚ‹Á_Ëngth
 = 
NÚe


122 
exû±
 
UnsuµÜ‹dO³¿tiÚ
:

123 
cÚ‹Á_Ëngth
 = 
NÚe


125 #S‘ 
the
 
La¡
-
Modif›d
 
»¥Ú£
 
h—d”
, 
so
 
th©


126 #modif›d-
sšû
 
v®id©iÚ
 
code
 
ÿn
 
wÜk
.

127 
»¥Ú£
.
h—d”s
['La¡-Modif›d'] = 
h‰put
.
	$HTTPD©e
(
¡
.
¡_mtime
)

128 
ıtoŞs
.
	$v®id©e_sšû
()

129 
cÚ‹Á_Ëngth
 = 
¡
.
¡_size


131 
cÚ‹Á_ty³
 
is
 
nÙ
 
NÚe
:

132 
»¥Ú£
.
h—d”s
['CÚ‹Á-Ty³'] = 
cÚ‹Á_ty³


133 
debug
:

134 
ch”rypy
.
	`log
('CÚ‹Á-Ty³: %r' % 
cÚ‹Á_ty³
, 'TOOLS.STATIC')

136 
cd
 = 
NÚe


137 
di¥os™iÚ
 
is
 
nÙ
 
NÚe
:

138 
Çme
 
is
 
NÚe
:

139 
cd
 = 
di¥os™iÚ


141 
cd
 = '%s; f’ame="%s"' % (
di¥os™iÚ
, 
Çme
)

142 
»¥Ú£
.
h—d”s
["CÚ‹Á-Di¥os™iÚ"] = 
cd


143 
debug
:

144 
ch”rypy
.
	`log
('CÚ‹Á-Di¥os™iÚ: %r' % 
cd
, 'TOOLS.STATIC')

146  
	$_£rve_feobj
(
feobj
, 
cÚ‹Á_ty³
, 
cÚ‹Á_Ëngth
, 
debug
=debug)

148 
def
 
	$_£rve_feobj
(
feobj
, 
cÚ‹Á_ty³
, 
cÚ‹Á_Ëngth
, 
debug
=
F®£
):

150 
»¥Ú£
 = 
ch”rypy
.
£rvšg
.response

152 #HTTP/1.0 
didn
't have Range/Accept-Ranges headers, orhe 206 code

153 
»que¡
 = 
ch”rypy
.
£rvšg
.request

154 
»que¡
.
´ÙocŞ
 >= (1, 1):

155 
»¥Ú£
.
h—d”s
["Accept-Ranges"] = "bytes"

156 
r
 = 
h‰put
.
	`g‘_¿nges
(
»que¡
.
h—d”s
.
	`g‘
('Rªge'), 
cÚ‹Á_Ëngth
)

157 
r
 == []:

158 
»¥Ú£
.
h—d”s
['CÚ‹Á-Rªge'] = "by‹ */%s" % 
cÚ‹Á_Ëngth


159 
mes§ge
 = "Invalid Range (first-byte-pos greaterhan Content-Length)"

160 
debug
:

161 
ch”rypy
.
	`log
(
mes§ge
, 'TOOLS.STATIC')

162 
¿i£
 
ch”rypy
.
	$HTTPE¼Ü
(416, 
mes§ge
)

164 
r
:

165 
	`Ën
(
r
) == 1:

166 #R‘uº 
a
 
sšgË
-
·¹
 
»¥Ú£
.

167 
¡¬t
, 
¡İ
 = 
r
[0]

168 
¡İ
 > 
cÚ‹Á_Ëngth
:

169 
¡İ
 = 
cÚ‹Á_Ëngth


170 
r_Ën
 = 
¡İ
 - 
¡¬t


171 
debug
:

172 
ch”rypy
.
	`log
('SšgË…¬t; s¹: %r, stİ: %r' % (
¡¬t
, 
¡İ
),

174 
»¥Ú£
.
¡©us
 = "206 Partial Content"

175 
»¥Ú£
.
h—d”s
['Content-Range'] = (

176 "by‹ %s-%s/%s" % (
¡¬t
, 
¡İ
 - 1, 
cÚ‹Á_Ëngth
))

177 
»¥Ú£
.
h—d”s
['CÚ‹Á-L’gth'] = 
r_Ën


178 
feobj
.
	$£ek
(
¡¬t
)

179 
»¥Ú£
.
body
 = 
	$fe_g’”©Ü_lim™ed
(
feobj
, 
r_Ën
)

181 #R‘uº 
a
 
muÉ¬t
/
by‹¿nges
 
»¥Ú£
.

182 
»¥Ú£
.
¡©us
 = "206 Partial Content"

183 
Œy
:

185 
äom
 
ema
.
g’”©Ü
 
impÜt
 
_make_bound¬y
 
as
 
choo£_bound¬y


186 
exû±
 
ImpÜtE¼Ü
:

188 
äom
 
mim‘oŞs
 
impÜt
 
choo£_bound¬y


189 
bound¬y
 = 
	$choo£_bound¬y
()

190 
ù
 = "muÉ¬t/by‹¿nges; bound¬y=%s" % 
bound¬y


191 
»¥Ú£
.
h—d”s
['CÚ‹Á-Ty³'] = 
ù


192 "CÚ‹Á-L’gth" 
š
 
»¥Ú£
.
h—d”s
:

193 #D–‘
CÚ‹Á
-
L’gth
 
h—d”
 
so
 
	`fš®ize
(è
»ÿlcs
 
™
.

194 
d–
 
»¥Ú£
.
h—d”s
["Content-Length"]

196 
def
 
	$fe_¿nges
():

197 #A·ch
com·tib™y
:

198 
y›ld
 
	`Áob
("\r\n")

200 
¡¬t
, 
¡İ
 
š
 
r
:

201 
debug
:

202 
ch”rypy
.
	`log
('MuÉ¬t; s¹: %r, stİ: %r' % (
¡¬t
, 
¡İ
),

204 
y›ld
 
	`Áob
("--" + 
bound¬y
, 'ascii')

205 
y›ld
 
	`Áob
("\r\nCÚ‹Á-ty³: %s" % 
cÚ‹Á_ty³
, 'ascii')

206 
y›ld
 
	`Áob
("\r\nContent-range: bytes %s-%s/%s\r\n\r\n"

207 % (
¡¬t
, 
¡İ
 - 1, 
cÚ‹Á_Ëngth
), 'ascii')

208 
feobj
.
	$£ek
(
¡¬t
)

209 
chunk
 
š
 
	`fe_g’”©Ü_lim™ed
(
feobj
, 
¡İ
-
¡¬t
):

210 
y›ld
 
chunk


211 
y›ld
 
	`Áob
("\r\n")

212 #Fš® 
bound¬y


213 
y›ld
 
	`Áob
("--" + 
bound¬y
 + "--", 'ascii')

215 #A·ch
com·tib™y
:

216 
y›ld
 
	`Áob
("\r\n")

217 
»¥Ú£
.
body
 = 
	$fe_¿nges
()

218  
»¥Ú£
.
body


220 
debug
:

221 
ch”rypy
.
	`log
('No byteranges„equested', 'TOOLS.STATIC')

223 #S‘ 
CÚ‹Á
-
L’gth
 
ªd
 
u£
 
ª
 
	`™”abË
 (
fe
 
objeù
)

224 #thi 
way
 
CP
 
wÚ
't†oadhe whole file in memory

225 
»¥Ú£
.
h—d”s
['CÚ‹Á-L’gth'] = 
cÚ‹Á_Ëngth


226 
»¥Ú£
.
body
 = 
feobj


227  
»¥Ú£
.
body


229 
def
 
	$£rve_dowÆßd
(
·th
, 
Çme
=
NÚe
):

231 #Thi 
is
 
such
 
a
 
commÚ
 
idiom
 
I
 
ãÉ
 
™
 
de£rved
 
™s
 
own
 
w¿µ”
.

232  
	`£rve_fe
(
·th
, "­¶iÿtiÚ/x-dowÆßd", "©chm’t", 
Çme
)

235 
def
 
	$_©‹m±
(
f’ame
, 
cÚ‹Á_ty³s
, 
debug
=
F®£
):

236 
debug
:

237 
ch”rypy
.
	`log
('Attempting %r (content_types %r)' %

238 (
f’ame
, 
cÚ‹Á_ty³s
), 'TOOLS.STATICDIR')

239 
Œy
:

240 #you 
ÿn
 
£t
 
the
 
cÚ‹Á
 
ty³s
 
a


241 #com¶‘
dœeùÜy
 
³r
 
ex‹nsiÚ


242 
cÚ‹Á_ty³
 = 
NÚe


243 
cÚ‹Á_ty³s
:

244 
r
, 
ext
 = 
os
.
·th
.
	$¥l™ext
(
f’ame
)

245 
cÚ‹Á_ty³
 = 
cÚ‹Á_ty³s
.
	`g‘
(
ext
[1:], 
NÚe
)

246 
	$£rve_fe
(
f’ame
, 
cÚ‹Á_ty³
=cÚ‹Á_ty³, 
debug
=debug)

247  
True


248 
exû±
 
ch”rypy
.
NÙFound
:

249 #Ià
we
 
didn
't findhe static file, continue handlinghe

250 #»que¡. 
We
 
might
 
fšd
 
a
 
dyÇmic
 
hªdËr
 
š¡—d
.

251 
debug
:

252 
ch”rypy
.
	`log
('NotFound', 'TOOLS.STATICFILE')

253  
F®£


255 
def
 
	`¡©icdœ
(
£ùiÚ
, 
dœ
, 
roÙ
="", 
m©ch
="", 
cÚ‹Á_ty³s
=
NÚe
, 
šdex
="",

256 
debug
=
F®£
):

259 
m©ch


260 
If
 
giv’
, 
»que¡
.
·th_šfo
 
wl
 
be
 
£¬ched
 
the
 given

261 
»guÏr
 
ex´essiÚ
 
befÜe
 
©‹m±šg
 
to
 
£rve
 
cÚ‹Á
.

263 
cÚ‹Á_ty³s


264 
If
 
giv’
, 
™
 
should
 
be
 
a
 
PythÚ
 
diùiÚ¬y
 
of


265 {
fe
-
ex‹nsiÚ
: 
cÚ‹Á
-
ty³
}…aœs, wh”'fe-ex‹nsiÚ' is

266 
a
 
¡ršg
 (
e
.
g
. "gif"è
	gªd
 'cÚ‹Á-ty³' 
is
 
the
 
v®ue
 
to
 
wr™e


267 
out
 
š
 
the
 
	gCÚ‹Á
-
Ty³
 
»¥Ú£
 
h—d”
 (
e
.
g
. "image/gif").

269 
šdex


270 
If
 
	g´ovided
, 
™
 
should
 
be
 
	$the
 (
»Ïtive
è
Çme
 
of
 
a
 
fe
 
to


271 
£rve
 
dœeùÜy
 
»que¡s
. 
FÜ
 
exam¶e
, 
the
 
dœ
 
¬gum’t
 
is


272 '/home/me', 
the
 
Reque¡
-
URI
 
is
 'my­p', 
ªd
h
šdex
 
¬g
 is

273 'šdex.html', 
the
 
fe
 '/home/me/my­p/šdex.html' 
wl
 
be
 
sought
.

275 
»que¡
 = 
ch”rypy
.
£rvšg
.request

276 
»que¡
.
m‘hod
 
nÙ
 
	`š
 ('GET', 'HEAD'):

277 
debug
:

278 
ch”rypy
.
	`log
('request.method‚ot GET or HEAD', 'TOOLS.STATICDIR')

279  
F®£


281 
m©ch
 
ªd
 
nÙ
 
»
.
	$£¬ch
(
m©ch
, 
»que¡
.
·th_šfo
):

282 
debug
:

283 
ch”rypy
.
	`log
('request.path_info %r does‚ot match…attern %r' %

284 (
»que¡
.
·th_šfo
, 
m©ch
), 'TOOLS.STATICDIR')

285  
F®£


287 #AÎow 
the
 
u£
 
of
 '~' 
to
 
»ãr
Ø
a
 
u£r
's home directory.

288 
dœ
 = 
os
.
·th
.
	$ex·ndu£r
(
dœ
)

290 #Ià
dœ
 
is
 
»Ïtive
, 
make
 
absŞu‹
 
usšg
 "root".

291 
nÙ
 
os
.
·th
.
	$i§bs
(
dœ
):

292 
nÙ
 
roÙ
:

293 
msg
 = "Static dir„equires‡n‡bsolute dir (or„oot)."

294 
debug
:

295 
ch”rypy
.
	`log
(
msg
, 'TOOLS.STATICDIR')

296 
¿i£
 
	$V®ueE¼Ü
(
msg
)

297 
dœ
 = 
os
.
·th
.
	$još
(
roÙ
, 
dœ
)

299 #D‘”mš
wh”e
 
we
 
¬e
 
š
 
the
 
objeù
 
Œ“
 
»Ïtive
 
to
 'section'

300 #(
wh”e
 
the
 
toŞ
 
was
 
defšed
).

301 
£ùiÚ
 == 'global':

302 
£ùiÚ
 = "/"

303 
£ùiÚ
 = seùiÚ.
	`r¡r
(
r
"\/")

304 
b¿nch
 = 
»que¡
.
·th_šfo
[
	`Ën
(
£ùiÚ
) + 1:]

305 
b¿nch
 = 
	`unquÙe
(b¿nch.
	`l¡r
(
r
"\/"))

307 #Ià
b¿nch
 
is
 "", 
f’ame
 
wl
 
’d
 
š
 
a
 
¦ash


308 
f’ame
 = 
os
.
·th
.
	$još
(
dœ
, 
b¿nch
)

309 
debug
:

310 
ch”rypy
.
	`log
('Checking file %ro fulfill %r' %

311 (
f’ame
, 
»que¡
.
·th_šfo
), 'TOOLS.STATICDIR')

314 #hav".." 
Ü
 
sim¬
 
u¶ev–
 
©cks
 
š
 
™
. 
Check
 
th©
 
the
 
fš®


315 #f’am
is
 
a
 
chd
 
of
 
dœ
.

316 
nÙ
 
os
.
·th
.
	`nÜm·th
(
f’ame
).
	`¡¬tsw™h
(os.·th.
	$nÜm·th
(
dœ
)):

317 
¿i£
 
ch”rypy
.
	$HTTPE¼Ü
(403) #Forbidden

319 
hªdËd
 = 
	$_©‹m±
(
f’ame
, 
cÚ‹Á_ty³s
)

320 
nÙ
 
hªdËd
:

321 #Check 
ª
 
šdex
 
fe
 
a
 
fŞd”
 
was
 
»que¡ed
.

322 
šdex
:

323 
hªdËd
 = 
	`_©‹m±
(
os
.
·th
.
	`još
(
f’ame
, 
šdex
), 
cÚ‹Á_ty³s
)

324 
hªdËd
:

325 
»que¡
.
is_šdex
 = 
f’ame
[-1] 
	`š
 (
r
"\/")

326  
hªdËd


328 
def
 
	`¡©icfe
(
f’ame
, 
roÙ
=
NÚe
, 
m©ch
="", 
cÚ‹Á_ty³s
=NÚe, 
debug
=
F®£
):

331 
m©ch


332 
If
 
giv’
, 
»que¡
.
·th_šfo
 
wl
 
be
 
£¬ched
 
the
 given

333 
»guÏr
 
ex´essiÚ
 
befÜe
 
©‹m±šg
 
to
 
£rve
 
cÚ‹Á
.

335 
cÚ‹Á_ty³s


336 
If
 
giv’
, 
™
 
should
 
be
 
a
 
PythÚ
 
diùiÚ¬y
 
of


337 {
fe
-
ex‹nsiÚ
: 
cÚ‹Á
-
ty³
}…aœs, wh”'fe-ex‹nsiÚ' is

338 
a
 
¡ršg
 (
e
.
g
. "gif"è
	gªd
 'cÚ‹Á-ty³' 
is
 
the
 
v®ue
 
to
 
wr™e


339 
out
 
š
 
the
 
	gCÚ‹Á
-
Ty³
 
»¥Ú£
 
h—d”
 (
e
.
g
. "image/gif").

342 
	g»que¡
 = 
ch”rypy
.
£rvšg
.
»que¡


343 
»que¡
.
m‘hod
 
nÙ
 
š
 ('GET', 'HEAD'):

344 
debug
:

345 
ch”rypy
.
log
('request.method‚ot GET or HEAD', 'TOOLS.STATICFILE')

346  
F®£


348 
m©ch
 
ªd
 
nÙ
 
	g»
.
	$£¬ch
(
m©ch
, 
»que¡
.
·th_šfo
):

349 
debug
:

350 
ch”rypy
.
	`log
('request.path_info %r does‚ot match…attern %r' %

351 (
»que¡
.
·th_šfo
, 
m©ch
), 'TOOLS.STATICFILE')

352  
F®£


354 #Ià
f’ame
 
is
 
»Ïtive
, 
make
 
absŞu‹
 
usšg
 "root".

355 
nÙ
 
os
.
·th
.
	$i§bs
(
f’ame
):

356 
nÙ
 
roÙ
:

357 
msg
 = "StiøtoŞ„equœe ª‡bsŞu‹ f’am(gÙ '%s')." % 
f’ame


358 
debug
:

359 
ch”rypy
.
	`log
(
msg
, 'TOOLS.STATICFILE')

360 
¿i£
 
	$V®ueE¼Ü
(
msg
)

361 
f’ame
 = 
os
.
·th
.
	$još
(
roÙ
, 
f’ame
)

363  
	`_©‹m±
(
f’ame
, 
cÚ‹Á_ty³s
, 
debug
=debug)

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/lib/xmlrpcutil.py

1 
impÜt
 
sys


3 
impÜt
 
ch”rypy


4 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
Áob


6 
def
 
	$g‘_xmÌpşib
():

7 
Œy
:

8 
impÜt
 
xmÌpc
.
ş›Á
 
as
 
x


9 
exû±
 
ImpÜtE¼Ü
:

10 
impÜt
 
xmÌpşib
 
as
 
x


11  
x


13 
def
 
	$´oûss_body
():

15 
Œy
:

16  
	`g‘_xmÌpşib
().
	`lßds
(
ch”rypy
.
»que¡
.
body
.
	$»ad
())

17 
exû±
 
Exû±iÚ
:

21 
def
 
	$·tched_·th
(
·th
):

23 
nÙ
 
·th
.
	`’dsw™h
('/'):

24 
·th
 += '/'

25 
·th
.
	`¡¬tsw™h
('/RPC2/'):

26 #¡r 
the
 
fœ¡
 /
½c2


27 
·th
 =…ath[5:]

28  
·th


31 
def
 
	$_£t_»¥Ú£
(
body
):

32 #Th
XML
-
RPC
 
	`¥ec
 (
h‰p
:

33 #"
UÆess
 
th”e
's‡†ower-levelƒrror,‡lways„eturn 200 OK."

34 #Sšû 
PythÚ
's xmlrpclib interprets‡‚on-200„esponse

35 #a 
a
 "PrÙocŞ E¼Ü", 
we
'll just„eturn 200ƒveryime.

36 
»¥Ú£
 = 
ch”rypy
.response

37 
»¥Ú£
.
¡©us
 = '200 OK'

38 
»¥Ú£
.
body
 = 
	`Áob
(body, 'utf-8')

39 
»¥Ú£
.
h—d”s
['Content-Type'] = 'text/xml'

40 
»¥Ú£
.
h—d”s
['CÚ‹Á-L’gth'] = 
	$Ën
(
body
)

43 
def
 
	`»¥Úd
(
body
, 
’codšg
='utf-8', 
®low_nÚe
=0):

44 
xmÌpşib
 = 
	$g‘_xmÌpşib
()

45 
nÙ
 
	$isš¡ªû
(
body
, 
xmÌpşib
.
FauÉ
):

46 
body
 = (body,)

47 
	`_£t_»¥Ú£
(
xmÌpşib
.
	$dumps
(
body
, 
m‘hod»¥Ú£
=1,

48 
’codšg
=encoding,

49 
®low_nÚe
=allow_none))

51 
def
 
	$Ú_”rÜ
(*
¬gs
, **
kw¬gs
):

52 
body
 = 
	`¡r
(
sys
.
	`exc_šfo
()[1])

53 
xmÌpşib
 = 
	$g‘_xmÌpşib
()

54 
	`_£t_»¥Ú£
(
xmÌpşib
.
	`dumps
(xmÌpşib.
	`FauÉ
(1, 
body
)))

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/process/__init__.py

3 
A
 
Web
 
S™e
 
Proûss
 
Bus
 
objeù
 
is
 
u£d
 
to
 
cÚÃù
 
	g­¶iÿtiÚs
, 
	g£rv”s
,

4 
ªd
 
äamewÜks
 
w™h
 
	gs™e
-
wide
 
£rviûs
 
such
 
as
 
	gd«mÚiz©iÚ
, 
´oûss


5 
	g»lßd
, 
sigÇl
 
	ghªdlšg
, 
drİ
 
	g´iveges
, 
PID
 
fe
 
	gmªagem’t
, 
loggšg


6 
®l
 
of
 
	gthe£
, 
ªd
 
mªy
 
	gmÜe
.

8 
	gThe
 '¶ugšs' 
moduË
 
defšes
 
a
 
ãw
 
ab¡¿ù
 
ªd
 
cÚü‘e
 
£rviûs
 

9 
u£
 
w™h
 
the
 
	gbus
. 
Some
 u£ 
	gtoŞ
-
¥ecific
 
	gchªÃls
; 
£e
h
docum’tiÚ


10 
—ch
 
	gşass
.

13 
äom
 
	gch”rypy
.
	g´oûss
.
w¥bus
 
impÜt
 
bus


14 
äom
 
	gch”rypy
.
´oûss
 
impÜt
 
	g¶ugšs
, 
	g£rv”s


	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/process/plugins.py

3 
impÜt
 
os


4 
impÜt
 
»


5 
impÜt
 
sigÇl
 
as
 
_sigÇl


6 
impÜt
 
sys


7 
impÜt
 
time


8 
impÜt
 
th»adšg


10 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
	gba£¡ršg
, 
	gg‘_d«mÚ
, 
	gg‘_th»ad_id’t
, 
	gÁob
, 
	g£t
, 
	gTim”
, 
	gS‘D«mÚPrİ”ty


12 #_moduË__fe__ba£ 
is
 
u£d
 
by
 
AutÜ–ßd
 
to
 
make


13 #absŞu‹ 
ªy
 
f’ames
 
»Œ›ved
 
äom
 
sys
.
moduËs
 
which
 
¬e
 
nÙ


14 #®»ady 
absŞu‹
 
·ths
. 
This
 
is
 
to
 
wÜk
 
¬ound
 
PythÚ
's quirk

15 #oà
impÜtšg
 
the
 
¡¬tup
 
süt
 
ªd
 
usšg
 
a
 
»Ïtive
 
f’ame


16 #fÜ 
™
 
š
 
sys
.
moduËs
.

17 #
#AutÜ–ßd 
examšes
 
sys
.
moduËs
 
aäesh
 
ev”y
 
time
 
™
 
runs
. 
If
 
ª
 
­¶iÿtiÚ


18 #chªge 
the
 
cu¼’t
 
dœeùÜy
 
by
 
executšg
 
os
.
chdœ
(), 
th’
h
Ãxt
 
time


19 #AutÜ–ßd 
runs
, 
™
 
wl
 
nÙ
 
be
 
abË
 
to
 
fšd
 
ªy
 
f’ames
 
which
 
¬e


20 #nÙ 
absŞu‹
 
·ths
, 
beÿu£
 
the
 
cu¼’t
 
dœeùÜy
 
is
 
nÙ
h
§me
 
as
 
wh’
he

21 #moduË 
was
 
fœ¡
 
impÜ‹d
. 
AutÜ–ßd
 
wl
 
th’
 
wrÚgly
 
cÚşude
 
the
 
fe
 
has


22 #"
chªged
",‡nd initiatehe shutdown/re-exec sequence.

23 #S“ 
tick‘
 #917.

24 #FÜ 
this
 
wÜk¬ound
 
to
 
have
 
a
 
deûÁ
 
´obab™y
 
of
 
sucûss
,hi 
moduË


25 #Ãed 
to
 
be
 
impÜ‹d
 
as
 
—¾y
‡ 
possibË
, 
befÜe
 
the
 
­p
 
has
 
much
 
chªû


26 #tØ
chªge
 
the
 
wÜkšg
 
dœeùÜy
.

27 
	g_moduË__fe__ba£
 = 
os
.
	$g‘cwd
()

30 
şass
 
	$Sim¶ePlugš
(
objeù
):

33 
bus
 = 
NÚe


36 
def
 
	$__š™__
(
£lf
, 
bus
):

37 
£lf
.
bus
 = bus

39 
def
 
	$subsüibe
(
£lf
):

41 
chªÃl
 
š
 
£lf
.
bus
.
li¡’”s
:

42 #Subsüib
£lf
.
¡¬t
, s–f.
ex™
, 
‘c
. 
´e£Á
.

43 
m‘hod
 = 
	$g‘©Œ
(
£lf
, 
chªÃl
, 
NÚe
)

44 
m‘hod
 
is
 
nÙ
 
NÚe
:

45 
£lf
.
bus
.
	$subsüibe
(
chªÃl
, 
m‘hod
)

47 
def
 
	$unsubsüibe
(
£lf
):

49 
chªÃl
 
š
 
£lf
.
bus
.
li¡’”s
:

50 #Unsubsüib
£lf
.
¡¬t
, s–f.
ex™
, 
‘c
. 
´e£Á
.

51 
m‘hod
 = 
	$g‘©Œ
(
£lf
, 
chªÃl
, 
NÚe
)

52 
m‘hod
 
is
 
nÙ
 
NÚe
:

53 
£lf
.
bus
.
	$unsubsüibe
(
chªÃl
, 
m‘hod
)

57 
şass
 
	$SigÇlHªdËr
(
objeù
):

60 
You
 
ÿn
 
modify
 
wh©
 
sigÇls
 
your
 
­¶iÿtiÚ
 
li¡’s
 , 
ªd
 wh© 
™
 
dÛs


61 
wh’
 
™
 
»ûives
 
sigÇls
, 
by
 
modifyšg
 :
©Œ
:`
SigÇlHªdËr
.
hªdËrs
`,

62 
a
 
diù
 
of
 {
sigÇl
 
Çme
: 
ÿÎback
}…aœs. Th s‘ is::

64 
hªdËrs
 = {'SIGTERM': 
£lf
.
bus
.
ex™
,

65 'SIGHUP': 
£lf
.
hªdË_SIGHUP
,

66 'SIGUSR1': 
£lf
.
bus
.
g¿ûful
,

69 
The
 :
func
:`
SigÇlHªdËr
.
hªdË_SIGHUP
`` 
m‘hod
 
ÿÎs


70 :
func
:`
bus
.
»¡¬t
()<
ch”rypy
.
´oûss
.
w¥bus
.
Bus
.restart>`

71 
the
 
´oûss
 
is
 
d«mÚized
, 
	gbut


72 :
func
:`
bus
.
ex™
()<
ch”rypy
.
´oûss
.
w¥bus
.
Bus
.exit>`

73 
the
 
´oûss
 
is
 
©ched
 
to
 
a
 
TTY
. 
This
 i 
beÿu£
 
Unix
 
wšdow


74 
mªag”s
 
‹nd
 
to
 
£nd
 
SIGHUP
Ø
‹rmš®
 
wšdows
 
wh’
 
the
 
u£r
 
şo£s
 
them
.

76 
F“l
 
ä“
 
to
 
add
 
sigÇls
 
which
 
¬e
 
nÙ
 
avaabË
 
Ú
 
ev”y
 
¶©fÜm
. 
The


77 :
şass
:`
SigÇlHªdËr
` 
wl
 
ignÜe
 
”rÜs
 
¿i£d
 
äom
 
©‹m±šg
 
to
 

78 
hªdËrs
 
unknown
 
sigÇls
.

81 
hªdËrs
 = {}

84 
sigÇls
 = {}

87 
k
, 
v
 
š
 
v¬s
(
_sigÇl
).
	$™ems
():

88 
k
.
	`¡¬tsw™h
('SIG'è
ªd
 
nÙ
 k.startswith('SIG_'):

89 
sigÇls
[
v
] = 
k


90 
d–
 
k
, 
v


92 
def
 
	$__š™__
(
£lf
, 
bus
):

93 
£lf
.
bus
 = bus

94 #S‘  
hªdËrs


95 
£lf
.
hªdËrs
 = {'SIGTERM': s–f.
bus
.
ex™
,

96 'SIGHUP': 
£lf
.
hªdË_SIGHUP
,

97 'SIGUSR1': 
£lf
.
bus
.
g¿ûful
,

98 
	}
}

100 
sys
.
¶©fÜm
[:4] == 'java':

101 
d–
 
£lf
.
hªdËrs
['SIGUSR1']

102 
£lf
.
hªdËrs
['SIGUSR2'] = s–f.
bus
.
g¿ûful


103 
£lf
.
bus
.
log
("SIGUSR1 cannot be set onhe JVM…latform. "

105 
£lf
.
hªdËrs
['SIGINT'] = s–f.
_jythÚ_SIGINT_hªdËr


107 
£lf
.
_´evious_hªdËrs
 = {}

109 
def
 
	$_jythÚ_SIGINT_hªdËr
(
£lf
, 
signum
=
NÚe
, 
äame
=None):

110 #S“ 
h‰p
:

111 
£lf
.
bus
.
	`log
('Keyboard Interrupt: shutting down bus')

112 
£lf
.
bus
.
	$ex™
()

114 
def
 
	$subsüibe
(
£lf
):

116 
sig
, 
func
 
š
 
£lf
.
hªdËrs
.
	$™ems
():

117 
Œy
:

118 
£lf
.
	$£t_hªdËr
(
sig
, 
func
)

119 
exû±
 
V®ueE¼Ü
:

120 
·ss


122 
def
 
	$unsubsüibe
(
£lf
):

124 
signum
, 
hªdËr
 
š
 
£lf
.
_´evious_hªdËrs
.
	$™ems
():

125 
sigÇme
 = 
£lf
.
sigÇls
[
signum
]

127 
hªdËr
 
is
 
NÚe
:

128 
£lf
.
bus
.
	`log
("Re¡Üšg % hªdË¸tØSIG_DFL." % 
sigÇme
)

129 
hªdËr
 = 
_sigÇl
.
SIG_DFL


131 
£lf
.
bus
.
	`log
("Re¡Üšg % hªdË¸%r." % (
sigÇme
, 
hªdËr
))

133 
Œy
:

134 
our_hªdËr
 = 
_sigÇl
.
	$sigÇl
(
signum
, 
hªdËr
)

135 
our_hªdËr
 
is
 
NÚe
:

136 
£lf
.
bus
.
	`log
("Restored old %s handler %r, but our "

138 (
sigÇme
, 
hªdËr
), 
Ëv–
=30)

139 
exû±
 
V®ueE¼Ü
:

140 
£lf
.
bus
.
	`log
("Unableo„estore %s handler %r." %

141 (
sigÇme
, 
hªdËr
), 
Ëv–
=40, 
Œaûback
=
True
)

143 
def
 
	$£t_hªdËr
(
£lf
, 
sigÇl
, 
li¡’”
=
NÚe
):

146 
If
 
the
 
İtiÚ®
 'li¡’”' 
¬gum’t
 
is
 
´ovided
, 
™
 
wl
 
be


147 
subsüibed
 
as
 
a
 
li¡’”
 
the
 
giv’
 
sigÇl
's channel.

149 
If
 
the
 
giv’
 
sigÇl
 
Çme
 
Ü
 
numb”
 
is
 
nÙ
 
avaabË
 
Ú
h
cu¼’t


150 
¶©fÜm
, 
V®ueE¼Ü
 
is
 
¿i£d
.

152 
	$isš¡ªû
(
sigÇl
, 
ba£¡ršg
):

153 
signum
 = 
	$g‘©Œ
(
_sigÇl
, 
sigÇl
, 
NÚe
)

154 
signum
 
is
 
NÚe
:

155 
¿i£
 
	`V®ueE¼Ü
("NØsuch sigÇl: %r" % 
sigÇl
)

156 
sigÇme
 = 
sigÇl


158 
Œy
:

159 
sigÇme
 = 
£lf
.
sigÇls
[
sigÇl
]

160 
exû±
 
KeyE¼Ü
:

161 
¿i£
 
	`V®ueE¼Ü
("NØsuch sigÇl: %r" % 
sigÇl
)

162 
signum
 = 
sigÇl


164 
´ev
 = 
_sigÇl
.
	$sigÇl
(
signum
, 
£lf
.
_hªdË_sigÇl
)

165 
£lf
.
_´evious_hªdËrs
[
signum
] = 
´ev


167 
li¡’”
 
is
 
nÙ
 
NÚe
:

168 
£lf
.
bus
.
	`log
("Li¡’šg fÜ %s." % 
sigÇme
)

169 
£lf
.
bus
.
	$subsüibe
(
sigÇme
, 
li¡’”
)

171 
def
 
	$_hªdË_sigÇl
(
£lf
, 
signum
=
NÚe
, 
äame
=None):

173 
sigÇme
 = 
£lf
.
sigÇls
[
signum
]

174 
£lf
.
bus
.
	`log
("CaughˆsigÇÈ%s." % 
sigÇme
)

175 
£lf
.
bus
.
	$publish
(
sigÇme
)

177 
def
 
	$hªdË_SIGHUP
(
£lf
):

179 
os
.
	`i§‰y
(
sys
.
¡dš
.
	$f’o
()):

180 #nÙ 
	`d«mÚized
 (
may
 
be
 
fÜeground
 
Ü
 
background
)

181 
£lf
.
bus
.
	`log
("SIGHUP caught but‚ot daemonized. Exiting.")

182 
£lf
.
bus
.
	$ex™
()

184 
£lf
.
bus
.
	`log
("SIGHUP caught while daemonized. Restarting.")

185 
£lf
.
bus
.
	$»¡¬t
()

188 
Œy
:

189 
impÜt
 
pwd
, 
g½


190 
exû±
 
ImpÜtE¼Ü
:

191 
pwd
, 
g½
 = 
NÚe
, None

194 
şass
 
	$DrİPriveges
(
Sim¶ePlugš
):

197 
S³cŸl
 
thªks
 
to
 
Gavš
 
Bak”
: 
h‰p
:

200 
def
 
	$__š™__
(
£lf
, 
bus
, 
umask
=
NÚe
, 
uid
=NÚe, 
gid
=None):

201 
Sim¶ePlugš
.
	$__š™__
(
£lf
, 
bus
)

202 
£lf
.
fš®ized
 = 
F®£


203 
£lf
.
uid
 = uid

204 
£lf
.
gid
 = gid

205 
£lf
.
umask
 = umask

207 
def
 
	$_g‘_uid
(
£lf
):

208  
£lf
.
_uid


209 
def
 
	$_£t_uid
(
£lf
, 
v®
):

210 
v®
 
is
 
nÙ
 
NÚe
:

211 
pwd
 
is
 
NÚe
:

212 
£lf
.
bus
.
	`log
("pwd module‚ot‡vailable; ignoring uid.",

213 
Ëv–
=30)

214 
v®
 = 
NÚe


215 
–if
 
	$isš¡ªû
(
v®
, 
ba£¡ršg
):

216 
v®
 = 
pwd
.
	`g‘pwÇm
(val)[2]

217 
£lf
.
_uid
 = 
v®


218 
uid
 = 
	`´İ”ty
(
_g‘_uid
, 
_£t_uid
,

219 
doc
="The uid under whicho„un. Availability: Unix.")

221 
def
 
	$_g‘_gid
(
£lf
):

222  
£lf
.
_gid


223 
def
 
	$_£t_gid
(
£lf
, 
v®
):

224 
v®
 
is
 
nÙ
 
NÚe
:

225 
g½
 
is
 
NÚe
:

226 
£lf
.
bus
.
	`log
("grp module‚ot‡vailable; ignoring gid.",

227 
Ëv–
=30)

228 
v®
 = 
NÚe


229 
–if
 
	$isš¡ªû
(
v®
, 
ba£¡ršg
):

230 
v®
 = 
g½
.
	`g‘gºam
(val)[2]

231 
£lf
.
_gid
 = 
v®


232 
gid
 = 
	`´İ”ty
(
_g‘_gid
, 
_£t_gid
,

233 
doc
="The gid under whicho„un. Availability: Unix.")

235 
def
 
	$_g‘_umask
(
£lf
):

236  
£lf
.
_umask


237 
def
 
	$_£t_umask
(
£lf
, 
v®
):

238 
v®
 
is
 
nÙ
 
NÚe
:

239 
Œy
:

240 
os
.
umask


241 
exû±
 
A‰ribu‹E¼Ü
:

242 
£lf
.
bus
.
	`log
("umask function‚ot‡vailable; ignoring umask.",

243 
Ëv–
=30)

244 
v®
 = 
NÚe


245 
£lf
.
_umask
 = 
v®


246 
umask
 = 
	`´İ”ty
(
_g‘_umask
, 
_£t_umask
,

247 
doc
="""The default…ermission mode for‚ewly created files‡nd directories.

249 
Usu®ly
 
ex´es£d
 
š
 
où®
 
fÜm©
, 
exam¶e
, ``0644``.

250 
Avaab™y
: 
Unix
, 
Wšdows
.

253 
def
 
	$¡¬t
(
£lf
):

254 #uid/
gid


255 
def
 
	$cu¼’t_ids
():

257 
Çme
, 
group
 = 
NÚe
, None

258 
pwd
:

259 
Çme
 = 
pwd
.
	`g‘pwuid
(
os
.
	`g‘uid
())[0]

260 
g½
:

261 
group
 = 
g½
.
	`g‘grgid
(
os
.
	`g‘gid
())[0]

262  
Çme
, 
group


264 
£lf
.
fš®ized
:

265 
	$nÙ
 (
£lf
.
uid
 
is
 
NÚe
 
ªd
 s–f.
gid
 is None):

266 
£lf
.
bus
.
	`log
('Already„unning‡s uid: %r gid: %r' %

267 
	$cu¼’t_ids
())

269 
£lf
.
uid
 
is
 
NÚe
 
ªd
 s–f.
gid
 is None:

270 
pwd
 
Ü
 
g½
:

271 
£lf
.
bus
.
	`log
('uid/gid‚Ù s‘', 
Ëv–
=30)

273 
£lf
.
bus
.
	`log
('S¹ed‡ uid: %¸gid: %r' % 
	$cu¼’t_ids
())

274 
£lf
.
gid
 
is
 
nÙ
 
NÚe
:

275 
os
.
	$£tgid
(
£lf
.
gid
)

276 
os
.
	$£tgroups
([])

277 
£lf
.
uid
 
is
 
nÙ
 
NÚe
:

278 
os
.
	$£tuid
(
£lf
.
uid
)

279 
£lf
.
bus
.
	`log
('RuÂšg‡ uid: %¸gid: %r' % 
	$cu¼’t_ids
())

282 
£lf
.
fš®ized
:

283 
£lf
.
umask
 
is
 
nÙ
 
NÚe
:

284 
£lf
.
bus
.
	`log
('umask‡Ì—dy s‘o: %03o' % s–f.
umask
)

286 
£lf
.
umask
 
is
 
NÚe
:

287 
£lf
.
bus
.
	`log
('umask‚Ù s‘', 
Ëv–
=30)

289 
Şd_umask
 = 
os
.
	$umask
(
£lf
.
umask
)

290 
£lf
.
bus
.
	`log
('umask old: %03o,‚ew: %03o' %

291 (
Şd_umask
, 
£lf
.
umask
))

293 
£lf
.
fš®ized
 = 
True


294 #Thi 
is
 
¦ighy
 
high”
 
thª
 
the
 
´iÜ™y
 
£rv”
.
¡¬t


295 #š 
Üd”
 
to
 
çc™©e
 
the
 
mo¡
 
commÚ
 
u£
: 
¡¬tšg
 
Ú
 
a
 
low


296 #pÜˆ(
which
 
»quœes
 
roÙ
è
ªd
 
th’
 
drİpšg
 
to
 
ªÙh”
 
u£r
.

297 
¡¬t
.
´iÜ™y
 = 77

300 
şass
 
	$D«mÚiz”
(
Sim¶ePlugš
):

303 
U£
 
this
 
w™h
 
a
 
Web
 
S™e
 
Proûss
 
Bus
 
vŸ
::

305 
	`D«mÚiz”
(
bus
).
	$subsüibe
()

307 
Wh’
 
this
 
compÚ’t
 
fšishes
, 
the
 
´oûss
 
is
 
com¶‘–y
 
decou¶ed
 
äom


308 
the
 
·»Á
 
’vœÚm’t
. 
PËa£
 
nÙe
 
th©
 
wh’
 
this
 
compÚ’t
 
is
 
u£d
,

309 
the
  
code
 
äom
h
·»Á
 
´oûss
 
wl
 
¡l
 
be
 0 
a
 
¡¬tup


310 
”rÜ
 
occurs
 
š
 
the
 
fÜked
 
chd»n
. 
E¼Üs
 iÀth
š™Ÿl
 
d«mÚizšg


311 
´oûss
 
¡l
  
´İ”
 
ex™
 
codes
. 
Th”efÜe
, 
you
 
u£
 
this


312 
¶ugš
 
to
 
d«mÚize
, 
dÚ
't usehe„eturn code‡s‡n‡ccurate indicator

313 
of
 
wh‘h”
 
the
 
´oûss
 
fuÎy
 
¡¬‹d
. 
In
 
çù
, 
th©
  
code
 
Úly


314 
šdiÿ‹s
 
the
 
´oûss
 
sucûsfuÎy
 
fšished
h
fœ¡
 
fÜk
.

317 
def
 
	`__š™__
(
£lf
, 
bus
, 
¡dš
='/dev/nuÎ', 
¡dout
='/dev/null',

318 
¡d”r
='/dev/null'):

319 
Sim¶ePlugš
.
	$__š™__
(
£lf
, 
bus
)

320 
£lf
.
¡dš
 = stdin

321 
£lf
.
¡dout
 = stdout

322 
£lf
.
¡d”r
 = stderr

323 
£lf
.
fš®ized
 = 
F®£


325 
def
 
	$¡¬t
(
£lf
):

326 
£lf
.
fš®ized
:

327 
£lf
.
bus
.
	`log
('Already deamonized.')

329 #fÜkšg 
has
 
issues
 
w™h
 
th»ads
:

331 #"
The
 
g’”®
 
´obËm
 
w™h
 
makšg
 
	`fÜk
(è
wÜk
 
š
 
a
 
muÉi
-
th»aded


332 #wÜld 
is
 
wh©
 
to
 dØ
w™h
 
®l
 
of
 
the
 
th»ads
..."

333 #SØ
we
 
check
 
aùive
 
th»ads
:

334 
th»adšg
.
	`aùiveCouÁ
() != 1:

335 
£lf
.
bus
.
	`log
('There‡re %r‡ctivehreads. '

337 
th»adšg
.
	`’um”©e
(), 
Ëv–
=30)

339 #S“ 
h‰p
:

340 #(
Ü
 
h‰p
:

341 #ªd 
h‰p
:

343 #Fšish 
up
 
w™h
 
the
 
cu¼’t
 
¡dout
/
¡d”r


344 
sys
.
¡dout
.
	$æush
()

345 
sys
.
¡d”r
.
	$æush
()

347 #DØ
fœ¡
 
fÜk
.

348 
Œy
:

349 
pid
 = 
os
.
	$fÜk
()

350 
pid
 == 0:

351 #Thi 
is
 
the
 
chd
 
´oûss
. 
CÚtšue
.

352 
·ss


354 #Thi 
is
 
the
 
fœ¡
 
·»Á
. 
Ex™
, 
now
 
th©
 
we
've forked.

355 
£lf
.
bus
.
	`log
('Forking once.')

356 
os
.
	$_ex™
(0)

357 
exû±
 
OSE¼Ü
:

358 #PythÚ 
¿i£s
 
OSE¼Ü
 
¿th”
 
thª
 
»tuºšg
 
Ãg©ive
 
numb”s
.

359 
exc
 = 
sys
.
	`exc_šfo
()[1]

360 
sys
.
	`ex™
("%s: fork #1 failed: (%d) %s\n"

361 % (
sys
.
¬gv
[0], 
exc
.
”ºo
,ƒxc.
¡»¼Ü
))

363 
os
.
	$£tsid
()

365 #DØ
£cÚd
 
fÜk


366 
Œy
:

367 
pid
 = 
os
.
	$fÜk
()

368 
pid
 > 0:

369 
£lf
.
bus
.
	`log
('Forkingwice.')

370 
os
.
	$_ex™
(0è#Ex™ 
£cÚd
 
·»Á


371 
exû±
 
OSE¼Ü
:

372 
exc
 = 
sys
.
	`exc_šfo
()[1]

373 
sys
.
	`ex™
("%s: fork #2 failed: (%d) %s\n"

374 % (
sys
.
¬gv
[0], 
exc
.
”ºo
,ƒxc.
¡»¼Ü
))

376 
os
.
	`chdœ
("/")

377 
os
.
	$umask
(0)

379 
si
 = 
	`İ’
(
£lf
.
¡dš
, "r")

380 
so
 = 
	`İ’
(
£lf
.
¡dout
, "a+")

381 
£
 = 
	`İ’
(
£lf
.
¡d”r
, "a+")

383 #os.
	`dup2
(
fd
, 
fd2
è
wl
 
şo£
 fd2 
Ãûs§ry
,

384 #sØ
we
 
dÚ
'tƒxplicitly close stdin/out/err.

385 #S“ 
h‰p
:

386 
os
.
	`dup2
(
si
.
	`f’o
(), 
sys
.
¡dš
.
	$f’o
())

387 
os
.
	`dup2
(
so
.
	`f’o
(), 
sys
.
¡dout
.
	$f’o
())

388 
os
.
	`dup2
(
£
.
	`f’o
(), 
sys
.
¡d”r
.
	$f’o
())

390 
£lf
.
bus
.
	`log
('D«mÚizedØPID: %s' % 
os
.
	$g‘pid
())

391 
£lf
.
fš®ized
 = 
True


392 
¡¬t
.
´iÜ™y
 = 65

395 
şass
 
	$PIDFe
(
Sim¶ePlugš
):

398 
def
 
	$__š™__
(
£lf
, 
bus
, 
pidfe
):

399 
Sim¶ePlugš
.
	$__š™__
(
£lf
, 
bus
)

400 
£lf
.
pidfe
 =…idfile

401 
£lf
.
fš®ized
 = 
F®£


403 
def
 
	$¡¬t
(
£lf
):

404 
pid
 = 
os
.
	$g‘pid
()

405 
£lf
.
fš®ized
:

406 
£lf
.
bus
.
	`log
('PID %¸®»ady wr™‹ÀtØ%r.' % (
pid
, s–f.
pidfe
))

408 
	`İ’
(
£lf
.
pidfe
, "wb").
	`wr™e
(
	`Áob
("%s" % 
pid
, 'utf8'))

409 
£lf
.
bus
.
	`log
('PID %¸wr™‹ÀtØ%r.' % (
pid
, s–f.
pidfe
))

410 
£lf
.
fš®ized
 = 
True


411 
¡¬t
.
´iÜ™y
 = 70

413 
def
 
	$ex™
(
£lf
):

414 
Œy
:

415 
os
.
	$»move
(
£lf
.
pidfe
)

416 
£lf
.
bus
.
	`log
('PID f»moved: %r.' % s–f.
pidfe
)

417 
	$exû±
 (
KeybßrdIÁ”ru±
, 
Sy¡emEx™
):

418 
¿i£


419 
exû±
:

420 
·ss


423 
şass
 
	$P”³tu®Tim”
(
Tim”
):

426 
U£
 
this
 
tim”
 
Úly
 
wh’
 
you
 
»®ly
 
Ãed
 
a
 
v”y
 
š‹¼u±ibË
imer;

427 
this
 
checks
 
™s
 'fšished' 
cÚd™iÚ
 
up
 
to
 20 
times
 
a
 
£cÚd
, 
which
 
ÿn


428 
»suÉs
 
š
 
´‘ty
 
high
 
CPU
 
u§ge


431 
def
 
	$__š™__
(
£lf
, *
¬gs
, **
kw¬gs
):

433 
£lf
.
bus
 = 
kw¬gs
.
	`pİ
('bus', 
NÚe
)

434 
	`su³r
(
P”³tu®Tim”
, 
£lf
).
	$__š™__
(*
¬gs
, **
kw¬gs
)

436 
def
 
	$run
(
£lf
):

437 
True
:

438 
£lf
.
fšished
.
	$wa™
(
£lf
.
š‹rv®
)

439 
£lf
.
fšished
.
	$isS‘
():

441 
Œy
:

442 
£lf
.
	$funùiÚ
(*
£lf
.
¬gs
, **£lf.
kw¬gs
)

443 
exû±
 
Exû±iÚ
:

444 
£lf
.
bus
:

445 
£lf
.
bus
.
	`log
(

447 
£lf
.
funùiÚ
, 
Ëv–
=40, 
Œaûback
=
True
)

448 #Qu™ 
Ú
 
fœ¡
 
”rÜ
 
to
 
avoid
 
massive
 
logs
.

449 
¿i£


452 
şass
 
	$BackgroundTask
(
S‘D«mÚPrİ”ty
, 
th»adšg
.
Th»ad
):

455 
U£
 
this
 
şass
 
mo¡
 
»³©šg
 
sks
. 
It
 
u£s
 
time
.
	$¦“p
(è
to
 
wa™


456 
—ch
 
š‹rv®
, 
which
 
i¢
't very„esponsive;hat is,ƒven if you call

457 
£lf
.
	`ÿnûl
(), 
you
'll haveo wait untilhe sleep() call finishes before

458 
the
 
th»ad
 
¡İs
. 
To
 
com³n§‹
, 
™
 
deçuÉs
 
to
 
bešg
 
d«mÚic
, 
which
 
m—ns


459 
™
 
wÚ
't delay stoppinghe whole…rocess.

462 
def
 
	`__š™__
(
£lf
, 
š‹rv®
, 
funùiÚ
, 
¬gs
=[], 
kw¬gs
={
	}
}, 
	gbus
=
NÚe
):

463 
th»adšg
.
Th»ad
.
	$__š™__
(
£lf
)

464 
£lf
.
š‹rv®
 = interval

465 
£lf
.
funùiÚ
 = function

466 
£lf
.
¬gs
 =‡rgs

467 
£lf
.
kw¬gs
 = kwargs

468 
£lf
.
ruÂšg
 = 
F®£


469 
£lf
.
bus
 = bus

471 #deçuÉ 
to
 
d«mÚic


472 
£lf
.
d«mÚ
 = 
True


474 
def
 
	$ÿnûl
(
£lf
):

475 
£lf
.
ruÂšg
 = 
F®£


477 
def
 
	$run
(
£lf
):

478 
£lf
.
ruÂšg
 = 
True


479 
£lf
.
ruÂšg
:

480 
time
.
	$¦“p
(
£lf
.
š‹rv®
)

481 
nÙ
 
£lf
.
ruÂšg
:

483 
Œy
:

484 
£lf
.
	$funùiÚ
(*
£lf
.
¬gs
, **£lf.
kw¬gs
)

485 
exû±
 
Exû±iÚ
:

486 
£lf
.
bus
:

487 
£lf
.
bus
.
	`log
("Error in backgroundaskhread function %r."

488 % 
£lf
.
funùiÚ
, 
Ëv–
=40, 
Œaûback
=
True
)

489 #Qu™ 
Ú
 
fœ¡
 
”rÜ
 
to
 
avoid
 
massive
 
logs
.

490 
¿i£


493 
şass
 
	$MÚ™Ü
(
Sim¶ePlugš
):

496 
ÿÎback
 = 
NÚe


499 
äequ’cy
 = 60

502 
th»ad
 = 
NÚe


505 
def
 
	$__š™__
(
£lf
, 
bus
, 
ÿÎback
, 
äequ’cy
=60, 
Çme
=
NÚe
):

506 
Sim¶ePlugš
.
	$__š™__
(
£lf
, 
bus
)

507 
£lf
.
ÿÎback
 = callback

508 
£lf
.
äequ’cy
 = frequency

509 
£lf
.
th»ad
 = 
NÚe


510 
£lf
.
Çme
 =‚ame

512 
def
 
	$¡¬t
(
£lf
):

514 
£lf
.
äequ’cy
 > 0:

515 
th»adÇme
 = 
£lf
.
Çme
 
Ü
 s–f.
__şass__
.
__Çme__


516 
£lf
.
th»ad
 
is
 
NÚe
:

517 
£lf
.
th»ad
 = 
	$BackgroundTask
(
£lf
.
äequ’cy
, s–f.
ÿÎback
,

518 
bus
 = 
£lf
.bus)

519 
£lf
.
th»ad
.
	$£tName
(
th»adÇme
)

520 
£lf
.
th»ad
.
	$¡¬t
()

521 
£lf
.
bus
.
	`log
("S¹ed mÚ™Üh»ad %r." % 
th»adÇme
)

523 
£lf
.
bus
.
	`log
("MÚ™Üh»ad %¸®»ady s¹ed." % 
th»adÇme
)

524 
¡¬t
.
´iÜ™y
 = 70

526 
def
 
	$¡İ
(
£lf
):

528 
£lf
.
th»ad
 
is
 
NÚe
:

529 
£lf
.
bus
.
	`log
("NØth»ad„uÂšg fÜ %s." % s–f.
Çme
 
Ü
 s–f.
__şass__
.
__Çme__
)

531 
£lf
.
th»ad
 
is
 
nÙ
 
th»adšg
.
	$cu¼’tTh»ad
():

532 
Çme
 = 
£lf
.
th»ad
.
	$g‘Name
()

533 
£lf
.
th»ad
.
	$ÿnûl
()

534 
nÙ
 
	$g‘_d«mÚ
(
£lf
.
th»ad
):

535 
£lf
.
bus
.
	`log
("Joššg %r" % 
Çme
)

536 
£lf
.
th»ad
.
	$još
()

537 
£lf
.
bus
.
	`log
("Stİ³dh»ad %r." % 
Çme
)

538 
£lf
.
th»ad
 = 
NÚe


540 
def
 
	$g¿ûful
(
£lf
):

542 
£lf
.
	$¡İ
()

543 
£lf
.
	$¡¬t
()

546 
şass
 
	$AutÜ–ßd”
(
MÚ™Ü
):

549 
This
 :
»f
:`
¶ugš
<
¶ugšs
>` 
»¡¬ts
 
the
 
	`´oûss
 (
vŸ
 :
func
:`
os
.
execv
`)

550 
ªy
 
of
 
the
 
fes
 
™
 
mÚ™Üs
 
	`chªge
 (
Ü
 
is
 
d–‘ed
). 
By
 ,he

551 
autÜ–ßd”
 
mÚ™Üs
 
®l
 
impÜ‹d
 
moduËs
; 
you
 
ÿn
 
add
 
to
 
the


552 
£t
 
by
 
addšg
 
to
 ``
autÜ–ßd
.
fes
``::

554 
ch”rypy
.
’gše
.
autÜ–ßd
.
fes
.
	$add
(
myFe
)

556 
If
 
th”e
 
¬e
 
impÜ‹d
 
fes
 
you
 dØ*
nÙ
* 
wish
 
to
 
mÚ™Ü
, you 
ÿn
 
adju¡
 
the


557 ``
m©ch
`` 
©Œibu‹
, 
a
 
»guÏr
 
ex´essiÚ
. 
FÜ
 
exam¶e
, 
to
 
¡İ
 
mÚ™Üšg


558 
ch”rypy
 
™£lf
::

560 
ch”rypy
.
’gše
.
autÜ–ßd
.
m©ch
 = 
r
'^(?!cherrypy).+'

562 
Like
 
®l
 :
şass
:`
MÚ™Ü
<
ch”rypy
.
´oûss
.
¶ugšs
.Monitor>`…lugins,

563 
the
 
autÜ–ßd
 
¶ugš
 
kes
 
a
 ``
äequ’cy
`` 
¬gum’t
. 
The
  
is


564 1 
£cÚd
; 
th©
 
is
, 
the
 
autÜ–ßd”
 
wl
 
examše
 
fes
 
Úû
 
—ch
 second.

567 
fes
 = 
NÚe


570 
äequ’cy
 = 1

573 
m©ch
 = '.*'

576 
def
 
	`__š™__
(
£lf
, 
bus
, 
äequ’cy
=1, 
m©ch
='.*'):

577 
£lf
.
mtimes
 = {
	}
}

578 
£lf
.
fes
 = 
	$£t
()

579 
£lf
.
m©ch
 = match

580 
MÚ™Ü
.
	$__š™__
(
£lf
, 
bus
, s–f.
run
, 
äequ’cy
)

582 
def
 
	$¡¬t
(
£lf
):

584 
£lf
.
th»ad
 
is
 
NÚe
:

585 
£lf
.
mtimes
 = {
	}
}

586 
MÚ™Ü
.
	$¡¬t
(
£lf
)

587 
¡¬t
.
´iÜ™y
 = 70

589 
def
 
	$sysfes
(
£lf
):

591 
fes
 = 
	$£t
()

592 
k
, 
m
 
š
 
sys
.
moduËs
.
	$™ems
():

593 
»
.
	$m©ch
(
£lf
.
m©ch
, 
k
):

594 
	`ha§‰r
(
m
, '__lßd”__'è
ªd
 ha§‰r(m.
__lßd”__
, 'archive'):

595 
f
 = 
m
.
__lßd”__
.
¬chive


597 
f
 = 
	`g‘©Œ
(
m
, '__fe__', 
NÚe
)

598 
f
 
is
 
nÙ
 
NÚe
 
ªd
‚Ù 
os
.
·th
.
	$i§bs
(
f
):

599 #’su» 
absŞu‹
 
·ths
 
so
 
a
 
os
.
	`chdœ
(è
š
 
the
 
­p
 
dÛ¢
't break me

600 
f
 = 
os
.
·th
.
	`nÜm·th
(os.·th.
	$još
(
_moduË__fe__ba£
, 
f
))

601 
fes
.
	$add
(
f
)

602  
fes


604 
def
 
	$run
(
£lf
):

606 
f’ame
 
š
 
£lf
.
	`sysfes
(è| s–f.
fes
:

607 
f’ame
:

608 
f’ame
.
	`’dsw™h
('.pyc'):

609 
f’ame
 = filename[:-1]

611 
Şdtime
 = 
£lf
.
mtimes
.
	$g‘
(
f’ame
, 0)

612 
Şdtime
 
is
 
NÚe
:

613 #ModuË 
w™h
 
no
 .
py
 
fe
. 
Sk
 
™
.

616 
Œy
:

617 
mtime
 = 
os
.
	`¡©
(
f’ame
).
¡_mtime


618 
exû±
 
OSE¼Ü
:

619 #E™h” 
a
 
moduË
 
w™h
 
no
 .
py
 
fe
, 
Ü
 
™
's been deleted.

620 
mtime
 = 
NÚe


622 
f’ame
 
nÙ
 
š
 
£lf
.
mtimes
:

623 #Ià
a
 
moduË
 
has
 
no
 .
py
 
fe
, 
this
 
wl
 
be
 
NÚe
.

624 
£lf
.
mtimes
[
f’ame
] = 
mtime


626 
mtime
 
is
 
NÚe
 
Ü
 mtim> 
Şdtime
:

627 #Th
fe
 
has
 
b“n
 
d–‘ed
 
Ü
 
modif›d
.

628 
£lf
.
bus
.
	`log
("Re¡¬tšg beÿu£ % chªged." % 
f’ame
)

629 
£lf
.
th»ad
.
	$ÿnûl
()

630 
£lf
.
bus
.
	`log
("Stİ³dh»ad %r." % s–f.
th»ad
.
	$g‘Name
())

631 
£lf
.
bus
.
	$»¡¬t
()

635 
şass
 
	$Th»adMªag”
(
Sim¶ePlugš
):

638 
If
 
you
 
have
 
cÚŒŞ
 
ov”
 
th»ad
 
ü—tiÚ
 
ªd
 
de¡ruùiÚ
, 
publish
 
to


639 
the
 'acquœe_th»ad' 
ªd
 '»Ëa£_th»ad' 
	`chªÃls
 (
—ch
 
th»ad
).

640 
This
 
wl
 /
uÄegi¡”
 
the
 
cu¼’t
 
th»ad
 
ªd
 
publish
 
to


641 '¡¬t_th»ad' 
ªd
 '¡İ_th»ad' 
li¡’”s
 
š
 
the
 
bus
 
as
 
Ãeded
.

643 
If
 
th»ads
 
¬e
 
ü—‹d
 
ªd
 
de¡royed
 
by
 
code
 
you
 dØ
nÙ
 
cÚŒŞ


644 (
e
.
g
., 
A·che
), 
th’
, 
©
 
the
 
begšnšg
 
of
 
ev”y
 
HTTP
 
»que¡
,

645 
publish
 
to
 'acquœe_th»ad' 
Úly
. 
You
 
should
 
nÙ
…ublisho

646 '»Ëa£_th»ad' 
š
 
this
 , 
sšû
 
you
 dØ
nÙ
 
know
 
wh‘h”


647 
the
 
th»ad
 
wl
 
be
 
»
-
u£d
 
Ü
 
nÙ
. 
The
 
bus
 wÈ
ÿÎ


648 '¡İ_th»ad' 
li¡’”s
 
you
 
wh’
 
™
 
¡İs
.

651 
th»ads
 = 
NÚe


654 
def
 
	$__š™__
(
£lf
, 
bus
):

655 
£lf
.
th»ads
 = {
	}
}

656 
Sim¶ePlugš
.
	$__š™__
(
£lf
, 
bus
)

657 
£lf
.
bus
.
li¡’”s
.
	`£tdeçuÉ
('acquœe_th»ad', 
	$£t
())

658 
£lf
.
bus
.
li¡’”s
.
	`£tdeçuÉ
('¡¬t_th»ad', 
	$£t
())

659 
£lf
.
bus
.
li¡’”s
.
	`£tdeçuÉ
('»Ëa£_th»ad', 
	$£t
())

660 
£lf
.
bus
.
li¡’”s
.
	`£tdeçuÉ
('¡İ_th»ad', 
	$£t
())

662 
def
 
	$acquœe_th»ad
(
£lf
):

665 
If
 
the
 
cu¼’t
 
th»ad
 
has
 
®»ady
 
b“n
 
£’
, 
ªy
 'start_thread'

666 
li¡’”s
 
wl
 
nÙ
 
be
 
run
 
agaš
.

668 
th»ad_id’t
 = 
	$g‘_th»ad_id’t
()

669 
th»ad_id’t
 
nÙ
 
š
 
£lf
.
th»ads
:

670 #W
ÿn
't just use get_ident‡shehread ID

671 #beÿu£ 
some
 
¶©fÜms
 
»u£
 
th»ad
 
ID
's.

672 
i
 = 
	`Ën
(
£lf
.
th»ads
) + 1

673 
£lf
.
th»ads
[
th»ad_id’t
] = 
i


674 
£lf
.
bus
.
	`publish
('¡¬t_th»ad', 
i
)

676 
def
 
	$»Ëa£_th»ad
(
£lf
):

678 
th»ad_id’t
 = 
	$g‘_th»ad_id’t
()

679 
i
 = 
£lf
.
th»ads
.
	$pİ
(
th»ad_id’t
, 
NÚe
)

680 
i
 
is
 
nÙ
 
NÚe
:

681 
£lf
.
bus
.
	`publish
('¡İ_th»ad', 
i
)

683 
def
 
	$¡İ
(
£lf
):

685 
th»ad_id’t
, 
i
 
š
 
£lf
.
th»ads
.
	$™ems
():

686 
£lf
.
bus
.
	`publish
('¡İ_th»ad', 
i
)

687 
£lf
.
th»ads
.
	$ş—r
()

688 
g¿ûful
 = 
¡İ


	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/process/servers.py

2 
S¹šg
 
š
 
	gCh”ryPy
 3.1, 
	gch”rypy
.
£rv”
 
is
 
im¶em’‹d
 
as
 
	gª


3 :
»f
:`
Engše
 
Plugš
<
¶ugšs
>`. 
It
's‡n instance of

4 :
şass
:`
ch”rypy
.
_ı£rv”
.
S”v”
`, 
which
 
is
 
a
 
subşass
 
	gof


5 :
şass
:`
ch”rypy
.
´oûss
.
£rv”s
.
S”v”Ad­‹r
`. 
The
 ``ServerAdapter`` class

6 
is
 
desigÃd
 
to
 
cÚŒŞ
 
Ùh”
 
£rv”s
, 
as
 
	gw–l
.

8 
MuÉË
 
	g£rv”s
/
	gpÜts


11 
If
 
you
 
Ãed
 
to
 
¡¬t
 
mÜe
 
thª
 
Úe
 
HTTP
 
£rv”
 (tØ
£rve
 
Ú
 
muÉË
 
pÜts
, 
Ü


12 
´ÙocŞs
, 
‘c
.), 
you
 
ÿn
 
mªu®ly
 
—ch
 
Úe
 
ªd
 
th’
 
¡¬t
 
them
 
®l


13 
w™h
 
	g’gše
.
	g¡¬t
::

15 
s1
 = 
S”v”Ad­‹r
(
ch”rypy
.
’gše
, 
MyWSGIS”v”
(
ho¡
='0.0.0.0', 
pÜt
=80))

16 
s2
 = 
S”v”Ad­‹r
(
ch”rypy
.
’gše
, 
ªÙh”
.
HTTPS”v”
(
ho¡
='127.0.0.1', 
SSL
=
True
))

17 
s1
.
	$subsüibe
()

18 
s2
.
	$subsüibe
()

19 
ch”rypy
.
’gše
.
	`¡¬t
()

21 .. 
šdex
:: 
SCGI


23 
Fa¡CGI
/
SCGI


26 
Th”e
 
¬e
 
®so
 
Flup
\ **
F
**\ 
CGIS”v”
 
ªd
 Flup\ **
S
**\ CGIS”v” 
şas£s
 
š


27 :
mod
:`
ch”rypy
.
´oûss
.
£rv”s
`. 
To
 
¡¬t
 
ª
 
fcgi
 
£rv”
, 
exam¶e
,

28 
w¿p
 
ª
 
š¡ªû
 
of
 
™
 
š
 
a
 
S”v”Ad­‹r
::

30 
addr
 = ('0.0.0.0', 4000)

31 
f
 = 
£rv”s
.
	$FlupFCGIS”v”
(
­¶iÿtiÚ
=
ch”rypy
.
Œ“
, 
bšdAdd»ss
=
addr
)

32 
s
 = 
£rv”s
.
	$S”v”Ad­‹r
(
ch”rypy
.
’gše
, 
h‰p£rv”
=
f
, 
bšd_addr
=
addr
)

33 
s
.
	$subsüibe
()

35 
The
 :
doc
:`
ch”ryd
</
d•loyguide
/ch”ryd>` 
¡¬tup
 
süt
 
wl
 dØ
the
 
above
 

36 
you
 
vŸ
 
™s
 `-
f
` 
æag
.

37 
NÙe
 
th©
 
you
 
Ãed
 
to
 
dowÆßd
 
ªd
 
š¡®l
 `
æup
 <
h‰p
:

38 
your£lf
, 
wh‘h”
 
you
 
u£
 ``
ch”ryd
`` 
Ü
 
nÙ
.

40 .. 
_ç¡cgi
:

41 .. 
šdex
:: 
Fa¡CGI


43 
Fa¡CGI


46 
A
 
v”y
 
sim¶e
 
£tup
 
Ëts
 
your
 
ch”ry
 
run
 
w™h
 
Fa¡CGI
.

47 
You
 
ju¡
 
Ãed
 
the
 
æup
 
lib¿ry
,

48 
¶us
 
a
 
ruÂšg
 
A·che
 
	`£rv”
 (
w™h
 ``
mod_ç¡cgi
``è
Ü
 
ligh‰pd
 
£rv”
.

50 
Ch”ryPy
 
code


53 
h–lo
.
py
::

55 #!/
u¤
/
bš
/
pythÚ


56 
impÜt
 
ch”rypy


58 
şass
 
H–loWÜld
:

60 
def
 
	$šdex
(
£lf
):

62 
šdex
.
expo£d
 = 
True


64 
ch”rypy
.
Œ“
.
	`mouÁ
(
	$H–loWÜld
())

65 #Ch”ryPy 
autÜ–ßd
 
mu¡
 
be
 
di§bËd
 
the
 
æup
 
£rv”
 
to
 
wÜk


66 
ch”rypy
.
cÚfig
.
	`upd©e
({'’gše.autÜ–ßd_Ú':
F®£
})

68 
Th’
 
run
 :
doc
:`/
d•loyguide
/
ch”ryd
` 
w™h
 
the
 '-f' 
¬g
::

70 
ch”ryd
 -
c
 <
mycÚfig
> -
d
 -
f
 -
i
 
h–lo
.
py


72 
A·che


75 
At
 
the
 
tİ
 
Ëv–
 
š
 
h‰pd
.
cÚf
::

77 
Fa¡CgiIpcDœ
 /
tmp


78 
Fa¡CgiS”v”
 /
·th
/
to
/
ch”ry
.
fcgi
 -
idË
-
timeout
 120 -
´oûs£s
 4

80 
And
 
šside
 
the
 
»Ëvªt
 
Vœtu®Ho¡
 
£ùiÚ
::

82 #Fa¡CGI 
cÚfig


83 
AddHªdËr
 
ç¡cgi
-
süt
 .
fcgi


84 
SütAlŸsM©ch
 (.*
$
è/
·th
/
to
/
ch”ry
.
fcgi$1


86 
Ligh‰pd


89 
FÜ
 `
Ligh‰pd
 <
h‰p
:

90 
š¡ruùiÚs
. 
W™hš
 ``
ligh‰pd
.
cÚf
`` 
make
 
su»
 ``
mod_ç¡cgi
`` 
is


91 
aùive
 
w™hš
 ``
£rv”
.
moduËs
``. 
Th’
, w™hš 
	gyour
 ``
	g$HTTP
["host"]``

92 
	gdœeùive
, 
cÚfigu»
 
your
 
ç¡cgi
 
süt
 
like
 
the
 
	gfŞlowšg
::

94 
$HTTP
["url"] =~ "" {

95 
ç¡cgi
.
£rv”
 = (

103 "max-´ocs" => 1, #adju¡ 
as
 
	gÃeded


107 } #’d 
of
 
	g$HTTP
["url"] =~ "^/"

109 
PËa£
 
£e
 `
Ligh‰pd
 
Fa¡CGI
 
Docs


110 <
h‰p
:

111 
of
 
the
 
possibË
 
cÚfigu¿tiÚ
 
İtiÚs
.

114 
impÜt
 
sys


115 
impÜt
 
time


116 
impÜt
 
w¬nšgs


119 
şass
 
	$S”v”Ad­‹r
(
objeù
):

122 
If
 
you
 
Ãed
 
to
 
¡¬t
 
mÜe
 
thª
 
Úe
 
HTTP
 
	`£rv”
 (tØ
£rve
 
Ú
 
muÉË


123 
pÜts
, 
Ü
 
´ÙocŞs
, 
‘c
.), 
you
 
ÿn
 
mªu®ly
 
—ch
 
Úe
 
ªd
 
th’


124 
¡¬t
 
them
 
®l
 
w™h
 
bus
.start:

126 
s1
 = 
	`S”v”Ad­‹r
(
bus
, 
	`MyWSGIS”v”
(
ho¡
='0.0.0.0', 
pÜt
=80))

127 
s2
 = 
	`S”v”Ad­‹r
(
bus
, 
ªÙh”
.
	`HTTPS”v”
(
ho¡
='127.0.0.1', 
SSL
=
True
))

128 
s1
.
	$subsüibe
()

129 
s2
.
	$subsüibe
()

130 
bus
.
	`¡¬t
()

133 
def
 
	$__š™__
(
£lf
, 
bus
, 
h‰p£rv”
=
NÚe
, 
bšd_addr
=None):

134 
£lf
.
bus
 = bus

135 
£lf
.
h‰p£rv”
 = httpserver

136 
£lf
.
bšd_addr
 = bind_addr

137 
£lf
.
š‹¼u±
 = 
NÚe


138 
£lf
.
ruÂšg
 = 
F®£


140 
def
 
	$subsüibe
(
£lf
):

141 
£lf
.
bus
.
	`subsüibe
('¡¬t', s–f.
¡¬t
)

142 
£lf
.
bus
.
	`subsüibe
('¡İ', s–f.
¡İ
)

144 
def
 
	$unsubsüibe
(
£lf
):

145 
£lf
.
bus
.
	`unsubsüibe
('¡¬t', s–f.
¡¬t
)

146 
£lf
.
bus
.
	`unsubsüibe
('¡İ', s–f.
¡İ
)

148 
def
 
	$¡¬t
(
£lf
):

150 
£lf
.
bšd_addr
 
is
 
NÚe
:

151 
Ú_wh©
 = "unknown interface (dynamic?)"

152 
–if
 
	$isš¡ªû
(
£lf
.
bšd_addr
, 
tu¶e
):

153 
ho¡
, 
pÜt
 = 
£lf
.
bšd_addr


154 
Ú_wh©
 = "%s:%s" % (
ho¡
, 
pÜt
)

156 
Ú_wh©
 = "sock‘ fe: %s" % 
£lf
.
bšd_addr


158 
£lf
.
ruÂšg
:

159 
£lf
.
bus
.
	`log
("AÌ—dy s”všg oÀ%s" % 
Ú_wh©
)

162 
£lf
.
š‹¼u±
 = 
NÚe


163 
nÙ
 
£lf
.
h‰p£rv”
:

164 
¿i£
 
	`V®ueE¼Ü
("No HTTP server has been created.")

166 #S¹ 
the
 
h‰p£rv”
 
š
 
a
 
Ãw
 
th»ad
.

167 
	$isš¡ªû
(
£lf
.
bšd_addr
, 
tu¶e
):

168 
	$wa™_fÜ_ä“_pÜt
(*
£lf
.
bšd_addr
)

170 
impÜt
 
th»adšg


171 
t
 = 
th»adšg
.
	$Th»ad
(
rg‘
=
£lf
.
_¡¬t_h‰p_th»ad
)

172 
t
.
	`£tName
("HTTPS”v” " +.
	$g‘Name
())

173 
t
.
	$¡¬t
()

175 
£lf
.
	$wa™
()

176 
£lf
.
ruÂšg
 = 
True


177 
£lf
.
bus
.
	`log
("S”všg oÀ%s" % 
Ú_wh©
)

178 
¡¬t
.
´iÜ™y
 = 75

180 
def
 
	$_¡¬t_h‰p_th»ad
(
£lf
):

182 
maš
 
th»ad
 
³rsi¡s
 
to
 
»ûive
 
KeybßrdIÁ”ru±
's. If‡n

183 
exû±iÚ
 
is
 
¿i£d
 
š
 
the
 
h‰p£rv”
' th»adh’ it'
s


184 
Œ­³d
 
h”e
, 
ªd
 
the
 
	$bus
 (
ªd
 
th”efÜe
 
our
 
h‰p£rv”
)

185 
¬e
 
shut
 
down
.

187 
Œy
:

188 
£lf
.
h‰p£rv”
.
	$¡¬t
()

189 
exû±
 
KeybßrdIÁ”ru±
:

190 
£lf
.
bus
.
	`log
("<Ctrl-C> hit: shutting down HTTP server")

191 
£lf
.
š‹¼u±
 = 
sys
.
	`exc_šfo
()[1]

192 
£lf
.
bus
.
	$ex™
()

193 
exû±
 
Sy¡emEx™
:

194 
£lf
.
bus
.
	`log
("SystemExit„aised: shutting down HTTP server")

195 
£lf
.
š‹¼u±
 = 
sys
.
	`exc_šfo
()[1]

196 
£lf
.
bus
.
	$ex™
()

197 
¿i£


198 
exû±
:

199 
£lf
.
š‹¼u±
 = 
sys
.
	`exc_šfo
()[1]

200 
£lf
.
bus
.
	`log
("Error in HTTP server: shutting down",

201 
Œaûback
=
True
, 
Ëv–
=40)

202 
£lf
.
bus
.
	$ex™
()

203 
¿i£


205 
def
 
	$wa™
(
£lf
):

207 
nÙ
 
	`g‘©Œ
(
£lf
.
h‰p£rv”
, "»ady", 
F®£
):

208 
£lf
.
š‹¼u±
:

209 
¿i£
 
£lf
.
š‹¼u±


210 
time
.
	$¦“p
(.1)

212 #Wa™ 
pÜt
 
to
 
be
 
occup›d


213 
	$isš¡ªû
(
£lf
.
bšd_addr
, 
tu¶e
):

214 
ho¡
, 
pÜt
 = 
£lf
.
bšd_addr


215 
	$wa™_fÜ_occup›d_pÜt
(
ho¡
, 
pÜt
)

217 
def
 
	$¡İ
(
£lf
):

219 
£lf
.
ruÂšg
:

220 #¡İ(è
MUST
 
block
 
uÁ
 
the
 
£rv”
 
is
 *
Œuly
* 
¡İ³d
.

221 
£lf
.
h‰p£rv”
.
	$¡İ
()

222 #Wa™ 
the
 
sock‘
 
to
 
be
 
Œuly
 
ä“d
.

223 
	$isš¡ªû
(
£lf
.
bšd_addr
, 
tu¶e
):

224 
	$wa™_fÜ_ä“_pÜt
(*
£lf
.
bšd_addr
)

225 
£lf
.
ruÂšg
 = 
F®£


226 
£lf
.
bus
.
	`log
("HTTP S”v” % shuˆdown" % s–f.
h‰p£rv”
)

228 
£lf
.
bus
.
	`log
("HTTP S”v” % ®»ady shuˆdown" % s–f.
h‰p£rv”
)

229 
¡İ
.
´iÜ™y
 = 25

231 
def
 
	$»¡¬t
(
£lf
):

233 
£lf
.
	$¡İ
()

234 
£lf
.
	$¡¬t
()

237 
şass
 
	$FlupCGIS”v”
(
objeù
):

240 
def
 
	$__š™__
(
£lf
, *
¬gs
, **
kw¬gs
):

241 
£lf
.
¬gs
 =‡rgs

242 
£lf
.
kw¬gs
 = kwargs

243 
£lf
.
»ady
 = 
F®£


245 
def
 
	$¡¬t
(
£lf
):

247 #W
have
 
to
 
š¡ªtŸ‹
 
the
 
£rv”
 
şass
 
h”e
 
beÿu£
 
™s
 
__š™__


248 #¡¬t 
a
 
th»adpoŞ
. 
If
 
we
 dØ
™
 
too
 
—¾y
, 
d«mÚize
 
wÚ
't work.

249 
äom
 
æup
.
£rv”
.
cgi
 
impÜt
 
WSGIS”v”


251 
£lf
.
cgi£rv”
 = 
	$WSGIS”v”
(*
£lf
.
¬gs
, **£lf.
kw¬gs
)

252 
£lf
.
»ady
 = 
True


253 
£lf
.
cgi£rv”
.
	$run
()

255 
def
 
	$¡İ
(
£lf
):

257 
£lf
.
»ady
 = 
F®£


260 
şass
 
	$FlupFCGIS”v”
(
objeù
):

263 
def
 
	$__š™__
(
£lf
, *
¬gs
, **
kw¬gs
):

264 
kw¬gs
.
	`g‘
('bšdAdd»ss', 
NÚe
è
is
 None:

265 
impÜt
 
sock‘


266 
nÙ
 
	`ha§‰r
(
sock‘
, 'fromfd'):

267 
¿i£
 
	`V®ueE¼Ü
(

271 
£lf
.
¬gs
 =‡rgs

272 
£lf
.
kw¬gs
 = kwargs

273 
£lf
.
»ady
 = 
F®£


275 
def
 
	$¡¬t
(
£lf
):

277 #W
have
 
to
 
š¡ªtŸ‹
 
the
 
£rv”
 
şass
 
h”e
 
beÿu£
 
™s
 
__š™__


278 #¡¬t 
a
 
th»adpoŞ
. 
If
 
we
 dØ
™
 
too
 
—¾y
, 
d«mÚize
 
wÚ
't work.

279 
äom
 
æup
.
£rv”
.
fcgi
 
impÜt
 
WSGIS”v”


280 
£lf
.
fcgi£rv”
 = 
	$WSGIS”v”
(*
£lf
.
¬gs
, **£lf.
kw¬gs
)

281 #TODO: 
»pÜt
 
this
 
bug
 
up¡»am
 
to
 
æup
.

282 #Ià
we
 
dÚ
't set _oldSIGs on Windows, we get:

284 #lš108, 
š
 
run


285 #£lf.
	`_»¡ÜeSigÇlHªdËrs
()

287 #lš156, 
š
 
_»¡ÜeSigÇlHªdËrs


288 #fÜ 
signum
,
hªdËr
 
š
 
£lf
.
_ŞdSIGs
:

289 #A‰ribu‹E¼Ü: 'WSGIS”v”' 
objeù
 
has
 
no
 
©Œibu‹
 '_oldSIGs'

290 
£lf
.
fcgi£rv”
.
_š¡®lSigÇlHªdËrs
 = 
Ïmbda
: 
NÚe


291 
£lf
.
fcgi£rv”
.
_ŞdSIGs
 = []

292 
£lf
.
»ady
 = 
True


293 
£lf
.
fcgi£rv”
.
	$run
()

295 
def
 
	$¡İ
(
£lf
):

297 #FÜcibly 
¡İ
 
the
 
fcgi
 
£rv”
 
maš
 
ev’t
 
loİ
.

298 
£lf
.
fcgi£rv”
.
_k“pGošg
 = 
F®£


299 #FÜû 
®l
 
wÜk”
 
th»ads
 
to
 
d›
 
off
.

300 
£lf
.
fcgi£rv”
.
_th»adPoŞ
.
maxS·»
 = s–f.fcgi£rv”._th»adPoŞ.
_idËCouÁ


301 
£lf
.
»ady
 = 
F®£


304 
şass
 
	$FlupSCGIS”v”
(
objeù
):

307 
def
 
	$__š™__
(
£lf
, *
¬gs
, **
kw¬gs
):

308 
£lf
.
¬gs
 =‡rgs

309 
£lf
.
kw¬gs
 = kwargs

310 
£lf
.
»ady
 = 
F®£


312 
def
 
	$¡¬t
(
£lf
):

314 #W
have
 
to
 
š¡ªtŸ‹
 
the
 
£rv”
 
şass
 
h”e
 
beÿu£
 
™s
 
__š™__


315 #¡¬t 
a
 
th»adpoŞ
. 
If
 
we
 dØ
™
 
too
 
—¾y
, 
d«mÚize
 
wÚ
't work.

316 
äom
 
æup
.
£rv”
.
scgi
 
impÜt
 
WSGIS”v”


317 
£lf
.
scgi£rv”
 = 
	$WSGIS”v”
(*
£lf
.
¬gs
, **£lf.
kw¬gs
)

318 #TODO: 
»pÜt
 
this
 
bug
 
up¡»am
 
to
 
æup
.

319 #Ià
we
 
dÚ
't set _oldSIGs on Windows, we get:

321 #lš108, 
š
 
run


322 #£lf.
	`_»¡ÜeSigÇlHªdËrs
()

324 #lš156, 
š
 
_»¡ÜeSigÇlHªdËrs


325 #fÜ 
signum
,
hªdËr
 
š
 
£lf
.
_ŞdSIGs
:

326 #A‰ribu‹E¼Ü: 'WSGIS”v”' 
objeù
 
has
 
no
 
©Œibu‹
 '_oldSIGs'

327 
£lf
.
scgi£rv”
.
_š¡®lSigÇlHªdËrs
 = 
Ïmbda
: 
NÚe


328 
£lf
.
scgi£rv”
.
_ŞdSIGs
 = []

329 
£lf
.
»ady
 = 
True


330 
£lf
.
scgi£rv”
.
	$run
()

332 
def
 
	$¡İ
(
£lf
):

334 
£lf
.
»ady
 = 
F®£


335 #FÜcibly 
¡İ
 
the
 
scgi
 
£rv”
 
maš
 
ev’t
 
loİ
.

336 
£lf
.
scgi£rv”
.
_k“pGošg
 = 
F®£


337 #FÜû 
®l
 
wÜk”
 
th»ads
 
to
 
d›
 
off
.

338 
£lf
.
scgi£rv”
.
_th»adPoŞ
.
maxS·»
 = 0

341 
def
 
	$ş›Á_ho¡
(
£rv”_ho¡
):

343 
£rv”_ho¡
 == '0.0.0.0':

344 #0.0.0.0 
is
 
INADDR_ANY
, 
which
 
should
 
ªsw”
 
Ú
 
loÿlho¡
.

346 
£rv”_ho¡
 
	`š
 ('::', '::0', '::0.0.0.0'):

347 #:: 
is
 
IN6ADDR_ANY
, 
which
 
should
 
ªsw”
 
Ú
 
loÿlho¡
.

348 #::0 
ªd
 ::0.0.0.0 
¬e
 
nÚ
-
ÿnÚiÿl
 
but
 
commÚ
 
ways
 
to
 
wr™e
 
IN6ADDR_ANY
.

350  
£rv”_ho¡


352 
def
 
	$check_pÜt
(
ho¡
, 
pÜt
, 
timeout
=1.0):

354 
nÙ
 
ho¡
:

355 
¿i£
 
	`V®ueE¼Ü
("Host values of '' or None‡re‚ot‡llowed.")

356 
ho¡
 = 
	$ş›Á_ho¡
(
ho¡
)

357 
pÜt
 = (port)

359 
impÜt
 
sock‘


361 #AF_INET 
Ü
 
AF_INET6
 
sock‘


362 #G‘ 
the
 
cÜ»ù
 
add»ss
 
çmy
 
our
 
	`ho¡
 (
®lows
 
IPv6
 
add»s£s
)

363 
Œy
:

364 
šfo
 = 
sock‘
.
	$g‘addršfo
(
ho¡
, 
pÜt
, 
sock‘
.
AF_UNSPEC
,

365 
sock‘
.
SOCK_STREAM
)

366 
exû±
 
sock‘
.
ga›¼Ü
:

367 ':' 
š
 
ho¡
:

368 
šfo
 = [(
sock‘
.
AF_INET6
, sock‘.
SOCK_STREAM
, 0, "", (
ho¡
, 
pÜt
, 0, 0))]

370 
šfo
 = [(
sock‘
.
AF_INET
, sock‘.
SOCK_STREAM
, 0, "", (
ho¡
, 
pÜt
))]

372 
»s
 
š
 
šfo
:

373 
af
, 
sockty³
, 
´Ùo
, 
ÿnÚÇme
, 
§
 = 
»s


374 
s
 = 
NÚe


375 
Œy
:

376 
s
 = 
sock‘
.
	$sock‘
(
af
, 
sockty³
, 
´Ùo
)

377 #S“ 
h‰p
:

378 #brow£_äm/
th»ad
/
bbã5eb39c904ã0


379 
s
.
	$£‰imeout
(
timeout
)

380 
s
.
	`cÚÃù
((
ho¡
, 
pÜt
))

381 
s
.
	$şo£
()

382 
exû±
 
sock‘
.
”rÜ
:

383 
s
:

384 
s
.
	$şo£
()

386 
¿i£
 
	`IOE¼Ü
("Port %s is in use on %s;…erhapshe…revious "

388 (
	`»´
(
pÜt
), 
	$»´
(
ho¡
)))

391 #F“È
ä“
 
to
 
šü—£
 
the£
 
deçuÉs
 
Ú
 
¦ow
 
sy¡ems
:

392 
ä“_pÜt_timeout
 = 0.1

393 
occup›d_pÜt_timeout
 = 1.0

395 
def
 
	$wa™_fÜ_ä“_pÜt
(
ho¡
, 
pÜt
, 
timeout
=
NÚe
):

397 
nÙ
 
ho¡
:

398 
¿i£
 
	`V®ueE¼Ü
("Host values of '' or None‡re‚ot‡llowed.")

399 
timeout
 
is
 
NÚe
:

400 
timeout
 = 
ä“_pÜt_timeout


402 
ŒŸl
 
š
 
	$¿nge
(50):

403 
Œy
:

404 #w
¬e
 
ex³ùšg
 
a
 
ä“
 
pÜt
, 
so
 
»duû
 
the
 
timeout


405 
	$check_pÜt
(
ho¡
, 
pÜt
, 
timeout
=timeout)

406 
exû±
 
IOE¼Ü
:

407 #Giv
the
 
Şd
 
£rv”
 
th»ad
 
time
 
to
 
ä“
h
pÜt
.

408 
time
.
	$¦“p
(
timeout
)

412 
¿i£
 
	`IOE¼Ü
("PÜˆ%¸nÙ f»Ú %r" % (
pÜt
, 
ho¡
))

414 
def
 
	$wa™_fÜ_occup›d_pÜt
(
ho¡
, 
pÜt
, 
timeout
=
NÚe
):

416 
nÙ
 
ho¡
:

417 
¿i£
 
	`V®ueE¼Ü
("Host values of '' or None‡re‚ot‡llowed.")

418 
timeout
 
is
 
NÚe
:

419 
timeout
 = 
occup›d_pÜt_timeout


421 
ŒŸl
 
š
 
	$¿nge
(50):

422 
Œy
:

423 
	$check_pÜt
(
ho¡
, 
pÜt
, 
timeout
=timeout)

424 
exû±
 
IOE¼Ü
:

425 #pÜˆ
is
 
occup›d


428 
time
.
	$¦“p
(
timeout
)

430 
ho¡
 =ğ
	$ş›Á_ho¡
(
ho¡
):

431 
¿i£
 
	`IOE¼Ü
("PÜˆ%¸nÙ bound oÀ%r" % (
pÜt
, 
ho¡
))

433 #OÀ
sy¡ems
 
wh”e
 
a
 
loİback
 
š‹rçû
 
is
 
nÙ
 
avaabË
 
ªd
 
the


434 #£rv” 
is
 
bound
 
to
 
®l
 
š‹rçûs
, 
™
's difficulto determine

435 #wh‘h” 
the
 
£rv”
 
is
 
š
 
çù
 
occupyšg
h
pÜt
. 
In
 
this
 ,

436 #ju¡ 
issue
 
a
 
w¬nšg
 
ªd
 
move
 
Ú
. 
S“
 issue #1100.

437 
msg
 = "UÇbËØv”ifyh©h£rv” i bound oÀ%r" % 
pÜt


438 
w¬nšgs
.
	`w¬n
(
msg
)

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/process/win32.py

3 
impÜt
 
os


4 
impÜt
 
wš32­i


5 
impÜt
 
wš32cÚ


6 
impÜt
 
wš32ev’t


7 
impÜt
 
wš32£rviû


8 
impÜt
 
wš32£rviûut


10 
äom
 
	gch”rypy
.
´oûss
 
impÜt
 
	gw¥bus
, 
¶ugšs


13 
şass
 
	$CÚsŞeCŒlHªdËr
(
¶ugšs
.
Sim¶ePlugš
):

16 
def
 
	$__š™__
(
£lf
, 
bus
):

17 
£lf
.
is_£t
 = 
F®£


18 
¶ugšs
.
Sim¶ePlugš
.
	$__š™__
(
£lf
, 
bus
)

20 
def
 
	$¡¬t
(
£lf
):

21 
£lf
.
is_£t
:

22 
£lf
.
bus
.
	`log
('HªdË¸fÜ cÚsŞev’t ®»ady s‘.', 
Ëv–
=40)

25 
»suÉ
 = 
wš32­i
.
	$S‘CÚsŞeCŒlHªdËr
(
£lf
.
hªdË
, 1)

26 
»suÉ
 == 0:

27 
£lf
.
bus
.
	`log
('Could‚ot SetConsoleCtrlHandler (error %r)' %

28 
wš32­i
.
	`G‘La¡E¼Ü
(), 
Ëv–
=40)

30 
£lf
.
bus
.
	`log
('S‘ hªdË¸fÜ cÚsŞev’ts.', 
Ëv–
=40)

31 
£lf
.
is_£t
 = 
True


33 
def
 
	$¡İ
(
£lf
):

34 
nÙ
 
£lf
.
is_£t
:

35 
£lf
.
bus
.
	`log
('HªdË¸fÜ cÚsŞev’t ®»ady off.', 
Ëv–
=40)

38 
Œy
:

39 
»suÉ
 = 
wš32­i
.
	$S‘CÚsŞeCŒlHªdËr
(
£lf
.
hªdË
, 0)

40 
exû±
 
V®ueE¼Ü
:

41 #"
V®ueE¼Ü
: 
The
 
objeù
 
has
 
nÙ
 
b“n
 
»gi¡”ed
"

42 
»suÉ
 = 1

44 
»suÉ
 == 0:

45 
£lf
.
bus
.
	`log
('Could‚ot„emove SetConsoleCtrlHandler (error %r)' %

46 
wš32­i
.
	`G‘La¡E¼Ü
(), 
Ëv–
=40)

48 
£lf
.
bus
.
	`log
('Removed hªdË¸fÜ cÚsŞev’ts.', 
Ëv–
=40)

49 
£lf
.
is_£t
 = 
F®£


51 
def
 
	$hªdË
(
£lf
, 
ev’t
):

53 
ev’t
 
	$š
 (
wš32cÚ
.
CTRL_C_EVENT
, wš32cÚ.
CTRL_LOGOFF_EVENT
,

54 
wš32cÚ
.
CTRL_BREAK_EVENT
, wš32cÚ.
CTRL_SHUTDOWN_EVENT
,

55 
wš32cÚ
.
CTRL_CLOSE_EVENT
):

56 
£lf
.
bus
.
	`log
('CÚsŞev’ˆ%s: shu‰šg dowÀbus' % 
ev’t
)

58 #Remov
£lf
 
immedŸ‹ly
 
so
 
»³©ed
 
CŒl
-
C
 
dÛ¢
't„e-call it.

59 
Œy
:

60 
£lf
.
	$¡İ
()

61 
exû±
 
V®ueE¼Ü
:

62 
·ss


64 
£lf
.
bus
.
	$ex™
()

65 #'
Fœ¡
 
to
  
True
 
¡İs
 
the
 
ÿÎs
'

70 
şass
 
	$Wš32Bus
(
w¥bus
.
Bus
):

73 
In¡—d
 
of
 
time
.
¦“p
, 
this
 
bus
 
blocks
 
usšg
 
Çtive
 
wš32ev’t
 
objeùs
.

76 
def
 
	$__š™__
(
£lf
):

77 
£lf
.
ev’ts
 = {
	}
}

78 
w¥bus
.
Bus
.
	$__š™__
(
£lf
)

80 
def
 
	$_g‘_¡©e_ev’t
(
£lf
, 
¡©e
):

82 
Œy
:

83  
£lf
.
ev’ts
[
¡©e
]

84 
exû±
 
KeyE¼Ü
:

85 
ev’t
 = 
wš32ev’t
.
	`C»©eEv’t
(
NÚe
, 0, 0,

87 (
¡©e
.
Çme
, 
os
.
	$g‘pid
()))

88 
£lf
.
ev’ts
[
¡©e
] = 
ev’t


89  
ev’t


91 
def
 
	$_g‘_¡©e
(
£lf
):

92  
£lf
.
_¡©e


93 
def
 
	$_£t_¡©e
(
£lf
, 
v®ue
):

94 
£lf
.
_¡©e
 = 
v®ue


95 
ev’t
 = 
£lf
.
	$_g‘_¡©e_ev’t
(
v®ue
)

96 
wš32ev’t
.
	$Pul£Ev’t
(
ev’t
)

97 
¡©e
 = 
	$´İ”ty
(
_g‘_¡©e
, 
_£t_¡©e
)

99 
def
 
	$wa™
(
£lf
, 
¡©e
, 
š‹rv®
=0.1, 
chªÃl
=
NÚe
):

102 
Sšû
 
this
 
şass
 
u£s
 
Çtive
 
wš32ev’t
 
objeùs
, 
the
 
š‹rv®


103 
¬gum’t
 
is
 
ignÜed
.

105 
	`isš¡ªû
(
¡©e
, (
tu¶e
, 
li¡
)):

107 
£lf
.
¡©e
 
nÙ
 
š
 state:

108 
ev’ts
 = 
	`tu¶e
([
£lf
.
	$_g‘_¡©e_ev’t
(
s
è 
š
 
¡©e
])

109 
wš32ev’t
.
	$Wa™FÜMuÉËObjeùs
(
ev’ts
, 0, 
wš32ev’t
.
INFINITE
)

112 
£lf
.
¡©e
 != state:

113 
ev’t
 = 
£lf
.
	$_g‘_¡©e_ev’t
(
¡©e
)

114 
wš32ev’t
.
	$Wa™FÜSšgËObjeù
(
ev’t
, 
wš32ev’t
.
INFINITE
)

117 
şass
 
	$_CÚŒŞCodes
(
diù
):

118 """CÚŒŞ code u£dØ"
sigÇl
"‡ service via ControlService.

120 
U£r
-
defšed
 
cÚŒŞ
 
codes
 
¬e
 
š
 
the
 
¿nge
 128-255. 
We
 
g’”®ly
 
u£


121 
the
 
¡ªd¬d
 
PythÚ
 
v®ue
 th
Lšux
 
sigÇl
 
ªd
 
add
 128. 
Exam¶e
:

123 >>> 
sigÇl
.
SIGUSR1


125 
cÚŒŞ_codes
['graceful'] = 128 + 10

128 
def
 
	$key_fÜ
(
£lf
, 
obj
):

130 
key
, 
v®
 
š
 
£lf
.
	$™ems
():

131 
v®
 
is
 
obj
:

132  
key


133 
¿i£
 
	`V®ueE¼Ü
("Thgiv’ objeù could‚Ù bfound: %r" % 
obj
)

135 
cÚŒŞ_codes
 = 
	`_CÚŒŞCodes
({'g¿ûful': 138
	}
})

138 
def
 
	$sigÇl_chd
(
£rviû
, 
commªd
):

139 
commªd
 == 'stop':

140 
wš32£rviûut
.
	$StİS”viû
(
£rviû
)

141 
–if
 
commªd
 == 'restart':

142 
wš32£rviûut
.
	$Re¡¬tS”viû
(
£rviû
)

144 
wš32£rviûut
.
	$CÚŒŞS”viû
(
£rviû
, 
cÚŒŞ_codes
[
commªd
])

147 
şass
 
	$PyWebS”viû
(
wš32£rviûut
.
S”viûF¿mewÜk
):

150 
_svc_Çme_
 = "Python Web Service"

151 
_svc_di¥Ïy_Çme_
 = "Python Web Service"

152 
_svc_d•s_
 = 
NÚe
 #£qu’û 
of
 
£rviû
 
Çmes
 
Ú
 
which
 
this
 
d•’ds


153 
_exe_Çme_
 = "pywebsvc"

154 
_exe_¬gs_
 = 
NÚe
 #DeçuÉ 
to
 
no
 
¬gum’ts


156 #OÆy 
exi¡s
 
Ú
 
Wšdows
 2000 
Ü
 
Ï‹r
, 
ignÜed
 oÀ
wšdows
 
NT


157 
_svc_desütiÚ_
 = "Python Web Service"

159 
def
 
	$SvcDoRun
(
£lf
):

160 
äom
 
ch”rypy
 
impÜt
 
´oûss


161 
´oûss
.
bus
.
	$¡¬t
()

162 
´oûss
.
bus
.
	$block
()

164 
def
 
	$SvcStİ
(
£lf
):

165 
äom
 
ch”rypy
 
impÜt
 
´oûss


166 
£lf
.
	$R•ÜtS”viûStus
(
wš32£rviû
.
SERVICE_STOP_PENDING
)

167 
´oûss
.
bus
.
	$ex™
()

169 
def
 
	$SvcOth”
(
£lf
, 
cÚŒŞ
):

170 
´oûss
.
bus
.
	`publish
(
cÚŒŞ_codes
.
	$key_fÜ
(
cÚŒŞ
))

173 
__Çme__
 == '__main__':

174 
wš32£rviûut
.
	`HªdËCommªdLše
(
PyWebS”viû
)

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/process/wspbus.py

3 
This
 
moduË
 
is
 
com¶‘–y
 
	g¡ªd®Úe
, 
d•’dšg
 
Úly
 
Ú
 
the
 
	g¡dlib
.

5 
Web
 
S™e
 
Proûss
 
	gBus


8 
A
 
Bus
 
objeù
 
is
 
u£d
 
to
 
cÚš
 
ªd
 
mªage
 
	gs™e
-
wide
 
	gbehaviÜ
:

9 
d«mÚiz©iÚ
, 
HTTP
 
£rv”
 
	g¡¬t
/
	g¡İ
, 
´oûss
 
	g»lßd
, 
sigÇl
 
	ghªdlšg
,

10 
drİ
 
	g´iveges
, 
PID
 
fe
 
	gmªagem’t
, 
loggšg
 
®l
 
of
 
	gthe£
,

11 
ªd
 
mªy
 
	gmÜe
.

13 
In
 
	gadd™iÚ
, 
a
 
Bus
 
objeù
 
´ovides
‡ 
¶aû
 
—ch
 
web
 
äamewÜk


14 
to
 
code
 
th©
 
runs
 
š
 
»¥Ú£
Ø
	gs™e
-
wide
 
ev’ts
 (
like


15 
´oûss
 
¡¬t
 
ªd
 
¡İ
), 
Ü
 
which
 
cÚŒŞs
 o¸
Ùh”wi£
 
š‹¿ùs
 
w™h


16 
the
 
	gs™e
-
wide
 
compÚ’ts
 
m’tiÚed
 
	gabove
. 
FÜ
 
	gexam¶e
, 
a
 
äamewÜk
 
which


17 
u£s
 
	gfe
-
ba£d
 
‹m¶©es
 
would
 
add
 
known
 
‹m¶©e
 
f’ames
 
to
 
ª


18 
autÜ–ßd
 
	gcompÚ’t
.

20 
	gId—Îy
, 
a
 
Bus
 
objeù
 
wl
 
be
 
æexibË
 
’ough
 
to
 b
u£ful
 
š
‡ 
v¬›ty


21 
of
 
švoÿtiÚ
 
	gsûÇrios
:

23 1. 
The
 
d•loy”
 
¡¬ts
 
a
 
s™e
 
äom
 
the
 
commªd
 
lše
 
vŸ
‡

24 
äamewÜk
-
ÃuŒ®
 
d•loym’t
 
süt
; 
­¶iÿtiÚs
 
äom
 
muÉË
 
äamewÜks


25 
¬e
 
mixed
 
š
 
a
 
sšgË
 
	gs™e
. 
	gCommªd
-
lše
 
¬gum’ts
 
ªd
 
cÚfigu¿tiÚ


26 
fes
 
¬e
 
u£d
 
to
 
defše
 
	gs™e
-
wide
 
compÚ’ts
 
such
 
as
 
the
 
HTTP
 
	g£rv”
,

27 
WSGI
 
compÚ’t
 
	gg¿ph
, 
autÜ–ßd
 
	gbehaviÜ
, 
sigÇl
 
	ghªdlšg
, 
	g‘c
.

28 2. 
The
 
d•loy”
 
¡¬ts
 
a
 
s™e
 
vŸ
 
some
 
Ùh”
 
	g´oûss
, 
such
 
as
 
	gA·che
;

29 
­¶iÿtiÚs
 
äom
 
muÉË
 
äamewÜks
 
¬e
 
mixed
 
š
 
a
 
sšgË
 
	gs™e
.

30 
AutÜ–ßd
 
ªd
 
sigÇl
 
	$hªdlšg
 (
äom
 
PythÚ
 
©
 
Ëa¡
è
¬e
 
di§bËd
.

31 3. 
The
 
d•loy”
 
¡¬ts
 
a
 
s™e
 
vŸ
‡ 
äamewÜk
-
¥ecific
 
mechªism
;

32 
exam¶e
, 
wh’
 
ruÂšg
 
‹¡s
, 
ex¶Üšg
 
tutÜŸls
, 
Ü
 
d•loyšg


33 
sšgË
 
­¶iÿtiÚs
 
äom
 
a
 sšgË 
äamewÜk
. 
The
 f¿mewÜk 
cÚŒŞs


34 
which
 
s™e
-
wide
 
compÚ’ts
 
¬e
 
’abËd
 
as
 
™
 
£es
 
f™
.

36 
The
 
Bus
 
objeù
 
š
 
this
 
·ckage
 
u£s
 
tİic
-
ba£d
 
publish
-
subsüibe


37 
mes§gšg
 
to
 
accom¶ish
 
®l
 
this
. 
A
 
ãw
 
tİic
 
chªÃls
 
¬e
 
but
 
š


38 ('¡¬t', '¡İ', 'ex™', 'g¿ûful', 'log', 
ªd
 'maš'). 
F¿mewÜks
‡nd

39 
s™e
 
cÚš”s
 
¬e
 
ä“
 
to
 
defše
 
theœ
 
own
. 
If
 
a
 
mes§ge
 
is
 
£Á
o‡

40 
chªÃl
 
th©
 
has
 
nÙ
 
b“n
 
defšed
 
Ü
 ha 
no
 
li¡’”s
, 
th”e
 
is
‚Ø
efãù
.

42 
In
 
g’”®
, 
th”e
 
should
 
Úly
 
ev”
 
be
 
a
 
sšgË
 
Bus
 
objeù
 
³r
 
´oûss
.

43 
F¿mewÜks
 
ªd
 
s™e
 
cÚš”s
 
sh¬e
 
a
 
sšgË
 
Bus
 
objeù
 
by
 
publishšg


44 
mes§ges
 
ªd
 
subsüibšg
 
li¡’”s
.

46 
The
 
Bus
 
objeù
 
wÜks
 
as
 
a
 
fš™e
 
¡©e
 
machše
 
which
 
mod–s
 
the
 
cu¼’t


47 
¡©e
 
of
 
the
 
´oûss
. 
Bus
 
m‘hods
 
move
 
™
 
äom
 
Úe
 s‹ 
to
 
ªÙh”
;

48 
tho£
 
m‘hods
 
th’
 
publish
 
to
 
subsüibed
 
li¡’”s
 
Ú
 
the
 
chªÃl
 

49 
the
 
Ãw
 
¡©e
.::

51 
O


53 
V


54 
STOPPING
 --> 
STOPPED
 --> 
EXITING
 -> 
X


55 
A
 A |

56 | \
___
 |

58 | 
V
 V

59 
STARTED
 <-- 
STARTING


63 
impÜt
 
©ex™


64 
impÜt
 
os


65 
impÜt
 
sys


66 
impÜt
 
th»adšg


67 
impÜt
 
time


68 
impÜt
 
Œaûback
 
as
 
_Œaûback


69 
impÜt
 
w¬nšgs


71 
äom
 
ch”rypy
.
_ıcom·t
 
impÜt
 
£t


73 #H”
I
 
§ve
 
the
 
v®ue
 
of
 
os
.
	`g‘cwd
(), 
which
, I 
am
 
impÜ‹d
 
—¾y
 
’ough
,

74 #wÈ
be
 
the
 
dœeùÜy
 
äom
 
which
h
¡¬tup
 
süt
 
was
 
run
. 
This
 
is
 
Ãeded


75 #by 
	`_do_execv
(), 
to
 
chªge
 
back
Ø
the
 
Üigš®
 
dœeùÜy
 
befÜe
 
	`execv
()
šg
 
a


76 #Ãw 
´oûss
. 
This
 
is
 
a
 
deãn£
 
agaš¡
 
the
 
­¶iÿtiÚ
 
havšg
 
chªged
he

77 #cu¼’ˆ
wÜkšg
 
	`dœeùÜy
 (
which
 
could
 
make
 
sys
.
execubË
 "not found" 

78 #sys.
execubË
 
is
 
a
 
»Ïtive
-
·th
, 
ªd
/
Ü
 
ÿu£
 
Ùh”
 
´obËms
).

79 
_¡¬tup_cwd
 = 
os
.
	$g‘cwd
()

81 
şass
 
	$ChªÃlFau»s
(
Exû±iÚ
):

83 
d–im™”
 = '\n'

85 
def
 
	$__š™__
(
£lf
, *
¬gs
, **
kw¬gs
):

86 #DÚ'ˆu£ '
su³r
' here; Exceptions‡re old-style in Py2.4

87 #S“ 
h‰p
:

88 
Exû±iÚ
.
	$__š™__
(
£lf
, *
¬gs
, **
kw¬gs
)

89 
£lf
.
_exû±iÚs
 = 
	$li¡
()

91 
def
 
	$hªdË_exû±iÚ
(
£lf
):

93 
£lf
.
_exû±iÚs
.
	`­³nd
(
sys
.
	`exc_šfo
()[1])

95 
def
 
	$g‘_š¡ªûs
(
£lf
):

97  
£lf
.
_exû±iÚs
[:]

99 
def
 
	$__¡r__
(
£lf
):

100 
exû±iÚ_¡ršgs
 = 
	`m­
(
»´
, 
£lf
.
	$g‘_š¡ªûs
())

101  
£lf
.
d–im™”
.
	$još
(
exû±iÚ_¡ršgs
)

103 
__»´__
 = 
__¡r__


105 
def
 
	$__boŞ__
(
£lf
):

106  
	$boŞ
(
£lf
.
_exû±iÚs
)

107 
__nÚz”o__
 = 
__boŞ__


109 #U£ 
a
 
æag
 
to
 
šdiÿ‹
 
the
 
¡©e
 
of
h
bus
.

110 
şass
 
	$_S‹Enum
(
objeù
):

111 
şass
 
	$S‹
(
objeù
):

112 
Çme
 = 
NÚe


113 
def
 
	$__»´__
(
£lf
):

114  "¡©es.%s" % 
£lf
.
Çme


116 
def
 
	$__£‰r__
(
£lf
, 
key
, 
v®ue
):

117 
	$isš¡ªû
(
v®ue
, 
£lf
.
S‹
):

118 
v®ue
.
Çme
 = 
key


119 
objeù
.
	$__£‰r__
(
£lf
, 
key
, 
v®ue
)

120 
¡©es
 = 
	$_S‹Enum
()

121 
¡©es
.
STOPPED
 = s‹s.
	$S‹
()

122 
¡©es
.
STARTING
 = s‹s.
	$S‹
()

123 
¡©es
.
STARTED
 = s‹s.
	$S‹
()

124 
¡©es
.
STOPPING
 = s‹s.
	$S‹
()

125 
¡©es
.
EXITING
 = s‹s.
	$S‹
()

128 
Œy
:

129 
impÜt
 
fú


130 
exû±
 
ImpÜtE¼Ü
:

131 
max_fes
 = 0

133 
Œy
:

134 
max_fes
 = 
os
.
	`syscÚf
('SC_OPEN_MAX')

135 
exû±
 
A‰ribu‹E¼Ü
:

136 
max_fes
 = 1024

139 
şass
 
	$Bus
(
objeù
):

142 
AÎ
 
li¡’”s
 
a
 
giv’
 
chªÃl
 
¬e
 
gu¬ª‹ed
 
to
 
be
 
ÿÎed
 
ev’


143 
Ùh”s
 
©
 
the
 
§me
 
chªÃl
 
ç
. 
Each
 
çu»
 
is
 
logged
, 
but


144 
executiÚ
 
´oûeds
 
Ú
 
to
 
the
 
Ãxt
 
li¡’”
. 
The
 
Úly
 
way
Ø
¡İ
 
®l


145 
´oûssšg
 
äom
 
šside
 
a
 
li¡’”
 
is
 
to
 
¿i£
 
Sy¡emEx™
 
ªd
 
¡İ
 
the


146 
whŞe
 
£rv”
.

149 
¡©es
 = states

150 
¡©e
 = 
¡©es
.
STOPPED


151 
execv
 = 
F®£


152 
max_şÛxec_fes
 = 
max_fes


154 
def
 
	$__š™__
(
£lf
):

155 
£lf
.
execv
 = 
F®£


156 
£lf
.
¡©e
 = 
¡©es
.
STOPPED


157 
£lf
.
li¡’”s
 = 
	`diù
(

158 [(
chªÃl
, 
	$£t
()è
chªÃl


159 
	`š
 ('start', 'stop', 'exit', 'graceful', 'log', 'main')])

160 
£lf
.
_´iÜ™›s
 = {
	}
}

162 
def
 
	$subsüibe
(
£lf
, 
chªÃl
, 
ÿÎback
, 
´iÜ™y
=
NÚe
):

164 
chªÃl
 
nÙ
 
š
 
£lf
.
li¡’”s
:

165 
£lf
.
li¡’”s
[
chªÃl
] = 
	$£t
()

166 
£lf
.
li¡’”s
[
chªÃl
].
	$add
(
ÿÎback
)

168 
´iÜ™y
 
is
 
NÚe
:

169 
´iÜ™y
 = 
	`g‘©Œ
(
ÿÎback
, 'priority', 50)

170 
£lf
.
_´iÜ™›s
[(
chªÃl
, 
ÿÎback
)] = 
´iÜ™y


172 
def
 
	$unsubsüibe
(
£lf
, 
chªÃl
, 
ÿÎback
):

174 
li¡’”s
 = 
£lf
.li¡’”s.
	$g‘
(
chªÃl
)

175 
li¡’”s
 
ªd
 
ÿÎback
 
š
†isteners:

176 
li¡’”s
.
	$disÿrd
(
ÿÎback
)

177 
d–
 
£lf
.
_´iÜ™›s
[(
chªÃl
, 
ÿÎback
)]

179 
def
 
	$publish
(
£lf
, 
chªÃl
, *
¬gs
, **
kw¬gs
):

181 
chªÃl
 
nÙ
 
š
 
£lf
.
li¡’”s
:

184 
exc
 = 
	$ChªÃlFau»s
()

185 
ouut
 = []

187 
™ems
 = [(
£lf
.
_´iÜ™›s
[(
chªÃl
, 
li¡’”
)],†istener)

188 
li¡’”
 
š
 
£lf
.
li¡’”s
[
chªÃl
]]

189 
Œy
:

190 
™ems
.
	`sÜt
(
key
=
Ïmbda
 
™em
: item[0])

191 
exû±
 
Ty³E¼Ü
:

192 #PythÚ 2.3 
had
 
no
 'key' 
¬g
, 
but
 
th©
 
dÛ¢
't matter

193 #sšû 
™
 
could
 
sÜt
 
dissim¬
 
ty³s
 
ju¡
 
fše
.

194 
™ems
.
	$sÜt
()

195 
´iÜ™y
, 
li¡’”
 
š
 
™ems
:

196 
Œy
:

197 
ouut
.
	`­³nd
(
	$li¡’”
(*
¬gs
, **
kw¬gs
))

198 
exû±
 
KeybßrdIÁ”ru±
:

199 
¿i£


200 
exû±
 
Sy¡emEx™
:

201 
e
 = 
sys
.
	`exc_šfo
()[1]

202 #Ià
we
 
have
 
´evious
 
”rÜs
 
’su»
 
the
 
ex™
 
code
 
is
 
nÚ
-
z”o


203 
exc
 
ªd
 
e
.
code
 == 0:

204 
e
.
code
 = 1

205 
¿i£


206 
exû±
:

207 
exc
.
	$hªdË_exû±iÚ
()

208 
chªÃl
 == 'log':

209 #Assum
ªy
 
fu¹h”
 
mes§ges
 
to
 'log' 
wl
 
ç
.

210 
·ss


212 
£lf
.
	`log
("E¼Ü iÀ%¸li¡’” %r" % (
chªÃl
, 
li¡’”
),

213 
Ëv–
=40, 
Œaûback
=
True
)

214 
exc
:

215 
¿i£
 
exc


216  
ouut


218 
def
 
	$_ş—n_ex™
(
£lf
):

220 
£lf
.
¡©e
 !ğ
¡©es
.
EXITING
:

221 
w¬nšgs
.
	`w¬n
(

225 "mašh»adƒx™s." % 
£lf
.
¡©e
, 
RuÁimeW¬nšg
)

226 
£lf
.
	$ex™
()

228 
def
 
	$¡¬t
(
£lf
):

230 
©ex™
.(
£lf
.
_ş—n_ex™
)

232 
£lf
.
¡©e
 = 
¡©es
.
STARTING


233 
£lf
.
	`log
('Bus STARTING')

234 
Œy
:

235 
£lf
.
	`publish
('start')

236 
£lf
.
¡©e
 = 
¡©es
.
STARTED


237 
£lf
.
	`log
('Bus STARTED')

238 
	$exû±
 (
KeybßrdIÁ”ru±
, 
Sy¡emEx™
):

239 
¿i£


240 
exû±
:

241 
£lf
.
	`log
("Shutting down dueoƒrror in start†istener:",

242 
Ëv–
=40, 
Œaûback
=
True
)

243 
e_šfo
 = 
sys
.
	`exc_šfo
()[1]

244 
Œy
:

245 
£lf
.
	$ex™
()

246 
exû±
:

247 #Any 
¡İ
/
ex™
 
”rÜs
 
wl
 
be
 
logged
 
šside
 
	`publish
().

248 
·ss


249 #Re-
¿i£
 
the
 
Üigš®
 
”rÜ


250 
¿i£
 
e_šfo


252 
def
 
	$ex™
(
£lf
):

254 
ex™¡©e
 = 
£lf
.
¡©e


255 
Œy
:

256 
£lf
.
	$¡İ
()

258 
£lf
.
¡©e
 = 
¡©es
.
EXITING


259 
£lf
.
	`log
('Bus EXITING')

260 
£lf
.
	`publish
('exit')

261 #Thi 
i¢
'ˆ¡riùly‚eûs§ry, buˆ™'
s
 
b‘‹r
 
thª
 
£ešg


262 #"
Wa™šg
 
chd
 
th»ads
 
to
 
‹rmš©e
..."‡ndhen‚othing.

263 
£lf
.
	`log
('Bus EXITED')

264 
exû±
:

265 #Thi 
m‘hod
 
is
 
oá’
 
ÿÎed
 
	`asynchrÚou¦y
 (
wh‘h”
 
th»ad
,

266 #sigÇÈ
hªdËr
, 
cÚsŞe
 hªdËr, 
Ü
 
©ex™
 hªdËr), 
so
 
we


268 #Assum
™
's been†ogged‡nd just die.

269 
os
.
	$_ex™
(70) #EX_SOFTWARE

271 
ex™¡©e
 =ğ
¡©es
.
STARTING
:

272 #ex™(è
was
 
ÿÎed
 
befÜe
 
	`¡¬t
(è
fšished
, 
possibly
 
due
 
to


273 #CŒl-
C
 
beÿu£
 
a
 
¡¬t
 
li¡’”
 
gÙ
 
¡uck
. 
In
 
this
 ,

274 #w
could
 
g‘
 
¡uck
 
š
 
a
 
loİ
 
wh”e
 
CŒl
-
C
 
Ãv”
 
ex™s
 
the


275 #´oûss, 
so
 
we
 
ju¡
 
ÿÎ
 
os
.
ex™
 
h”e
.

276 
os
.
	$_ex™
(70) #EX_SOFTWARE

278 
def
 
	$»¡¬t
(
£lf
):

281 
This
 
m‘hod
 
dÛs
 
nÙ
 
»¡¬t
 
the
 
´oûss
 
äom
h
ÿÎšg
 
th»ad
;

282 
š¡—d
, 
™
 
¡İs
 
the
 
bus
 
ªd
 
asks
h
maš
 
th»ad
 
to
 
ÿÎ
 
execv
.

284 
£lf
.
execv
 = 
True


285 
£lf
.
	$ex™
()

287 
def
 
	$g¿ûful
(
£lf
):

289 
£lf
.
	`log
('Bus graceful')

290 
£lf
.
	`publish
('graceful')

292 
def
 
	$block
(
£lf
, 
š‹rv®
=0.1):

295 
This
 
funùiÚ
 
is
 
š‹nded
 
to
 
be
 
ÿÎed
 
Úly
 
by
 
the
 
maš
 
th»ad
.

296 
Aá”
 
wa™šg
 
the
 
EXITING
 
¡©e
, 
™
 
®so
 
wa™s
 
®l
 
th»ads


297 
to
 
‹rmš©e
, 
ªd
 
th’
 
ÿÎs
 
os
.
execv
 
£lf
.execv 
is
 
True
. 
This


298 
design
 
®lows
 
ªÙh”
 
th»ad
 
to
 
ÿÎ
 
bus
.
»¡¬t
, 
y‘
 
have
 
the
 
maš


299 
th»ad
 
³rfÜm
 
the
 
aùu®
 
execv
 
	`ÿÎ
 (
»quœed
 
Ú
 
some
 
¶©fÜms
).

301 
Œy
:

302 
£lf
.
	`wa™
(
¡©es
.
EXITING
, 
š‹rv®
=š‹rv®, 
chªÃl
='main')

303 
	$exû±
 (
KeybßrdIÁ”ru±
, 
IOE¼Ü
):

304 #Th
time
.
¦“p
 
ÿÎ
 
might
 
¿i£


305 #"
IOE¼Ü
: [
E¼no
 4] 
IÁ”ru±ed
 
funùiÚ
 
ÿÎ
" on KBInt.

306 
£lf
.
	`log
('Keyboard Interrupt: shutting down bus')

307 
£lf
.
	$ex™
()

308 
exû±
 
Sy¡emEx™
:

309 
£lf
.
	`log
('SystemExit„aised: shutting down bus')

310 
£lf
.
	$ex™
()

311 
¿i£


313 #Wa™šg 
ALL
 
chd
 
th»ads
 
to
 
fšish
 
is
 
Ãûs§ry
 
Ú
 
OS
 
X
.

314 #S“ 
h‰p
:

316 #th
maš
 
th»ad
 
to
 
ÿÎ
 
©ex™
 
hªdËrs
.

317 #S“ 
h‰p
:

318 
£lf
.
	`log
("Waiting for childhreadsoerminate...")

319 
t
 
š
 
th»adšg
.
	$’um”©e
():

320 
t
 !ğ
th»adšg
.
	$cu¼’tTh»ad
(è
ªd
 
t
.
	$isAlive
():

321 #NÙ
th©
 
ªy
 
	`dummy
 (
ex‹º®
è
th»ads
 
¬e
 
®ways
 
d«mÚic
.

322 
	`ha§‰r
(
th»adšg
.
Th»ad
, "daemon"):

324 
d
 = 
t
.
d«mÚ


326 
d
 = 
t
.
	$isD«mÚ
()

327 
nÙ
 
d
:

328 
£lf
.
	`log
("Wa™šg fÜh»ad %s." % 
t
.
	$g‘Name
())

329 
t
.
	$još
()

331 
£lf
.
execv
:

332 
£lf
.
	$_do_execv
()

334 
def
 
	$wa™
(
£lf
, 
¡©e
, 
š‹rv®
=0.1, 
chªÃl
=
NÚe
):

336 
	`isš¡ªû
(
¡©e
, (
tu¶e
, 
li¡
)):

337 
¡©es
 = 
¡©e


339 
¡©es
 = [
¡©e
]

341 
def
 
	$_wa™
():

342 
£lf
.
¡©e
 
nÙ
 
š
 
¡©es
:

343 
time
.
	$¦“p
(
š‹rv®
)

344 
£lf
.
	$publish
(
chªÃl
)

346 #From 
h‰p
:

347 #"
The
 
comped
 
machše
 
code
 
dÛs
 
nÙ
 
šşude
 
the
 
»guÏr
 
pŞlšg


348 #dÚ
by
 
PythÚ
, 
m—nšg
 
th©
 
a
 
KeybßrdIÁ”ru±
 
wl
 
nÙ
 
be


349 #d‘eùed 
befÜe
 
executiÚ
 
comes
 
back
 
to
 
the
 
»guÏr
 
PythÚ


350 #š‹½»‹r. 
Your
 
´og¿m
 
ÿÂÙ
 
be
 
š‹¼u±ed
 
ÿught


351 #štØ
ª
 
šfš™e
 
Psyco
-
comped
 
loİ
."

352 
Œy
:

353 
sys
.
moduËs
['psyco'].
	$ÿÂÙcompe
(
_wa™
)

354 
	$exû±
 (
KeyE¼Ü
, 
A‰ribu‹E¼Ü
):

355 
·ss


357 
	$_wa™
()

359 
def
 
	$_do_execv
(
£lf
):

362 
This
 
mu¡
 
be
 
ÿÎed
 
äom
 
the
 
maš
 
th»ad
, 
beÿu£
 
û¹aš
 
¶©fÜms


363 (
OS
 
X
è
dÚ
't‡llowƒxecvo be called in‡ childhread very well.

365 
¬gs
 = 
sys
.
¬gv
[:]

366 
£lf
.
	`log
('Re-¥awnšg %s' % ' '.
	$još
(
¬gs
))

368 
sys
.
¶©fÜm
[:4] == 'java':

369 
äom
 
_sy¡em»¡¬t
 
impÜt
 
Sy¡emRe¡¬t


370 
¿i£
 
Sy¡emRe¡¬t


372 
¬gs
.
	$š£¹
(0, 
sys
.
execubË
)

373 
sys
.
¶©fÜm
 == 'win32':

374 
¬gs
 = ['"%s"' % 
¬g
 ¬g 
š
‡rgs]

376 
os
.
	$chdœ
(
_¡¬tup_cwd
)

377 
£lf
.
max_şÛxec_fes
:

378 
£lf
.
	$_£t_şÛxec
()

379 
os
.
	$execv
(
sys
.
execubË
, 
¬gs
)

381 
def
 
	$_£t_şÛxec
(
£lf
):

384 
If
 
£lf
.
max_şÛxec_fes
 
is
 
ª
 
	`š‹g”
 (
the
 ), 
th’
 
Ú


385 
¶©fÜms
 
which
 
suµÜt
 
™
, iˆ
»´e£Ás
 
the
 
max
 
İ’
 
fes
 
£‰šg


386 
the
 
İ”©šg
 
sy¡em
. 
This
 
funùiÚ
 
wl
 
be
 
ÿÎed
 
ju¡
 
befÜe


387 
the
 
´oûss
 
is
 
»¡¬‹d
 
vŸ
 
os
.
	$execv
(è
to
 
´ev’t
 
İ’
 
fes


388 
äom
 
³rsi¡šg
 
što
 
the
 
Ãw
 
´oûss
.

390 
S‘
 
£lf
.
max_şÛxec_fes
 
to
 0Ø
di§bË
 
this
 
behaviÜ
.

392 
fd
 
š
 
	$¿nge
(3, 
£lf
.
max_şÛxec_fes
): #sk 
¡dš
/
out
/
”r


393 
Œy
:

394 
æags
 = 
fú
.
	$fú
(
fd
, 
fú
.
F_GETFD
)

395 
exû±
 
IOE¼Ü
:

397 
fú
.
	`fú
(
fd
, fú.
F_SETFD
, 
æags
 | fú.
FD_CLOEXEC
)

399 
def
 
	$¡İ
(
£lf
):

401 
£lf
.
¡©e
 = 
¡©es
.
STOPPING


402 
£lf
.
	`log
('Bus STOPPING')

403 
£lf
.
	`publish
('stop')

404 
£lf
.
¡©e
 = 
¡©es
.
STOPPED


405 
£lf
.
	`log
('Bus STOPPED')

407 
def
 
	$¡¬t_w™h_ÿÎback
(
£lf
, 
func
, 
¬gs
=
NÚe
, 
kw¬gs
=None):

409 
¬gs
 
is
 
NÚe
:

410 
¬gs
 = ()

411 
kw¬gs
 
is
 
NÚe
:

412 
kw¬gs
 = {
	}
}

413 
¬gs
 = (
func
,) +‡rgs

415 
def
 
	$_ÿÎback
(
func
, *
a
, **
kw
):

416 
£lf
.
	$wa™
(
¡©es
.
STARTED
)

417 
	$func
(*
a
, **
kw
)

418 
t
 = 
th»adšg
.
	$Th»ad
(
rg‘
=
_ÿÎback
, 
¬gs
÷rgs, 
kw¬gs
=kwargs)

419 
t
.
	`£tName
('Bu C®lback ' +.
	$g‘Name
())

420 
t
.
	$¡¬t
()

422 
£lf
.
	$¡¬t
()

424  
t


426 
def
 
	`log
(
£lf
, 
msg
="", 
Ëv–
=20, 
Œaûback
=
F®£
):

428 
Œaûback
:

429 
msg
 +ğ"\n" + "".
	`još
(
_Œaûback
.
	`fÜm©_exû±iÚ
(*
sys
.
	$exc_šfo
()))

430 
£lf
.
	`publish
('log', 
msg
, 
Ëv–
)

432 
bus
 = 
	`Bus
()

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/scaffold/__init__.py

3 
U£
 
this
 
as
 
a
 
ba£
 
ü—tšg
 
Ãw
 
Ch”ryPy
 
	g­¶iÿtiÚs
. 
Wh’
 
you
 
wªt


4 
to
 
make
 
a
 
Ãw
 
	g­p
, 
cİy
 
ªd
 
·¡e
 
this
 
fŞd”
Ø
some
 
Ùh”
 
	gloÿtiÚ


5 (
maybe
 
	gs™e
-
	g·ckages
è
ªd
 
»Çme
 
™
 
to
 
the
 
Çme
 
of
 
your
 
	g´ojeù
,

6 
th’
 
tw—k
 
as
 
	gdesœed
.

8 
Ev’
 
befÜe
 
ªy
 
	gtw—kšg
, 
this
 
should
 
£rve
 
a
 
ãw
 
demÚ¡¿tiÚ
 
	g·ges
.

9 
Chªge
 
to
 
this
 
dœeùÜy
 
ªd
 
	grun
:

11 ../
ch”ryd
 -
c
 
s™e
.
cÚf


15 
impÜt
 
ch”rypy


16 
äom
 
ch”rypy
 
impÜt
 
toŞs
, 
u¾


18 
impÜt
 
os


19 
	gloÿl_dœ
 = 
os
.
·th
.
još
(os.
g‘cwd
(), os.·th.
	$dœÇme
(
__fe__
))

22 
şass
 
RoÙ
:

24 
_ı_cÚfig
 = {'toŞs.log_Œaûbacks.Ú': 
True
,

25 
	}
}

27 
def
 
	$šdex
(
£lf
):

29 <
body
>
Try
 
some
 <
a
 
h»f
='%s?a=7'>
Ùh”
</a> 
·th
,

30 
Ü
 
a
 <¨
h»f
='%s?n=14'></a> 
·th
.<
br
 />

31 
Or
, 
ju¡
 
look
 
©
 
the
 
´‘ty
 
piùu»
:<
br
 />

32 <
img
 
¤c
='%s' />

33 </
body
></
html
>""" % (u¾("
Ùh”
"), url(""),

34 
	`u¾
("files/made_with_cherrypy_small.png"))

35 
šdex
.
expo£d
 = 
True


37 
def
 (
£lf
, *
¬gs
, **
kw¬gs
):

38  "¬gs: % kw¬gs: %s" % (
¬gs
, 
kw¬gs
)

39 .
expo£d
 = 
True


41 
def
 
	`Ùh”
(
£lf
, 
a
=2, 
b
='bªªas', 
c
=
NÚe
):

42 
ch”rypy
.
»¥Ú£
.
h—d”s
['Content-Type'] = 'text/plain'

43 
c
 
is
 
NÚe
:

44  "Hav%d %s." % ((
a
), 
b
)

46  "Hav%d %s, %s." % ((
a
), 
b
, 
c
)

47 
Ùh”
.
expo£d
 = 
True


49 
fes
 = 
ch”rypy
.
toŞs
.
¡©icdœ
.
	`hªdËr
(

50 
£ùiÚ
="/files",

51 
dœ
=
os
.
·th
.
	`još
(
loÿl_dœ
, "static"),

52 #IgnÜ.
php
 
fes
, 
‘c
.

53 
m©ch
=
r
'\.(css|gif|html?|ico|jpe?g|js|png|swf|xml)$',

57 
roÙ
 = 
	$RoÙ
()

59 #Uncomm’ˆ
the
 
fŞlowšg
 
to
 
u£
 
your
 
own
 
çvicÚ
 
š¡—d
 
of
 
CP
's default.

60 #çvicÚ_·th = 
os
.
·th
.
	`još
(
loÿl_dœ
, "favicon.ico")

61 #roÙ.
çvicÚ_ico
 = 
toŞs
.
¡©icfe
.
	`hªdËr
(
f’ame
=
çvicÚ_·th
)

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/__init__.py

3 
	gRun
 'no£‹¡ - ‹¡/' 
to
 
ex”ci£
 
®l
 
	g‹¡s
.

5 
	gThe
 '-s' 
æag
 
š¡ruùs
 
no£
 
to
 
ouut
 
¡dout
 
	gmes§ges
, 
wihch
 
is
 
üucŸl
o

6 
	gthe
 'š‹¿ùive' 
mode
 
of
 
	gweb‹¡
.
	gpy
. 
If
 
you
 
run
 
the£
 
‹¡s
 
w™hout
he '-s'

7 
	gæag
, 
	gdÚ
'ˆbsu½ri£d iàth‹¡ s“m tØhªg: it'
s
 
wa™šg
 
your


8 
š‹¿ùive
 
	gšput
.

11 
impÜt
 
os


12 
impÜt
 
sys


14 
def
 
	$Ãwex™
():

15 
os
.
	$_ex™
(1)

17 
def
 
	$£tup
():

18 #W
wªt
 
to
 
mÚkey
 
·tch
 
sys
.
ex™
 
so
 
th©
 
we
 
ÿn
 
g‘
 
some


19 #šfÜm©iÚ 
about
 
wh”e
 
ex™
 
is
 
bešg
 
ÿÎed
.

20 
Ãwex™
.
_Şd
 = 
sys
.
ex™


21 
sys
.
ex™
 = 
Ãwex™


23 
def
 
	$‹¬down
():

24 
Œy
:

25 
sys
.
ex™
 = sys.ex™.
_Şd


26 
exû±
 
A‰ribu‹E¼Ü
:

27 
sys
.
ex™
 = sys.
_ex™


	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/_test_decorators.py

3 
äom
 
ch”rypy
 
impÜt
 
	gexpo£
, 
toŞs


4 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
Áob


7 
şass
 
	$Expo£Exam¶es
(
objeù
):

9 @
expo£


10 
def
 
	$no_ÿÎ
(
£lf
):

13 @
	$expo£
()

14 
def
 
	$ÿÎ_em±y
(
£lf
):

17 @
	`expo£
("call_alias")

18 
def
 
	$Ãsb™t
(
£lf
):

21 @
	`expo£
(["alias1", "alias2"])

22 
def
 
	$ªd»ws
(
£lf
):

25 @
	`expo£
(
®Ÿs
="alias3")

26 
def
 
	$w©sÚ
(
£lf
):

30 
şass
 
	$ToŞExam¶es
(
objeù
):

32 @
expo£


33 @
toŞs
.
	`»¥Ú£_h—d”s
(
h—d”s
=[('Content-Type', 'application/data')])

34 
def
 
	$bÏh
(
£lf
):

35 
y›ld
 
	`Áob
("blah")

36 #Thi 
is
 
h”e
 
to
 
demÚ¡¿‹
 
th©
 
_ı_cÚfig
 = {...
	}
} 
ov”wr™es


37 #th
_ı_cÚfig
 
©Œibu‹
 
added
 
by
 
the
 
ToŞ
 
decÜ©Ü
. 
You
 
have


38 #tØ
wr™e
 
_ı_cÚfig
[
k
] = 
v
 
Ü
 _ı_cÚfig.
upd©e
(...è
š¡—d
.

39 
bÏh
.
_ı_cÚfig
['»¥Ú£.¡»am'] = 
True


	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/_test_states_demo.py

1 
impÜt
 
os


2 
impÜt
 
sys


3 
impÜt
 
time


4 
	g¡¬‰ime
 = 
time
.
	$time
()

6 
impÜt
 
ch”rypy


9 
şass
 
RoÙ
:

11 
def
 
	$šdex
(
£lf
):

13 
šdex
.
expo£d
 = 
True


15 
def
 
	$mtimes
(
£lf
):

16  
	`»´
(
ch”rypy
.
’gše
.
	`publish
("Autoreloader", "mtimes"))

17 
mtimes
.
expo£d
 = 
True


19 
def
 
	$pid
(
£lf
):

20  
	`¡r
(
os
.
	$g‘pid
())

21 
pid
.
expo£d
 = 
True


23 
def
 
	$¡¬t
(
£lf
):

24  
	$»´
(
¡¬‰ime
)

25 
¡¬t
.
expo£d
 = 
True


27 
def
 
	$ex™
(
£lf
):

28 #Thi 
hªdËr
 
might
 
be
 
ÿÎed
 
befÜe
 
the
 
’gše
 
is
 
STARTED
 
ª


29 #HTTP 
wÜk”
 
th»ad
 
hªdËs
 
™
 
befÜe
 
the
 
HTTP
 
£rv”
 
»tuºs


30 #cÚŒŞ 
to
 
’gše
.
¡¬t
. 
We
 
avoid
 
th©
 
¿û
 
cÚd™iÚ
 
h”e


31 #by 
wa™šg
 
the
 
Bus
 
to
 
be
 
STARTED
.

32 
ch”rypy
.
’gše
.
	$wa™
(
¡©e
=
ch”rypy
.
’gše
.
¡©es
.
STARTED
)

33 
ch”rypy
.
’gše
.
	$ex™
()

34 
ex™
.
expo£d
 = 
True


37 
def
 
	$unsub_sig
():

38 
ch”rypy
.
	`log
("unsubsig: %s" % ch”rypy.
cÚfig
.
	`g‘
('unsubsig', 
F®£
))

39 
ch”rypy
.
cÚfig
.
	`g‘
('unsubsig', 
F®£
):

40 
ch”rypy
.
	`log
("Unsubscribinghe default cherrypy signal handler")

41 
ch”rypy
.
’gše
.
sigÇl_hªdËr
.
	$unsubsüibe
()

42 
Œy
:

43 
äom
 
sigÇl
 
impÜt
 sigÇl, 
SIGTERM


44 
exû±
 
ImpÜtE¼Ü
:

45 
·ss


47 
def
 
	$Şd_‹rm_hªdËr
(
signum
=
NÚe
, 
äame
=None):

48 
ch”rypy
.
	`log
("I‡m‡n old SIGTERM handler.")

49 
sys
.
	$ex™
(0)

50 
ch”rypy
.
	`log
("Subscribinghe‚ew one.")

51 
	$sigÇl
(
SIGTERM
, 
Şd_‹rm_hªdËr
)

52 
ch”rypy
.
’gše
.
	`subsüibe
('¡¬t', 
unsub_sig
, 
´iÜ™y
=100)

55 
def
 
	$¡¬‹¼Ü
():

56 
ch”rypy
.
cÚfig
.
	`g‘
('¡¬‹¼Ü', 
F®£
):

57 
z”odiv
 = 1 / 0

58 
ch”rypy
.
’gše
.
	`subsüibe
('¡¬t', 
¡¬‹¼Ü
, 
´iÜ™y
=6)

60 
def
 
	$log_‹¡_ÿ£_Çme
():

61 
ch”rypy
.
cÚfig
.
	`g‘
('‹¡_ÿ£_Çme', 
F®£
):

62 
ch”rypy
.
	`log
("STARTED FROM: %s" % ch”rypy.
cÚfig
.
	`g‘
('test_case_name'))

63 
ch”rypy
.
’gše
.
	`subsüibe
('¡¬t', 
log_‹¡_ÿ£_Çme
, 
´iÜ™y
=6)

66 
ch”rypy
.
Œ“
.
	`mouÁ
(
	`RoÙ
(), '/', {'/': {}
	}
})

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/benchmark.py

3 
	gU§ge
:

4 
b’chm¬k
.
py
 --
nuÎ
 --
nÙe¡s
 --
h–p
 --
ımodpy
 --
modpythÚ
 --
ab
=
·th
 --
­ache
=path

6 --
nuÎ
: 
u£
 
a
‚uÎ 
Reque¡
 
objeù
 (
to
 
b’ch
 
the
 
HTTP
 
£rv”
 
Úly
)

7 --
nÙe¡s
: 
¡¬t
 
the
 
£rv”
 
but
 dØ
nÙ
 
run
h
‹¡s
; 
this
 
®lows


8 
you
 
to
 
check
 
the
 
‹¡ed
 
·ges
 
w™h
 
a
 
	gbrow£r


9 --
	gh–p
: 
show
 
this
 
h–p
 
mes§ge


10 --
ımodpy
: 
run
 
‹¡s
 
vŸ
 
­ache
 
Ú
 54583 (
w™h
 
the
 
butš
 
_ımodpy
)

11 --
modpythÚ
: 
run
 
‹¡s
 
vŸ
 
­ache
 
Ú
 54583 (
w™h
 
modpythÚ_g©eway
)

12 --
ab
=
·th
: 
U£
 
the
‡b 
süt
/
execubË
 
©
 '·th' (
£e
 
b–ow
)

13 --
­ache
=
·th
: 
U£
 
the
‡·ch
süt
/
exe
 
©
 '·th' (
£e
 
b–ow
)

15 
To
 
run
 
the
 
b’chm¬ks
,h
A·che
 
B’chm¬k
 
	gtoŞ
 "ab" 
mu¡
 
e™h”
 
be
 
Ú


16 
your
 
sy¡em
 
	g·th
, 
Ü
 
¥ecif›d
 
vŸ
 
	gthe
 --
	gab
=
·th
 
İtiÚ
.

18 
To
 
run
 
the
 
modpythÚ
 
‹¡s
, 
	gthe
 "­ache" 
execubË
 
Ü
 
süt
 
mu¡
 
be


19 
Ú
 
your
 
sy¡em
 
	g·th
, 
Ü
 
´ovided
 
vŸ
 
	gthe
 --
	g­ache
=
·th
 
İtiÚ
. 
On
 
some


20 
¶©fÜms
, "­ache" 
may
 
be
 
	gÿÎed
 "­acheùl" 
	gÜ
 "­ache2ùl"--
ü—‹


21 
a
 
symlšk
 
to
 
them
 
	gÃeded
.

24 
impÜt
 
g‘İt


25 
impÜt
 
os


26 
	gcurdœ
 = 
os
.
·th
.
još
(os.
g‘cwd
(), os.·th.
	$dœÇme
(
__fe__
))

28 
impÜt
 
»


29 
impÜt
 
sys


30 
impÜt
 
time


31 
impÜt
 
Œaûback


33 
impÜt
 
ch”rypy


34 
äom
 
ch”rypy
.
_ıcom·t
 
impÜt
 
Áob


35 
äom
 
ch”rypy
 
impÜt
 
_ı”rÜ
, 
_ımodpy


36 
äom
 
ch”rypy
.
lib
 
impÜt
 
h‰put


39 
AB_PATH
 = ""

40 
APACHE_PATH
 = "apache"

41 
SCRIPT_NAME
 = "/cpbench/users/rdelon/apps/blog"

43 
__®l__
 = ['ABSession', 'Root', 'print_report',

48 
size_ÿche
 = {
	}
}

50 
şass
 
RoÙ
:

52 
def
 
	$šdex
(
£lf
):

54 <
h—d
>

55 <
t™Ë
>
Ch”ryPy
 
B’chm¬k
</title>

56 </
h—d
>

57 <
body
>

58 <
ul
>

59 <
li
><
a
 
h»f
="h–lo">
H–lo
, 
wÜld
! (14 
by‹
 
dyÇmic
)</a></li>

60 <
li
><
a
 
h»f
="¡©ic/šdex.html">
Stic
 
	`fe
 (14 
by‹s
 )</a></li>

61 <
li
><
fÜm
 
aùiÚ
="siz”">
Re¥Ú£
 
of
 
Ëngth
:

62 <
šput
 
ty³
='‹xt' 
Çme
='size' 
v®ue
='10' /></
fÜm
>

63 </
li
>

64 </
ul
>

65 </
body
>

66 </
html
>"""

67 
šdex
.
expo£d
 = 
True


69 
def
 
	$h–lo
(
£lf
):

71 
h–lo
.
expo£d
 = 
True


73 
def
 
	$siz”
(
£lf
, 
size
):

74 
»¥
 = 
size_ÿche
.
	$g‘
(
size
, 
NÚe
)

75 
»¥
 
is
 
NÚe
:

76 
size_ÿche
[
size
] = 
»¥
 = "X" * (size)

77  
»¥


78 
siz”
.
expo£d
 = 
True


81 
ch”rypy
.
cÚfig
.
	`upd©e
({

89 
	}
})

91 #Ch—ˆ
mode
 
Ú
 ;)

92 
d–
 
	gch”rypy
.
	gcÚfig
['tools.log_tracebacks.on']

93 
d–
 
	gch”rypy
.
	gcÚfig
['tools.log_headers.on']

94 
d–
 
	gch”rypy
.
	gcÚfig
['tools.trailing_slash.on']

96 
	g­pcÚf
 = {

98 'toŞs.¡©icdœ.Ú': 
True
,

100 'toŞs.¡©icdœ.roÙ': 
curdœ
,

103 
­p
 = 
ch”rypy
.
Œ“
.
mouÁ
(
RoÙ
(), 
SCRIPT_NAME
, 
­pcÚf
)

106 
şass
 
	gNuÎReque¡
:

109 
def
 
__š™__
(
£lf
, 
loÿl
, 
»mÙe
, 
scheme
="http"):

110 
·ss


112 
def
 
	$şo£
(
£lf
):

113 
·ss


115 
def
 
	$run
(
£lf
, 
m‘hod
, 
·th
, 
qu”y_¡ršg
, 
´ÙocŞ
, 
h—d”s
, 
rfe
):

116 
ch”rypy
.
»¥Ú£
.
¡©us
 = "200 OK"

117 
ch”rypy
.
»¥Ú£
.
h—d”_li¡
 = [("Content-Type", 'text/html'),

119 ("D©e", 
h‰put
.
	`HTTPD©e
()),

122 
ch”rypy
.
»¥Ú£
.
body
 = [""]

123  
ch”rypy
.
»¥Ú£


126 
şass
 
NuÎRe¥Ú£
:

127 
·ss


130 
şass
 
ABSessiÚ
:

133 
Exam¶e
 
ouut
 
äom
 
ab
:

135 
This
 
is
 
A·cheB’ch
, 
V”siÚ
 2.0.40-
dev
 <
$RevisiÚ
: 1.121.2.1 
$
> 
­ache
-2.0

136 
	`Cİyright
 (
c
è1996 
Adam
 
Twiss
, 
Zeus
 
TechnŞogy
 
Ltd
, 
h‰p
:

137 
	`Cİyright
 (
c
è1998-2002 
The
 
A·che
 
Soáw¬e
 
Found©iÚ
, 
h‰p
:

139 
B’chm¬kšg
 127.0.0.1 (
be
 
·t›Á
)

140 
Com¶‘ed
 100 
»que¡s


141 
Com¶‘ed
 200 
»que¡s


142 
Com¶‘ed
 300 
»que¡s


143 
Com¶‘ed
 400 
»que¡s


144 
Com¶‘ed
 500 
»que¡s


145 
Com¶‘ed
 600 
»que¡s


146 
Com¶‘ed
 700 
»que¡s


147 
Com¶‘ed
 800 
»que¡s


148 
Com¶‘ed
 900 
»que¡s


151 
S”v”
 
Soáw¬e
: 
Ch”ryPy
/3.1be



152 
S”v”
 
Ho¡Çme
: 127.0.0.1

153 
S”v”
 
PÜt
: 54583

155 
Docum’t
 
P©h
: //
šdex
.
html


156 
Docum’t
 
L’gth
: 14 
by‹s


158 
CÚcu¼’cy
 
Lev–
: 10

159 
Time
 
k’
 
‹¡s
: 9.643867 
£cÚds


160 
Com¶‘e
 
»que¡s
: 1000

161 
Faed
 
»que¡s
: 0

162 
Wr™e
 
”rÜs
: 0

163 
TÙ®
 
Œªsã¼ed
: 189000 
by‹s


164 
HTML
 
Œªsã¼ed
: 14000 
by‹s


165 
Reque¡s
 
³r
 
£cÚd
: 103.69 [#/
£c
] (
m—n
)

166 
Time
 
³r
 
»que¡
: 96.439 [
ms
] (
m—n
)

167 
Time
 
³r
 
»que¡
: 9.644 [
ms
] (
m—n
, 
aüoss
 
®l
 
cÚcu¼’t
 
»que¡s
)

168 
T¿nsãr
 
¿‹
: 19.08 [
Kby‹s
/
£c
] 
»ûived


170 
CÚÃùiÚ
 
	$Times
 (
ms
)

171 
mš
 
m—n
[+/-
sd
] 
medŸn
 
max


172 
CÚÃù
: 0 0 2.9 0 10

173 
Proûssšg
: 20 94 7.3 90 130

174 
Wa™šg
: 0 43 28.1 40 100

175 
TÙ®
: 20 95 7.3 100 130

177 
P”ûÁage
 
of
 
the
 
»que¡s
 
£rved
 
w™hš
 
a
 
û¹aš
 
	`time
 (
ms
)

186 100% 130 (
lÚge¡
 
»que¡
)

187 
Fšished
 1000 
»que¡s


190 
·r£_·‰”ns
 = [('complete_requests', 'Completed',

191 
	`Áob
(
r
'^Complete„equests:\s*(\d+)')),

193 
	`Áob
(
r
'^Failed„equests:\s*(\d+)')),

195 
	`Áob
(
r
'^Requests…er second:\s*([0-9.]+)')),

197 
	`Áob
(
r
'^Time…er„equest:\s*([0-9.]+).*concurrent„equests\)$')),

199 
	`Áob
(
r
'^Transfer„ate:\s*([0-9.]+)')),

202 
def
 
	`__š™__
(
£lf
, 
·th
=
SCRIPT_NAME
 + "/h–lo", 
»que¡s
=1000, 
cÚcu¼’cy
=10):

203 
£lf
.
·th
 =…ath

204 
£lf
.
»que¡s
 =„equests

205 
£lf
.
cÚcu¼’cy
 = concurrency

207 
def
 
	$¬gs
(
£lf
):

208 
pÜt
 = 
ch”rypy
.
£rv”
.
sock‘_pÜt


209 
as£¹
 
£lf
.
cÚcu¼’cy
 > 0

210 
as£¹
 
£lf
.
»que¡s
 > 0

212 #Cà
h‰p
:

214 (
£lf
.
»que¡s
, s–f.
cÚcu¼’cy
, 
pÜt
, s–f.
·th
))

216 
def
 
	$run
(
£lf
):

217 #P¬£ 
ouut
 
of
 
ab
, 
£‰šg
 
©Œibu‹s
 
Ú
 
£lf


218 
Œy
:

219 
£lf
.
ouut
 = 
_ımodpy
.
	`»ad_´oûss
(
AB_PATH
 
Ü
 "ab", s–f.
	$¬gs
())

220 
exû±
:

221 
	`´št
(
_ı”rÜ
.
	$fÜm©_exc
())

222 
¿i£


224 
©Œ
, 
Çme
, 
·‰”n
 
š
 
£lf
.
·r£_·‰”ns
:

225 
v®
 = 
»
.
	$£¬ch
(
·‰”n
, 
£lf
.
ouut
, 
»
.
MULTILINE
)

226 
v®
:

227 
v®
 = v®.
	$group
(1)

228 
	$£‰r
(
£lf
, 
©Œ
, 
v®
)

230 
	$£‰r
(
£lf
, 
©Œ
, 
NÚe
)

233 
§ã_th»ads
 = (25, 50, 100, 200, 400)

234 
sys
.
¶©fÜm
 
	`š
 ("win32",):

235 #FÜ 
some
 
»asÚ
, 
ab
 
üashes
 
w™h
 > 50 
th»ads
 
Ú
 
my
 
Wš2k
 
Ï±İ
.

236 
§ã_th»ads
 = (10, 20, 30, 40, 50)

239 
def
 
	`th»ad_»pÜt
(
·th
=
SCRIPT_NAME
 + "/h–lo", 
cÚcu¼’cy
=
§ã_th»ads
):

240 
£ss
 = 
	$ABSessiÚ
(
·th
)

241 
©Œs
, 
Çmes
, 
·‰”ns
 = 
	`li¡
(
	$z
(*
£ss
.
·r£_·‰”ns
))

242 
avg
 = 
diù
.
	$äomkeys
(
©Œs
, 0.0)

244 
	`y›ld
 ('th»ads',è+ 
Çmes


245 
c
 
š
 
cÚcu¼’cy
:

246 
£ss
.
cÚcu¼’cy
 = 
c


247 
£ss
.
	$run
()

248 
row
 = [
c
]

249 
©Œ
 
š
 
©Œs
:

250 
v®
 = 
	$g‘©Œ
(
£ss
, 
©Œ
)

251 
v®
 
is
 
NÚe
:

252 
	$´št
(
£ss
.
ouut
)

253 
row
 = 
NÚe


255 
v®
 = (val)

256 
avg
[
©Œ
] +ğ(
v®
)

257 
row
.
	$­³nd
(
v®
)

258 
row
:

259 
y›ld
 
row


261 #Add 
a
 
row
 
of
 
av”ages
.

262 
y›ld
 ["Av”age"] + [
	`¡r
(
avg
[
©Œ
] / 
	$Ën
(
cÚcu¼’cy
)è
©Œ
 
š
 
©Œs
]

264 
def
 
	`size_»pÜt
(
sizes
=(10, 100, 1000, 10000, 100000, 100000000),

265 
cÚcu¼’cy
=50):

266 
£ss
 = 
	$ABSessiÚ
(
cÚcu¼’cy
=concurrency)

267 
©Œs
, 
Çmes
, 
·‰”ns
 = 
	`li¡
(
	$z
(*
£ss
.
·r£_·‰”ns
))

268 
	`y›ld
 ('by‹s',è+ 
Çmes


269 
sz
 
š
 
sizes
:

270 
£ss
.
·th
 = "%s/siz”?size=%s" % (
SCRIPT_NAME
, 
sz
)

271 
£ss
.
	$run
()

272 
y›ld
 [
sz
] + [
	$g‘©Œ
(
£ss
, 
©Œ
è©Œ 
š
 
©Œs
]

274 
def
 
	$´št_»pÜt
(
rows
):

275 
row
 
š
 
rows
:

276 
	`´št
("")

277 
i
, 
v®
 
š
 
	$’um”©e
(
row
):

278 
sys
.
¡dout
.
	`wr™e
(
	`¡r
(
v®
).
	`rju¡
(10) + " | ")

279 
	`´št
("")

282 
def
 
	$run_¡ªd¬d_b’chm¬ks
():

283 
	`´št
("")

284 
	`´št
("Client Thread Report (1000„equests, 14 byte„esponse body, "

285 "% £rv”h»ads):" % 
ch”rypy
.
£rv”
.
th»ad_poŞ
)

286 
	`´št_»pÜt
(
	$th»ad_»pÜt
())

288 
	`´št
("")

289 
	`´št
("Client Thread Report (1000„equests, 14 bytes via staticdir, "

290 "% £rv”h»ads):" % 
ch”rypy
.
£rv”
.
th»ad_poŞ
)

291 
	`´št_»pÜt
(
	`th»ad_»pÜt
("%s/¡©ic/šdex.html" % 
SCRIPT_NAME
))

293 
	`´št
("")

294 
	`´št
("Size Report (1000„equests, 50 clienthreads, "

295 "% £rv”h»ads):" % 
ch”rypy
.
£rv”
.
th»ad_poŞ
)

296 
	`´št_»pÜt
(
	$size_»pÜt
())

299 #modpythÚ 
ªd
 
Ùh”
 
WSGI
 #


300 
def
 
	$¡¬tup_modpythÚ
(
»q
=
NÚe
):

302 
ch”rypy
.
’gše
.
¡©e
 =ğch”rypy.
_ı’gše
.
STOPPED
:

303 
»q
:

304 "nuÎ»q" 
š
 
»q
.
	$g‘_İtiÚs
():

305 
ch”rypy
.
’gše
.
»que¡_şass
 = 
NuÎReque¡


306 
ch”rypy
.
’gše
.
»¥Ú£_şass
 = 
NuÎRe¥Ú£


307 
ab_İt
 = 
»q
.
	`g‘_İtiÚs
().
	`g‘
("ab", "")

308 
ab_İt
:

309 
glob®
 
AB_PATH


310 
AB_PATH
 = 
ab_İt


311 
ch”rypy
.
’gše
.
	$¡¬t
()

312 
ch”rypy
.
’gše
.
¡©e
 =ğch”rypy.
_ı’gše
.
STARTING
:

313 
ch”rypy
.
’gše
.
	$wa™
()

314  0 #­ache.
OK


317 
def
 
	$run_modpythÚ
(
u£_wsgi
=
F®£
):

318 
	`´št
("Starting mod_python...")

319 
pyİts
 = []

321 #Pas 
the
 
nuÎ
 
ªd
 
ab
=
·th
 
İtiÚs
 
through
 
A·che


322 "--nuÎ" 
š
 
İts
:

323 
pyİts
.
	`­³nd
(("nullreq", ""))

325 "--ab" 
š
 
İts
:

326 
pyİts
.
	`­³nd
(("ab", 
İts
["--ab"]))

328 
s
 = 
_ımodpy
.
ModPythÚS”v”


329 
u£_wsgi
:

330 
pyİts
.
	`­³nd
(("wsgi.application", "cherrypy::tree"))

331 
pyİts
.
	`­³nd
(("wsgi.startup", "cherrypy.test.benchmark::startup_modpython"))

332 
hªdËr
 = "modpython_gateway::handler"

333 
s
 = 
	$s
(
pÜt
=54583, 
İts
=
pyİts
, 
­ache_·th
=
APACHE_PATH
, 
hªdËr
=handler)

335 
pyİts
.
	`­³nd
(("cherrypy.setup", "cherrypy.test.benchmark::startup_modpython"))

336 
s
 = 
	$s
(
pÜt
=54583, 
İts
=
pyİts
, 
­ache_·th
=
APACHE_PATH
)

338 
Œy
:

339 
s
.
	$¡¬t
()

340 
	$run
()

341 
fš®ly
:

342 
s
.
	$¡İ
()

346 
__Çme__
 == '__main__':

347 
lÚgİts
 = ['cpmodpy', 'modpython', 'null', 'notests',

349 
Œy
:

350 
sw™ches
, 
¬gs
 = 
g‘İt
.
	`g‘İt
(
sys
.
¬gv
[1:], "", 
lÚgİts
)

351 
İts
 = 
	$diù
(
sw™ches
)

352 
exû±
 
g‘İt
.
G‘İtE¼Ü
:

353 
	$´št
(
__doc__
)

354 
sys
.
	$ex™
(2)

356 "--h–p" 
š
 
İts
:

357 
	$´št
(
__doc__
)

358 
sys
.
	$ex™
(0)

360 "--ab" 
š
 
İts
:

361 
AB_PATH
 = 
İts
['--ab']

363 "--nÙe¡s" 
š
 
İts
:

364 #R‘uº 
w™hout
 
¡İpšg
 
the
 
£rv”
, 
so
 
th©
h
·ges


365 #ÿÀ
be
 
‹¡ed
 
äom
 
a
 
¡ªd¬d
 
web
 
brow£r
.

366 
def
 
	$run
():

367 
pÜt
 = 
ch”rypy
.
£rv”
.
sock‘_pÜt


368 
	`´št
("You may‚ow open http://127.0.0.1:%s%s/" %

369 (
pÜt
, 
SCRIPT_NAME
))

371 "--nuÎ" 
š
 
İts
:

372 
	`´št
("Using‚ull Request object")

374 
def
 
	$run
():

375 
’d
 = 
time
.
	`time
(è- 
¡¬t


376 
	`´št
("S¹ed iÀ% £cÚds" % 
’d
)

377 "--nuÎ" 
š
 
İts
:

378 
	`´št
("\nUsing‚ull Request object")

379 
Œy
:

380 
Œy
:

381 
	$run_¡ªd¬d_b’chm¬ks
()

382 
exû±
:

383 
	`´št
(
_ı”rÜ
.
	$fÜm©_exc
())

384 
¿i£


385 
fš®ly
:

386 
ch”rypy
.
’gše
.
	$ex™
()

388 
	`´št
("Starting CherryPy‡pp server...")

390 
şass
 
	$NuÎWr™”
(
objeù
):

392 
def
 
	$wr™e
(
£lf
, 
d©a
):

393 
·ss


394 
sys
.
¡d”r
 = 
	$NuÎWr™”
()

396 
¡¬t
 = 
time
.
	$time
()

398 "--ımodpy" 
š
 
İts
:

399 
	$run_modpythÚ
()

400 
–if
 "--modpythÚ" 
š
 
İts
:

401 
	$run_modpythÚ
(
u£_wsgi
=
True
)

403 "--nuÎ" 
š
 
İts
:

404 
ch”rypy
.
£rv”
.
»que¡_şass
 = 
NuÎReque¡


405 
ch”rypy
.
£rv”
.
»¥Ú£_şass
 = 
NuÎRe¥Ú£


407 
ch”rypy
.
’gše
.
	$¡¬t_w™h_ÿÎback
(
run
)

408 
ch”rypy
.
’gše
.
	`block
()

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/checkerdemo.py

3 
This
 
­¶iÿtiÚ
 
is
 
š‹ÁiÚ®ly
 
brok’
 
ªd
 
badly
 
	gdesigÃd
.

4 
To
 
demÚ¡¿‹
 
the
 
ouut
 
of
h
Ch”ryPy
 
	gCheck”
, 
sim¶y
 
execu‹


5 
this
 
	gmoduË
.

8 
impÜt
 
os


9 
impÜt
 
ch”rypy


10 
	gthisdœ
 = 
os
.
·th
.
dœÇme
(os.·th.
	$ab¥©h
(
__fe__
))

12 
şass
 
RoÙ
:

13 
·ss


15 
__Çme__
 == '__main__':

16 
cÚf
 = {'/ba£': {'toŞs.¡©icdœ.roÙ': 
thisdœ
,

17 #ObsŞ‘
key
.

18 'throw_”rÜs': 
True
,

20 #Thi 
’Œy
 
should
 
be
 
OK
.

21 '/ba£/¡©ic': {'toŞs.¡©icdœ.Ú': 
True
,

23 #W¬À
Ú
 
missšg
 
fŞd”
.

24 '/ba£/js': {'toŞs.¡©icdœ.Ú': 
True
,

26 #W¬À
Ú
 
dœ
 
w™h
 
ª
 
abs
 
·th
 
ev’
 
though
 
we
 
´ovide
 
roÙ
.

27 '/ba£/¡©ic2': {'toŞs.¡©icdœ.Ú': 
True
,

29 #W¬À
Ú
 
dœ
 
w™h
 
a
 
»Ïtive
 
·th
 w™h 
no
 
roÙ
.

30 '/¡©ic3': {'toŞs.¡©icdœ.Ú': 
True
,

32 #W¬À
Ú
 
unknown
 
Çme¥aû


33 '/unknown': {'toobËs.gz.Ú': 
True
},

34 #W¬À
¥ecŸl
 
Ú
 
ch”rypy
.<
known
 
ns
>.*

35 '/ıknown': {'ch”rypy.toŞs.’code.Ú': 
True
},

36 #W¬À
Ú
 
mism©ched
 
ty³s


38 #W¬À
Ú
 
unknown
 
toŞ
.

39 '/web': {'toŞs.unknown.Ú': 
True
},

40 #W¬À
Ú
 
£rv”
.* 
š
 
­p
 
cÚfig
.

42 #W¬À
Ú
 'localhost'

44 #W¬À
Ú
 '[name]'

46 
	}
}

47 
ch”rypy
.
quick¡¬t
(
RoÙ
(), 
cÚfig
=
cÚf
)

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/helper.py

3 
impÜt
 
d©‘ime


4 
impÜt
 
loggšg


5 
	glog
 = 
loggšg
.
	$g‘Logg”
(
__Çme__
)

6 
impÜt
 
os


7 
thisdœ
 = 
os
.
·th
.
	`ab¥©h
(os.·th.
	$dœÇme
(
__fe__
))

8 
£rv”³m
 = 
os
.
·th
.
	`još
(os.
	`g‘cwd
(), 
thisdœ
, 'test.pem')

10 
impÜt
 
»


11 
impÜt
 
sys


12 
impÜt
 
time


13 
impÜt
 
w¬nšgs


15 
impÜt
 
ch”rypy


16 
äom
 
ch”rypy
.
_ıcom·t
 
impÜt
 
ba£¡ršg
, 
cİy™ems
, 
HTTPSCÚÃùiÚ
, 
Áob


17 
äom
 
ch”rypy
.
_ıcom·t
 
impÜt
 
sub´oûss


18 
äom
 
ch”rypy
.
lib
 
impÜt
 
h‰put


19 
äom
 
ch”rypy
.
lib
 
impÜt
 
gùoŞs


20 
äom
 
ch”rypy
.
lib
.
»´cÚf
 
impÜt
 
uÄ•r


21 
äom
 
ch”rypy
.
‹¡
 
impÜt
 
web‹¡


23 
impÜt
 
no£


25 
_‹¡cÚfig
 = 
NÚe


27 
def
 
	`g‘_t¡_cÚfig
(
ov”cÚf
 = {
	}
}):

28 
glob®
 
_‹¡cÚfig


29 
_‹¡cÚfig
 
is
 
NÚe
:

30 
cÚf
 = {

35 'v®id©e': 
F®£
,

36 'cÚqu”': 
F®£
,

39 
Œy
:

40 
impÜt
 
‹¡cÚfig


41 
_cÚf
 = 
‹¡cÚfig
.
cÚfig
.
g‘
('su³rvisÜ', 
NÚe
)

42 
_cÚf
 
is
 
nÙ
 
	gNÚe
:

43 
k
, 
v
 
š
 
	g_cÚf
.
	$™ems
():

44 
	$isš¡ªû
(
v
, 
ba£¡ršg
):

45 
_cÚf
[
k
] = 
	$uÄ•r
(
v
)

46 
cÚf
.
	$upd©e
(
_cÚf
)

47 
exû±
 
ImpÜtE¼Ü
:

48 
·ss


49 
_‹¡cÚfig
 = 
cÚf


50 
cÚf
 = 
_‹¡cÚfig
.
	$cİy
()

51 
cÚf
.
	$upd©e
(
ov”cÚf
)

53  
cÚf


55 
şass
 
	$Su³rvisÜ
(
objeù
):

58 
def
 
	$__š™__
(
£lf
, **
kw¬gs
):

59 
k
, 
v
 
š
 
kw¬gs
.
	$™ems
():

60 
k
 == 'port':

61 
	`£‰r
(
£lf
, 
k
, (
v
))

62 
	$£‰r
(
£lf
, 
k
, 
v
)

65 
log_to_¡d”r
 = 
Ïmbda
 
msg
, 
Ëv–
: 
sys
.
¡d”r
.
	`wr™e
(msg + 
os
.
lše£p
)

67 
şass
 
	$LoÿlSu³rvisÜ
(
Su³rvisÜ
):

70 
Wh’
 
the
 
£rv”
 
side
 
runs
 
š
 
a
 
difã»Á
 
´oûss
, 
¡¬t
/
¡İ
 
ÿn
 
dump
 
®l


71 
¡©e
 
b‘w“n
 
—ch
 
‹¡
 
moduË
 
—sy
. 
Wh’
 
the
 
£rv”
 
side
 
runs
 
š
he

72 
§me
 
´oûss
 
as
 
the
 
ş›Á
, 
howev”
, 
we
 
have
 
to
 dØ
a
 
b™
 
mÜe
 
wÜk
Ø
’su»


73 
cÚfig
 
ªd
 
mouÁed
 
­ps
 
¬e
 
»£t
 
b‘w“n
 
‹¡s
.

76 
usšg_­ache
 = 
F®£


77 
usšg_wsgi
 = 
F®£


79 
def
 
	$__š™__
(
£lf
, **
kw¬gs
):

80 
k
, 
v
 
š
 
kw¬gs
.
	$™ems
():

81 
	$£‰r
(
£lf
, 
k
, 
v
)

83 
ch”rypy
.
£rv”
.
h‰p£rv”
 = 
£lf
.
h‰p£rv”_şass


85 #Thi 
is
 
³rh­s
 
the
 
wrÚg
 
¶aû
 
this
 
ÿÎ
 
but
hi i th
Úly


86 #¶aû 
th©
 
i
've found so farhat I KNOW isƒarlyƒnougho sethis.

87 
ch”rypy
.
cÚfig
.
	`upd©e
({'log.sü“n': 
F®£
})

88 
’gše
 = 
ch”rypy
.engine

89 
ha§‰r
(
’gše
, "signal_handler"):

90 
’gše
.
sigÇl_hªdËr
.
	$subsüibe
()

91 
	`ha§‰r
(
’gše
, "console_control_handler"):

92 
’gše
.
cÚsŞe_cÚŒŞ_hªdËr
.
	$subsüibe
()

93 #’gše.
	`subsüibe
('log', 
log_to_¡d”r
)

95 
def
 
	$¡¬t
(
£lf
, 
moduËÇme
=
NÚe
):

97 
moduËÇme
:

98 #Unhook 
h‰p£rv”
 
so
 
ch”rypy
.
£rv”
.
	`¡¬t
(è
ü—‹s
 
a
 
Ãw


99 #Ú(
w™h
 
cÚfig
 
äom
 
£tup_£rv”
, 
deş¬ed
).

100 
ch”rypy
.
£rv”
.
h‰p£rv”
 = 
NÚe


102 
ch”rypy
.
’gše
.
	$¡¬t
()

104 
£lf
.
	$sync_­ps
()

106 
def
 
	$sync_­ps
(
£lf
):

108 
·ss


110 
def
 
	$¡İ
(
£lf
):

111 
td
 = 
	`g‘©Œ
(
£lf
, '‹¬down', 
NÚe
)

112 
td
:

113 
	$td
()

115 
ch”rypy
.
’gše
.
	$ex™
()

117 
Çme
, 
£rv”
 
š
 
	`cİy™ems
(
	`g‘©Œ
(
ch”rypy
, '£rv”s', {
	}
})):

118 
£rv”
.
	$unsubsüibe
()

119 
d–
 
ch”rypy
.
£rv”s
[
Çme
]

122 
şass
 
	$N©iveS”v”Su³rvisÜ
(
LoÿlSu³rvisÜ
):

125 
h‰p£rv”_şass
 = "cherrypy._cpnative_server.CPHTTPServer"

126 
usšg_­ache
 = 
F®£


127 
usšg_wsgi
 = 
F®£


129 
def
 
	$__¡r__
(
£lf
):

130  "Butš HTTP S”v” oÀ%s:%s" % (
£lf
.
ho¡
, s–f.
pÜt
)

133 
şass
 
	$LoÿlWSGISu³rvisÜ
(
LoÿlSu³rvisÜ
):

136 
h‰p£rv”_şass
 = "cherrypy._cpwsgi_server.CPWSGIServer"

137 
usšg_­ache
 = 
F®£


138 
usšg_wsgi
 = 
True


140 
def
 
	$__¡r__
(
£lf
):

141  "Butš WSGI S”v” oÀ%s:%s" % (
£lf
.
ho¡
, s–f.
pÜt
)

143 
def
 
	$sync_­ps
(
£lf
):

145 
ch”rypy
.
£rv”
.
h‰p£rv”
.
wsgi_­p
 = 
£lf
.
	$g‘_­p
()

147 
def
 
	$g‘_­p
(
£lf
, 
­p
=
NÚe
):

149 
­p
 
is
 
NÚe
:

150 
­p
 = 
ch”rypy
.
Œ“


152 
£lf
.
cÚqu”
:

153 
Œy
:

154 
impÜt
 
wsgicÚq


155 
exû±
 
ImpÜtE¼Ü
:

156 
w¬nšgs
.
	`w¬n
("Error importing wsgiconq.…yconquer will‚ot„un.")

158 
­p
 = 
wsgicÚq
.
	$WSGILogg”
(
­p
, 
c_ÿÎs
=
True
)

160 
£lf
.
v®id©e
:

161 
Œy
:

162 
äom
 
wsgœef
 
impÜt
 
v®id©e


163 
exû±
 
ImpÜtE¼Ü
:

164 
w¬nšgs
.
	`w¬n
("Error importing wsgiref. The validator will‚ot„un.")

166 #w¿p 
the
 
­p
 
š
h
v®id©Ü


167 
­p
 = 
v®id©e
.
	$v®id©Ü
(
­p
)

169  
­p


172 
def
 
	$g‘_ımodpy_su³rvisÜ
(**
İtiÚs
):

173 
äom
 
ch”rypy
.
‹¡
 
impÜt
 
modpy


174 
sup
 = 
modpy
.
	$ModPythÚSu³rvisÜ
(**
İtiÚs
)

175 
sup
.
‹m¶©e
 = 
modpy
.
cÚf_ımodpy


176  
sup


178 
def
 
	$g‘_modpygw_su³rvisÜ
(**
İtiÚs
):

179 
äom
 
ch”rypy
.
‹¡
 
impÜt
 
modpy


180 
sup
 = 
modpy
.
	$ModPythÚSu³rvisÜ
(**
İtiÚs
)

181 
sup
.
‹m¶©e
 = 
modpy
.
cÚf_modpythÚ_g©eway


182 
sup
.
usšg_wsgi
 = 
True


183  
sup


185 
def
 
	$g‘_modwsgi_su³rvisÜ
(**
İtiÚs
):

186 
äom
 
ch”rypy
.
‹¡
 
impÜt
 
modwsgi


187  
modwsgi
.
	$ModWSGISu³rvisÜ
(**
İtiÚs
)

189 
def
 
	$g‘_modfcgid_su³rvisÜ
(**
İtiÚs
):

190 
äom
 
ch”rypy
.
‹¡
 
impÜt
 
modfcgid


191  
modfcgid
.
	$ModFCGISu³rvisÜ
(**
İtiÚs
)

193 
def
 
	$g‘_modç¡cgi_su³rvisÜ
(**
İtiÚs
):

194 
äom
 
ch”rypy
.
‹¡
 
impÜt
 
modç¡cgi


195  
modç¡cgi
.
	$ModFCGISu³rvisÜ
(**
İtiÚs
)

197 
def
 
	$g‘_wsgi_u_su³rvisÜ
(**
İtiÚs
):

198 
ch”rypy
.
£rv”
.
wsgi_v”siÚ
 = ('u', 0)

199  
	$LoÿlWSGISu³rvisÜ
(**
İtiÚs
)

202 
şass
 
	$CPWebCa£
(
web‹¡
.
WebCa£
):

204 
süt_Çme
 = ""

205 
scheme
 = "http"

207 
avaabË_£rv”s
 = {'wsgi': 
LoÿlWSGISu³rvisÜ
,

208 'wsgi_u': 
g‘_wsgi_u_su³rvisÜ
,

209 'Çtive': 
N©iveS”v”Su³rvisÜ
,

210 'ımodpy': 
g‘_ımodpy_su³rvisÜ
,

211 'modpygw': 
g‘_modpygw_su³rvisÜ
,

212 'modwsgi': 
g‘_modwsgi_su³rvisÜ
,

213 'modfcgid': 
g‘_modfcgid_su³rvisÜ
,

214 'modç¡cgi': 
g‘_modç¡cgi_su³rvisÜ
,

215 
	}
}

216 
deçuÉ_£rv”
 = "wsgi"

218 
def
 
	$_£tup_£rv”
(
şs
, 
su³rvisÜ
, 
cÚf
):

219 
v
 = 
sys
.
v”siÚ
.
	`¥l™
()[0]

220 
log
.
	`šfo
("PythÚ v”siÚ u£dØruÀthi ‹¡ süt: %s" % 
v
)

221 
log
.
	`šfo
("Ch”ryPy v”siÚ: %s" % 
ch”rypy
.
__v”siÚ__
)

222 
su³rvisÜ
.
scheme
 == "https":

223 
s¦
 = " (ssl)"

225 
s¦
 = ""

226 
log
.
	`šfo
("HTTP s”v” v”siÚ: %s%s" % (
su³rvisÜ
.
´ÙocŞ
, 
s¦
))

227 
log
.
	`šfo
("PID: %s" % 
os
.
	$g‘pid
())

229 
ch”rypy
.
£rv”
.
usšg_­ache
 = 
su³rvisÜ
.using_apache

230 
ch”rypy
.
£rv”
.
usšg_wsgi
 = 
su³rvisÜ
.using_wsgi

232 
sys
.
¶©fÜm
[:4] == 'java':

233 
ch”rypy
.
cÚfig
.
	`upd©e
({'£rv”.nod–ay': 
F®£
})

235 
	$isš¡ªû
(
cÚf
, 
ba£¡ršg
):

236 
·r£r
 = 
ch”rypy
.
lib
.
»´cÚf
.
	$P¬£r
()

237 
cÚf
 = 
·r£r
.
	`diù_äom_fe
(cÚf).
	`g‘
('glob®', {
	}
})

239 
cÚf
 = cÚà
Ü
 {}

240 
ba£cÚf
 = 
cÚf
.
	$cİy
()

241 
ba£cÚf
.
	`upd©e
({'£rv”.sock‘_ho¡': 
su³rvisÜ
.
ho¡
,

242 '£rv”.sock‘_pÜt': 
su³rvisÜ
.
pÜt
,

243 '£rv”.´ÙocŞ_v”siÚ': 
su³rvisÜ
.
´ÙocŞ
,

245 
	}
})

246 
su³rvisÜ
.
scheme
 == "https":

248 
ba£cÚf
['£rv”.s¦_û¹ifiÿ‹'] = 
£rv”³m


249 
ba£cÚf
['£rv”.s¦_´iv©e_key'] = 
£rv”³m


251 #h–³¸
mu¡
 
be
 
impÜ‹d
 
Ïzy
 
so
 
the
 
cov”age
 
toŞ


252 #ÿÀ
run
 
agaš¡
 
moduË
-
Ëv–
 
¡©em’ts
 
w™hš
 
ch”rypy
.

253 #Also, 
we
 
have
 
to
 do "from cherrypy.test import helper",

254 #exaùly 
like
 
—ch
 
‹¡
 
moduË
 
dÛs
, 
beÿu£
 
a
 
»Ïtive
 
impÜt


255 #would 
¡ick
 
a
 
£cÚd
 
š¡ªû
 
of
 
web‹¡
 
š
 
sys
.
moduËs
,

256 #ªd 
we
 
wouldn
't be‡bleo globally overridehe…ort‡nymore.

257 
	gsu³rvisÜ
.
	gscheme
 == "https":

258 
web‹¡
.
WebCa£
.
HTTP_CONN
 = 
HTTPSCÚÃùiÚ


259  
ba£cÚf


260 
_£tup_£rv”
 = 
	$şassm‘hod
(
_£tup_£rv”
)

262 
def
 
	$£tup_şass
(
şs
):

264 #C»©e 
a
 
£rv”


265 
cÚf
 = 
	$g‘_t¡_cÚfig
()

266 
su³rvisÜ_çùÜy
 = 
şs
.
avaabË_£rv”s
.
	`g‘
(
cÚf
.get('server', 'wsgi'))

267 
su³rvisÜ_çùÜy
 
is
 
NÚe
:

268 
¿i£
 
	`RuÁimeE¼Ü
('UnknowÀ£rv” iÀcÚfig: %s' % 
cÚf
['server'])

269 
su³rvisÜ
 = 
	$su³rvisÜ_çùÜy
(**
cÚf
)

271 #Cİ›d 
äom
 "run_test_suite"

272 
ch”rypy
.
cÚfig
.
	$»£t
()

273 
ba£cÚf
 = 
şs
.
	$_£tup_£rv”
(
su³rvisÜ
, 
cÚf
)

274 
ch”rypy
.
cÚfig
.
	$upd©e
(
ba£cÚf
)

275 
	$£tup_ş›Á
()

277 
	`ha§‰r
(
şs
, 'setup_server'):

278 #CË¬ 
the
 
ch”rypy
 
Œ“
 
ªd
 
ş—r
h
wsgi
 
£rv”
 
so
 
th©


279 #™ 
ÿn
 
be
 
upd©ed
 
w™h
 
the
 
Ãw
 
roÙ


280 
ch”rypy
.
Œ“
 = ch”rypy.
_ıŒ“
.
	$T»e
()

281 
ch”rypy
.
£rv”
.
h‰p£rv”
 = 
NÚe


282 
şs
.
	$£tup_£rv”
()

283 #Add 
a
 
»sourû
 
v”ifyšg
 
th”e
 
¬e
 
no
 
»æ—ks


284 #tØ*
ev”y
* 
‹¡
 
şass
.

285 
ch”rypy
.
Œ“
.
	`mouÁ
(
gùoŞs
.
	`GCRoÙ
(), '/gc')

286 
şs
.
do_gc_‹¡
 = 
True


287 
su³rvisÜ
.
	$¡¬t
(
şs
.
__moduË__
)

289 
şs
.
su³rvisÜ
 = supervisor

290 
£tup_şass
 = 
	$şassm‘hod
(
£tup_şass
)

292 
def
 
	$‹¬down_şass
(
şs
):

294 
	`ha§‰r
(
şs
, 'setup_server'):

295 
şs
.
su³rvisÜ
.
	$¡İ
()

296 
‹¬down_şass
 = 
	$şassm‘hod
(
‹¬down_şass
)

298 
do_gc_‹¡
 = 
F®£


300 
def
 
	$‹¡_gc
(
£lf
):

301 
£lf
.
do_gc_‹¡
:

302 
£lf
.
	`g‘Page
("/gc/stats")

303 
£lf
.
	`as£¹Body
("Statistics:")

304 #T–È
no£
 
to
 
run
 
this
 
Ï¡
 
š
 
—ch
 
şass
.

305 #P»ã¸
sys
.
maxšt
 
PythÚ
 2.3, 
which
 
didn
'ˆhavæßt('
šf
')

306 
‹¡_gc
.
com·t_co_fœ¡lš’o
 = 
	`g‘©Œ
(
sys
, 'maxšt', 
NÚe
è
Ü
 ('inf')

308 
def
 
	$´efix
(
£lf
):

309  
£lf
.
süt_Çme
.
	`r¡r
("/")

311 
def
 
	$ba£
(
£lf
):

312 ià((
£lf
.
scheme
 =ğ"h‰p" 
ªd
 s–f.
PORT
 =ğ80è
Ü


313 (
£lf
.
scheme
 =ğ"h‰ps" 
ªd
 s–f.
PORT
 == 443)):

314 
pÜt
 = ""

316 
pÜt
 = ":%s" % 
£lf
.
PORT


318  "%s://%s%s%s" % (
£lf
.
scheme
, s–f.
HOST
, 
pÜt
,

319 
£lf
.
süt_Çme
.
	`r¡r
("/"))

321 
def
 
	$ex™
(
£lf
):

322 
sys
.
	$ex™
()

324 
def
 
	`g‘Page
(
£lf
, 
u¾
, 
h—d”s
=
NÚe
, 
m‘hod
="GET", 
body
=NÚe, 
´ÙocŞ
=None):

326 
£lf
.
süt_Çme
:

327 
u¾
 = 
h‰put
.
	$u¾još
(
£lf
.
süt_Çme
, 
u¾
)

328  
web‹¡
.
WebCa£
.
	$g‘Page
(
£lf
, 
u¾
, 
h—d”s
, 
m‘hod
, 
body
, 
´ÙocŞ
)

330 
def
 
	`sk
(
£lf
, 
msg
='skipped '):

331 
¿i£
 
no£
.
	$SkTe¡
(
msg
)

333 
def
 
	`as£¹E¼ÜPage
(
£lf
, 
¡©us
, 
mes§ge
=
NÚe
, 
·‰”n
=''):

336 
The
 
funùiÚ
 
wl
 
İtiÚ®ly
 
look
 
the
 
»gexp
 
·‰”n
,

337 
w™hš
 
the
 
exû±iÚ
 
embedded
 
š
h
”rÜ
 
·ge
."""

339 #Thi 
wl
 
Ãv”
 
cÚš
 
a
 
Œaûback


340 
·ge
 = 
ch”rypy
.
_ı”rÜ
.
	$g‘_”rÜ_·ge
(
¡©us
, 
mes§ge
=message)

342 #Fœ¡, 
‹¡
 
the
 
»¥Ú£
 
body
 
w™hout
 
checkšg
h
Œaûback
.

343 #Stick 
a
 
m©ch
-
®l
 
	`group
 (.*è
š
 
to
 
g¿b
 
the
 
Œaûback
.

344 
esc
 = 
»
.
esÿ³


345 
•age
 = 
	$esc
(
·ge
)

346 
•age
 =ƒ·ge.
	`»¶aû
(
	`esc
('<pre id="traceback"></pre>'),

347 
	`esc
('<pre id="traceback">') + '(.*)' +ƒsc('</pre>'))

348 
m
 = 
»
.
	`m©ch
(
	`Áob
(
•age
, 
£lf
.
’codšg
), s–f.
body
,„e.
DOTALL
)

349 
nÙ
 
m
:

350 
£lf
.
	`_hªdËwebE¼Ü
('E¼Ü…agdÛ nÙ m©ch;ƒx³ùed:\n' + 
·ge
)

353 #Now 
‹¡
 
the
 
·‰”n
 
agaš¡
h
Œaûback


354 
·‰”n
 
is
 
NÚe
:

355 #S³cŸl-
NÚe
 
to
 
m—n
 
th©
 
th”e
 
should
 
be
 *
no
* 
Œaûback
.

356 
m
 
ªd
 m.
	$group
(1):

357 
£lf
.
	`_hªdËwebE¼Ü
('Error…age containsraceback')

359 ià(
m
 
is
 
NÚe
è
	`Ü
 (

360 
nÙ
 
»
.
	`£¬ch
(
	`Áob
Ôe.
	`esÿ³
(
·‰”n
), 
£lf
.
’codšg
),

361 
m
.
	$group
(1))):

362 
msg
 = 'Error…age does‚ot contain %s inraceback'

363 
£lf
.
	`_hªdËwebE¼Ü
(
msg
 % 
	$»´
(
·‰”n
))

365 
d©e_tŞ”ªû
 = 2

367 
def
 
	$as£¹Equ®D©es
(
£lf
, 
dt1
, 
dt2
, 
£cÚds
=
NÚe
):

369 
£cÚds
 
is
 
NÚe
:

370 
£cÚds
 = 
£lf
.
d©e_tŞ”ªû


372 
dt1
 > 
dt2
:

373 
diff
 = 
dt1
 - 
dt2


375 
diff
 = 
dt2
 - 
dt1


376 
nÙ
 
diff
 < 
d©‘ime
.
	$timed–
(
£cÚds
=seconds):

377 
¿i£
 
	`As£¹iÚE¼Ü
('%r‡nd %r‡re‚ot within %r seconds.' %

378 (
dt1
, 
dt2
, 
£cÚds
))

381 
def
 
	$£tup_ş›Á
():

383 
web‹¡
.
WebCa£
.
PORT
 = 
ch”rypy
.
£rv”
.
sock‘_pÜt


384 
web‹¡
.
WebCa£
.
HOST
 = 
ch”rypy
.
£rv”
.
sock‘_ho¡


385 
ch”rypy
.
£rv”
.
s¦_û¹ifiÿ‹
:

386 
CPWebCa£
.
scheme
 = 'https'

388 #--------------------------- 
S·wnšg
 
h–³rs
 --------------------------- #


390 
şass
 
	$CPProûss
(
objeù
):

392 
pid_fe
 = 
os
.
·th
.
	`još
(
thisdœ
, 'test.pid')

393 
cÚfig_fe
 = 
os
.
·th
.
	`još
(
thisdœ
, 'test.conf')

394 
cÚfig_‹m¶©e
 = """[global]

395 
£rv”
.
sock‘_ho¡
: '%(host)s'

396 
£rv”
.
sock‘_pÜt
: %(
pÜt
)
s


397 
check”
.
Ú
: 
F®£


398 
log
.
sü“n
: 
F®£


399 
log
.
”rÜ_fe
: 
r
'%(error_log)s'

400 
log
.
acûss_fe
: 
r
'%(access_log)s'

401 %(
s¦
)
s


402 %(
exŒa
)
s


404 
”rÜ_log
 = 
os
.
·th
.
	`još
(
thisdœ
, 'test.error.log')

405 
acûss_log
 = 
os
.
·th
.
	`još
(
thisdœ
, 'test.access.log')

407 
def
 
	$__š™__
(
£lf
, 
wa™
=
F®£
, 
d«mÚize
=F®£, 
s¦
=F®£, 
sock‘_ho¡
=
NÚe
, 
sock‘_pÜt
=None):

408 
£lf
.
wa™
 = wait

409 
£lf
.
d«mÚize
 = daemonize

410 
£lf
.
s¦
 = ssl

411 
£lf
.
ho¡
 = 
sock‘_ho¡
 
Ü
 
ch”rypy
.
£rv”
.socket_host

412 
£lf
.
pÜt
 = 
sock‘_pÜt
 
Ü
 
ch”rypy
.
£rv”
.socket_port

414 
def
 
	`wr™e_cÚf
(
£lf
, 
exŒa
=""):

415 
£lf
.
s¦
:

416 
£rv”³m
 = 
os
.
·th
.
	`još
(
thisdœ
, 'test.pem')

417 
s¦
 = """

418 
£rv”
.
s¦_û¹ifiÿ‹
: 
r
'%s'

419 
£rv”
.
s¦_´iv©e_key
: 
r
'%s'

422 
s¦
 = ""

424 
cÚf
 = 
£lf
.
cÚfig_‹m¶©e
 % {

425 'ho¡': 
£lf
.
ho¡
,

426 'pÜt': 
£lf
.
pÜt
,

427 '”rÜ_log': 
£lf
.
”rÜ_log
,

428 'acûss_log': 
£lf
.
acûss_log
,

429 's¦': 
s¦
,

430 'exŒa': 
exŒa
,

431 
	}
}

432 
f
 = 
İ’
(
£lf
.
cÚfig_fe
, 'wb')

433 
	gf
.
wr™e
(
Áob
(
cÚf
, 'utf-8'))

434 
	gf
.
	$şo£
()

436 
def
 
	$¡¬t
(
£lf
, 
impÜts
=
NÚe
):

438 
ch”rypy
.
_ı£rv”
.
	$wa™_fÜ_ä“_pÜt
(
£lf
.
ho¡
, s–f.
pÜt
)

440 
¬gs
 = [

441 
os
.
·th
.
	`još
(
thisdœ
, '..', 'cherryd'),

442 '-c', 
£lf
.
cÚfig_fe
,

443 '-p', 
£lf
.
pid_fe
,

446 
nÙ
 
	`isš¡ªû
(
impÜts
, (
li¡
, 
tu¶e
)):

447 
impÜts
 = [imports]

448 
i
 
š
 
impÜts
:

449 
i
:

450 
¬gs
.
	`­³nd
('-i')

451 
¬gs
.
	$­³nd
(
i
)

453 
£lf
.
d«mÚize
:

454 
¬gs
.
	`­³nd
('-d')

456 
’v
 = 
os
.
’vœÚ
.
	$cİy
()

457 #Mak
su»
 
we
 
impÜt
 
the
 
ch”rypy
 
·ckage
 
š
 
which
 
this
 
moduË
 
is
 
defšed
.

458 
g¿nd·»Ádœ
 = 
os
.
·th
.
	`ab¥©h
(os.·th.
	`još
(
thisdœ
, '..', '..'))

459 
’v
.
	`g‘
('PYTHONPATH', ''):

460 
’v
['PYTHONPATH'] = 
os
.
·th£p
.
	`još
((
g¿nd·»Ádœ
,ƒnv['PYTHONPATH']))

462 
’v
['PYTHONPATH'] = 
g¿nd·»Ádœ


463 
£lf
.
_´oc
 = 
sub´oûss
.
	`Pİ’
([
sys
.
execubË
] + 
¬gs
, 
’v
=env)

464 
£lf
.
wa™
:

465 
£lf
.
ex™_code
 = s–f.
_´oc
.
	$wa™
()

467 
ch”rypy
.
_ı£rv”
.
	$wa™_fÜ_occup›d_pÜt
(
£lf
.
ho¡
, s–f.
pÜt
)

469 #Giv
the
 
’gše
 
a
 
w“
 
b™
 
mÜe
 
time
 
to
 
fšish
 
STARTING


470 
£lf
.
d«mÚize
:

471 
time
.
	$¦“p
(2)

473 
time
.
	$¦“p
(1)

475 
def
 
	$g‘_pid
(
£lf
):

476 
£lf
.
d«mÚize
:

477  (
	`İ’
(
£lf
.
pid_fe
, 'rb').
	$»ad
())

478  
£lf
.
_´oc
.
pid


480 
def
 
	$još
(
£lf
):

482 
£lf
.
d«mÚize
:

483  
£lf
.
	$_još_d«mÚ
()

484 
£lf
.
_´oc
.
	$wa™
()

486 
def
 
	$_još_d«mÚ
(
£lf
):

487 
Œy
:

488 
Œy
:

489 #Mac, 
UNIX


490 
os
.
	$wa™
()

491 
exû±
 
A‰ribu‹E¼Ü
:

493 
Œy
:

494 
pid
 = 
£lf
.
	$g‘_pid
()

495 
exû±
 
IOE¼Ü
:

496 #Assum
the
 
sub´oûss
 
d–‘ed
h
pidfe
 
Ú
 
shutdown
.

497 
·ss


499 
os
.
	$wa™pid
(
pid
, 0)

500 
exû±
 
OSE¼Ü
:

501 
x
 = 
sys
.
	`exc_šfo
()[1]

502 
x
.
¬gs
 != (10, 'No child…rocesses'):

503 
¿i£


	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/logtest.py

3 
impÜt
 
sys


4 
impÜt
 
time


6 
impÜt
 
ch”rypy


7 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
	gba£¡ršg
, 
	gÁob
, 
unicode¡r


10 
	gŒy
:

11 #OÀ
Wšdows
, 
msvüt
.
g‘ch
 
»ads
 
a
 
sšgË
 
w™hout
 
ouut
.

12 
impÜt
 
msvüt


13 
def
 
	$g‘ch¬
():

14  
msvüt
.
	$g‘ch
()

15 
exû±
 
ImpÜtE¼Ü
:

16 #Unix 
g‘chr


17 
impÜt
 
‰y
, 
‹rmios


18 
def
 
	$g‘ch¬
():

19 
fd
 = 
sys
.
¡dš
.
	$f’o
()

20 
Şd_£‰šgs
 = 
‹rmios
.
	$tcg‘©Œ
(
fd
)

21 
Œy
:

22 
‰y
.
	`£Œaw
(
sys
.
¡dš
.
	$f’o
())

23 
ch
 = 
sys
.
¡dš
.
	$»ad
(1)

24 
fš®ly
:

25 
‹rmios
.
	$tc£‰r
(
fd
, 
‹rmios
.
TCSADRAIN
, 
Şd_£‰šgs
)

26  
ch


29 
şass
 
	$LogCa£
(
objeù
):

32 
logfe
: 
a
 
f’ame
 
the
 
desœed
 
log
. 
Yes
, 
I
 
know
 
modes
 
¬e
 
ev
,

33 
but
 
™
 
makes
 
the
 
‹¡
 
funùiÚs
 
so
 
much
 
ş—Ãr
 
to
 
£t
 
this
 
Úû
.

35 
Ï¡m¬k”
: 
the
 
Ï¡
 
m¬k”
 
š
h
log
. 
This
 
ÿn
 
be
 
u£d
 
to
 
£¬ch
 

36 
mes§ges
 
sšû
 
the
 
Ï¡
 
m¬k”
.

38 
m¬k”P»fix
: 
a
 
¡ršg
 
w™h
 
which
 
to
 
´efix
 
log
 
m¬k”s
. 
This
 
should
 
be


39 
unique
 
’ough
 
äom
 
nÜm®
 
log
 
ouut
 
to
 
u£
 
m¬k”
 
id’tifiÿtiÚ
.

42 
logfe
 = 
NÚe


43 
Ï¡m¬k”
 = 
NÚe


44 
m¬k”P»fix
 = 
	`Áob
("test suite marker: ")

46 
def
 
	$_hªdËLogE¼Ü
(
£lf
, 
msg
, 
d©a
, 
m¬k”
, 
·‰”n
):

47 
	`´št
("")

48 
	`´št
(" ERROR: %s" % 
msg
)

50 
nÙ
 
£lf
.
š‹¿ùive
:

51 
¿i£
 
£lf
.
	$çu»Exû±iÚ
(
msg
)

53 
p
 = " Show: [L]og [M]arker [P]attern; [I]gnore, [R]aise, or sys.e[X]it >> "

54 
sys
.
¡dout
.
	`wr™e
(
p
 + ' ')

56 
sys
.
¡dout
.
	$æush
()

57 
True
:

58 
i
 = 
	`g‘ch¬
().
	$uµ”
()

59 
i
 
nÙ
 
š
 "MPLIRX":

61 
	`´št
(
i
.
	$uµ”
()è#AlsØ
´šts
 
Ãw
 
lše


62 
i
 == "L":

63 
x
, 
lše
 
š
 
	$’um”©e
(
d©a
):

64 ià(
x
 + 1è% 
£lf
.
cÚsŞe_height
 == 0:

65 #Th\
r
 
ªd
 
comma
 
should
 
make
 
the
 
Ãxt
 
lše
 
ov”wr™e


66 
sys
.
¡dout
.
	`wr™e
("<-- More -->\r ")

67 
m
 = 
	`g‘ch¬
().
	$low”
()

68 #E¿£ 
our
 "MÜe" 
´om±


69 
sys
.
¡dout
.
	`wr™e
(" \r ")

70 
m
 == "q":

72 
	`´št
(
lše
.
	$r¡r
())

73 
–if
 
i
 == "M":

74 
	`´št
(
	$»´
(
m¬k”
 
Ü
 
£lf
.
Ï¡m¬k”
))

75 
–if
 
i
 == "P":

76 
	`´št
(
	$»´
(
·‰”n
))

77 
–if
 
i
 == "I":

78 #»tuº 
w™hout
 
¿isšg
 
the
 
nÜm®
 
exû±iÚ


80 
–if
 
i
 == "R":

81 
¿i£
 
£lf
.
	$çu»Exû±iÚ
(
msg
)

82 
–if
 
i
 == "X":

83 
£lf
.
	$ex™
()

84 
sys
.
¡dout
.
	`wr™e
(
p
 + ' ')

86 
def
 
	$ex™
(
£lf
):

87 
sys
.
	$ex™
()

89 
def
 
	$em±yLog
(
£lf
):

91 
	`İ’
(
£lf
.
logfe
, 'wb').
	`wr™e
("")

93 
def
 
	$m¬kLog
(
£lf
, 
key
=
NÚe
):

95 
key
 
is
 
NÚe
:

96 
key
 = 
	`¡r
(
time
.
	$time
())

97 
£lf
.
Ï¡m¬k”
 = 
key


99 
	`İ’
(
£lf
.
logfe
, 'ab+').
	`wr™e
(
	`Áob
("%s%s\n" % (£lf.
m¬k”P»fix
, 
key
),"utf-8"))

101 
def
 
	$_»ad_m¬ked_»giÚ
(
£lf
, 
m¬k”
=
NÚe
):

104 
If
 
m¬k”
 
is
 
NÚe
, 
£lf
.
Ï¡m¬k”
 i 
u£d
. Ià
the
 
log
 
ha¢
't

105 
b“n
 
	`m¬ked
 (
usšg
 
£lf
.
m¬kLog
), 
the
 
’tœe
 
log
 
wl
 
be
 
»tuºed
.

107 ## #Giv
the
 
logg”
 
time
 
to
 
fšish
 
wr™šg
?

108 ## 
time
.
	`¦“p
(0.5)

110 
logfe
 = 
£lf
.logfile

111 
m¬k”
 = m¬k” 
Ü
 
£lf
.
Ï¡m¬k”


112 
m¬k”
 
is
 
NÚe
:

113  
	`İ’
(
logfe
, 'rb').
	$»adlšes
()

115 
	$isš¡ªû
(
m¬k”
, 
unicode¡r
):

116 
m¬k”
 = m¬k”.
	`’code
('utf-8')

117 
d©a
 = []

118 
š_»giÚ
 = 
F®£


119 
lše
 
š
 
	`İ’
(
logfe
, 'rb'):

120 
š_»giÚ
:

121 ià(
lše
.
	$¡¬tsw™h
(
£lf
.
m¬k”P»fix
è
ªd
 
nÙ
 
m¬k”
 
š
 
lše
):

124 
d©a
.
	$­³nd
(
lše
)

125 
–if
 
m¬k”
 
š
 
lše
:

126 
š_»giÚ
 = 
True


127  
d©a


129 
def
 
	$as£¹InLog
(
£lf
, 
lše
, 
m¬k”
=
NÚe
):

132 
The
 
log
 
wl
 
be
 
£¬ched
 
äom
 
the
 
giv’
 
m¬k”
 
to
h
Ãxt
 marker.

133 
If
 
m¬k”
 
is
 
NÚe
, 
£lf
.
Ï¡m¬k”
 i 
u£d
. Ià
the
 
log
 
ha¢
't

134 
b“n
 
	`m¬ked
 (
usšg
 
£lf
.
m¬kLog
), 
the
 
’tœe
 
log
 
wl
 
be
 
£¬ched
.

136 
d©a
 = 
£lf
.
	$_»ad_m¬ked_»giÚ
(
m¬k”
)

137 
loglše
 
š
 
d©a
:

138 
lše
 
š
 
loglše
:

140 
msg
 = "%¸nÙ found iÀlog" % 
lše


141 
£lf
.
	$_hªdËLogE¼Ü
(
msg
, 
d©a
, 
m¬k”
, 
lše
)

143 
def
 
	$as£¹NÙInLog
(
£lf
, 
lše
, 
m¬k”
=
NÚe
):

146 
The
 
log
 
wl
 
be
 
£¬ched
 
äom
 
the
 
giv’
 
m¬k”
 
to
h
Ãxt
 marker.

147 
If
 
m¬k”
 
is
 
NÚe
, 
£lf
.
Ï¡m¬k”
 i 
u£d
. Ià
the
 
log
 
ha¢
't

148 
b“n
 
	`m¬ked
 (
usšg
 
£lf
.
m¬kLog
), 
the
 
’tœe
 
log
 
wl
 
be
 
£¬ched
.

150 
d©a
 = 
£lf
.
	$_»ad_m¬ked_»giÚ
(
m¬k”
)

151 
loglše
 
š
 
d©a
:

152 
lše
 
š
 
loglše
:

153 
msg
 = "%¸found iÀlog" % 
lše


154 
£lf
.
	$_hªdËLogE¼Ü
(
msg
, 
d©a
, 
m¬k”
, 
lše
)

156 
def
 
	$as£¹Log
(
£lf
, 
¦iû¬gs
, 
lšes
, 
m¬k”
=
NÚe
):

159 
The
 
log
 
wl
 
be
 
£¬ched
 
äom
 
the
 
giv’
 
m¬k”
 
to
h
Ãxt
 marker.

160 
If
 
m¬k”
 
is
 
NÚe
, 
£lf
.
Ï¡m¬k”
 i 
u£d
. Ià
the
 
log
 
ha¢
't

161 
b“n
 
	`m¬ked
 (
usšg
 
£lf
.
m¬kLog
), 
the
 
’tœe
 
log
 
wl
 
be
 
£¬ched
.

163 
d©a
 = 
£lf
.
	$_»ad_m¬ked_»giÚ
(
m¬k”
)

164 
	$isš¡ªû
(
¦iû¬gs
, ):

165 #SšgË 
¬g
. 
U£
 
__g‘™em__
 
ªd
 
®low
 
lšes
 
to
 
be
 
¡r
 
Ü
 
li¡
.

166 
	`isš¡ªû
(
lšes
, (
tu¶e
, 
li¡
)):

167 
lšes
 =†ines[0]

168 
	$isš¡ªû
(
lšes
, 
unicode¡r
):

169 
lšes
 =†šes.
	`’code
('utf-8')

170 
lšes
 
nÙ
 
š
 
d©a
[
¦iû¬gs
]:

171 
msg
 = "%¸nÙ found oÀlog†š%r" % (
lšes
, 
¦iû¬gs
)

172 
£lf
.
	`_hªdËLogE¼Ü
(
msg
, [
d©a
[
¦iû¬gs
],"--EXTRA CONTEXT--"] + d©a[¦iû¬gs+1:¦iû¬gs+6], 
m¬k”
, 
lšes
)

174 #MuÉË 
¬gs
. 
U£
 
__g‘¦iû__
 
ªd
 
»quœe
 
lšes
 
to
 
be
 
li¡
.

175 
	$isš¡ªû
(
lšes
, 
tu¶e
):

176 
lšes
 = 
	$li¡
(
lšes
)

177 
–if
 
	$isš¡ªû
(
lšes
, 
ba£¡ršg
):

178 
¿i£
 
	`Ty³E¼Ü
("The 'lines'‡rg must be‡†ist when "

181 
¡¬t
, 
¡İ
 = 
¦iû¬gs


182 
lše
, 
loglše
 
š
 
	`z
(
lšes
, 
d©a
[
¡¬t
:
¡İ
]):

183 
	$isš¡ªû
(
lše
, 
unicode¡r
):

184 
lše
 =†še.
	`’code
('utf-8')

185 
lše
 
nÙ
 
š
 
loglše
:

186 
msg
 = "%¸nÙ found iÀlog" % 
lše


187 
£lf
.
	`_hªdËLogE¼Ü
(
msg
, 
d©a
[
¡¬t
:
¡İ
], 
m¬k”
, 
lše
)

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/modfastcgi.py

3 
To
 
auto¡¬t
 
	gç¡cgi
, 
	gthe
 "­ache" 
execubË
 
Ü
 
süt
 
mu¡
 
be


4 
Ú
 
your
 
sy¡em
 
	g·th
, 
Ü
 
you
 
mu¡
 
ov”ride
 
the
 
glob®
 
	gAPACHE_PATH
.

5 
On
 
some
 
	g¶©fÜms
, "­ache" 
may
 
be
 
	gÿÎed
 "apachectl", "apache2ctl",

6 
	gÜ
 "h‰pd"--
ü—‹
 
a
 
symlšk
 
to
 
them
 
	gÃeded
.

8 
	gYou
'll‡lso‚eedhe WSGIServer from flup.servers.

9 
S“
 
	gh‰p
:

12 
KNOWN
 
BUGS


15 1. 
A·che
 
´oûs£s
 
Rªge
 
h—d”s
 
autom©iÿÎy
; 
	gCh”ryPy
'sruncated

16 
ouut
 
is
 
th’
 
Œunÿ‹d
 
agaš
 
by
 
	gA·che
. 
S“
 
	g‹¡_cÜe
.
	g‹¡Rªges
.

17 
This
 
was
 
wÜked
 
¬ound
 
š
 
	gh‰p
:

18 2. 
A·che
 
dÛs
 
nÙ
 
®low
 
cu¡om
 
HTTP
 
m‘hods
 
like
 
CONNECT
 
as
 
³r
 
the
 
¥ec
.

19 
S“
 
‹¡_cÜe
.
‹¡HTTPM‘hods
.

20 3. 
Max
 
»que¡
 
h—d”
 
ªd
 
body
 
£‰šgs
 dØ
nÙ
 
wÜk
 
w™h
 
A·che
.

21 4. 
A·che
 
»¶aûs
 
¡©us
 "»asÚ…h¿£s" 
autom©iÿÎy
. 
FÜ
 
exam¶e
,

22 
Ch”ryPy
 
may
 
	g£t
 "304 NÙ modif›d" 
but
 
A·che
 
wl
 
wr™e
 
	gout


23 "304 NÙ Modif›d" (
	gÿp™®
 "M").

24 5. 
A·che
 
dÛs
 
nÙ
 
®low
 
cu¡om
 
”rÜ
 
codes
 
as
 
³r
 
the
 
	g¥ec
.

25 6. 
	$A·che
 (
Ü
 
³rh­s
 
modpythÚ
, o¸
modpythÚ_g©eway
è
unquÙes
 %
xx
 
š
 
the


26 
Reque¡
-
URI
 
too
 
—¾y
.

27 7. 
mod_pythÚ
 
wl
 
nÙ
 
»ad
 
»que¡
 
bod›s
 
which
 
u£
 
the
 "chunked"

28 
Œªsãr
-
	`codšg
 (
™
 
·s£s
 
REQUEST_CHUNKED_ERROR
 
to
 
­_£tup_ş›Á_block


29 
š¡—d
 
of
 
REQUEST_CHUNKED_DECHUNK
, 
£e
 
A·che2
's http_protocol.c‡nd

30 
mod_pythÚ
's„equestobject.c).

31 8. 
A·che
 
wl
 
ouut
 
a
 "CÚ‹Á-L’gth: 0" 
»¥Ú£
 
h—d”
 
ev’
 
th”e
's

32 
no
 
»¥Ú£
 
’t™y
 
body
. 
This
 
i¢
't„eally‡ bug; it just differs from

33 
the
 
Ch”ryPy
 .

36 
impÜt
 
os


37 
curdœ
 = 
os
.
·th
.
	`još
(os.
	`g‘cwd
(), os.·th.
	$dœÇme
(
__fe__
))

38 
impÜt
 
»


39 
impÜt
 
sys


40 
impÜt
 
time


42 
impÜt
 
ch”rypy


43 
äom
 
ch”rypy
.
´oûss
 
impÜt
 
¶ugšs
, 
£rv”s


44 
äom
 
ch”rypy
.
‹¡
 
impÜt
 
h–³r


47 
def
 
	`»ad_´oûss
(
cmd
, 
¬gs
=""):

48 
peš
, 
peout
 = 
os
.
	`pİ’4
("% %s" % (
cmd
, 
¬gs
))

49 
Œy
:

50 
fœ¡lše
 = 
peout
.
	$»adlše
()

51 ià(
»
.
	`£¬ch
(
r
"ÒÙ„ecognized|NØsuch fe|nÙ found)", 
fœ¡lše
,

52 
»
.
IGNORECASE
)):

53 
¿i£
 
	`IOE¼Ü
('% mu¡ bÚ you¸sy¡em…©h.' % 
cmd
)

54 
ouut
 = 
fœ¡lše
 + 
peout
.
	$»ad
()

55 
fš®ly
:

56 
peout
.
	$şo£
()

57  
ouut


60 
APACHE_PATH
 = "apache2ctl"

61 
CONF_PATH
 = "fastcgi.conf"

63 
cÚf_ç¡cgi
 = """

64 #A·che2 
£rv”
 
cÚf
 
fe
 
‹¡šg
 
Ch”ryPy
 
w™h
 
mod_ç¡cgi
.

65 #fumªchu: 
I
 
had
 
to
 
h¬d
-
code
 
·ths
 
due
Ø
üazy
 
DebŸn
 
Ïyouts
 :(

66 
S”v”RoÙ
 /
u¤
/
lib
/
­ache2


67 
U£r
 #1000

68 
E¼ÜLog
 %(
roÙ
)
s
/
mod_ç¡cgi
.
”rÜ
.
log


70 
Docum’tRoÙ
 "%(root)s"

71 
S”v”Name
 127.0.0.1

72 
Li¡’
 %(
pÜt
)
s


73 
LßdModuË
 
ç¡cgi_moduË
 
moduËs
/
mod_ç¡cgi
.
so


74 
LßdModuË
 
»wr™e_moduË
 
moduËs
/
mod_»wr™e
.
so


76 
O±iÚs
 +
ExecCGI


77 
S‘HªdËr
 
ç¡cgi
-
süt


78 
Rewr™eEngše
 
On


79 
Rewr™eRuË
 ^(.*)
$
 /
ç¡cgi
.
pyc
 [
L
]

80 
Fa¡CgiEx‹º®S”v”
 "%(£rv”)s" -
ho¡
 127.0.0.1:4000

83 
def
 
	$”a£_süt_Çme
(
’vœÚ
, 
¡¬t_»¥Ú£
):

84 
’vœÚ
['SCRIPT_NAME'] = ''

85  
ch”rypy
.
	$Œ“
(
’vœÚ
, 
¡¬t_»¥Ú£
)

87 
şass
 
	$ModFCGISu³rvisÜ
(
h–³r
.
LoÿlWSGISu³rvisÜ
):

89 
h‰p£rv”_şass
 = "cherrypy.process.servers.FlupFCGIServer"

90 
usšg_­ache
 = 
True


91 
usšg_wsgi
 = 
True


92 
‹m¶©e
 = 
cÚf_ç¡cgi


94 
def
 
	$__¡r__
(
£lf
):

95  "FCGI S”v” oÀ%s:%s" % (
£lf
.
ho¡
, s–f.
pÜt
)

97 
def
 
	$¡¬t
(
£lf
, 
moduËÇme
):

98 
ch”rypy
.
£rv”
.
h‰p£rv”
 = 
£rv”s
.
	`FlupFCGIS”v”
(

99 
­¶iÿtiÚ
=
”a£_süt_Çme
, 
bšdAdd»ss
=('127.0.0.1', 4000))

100 
ch”rypy
.
£rv”
.
h‰p£rv”
.
bšd_addr
 = ('127.0.0.1', 4000)

101 
ch”rypy
.
£rv”
.
sock‘_pÜt
 = 4000

102 #FÜ 
FCGI
, 
we
 
bÙh
 
¡¬t
 
­ache
...

103 
£lf
.
	$¡¬t_­ache
()

104 #...
ªd
 
our
 
loÿl
 
£rv”


105 
ch”rypy
.
’gše
.
	$¡¬t
()

106 
£lf
.
	$sync_­ps
()

108 
def
 
	$¡¬t_­ache
(
£lf
):

109 
fcgicÚf
 = 
CONF_PATH


110 
nÙ
 
os
.
·th
.
	$i§bs
(
fcgicÚf
):

111 
fcgicÚf
 = 
os
.
·th
.
	$još
(
curdœ
, 
fcgicÚf
)

113 #Wr™
the
 
A·che
 
cÚf
 
fe
.

114 
f
 = 
	`İ’
(
fcgicÚf
, 'wb')

115 
Œy
:

116 
£rv”
 = 
	`»´
(
os
.
·th
.
	`još
(
curdœ
, 'fastcgi.pyc'))[1:-1]

117 
ouut
 = 
£lf
.
‹m¶©e
 % {'pÜt': s–f.
pÜt
, 'roÙ': 
curdœ
,

118 '£rv”': 
£rv”
}

119 
ouut
 = ouut.
»¶aû
('\r\n', '\n')

120 
	gf
.
	$wr™e
(
ouut
)

121 
fš®ly
:

122 
f
.
	$şo£
()

124 
»suÉ
 = 
	`»ad_´oûss
(
APACHE_PATH
, "-k s¹ -à%s" % 
fcgicÚf
)

125 
»suÉ
:

126 
	$´št
(
»suÉ
)

128 
def
 
	$¡İ
(
£lf
):

130 
	`»ad_´oûss
(
APACHE_PATH
, "-k stop")

131 
h–³r
.
LoÿlWSGISu³rvisÜ
.
	$¡İ
(
£lf
)

133 
def
 
	$sync_­ps
(
£lf
):

134 
ch”rypy
.
£rv”
.
h‰p£rv”
.
fcgi£rv”
.
­¶iÿtiÚ
 = 
£lf
.
	`g‘_­p
(
”a£_süt_Çme
)

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/modfcgid.py

3 
To
 
auto¡¬t
 
	gfcgid
, 
	gthe
 "­ache" 
execubË
 
Ü
 
süt
 
mu¡
 
be


4 
Ú
 
your
 
sy¡em
 
	g·th
, 
Ü
 
you
 
mu¡
 
ov”ride
 
the
 
glob®
 
	gAPACHE_PATH
.

5 
On
 
some
 
	g¶©fÜms
, "­ache" 
may
 
be
 
	gÿÎed
 "apachectl", "apache2ctl",

6 
	gÜ
 "h‰pd"--
ü—‹
 
a
 
symlšk
 
to
 
them
 
	gÃeded
.

8 
	gYou
'll‡lso‚eedhe WSGIServer from flup.servers.

9 
S“
 
	gh‰p
:

12 
KNOWN
 
BUGS


15 1. 
A·che
 
´oûs£s
 
Rªge
 
h—d”s
 
autom©iÿÎy
; 
	gCh”ryPy
'sruncated

16 
ouut
 
is
 
th’
 
Œunÿ‹d
 
agaš
 
by
 
	gA·che
. 
S“
 
	g‹¡_cÜe
.
	g‹¡Rªges
.

17 
This
 
was
 
wÜked
 
¬ound
 
š
 
	gh‰p
:

18 2. 
A·che
 
dÛs
 
nÙ
 
®low
 
cu¡om
 
HTTP
 
m‘hods
 
like
 
CONNECT
 
as
 
³r
 
the
 
¥ec
.

19 
S“
 
‹¡_cÜe
.
‹¡HTTPM‘hods
.

20 3. 
Max
 
»que¡
 
h—d”
 
ªd
 
body
 
£‰šgs
 dØ
nÙ
 
wÜk
 
w™h
 
A·che
.

21 4. 
A·che
 
»¶aûs
 
¡©us
 "»asÚ…h¿£s" 
autom©iÿÎy
. 
FÜ
 
exam¶e
,

22 
Ch”ryPy
 
may
 
	g£t
 "304 NÙ modif›d" 
but
 
A·che
 
wl
 
wr™e
 
	gout


23 "304 NÙ Modif›d" (
	gÿp™®
 "M").

24 5. 
A·che
 
dÛs
 
nÙ
 
®low
 
cu¡om
 
”rÜ
 
codes
 
as
 
³r
 
the
 
	g¥ec
.

25 6. 
	$A·che
 (
Ü
 
³rh­s
 
modpythÚ
, o¸
modpythÚ_g©eway
è
unquÙes
 %
xx
 
š
 
the


26 
Reque¡
-
URI
 
too
 
—¾y
.

27 7. 
mod_pythÚ
 
wl
 
nÙ
 
»ad
 
»que¡
 
bod›s
 
which
 
u£
 
the
 "chunked"

28 
Œªsãr
-
	`codšg
 (
™
 
·s£s
 
REQUEST_CHUNKED_ERROR
 
to
 
­_£tup_ş›Á_block


29 
š¡—d
 
of
 
REQUEST_CHUNKED_DECHUNK
, 
£e
 
A·che2
's http_protocol.c‡nd

30 
mod_pythÚ
's„equestobject.c).

31 8. 
A·che
 
wl
 
ouut
 
a
 "CÚ‹Á-L’gth: 0" 
»¥Ú£
 
h—d”
 
ev’
 
th”e
's

32 
no
 
»¥Ú£
 
’t™y
 
body
. 
This
 
i¢
't„eally‡ bug; it just differs from

33 
the
 
Ch”ryPy
 .

36 
impÜt
 
os


37 
curdœ
 = 
os
.
·th
.
	`još
(os.
	`g‘cwd
(), os.·th.
	$dœÇme
(
__fe__
))

38 
impÜt
 
»


39 
impÜt
 
sys


40 
impÜt
 
time


42 
impÜt
 
ch”rypy


43 
äom
 
ch”rypy
.
_ıcom·t
 
impÜt
 
Áob


44 
äom
 
ch”rypy
.
´oûss
 
impÜt
 
¶ugšs
, 
£rv”s


45 
äom
 
ch”rypy
.
‹¡
 
impÜt
 
h–³r


48 
def
 
	`»ad_´oûss
(
cmd
, 
¬gs
=""):

49 
peš
, 
peout
 = 
os
.
	`pİ’4
("% %s" % (
cmd
, 
¬gs
))

50 
Œy
:

51 
fœ¡lše
 = 
peout
.
	$»adlše
()

52 ià(
»
.
	`£¬ch
(
r
"ÒÙ„ecognized|NØsuch fe|nÙ found)", 
fœ¡lše
,

53 
»
.
IGNORECASE
)):

54 
¿i£
 
	`IOE¼Ü
('% mu¡ bÚ you¸sy¡em…©h.' % 
cmd
)

55 
ouut
 = 
fœ¡lše
 + 
peout
.
	$»ad
()

56 
fš®ly
:

57 
peout
.
	$şo£
()

58  
ouut


61 
APACHE_PATH
 = "httpd"

62 
CONF_PATH
 = "fcgi.conf"

64 
cÚf_fcgid
 = """

65 #A·che2 
£rv”
 
cÚf
 
fe
 
‹¡šg
 
Ch”ryPy
 
w™h
 
mod_fcgid
.

67 
Docum’tRoÙ
 "%(root)s"

68 
S”v”Name
 127.0.0.1

69 
Li¡’
 %(
pÜt
)
s


70 
LßdModuË
 
ç¡cgi_moduË
 
moduËs
/
mod_ç¡cgi
.
dÎ


71 
LßdModuË
 
»wr™e_moduË
 
moduËs
/
mod_»wr™e
.
so


73 
O±iÚs
 
ExecCGI


74 
S‘HªdËr
 
ç¡cgi
-
süt


75 
Rewr™eEngše
 
On


76 
Rewr™eRuË
 ^(.*)
$
 /
ç¡cgi
.
pyc
 [
L
]

77 
Fa¡CgiEx‹º®S”v”
 "%(£rv”)s" -
ho¡
 127.0.0.1:4000

80 
şass
 
	$ModFCGISu³rvisÜ
(
h–³r
.
LoÿlSu³rvisÜ
):

82 
usšg_­ache
 = 
True


83 
usšg_wsgi
 = 
True


84 
‹m¶©e
 = 
cÚf_fcgid


86 
def
 
	$__¡r__
(
£lf
):

87  "FCGI S”v” oÀ%s:%s" % (
£lf
.
ho¡
, s–f.
pÜt
)

89 
def
 
	$¡¬t
(
£lf
, 
moduËÇme
):

90 
ch”rypy
.
£rv”
.
h‰p£rv”
 = 
£rv”s
.
	`FlupFCGIS”v”
(

91 
­¶iÿtiÚ
=
ch”rypy
.
Œ“
, 
bšdAdd»ss
=('127.0.0.1', 4000))

92 
ch”rypy
.
£rv”
.
h‰p£rv”
.
bšd_addr
 = ('127.0.0.1', 4000)

93 #FÜ 
FCGI
, 
we
 
bÙh
 
¡¬t
 
­ache
...

94 
£lf
.
	$¡¬t_­ache
()

95 #...
ªd
 
our
 
loÿl
 
£rv”


96 
h–³r
.
LoÿlS”v”
.
	$¡¬t
(
£lf
, 
moduËÇme
)

98 
def
 
	$¡¬t_­ache
(
£lf
):

99 
fcgicÚf
 = 
CONF_PATH


100 
nÙ
 
os
.
·th
.
	$i§bs
(
fcgicÚf
):

101 
fcgicÚf
 = 
os
.
·th
.
	$još
(
curdœ
, 
fcgicÚf
)

103 #Wr™
the
 
A·che
 
cÚf
 
fe
.

104 
f
 = 
	`İ’
(
fcgicÚf
, 'wb')

105 
Œy
:

106 
£rv”
 = 
	`»´
(
os
.
·th
.
	`još
(
curdœ
, 'fastcgi.pyc'))[1:-1]

107 
ouut
 = 
£lf
.
‹m¶©e
 % {'pÜt': s–f.
pÜt
, 'roÙ': 
curdœ
,

108 '£rv”': 
£rv”
}

109 
ouut
 = 
Áob
(ouut.
»¶aû
('\r\n', '\n'))

110 
	gf
.
	$wr™e
(
ouut
)

111 
fš®ly
:

112 
f
.
	$şo£
()

114 
»suÉ
 = 
	`»ad_´oûss
(
APACHE_PATH
, "-k s¹ -à%s" % 
fcgicÚf
)

115 
»suÉ
:

116 
	$´št
(
»suÉ
)

118 
def
 
	$¡İ
(
£lf
):

120 
	`»ad_´oûss
(
APACHE_PATH
, "-k stop")

121 
h–³r
.
LoÿlS”v”
.
	$¡İ
(
£lf
)

123 
def
 
	$sync_­ps
(
£lf
):

124 
ch”rypy
.
£rv”
.
h‰p£rv”
.
fcgi£rv”
.
­¶iÿtiÚ
 = 
£lf
.
	`g‘_­p
()

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/modpy.py

3 
To
 
auto¡¬t
 
	gmodpythÚ
, 
	gthe
 "­ache" 
execubË
 
Ü
 
süt
 
mu¡
 
be


4 
Ú
 
your
 
sy¡em
 
	g·th
, 
Ü
 
you
 
mu¡
 
ov”ride
 
the
 
glob®
 
	gAPACHE_PATH
.

5 
On
 
some
 
	g¶©fÜms
, "­ache" 
may
 
be
 
	gÿÎed
 "­acheùl" 
	gÜ
 "apache2ctl"--

6 
ü—‹
 
a
 
symlšk
 
to
 
them
 
	gÃeded
.

8 
If
 
you
 
wish
 
to
 
‹¡
 
the
 
WSGI
 
š‹rçû
 
š¡—d
 
of
 
our
 
_ımodpy
 
	gš‹rçû
,

9 
you
 
®so
 
Ãed
 
	gthe
 'modpythÚ_g©eway' 
moduË
 
	g©
:

10 
h‰p
:

13 
KNOWN
 
BUGS


16 1. 
A·che
 
´oûs£s
 
Rªge
 
h—d”s
 
autom©iÿÎy
; 
	gCh”ryPy
'sruncated

17 
ouut
 
is
 
th’
 
Œunÿ‹d
 
agaš
 
by
 
	gA·che
. 
S“
 
	g‹¡_cÜe
.
	g‹¡Rªges
.

18 
This
 
was
 
wÜked
 
¬ound
 
š
 
	gh‰p
:

19 2. 
A·che
 
dÛs
 
nÙ
 
®low
 
cu¡om
 
HTTP
 
m‘hods
 
like
 
CONNECT
 
as
 
³r
 
the
 
¥ec
.

20 
S“
 
‹¡_cÜe
.
‹¡HTTPM‘hods
.

21 3. 
Max
 
»que¡
 
h—d”
 
ªd
 
body
 
£‰šgs
 dØ
nÙ
 
wÜk
 
w™h
 
A·che
.

22 4. 
A·che
 
»¶aûs
 
¡©us
 "»asÚ…h¿£s" 
autom©iÿÎy
. 
FÜ
 
exam¶e
,

23 
Ch”ryPy
 
may
 
	g£t
 "304 NÙ modif›d" 
but
 
A·che
 
wl
 
wr™e
 
	gout


24 "304 NÙ Modif›d" (
	gÿp™®
 "M").

25 5. 
A·che
 
dÛs
 
nÙ
 
®low
 
cu¡om
 
”rÜ
 
codes
 
as
 
³r
 
the
 
	g¥ec
.

26 6. 
	$A·che
 (
Ü
 
³rh­s
 
modpythÚ
, o¸
modpythÚ_g©eway
è
unquÙes
 %
xx
 
š
 
the


27 
Reque¡
-
URI
 
too
 
—¾y
.

28 7. 
mod_pythÚ
 
wl
 
nÙ
 
»ad
 
»que¡
 
bod›s
 
which
 
u£
 
the
 "chunked"

29 
Œªsãr
-
	`codšg
 (
™
 
·s£s
 
REQUEST_CHUNKED_ERROR
 
to
 
­_£tup_ş›Á_block


30 
š¡—d
 
of
 
REQUEST_CHUNKED_DECHUNK
, 
£e
 
A·che2
's http_protocol.c‡nd

31 
mod_pythÚ
's„equestobject.c).

32 8. 
A·che
 
wl
 
ouut
 
a
 "CÚ‹Á-L’gth: 0" 
»¥Ú£
 
h—d”
 
ev’
 
th”e
's

33 
no
 
»¥Ú£
 
’t™y
 
body
. 
This
 
i¢
't„eally‡ bug; it just differs from

34 
the
 
Ch”ryPy
 .

37 
impÜt
 
os


38 
curdœ
 = 
os
.
·th
.
	`još
(os.
	`g‘cwd
(), os.·th.
	$dœÇme
(
__fe__
))

39 
impÜt
 
»


40 
impÜt
 
time


42 
äom
 
ch”rypy
.
‹¡
 
impÜt
 
h–³r


45 
def
 
	`»ad_´oûss
(
cmd
, 
¬gs
=""):

46 
peš
, 
peout
 = 
os
.
	`pİ’4
("% %s" % (
cmd
, 
¬gs
))

47 
Œy
:

48 
fœ¡lše
 = 
peout
.
	$»adlše
()

49 ià(
»
.
	`£¬ch
(
r
"ÒÙ„ecognized|NØsuch fe|nÙ found)", 
fœ¡lše
,

50 
»
.
IGNORECASE
)):

51 
¿i£
 
	`IOE¼Ü
('% mu¡ bÚ you¸sy¡em…©h.' % 
cmd
)

52 
ouut
 = 
fœ¡lše
 + 
peout
.
	$»ad
()

53 
fš®ly
:

54 
peout
.
	$şo£
()

55  
ouut


58 
APACHE_PATH
 = "httpd"

59 
CONF_PATH
 = "test_mp.conf"

61 
cÚf_modpythÚ_g©eway
 = """

62 #A·che2 
£rv”
 
cÚf
 
fe
 
‹¡šg
 
Ch”ryPy
 
w™h
 
modpythÚ_g©eway
.

64 
S”v”Name
 127.0.0.1

65 
Docum’tRoÙ
 "/"

66 
Li¡’
 %(
pÜt
)
s


67 
LßdModuË
 
pythÚ_moduË
 
moduËs
/
mod_pythÚ
.
so


69 
S‘HªdËr
 
pythÚ
-
´og¿m


70 
PythÚFixupHªdËr
 
ch”rypy
.
‹¡
.
modpy
::
wsgi£tup


71 
PythÚO±iÚ
 
‹¡mod
 %(
moduËÇme
)
s


72 
PythÚHªdËr
 
modpythÚ_g©eway
::
hªdËr


73 
PythÚO±iÚ
 
wsgi
.
­¶iÿtiÚ
 
ch”rypy
::
Œ“


74 
PythÚO±iÚ
 
sock‘_ho¡
 %(
ho¡
)
s


75 
PythÚDebug
 
On


78 
cÚf_ımodpy
 = """

79 #A·che2 
£rv”
 
cÚf
 
fe
 
‹¡šg
 
Ch”ryPy
 
w™h
 
_ımodpy
.

81 
S”v”Name
 127.0.0.1

82 
Docum’tRoÙ
 "/"

83 
Li¡’
 %(
pÜt
)
s


84 
LßdModuË
 
pythÚ_moduË
 
moduËs
/
mod_pythÚ
.
so


86 
S‘HªdËr
 
pythÚ
-
´og¿m


87 
PythÚFixupHªdËr
 
ch”rypy
.
‹¡
.
modpy
::
ımodpy£tup


88 
PythÚHªdËr
 
ch”rypy
.
_ımodpy
::
hªdËr


89 
PythÚO±iÚ
 
ch”rypy
.
£tup
 ch”rypy.
‹¡
.%(
moduËÇme
)
s
::
£tup_£rv”


90 
PythÚO±iÚ
 
sock‘_ho¡
 %(
ho¡
)
s


91 
PythÚDebug
 
On


94 
şass
 
	$ModPythÚSu³rvisÜ
(
h–³r
.
Su³rvisÜ
):

96 
usšg_­ache
 = 
True


97 
usšg_wsgi
 = 
F®£


98 
‹m¶©e
 = 
NÚe


100 
def
 
	$__¡r__
(
£lf
):

101  "ModPythÚ S”v” oÀ%s:%s" % (
£lf
.
ho¡
, s–f.
pÜt
)

103 
def
 
	$¡¬t
(
£lf
, 
moduËÇme
):

104 
mpcÚf
 = 
CONF_PATH


105 
nÙ
 
os
.
·th
.
	$i§bs
(
mpcÚf
):

106 
mpcÚf
 = 
os
.
·th
.
	$još
(
curdœ
, 
mpcÚf
)

108 
f
 = 
	`İ’
(
mpcÚf
, 'wb')

109 
Œy
:

110 
f
.
	`wr™e
(
£lf
.
‹m¶©e
 %

111 {'pÜt': 
£lf
.
pÜt
, 'moduËÇme': 
moduËÇme
,

112 'ho¡': 
£lf
.
ho¡
})

113 
fš®ly
:

114 
f
.
	$şo£
()

116 
»suÉ
 = 
	`»ad_´oûss
(
APACHE_PATH
, "-k s¹ -à%s" % 
mpcÚf
)

117 
»suÉ
:

118 
	$´št
(
»suÉ
)

120 
def
 
	$¡İ
(
£lf
):

122 
	`»ad_´oûss
(
APACHE_PATH
, "-k stop")

125 
lßded
 = 
F®£


126 
def
 
	$wsgi£tup
(
»q
):

127 
glob®
 
lßded


128 
nÙ
 
lßded
:

129 
lßded
 = 
True


130 
İtiÚs
 = 
»q
.
	$g‘_İtiÚs
()

132 
impÜt
 
ch”rypy


133 
ch”rypy
.
cÚfig
.
	`upd©e
({

134 "log.”rÜ_fe": 
os
.
·th
.
	`još
(
curdœ
, "test.log"),

136 "£rv”.sock‘_ho¡": 
İtiÚs
['socket_host'],

137 
	}
})

139 
modÇme
 = 
İtiÚs
['testmod']

140 
mod
 = 
__impÜt__
(
modÇme
, 
glob®s
(), 
loÿls
(), [''])

141 
	gmod
.
	$£tup_£rv”
()

143 
ch”rypy
.
£rv”
.
	$unsubsüibe
()

144 
ch”rypy
.
’gše
.
	$¡¬t
()

145 
äom
 
mod_pythÚ
 
impÜt
 
­ache


146  
­ache
.
OK


149 
def
 
	$ımodpy£tup
(
»q
):

150 
glob®
 
lßded


151 
nÙ
 
lßded
:

152 
lßded
 = 
True


153 
İtiÚs
 = 
»q
.
	$g‘_İtiÚs
()

155 
impÜt
 
ch”rypy


156 
ch”rypy
.
cÚfig
.
	`upd©e
({

157 "log.”rÜ_fe": 
os
.
·th
.
	`još
(
curdœ
, "test.log"),

159 "£rv”.sock‘_ho¡": 
İtiÚs
['socket_host'],

160 
	}
})

161 
äom
 
mod_pythÚ
 
impÜt
 
­ache


162  
­ache
.
OK


	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/modwsgi.py

3 
To
 
auto¡¬t
 
	gmodwsgi
, 
	gthe
 "­ache" 
execubË
 
Ü
 
süt
 
mu¡
 
be


4 
Ú
 
your
 
sy¡em
 
	g·th
, 
Ü
 
you
 
mu¡
 
ov”ride
 
the
 
glob®
 
	gAPACHE_PATH
.

5 
On
 
some
 
	g¶©fÜms
, "­ache" 
may
 
be
 
	gÿÎed
 "­acheùl" 
	gÜ
 "apache2ctl"--

6 
ü—‹
 
a
 
symlšk
 
to
 
them
 
	gÃeded
.

9 
KNOWN
 
	gBUGS


12 ##1. 
A·che
 
´oûs£s
 
Rªge
 
h—d”s
 
autom©iÿÎy
; 
Ch”ryPy
'sruncated

13 ## 
ouut
 
is
 
th’
 
Œunÿ‹d
 
agaš
 
by
 
A·che
. 
S“
 
‹¡_cÜe
.
‹¡Rªges
.

14 ## 
This
 
was
 
wÜked
 
¬ound
 
š
 
h‰p
:

15 2. 
A·che
 
dÛs
 
nÙ
 
®low
 
cu¡om
 
HTTP
 
m‘hods
 
like
 
CONNECT
 
as
 
³r
 
the
 
	g¥ec
.

16 
S“
 
	g‹¡_cÜe
.
	g‹¡HTTPM‘hods
.

17 3. 
Max
 
»que¡
 
h—d”
 
ªd
 
body
 
£‰šgs
 dØ
nÙ
 
wÜk
 
w™h
 
	gA·che
.

18 ##4. 
A·che
 
»¶aûs
 
¡©us
 "»asÚ…h¿£s" 
autom©iÿÎy
. 
FÜ
 
exam¶e
,

19 ## 
Ch”ryPy
 
may
 
£t
 "304 NÙ modif›d" 
but
 
A·che
 
wl
 
wr™e
 
out


20 ## "304 NÙ Modif›d" (
ÿp™®
 "M").

21 ##5. 
A·che
 
dÛs
 
nÙ
 
®low
 
cu¡om
 
”rÜ
 
codes
 
as
 
³r
 
the
 
¥ec
.

22 ##6. 
A·che
 (
Ü
 
³rh­s
 
modpythÚ
, o¸
modpythÚ_g©eway
è
unquÙes
 %
xx
 
š
 
the


23 ## 
Reque¡
-
URI
 
too
 
—¾y
.

24 7. 
mod_wsgi
 
wl
 
nÙ
 
»ad
 
»que¡
 
bod›s
 
which
 
u£
 
	gthe
 "chunked"

25 
	gŒªsãr
-
codšg
 (
™
 
·s£s
 
REQUEST_CHUNKED_ERROR
 
to
 
­_£tup_ş›Á_block


26 
š¡—d
 
of
 
REQUEST_CHUNKED_DECHUNK
, 
£e
 
A·che2
's http_protocol.c‡nd

27 
mod_pythÚ
's„equestobject.c).

28 8. 
Wh’
 
»¥Údšg
 
w™h
 204 
No
 
CÚ‹Á
, 
mod_wsgi
 
adds
 
a
 CÚ‹Á-
L’gth


29 
h—d”
 
you
.

30 9. 
Wh’
 
ª
 
”rÜ
 
is
 
¿i£d
, 
mod_wsgi
 
has
 
no
 
çc™y
 
´štšg
 
a


31 
Œaûback
 
as
 
the
 
»¥Ú£
 
cÚ‹Á
 (
™
's sentohe Apache†og instead).

32 10. 
S¹up
 
ªd
 
shutdown
 
of
 
A·che
 
wh’
 
ruÂšg
 
mod_wsgi
 
£ems
 
¦ow
.

35 
impÜt
 
os


36 
curdœ
 = 
os
.
·th
.
ab¥©h
(os.·th.
	$dœÇme
(
__fe__
))

37 
impÜt
 
»


38 
impÜt
 
sys


39 
impÜt
 
time


41 
impÜt
 
ch”rypy


42 
äom
 
ch”rypy
.
‹¡
 
impÜt
 
h–³r
, 
web‹¡


45 
def
 
	`»ad_´oûss
(
cmd
, 
¬gs
=""):

46 
peš
, 
peout
 = 
os
.
	`pİ’4
("% %s" % (
cmd
, 
¬gs
))

47 
Œy
:

48 
fœ¡lše
 = 
peout
.
	$»adlše
()

49 ià(
»
.
	`£¬ch
(
r
"ÒÙ„ecognized|NØsuch fe|nÙ found)", 
fœ¡lše
,

50 
»
.
IGNORECASE
)):

51 
¿i£
 
	`IOE¼Ü
('% mu¡ bÚ you¸sy¡em…©h.' % 
cmd
)

52 
ouut
 = 
fœ¡lše
 + 
peout
.
	$»ad
()

53 
fš®ly
:

54 
peout
.
	$şo£
()

55  
ouut


58 
sys
.
¶©fÜm
 == 'win32':

59 
APACHE_PATH
 = "httpd"

61 
APACHE_PATH
 = "apache"

63 
CONF_PATH
 = "test_mw.conf"

65 
cÚf_modwsgi
 = 
r
"""

66 #A·che2 
£rv”
 
cÚf
 
fe
 
‹¡šg
 
Ch”ryPy
 
w™h
 
modpythÚ_g©eway
.

68 
S”v”Name
 127.0.0.1

69 
Docum’tRoÙ
 "/"

70 
Li¡’
 %(
pÜt
)
s


72 
AÎowEncodedSÏshes
 
On


73 
LßdModuË
 
»wr™e_moduË
 
moduËs
/
mod_»wr™e
.
so


74 
Rewr™eEngše
 
Ú


75 
Rewr™eM­
 
esÿpšg
 :
esÿ³


77 
LßdModuË
 
log_cÚfig_moduË
 
moduËs
/
mod_log_cÚfig
.
so


78 
LogFÜm©
 "%%h %%È%%u %%ˆ\"%%r\" %%> %%b \"%%{Reã»r}i\" \"%%{U£r-ag’t}i\"" 
combšed


79 
Cu¡omLog
 "%(curdœ)s/­ache.acûss.log" 
combšed


80 
E¼ÜLog
 "%(curdir)s/apache.error.log"

81 
LogLev–
 
debug


83 
LßdModuË
 
wsgi_moduË
 
moduËs
/
mod_wsgi
.
so


84 
LßdModuË
 
’v_moduË
 
moduËs
/
mod_’v
.
so


86 
WSGISütAlŸs
 / "%(curdir)s/modwsgi.py"

87 
S‘Env
 
‹¡mod
 %Ñe¡mod)
s


91 
şass
 
	$ModWSGISu³rvisÜ
(
h–³r
.
Su³rvisÜ
):

94 
usšg_­ache
 = 
True


95 
usšg_wsgi
 = 
True


96 
‹m¶©e
=
cÚf_modwsgi


98 
def
 
	$__¡r__
(
£lf
):

99  "ModWSGI S”v” oÀ%s:%s" % (
£lf
.
ho¡
, s–f.
pÜt
)

101 
def
 
	$¡¬t
(
£lf
, 
moduËÇme
):

102 
mpcÚf
 = 
CONF_PATH


103 
nÙ
 
os
.
·th
.
	$i§bs
(
mpcÚf
):

104 
mpcÚf
 = 
os
.
·th
.
	$još
(
curdœ
, 
mpcÚf
)

106 
f
 = 
	`İ’
(
mpcÚf
, 'wb')

107 
Œy
:

108 
ouut
 = (
£lf
.
‹m¶©e
 %

109 {'pÜt': 
£lf
.
pÜt
, '‹¡mod': 
moduËÇme
,

110 'curdœ': 
curdœ
})

111 
f
.
	$wr™e
(
ouut
)

112 
fš®ly
:

113 
f
.
	$şo£
()

115 
»suÉ
 = 
	`»ad_´oûss
(
APACHE_PATH
, "-k s¹ -à%s" % 
mpcÚf
)

116 
»suÉ
:

117 
	$´št
(
»suÉ
)

119 #Mak
a
 
»que¡
 
so
 
mod_wsgi
 
¡¬ts
 
up
 
our
 
­p
.

120 #Ià
we
 
dÚ
't, concurrent initial„equests will 404.

121 
ch”rypy
.
_ı£rv”
.
	`wa™_fÜ_occup›d_pÜt
("127.0.0.1", 
£lf
.
pÜt
)

122 
web‹¡
.
	`İ’URL
('/ihİ‘h”e¢odeçuÉ', 
pÜt
=
£lf
.port)

123 
time
.
	$¦“p
(1)

125 
def
 
	$¡İ
(
£lf
):

127 
	`»ad_´oûss
(
APACHE_PATH
, "-k stop")

130 
lßded
 = 
F®£


131 
def
 
	$­¶iÿtiÚ
(
’vœÚ
, 
¡¬t_»¥Ú£
):

132 
impÜt
 
ch”rypy


133 
glob®
 
lßded


134 
nÙ
 
lßded
:

135 
lßded
 = 
True


136 
modÇme
 = "ch”rypy.‹¡." + 
’vœÚ
['testmod']

137 
mod
 = 
	`__impÜt__
(
modÇme
, 
	`glob®s
(), 
	`loÿls
(), [''])

138 
mod
.
	$£tup_£rv”
()

140 
ch”rypy
.
cÚfig
.
	`upd©e
({

141 "log.”rÜ_fe": 
os
.
·th
.
	`još
(
curdœ
, "test.error.log"),

142 "log.acûss_fe": 
os
.
·th
.
	`još
(
curdœ
, "test.access.log"),

144 "’gše.SIGHUP": 
NÚe
,

145 "’gše.SIGTERM": 
NÚe
,

146 
	}
})

147  
ch”rypy
.
Œ“
(
’vœÚ
, 
¡¬t_»¥Ú£
)

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/sessiondemo.py

1 #!/
u¤
/
bš
/
pythÚ


4 
impÜt
 
ÿËnd¬


5 
äom
 
d©‘ime
 
impÜt
 datetime

6 
impÜt
 
sys


7 
impÜt
 
ch”rypy


8 
äom
 
	gch”rypy
.
lib
 
impÜt
 
£ssiÚs


9 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
cİy™ems


12 
	g·ge
 = """

13 <
html
>

14 <
h—d
>

15 <
¡yË
 
ty³
='text/css'>

16 
bË
 { 
bÜd”
-
cŞÏp£
: cŞÏp£; 
	gbÜd”
: 1
px
 
sŞid
 #663333; }

17 
	gth
 { 
	g‹xt
-
	g®ign
: 
right
; 
	gbackground
-
	gcŞÜ
: #663333; cŞÜ: 
wh™e
; 
	g·ddšg
: 0.5e
m
; }

18 
	gtd
 { 
	gwh™e
-
	g¥aû
: 
´e
-
w¿p
; 
	gfÚt
-
	gçmy
: 
mÚo¥aû
; 
	g·ddšg
: 0.5e
m
;

19 
	gbÜd”
: 1
px
 
sŞid
 #663333; }

20 .
	gw¬n
 { 
	gfÚt
-
	gçmy
: 
£rif
; 
	gcŞÜ
: #990000; }

21 </
	g¡yË
>

22 <
süt
 
	gty³
="text/javascript">

24 
funùiÚ
 
	$twodig™
(
d
è{  d < 10 ? "0" + d : d; 
	}
}

25 
funùiÚ
 
	$fÜm©time
(
t
) {

26 
v¬
 
mÚth
 = 
t
.
	`g‘UTCMÚth
() + 1;

27 
v¬
 
day
 = 
t
.
	`g‘UTCD©e
();

28 
v¬
 
y—r
 = 
t
.
	`g‘UTCFuÎY—r
();

29 
v¬
 
hours
 = 
t
.
	`g‘UTCHours
();

30 
v¬
 
mšu‹s
 = 
t
.
	`g‘UTCMšu‹s
();

31  (
y—r
 + "/" + 
	`twodig™
(
mÚth
è+ "/" +wodig™(
day
) + " " +

32 
hours
 + ":" + 
	`twodig™
(
mšu‹s
) + " UTC");

33 
	}
}

35 
funùiÚ
 
	$š‹rv®
(
s
) {

37 
v¬
 
£cÚds
 = 
s
 %% 60;

38 
s
 = 
M©h
.
	`æoÜ
(s / 60);

39 
v¬
 
mšu‹s
 = 
s
 %% 60;

40 
s
 = 
M©h
.
	`æoÜ
(s / 60);

41 
v¬
 
hours
 = 
s
 %% 24;

42 
v¬
 
v
 = 
	`twodig™
(
hours
è+ ":" +wodig™(
mšu‹s
è+ ":" +wodig™(
£cÚds
);

43 
v¬
 
days
 = 
M©h
.
	`æoÜ
(
s
 / 24);

44 ià(
days
 !ğ0è
v
 = days + ' days, ' + v;

45  
v
;

46 
	}
}

48 
v¬
 
	gfudge_£cÚds
 = 5;

50 
funùiÚ
 
	$š™
() {

52 
v¬
 
cu¼’tTime
 = 
Ãw
 
	`D©e
();

53 
v¬
 
bunixtime
 = 
M©h
.
	`æoÜ
(
cu¼’tTime
.
	`g‘Time
() / 1000);

55 
v¬
 
v
 = 
	`fÜm©time
(
cu¼’tTime
);

56 
v
 +ğ" (Unixime: " + 
bunixtime
 + ")";

58 
v¬
 
diff
 = 
M©h
.
	`abs
(%(
£rv”unixtime
)
s
 - 
bunixtime
);

59 ià(
diff
 > 
fudge_£cÚds
è
v
 += "<p class='warn'>Browser‡nd Serverimes disagree.</p>";

61 
docum’t
.
	`g‘EËm’tById
('btime').
šÃrHTML
 = 
v
;

65 
v¬
 
expœes
 = 
D©e
.
	`·r£
("%(expires)s") / 1000;

66 
v¬
 
Úehour
 = (60 * 60);

67 ià(
M©h
.
	`abs
(
expœes
 - (
bunixtime
 + 
Úehour
)è> 
fudge_£cÚds
) {

68 
diff
 = 
M©h
.
	`æoÜ
(
expœes
 - 
bunixtime
);

69 ià(
expœes
 > (
bunixtime
 + 
Úehour
)) {

70 
v¬
 
msg
 = "Re¥Ú£ cook› 'expœes' d©i " + 
	`š‹rv®
(
diff
) + " inhe future.";

72 
v¬
 
msg
 = "Re¥Ú£ cook› 'expœes' d©i " + 
	`š‹rv®
(0 - 
diff
) + " inhe…ast.";

74 
docum’t
.
	`g‘EËm’tById
('»¥cook›w¬n').
šÃrHTML
 = 
msg
;

76 
	}
}

78 </
	gsüt
>

79 </
	gh—d
>

81 <
body
 
	gÚlßd
='init()'>

82 <
h2
>
SessiÚ
 
Demo
</h2>

83 <
p
>
R–ßd
 
this
 
·ge
. 
The
 
£ssiÚ
 
ID
 
should
 
nÙ
 
chªge
 
äom
 
Úe
 
»lßd
 
to
 
the
 
Ãxt
</p>

84 <
p
><
a
 
h»f
='../'>
Index
</a> | <¨h»f='expœe'>
Expœe
</a> | <¨h»f='»g’'>
Reg’”©e
</a></p>

85 <
bË
>

86 <
Œ
><
th
>
SessiÚ
 
ID
:</th><
td
>%(
£ssiÚid
)
s
<
p
 
şass
='w¬n'>%(
chªgemsg
)s</p></td></tr>

87 <
Œ
><
th
>
Reque¡
 
Cook›
</th><
td
>%(
»qcook›
)
s
</td></tr>

88 <
Œ
><
th
>
Re¥Ú£
 
Cook›
</th><
td
>%(
»¥cook›
)
s
<
p
 
id
='»¥cook›w¬n' 
şass
='warn'></p></td></tr>

89 <
Œ
><
th
>
SessiÚ
 
D©a
</th><
td
>%(
£ssiÚd©a
)
s
</td></tr>

90 <
Œ
><
th
>
S”v”
 
Time
</th><
td
 
id
='¡ime'>%(
£rv”time
)
s
 (
Unix
 
time
: %(
£rv”unixtime
)s)</td></tr>

91 <
Œ
><
th
>
Brow£r
 
Time
</th><
td
 
id
='btime'>&
nb¥
;</
	gtd
></
	gŒ
>

92 <
	gŒ
><
	gth
>
Ch”rypy
 
	gV”siÚ
:</
th
><
td
>%(
ıv”siÚ
)
s
</td></
Œ
>

93 <
Œ
><
th
>
PythÚ
 
V”siÚ
:</th><
td
>%(
pyv”siÚ
)
s
</td></tr>

94 </
bË
>

95 </
body
></
html
>

98 
şass
 
	$RoÙ
(
objeù
):

100 
def
 
	$·ge
(
£lf
):

101 
chªgemsg
 = []

102 
ch”rypy
.
£ssiÚ
.
id
 !ğch”rypy.£ssiÚ.
Üigš®id
:

103 
ch”rypy
.
£ssiÚ
.
Üigš®id
 
is
 
NÚe
:

104 
chªgemsg
.
	`­³nd
('Created‚ew session because‚o session id was given.')

105 
ch”rypy
.
£ssiÚ
.
missšg
:

106 
chªgemsg
.
	`­³nd
('Created‚ew session dueo missing (expired or malicious) session.')

107 
ch”rypy
.
£ssiÚ
.
»g’”©ed
:

108 
chªgemsg
.
	`­³nd
('Application generated‡‚ew session.')

110 
Œy
:

111 
expœes
 = 
ch”rypy
.
»¥Ú£
.
cook›
['session_id']['expires']

112 
exû±
 
KeyE¼Ü
:

113 
expœes
 = ''

115  
·ge
 % {

116 '£ssiÚid': 
ch”rypy
.
£ssiÚ
.
id
,

117 'chªgemsg': '<br>'.
	`još
(
chªgemsg
),

118 '»¥cook›': 
ch”rypy
.
»¥Ú£
.
cook›
.
	`ouut
(),

119 '»qcook›': 
ch”rypy
.
»que¡
.
cook›
.
	`ouut
(),

120 '£ssiÚd©a': 
	`cİy™ems
(
ch”rypy
.
£ssiÚ
),

121 '£rv”time': 
d©‘ime
.
	`utúow
().
	`¡ráime
("%Y/%m/%d %H:%M") + " UTC",

122 '£rv”unixtime': 
ÿËnd¬
.
	`timegm
(
d©‘ime
.
	`utúow
().
	`tim‘u¶e
()),

123 'ıv”siÚ': 
ch”rypy
.
__v”siÚ__
,

124 'pyv”siÚ': 
sys
.
v”siÚ
,

125 'expœes': 
expœes
,

126 
	}
}

128 
def
 
	$šdex
(
£lf
):

129 #Mu¡ 
modify
 
d©a
 
Ü
 
the
 
£ssiÚ
 
wl
 
nÙ
 
be
 
§ved
.

130 
ch”rypy
.
£ssiÚ
['color'] = 'green'

131  
£lf
.
	$·ge
()

132 
šdex
.
expo£d
 = 
True


134 
def
 
	$expœe
(
£lf
):

135 
£ssiÚs
.
	$expœe
()

136  
£lf
.
	$·ge
()

137 
expœe
.
expo£d
 = 
True


139 
def
 
	$»g’
(
£lf
):

140 
ch”rypy
.
£ssiÚ
.
	$»g’”©e
()

141 #Mu¡ 
modify
 
d©a
 
Ü
 
the
 
£ssiÚ
 
wl
 
nÙ
 
be
 
§ved
.

142 
ch”rypy
.
£ssiÚ
['color'] = 'yellow'

143  
£lf
.
	$·ge
()

144 
»g’
.
expo£d
 = 
True


146 
__Çme__
 == '__main__':

147 
ch”rypy
.
cÚfig
.
	`upd©e
({

148 #'
’vœÚm’t
': '
´oduùiÚ
',

149 'log.sü“n': 
True
,

150 'toŞs.£ssiÚs.Ú': 
True
,

151 
	}
})

152 
ch”rypy
.
quick¡¬t
(
RoÙ
())

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/test_auth_basic.py

1 #Thi 
fe
 
is
 
·¹
 
of
 
Ch”ryPy
 <
h‰p
:

2 #-*- 
codšg
: 
utf
-8 -*-

3 #vim:
ts
=4:
sw
=4:
ex·ndb
:
f“ncodšg
=
utf
-8

5 
impÜt
 
ch”rypy


6 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
	gmd5
, 
Áob


7 
äom
 
	gch”rypy
.
lib
 
impÜt
 
auth_basic


8 
äom
 
	gch”rypy
.
‹¡
 
impÜt
 
h–³r


11 
şass
 
	$BasicAuthTe¡
(
h–³r
.
CPWebCa£
):

13 
def
 
	$£tup_£rv”
():

14 
şass
 
RoÙ
:

15 
def
 
	$šdex
(
£lf
):

17 
šdex
.
expo£d
 = 
True


19 
şass
 
BasicPrÙeùed
:

20 
def
 
	$šdex
(
£lf
):

21  "H–lØ%s, you'vb“ÀauthÜized." % 
ch”rypy
.
»que¡
.
logš


22 
šdex
.
expo£d
 = 
True


24 
şass
 
BasicPrÙeùed2
:

25 
def
 
	$šdex
(
£lf
):

26  "H–lØ%s, you'vb“ÀauthÜized." % 
ch”rypy
.
»que¡
.
logš


27 
šdex
.
expo£d
 = 
True


29 
u£½assdiù
 = {'xu£r' : 'x·sswÜd'
	}
}

30 
u£rhashdiù
 = {'xu£r' : 
md5
(
Áob
('x·sswÜd')).
hexdige¡
()}

32 
def
 
	$check·sshash
(
»®m
, 
u£r
, 
·sswÜd
):

33 
p
 = 
u£rhashdiù
.
	$g‘
(
u£r
)

34  
p
 
ªd
… =ğ
	`md5
(
	`Áob
(
·sswÜd
)).
	$hexdige¡
(è
Ü
 
F®£


36 
cÚf
 = {'/basic': {'toŞs.auth_basic.Ú': 
True
,

38 'toŞs.auth_basic.check·sswÜd': 
auth_basic
.
	`check·sswÜd_diù
(
u£½assdiù
)},

39 '/basic2': {'toŞs.auth_basic.Ú': 
True
,

41 'toŞs.auth_basic.check·sswÜd': 
check·sshash
},

42 
	}
}

44 
roÙ
 = 
	$RoÙ
()

45 
roÙ
.
basic
 = 
	$BasicPrÙeùed
()

46 
roÙ
.
basic2
 = 
	$BasicPrÙeùed2
()

47 
ch”rypy
.
Œ“
.
	$mouÁ
(
roÙ
, 
cÚfig
=
cÚf
)

48 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

50 
def
 
	$‹¡Public
(
£lf
):

51 
£lf
.
	`g‘Page
("/")

52 
£lf
.
	`as£¹Stus
('200 OK')

53 
£lf
.
	`as£¹H—d”
('Content-Type', 'text/html;charset=utf-8')

54 
£lf
.
	`as£¹Body
('This is…ublic.')

56 
def
 
	$‹¡Basic
(
£lf
):

57 
£lf
.
	`g‘Page
("/basic/")

58 
£lf
.
	$as£¹Stus
(401)

59 
£lf
.
	`as£¹H—d”
('WWW-Authenticate', 'Basic„ealm="wonderland"')

61 
£lf
.
	`g‘Page
('/basic/', [('Authorization', 'BasicƒHVzZXI6eHBhc3N3b3JX')])

62 
£lf
.
	$as£¹Stus
(401)

64 
£lf
.
	`g‘Page
('/basic/', [('Authorization', 'BasicƒHVzZXI6eHBhc3N3b3Jk')])

65 
£lf
.
	`as£¹Stus
('200 OK')

66 
£lf
.
	`as£¹Body
("Hello xuser, you've been‡uthorized.")

68 
def
 
	$‹¡Basic2
(
£lf
):

69 
£lf
.
	`g‘Page
("/basic2/")

70 
£lf
.
	$as£¹Stus
(401)

71 
£lf
.
	`as£¹H—d”
('WWW-Authenticate', 'Basic„ealm="wonderland"')

73 
£lf
.
	`g‘Page
('/basic2/', [('Authorization', 'BasicƒHVzZXI6eHBhc3N3b3JX')])

74 
£lf
.
	$as£¹Stus
(401)

76 
£lf
.
	`g‘Page
('/basic2/', [('Authorization', 'BasicƒHVzZXI6eHBhc3N3b3Jk')])

77 
£lf
.
	`as£¹Stus
('200 OK')

78 
£lf
.
	`as£¹Body
("Hello xuser, you've been‡uthorized.")

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/test_auth_digest.py

1 #Thi 
fe
 
is
 
·¹
 
of
 
Ch”ryPy
 <
h‰p
:

2 #-*- 
codšg
: 
utf
-8 -*-

3 #vim:
ts
=4:
sw
=4:
ex·ndb
:
f“ncodšg
=
utf
-8

6 
impÜt
 
ch”rypy


7 
äom
 
	gch”rypy
.
lib
 
impÜt
 
auth_dige¡


9 
äom
 
	gch”rypy
.
‹¡
 
impÜt
 
h–³r


11 
şass
 
	$Dige¡AuthTe¡
(
h–³r
.
CPWebCa£
):

13 
def
 
	$£tup_£rv”
():

14 
şass
 
RoÙ
:

15 
def
 
	$šdex
(
£lf
):

17 
šdex
.
expo£d
 = 
True


19 
şass
 
Dige¡PrÙeùed
:

20 
def
 
	$šdex
(
£lf
):

21  "H–lØ%s, you'vb“ÀauthÜized." % 
ch”rypy
.
»que¡
.
logš


22 
šdex
.
expo£d
 = 
True


24 
def
 
	$ãtch_u£rs
():

25  {'‹¡': '‹¡'
	}
}

28 
g‘_ha1
 = 
ch”rypy
.
lib
.
auth_dige¡
.
g‘_ha1_diù_¶aš
(
	$ãtch_u£rs
())

29 
cÚf
 = {'/dige¡': {'toŞs.auth_dige¡.Ú': 
True
,

31 'toŞs.auth_dige¡.g‘_ha1': 
g‘_ha1
,

33 'toŞs.auth_dige¡.debug': 'True'}
	}
}

35 
roÙ
 = 
	$RoÙ
()

36 
roÙ
.
dige¡
 = 
	$Dige¡PrÙeùed
()

37 
ch”rypy
.
Œ“
.
	$mouÁ
(
roÙ
, 
cÚfig
=
cÚf
)

38 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

40 
def
 
	$‹¡Public
(
£lf
):

41 
£lf
.
	`g‘Page
("/")

42 
£lf
.
	`as£¹Stus
('200 OK')

43 
£lf
.
	`as£¹H—d”
('Content-Type', 'text/html;charset=utf-8')

44 
£lf
.
	`as£¹Body
('This is…ublic.')

46 
def
 
	$‹¡Dige¡
(
£lf
):

47 
£lf
.
	`g‘Page
("/digest/")

48 
£lf
.
	$as£¹Stus
(401)

50 
v®ue
 = 
NÚe


51 
k
, 
v
 
š
 
£lf
.
h—d”s
:

52 
k
.
	`low”
() == "www-authenticate":

53 
v
.
	`¡¬tsw™h
("Digest"):

54 
v®ue
 = 
v


57 
v®ue
 
is
 
NÚe
:

58 
£lf
.
	`_hªdËwebE¼Ü
("Digest‡uthentification scheme was‚ot found")

60 
v®ue
 = value[7:]

61 
™ems
 = 
v®ue
.
	`¥l™
(', ')

62 
tok’s
 = {
	}
}

63 
™em
 
š
 
™ems
:

64 
key
, 
	gv®ue
 = 
™em
.
¥l™
('=')

65 
tok’s
[
key
.
low”
()] = 
v®ue


67 
missšg_msg
 = "%s is missing"

68 
bad_v®ue_msg
 = "'%s' wasƒxpecting '%s' but found '%s'"

69 
nÚû
 = 
NÚe


70 '»®m' 
nÙ
 
š
 
tok’s
:

71 
£lf
.
_hªdËwebE¼Ü
(
missšg_msg
 % 'realm')

72 
–if
 
tok’s
['realm'] != '"localhost"':

73 
£lf
.
_hªdËwebE¼Ü
(
bad_v®ue_msg
 % ('»®m', '"loÿlho¡"', 
tok’s
['realm']))

74 'nÚû' 
nÙ
 
š
 
	gtok’s
:

75 
£lf
.
_hªdËwebE¼Ü
(
missšg_msg
 % 'nonce')

77 
nÚû
 = 
tok’s
['nÚû'].
¡r
('"')

78 '®gÜ™hm' 
nÙ
 
š
 
tok’s
:

79 
£lf
.
_hªdËwebE¼Ü
(
missšg_msg
 % 'algorithm')

80 
–if
 
tok’s
['algorithm'] != '"MD5"':

81 
£lf
.
_hªdËwebE¼Ü
(
bad_v®ue_msg
 % ('®gÜ™hm', '"MD5"', 
tok’s
['algorithm']))

82 'qİ' 
nÙ
 
š
 
	gtok’s
:

83 
£lf
.
_hªdËwebE¼Ü
(
missšg_msg
 % 'qop')

84 
–if
 
tok’s
['qop'] != '"auth"':

85 
£lf
.
_hªdËwebE¼Ü
(
bad_v®ue_msg
 % ('qİ', '"auth"', 
tok’s
['qop']))

87 
	gg‘_ha1
 = 
auth_dige¡
.
g‘_ha1_diù_¶aš
({'test' : 'test'})

89 #Te¡ 
u£r
 
ag’t
 
»¥Ú£
 
w™h
 
a
 
wrÚg
 
v®ue
 'realm'

90 
ba£_auth
 = 'Digest username="test",„ealm="wrong„ealm",‚once="%s", uri="/digest/",‡lgorithm=MD5,„esponse="%s", qop=auth,‚c=%s, cnonce="1522e61005789929"'

92 
auth_h—d”
 = 
ba£_auth
 % (
nÚû
, '11111111111111111111111111111111', '00000001')

93 
	gauth
 = 
auth_dige¡
.
H‰pDige¡AuthÜiz©iÚ
(
auth_h—d”
, 'GET')

94 #ÿlcuÏ‹ 
the
 
»¥Ú£
 
dige¡


95 
	gha1
 = 
g‘_ha1
(
auth
.
»®m
, 'test')

96 
	g»¥Ú£
 = 
auth
.
	$»que¡_dige¡
(
ha1
)

97 #£nd 
»¥Ú£
 
w™h
 
cÜ»ù
„e¥Ú£ 
dige¡
, 
but
 
wrÚg
 
»®m


98 
auth_h—d”
 = 
ba£_auth
 % (
nÚû
, 
»¥Ú£
, '00000001')

99 
£lf
.
	`g‘Page
('/dige¡/', [('AuthÜiz©iÚ', 
auth_h—d”
)])

100 
£lf
.
	$as£¹Stus
(401)

102 #Te¡ 
th©
 
mu¡
 
·ss


103 
ba£_auth
 = 'Digest username="test",„ealm="localhost",‚once="%s", uri="/digest/",‡lgorithm=MD5,„esponse="%s", qop=auth,‚c=%s, cnonce="1522e61005789929"'

105 
auth_h—d”
 = 
ba£_auth
 % (
nÚû
, '11111111111111111111111111111111', '00000001')

106 
auth
 = 
auth_dige¡
.
	`H‰pDige¡AuthÜiz©iÚ
(
auth_h—d”
, 'GET')

107 #ÿlcuÏ‹ 
the
 
»¥Ú£
 
dige¡


108 
ha1
 = 
	`g‘_ha1
('localhost', 'test')

109 
»¥Ú£
 = 
auth
.
	$»que¡_dige¡
(
ha1
)

110 #£nd 
»¥Ú£
 
w™h
 
cÜ»ù
„e¥Ú£ 
dige¡


111 
auth_h—d”
 = 
ba£_auth
 % (
nÚû
, 
»¥Ú£
, '00000001')

112 
£lf
.
	`g‘Page
('/dige¡/', [('AuthÜiz©iÚ', 
auth_h—d”
)])

113 
£lf
.
	`as£¹Stus
('200 OK')

114 
£lf
.
	`as£¹Body
("Helloest, you've been‡uthorized.")

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/test_bus.py

1 
impÜt
 
th»adšg


2 
impÜt
 
time


3 
impÜt
 
un™‹¡


5 
impÜt
 
ch”rypy


6 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
	gg‘_d«mÚ
, 
£t


7 
äom
 
	gch”rypy
.
´oûss
 
impÜt
 
w¥bus


10 
	gmsg
 = "Listener %d on channel %s: %s."

13 
şass
 
	$PublishSubsüibeTe¡s
(
un™‹¡
.
Te¡Ca£
):

15 
def
 
	$g‘_li¡’”
(
£lf
, 
chªÃl
, 
šdex
):

16 
def
 
	$li¡’”
(
¬g
=
NÚe
):

17 
£lf
.
»¥Ú£s
.
	`­³nd
(
msg
 % (
šdex
, 
chªÃl
, 
¬g
))

18  
li¡’”


20 
def
 
	$‹¡_butš_chªÃls
(
£lf
):

21 
b
 = 
w¥bus
.
	$Bus
()

23 
£lf
.
»¥Ú£s
, 
ex³ùed
 = [], []

25 
chªÃl
 
š
 
b
.
li¡’”s
:

26 
šdex
, 
´iÜ™y
 
š
 
	$’um”©e
([100, 50, 0, 51]):

27 
b
.
	`subsüibe
(
chªÃl
, 
£lf
.
	`g‘_li¡’”
(chªÃl, 
šdex
), 
´iÜ™y
)

29 
chªÃl
 
š
 
b
.
li¡’”s
:

30 
b
.
	$publish
(
chªÃl
)

31 
ex³ùed
.
	`ex‹nd
([
msg
 % (
i
, 
chªÃl
, 
NÚe
è˜
	`š
 (2, 1, 3, 0)])

32 
b
.
	$publish
(
chªÃl
, 
¬g
=79347)

33 
ex³ùed
.
	`ex‹nd
([
msg
 % (
i
, 
chªÃl
, 79347è˜
	`š
 (2, 1, 3, 0)])

35 
£lf
.
	$as£¹Equ®
(
£lf
.
»¥Ú£s
, 
ex³ùed
)

37 
def
 
	$‹¡_cu¡om_chªÃls
(
£lf
):

38 
b
 = 
w¥bus
.
	$Bus
()

40 
£lf
.
»¥Ú£s
, 
ex³ùed
 = [], []

42 
cu¡om_li¡’”s
 = ('hugh', 'louis', 'dewey')

43 
chªÃl
 
š
 
cu¡om_li¡’”s
:

44 
šdex
, 
´iÜ™y
 
š
 
	$’um”©e
([
NÚe
, 10, 60, 40]):

45 
b
.
	`subsüibe
(
chªÃl
, 
£lf
.
	`g‘_li¡’”
(chªÃl, 
šdex
), 
´iÜ™y
)

47 
chªÃl
 
š
 
cu¡om_li¡’”s
:

48 
b
.
	`publish
(
chªÃl
, 'ah so')

49 
ex³ùed
.
	`ex‹nd
([
msg
 % (
i
, 
chªÃl
, 'ah so'è˜
	`š
 (1, 3, 0, 2)])

50 
b
.
	$publish
(
chªÃl
)

51 
ex³ùed
.
	`ex‹nd
([
msg
 % (
i
, 
chªÃl
, 
NÚe
è˜
	`š
 (1, 3, 0, 2)])

53 
£lf
.
	$as£¹Equ®
(
£lf
.
»¥Ú£s
, 
ex³ùed
)

55 
def
 
	$‹¡_li¡’”_”rÜs
(
£lf
):

56 
b
 = 
w¥bus
.
	$Bus
()

58 
£lf
.
»¥Ú£s
, 
ex³ùed
 = [], []

59 
chªÃls
 = [
c
 ø
š
 
b
.
li¡’”s
 c != 'log']

61 
chªÃl
 
š
 
chªÃls
:

62 
b
.
	`subsüibe
(
chªÃl
, 
£lf
.
	$g‘_li¡’”
(
chªÃl
, 1))

63 #Thi 
wl
  
sšû
 
the
 
Ïmbda
 
kes
 
no
 
¬gs
.

64 
b
.
	`subsüibe
(
chªÃl
, 
Ïmbda
: 
NÚe
, 
´iÜ™y
=20)

66 
chªÃl
 
š
 
chªÃls
:

67 
£lf
.
	$as£¹Rai£s
(
w¥bus
.
ChªÃlFau»s
, 
b
.
publish
, 
chªÃl
, 123)

68 
ex³ùed
.
	`­³nd
(
msg
 % (1, 
chªÃl
, 123))

70 
£lf
.
	$as£¹Equ®
(
£lf
.
»¥Ú£s
, 
ex³ùed
)

73 
şass
 
	$BusM‘hodTe¡s
(
un™‹¡
.
Te¡Ca£
):

75 
def
 
	$log
(
£lf
, 
bus
):

76 
£lf
.
_log_’Œ›s
 = []

77 
def
 
	$log™
(
msg
, 
Ëv–
):

78 
£lf
.
_log_’Œ›s
.
	$­³nd
(
msg
)

79 
bus
.
	`subsüibe
('log', 
log™
)

81 
def
 
	$as£¹Log
(
£lf
, 
’Œ›s
):

82 
£lf
.
	$as£¹Equ®
(
£lf
.
_log_’Œ›s
, 
’Œ›s
)

84 
def
 
	$g‘_li¡’”
(
£lf
, 
chªÃl
, 
šdex
):

85 
def
 
	$li¡’”
(
¬g
=
NÚe
):

86 
£lf
.
»¥Ú£s
.
	`­³nd
(
msg
 % (
šdex
, 
chªÃl
, 
¬g
))

87  
li¡’”


89 
def
 
	$‹¡_¡¬t
(
£lf
):

90 
b
 = 
w¥bus
.
	$Bus
()

91 
£lf
.
	$log
(
b
)

93 
£lf
.
»¥Ú£s
 = []

94 
num
 = 3

95 
šdex
 
š
 
	$¿nge
(
num
):

96 
b
.
	`subsüibe
('¡¬t', 
£lf
.
	`g‘_li¡’”
('¡¬t', 
šdex
))

98 
b
.
	$¡¬t
()

99 
Œy
:

100 #Th
¡¬t
 
m‘hod
 
MUST
 
ÿÎ
 
®l
 '¡¬t' 
li¡’”s
.

101 
£lf
.
	`as£¹Equ®
(
	`£t
(£lf.
»¥Ú£s
),

102 
	`£t
([
msg
 % (
i
, '¡¬t', 
NÚe
è˜
š
 
	`¿nge
(
num
)]))

103 #Th
¡¬t
 
m‘hod
 
MUST
 
move
 
the
 
¡©e
 
to
 
STARTED


104 #(
Ü
 
EXITING
, 
”rÜs
 
occur
)

105 
£lf
.
	$as£¹Equ®
(
b
.
¡©e
, b.
¡©es
.
STARTED
)

106 #Th
¡¬t
 
m‘hod
 
MUST
 
log
 
™s
 
¡©es
.

107 
£lf
.
	`as£¹Log
(['Bus STARTING', 'Bus STARTED'])

108 
fš®ly
:

109 #Ex™ 
so
 
the
 
©ex™
 
hªdËr
 
dÛ¢
't complain.

110 
b
.
	$ex™
()

112 
def
 
	$‹¡_¡İ
(
£lf
):

113 
b
 = 
w¥bus
.
	$Bus
()

114 
£lf
.
	$log
(
b
)

116 
£lf
.
»¥Ú£s
 = []

117 
num
 = 3

118 
šdex
 
š
 
	$¿nge
(
num
):

119 
b
.
	`subsüibe
('¡İ', 
£lf
.
	`g‘_li¡’”
('¡İ', 
šdex
))

121 
b
.
	$¡İ
()

123 #Th
¡İ
 
m‘hod
 
MUST
 
ÿÎ
 
®l
 '¡İ' 
li¡’”s
.

124 
£lf
.
	`as£¹Equ®
(
	`£t
(£lf.
»¥Ú£s
),

125 
	`£t
([
msg
 % (
i
, '¡İ', 
NÚe
è˜
š
 
	`¿nge
(
num
)]))

126 #Th
¡İ
 
m‘hod
 
MUST
 
move
 
the
 
¡©e
 
to
 
STOPPED


127 
£lf
.
	$as£¹Equ®
(
b
.
¡©e
, b.
¡©es
.
STOPPED
)

128 #Th
¡İ
 
m‘hod
 
MUST
 
log
 
™s
 
¡©es
.

129 
£lf
.
	`as£¹Log
(['Bus STOPPING', 'Bus STOPPED'])

131 
def
 
	$‹¡_g¿ûful
(
£lf
):

132 
b
 = 
w¥bus
.
	$Bus
()

133 
£lf
.
	$log
(
b
)

135 
£lf
.
»¥Ú£s
 = []

136 
num
 = 3

137 
šdex
 
š
 
	$¿nge
(
num
):

138 
b
.
	`subsüibe
('g¿ûful', 
£lf
.
	`g‘_li¡’”
('g¿ûful', 
šdex
))

140 
b
.
	$g¿ûful
()

142 #Th
g¿ûful
 
m‘hod
 
MUST
 
ÿÎ
 
®l
 'g¿ûful' 
li¡’”s
.

143 
£lf
.
	`as£¹Equ®
(
	`£t
(£lf.
»¥Ú£s
),

144 
	`£t
([
msg
 % (
i
, 'g¿ûful', 
NÚe
è˜
š
 
	`¿nge
(
num
)]))

145 #Th
g¿ûful
 
m‘hod
 
MUST
 
log
 
™s
 
¡©es
.

146 
£lf
.
	`as£¹Log
(['Bus graceful'])

148 
def
 
	$‹¡_ex™
(
£lf
):

149 
b
 = 
w¥bus
.
	$Bus
()

150 
£lf
.
	$log
(
b
)

152 
£lf
.
»¥Ú£s
 = []

153 
num
 = 3

154 
šdex
 
š
 
	$¿nge
(
num
):

155 
b
.
	`subsüibe
('¡İ', 
£lf
.
	`g‘_li¡’”
('¡İ', 
šdex
))

156 
b
.
	`subsüibe
('ex™', 
£lf
.
	`g‘_li¡’”
('ex™', 
šdex
))

158 
b
.
	$ex™
()

160 #Th
ex™
 
m‘hod
 
MUST
 
ÿÎ
 
®l
 '¡İ' 
li¡’”s
,

161 #ªd 
th’
 
®l
 'ex™' 
li¡’”s
.

162 
£lf
.
	`as£¹Equ®
(
	`£t
(£lf.
»¥Ú£s
),

163 
	`£t
([
msg
 % (
i
, '¡İ', 
NÚe
è˜
š
 
	`¿nge
(
num
)] +

164 [
msg
 % (
i
, 'ex™', 
NÚe
è˜
š
 
	`¿nge
(
num
)]))

165 #Th
ex™
 
m‘hod
 
MUST
 
move
 
the
 
¡©e
 
to
 
EXITING


166 
£lf
.
	$as£¹Equ®
(
b
.
¡©e
, b.
¡©es
.
EXITING
)

167 #Th
ex™
 
m‘hod
 
MUST
 
log
 
™s
 
¡©es
.

168 
£lf
.
	`as£¹Log
(['Bus STOPPING', 'Bus STOPPED', 'Bus EXITING', 'Bus EXITED'])

170 
def
 
	$‹¡_wa™
(
£lf
):

171 
b
 = 
w¥bus
.
	$Bus
()

173 
def
 
	$f
(
m‘hod
):

174 
time
.
	$¦“p
(0.2)

175 
	$g‘©Œ
(
b
, 
m‘hod
)()

177 
m‘hod
, 
¡©es
 
š
 [('¡¬t', [
b
.¡©es.
STARTED
]),

178 ('¡İ', [
b
.
¡©es
.
STOPPED
]),

179 ('¡¬t', [
b
.
¡©es
.
STARTING
, b.¡©es.
STARTED
]),

180 ('ex™', [
b
.
¡©es
.
EXITING
]),

182 
th»adšg
.
	`Th»ad
(
rg‘
=
f
, 
¬gs
=(
m‘hod
,)).
	$¡¬t
()

183 
b
.
	$wa™
(
¡©es
)

185 #Th
wa™
 
m‘hod
 
MUST
 wa™ 
the
 
giv’
 
	`¡©e
(
s
).

186 
b
.
¡©e
 
nÙ
 
š
 
¡©es
:

187 
£lf
.
	`ç
("S‹ %¸nÙ iÀ%r" % (
b
.
¡©e
, 
¡©es
))

189 
def
 
	$‹¡_block
(
£lf
):

190 
b
 = 
w¥bus
.
	$Bus
()

191 
£lf
.
	$log
(
b
)

193 
def
 
	$f
():

194 
time
.
	$¦“p
(0.2)

195 
b
.
	$ex™
()

196 
def
 
	$g
():

197 
time
.
	$¦“p
(0.4)

198 
th»adšg
.
	`Th»ad
(
rg‘
=
f
).
	$¡¬t
()

199 
th»adšg
.
	`Th»ad
(
rg‘
=
g
).
	$¡¬t
()

200 
th»ads
 = [
t
 ˆ
š
 
th»adšg
.
	$’um”©e
(è
nÙ
 
	`g‘_d«mÚ
(
t
)]

201 
£lf
.
	`as£¹Equ®
(
	`Ën
(
th»ads
), 3)

203 
b
.
	$block
()

205 #Th
block
 
m‘hod
 
MUST
 
wa™
 
the
 
EXITING
 
¡©e
.

206 
£lf
.
	$as£¹Equ®
(
b
.
¡©e
, b.
¡©es
.
EXITING
)

207 #Th
block
 
m‘hod
 
MUST
 
wa™
 
ALL
 
nÚ
-
maš
,‚Ú-
d«mÚ
 
th»ads
 
to
 
fšish
.

208 
th»ads
 = [
t
 ˆ
š
 
th»adšg
.
	$’um”©e
(è
nÙ
 
	`g‘_d«mÚ
(
t
)]

209 
£lf
.
	`as£¹Equ®
(
	`Ën
(
th»ads
), 1)

210 #Th
Ï¡
 
mes§ge
 
wl
 
m’tiÚ
 
ª
 
šd‘”mšabË
 
th»ad
 
Çme
; 
ignÜe
 
™


211 
£lf
.
	`as£¹Equ®
(£lf.
_log_’Œ›s
[:-1],

216 
def
 
	$‹¡_¡¬t_w™h_ÿÎback
(
£lf
):

217 
b
 = 
w¥bus
.
	$Bus
()

218 
£lf
.
	$log
(
b
)

219 
Œy
:

220 
ev’ts
 = []

221 
def
 
	$f
(*
¬gs
, **
kw¬gs
):

222 
ev’ts
.
	`­³nd
(("f", 
¬gs
, 
kw¬gs
))

223 
def
 
	$g
():

224 
ev’ts
.
	`­³nd
("g")

225 
b
.
	`subsüibe
("¡¬t", 
g
)

226 
b
.
	`¡¬t_w™h_ÿÎback
(
f
, (1, 3, 5), {"foo": "b¬"
	}
})

227 #Giv
wa™
(è
time
 
to
 
run
 
f
()

228 
time
.
	$¦“p
(0.2)

230 #Th
ÿÎback
 
m‘hod
 
MUST
 
wa™
 
the
 
STARTED
 
¡©e
.

231 
£lf
.
	$as£¹Equ®
(
b
.
¡©e
, b.
¡©es
.
STARTED
)

232 #Th
ÿÎback
 
m‘hod
 
MUST
 
run
 
aá”
 
®l
 
¡¬t
 
m‘hods
.

233 
£lf
.
	`as£¹Equ®
(
ev’ts
, ["g", ("f", (1, 3, 5), {"foo": "b¬"
	}
})])

234 
fš®ly
:

235 
b
.
	$ex™
()

237 
def
 
	$‹¡_log
(
£lf
):

238 
b
 = 
w¥bus
.
	$Bus
()

239 
£lf
.
	$log
(
b
)

240 
£lf
.
	$as£¹Log
([])

242 #Try 
a
 
nÜm®
 
mes§ge
.

243 
ex³ùed
 = []

244 
msg
 
š
 ["O mah darlin'"] * 3 + ["Clementiiiiiiiine"]:

245 
b
.
	$log
(
msg
)

246 
ex³ùed
.
	$­³nd
(
msg
)

247 
£lf
.
	$as£¹Log
(
ex³ùed
)

249 #Try 
ª
 
”rÜ
 
mes§ge


250 
Œy
:

251 
foo


252 
exû±
 
NameE¼Ü
:

253 
b
.
	`log
("You‡»†o¡‡nd gÚfÜev”", 
Œaûback
=
True
)

254 
Ï¡msg
 = 
£lf
.
_log_’Œ›s
[-1]

255 "T¿ûback" 
nÙ
 
š
 
Ï¡msg
 
Ü
 "NameError"‚ot in†astmsg:

256 
£lf
.
	`ç
("Last†og message %r did‚ot contain "

257 "thex³ùed¿ûback." % 
Ï¡msg
)

259 
£lf
.
	`ç
("NameError was‚ot„aised‡sƒxpected.")

262 
__Çme__
 == "__main__":

263 
un™‹¡
.
	`maš
()

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/test_caching.py

1 
impÜt
 
d©‘ime


2 
impÜt
 
gz


3 
äom
 
™”toŞs
 
impÜt
 
couÁ


4 
impÜt
 
os


5 
	gcurdœ
 = 
os
.
·th
.
još
(os.
g‘cwd
(), os.·th.
	$dœÇme
(
__fe__
))

6 
impÜt
 
sys


7 
impÜt
 
th»adšg


8 
impÜt
 
time


9 
impÜt
 
u¾lib


11 
impÜt
 
ch”rypy


12 
äom
 
ch”rypy
.
_ıcom·t
 
impÜt
 
Ãxt
, 
Áob
, 
quÙe
, 
x¿nge


13 
äom
 
ch”rypy
.
lib
 
impÜt
 
h‰put


15 
gif_by‹s
 = 
	`Áob
('GIF89a\x01\x00\x01\x00\x82\x00\x01\x99"\x1e\x00\x00\x00\x00\x00'

21 
äom
 
ch”rypy
.
‹¡
 
impÜt
 
h–³r


23 
şass
 
	$CacheTe¡
(
h–³r
.
CPWebCa£
):

25 
def
 
	$£tup_£rv”
():

27 
şass
 
RoÙ
:

29 
_ı_cÚfig
 = {'toŞs.ÿchšg.Ú': 
True
}

31 
def
 
	$__š™__
(
£lf
):

32 
£lf
.
couÁ”
 = 0

33 
£lf
.
cÚŒŞ_couÁ”
 = 0

34 
£lf
.
lÚglock
 = 
th»adšg
.
	$Lock
()

36 
def
 
	$šdex
(
£lf
):

37 
£lf
.
couÁ”
 += 1

38 
msg
 = "vis™ #%s" % 
£lf
.
couÁ”


39  
msg


40 
šdex
.
expo£d
 = 
True


42 
def
 
	$cÚŒŞ
(
£lf
):

43 
£lf
.
cÚŒŞ_couÁ”
 += 1

44  "vis™ #%s" % 
£lf
.
cÚŒŞ_couÁ”


45 
cÚŒŞ
.
expo£d
 = 
True


47 
def
 
	$a_gif
(
£lf
):

48 
ch”rypy
.
»¥Ú£
.
h—d”s
['La¡-Modif›d'] = 
h‰put
.
	$HTTPD©e
()

49  
gif_by‹s


50 
a_gif
.
expo£d
 = 
True


52 
def
 
	`lÚg_´oûss
(
£lf
, 
£cÚds
='1'):

53 
Œy
:

54 
£lf
.
lÚglock
.
	$acquœe
()

55 
time
.
	`¦“p
((
£cÚds
))

56 
fš®ly
:

57 
£lf
.
lÚglock
.
	$»Ëa£
()

59 
lÚg_´oûss
.
expo£d
 = 
True


61 
def
 
	$ş—r_ÿche
(
£lf
, 
·th
):

62 
ch”rypy
.
_ÿche
.
¡Üe
[ch”rypy.
»que¡
.
ba£
 + 
·th
].
	$ş—r
()

63 
ş—r_ÿche
.
expo£d
 = 
True


65 
şass
 
	$V¬yH—d”CachšgS”v”
(
objeù
):

67 
_ı_cÚfig
 = {'toŞs.ÿchšg.Ú': 
True
,

68 'toŞs.»¥Ú£_h—d”s.Ú': 
True
,

70 
	}
}

72 
def
 
	$__š™__
(
£lf
):

73 
£lf
.
couÁ”
 = 
	$couÁ
(1)

75 
def
 
	$šdex
(
£lf
):

76  "vis™ #%s" % 
	$Ãxt
(
£lf
.
couÁ”
)

77 
šdex
.
expo£d
 = 
True


79 
şass
 
	$UnCached
(
objeù
):

80 
_ı_cÚfig
 = {'toŞs.expœes.Ú': 
True
,

82 'toŞs.¡©icdœ.Ú': 
True
,

84 'toŞs.¡©icdœ.roÙ': 
curdœ
,

85 
	}
}

87 
def
 
	$fÜû
(
£lf
):

88 
ch”rypy
.
»¥Ú£
.
h—d”s
['Etag'] = 'bibbitybobbityboo'

89 
£lf
.
_ı_cÚfig
['toŞs.expœes.fÜû'] = 
True


90 
£lf
.
_ı_cÚfig
['tools.expires.secs'] = 0

92 
fÜû
.
expo£d
 = 
True


93 
fÜû
.
_ı_cÚfig
 = {'toŞs.expœes.£cs': 0
	}
}

95 
def
 
	$dyÇmic
(
£lf
):

96 
ch”rypy
.
»¥Ú£
.
h—d”s
['Etag'] = 'bibbitybobbityboo'

97 
ch”rypy
.
»¥Ú£
.
h—d”s
['Cache-Control'] = 'private'

99 
dyÇmic
.
expo£d
 = 
True


101 
def
 
	$ÿch—bË
(
£lf
):

102 
ch”rypy
.
»¥Ú£
.
h—d”s
['Etag'] = 'bibbitybobbityboo'

104 
ÿch—bË
.
expo£d
 = 
True


106 
def
 
	$¥ecific
(
£lf
):

107 
ch”rypy
.
»¥Ú£
.
h—d”s
['Etag'] = 'need_this_to_make_me_cacheable'

109 
¥ecific
.
expo£d
 = 
True


110 
¥ecific
.
_ı_cÚfig
 = {'toŞs.expœes.£cs': 86400
	}
}

112 
şass
 
	$Foo
(
objeù
):
·ss


114 
def
 
	$wrÚgty³
(
£lf
):

115 
ch”rypy
.
»¥Ú£
.
h—d”s
['Etag'] = 'need_this_to_make_me_cacheable'

117 
wrÚgty³
.
expo£d
 = 
True


118 
wrÚgty³
.
_ı_cÚfig
 = {'toŞs.expœes.£cs': 
	`Foo
()
	}
}

120 
ch”rypy
.
Œ“
.
mouÁ
(
	$RoÙ
())

121 
ch”rypy
.
Œ“
.
	`mouÁ
(
	`UnCached
(), "/expires")

122 
ch”rypy
.
Œ“
.
	`mouÁ
(
	`V¬yH—d”CachšgS”v”
(), "/varying_headers")

123 
ch”rypy
.
cÚfig
.
	`upd©e
({'toŞs.gz.Ú': 
True
})

124 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

126 
def
 
	$‹¡Cachšg
(
£lf
):

127 
–­£d
 = 0.0

128 
ŒŸl
 
š
 
	$¿nge
(10):

129 
£lf
.
	`g‘Page
("/")

130 #Th
»¥Ú£
 
should
 
be
 
the
 
§me
 
ev”y
 
time
,

131 #exû± 
the
 
Age
 
»¥Ú£
 
h—d”
.

132 
£lf
.
	`as£¹Body
('visit #1')

133 
ŒŸl
 != 0:

134 
age
 = (
£lf
.
	`as£¹H—d”
("Age"))

135 
£lf
.
	`as£¹_
(
age
 >ğ
–­£d
)

136 
–­£d
 = 
age


138 #POST, 
PUT
, 
DELETE
 
should
 
nÙ
 
be
 
ÿched
.

139 
£lf
.
	`g‘Page
("/", 
m‘hod
="POST")

140 
£lf
.
	`as£¹Body
('visit #2')

141 #Beÿu£ 
gz
 
is
 
tuºed
 
Ú
, 
the
 
V¬y
 
h—d”
 
should
 
®ways
 V¬y 
cÚ‹Á
-
’codšg


142 
£lf
.
	`as£¹H—d”
('Vary', 'Accept-Encoding')

143 #Th
´evious
 
»que¡
 
should
 
have
 
šv®id©ed
 
the
 
ÿche
,

144 #sØ
this
 
»que¡
 
wl
 
»ÿlc
 
the
 
»¥Ú£
.

145 
£lf
.
	`g‘Page
("/", 
m‘hod
="GET")

146 
£lf
.
	`as£¹Body
('visit #3')

147 #...
but
 
this
 
»que¡
 
should
 
g‘
 
the
 
ÿched
 
cİy
.

148 
£lf
.
	`g‘Page
("/", 
m‘hod
="GET")

149 
£lf
.
	`as£¹Body
('visit #3')

150 
£lf
.
	`g‘Page
("/", 
m‘hod
="DELETE")

151 
£lf
.
	`as£¹Body
('visit #4')

153 #Th
´evious
 
»que¡
 
should
 
have
 
šv®id©ed
 
the
 
ÿche
,

154 #sØ
this
 
»que¡
 
wl
 
»ÿlc
 
the
 
»¥Ú£
.

155 
£lf
.
	`g‘Page
("/", 
m‘hod
="GET", 
h—d”s
=[('Accept-Encoding', 'gzip')])

156 
£lf
.
	`as£¹H—d”
('Content-Encoding', 'gzip')

157 
£lf
.
	`as£¹H—d”
('Vary')

158 
£lf
.
	`as£¹Equ®
(
ch”rypy
.
lib
.
’codšg
.
	`decom´ess
(£lf.
body
), 
	`Áob
("visit #5"))

160 #Now 
check
 
th©
 
a
 
£cÚd
 
»que¡
 
g‘s
 
the
 
gz
 
h—d”
 
ªd
 
gz³d
 
body


161 #Thi 
®so
 
‹¡s
 
a
 
bug
 
š
 3.0 
to
 3.0.2 
wh”eby
 
the
 
ÿched
, 
gz³d


162 #»¥Ú£ 
body
 
was
 
bešg
 
gz³d
 
a
 
£cÚd
 
time
.

163 
£lf
.
	`g‘Page
("/", 
m‘hod
="GET", 
h—d”s
=[('Accept-Encoding', 'gzip')])

164 
£lf
.
	`as£¹H—d”
('Content-Encoding', 'gzip')

165 
£lf
.
	`as£¹Equ®
(
ch”rypy
.
lib
.
’codšg
.
	`decom´ess
(£lf.
body
), 
	`Áob
("visit #5"))

167 #Now 
check
 
th©
 
a
 
thœd
 
»que¡
h© 
dÛ¢
't‡ccept gzip

168 #sk 
the
 
	`ÿche
 (
beÿu£
h'V¬y' 
h—d”
 
d’›s
 
™
).

169 
£lf
.
	`g‘Page
("/", 
m‘hod
="GET")

170 
£lf
.
	`as£¹NoH—d”
('Content-Encoding')

171 
£lf
.
	`as£¹Body
('visit #6')

173 
def
 
	$‹¡V¬yH—d”
(
£lf
):

174 
£lf
.
	`g‘Page
("/varying_headers/")

175 
£lf
.
	`as£¹Stus
("200 OK")

176 
£lf
.
	`as£¹H—d”I‹mV®ue
('Vary', 'Our-Varying-Header')

177 
£lf
.
	`as£¹Body
('visit #1')

179 #Now 
check
 
th©
 
difã»Á
 'V¬y'-
f›lds
 
dÚ
'tƒvictƒach other.

180 #Thi 
‹¡
 
ü—‹s
 2 
»que¡s
 
w™h
 
difã»Á
 'Our-Varying-Header'

181 #ªd 
th’
 
‹¡s
 
the
 
fœ¡
 
Úe
 
¡l
 
exi¡s
.

182 
£lf
.
	`g‘Page
("/v¬yšg_h—d”s/", 
h—d”s
=[('Our-Varying-Header', 'request 2')])

183 
£lf
.
	`as£¹Stus
("200 OK")

184 
£lf
.
	`as£¹Body
('visit #2')

186 
£lf
.
	`g‘Page
("/v¬yšg_h—d”s/", 
h—d”s
=[('Our-Varying-Header', 'request 2')])

187 
£lf
.
	`as£¹Stus
("200 OK")

188 
£lf
.
	`as£¹Body
('visit #2')

190 
£lf
.
	`g‘Page
("/varying_headers/")

191 
£lf
.
	`as£¹Stus
("200 OK")

192 
£lf
.
	`as£¹Body
('visit #1')

194 
def
 
	$‹¡ExpœesToŞ
(
£lf
):

195 #‹¡ 
£‰šg
 
ª
 
expœes
 
h—d”


196 
£lf
.
	`g‘Page
("/expires/specific")

197 
£lf
.
	`as£¹Stus
("200 OK")

198 
£lf
.
	`as£¹H—d”
("Expires")

200 #‹¡ 
exû±iÚs
 
bad
 
time
 
v®ues


201 
£lf
.
	`g‘Page
("/expires/wrongtype")

202 
£lf
.
	$as£¹Stus
(500)

203 
£lf
.
	`as£¹InBody
("TypeError")

205 #¡©iø
cÚ‹Á
 
should
 
nÙ
 
have
 "ÿch´ev’tiÚ" 
h—d”s


206 
£lf
.
	`g‘Page
("/expires/index.html")

207 
£lf
.
	`as£¹Stus
("200 OK")

208 
£lf
.
	`as£¹NoH—d”
("Pragma")

209 
£lf
.
	`as£¹NoH—d”
("Cache-Control")

210 
£lf
.
	`as£¹H—d”
("Expires")

212 #dyÇmiø
cÚ‹Á
 
th©
 
£ts
 
šdiÿtÜs
 
should
 
nÙ
 
have


213 #"
ÿche
 
´ev’tiÚ
" headers

214 
£lf
.
	`g‘Page
("/expires/cacheable")

215 
£lf
.
	`as£¹Stus
("200 OK")

216 
£lf
.
	`as£¹NoH—d”
("Pragma")

217 
£lf
.
	`as£¹NoH—d”
("Cache-Control")

218 
£lf
.
	`as£¹H—d”
("Expires")

220 
£lf
.
	`g‘Page
('/expires/dynamic')

221 
£lf
.
	`as£¹Body
("D-d-d-dynamic!")

222 #th
Cache
-
CÚŒŞ
 
h—d”
 
should
 
be
 
uÁouched


223 
£lf
.
	`as£¹H—d”
("Cache-Control", "private")

224 
£lf
.
	`as£¹H—d”
("Expires")

226 #cÚfigu» 
the
 
toŞ
 
to
 
ignÜe
 
šdiÿtÜs
 
ªd
 
»¶aû
 
exi¡šg
 
h—d”s


227 
£lf
.
	`g‘Page
("/expires/force")

228 
£lf
.
	`as£¹Stus
("200 OK")

229 #Thi 
®so
 
gives
 
us
 
a
 
chªû
 
to
 
‹¡
 0 
expœy
 
w™h
 
no
 
Ùh”
 
h—d”s


230 
£lf
.
	`as£¹H—d”
("Pragma", "no-cache")

231 
ch”rypy
.
£rv”
.
´ÙocŞ_v”siÚ
 == "HTTP/1.1":

232 
£lf
.
	`as£¹H—d”
("Cache-Control", "no-cache, must-revalidate")

233 
£lf
.
	`as£¹H—d”
("Expires", "Sun, 28 Jan 2007 00:00:00 GMT")

235 #¡©iø
cÚ‹Á
 
should
 
now
 
have
 "ÿch´ev’tiÚ" 
h—d”s


236 
£lf
.
	`g‘Page
("/expires/index.html")

237 
£lf
.
	`as£¹Stus
("200 OK")

238 
£lf
.
	`as£¹H—d”
("Pragma", "no-cache")

239 
ch”rypy
.
£rv”
.
´ÙocŞ_v”siÚ
 == "HTTP/1.1":

240 
£lf
.
	`as£¹H—d”
("Cache-Control", "no-cache, must-revalidate")

241 
£lf
.
	`as£¹H—d”
("Expires", "Sun, 28 Jan 2007 00:00:00 GMT")

243 #th
ÿch—bË
 
hªdËr
 
should
 
now
 
have
 "ÿch´ev’tiÚ" 
h—d”s


244 
£lf
.
	`g‘Page
("/expires/cacheable")

245 
£lf
.
	`as£¹Stus
("200 OK")

246 
£lf
.
	`as£¹H—d”
("Pragma", "no-cache")

247 
ch”rypy
.
£rv”
.
´ÙocŞ_v”siÚ
 == "HTTP/1.1":

248 
£lf
.
	`as£¹H—d”
("Cache-Control", "no-cache, must-revalidate")

249 
£lf
.
	`as£¹H—d”
("Expires", "Sun, 28 Jan 2007 00:00:00 GMT")

251 
£lf
.
	`g‘Page
('/expires/dynamic')

252 
£lf
.
	`as£¹Body
("D-d-d-dynamic!")

253 #dyÇmiø
£ts
 
Cache
-
CÚŒŞ
 
to
 
´iv©e
 
but
 
™
 
should
 
be


254 #ov”wr™‹À
h”e
 ...

255 
£lf
.
	`as£¹H—d”
("Pragma", "no-cache")

256 
ch”rypy
.
£rv”
.
´ÙocŞ_v”siÚ
 == "HTTP/1.1":

257 
£lf
.
	`as£¹H—d”
("Cache-Control", "no-cache, must-revalidate")

258 
£lf
.
	`as£¹H—d”
("Expires", "Sun, 28 Jan 2007 00:00:00 GMT")

260 
def
 
	$‹¡La¡Modif›d
(
£lf
):

261 
£lf
.
	`g‘Page
("/a.gif")

262 
£lf
.
	$as£¹Stus
(200)

263 
£lf
.
	$as£¹Body
(
gif_by‹s
)

264 
lm1
 = 
£lf
.
	`as£¹H—d”
("Last-Modified")

266 #thi 
»que¡
 
should
 
g‘
 
the
 
ÿched
 
cİy
.

267 
£lf
.
	`g‘Page
("/a.gif")

268 
£lf
.
	$as£¹Stus
(200)

269 
£lf
.
	$as£¹Body
(
gif_by‹s
)

270 
£lf
.
	`as£¹H—d”
("Age")

271 
lm2
 = 
£lf
.
	`as£¹H—d”
("Last-Modified")

272 
£lf
.
	$as£¹Equ®
(
lm1
, 
lm2
)

274 #thi 
»que¡
 
should
 
m©ch
 
the
 
ÿched
 
cİy
, 
but
 
¿i£
 304.

275 
£lf
.
	`g‘Page
("/a.gif", [('If-Modif›d-Sšû', 
lm1
)])

276 
£lf
.
	$as£¹Stus
(304)

277 
£lf
.
	`as£¹NoH—d”
("Last-Modified")

278 
nÙ
 
	`g‘©Œ
(
ch”rypy
.
£rv”
, "usšg_­ache", 
F®£
):

279 
£lf
.
	`as£¹H—d”
("Age")

281 
def
 
	$‹¡_ªti¡am³de
(
£lf
):

282 
SECONDS
 = 4

283 #W
MUST
 
make
 
ª
 
š™Ÿl
 
synchrÚous
 
»que¡
 
š
 
Üd”
 
to
 
ü—‹
 
the


284 #AÁiSm³deCach
objeù
, 
ªd
 
pİuÏ‹
 
™s
 
£Ëùšg_h—d”s
,

285 #befÜ
the
 
aùu®
 
¡am³de
.

286 
£lf
.
	`g‘Page
("/lÚg_´oûss?£cÚds=%d" % 
SECONDS
)

287 
£lf
.
	`as£¹Body
('success!')

288 
£lf
.
	`g‘Page
("/clear_cache?path=" +

289 
	`quÙe
('/lÚg_´oûss?£cÚds=%d' % 
SECONDS
, 
§ã
=''))

290 
£lf
.
	$as£¹Stus
(200)

292 
¡¬t
 = 
d©‘ime
.d©‘ime.
	$now
()

293 
def
 
	$run
():

294 
£lf
.
	`g‘Page
("/lÚg_´oûss?£cÚds=%d" % 
SECONDS
)

295 #Th
»¥Ú£
 
should
 
be
 
the
 
§me
 
ev”y
 
time


296 
£lf
.
	`as£¹Body
('success!')

297 
ts
 = [
th»adšg
.
	$Th»ad
(
rg‘
=
run
è
i
 
š
 
	`x¿nge
(100)]

298 
t
 
š
 
ts
:

299 
t
.
	$¡¬t
()

300 
t
 
š
 
ts
:

301 
t
.
	$još
()

302 
£lf
.
	`as£¹Equ®D©es
(
¡¬t
, 
d©‘ime
.d©‘ime.
	`now
(),

303 #AÎow 
a
 
	`£cÚd
 (
two
, 
¦ow
 
ho¡s
)

304 #fÜ 
our
 
th»ad
/
TCP
 
ov”h—d
 
‘c
.

305 
£cÚds
=
SECONDS
 + 2)

307 
def
 
	$‹¡_ÿche_cÚŒŞ
(
£lf
):

308 
£lf
.
	`g‘Page
("/control")

309 
£lf
.
	`as£¹Body
('visit #1')

310 
£lf
.
	`g‘Page
("/control")

311 
£lf
.
	`as£¹Body
('visit #1')

313 
£lf
.
	`g‘Page
("/cÚŒŞ", 
h—d”s
=[('Cache-Control', 'no-cache')])

314 
£lf
.
	`as£¹Body
('visit #2')

315 
£lf
.
	`g‘Page
("/control")

316 
£lf
.
	`as£¹Body
('visit #2')

318 
£lf
.
	`g‘Page
("/cÚŒŞ", 
h—d”s
=[('Pragma', 'no-cache')])

319 
£lf
.
	`as£¹Body
('visit #3')

320 
£lf
.
	`g‘Page
("/control")

321 
£lf
.
	`as£¹Body
('visit #3')

323 
time
.
	$¦“p
(1)

324 
£lf
.
	`g‘Page
("/cÚŒŞ", 
h—d”s
=[('Cache-Control', 'max-age=0')])

325 
£lf
.
	`as£¹Body
('visit #4')

326 
£lf
.
	`g‘Page
("/control")

327 
£lf
.
	`as£¹Body
('visit #4')

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/test_compat.py

1 
impÜt
 
un™‹¡


3 
impÜt
 
no£


5 
äom
 
ch”rypy
 
impÜt
 
_ıcom·t
 
as
 
com·t


7 
şass
 
	$SŒšgTe¡”
(
un™‹¡
.
Te¡Ca£
):

8 
def
 
	$‹¡_Áob_nÚ_Çtive
(
£lf
):

10 
Áob
 
should
 
¿i£
 
ª
 
Exû±iÚ
 
Ú
 
unicode
.

11 (
PythÚ
 2 
Úly
)

13 
S“
 #1132 
discussiÚ
.

15 
com·t
.
py3k
:

16 
¿i£
 
no£
.
	`SkTe¡
("Only useful on Python 2")

17 
£lf
.
	`as£¹Rai£s
(
Exû±iÚ
, 
com·t
.
Áob
, 
	`unicode
('fight'))

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/test_config.py

3 
impÜt
 
	gos
, 
sys


4 
	gloÿlDœ
 = 
os
.
·th
.
još
(os.
g‘cwd
(), os.·th.
	$dœÇme
(
__fe__
))

6 
äom
 
ch”rypy
.
_ıcom·t
 
impÜt
 
Áob
, 
SŒšgIO


7 
impÜt
 
un™‹¡


9 
impÜt
 
ch”rypy


11 
def
 
	$£tup_£rv”
():

13 
şass
 
RoÙ
:

15 
_ı_cÚfig
 = {'foo': 'this',

16 'b¬': 'th©'
	}
}

18 
def
 
	$__š™__
(
£lf
):

19 
ch”rypy
.
cÚfig
.
Çme¥aûs
['db'] = 
£lf
.
db_Çme¥aû


21 
def
 
	$db_Çme¥aû
(
£lf
, 
k
, 
v
):

22 
k
 == "scheme":

23 
£lf
.
db
 = 
v


25 #@
ch”rypy
.
	`expo£
(
®Ÿs
=('global_', 'xyz'))

26 
def
 
	$šdex
(
£lf
, 
key
):

27  
ch”rypy
.
»que¡
.
cÚfig
.
	`g‘
(
key
, "None")

28 
šdex
 = 
ch”rypy
.
	`expo£
(šdex, 
®Ÿs
=('global_', 'xyz'))

30 
def
 
	$»´
(
£lf
, 
key
):

31  
	`»´
(
ch”rypy
.
»que¡
.
cÚfig
.
	$g‘
(
key
, 
NÚe
))

32 
»´
.
expo£d
 = 
True


34 
def
 
	$dbscheme
(
£lf
):

35  
£lf
.
db


36 
dbscheme
.
expo£d
 = 
True


38 
def
 
	$¶aš
(
£lf
, 
x
):

39  
x


40 
¶aš
.
expo£d
 = 
True


41 
¶aš
.
_ı_cÚfig
 = {'»que¡.body.©‹m±_ch¬£ts': ['utf-16']
	}
}

43 
çvicÚ_ico
 = 
ch”rypy
.
toŞs
.
¡©icfe
.
hªdËr
(

44 
f’ame
=
os
.
·th
.
još
(
loÿlDœ
, '../favicon.ico'))

46 
şass
 
	gFoo
:

48 
_ı_cÚfig
 = {'foo': 'this2',

51 
def
 
	$šdex
(
£lf
, 
key
):

52  
ch”rypy
.
»que¡
.
cÚfig
.
	`g‘
(
key
, "None")

53 
šdex
.
expo£d
 = 
True


54 
Ãx
 = 
šdex


56 
def
 
	$sly
(
£lf
):

58 
sly
.
expo£d
 = 
True


59 
sly
.
_ı_cÚfig
 = {'»¥Ú£.h—d”s.X-sly': 'slyv®'
	}
}

61 #Te¡ 
the
 
expo£
 
ªd
 
cÚfig
 
decÜ©Üs


62 #@
ch”rypy
.
expo£


63 #@
ch”rypy
.
cÚfig
(
foo
='this3', **{'bax': 'this4'})

64 
def
 
	$b¬
(
£lf
, 
key
):

65  
	`»´
(
ch”rypy
.
»que¡
.
cÚfig
.
	$g‘
(
key
, 
NÚe
))

66 
b¬
.
expo£d
 = 
True


67 
b¬
.
_ı_cÚfig
 = {'foo': 'this3', 'bax': 'this4'
	}
}

69 
şass
 
AnÙh”
:

71 
def
 
	$šdex
(
£lf
, 
key
):

72  
	`¡r
(
ch”rypy
.
»que¡
.
cÚfig
.
	`g‘
(
key
, "None"))

73 
šdex
.
expo£d
 = 
True


76 
def
 
	$¿w_Çme¥aû
(
key
, 
v®ue
):

77 
key
 == 'input.map':

78 
hªdËr
 = 
ch”rypy
.
»que¡
.handler

79 
def
 
	$w¿µ”
():

80 
·¿ms
 = 
ch”rypy
.
»que¡
.params

81 
Çme
, 
cÛrûr
 
š
 
	`li¡
(
v®ue
.
	$™ems
()):

82 
Œy
:

83 
·¿ms
[
Çme
] = 
	$cÛrûr
(
·¿ms
[
Çme
])

84 
exû±
 
KeyE¼Ü
:

85 
·ss


86  
	$hªdËr
()

87 
ch”rypy
.
»que¡
.
hªdËr
 = 
w¿µ”


88 
–if
 
key
 == 'output':

89 
hªdËr
 = 
ch”rypy
.
»que¡
.handler

90 
def
 
	$w¿µ”
():

91 #'
v®ue
' is‡ype (like int or str).

92  
	`v®ue
(
	$hªdËr
())

93 
ch”rypy
.
»que¡
.
hªdËr
 = 
w¿µ”


95 
şass
 
Raw
:

97 
_ı_cÚfig
 = {'¿w.ouut': 
»´
}

99 
def
 
	$šü
(
£lf
, 
num
):

100  
num
 + 1

101 
šü
.
expo£d
 = 
True


102 
šü
.
_ı_cÚfig
 = {'¿w.šput.m­': {'num': }
	}
}

104 
iocÚf
 = 
SŒšgIO
("""

106 
Ãg
: -1234

107 
f’ame
: 
os
.
·th
.
još
(
sys
.
´efix
, "hello.py")

108 
thšg1
: 
ch”rypy
.
lib
.
h‰put
.
»¥Ú£_codes
[404]

109 
thšg2
: 
__impÜt__
('ch”rypy.tutÜŸl', 
glob®s
(), 
loÿls
(), ['']).thing2

110 
com¶ex
: 3+2
j


111 
mul
: 6*3

112 
Úes
: "11"

113 
twos
: "22"

114 
¡¿dd
: %%(
Úes
)
s
 + %%(
twos
)s + "33"

116 [/
çvicÚ
.
ico
]

117 
toŞs
.
¡©icfe
.
f’ame
 = %
r


120 
roÙ
 = 
	$RoÙ
()

121 
roÙ
.
foo
 = 
	$Foo
()

122 
roÙ
.
¿w
 = 
	$Raw
()

123 
­p
 = 
ch”rypy
.
Œ“
.
	$mouÁ
(
roÙ
, 
cÚfig
=
iocÚf
)

124 
­p
.
»que¡_şass
.
Çme¥aûs
['¿w'] = 
¿w_Çme¥aû


126 
ch”rypy
.
Œ“
.
	`mouÁ
(
	`AnÙh”
(), "/another")

127 
ch”rypy
.
cÚfig
.
	`upd©e
({'luxuryyacht': 'throatwobblermangrove',

128 'db.scheme': 
r
"sqlite///memory",

129 
	}
})

132 #Cl›Á-
side
 
code
 #


133 
äom
 
ch”rypy
.
‹¡
 
impÜt
 
h–³r


135 
şass
 
	$CÚfigTe¡s
(
h–³r
.
CPWebCa£
):

136 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

138 
def
 
	$‹¡CÚfig
(
£lf
):

139 
‹¡s
 = [

149 #Ià'foo' =ğ'this', 
th’
 
the
 
mouÁ
 
pošt
 '/ªÙh”' 
Ëaks
 
što
 '/'.

152 
·th
, 
key
, 
ex³ùed
 
š
 
‹¡s
:

153 
£lf
.
	`g‘Page
(
·th
 + "?key=" + 
key
)

154 
£lf
.
	$as£¹Body
(
ex³ùed
)

156 
ex³ùedcÚf
 = {

157 #From 
CP
 
deçuÉs


158 'toŞs.log_h—d”s.Ú': 
F®£
,

159 'toŞs.log_Œaûbacks.Ú': 
True
,

160 '»que¡.show_Œaûbacks': 
True
,

161 'log.sü“n': 
F®£
,

163 '’gše.autÜ–ßd_Ú': 
F®£
,

164 #From 
glob®
 
cÚfig


166 #From 
RoÙ
.
_ı_cÚfig


168 #From 
Foo
.
_ı_cÚfig


170 #From 
Foo
.
b¬
.
_ı_cÚfig


173 
	}
}

174 
key
, 
ex³ùed
 
š
 
ex³ùedcÚf
.
	$™ems
():

175 
£lf
.
	`g‘Page
("/foo/b¬?key=" + 
key
)

176 
£lf
.
	`as£¹Body
(
	$»´
(
ex³ùed
))

178 
def
 
	$‹¡UÄ•r
(
£lf
):

179 
£lf
.
	`g‘Page
("/repr?key=neg")

180 
£lf
.
	`as£¹Body
("-1234")

182 
£lf
.
	`g‘Page
("/repr?key=filename")

183 
£lf
.
	`as£¹Body
(
	`»´
(
os
.
·th
.
	`još
(
sys
.
´efix
, "hello.py")))

185 
£lf
.
	`g‘Page
("/repr?key=thing1")

186 
£lf
.
	`as£¹Body
(
	$»´
(
ch”rypy
.
lib
.
h‰put
.
»¥Ú£_codes
[404]))

188 
nÙ
 
	`g‘©Œ
(
ch”rypy
.
£rv”
, "usšg_­ache", 
F®£
):

189 #Th
objeù
 
ID
' wÚ'
t
 
m©ch
 
up
 
wh’
 
usšg
 
A·che
, 
sšû
 
the


190 #£rv” 
ªd
 
ş›Á
 
¬e
 
ruÂšg
 
š
 
difã»Á
 
´oûs£s
.

191 
£lf
.
	`g‘Page
("/repr?key=thing2")

192 
äom
 
ch”rypy
.
tutÜŸl
 
impÜt
 
thšg2


193 
£lf
.
	`as£¹Body
(
	$»´
(
thšg2
))

195 
£lf
.
	`g‘Page
("/repr?key=complex")

196 
£lf
.
	`as£¹Body
("(3+2j)")

198 
£lf
.
	`g‘Page
("/repr?key=mul")

199 
£lf
.
	`as£¹Body
("18")

201 
£lf
.
	`g‘Page
("/repr?key=stradd")

202 
£lf
.
	`as£¹Body
(
	`»´
("112233"))

204 
def
 
	$‹¡Re¥Name¥aûs
(
£lf
):

205 
£lf
.
	`g‘Page
("/foo/silly")

206 
£lf
.
	`as£¹H—d”
('X-silly', 'sillyval')

207 
£lf
.
	`as£¹Body
('Hello world')

209 
def
 
	$‹¡Cu¡omName¥aûs
(
£lf
):

210 
£lf
.
	`g‘Page
("/raw/incr?num=12")

211 
£lf
.
	`as£¹Body
("13")

213 
£lf
.
	`g‘Page
("/dbscheme")

214 
£lf
.
	`as£¹Body
(
r
"sqlite///memory")

216 
def
 
	$‹¡HªdËrToŞCÚfigOv”ride
(
£lf
):

217 #As£¹ 
th©
 
cÚfig
 
ov”rides
 
toŞ
 
cÚ¡ruùÜ
 
¬gs
. 
Above
, 
we
 
£t


218 #th
çvicÚ
 
š
 
the
 
·ge
 
hªdËr
 
to
 
be
 '../favicon.ico',

219 #buˆ
th’
 
ov”rode
 
™
 
š
 
cÚfig
 
to
 
be
 './static/dirback.jpg'.

220 
£lf
.
	`g‘Page
("/favicon.ico")

221 
£lf
.
	`as£¹Body
(
	`İ’
(
os
.
·th
.
	`još
(
loÿlDœ
, "static/dirback.jpg"),

222 "rb").
	$»ad
())

224 
def
 
	$‹¡_»que¡_body_Çme¥aû
(
£lf
):

225 
£lf
.
	`g‘Page
("/¶aš", 
m‘hod
='POST', 
h—d”s
=[

228 
body
=
	`Áob
('\xff\xfex\x00=\xff\xfea\x00b\x00c\x00'))

229 
£lf
.
	`as£¹Body
("abc")

232 
şass
 
	$V¬ŸbËSub¡™utiÚTe¡s
(
un™‹¡
.
Te¡Ca£
):

233 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

235 
def
 
	$‹¡_cÚfig
(
£lf
):

236 
äom
 
‹xtw¿p
 
impÜt
 
ded’t


238 #v¬ŸbË 
sub¡™utiÚ
 
w™h
 [
DEFAULT
]

239 
cÚf
 = 
	`ded’t
("""

240 [
DEFAULT
]

241 
dœ
 = "/some/dir"

242 
my
.
dœ
 = %(dœ)
s
 + "/sub"

244 [
my
]

245 
my
.
dœ
 = %(dœ)
s
 + "/my/dir"

246 
my
.
dœ2
 = %(my.
dœ
)
s
 + '/dir2'

250 
å
 = 
	$SŒšgIO
(
cÚf
)

252 
ch”rypy
.
cÚfig
.
	$upd©e
(
å
)

253 
£lf
.
	`as£¹Equ®
(
ch”rypy
.
cÚfig
["my"]["my.dir"], "/some/dir/my/dir")

254 
£lf
.
	`as£¹Equ®
(
ch”rypy
.
cÚfig
["my"]["my.dir2"], "/some/dir/my/dir/dir2")

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/test_config_server.py

3 
impÜt
 
	gos
, 
sys


4 
	gloÿlDœ
 = 
os
.
·th
.
još
(os.
g‘cwd
(), os.·th.
	$dœÇme
(
__fe__
))

5 
impÜt
 
sock‘


6 
impÜt
 
time


8 
impÜt
 
ch”rypy


11 #Cl›Á-
side
 
code
 #


12 
äom
 
ch”rypy
.
‹¡
 
impÜt
 
h–³r


14 
şass
 
	$S”v”CÚfigTe¡s
(
h–³r
.
CPWebCa£
):

16 
def
 
	$£tup_£rv”
():

18 
şass
 
RoÙ
:

19 
def
 
	$šdex
(
£lf
):

20  
ch”rypy
.
»que¡
.
wsgi_’vœÚ
['SERVER_PORT']

21 
šdex
.
expo£d
 = 
True


23 
def
 
	$u¶ßd
(
£lf
, 
fe
):

24  "Size: %s" % 
	`Ën
(
fe
.fe.
	$»ad
())

25 
u¶ßd
.
expo£d
 = 
True


27 
def
 
	$tšyu¶ßd
(
£lf
):

28  
ch”rypy
.
»que¡
.
body
.
	$»ad
()

29 
tšyu¶ßd
.
expo£d
 = 
True


30 
tšyu¶ßd
.
_ı_cÚfig
 = {'»que¡.body.maxby‹s': 100
	}
}

32 
ch”rypy
.
Œ“
.
mouÁ
(
	$RoÙ
())

34 
ch”rypy
.
cÚfig
.
	`upd©e
({

41 #Te¡ 
ex¶ic™
 
£rv”
.
š¡ªû


45 #Te¡ 
nÚ
-
num”ic
 <
£rv”Çme
>

46 #AlsØ
‹¡
  
£rv”
.
š¡ªû
 = 
butš
 server

48 
	}
})

49 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

51 
PORT
 = 9876

53 
def
 
	$‹¡BasicCÚfig
(
£lf
):

54 
£lf
.
	`g‘Page
("/")

55 
£lf
.
	`as£¹Body
(
	$¡r
(
£lf
.
PORT
))

57 
def
 
	$‹¡Add™iÚ®S”v”s
(
£lf
):

58 
£lf
.
scheme
 == 'https':

59  
£lf
.
	`sk
("not‡vailable under ssl")

60 
£lf
.
PORT
 = 9877

61 
£lf
.
	`g‘Page
("/")

62 
£lf
.
	`as£¹Body
(
	$¡r
(
£lf
.
PORT
))

63 
£lf
.
PORT
 = 9878

64 
£lf
.
	`g‘Page
("/")

65 
£lf
.
	`as£¹Body
(
	$¡r
(
£lf
.
PORT
))

67 
def
 
	$‹¡MaxReque¡SizeP”HªdËr
(
£lf
):

68 
	`g‘©Œ
(
ch”rypy
.
£rv”
, "usšg_­ache", 
F®£
):

69  
£lf
.
	`sk
("skipped dueo known Apache differences... ")

71 
£lf
.
	`g‘Page
('/tšyu¶ßd', 
m‘hod
="POST",

72 
h—d”s
=[('Content-Type', 'text/plain'),

74 
body
="x" * 100)

75 
£lf
.
	$as£¹Stus
(200)

76 
£lf
.
	`as£¹Body
("x" * 100)

78 
£lf
.
	`g‘Page
('/tšyu¶ßd', 
m‘hod
="POST",

79 
h—d”s
=[('Content-Type', 'text/plain'),

81 
body
="x" * 101)

82 
£lf
.
	$as£¹Stus
(413)

84 
def
 
	$‹¡MaxReque¡Size
(
£lf
):

85 
	`g‘©Œ
(
ch”rypy
.
£rv”
, "usšg_­ache", 
F®£
):

86  
£lf
.
	`sk
("skipped dueo known Apache differences... ")

88 
size
 
	$š
 (500, 5000, 50000):

89 
£lf
.
	`g‘Page
("/", 
h—d”s
=[('From', "x" * 500)])

90 
£lf
.
	$as£¹Stus
(413)

92 #Te¡ 
h‰p
:

93 #(
IncÜ»ù
 
bÜd”
 
cÚd™iÚ
 
š
 
»adlše
 
of
 
SizeCheckW¿µ”
).

94 #Thi 
hªgs
 
š
 
»v
 891 
ªd
 
—¾›r
.

95 
lšes256
 = "x" * 248

96 
£lf
.
	`g‘Page
("/",

97 
h—d”s
=[('Ho¡', '%s:%s' % (
£lf
.
HOST
, s–f.
PORT
)),

98 ('From', 
lšes256
)])

100 #Te¡ 
u¶ßd


101 
body
 = '\r\n'.
	`još
([

108 
·¹Ën
 = 200 - 
	$Ën
(
body
)

109 
b
 = 
body
 % ("x" * 
·¹Ën
)

110 
h
 = [("Content-type", "multipart/form-data; boundary=x"),

111 ("CÚ‹Á-L’gth", "%s" % 
	`Ën
(
b
))]

112 
£lf
.
	`g‘Page
('/u¶ßd', 
h
, "POST", 
b
)

113 
£lf
.
	`as£¹Body
('Size: %d' % 
·¹Ën
)

115 
b
 = 
body
 % ("x" * 200)

116 
h
 = [("Content-type", "multipart/form-data; boundary=x"),

117 ("CÚ‹Á-L’gth", "%s" % 
	`Ën
(
b
))]

118 
£lf
.
	`g‘Page
('/u¶ßd', 
h
, "POST", 
b
)

119 
£lf
.
	`as£¹Stus
(413)

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/test_conn.py

3 
impÜt
 
sock‘


4 
impÜt
 
sys


5 
impÜt
 
time


6 
	gtimeout
 = 1

9 
impÜt
 
ch”rypy


10 
äom
 
ch”rypy
.
_ıcom·t
 
impÜt
 
HTTPCÚÃùiÚ
, 
	gHTTPSCÚÃùiÚ
, 
	gNÙCÚÃùed
, 
BadStusLše


11 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
	gÁob
, 
	gu¾İ’
, 
unicode¡r


12 
äom
 
	gch”rypy
.
‹¡
 
impÜt
 
web‹¡


13 
äom
 
ch”rypy
 
impÜt
 
_ı”rÜ


16 
	gpov
 = 'pPeErRsSiIsStTeEnNcCeE oOfF vViIsSiIoOnN'

18 
def
 
	$£tup_£rv”
():

20 
def
 
	$¿i£500
():

21 
¿i£
 
ch”rypy
.
	$HTTPE¼Ü
(500)

23 
şass
 
RoÙ
:

25 
def
 
	$šdex
(
£lf
):

26  
pov


27 
šdex
.
expo£d
 = 
True


28 
·ge1
 = 
šdex


29 
·ge2
 = 
šdex


30 
·ge3
 = 
šdex


32 
def
 
	$h–lo
(
£lf
):

34 
h–lo
.
expo£d
 = 
True


36 
def
 
	$timeout
(
£lf
, 
t
):

37  
	$¡r
(
ch”rypy
.
£rv”
.
h‰p£rv”
.
timeout
)

38 
timeout
.
expo£d
 = 
True


40 
def
 
	$¡»am
(
£lf
, 
£t_ş
=
F®£
):

41 
£t_ş
:

42 
ch”rypy
.
»¥Ú£
.
h—d”s
['Content-Length'] = 10

44 
def
 
	$cÚ‹Á
():

45 
x
 
š
 
	$¿nge
(10):

46 
y›ld
 
	$¡r
(
x
)

48  
	$cÚ‹Á
()

49 
¡»am
.
expo£d
 = 
True


50 
¡»am
.
_ı_cÚfig
 = {'»¥Ú£.¡»am': 
True
}

52 
def
 
	$”rÜ
(
£lf
, 
code
=500):

53 
¿i£
 
ch”rypy
.
	$HTTPE¼Ü
(
code
)

54 
”rÜ
.
expo£d
 = 
True


56 
def
 
	$u¶ßd
(
£lf
):

57 
nÙ
 
ch”rypy
.
»que¡
.
m‘hod
 == 'POST':

58 
¿i£
 
	`As£¹iÚE¼Ü
("'POST' !=„equest.method %r" %

59 
ch”rypy
.
»que¡
.
m‘hod
)

60  "thªk fÜ '%s'" % 
ch”rypy
.
»que¡
.
body
.
	$»ad
()

61 
u¶ßd
.
expo£d
 = 
True


63 
def
 
	$cu¡om
(
£lf
, 
»¥Ú£_code
):

64 
ch”rypy
.
»¥Ú£
.
¡©us
 = 
»¥Ú£_code


65  "Codğ%s" % 
»¥Ú£_code


66 
cu¡om
.
expo£d
 = 
True


68 
def
 
	$”r_befÜe_»ad
(
£lf
):

70 
”r_befÜe_»ad
.
expo£d
 = 
True


71 
”r_befÜe_»ad
.
_ı_cÚfig
 = {'hooks.Ú_¡¬t_»sourû': 
¿i£500
}

73 
def
 
	$Úe_megaby‹_of_a
(
£lf
):

75 
Úe_megaby‹_of_a
.
expo£d
 = 
True


77 
def
 
	$cu¡om_ş
(
£lf
, 
body
, 
ş
):

78 
ch”rypy
.
»¥Ú£
.
h—d”s
['CÚ‹Á-L’gth'] = 
ş


79 
nÙ
 
	$isš¡ªû
(
body
, 
li¡
):

80 
body
 = [body]

81 
Ãwbody
 = []

82 
chunk
 
š
 
body
:

83 
	$isš¡ªû
(
chunk
, 
unicode¡r
):

84 
chunk
 = chunk.
	`’code
('ISO-8859-1')

85 
Ãwbody
.
	$­³nd
(
chunk
)

86  
Ãwbody


87 
cu¡om_ş
.
expo£d
 = 
True


88 #Tuº 
off
 
the
 
’codšg
 
toŞ
 
so
 
™
 
dÛns
't collapse

89 #ou¸
»¥Ú£
 
body
 
ªd
 
»şacuÏ‹
 
the
 
CÚ‹Á
-
L’gth
.

90 
cu¡om_ş
.
_ı_cÚfig
 = {'toŞs.’code.Ú': 
F®£
}

92 
ch”rypy
.
Œ“
.
mouÁ
(
	$RoÙ
())

93 
ch”rypy
.
cÚfig
.
	`upd©e
({

95 '£rv”.sock‘_timeout': 
timeout
,

96 
	}
})

99 
äom
 
ch”rypy
.
‹¡
 
impÜt
 
h–³r


101 
şass
 
	$CÚÃùiÚClo£Te¡s
(
h–³r
.
CPWebCa£
):

102 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

104 
def
 
	$‹¡_HTTP11
(
£lf
):

105 
ch”rypy
.
£rv”
.
´ÙocŞ_v”siÚ
 != "HTTP/1.1":

106  
£lf
.
	$sk
()

108 
£lf
.
PROTOCOL
 = "HTTP/1.1"

110 
£lf
.
³rsi¡’t
 = 
True


112 #Mak
the
 
fœ¡
 
»que¡
 
ªd
 
as£¹
 
th”e
's‚o "Connection: close".

113 
£lf
.
	`g‘Page
("/")

114 
£lf
.
	`as£¹Stus
('200 OK')

115 
£lf
.
	$as£¹Body
(
pov
)

116 
£lf
.
	`as£¹NoH—d”
("Connection")

118 #Mak
ªÙh”
 
»que¡
 
Ú
 
the
 
§me
 
cÚÃùiÚ
.

119 
£lf
.
	`g‘Page
("/page1")

120 
£lf
.
	`as£¹Stus
('200 OK')

121 
£lf
.
	$as£¹Body
(
pov
)

122 
£lf
.
	`as£¹NoH—d”
("Connection")

124 #Te¡ 
ş›Á
-
side
 
şo£
.

125 
£lf
.
	`g‘Page
("/·ge2", 
h—d”s
=[("Connection", "close")])

126 
£lf
.
	`as£¹Stus
('200 OK')

127 
£lf
.
	$as£¹Body
(
pov
)

128 
£lf
.
	`as£¹H—d”
("Connection", "close")

130 #Mak
ªÙh”
 
»que¡
 
Ú
 
the
 
§me
 
cÚÃùiÚ
, 
which
 
should
 
”rÜ
.

131 
£lf
.
	`as£¹Rai£s
(
NÙCÚÃùed
, s–f.
g‘Page
, "/")

133 
def
 
	$‹¡_SŒ—mšg_no_Ën
(
£lf
):

134 
£lf
.
	$_¡»amšg
(
£t_ş
=
F®£
)

136 
def
 
	$‹¡_SŒ—mšg_w™h_Ën
(
£lf
):

137 
£lf
.
	$_¡»amšg
(
£t_ş
=
True
)

139 
def
 
	$_¡»amšg
(
£lf
, 
£t_ş
):

140 
ch”rypy
.
£rv”
.
´ÙocŞ_v”siÚ
 == "HTTP/1.1":

141 
£lf
.
PROTOCOL
 = "HTTP/1.1"

143 
£lf
.
³rsi¡’t
 = 
True


145 #Mak
the
 
fœ¡
 
»que¡
 
ªd
 
as£¹
 
th”e
's‚o "Connection: close".

146 
£lf
.
	`g‘Page
("/")

147 
£lf
.
	`as£¹Stus
('200 OK')

148 
£lf
.
	$as£¹Body
(
pov
)

149 
£lf
.
	`as£¹NoH—d”
("Connection")

151 #Mak
ªÙh”
, 
¡»amed
 
»que¡
 
Ú
 
the
 
§me
 
cÚÃùiÚ
.

152 
£t_ş
:

153 #Wh’ 
a
 
CÚ‹Á
-
L’gth
 
is
 
´ovided
, 
the
 
cÚ‹Á
 
should
 
¡»am


154 #w™houˆ
şosšg
 
the
 
cÚÃùiÚ
.

155 
£lf
.
	`g‘Page
("/stream?set_cl=Yes")

156 
£lf
.
	`as£¹H—d”
("Content-Length")

157 
£lf
.
	`as£¹NoH—d”
("Connection", "close")

158 
£lf
.
	`as£¹NoH—d”
("Transfer-Encoding")

160 
£lf
.
	`as£¹Stus
('200 OK')

161 
£lf
.
	`as£¹Body
('0123456789')

163 #Wh’ 
no
 
CÚ‹Á
-
L’gth
 
»¥Ú£
 
h—d”
 
is
 
´ovided
,

164 #¡»amed 
ouut
 
wl
 
e™h”
 
şo£
 
the
 
cÚÃùiÚ
, 
Ü
 
u£


165 #chunked 
’codšg
, 
to
 
d‘”mše
 
Œªsãr
-
Ëngth
.

166 
£lf
.
	`g‘Page
("/stream")

167 
£lf
.
	`as£¹NoH—d”
("Content-Length")

168 
£lf
.
	`as£¹Stus
('200 OK')

169 
£lf
.
	`as£¹Body
('0123456789')

171 
chunked_»¥Ú£
 = 
F®£


172 
k
, 
v
 
š
 
£lf
.
h—d”s
:

173 
k
.
	`low”
() == "transfer-encoding":

174 
	`¡r
(
v
) == "chunked":

175 
chunked_»¥Ú£
 = 
True


177 
chunked_»¥Ú£
:

178 
£lf
.
	`as£¹NoH—d”
("Connection", "close")

180 
£lf
.
	`as£¹H—d”
("Connection", "close")

182 #Mak
ªÙh”
 
»que¡
 
Ú
 
the
 
§me
 
cÚÃùiÚ
, 
which
 
should
 
”rÜ
.

183 
£lf
.
	`as£¹Rai£s
(
NÙCÚÃùed
, s–f.
g‘Page
, "/")

185 #Try 
HEAD
. 
S“
 
h‰p
:

186 
£lf
.
	`g‘Page
("/¡»am", 
m‘hod
='HEAD')

187 
£lf
.
	`as£¹Stus
('200 OK')

188 
£lf
.
	`as£¹Body
('')

189 
£lf
.
	`as£¹NoH—d”
("Transfer-Encoding")

191 
£lf
.
PROTOCOL
 = "HTTP/1.0"

193 
£lf
.
³rsi¡’t
 = 
True


195 #Mak
the
 
fœ¡
 
»que¡
 
ªd
 
as£¹
 
K“p
-
Alive
.

196 
£lf
.
	`g‘Page
("/", 
h—d”s
=[("Connection", "Keep-Alive")])

197 
£lf
.
	`as£¹Stus
('200 OK')

198 
£lf
.
	$as£¹Body
(
pov
)

199 
£lf
.
	`as£¹H—d”
("Connection", "Keep-Alive")

201 #Mak
ªÙh”
, 
¡»amed
 
»que¡
 
Ú
 
the
 
§me
 
cÚÃùiÚ
.

202 
£t_ş
:

203 #Wh’ 
a
 
CÚ‹Á
-
L’gth
 
is
 
´ovided
, 
the
 
cÚ‹Á
 
should


204 #¡»am 
w™hout
 
şosšg
 
the
 
cÚÃùiÚ
.

205 
£lf
.
	`g‘Page
("/stream?set_cl=Yes",

206 
h—d”s
=[("Connection", "Keep-Alive")])

207 
£lf
.
	`as£¹H—d”
("Content-Length")

208 
£lf
.
	`as£¹H—d”
("Connection", "Keep-Alive")

209 
£lf
.
	`as£¹NoH—d”
("Transfer-Encoding")

210 
£lf
.
	`as£¹Stus
('200 OK')

211 
£lf
.
	`as£¹Body
('0123456789')

213 #Wh’ 
a
 
CÚ‹Á
-
L’gth
 
is
 
nÙ
 
´ovided
,

214 #th
£rv”
 
should
 
şo£
 
the
 
cÚÃùiÚ
.

215 
£lf
.
	`g‘Page
("/¡»am", 
h—d”s
=[("Connection", "Keep-Alive")])

216 
£lf
.
	`as£¹Stus
('200 OK')

217 
£lf
.
	`as£¹Body
('0123456789')

219 
£lf
.
	`as£¹NoH—d”
("Content-Length")

220 
£lf
.
	`as£¹NoH—d”
("Connection", "Keep-Alive")

221 
£lf
.
	`as£¹NoH—d”
("Transfer-Encoding")

223 #Mak
ªÙh”
 
»que¡
 
Ú
 
the
 
§me
 
cÚÃùiÚ
, 
which
 
should
 
”rÜ
.

224 
£lf
.
	`as£¹Rai£s
(
NÙCÚÃùed
, s–f.
g‘Page
, "/")

226 
def
 
	$‹¡_HTTP10_K“pAlive
(
£lf
):

227 
£lf
.
PROTOCOL
 = "HTTP/1.0"

228 
£lf
.
scheme
 == "https":

229 
£lf
.
HTTP_CONN
 = 
HTTPSCÚÃùiÚ


231 
£lf
.
HTTP_CONN
 = 
HTTPCÚÃùiÚ


233 #Te¡ 
a
 
nÜm®
 
HTTP
/1.0 
»que¡
.

234 
£lf
.
	`g‘Page
("/page2")

235 
£lf
.
	`as£¹Stus
('200 OK')

236 
£lf
.
	$as£¹Body
(
pov
)

237 #A·che, 
exam¶e
, 
may
 
em™
 
a
 
CÚÃùiÚ
 
h—d”
 
ev’
 
HTTP
/1.0

238 ## 
£lf
.
	`as£¹NoH—d”
("Connection")

240 #Te¡ 
a
 
k“p
-
®ive
 
HTTP
/1.0 
»que¡
.

241 
£lf
.
³rsi¡’t
 = 
True


243 
£lf
.
	`g‘Page
("/·ge3", 
h—d”s
=[("Connection", "Keep-Alive")])

244 
£lf
.
	`as£¹Stus
('200 OK')

245 
£lf
.
	$as£¹Body
(
pov
)

246 
£lf
.
	`as£¹H—d”
("Connection", "Keep-Alive")

248 #Remov
the
 
k“p
-
®ive
 
h—d”
 
agaš
.

249 
£lf
.
	`g‘Page
("/page3")

250 
£lf
.
	`as£¹Stus
('200 OK')

251 
£lf
.
	$as£¹Body
(
pov
)

252 #A·che, 
exam¶e
, 
may
 
em™
 
a
 
CÚÃùiÚ
 
h—d”
 
ev’
 
HTTP
/1.0

253 ## 
£lf
.
	`as£¹NoH—d”
("Connection")

256 
şass
 
	$P–šeTe¡s
(
h–³r
.
CPWebCa£
):

257 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

259 
def
 
	$‹¡_HTTP11_Timeout
(
£lf
):

260 #Ià
we
 
timeout
 
w™hout
 
£ndšg
 
ªy
 
d©a
,

261 #th
£rv”
 
wl
 
şo£
 
the
 
cÚn
 
w™h
 
a
 408.

262 
ch”rypy
.
£rv”
.
´ÙocŞ_v”siÚ
 != "HTTP/1.1":

263  
£lf
.
	$sk
()

265 
£lf
.
PROTOCOL
 = "HTTP/1.1"

267 #CÚÃù 
but
 
£nd
 
nÙhšg
.

268 
£lf
.
³rsi¡’t
 = 
True


269 
cÚn
 = 
£lf
.
HTTP_CONN


270 
cÚn
.
auto_İ’
 = 
F®£


271 
cÚn
.
	$cÚÃù
()

273 #Wa™ 
our
 
sock‘
 
timeout


274 
time
.
	$¦“p
(
timeout
 * 2)

276 #Th
»que¡
 
should
 
have
 
»tuºed
 408 
®»ady
.

277 
»¥Ú£
 = 
cÚn
.
	`»¥Ú£_şass
(cÚn.
sock
, 
m‘hod
="GET")

278 
»¥Ú£
.
	$begš
()

279 
£lf
.
	$as£¹Equ®
(
»¥Ú£
.
¡©us
, 408)

280 
cÚn
.
	$şo£
()

282 #CÚÃù 
but
 
£nd
 
h®f
 
the
 
h—d”s
 
Úly
.

283 
£lf
.
³rsi¡’t
 = 
True


284 
cÚn
 = 
£lf
.
HTTP_CONN


285 
cÚn
.
auto_İ’
 = 
F®£


286 
cÚn
.
	$cÚÃù
()

287 
cÚn
.
	`£nd
(
	`Áob
('GET /hello HTTP/1.1'))

288 
cÚn
.
	`£nd
(("Ho¡: %s" % 
£lf
.
HOST
).
	`’code
('ascii'))

290 #Wa™ 
our
 
sock‘
 
timeout


291 
time
.
	$¦“p
(
timeout
 * 2)

293 #Th
cÚn
 
should
 
have
 
®»ady
 
£Á
 408.

294 
»¥Ú£
 = 
cÚn
.
	`»¥Ú£_şass
(cÚn.
sock
, 
m‘hod
="GET")

295 
»¥Ú£
.
	$begš
()

296 
£lf
.
	$as£¹Equ®
(
»¥Ú£
.
¡©us
, 408)

297 
cÚn
.
	$şo£
()

299 
def
 
	$‹¡_HTTP11_Timeout_aá”_»que¡
(
£lf
):

300 #Ià
we
 
timeout
 
aá”
 
©
 
Ëa¡
 
Úe
 
»que¡
 
has
 
sucûeded
,

301 #th
£rv”
 
wl
 
şo£
 
the
 
cÚn
 
w™hout
 408.

302 
ch”rypy
.
£rv”
.
´ÙocŞ_v”siÚ
 != "HTTP/1.1":

303  
£lf
.
	$sk
()

305 
£lf
.
PROTOCOL
 = "HTTP/1.1"

307 #Mak
ª
 
š™Ÿl
 
»que¡


308 
£lf
.
³rsi¡’t
 = 
True


309 
cÚn
 = 
£lf
.
HTTP_CONN


310 
cÚn
.
	`puŒeque¡
("GET", "/timeout?t=%s" % 
timeout
, 
sk_ho¡
=
True
)

311 
cÚn
.
	`puth—d”
("Ho¡", 
£lf
.
HOST
)

312 
cÚn
.
	$’dh—d”s
()

313 
»¥Ú£
 = 
cÚn
.
	`»¥Ú£_şass
(cÚn.
sock
, 
m‘hod
="GET")

314 
»¥Ú£
.
	$begš
()

315 
£lf
.
	$as£¹Equ®
(
»¥Ú£
.
¡©us
, 200)

316 
£lf
.
body
 = 
»¥Ú£
.
	$»ad
()

317 
£lf
.
	`as£¹Body
(
	$¡r
(
timeout
))

319 #Mak
a
 
£cÚd
 
»que¡
 
Ú
 
the
 
§me
 
sock‘


320 
cÚn
.
	`_ouut
(
	`Áob
('GET /hello HTTP/1.1'))

321 
cÚn
.
	`_ouut
(
	`Áob
("Ho¡: %s" % 
£lf
.
HOST
, 'ascii'))

322 
cÚn
.
	$_£nd_ouut
()

323 
»¥Ú£
 = 
cÚn
.
	`»¥Ú£_şass
(cÚn.
sock
, 
m‘hod
="GET")

324 
»¥Ú£
.
	$begš
()

325 
£lf
.
	$as£¹Equ®
(
»¥Ú£
.
¡©us
, 200)

326 
£lf
.
body
 = 
»¥Ú£
.
	$»ad
()

327 
£lf
.
	`as£¹Body
("Hello, world!")

329 #Wa™ 
our
 
sock‘
 
timeout


330 
time
.
	$¦“p
(
timeout
 * 2)

332 #Mak
ªÙh”
 
»que¡
 
Ú
 
the
 
§me
 
sock‘
, 
which
 
should
 
”rÜ


333 
cÚn
.
	`_ouut
(
	`Áob
('GET /hello HTTP/1.1'))

334 
cÚn
.
	`_ouut
(
	`Áob
("Ho¡: %s" % 
£lf
.
HOST
, 'ascii'))

335 
cÚn
.
	$_£nd_ouut
()

336 
»¥Ú£
 = 
cÚn
.
	`»¥Ú£_şass
(cÚn.
sock
, 
m‘hod
="GET")

337 
Œy
:

338 
»¥Ú£
.
	$begš
()

339 
exû±
:

340 
nÙ
 
	`isš¡ªû
(
sys
.
	`exc_šfo
()[1],

341 (
sock‘
.
”rÜ
, 
BadStusLše
)):

342 
£lf
.
	`ç
("Writingoimed out socket didn't fail"

343 "‡ ™ should have: %s" % 
sys
.
	`exc_šfo
()[1])

345 
»¥Ú£
.
¡©us
 != 408:

346 
£lf
.
	`ç
("Writingoimed out socket didn't fail"

348 
»¥Ú£
.
	$»ad
())

350 
cÚn
.
	$şo£
()

352 #Mak
ªÙh”
 
»que¡
 
Ú
 
a
 
Ãw
 
sock‘
, 
which
 
should
 
wÜk


353 
£lf
.
³rsi¡’t
 = 
True


354 
cÚn
 = 
£lf
.
HTTP_CONN


355 
cÚn
.
	`puŒeque¡
("GET", "/", 
sk_ho¡
=
True
)

356 
cÚn
.
	`puth—d”
("Ho¡", 
£lf
.
HOST
)

357 
cÚn
.
	$’dh—d”s
()

358 
»¥Ú£
 = 
cÚn
.
	`»¥Ú£_şass
(cÚn.
sock
, 
m‘hod
="GET")

359 
»¥Ú£
.
	$begš
()

360 
£lf
.
	$as£¹Equ®
(
»¥Ú£
.
¡©us
, 200)

361 
£lf
.
body
 = 
»¥Ú£
.
	$»ad
()

362 
£lf
.
	$as£¹Body
(
pov
)

365 #Mak
ªÙh”
 
»que¡
 
Ú
 
the
 
§me
 
sock‘
,

366 #buˆ
timeout
 
Ú
 
the
 
h—d”s


367 
cÚn
.
	`£nd
(
	`Áob
('GET /hello HTTP/1.1'))

368 #Wa™ 
our
 
sock‘
 
timeout


369 
time
.
	$¦“p
(
timeout
 * 2)

370 
»¥Ú£
 = 
cÚn
.
	`»¥Ú£_şass
(cÚn.
sock
, 
m‘hod
="GET")

371 
Œy
:

372 
»¥Ú£
.
	$begš
()

373 
exû±
:

374 
nÙ
 
	`isš¡ªû
(
sys
.
	`exc_šfo
()[1],

375 (
sock‘
.
”rÜ
, 
BadStusLše
)):

376 
£lf
.
	`ç
("Writingoimed out socket didn't fail"

377 "‡ ™ should have: %s" % 
sys
.
	`exc_šfo
()[1])

379 
£lf
.
	`ç
("Writingoimed out socket didn't fail"

381 
»¥Ú£
.
	$»ad
())

383 
cÚn
.
	$şo£
()

385 #R‘ry 
the
 
»que¡
 
Ú
 
a
 
Ãw
 
cÚÃùiÚ
, 
which
 
should
 
wÜk


386 
£lf
.
³rsi¡’t
 = 
True


387 
cÚn
 = 
£lf
.
HTTP_CONN


388 
cÚn
.
	`puŒeque¡
("GET", "/", 
sk_ho¡
=
True
)

389 
cÚn
.
	`puth—d”
("Ho¡", 
£lf
.
HOST
)

390 
cÚn
.
	$’dh—d”s
()

391 
»¥Ú£
 = 
cÚn
.
	`»¥Ú£_şass
(cÚn.
sock
, 
m‘hod
="GET")

392 
»¥Ú£
.
	$begš
()

393 
£lf
.
	$as£¹Equ®
(
»¥Ú£
.
¡©us
, 200)

394 
£lf
.
body
 = 
»¥Ú£
.
	$»ad
()

395 
£lf
.
	$as£¹Body
(
pov
)

396 
cÚn
.
	$şo£
()

398 
def
 
	$‹¡_HTTP11_p–ššg
(
£lf
):

399 
ch”rypy
.
£rv”
.
´ÙocŞ_v”siÚ
 != "HTTP/1.1":

400  
£lf
.
	$sk
()

402 
£lf
.
PROTOCOL
 = "HTTP/1.1"

404 #Te¡ 
p–ššg
. 
h‰¶ib
 
dÛ¢
't supporthis directly.

405 
£lf
.
³rsi¡’t
 = 
True


406 
cÚn
 = 
£lf
.
HTTP_CONN


408 #Puˆ
»que¡
 1

409 
cÚn
.
	`puŒeque¡
("GET", "/h–lo", 
sk_ho¡
=
True
)

410 
cÚn
.
	`puth—d”
("Ho¡", 
£lf
.
HOST
)

411 
cÚn
.
	$’dh—d”s
()

413 
ŒŸl
 
š
 
	$¿nge
(5):

414 #Puˆ
Ãxt
 
»que¡


415 
cÚn
.
	`_ouut
(
	`Áob
('GET /hello HTTP/1.1'))

416 
cÚn
.
	`_ouut
(
	`Áob
("Ho¡: %s" % 
£lf
.
HOST
, 'ascii'))

417 
cÚn
.
	$_£nd_ouut
()

419 #R‘r›v
´evious
 
»¥Ú£


420 
»¥Ú£
 = 
cÚn
.
	`»¥Ú£_şass
(cÚn.
sock
, 
m‘hod
="GET")

421 
»¥Ú£
.
	$begš
()

422 
body
 = 
»¥Ú£
.
	$»ad
(13)

423 
£lf
.
	$as£¹Equ®
(
»¥Ú£
.
¡©us
, 200)

424 
£lf
.
	`as£¹Equ®
(
body
, 
	`Áob
("Hello, world!"))

426 #R‘r›v
fš®
 
»¥Ú£


427 
»¥Ú£
 = 
cÚn
.
	`»¥Ú£_şass
(cÚn.
sock
, 
m‘hod
="GET")

428 
»¥Ú£
.
	$begš
()

429 
body
 = 
»¥Ú£
.
	$»ad
()

430 
£lf
.
	$as£¹Equ®
(
»¥Ú£
.
¡©us
, 200)

431 
£lf
.
	`as£¹Equ®
(
body
, 
	`Áob
("Hello, world!"))

433 
cÚn
.
	$şo£
()

435 
def
 
	$‹¡_100_CÚtšue
(
£lf
):

436 
ch”rypy
.
£rv”
.
´ÙocŞ_v”siÚ
 != "HTTP/1.1":

437  
£lf
.
	$sk
()

439 
£lf
.
PROTOCOL
 = "HTTP/1.1"

441 
£lf
.
³rsi¡’t
 = 
True


442 
cÚn
 = 
£lf
.
HTTP_CONN


444 #Try 
a
 
·ge
 
w™hout
 
ª
 
Ex³ù
 
»que¡
 
h—d”
 
fœ¡
.

445 #NÙ
th©
 
h‰¶ib
's„esponse.begin‡utomatically ignores

446 #100 
CÚtšue
 
»¥Ú£s
, 
so
 
we
 
mu¡
 
mªu®ly
 
check
 
™
.

447 
cÚn
.
	`puŒeque¡
("POST", "/u¶ßd", 
sk_ho¡
=
True
)

448 
cÚn
.
	`puth—d”
("Ho¡", 
£lf
.
HOST
)

449 
cÚn
.
	`puth—d”
("Content-Type", "text/plain")

450 
cÚn
.
	`puth—d”
("Content-Length", "4")

451 
cÚn
.
	$’dh—d”s
()

452 
cÚn
.
	`£nd
(
	`Áob
("d'oh"))

453 
»¥Ú£
 = 
cÚn
.
	`»¥Ú£_şass
(cÚn.
sock
, 
m‘hod
="POST")

454 
v”siÚ
, 
¡©us
, 
»asÚ
 = 
»¥Ú£
.
	$_»ad_¡©us
()

455 
£lf
.
	$as£¹NÙEqu®
(
¡©us
, 100)

456 
cÚn
.
	$şo£
()

458 #Now 
Œy
 
a
 
·ge
 
w™h
 
ª
 
Ex³ù
 
h—d”
...

459 
cÚn
.
	$cÚÃù
()

460 
cÚn
.
	`puŒeque¡
("POST", "/u¶ßd", 
sk_ho¡
=
True
)

461 
cÚn
.
	`puth—d”
("Ho¡", 
£lf
.
HOST
)

462 
cÚn
.
	`puth—d”
("Content-Type", "text/plain")

463 
cÚn
.
	`puth—d”
("Content-Length", "17")

464 
cÚn
.
	`puth—d”
("Expect", "100-continue")

465 
cÚn
.
	$’dh—d”s
()

466 
»¥Ú£
 = 
cÚn
.
	`»¥Ú£_şass
(cÚn.
sock
, 
m‘hod
="POST")

468 #...
as£¹
 
ªd
 
th’
 
sk
 
the
 100 
»¥Ú£


469 
v”siÚ
, 
¡©us
, 
»asÚ
 = 
»¥Ú£
.
	$_»ad_¡©us
()

470 
£lf
.
	$as£¹Equ®
(
¡©us
, 100)

471 
True
:

472 
lše
 = 
»¥Ú£
.
å
.
	`»adlše
().
	$¡r
()

473 
lše
:

474 
£lf
.
	`ç
("100 CÚtšushould‚Ù ouuˆªy h—d”s. GÙ %r" % 
lše
)

478 #...
£nd
 
the
 
body


479 
body
 = 
	`Áob
("I‡m‡ small file")

480 
cÚn
.
	$£nd
(
body
)

482 #...
g‘
 
the
 
fš®
 
»¥Ú£


483 
»¥Ú£
.
	$begš
()

484 
£lf
.
¡©us
, s–f.
h—d”s
, s–f.
body
 = 
web‹¡
.
	$shb
(
»¥Ú£
)

485 
£lf
.
	$as£¹Stus
(200)

486 
£lf
.
	`as£¹Body
("thªk fÜ '%s'" % 
body
)

487 
cÚn
.
	$şo£
()

490 
şass
 
	$CÚÃùiÚTe¡s
(
h–³r
.
CPWebCa£
):

491 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

493 
def
 
	$‹¡_»ad®l_Ü_şo£
(
£lf
):

494 
ch”rypy
.
£rv”
.
´ÙocŞ_v”siÚ
 != "HTTP/1.1":

495  
£lf
.
	$sk
()

497 
£lf
.
PROTOCOL
 = "HTTP/1.1"

499 
£lf
.
scheme
 == "https":

500 
£lf
.
HTTP_CONN
 = 
HTTPSCÚÃùiÚ


502 
£lf
.
HTTP_CONN
 = 
HTTPCÚÃùiÚ


504 #Te¡ 
a
 
max
 
of
 0 (
the
 è
ªd
 
th’
 
»£t
 
to
 
wh©
 
™
 
was
 
above
.

505 
Şd_max
 = 
ch”rypy
.
£rv”
.
max_»que¡_body_size


506 
Ãw_max
 
	$š
 (0, 
Şd_max
):

507 
ch”rypy
.
£rv”
.
max_»que¡_body_size
 = 
Ãw_max


509 
£lf
.
³rsi¡’t
 = 
True


510 
cÚn
 = 
£lf
.
HTTP_CONN


512 #G‘ 
a
 
POST
 
·ge
 
w™h
 
ª
 
”rÜ


513 
cÚn
.
	`puŒeque¡
("POST", "/”r_befÜe_»ad", 
sk_ho¡
=
True
)

514 
cÚn
.
	`puth—d”
("Ho¡", 
£lf
.
HOST
)

515 
cÚn
.
	`puth—d”
("Content-Type", "text/plain")

516 
cÚn
.
	`puth—d”
("Content-Length", "1000")

517 
cÚn
.
	`puth—d”
("Expect", "100-continue")

518 
cÚn
.
	$’dh—d”s
()

519 
»¥Ú£
 = 
cÚn
.
	`»¥Ú£_şass
(cÚn.
sock
, 
m‘hod
="POST")

521 #...
as£¹
 
ªd
 
th’
 
sk
 
the
 100 
»¥Ú£


522 
v”siÚ
, 
¡©us
, 
»asÚ
 = 
»¥Ú£
.
	$_»ad_¡©us
()

523 
£lf
.
	$as£¹Equ®
(
¡©us
, 100)

524 
True
:

525 
sk
 = 
»¥Ú£
.
å
.
	`»adlše
().
	$¡r
()

526 
nÙ
 
sk
:

529 #...
£nd
 
the
 
body


530 
cÚn
.
	`£nd
(
	`Áob
("x" * 1000))

532 #...
g‘
 
the
 
fš®
 
»¥Ú£


533 
»¥Ú£
.
	$begš
()

534 
£lf
.
¡©us
, s–f.
h—d”s
, s–f.
body
 = 
web‹¡
.
	$shb
(
»¥Ú£
)

535 
£lf
.
	$as£¹Stus
(500)

537 #Now 
Œy
 
a
 
wÜkšg
 
·ge
 
w™h
 
ª
 
Ex³ù
 
h—d”
...

538 
cÚn
.
	`_ouut
(
	`Áob
('POST /upload HTTP/1.1'))

539 
cÚn
.
	`_ouut
(
	`Áob
("Ho¡: %s" % 
£lf
.
HOST
, 'ascii'))

540 
cÚn
.
	`_ouut
(
	`Áob
("Content-Type:ext/plain"))

541 
cÚn
.
	`_ouut
(
	`Áob
("Content-Length: 17"))

542 
cÚn
.
	`_ouut
(
	`Áob
("Expect: 100-continue"))

543 
cÚn
.
	$_£nd_ouut
()

544 
»¥Ú£
 = 
cÚn
.
	`»¥Ú£_şass
(cÚn.
sock
, 
m‘hod
="POST")

546 #...
as£¹
 
ªd
 
th’
 
sk
 
the
 100 
»¥Ú£


547 
v”siÚ
, 
¡©us
, 
»asÚ
 = 
»¥Ú£
.
	$_»ad_¡©us
()

548 
£lf
.
	$as£¹Equ®
(
¡©us
, 100)

549 
True
:

550 
sk
 = 
»¥Ú£
.
å
.
	`»adlše
().
	$¡r
()

551 
nÙ
 
sk
:

554 #...
£nd
 
the
 
body


555 
body
 = 
	`Áob
("I‡m‡ small file")

556 
cÚn
.
	$£nd
(
body
)

558 #...
g‘
 
the
 
fš®
 
»¥Ú£


559 
»¥Ú£
.
	$begš
()

560 
£lf
.
¡©us
, s–f.
h—d”s
, s–f.
body
 = 
web‹¡
.
	$shb
(
»¥Ú£
)

561 
£lf
.
	$as£¹Stus
(200)

562 
£lf
.
	`as£¹Body
("thªk fÜ '%s'" % 
body
)

563 
cÚn
.
	$şo£
()

565 
def
 
	$‹¡_No_Mes§ge_Body
(
£lf
):

566 
ch”rypy
.
£rv”
.
´ÙocŞ_v”siÚ
 != "HTTP/1.1":

567  
£lf
.
	$sk
()

569 
£lf
.
PROTOCOL
 = "HTTP/1.1"

571 #S‘ 
our
 
HTTP_CONN
 
to
 
ª
 
š¡ªû
 
so
 
™
 
³rsi¡s
 
b‘w“n
 
»que¡s
.

572 
£lf
.
³rsi¡’t
 = 
True


574 #Mak
the
 
fœ¡
 
»que¡
 
ªd
 
as£¹
 
th”e
's‚o "Connection: close".

575 
£lf
.
	`g‘Page
("/")

576 
£lf
.
	`as£¹Stus
('200 OK')

577 
£lf
.
	$as£¹Body
(
pov
)

578 
£lf
.
	`as£¹NoH—d”
("Connection")

580 #Mak
a
 204 
»que¡
 
Ú
 
the
 
§me
 
cÚÃùiÚ
.

581 
£lf
.
	`g‘Page
("/custom/204")

582 
£lf
.
	$as£¹Stus
(204)

583 
£lf
.
	`as£¹NoH—d”
("Content-Length")

584 
£lf
.
	`as£¹Body
("")

585 
£lf
.
	`as£¹NoH—d”
("Connection")

587 #Mak
a
 304 
»que¡
 
Ú
 
the
 
§me
 
cÚÃùiÚ
.

588 
£lf
.
	`g‘Page
("/custom/304")

589 
£lf
.
	$as£¹Stus
(304)

590 
£lf
.
	`as£¹NoH—d”
("Content-Length")

591 
£lf
.
	`as£¹Body
("")

592 
£lf
.
	`as£¹NoH—d”
("Connection")

594 
def
 
	$‹¡_Chunked_Encodšg
(
£lf
):

595 
ch”rypy
.
£rv”
.
´ÙocŞ_v”siÚ
 != "HTTP/1.1":

596  
£lf
.
	$sk
()

598 ià(
	`ha§‰r
(
£lf
, 'h¬Ãss'è
ªd


599 "modpythÚ" 
š
 
£lf
.
h¬Ãss
.
__şass__
.
__Çme__
.
	$low”
()):

600 #mod_pythÚ 
fÜbids
 
chunked
 
’codšg


601  
£lf
.
	$sk
()

603 
£lf
.
PROTOCOL
 = "HTTP/1.1"

605 #S‘ 
our
 
HTTP_CONN
 
to
 
ª
 
š¡ªû
 
so
 
™
 
³rsi¡s
 
b‘w“n
 
»que¡s
.

606 
£lf
.
³rsi¡’t
 = 
True


607 
cÚn
 = 
£lf
.
HTTP_CONN


609 #Try 
a
 
nÜm®
 
chunked
 
	`»que¡
 (
w™h
 
ex‹nsiÚs
)

610 
body
 = 
	`Áob
("8;key=value\r\nxx\r\nxxxx\r\n5\r\nyyyyy\r\n0\r\n"

613 
cÚn
.
	`puŒeque¡
("POST", "/u¶ßd", 
sk_ho¡
=
True
)

614 
cÚn
.
	`puth—d”
("Ho¡", 
£lf
.
HOST
)

615 
cÚn
.
	`puth—d”
("Transfer-Encoding", "chunked")

616 
cÚn
.
	`puth—d”
("Trailer", "Content-Type")

617 #NÙ
th©
 
this
 
is
 
somewh©
 
m®fÜmed
:

618 #w
shouldn
't be sending Content-Length.

619 #RFC 2616 
§ys
 
the
 
£rv”
 
should
 
ignÜe
 
™
.

620 
cÚn
.
	`puth—d”
("Content-Length", "3")

621 
cÚn
.
	$’dh—d”s
()

622 
cÚn
.
	$£nd
(
body
)

623 
»¥Ú£
 = 
cÚn
.
	$g‘»¥Ú£
()

624 
£lf
.
¡©us
, s–f.
h—d”s
, s–f.
body
 = 
web‹¡
.
	$shb
(
»¥Ú£
)

625 
£lf
.
	`as£¹Stus
('200 OK')

626 
£lf
.
	`as£¹Body
("thªk fÜ '%s'" % 
	`Áob
('xx\r\nxxxxyyyyy'))

628 #Try 
a
 
chunked
 
»que¡
 
th©
 
exûeds
 
£rv”
.
max_»que¡_body_size
.

629 #NÙ
th©
 
the
 
d–im™”s
 
ªd
 
Œa”
 
¬e
 
šşuded
.

630 
body
 = 
	`Áob
("3e3\r\n" + ("x" * 995) + "\r\n0\r\n\r\n")

631 
cÚn
.
	`puŒeque¡
("POST", "/u¶ßd", 
sk_ho¡
=
True
)

632 
cÚn
.
	`puth—d”
("Ho¡", 
£lf
.
HOST
)

633 
cÚn
.
	`puth—d”
("Transfer-Encoding", "chunked")

634 
cÚn
.
	`puth—d”
("Content-Type", "text/plain")

635 #Chunked 
»que¡s
 
dÚ
't‚eed‡ content-length

636 ## 
cÚn
.
	`puth—d”
("CÚ‹Á-L’gth", 
	`Ën
(
body
))

637 
cÚn
.
	$’dh—d”s
()

638 
cÚn
.
	$£nd
(
body
)

639 
»¥Ú£
 = 
cÚn
.
	$g‘»¥Ú£
()

640 
£lf
.
¡©us
, s–f.
h—d”s
, s–f.
body
 = 
web‹¡
.
	$shb
(
»¥Ú£
)

641 
£lf
.
	$as£¹Stus
(413)

642 
cÚn
.
	$şo£
()

644 
def
 
	$‹¡_CÚ‹Á_L’gth_š
(
£lf
):

645 #Try 
a
 
nÚ
-
chunked
 
»que¡
 
wh”e
 
CÚ‹Á
-
L’gth
 
exûeds


646 #£rv”.
max_»que¡_body_size
. 
As£¹
 
”rÜ
 
befÜe
 
body
 
£nd
.

647 
£lf
.
³rsi¡’t
 = 
True


648 
cÚn
 = 
£lf
.
HTTP_CONN


649 
cÚn
.
	`puŒeque¡
("POST", "/u¶ßd", 
sk_ho¡
=
True
)

650 
cÚn
.
	`puth—d”
("Ho¡", 
£lf
.
HOST
)

651 
cÚn
.
	`puth—d”
("Content-Type", "text/plain")

652 
cÚn
.
	`puth—d”
("Content-Length", "9999")

653 
cÚn
.
	$’dh—d”s
()

654 
»¥Ú£
 = 
cÚn
.
	$g‘»¥Ú£
()

655 
£lf
.
¡©us
, s–f.
h—d”s
, s–f.
body
 = 
web‹¡
.
	$shb
(
»¥Ú£
)

656 
£lf
.
	$as£¹Stus
(413)

657 
£lf
.
	`as£¹Body
("Theƒntity sent withhe„equestƒxceeds "

659 
cÚn
.
	$şo£
()

661 
def
 
	$‹¡_CÚ‹Á_L’gth_out_´eh—d”s
(
£lf
):

662 #Try 
a
 
nÚ
-
chunked
 
»¥Ú£
 
wh”e
 
CÚ‹Á
-
L’gth
 
is
 
Ëss
 
thª


663 #th
aùu®
 
by‹s
 
š
 
the
 
»¥Ú£
 
body
.

664 
£lf
.
³rsi¡’t
 = 
True


665 
cÚn
 = 
£lf
.
HTTP_CONN


666 
cÚn
.
	`puŒeque¡
("GET", "/custom_cl?body=I+have+too+many+bytes&cl=5",

667 
sk_ho¡
=
True
)

668 
cÚn
.
	`puth—d”
("Ho¡", 
£lf
.
HOST
)

669 
cÚn
.
	$’dh—d”s
()

670 
»¥Ú£
 = 
cÚn
.
	$g‘»¥Ú£
()

671 
£lf
.
¡©us
, s–f.
h—d”s
, s–f.
body
 = 
web‹¡
.
	$shb
(
»¥Ú£
)

672 
£lf
.
	$as£¹Stus
(500)

673 
£lf
.
	`as£¹Body
(

676 
cÚn
.
	$şo£
()

678 
def
 
	$‹¡_CÚ‹Á_L’gth_out_po¡h—d”s
(
£lf
):

679 #Try 
a
 
nÚ
-
chunked
 
»¥Ú£
 
wh”e
 
CÚ‹Á
-
L’gth
 
is
 
Ëss
 
thª


680 #th
aùu®
 
by‹s
 
š
 
the
 
»¥Ú£
 
body
.

681 
£lf
.
³rsi¡’t
 = 
True


682 
cÚn
 = 
£lf
.
HTTP_CONN


683 
cÚn
.
	`puŒeque¡
("GET", "/custom_cl?body=I+too&body=+have+too+many&cl=5",

684 
sk_ho¡
=
True
)

685 
cÚn
.
	`puth—d”
("Ho¡", 
£lf
.
HOST
)

686 
cÚn
.
	$’dh—d”s
()

687 
»¥Ú£
 = 
cÚn
.
	$g‘»¥Ú£
()

688 
£lf
.
¡©us
, s–f.
h—d”s
, s–f.
body
 = 
web‹¡
.
	$shb
(
»¥Ú£
)

689 
£lf
.
	$as£¹Stus
(200)

690 
£lf
.
	`as£¹Body
("Ioo")

691 
cÚn
.
	$şo£
()

693 
def
 
	$‹¡_598
(
£lf
):

694 
»mÙe_d©a_cÚn
 = 
	`u¾İ’
('%s://%s:%s/one_megabyte_of_a/' %

695 (
£lf
.
scheme
, s–f.
HOST
, s–f.
PORT
,))

696 
buf
 = 
»mÙe_d©a_cÚn
.
	$»ad
(512)

697 
time
.
	$¦“p
(
timeout
 * 0.6)

698 
»maššg
 = (1024 * 1024) - 512

699 
»maššg
:

700 
d©a
 = 
»mÙe_d©a_cÚn
.
	$»ad
(
»maššg
)

701 
nÙ
 
d©a
:

704 
buf
 +ğ
d©a


705 
»maššg
 -ğ
	$Ën
(
d©a
)

707 
£lf
.
	`as£¹Equ®
(
	`Ën
(
buf
), 1024 * 1024)

708 
£lf
.
	`as£¹Equ®
(
buf
, 
	`Áob
("a" * 1024 * 1024))

709 
£lf
.
	$as£¹Equ®
(
»maššg
, 0)

710 
»mÙe_d©a_cÚn
.
	$şo£
()

713 
şass
 
	$BadReque¡Te¡s
(
h–³r
.
CPWebCa£
):

714 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

716 
def
 
	$‹¡_No_CRLF
(
£lf
):

717 
£lf
.
³rsi¡’t
 = 
True


719 
cÚn
 = 
£lf
.
HTTP_CONN


720 
cÚn
.
	`£nd
(
	`Áob
('GET /hello HTTP/1.1\n\n'))

721 
»¥Ú£
 = 
cÚn
.
	`»¥Ú£_şass
(cÚn.
sock
, 
m‘hod
="GET")

722 
»¥Ú£
.
	$begš
()

723 
£lf
.
body
 = 
»¥Ú£
.
	$»ad
()

724 
£lf
.
	`as£¹Body
("HTTP„equires CRLFerminators")

725 
cÚn
.
	$şo£
()

727 
cÚn
.
	$cÚÃù
()

728 
cÚn
.
	`£nd
(
	`Áob
('GET /hello HTTP/1.1\r\n\n'))

729 
»¥Ú£
 = 
cÚn
.
	`»¥Ú£_şass
(cÚn.
sock
, 
m‘hod
="GET")

730 
»¥Ú£
.
	$begš
()

731 
£lf
.
body
 = 
»¥Ú£
.
	$»ad
()

732 
£lf
.
	`as£¹Body
("HTTP„equires CRLFerminators")

733 
cÚn
.
	`şo£
()

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/test_core.py

3 
impÜt
 
os


4 
	gloÿlDœ
 = 
os
.
·th
.
	$dœÇme
(
__fe__
)

5 
impÜt
 
sys


6 
impÜt
 
ty³s


8 
impÜt
 
ch”rypy


9 
äom
 
ch”rypy
.
_ıcom·t
 
impÜt
 
Incom¶‘eR—d
, 
™”v®ues
, 
Áob


10 
äom
 
ch”rypy
 
impÜt
 
_ıtoŞs
, 
toŞs


11 
äom
 
ch”rypy
.
lib
 
impÜt
 
h‰put
, 

14 
çvicÚ_·th
 = 
os
.
·th
.
	`još
(os.
	`g‘cwd
(), 
loÿlDœ
, "../favicon.ico")

16 #Cl›Á-
side
 
code
 #


17 
äom
 
ch”rypy
.
‹¡
 
impÜt
 
h–³r


19 
şass
 
	$CÜeReque¡HªdlšgTe¡
(
h–³r
.
CPWebCa£
):

21 
def
 
	$£tup_£rv”
():

22 
şass
 
RoÙ
:

24 
def
 
	$šdex
(
£lf
):

26 
šdex
.
expo£d
 = 
True


28 
çvicÚ_ico
 = 
toŞs
.
¡©icfe
.
	$hªdËr
(
f’ame
=
çvicÚ_·th
)

30 
def
 
	$defù
(
£lf
, 
Ãwù
):

31 
Ãwù
 = "text/%s" %‚ewct

32 
ch”rypy
.
cÚfig
.
	`upd©e
({'toŞs.»¥Ú£_h—d”s.Ú': 
True
,

34 [('CÚ‹Á-Ty³', 
Ãwù
)]
	}
})

35 
defù
.
expo£d
 = 
True


37 
def
 
	$ba£u¾
(
£lf
, 
·th_šfo
, 
»Ïtive
=
NÚe
):

38  
ch”rypy
.
	`u¾
(
·th_šfo
, 
»Ïtive
=
	$boŞ
(
»Ïtive
))

39 
ba£u¾
.
expo£d
 = 
True


41 
roÙ
 = 
	$RoÙ
()

43 
sys
.
v”siÚ_šfo
 >= (2, 5):

44 
äom
 
ch”rypy
.
‹¡
.
_‹¡_decÜ©Üs
 
impÜt
 
Expo£Exam¶es


45 
roÙ
.
expo£_dec
 = 
	$Expo£Exam¶es
()

48 
şass
 
	$Te¡Ty³
(
ty³
):

50 
ªd
 
adds
 
ª
 
š¡ªû
 
of
 
the
 
subşass
 
as
‡À
©Œibu‹
 oà
roÙ
.

52 
def
 
	$__š™__
(
şs
, 
Çme
, 
ba£s
, 
dù
):

53 
ty³
.
	$__š™__
(
şs
, 
Çme
, 
ba£s
, 
dù
)

54 
v®ue
 
š
 
	$™”v®ues
(
dù
):

55 
	$isš¡ªû
(
v®ue
, 
ty³s
.
FunùiÚTy³
):

56 
v®ue
.
expo£d
 = 
True


57 
	`£‰r
(
roÙ
, 
Çme
.
	`low”
(), 
	$şs
())

58 
Te¡
 = 
	`Te¡Ty³
('Te¡', (
objeù
, ), {
	}
})

61 
şass
 
	$URL
(
Te¡
):

63 
_ı_cÚfig
 = {'toŞs.Œašg_¦ash.Ú': 
F®£
}

65 
def
 
	$šdex
(
£lf
, 
·th_šfo
, 
»Ïtive
=
NÚe
):

66 
»Ïtive
 != 'server':

67 
»Ïtive
 = 
	$boŞ
(
»Ïtive
)

68  
ch”rypy
.
	$u¾
(
·th_šfo
, 
»Ïtive
=relative)

70 
def
 
	$Ëaf
(
£lf
, 
·th_šfo
, 
»Ïtive
=
NÚe
):

71 
»Ïtive
 != 'server':

72 
»Ïtive
 = 
	$boŞ
(
»Ïtive
)

73  
ch”rypy
.
	$u¾
(
·th_šfo
, 
»Ïtive
=relative)

76 
def
 
	$log_¡©us
():

77 
Stus
.
¡©u£s
.
	$­³nd
(
ch”rypy
.
»¥Ú£
.
¡©us
)

78 
ch”rypy
.
toŞs
.
log_¡©us
 = ch”rypy.
	`ToŞ
('on_end_resource',†og_status)

81 
şass
 
	$Stus
(
Te¡
):

83 
def
 
	$šdex
(
£lf
):

86 
def
 
	$bÏnk
(
£lf
):

87 
ch”rypy
.
»¥Ú£
.
¡©us
 = ""

89 #AccÜdšg 
to
 
RFC
 2616, 
Ãw
 
¡©us
 
codes
 
¬e
 
OK
 
as
 a 
they


90 #¬
b‘w“n
 100 
ªd
 599.

92 #H”
is
 
ª
 
Ëg®
 
code
...

93 
def
 
	$Ëg®
(
£lf
):

94 
ch”rypy
.
»¥Ú£
.
¡©us
 = 781

97 #...
ªd
 
h”e
 
is
 
ª
 
unknown
 
but
 
Ëg®
 
code
.

98 
def
 
	$unknown
(
£lf
):

99 
ch”rypy
.
»¥Ú£
.
¡©us
 = "431 My customƒrror"

102 #NÚ-
num”ic
 
code


103 
def
 
	$bad
(
£lf
):

104 
ch”rypy
.
»¥Ú£
.
¡©us
 = "error"

107 
¡©u£s
 = []

108 
def
 
	$Ú_’d_»sourû_¡age
(
£lf
):

109  
	$»´
(
£lf
.
¡©u£s
)

110 
Ú_’d_»sourû_¡age
.
_ı_cÚfig
 = {'toŞs.log_¡©us.Ú': 
True
}

113 
şass
 
	$Redœeù
(
Te¡
):

115 
şass
 
E¼Ü
:

116 
_ı_cÚfig
 = {"toŞs.”r_»dœeù.Ú": 
True
,

118 "toŞs.”r_»dœeù.š‹º®": 
F®£
,

119 
	}
}

121 
def
 
	$šdex
(
£lf
):

122 
¿i£
 
	`NameE¼Ü
("redirect_test")

123 
šdex
.
expo£d
 = 
True


124 
”rÜ
 = 
	$E¼Ü
()

126 
def
 
	$šdex
(
£lf
):

129 
def
 
	$cu¡om
(
£lf
, 
u¾
, 
code
):

130 
¿i£
 
ch”rypy
.
	$HTTPRedœeù
(
u¾
, 
code
)

132 
def
 
	$by_code
(
£lf
, 
code
):

133 
¿i£
 
ch”rypy
.
	`HTTPRedœeù
("somewh”e%20–£", 
code
)

134 
by_code
.
_ı_cÚfig
 = {'toŞs.Œašg_¦ash.exŒa': 
True
}

136 
def
 
	$nomodify
(
£lf
):

137 
¿i£
 
ch”rypy
.
	`HTTPRedœeù
("", 304)

139 
def
 
	$´oxy
(
£lf
):

140 
¿i£
 
ch”rypy
.
	`HTTPRedœeù
("proxy", 305)

142 
def
 
	$¡ršgify
(
£lf
):

143  
	`¡r
(
ch”rypy
.
	`HTTPRedœeù
("/"))

145 
def
 
	$äagm’t
(
£lf
, 
äag
):

146 
¿i£
 
ch”rypy
.
	`HTTPRedœeù
("/some/u¾#%s" % 
äag
)

148 
def
 
	$logš_»dœ
():

149 
nÙ
 
	`g‘©Œ
(
ch”rypy
.
»que¡
, "logš", 
NÚe
):

150 
¿i£
 
ch”rypy
.
	`IÁ”ÇlRedœeù
("/internalredirect/login")

151 
toŞs
.
logš_»dœ
 = 
_ıtoŞs
.
	`ToŞ
('before_handler',†ogin_redir)

153 
def
 
	$»dœ_cu¡om
():

154 
¿i£
 
ch”rypy
.
	`IÁ”ÇlRedœeù
("/internalredirect/custom_err")

156 
şass
 
	$IÁ”ÇlRedœeù
(
Te¡
):

158 
def
 
	$šdex
(
£lf
):

159 
¿i£
 
ch”rypy
.
	`IÁ”ÇlRedœeù
("/")

161 
def
 
	$choke
(
£lf
):

163 
choke
.
expo£d
 = 
True


164 
choke
.
_ı_cÚfig
 = {'hooks.befÜe_”rÜ_»¥Ú£': 
»dœ_cu¡om
}

166 
def
 
	$»Ïtive
(
£lf
, 
a
, 
b
):

167 
¿i£
 
ch”rypy
.
	`IÁ”ÇlRedœeù
("cousin?t=6")

169 
def
 
	$cousš
(
£lf
, 
t
):

170 
as£¹
 
ch”rypy
.
»que¡
.
´ev
.
şo£d


171  
ch”rypy
.
»que¡
.
´ev
.
qu”y_¡ršg


173 
def
 
	$³tshİ
(
£lf
, 
u£r_id
):

174 
u£r_id
 == "parrot":

175 #T¿d
™
 
a
 
¦ug
 
wh’
 
»dœeùšg


176 
¿i£
 
ch”rypy
.
	`IÁ”ÇlRedœeù
('/image/getImagesByUser?user_id=slug')

177 
–if
 
u£r_id
 == "terrier":

178 #T¿d
™
 
a
 
fish
 
wh’
 
»dœeùšg


179 
¿i£
 
ch”rypy
.
	`IÁ”ÇlRedœeù
('/image/getImagesByUser?user_id=fish')

181 #Thi 
should
 
·ss
 
the
 
u£r_id
 
through
 
to
 
g‘ImagesByU£r


182 
¿i£
 
ch”rypy
.
	`IÁ”ÇlRedœeù
(

183 '/image/g‘ImagesByU£r?u£r_id=%s' % 
	$¡r
(
u£r_id
))

185 #W
suµÜt
 
PythÚ
 2.3, 
but
 
the
 @-
deco
 
syÁax
 
would
 
look
 
like
 
this
:

186 #@
toŞs
.
	`logš_»dœ
()

187 
def
 
	$£cu»
(
£lf
):

189 
£cu»
 = 
toŞs
.
	$logš_»dœ
()(
£cu»
)

190 #Sšû 
ÿÎšg
 
the
 
toŞ
 
»tuºs
h
§me
 
funùiÚ
 
you
 
·ss
 
š
,

191 #you 
could
 
sk
 
bšdšg
 
the
  
v®ue
, 
ªd
 
ju¡
 
wr™e
:

192 #toŞs.
	`logš_»dœ
()(
£cu»
)

194 
def
 
	$logš
(
£lf
):

197 
def
 
	$cu¡om_”r
(
£lf
):

200 
def
 
	$—¾y_œ
(
£lf
, 
¬g
):

202 
—¾y_œ
.
_ı_cÚfig
 = {'hooks.befÜe_»que¡_body': 
»dœ_cu¡om
}

205 
şass
 
	$Image
(
Te¡
):

207 
def
 
	$g‘ImagesByU£r
(
£lf
, 
u£r_id
):

208  "0 image fÜ %s" % 
u£r_id


211 
şass
 
	$FÏ‰’
(
Te¡
):

213 
def
 
	$as_¡ršg
(
£lf
):

216 
def
 
	$as_li¡
(
£lf
):

219 
def
 
	$as_y›ld
(
£lf
):

220 
y›ld
 
	`Áob
("content")

222 
def
 
	$as_dbly›ld
(
£lf
):

223 
y›ld
 
£lf
.
	$as_y›ld
()

224 
as_dbly›ld
.
_ı_cÚfig
 = {'toŞs.æ©‹n.Ú': 
True
}

226 
def
 
	$as_»fy›ld
(
£lf
):

227 
chunk
 
š
 
£lf
.
	$as_y›ld
():

228 
y›ld
 
chunk


231 
şass
 
	$Rªges
(
Te¡
):

233 
def
 
	$g‘_¿nges
(
£lf
, 
by‹s
):

234  
	`»´
(
h‰put
.
	`g‘_¿nges
('by‹s=%s' % 
by‹s
, 8))

236 
def
 
	$¦iû_fe
(
£lf
):

237 
·th
 = 
os
.·th.
	`još
(os.
	`g‘cwd
(), os.·th.
	$dœÇme
(
__fe__
))

238  .
	`£rve_fe
(
os
.
·th
.
	`još
(path, "static/index.html"))

241 
şass
 
	$Cook›s
(
Te¡
):

243 
def
 
	$sšgË
(
£lf
, 
Çme
):

244 
cook›
 = 
ch”rypy
.
»que¡
.cook›[
Çme
]

245 #PythÚ2' Sim¶eCook›.__£t™em__ wÚ'
t
 
ke
 
unicode
 
keys
.

246 
ch”rypy
.
»¥Ú£
.
cook›
[
	`¡r
(
Çme
)] = cook›.
v®ue


248 
def
 
	$muÉË
(
£lf
, 
Çmes
):

249 
Çme
 
š
 
Çmes
:

250 
cook›
 = 
ch”rypy
.
»que¡
.cook›[
Çme
]

251 #PythÚ2' Sim¶eCook›.__£t™em__ wÚ'
t
 
ke
 
unicode
 
keys
.

252 
ch”rypy
.
»¥Ú£
.
cook›
[
	`¡r
(
Çme
)] = cook›.
v®ue


254 
def
 
	$­³nd_h—d”s
(
h—d”_li¡
, 
debug
=
F®£
):

255 
debug
:

256 
ch”rypy
.
	`log
(

257 "Ex‹ndšg„e¥Ú£ h—d” w™h %s" % 
	`»´
(
h—d”_li¡
),

259 
ch”rypy
.
£rvšg
.
»¥Ú£
.
h—d”_li¡
.
	$ex‹nd
(
h—d”_li¡
)

260 
ch”rypy
.
toŞs
.
­³nd_h—d”s
 = ch”rypy.
	`ToŞ
('on_end_resource',‡ppend_headers)

262 
şass
 
	$MuÉiH—d”
(
Te¡
):

264 
def
 
	$h—d”_li¡
(
£lf
):

265 
·ss


266 
h—d”_li¡
 = 
ch”rypy
.
toŞs
.
	`­³nd_h—d”s
(header_list=[

267 (
	`Áob
('WWW-Authenticate'),‚tob('Negotiate')),

268 (
	`Áob
('WWW-Authenticate'),‚tob('Basic„ealm="foo"')),

269 ])(
h—d”_li¡
)

271 
def
 
	$commas
(
£lf
):

272 
ch”rypy
.
»¥Ú£
.
h—d”s
['WWW-Authenticate'] = 'Negotiate,Basic„ealm="foo"'

275 
ch”rypy
.
Œ“
.
	$mouÁ
(
roÙ
)

276 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

279 
def
 
	$‹¡Stus
(
£lf
):

280 
£lf
.
	`g‘Page
("/status/")

281 
£lf
.
	`as£¹Body
('normal')

282 
£lf
.
	$as£¹Stus
(200)

284 
£lf
.
	`g‘Page
("/status/blank")

285 
£lf
.
	`as£¹Body
('')

286 
£lf
.
	$as£¹Stus
(200)

288 
£lf
.
	`g‘Page
("/status/illegal")

289 
£lf
.
	$as£¹Stus
(500)

290 
msg
 = "Illegal„esponse status from server (781 is out of„ange)."

291 
£lf
.
	$as£¹E¼ÜPage
(500, 
msg
)

293 
nÙ
 
	`g‘©Œ
(
ch”rypy
.
£rv”
, 'usšg_­ache', 
F®£
):

294 
£lf
.
	`g‘Page
("/status/unknown")

295 
£lf
.
	`as£¹Body
('funky')

296 
£lf
.
	$as£¹Stus
(431)

298 
£lf
.
	`g‘Page
("/status/bad")

299 
£lf
.
	$as£¹Stus
(500)

300 
msg
 = "Illegal„esponse status from server ('error' is‚on-numeric)."

301 
£lf
.
	$as£¹E¼ÜPage
(500, 
msg
)

303 
def
 
	$‹¡_Ú_’d_»sourû_¡©us
(
£lf
):

304 
£lf
.
	`g‘Page
('/status/on_end_resource_stage')

305 
£lf
.
	`as£¹Body
('[]')

306 
£lf
.
	`g‘Page
('/status/on_end_resource_stage')

307 
£lf
.
	`as£¹Body
(
	`»´
(["200 OK"]))

309 
def
 
	$‹¡SÏshes
(
£lf
):

310 #Te¡ 
th©
 
»que¡s
 
šdex
 
m‘hods
 
w™hout
 
a
 
Œašg
 
¦ash


311 #g‘ 
»dœeùed
 
to
 
the
 
§me
 
URI
 
·th
 
w™h
 
a
 
Œašg
 
¦ash
.

312 #Mak
su»
 
GET
 
·¿ms
 
¬e
 
´e£rved
.

313 
£lf
.
	`g‘Page
("/redirect?id=3")

314 
£lf
.
	$as£¹Stus
(301)

315 
£lf
.
	`as£¹InBody
("<a href='%s/redirect/?id=3'>"

316 "%s/»dœeù/?id=3</a>" % (
£lf
.
	`ba£
(), s–f.
	$ba£
()))

318 
£lf
.
	$´efix
():

319 #CÜÃ¸: 
the
 "Œašg sÏsh" 
»dœeù
 
could
 
be
 
Œicky
 

321 
£lf
.
	`g‘Page
("")

322 
£lf
.
	$as£¹Stus
(301)

323 
£lf
.
	`as£¹InBody
("<a href='%s/'>%s/</a>" %

324 (
£lf
.
	`ba£
(), s–f.
	$ba£
()))

326 #Te¡ 
th©
 
»que¡s
 
NON
-
šdex
 
m‘hods
 
WITH
 
a
 
Œašg
 
¦ash


327 #g‘ 
»dœeùed
 
to
 
the
 
§me
 
URI
 
·th
 
WITHOUT
 
a
 
Œašg
 
¦ash
.

328 #Mak
su»
 
GET
 
·¿ms
 
¬e
 
´e£rved
.

329 
£lf
.
	`g‘Page
("/redirect/by_code/?code=307")

330 
£lf
.
	$as£¹Stus
(301)

331 
£lf
.
	`as£¹InBody
("<a href='%s/redirect/by_code?code=307'>"

333 % (
£lf
.
	`ba£
(), s–f.
	$ba£
()))

335 #Ià
the
 
Œašg_¦ash
 
toŞ
 
is
 
off
, 
CP
 
should
 
ju¡
 

336 #a 
the
 
¦ashes
 
w”e
 
cÜ»ù
. 
But
 
™
 
Ãeds
 
some
 
h–p


337 #šsid
ch”rypy
.
u¾
 
to
 
fÜm
 
cÜ»ù
 
ouut
.

338 
£lf
.
	`g‘Page
('/url?path_info=page1')

339 
£lf
.
	`as£¹Body
('%s/u¾/·ge1' % s–f.
	$ba£
())

340 
£lf
.
	`g‘Page
('/url/leaf/?path_info=page1')

341 
£lf
.
	`as£¹Body
('%s/u¾/·ge1' % s–f.
	$ba£
())

343 
def
 
	$‹¡Redœeù
(
£lf
):

344 
£lf
.
	`g‘Page
("/redirect/")

345 
£lf
.
	`as£¹Body
('child')

346 
£lf
.
	$as£¹Stus
(200)

348 
£lf
.
	`g‘Page
("/redirect/by_code?code=300")

349 
£lf
.
	`as£¹M©chesBody
(
r
"<a href='(.*)somewhere%20else'>\1somewhere%20else</a>")

350 
£lf
.
	$as£¹Stus
(300)

352 
£lf
.
	`g‘Page
("/redirect/by_code?code=301")

353 
£lf
.
	`as£¹M©chesBody
(
r
"<a href='(.*)somewhere%20else'>\1somewhere%20else</a>")

354 
£lf
.
	$as£¹Stus
(301)

356 
£lf
.
	`g‘Page
("/redirect/by_code?code=302")

357 
£lf
.
	`as£¹M©chesBody
(
r
"<a href='(.*)somewhere%20else'>\1somewhere%20else</a>")

358 
£lf
.
	$as£¹Stus
(302)

360 
£lf
.
	`g‘Page
("/redirect/by_code?code=303")

361 
£lf
.
	`as£¹M©chesBody
(
r
"<a href='(.*)somewhere%20else'>\1somewhere%20else</a>")

362 
£lf
.
	$as£¹Stus
(303)

364 
£lf
.
	`g‘Page
("/redirect/by_code?code=307")

365 
£lf
.
	`as£¹M©chesBody
(
r
"<a href='(.*)somewhere%20else'>\1somewhere%20else</a>")

366 
£lf
.
	$as£¹Stus
(307)

368 
£lf
.
	`g‘Page
("/redirect/nomodify")

369 
£lf
.
	`as£¹Body
('')

370 
£lf
.
	$as£¹Stus
(304)

372 
£lf
.
	`g‘Page
("/redirect/proxy")

373 
£lf
.
	`as£¹Body
('')

374 
£lf
.
	$as£¹Stus
(305)

376 #HTTPRedœeù 
Ú
 
”rÜ


377 
£lf
.
	`g‘Page
("/redirect/error/")

378 
£lf
.
	`as£¹Stus
(('302 Found', '303 See Other'))

379 
£lf
.
	`as£¹InBody
('/errpage')

381 #Mak
su»
 
	`¡r
(
	`HTTPRedœeù
()è
wÜks
.

382 
£lf
.
	`g‘Page
("/»dœeù/¡ršgify", 
´ÙocŞ
="HTTP/1.0")

383 
£lf
.
	$as£¹Stus
(200)

384 
£lf
.
	`as£¹Body
("(['%s/'], 302)" % s–f.
	$ba£
())

385 
ch”rypy
.
£rv”
.
´ÙocŞ_v”siÚ
 == "HTTP/1.1":

386 
£lf
.
	`g‘Page
("/»dœeù/¡ršgify", 
´ÙocŞ
="HTTP/1.1")

387 
£lf
.
	$as£¹Stus
(200)

388 
£lf
.
	`as£¹Body
("(['%s/'], 303)" % s–f.
	$ba£
())

390 #check 
th©
 #äagm’t 
¬e
 
hªdËd
 
´İ”ly


392 
äag
 = "foo"

393 
£lf
.
	`g‘Page
("/»dœeù/äagm’t/%s" % 
äag
)

394 
£lf
.
	`as£¹M©chesBody
(
r
"<¨h»f='(.*)\/some\/u¾\#%s'>\1\/some\/u¾\#%s</a>" % (
äag
, frag))

395 
loc
 = 
£lf
.
	`as£¹H—d”
('Location')

396 
as£¹
 
loc
.
	`’dsw™h
("#%s" % 
äag
)

397 
£lf
.
	`as£¹Stus
(('302 Found', '303 See Other'))

399 #check 
šjeùiÚ
 
´ÙeùiÚ


400 #S“ 
h‰p
:

401 
£lf
.
	`g‘Page
("/redirect/custom?code=303&url=/foobar/%0d%0aSet-Cookie:%20somecookie=someval")

402 
£lf
.
	$as£¹Stus
(303)

403 
loc
 = 
£lf
.
	`as£¹H—d”
('Location')

404 
as£¹
 'S‘-Cook›' 
š
 
loc


405 
£lf
.
	`as£¹NoH—d”
('Set-Cookie')

407 
def
 
	$‹¡_IÁ”ÇlRedœeù
(
£lf
):

409 
£lf
.
	`g‘Page
("/internalredirect/")

410 
£lf
.
	`as£¹Body
('hello')

411 
£lf
.
	$as£¹Stus
(200)

413 #Te¡ 
·s¡hrough


414 
£lf
.
	`g‘Page
("/internalredirect/petshop?user_id=Sir-not-appearing-in-this-film")

415 
£lf
.
	`as£¹Body
('0 images for Sir-not-appearing-in-this-film')

416 
£lf
.
	$as£¹Stus
(200)

418 #Te¡ 
¬gs


419 
£lf
.
	`g‘Page
("/internalredirect/petshop?user_id=parrot")

420 
£lf
.
	`as£¹Body
('0 images for slug')

421 
£lf
.
	$as£¹Stus
(200)

423 #Te¡ 
POST


424 
£lf
.
	`g‘Page
("/š‹º®»dœeù/³tshİ", 
m‘hod
="POST",

425 
body
="user_id=terrier")

426 
£lf
.
	`as£¹Body
('0 images for fish')

427 
£lf
.
	$as£¹Stus
(200)

429 #Te¡ 
œ
 
befÜe
 
body
 
»ad


430 
£lf
.
	`g‘Page
("/š‹º®»dœeù/—¾y_œ", 
m‘hod
="POST",

431 
body
="arg=aha!")

432 
£lf
.
	`as£¹Body
("Something went horribly wrong.")

433 
£lf
.
	$as£¹Stus
(200)

435 
£lf
.
	`g‘Page
("/internalredirect/secure")

436 
£lf
.
	`as£¹Body
('Please†og in')

437 
£lf
.
	$as£¹Stus
(200)

439 #R–©iv
·th
 
š
 
IÁ”ÇlRedœeù
.

440 #AlsØ
‹¡s
 
»que¡
.
´ev
.

441 
£lf
.
	`g‘Page
("/internalredirect/relative?a=3&b=5")

442 
£lf
.
	`as£¹Body
("a=3&b=5")

443 
£lf
.
	$as£¹Stus
(200)

445 #IÁ”ÇlRedœeù 
Ú
 
”rÜ


446 
£lf
.
	`g‘Page
("/internalredirect/choke")

447 
£lf
.
	$as£¹Stus
(200)

448 
£lf
.
	`as£¹Body
("Something went horribly wrong.")

450 
def
 
	$‹¡FÏ‰’
(
£lf
):

451 
u¾
 
š
 ["/flatten/as_string", "/flatten/as_list",

454 
£lf
.
	$g‘Page
(
u¾
)

455 
£lf
.
	`as£¹Body
('content')

457 
def
 
	$‹¡Rªges
(
£lf
):

458 
£lf
.
	`g‘Page
("/ranges/get_ranges?bytes=3-6")

459 
£lf
.
	`as£¹Body
("[(3, 7)]")

461 #Te¡ 
muÉË
 
¿nges
 
ªd
 
a
 
suffix
-
by‹
-
¿nge
-
¥ec
, 
good
 
m—su»
.

462 
£lf
.
	`g‘Page
("/ranges/get_ranges?bytes=2-4,-1")

463 
£lf
.
	`as£¹Body
("[(2, 5), (7, 8)]")

465 #G‘ 
a
 
·¹Ÿl
 
fe
.

466 
ch”rypy
.
£rv”
.
´ÙocŞ_v”siÚ
 == "HTTP/1.1":

467 
£lf
.
	`g‘Page
("/ranges/slice_file", [('Range', 'bytes=2-5')])

468 
£lf
.
	$as£¹Stus
(206)

469 
£lf
.
	`as£¹H—d”
("Content-Type", "text/html;charset=utf-8")

470 
£lf
.
	`as£¹H—d”
("Content-Range", "bytes 2-5/14")

471 
£lf
.
	`as£¹Body
("llo,")

473 #Wh© 
h­³ns
 
w™h
 
ov”Ïµšg
 
	`¿nges
 (
ªd
 
out
 
of
 
Üd”
, 
too
)?

474 
£lf
.
	`g‘Page
("/ranges/slice_file", [('Range', 'bytes=4-6,2-5')])

475 
£lf
.
	$as£¹Stus
(206)

476 
ù
 = 
£lf
.
	`as£¹H—d”
("Content-Type")

477 
ex³ùed_ty³
 = "multipart/byteranges; boundary="

478 
£lf
.
	`as£¹_
(
ù
.
	$¡¬tsw™h
(
ex³ùed_ty³
))

479 
bound¬y
 = 
ù
[
	$Ën
(
ex³ùed_ty³
):]

480 
ex³ùed_body
 = ("\r\n--%s\r\n"

490 "--%s--\r\n" % (
bound¬y
, boundary, boundary))

491 
£lf
.
	$as£¹Body
(
ex³ùed_body
)

492 
£lf
.
	`as£¹H—d”
("Content-Length")

495 
£lf
.
	`g‘Page
("/ranges/slice_file", [('Range', 'bytes=2300-2900')])

496 
£lf
.
	$as£¹Stus
(416)

497 #"
Wh’
 
this
 
¡©us
 
code
 
is
 
»tuºed
 
a
 
by‹
-
¿nge
 
»que¡
,

498 #th
»¥Ú£
 
SHOULD
 
šşude
 
a
 
CÚ‹Á
-
Rªge
 
’t™y
-
h—d”


499 #f›ld 
¥ecifyšg
 
the
 
cu¼’t
 
Ëngth
 
of
h
£Ëùed
 
»sourû
"

500 
£lf
.
	`as£¹H—d”
("Content-Range", "bytes */14")

501 
–if
 
ch”rypy
.
£rv”
.
´ÙocŞ_v”siÚ
 == "HTTP/1.0":

502 #Te¡ 
Rªge
 
behaviÜ
 
w™h
 
HTTP
/1.0 
»que¡


503 
£lf
.
	`g‘Page
("/ranges/slice_file", [('Range', 'bytes=2-5')])

504 
£lf
.
	$as£¹Stus
(200)

505 
£lf
.
	`as£¹Body
("Hello, world\r\n")

507 
def
 
	$‹¡FavicÚ
(
£lf
):

508 #çvicÚ.
ico
 
is
 
£rved
 
by
 
¡©icfe
.

509 
icof’ame
 = 
os
.
·th
.
	`još
(
loÿlDœ
, "../favicon.ico")

510 
icofe
 = 
	`İ’
(
icof’ame
, "rb")

511 
d©a
 = 
icofe
.
	$»ad
()

512 
icofe
.
	$şo£
()

514 
£lf
.
	`g‘Page
("/favicon.ico")

515 
£lf
.
	$as£¹Body
(
d©a
)

517 
def
 
	$‹¡Cook›s
(
£lf
):

518 
sys
.
v”siÚ_šfo
 >= (2, 5):

519 
h—d”_v®ue
 = 
Ïmbda
 
x
: x

521 
h—d”_v®ue
 = 
Ïmbda
 
x
: x+';'

523 
£lf
.
	`g‘Page
("/cookies/single?name=First",

525 
£lf
.
	`as£¹H—d”
('S‘-Cook›', 
	`h—d”_v®ue
('First=Dinsdale'))

527 
£lf
.
	`g‘Page
("/cookies/multiple?names=First&names=Last",

530 
£lf
.
	`as£¹H—d”
('S‘-Cook›', 
	`h—d”_v®ue
('First=Dinsdale'))

531 
£lf
.
	`as£¹H—d”
('S‘-Cook›', 
	`h—d”_v®ue
('Last=Piranha'))

533 
£lf
.
	`g‘Page
("/cookies/single?name=Something-With:Colon",

535 
£lf
.
	$as£¹Stus
(400)

537 
def
 
	$‹¡DeçuÉCÚ‹ÁTy³
(
£lf
):

538 
£lf
.
	`g‘Page
('/')

539 
£lf
.
	`as£¹H—d”
('Content-Type', 'text/html;charset=utf-8')

540 
£lf
.
	`g‘Page
('/defct/plain')

541 
£lf
.
	`g‘Page
('/')

542 
£lf
.
	`as£¹H—d”
('Content-Type', 'text/plain;charset=utf-8')

543 
£lf
.
	`g‘Page
('/defct/html')

545 
def
 
	$‹¡_muÉË_h—d”s
(
£lf
):

546 
£lf
.
	`g‘Page
('/multiheader/header_list')

547 
£lf
.
	`as£¹Equ®
([(
k
, 
v
èk, v 
š
 s–f.
h—d”s
 k == 'WWW-Authenticate'],

551 
£lf
.
	`g‘Page
('/multiheader/commas')

552 
£lf
.
	`as£¹H—d”
('WWW-Authenticate', 'Negotiate,Basic„ealm="foo"')

554 
def
 
	$‹¡_ch”rypy_u¾
(
£lf
):

555 #IÅuˆ
»Ïtive
 
to
 
cu¼’t


556 
£lf
.
	`g‘Page
('/url/leaf?path_info=page1')

557 
£lf
.
	`as£¹Body
('%s/u¾/·ge1' % s–f.
	$ba£
())

558 
£lf
.
	`g‘Page
('/url/?path_info=page1')

559 
£lf
.
	`as£¹Body
('%s/u¾/·ge1' % s–f.
	$ba£
())

560 #Oth” 
ho¡
 
h—d”


561 
ho¡
 = 'www.mydomain.example'

562 
£lf
.
	`g‘Page
('/url/leaf?path_info=page1',

563 
h—d”s
=[('Ho¡', 
ho¡
)])

564 
£lf
.
	`as£¹Body
('%s://%s/u¾/·ge1' % (£lf.
scheme
, 
ho¡
))

566 #IÅuˆ
is
 'absŞu‹'; 
th©
 is, 
»Ïtive
 
to
 
süt_Çme


567 
£lf
.
	`g‘Page
('/url/leaf?path_info=/page1')

568 
£lf
.
	`as£¹Body
('%s/·ge1' % s–f.
	$ba£
())

569 
£lf
.
	`g‘Page
('/url/?path_info=/page1')

570 
£lf
.
	`as£¹Body
('%s/·ge1' % s–f.
	$ba£
())

572 #SšgË 
dÙs


573 
£lf
.
	`g‘Page
('/url/leaf?path_info=./page1')

574 
£lf
.
	`as£¹Body
('%s/u¾/·ge1' % s–f.
	$ba£
())

575 
£lf
.
	`g‘Page
('/url/leaf?path_info=other/./page1')

576 
£lf
.
	`as£¹Body
('%s/u¾/Ùh”/·ge1' % s–f.
	$ba£
())

577 
£lf
.
	`g‘Page
('/url/?path_info=/other/./page1')

578 
£lf
.
	`as£¹Body
('%s/Ùh”/·ge1' % s–f.
	$ba£
())

580 #DoubË 
dÙs


581 
£lf
.
	`g‘Page
('/url/leaf?path_info=../page1')

582 
£lf
.
	`as£¹Body
('%s/·ge1' % s–f.
	$ba£
())

583 
£lf
.
	`g‘Page
('/url/leaf?path_info=other/../page1')

584 
£lf
.
	`as£¹Body
('%s/u¾/·ge1' % s–f.
	$ba£
())

585 
£lf
.
	`g‘Page
('/url/leaf?path_info=/other/../page1')

586 
£lf
.
	`as£¹Body
('%s/·ge1' % s–f.
	$ba£
())

588 #Ouuˆ
»Ïtive
 
to
 
cu¼’t
 
·th
 
Ü
 
süt_Çme


589 
£lf
.
	`g‘Page
('/url/?path_info=page1&relative=True')

590 
£lf
.
	`as£¹Body
('page1')

591 
£lf
.
	`g‘Page
('/url/leaf?path_info=/page1&relative=True')

592 
£lf
.
	`as£¹Body
('../page1')

593 
£lf
.
	`g‘Page
('/url/leaf?path_info=page1&relative=True')

594 
£lf
.
	`as£¹Body
('page1')

595 
£lf
.
	`g‘Page
('/url/leaf?path_info=leaf/page1&relative=True')

596 
£lf
.
	`as£¹Body
('leaf/page1')

597 
£lf
.
	`g‘Page
('/url/leaf?path_info=../page1&relative=True')

598 
£lf
.
	`as£¹Body
('../page1')

599 
£lf
.
	`g‘Page
('/url/?path_info=other/../page1&relative=True')

600 
£lf
.
	`as£¹Body
('page1')

602 #Ouuˆ
»Ïtive
 
to
 /

603 
£lf
.
	`g‘Page
('/baseurl?path_info=ab&relative=True')

604 
£lf
.
	`as£¹Body
('ab')

605 #Ouuˆ
»Ïtive
 
to
 /

606 
£lf
.
	`g‘Page
('/baseurl?path_info=/ab&relative=True')

607 
£lf
.
	`as£¹Body
('ab')

609 #absŞu‹-
·th
 
	`»ã»nûs
 ("server-relative")

610 #IÅuˆ
»Ïtive
 
to
 
cu¼’t


611 
£lf
.
	`g‘Page
('/url/leaf?path_info=page1&relative=server')

612 
£lf
.
	`as£¹Body
('/url/page1')

613 
£lf
.
	`g‘Page
('/url/?path_info=page1&relative=server')

614 
£lf
.
	`as£¹Body
('/url/page1')

615 #IÅuˆ
is
 'absŞu‹'; 
th©
 is, 
»Ïtive
 
to
 
süt_Çme


616 
£lf
.
	`g‘Page
('/url/leaf?path_info=/page1&relative=server')

617 
£lf
.
	`as£¹Body
('/page1')

618 
£lf
.
	`g‘Page
('/url/?path_info=/page1&relative=server')

619 
£lf
.
	`as£¹Body
('/page1')

621 
def
 
	$‹¡_expo£_decÜ©Ü
(
£lf
):

622 
nÙ
 
sys
.
v”siÚ_šfo
 >= (2, 5):

623  
£lf
.
	`sk
("skipped (Python 2.5+ only) ")

625 #Te¡ @
expo£


626 
£lf
.
	`g‘Page
("/expose_dec/no_call")

627 
£lf
.
	$as£¹Stus
(200)

628 
£lf
.
	`as£¹Body
("Mr E. R. Bradshaw")

630 #Te¡ @
	`expo£
()

631 
£lf
.
	`g‘Page
("/expose_dec/call_empty")

632 
£lf
.
	$as£¹Stus
(200)

633 
£lf
.
	`as£¹Body
("Mrs. B.J. Smegma")

635 #Te¡ @
	`expo£
("alias")

636 
£lf
.
	`g‘Page
("/expose_dec/call_alias")

637 
£lf
.
	$as£¹Stus
(200)

638 
£lf
.
	`as£¹Body
("Mr Nesbitt")

639 #DÛ 
the
 
Üigš®
 
Çme
 
wÜk
?

640 
£lf
.
	`g‘Page
("/expose_dec/nesbitt")

641 
£lf
.
	$as£¹Stus
(200)

642 
£lf
.
	`as£¹Body
("Mr Nesbitt")

644 #Te¡ @
	`expo£
(["alias1", "alias2"])

645 
£lf
.
	`g‘Page
("/expose_dec/alias1")

646 
£lf
.
	$as£¹Stus
(200)

647 
£lf
.
	`as£¹Body
("Mr Ken Andrews")

648 
£lf
.
	`g‘Page
("/expose_dec/alias2")

649 
£lf
.
	$as£¹Stus
(200)

650 
£lf
.
	`as£¹Body
("Mr Ken Andrews")

651 #DÛ 
the
 
Üigš®
 
Çme
 
wÜk
?

652 
£lf
.
	`g‘Page
("/expose_dec/andrews")

653 
£lf
.
	$as£¹Stus
(200)

654 
£lf
.
	`as£¹Body
("Mr Ken Andrews")

656 #Te¡ @
	`expo£
(
®Ÿs
="alias")

657 
£lf
.
	`g‘Page
("/expose_dec/alias3")

658 
£lf
.
	$as£¹Stus
(200)

659 
£lf
.
	`as£¹Body
("Mr.‡nd Mrs. Watson")

662 
şass
 
	$E¼ÜTe¡s
(
h–³r
.
CPWebCa£
):

664 
def
 
	$£tup_£rv”
():

665 
def
 
	$b»ak_h—d”
():

666 #Add 
a
 
h—d”
 
aá”
 
fš®ize
 
th©
 
is
 
šv®id


667 
ch”rypy
.
£rvšg
.
»¥Ú£
.
h—d”_li¡
.
	`­³nd
((2, 3))

668 
ch”rypy
.
toŞs
.
b»ak_h—d”
 = ch”rypy.
	`ToŞ
('on_end_resource', break_header)

670 
şass
 
RoÙ
:

671 
def
 
	$šdex
(
£lf
):

673 
šdex
.
expo£d
 = 
True


675 
def
 
	$¡¬t_»¥Ú£_”rÜ
(
£lf
):

677 
¡¬t_»¥Ú£_”rÜ
.
_ı_cÚfig
 = {'toŞs.b»ak_h—d”.Ú': 
True
}

678 
roÙ
 = 
	$RoÙ
()

680 
ch”rypy
.
Œ“
.
	$mouÁ
(
roÙ
)

681 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

683 
def
 
	$‹¡_¡¬t_»¥Ú£_”rÜ
(
£lf
):

684 
£lf
.
	`g‘Page
("/start_response_error")

685 
£lf
.
	$as£¹Stus
(500)

686 
£lf
.
	`as£¹InBody
("TypeError:„esponse.header_list key 2 is‚ot‡ byte string.")

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/test_dynamicobjectmapping.py

1 
impÜt
 
ch”rypy


2 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
	gsÜ‹d
, 
unicode¡r


3 
äom
 
	gch”rypy
.
_ıŒ“
 
impÜt
 
AµliÿtiÚ


4 
äom
 
	gch”rypy
.
‹¡
 
impÜt
 
h–³r


6 
	gsüt_Çmes
 = ["", "/foo", "/users/fred/blog", "/corp/blog"]

10 
def
 
	$£tup_£rv”
():

11 
şass
 
SubSubRoÙ
:

12 
def
 
	$šdex
(
£lf
):

14 
šdex
.
expo£d
 = 
True


16 
def
 (
£lf
, *
¬gs
):

18 .
expo£d
 = 
True


20 
def
 
	$hªdËr
(
£lf
):

22 
hªdËr
.
expo£d
 = 
True


24 
def
 
	$di¥©ch
(
£lf
):

26 
di¥©ch
.
expo£d
 = 
True


28 
subsubnodes
 = {

29 '1': 
	`SubSubRoÙ
(),

30 '2': 
	`SubSubRoÙ
(),

31 
	}
}

33 
şass
 
SubRoÙ
:

34 
def
 
	$šdex
(
£lf
):

36 
šdex
.
expo£d
 = 
True


38 
def
 (
£lf
, *
¬gs
):

39  "SubRoÙ %s" % (
¬gs
,)

40 .
expo£d
 = 
True


42 
def
 
	$hªdËr
(
£lf
):

44 
hªdËr
.
expo£d
 = 
True


46 
def
 
	$_ı_di¥©ch
(
£lf
, 
v·th
):

47  
subsubnodes
.
	$g‘
(
v·th
[0], 
NÚe
)

49 
subnodes
 = {

50 '1': 
	`SubRoÙ
(),

51 '2': 
	`SubRoÙ
(),

52 
	}
}

53 
şass
 
RoÙ
:

54 
def
 
	$šdex
(
£lf
):

56 
šdex
.
expo£d
 = 
True


58 
def
 (
£lf
, *
¬gs
):

59  "deçuÉ %s" % (
¬gs
,)

60 .
expo£d
 = 
True


62 
def
 
	$hªdËr
(
£lf
):

64 
hªdËr
.
expo£d
 = 
True


66 
def
 
	$_ı_di¥©ch
(
£lf
, 
v·th
):

67  
subnodes
.
	$g‘
(
v·th
[0])

70 #DyÇmicNodeAndM‘hodDi¥©ch” 
exam¶e
.

71 #Thi 
exam¶e
 
expo£s
 
a
 
çœly
 
Çive
 
HTTP
 
­i


72 
şass
 
	$U£r
(
objeù
):

73 
def
 
	$__š™__
(
£lf
, 
id
, 
Çme
):

74 
£lf
.
id
 = id

75 
£lf
.
Çme
 =‚ame

77 
def
 
	$__unicode__
(
£lf
):

78  
	$unicode
(
£lf
.
Çme
)

79 
def
 
	$__¡r__
(
£lf
):

80  
	$¡r
(
£lf
.
Çme
)

82 
u£r_lookup
 = {

83 1: 
	`U£r
(1, 'foo'),

84 2: 
	`U£r
(2, 'bar'),

85 
	}
}

87 
def
 
	$make_u£r
(
Çme
, 
id
=
NÚe
):

88 
nÙ
 
id
:

89 
id
 = 
	`max
(*
	`li¡
(
u£r_lookup
.
	`keys
())) + 1

90 
u£r_lookup
[
id
] = 
	$U£r
(
id
, 
Çme
)

91  
id


93 
şass
 
	$U£rCÚš”Node
(
objeù
):

94 
expo£d
 = 
True


96 
def
 
	$POST
(
£lf
, 
Çme
):

98 
AÎow
 
the
 
ü—tiÚ
 
of
 
a
 
Ãw
 
Objeù


100  "POST %d" % 
	$make_u£r
(
Çme
)

102 
def
 
	$GET
(
£lf
):

103  
	`unicode¡r
(
	`sÜ‹d
(
u£r_lookup
.
	$keys
()))

105 
def
 
	$dyÇmic_di¥©ch
(
£lf
, 
v·th
):

106 
Œy
:

107 
id
 = (
v·th
[0])

108 
	$exû±
 (
V®ueE¼Ü
, 
IndexE¼Ü
):

109  
NÚe


110  
	$U£rIn¡ªûNode
(
id
)

112 
şass
 
	$U£rIn¡ªûNode
(
objeù
):

113 
expo£d
 = 
True


114 
def
 
	$__š™__
(
£lf
, 
id
):

115 
£lf
.
id
 = id

116 
£lf
.
u£r
 = 
u£r_lookup
.
	$g‘
(
id
, 
NÚe
)

118 #FÜ 
®l
 
but
 
PUT
 
m‘hods
 
th”e
 
MUST
 
be
 
a
 
v®id
 
u£r
 
id’tif›d


119 #by 
£lf
.
id


120 
nÙ
 
£lf
.
u£r
 
ªd
 
ch”rypy
.
»que¡
.
m‘hod
 != 'PUT':

121 
¿i£
 
ch”rypy
.
	$HTTPE¼Ü
(404)

123 
def
 
	$GET
(
£lf
, *
¬gs
, **
kw¬gs
):

125 
R‘uº
 
the
 
­´İrŸ‹
 
»´e£Á©iÚ
 
of
h
š¡ªû
.

127  
	$unicode¡r
(
£lf
.
u£r
)

129 
def
 
	$POST
(
£lf
, 
Çme
):

131 
Upd©e
 
the
 
f›lds
 
of
h
u£r
 
š¡ªû
.

133 
£lf
.
u£r
.
Çme
 =‚ame

134  "POST %d" % 
£lf
.
u£r
.
id


136 
def
 
	$PUT
(
£lf
, 
Çme
):

138 
C»©e
 
a
 
Ãw
 
u£r
 
w™h
 
the
 
¥ecif›d
 
id
, 
Ü
 
ed™
 
™
 ™ 
®»ady
 
exi¡s


140 
£lf
.
u£r
:

141 #Ed™ 
the
 
cu¼’t
 
u£r


142 
£lf
.
u£r
.
Çme
 =‚ame

143  "PUT %d" % 
£lf
.
u£r
.
id


145 #Mak
a
 
Ãw
 
u£r
 
w™h
 
§id
 
©Œibu‹s
.

146  "PUT %d" % 
	$make_u£r
(
Çme
, 
£lf
.
id
)

148 
def
 
	$DELETE
(
£lf
):

150 
D–‘e
 
the
 
u£r
 
¥ecif›d
 
©
h
id
.

152 
id
 = 
£lf
.
u£r
.id

153 
d–
 
u£r_lookup
[
£lf
.
u£r
.
id
]

154 
d–
 
£lf
.
u£r


155  "DELETE %d" % 
id


158 
şass
 
ABHªdËr
:

159 
şass
 
Cu¡omDi¥©ch
:

160 
def
 
	$šdex
(
£lf
, 
a
, 
b
):

162 
šdex
.
expo£d
 = 
True


164 
def
 
	$_ı_di¥©ch
(
£lf
, 
v·th
):

166 
´oûssšg
 
¡l
 
wÜks
.

168  
£lf
.
	$Cu¡omDi¥©ch
()

170 
def
 
	$šdex
(
£lf
, 
a
, 
b
=
NÚe
):

171 
body
 = [ 'a:' + 
	`¡r
(
a
) ]

172 
b
 
is
 
nÙ
 
NÚe
:

173 
body
.
	`­³nd
(',b:' + 
	$¡r
(
b
))

174  ''.
	$još
(
body
)

175 
šdex
.
expo£d
 = 
True


177 
def
 
	$d–‘e
(
£lf
, 
a
, 
b
):

178  'd–‘šg ' + 
	`¡r
(
a
è+ '‡nd ' + 
	$¡r
(
b
)

179 
d–‘e
.
expo£d
 = 
True


181 
şass
 
IndexOÆy
:

182 
def
 
	$_ı_di¥©ch
(
£lf
, 
v·th
):

184 
hªdËr
.

186 
v·th
:

187 
v·th
.
	$pİ
()

188  
£lf


190 
def
 
	$šdex
(
£lf
):

192 
šdex
.
expo£d
 = 
True


194 
şass
 
DecÜ©edPİArgs
:

196 
def
 
	$šdex
(
£lf
):

198 
šdex
.
expo£d
 = 
True


200 
def
 
	$hi
(
£lf
):

202 
hi
.
expo£d
 = 
True


203 
DecÜ©edPİArgs
 = 
ch”rypy
.
	`pİ¬gs
('a', 'b', 
hªdËr
=
	$ABHªdËr
())(
DecÜ©edPİArgs
)

205 
şass
 
NÚDecÜ©edPİArgs
:

208 
_ı_di¥©ch
 = 
ch”rypy
.
	`pİ¬gs
('a')

210 
def
 
	$šdex
(
£lf
, 
a
):

211  "šdex: " + 
	$¡r
(
a
)

212 
šdex
.
expo£d
 = 
True


214 
şass
 
P¬am‘”izedHªdËr
:

217 
def
 
	$__š™__
(
£lf
, 
a
):

218 
£lf
.
a
 =‡

220 
def
 
	$šdex
(
£lf
):

221 'a' 
š
 
ch”rypy
.
»que¡
.
·¿ms
:

222 
¿i£
 
	`Exû±iÚ
("Parameterized handler‡rgumentƒnded up in„equest.params")

223  
£lf
.
a


224 
šdex
.
expo£d
 = 
True


226 
şass
 
P¬am‘”izedPİArgs
:

228 
P¬am‘”izedPİArgs
 = 
ch”rypy
.
	`pİ¬gs
('a', 
hªdËr
=
P¬am‘”izedHªdËr
)(ParameterizedPopArgs)

230 
RoÙ
.
decÜ©ed
 = 
	$DecÜ©edPİArgs
()

231 
RoÙ
.
undecÜ©ed
 = 
	$NÚDecÜ©edPİArgs
()

232 
RoÙ
.
šdex_Úly
 = 
	$IndexOÆy
()

233 
RoÙ
.
·¿m‘”_‹¡
 = 
	$P¬am‘”izedPİArgs
()

235 
RoÙ
.
u£rs
 = 
	$U£rCÚš”Node
()

237 
md
 = 
ch”rypy
.
di¥©ch
.
	`M‘hodDi¥©ch”
('dynamic_dispatch')

238 
u¾
 
š
 
süt_Çmes
:

239 
cÚf
 = {'/': {

240 'u£r': (
u¾
 
Ü
 "/").
	`¥l™
("/")[-2],

243 '»que¡.di¥©ch': 
md


245 
	}
}

246 
ch”rypy
.
Œ“
.
mouÁ
(
RoÙ
(), 
u¾
, 
cÚf
)

248 
şass
 
	$DyÇmicObjeùM­pšgTe¡
(
h–³r
.
CPWebCa£
):

249 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

251 
def
 
	$‹¡ObjeùM­pšg
(
£lf
):

252 
u¾
 
š
 
süt_Çmes
:

253 
´efix
 = 
£lf
.
süt_Çme
 = 
u¾


255 
£lf
.
	`g‘Page
('/')

256 
£lf
.
	`as£¹Body
('index')

258 
£lf
.
	`g‘Page
('/handler')

259 
£lf
.
	`as£¹Body
('handler')

261 #DyÇmiø
di¥©ch
 
wl
 
sucûed
 
h”e
 
the
 
subnodes


262 #sØ
the
 
subroÙ
 
g‘s
 
ÿÎed


263 
£lf
.
	`g‘Page
('/1/')

264 
£lf
.
	`as£¹Body
('SubRoot index')

266 
£lf
.
	`g‘Page
('/2/')

267 
£lf
.
	`as£¹Body
('SubRoot index')

269 
£lf
.
	`g‘Page
('/1/handler')

270 
£lf
.
	`as£¹Body
('SubRoot handler')

272 
£lf
.
	`g‘Page
('/2/handler')

273 
£lf
.
	`as£¹Body
('SubRoot handler')

275 #DyÇmiø
di¥©ch
 
wl
 
ç
 
h”e
 
the
 
subnodes


276 #sØ
the
  
g‘s
 
ÿÎed


277 
£lf
.
	`g‘Page
('/asdf/')

278 
£lf
.
	`as£¹Body
("default ('asdf',)")

280 
£lf
.
	`g‘Page
('/asdf/asdf')

281 
£lf
.
	`as£¹Body
("default ('asdf', 'asdf')")

283 
£lf
.
	`g‘Page
('/asdf/handler')

284 
£lf
.
	`as£¹Body
("default ('asdf', 'handler')")

286 #DyÇmiø
di¥©ch
 
wl
 
sucûed
 
h”e
 
the
 
subsubnodes


287 #sØ
the
 
subsubroÙ
 
g‘s
 
ÿÎed


288 
£lf
.
	`g‘Page
('/1/1/')

289 
£lf
.
	`as£¹Body
('SubSubRoot index')

291 
£lf
.
	`g‘Page
('/2/2/')

292 
£lf
.
	`as£¹Body
('SubSubRoot index')

294 
£lf
.
	`g‘Page
('/1/1/handler')

295 
£lf
.
	`as£¹Body
('SubSubRoot handler')

297 
£lf
.
	`g‘Page
('/2/2/handler')

298 
£lf
.
	`as£¹Body
('SubSubRoot handler')

300 
£lf
.
	`g‘Page
('/2/2/dispatch')

301 
£lf
.
	`as£¹Body
('SubSubRoot dispatch')

303 #Th
expo£d
 
di¥©ch
 
wl
 
nÙ
 
be
 
ÿÎed
 
as
 
a
 dispatch

305 
£lf
.
	`g‘Page
('/2/2/foo/foo')

306 
£lf
.
	`as£¹Body
("SubSubRoot default")

308 #DyÇmiø
di¥©ch
 
wl
 
ç
 
h”e
 
the
 
subsubnodes


309 #sØ
the
 
SubRoÙ
 
g‘s
 
ÿÎed


310 
£lf
.
	`g‘Page
('/1/asdf/')

311 
£lf
.
	`as£¹Body
("SubRoot ('asdf',)")

313 
£lf
.
	`g‘Page
('/1/asdf/asdf')

314 
£lf
.
	`as£¹Body
("SubRoot ('asdf', 'asdf')")

316 
£lf
.
	`g‘Page
('/1/asdf/handler')

317 
£lf
.
	`as£¹Body
("SubRoot ('asdf', 'handler')")

319 
def
 
	$‹¡M‘hodDi¥©ch
(
£lf
):

320 #GET 
aùs
 
like
 
a
 
cÚš”


321 
£lf
.
	`g‘Page
("/users")

322 
£lf
.
	`as£¹Body
("[1, 2]")

323 
£lf
.
	`as£¹H—d”
('Allow', 'GET, HEAD, POST')

325 #POST 
to
 
the
 
cÚš”
 
URI
 
®lows
 
ü—tiÚ


326 
£lf
.
	`g‘Page
("/u£rs", 
m‘hod
="POST", 
body
="name=baz")

327 
£lf
.
	`as£¹Body
("POST 3")

328 
£lf
.
	`as£¹H—d”
('Allow', 'GET, HEAD, POST')

330 #POST 
to
 
a
 
¥ecific
 
š¡ªù
 
URI
 
»suÉs
 
š
‡ 404

331 #a 
the
 
»sourû
 
dÛs
 
nÙ
 
ex™
.

332 
£lf
.
	`g‘Page
("/u£rs/5", 
m‘hod
="POST", 
body
="name=baz")

333 
£lf
.
	$as£¹Stus
(404)

335 #PUT 
to
 
a
 
¥ecific
 
š¡ªù
 
URI
 
»suÉs
 
š
 
ü—tiÚ


336 
£lf
.
	`g‘Page
("/u£rs/5", 
m‘hod
="PUT", 
body
="name=boris")

337 
£lf
.
	`as£¹Body
("PUT 5")

338 
£lf
.
	`as£¹H—d”
('Allow', 'DELETE, GET, HEAD, POST, PUT')

340 #GET 
aùs
 
like
 
a
 
cÚš”


341 
£lf
.
	`g‘Page
("/users")

342 
£lf
.
	`as£¹Body
("[1, 2, 3, 5]")

343 
£lf
.
	`as£¹H—d”
('Allow', 'GET, HEAD, POST')

345 
‹¡_ÿ£s
 = (

351 
id
, 
Çme
, 
upd©edÇme
, 
h—d”s
 
š
 
‹¡_ÿ£s
:

352 
£lf
.
	`g‘Page
("/u£rs/%d" % 
id
)

353 
£lf
.
	$as£¹Body
(
Çme
)

354 
£lf
.
	`as£¹H—d”
('AÎow', 
h—d”s
)

356 #Mak
su»
 
POSTs
 
upd©e
 
®»ady
 
exi¡šgs
 
»sourûs


357 
£lf
.
	`g‘Page
("/u£rs/%d" % 
id
, 
m‘hod
='POST', 
body
="Çme=%s" % 
upd©edÇme
)

358 
£lf
.
	`as£¹Body
("POST %d" % 
id
)

359 
£lf
.
	`as£¹H—d”
('AÎow', 
h—d”s
)

361 #Mak
su»
 
PUTs
 
Upd©e
 
®»ady
 
exi¡šg
 
»sourûs
.

362 
£lf
.
	`g‘Page
("/u£rs/%d" % 
id
, 
m‘hod
='PUT', 
body
="Çme=%s" % 
upd©edÇme
)

363 
£lf
.
	`as£¹Body
("PUT %d" % 
id
)

364 
£lf
.
	`as£¹H—d”
('AÎow', 
h—d”s
)

366 #Mak
su»
 
DELETES
 
Remove
 
®»ady
 
exi¡šg
 
»sourûs
.

367 
£lf
.
	`g‘Page
("/u£rs/%d" % 
id
, 
m‘hod
='DELETE')

368 
£lf
.
	`as£¹Body
("DELETE %d" % 
id
)

369 
£lf
.
	`as£¹H—d”
('AÎow', 
h—d”s
)

372 #GET 
aùs
 
like
 
a
 
cÚš”


373 
£lf
.
	`g‘Page
("/users")

374 
£lf
.
	`as£¹Body
("[]")

375 
£lf
.
	`as£¹H—d”
('Allow', 'GET, HEAD, POST')

377 
def
 
	$‹¡V·thDi¥©ch
(
£lf
):

378 
£lf
.
	`g‘Page
("/decorated/")

379 
£lf
.
	`as£¹Body
("no…arams")

381 
£lf
.
	`g‘Page
("/decorated/hi")

382 
£lf
.
	`as£¹Body
("hi was‚ot interpreted‡s 'a'…aram")

384 
£lf
.
	`g‘Page
("/decorated/yo/")

385 
£lf
.
	`as£¹Body
("a:yo")

387 
£lf
.
	`g‘Page
("/decorated/yo/there/")

388 
£lf
.
	`as£¹Body
("a:yo,b:there")

390 
£lf
.
	`g‘Page
("/decorated/yo/there/delete")

391 
£lf
.
	`as£¹Body
("deleting yo‡ndhere")

393 
£lf
.
	`g‘Page
("/decorated/yo/there/handled_by_dispatch/")

394 
£lf
.
	`as£¹Body
("custom")

396 
£lf
.
	`g‘Page
("/undecorated/blah/")

397 
£lf
.
	`as£¹Body
("index: blah")

399 
£lf
.
	`g‘Page
("/index_only/a/b/c/d/e/f/g/")

400 
£lf
.
	`as£¹Body
("IndexOnly index")

402 
£lf
.
	`g‘Page
("/parameter_test/argument2/")

403 
£lf
.
	`as£¹Body
("argument2")

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/test_encoding.py

2 
impÜt
 
gz


3 
impÜt
 
sys


5 
impÜt
 
ch”rypy


6 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
	gBy‹sIO
, 
	gIncom¶‘eR—d
, 
	gÁob
, 
Áou


8 
	geurİoundUnicode
 = 
Áou
('\x80\xa3')

9 
sšg
 = 
Áou
("\u6bdb\u6cfd\u4e1c: Sing, Little Birdie?", 'escape')

10 
	gsšg8
 = 
sšg
.
’code
('utf-8')

11 
sšg16
 = 
sšg
.
’code
('utf-16')

14 
äom
 
ch”rypy
.
‹¡
 
impÜt
 
h–³r


17 
şass
 
	$EncodšgTe¡s
(
h–³r
.
CPWebCa£
):

19 
def
 
	$£tup_£rv”
():

20 
şass
 
RoÙ
:

21 
def
 
	$šdex
(
£lf
, 
·¿m
):

22 
as£¹
 
·¿m
 =ğ
eurİoundUnicode
, "%r != %r" % (param,ƒuropoundUnicode)

23 
y›ld
 
eurİoundUnicode


24 
šdex
.
expo£d
 = 
True


26 
def
 
	$mao_zedÚg
(
£lf
):

27  
sšg


28 
mao_zedÚg
.
expo£d
 = 
True


30 
def
 
	$utf8
(
£lf
):

31  
sšg8


32 
utf8
.
expo£d
 = 
True


33 
utf8
.
_ı_cÚfig
 = {'toŞs.’code.’codšg': 'utf-8'
	}
}

35 
def
 
	$cook›s_ªd_h—d”s
(
£lf
):

36 #ià
the
 
h—d”s
 
have
 
nÚ
-
ascii
 
ch¬aù”s
 
ªd
 
a
 
cook›
 
has


37 #ªy 
·¹
 
which
 
is
 
	`unicode
 (
ev’
 
ascii
), 
the
 
»¥Ú£


38 #should 
nÙ
 
ç
.

39 
ch”rypy
.
»¥Ú£
.
cook›
['candy'] = 'bar'

40 
ch”rypy
.
»¥Ú£
.
cook›
['candy']['domain'] = 'cherrypy.org'

41 
ch”rypy
.
»¥Ú£
.
h—d”s
['Some-Header'] = 'My d\xc3\xb6g has fleas'

43 
cook›s_ªd_h—d”s
.
expo£d
 = 
True


45 
def
 
	$»q·¿ms
(
£lf
, *
¬gs
, **
kw¬gs
):

46  
	`Áob
(', ').
	`još
([": ".još((
k
, 
v
)).
	`’code
('utf8')

47 
k
, 
v
 
š
 
ch”rypy
.
»que¡
.
·¿ms
.
	`™ems
()])

48 
»q·¿ms
.
expo£d
 = 
True


50 
def
 
	$nÚ‹xt
(
£lf
, *
¬gs
, **
kw¬gs
):

51 
ch”rypy
.
»¥Ú£
.
h—d”s
['Content-Type'] = 'application/binary'

53 
nÚ‹xt
.
expo£d
 = 
True


54 
nÚ‹xt
.
_ı_cÚfig
 = {'toŞs.’code.‹xt_Úly': 
F®£
,

55 'toŞs.’code.add_ch¬£t': 
True
,

56 
	}
}

58 
şass
 
GZIP
:

59 
def
 
	$šdex
(
£lf
):

60 
y›ld
 "Hello, world"

61 
šdex
.
expo£d
 = 
True


63 
def
 
	$noshow
(
£lf
):

64 #Te¡ 
tick‘
 #147, 
wh”e
 
y›ld
 
showed
 
no
 
	`exû±iÚs
 (
cÚ‹Á
-

65 #’codšg 
was
 
¡l
 
gz
 
ev’
 
though
 
Œaûback
 
wa¢
't zipped).

66 
¿i£
 
	$IndexE¼Ü
()

67 
y›ld
 "Here be dragons"

68 
noshow
.
expo£d
 = 
True


69 #Tuº 
’codšg
 
off
 
so
 
the
 
gz
 
toŞ
 
is
h
Úe
 
došg
h
cŞÏp£
.

70 
noshow
.
_ı_cÚfig
 = {'toŞs.’code.Ú': 
F®£
}

72 
def
 
	$noshow_¡»am
(
£lf
):

73 #Te¡ 
tick‘
 #147, 
wh”e
 
y›ld
 
showed
 
no
 
	`exû±iÚs
 (
cÚ‹Á
-

74 #’codšg 
was
 
¡l
 
gz
 
ev’
 
though
 
Œaûback
 
wa¢
't zipped).

75 
¿i£
 
	$IndexE¼Ü
()

76 
y›ld
 "Here be dragons"

77 
noshow_¡»am
.
expo£d
 = 
True


78 
noshow_¡»am
.
_ı_cÚfig
 = {'»¥Ú£.¡»am': 
True
}

80 
şass
 
Decode
:

81 
def
 
	$exŒa_ch¬£t
(
£lf
, *
¬gs
, **
kw¬gs
):

82  ', '.
	`još
([": ".još((
k
, 
v
))

83 
k
, 
v
 
š
 
ch”rypy
.
»que¡
.
·¿ms
.
	`™ems
()])

84 
exŒa_ch¬£t
.
expo£d
 = 
True


85 
exŒa_ch¬£t
.
_ı_cÚfig
 = {

86 'toŞs.decode.Ú': 
True
,

88 
	}
}

90 
def
 
	$fÜû_ch¬£t
(
£lf
, *
¬gs
, **
kw¬gs
):

91  ', '.
	`još
([": ".još((
k
, 
v
))

92 
k
, 
v
 
š
 
ch”rypy
.
»que¡
.
·¿ms
.
	`™ems
()])

93 
fÜû_ch¬£t
.
expo£d
 = 
True


94 
fÜû_ch¬£t
.
_ı_cÚfig
 = {

95 'toŞs.decode.Ú': 
True
,

97 
	}
}

99 
roÙ
 = 
	$RoÙ
()

100 
roÙ
.
gz
 = 
	$GZIP
()

101 
roÙ
.
decode
 = 
	$Decode
()

102 
ch”rypy
.
Œ“
.
	`mouÁ
(
roÙ
, 
cÚfig
={'/gz': {'toŞs.gz.Ú': 
True
}
	}
})

103 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

105 
def
 
	$‹¡_qu”y_¡ršg_decodšg
(
£lf
):

106 
eurİoundUtf8
 = 
eurİoundUnicode
.
	`’code
('utf-8')

107 
£lf
.
	`g‘Page
(
	`Áob
('/?·¿m='è+ 
eurİoundUtf8
)

108 
£lf
.
	$as£¹Body
(
eurİoundUtf8
)

110 #Encoded 
utf8
 
qu”y
 
¡ršgs
 
MUST
 
be
 
·r£d
 
cÜ»ùly
.

111 #H”e, 
q
 
is
 
the
 
POUND
 
SIGN
 
U
+00A3 
’coded
 
š
 
utf8
 
ªd
 
th’
 %
HEX


112 
£lf
.
	`g‘Page
("/reqparams?q=%C2%A3")

113 #Th 
v®ue
 
wl
 
be
 
’coded
 
as
 
utf8
.

114 
£lf
.
	`as£¹Body
(
	`Áob
("q: \xc2\xa3"))

116 #Qu”y 
¡ršgs
 
th©
 
¬e
 
šcÜ»ùly
 
’coded
 
MUST
 
¿i£
 404.

117 #H”e, 
q
 
is
 
the
 
POUND
 
SIGN
 
U
+00A3 
’coded
 
š
 
Ïtš1
 
ªd
 
th’
 %
HEX


118 
£lf
.
	`g‘Page
("/reqparams?q=%A3")

119 
£lf
.
	$as£¹Stus
(404)

120 
£lf
.
	`as£¹E¼ÜPage
(404,

124 
def
 
	$‹¡_u¾’coded_decodšg
(
£lf
):

125 #Te¡ 
the
 
decodšg
 
of
 
ª
 
­¶iÿtiÚ
/
x
-
www
-
fÜm
-
u¾’coded
 
’t™y
.

126 
eurİoundUtf8
 = 
eurİoundUnicode
.
	`’code
('utf-8')

127 
body
=
	`Áob
("·¿m="è+ 
eurİoundUtf8


128 
£lf
.
	`g‘Page
('/', 
m‘hod
='POST',

129 
h—d”s
=[("Content-Type", "application/x-www-form-urlencoded"),

130 ("CÚ‹Á-L’gth", 
	`¡r
(
	`Ën
(
body
))),

132 
body
=body),

133 
£lf
.
	$as£¹Body
(
eurİoundUtf8
)

135 #Encoded 
utf8
 
’t™›s
 
MUST
 
be
 
·r£d
 
ªd
 
decoded
 
cÜ»ùly
.

136 #H”e, 
q
 
is
 
the
 
POUND
 
SIGN
 
U
+00A3 
’coded
 
š
 
utf8


137 
body
 = 
	`Áob
("q=\xc2\xa3")

138 
£lf
.
	`g‘Page
('/»q·¿ms', 
m‘hod
='POST',

139 
h—d”s
=[("Content-Type", "application/x-www-form-urlencoded"),

140 ("CÚ‹Á-L’gth", 
	`¡r
(
	`Ën
(
body
))),

142 
body
=body),

143 
£lf
.
	`as£¹Body
(
	`Áob
("q: \xc2\xa3"))

145 #...
ªd
 
š
 
utf16
, 
which
 
is
 
nÙ
 iÀ
the
  
©‹m±_ch¬£ts
 
li¡
:

146 
body
 = 
	`Áob
("\xff\xfeq\x00=\xff\xfe\xa3\x00")

147 
£lf
.
	`g‘Page
('/»q·¿ms', 
m‘hod
='POST',

148 
h—d”s
=[("Content-Type", "application/x-www-form-urlencoded;charset=utf-16"),

149 ("CÚ‹Á-L’gth", 
	`¡r
(
	`Ën
(
body
))),

151 
body
=body),

152 
£lf
.
	`as£¹Body
(
	`Áob
("q: \xc2\xa3"))

154 #EÁ™› 
th©
 
¬e
 
šcÜ»ùly
 
’coded
 
MUST
 
¿i£
 400.

155 #H”e, 
q
 
is
 
the
 
POUND
 
SIGN
 
U
+00A3 
’coded
 
š
 
utf16
, 
but


156 #th
CÚ‹Á
-
Ty³
 
šcÜ»ùly
 
Ïb–s
 
™
 
utf
-8.

157 
body
 = 
	`Áob
("\xff\xfeq\x00=\xff\xfe\xa3\x00")

158 
£lf
.
	`g‘Page
('/»q·¿ms', 
m‘hod
='POST',

159 
h—d”s
=[("Content-Type", "application/x-www-form-urlencoded;charset=utf-8"),

160 ("CÚ‹Á-L’gth", 
	`¡r
(
	`Ën
(
body
))),

162 
body
=body),

163 
£lf
.
	$as£¹Stus
(400)

164 
£lf
.
	`as£¹E¼ÜPage
(400,

168 
def
 
	$‹¡_decode_toŞ
(
£lf
):

169 #AÀ
exŒa
 
ch¬£t
 
should
 
be
 
Œ›d
 
fœ¡
, 
ªd
 
sucûed
 
™
 
m©ches
.

170 #H”e, 
we
 
add
 
utf
-16 
as
 
a
 
ch¬£t
 
ªd
 
·ss
‡ utf-16 
body
.

171 
body
 = 
	`Áob
("\xff\xfeq\x00=\xff\xfe\xa3\x00")

172 
£lf
.
	`g‘Page
('/decode/exŒa_ch¬£t', 
m‘hod
='POST',

173 
h—d”s
=[("Content-Type", "application/x-www-form-urlencoded"),

174 ("CÚ‹Á-L’gth", 
	`¡r
(
	`Ën
(
body
))),

176 
body
=body),

177 
£lf
.
	`as£¹Body
(
	`Áob
("q: \xc2\xa3"))

179 #AÀ
exŒa
 
ch¬£t
 
should
 
be
 
Œ›d
 
fœ¡
, 
ªd
  
to
 
Ùh”
 

180 #ch¬£t 
™
 
dÛ¢
't match.

181 #H”e, 
we
 
add
 
utf
-16 
as
 
a
 
ch¬£t
 
but
 
¡l
 
·ss
‡ utf-8 
body
.

182 
body
 = 
	`Áob
("q=\xc2\xa3")

183 
£lf
.
	`g‘Page
('/decode/exŒa_ch¬£t', 
m‘hod
='POST',

184 
h—d”s
=[("Content-Type", "application/x-www-form-urlencoded"),

185 ("CÚ‹Á-L’gth", 
	`¡r
(
	`Ën
(
body
))),

187 
body
=body),

188 
£lf
.
	`as£¹Body
(
	`Áob
("q: \xc2\xa3"))

190 #AÀ
exŒa
 
ch¬£t
 
should
 
”rÜ
 
fÜû
 
is
 
True
 
ªd
 
™
 
dÛ¢
't match.

191 #H”e, 
we
 
fÜû
 
utf
-16 
as
 
a
 
ch¬£t
 
but
 
¡l
 
·ss
‡ utf-8 
body
.

192 
body
 = 
	`Áob
("q=\xc2\xa3")

193 
£lf
.
	`g‘Page
('/decode/fÜû_ch¬£t', 
m‘hod
='POST',

194 
h—d”s
=[("Content-Type", "application/x-www-form-urlencoded"),

195 ("CÚ‹Á-L’gth", 
	`¡r
(
	`Ën
(
body
))),

197 
body
=body),

198 
£lf
.
	`as£¹E¼ÜPage
(400,

202 
def
 
	$‹¡_muÉ¬t_decodšg
(
£lf
):

203 #Te¡ 
the
 
decodšg
 
of
 
a
 
muÉ¬t
 
’t™y
 
wh’
h
	`ch¬£t
 (
utf16
è
is


204 #ex¶ic™ly 
giv’
.

205 
body
=
	`Áob
('\r\n'.
	`još
(['--X',

216 
£lf
.
	`g‘Page
('/»q·¿ms', 
m‘hod
='POST',

217 
h—d”s
=[("Content-Type", "multipart/form-data;boundary=X"),

218 ("CÚ‹Á-L’gth", 
	`¡r
(
	`Ën
(
body
))),

220 
body
=body),

221 
£lf
.
	`as£¹Body
(
	`Áob
("text:‡b\xe2\x80\x9cc, submit: Create"))

223 
def
 
	$‹¡_muÉ¬t_decodšg_no_ch¬£t
(
£lf
):

224 #Te¡ 
the
 
decodšg
 
of
 
a
 
muÉ¬t
 
’t™y
 
wh’
h
	`ch¬£t
 (
utf8
è
is


225 #NOT 
ex¶ic™ly
 
giv’
, 
but
 
is
 
š
 
the
 
li¡
 
of
 
ch¬£ts
 
to
 
©‹m±
.

226 
body
=
	`Áob
('\r\n'.
	`još
(['--X',

235 
£lf
.
	`g‘Page
('/»q·¿ms', 
m‘hod
='POST',

236 
h—d”s
=[("Content-Type", "multipart/form-data;boundary=X"),

237 ("CÚ‹Á-L’gth", 
	`¡r
(
	`Ën
(
body
))),

239 
body
=body),

240 
£lf
.
	`as£¹Body
(
	`Áob
("text: \xe2\x80\x9c, submit: Create"))

242 
def
 
	$‹¡_muÉ¬t_decodšg_no_sucûssful_ch¬£t
(
£lf
):

243 #Te¡ 
the
 
decodšg
 
of
 
a
 
muÉ¬t
 
’t™y
 
wh’
h
	`ch¬£t
 (
utf16
è
is


244 #NOT 
ex¶ic™ly
 
giv’
, 
ªd
 
is
 
NOT
 
š
 
the
 
li¡
 
of
 
ch¬£ts
 
to
 
©‹m±
.

245 
body
=
	`Áob
('\r\n'.
	`još
(['--X',

254 
£lf
.
	`g‘Page
('/»q·¿ms', 
m‘hod
='POST',

255 
h—d”s
=[("Content-Type", "multipart/form-data;boundary=X"),

256 ("CÚ‹Á-L’gth", 
	`¡r
(
	`Ën
(
body
))),

258 
body
=body),

259 
£lf
.
	$as£¹Stus
(400)

260 
£lf
.
	`as£¹E¼ÜPage
(400,

264 
def
 
	$‹¡_nÚ‹xt
(
£lf
):

265 
£lf
.
	`g‘Page
('/nontext')

266 
£lf
.
	`as£¹H—d”
('Content-Type', 'application/binary;charset=utf-8')

267 
£lf
.
	`as£¹Body
('\x00\x01\x02\x03')

269 
def
 
	$‹¡Encodšg
(
£lf
):

270 #DeçuÉ 
’codšg
 
should
 
be
 
utf
-8

271 
£lf
.
	`g‘Page
('/mao_zedong')

272 
£lf
.
	$as£¹Body
(
sšg8
)

274 #Ask 
utf
-16.

275 
£lf
.
	`g‘Page
('/mao_zedong', [('Accept-Charset', 'utf-16')])

276 
£lf
.
	`as£¹H—d”
('Content-Type', 'text/html;charset=utf-16')

277 
£lf
.
	$as£¹Body
(
sšg16
)

279 #Ask 
muÉË
 
’codšgs
. 
ISO
-8859-1 
should
 
ç
, 
ªd
 
utf
-16

280 #should 
be
 
´oduûd
.

281 
£lf
.
	`g‘Page
('/mao_zedong', [('Accept-Charset',

283 
£lf
.
	$as£¹Body
(
sšg16
)

285 #Th"*" 
v®ue
 
should
  
to
 
our
 
deçuÉ_’codšg
, 
utf
-8

286 
£lf
.
	`g‘Page
('/mao_zedong', [('Accept-Charset', '*;q=1, utf-7;q=.2')])

287 
£lf
.
	$as£¹Body
(
sšg8
)

289 #OÆy 
®low
 
iso
-8859-1, 
which
 
should
 
ç
 
ªd
 
¿i£
 406.

290 
£lf
.
	`g‘Page
('/mao_zedong', [('Accept-Charset', 'iso-8859-1, *;q=0')])

291 
£lf
.
	`as£¹Stus
("406 Not Acceptable")

292 
£lf
.
	`as£¹InBody
("Your client senthis Accept-Charset header: "

296 #Ask 
x
-
mac
-
û
, 
which
 
should
 
be
 
unknown
. 
S“
 
tick‘
 #569.

297 
£lf
.
	`g‘Page
('/mao_zedong', [('Accept-Charset',

299 
£lf
.
	`as£¹Stus
("406 Not Acceptable")

300 
£lf
.
	`as£¹InBody
("Your client senthis Accept-Charset header: "

304 #Te¡ 
the
 '’codšg' 
¬g
 
to
 
’code
.

305 
£lf
.
	`g‘Page
('/utf8')

306 
£lf
.
	$as£¹Body
(
sšg8
)

307 
£lf
.
	`g‘Page
('/utf8', [('Accept-Charset', 'us-ascii, ISO-8859-1')])

308 
£lf
.
	`as£¹Stus
("406 Not Acceptable")

310 
def
 
	$‹¡Gz
(
£lf
):

311 
zbuf
 = 
	$By‹sIO
()

312 
zfe
 = 
gz
.
	`GzFe
(
mode
='wb', 
feobj
=
zbuf
, 
com´es¦ev–
=9)

313 
zfe
.
	`wr™e
(
	`Áob
("Hello, world"))

314 
zfe
.
	$şo£
()

316 
£lf
.
	`g‘Page
('/gz/', 
h—d”s
=[("Accept-Encoding", "gzip")])

317 
£lf
.
	`as£¹InBody
(
zbuf
.
	`g‘v®ue
()[:3])

318 
£lf
.
	`as£¹H—d”
("Vary", "Accept-Encoding")

319 
£lf
.
	`as£¹H—d”
("Content-Encoding", "gzip")

321 #Te¡ 
wh’
 
gz
 
is
 
d’›d
.

322 
£lf
.
	`g‘Page
('/gz/', 
h—d”s
=[("Accept-Encoding", "identity")])

323 
£lf
.
	`as£¹H—d”
("Vary", "Accept-Encoding")

324 
£lf
.
	`as£¹NoH—d”
("Content-Encoding")

325 
£lf
.
	`as£¹Body
("Hello, world")

327 
£lf
.
	`g‘Page
('/gz/', 
h—d”s
=[("Accept-Encoding", "gzip;q=0")])

328 
£lf
.
	`as£¹H—d”
("Vary", "Accept-Encoding")

329 
£lf
.
	`as£¹NoH—d”
("Content-Encoding")

330 
£lf
.
	`as£¹Body
("Hello, world")

332 
£lf
.
	`g‘Page
('/gz/', 
h—d”s
=[("Accept-Encoding", "*;q=0")])

333 
£lf
.
	$as£¹Stus
(406)

334 
£lf
.
	`as£¹NoH—d”
("Content-Encoding")

335 
£lf
.
	`as£¹E¼ÜPage
(406, "identity, gzip")

337 #Te¡ 
tick‘
 #147

338 
£lf
.
	`g‘Page
('/gz/noshow', 
h—d”s
=[("Accept-Encoding", "gzip")])

339 
£lf
.
	`as£¹NoH—d”
('Content-Encoding')

340 
£lf
.
	$as£¹Stus
(500)

341 
£lf
.
	`as£¹E¼ÜPage
(500, 
·‰”n
="IndexError\n")

343 #IÀ
this
 , 
th”e
's‚othing we can doo deliver‡

344 #»adabË 
·ge
, 
sšû
 1è
the
 
gz
 
h—d”
 
is
 
®»ady
 
£t
,

345 #ªd 2è
we
 
may
 
have
 
®»ady
 
wr™‹n
 
some
 
of
 
the
 
body
.

346 #Th
fix
 
is
 
to
 
Ãv”
 
¡»am
 
y›lds
 
wh’
 
usšg
 
gz
.

347 ià(
ch”rypy
.
£rv”
.
´ÙocŞ_v”siÚ
 =ğ"HTTP/1.0" 
Ü


348 
	`g‘©Œ
(
ch”rypy
.
£rv”
, "usšg_­ache", 
F®£
)):

349 
£lf
.
	`g‘Page
('/gzip/noshow_stream',

350 
h—d”s
=[("Accept-Encoding", "gzip")])

351 
£lf
.
	`as£¹H—d”
('Content-Encoding', 'gzip')

352 
£lf
.
	`as£¹InBody
('\x1f\x8b\x08\x00')

354 #Th
wsgi£rv”
 
wl
 
sim¶y
 
¡İ
 
£ndšg
 
d©a
, 
ªd
 
the
 
HTTP
 
ş›Á


355 #wÈ
”rÜ
 
due
 
to
 
ª
 
šcom¶‘e
 
chunk
-
’coded
 
¡»am
.

356 
£lf
.
	`as£¹Rai£s
((
V®ueE¼Ü
, 
Incom¶‘eR—d
), s–f.
g‘Page
,

358 
h—d”s
=[("Accept-Encoding", "gzip")])

360 
def
 
	$‹¡_UnicodeH—d”s
(
£lf
):

361 
£lf
.
	`g‘Page
('/cookies_and_headers')

362 
£lf
.
	`as£¹Body
('Any content')

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/test_etags.py

1 
impÜt
 
ch”rypy


2 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
Áou


3 
äom
 
	gch”rypy
.
‹¡
 
impÜt
 
h–³r


6 
şass
 
	$ETagTe¡
(
h–³r
.
CPWebCa£
):

8 
def
 
	$£tup_£rv”
():

9 
şass
 
RoÙ
:

10 
def
 
	$»sourû
(
£lf
):

12 
»sourû
.
expo£d
 = 
True


14 
def
 
	$ç
(
£lf
, 
code
):

15 
code
 = (code)

16 300 <ğ
code
 <= 399:

17 
¿i£
 
ch”rypy
.
	$HTTPRedœeù
([], 
code
)

19 
¿i£
 
ch”rypy
.
	$HTTPE¼Ü
(
code
)

20 
ç
.
expo£d
 = 
True


22 
def
 
	$unicoded
(
£lf
):

23  
	`Áou
('I‡m‡ \u1ee4nicode string.', 'escape')

24 
unicoded
.
expo£d
 = 
True


25 #IÀ
PythÚ
 3, 
toŞs
.
’code
 
is
 
Ú
 
by
 

26 
unicoded
.
_ı_cÚfig
 = {'toŞs.’code.Ú': 
True
}

28 
cÚf
 = {'/': {'toŞs.‘ags.Ú': 
True
,

29 'toŞs.‘ags.autÙags': 
True
,

31 
ch”rypy
.
Œ“
.
mouÁ
(
RoÙ
(), 
cÚfig
=
cÚf
)

32 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

34 
def
 
	$‹¡_‘ags
(
£lf
):

35 
£lf
.
	`g‘Page
("/resource")

36 
£lf
.
	`as£¹Stus
('200 OK')

37 
£lf
.
	`as£¹H—d”
('Content-Type', 'text/html;charset=utf-8')

38 
£lf
.
	`as£¹Body
('Oh waha goo Siam.')

39 
‘ag
 = 
£lf
.
	`as£¹H—d”
('ETag')

41 #Te¡ 
If
-
	`M©ch
 (
bÙh
 
v®id
 
ªd
 
šv®id
)

42 
£lf
.
	`g‘Page
("/»sourû", 
h—d”s
=[('If-M©ch', 
‘ag
)])

43 
£lf
.
	`as£¹Stus
("200 OK")

44 
£lf
.
	`g‘Page
("/»sourû", 
h—d”s
=[('If-Match', "*")])

45 
£lf
.
	`as£¹Stus
("200 OK")

46 
£lf
.
	`g‘Page
("/»sourû", 
h—d”s
=[('If-M©ch', "*")], 
m‘hod
="POST")

47 
£lf
.
	`as£¹Stus
("200 OK")

48 
£lf
.
	`g‘Page
("/»sourû", 
h—d”s
=[('If-Match', "a bogusag")])

49 
£lf
.
	`as£¹Stus
("412 Precondition Failed")

51 #Te¡ 
If
-
NÚe
-
	`M©ch
 (
bÙh
 
v®id
 
ªd
 
šv®id
)

52 
£lf
.
	`g‘Page
("/»sourû", 
h—d”s
=[('If-NÚe-M©ch', 
‘ag
)])

53 
£lf
.
	$as£¹Stus
(304)

54 
£lf
.
	`g‘Page
("/»sourû", 
m‘hod
='POST', 
h—d”s
=[('If-NÚe-M©ch', 
‘ag
)])

55 
£lf
.
	`as£¹Stus
("412 Precondition Failed")

56 
£lf
.
	`g‘Page
("/»sourû", 
h—d”s
=[('If-None-Match', "*")])

57 
£lf
.
	$as£¹Stus
(304)

58 
£lf
.
	`g‘Page
("/»sourû", 
h—d”s
=[('If-None-Match', "a bogusag")])

59 
£lf
.
	`as£¹Stus
("200 OK")

61 
def
 
	$‹¡_”rÜs
(
£lf
):

62 
£lf
.
	`g‘Page
("/resource")

63 
£lf
.
	$as£¹Stus
(200)

64 
‘ag
 = 
£lf
.
	`as£¹H—d”
('ETag')

66 #Te¡ 
¿isšg
 
”rÜs
 
š
 
·ge
 
hªdËr


67 
£lf
.
	`g‘Page
("/ç/412", 
h—d”s
=[('If-M©ch', 
‘ag
)])

68 
£lf
.
	$as£¹Stus
(412)

69 
£lf
.
	`g‘Page
("/ç/304", 
h—d”s
=[('If-M©ch', 
‘ag
)])

70 
£lf
.
	$as£¹Stus
(304)

71 
£lf
.
	`g‘Page
("/ç/412", 
h—d”s
=[('If-None-Match', "*")])

72 
£lf
.
	$as£¹Stus
(412)

73 
£lf
.
	`g‘Page
("/ç/304", 
h—d”s
=[('If-None-Match', "*")])

74 
£lf
.
	$as£¹Stus
(304)

76 
def
 
	$‹¡_unicode_body
(
£lf
):

77 
£lf
.
	`g‘Page
("/unicoded")

78 
£lf
.
	$as£¹Stus
(200)

79 
‘ag1
 = 
£lf
.
	`as£¹H—d”
('ETag')

80 
£lf
.
	`g‘Page
("/unicoded", 
h—d”s
=[('If-M©ch', 
‘ag1
)])

81 
£lf
.
	$as£¹Stus
(200)

82 
£lf
.
	`as£¹H—d”
('ETag', 
‘ag1
)

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/test_http.py

3 
impÜt
 
”ºo


4 
impÜt
 
mim‘y³s


5 
impÜt
 
sock‘


6 
impÜt
 
sys


8 
impÜt
 
ch”rypy


9 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
	gHTTPCÚÃùiÚ
, 
	gHTTPSCÚÃùiÚ
, 
	gÁob
, 
py3k


12 
def
 
	$’code_muÉ¬t_fÜmd©a
(
fes
):

15 
fes
: 
a
 
£qu’û
 
	$of
 (
Çme
, 
f’ame
, 
v®ue
è
tu¶es
 
muÉ¬t
 
u¶ßds
.

17 
BOUNDARY
 = '________ThIs_Is_tHe_bouNdaRY_$'

18 
L
 = []

19 
key
, 
f’ame
, 
v®ue
 
š
 
fes
:

20 
L
.
	`­³nd
('--' + 
BOUNDARY
)

21 
L
.
	`­³nd
('Content-Disposition: form-data;‚ame="%s"; filename="%s"' %

22 (
key
, 
f’ame
))

23 
ù
 = 
mim‘y³s
.
	`guess_ty³
(
f’ame
)[0] 
Ü
 'application/octet-stream'

24 
L
.
	`­³nd
('CÚ‹Á-Ty³: %s' % 
ù
)

25 
L
.
	`­³nd
('')

26 
L
.
	$­³nd
(
v®ue
)

27 
L
.
	`­³nd
('--' + 
BOUNDARY
 + '--')

28 
L
.
	`­³nd
('')

29 
body
 = '\r\n'.
	$još
(
L
)

30 
cÚ‹Á_ty³
 = 'muÉ¬t/fÜm-d©a; bound¬y=%s' % 
BOUNDARY


31  
cÚ‹Á_ty³
, 
body


36 
äom
 
ch”rypy
.
‹¡
 
impÜt
 
h–³r


38 
şass
 
	$HTTPTe¡s
(
h–³r
.
CPWebCa£
):

40 
def
 
	$£tup_£rv”
():

41 
şass
 
RoÙ
:

42 
def
 
	$šdex
(
£lf
, *
¬gs
, **
kw¬gs
):

44 
šdex
.
expo£d
 = 
True


46 
def
 
	$no_body
(
£lf
, *
¬gs
, **
kw¬gs
):

48 
no_body
.
expo£d
 = 
True


49 
no_body
.
_ı_cÚfig
 = {'»que¡.´oûss_»que¡_body': 
F®£
}

51 
def
 
	$po¡_muÉ¬t
(
£lf
, 
fe
):

52 """R‘uº‡ summ¬y ("
a
 * 65536\
nb
 * 65536") ofhe uploaded file."""

53 
cÚ‹Ás
 = 
fe
.fe.
	$»ad
()

54 
summ¬y
 = []

55 
curch¬
 = 
NÚe


56 
couÁ
 = 0

57 
c
 
š
 
cÚ‹Ás
:

58 
c
 =ğ
curch¬
:

59 
couÁ
 += 1

61 
couÁ
:

62 
py3k
: 
curch¬
 = 
	$chr
(
curch¬
)

63 
summ¬y
.
	`­³nd
("% * %d" % (
curch¬
, 
couÁ
))

64 
couÁ
 = 1

65 
curch¬
 = 
c


66 
couÁ
:

67 
py3k
: 
curch¬
 = 
	$chr
(
curch¬
)

68 
summ¬y
.
	`­³nd
("% * %d" % (
curch¬
, 
couÁ
))

69  ", ".
	$još
(
summ¬y
)

70 
po¡_muÉ¬t
.
expo£d
 = 
True


72 
ch”rypy
.
Œ“
.
	`mouÁ
(
	$RoÙ
())

73 
ch”rypy
.
cÚfig
.
	`upd©e
({'£rv”.max_»que¡_body_size': 30000000
	}
})

74 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

76 
def
 
	$‹¡_no_cÚ‹Á_Ëngth
(
£lf
):

77 #"
The
 
´e£nû
 
of
 
a
 
mes§ge
-
body
 
š
‡ 
»que¡
 
is
 
sigÇËd
 
by
 
the


78 #šşusiÚ 
of
 
a
 
CÚ‹Á
-
L’gth
 
Ü
 
T¿nsãr
-
Encodšg
 
h—d”
 
f›ld
 
š


79 #th
»que¡
's message-headers."

80 #
#S’d 
a
 
mes§ge
 
w™h
 
Ã™h”
 
h—d”
 
ªd
 
no
 
body
. 
Ev’
 
though


81 #th
»que¡
 
is
 
of
 
m‘hod
 
POST
, 
this
 
should
 
be
 
OK
 
beÿu£
 
we
 
£t


82 #»que¡.
´oûss_»que¡_body
 
to
 
F®£
 
our
 
hªdËr
.

83 
£lf
.
scheme
 == "https":

84 
c
 = 
	`HTTPSCÚÃùiÚ
('%s:%s' % (
£lf
.
	`š‹rçû
(), s–f.
PORT
))

86 
c
 = 
	`HTTPCÚÃùiÚ
('%s:%s' % (
£lf
.
	`š‹rçû
(), s–f.
PORT
))

87 
c
.
	`»que¡
("POST", "/no_body")

88 
»¥Ú£
 = 
c
.
	$g‘»¥Ú£
()

89 
£lf
.
body
 = 
»¥Ú£
.
å
.
	$»ad
()

90 
£lf
.
¡©us
 = 
	$¡r
(
»¥Ú£
.
¡©us
)

91 
£lf
.
	$as£¹Stus
(200)

92 
£lf
.
	`as£¹Body
(
	`Áob
('Hello world!'))

94 #Now 
£nd
 
a
 
mes§ge
 
th©
 
has
 
no
 
CÚ‹Á
-
L’gth
, 
but
 
dÛs
 s’d‡ 
body
.

95 #V”ify 
th©
 
CP
 
times
 
out
 
the
 
sock‘
 
ªd
 
»¥Úds


96 #w™h 411 
L’gth
 
Requœed
.

97 
£lf
.
scheme
 == "https":

98 
c
 = 
	`HTTPSCÚÃùiÚ
('%s:%s' % (
£lf
.
	`š‹rçû
(), s–f.
PORT
))

100 
c
 = 
	`HTTPCÚÃùiÚ
('%s:%s' % (
£lf
.
	`š‹rçû
(), s–f.
PORT
))

101 
c
.
	`»que¡
("POST", "/")

102 
»¥Ú£
 = 
c
.
	$g‘»¥Ú£
()

103 
£lf
.
body
 = 
»¥Ú£
.
å
.
	$»ad
()

104 
£lf
.
¡©us
 = 
	$¡r
(
»¥Ú£
.
¡©us
)

105 
£lf
.
	$as£¹Stus
(411)

107 
def
 
	$‹¡_po¡_muÉ¬t
(
£lf
):

108 
®phab‘
 = "abcdefghijklmnopqrstuvwxyz"

109 #g’”©
fe
 
cÚ‹Ás
 
a
 
Ïrge
 
po¡


110 
cÚ‹Ás
 = "".
	$još
([
c
 * 65536 ø
š
 
®phab‘
])

112 #’cod
as
 
muÉ¬t
 
fÜm
 
d©a


113 
fes
=[('fe', 'fe.txt', 
cÚ‹Ás
)]

114 
cÚ‹Á_ty³
, 
body
 = 
	$’code_muÉ¬t_fÜmd©a
(
fes
)

115 
body
 = body.
	`’code
('Latin-1')

117 #po¡ 
fe


118 
£lf
.
scheme
 == 'https':

119 
c
 = 
	`HTTPSCÚÃùiÚ
('%s:%s' % (
£lf
.
	`š‹rçû
(), s–f.
PORT
))

121 
c
 = 
	`HTTPCÚÃùiÚ
('%s:%s' % (
£lf
.
	`š‹rçû
(), s–f.
PORT
))

122 
c
.
	`puŒeque¡
('POST', '/post_multipart')

123 
c
.
	`puth—d”
('CÚ‹Á-Ty³', 
cÚ‹Á_ty³
)

124 
c
.
	`puth—d”
('CÚ‹Á-L’gth', 
	`¡r
(
	$Ën
(
body
)))

125 
c
.
	$’dh—d”s
()

126 
c
.
	$£nd
(
body
)

128 
»¥Ú£
 = 
c
.
	$g‘»¥Ú£
()

129 
£lf
.
body
 = 
»¥Ú£
.
å
.
	$»ad
()

130 
£lf
.
¡©us
 = 
	$¡r
(
»¥Ú£
.
¡©us
)

131 
£lf
.
	$as£¹Stus
(200)

132 
£lf
.
	`as£¹Body
(", ".
	`još
(["% * 65536" % 
c
 ø
š
 
®phab‘
]))

134 
def
 
	$‹¡_m®fÜmed_»que¡_lše
(
£lf
):

135 
	`g‘©Œ
(
ch”rypy
.
£rv”
, "usšg_­ache", 
F®£
):

136  
£lf
.
	`sk
("skipped dueo known Apache differences...")

138 #Te¡ 
missšg
 
v”siÚ
 
š
 
Reque¡
-
Lše


139 
£lf
.
scheme
 == 'https':

140 
c
 = 
	`HTTPSCÚÃùiÚ
('%s:%s' % (
£lf
.
	`š‹rçû
(), s–f.
PORT
))

142 
c
 = 
	`HTTPCÚÃùiÚ
('%s:%s' % (
£lf
.
	`š‹rçû
(), s–f.
PORT
))

143 
c
.
	`_ouut
(
	`Áob
('GET /'))

144 
c
.
	$_£nd_ouut
()

145 
	`ha§‰r
(
c
, 'strict'):

146 
»¥Ú£
 = 
c
.
	`»¥Ú£_şass
(c.
sock
, 
¡riù
=c.¡riù, 
m‘hod
='GET')

148 #PythÚ 3.2 
»moved
 
the
 '¡riù' 
ã©u»
, 
§yšg
:

149 #"
h‰p
.
ş›Á
 
now
 
®ways
 
assumes
 
HTTP
/1.x 
com¶ŸÁ
 
£rv”s
."

150 
»¥Ú£
 = 
c
.
	`»¥Ú£_şass
(c.
sock
, 
m‘hod
='GET')

151 
»¥Ú£
.
	$begš
()

152 
£lf
.
	$as£¹Equ®
(
»¥Ú£
.
¡©us
, 400)

153 
£lf
.
	`as£¹Equ®
(
»¥Ú£
.
å
.
	`»ad
(22), 
	`Áob
("Malformed Request-Line"))

154 
c
.
	$şo£
()

156 
def
 
	$‹¡_m®fÜmed_h—d”
(
£lf
):

157 
£lf
.
scheme
 == 'https':

158 
c
 = 
	`HTTPSCÚÃùiÚ
('%s:%s' % (
£lf
.
	`š‹rçû
(), s–f.
PORT
))

160 
c
 = 
	`HTTPCÚÃùiÚ
('%s:%s' % (
£lf
.
	`š‹rçû
(), s–f.
PORT
))

161 
c
.
	`puŒeque¡
('GET', '/')

162 
c
.
	`puth—d”
('Content-Type', 'text/plain')

163 #S“ 
h‰p
:

164 
c
.
	`_ouut
(
	`Áob
('Re, 1.2.3.4#015#012'))

165 
c
.
	$’dh—d”s
()

167 
»¥Ú£
 = 
c
.
	$g‘»¥Ú£
()

168 
£lf
.
¡©us
 = 
	$¡r
(
»¥Ú£
.
¡©us
)

169 
£lf
.
	$as£¹Stus
(400)

170 
£lf
.
body
 = 
»¥Ú£
.
å
.
	$»ad
(20)

171 
£lf
.
	`as£¹Body
("Illegal header†ine.")

173 
def
 
	$‹¡_h‰p_ov”_h‰ps
(
£lf
):

174 
£lf
.
scheme
 != 'https':

175  
£lf
.
	`sk
("skipped (not„unning HTTPS)... ")

177 #Try 
cÚÃùšg
 
w™hout
 
SSL
.

178 
cÚn
 = 
	`HTTPCÚÃùiÚ
('%s:%s' % (
£lf
.
	`š‹rçû
(), s–f.
PORT
))

179 
cÚn
.
	`puŒeque¡
("GET", "/", 
sk_ho¡
=
True
)

180 
cÚn
.
	`puth—d”
("Ho¡", 
£lf
.
HOST
)

181 
cÚn
.
	$’dh—d”s
()

182 
»¥Ú£
 = 
cÚn
.
	`»¥Ú£_şass
(cÚn.
sock
, 
m‘hod
="GET")

183 
Œy
:

184 
»¥Ú£
.
	$begš
()

185 
£lf
.
	$as£¹Equ®
(
»¥Ú£
.
¡©us
, 400)

186 
£lf
.
body
 = 
»¥Ú£
.
	$»ad
()

187 
£lf
.
	`as£¹Body
("The client sent‡…lain HTTP„equest, buthis "

189 
exû±
 
sock‘
.
”rÜ
:

190 
e
 = 
sys
.
	`exc_šfo
()[1]

191 #"
CÚÃùiÚ
 
»£t
 
by
 
³”
" is‡lso‡cceptable.

192 
e
.
”ºo
 !ğ”ºo.
ECONNRESET
:

193 
¿i£


195 
def
 
	$‹¡_g¬bage_š
(
£lf
):

196 #CÚÃù 
w™hout
 
SSL
 
»g¬dËss
 
of
 
£rv”
.
scheme


197 
c
 = 
	`HTTPCÚÃùiÚ
('%s:%s' % (
£lf
.
	`š‹rçû
(), s–f.
PORT
))

198 
c
.
	`_ouut
(
	`Áob
('gjkgjklsgjklsgjkljklsg'))

199 
c
.
	$_£nd_ouut
()

200 
»¥Ú£
 = 
c
.
	`»¥Ú£_şass
(c.
sock
, 
m‘hod
="GET")

201 
Œy
:

202 
»¥Ú£
.
	$begš
()

203 
£lf
.
	$as£¹Equ®
(
»¥Ú£
.
¡©us
, 400)

204 
£lf
.
	`as£¹Equ®
(
»¥Ú£
.
å
.
	`»ad
(22), 
	`Áob
("Malformed Request-Line"))

205 
c
.
	$şo£
()

206 
exû±
 
sock‘
.
”rÜ
:

207 
e
 = 
sys
.
	`exc_šfo
()[1]

208 #"
CÚÃùiÚ
 
»£t
 
by
 
³”
" is‡lso‡cceptable.

209 
e
.
”ºo
 !ğ”ºo.
ECONNRESET
:

210 
¿i£


	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/test_httpauth.py

1 
impÜt
 
ch”rypy


2 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
	gmd5
, 
	gsha
, 
Áob


3 
äom
 
	gch”rypy
.
lib
 
impÜt
 
h‰·uth


5 
äom
 
	gch”rypy
.
‹¡
 
impÜt
 
h–³r


7 
şass
 
	$HTTPAuthTe¡
(
h–³r
.
CPWebCa£
):

9 
def
 
	$£tup_£rv”
():

10 
şass
 
RoÙ
:

11 
def
 
	$šdex
(
£lf
):

13 
šdex
.
expo£d
 = 
True


15 
şass
 
Dige¡PrÙeùed
:

16 
def
 
	$šdex
(
£lf
):

17  "H–lØ%s, you'vb“ÀauthÜized." % 
ch”rypy
.
»que¡
.
logš


18 
šdex
.
expo£d
 = 
True


20 
şass
 
BasicPrÙeùed
:

21 
def
 
	$šdex
(
£lf
):

22  "H–lØ%s, you'vb“ÀauthÜized." % 
ch”rypy
.
»que¡
.
logš


23 
šdex
.
expo£d
 = 
True


25 
şass
 
BasicPrÙeùed2
:

26 
def
 
	$šdex
(
£lf
):

27  "H–lØ%s, you'vb“ÀauthÜized." % 
ch”rypy
.
»que¡
.
logš


28 
šdex
.
expo£d
 = 
True


30 
def
 
	$ãtch_u£rs
():

31  {'‹¡': '‹¡'
	}
}

33 
def
 
	$sha_·sswÜd_’üy±”
(
·sswÜd
):

34  
	`sha
(
	`Áob
(
·sswÜd
)).
	$hexdige¡
()

36 
def
 
	$ãtch_·sswÜd
(
u£ºame
):

37  
	`sha
(
	`Áob
('‹¡')).
	$hexdige¡
()

39 
cÚf
 = {'/dige¡': {'toŞs.dige¡_auth.Ú': 
True
,

41 'toŞs.dige¡_auth.u£rs': 
ãtch_u£rs
},

42 '/basic': {'toŞs.basic_auth.Ú': 
True
,

44 'toŞs.basic_auth.u£rs': {'‹¡': 
	`md5
(
	`Áob
('‹¡')).
	`hexdige¡
()}},

45 '/basic2': {'toŞs.basic_auth.Ú': 
True
,

47 'toŞs.basic_auth.u£rs': 
ãtch_·sswÜd
,

48 'toŞs.basic_auth.’üy±': 
sha_·sswÜd_’üy±”
}
	}
}

50 
roÙ
 = 
	$RoÙ
()

51 
roÙ
.
dige¡
 = 
	$Dige¡PrÙeùed
()

52 
roÙ
.
basic
 = 
	$BasicPrÙeùed
()

53 
roÙ
.
basic2
 = 
	$BasicPrÙeùed2
()

54 
ch”rypy
.
Œ“
.
	$mouÁ
(
roÙ
, 
cÚfig
=
cÚf
)

55 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

58 
def
 
	$‹¡Public
(
£lf
):

59 
£lf
.
	`g‘Page
("/")

60 
£lf
.
	`as£¹Stus
('200 OK')

61 
£lf
.
	`as£¹H—d”
('Content-Type', 'text/html;charset=utf-8')

62 
£lf
.
	`as£¹Body
('This is…ublic.')

64 
def
 
	$‹¡Basic
(
£lf
):

65 
£lf
.
	`g‘Page
("/basic/")

66 
£lf
.
	$as£¹Stus
(401)

67 
£lf
.
	`as£¹H—d”
('WWW-Authenticate', 'Basic„ealm="localhost"')

69 
£lf
.
	`g‘Page
('/basic/', [('Authorization', 'Basic dGVzdDp0ZX60')])

70 
£lf
.
	$as£¹Stus
(401)

72 
£lf
.
	`g‘Page
('/basic/', [('Authorization', 'Basic dGVzdDp0ZXN0')])

73 
£lf
.
	`as£¹Stus
('200 OK')

74 
£lf
.
	`as£¹Body
("Helloest, you've been‡uthorized.")

76 
def
 
	$‹¡Basic2
(
£lf
):

77 
£lf
.
	`g‘Page
("/basic2/")

78 
£lf
.
	$as£¹Stus
(401)

79 
£lf
.
	`as£¹H—d”
('WWW-Authenticate', 'Basic„ealm="localhost"')

81 
£lf
.
	`g‘Page
('/basic2/', [('Authorization', 'Basic dGVzdDp0ZX60')])

82 
£lf
.
	$as£¹Stus
(401)

84 
£lf
.
	`g‘Page
('/basic2/', [('Authorization', 'Basic dGVzdDp0ZXN0')])

85 
£lf
.
	`as£¹Stus
('200 OK')

86 
£lf
.
	`as£¹Body
("Helloest, you've been‡uthorized.")

88 
def
 
	$‹¡Dige¡
(
£lf
):

89 
£lf
.
	`g‘Page
("/digest/")

90 
£lf
.
	$as£¹Stus
(401)

92 
v®ue
 = 
NÚe


93 
k
, 
v
 
š
 
£lf
.
h—d”s
:

94 
k
.
	`low”
() == "www-authenticate":

95 
v
.
	`¡¬tsw™h
("Digest"):

96 
v®ue
 = 
v


99 
v®ue
 
is
 
NÚe
:

100 
£lf
.
	`_hªdËwebE¼Ü
("Digest‡uthentification scheme was‚ot found")

102 
v®ue
 = value[7:]

103 
™ems
 = 
v®ue
.
	`¥l™
(', ')

104 
tok’s
 = {
	}
}

105 
™em
 
š
 
™ems
:

106 
key
, 
	gv®ue
 = 
™em
.
¥l™
('=')

107 
tok’s
[
key
.
low”
()] = 
v®ue


109 
missšg_msg
 = "%s is missing"

110 
bad_v®ue_msg
 = "'%s' wasƒxpecting '%s' but found '%s'"

111 
nÚû
 = 
NÚe


112 '»®m' 
nÙ
 
š
 
tok’s
:

113 
£lf
.
_hªdËwebE¼Ü
(
missšg_msg
 % 'realm')

114 
–if
 
tok’s
['realm'] != '"localhost"':

115 
£lf
.
_hªdËwebE¼Ü
(
bad_v®ue_msg
 % ('»®m', '"loÿlho¡"', 
tok’s
['realm']))

116 'nÚû' 
nÙ
 
š
 
	gtok’s
:

117 
£lf
.
_hªdËwebE¼Ü
(
missšg_msg
 % 'nonce')

119 
nÚû
 = 
tok’s
['nÚû'].
¡r
('"')

120 '®gÜ™hm' 
nÙ
 
š
 
tok’s
:

121 
£lf
.
_hªdËwebE¼Ü
(
missšg_msg
 % 'algorithm')

122 
–if
 
tok’s
['algorithm'] != '"MD5"':

123 
£lf
.
_hªdËwebE¼Ü
(
bad_v®ue_msg
 % ('®gÜ™hm', '"MD5"', 
tok’s
['algorithm']))

124 'qİ' 
nÙ
 
š
 
	gtok’s
:

125 
£lf
.
_hªdËwebE¼Ü
(
missšg_msg
 % 'qop')

126 
–if
 
tok’s
['qop'] != '"auth"':

127 
£lf
.
_hªdËwebE¼Ü
(
bad_v®ue_msg
 % ('qİ', '"auth"', 
tok’s
['qop']))

129 #Te¡ 
a
 
wrÚg
 '»®m' 
v®ue


130 
	gba£_auth
 = 'Digest username="test",„ealm="wrong„ealm",‚once="%s", uri="/digest/",‡lgorithm=MD5,„esponse="%s", qop=auth,‚c=%s, cnonce="1522e61005789929"'

132 
auth
 = 
ba£_auth
 % (
nÚû
, '', '00000001')

133 
	g·¿ms
 = 
h‰·uth
.
	$·r£AuthÜiz©iÚ
(
auth
)

134 
»¥Ú£
 = 
h‰·uth
.
	`_compu‹Dige¡Re¥Ú£
(
·¿ms
, 'test')

136 
auth
 = 
ba£_auth
 % (
nÚû
, 
»¥Ú£
, '00000001')

137 
£lf
.
	`g‘Page
('/dige¡/', [('AuthÜiz©iÚ', 
auth
)])

138 
£lf
.
	$as£¹Stus
(401)

140 #Te¡ 
th©
 
mu¡
 
·ss


141 
ba£_auth
 = 'Digest username="test",„ealm="localhost",‚once="%s", uri="/digest/",‡lgorithm=MD5,„esponse="%s", qop=auth,‚c=%s, cnonce="1522e61005789929"'

143 
auth
 = 
ba£_auth
 % (
nÚû
, '', '00000001')

144 
·¿ms
 = 
h‰·uth
.
	$·r£AuthÜiz©iÚ
(
auth
)

145 
»¥Ú£
 = 
h‰·uth
.
	`_compu‹Dige¡Re¥Ú£
(
·¿ms
, 'test')

147 
auth
 = 
ba£_auth
 % (
nÚû
, 
»¥Ú£
, '00000001')

148 
£lf
.
	`g‘Page
('/dige¡/', [('AuthÜiz©iÚ', 
auth
)])

149 
£lf
.
	`as£¹Stus
('200 OK')

150 
£lf
.
	`as£¹Body
("Helloest, you've been‡uthorized.")

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/test_httplib.py

3 
impÜt
 
un™‹¡


4 
äom
 
	gch”rypy
.
lib
 
impÜt
 
h‰put


7 
şass
 
	$Ut™yTe¡s
(
un™‹¡
.
Te¡Ca£
):

9 
def
 
	$‹¡_u¾još
(
£lf
):

10 #Te¡ 
®l
 
¦ash
+
©om
 
combš©iÚs
 
SCRIPT_NAME
 
ªd
 
PATH_INFO


11 
£lf
.
	`as£¹Equ®
(
h‰put
.
	`u¾još
("/sn/", "/pi/"), "/sn/pi/")

12 
£lf
.
	`as£¹Equ®
(
h‰put
.
	`u¾još
("/sn/", "/pi"), "/sn/pi")

13 
£lf
.
	`as£¹Equ®
(
h‰put
.
	`u¾još
("/sn/", "/"), "/sn/")

14 
£lf
.
	`as£¹Equ®
(
h‰put
.
	`u¾još
("/sn/", ""), "/sn/")

15 
£lf
.
	`as£¹Equ®
(
h‰put
.
	`u¾još
("/sn", "/pi/"), "/sn/pi/")

16 
£lf
.
	`as£¹Equ®
(
h‰put
.
	`u¾još
("/sn", "/pi"), "/sn/pi")

17 
£lf
.
	`as£¹Equ®
(
h‰put
.
	`u¾još
("/sn", "/"), "/sn/")

18 
£lf
.
	`as£¹Equ®
(
h‰put
.
	`u¾još
("/sn", ""), "/sn")

19 
£lf
.
	`as£¹Equ®
(
h‰put
.
	`u¾još
("/", "/pi/"), "/pi/")

20 
£lf
.
	`as£¹Equ®
(
h‰put
.
	`u¾još
("/", "/pi"), "/pi")

21 
£lf
.
	`as£¹Equ®
(
h‰put
.
	`u¾još
("/", "/"), "/")

22 
£lf
.
	`as£¹Equ®
(
h‰put
.
	`u¾još
("/", ""), "/")

23 
£lf
.
	`as£¹Equ®
(
h‰put
.
	`u¾još
("", "/pi/"), "/pi/")

24 
£lf
.
	`as£¹Equ®
(
h‰put
.
	`u¾još
("", "/pi"), "/pi")

25 
£lf
.
	`as£¹Equ®
(
h‰put
.
	`u¾još
("", "/"), "/")

26 
£lf
.
	`as£¹Equ®
(
h‰put
.
	`u¾još
("", ""), "/")

28 
__Çme__
 == '__main__':

29 
un™‹¡
.
	`maš
()

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/test_json.py

1 
impÜt
 
ch”rypy


2 
äom
 
	gch”rypy
.
‹¡
 
impÜt
 
h–³r


4 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
jsÚ


6 
şass
 
	$JsÚTe¡
(
h–³r
.
CPWebCa£
):

7 
def
 
	$£tup_£rv”
():

8 
şass
 
	$RoÙ
(
objeù
):

9 
def
 
	$¶aš
(
£lf
):

11 
¶aš
.
expo£d
 = 
True


13 
def
 
	$jsÚ_¡ršg
(
£lf
):

15 
jsÚ_¡ršg
.
expo£d
 = 
True


16 
jsÚ_¡ršg
.
_ı_cÚfig
 = {'toŞs.jsÚ_out.Ú': 
True
}

18 
def
 
	$jsÚ_li¡
(
£lf
):

20 
jsÚ_li¡
.
expo£d
 = 
True


21 
jsÚ_li¡
.
_ı_cÚfig
 = {'toŞs.jsÚ_out.Ú': 
True
}

23 
def
 
	$jsÚ_diù
(
£lf
):

24  {'ªsw”': 42
	}
}

25 
jsÚ_diù
.
expo£d
 = 
True


26 
jsÚ_diù
.
_ı_cÚfig
 = {'toŞs.jsÚ_out.Ú': 
True
}

28 
def
 
	$jsÚ_po¡
(
£lf
):

29 
ch”rypy
.
»que¡
.
jsÚ
 == [13, 'c']:

33 
jsÚ_po¡
.
expo£d
 = 
True


34 
jsÚ_po¡
.
_ı_cÚfig
 = {'toŞs.jsÚ_š.Ú': 
True
}

36 
roÙ
 = 
	$RoÙ
()

37 
ch”rypy
.
Œ“
.
	$mouÁ
(
roÙ
)

38 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

40 
def
 
	$‹¡_jsÚ_ouut
(
£lf
):

41 
jsÚ
 
is
 
NÚe
:

42 
£lf
.
	`sk
("json‚ot found ")

45 
£lf
.
	`g‘Page
("/plain")

46 
£lf
.
	`as£¹Body
("hello")

48 
£lf
.
	`g‘Page
("/json_string")

49 
£lf
.
	`as£¹Body
('"hello"')

51 
£lf
.
	`g‘Page
("/json_list")

52 
£lf
.
	`as£¹Body
('["a", "b", 42]')

54 
£lf
.
	`g‘Page
("/json_dict")

55 
£lf
.
	`as£¹Body
('{"answer": 42}')

57 
def
 
	$‹¡_jsÚ_šput
(
£lf
):

58 
jsÚ
 
is
 
NÚe
:

59 
£lf
.
	`sk
("json‚ot found ")

62 
body
 = '[13, "c"]'

63 
h—d”s
 = [('Content-Type', 'application/json'),

64 ('CÚ‹Á-L’gth', 
	`¡r
(
	`Ën
(
body
)))]

65 
£lf
.
	`g‘Page
("/jsÚ_po¡", 
m‘hod
="POST", 
h—d”s
=h—d”s, 
body
=body)

66 
£lf
.
	`as£¹Body
('ok')

68 
body
 = '[13, "c"]'

69 
h—d”s
 = [('Content-Type', 'text/plain'),

70 ('CÚ‹Á-L’gth', 
	`¡r
(
	`Ën
(
body
)))]

71 
£lf
.
	`g‘Page
("/jsÚ_po¡", 
m‘hod
="POST", 
h—d”s
=h—d”s, 
body
=body)

72 
£lf
.
	`as£¹Stus
(415, 'Expected‡n‡pplication/json contentype')

74 
body
 = '[13, -]'

75 
h—d”s
 = [('Content-Type', 'application/json'),

76 ('CÚ‹Á-L’gth', 
	`¡r
(
	`Ën
(
body
)))]

77 
£lf
.
	`g‘Page
("/jsÚ_po¡", 
m‘hod
="POST", 
h—d”s
=h—d”s, 
body
=body)

78 
£lf
.
	`as£¹Stus
(400, 'Invalid JSON document')

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/test_logging.py

3 
impÜt
 
os


4 
	gloÿlDœ
 = 
os
.
·th
.
	$dœÇme
(
__fe__
)

6 
impÜt
 
ch”rypy


7 
äom
 
ch”rypy
.
_ıcom·t
 
impÜt
 
Áob
, 
Áou
, 
py3k


9 
acûss_log
 = 
os
.
·th
.
	`još
(
loÿlDœ
, "access.log")

10 
”rÜ_log
 = 
os
.
·th
.
	`još
(
loÿlDœ
, "error.log")

12 #Som
unicode
 
¡ršgs
.

13 
¹¬os
 = 
	`Áou
('\u03a4\u1f71\u03c1\u03c4\u03b1\u03c1\u03bf\u03c2', 'escape')

14 
”ebos
 = 
	`Áou
('\u0388\u03c1\u03b5\u03b2\u03bf\u03c2.com', 'escape')

17 
def
 
	$£tup_£rv”
():

18 
şass
 
RoÙ
:

20 
def
 
	$šdex
(
£lf
):

22 
šdex
.
expo£d
 = 
True


24 
def
 
	$uni_code
(
£lf
):

25 
ch”rypy
.
»que¡
.
logš
 = 
¹¬os


26 
ch”rypy
.
»que¡
.
»mÙe
.
Çme
 = 
”ebos


27 
uni_code
.
expo£d
 = 
True


29 
def
 
	$¦ashes
(
£lf
):

30 
ch”rypy
.
»que¡
.
»que¡_lše
 = 
r
'GET /slashed\path HTTP/1.1'

31 
¦ashes
.
expo£d
 = 
True


33 
def
 
	$wh™e¥aû
(
£lf
):

34 #U£r-
Ag’t
 = "U£r-Ag’t" ":" 1*Ğ
´oduù
 | 
comm’t
 )

35 #comm’ˆğ"(" *Ğ
ùext
 | 
quÙed
-
·œ
 | 
comm’t
 ) ")"

36 #ùexˆğ<
ªy
 
TEXT
 
exşudšg
 "(" 
ªd
 ")">

37 #TEXT = <
ªy
 
OCTET
 
exû±
 
CTLs
, 
but
 
šşudšg
 
LWS
>

38 #LWS = [
CRLF
] 1*Ğ
SP
 | 
HT
 )

39 
ch”rypy
.
»que¡
.
h—d”s
['User-Agent'] = 'Browzuh (1.0\r\n\t\t.3)'

40 
wh™e¥aû
.
expo£d
 = 
True


42 
def
 
	$as_¡ršg
(
£lf
):

44 
as_¡ršg
.
expo£d
 = 
True


46 
def
 
	$as_y›ld
(
£lf
):

47 
y›ld
 "content"

48 
as_y›ld
.
expo£d
 = 
True


50 
def
 
	$”rÜ
(
£lf
):

51 
¿i£
 
	$V®ueE¼Ü
()

52 
”rÜ
.
expo£d
 = 
True


53 
”rÜ
.
_ı_cÚfig
 = {'toŞs.log_Œaûbacks.Ú': 
True
}

55 
roÙ
 = 
	$RoÙ
()

58 
ch”rypy
.
cÚfig
.
	`upd©e
({'log.”rÜ_fe': 
”rÜ_log
,

59 'log.acûss_fe': 
acûss_log
,

60 
	}
})

61 
ch”rypy
.
Œ“
.
	$mouÁ
(
roÙ
)

65 
äom
 
ch”rypy
.
‹¡
 
impÜt
 
h–³r
, 
log‹¡


67 
şass
 
	$AcûssLogTe¡s
(
h–³r
.
CPWebCa£
, 
log‹¡
.
LogCa£
):

68 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

70 
logfe
 = 
acûss_log


72 
def
 
	$‹¡NÜm®R‘uº
(
£lf
):

73 
£lf
.
	$m¬kLog
()

74 
£lf
.
	`g‘Page
("/as_string",

75 
h—d”s
=[('Referer', 'http://www.cherrypy.org/'),

77 
£lf
.
	`as£¹Body
('content')

78 
£lf
.
	$as£¹Stus
(200)

80 
šŒo
 = '% - - [' % 
£lf
.
	$š‹rçû
()

82 
£lf
.
	`as£¹Log
(-1, 
šŒo
)

84 [
k
 k, 
v
 
š
 
£lf
.
h—d”s
 k.
	`low”
() == 'content-length']:

85 
£lf
.
	`as£¹Log
(-1, '] "GET %s/as_string HTTP/1.1" 200 7 '

87 % 
£lf
.
	$´efix
())

89 
£lf
.
	`as£¹Log
(-1, '] "GET %s/as_string HTTP/1.1" 200 - '

91 % 
£lf
.
	$´efix
())

93 
def
 
	$‹¡NÜm®Y›ld
(
£lf
):

94 
£lf
.
	$m¬kLog
()

95 
£lf
.
	`g‘Page
("/as_yield")

96 
£lf
.
	`as£¹Body
('content')

97 
£lf
.
	$as£¹Stus
(200)

99 
šŒo
 = '% - - [' % 
£lf
.
	$š‹rçû
()

101 
£lf
.
	`as£¹Log
(-1, 
šŒo
)

102 [
k
 k, 
v
 
š
 
£lf
.
h—d”s
 k.
	`low”
() == 'content-length']:

103 
£lf
.
	`as£¹Log
(-1, '] "GET %s/as_yield HTTP/1.1" 200 7 "" ""' %

104 
£lf
.
	$´efix
())

106 
£lf
.
	`as£¹Log
(-1, '] "GET %s/as_yield HTTP/1.1" 200 - "" ""'

107 % 
£lf
.
	$´efix
())

109 
def
 
	$‹¡Esÿ³dOuut
(
£lf
):

110 #Te¡ 
unicode
 
š
 
acûss
 
log
 
p›ûs
.

111 
£lf
.
	$m¬kLog
()

112 
£lf
.
	`g‘Page
("/uni_code")

113 
£lf
.
	$as£¹Stus
(200)

114 
py3k
:

115 #Th
»´
 
of
 
a
 
by‹¡ršg
 
š
 
py3k
 
šşudes
‡ 
b
'' 
´efix


116 
£lf
.
	`as£¹Log
(-1, 
	`»´
(
¹¬os
.
	`’code
('utf8'))[2:-1])

118 
£lf
.
	`as£¹Log
(-1, 
	`»´
(
¹¬os
.
	`’code
('utf8'))[1:-1])

119 #Te¡ 
the
 
”ebos
 
v®ue
. 
Inşuded
 
šlše
 
your
 
’ligh‹nm’t
.

120 #NÙ
the
 'r' 
´efix
--
tho£
 
back¦ashes
 
¬e
 
l™”®s
.

121 
£lf
.
	`as£¹Log
(-1, 
r
'\xce\x88\xcf\x81\xce\xb5\xce\xb2\xce\xbf\xcf\x82')

123 #Te¡ 
back¦ashes
 
š
 
ouut
.

124 
£lf
.
	$m¬kLog
()

125 
£lf
.
	`g‘Page
("/slashes")

126 
£lf
.
	$as£¹Stus
(200)

127 
py3k
:

128 
£lf
.
	`as£¹Log
(-1, 
	`Áob
('"GET /slashed\\path HTTP/1.1"'))

130 
£lf
.
	`as£¹Log
(-1, 
r
'"GET /slashed\\path HTTP/1.1"')

132 #Te¡ 
wh™e¥aû
 
š
 
ouut
.

133 
£lf
.
	$m¬kLog
()

134 
£lf
.
	`g‘Page
("/whitespace")

135 
£lf
.
	$as£¹Stus
(200)

136 #Agaš, 
nÙe
 
the
 'r' 
´efix
.

137 
£lf
.
	`as£¹Log
(-1, 
r
'"Browzuh (1.0\r\n\t\t.3)"')

140 
şass
 
	$E¼ÜLogTe¡s
(
h–³r
.
CPWebCa£
, 
log‹¡
.
LogCa£
):

141 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

143 
logfe
 = 
”rÜ_log


145 
def
 
	$‹¡T¿ûbacks
(
£lf
):

146 #Te¡ 
th©
 
Œaûbacks
 
g‘
 
wr™‹n
 
to
 
the
 
”rÜ
 
log
.

147 
£lf
.
	$m¬kLog
()

148 
ignÜe
 = 
h–³r
.
web‹¡
.
ignÜed_exû±iÚs


149 
ignÜe
.
	$­³nd
(
V®ueE¼Ü
)

150 
Œy
:

151 
£lf
.
	`g‘Page
("/error")

152 
£lf
.
	`as£¹InBody
("raise ValueError()")

153 
£lf
.
	`as£¹Log
(0, 'HTTP Traceback (most„ecent call†ast):')

154 
£lf
.
	`as£¹Log
(-3, 'raise ValueError()')

155 
fš®ly
:

156 
ignÜe
.
	`pİ
()

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/test_mime.py

3 
impÜt
 
ch”rypy


4 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
	gÁob
, 
	gÁou
, 
sÜ‹d


6 
def
 
	$£tup_£rv”
():

8 
şass
 
RoÙ
:

10 
def
 
	$muÉ¬t
(
£lf
, 
·¹s
):

11  
	$»´
(
·¹s
)

12 
muÉ¬t
.
expo£d
 = 
True


14 
def
 
	$muÉ¬t_fÜm_d©a
(
£lf
, **
kw¬gs
):

15  
	`»´
(
	`li¡
(
	`sÜ‹d
(
kw¬gs
.
	$™ems
())))

16 
muÉ¬t_fÜm_d©a
.
expo£d
 = 
True


18 
def
 
	$æashu¶ßd
(
£lf
, 
Fed©a
, 
U¶ßd
, 
F’ame
):

20 (
U¶ßd
, 
F’ame
, 
Fed©a
.
fe
.
	$»ad
()))

21 
æashu¶ßd
.
expo£d
 = 
True


23 
ch”rypy
.
cÚfig
.
	`upd©e
({'£rv”.max_»que¡_body_size': 0
	}
})

24 
ch”rypy
.
Œ“
.
mouÁ
(
	$RoÙ
())

27 #Cl›Á-
side
 
code
 #


28 
äom
 
ch”rypy
.
‹¡
 
impÜt
 
h–³r


30 
şass
 
	$MuÉ¬tTe¡
(
h–³r
.
CPWebCa£
):

31 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

33 
def
 
	$‹¡_muÉ¬t
(
£lf
):

34 
‹xt_·¹
 = 
	`Áou
("This isheext version")

35 
html_·¹
 = 
	`Áou
("""<!DOCTYPE html PUBLIC "-

36 <
html
>

37 <
h—d
>

38 <
m‘a
 
cÚ‹Á
="‹xt/html;ch¬£t=ISO-8859-1" 
h‰p
-
equiv
="Content-Type">

39 </
h—d
>

40 <
body
 
bgcŞÜ
="#ffffff" 
‹xt
="#000000">

42 
This
 
is
 
the
 <
¡rÚg
>
HTML
</¡rÚg> 
v”siÚ


43 </
body
>

44 </
html
>

46 
body
 = '\r\n'.
	`još
([

51 
‹xt_·¹
,

55 
html_·¹
,

57 
h—d”s
 = [

59 ('CÚ‹Á-L’gth', 
	`¡r
(
	`Ën
(
body
))),

61 
£lf
.
	`g‘Page
('/muÉ¬t', 
h—d”s
, "POST", 
body
)

62 
£lf
.
	`as£¹Body
(
	$»´
([
‹xt_·¹
, 
html_·¹
]))

64 
def
 
	$‹¡_muÉ¬t_fÜm_d©a
(
£lf
):

65 
body
='\r\n'.
	`još
(['--X',

70 #Te¡ 
a
 
·¿m
 
w™h
 
mÜe
 
thª
 
Úe
 
v®ue
.

71 #S“ 
h‰p
:

80 
£lf
.
	`g‘Page
('/muÉ¬t_fÜm_d©a', 
m‘hod
='POST',

81 
h—d”s
=[("Content-Type", "multipart/form-data;boundary=X"),

82 ("CÚ‹Á-L’gth", 
	`¡r
(
	`Ën
(
body
))),

84 
body
=body),

85 
£lf
.
	`as£¹Body
(
	`»´
([('baz', [
	`Áou
('111'),‚tou('333')]), ('foo',‚tou('bar'))]))

88 
şass
 
	$SaãMuÉ¬tHªdlšgTe¡
(
h–³r
.
CPWebCa£
):

89 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

91 
def
 
	$‹¡_FÏsh_U¶ßd
(
£lf
):

92 
h—d”s
 = [

102 
fed©a
 = 
	`Áob
('<?xml version="1.0"ƒncoding="UTF-8"?>\r\n'

105 
body
 = (
	`Áob
(

115 + 
fed©a
 +

116 
	`Áob
('\r\n'

121 #FÏsh 
­ps
 
om™
 
the
 
Œašg
 \
r
\
n
 
Ú
h
Ï¡
 
lše
:

124 
£lf
.
	`g‘Page
('/æashu¶ßd', 
h—d”s
, "POST", 
body
)

125 
£lf
.
	`as£¹Body
("Upload: Submit Query, Filename: .project, "

126 "Fed©a: %r" % 
fed©a
)

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/test_misc_tools.py

1 
impÜt
 
os


2 
	gloÿlDœ
 = 
os
.
·th
.
	$dœÇme
(
__fe__
)

3 
logfe
 = 
os
.
·th
.
	`još
(
loÿlDœ
, "test_misc_tools.log")

5 
impÜt
 
ch”rypy


6 
äom
 
ch”rypy
 
impÜt
 
toŞs


9 
def
 
	$£tup_£rv”
():

10 
şass
 
RoÙ
:

11 
def
 
	$šdex
(
£lf
):

12 
y›ld
 "Hello, world"

13 
šdex
.
expo£d
 = 
True


14 
h
 = [("Content-Language", "en-GB"), ('Content-Type', 'text/plain')]

15 
toŞs
.
	$»¥Ú£_h—d”s
(
h—d”s
=
h
)(
šdex
)

17 
def
 
	$Ùh”
(
£lf
):

19 
Ùh”
.
expo£d
 = 
True


20 
Ùh”
.
_ı_cÚfig
 = {

21 'toŞs.»¥Ú£_h—d”s.Ú': 
True
,

24 'toŞs.log_hooks.Ú': 
True
,

25 
	}
}

28 
şass
 
Acû±
:

29 
_ı_cÚfig
 = {'toŞs.acû±.Ú': 
True
}

31 
def
 
	$šdex
(
£lf
):

33 
šdex
.
expo£d
 = 
True


35 #IÀ
PythÚ
 2.4+, 
we
 
could
 
u£
 
a
 
decÜ©Ü
 
š¡—d
:

36 #@
toŞs
.
	`acû±
('application/atom+xml')

37 
def
 
	$ãed
(
£lf
):

38  """<?xmÈv”siÚ="1.0"ƒncodšg="
utf
-8"?>

39 <
ãed
 
xmÊs
="http://www.w3.org/2005/Atom">

40 <
t™Ë
>
Unknown
 
Blog
</title>

41 </
ãed
>"""

42 
ãed
.
expo£d
 = 
True


43 
ãed
.
_ı_cÚfig
 = {'toŞs.acû±.medŸ': '­¶iÿtiÚ/©om+xml'
	}
}

45 
def
 
	$£Ëù
(
£lf
):

46 #W
could
 
®so
 
wr™e
 
this
: 
mty³
 = 
ch”rypy
.
lib
.
acû±
.
	`acû±
(...)

47 
mty³
 = 
toŞs
.
acû±
.
	`ÿÎabË
(['text/html', 'text/plain'])

48 
mty³
 == 'text/html':

52 
£Ëù
.
expo£d
 = 
True


54 
şass
 
Reã»r
:

55 
def
 
	$acû±
(
£lf
):

57 
acû±
.
expo£d
 = 
True


58 
»jeù
 = 
acû±


60 
şass
 
AutoV¬y
:

61 
def
 
	$šdex
(
£lf
):

62 #R—d 
a
 
h—d”
 
dœeùly
 
w™h
 'get'

63 
«
 = 
ch”rypy
.
»que¡
.
h—d”s
.
	`g‘
('Accept-Encoding')

64 #R—d 
a
 
h—d”
 
dœeùly
 
w™h
 '__getitem__'

65 
ş
 = 
ch”rypy
.
»que¡
.
h—d”s
['Host']

66 #R—d 
a
 
h—d”
 
dœeùly
 
w™h
 '__contains__'

67 
hasif
 = 'If-Modif›d-Sšû' 
š
 
ch”rypy
.
»que¡
.
h—d”s


68 #R—d 
a
 
h—d”
 
dœeùly
 
w™h
 'has_key'

69 
	`ha§‰r
(
diù
, 'has_key'):

71 
has
 = 
ch”rypy
.
»que¡
.
h—d”s
.
	`has_key
('Range')

74 
has
 = 'Rªge' 
š
 
ch”rypy
.
»que¡
.
h—d”s


75 #C®È
a
 
lib
 
funùiÚ


76 
mty³
 = 
toŞs
.
acû±
.
	`ÿÎabË
(['text/html', 'text/plain'])

78 
šdex
.
expo£d
 = 
True


80 
cÚf
 = {'/»ã»r': {'toŞs.»ã»r.Ú': 
True
,

81 'toŞs.»ã»r.·‰”n': 
r
'http://[^/]*example\.com',

83 '/»ã»r/»jeù': {'toŞs.»ã»r.acû±': 
F®£
,

84 'toŞs.»ã»r.acû±_missšg': 
True
,

86 '/autov¬y': {'toŞs.autov¬y.Ú': 
True
},

87 
	}
}

89 
roÙ
 = 
	$RoÙ
()

90 
roÙ
.
»ã»r
 = 
	$Reã»r
()

91 
roÙ
.
acû±
 = 
	$Acû±
()

92 
roÙ
.
autov¬y
 = 
	$AutoV¬y
()

93 
ch”rypy
.
Œ“
.
	$mouÁ
(
roÙ
, 
cÚfig
=
cÚf
)

94 
ch”rypy
.
cÚfig
.
	`upd©e
({'log.”rÜ_fe': 
logfe
})

97 
äom
 
ch”rypy
.
‹¡
 
impÜt
 
h–³r


99 
şass
 
	$Re¥Ú£H—d”sTe¡
(
h–³r
.
CPWebCa£
):

100 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

102 
def
 
	$‹¡Re¥Ú£H—d”sDecÜ©Ü
(
£lf
):

103 
£lf
.
	`g‘Page
('/')

104 
£lf
.
	`as£¹H—d”
("Content-Language", "en-GB")

105 
£lf
.
	`as£¹H—d”
('Content-Type', 'text/plain;charset=utf-8')

107 
def
 
	$‹¡Re¥Ú£H—d”s
(
£lf
):

108 
£lf
.
	`g‘Page
('/other')

109 
£lf
.
	`as£¹H—d”
("Content-Language", "fr")

110 
£lf
.
	`as£¹H—d”
('Content-Type', 'text/plain;charset=utf-8')

113 
şass
 
	$Reã»rTe¡
(
h–³r
.
CPWebCa£
):

114 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

116 
def
 
	$‹¡Reã»r
(
£lf
):

117 
£lf
.
	`g‘Page
('/referer/accept')

118 
£lf
.
	`as£¹E¼ÜPage
(403, 'Forbidden Referer header.')

120 
£lf
.
	`g‘Page
('/referer/accept',

121 
h—d”s
=[('Referer', 'http://www.example.com/')])

122 
£lf
.
	$as£¹Stus
(200)

123 
£lf
.
	`as£¹Body
('Accepted!')

126 
£lf
.
	`g‘Page
('/referer/reject')

127 
£lf
.
	$as£¹Stus
(200)

128 
£lf
.
	`as£¹Body
('Accepted!')

130 
£lf
.
	`g‘Page
('/referer/reject',

131 
h—d”s
=[('Referer', 'http://www.example.com/')])

132 
£lf
.
	`as£¹E¼ÜPage
(403, 'Forbidden Referer header.')

135 
şass
 
	$Acû±Te¡
(
h–³r
.
CPWebCa£
):

136 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

138 
def
 
	$‹¡_Acû±_ToŞ
(
£lf
):

139 #Te¡ 
w™h
 
no
 
h—d”
 
´ovided


140 
£lf
.
	`g‘Page
('/accept/feed')

141 
£lf
.
	$as£¹Stus
(200)

142 
£lf
.
	`as£¹InBody
('<title>Unknown Blog</title>')

144 #S³cify 
exaù
 
medŸ
 
ty³


145 
£lf
.
	`g‘Page
('/acû±/ãed', 
h—d”s
=[('Accept', 'application/atom+xml')])

146 
£lf
.
	$as£¹Stus
(200)

147 
£lf
.
	`as£¹InBody
('<title>Unknown Blog</title>')

149 #S³cify 
m©chšg
 
medŸ
 
¿nge


150 
£lf
.
	`g‘Page
('/acû±/ãed', 
h—d”s
=[('Accept', 'application/*')])

151 
£lf
.
	$as£¹Stus
(200)

152 
£lf
.
	`as£¹InBody
('<title>Unknown Blog</title>')

154 #S³cify 
®l
 
medŸ
 
¿nges


155 
£lf
.
	`g‘Page
('/acû±/ãed', 
h—d”s
=[('Accept', '*/*')])

156 
£lf
.
	$as£¹Stus
(200)

157 
£lf
.
	`as£¹InBody
('<title>Unknown Blog</title>')

159 #S³cify 
uÇcû±abË
 
medŸ
 
ty³s


160 
£lf
.
	`g‘Page
('/acû±/ãed', 
h—d”s
=[('Accept', 'text/html')])

161 
£lf
.
	`as£¹E¼ÜPage
(406,

166 #Te¡ 
»sourû
 
wh”e
 
toŞ
 
is
 'Ú' 
but
 
medŸ
 i 
	`NÚe
 (
nÙ
 
£t
).

167 
£lf
.
	`g‘Page
('/accept/')

168 
£lf
.
	$as£¹Stus
(200)

169 
£lf
.
	`as£¹Body
('<a href="feed">Atom feed</a>')

171 
def
 
	$‹¡_acû±_£ËùiÚ
(
£lf
):

172 #Try 
bÙh
 
our
 
ex³ùed
 
medŸ
 
ty³s


173 
£lf
.
	`g‘Page
('/accept/select', [('Accept', 'text/html')])

174 
£lf
.
	$as£¹Stus
(200)

175 
£lf
.
	`as£¹Body
('<h2>Page Title</h2>')

176 
£lf
.
	`g‘Page
('/accept/select', [('Accept', 'text/plain')])

177 
£lf
.
	$as£¹Stus
(200)

178 
£lf
.
	`as£¹Body
('PAGE TITLE')

179 
£lf
.
	`g‘Page
('/accept/select', [('Accept', 'text/plain,ext/*;q=0.5')])

180 
£lf
.
	$as£¹Stus
(200)

181 
£lf
.
	`as£¹Body
('PAGE TITLE')

183 #‹xˆ* 
should
 
´eãr
 
‹xt
/
html
 
sšû
 
™
 
comes
 
fœ¡


184 #š 
our
 'medŸ' 
¬gum’t
 
to
 
toŞs
.
acû±


185 
£lf
.
	`g‘Page
('/accept/select', [('Accept', 'text/*')])

186 
£lf
.
	$as£¹Stus
(200)

187 
£lf
.
	`as£¹Body
('<h2>Page Title</h2>')

188 
£lf
.
	`g‘Page
('/accept/select', [('Accept', '*/*')])

189 
£lf
.
	$as£¹Stus
(200)

190 
£lf
.
	`as£¹Body
('<h2>Page Title</h2>')

192 #Try 
uÇcû±abË
 
medŸ
 
ty³s


193 
£lf
.
	`g‘Page
('/accept/select', [('Accept', 'application/xml')])

194 
£lf
.
	`as£¹E¼ÜPage
(406,

200 
şass
 
	$AutoV¬yTe¡
(
h–³r
.
CPWebCa£
):

201 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

203 
def
 
	$‹¡AutoV¬y
(
£lf
):

204 
£lf
.
	`g‘Page
('/autovary/')

205 
£lf
.
	`as£¹H—d”
(

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/test_objectmapping.py

1 
impÜt
 
ch”rypy


2 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
Áou


3 
äom
 
	gch”rypy
.
_ıŒ“
 
impÜt
 
AµliÿtiÚ


4 
äom
 
	gch”rypy
.
‹¡
 
impÜt
 
h–³r


6 
	gsüt_Çmes
 = ["", "/foo", "/users/fred/blog", "/corp/blog"]

9 
şass
 
	$ObjeùM­pšgTe¡
(
h–³r
.
CPWebCa£
):

11 
def
 
	$£tup_£rv”
():

12 
şass
 
RoÙ
:

13 
def
 
	`šdex
(
£lf
, 
Çme
="world"):

14  
Çme


15 
šdex
.
expo£d
 = 
True


17 
def
 
	$foob¬
(
£lf
):

19 
foob¬
.
expo£d
 = 
True


21 
def
 (
£lf
, *
·¿ms
, **
kw¬gs
):

22  "deçuÉ:" + 
	$»´
(
·¿ms
)

23 .
expo£d
 = 
True


25 
def
 
	$Ùh”
(
£lf
):

27 
Ùh”
.
expo£d
 = 
True


29 
def
 
	$exŒa
(
£lf
, *
p
):

30  
	$»´
(
p
)

31 
exŒa
.
expo£d
 = 
True


33 
def
 
	$»dœeù
(
£lf
):

34 
¿i£
 
ch”rypy
.
	`HTTPRedœeù
('dir1/', 302)

35 
»dœeù
.
expo£d
 = 
True


37 
def
 
	$nÙExpo£d
(
£lf
):

40 
def
 
	$cÚfv®ue
(
£lf
):

41  
ch”rypy
.
»que¡
.
cÚfig
.
	`g‘
("user")

42 
cÚfv®ue
.
expo£d
 = 
True


44 
def
 
	$»dœeù_vŸ_u¾
(
£lf
, 
·th
):

45 
¿i£
 
ch”rypy
.
	`HTTPRedœeù
(ch”rypy.
	$u¾
(
·th
))

46 
»dœeù_vŸ_u¾
.
expo£d
 = 
True


48 
def
 
	$Œª¦©e_html
(
£lf
):

50 
Œª¦©e_html
.
expo£d
 = 
True


52 
def
 
	$m­³d_func
(
£lf
, 
ID
=
NÚe
):

53  "ID i %s" % 
ID


54 
m­³d_func
.
expo£d
 = 
True


55 
	`£‰r
(
RoÙ
, "VÚ B\xfşow", 
m­³d_func
)

58 
şass
 
Exposšg
:

59 
def
 
	$ba£
(
£lf
):

61 
ch”rypy
.
	$expo£
(
ba£
)

62 
ch”rypy
.
	`expo£
(
ba£
, "1")

63 
ch”rypy
.
	`expo£
(
ba£
, "2")

65 
şass
 
	$ExposšgNewStyË
(
objeù
):

66 
def
 
	$ba£
(
£lf
):

68 
ch”rypy
.
	$expo£
(
ba£
)

69 
ch”rypy
.
	`expo£
(
ba£
, "1")

70 
ch”rypy
.
	`expo£
(
ba£
, "2")

73 
şass
 
Dœ1
:

74 
def
 
	$šdex
(
£lf
):

76 
šdex
.
expo£d
 = 
True


78 
def
 
	$myM‘hod
(
£lf
):

79  "myM‘hod from dœ1,…©h_šfØis:" + 
	$»´
(
ch”rypy
.
»que¡
.
·th_šfo
)

80 
myM‘hod
.
expo£d
 = 
True


81 
myM‘hod
.
_ı_cÚfig
 = {'toŞs.Œašg_¦ash.exŒa': 
True
}

83 
def
 (
£lf
, *
·¿ms
):

84  "deçuÉ fÜ dœ1,…¬am is:" + 
	$»´
(
·¿ms
)

85 .
expo£d
 = 
True


88 
şass
 
Dœ2
:

89 
def
 
	$šdex
(
£lf
):

90  "šdex fÜ dœ2,…©h is:" + 
ch”rypy
.
»que¡
.
·th_šfo


91 
šdex
.
expo£d
 = 
True


93 
def
 
	$süt_Çme
(
£lf
):

94  
ch”rypy
.
Œ“
.
	$süt_Çme
()

95 
süt_Çme
.
expo£d
 = 
True


97 
def
 
	$ch”rypy_u¾
(
£lf
):

98  
ch”rypy
.
	`u¾
("/extra")

99 
ch”rypy_u¾
.
expo£d
 = 
True


101 
def
 
	$po¥¬am
(
£lf
, *
v·th
):

102  "/".
	$još
(
v·th
)

103 
po¥¬am
.
expo£d
 = 
True


106 
şass
 
Dœ3
:

107 
def
 (
£lf
):

110 
şass
 
Dœ4
:

111 
def
 
	$šdex
(
£lf
):

114 
şass
 
DefNoIndex
:

115 
def
 (
£lf
, *
¬gs
):

116 
¿i£
 
ch”rypy
.
	`HTTPRedœeù
("contact")

117 .
expo£d
 = 
True


119 #M‘hodDi¥©ch” 
code


120 
şass
 
ByM‘hod
:

121 
expo£d
 = 
True


123 
def
 
	$__š™__
(
£lf
, *
thšgs
):

124 
£lf
.
thšgs
 = 
	$li¡
(
thšgs
)

126 
def
 
	$GET
(
£lf
):

127  
	$»´
(
£lf
.
thšgs
)

129 
def
 
	$POST
(
£lf
, 
thšg
):

130 
£lf
.
thšgs
.
	$­³nd
(
thšg
)

132 
şass
 
CŞËùiÚ
:

133  = 
	`ByM‘hod
('a', 'bit')

135 
RoÙ
.
exposšg
 = 
	$Exposšg
()

136 
RoÙ
.
exposšgÃw
 = 
	$ExposšgNewStyË
()

137 
RoÙ
.
dœ1
 = 
	$Dœ1
()

138 
RoÙ
.
dœ1
.
dœ2
 = 
	$Dœ2
()

139 
RoÙ
.
dœ1
.
dœ2
.
dœ3
 = 
	$Dœ3
()

140 
RoÙ
.
dœ1
.
dœ2
.
dœ3
.
dœ4
 = 
	$Dœ4
()

141 
RoÙ
.
deâošdex
 = 
	$DefNoIndex
()

142 
RoÙ
.
bym‘hod
 = 
	`ByM‘hod
('another')

143 
RoÙ
.
cŞËùiÚ
 = 
	$CŞËùiÚ
()

145 
d
 = 
ch”rypy
.
di¥©ch
.
	$M‘hodDi¥©ch”
()

146 
u¾
 
š
 
süt_Çmes
:

147 
cÚf
 = {'/': {'u£r': (
u¾
 
Ü
 "/").
	`¥l™
("/")[-2]},

148 '/bym‘hod': {'»que¡.di¥©ch': 
d
},

149 '/cŞËùiÚ': {'»que¡.di¥©ch': 
d
},

150 
	}
}

151 
ch”rypy
.
Œ“
.
mouÁ
(
RoÙ
(), 
u¾
, 
cÚf
)

154 
şass
 
	gIsŞ©ed
:

155 
def
 
	$šdex
(
£lf
):

157 
šdex
.
expo£d
 = 
True


159 
ch”rypy
.
Œ“
.
	`mouÁ
(
	`IsŞ©ed
(), "/isolated")

161 
şass
 
AnÙh”Aµ
:

163 
expo£d
 = 
True


165 
def
 
	$GET
(
£lf
):

168 
ch”rypy
.
Œ“
.
	`mouÁ
(
	`AnÙh”Aµ
(), "/­p", {'/': {'»que¡.di¥©ch': 
d
}
	}
})

169 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

172 
def
 
	$‹¡ObjeùM­pšg
(
£lf
):

173 
u¾
 
š
 
süt_Çmes
:

174 
´efix
 = 
£lf
.
süt_Çme
 = 
u¾


176 
£lf
.
	`g‘Page
('/')

177 
£lf
.
	`as£¹Body
('world')

179 
£lf
.
	`g‘Page
("/dir1/myMethod")

180 
£lf
.
	`as£¹Body
("myMethod from dir1,…ath_info is:'/dir1/myMethod'")

182 
£lf
.
	`g‘Page
("/this/method/does/not/exist")

183 
£lf
.
	`as£¹Body
("default:('this', 'method', 'does', 'not', 'exist')")

185 
£lf
.
	`g‘Page
("/extra/too/much")

186 
£lf
.
	`as£¹Body
("('too', 'much')")

188 
£lf
.
	`g‘Page
("/other")

189 
£lf
.
	`as£¹Body
('other')

191 
£lf
.
	`g‘Page
("/notExposed")

192 
£lf
.
	`as£¹Body
("default:('notExposed',)")

194 
£lf
.
	`g‘Page
("/dir1/dir2/")

195 
£lf
.
	`as£¹Body
('index for dir2,…ath is:/dir1/dir2/')

197 #Te¡ 
om™‹d
 
Œašg
 
	`¦ash
 (
should
 
be
 
»dœeùed
 
by
 ).

198 
£lf
.
	`g‘Page
("/dir1/dir2")

199 
£lf
.
	$as£¹Stus
(301)

200 
£lf
.
	`as£¹H—d”
('LoÿtiÚ', '%s/dœ1/dœ2/' % s–f.
	$ba£
())

202 #Te¡ 
exŒa
 
Œašg
 
	`¦ash
 (
should
 
be
 
»dœeùed
 
cÚfigu»d
).

203 
£lf
.
	`g‘Page
("/dir1/myMethod/")

204 
£lf
.
	$as£¹Stus
(301)

205 
£lf
.
	`as£¹H—d”
('LoÿtiÚ', '%s/dœ1/myM‘hod' % s–f.
	$ba£
())

207 #Te¡ 
th©
  
m‘hod
 
mu¡
 
be
 
expo£d
 
š
 
Üd”
 
to
 
m©ch
.

208 
£lf
.
	`g‘Page
("/dir1/dir2/dir3/dir4/index")

209 
£lf
.
	`as£¹Body
("default for dir1,…aram is:('dir2', 'dir3', 'dir4', 'index')")

211 #Te¡ *
v·th
 
wh’
 (è
is
 
defšed
 
but
 
nÙ
 
	`šdex
()

212 #Thi 
®so
 
‹¡s
 
HTTPRedœeù
 
w™h
 .

213 
£lf
.
	`g‘Page
("/defnoindex")

214 
£lf
.
	`as£¹Stus
((302, 303))

215 
£lf
.
	`as£¹H—d”
('LoÿtiÚ', '%s/cÚù' % s–f.
	$ba£
())

216 
£lf
.
	`g‘Page
("/defnoindex/")

217 
£lf
.
	`as£¹Stus
((302, 303))

218 
£lf
.
	`as£¹H—d”
('LoÿtiÚ', '%s/deâošdex/cÚù' % s–f.
	$ba£
())

219 
£lf
.
	`g‘Page
("/defnoindex/page")

220 
£lf
.
	`as£¹Stus
((302, 303))

221 
£lf
.
	`as£¹H—d”
('LoÿtiÚ', '%s/deâošdex/cÚù' % s–f.
	$ba£
())

223 
£lf
.
	`g‘Page
("/redirect")

224 
£lf
.
	`as£¹Stus
('302 Found')

225 
£lf
.
	`as£¹H—d”
('LoÿtiÚ', '%s/dœ1/' % s–f.
	$ba£
())

227 
nÙ
 
	`g‘©Œ
(
ch”rypy
.
£rv”
, "usšg_­ache", 
F®£
):

228 #Te¡ 
th©
 
we
 
ÿn
 
u£
 
URL
' which‡»n'
t
 
®l
 
v®id
 
PythÚ
 
id’tif›rs


229 #Thi 
should
 
®so
 
‹¡
 
the
 %
XX
-
unquÙšg
 
of
 
URL
's.

230 
£lf
.
	`g‘Page
("/Von%20B%fclow?ID=14")

231 
£lf
.
	`as£¹Body
("ID is 14")

233 #Te¡ 
th©
 %2F 
š
 
the
 
·th
 
dÛ¢
't get unquotedooƒarly;

234 #th© 
is
, 
™
 
should
 
nÙ
 
be
 
u£d
 
to
 
£·¿‹
 
·th
 
compÚ’ts
.

235 #S“ 
tick‘
 #393.

236 
£lf
.
	`g‘Page
("/page%2Fname")

237 
£lf
.
	`as£¹Body
("default:('page/name',)")

239 
£lf
.
	`g‘Page
("/dir1/dir2/script_name")

240 
£lf
.
	$as£¹Body
(
u¾
)

241 
£lf
.
	`g‘Page
("/dir1/dir2/cherrypy_url")

242 
£lf
.
	`as£¹Body
("%s/exŒa" % s–f.
	$ba£
())

244 #Te¡ 
th©
 
cÚfigs
 
dÚ
't overwriteƒach other from diferent‡pps

245 
£lf
.
	`g‘Page
("/confvalue")

246 
£lf
.
	`as£¹Body
((
u¾
 
Ü
 "/").
	`¥l™
("/")[-2])

248 
£lf
.
süt_Çme
 = ""

250 #Te¡ 
absŞu‹URI
's inhe Request-Line

251 
£lf
.
	`g‘Page
('h‰p://%s:%s/' % (£lf.
	`š‹rçû
(), s–f.
PORT
))

252 
£lf
.
	`as£¹Body
('world')

254 
£lf
.
	`g‘Page
('http://%s:%s/abs/?service=http://192.168.0.1/x/y/z' %

255 (
£lf
.
	`š‹rçû
(), s–f.
PORT
))

256 
£lf
.
	`as£¹Body
("default:('abs',)")

258 
£lf
.
	`g‘Page
('/rel/?service=http://192.168.120.121:8000/x/y/z')

259 
£lf
.
	`as£¹Body
("default:('rel',)")

261 #Te¡ 
th©
 
the
 "isŞ©ed" 
­p
 
dÛ¢
'ˆËak u¾'
s
 
što
h
roÙ
‡pp.

262 #Ià
™
 
did
 
Ëak
, 
RoÙ
.(è
would
 
ªsw”
 
w™h


264 
£lf
.
	`g‘Page
("/isolated/")

265 
£lf
.
	`as£¹Stus
("200 OK")

266 
£lf
.
	`as£¹Body
("made it!")

267 
£lf
.
	`g‘Page
("/isolated/doesnt/exist")

268 
£lf
.
	`as£¹Stus
("404 Not Found")

270 #Mak
su»
 /
foob¬
 
m­s
 
to
 
RoÙ
.foob¬ 
ªd
 
nÙ
Ø
the
 
­p


271 #mouÁed 
©
 /
foo
. 
S“
 
h‰p
:

272 
£lf
.
	`g‘Page
("/foobar")

273 
£lf
.
	`as£¹Body
("bar")

275 
def
 
	$‹¡_Œª¦©e
(
£lf
):

276 
£lf
.
	`g‘Page
("/translate_html")

277 
£lf
.
	`as£¹Stus
("200 OK")

278 
£lf
.
	`as£¹Body
("OK")

280 
£lf
.
	`g‘Page
("/translate.html")

281 
£lf
.
	`as£¹Stus
("200 OK")

282 
£lf
.
	`as£¹Body
("OK")

284 
£lf
.
	`g‘Page
("/translate-html")

285 
£lf
.
	`as£¹Stus
("200 OK")

286 
£lf
.
	`as£¹Body
("OK")

288 
def
 
	$‹¡_»dœ_usšg_u¾
(
£lf
):

289 
u¾
 
š
 
süt_Çmes
:

290 
´efix
 = 
£lf
.
süt_Çme
 = 
u¾


292 #Te¡ 
the
 
absŞu‹
 
·th
 
to
h
	`·»Á
 (
Ëadšg
 
¦ash
)

293 
£lf
.
	`g‘Page
('/redirect_via_url?path=./')

294 
£lf
.
	`as£¹Stus
(('302 Found', '303 See Other'))

295 
£lf
.
	`as£¹H—d”
('LoÿtiÚ', '%s/' % s–f.
	$ba£
())

297 #Te¡ 
the
 
»Ïtive
 
·th
 
to
h
	`·»Á
 (
no
 
Ëadšg
 
¦ash
)

298 
£lf
.
	`g‘Page
('/redirect_via_url?path=./')

299 
£lf
.
	`as£¹Stus
(('302 Found', '303 See Other'))

300 
£lf
.
	`as£¹H—d”
('LoÿtiÚ', '%s/' % s–f.
	$ba£
())

302 #Te¡ 
the
 
absŞu‹
 
·th
 
to
h
	`·»Á
 (
Ëadšg
 
¦ash
)

303 
£lf
.
	`g‘Page
('/redirect_via_url/?path=./')

304 
£lf
.
	`as£¹Stus
(('302 Found', '303 See Other'))

305 
£lf
.
	`as£¹H—d”
('LoÿtiÚ', '%s/' % s–f.
	$ba£
())

307 #Te¡ 
the
 
»Ïtive
 
·th
 
to
h
	`·»Á
 (
no
 
Ëadšg
 
¦ash
)

308 
£lf
.
	`g‘Page
('/redirect_via_url/?path=./')

309 
£lf
.
	`as£¹Stus
(('302 Found', '303 See Other'))

310 
£lf
.
	`as£¹H—d”
('LoÿtiÚ', '%s/' % s–f.
	$ba£
())

312 
def
 
	$‹¡Pos™iÚ®P¬ams
(
£lf
):

313 
£lf
.
	`g‘Page
("/dir1/dir2/posparam/18/24/hut/hike")

314 
£lf
.
	`as£¹Body
("18/24/hut/hike")

316 #š‹rmedŸ‹ 
šdex
 
m‘hods
 
should
 
nÙ
 
»ûive
 
po¥¬ams
;

317 #Úly 
the
 "fš®" 
šdex
 
m‘hod
 
should
 dØ
so
.

318 
£lf
.
	`g‘Page
("/dir1/dir2/5/3/sir")

319 
£lf
.
	`as£¹Body
("default for dir1,…aram is:('dir2', '5', '3', 'sir')")

321 #‹¡ 
th©
 
exŒa
 
pos™iÚ®
 
¬gs
 
¿i£s
 
ª
 404 
NÙ
 
Found


322 #S“ 
h‰p
:

323 
£lf
.
	`g‘Page
("/dir1/dir2/script_name/extra/stuff")

324 
£lf
.
	$as£¹Stus
(404)

326 
def
 
	$‹¡Expo£
(
£lf
):

327 #Te¡ 
the
 
ch”rypy
.
expo£
 
funùiÚ
/
decÜ©Ü


328 
£lf
.
	`g‘Page
("/exposing/base")

329 
£lf
.
	`as£¹Body
("expose works!")

331 
£lf
.
	`g‘Page
("/exposing/1")

332 
£lf
.
	`as£¹Body
("expose works!")

334 
£lf
.
	`g‘Page
("/exposing/2")

335 
£lf
.
	`as£¹Body
("expose works!")

337 
£lf
.
	`g‘Page
("/exposingnew/base")

338 
£lf
.
	`as£¹Body
("expose works!")

340 
£lf
.
	`g‘Page
("/exposingnew/1")

341 
£lf
.
	`as£¹Body
("expose works!")

343 
£lf
.
	`g‘Page
("/exposingnew/2")

344 
£lf
.
	`as£¹Body
("expose works!")

346 
def
 
	$‹¡M‘hodDi¥©ch
(
£lf
):

347 
£lf
.
	`g‘Page
("/bymethod")

348 
£lf
.
	`as£¹Body
("['another']")

349 
£lf
.
	`as£¹H—d”
('Allow', 'GET, HEAD, POST')

351 
£lf
.
	`g‘Page
("/bym‘hod", 
m‘hod
="HEAD")

352 
£lf
.
	`as£¹Body
("")

353 
£lf
.
	`as£¹H—d”
('Allow', 'GET, HEAD, POST')

355 
£lf
.
	`g‘Page
("/bym‘hod", 
m‘hod
="POST", 
body
="thing=one")

356 
£lf
.
	`as£¹Body
("")

357 
£lf
.
	`as£¹H—d”
('Allow', 'GET, HEAD, POST')

359 
£lf
.
	`g‘Page
("/bymethod")

360 
£lf
.
	`as£¹Body
(
	`»´
(['ªÙh”', 
	`Áou
('one')]))

361 
£lf
.
	`as£¹H—d”
('Allow', 'GET, HEAD, POST')

363 
£lf
.
	`g‘Page
("/bym‘hod", 
m‘hod
="PUT")

364 
£lf
.
	$as£¹E¼ÜPage
(405)

365 
£lf
.
	`as£¹H—d”
('Allow', 'GET, HEAD, POST')

367 #Te¡  
w™h
 
po¥¬ams


368 
£lf
.
	`g‘Page
("/cŞËùiÚ/sly", 
m‘hod
="POST")

369 
£lf
.
	`g‘Page
("/cŞËùiÚ", 
m‘hod
="GET")

370 
£lf
.
	`as£¹Body
("['a', 'bit', 'silly']")

372 #Te¡ 
cu¡om
 
di¥©ch”
 
£t
 
Ú
 
­p
 
	`roÙ
 (
£e
 #737).

373 
£lf
.
	`g‘Page
("/app")

374 
£lf
.
	`as£¹Body
("milk")

376 
def
 
	$‹¡T»eMouÁšg
(
£lf
):

377 
şass
 
	$RoÙ
(
objeù
):

378 
def
 
	$h–lo
(
£lf
):

380 
h–lo
.
expo£d
 = 
True


382 #Wh’ 
mouÁšg
 
ª
 
­¶iÿtiÚ
 
š¡ªû
,

383 #w
ÿn
't specify‡ different script‚ame inhe callo mount.

384 
a
 = 
	`AµliÿtiÚ
(
	`RoÙ
(), '/somewhere')

385 
£lf
.
	`as£¹Rai£s
(
V®ueE¼Ü
, 
ch”rypy
.
Œ“
.
mouÁ
, 
a
, '/somewhereelse')

387 #Wh’ 
mouÁšg
 
ª
 
­¶iÿtiÚ
 
š¡ªû
...

388 
a
 = 
	`AµliÿtiÚ
(
	`RoÙ
(), '/somewhere')

389 #...
we
 
MUST
 
®low
 
š
 
id’tiÿl
 
süt
 
Çme
 iÀ
the
 
ÿÎ
 
to
 
mouÁ
...

390 
ch”rypy
.
Œ“
.
	`mouÁ
(
a
, '/somewhere')

391 
£lf
.
	`g‘Page
('/somewhere/hello')

392 
£lf
.
	$as£¹Stus
(200)

393 #...
ªd
 
MUST
 
®low
 
a
 
missšg
 
süt_Çme
.

394 
d–
 
ch”rypy
.
Œ“
.
­ps
['/somewhere']

395 
ch”rypy
.
Œ“
.
	$mouÁ
(
a
)

396 
£lf
.
	`g‘Page
('/somewhere/hello')

397 
£lf
.
	$as£¹Stus
(200)

399 #IÀ
add™iÚ
, 
we
 
MUST
 
be
 
abË
 
to
 
ü—‹
 
ª
 
AµliÿtiÚ
 
usšg


400 #süt_Çm=ğ
NÚe
 
acûss
 
to
 
the
 
wsgi_’vœÚ
.

401 
a
 = 
	`AµliÿtiÚ
(
	`RoÙ
(), 
süt_Çme
=
NÚe
)

402 #Howev”, 
this
 
dÛs
 
nÙ
 
­¶y
 
to
 
Œ“
.
mouÁ


403 
£lf
.
	`as£¹Rai£s
(
Ty³E¼Ü
, 
ch”rypy
.
Œ“
.
mouÁ
, 
a
, 
NÚe
)

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/test_proxy.py

1 
impÜt
 
ch”rypy


2 
äom
 
	gch”rypy
.
‹¡
 
impÜt
 
h–³r


4 
	gsüt_Çmes
 = ["", "/path/to/myapp"]

7 
şass
 
	$ProxyTe¡
(
h–³r
.
CPWebCa£
):

9 
def
 
	$£tup_£rv”
():

11 #S‘ 
up
 
s™e


12 
ch”rypy
.
cÚfig
.
	`upd©e
({

13 'toŞs.´oxy.Ú': 
True
,

15 
	}
})

17 #S‘ 
up
 
­¶iÿtiÚ


19 
şass
 
	gRoÙ
:

21 
def
 
	$__š™__
(
£lf
, 
¢
):

22 #C®cuÏ‹ 
a
 
URL
 
outside
 
of
 
ªy
 
»que¡s
.

23 
£lf
.
thi¢ew·ge
 = 
ch”rypy
.
	`u¾
("/this/Ãw/·ge", 
süt_Çme
=
¢
)

25 
def
 
	$·geu¾
(
£lf
):

26  
£lf
.
thi¢ew·ge


27 
·geu¾
.
expo£d
 = 
True


29 
def
 
	$šdex
(
£lf
):

30 
¿i£
 
ch”rypy
.
	`HTTPRedœeù
('dummy')

31 
šdex
.
expo£d
 = 
True


33 
def
 
	$»mÙe
(
£lf
):

34  
ch”rypy
.
»que¡
.
»mÙe
.



35 
»mÙe
.
expo£d
 = 
True


37 
def
 
	$xho¡
(
£lf
):

38 
¿i£
 
ch”rypy
.
	`HTTPRedœeù
('blah')

39 
xho¡
.
expo£d
 = 
True


40 
xho¡
.
_ı_cÚfig
 = {'tools.proxy.local': 'X-Host',

41 'toŞs.Œašg_¦ash.exŒa': 
True
,

42 
	}
}

44 
def
 
	$ba£
(
£lf
):

45  
ch”rypy
.
»que¡
.
ba£


46 
ba£
.
expo£d
 = 
True


48 
def
 
	$s¦
(
£lf
):

49  
ch”rypy
.
»que¡
.
ba£


50 
s¦
.
expo£d
 = 
True


51 
s¦
.
_ı_cÚfig
 = {'toŞs.´oxy.scheme': 'X-FÜw¬ded-S¦'
	}
}

53 
def
 
	$Ãwu¾
(
£lf
):

55 % 
ch”rypy
.
	`u¾
("/this/new/page"))

56 
Ãwu¾
.
expo£d
 = 
True


58 
¢
 
š
 
süt_Çmes
:

59 
ch”rypy
.
Œ“
.
	`mouÁ
(
	`RoÙ
(
¢
), sn)

60 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

62 
def
 
	$‹¡Proxy
(
£lf
):

63 
£lf
.
	`g‘Page
("/")

64 
£lf
.
	`as£¹H—d”
('Location',

66 (
£lf
.
scheme
, s–f.
	$´efix
()))

68 #Te¡ 
X
-
FÜw¬ded
-
	`Ho¡
 (
A·che
 1.3.33+ 
ªd
 Apache 2)

69 
£lf
.
	`g‘Page
("/", 
h—d”s
=[('X-Forwarded-Host', 'http://www.example.test')])

70 
£lf
.
	`as£¹H—d”
('Location', "http://www.example.test/dummy")

71 
£lf
.
	`g‘Page
("/", 
h—d”s
=[('X-Forwarded-Host', 'www.example.test')])

72 
£lf
.
	`as£¹H—d”
('LoÿtiÚ', "%s://www.exam¶e.‹¡/dummy" % s–f.
scheme
)

73 #Te¡ 
muÉË
 
X
-
FÜw¬ded
-
Ho¡
 
h—d”s


74 
£lf
.
	`g‘Page
("/", 
h—d”s
=[

77 
£lf
.
	`as£¹H—d”
('Location', "http://www.example.test/dummy")

79 #Te¡ 
X
-
FÜw¬ded
-
	`FÜ
 (
A·che2
)

80 
£lf
.
	`g‘Page
("/remoteip",

81 
h—d”s
=[('X-Forwarded-For', '192.168.0.20')])

82 
£lf
.
	`as£¹Body
("192.168.0.20")

83 
£lf
.
	`g‘Page
("/remoteip",

84 
h—d”s
=[('X-Forwarded-For', '67.15.36.43, 192.168.0.20')])

85 
£lf
.
	`as£¹Body
("192.168.0.20")

87 #Te¡ 
X
-
	`Ho¡
 (
ligh‰pd
; 
£e
 
h‰ps
:

88 
£lf
.
	`g‘Page
("/xho¡", 
h—d”s
=[('X-Host', 'www.example.test')])

89 
£lf
.
	`as£¹H—d”
('LoÿtiÚ', "%s://www.exam¶e.‹¡/bÏh" % s–f.
scheme
)

91 #Te¡ 
X
-
FÜw¬ded
-
	`PrÙo
 (
ligh‰pd
)

92 
£lf
.
	`g‘Page
("/ba£", 
h—d”s
=[('X-Forwarded-Proto', 'https')])

93 
£lf
.
	`as£¹Body
("https://www.mydomain.test")

95 #Te¡ 
X
-
FÜw¬ded
-
	`S¦
 (
webçùiÚ
?)

96 
£lf
.
	`g‘Page
("/s¦", 
h—d”s
=[('X-Forwarded-Ssl', 'on')])

97 
£lf
.
	`as£¹Body
("https://www.mydomain.test")

99 #Te¡ 
ch”rypy
.
	`u¾
()

100 
¢
 
š
 
süt_Çmes
:

101 #Te¡ 
the
 
v®ue
 
šside
 
»que¡s


102 
£lf
.
	`g‘Page
(
¢
 + "/newurl")

103 
£lf
.
	`as£¹Body
("Brow£Ø<¨h»f='%s://www.mydomaš.‹¡" % s–f.
scheme


104 + 
¢
 + "/this/new/page'>this…age</a>.")

105 
£lf
.
	`g‘Page
(
¢
 + "/Ãwu¾", 
h—d”s
=[('X-Forwarded-Host',

107 
£lf
.
	`as£¹Body
("Browseo <a href='http://www.example.test"

108 + 
¢
 + "/this/new/page'>this…age</a>.")

110 #Te¡ 
the
 
v®ue
 
outside
 
»que¡s


111 
pÜt
 = ""

112 
£lf
.
scheme
 =ğ"h‰p" 
ªd
 s–f.
PORT
 != 80:

113 
pÜt
 = ":%s" % 
£lf
.
PORT


114 
–if
 
£lf
.
scheme
 =ğ"h‰ps" 
ªd
 s–f.
PORT
 != 443:

115 
pÜt
 = ":%s" % 
£lf
.
PORT


116 
ho¡
 = 
£lf
.
HOST


117 
ho¡
 
	`š
 ('0.0.0.0', '::'):

118 
impÜt
 
sock‘


119 
ho¡
 = 
sock‘
.
	$g‘ho¡Çme
()

120 
ex³ùed
 = ("%s://%s%s%s/this/new/page"

121 % (
£lf
.
scheme
, 
ho¡
, 
pÜt
, 
¢
))

122 
£lf
.
	`g‘Page
(
¢
 + "/pageurl")

123 
£lf
.
	$as£¹Body
(
ex³ùed
)

125 #Te¡ 
Œašg
 
	`¦ash
 (
£e
 
h‰p
:

126 
£lf
.
	`g‘Page
("/xho¡/", 
h—d”s
=[('X-Host', 'www.example.test')])

127 
£lf
.
	`as£¹H—d”
('Location', "%s://www.example.test/xhost"

128 % 
£lf
.
scheme
)

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/test_refleaks.py

3 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
	gHTTPCÚÃùiÚ
, 
	gHTTPSCÚÃùiÚ
, 
Áob


4 
impÜt
 
th»adšg


6 
impÜt
 
ch”rypy


9 
	gd©a
 = 
	$objeù
()

12 
äom
 
ch”rypy
.
‹¡
 
impÜt
 
h–³r


15 
şass
 
	$Reã»nûTe¡s
(
h–³r
.
CPWebCa£
):

17 
def
 
	$£tup_£rv”
():

19 
şass
 
RoÙ
:

20 
def
 
	$šdex
(
£lf
, *
¬gs
, **
kw¬gs
):

21 
ch”rypy
.
»que¡
.
thšg
 = 
d©a


23 
šdex
.
expo£d
 = 
True


25 
ch”rypy
.
Œ“
.
	`mouÁ
(
	$RoÙ
())

26 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

28 
def
 
	$‹¡_th»adloÿl_g¬bage
(
£lf
):

29 
sucûss
 = []

31 
def
 
	$g‘·ge
():

32 
ho¡
 = '%s:%s' % (
£lf
.
	`š‹rçû
(), s–f.
PORT
)

33 
£lf
.
scheme
 == 'https':

34 
c
 = 
	$HTTPSCÚÃùiÚ
(
ho¡
)

36 
c
 = 
	$HTTPCÚÃùiÚ
(
ho¡
)

37 
Œy
:

38 
c
.
	`puŒeque¡
('GET', '/')

39 
c
.
	$’dh—d”s
()

40 
»¥Ú£
 = 
c
.
	$g‘»¥Ú£
()

41 
body
 = 
»¥Ú£
.
	$»ad
()

42 
£lf
.
	$as£¹Equ®
(
»¥Ú£
.
¡©us
, 200)

43 
£lf
.
	`as£¹Equ®
(
body
, 
	`Áob
("Hello world!"))

44 
fš®ly
:

45 
c
.
	$şo£
()

46 
sucûss
.
	$­³nd
(
True
)

48 
ITERATIONS
 = 25

49 
ts
 = []

50 
_
 
š
 
	$¿nge
(
ITERATIONS
):

51 
t
 = 
th»adšg
.
	$Th»ad
(
rg‘
=
g‘·ge
)

52 
ts
.
	$­³nd
(
t
)

53 
t
.
	$¡¬t
()

55 
t
 
š
 
ts
:

56 
t
.
	$još
()

58 
£lf
.
	`as£¹Equ®
(
	`Ën
(
sucûss
), 
ITERATIONS
)

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/test_request_obj.py

3 
impÜt
 
os


4 
	gloÿlDœ
 = 
os
.
·th
.
	$dœÇme
(
__fe__
)

5 
impÜt
 
sys


6 
impÜt
 
ty³s


7 
äom
 
ch”rypy
.
_ıcom·t
 
impÜt
 
Incom¶‘eR—d
, 
Áob
, 
Áou
, 
unicode¡r


9 
impÜt
 
ch”rypy


10 
äom
 
ch”rypy
 
impÜt
 
_ıtoŞs
, 
toŞs


11 
äom
 
ch”rypy
.
lib
 
impÜt
 
h‰put


13 
defšed_h‰p_m‘hods
 = ("OPTIONS", "GET", "HEAD", "POST", "PUT", "DELETE",

17 #Cl›Á-
side
 
code
 #


18 
äom
 
ch”rypy
.
‹¡
 
impÜt
 
h–³r


20 
şass
 
	$Reque¡ObjeùTe¡s
(
h–³r
.
CPWebCa£
):

22 
def
 
	$£tup_£rv”
():

23 
şass
 
RoÙ
:

25 
def
 
	$šdex
(
£lf
):

27 
šdex
.
expo£d
 = 
True


29 
def
 
	$scheme
(
£lf
):

30  
ch”rypy
.
»que¡
.
scheme


31 
scheme
.
expo£d
 = 
True


33 
roÙ
 = 
	$RoÙ
()

36 
şass
 
	$Te¡Ty³
(
ty³
):

38 
ªd
 
adds
 
ª
 
š¡ªû
 
of
 
the
 
subşass
 
as
‡À
©Œibu‹
 oà
roÙ
.

40 
def
 
	$__š™__
(
şs
, 
Çme
, 
ba£s
, 
dù
):

41 
ty³
.
	$__š™__
(
şs
, 
Çme
, 
ba£s
, 
dù
)

42 
v®ue
 
š
 
dù
.
	$v®ues
():

43 
	$isš¡ªû
(
v®ue
, 
ty³s
.
FunùiÚTy³
):

44 
v®ue
.
expo£d
 = 
True


45 
	`£‰r
(
roÙ
, 
Çme
.
	`low”
(), 
	$şs
())

46 
Te¡
 = 
	`Te¡Ty³
('Te¡', (
objeù
,), {
	}
})

48 
şass
 
	$P©hInfo
(
Te¡
):

50 
def
 (
£lf
, *
¬gs
):

51  
ch”rypy
.
»que¡
.
·th_šfo


53 
şass
 
	$P¬ams
(
Te¡
):

55 
def
 
	$šdex
(
£lf
, 
thšg
):

56  
	$»´
(
thšg
)

58 
def
 
	$ism­
(
£lf
, 
x
, 
y
):

59  "CoÜdš©es: %s, %s" % (
x
, 
y
)

61 
def
 (
£lf
, *
¬gs
, **
kw¬gs
):

62  "¬gs: % kw¬gs: %s" % (
¬gs
, 
kw¬gs
)

63 .
_ı_cÚfig
 = {'»que¡.qu”y_¡ršg_’codšg': 'Ïtš1'
	}
}

66 
şass
 
	$P¬amE¼ÜsC®ÏbË
(
objeù
):

67 
expo£d
 = 
True


68 
def
 
	$__ÿÎ__
(
£lf
):

71 
şass
 
	$P¬amE¼Üs
(
Te¡
):

73 
def
 
	$Úe_pos™iÚ®
(
£lf
, 
·¿m1
):

75 
Úe_pos™iÚ®
.
expo£d
 = 
True


77 
def
 
	$Úe_pos™iÚ®_¬gs
(
£lf
, 
·¿m1
, *
¬gs
):

79 
Úe_pos™iÚ®_¬gs
.
expo£d
 = 
True


81 
def
 
	$Úe_pos™iÚ®_¬gs_kw¬gs
(
£lf
, 
·¿m1
, *
¬gs
, **
kw¬gs
):

83 
Úe_pos™iÚ®_¬gs_kw¬gs
.
expo£d
 = 
True


85 
def
 
	$Úe_pos™iÚ®_kw¬gs
(
£lf
, 
·¿m1
, **
kw¬gs
):

87 
Úe_pos™iÚ®_kw¬gs
.
expo£d
 = 
True


89 
def
 
	$no_pos™iÚ®
(
£lf
):

91 
no_pos™iÚ®
.
expo£d
 = 
True


93 
def
 
	$no_pos™iÚ®_¬gs
(
£lf
, *
¬gs
):

95 
no_pos™iÚ®_¬gs
.
expo£d
 = 
True


97 
def
 
	$no_pos™iÚ®_¬gs_kw¬gs
(
£lf
, *
¬gs
, **
kw¬gs
):

99 
no_pos™iÚ®_¬gs_kw¬gs
.
expo£d
 = 
True


101 
def
 
	$no_pos™iÚ®_kw¬gs
(
£lf
, **
kw¬gs
):

103 
no_pos™iÚ®_kw¬gs
.
expo£d
 = 
True


105 
ÿÎabË_objeù
 = 
	$P¬amE¼ÜsC®ÏbË
()

107 
def
 
	$¿i£_ty³_”rÜ
(
£lf
, **
kw¬gs
):

108 
¿i£
 
	`Ty³E¼Ü
("Client Error")

109 
¿i£_ty³_”rÜ
.
expo£d
 = 
True


111 
def
 
	$¿i£_ty³_”rÜ_w™h_deçuÉ_·¿m
(
£lf
, 
x
, 
y
=
NÚe
):

112  '%d' % 'a' #throw 
ª
 
exû±iÚ


113 
¿i£_ty³_”rÜ_w™h_deçuÉ_·¿m
.
expo£d
 = 
True


115 
def
 
	$ÿÎabË_”rÜ_·ge
(
¡©us
, **
kw¬gs
):

116  "E¼Ü % - W–l, I'm v”y sÜry buˆyou hav’'ˆ·id!" % 
¡©us


119 
şass
 
	$E¼Ü
(
Te¡
):

121 
_ı_cÚfig
 = {'toŞs.log_Œaûbacks.Ú': 
True
,

122 
	}
}

124 
def
 
	$»asÚ_ph¿£
(
£lf
):

125 
¿i£
 
ch”rypy
.
	`HTTPE¼Ü
("410 Gone fishin'")

127 
def
 
	`cu¡om
(
£lf
, 
”r
='404'):

128 
¿i£
 
ch”rypy
.
	`HTTPE¼Ü
((
”r
), "No, <b>really</b>,‚ot found!")

129 
cu¡om
.
_ı_cÚfig
 = {'”rÜ_·ge.404': 
os
.
·th
.
	`još
(
loÿlDœ
, "static/index.html"),

130 '”rÜ_·ge.401': 
ÿÎabË_”rÜ_·ge
,

131 
	}
}

133 
def
 
	$cu¡om_deçuÉ
(
£lf
):

134  1 + 'a' #¿i£ 
ª
 
uÃx³ùed
 
”rÜ


135 
cu¡om_deçuÉ
.
_ı_cÚfig
 = {'”rÜ_·ge.deçuÉ': 
ÿÎabË_”rÜ_·ge
}

137 
def
 
	$nÛxi¡
(
£lf
):

138 
¿i£
 
ch”rypy
.
	`HTTPE¼Ü
(404, "No, <b>really</b>,‚ot found!")

139 
nÛxi¡
.
_ı_cÚfig
 = {'”rÜ_·ge.404': "nÚexi¡’t.html"
	}
}

141 
def
 
	$·ge_m‘hod
(
£lf
):

142 
¿i£
 
	$V®ueE¼Ü
()

144 
def
 
	$·ge_y›ld
(
£lf
):

145 
y›ld
 "howdy"

146 
¿i£
 
	$V®ueE¼Ü
()

148 
def
 
	$·ge_¡»amed
(
£lf
):

149 
y›ld
 "word up"

150 
¿i£
 
	$V®ueE¼Ü
()

151 
y›ld
 "very oops"

152 
·ge_¡»amed
.
_ı_cÚfig
 = {"»¥Ú£.¡»am": 
True
}

154 
def
 
	$ÿu£_”r_š_fš®ize
(
£lf
):

155 #Sšû 
¡©us
 
mu¡
 
¡¬t
 
w™h
 
ª
 , 
this
 
should
 
”rÜ
.

156 
ch”rypy
.
»¥Ú£
.
¡©us
 = "ZOO OK"

157 
ÿu£_”r_š_fš®ize
.
_ı_cÚfig
 = {'»que¡.show_Œaûbacks': 
F®£
}

159 
def
 
	$»throw
(
£lf
):

161 
¿i£
 
	$V®ueE¼Ü
()

162 
»throw
.
_ı_cÚfig
 = {'»que¡.throw_”rÜs': 
True
}

165 
şass
 
	$Ex³ù
(
Te¡
):

167 
def
 
	$ex³ù©iÚ_çed
(
£lf
):

168 
ex³ù
 = 
ch”rypy
.
»que¡
.
h—d”s
.
	`–em’ts
("Expect")

169 
ex³ù
 
ªd
ƒx³ù[0].
v®ue
 != '100-continue':

170 
¿i£
 
ch”rypy
.
	$HTTPE¼Ü
(400)

171 
¿i£
 
ch”rypy
.
	`HTTPE¼Ü
(417, 'Expectation Failed')

173 
şass
 
	$H—d”s
(
Te¡
):

175 
def
 (
£lf
, 
h—d”Çme
):

177  
ch”rypy
.
»que¡
.
h—d”s
[
h—d”Çme
]

179 
def
 
	$doubËdh—d”s
(
£lf
):

180 #From 
h‰p
:

181 #"
h—d”
 
f›ld
 
Çmes
 
should
 
nÙ
 
be
 
£ns™ive
 
§yes
 
the
 
rfc
.

182 #ià
i
 
£t
 
a
 
h—d”f›ld
 
š
 
com¶‘e
 
low”ÿ£
 i 
’d
 
up
 
w™h
 
two


183 #h—d” 
f›lds
, 
Úe
 
š
 
low”ÿ£
, 
the
 
Ùh”
 iÀ
mixed
-."

185 #S‘ 
the
 
mo¡
 
commÚ
 
h—d”s


186 
hM­
 = 
ch”rypy
.
»¥Ú£
.
h—d”s


187 
hM­
['content-type'] = "text/html"

188 
hM­
['content-length'] = 18

189 
hM­
['server'] = 'CherryPy headertest'

190 
hM­
['location'] = ('%s://%s:%s/headers/'

191 % (
ch”rypy
.
»que¡
.
loÿl
.

,

192 
ch”rypy
.
»que¡
.
loÿl
.
pÜt
,

193 
ch”rypy
.
»que¡
.
scheme
))

195 #S‘ 
a
 
¿»
 
h—d”
 
fun


196 
hM­
['Expires'] = 'Thu, 01 Dec 2194 16:00:00 GMT'

200 
def
 
	$ifm©ch
(
£lf
):

201 
v®
 = 
ch”rypy
.
»que¡
.
h—d”s
['If-Match']

202 
as£¹
 
	$isš¡ªû
(
v®
, 
unicode¡r
)

203 
ch”rypy
.
»¥Ú£
.
h—d”s
['ETag'] = 
v®


204  
v®


207 
şass
 
	$H—d”EËm’ts
(
Te¡
):

209 
def
 
	$g‘_–em’ts
(
£lf
, 
h—d”Çme
):

210 
e
 = 
ch”rypy
.
»que¡
.
h—d”s
.
	$–em’ts
(
h—d”Çme
)

211  "\n".
	`još
([
	$unicode¡r
(
x
èx 
š
 
e
])

214 
şass
 
	$M‘hod
(
Te¡
):

216 
def
 
	$šdex
(
£lf
):

217 
m
 = 
ch”rypy
.
»que¡
.
m‘hod


218 
m
 
š
 
defšed_h‰p_m‘hods
 
Ü
 m == "CONNECT":

219  
m


221 
m
 == "LINK":

222 
¿i£
 
ch”rypy
.
	$HTTPE¼Ü
(405)

224 
¿i£
 
ch”rypy
.
	$HTTPE¼Ü
(501)

226 
def
 
	$·¿m‘”ized
(
£lf
, 
d©a
):

227  
d©a


229 
def
 
	$»que¡_body
(
£lf
):

230 #Thi 
should
 
be
 
a
 
fe
 
	`objeù
 (
‹mp
 file),

231 #which 
CP
 
wl
 
ju¡
 
pe
 
back
 
out
 
we
 
‹Î
 
™
 
to
.

232  
ch”rypy
.
»que¡
.
body


234 
def
 
	$»achabË
(
£lf
):

237 
şass
 
DivÜû
:

239 
FÜ
 
exam¶e
, 
a
 
GET
-
hªdËr
 
shouldn
'ˆcŞlidw™h‡ m‘hod‚amed '
g‘
'.

241 
If
 
you
 
bud
 
HTTP
 
m‘hod
 
di¥©chšg
 
što
 
Ch”ryPy
, 
»wr™e
 
this
 
şass


242 
to
 
u£
 
your
 
Ãw
 
di¥©ch
 
mechªism
 
ªd
 
make
 
su»
 
th©
:

243 "GET /divÜû HTTP/1.1" 
m­s
 
to
 
divÜû
.
	$šdex
(è
ªd


244 "GET /divÜû/g‘?ID=13 HTTP/1.1" 
m­s
 
to
 
divÜû
.
	`g‘
()

247 
docum’ts
 = {
	}
}

249 
def
 
	$šdex
(
£lf
):

250 
y›ld
 "<h1>Choose your document</h1>\n"

251 
y›ld
 "<ul>\n"

252 
id
, 
cÚ‹Ás
 
š
 
£lf
.
docum’ts
.
	$™ems
():

253 
	`y›ld
 (" <li><a href='/divorce/get?ID=%s'>%s</a>: %s</li>\n"

254 % (
id
, id, 
cÚ‹Ás
))

255 
y›ld
 "</ul>"

256 
šdex
.
expo£d
 = 
True


258 
def
 
	$g‘
(
£lf
, 
ID
):

260 (
ID
, 
£lf
.
docum’ts
.
	`g‘
(ID, "empty")))

261 
g‘
.
expo£d
 = 
True


263 
roÙ
.
divÜû
 = 
	$DivÜû
()

266 
şass
 
	$Th»adLoÿl
(
Te¡
):

268 
def
 
	$šdex
(
£lf
):

269 
exi¡šg
 = 
	`»´
(
	`g‘©Œ
(
ch”rypy
.
»que¡
, "asdf", 
NÚe
))

270 
ch”rypy
.
»que¡
.
asdf
 = "rassfrassin"

271  
exi¡šg


273 
­pcÚf
 = {

275 
	}
}

276 
ch”rypy
.
Œ“
.
	$mouÁ
(
roÙ
, 
cÚfig
=
­pcÚf
)

277 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

279 
def
 
	$‹¡_scheme
(
£lf
):

280 
£lf
.
	`g‘Page
("/scheme")

281 
£lf
.
	$as£¹Body
(
£lf
.
scheme
)

283 
def
 
	$‹¡R–©iveURIP©hInfo
(
£lf
):

284 
£lf
.
	`g‘Page
("/pathinfo/foo/bar")

285 
£lf
.
	`as£¹Body
("/pathinfo/foo/bar")

287 
def
 
	$‹¡AbsŞu‹URIP©hInfo
(
£lf
):

289 
£lf
.
	`g‘Page
("http://localhost/pathinfo/foo/bar")

290 
£lf
.
	`as£¹Body
("/pathinfo/foo/bar")

292 
def
 
	$‹¡P¬ams
(
£lf
):

293 
£lf
.
	`g‘Page
("/params/?thing=a")

294 
£lf
.
	`as£¹Body
(
	`»´
(
	`Áou
("a")))

296 
£lf
.
	`g‘Page
("/params/?thing=a&thing=b&thing=c")

297 
£lf
.
	`as£¹Body
(
	`»´
([
	`Áou
('a'),‚tou('b'),‚tou('c')]))

299 #Te¡ 
ä›ndly
 
”rÜ
 
mes§ge
 
wh’
 
giv’
 
·¿ms
 
¬e
 
nÙ
 
acû±ed
.

300 
ch”rypy
.
cÚfig
.
	`upd©e
({"»que¡.show_mism©ched_·¿ms": 
True
})

301 
£lf
.
g‘Page
("/params/?notathing=meeting")

302 
£lf
.
as£¹InBody
("Missing…arameters:hing")

303 
£lf
.
g‘Page
("/params/?thing=meeting&notathing=meeting")

304 
£lf
.
as£¹InBody
("Unexpected query string…arameters:‚otathing")

306 #Te¡ 
ab™y
 
to
 
tuº
 
off
 
ä›ndly
 
”rÜ
 
mes§ges


307 
ch”rypy
.
cÚfig
.
upd©e
({"»que¡.show_mism©ched_·¿ms": 
F®£
})

308 
£lf
.
g‘Page
("/params/?notathing=meeting")

309 
£lf
.
as£¹InBody
("Not Found")

310 
£lf
.
g‘Page
("/params/?thing=meeting&notathing=meeting")

311 
£lf
.
as£¹InBody
("Not Found")

313 #Te¡ "% HEX HEX"-
’coded
 
URL
, 
·¿m
 
keys
, 
ªd
 
v®ues


314 
	g£lf
.
g‘Page
("/params/%d4%20%e3/cheese?Gruy%E8re=Bulgn%e9ville")

315 
	g£lf
.
as£¹Body
("args: %s kwargs: %s" %

317 {'Gruy\xe8»': 
Áou
('Bulgn\xe9ville')}))

319 #Mak
su»
 
th©
 
’coded
 = 
ªd
 & 
g‘
 
·r£d
 
cÜ»ùly


320 
£lf
.
g‘Page
("/params/code?url=http%3A//cherrypy.org/index%3Fa%3D1%26b%3D2")

321 
£lf
.
as£¹Body
("args: %s kwargs: %s" %

323 {'u¾': 
Áou
('http://cherrypy.org/index?a=1&b=2')}))

325 #Te¡ 
coÜdš©es
 
£Á
 
by
 <
img
 
ism­
>

326 
£lf
.
g‘Page
("/params/ismap?223,114")

327 
£lf
.
as£¹Body
("Coordinates: 223, 114")

329 #Te¡ "Çme[key]" 
diù
-
like
 
·¿ms


330 
£lf
.
g‘Page
("/params/dictlike?a[1]=1&a[2]=2&b=foo&b[bar]=baz")

331 
£lf
.
as£¹Body
("args: %s kwargs: %s" %

333 {'a[1]': 
Áou
('1'), 'b[bar]':‚tou('baz'),

334 'b': 
Áou
('foo'), 'a[2]':‚tou('2')}))

336 
def
 
	$‹¡P¬amE¼Üs
(
£lf
):

338 #‹¡ 
th©
 
®l
 
of
 
the
 
hªdËrs
 
wÜk
 
wh’
 
giv’


339 #th
cÜ»ù
 
·¿m‘”s
 
š
 
Üd”
 
to
 
’su»
 
th©
 
the


340 #”rÜ 
b–ow
 
¬’
't coming from some other source.

341 
uri
 
	`š
 (

360 
£lf
.
	$g‘Page
(
uri
)

361 
£lf
.
	$as£¹Stus
(200)

363 #qu”y 
¡ršg
 
·¿m‘”s
 
¬e
 
·¹
 
of
 
the
 
URI
, 
so
 
they
‡» 
wrÚg


364 #fÜ 
a
 
·¹icuÏr
 
hªdËr
, 
the
 
¡©us
 
MUST
 
be
‡ 404.

365 
”rÜ_msgs
 = [

372 
uri
, 
msg
 
	`š
 (

373 ('/·¿m”rÜs/Úe_pos™iÚ®', 
”rÜ_msgs
[0]),

374 ('/·¿m”rÜs/Úe_pos™iÚ®?foo=foo', 
”rÜ_msgs
[0]),

375 ('/·¿m”rÜs/Úe_pos™iÚ®/foo/b¬/baz', 
”rÜ_msgs
[1]),

376 ('/·¿m”rÜs/Úe_pos™iÚ®/foo?·¿m1=foo', 
”rÜ_msgs
[2]),

377 ('/·¿m”rÜs/Úe_pos™iÚ®/foo?·¿m1=foo&·¿m2=foo', 
”rÜ_msgs
[2]),

378 ('/·¿m”rÜs/Úe_pos™iÚ®_¬gs/foo?·¿m1=foo&·¿m2=foo', 
”rÜ_msgs
[2]),

379 ('/·¿m”rÜs/Úe_pos™iÚ®_¬gs/foo/b¬/baz?·¿m2=foo', 
”rÜ_msgs
[3]),

380 ('/·¿m”rÜs/Úe_pos™iÚ®_¬gs_kw¬gs/foo/b¬/baz?·¿m1=b¬&·¿m3=baz', 
”rÜ_msgs
[2]),

381 ('/·¿m”rÜs/Úe_pos™iÚ®_kw¬gs/foo?·¿m1=foo&·¿m2=b¬&·¿m3=baz', 
”rÜ_msgs
[2]),

382 ('/·¿m”rÜs/no_pos™iÚ®/boo', 
”rÜ_msgs
[1]),

383 ('/·¿m”rÜs/no_pos™iÚ®?·¿m1=foo', 
”rÜ_msgs
[3]),

384 ('/·¿m”rÜs/no_pos™iÚ®_¬gs/boo?·¿m1=foo', 
”rÜ_msgs
[3]),

385 ('/·¿m”rÜs/no_pos™iÚ®_kw¬gs/boo?·¿m1=foo', 
”rÜ_msgs
[1]),

386 ('/·¿m”rÜs/ÿÎabË_objeù?·¿m1=foo', 
”rÜ_msgs
[3]),

387 ('/·¿m”rÜs/ÿÎabË_objeù/boo', 
”rÜ_msgs
[1]),

389 
show_mism©ched_·¿ms
 
	$š
 (
True
, 
F®£
):

390 
ch”rypy
.
cÚfig
.
	`upd©e
({'»que¡.show_mism©ched_·¿ms': 
show_mism©ched_·¿ms
})

391 
£lf
.
	$g‘Page
(
uri
)

392 
£lf
.
	$as£¹Stus
(404)

393 
show_mism©ched_·¿ms
:

394 
£lf
.
	$as£¹InBody
(
msg
)

396 
£lf
.
	`as£¹InBody
("Not Found")

398 #ià
body
 
·¿m‘”s
 
¬e
 
wrÚg
, 
a
 400 
mu¡
 
be
 
»tuºed
.

399 
uri
, 
body
, 
msg
 
	`š
 (

400 ('/·¿m”rÜs/Úe_pos™iÚ®/foo', '·¿m1=foo', 
”rÜ_msgs
[2]),

401 ('/·¿m”rÜs/Úe_pos™iÚ®/foo', '·¿m1=foo&·¿m2=foo', 
”rÜ_msgs
[2]),

402 ('/·¿m”rÜs/Úe_pos™iÚ®_¬gs/foo', '·¿m1=foo&·¿m2=foo', 
”rÜ_msgs
[2]),

403 ('/·¿m”rÜs/Úe_pos™iÚ®_¬gs/foo/b¬/baz', '·¿m2=foo', 
”rÜ_msgs
[4]),

404 ('/·¿m”rÜs/Úe_pos™iÚ®_¬gs_kw¬gs/foo/b¬/baz', '·¿m1=b¬&·¿m3=baz', 
”rÜ_msgs
[2]),

405 ('/·¿m”rÜs/Úe_pos™iÚ®_kw¬gs/foo', '·¿m1=foo&·¿m2=b¬&·¿m3=baz', 
”rÜ_msgs
[2]),

406 ('/·¿m”rÜs/no_pos™iÚ®', '·¿m1=foo', 
”rÜ_msgs
[4]),

407 ('/·¿m”rÜs/no_pos™iÚ®_¬gs/boo', '·¿m1=foo', 
”rÜ_msgs
[4]),

408 ('/·¿m”rÜs/ÿÎabË_objeù', '·¿m1=foo', 
”rÜ_msgs
[4]),

410 
show_mism©ched_·¿ms
 
	$š
 (
True
, 
F®£
):

411 
ch”rypy
.
cÚfig
.
	`upd©e
({'»que¡.show_mism©ched_·¿ms': 
show_mism©ched_·¿ms
})

412 
£lf
.
g‘Page
(
uri
, 
m‘hod
='POST', 
body
=body)

413 
£lf
.
	$as£¹Stus
(400)

414 
show_mism©ched_·¿ms
:

415 
£lf
.
	$as£¹InBody
(
msg
)

417 
£lf
.
	`as£¹InBody
("400 Bad")

420 #ev’ 
body
 
·¿m‘”s
 
¬e
 
wrÚg
, 
we
 
g‘
 
the
 
uri
 wrÚg, 
th’


422 
uri
, 
body
, 
msg
 
	`š
 (

423 ('/·¿m”rÜs/Úe_pos™iÚ®?·¿m2=foo', '·¿m1=foo', 
”rÜ_msgs
[3]),

424 ('/·¿m”rÜs/Úe_pos™iÚ®/foo/b¬', '·¿m2=foo', 
”rÜ_msgs
[1]),

425 ('/·¿m”rÜs/Úe_pos™iÚ®_¬gs/foo/b¬?·¿m2=foo', '·¿m3=foo', 
”rÜ_msgs
[3]),

426 ('/·¿m”rÜs/Úe_pos™iÚ®_kw¬gs/foo/b¬', '·¿m2=b¬&·¿m3=baz', 
”rÜ_msgs
[1]),

427 ('/·¿m”rÜs/no_pos™iÚ®?·¿m1=foo', '·¿m2=foo', 
”rÜ_msgs
[3]),

428 ('/·¿m”rÜs/no_pos™iÚ®_¬gs/boo?·¿m2=foo', '·¿m1=foo', 
”rÜ_msgs
[3]),

429 ('/·¿m”rÜs/ÿÎabË_objeù?·¿m2=b¬', '·¿m1=foo', 
”rÜ_msgs
[3]),

431 
show_mism©ched_·¿ms
 
	$š
 (
True
, 
F®£
):

432 
ch”rypy
.
cÚfig
.
	`upd©e
({'»que¡.show_mism©ched_·¿ms': 
show_mism©ched_·¿ms
})

433 
£lf
.
g‘Page
(
uri
, 
m‘hod
='POST', 
body
=body)

434 
£lf
.
	$as£¹Stus
(404)

435 
show_mism©ched_·¿ms
:

436 
£lf
.
	$as£¹InBody
(
msg
)

438 
£lf
.
	`as£¹InBody
("Not Found")

440 #IÀ
the
 
th©
 
a
 
hªdËr
 
¿i£s
‡ 
Ty³E¼Ü
 
we
 
should


441 #Ëˆ
th©
 
ty³
 
”rÜ
 
through
.

442 
uri
 
	`š
 (

447 
£lf
.
	`g‘Page
(
uri
, 
m‘hod
='GET')

448 
£lf
.
	$as£¹Stus
(500)

449 
£lf
.
	`as£¹True
('Cl›Á E¼Ü', s–f.
body
)

451 
def
 
	$‹¡E¼ÜHªdlšg
(
£lf
):

452 
£lf
.
	`g‘Page
("/error/missing")

453 
£lf
.
	$as£¹Stus
(404)

454 
£lf
.
	`as£¹E¼ÜPage
(404, "The…ath '/error/missing' was‚ot found.")

456 
ignÜe
 = 
h–³r
.
web‹¡
.
ignÜed_exû±iÚs


457 
ignÜe
.
	$­³nd
(
V®ueE¼Ü
)

458 
Œy
:

459 
v®”r
 = '\n„aise ValueError()\nValueError'

460 
£lf
.
	`g‘Page
("/error/page_method")

461 
£lf
.
	$as£¹E¼ÜPage
(500, 
·‰”n
=
v®”r
)

463 
£lf
.
	`g‘Page
("/error/page_yield")

464 
£lf
.
	$as£¹E¼ÜPage
(500, 
·‰”n
=
v®”r
)

466 ià(
ch”rypy
.
£rv”
.
´ÙocŞ_v”siÚ
 =ğ"HTTP/1.0" 
Ü


467 
	`g‘©Œ
(
ch”rypy
.
£rv”
, "usšg_­ache", 
F®£
)):

468 
£lf
.
	`g‘Page
("/error/page_streamed")

469 #Beÿu£ 
this
 
”rÜ
 
is
 
¿i£d
 
aá”
 
the
 
»¥Ú£
 
body
 
has


470 #¡¬‹d, 
the
 
¡©us
 
should
 
nÙ
 
chªge
 
to
 
ª
 
”rÜ
 status.

471 
£lf
.
	$as£¹Stus
(200)

472 
£lf
.
	`as£¹Body
("word up")

474 #Und” 
HTTP
/1.1, 
the
 
chunked
 
Œªsãr
-
codšg
 
is
 
u£d
.

475 #Th
HTTP
 
ş›Á
 
wl
 
choke
 
wh’
 
the
 
ouut
 
is
 
šcom¶‘e
.

476 
£lf
.
	`as£¹Rai£s
((
V®ueE¼Ü
, 
Incom¶‘eR—d
), s–f.
g‘Page
,

479 #NØ
Œaûback
 
should
 
be
 
´e£Á


480 
£lf
.
	`g‘Page
("/error/cause_err_in_finalize")

481 
msg
 = "Illegal„esponse status from server ('ZOO' is‚on-numeric)."

482 
£lf
.
	$as£¹E¼ÜPage
(500, 
msg
, 
NÚe
)

483 
fš®ly
:

484 
ignÜe
.
	$pİ
()

486 #Te¡ 
HTTPE¼Ü
 
w™h
 
a
 
»asÚ
-
ph¿£
 
š
 
the
 
¡©us
 
¬g
.

487 
£lf
.
	`g‘Page
('/error/reason_phrase')

488 
£lf
.
	`as£¹Stus
("410 Gone fishin'")

490 #Te¡ 
cu¡om
 
”rÜ
 
·ge
 
a
 
¥ecific
ƒrror.

491 
£lf
.
	`g‘Page
("/error/custom")

492 
£lf
.
	$as£¹Stus
(404)

493 
£lf
.
	`as£¹Body
("Hello, world\r\n" + (" " * 499))

495 #Te¡ 
cu¡om
 
”rÜ
 
·ge
 
a
 
¥ecific
ƒrror.

496 
£lf
.
	`g‘Page
("/error/custom?err=401")

497 
£lf
.
	$as£¹Stus
(401)

498 
£lf
.
	`as£¹Body
("Error 401 Unauthorized - Well, I'm very sorry but you haven't…aid!")

500 #Te¡  
cu¡om
 
”rÜ
 
·ge
.

501 
£lf
.
	`g‘Page
("/error/custom_default")

502 
£lf
.
	$as£¹Stus
(500)

503 
£lf
.
	`as£¹Body
("E¼Ü 500 IÁ”ÇÈS”v” E¼Ü - W–l, I'm v”y sÜry buˆyou hav’'ˆ·id!".
	$lju¡
(513))

505 #Te¡ 
”rÜ
 
š
 
cu¡om
ƒ¼Ü 
	`·ge
 (
tick‘
 #305).

506 #NÙ
th©
 
the
 
mes§ge
 
is
 
esÿ³d
 
	`HTML
 (
tick‘
 #310).

507 
£lf
.
	`g‘Page
("/error/noexist")

508 
£lf
.
	$as£¹Stus
(404)

509 
msg
 = ("No, &lt;b&gt;really&lt;/b&gt;,‚ot found!<br />"

512 
£lf
.
	$as£¹InBody
(
msg
)

514 
	`g‘©Œ
(
ch”rypy
.
£rv”
, "usšg_­ache", 
F®£
):

515 
·ss


517 #Te¡ 
	`throw_”rÜs
 (
tick‘
 #186).

518 
£lf
.
	`g‘Page
("/error/rethrow")

519 
£lf
.
	`as£¹InBody
("raise ValueError()")

521 
def
 
	$‹¡Ex³ù
(
£lf
):

522 
e
 = ('Expect', '100-continue')

523 
£lf
.
	`g‘Page
("/h—d”–em’ts/g‘_–em’ts?h—d”Çme=Ex³ù", [
e
])

524 
£lf
.
	`as£¹Body
('100-continue')

526 
£lf
.
	`g‘Page
("/ex³ù/ex³ù©iÚ_çed", [
e
])

527 
£lf
.
	$as£¹Stus
(417)

529 
def
 
	$‹¡H—d”EËm’ts
(
£lf
):

530 #Acû±-* 
h—d”
 
–em’ts
 
should
 
be
 
sÜ‹d
, 
w™h
 
mo¡
 
´eã¼ed
 
fœ¡
.

531 
h
 = [('Accept', 'audio/*; q=0.2,‡udio/basic')]

532 
£lf
.
	`g‘Page
("/h—d”–em’ts/g‘_–em’ts?h—d”Çme=Acû±", 
h
)

533 
£lf
.
	$as£¹Stus
(200)

534 
£lf
.
	`as£¹Body
("audio/basic\n"

537 
h
 = [('Accept', 'text/plain; q=0.5,ext/html,ext/x-dvi; q=0.8,ext/x-c')]

538 
£lf
.
	`g‘Page
("/h—d”–em’ts/g‘_–em’ts?h—d”Çme=Acû±", 
h
)

539 
£lf
.
	$as£¹Stus
(200)

540 
£lf
.
	`as£¹Body
("text/x-c\n"

545 #Te¡ 
th©
 
mÜe
 
¥ecific
 
medŸ
 
¿nges
 
g‘
 
´iÜ™y
.

546 
h
 = [('Accept', 'text/*,ext/html,ext/html;level=1, */*')]

547 
£lf
.
	`g‘Page
("/h—d”–em’ts/g‘_–em’ts?h—d”Çme=Acû±", 
h
)

548 
£lf
.
	$as£¹Stus
(200)

549 
£lf
.
	`as£¹Body
("text/html;level=1\n"

554 #Te¡ 
Acû±
-
Ch¬£t


555 
h
 = [('Accept-Charset', 'iso-8859-5, unicode-1-1;q=0.8')]

556 
£lf
.
	`g‘Page
("/h—d”–em’ts/g‘_–em’ts?h—d”Çme=Acû±-Ch¬£t", 
h
)

557 
£lf
.
	`as£¹Stus
("200 OK")

558 
£lf
.
	`as£¹Body
("iso-8859-5\n"

561 #Te¡ 
Acû±
-
Encodšg


562 
h
 = [('Accept-Encoding', 'gzip;q=1.0, identity; q=0.5, *;q=0')]

563 
£lf
.
	`g‘Page
("/h—d”–em’ts/g‘_–em’ts?h—d”Çme=Acû±-Encodšg", 
h
)

564 
£lf
.
	`as£¹Stus
("200 OK")

565 
£lf
.
	`as£¹Body
("gzip;q=1.0\n"

569 #Te¡ 
Acû±
-
Lªguage


570 
h
 = [('Accept-Language', 'da,ƒn-gb;q=0.8,ƒn;q=0.7')]

571 
£lf
.
	`g‘Page
("/h—d”–em’ts/g‘_–em’ts?h—d”Çme=Acû±-Lªguage", 
h
)

572 
£lf
.
	`as£¹Stus
("200 OK")

573 
£lf
.
	`as£¹Body
("da\n"

577 #Te¡ 
m®fÜmed
 
h—d”
 
·rsšg
. 
S“
 
h‰p
:

578 
£lf
.
	`g‘Page
("/headerelements/get_elements?headername=Content-Type",

579 #NÙ
the
 
Ëg®
 
Œašg
 ";"

580 
h—d”s
=[('Content-Type', 'text/html; charset=utf-8;')])

581 
£lf
.
	$as£¹Stus
(200)

582 
£lf
.
	`as£¹Body
("text/html;charset=utf-8")

584 
def
 
	$‹¡_»³©ed_h—d”s
(
£lf
):

585 #Te¡ 
th©
 
two
 
»que¡
 
h—d”s
 
¬e
 
cŞÏp£d
 
što
 
Úe
.

586 #S“ 
h‰p
:

587 
£lf
.
	`g‘Page
("/headers/Accept-Charset",

588 
h—d”s
=[("Accept-Charset", "iso-8859-5"),

590 
£lf
.
	`as£¹Body
("iso-8859-5, unicode-1-1;q=0.8")

592 #Te¡ 
th©
 
—ch
 
h—d”
 
Úly
 
­³¬s
 
Úû
, 
»g¬dËss
 
of
 .

593 
£lf
.
	`g‘Page
("/headers/doubledheaders")

594 
£lf
.
	`as£¹Body
("double headerest")

595 
hÇmes
 = [
Çme
.
	$t™Ë
(è
Çme
, 
v®
 
š
 
£lf
.
h—d”s
]

596 
key
 
š
 ['Content-Length', 'Content-Type', 'Date',

598 
£lf
.
	`as£¹Equ®
(
hÇmes
.
	`couÁ
(
key
), 1, s–f.
h—d”s
)

600 
def
 
	$‹¡_’coded_h—d”s
(
£lf
):

601 #Fœ¡, 
make
 
su»
 
the
 
šÇrds
 
wÜk
 
like
 
ex³ùed
.

602 
£lf
.
	`as£¹Equ®
(
h‰put
.
	`decode_TEXT
(
	`Áou
("=?utf-8?q?f=C3=BCr?=")),‚tou("f\xfcr"))

604 
ch”rypy
.
£rv”
.
´ÙocŞ_v”siÚ
 == "HTTP/1.1":

605 #Te¡ 
RFC
-2047-
’coded
 
»que¡
 
ªd
 
»¥Ú£
 
h—d”
 
v®ues


606 
u
 = 
	`Áou
('\u212bngstr\xf6m', 'escape')

607 
c
 = 
	`Áou
("=E2=84=ABngstr=C3=B6m")

608 
£lf
.
	`g‘Page
("/h—d”s/ifm©ch", [('If-M©ch', 
	`Áou
('=?utf-8?q?%s?='è% 
c
)])

609 #Th
body
 
should
 
be
 
utf
-8 
’coded
.

610 
£lf
.
	`as£¹Body
(
	`Áob
("\xe2\x84\xabngstr\xc3\xb6m"))

611 #Buˆ
the
 
Eg
 
h—d”
 
should
 
be
 
RFC
-2047 
	`’coded
 (
bš¬y
)

612 
£lf
.
	`as£¹H—d”
("ETag", 
	`Áou
('=?utf-8?b?4oSrbmdzdHLDtm0=?='))

614 #Te¡ 
a
 *
LONG
* 
RFC
-2047-
’coded
 
»que¡
 
ªd
 
»¥Ú£
 
h—d”
 
v®ue


615 
£lf
.
	`g‘Page
("/headers/ifmatch",

616 [('If-M©ch', 
	`Áou
('=?utf-8?q?%s?='è% (
c
 * 10))])

617 
£lf
.
	`as£¹Body
(
	`Áob
("\xe2\x84\xabngstr\xc3\xb6m") * 10)

618 #NÙe: 
this
 
is
 
difã»Á
 
ouut
 
PythÚ3
, 
but
 
™
 
decodes
 
fše
.

619 
‘ag
 = 
£lf
.
	`as£¹H—d”
("ETag",

624 
£lf
.
	`as£¹Equ®
(
h‰put
.
	`decode_TEXT
(
‘ag
), 
u
 * 10)

626 
def
 
	$‹¡_h—d”_´e£nû
(
£lf
):

627 #Ià
we
 
dÚ
't…ass‡ Content-Type header, it should‚ot be…resent

628 #š 
ch”rypy
.
»que¡
.
h—d”s


629 
£lf
.
	`g‘Page
("/headers/Content-Type",

630 
h—d”s
=[])

631 
£lf
.
	$as£¹Stus
(500)

633 #Ià
CÚ‹Á
-
Ty³
 
is
 
´e£Á
 
š
 
the
 
»que¡
, 
™
 
should
 
be
…resent in

634 #ch”rypy.
»que¡
.
h—d”s


635 
£lf
.
	`g‘Page
("/headers/Content-Type",

636 
h—d”s
=[("Content-type", "application/json")])

637 
£lf
.
	`as£¹Body
("application/json")

639 
def
 
	$‹¡_basic_HTTPM‘hods
(
£lf
):

640 
h–³r
.
web‹¡
.
m‘hods_w™h_bod›s
 = ("POST", "PUT", "PROPFIND")

642 #Te¡ 
th©
 
®l
 
defšed
 
HTTP
 
m‘hods
 
wÜk
.

643 
m
 
š
 
defšed_h‰p_m‘hods
:

644 
£lf
.
	`g‘Page
("/m‘hod/", 
m‘hod
=
m
)

646 #HEAD 
»que¡s
 
should
 
nÙ
  
ªy
 
body
.

647 
m
 == "HEAD":

648 
£lf
.
	`as£¹Body
("")

649 
–if
 
m
 == "TRACE":

650 #Som
HTTP
 
	`£rv”s
 (
like
 
modpy
è
have
 
theœ
 
own
 
TRACE
 
suµÜt


651 
£lf
.
	`as£¹Equ®
(£lf.
body
[:5], 
	`Áob
("TRACE"))

653 
£lf
.
	$as£¹Body
(
m
)

655 #Reque¡ 
a
 
PUT
 
m‘hod
 
w™h
‡ 
fÜm
-
u¾’coded
 
body


656 
£lf
.
	`g‘Page
("/m‘hod/·¿m‘”ized", 
m‘hod
="PUT",

657 
body
="data=on+top+of+other+things")

658 
£lf
.
	`as£¹Body
("onop of otherhings")

660 #Reque¡ 
a
 
PUT
 
m‘hod
 
w™h
‡ 
fe
 
body


661 
b
 = "onehing onop of‡nother"

662 
h
 = [("Content-Type", "text/plain"),

663 ("CÚ‹Á-L’gth", 
	`¡r
(
	`Ën
(
b
)))]

664 
£lf
.
	`g‘Page
("/m‘hod/»que¡_body", 
h—d”s
=
h
, 
m‘hod
="PUT", 
body
=
b
)

665 
£lf
.
	$as£¹Stus
(200)

666 
£lf
.
	$as£¹Body
(
b
)

668 #Reque¡ 
a
 
PUT
 
m‘hod
 
w™h
‡ 
fe
 
body
 
but
 
no
 
CÚ‹Á
-
Ty³
.

669 #S“ 
h‰p
:

670 
b
 = 
	`Áob
("onehing onop of‡nother")

671 
£lf
.
³rsi¡’t
 = 
True


672 
Œy
:

673 
cÚn
 = 
£lf
.
HTTP_CONN


674 
cÚn
.
	`puŒeque¡
("PUT", "/m‘hod/»que¡_body", 
sk_ho¡
=
True
)

675 
cÚn
.
	`puth—d”
("Ho¡", 
£lf
.
HOST
)

676 
cÚn
.
	`puth—d”
('CÚ‹Á-L’gth', 
	`¡r
(
	$Ën
(
b
)))

677 
cÚn
.
	$’dh—d”s
()

678 
cÚn
.
	$£nd
(
b
)

679 
»¥Ú£
 = 
cÚn
.
	`»¥Ú£_şass
(cÚn.
sock
, 
m‘hod
="PUT")

680 
»¥Ú£
.
	$begš
()

681 
£lf
.
	$as£¹Equ®
(
»¥Ú£
.
¡©us
, 200)

682 
£lf
.
body
 = 
»¥Ú£
.
	$»ad
()

683 
£lf
.
	$as£¹Body
(
b
)

684 
fš®ly
:

685 
£lf
.
³rsi¡’t
 = 
F®£


687 #Reque¡ 
a
 
PUT
 
m‘hod
 
w™h
 
no
 
body
 
	`wh©sÛv”
 (
nÙ
 
ª
 
em±y
 
Úe
).

688 #S“ 
h‰p
:

689 #Provid
a
 
C
-
T
 
Ü
 
web‹¡
 
wl
 
´ovide
 
	`Úe
 (
ªd
‡ C-
L
è
us
.

690 
h
 = [("Content-Type", "text/plain")]

691 
£lf
.
	`g‘Page
("/m‘hod/»achabË", 
h—d”s
=
h
, 
m‘hod
="PUT")

692 
£lf
.
	$as£¹Stus
(411)

694 #Reque¡ 
a
 
cu¡om
 
m‘hod
 
w™h
‡ 
»que¡
 
body


695 
b
 = ('<?xml version="1.0"ƒncoding="utf-8" ?>\n\n'

698 
h
 = [('Content-Type', 'text/xml'),

699 ('CÚ‹Á-L’gth', 
	`¡r
(
	`Ën
(
b
)))]

700 
£lf
.
	`g‘Page
("/m‘hod/»que¡_body", 
h—d”s
=
h
, 
m‘hod
="PROPFIND", 
body
=
b
)

701 
£lf
.
	$as£¹Stus
(200)

702 
£lf
.
	$as£¹Body
(
b
)

704 #Reque¡ 
a
 
di§Îowed
 
m‘hod


705 
£lf
.
	`g‘Page
("/m‘hod/", 
m‘hod
="LINK")

706 
£lf
.
	$as£¹Stus
(405)

708 #Reque¡ 
ª
 
unknown
 
m‘hod


709 
£lf
.
	`g‘Page
("/m‘hod/", 
m‘hod
="SEARCH")

710 
£lf
.
	$as£¹Stus
(501)

712 #FÜ 
m‘hod
 
di¥©ch”s
: 
make
 
su»
 
th©
 
ª
 
HTTP
 m‘hod 
dÛ¢
't

713 #cŞlid
w™h
 
a
 
vœtu®
 
·th
 
©om
. 
If
 
you
 
bud
 
HTTP
-
m‘hod


714 #di¥©chšg 
što
 
the
 
cÜe
, 
»wr™e
 
the£
 
hªdËrs
 
to
 
u£


715 #you¸
di¥©ch
 
idioms
.

716 
£lf
.
	`g‘Page
("/divorce/get?ID=13")

717 
£lf
.
	`as£¹Body
('Divorce document 13:ƒmpty')

718 
£lf
.
	$as£¹Stus
(200)

719 
£lf
.
	`g‘Page
("/divÜû/", 
m‘hod
="GET")

720 
£lf
.
	`as£¹Body
('<h1>Choose your document</h1>\n<ul>\n</ul>')

721 
£lf
.
	$as£¹Stus
(200)

723 
def
 
	$‹¡_CONNECT_m‘hod
(
£lf
):

724 
	`g‘©Œ
(
ch”rypy
.
£rv”
, "usšg_­ache", 
F®£
):

725  
£lf
.
	`sk
("skipped dueo known Apache differences... ")

727 
£lf
.
	`g‘Page
("/m‘hod/", 
m‘hod
="CONNECT")

728 
£lf
.
	`as£¹Body
("CONNECT")

730 
def
 
	$‹¡Em±yTh»adloÿls
(
£lf
):

731 
»suÉs
 = []

732 
x
 
š
 
	$¿nge
(20):

733 
£lf
.
	`g‘Page
("/threadlocal/")

734 
»suÉs
.
	$­³nd
(
£lf
.
body
)

735 
£lf
.
	`as£¹Equ®
(
»suÉs
, [
	`Áob
("None")] * 20)

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/test_routes.py

1 
impÜt
 
os


2 
	gcurdœ
 = 
os
.
·th
.
još
(os.
g‘cwd
(), os.·th.
	$dœÇme
(
__fe__
))

4 
impÜt
 
ch”rypy


6 
äom
 
ch”rypy
.
‹¡
 
impÜt
 
h–³r


7 
impÜt
 
no£


9 
şass
 
	$Rou‹sDi¥©chTe¡
(
h–³r
.
CPWebCa£
):

11 
def
 
	$£tup_£rv”
():

13 
Œy
:

14 
impÜt
 
rou‹s


15 
exû±
 
ImpÜtE¼Ü
:

16 
¿i£
 
no£
.
	`SkTe¡
('Install„outesoest RoutesDispatcher code')

18 
şass
 
Dummy
:

19 
def
 
	$šdex
(
£lf
):

22 
şass
 
C™y
:

24 
def
 
	$__š™__
(
£lf
, 
Çme
):

25 
£lf
.
Çme
 =‚ame

26 
£lf
.
pİuÏtiÚ
 = 10000

28 
def
 
	$šdex
(
£lf
, **
kw¬gs
):

29  "W–comtØ%s,…İ. %s" % (
£lf
.
Çme
, s–f.
pİuÏtiÚ
)

30 
šdex
.
_ı_cÚfig
 = {'toŞs.»¥Ú£_h—d”s.Ú': 
True
,

31 'toŞs.»¥Ú£_h—d”s.h—d”s': [('CÚ‹Á-Lªguage', '’-GB')]
	}
}

33 
def
 
	$upd©e
(
£lf
, **
kw¬gs
):

34 
£lf
.
pİuÏtiÚ
 = 
kw¬gs
['pop']

37 
d
 = 
ch”rypy
.
di¥©ch
.
	$Rou‹sDi¥©ch”
()

38 
d
.
	`cÚÃù
(
aùiÚ
='šdex', 
Çme
='houn¦ow', 
rou‹
='/hounslow',

39 
cÚŒŞËr
=
	`C™y
('Hounslow'))

40 
d
.
	`cÚÃù
(
Çme
='surb™Ú', 
rou‹
='/surb™Ú', 
cÚŒŞËr
=
	`C™y
('Surbiton'),

41 
aùiÚ
='šdex', 
cÚd™iÚs
=
	`diù
(
m‘hod
=['GET']))

42 
d
.
m­³r
.
	`cÚÃù
('/surb™Ú', 
cÚŒŞËr
='surbiton',

43 
aùiÚ
='upd©e', 
cÚd™iÚs
=
	`diù
(
m‘hod
=['POST']))

44 
d
.
	`cÚÃù
('maš', ':aùiÚ', 
cÚŒŞËr
=
	$Dummy
())

46 
cÚf
 = {'/': {'»que¡.di¥©ch': 
d
}
	}
}

47 
ch”rypy
.
Œ“
.
	$mouÁ
(
roÙ
=
NÚe
, 
cÚfig
=
cÚf
)

48 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

50 
def
 
	$‹¡_Rou‹s_Di¥©ch
(
£lf
):

51 
£lf
.
	`g‘Page
("/hounslow")

52 
£lf
.
	`as£¹Stus
("200 OK")

53 
£lf
.
	`as£¹Body
("Welcomeo Hounslow,…op. 10000")

55 
£lf
.
	`g‘Page
("/foo")

56 
£lf
.
	`as£¹Stus
("404 Not Found")

58 
£lf
.
	`g‘Page
("/surbiton")

59 
£lf
.
	`as£¹Stus
("200 OK")

60 
£lf
.
	`as£¹Body
("Welcomeo Surbiton,…op. 10000")

62 
£lf
.
	`g‘Page
("/surb™Ú", 
m‘hod
="POST", 
body
="pop=1327")

63 
£lf
.
	`as£¹Stus
("200 OK")

64 
£lf
.
	`as£¹Body
("OK")

65 
£lf
.
	`g‘Page
("/surbiton")

66 
£lf
.
	`as£¹Stus
("200 OK")

67 
£lf
.
	`as£¹H—d”
("Content-Language", "en-GB")

68 
£lf
.
	`as£¹Body
("Welcomeo Surbiton,…op. 1327")

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/test_session.py

1 
impÜt
 
os


2 
	gloÿlDœ
 = 
os
.
·th
.
	$dœÇme
(
__fe__
)

3 
impÜt
 
sys


4 
impÜt
 
th»adšg


5 
impÜt
 
time


7 
impÜt
 
ch”rypy


8 
äom
 
ch”rypy
.
_ıcom·t
 
impÜt
 
cİykeys
, 
HTTPCÚÃùiÚ
, 
HTTPSCÚÃùiÚ


9 
äom
 
ch”rypy
.
lib
 
impÜt
 
£ssiÚs


10 
äom
 
ch”rypy
.
lib
.
h‰put
 
impÜt
 
»¥Ú£_codes


12 
def
 
	`h‰p_m‘hods_®lowed
(
m‘hods
=['GET', 'HEAD']):

13 
m‘hod
 = 
ch”rypy
.
»que¡
.m‘hod.
	$uµ”
()

14 
m‘hod
 
nÙ
 
š
 
m‘hods
:

15 
ch”rypy
.
»¥Ú£
.
h—d”s
['AÎow'] = ", ".
	$još
(
m‘hods
)

16 
¿i£
 
ch”rypy
.
	$HTTPE¼Ü
(405)

18 
ch”rypy
.
toŞs
.
®low
 = ch”rypy.
	`ToŞ
('Ú_¡¬t_»sourû', 
h‰p_m‘hods_®lowed
)

21 
def
 
	$£tup_£rv”
():

23 
şass
 
RoÙ
:

25 
_ı_cÚfig
 = {'toŞs.£ssiÚs.Ú': 
True
,

27 'toŞs.£ssiÚs.¡Üage_·th' : 
loÿlDœ
,

30 
	}
}

32 
def
 
	$ş—r
(
£lf
):

33 
ch”rypy
.
£ssiÚ
.
ÿche
.
	$ş—r
()

34 
ş—r
.
expo£d
 = 
True


36 
def
 
	$d©a
(
£lf
):

37 
ch”rypy
.
£ssiÚ
['aha'] = 'foo'

38  
	$»´
(
ch”rypy
.
£ssiÚ
.
_d©a
)

39 
d©a
.
expo£d
 = 
True


41 
def
 
	$‹¡G’
(
£lf
):

42 
couÁ”
 = 
ch”rypy
.
£ssiÚ
.
	`g‘
('counter', 0) + 1

43 
ch”rypy
.
£ssiÚ
['couÁ”'] = 
couÁ”


44 
y›ld
 
	$¡r
(
couÁ”
)

45 
‹¡G’
.
expo£d
 = 
True


47 
def
 
	$‹¡SŒ
(
£lf
):

48 
couÁ”
 = 
ch”rypy
.
£ssiÚ
.
	`g‘
('counter', 0) + 1

49 
ch”rypy
.
£ssiÚ
['couÁ”'] = 
couÁ”


50  
	$¡r
(
couÁ”
)

51 
‹¡SŒ
.
expo£d
 = 
True


53 
def
 
	$£t£ssiÚty³
(
£lf
, 
Ãwty³
):

54 
£lf
.
__şass__
.
_ı_cÚfig
.
	`upd©e
({'toŞs.£ssiÚs.¡Üage_ty³': 
Ãwty³
})

55 
ha§‰r
(
ch”rypy
, "session"):

56 
d–
 
ch”rypy
.
£ssiÚ


57 
şs
 = 
g‘©Œ
(
£ssiÚs
, 
Ãwty³
.
t™Ë
() + 'Session')

58 
	gşs
.
	gş—n_th»ad
:

59 
şs
.
ş—n_th»ad
.
	$¡İ
()

60 
şs
.
ş—n_th»ad
.
	$unsubsüibe
()

61 
d–
 
şs
.
ş—n_th»ad


62 
£t£ssiÚty³
.
expo£d
 = 
True


63 
£t£ssiÚty³
.
_ı_cÚfig
 = {'toŞs.£ssiÚs.Ú': 
F®£
}

65 
def
 
	$šdex
(
£lf
):

66 
£ss
 = 
ch”rypy
.
£ssiÚ


67 
c
 = 
£ss
.
	`g‘
('counter', 0) + 1

68 
time
.
	$¦“p
(0.01)

69 
£ss
['couÁ”'] = 
c


70  
	$¡r
(
c
)

71 
šdex
.
expo£d
 = 
True


73 
def
 
	$keyš
(
£lf
, 
key
):

74  
	$¡r
(
key
 
š
 
ch”rypy
.
£ssiÚ
)

75 
keyš
.
expo£d
 = 
True


77 
def
 
	$d–‘e
(
£lf
):

78 
ch”rypy
.
£ssiÚ
.
	$d–‘e
()

79 
£ssiÚs
.
	$expœe
()

81 
d–‘e
.
expo£d
 = 
True


83 
def
 
	$d–key
(
£lf
, 
key
):

84 
d–
 
ch”rypy
.
£ssiÚ
[
key
]

86 
d–key
.
expo£d
 = 
True


88 
def
 
	$bÏh
(
£lf
):

89  
£lf
.
_ı_cÚfig
['tools.sessions.storage_type']

90 
bÏh
.
expo£d
 = 
True


92 
def
 
	$œedœ
(
£lf
):

93 
¿i£
 
ch”rypy
.
	`IÁ”ÇlRedœeù
('/blah')

94 
œedœ
.
expo£d
 = 
True


96 
def
 
	$»¡riùed
(
£lf
):

97  
ch”rypy
.
»que¡
.
m‘hod


98 
»¡riùed
.
expo£d
 = 
True


99 
»¡riùed
.
_ı_cÚfig
 = {'toŞs.®low.Ú': 
True
,

100 'toŞs.®low.m‘hods': ['GET']
	}
}

102 
def
 
	$»g’
(
£lf
):

103 
ch”rypy
.
toŞs
.
£ssiÚs
.
	$»g’”©e
()

105 
»g’
.
expo£d
 = 
True


107 
def
 
	$Ëngth
(
£lf
):

108  
	`¡r
(
	$Ën
(
ch”rypy
.
£ssiÚ
))

109 
Ëngth
.
expo£d
 = 
True


111 
def
 
	$£ssiÚ_cook›
(
£lf
):

112 #Mu¡ 
	`lßd
(è
to
 
¡¬t
 
the
 
ş—n
 
th»ad
.

113 
ch”rypy
.
£ssiÚ
.
	$lßd
()

114  
ch”rypy
.
£ssiÚ
.
id


115 
£ssiÚ_cook›
.
expo£d
 = 
True


116 
£ssiÚ_cook›
.
_ı_cÚfig
 = {

119 'toŞs.£ssiÚs.³rsi¡’t': 
F®£
}

121 
ch”rypy
.
Œ“
.
mouÁ
(
	$RoÙ
())

124 
äom
 
ch”rypy
.
‹¡
 
impÜt
 
h–³r


126 
şass
 
	$SessiÚTe¡
(
h–³r
.
CPWebCa£
):

127 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

129 
def
 
	$‹¬Down
(
£lf
):

130 #CËª 
up
 
£ssiÚs
.

131 
âame
 
š
 
os
.
	$li¡dœ
(
loÿlDœ
):

132 
âame
.
	$¡¬tsw™h
(
£ssiÚs
.
FeSessiÚ
.
SESSION_PREFIX
):

133 
os
.
	`uÆšk
(os.
·th
.
	$još
(
loÿlDœ
, 
âame
))

135 
def
 
	$‹¡_0_SessiÚ
(
£lf
):

136 
£lf
.
	`g‘Page
('/setsessiontype/ram')

137 
£lf
.
	`g‘Page
('/clear')

139 #Te¡ 
th©
 
a
 
nÜm®
 
»que¡
 
g‘s
 
the
 
§me
 
id
 
š
h
cook›s
.

140 #NÙe: 
this
 
wouldn
'ˆwÜk ià/d©¨didn'
t
 
lßd
 
the
 
£ssiÚ
.

141 
£lf
.
	`g‘Page
('/data')

142 
£lf
.
	`as£¹Body
("{'aha': 'foo'}")

143 
c
 = 
£lf
.
cook›s
[0]

144 
£lf
.
	`g‘Page
('/d©a', s–f.
cook›s
)

145 
£lf
.
	$as£¹Equ®
(
£lf
.
cook›s
[0], 
c
)

147 
£lf
.
	`g‘Page
('/testStr')

148 
£lf
.
	`as£¹Body
('1')

149 
cook›_·¹s
 = 
	`diù
([
p
.
	`¡r
().
	`¥l™
('=')

150 
p
 
š
 
£lf
.
cook›s
[0][1].
	`¥l™
(";")])

151 #As£¹ 
th”e
 
is
 
ª
 'expœes' 
·¿m


152 
£lf
.
	`as£¹Equ®
(
	`£t
(
cook›_·¹s
.
	`keys
()),

153 
	`£t
(['session_id', 'expires', 'Path']))

154 
£lf
.
	`g‘Page
('/‹¡G’', s–f.
cook›s
)

155 
£lf
.
	`as£¹Body
('2')

156 
£lf
.
	`g‘Page
('/‹¡SŒ', s–f.
cook›s
)

157 
£lf
.
	`as£¹Body
('3')

158 
£lf
.
	`g‘Page
('/d©a', s–f.
cook›s
)

159 
£lf
.
	`as£¹Body
("{'aha': 'foo', 'counter': 3}")

160 
£lf
.
	`g‘Page
('/Ëngth', s–f.
cook›s
)

161 
£lf
.
	`as£¹Body
('2')

162 
£lf
.
	`g‘Page
('/d–key?key=couÁ”', s–f.
cook›s
)

163 
£lf
.
	$as£¹Stus
(200)

165 
£lf
.
	`g‘Page
('/setsessiontype/file')

166 
£lf
.
	`g‘Page
('/testStr')

167 
£lf
.
	`as£¹Body
('1')

168 
£lf
.
	`g‘Page
('/‹¡G’', s–f.
cook›s
)

169 
£lf
.
	`as£¹Body
('2')

170 
£lf
.
	`g‘Page
('/‹¡SŒ', s–f.
cook›s
)

171 
£lf
.
	`as£¹Body
('3')

172 
£lf
.
	`g‘Page
('/d–key?key=couÁ”', s–f.
cook›s
)

173 
£lf
.
	$as£¹Stus
(200)

175 #Wa™ 
the
 
£ssiÚ
.
	`timeout
 (1 
£cÚd
)

176 
time
.
	$¦“p
(2)

177 
£lf
.
	`g‘Page
('/')

178 
£lf
.
	`as£¹Body
('1')

179 
£lf
.
	`g‘Page
('/Ëngth', s–f.
cook›s
)

180 
£lf
.
	`as£¹Body
('1')

182 #Te¡ 
£ssiÚ
 
__cÚšs__


183 
£lf
.
	`g‘Page
('/keyš?key=couÁ”', s–f.
cook›s
)

184 
£lf
.
	`as£¹Body
("True")

185 
cook›£t1
 = 
£lf
.
cook›s


187 #Mak
a
 
Ãw
 
£ssiÚ
 
ªd
 
‹¡
 
__Ën__
 
agaš


188 
£lf
.
	`g‘Page
('/')

189 
£lf
.
	`g‘Page
('/Ëngth', s–f.
cook›s
)

190 
£lf
.
	`as£¹Body
('2')

192 #Te¡ 
£ssiÚ
 
d–‘e


193 
£lf
.
	`g‘Page
('/d–‘e', s–f.
cook›s
)

194 
£lf
.
	`as£¹Body
("done")

195 
£lf
.
	`g‘Page
('/d–‘e', 
cook›£t1
)

196 
£lf
.
	`as£¹Body
("done")

197 
f
 = 
Ïmbda
: [
x
 x 
š
 
os
.
	$li¡dœ
(
loÿlDœ
è
x
.
	`¡¬tsw™h
('session-')]

198 
£lf
.
	`as£¹Equ®
(
	`f
(), [])

200 #Wa™ 
the
 
ş—nup
 
th»ad
 
to
 
d–‘e
 
»maššg
 
£ssiÚ
 
fes


201 
£lf
.
	`g‘Page
('/')

202 
f
 = 
Ïmbda
: [
x
 x 
š
 
os
.
	$li¡dœ
(
loÿlDœ
è
x
.
	`¡¬tsw™h
('session-')]

203 
£lf
.
	`as£¹NÙEqu®
(
	`f
(), [])

204 
time
.
	$¦“p
(2)

205 
£lf
.
	`as£¹Equ®
(
	`f
(), [])

207 
def
 
	$‹¡_1_Ram_CÚcu¼’cy
(
£lf
):

208 
£lf
.
	`g‘Page
('/setsessiontype/ram')

209 
£lf
.
	$_‹¡_CÚcu¼’cy
()

211 
def
 
	$‹¡_2_Fe_CÚcu¼’cy
(
£lf
):

212 
£lf
.
	`g‘Page
('/setsessiontype/file')

213 
£lf
.
	$_‹¡_CÚcu¼’cy
()

215 
def
 
	$_‹¡_CÚcu¼’cy
(
£lf
):

216 
ş›Á_th»ad_couÁ
 = 5

217 
»que¡_couÁ
 = 30

219 #G‘ 
š™Ÿl
 
cook›


220 
£lf
.
	`g‘Page
("/")

221 
£lf
.
	`as£¹Body
("1")

222 
cook›s
 = 
£lf
.cookies

224 
d©a_diù
 = {
	}
}

225 
”rÜs
 = []

227 
def
 
	$»que¡
(
šdex
):

228 
£lf
.
scheme
 == 'https':

229 
c
 = 
	`HTTPSCÚÃùiÚ
('%s:%s' % (
£lf
.
	`š‹rçû
(), s–f.
PORT
))

231 
c
 = 
	`HTTPCÚÃùiÚ
('%s:%s' % (
£lf
.
	`š‹rçû
(), s–f.
PORT
))

232 
i
 
š
 
	$¿nge
(
»que¡_couÁ
):

233 
c
.
	`puŒeque¡
('GET', '/')

234 
k
, 
v
 
š
 
cook›s
:

235 
c
.
	$puth—d”
(
k
, 
v
)

236 
c
.
	$’dh—d”s
()

237 
»¥Ú£
 = 
c
.
	$g‘»¥Ú£
()

238 
body
 = 
»¥Ú£
.
	$»ad
()

239 
»¥Ú£
.
¡©us
 !ğ200 
Ü
 
nÙ
 
body
.
	$isdig™
():

240 
”rÜs
.
	`­³nd
((
»¥Ú£
.
¡©us
, 
body
))

242 
d©a_diù
[
šdex
] = 
	`max
(d©a_diù[šdex], (
body
))

243 #Uncomm’ˆ
the
 
fŞlowšg
 
lše
 
to
 
´ove
 
th»ads
 
ov”Ïp
.

244 ## 
sys
.
¡dout
.
	`wr™e
("%d " % 
šdex
)

246 #S¹ <
»que¡_couÁ
> 
»que¡s
 
äom
 
—ch
 
of


247 #<
ş›Á_th»ad_couÁ
> 
cÚcu¼’t
 
ş›Ás


248 
ts
 = []

249 
c
 
š
 
	$¿nge
(
ş›Á_th»ad_couÁ
):

250 
d©a_diù
[
c
] = 0

251 
t
 = 
th»adšg
.
	`Th»ad
(
rg‘
=
»que¡
, 
¬gs
=(
c
,))

252 
ts
.
	$­³nd
(
t
)

253 
t
.
	$¡¬t
()

255 
t
 
š
 
ts
:

256 
t
.
	$još
()

258 
h™couÁ
 = 
	`max
(
d©a_diù
.
	$v®ues
())

259 
ex³ùed
 = 1 + (
ş›Á_th»ad_couÁ
 * 
»que¡_couÁ
)

261 
e
 
š
 
”rÜs
:

262 
	$´št
(
e
)

263 
£lf
.
	$as£¹Equ®
(
h™couÁ
, 
ex³ùed
)

265 
def
 
	$‹¡_3_Redœeù
(
£lf
):

266 #S¹ 
a
 
Ãw
 
£ssiÚ


267 
£lf
.
	`g‘Page
('/testStr')

268 
£lf
.
	`g‘Page
('/œedœ', s–f.
cook›s
)

269 
£lf
.
	`as£¹Body
("file")

271 
def
 
	$‹¡_4_Fe_d–‘iÚ
(
£lf
):

272 #S¹ 
a
 
Ãw
 
£ssiÚ


273 
£lf
.
	`g‘Page
('/testStr')

274 #D–‘
the
 
£ssiÚ
 
fe
 
mªu®ly
 
ªd
 
»Œy
.

275 
id
 = 
£lf
.
cook›s
[0][1].
	`¥l™
(";", 1)[0].split("=", 1)[1]

276 
·th
 = 
os
.·th.
	`još
(
loÿlDœ
, "£ssiÚ-" + 
id
)

277 
os
.
	$uÆšk
(
·th
)

278 
£lf
.
	`g‘Page
('/‹¡SŒ', s–f.
cook›s
)

280 
def
 
	$‹¡_5_E¼Ü_·ths
(
£lf
):

281 
£lf
.
	`g‘Page
('/unknown/page')

282 
£lf
.
	`as£¹E¼ÜPage
(404, "The…ath '/unknown/page' was‚ot found.")

284 #NÙe: 
this
 
·th
 
is
 *
nÙ
* 
the
 
§me
 
as
 
above
. 
The
‡bove

285 #ke 
a
 
nÜm®
 
rou‹
 
through
 
the
 
£ssiÚ
 
code
; 
this
 
Úe


286 #sk 
the
 
£ssiÚ
 
code
's before_handler‡nd only calls

287 #befÜe_fš®iz(
§ve
è
ªd
 
	`Ú_’d
 (
şo£
). 
So
 
the
 
£ssiÚ


288 #cod
has
 
to
 
survive
 
ÿÎšg
 
§ve
/
şo£
 
w™hout
 
š™
.

289 
£lf
.
	`g‘Page
('/»¡riùed', s–f.
cook›s
, 
m‘hod
='POST')

290 
£lf
.
	$as£¹E¼ÜPage
(405, 
»¥Ú£_codes
[405][1])

292 
def
 
	$‹¡_6_»g’”©e
(
£lf
):

293 
£lf
.
	`g‘Page
('/testStr')

294 #g¿b 
the
 
cook›
 
ID


295 
id1
 = 
£lf
.
cook›s
[0][1].
	`¥l™
(";", 1)[0].split("=", 1)[1]

296 
£lf
.
	`g‘Page
('/regen')

297 
£lf
.
	`as£¹Body
('logged in')

298 
id2
 = 
£lf
.
cook›s
[0][1].
	`¥l™
(";", 1)[0].split("=", 1)[1]

299 
£lf
.
	$as£¹NÙEqu®
(
id1
, 
id2
)

301 
£lf
.
	`g‘Page
('/testStr')

302 #g¿b 
the
 
cook›
 
ID


303 
id1
 = 
£lf
.
cook›s
[0][1].
	`¥l™
(";", 1)[0].split("=", 1)[1]

304 
£lf
.
	`g‘Page
('/testStr',

305 
h—d”s
=[('Cookie',

308 
id2
 = 
£lf
.
cook›s
[0][1].
	`¥l™
(";", 1)[0].split("=", 1)[1]

309 
£lf
.
	$as£¹NÙEqu®
(
id1
, 
id2
)

310 
£lf
.
	`as£¹NÙEqu®
(
id2
, 'maliciousid')

312 
def
 
	$‹¡_7_£ssiÚ_cook›s
(
£lf
):

313 
£lf
.
	`g‘Page
('/setsessiontype/ram')

314 
£lf
.
	`g‘Page
('/clear')

315 
£lf
.
	`g‘Page
('/session_cookie')

316 #g¿b 
the
 
cook›
 
ID


317 
cook›_·¹s
 = 
	`diù
([
p
.
	`¡r
().
	`¥l™
('='è°
š
 
£lf
.
cook›s
[0][1].split(";")])

318 #As£¹ 
th”e
 
is
 
no
 'expœes' 
·¿m


319 
£lf
.
	`as£¹Equ®
(
	`£t
(
cook›_·¹s
.
	`keys
()), set(['temp', 'Path']))

320 
id1
 = 
cook›_·¹s
['temp']

321 
£lf
.
	`as£¹Equ®
(
	`cİykeys
(
£ssiÚs
.
RamSessiÚ
.
ÿche
), [
id1
])

323 #S’d 
ªÙh”
 
»que¡
 
š
 
the
 
§me
 "browser session".

324 
£lf
.
	`g‘Page
('/£ssiÚ_cook›', s–f.
cook›s
)

325 
cook›_·¹s
 = 
	`diù
([
p
.
	`¡r
().
	`¥l™
('='è°
š
 
£lf
.
cook›s
[0][1].split(";")])

326 #As£¹ 
th”e
 
is
 
no
 'expœes' 
·¿m


327 
£lf
.
	`as£¹Equ®
(
	`£t
(
cook›_·¹s
.
	`keys
()), set(['temp', 'Path']))

328 
£lf
.
	$as£¹Body
(
id1
)

329 
£lf
.
	`as£¹Equ®
(
	`cİykeys
(
£ssiÚs
.
RamSessiÚ
.
ÿche
), [
id1
])

331 #SimuÏ‹ 
a
 
brow£r
 
şo£
 
by
 
ju¡
 
nÙ
 
£ndšg
 
the
 
cook›s


332 
£lf
.
	`g‘Page
('/session_cookie')

333 #g¿b 
the
 
cook›
 
ID


334 
cook›_·¹s
 = 
	`diù
([
p
.
	`¡r
().
	`¥l™
('='è°
š
 
£lf
.
cook›s
[0][1].split(";")])

335 #As£¹ 
th”e
 
is
 
no
 'expœes' 
·¿m


336 
£lf
.
	`as£¹Equ®
(
	`£t
(
cook›_·¹s
.
	`keys
()), set(['temp', 'Path']))

337 #As£¹ 
a
 
Ãw
 
id
 
has
 
b“n
 
g’”©ed
...

338 
id2
 = 
cook›_·¹s
['temp']

339 
£lf
.
	$as£¹NÙEqu®
(
id1
, 
id2
)

340 
£lf
.
	`as£¹Equ®
(
	`£t
(
£ssiÚs
.
RamSessiÚ
.
ÿche
.
	`keys
()), 
	$£t
([
id1
, 
id2
]))

342 #Wa™ 
the
 
£ssiÚ
.
timeout
 
Ú
 
bÙh
 
£ssiÚs


343 
time
.
	$¦“p
(2.5)

344 
ÿche
 = 
	$cİykeys
(
£ssiÚs
.
RamSessiÚ
.
ÿche
)

345 
ÿche
:

346 
ÿche
 =ğ[
id2
]:

347 
£lf
.
	`ç
("The second session did‚otime out.")

349 
£lf
.
	`ç
("UnknowÀ£ssiÚ id iÀÿche: %r", 
ÿche
)

352 
impÜt
 
sock‘


353 
Œy
:

354 
impÜt
 
memÿche


356 
ho¡
, 
pÜt
 = '127.0.0.1', 11211

357 
»s
 
š
 
sock‘
.
	$g‘addršfo
(
ho¡
, 
pÜt
, 
sock‘
.
AF_UNSPEC
,

358 
sock‘
.
SOCK_STREAM
):

359 
af
, 
sockty³
, 
´Ùo
, 
ÿnÚÇme
, 
§
 = 
»s


360 
s
 = 
NÚe


361 
Œy
:

362 
s
 = 
sock‘
.
	$sock‘
(
af
, 
sockty³
, 
´Ùo
)

363 #S“ 
h‰p
:

364 #brow£_äm/
th»ad
/
bbã5eb39c904ã0


365 
s
.
	$£‰imeout
(1.0)

366 
s
.
	`cÚÃù
((
ho¡
, 
pÜt
))

367 
s
.
	$şo£
()

368 
exû±
 
sock‘
.
”rÜ
:

369 
s
:

370 
s
.
	$şo£
()

371 
¿i£


373 
	$exû±
 (
ImpÜtE¼Ü
, 
sock‘
.
”rÜ
):

374 
şass
 
	$MemÿchedSessiÚTe¡
(
h–³r
.
CPWebCa£
):

375 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

377 
def
 
	$‹¡
(
£lf
):

378  
£lf
.
	`sk
("memcached‚ot„eachable ")

380 
şass
 
	$MemÿchedSessiÚTe¡
(
h–³r
.
CPWebCa£
):

381 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

383 
def
 
	$‹¡_0_SessiÚ
(
£lf
):

384 
£lf
.
	`g‘Page
('/setsessiontype/memcached')

386 
£lf
.
	`g‘Page
('/testStr')

387 
£lf
.
	`as£¹Body
('1')

388 
£lf
.
	`g‘Page
('/‹¡G’', s–f.
cook›s
)

389 
£lf
.
	`as£¹Body
('2')

390 
£lf
.
	`g‘Page
('/‹¡SŒ', s–f.
cook›s
)

391 
£lf
.
	`as£¹Body
('3')

392 
£lf
.
	`g‘Page
('/Ëngth', s–f.
cook›s
)

393 
£lf
.
	$as£¹E¼ÜPage
(500)

394 
£lf
.
	`as£¹InBody
("NotImplementedError")

395 
£lf
.
	`g‘Page
('/d–key?key=couÁ”', s–f.
cook›s
)

396 
£lf
.
	$as£¹Stus
(200)

398 #Wa™ 
the
 
£ssiÚ
.
	`timeout
 (1 
£cÚd
)

399 
time
.
	$¦“p
(1.25)

400 
£lf
.
	`g‘Page
('/')

401 
£lf
.
	`as£¹Body
('1')

403 #Te¡ 
£ssiÚ
 
__cÚšs__


404 
£lf
.
	`g‘Page
('/keyš?key=couÁ”', s–f.
cook›s
)

405 
£lf
.
	`as£¹Body
("True")

407 #Te¡ 
£ssiÚ
 
d–‘e


408 
£lf
.
	`g‘Page
('/d–‘e', s–f.
cook›s
)

409 
£lf
.
	`as£¹Body
("done")

411 
def
 
	$‹¡_1_CÚcu¼’cy
(
£lf
):

412 
ş›Á_th»ad_couÁ
 = 5

413 
»que¡_couÁ
 = 30

415 #G‘ 
š™Ÿl
 
cook›


416 
£lf
.
	`g‘Page
("/")

417 
£lf
.
	`as£¹Body
("1")

418 
cook›s
 = 
£lf
.cookies

420 
d©a_diù
 = {
	}
}

422 
def
 
	$»que¡
(
šdex
):

423 
i
 
š
 
	$¿nge
(
»que¡_couÁ
):

424 
£lf
.
	`g‘Page
("/", 
cook›s
)

425 #Uncomm’ˆ
the
 
fŞlowšg
 
lše
 
to
 
´ove
 
th»ads
 
ov”Ïp
.

426 ## 
sys
.
¡dout
.
	`wr™e
("%d " % 
šdex
)

427 
nÙ
 
£lf
.
body
.
	$isdig™
():

428 
£lf
.
	$ç
(
£lf
.
body
)

429 
d©a_diù
[
šdex
] = 
v
 = (
£lf
.
body
)

431 #S¹ <
»que¡_couÁ
> 
cÚcu¼’t
 
»que¡s
 
äom


432 #—ch 
of
 <
ş›Á_th»ad_couÁ
> 
ş›Ás


433 
ts
 = []

434 
c
 
š
 
	$¿nge
(
ş›Á_th»ad_couÁ
):

435 
d©a_diù
[
c
] = 0

436 
t
 = 
th»adšg
.
	`Th»ad
(
rg‘
=
»que¡
, 
¬gs
=(
c
,))

437 
ts
.
	$­³nd
(
t
)

438 
t
.
	$¡¬t
()

440 
t
 
š
 
ts
:

441 
t
.
	$još
()

443 
h™couÁ
 = 
	`max
(
d©a_diù
.
	$v®ues
())

444 
ex³ùed
 = 1 + (
ş›Á_th»ad_couÁ
 * 
»que¡_couÁ
)

445 
£lf
.
	$as£¹Equ®
(
h™couÁ
, 
ex³ùed
)

447 
def
 
	$‹¡_3_Redœeù
(
£lf
):

448 #S¹ 
a
 
Ãw
 
£ssiÚ


449 
£lf
.
	`g‘Page
('/testStr')

450 
£lf
.
	`g‘Page
('/œedœ', s–f.
cook›s
)

451 
£lf
.
	`as£¹Body
("memcached")

453 
def
 
	$‹¡_5_E¼Ü_·ths
(
£lf
):

454 
£lf
.
	`g‘Page
('/unknown/page')

455 
£lf
.
	`as£¹E¼ÜPage
(404, "The…ath '/unknown/page' was‚ot found.")

457 #NÙe: 
this
 
·th
 
is
 *
nÙ
* 
the
 
§me
 
as
 
above
. 
The
‡bove

458 #ke 
a
 
nÜm®
 
rou‹
 
through
 
the
 
£ssiÚ
 
code
; 
this
 
Úe


459 #sk 
the
 
£ssiÚ
 
code
's before_handler‡nd only calls

460 #befÜe_fš®iz(
§ve
è
ªd
 
	`Ú_’d
 (
şo£
). 
So
 
the
 
£ssiÚ


461 #cod
has
 
to
 
survive
 
ÿÎšg
 
§ve
/
şo£
 
w™hout
 
š™
.

462 
£lf
.
	`g‘Page
('/»¡riùed', s–f.
cook›s
, 
m‘hod
='POST')

463 
£lf
.
	`as£¹E¼ÜPage
(405, 
»¥Ú£_codes
[405][1])

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/test_sessionauthenticate.py

1 
impÜt
 
ch”rypy


2 
äom
 
	gch”rypy
.
‹¡
 
impÜt
 
h–³r


5 
şass
 
	$SessiÚAuth’tiÿ‹Te¡
(
h–³r
.
CPWebCa£
):

7 
def
 
	$£tup_£rv”
():

9 
def
 
	$check
(
u£ºame
, 
·sswÜd
):

10 #Dummy 
check_u£ºame_ªd_·sswÜd
 
funùiÚ


11 
u£ºame
 !ğ'‹¡' 
Ü
 
·sswÜd
 != 'password':

14 
def
 
	$augm’t_·¿ms
():

15 #A 
sim¶e
 
toŞ
 
to
 
add
 
some
 
thšgs
Ø
»que¡
.
·¿ms


16 #Thi 
is
 
to
 
check
Ø
make
 
su»
 
th©
 
£ssiÚ_auth
 
ÿn
 
hªdË
 
»que¡


17 #·¿m (
tick‘
 #780)

18 
ch”rypy
.
»que¡
.
·¿ms
["test"] = "test"

20 
ch”rypy
.
toŞs
.
augm’t_·¿ms
 = ch”rypy.
	`ToŞ
('before_handler',

21 
augm’t_·¿ms
, 
NÚe
, 
´iÜ™y
=30)

23 
şass
 
Te¡
:

25 
_ı_cÚfig
 = {'toŞs.£ssiÚs.Ú': 
True
,

26 'toŞs.£ssiÚ_auth.Ú': 
True
,

27 'toŞs.£ssiÚ_auth.check_u£ºame_ªd_·sswÜd': 
check
,

28 'toŞs.augm’t_·¿ms.Ú': 
True
,

29 
	}
}

31 
def
 
	$šdex
(
£lf
, **
kw¬gs
):

32  "H˜%s, you‡»†ogged in" % 
ch”rypy
.
»que¡
.
logš


33 
šdex
.
expo£d
 = 
True


35 
ch”rypy
.
Œ“
.
	`mouÁ
(
	$Te¡
())

36 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

39 
def
 
	$‹¡SessiÚAuth’tiÿ‹
(
£lf
):

40 #»que¡ 
a
 
·ge
 
ªd
 
check
 
logš
 
fÜm


41 
£lf
.
	`g‘Page
('/')

42 
£lf
.
	`as£¹InBody
('<form method="post"‡ction="do_login">')

44 #£tu°
üed’tŸls


45 
logš_body
 = 'username=test&password=password&from_page=/'

47 #©‹m± 
a
 
logš


48 
£lf
.
	`g‘Page
('/do_logš', 
m‘hod
='POST', 
body
=
logš_body
)

49 
£lf
.
	`as£¹Stus
((302, 303))

51 #g‘ 
the
 
·ge
 
now
 
th©
 
we
 
¬e
 
logged
 
š


52 
£lf
.
	`g‘Page
('/', s–f.
cook›s
)

53 
£lf
.
	`as£¹Body
('Hiest, you‡re†ogged in')

55 #dØ
a
 
logout


56 
£lf
.
	`g‘Page
('/do_logout', s–f.
cook›s
, 
m‘hod
='POST')

57 
£lf
.
	`as£¹Stus
((302, 303))

59 #v”ify 
we
 
¬e
 
logged
 
out


60 
£lf
.
	`g‘Page
('/', s–f.
cook›s
)

61 
£lf
.
	`as£¹InBody
('<form method="post"‡ction="do_login">')

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/test_states.py

1 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
	gBadStusLše
, 
Áob


2 
impÜt
 
os


3 
impÜt
 
sys


4 
impÜt
 
time


5 
impÜt
 
sigÇl


6 
impÜt
 
un™‹¡


7 
impÜt
 
sock‘


9 
impÜt
 
ch”rypy


10 
impÜt
 
	gch”rypy
.
	g´oûss
.
£rv”s


11 
äom
 
	gch”rypy
.
‹¡
 
impÜt
 
h–³r


13 
	g’gše
 = 
ch”rypy
.
’gše


14 
thisdœ
 = 
os
.
·th
.
još
(os.
g‘cwd
(), os.·th.
	$dœÇme
(
__fe__
))

17 
şass
 
D•’d’cy
:

19 
def
 
	$__š™__
(
£lf
, 
bus
):

20 
£lf
.
bus
 = bus

21 
£lf
.
ruÂšg
 = 
F®£


22 
£lf
.
¡¬tcouÁ
 = 0

23 
£lf
.
g¿ûcouÁ
 = 0

24 
£lf
.
th»ads
 = {
	}
}

26 
def
 
	$subsüibe
(
£lf
):

27 
£lf
.
bus
.
	`subsüibe
('¡¬t', s–f.
¡¬t
)

28 
£lf
.
bus
.
	`subsüibe
('¡İ', s–f.
¡İ
)

29 
£lf
.
bus
.
	`subsüibe
('g¿ûful', s–f.
g¿ûful
)

30 
£lf
.
bus
.
	`subsüibe
('¡¬t_th»ad', s–f.
¡¬‰h»ad
)

31 
£lf
.
bus
.
	`subsüibe
('¡İ_th»ad', s–f.
¡İth»ad
)

33 
def
 
	$¡¬t
(
£lf
):

34 
£lf
.
ruÂšg
 = 
True


35 
£lf
.
¡¬tcouÁ
 += 1

37 
def
 
	$¡İ
(
£lf
):

38 
£lf
.
ruÂšg
 = 
F®£


40 
def
 
	$g¿ûful
(
£lf
):

41 
£lf
.
g¿ûcouÁ
 += 1

43 
def
 
	$¡¬‰h»ad
(
£lf
, 
th»ad_id
):

44 
£lf
.
th»ads
[
th»ad_id
] = 
NÚe


46 
def
 
	$¡İth»ad
(
£lf
, 
th»ad_id
):

47 
d–
 
£lf
.
th»ads
[
th»ad_id
]

49 
db_cÚÃùiÚ
 = 
	$D•’d’cy
(
’gše
)

51 
def
 
	$£tup_£rv”
():

52 
şass
 
RoÙ
:

53 
def
 
	$šdex
(
£lf
):

55 
šdex
.
expo£d
 = 
True


57 
def
 
	$ù¾c
(
£lf
):

58 
¿i£
 
	$KeybßrdIÁ”ru±
()

59 
ù¾c
.
expo£d
 = 
True


61 
def
 
	$g¿ûful
(
£lf
):

62 
’gše
.
	$g¿ûful
()

64 
g¿ûful
.
expo£d
 = 
True


66 
def
 
	$block_ex¶ic™
(
£lf
):

67 
True
:

68 
ch”rypy
.
»¥Ú£
.
timed_out
:

69 
ch”rypy
.
»¥Ú£
.
timed_out
 = 
F®£


71 
time
.
	$¦“p
(0.01)

72 
block_ex¶ic™
.
expo£d
 = 
True


74 
def
 
	$block_im¶ic™
(
£lf
):

75 
time
.
	$¦“p
(0.5)

76  "»¥Ú£.timeouˆğ%s" % 
ch”rypy
.
»¥Ú£
.
timeout


77 
block_im¶ic™
.
expo£d
 = 
True


79 
ch”rypy
.
Œ“
.
	`mouÁ
(
	$RoÙ
())

80 
ch”rypy
.
cÚfig
.
	`upd©e
({

83 
	}
})

85 
db_cÚÃùiÚ
.
	$subsüibe
()

87 #------------ 
Enough
 
h–³rs
. 
Time
 
»®
 
live
 
‹¡
 
ÿ£s
. ------------ #


88 
şass
 
	$S”v”S‹Te¡s
(
h–³r
.
CPWebCa£
):

89 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

91 
def
 
	$£tUp
(
£lf
):

92 
ch”rypy
.
£rv”
.
sock‘_timeout
 = 0.1

93 
£lf
.
do_gc_‹¡
 = 
F®£


95 
def
 
	$‹¡_0_NÜm®S‹Flow
(
£lf
):

96 
’gše
.
	$¡İ
()

97 #Ou¸
db_cÚÃùiÚ
 
should
 
nÙ
 
be
 
ruÂšg


98 
£lf
.
	$as£¹Equ®
(
db_cÚÃùiÚ
.
ruÂšg
, 
F®£
)

99 
£lf
.
	$as£¹Equ®
(
db_cÚÃùiÚ
.
¡¬tcouÁ
, 1)

100 
£lf
.
	`as£¹Equ®
(
	`Ën
(
db_cÚÃùiÚ
.
th»ads
), 0)

102 #Te¡ 
£rv”
 
¡¬t


103 
’gše
.
	$¡¬t
()

104 
£lf
.
	$as£¹Equ®
(
’gše
.
¡©e
,ƒngše.
¡©es
.
STARTED
)

106 
ho¡
 = 
ch”rypy
.
£rv”
.
sock‘_ho¡


107 
pÜt
 = 
ch”rypy
.
£rv”
.
sock‘_pÜt


108 
£lf
.
	$as£¹Rai£s
(
IOE¼Ü
, 
ch”rypy
.
_ı£rv”
.
check_pÜt
, 
ho¡
, 
pÜt
)

110 #Th
db_cÚÃùiÚ
 
should
 
be
 
ruÂšg
 
now


111 
£lf
.
	$as£¹Equ®
(
db_cÚÃùiÚ
.
ruÂšg
, 
True
)

112 
£lf
.
	$as£¹Equ®
(
db_cÚÃùiÚ
.
¡¬tcouÁ
, 2)

113 
£lf
.
	`as£¹Equ®
(
	`Ën
(
db_cÚÃùiÚ
.
th»ads
), 0)

115 
£lf
.
	`g‘Page
("/")

116 
£lf
.
	`as£¹Body
("Hello World")

117 
£lf
.
	`as£¹Equ®
(
	`Ën
(
db_cÚÃùiÚ
.
th»ads
), 1)

119 #Te¡ 
’gše
 
¡İ
. 
This
 
wl
 
®so
 stİ 
the
 
HTTP
 
£rv”
.

120 
’gše
.
	$¡İ
()

121 
£lf
.
	$as£¹Equ®
(
’gše
.
¡©e
,ƒngše.
¡©es
.
STOPPED
)

123 #V”ify 
th©
 
our
 
cu¡om
 
¡İ
 
funùiÚ
 
was
 
ÿÎed


124 
£lf
.
	$as£¹Equ®
(
db_cÚÃùiÚ
.
ruÂšg
, 
F®£
)

125 
£lf
.
	`as£¹Equ®
(
	`Ën
(
db_cÚÃùiÚ
.
th»ads
), 0)

127 #Block 
the
 
maš
 
th»ad
 
now
 
ªd
 
v”ify
 
th©
 
	`ex™
(è
wÜks
.

128 
def
 
	$ex™‹¡
():

129 
£lf
.
	`g‘Page
("/")

130 
£lf
.
	`as£¹Body
("Hello World")

131 
’gše
.
	$ex™
()

132 
ch”rypy
.
£rv”
.
	$¡¬t
()

133 
’gše
.
	$¡¬t_w™h_ÿÎback
(
ex™‹¡
)

134 
’gše
.
	$block
()

135 
£lf
.
	$as£¹Equ®
(
’gše
.
¡©e
,ƒngše.
¡©es
.
EXITING
)

137 
def
 
	$‹¡_1_Re¡¬t
(
£lf
):

138 
ch”rypy
.
£rv”
.
	$¡¬t
()

139 
’gše
.
	$¡¬t
()

141 #Th
db_cÚÃùiÚ
 
should
 
be
 
ruÂšg
 
now


142 
£lf
.
	$as£¹Equ®
(
db_cÚÃùiÚ
.
ruÂšg
, 
True
)

143 
g¿û
 = 
db_cÚÃùiÚ
.
g¿ûcouÁ


145 
£lf
.
	`g‘Page
("/")

146 
£lf
.
	`as£¹Body
("Hello World")

147 
£lf
.
	`as£¹Equ®
(
	`Ën
(
db_cÚÃùiÚ
.
th»ads
), 1)

149 #Te¡ 
£rv”
 
»¡¬t
 
äom
 
this
 
th»ad


150 
’gše
.
	$g¿ûful
()

151 
£lf
.
	$as£¹Equ®
(
’gše
.
¡©e
,ƒngše.
¡©es
.
STARTED
)

152 
£lf
.
	`g‘Page
("/")

153 
£lf
.
	`as£¹Body
("Hello World")

154 
£lf
.
	$as£¹Equ®
(
db_cÚÃùiÚ
.
ruÂšg
, 
True
)

155 
£lf
.
	`as£¹Equ®
(
db_cÚÃùiÚ
.
g¿ûcouÁ
, 
g¿û
 + 1)

156 
£lf
.
	`as£¹Equ®
(
	`Ën
(
db_cÚÃùiÚ
.
th»ads
), 1)

158 #Te¡ 
£rv”
 
»¡¬t
 
äom
 
šside
 
a
 
·ge
 
hªdËr


159 
£lf
.
	`g‘Page
("/graceful")

160 
£lf
.
	$as£¹Equ®
(
’gše
.
¡©e
,ƒngše.
¡©es
.
STARTED
)

161 
£lf
.
	`as£¹Body
("app was (gracefully)„estarted succesfully")

162 
£lf
.
	$as£¹Equ®
(
db_cÚÃùiÚ
.
ruÂšg
, 
True
)

163 
£lf
.
	`as£¹Equ®
(
db_cÚÃùiÚ
.
g¿ûcouÁ
, 
g¿û
 + 2)

164 #Sšû 
we
 
¬e
 
»que¡šg
 
synchrÚou¦y
, 
is
 
Úly
 
Úe
 
th»ad
 
u£d
?

165 #NÙ
th©
 
the
 "/g¿ûful" 
»que¡
 
has
 
b“n
 
æushed
.

166 
£lf
.
	`as£¹Equ®
(
	`Ën
(
db_cÚÃùiÚ
.
th»ads
), 0)

168 
’gše
.
	$¡İ
()

169 
£lf
.
	$as£¹Equ®
(
’gše
.
¡©e
,ƒngše.
¡©es
.
STOPPED
)

170 
£lf
.
	$as£¹Equ®
(
db_cÚÃùiÚ
.
ruÂšg
, 
F®£
)

171 
£lf
.
	`as£¹Equ®
(
	`Ën
(
db_cÚÃùiÚ
.
th»ads
), 0)

173 
def
 
	$‹¡_2_KeybßrdIÁ”ru±
(
£lf
):

174 #Rai£ 
a
 
keybßrd
 
š‹¼u±
 
š
 
the
 
HTTP
 
£rv”
's mainhread.

175 #W
mu¡
 
¡¬t
 
the
 
£rv”
 
š
 
this
,h
maš
 
th»ad


176 
’gše
.
	$¡¬t
()

177 
ch”rypy
.
£rv”
.
	$¡¬t
()

179 
£lf
.
³rsi¡’t
 = 
True


180 
Œy
:

181 #Mak
the
 
fœ¡
 
»que¡
 
ªd
 
as£¹
 
th”e
's‚o "Connection: close".

182 
£lf
.
	`g‘Page
("/")

183 
£lf
.
	`as£¹Stus
('200 OK')

184 
£lf
.
	`as£¹Body
("Hello World")

185 
£lf
.
	`as£¹NoH—d”
("Connection")

187 
ch”rypy
.
£rv”
.
h‰p£rv”
.
š‹¼u±
 = 
KeybßrdIÁ”ru±


188 
’gše
.
	$block
()

190 
£lf
.
	$as£¹Equ®
(
db_cÚÃùiÚ
.
ruÂšg
, 
F®£
)

191 
£lf
.
	`as£¹Equ®
(
	`Ën
(
db_cÚÃùiÚ
.
th»ads
), 0)

192 
£lf
.
	$as£¹Equ®
(
’gše
.
¡©e
,ƒngše.
¡©es
.
EXITING
)

193 
fš®ly
:

194 
£lf
.
³rsi¡’t
 = 
F®£


196 #Rai£ 
a
 
keybßrd
 
š‹¼u±
 
š
‡ 
·ge
 
hªdËr
; 
Ú
 
muÉ™h»aded


197 #£rv”s, 
this
 
should
 
occur
 
š
 
Úe
 
of
 
the
 
wÜk”
 
th»ads
.

198 #Thi 
should
 
¿i£
 
a
 
BadStusLše
 
”rÜ
, 
sšû
 
the
 
wÜk”


199 #th»ad 
wl
 
ju¡
 
d›
 
w™hout
 
wr™šg
 
a
 
»¥Ú£
.

200 
’gše
.
	$¡¬t
()

201 
ch”rypy
.
£rv”
.
	$¡¬t
()

203 
Œy
:

204 
£lf
.
	`g‘Page
("/ctrlc")

205 
exû±
 
BadStusLše
:

206 
·ss


208 
	$´št
(
£lf
.
body
)

209 
£lf
.
	`ç
("AssertionError: BadStatusLine‚ot„aised")

211 
’gše
.
	$block
()

212 
£lf
.
	$as£¹Equ®
(
db_cÚÃùiÚ
.
ruÂšg
, 
F®£
)

213 
£lf
.
	`as£¹Equ®
(
	`Ën
(
db_cÚÃùiÚ
.
th»ads
), 0)

215 
def
 
	$‹¡_3_D—dlocks
(
£lf
):

216 
ch”rypy
.
cÚfig
.
	`upd©e
({'»¥Ú£.timeout': 0.2
	}
})

218 
’gše
.
	$¡¬t
()

219 
ch”rypy
.
£rv”
.
	$¡¬t
()

220 
Œy
:

221 
£lf
.
	$as£¹NÙEqu®
(
’gše
.
timeout_mÚ™Ü
.
th»ad
, 
NÚe
)

223 #Reque¡ 
a
 "nÜm®" 
·ge
.

224 
£lf
.
	$as£¹Equ®
(
’gše
.
timeout_mÚ™Ü
.
£rvšgs
, [])

225 
£lf
.
	`g‘Page
("/")

226 
£lf
.
	`as£¹Body
("Hello World")

227 #»que¡.
şo£
 
is
 
ÿÎed
 
async
.

228 
’gše
.
timeout_mÚ™Ü
.
£rvšgs
:

229 
sys
.
¡dout
.
	`wr™e
(".")

230 
time
.
	$¦“p
(0.01)

232 #Reque¡ 
a
 
·ge
 
th©
 
ex¶ic™ly
 
checks
 
™£lf
 
d—dlock
.

233 #Th
d—dlock_timeout
 
should
 
be
 2 
£cs
.

234 
£lf
.
	`g‘Page
("/block_explicit")

235 
£lf
.
	`as£¹Body
("broken!")

237 #Reque¡ 
a
 
·ge
 
th©
 
im¶ic™ly
 
b»aks
 
d—dlock
.

238 #Ià
we
 
d—dlock
, w
wªt
 
to
 
touch
 
as
 
l™e
 
code
‡ 
possibË
,

239 #sØ
we
 
wÚ
'tƒven call handle_error, just bail ASAP.

240 
£lf
.
	`g‘Page
("/block_implicit")

241 
£lf
.
	$as£¹Stus
(500)

242 
£lf
.
	`as£¹InBody
("raise cherrypy.TimeoutError()")

243 
fš®ly
:

244 
’gše
.
	$ex™
()

246 
def
 
	$‹¡_4_AutÜ–ßd
(
£lf
):

247 #S¹ 
the
 
demo
 
süt
 
š
 
a
 
Ãw
 
´oûss


248 
p
 = 
h–³r
.
	`CPProûss
(
s¦
=(
£lf
.
scheme
.
	`low”
()=='https'))

249 
p
.
	`wr™e_cÚf
(
exŒa
='test_case_name: "test_4_Autoreload"')

250 
p
.
	`¡¬t
(
impÜts
='cherrypy.test._test_states_demo')

251 
Œy
:

252 
£lf
.
	`g‘Page
("/start")

253 
¡¬t
 = (
£lf
.
body
)

255 #Giv
the
 
autÜ–ßd”
 
time
 
to
 
ÿche
h
fe
ime.

256 
time
.
	$¦“p
(2)

258 #Touch 
the
 
fe


259 
os
.
	`utime
(os.
·th
.
	`još
(
thisdœ
, "_‹¡_¡©es_demo.py"), 
NÚe
)

261 #Giv
the
 
autÜ–ßd”
 
time
 
to
 
»
-
exec
h
´oûss


262 
time
.
	$¦“p
(2)

263 
ho¡
 = 
ch”rypy
.
£rv”
.
sock‘_ho¡


264 
pÜt
 = 
ch”rypy
.
£rv”
.
sock‘_pÜt


265 
ch”rypy
.
_ı£rv”
.
	$wa™_fÜ_occup›d_pÜt
(
ho¡
, 
pÜt
)

267 
£lf
.
	`g‘Page
("/start")

268 
	`nÙ
 ((
£lf
.
body
è> 
¡¬t
):

269 
¿i£
 
	`As£¹iÚE¼Ü
("startime %s‚ot greaterhan %s" %

270 ((
£lf
.
body
), 
¡¬t
))

271 
fš®ly
:

272 #Shuˆ
down
 
the
 
¥awÃd
 
´oûss


273 
£lf
.
	`g‘Page
("/exit")

274 
p
.
	$još
()

276 
def
 
	$‹¡_5_S¹_E¼Ü
(
£lf
):

277 #Ià
a
 
´oûss
 
”rÜs
 
duršg
 
¡¬t
, 
™
 
should
 
¡İ
 
the
 
’gše


278 #ªd 
ex™
 
w™h
 
a
 
nÚ
-
z”o
ƒx™ 
code
.

279 
p
 = 
h–³r
.
	`CPProûss
(
s¦
=(
£lf
.
scheme
.
	`low”
()=='https'),

280 
wa™
=
True
)

281 
p
.
	`wr™e_cÚf
(

282 
exŒa
="""starterror: True

283 
‹¡_ÿ£_Çme
: "test_5_Start_Error"

286 
p
.
	`¡¬t
(
impÜts
='cherrypy.test._test_states_demo')

287 
p
.
ex™_code
 == 0:

288 
£lf
.
	`ç
("Process failedo„eturn‚onzeroƒxit code.")

291 
şass
 
	$PlugšTe¡s
(
h–³r
.
CPWebCa£
):

292 
def
 
	$‹¡_d«mÚize
(
£lf
):

293 
os
.
Çme
 
nÙ
 
š
 ['posix']:

294  
£lf
.
	`sk
("skipped (not on…osix) ")

295 
£lf
.
HOST
 = '127.0.0.1'

296 
£lf
.
PORT
 = 8081

297 #S·wÀ
the
 
´oûss
 
ªd
 
wa™
, 
wh’
 
this
 
»tuºs
,h
Üigš®
…rocess

298 #i 
fšished
. 
If
 
™
 
d«mÚized
 
´İ”ly
, 
we
 
should
 
¡l
 
be
 
abË


299 #tØ
acûss
 
·ges
.

300 
p
 = 
h–³r
.
	`CPProûss
(
s¦
=(
£lf
.
scheme
.
	`low”
()=='https'),

301 
wa™
=
True
, 
d«mÚize
=True,

302 
sock‘_ho¡
='127.0.0.1',

303 
sock‘_pÜt
=8081)

304 
p
.
	`wr™e_cÚf
(

305 
exŒa
='test_case_name: "test_daemonize"')

306 
p
.
	`¡¬t
(
impÜts
='cherrypy.test._test_states_demo')

307 
Œy
:

308 #Ju¡ 
g‘
 
the
 
pid
 
of
h
d«mÚiz©iÚ
 
´oûss
.

309 
£lf
.
	`g‘Page
("/pid")

310 
£lf
.
	$as£¹Stus
(200)

311 
·ge_pid
 = (
£lf
.
body
)

312 
£lf
.
	`as£¹Equ®
(
·ge_pid
, 
p
.
	$g‘_pid
())

313 
fš®ly
:

314 #Shuˆ
down
 
the
 
¥awÃd
 
´oûss


315 
£lf
.
	`g‘Page
("/exit")

316 
p
.
	$još
()

318 #Wa™ 
uÁ
 
h”e
 
to
 
‹¡
 
the
 
ex™
 
code
 
beÿu£
 
we
 
wªt
Ø
’su»


319 #th© 
we
 
wa™
 
the
 
d«mÚ
 
to
 
fšish
 
ruÂšg
 
befÜe
 w
ç
.

320 
p
.
ex™_code
 != 0:

321 
£lf
.
	`ç
("Daemonized…arent…rocess failedoƒxit cleanly.")

324 
şass
 
	$SigÇlHªdlšgTe¡s
(
h–³r
.
CPWebCa£
):

325 
def
 
	$‹¡_SIGHUP_‰y
(
£lf
):

326 #Wh’ 
nÙ
 
d«mÚized
, 
SIGHUP
 
should
 
shut
 
down
 
the
 
£rv”
.

327 
Œy
:

328 
äom
 
sigÇl
 
impÜt
 
SIGHUP


329 
exû±
 
ImpÜtE¼Ü
:

330  
£lf
.
	`sk
("skipped (no SIGHUP) ")

332 #S·wÀ
the
 
´oûss
.

333 
p
 = 
h–³r
.
	`CPProûss
(
s¦
=(
£lf
.
scheme
.
	`low”
()=='https'))

334 
p
.
	`wr™e_cÚf
(

335 
exŒa
='test_case_name: "test_SIGHUP_tty"')

336 
p
.
	`¡¬t
(
impÜts
='cherrypy.test._test_states_demo')

337 #S’d 
a
 
SIGHUP


338 
os
.
	`kl
(
p
.
	`g‘_pid
(), 
SIGHUP
)

339 #Thi 
might
 
hªg
 
thšgs
 
¬’
't working„ight, but meh.

340 
p
.
	$još
()

342 
def
 
	$‹¡_SIGHUP_d«mÚized
(
£lf
):

343 #Wh’ 
d«mÚized
, 
SIGHUP
 
should
 
»¡¬t
 
the
 
£rv”
.

344 
Œy
:

345 
äom
 
sigÇl
 
impÜt
 
SIGHUP


346 
exû±
 
ImpÜtE¼Ü
:

347  
£lf
.
	`sk
("skipped (no SIGHUP) ")

349 
os
.
Çme
 
nÙ
 
š
 ['posix']:

350  
£lf
.
	`sk
("skipped (not on…osix) ")

352 #S·wÀ
the
 
´oûss
 
ªd
 
wa™
, 
wh’
 
this
 
»tuºs
,h
Üigš®
…rocess

353 #i 
fšished
. 
If
 
™
 
d«mÚized
 
´İ”ly
, 
we
 
should
 
¡l
 
be
 
abË


354 #tØ
acûss
 
·ges
.

355 
p
 = 
h–³r
.
	`CPProûss
(
s¦
=(
£lf
.
scheme
.
	`low”
()=='https'),

356 
wa™
=
True
, 
d«mÚize
=True)

357 
p
.
	`wr™e_cÚf
(

358 
exŒa
='test_case_name: "test_SIGHUP_daemonized"')

359 
p
.
	`¡¬t
(
impÜts
='cherrypy.test._test_states_demo')

361 
pid
 = 
p
.
	$g‘_pid
()

362 
Œy
:

363 #S’d 
a
 
SIGHUP


364 
os
.
	$kl
(
pid
, 
SIGHUP
)

365 #Giv
the
 
£rv”
 
some
 
time
 
to
 
»¡¬t


366 
time
.
	$¦“p
(2)

367 
£lf
.
	`g‘Page
("/pid")

368 
£lf
.
	$as£¹Stus
(200)

369 
Ãw_pid
 = (
£lf
.
body
)

370 
£lf
.
	$as£¹NÙEqu®
(
Ãw_pid
, 
pid
)

371 
fš®ly
:

372 #Shuˆ
down
 
the
 
¥awÃd
 
´oûss


373 
£lf
.
	`g‘Page
("/exit")

374 
p
.
	$još
()

376 
def
 
	$_»quœe_sigÇl_ªd_kl
(
£lf
, 
sigÇl_Çme
):

377 
nÙ
 
	$ha§‰r
(
sigÇl
, 
sigÇl_Çme
):

378 
£lf
.
	`sk
("sk³d (nØ%(sigÇl_Çme)s)" % 
	$v¬s
())

380 
nÙ
 
	`ha§‰r
(
os
, 'kill'):

381 
£lf
.
	`sk
("skipped (no os.kill)")

383 
def
 
	$‹¡_SIGTERM
(
£lf
):

385 
£lf
.
	`_»quœe_sigÇl_ªd_kl
('SIGTERM')

387 #S·wÀ
a
 
nÜm®
, 
und«mÚized
 
´oûss
.

388 
p
 = 
h–³r
.
	`CPProûss
(
s¦
=(
£lf
.
scheme
.
	`low”
()=='https'))

389 
p
.
	`wr™e_cÚf
(

390 
exŒa
='test_case_name: "test_SIGTERM"')

391 
p
.
	`¡¬t
(
impÜts
='cherrypy.test._test_states_demo')

392 #S’d 
a
 
SIGTERM


393 
os
.
	`kl
(
p
.
	`g‘_pid
(), 
sigÇl
.
SIGTERM
)

394 #Thi 
might
 
hªg
 
thšgs
 
¬’
't working„ight, but meh.

395 
p
.
	$još
()

397 
os
.
Çme
 
š
 ['posix']:

398 #S·wÀ
a
 
d«mÚized
 
´oûss
 
ªd
 
‹¡
 
agaš
.

399 
p
 = 
h–³r
.
	`CPProûss
(
s¦
=(
£lf
.
scheme
.
	`low”
()=='https'),

400 
wa™
=
True
, 
d«mÚize
=True)

401 
p
.
	`wr™e_cÚf
(

402 
exŒa
='test_case_name: "test_SIGTERM_2"')

403 
p
.
	`¡¬t
(
impÜts
='cherrypy.test._test_states_demo')

404 #S’d 
a
 
SIGTERM


405 
os
.
	`kl
(
p
.
	`g‘_pid
(), 
sigÇl
.
SIGTERM
)

406 #Thi 
might
 
hªg
 
thšgs
 
¬’
't working„ight, but meh.

407 
p
.
	$još
()

409 
def
 
	$‹¡_sigÇl_hªdËr_unsubsüibe
(
£lf
):

410 
£lf
.
	`_»quœe_sigÇl_ªd_kl
('SIGTERM')

412 #AÉhough 
Wšdows
 
has
 `
os
.
kl
` 
ªd
 
SIGTERM
 
is
 
defšed
, 
the


413 #¶©fÜm 
dÛs
 
nÙ
 
im¶em’t
 
sigÇls
 
ªd
 
£ndšg
 
SIGTERM


414 #wÈ
»suÉ
 
š
 
a
 
fÜûd
 
‹rmš©iÚ
 
of
 
the
 
´oûss
.

415 #Th”efÜe, 
this
 
‹¡
 
is
 
nÙ
 
su™abË
 
Wšdows
.

416 
os
.
Çme
 == 'nt':

417 
£lf
.
	`sk
("SIGTERM‚ot‡vailable")

419 #S·wÀ
a
 
nÜm®
, 
und«mÚized
 
´oûss
.

420 
p
 = 
h–³r
.
	`CPProûss
(
s¦
=(
£lf
.
scheme
.
	`low”
()=='https'))

421 
p
.
	`wr™e_cÚf
(

422 
exŒa
="""unsubsig: True

423 
‹¡_ÿ£_Çme
: "test_signal_handler_unsubscribe"

425 
p
.
	`¡¬t
(
impÜts
='cherrypy.test._test_states_demo')

426 #Ask 
the
 
´oûss
 
to
 
qu™


427 
os
.
	`kl
(
p
.
	`g‘_pid
(), 
sigÇl
.
SIGTERM
)

428 #Thi 
might
 
hªg
 
thšgs
 
¬’
't working„ight, but meh.

429 
p
.
	$još
()

431 #As£¹ 
the
 
Şd
 
hªdËr
 
¿n
.

432 
rg‘_lše
 = 
	`İ’
(
p
.
”rÜ_log
, 'rb').
	`»adlšes
()[-10]

433 
nÙ
 
	`Áob
("I‡m‡ÀŞd SIGTERM hªdËr."è
š
 
rg‘_lše
:

434 
£lf
.
	`ç
("Old SIGTERM hªdË¸did‚Ù„un.\n%r" % 
rg‘_lše
)

436 
şass
 
	$Wa™Te¡s
(
un™‹¡
.
Te¡Ca£
):

437 
def
 
	$‹¡_wa™_fÜ_occup›d_pÜt_INADDR_ANY
(
£lf
):

439 
Wa™
 
Ú
 
INADDR_ANY
 
should
 
nÙ
 
¿i£
 
IOE¼Ü


441 
In
 
ÿ£s
 
wh”e
 
the
 
loİback
 
š‹rçû
 
dÛs
 
nÙ
 
exi¡
, 
Ch”ryPy
 
ÿÂÙ


442 
efãùiv–y
 
d‘”mše
 
a
 
pÜt
 
bšdšg
 
to
 
INADDR_ANY
 
was
 
efãùed
.

443 
In
 
this
 
s™u©iÚ
, 
Ch”ryPy
 
should
 
assume
 
th©
 
™
 
çed
 
to
 
d‘eù


444 
the
 
	$bšdšg
 (
nÙ
 
th©
 
the
 
bšdšg
 
çed
è
ªd
 
Úly
 
w¬n
h© 
™
 
could


445 
nÙ
 
v”ify
 
™
.

447 #Aˆ
such
 
a
 
time
 
th©
 
Ch”ryPy
 
ÿn
 
»lŸbly
 
d‘”mše
 
Úe
 
Ü
 
mÜe


448 #vŸbË 
IP
 
add»s£s
 
of
 
the
 
ho¡
, 
this
 
‹¡
 
may
 
be
 
»moved
.

450 #SimuÏ‹ 
the
 
behaviÜ
 
we
 
ob£rve
 
wh’
 
no
 
loİback
 
š‹rçû
 
is


451 #´e£Á 
by
: 
fšdšg
 
a
 
pÜt
 
th©
's‚ot occupied,hen wait on it.

453 
ä“_pÜt
 = 
£lf
.
	$fšd_ä“_pÜt
()

455 
£rv”s
 = 
ch”rypy
.
´oûss
.servers

457 
def
 
	$w™h_shÜ‹r_timeouts
(
func
):

459 
A
 
cÚ‹xt
 
wh”e
 
occup›d_pÜt_timeout
 
is
 
much
 
sm®Ër
 
to
 
¥“d


460 
‹¡
 
runs
.

462 #Wh’ 
we
 
have
 
PythÚ
 2.5, 
sim¶ify
 
usšg
 
the
 
w™h_¡©em’t
.

463 
Üig_timeout
 = 
£rv”s
.
occup›d_pÜt_timeout


464 
£rv”s
.
occup›d_pÜt_timeout
 = .07

465 
Œy
:

466 
	$func
()

467 
fš®ly
:

468 
£rv”s
.
occup›d_pÜt_timeout
 = 
Üig_timeout


470 
def
 
	$do_wa™šg
():

471 #Wa™ 
Ú
 
the
 
ä“
 
pÜt
 
th©
's unbound

472 
£rv”s
.
	`wa™_fÜ_occup›d_pÜt
('0.0.0.0', 
ä“_pÜt
)

473 #Th
wa™
 
should
 
¡l
 
¿i£
 
ª
 
IO
 
”rÜ
 
INADDR_ANY
 
was


474 #nÙ 
suµl›d
.

475 
£lf
.
	`as£¹Rai£s
(
IOE¼Ü
, 
£rv”s
.
wa™_fÜ_occup›d_pÜt
,

476 '127.0.0.1', 
ä“_pÜt
)

478 
	$w™h_shÜ‹r_timeouts
(
do_wa™šg
)

480 
def
 
	$fšd_ä“_pÜt
(
£lf
):

482 
sock
 = 
sock‘
.
	$sock‘
(
sock‘
.
AF_INET
, sock‘.
SOCK_STREAM
)

483 
sock
.
	`bšd
(('', 0))

484 
ä“_pÜt
 = 
sock
.
	`g‘sockÇme
()[1]

485 
sock
.
	$şo£
()

486  
ä“_pÜt


	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/test_static.py

1 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
	gHTTPCÚÃùiÚ
, 
	gHTTPSCÚÃùiÚ
, 
Áob


2 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
By‹sIO


4 
impÜt
 
os


5 
	gcurdœ
 = 
os
.
·th
.
još
(os.
g‘cwd
(), os.·th.
	$dœÇme
(
__fe__
))

6 
has_¥aû_f•©h
 = 
os
.
·th
.
	`još
(
curdœ
, 'static', 'has space.html')

7 
bigfe_f•©h
 = 
os
.
·th
.
	`još
(
curdœ
, "static", "bigfile.log")

8 
BIGFILE_SIZE
 = 1024 * 1024

10 
impÜt
 
ch”rypy


11 
äom
 
ch”rypy
.
lib
 
impÜt
 

12 
äom
 
ch”rypy
.
‹¡
 
impÜt
 
h–³r


15 
şass
 
	$SticTe¡
(
h–³r
.
CPWebCa£
):

17 
def
 
	$£tup_£rv”
():

18 
nÙ
 
os
.
·th
.
	$exi¡s
(
has_¥aû_f•©h
):

19 
	`İ’
(
has_¥aû_f•©h
, 'wb').
	`wr™e
(
	`Áob
('Hello, world\r\n'))

20 
nÙ
 
os
.
·th
.
	$exi¡s
(
bigfe_f•©h
):

21 
	`İ’
(
bigfe_f•©h
, 'wb').
	`wr™e
(
	`Áob
("x" * 
BIGFILE_SIZE
))

23 
şass
 
RoÙ
:

25 
def
 
	$bigfe
(
£lf
):

26 
äom
 
ch”rypy
.
lib
 
impÜt
 

27 
£lf
.
f
 = .
	$£rve_fe
(
bigfe_f•©h
)

28  
£lf
.
f


29 
bigfe
.
expo£d
 = 
True


30 
bigfe
.
_ı_cÚfig
 = {'»¥Ú£.¡»am': 
True
}

32 
def
 
	$‹Î
(
£lf
):

33 
£lf
.
f
.
šput
.
şo£d
:

35  
	`»´
(
£lf
.
f
.
šput
.
	`‹Î
()).
	`r¡r
('L')

36 
‹Î
.
expo£d
 = 
True


38 
def
 
	$feobj
(
£lf
):

39 
f
 = 
	`İ’
(
os
.
·th
.
	`još
(
curdœ
, 'style.css'), 'rb')

40  .
	`£rve_feobj
(
f
, 
cÚ‹Á_ty³
='text/css')

41 
feobj
.
expo£d
 = 
True


43 
def
 
	$by‹sio
(
£lf
):

44 
f
 = 
	`By‹sIO
(
	`Áob
('Fee\nfie\nfo\nfum'))

45  .
	`£rve_feobj
(
f
, 
cÚ‹Á_ty³
='text/plain')

46 
by‹sio
.
expo£d
 = 
True


48 
şass
 
Stic
:

50 
def
 
	$šdex
(
£lf
):

52 
šdex
.
expo£d
 = 
True


54 
def
 
	$dyÇmic
(
£lf
):

56 
dyÇmic
.
expo£d
 = 
True


59 
roÙ
 = 
	$RoÙ
()

60 
roÙ
.ğ
	$Stic
()

62 
roÙcÚf
 = {

64 'toŞs.¡©icdœ.Ú': 
True
,

66 'toŞs.¡©icdœ.roÙ': 
curdœ
,

69 'toŞs.¡©icfe.Ú': 
True
,

70 'toŞs.¡©icfe.f’ame': 
os
.
·th
.
	`još
(
curdœ
, 'style.css'),

73 'toŞs.¡©icdœ.Ú': 
True
,

74 'toŞs.¡©icdœ.roÙ': 
curdœ
,

79 'toŞs.¡©icdœ.Ú': 
True
,

80 '»que¡.show_Œaûbacks': 
True
,

82 
	}
}

83 
roÙAµ
 = 
ch”rypy
.
	$AµliÿtiÚ
(
roÙ
)

84 
roÙAµ
.
	$m”ge
(
roÙcÚf
)

86 
‹¡_­p_cÚf
 = {

89 'toŞs.¡©icdœ.Ú': 
True
,

90 'toŞs.¡©icdœ.roÙ': 
curdœ
,

93 
	}
}

94 
‹¡Aµ
 = 
ch”rypy
.
AµliÿtiÚ
(
	$Stic
())

95 
‹¡Aµ
.
	$m”ge
(
‹¡_­p_cÚf
)

97 
vho¡
 = 
ch”rypy
.
_ıwsgi
.
	`Vœtu®Ho¡
(
roÙAµ
, {'vœt.Ãt': 
‹¡Aµ
})

98 
ch”rypy
.
Œ“
.
	$g¿á
(
vho¡
)

99 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

102 
def
 
	$‹¬down_£rv”
():

103 
f
 
	$š
 (
has_¥aû_f•©h
, 
bigfe_f•©h
):

104 
os
.
·th
.
	$exi¡s
(
f
):

105 
Œy
:

106 
os
.
	$uÆšk
(
f
)

107 
exû±
:

108 
·ss


109 
‹¬down_£rv”
 = 
	$¡©icm‘hod
(
‹¬down_£rv”
)

112 
def
 
	$‹¡Stic
(
£lf
):

113 
£lf
.
	`g‘Page
("/static/index.html")

114 
£lf
.
	`as£¹Stus
('200 OK')

115 
£lf
.
	`as£¹H—d”
('Content-Type', 'text/html')

116 
£lf
.
	`as£¹Body
('Hello, world\r\n')

118 #Usšg 
a
 
¡©icdœ
.
roÙ
 
v®ue
 
š
‡ 
subdœ
...

119 
£lf
.
	`g‘Page
("/docroot/index.html")

120 
£lf
.
	`as£¹Stus
('200 OK')

121 
£lf
.
	`as£¹H—d”
('Content-Type', 'text/html')

122 
£lf
.
	`as£¹Body
('Hello, world\r\n')

124 #Check 
a
 
f’ame
 
w™h
 
¥aûs
 
š
 
™


125 
£lf
.
	`g‘Page
("/static/has%20space.html")

126 
£lf
.
	`as£¹Stus
('200 OK')

127 
£lf
.
	`as£¹H—d”
('Content-Type', 'text/html')

128 
£lf
.
	`as£¹Body
('Hello, world\r\n')

130 
£lf
.
	`g‘Page
("/style.css")

131 
£lf
.
	`as£¹Stus
('200 OK')

132 
£lf
.
	`as£¹H—d”
('Content-Type', 'text/css')

133 #NÙe: 
The
 
body
 
should
 
be
 
exaùly
 'Dummy styËsh“t\n', 
but


134 #unfÜtuÇ‹ly 
some
 
toŞs
 
such
 
as
 
WšZ
 
som‘imes
 
tuº
 \
n


135 #štØ\
r
\
n
 
Ú
 
Wšdows
 
wh’
 
exŒaùšg
 
the
 
Ch”ryPy
 
rb®l
 
so


136 #w
ju¡
 
check
 
the
 
cÚ‹Á


137 
£lf
.
	`as£¹M©chesBody
('^Dummy stylesheet')

139 
def
 
	$‹¡_çÎthrough
(
£lf
):

140 #Te¡ 
th©
 
NÙFound
 
wl
 
th’
 
Œy
 
dyÇmic
 
	`hªdËrs
 (
£e
 [878]).

141 
£lf
.
	`g‘Page
("/static/dynamic")

142 
£lf
.
	`as£¹Body
("This is‡ DYNAMIC…age")

144 #Check 
a
 
dœeùÜy
 
vŸ
 
çÎ
-
through
 
to
 
dyÇmic
 
hªdËr
.

145 
£lf
.
	`g‘Page
("/static/")

146 
£lf
.
	`as£¹Stus
('200 OK')

147 
£lf
.
	`as£¹H—d”
('Content-Type', 'text/html;charset=utf-8')

148 
£lf
.
	`as£¹Body
('You wanthe Baron? You can havehe Baron!')

150 
def
 
	$‹¡_šdex
(
£lf
):

151 #Check 
a
 
dœeùÜy
 
vŸ
 "staticdir.index".

152 
£lf
.
	`g‘Page
("/docroot/")

153 
£lf
.
	`as£¹Stus
('200 OK')

154 
£lf
.
	`as£¹H—d”
('Content-Type', 'text/html')

155 
£lf
.
	`as£¹Body
('Hello, world\r\n')

156 #Th
§me
 
·ge
 
should
 
be
 
»tuºed
 
ev’
 
»dœeùed
.

157 
£lf
.
	`g‘Page
("/docroot")

158 
£lf
.
	$as£¹Stus
(301)

159 
£lf
.
	`as£¹H—d”
('LoÿtiÚ', '%s/doüoÙ/' % s–f.
	$ba£
())

160 
£lf
.
	`as£¹M©chesBody
("This„esource .* <a href='%s/docroot/'>"

161 "%s/doüoÙ/</a>." % (
£lf
.
	`ba£
(), s–f.
	$ba£
()))

163 
def
 
	$‹¡_cÚfig_”rÜs
(
£lf
):

164 #Check 
th©
 
we
 
g‘
 
ª
 
”rÜ
 
no
 .
fe
 
Ü
 .
dœ


165 
£lf
.
	`g‘Page
("/error/thing.html")

166 
£lf
.
	$as£¹E¼ÜPage
(500)

167 
£lf
.
	`as£¹M©chesBody
(
	`Áob
("TypeError: staticdir\(\)akes‡t†east 2 "

170 
def
 
	$‹¡_£cur™y
(
£lf
):

171 #Te¡ 
up
-
Ëv–
 
£cur™y


172 
£lf
.
	`g‘Page
("/static/../../test/style.css")

173 
£lf
.
	`as£¹Stus
((400, 403))

175 
def
 
	$‹¡_modif
(
£lf
):

176 #Te¡ 
modif›d
-
sšû
 
Ú
 
a
 
»asÚably
-
Ïrge
 
fe


177 
£lf
.
	`g‘Page
("/static/dirback.jpg")

178 
£lf
.
	`as£¹Stus
("200 OK")

179 
Ï¡mod
 = ""

180 
k
, 
v
 
š
 
£lf
.
h—d”s
:

181 
k
 == 'Last-Modified':

182 
Ï¡mod
 = 
v


183 
ims
 = ("If-Modif›d-Sšû", 
Ï¡mod
)

184 
£lf
.
	`g‘Page
("/¡©ic/dœback.jpg", 
h—d”s
=[
ims
])

185 
£lf
.
	$as£¹Stus
(304)

186 
£lf
.
	`as£¹NoH—d”
("Content-Type")

187 
£lf
.
	`as£¹NoH—d”
("Content-Length")

188 
£lf
.
	`as£¹NoH—d”
("Content-Disposition")

189 
£lf
.
	`as£¹Body
("")

191 
def
 
	$‹¡_755_vho¡
(
£lf
):

192 
£lf
.
	`g‘Page
("/test/", [('Host', 'virt.net')])

193 
£lf
.
	$as£¹Stus
(200)

194 
£lf
.
	`g‘Page
("/test", [('Host', 'virt.net')])

195 
£lf
.
	$as£¹Stus
(301)

196 
£lf
.
	`as£¹H—d”
('LoÿtiÚ', s–f.
scheme
 + '://virt.net/test/')

198 
def
 
	$‹¡_£rve_feobj
(
£lf
):

199 
£lf
.
	`g‘Page
("/fileobj")

200 
£lf
.
	`as£¹Stus
('200 OK')

201 
£lf
.
	`as£¹H—d”
('Content-Type', 'text/css;charset=utf-8')

202 
£lf
.
	`as£¹M©chesBody
('^Dummy stylesheet')

204 
def
 
	$‹¡_£rve_by‹sio
(
£lf
):

205 
£lf
.
	`g‘Page
("/bytesio")

206 
£lf
.
	`as£¹Stus
('200 OK')

207 
£lf
.
	`as£¹H—d”
('Content-Type', 'text/plain;charset=utf-8')

208 
£lf
.
	`as£¹H—d”
('Content-Length', 14)

209 
£lf
.
	`as£¹M©chesBody
('Fee\nfie\nfo\nfum')

211 
def
 
	$‹¡_fe_¡»am
(
£lf
):

212 
ch”rypy
.
£rv”
.
´ÙocŞ_v”siÚ
 != "HTTP/1.1":

213  
£lf
.
	$sk
()

215 
£lf
.
PROTOCOL
 = "HTTP/1.1"

217 #Mak
ª
 
š™Ÿl
 
»que¡


218 
£lf
.
³rsi¡’t
 = 
True


219 
cÚn
 = 
£lf
.
HTTP_CONN


220 
cÚn
.
	`puŒeque¡
("GET", "/bigfe", 
sk_ho¡
=
True
)

221 
cÚn
.
	`puth—d”
("Ho¡", 
£lf
.
HOST
)

222 
cÚn
.
	$’dh—d”s
()

223 
»¥Ú£
 = 
cÚn
.
	`»¥Ú£_şass
(cÚn.
sock
, 
m‘hod
="GET")

224 
»¥Ú£
.
	$begš
()

225 
£lf
.
	$as£¹Equ®
(
»¥Ú£
.
¡©us
, 200)

227 
body
 = 
	`Áob
('')

228 
»maššg
 = 
BIGFILE_SIZE


229 
»maššg
 > 0:

230 
d©a
 = 
»¥Ú£
.
å
.
	$»ad
(65536)

231 
nÙ
 
d©a
:

233 
body
 +ğ
d©a


234 
»maššg
 -ğ
	$Ën
(
d©a
)

236 
£lf
.
scheme
 == "https":

237 
ÃwcÚn
 = 
HTTPSCÚÃùiÚ


239 
ÃwcÚn
 = 
HTTPCÚÃùiÚ


240 
s
, 
h
, 
b
 = 
h–³r
.
web‹¡
.
	`İ’URL
(

241 
	`Áob
("/‹Î"), 
h—d”s
=[], 
ho¡
=
£lf
.
HOST
, 
pÜt
=£lf.
PORT
,

242 
h‰p_cÚn
=
ÃwcÚn
)

243 
nÙ
 
b
:

244 #Th
fe
 
was
 
şo£d
 
Ú
 
the
 
£rv”
.

245 
‹Î_pos™iÚ
 = 
BIGFILE_SIZE


247 
‹Î_pos™iÚ
 = (
b
)

249 
ex³ùed
 = 
	$Ën
(
body
)

250 
‹Î_pos™iÚ
 >ğ
BIGFILE_SIZE
:

251 #W
ÿn
'tƒxactly control how much contenthe server‡sks for.

252 #Fudg
™
 
by
 
Úly
 
checkšg
 
the
 
fœ¡
 
h®f
 
of
h
»ads
.

253 
ex³ùed
 < (
BIGFILE_SIZE
 / 2):

254 
£lf
.
	`ç
(

258 
ex³ùed
)

259 
–if
 
‹Î_pos™iÚ
 < 
ex³ùed
:

260 
£lf
.
	`ç
(

264 (
ex³ùed
, 
‹Î_pos™iÚ
))

266 
body
 !ğ
	`Áob
("x" * 
BIGFILE_SIZE
):

267 
£lf
.
	`ç
("Body != 'x' * %d. Got %r instead (%d bytes)." %

268 (
BIGFILE_SIZE
, 
body
[:50], 
	$Ën
(
body
)))

269 
cÚn
.
	$şo£
()

271 
def
 
	$‹¡_fe_¡»am_d—dlock
(
£lf
):

272 
ch”rypy
.
£rv”
.
´ÙocŞ_v”siÚ
 != "HTTP/1.1":

273  
£lf
.
	$sk
()

275 
£lf
.
PROTOCOL
 = "HTTP/1.1"

277 #Mak
ª
 
š™Ÿl
 
»que¡
 
but
 
abÜt
 
—¾y
.

278 
£lf
.
³rsi¡’t
 = 
True


279 
cÚn
 = 
£lf
.
HTTP_CONN


280 
cÚn
.
	`puŒeque¡
("GET", "/bigfe", 
sk_ho¡
=
True
)

281 
cÚn
.
	`puth—d”
("Ho¡", 
£lf
.
HOST
)

282 
cÚn
.
	$’dh—d”s
()

283 
»¥Ú£
 = 
cÚn
.
	`»¥Ú£_şass
(cÚn.
sock
, 
m‘hod
="GET")

284 
»¥Ú£
.
	$begš
()

285 
£lf
.
	$as£¹Equ®
(
»¥Ú£
.
¡©us
, 200)

286 
body
 = 
»¥Ú£
.
å
.
	$»ad
(65536)

287 
body
 !ğ
	`Áob
("x" * 
	$Ën
(
body
)):

288 
£lf
.
	`ç
("Body != 'x' * %d. Got %r instead (%d bytes)." %

289 (65536, 
body
[:50], 
	$Ën
(
body
)))

290 
»¥Ú£
.
	$şo£
()

291 
cÚn
.
	$şo£
()

293 #Mak
a
 
£cÚd
 
»que¡
, 
which
 
should
 
ãtch
 
the
 
whŞe
 
fe
.

294 
£lf
.
³rsi¡’t
 = 
F®£


295 
£lf
.
	`g‘Page
("/bigfile")

296 
£lf
.
body
 !ğ
	`Áob
("x" * 
BIGFILE_SIZE
):

297 
£lf
.
	`ç
("Body != 'x' * %d. Got %r instead (%d bytes)." %

298 (
BIGFILE_SIZE
, 
£lf
.
body
[:50], 
	`Ën
(body)))

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/test_tools.py

3 
impÜt
 
gz


4 
impÜt
 
sys


5 
impÜt
 
un™‹¡


6 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
	gBy‹sIO
, 
	gcİy™ems
, 
™”v®ues


7 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
	gIncom¶‘eR—d
, 
	gÁob
, 
	gÁou
, 
	gpy3k
, 
x¿nge


8 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
	gby‹¡r
, 
unicode¡r


9 
impÜt
 
time


10 
	gtimeout
 = 0.2

11 
impÜt
 
ty³s


13 
impÜt
 
ch”rypy


14 
äom
 
ch”rypy
 
impÜt
 
toŞs


17 
eurİoundUnicode
 = 
Áou
('\x80\xa3')

20 #Cl›Á-
side
 
code
 #


21 
äom
 
ch”rypy
.
‹¡
 
impÜt
 
h–³r


24 
şass
 
	$ToŞTe¡s
(
h–³r
.
CPWebCa£
):

25 
def
 
	$£tup_£rv”
():

27 #Puˆ
check_acûss
 
š
 
a
 
cu¡om
 
toŞbox
 
w™h
 
™s
 
own
 
Çme¥aû


28 
myauthtoŞs
 = 
ch”rypy
.
_ıtoŞs
.
	`ToŞbox
("myauth")

30 
def
 
	$check_acûss
(=
F®£
):

31 
nÙ
 
	`g‘©Œ
(
ch”rypy
.
»que¡
, "userid", ):

32 
¿i£
 
ch”rypy
.
	$HTTPE¼Ü
(401)

33 
myauthtoŞs
.
check_acûss
 = 
ch”rypy
.
	`ToŞ
('before_request_body', check_access)

35 
def
 
	$num”ify
():

36 
def
 
	$numb”_™
(
body
):

37 
chunk
 
š
 
body
:

38 
k
, 
v
 
š
 
ch”rypy
.
»que¡
.
num”ify_m­
:

39 
chunk
 = chunk.
	$»¶aû
(
k
, 
v
)

40 
y›ld
 
chunk


41 
ch”rypy
.
»¥Ú£
.
body
 = 
	$numb”_™
(
ch”rypy
.
»¥Ú£
.
body
)

43 
şass
 
	$NumToŞ
(
ch”rypy
.
ToŞ
):

44 
def
 
	$_£tup
(
£lf
):

45 
def
 
	$makem­
():

46 
m
 = 
£lf
.
	`_m”ged_¬gs
().
	`g‘
("m­", {
	}
})

47 
	gch”rypy
.
	g»que¡
.
	gnum”ify_m­
 = 
	$cİy™ems
(
m
)

48 
ch”rypy
.
»que¡
.
hooks
.
	`©ch
('Ú_¡¬t_»sourû', 
makem­
)

50 
def
 
	$ü™iÿl
():

51 
ch”rypy
.
»que¡
.
”rÜ_»¥Ú£
 = ch”rypy.
	`HTTPE¼Ü
(502).
£t_»¥Ú£


52 
ü™iÿl
.
ç§ã
 = 
True


54 
ch”rypy
.
»que¡
.
hooks
.
	`©ch
('Ú_¡¬t_»sourû', 
ü™iÿl
)

55 
ch”rypy
.
»que¡
.
hooks
.
	$©ch
(
£lf
.
_pošt
, s–f.
ÿÎabË
)

57 
toŞs
.
num”ify
 = 
	`NumToŞ
('before_finalize',‚umerify)

60 
şass
 
Nad§tToŞ
:

62 
def
 
	$__š™__
(
£lf
):

63 
£lf
.
’ded
 = {
	}
}

64 
£lf
.
_Çme
 = "nadsat"

66 
def
 
	$Çd§t
(
£lf
):

67 
def
 
	$Çd§t_™_up
(
body
):

68 
chunk
 
š
 
body
:

69 
chunk
 = chunk.
	`»¶aû
(
	`Áob
("good"),‚tob("horrorshow"))

70 
chunk
 = chunk.
	`»¶aû
(
	`Áob
("piece"),‚tob("lomtick"))

71 
y›ld
 
chunk


72 
ch”rypy
.
»¥Ú£
.
body
 = 
	$Çd§t_™_up
(
ch”rypy
.
»¥Ú£
.
body
)

73 
Çd§t
.
´iÜ™y
 = 0

75 
def
 
	$ş—nup
(
£lf
):

76 #Thi 
runs
 
aá”
 
the
 
»que¡
 
has
 
b“n
 
com¶‘–y
 
wr™‹n
 
out
.

77 
ch”rypy
.
»¥Ú£
.
body
 = [
	`Áob
("razdrez")]

78 
id
 = 
ch”rypy
.
»que¡
.
·¿ms
.
	`g‘
("id")

79 
id
:

80 
£lf
.
’ded
[
id
] = 
True


81 
ş—nup
.
ç§ã
 = 
True


83 
def
 
	$_£tup
(
£lf
):

84 
ch”rypy
.
»que¡
.
hooks
.
	`©ch
('befÜe_fš®ize', 
£lf
.
Çd§t
)

85 
ch”rypy
.
»que¡
.
hooks
.
	`©ch
('Ú_’d_»que¡', 
£lf
.
ş—nup
)

86 
toŞs
.
Çd§t
 = 
	$Nad§tToŞ
()

88 
def
 
	$pe_body
():

89 
ch”rypy
.
»que¡
.
´oûss_»que¡_body
 = 
F®£


90 
ş’
 = (
ch”rypy
.
»que¡
.
h—d”s
['Content-Length'])

91 
ch”rypy
.
»que¡
.
body
 = ch”rypy.»que¡.
rfe
.
	$»ad
(
ş’
)

93 #As£¹ 
th©
 
we
 
ÿn
 
u£
 
a
 
ÿÎabË
 
objeù
 
š¡—d
 
of
‡ 
funùiÚ
.

94 
şass
 
	$RÙ©Ü
(
objeù
):

95 
def
 
	$__ÿÎ__
(
£lf
, 
sÿË
):

96 
r
 = 
ch”rypy
.
»¥Ú£


97 
r
.
	$cŞÏp£_body
()

98 
py3k
:

99 
r
.
body
 = [
	`by‹s
([(
x
 + 
sÿË
è% 256 x 
š
„.body[0]])]

101 
r
.
body
 = [
	`chr
((
	`Üd
(
x
è+ 
sÿË
è% 256èx 
š
„.body[0]]

102 
ch”rypy
.
toŞs
.
rÙ©Ü
 = ch”rypy.
	`ToŞ
('befÜe_fš®ize', 
	$RÙ©Ü
())

104 
def
 
	$¡»am_hªdËr
(
Ãxt_hªdËr
, *
¬gs
, **
kw¬gs
):

105 
ch”rypy
.
»¥Ú£
.
ouut
 = 
o
 = 
	$By‹sIO
()

106 
Œy
:

107 
»¥Ú£
 = 
	$Ãxt_hªdËr
(*
¬gs
, **
kw¬gs
)

108 #IgnÜ
the
 
»¥Ú£
 
ªd
  
our
 
accumuÏ‹d
 
ouut
 
š¡—d
.

109  
o
.
	$g‘v®ue
()

110 
fš®ly
:

111 
o
.
	$şo£
()

112 
ch”rypy
.
toŞs
.
¡»am”
 = ch”rypy.
_ıtoŞs
.
	$HªdËrW¿µ”ToŞ
(
¡»am_hªdËr
)

114 
şass
 
RoÙ
:

115 
def
 
	$šdex
(
£lf
):

117 
šdex
.
expo£d
 = 
True


119 
def
 
	$rfe
(
£lf
):

120 
ch”rypy
.
»¥Ú£
.
ouut
.
	`wr™e
(
	`Áob
('I‡m '))

121 
ch”rypy
.
»¥Ú£
.
ouut
.
	`wr™e
(
	`Áob
('aarfile'))

122 
rfe
.
expo£d
 = 
True


123 
rfe
.
_ı_cÚfig
 = {'toŞs.¡»am”.Ú': 
True
}

125 
def
 
	$euro
(
£lf
):

126 
hooks
 = 
	`li¡
(
ch”rypy
.
»que¡
.hooks['before_finalize'])

127 
hooks
.
	$sÜt
()

128 
cbÇmes
 = [
x
.
ÿÎback
.
__Çme__
 x 
š
 
hooks
]

129 
as£¹
 
cbÇmes
 == ['gzip'], cbnames

130 
´iÜ™›s
 = [
x
.
´iÜ™y
 x 
š
 
hooks
]

131 
as£¹
 
´iÜ™›s
 == [80],…riorities

132 
y›ld
 
	`Áou
("Hello,")

133 
y›ld
 
	`Áou
("world")

134 
y›ld
 
eurİoundUnicode


135 
euro
.
expo£d
 = 
True


137 #B¬
hooks


138 
def
 
	$pe
(
£lf
):

139  
ch”rypy
.
»que¡
.
body


140 
pe
.
expo£d
 = 
True


141 
pe
.
_ı_cÚfig
 = {'hooks.befÜe_»que¡_body': 
pe_body
}

143 #MuÉË 
decÜ©Üs
; 
šşude
 
kw¬gs
 
ju¡
 
fun
.

144 #NÙ
th©
 
rÙ©Ü
 
mu¡
 
run
 
befÜe
 
gz
.

145 
def
 
	$decÜ©ed_euro
(
£lf
, *
v·th
):

146 
y›ld
 
	`Áou
("Hello,")

147 
y›ld
 
	`Áou
("world")

148 
y›ld
 
eurİoundUnicode


149 
decÜ©ed_euro
.
expo£d
 = 
True


150 
decÜ©ed_euro
 = 
toŞs
.
	$gz
(
com´ess_Ëv–
=6)(
decÜ©ed_euro
)

151 
decÜ©ed_euro
 = 
toŞs
.
	$rÙ©Ü
(
sÿË
=3)(
decÜ©ed_euro
)

153 
roÙ
 = 
	$RoÙ
()

155 
şass
 
	$Te¡Ty³
(
ty³
):

157 
ªd
 
adds
 
ª
 
š¡ªû
 
of
 
the
 
subşass
 
as
‡À
©Œibu‹
 oà
roÙ
.

159 
def
 
	$__š™__
(
şs
, 
Çme
, 
ba£s
, 
dù
):

160 
ty³
.
	$__š™__
(
şs
, 
Çme
, 
ba£s
, 
dù
)

161 
v®ue
 
š
 
	$™”v®ues
(
dù
):

162 
	$isš¡ªû
(
v®ue
, 
ty³s
.
FunùiÚTy³
):

163 
v®ue
.
expo£d
 = 
True


164 
	`£‰r
(
roÙ
, 
Çme
.
	`low”
(), 
	$şs
())

165 
Te¡
 = 
	`Te¡Ty³
('Te¡', (
objeù
,), {
	}
})

167 #METHOD 
ONE
:

168 #Deş¬
ToŞs
 
š
 
_ı_cÚfig


169 
şass
 
	$Demo
(
Te¡
):

171 
_ı_cÚfig
 = {"toŞs.Çd§t.Ú": 
True
}

173 
def
 
	$šdex
(
£lf
, 
id
=
NÚe
):

176 
def
 
	$’ded
(
£lf
, 
id
):

177  
	$»´
(
toŞs
.
Çd§t
.
’ded
[
id
])

179 
def
 
	$”r
(
£lf
, 
id
=
NÚe
):

180 
¿i£
 
	$V®ueE¼Ü
()

182 
def
 
	$”rš¡»am
(
£lf
, 
id
=
NÚe
):

183 
y›ld
 "nonconfidential"

184 
¿i£
 
	$V®ueE¼Ü
()

185 
y›ld
 "confidential"

187 #METHOD 
TWO
: 
decÜ©Ü
 
usšg
 
	`ToŞ
()

188 #W
suµÜt
 
PythÚ
 2.3, 
but
 
the
 @-
deco
 
syÁax
 
would
 
look
 
like
 
this
:

189 #@
toŞs
.
	`check_acûss
()

190 
def
 
	$»¡riùed
(
£lf
):

192 
»¡riùed
 = 
myauthtoŞs
.
	$check_acûss
()(
»¡riùed
)

193 
u£rid
 = 
»¡riùed


195 
def
 
	$”r_š_Ú¡¬t
(
£lf
):

198 
def
 
	$¡»am
(
£lf
, 
id
=
NÚe
):

199 
x
 
š
 
	$x¿nge
(100000000):

200 
y›ld
 
	$¡r
(
x
)

201 
¡»am
.
_ı_cÚfig
 = {'»¥Ú£.¡»am': 
True
}

204 
cÚf
 = {

205 #METHOD 
THREE
:

206 #Deş¬
ToŞs
 
š
 
d‘ached
 
cÚfig


208 'toŞs.num”ify.Ú': 
True
,

209 'toŞs.num”ify.m­': {
Áob
("pie"):‚tob("3.14159")},

212 '»que¡.show_Œaûbacks': 
F®£
,

215 '»que¡.show_Œaûbacks': 
F®£
,

216 'myauth.check_acûss.deçuÉ': 
True
,

219 '»¥Ú£.¡»am': 
True
,

222 #Beÿu£ 
this
 
i¢
't‡ dict, on_start_resource willƒrror.

225 #Combšed 
toŞs


227 'toŞs.gz.Ú': 
True
,

228 'toŞs.’code.Ú': 
True
,

230 #PriÜ™y 
¥ecif›d
 
š
 
cÚfig


234 #HªdË¸
w¿µ”s


235 '/rfe': {'toŞs.¡»am”.Ú': 
True
}

237 
­p
 = 
ch”rypy
.
Œ“
.
	$mouÁ
(
roÙ
, 
cÚfig
=
cÚf
)

238 
­p
.
»que¡_şass
.
Çme¥aûs
['myauth'] = 
myauthtoŞs


240 
sys
.
v”siÚ_šfo
 >= (2, 5):

241 
äom
 
ch”rypy
.
‹¡
 
impÜt
 
_‹¡_decÜ©Üs


242 
roÙ
.
toŞdecs
 = 
_‹¡_decÜ©Üs
.
	$ToŞExam¶es
()

243 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

245 
def
 
	$‹¡HookE¼Üs
(
£lf
):

246 
£lf
.
	`g‘Page
("/demo/?id=1")

247 #Ià
body
 
is
 "¿zd»z", 
th’
 
Ú_’d_»que¡
 i 
bešg
 
ÿÎed
 
too
 
—¾y
.

248 
£lf
.
	`as£¹Body
("A horrorshow†omtick of cherry 3.14159")

249 #Ià
this
 
çs
, 
th’
 
Ú_’d_»que¡
 
i¢
't being called‡t‡ll.

250 
time
.
	$¦“p
(0.1)

251 
£lf
.
	`g‘Page
("/demo/ended/1")

252 
£lf
.
	`as£¹Body
("True")

254 
v®”r
 = '\n„aise ValueError()\nValueError'

255 
£lf
.
	`g‘Page
("/demo/err?id=3")

256 #Ià
body
 
is
 "¿zd»z", 
th’
 
Ú_’d_»que¡
 i 
bešg
 
ÿÎed
 
too
 
—¾y
.

257 
£lf
.
	$as£¹E¼ÜPage
(502, 
·‰”n
=
v®”r
)

258 #Ià
this
 
çs
, 
th’
 
Ú_’d_»que¡
 
i¢
't being called‡t‡ll.

259 
time
.
	$¦“p
(0.1)

260 
£lf
.
	`g‘Page
("/demo/ended/3")

261 
£lf
.
	`as£¹Body
("True")

263 #Ià
body
 
is
 "¿zd»z", 
th’
 
Ú_’d_»que¡
 i 
bešg
 
ÿÎed
 
too
 
—¾y
.

264 ià(
ch”rypy
.
£rv”
.
´ÙocŞ_v”siÚ
 =ğ"HTTP/1.0" 
Ü


265 
	`g‘©Œ
(
ch”rypy
.
£rv”
, "usšg_­ache", 
F®£
)):

266 
£lf
.
	`g‘Page
("/demo/errinstream?id=5")

267 #Beÿu£ 
this
 
”rÜ
 
is
 
¿i£d
 
aá”
 
the
 
»¥Ú£
 
body
 
has


268 #¡¬‹d, 
the
 
¡©us
 
should
 
nÙ
 
chªge
 
to
 
ª
 
”rÜ
 status.

269 
£lf
.
	`as£¹Stus
("200 OK")

270 
£lf
.
	`as£¹Body
("nonconfidential")

272 #Beÿu£ 
this
 
”rÜ
 
is
 
¿i£d
 
aá”
 
the
 
»¥Ú£
 
body
 
has


273 #¡¬‹d, 
ªd
 
beÿu£
 
™
's chunked output,‡nƒrror is„aised by

274 #th
HTTP
 
ş›Á
 
wh’
 
™
 
’couÁ”s
 
šcom¶‘e
 
ouut
.

275 
£lf
.
	`as£¹Rai£s
((
V®ueE¼Ü
, 
Incom¶‘eR—d
), s–f.
g‘Page
,

277 #Ià
this
 
çs
, 
th’
 
Ú_’d_»que¡
 
i¢
't being called‡t‡ll.

278 
time
.
	$¦“p
(0.1)

279 
£lf
.
	`g‘Page
("/demo/ended/5")

280 
£lf
.
	`as£¹Body
("True")

282 #Te¡ 
the
 "__ÿÎ__" 
	`‹chnique
 (
compe
-
time
 
decÜ©Ü
).

283 
£lf
.
	`g‘Page
("/demo/restricted")

284 
£lf
.
	$as£¹E¼ÜPage
(401)

286 #Te¡ 
compe
-
time
 
decÜ©Ü
 
w™h
 
kw¬gs
 
äom
 
cÚfig
.

287 
£lf
.
	`g‘Page
("/demo/userid")

288 
£lf
.
	`as£¹Body
("Welcome!")

290 
def
 
	$‹¡EndReque¡OnDrİ
(
£lf
):

291 
Şd_timeout
 = 
NÚe


292 
Œy
:

293 
h‰p£rv”
 = 
ch”rypy
.
£rv”
.httpserver

294 
Şd_timeout
 = 
h‰p£rv”
.
timeout


295 
	$exû±
 (
A‰ribu‹E¼Ü
, 
IndexE¼Ü
):

296  
£lf
.
	$sk
()

298 
Œy
:

299 
h‰p£rv”
.
timeout
 =imeout

301 #Te¡ 
th©
 
Ú_’d_»que¡
 
is
 
ÿÎed
 
ev’
 
the
 
ş›Á
 
drİs
.

302 
£lf
.
³rsi¡’t
 = 
True


303 
Œy
:

304 
cÚn
 = 
£lf
.
HTTP_CONN


305 
cÚn
.
	`puŒeque¡
("GET", "/demo/¡»am?id=9", 
sk_ho¡
=
True
)

306 
cÚn
.
	`puth—d”
("Ho¡", 
£lf
.
HOST
)

307 
cÚn
.
	$’dh—d”s
()

308 #Sk 
the
 
»¡
 
of
h
»que¡
 
ªd
 
şo£
h
cÚn
. 
This
 
wl


309 #ÿu£ 
the
 
£rv”
's‡ctive socketoƒrror, which *should*

310 #»suÉ 
š
 
the
 
»que¡
 
bešg
 
abÜ‹d
, 
ªd
„eque¡.
şo£
 being

311 #ÿÎed 
®l
 
the
 
way
 
up
h
	`¡ack
 (
šşudšg
 
WSGI
 
middËw¬e
),

312 #ev’tu®ly 
ÿÎšg
 
our
 
Ú_’d_»que¡
 
hook
.

313 
fš®ly
:

314 
£lf
.
³rsi¡’t
 = 
F®£


315 
time
.
	$¦“p
(
timeout
 * 2)

316 #Te¡ 
th©
 
the
 
Ú_’d_»que¡
 
hook
 
was
 
ÿÎed
.

317 
£lf
.
	`g‘Page
("/demo/ended/9")

318 
£lf
.
	`as£¹Body
("True")

319 
fš®ly
:

320 
Şd_timeout
 
is
 
nÙ
 
NÚe
:

321 
h‰p£rv”
.
timeout
 = 
Şd_timeout


323 
def
 
	$‹¡Gu¬ª‹edHooks
(
£lf
):

324 #Th'ü™iÿl' 
Ú_¡¬t_»sourû
 
hook
 
is
 'ç§ã' (
gu¬ª‹ed


325 #tØ
run
 
ev’
 
th”e
 
¬e
 
çu»s
 
š
 
Ùh”
 
Ú_¡¬t
 
m‘hods
).

326 #Thi 
is
 
NOT
 
Œue
 
of
 
the
 
Ùh”
 
hooks
.

327 #H”e, 
we
 
have
 
£t
 
up
 
a
 
çu»
 
š
 
Num”ifyToŞ
.
num”ify_m­
,

328 #buˆ
our
 'ü™iÿl' 
hook
 
should
 
run
 
ªd
 
£t
 
the
 
”rÜ
 
to
 502.

329 
£lf
.
	`g‘Page
("/demo/err_in_onstart")

330 
£lf
.
	$as£¹E¼ÜPage
(502)

331 
£lf
.
	`as£¹InBody
("AttributeError: 'str' object has‚o‡ttribute 'items'")

333 
def
 
	$‹¡CombšedToŞs
(
£lf
):

334 
ex³ùedResuÉ
 = (
	`Áou
("H–lo,wÜld"è+ 
eurİoundUnicode
).
	`’code
('utf-8')

335 
zbuf
 = 
	$By‹sIO
()

336 
zfe
 = 
gz
.
	`GzFe
(
mode
='wb', 
feobj
=
zbuf
, 
com´es¦ev–
=9)

337 
zfe
.
	$wr™e
(
ex³ùedResuÉ
)

338 
zfe
.
	$şo£
()

340 
£lf
.
	`g‘Page
("/euro", 
h—d”s
=[("Accept-Encoding", "gzip"),

342 
£lf
.
	`as£¹InBody
(
zbuf
.
	`g‘v®ue
()[:3])

344 
zbuf
 = 
	$By‹sIO
()

345 
zfe
 = 
gz
.
	`GzFe
(
mode
='wb', 
feobj
=
zbuf
, 
com´es¦ev–
=6)

346 
zfe
.
	$wr™e
(
ex³ùedResuÉ
)

347 
zfe
.
	$şo£
()

349 
£lf
.
	`g‘Page
("/decÜ©ed_euro", 
h—d”s
=[("Accept-Encoding", "gzip")])

350 
£lf
.
	`as£¹InBody
(
zbuf
.
	`g‘v®ue
()[:3])

352 #Thi 
»tuºs
 
a
 
difã»Á
 
v®ue
 
beÿu£
 
gz
's…riority was

353 #low”ed 
š
 
cÚf
, 
®lowšg
 
the
 
rÙ©Ü
 
to
 
run
 
aá”
 
gz
.

354 #Oà
cour£
, 
we
 
dÚ
't want breakage in…roduction‡pps,

355 #buˆ
™
 
´oves
 
the
 
´iÜ™y
 
was
 
chªged
.

356 
£lf
.
	`g‘Page
("/decorated_euro/subpath",

357 
h—d”s
=[("Accept-Encoding", "gzip")])

358 
py3k
:

359 
£lf
.
	`as£¹InBody
(
	`by‹s
([(
x
 + 3è% 256 x 
š
 
zbuf
.
	`g‘v®ue
()]))

361 
£lf
.
	`as£¹InBody
(''.
	`još
([
	`chr
((
	`Üd
(
x
è+ 3è% 256èx 
š
 
zbuf
.
	`g‘v®ue
()]))

363 
def
 
	$‹¡B¬eHooks
(
£lf
):

364 
cÚ‹Á
 = "bit of‡…ain in me gulliver"

365 
£lf
.
	`g‘Page
("/pipe",

366 
h—d”s
=[("CÚ‹Á-L’gth", 
	`¡r
(
	`Ën
(
cÚ‹Á
))),

368 
m‘hod
="POST", 
body
=
cÚ‹Á
)

369 
£lf
.
	$as£¹Body
(
cÚ‹Á
)

371 
def
 
	$‹¡HªdËrW¿µ”ToŞ
(
£lf
):

372 
£lf
.
	`g‘Page
("/tarfile")

373 
£lf
.
	`as£¹Body
("I‡m‡arfile")

375 
def
 
	$‹¡ToŞW™hCÚfig
(
£lf
):

376 
nÙ
 
sys
.
v”siÚ_šfo
 >= (2, 5):

377  
£lf
.
	`sk
("skipped (Python 2.5+ only)")

379 
£lf
.
	`g‘Page
('/tooldecs/blah')

380 
£lf
.
	`as£¹H—d”
('Content-Type', 'application/data')

382 
def
 
	$‹¡W¬nToŞOn
(
£lf
):

384 
Œy
:

385 
ch”rypy
.
toŞs
.
num”ify
.
Ú


386 
exû±
 
A‰ribu‹E¼Ü
:

387 
·ss


389 
¿i£
 
	`As£¹iÚE¼Ü
("Tool.on did‚otƒrror‡s it should have.")

392 
Œy
:

393 
ch”rypy
.
toŞs
.
num”ify
.
Ú
 = 
True


394 
exû±
 
A‰ribu‹E¼Ü
:

395 
·ss


397 
¿i£
 
	`As£¹iÚE¼Ü
("Tool.on did‚otƒrror‡s it should have.")

399 
şass
 
	$SessiÚAuthTe¡
(
un™‹¡
.
Te¡Ca£
):

400 
def
 
	$‹¡_logš_sü“n_»tuºs_by‹s
(
£lf
):

402 
logš_sü“n
 
mu¡
  
by‹s
 
ev’
 
unicode
 
·¿m‘”s
 
¬e
 
·s£d
.

403 
Issue
 1132 
»v—Ëd
 
th©
 
logš_sü“n
 
would
  
unicode
 
the


404 
u£ºame
 
ªd
 
·sswÜd
 
w”e
 
unicode
.

406 
§
 = 
ch”rypy
.
lib
.
ıtoŞs
.
	$SessiÚAuth
()

407 
»s
 = 
§
.
	`logš_sü“n
(
NÚe
, 
u£ºame
=
	`unicode¡r
('nobody'),

408 
·sswÜd
=
	`unicode¡r
('anypass'))

409 
£lf
.
	`as£¹IsIn¡ªû
(
»s
, 
by‹¡r
)

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/test_tutorials.py

1 
impÜt
 
sys


3 
impÜt
 
ch”rypy


4 
äom
 
	gch”rypy
.
‹¡
 
impÜt
 
h–³r


7 
şass
 
	$TutÜŸlTe¡
(
h–³r
.
CPWebCa£
):

9 
def
 
	$£tup_£rv”
(
şs
):

11 
cÚf
 = 
ch”rypy
.
cÚfig
.
	$cİy
()

13 
def
 
	$lßd_tut_moduË
(
Çme
):

15 
ch”rypy
.
cÚfig
.
	$»£t
()

16 
ch”rypy
.
cÚfig
.
	$upd©e
(
cÚf
)

18 
rg‘
 = "ch”rypy.tutÜŸl." + 
Çme


19 
rg‘
 
š
 
sys
.
moduËs
:

20 
moduË
 = 
	$»lßd
(
sys
.
moduËs
[
rg‘
])

22 
moduË
 = 
	`__impÜt__
(
rg‘
, 
	`glob®s
(), 
	`loÿls
(), [''])

23 #Th
above
 
impÜt
 
wl
 
´obably
 
mouÁ
 
a
 
Ãw
 
­p
 
©
 "".

24 
­p
 = 
ch”rypy
.
Œ“
.
­ps
[""]

26 
­p
.
roÙ
.
lßd_tut_moduË
 =†oad_tut_module

27 
­p
.
roÙ
.
£ssiÚs
 = sessions

28 
­p
.
roÙ
.
Œaûback_£‰šg
 =raceback_setting

30 
şs
.
su³rvisÜ
.
	$sync_­ps
()

31 
lßd_tut_moduË
.
expo£d
 = 
True


33 
def
 
	$£ssiÚs
():

34 
ch”rypy
.
cÚfig
.
	`upd©e
({"toŞs.£ssiÚs.Ú": 
True
})

35 
£ssiÚs
.
expo£d
 = 
True


37 
def
 
	$Œaûback_£‰šg
():

38  
	$»´
(
ch”rypy
.
»que¡
.
show_Œaûbacks
)

39 
Œaûback_£‰šg
.
expo£d
 = 
True


41 
şass
 
Dummy
:

42 
·ss


43 
roÙ
 = 
	$Dummy
()

44 
roÙ
.
lßd_tut_moduË
 =†oad_tut_module

45 
ch”rypy
.
Œ“
.
	$mouÁ
(
roÙ
)

46 
£tup_£rv”
 = 
	$şassm‘hod
(
£tup_£rv”
)

49 
def
 
	$‹¡01H–loWÜld
(
£lf
):

50 
£lf
.
	`g‘Page
("/load_tut_module/tut01_helloworld")

51 
£lf
.
	`g‘Page
("/")

52 
£lf
.
	`as£¹Body
('Hello world!')

54 
def
 
	$‹¡02Expo£M‘hods
(
£lf
):

55 
£lf
.
	`g‘Page
("/load_tut_module/tut02_expose_methods")

56 
£lf
.
	`g‘Page
("/showMessage")

57 
£lf
.
	`as£¹Body
('Hello world!')

59 
def
 
	$‹¡03G‘AndPo¡
(
£lf
):

60 
£lf
.
	`g‘Page
("/load_tut_module/tut03_get_and_post")

62 #Try 
difã»Á
 
GET
 
qu”›s


63 
£lf
.
	`g‘Page
("/greetUser?name=Bob")

64 
£lf
.
	`as£¹Body
("Hey Bob, what's up?")

66 
£lf
.
	`g‘Page
("/greetUser")

67 
£lf
.
	`as£¹Body
('Pleaseƒnter your‚ame <a href="./">here</a>.')

69 
£lf
.
	`g‘Page
("/greetUser?name=")

70 
£lf
.
	`as£¹Body
('No,„eally,ƒnter your‚ame <a href="./">here</a>.')

72 #Try 
the
 
§me
 
w™h
 
POST


73 
£lf
.
	`g‘Page
("/g»‘U£r", 
m‘hod
="POST", 
body
="name=Bob")

74 
£lf
.
	`as£¹Body
("Hey Bob, what's up?")

76 
£lf
.
	`g‘Page
("/g»‘U£r", 
m‘hod
="POST", 
body
="name=")

77 
£lf
.
	`as£¹Body
('No,„eally,ƒnter your‚ame <a href="./">here</a>.')

79 
def
 
	$‹¡04Com¶exS™e
(
£lf
):

80 
£lf
.
	`g‘Page
("/load_tut_module/tut04_complex_site")

81 
msg
 = '''

82 <
p
>
H”e
 
¬e
 
some
 
exŒa
 
u£ful
 
lšks
:</p>

84 <
ul
>

85 <
li
><
a
 
h»f
="h‰p://d–.icio.us">
d–
.
icio
.
us
</a></li>

86 <
li
><
a
 
h»f
="h‰p://www.mÜnog¿phy.de">
H’drik
's weblog</a></li>

87 </
ul
>

89 <
p
>[<
a
 
h»f
="../">
R‘uº
 
to
 
lšks
 
·ge
</a>]</p>'''

90 
£lf
.
	`g‘Page
("/links/extra/")

91 
£lf
.
	$as£¹Body
(
msg
)

93 
def
 
	$‹¡05D”ivedObjeùs
(
£lf
):

94 
£lf
.
	`g‘Page
("/load_tut_module/tut05_derived_objects")

95 
msg
 = '''

96 <
html
>

97 <
h—d
>

98 <
t™Ë
>
AnÙh”
 
Page
</title>

99 <
h—d
>

100 <
body
>

101 <
h2
>
AnÙh”
 
Page
</h2>

103 <
p
>

104 
And
 
this
 
is
 
the
 
amazšg
 
£cÚd
 
·ge
!

105 </
p
>

107 </
body
>

108 </
html
>

110 #th
tutÜŸl
 
has
 
some
 
ªnoyšg
 
¥aûs
 
š
 
Ùh”wi£
 
bÏnk
 
lšes


111 
msg
 = msg.
	`»¶aû
('</h2>\n\n', '</h2>\n \n')

112 
msg
 = msg.
	`»¶aû
('</p>\n\n', '</p>\n \n')

113 
£lf
.
	`g‘Page
("/another/")

114 
£lf
.
	$as£¹Body
(
msg
)

116 
def
 
	$‹¡06DeçuÉM‘hod
(
£lf
):

117 
£lf
.
	`g‘Page
("/load_tut_module/tut06_default_method")

118 
£lf
.
	`g‘Page
('/hendrik')

119 
£lf
.
	`as£¹Body
('Hendrik Mans, CherryPy co-developer & crazy German '

122 
def
 
	$‹¡07SessiÚs
(
£lf
):

123 
£lf
.
	`g‘Page
("/load_tut_module/tut07_sessions")

124 
£lf
.
	`g‘Page
("/sessions")

126 
£lf
.
	`g‘Page
('/')

127 
£lf
.
	`as£¹Body
("\n During your current session, you've viewedhis"

131 
£lf
.
	`g‘Page
('/', s–f.
cook›s
)

132 
£lf
.
	`as£¹Body
("\n During your current session, you've viewedhis"

136 
def
 
	$‹¡08G’”©ÜsAndY›ld
(
£lf
):

137 
£lf
.
	`g‘Page
("/load_tut_module/tut08_generators_and_yield")

138 
£lf
.
	`g‘Page
('/')

139 
£lf
.
	`as£¹Body
('<html><body><h2>Generators„ule!</h2>'

144 
def
 
	$‹¡09Fes
(
£lf
):

145 
£lf
.
	`g‘Page
("/load_tut_module/tut09_files")

147 #Te¡ 
u¶ßd


148 
fesize
 = 5

149 
h
 = [("Content-type", "multipart/form-data; boundary=x"),

150 ("CÚ‹Á-L’gth", 
	`¡r
(105 + 
fesize
))]

151 
b
 = '--x\n' + \

155 'a' * 
fesize
 + '\n' + \

157 
£lf
.
	`g‘Page
('/u¶ßd', 
h
, "POST", 
b
)

158 
£lf
.
	`as£¹Body
('''<html>

159 <
body
>

160 
myFe
 
Ëngth
: %
d
<
br
 />

161 
myFe
 
f’ame
: 
h–lo
.
txt
<
br
 />

162 
myFe
 
mime
-
ty³
: 
‹xt
/
¶aš


163 </
body
>

164 </
html
>''' % filesize)

166 #Te¡ 
dowÆßd


167 
£lf
.
	`g‘Page
('/download')

168 
£lf
.
	`as£¹Stus
("200 OK")

169 
£lf
.
	`as£¹H—d”
("Content-Type", "application/x-download")

170 
£lf
.
	`as£¹H—d”
("Content-Disposition",

171 #Mak
su»
 
the
 
f’ame
 
is
 
quÙed
.

173 
£lf
.
	`as£¹Equ®
(
	`Ën
(£lf.
body
), 85698)

175 
def
 
	$‹¡10HTTPE¼Üs
(
£lf
):

176 
£lf
.
	`g‘Page
("/load_tut_module/tut10_http_errors")

178 
£lf
.
	`g‘Page
("/")

179 
£lf
.
	`as£¹InBody
("""<¨h»f="
toggËT¿ûbacks
">""")

180 
£lf
.
	`as£¹InBody
("""<¨h»f="/
dÛsNÙExi¡
">""")

181 
£lf
.
	`as£¹InBody
("""<¨h»f="/
”rÜ
?
code
=403">""")

182 
£lf
.
	`as£¹InBody
("""<¨h»f="/
”rÜ
?
code
=500">""")

183 
£lf
.
	`as£¹InBody
("""<¨h»f="/
mes§geArg
">""")

185 
£lf
.
	`g‘Page
("/traceback_setting")

186 
£‰šg
 = 
£lf
.
body


187 
£lf
.
	`g‘Page
("/toggleTracebacks")

188 
£lf
.
	`as£¹Stus
((302, 303))

189 
£lf
.
	`g‘Page
("/traceback_setting")

190 
£lf
.
	`as£¹Body
(
	`¡r
(
nÙ
 
	$ev®
(
£‰šg
)))

192 
£lf
.
	`g‘Page
("/error?code=500")

193 
£lf
.
	$as£¹Stus
(500)

194 
£lf
.
	`as£¹InBody
("The serverƒncountered‡n unexpected condition "

197 
£lf
.
	`g‘Page
("/error?code=403")

198 
£lf
.
	$as£¹Stus
(403)

199 
£lf
.
	`as£¹InBody
("<h2>You can't dohat!</h2>")

201 
£lf
.
	`g‘Page
("/messageArg")

202 
£lf
.
	$as£¹Stus
(500)

203 
£lf
.
	`as£¹InBody
("If you construct‡n HTTPError with‡ 'message'")

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/test_virtualhost.py

1 
impÜt
 
os


2 
	gcurdœ
 = 
os
.
·th
.
još
(os.
g‘cwd
(), os.·th.
	$dœÇme
(
__fe__
))

4 
impÜt
 
ch”rypy


5 
äom
 
ch”rypy
.
‹¡
 
impÜt
 
h–³r


8 
şass
 
	$Vœtu®Ho¡Te¡
(
h–³r
.
CPWebCa£
):

10 
def
 
	$£tup_£rv”
():

11 
şass
 
RoÙ
:

12 
def
 
	$šdex
(
£lf
):

14 
šdex
.
expo£d
 = 
True


16 
def
 
	$dom4
(
£lf
):

18 
dom4
.
expo£d
 = 
True


20 
def
 
	$m‘hod
(
£lf
, 
v®ue
):

21  "You s’ˆ%s" % 
v®ue


22 
m‘hod
.
expo£d
 = 
True


24 
şass
 
VHo¡
:

25 
def
 
	$__š™__
(
£lf
, 
s™’ame
):

26 
£lf
.
s™’ame
 = sitename

28 
def
 
	$šdex
(
£lf
):

29  "W–comtØ%s" % 
£lf
.
s™’ame


30 
šdex
.
expo£d
 = 
True


32 
def
 
	$vm‘hod
(
£lf
, 
v®ue
):

33  "You s’ˆ%s" % 
v®ue


34 
vm‘hod
.
expo£d
 = 
True


36 
def
 
	$u¾
(
£lf
):

37  
ch”rypy
.
	`u¾
("nextpage")

38 
u¾
.
expo£d
 = 
True


40 #Te¡ 
as
 
a
 
	`hªdËr
 (
£ùiÚ
 
mu¡
 
NOT
 
šşude
 
vho¡
 
´efix
)

41 ğ
ch”rypy
.
toŞs
.
¡©icdœ
.
	`hªdËr
(
£ùiÚ
='/¡©ic', 
dœ
=
curdœ
)

43 
roÙ
 = 
	$RoÙ
()

44 
roÙ
.
mydom2
 = 
	`VHo¡
("Domain 2")

45 
roÙ
.
mydom3
 = 
	`VHo¡
("Domain 3")

46 
ho¡m­
 = {'www.mydom2.com': '/mydom2',

49 
	}
}

50 
ch”rypy
.
Œ“
.
mouÁ
(
roÙ
, 
cÚfig
={

51 '/': {'»que¡.di¥©ch': 
ch”rypy
.
di¥©ch
.
Vœtu®Ho¡
(**
ho¡m­
)},

52 #Te¡ 
š
 
cÚfig
 (
£ùiÚ
 
mu¡
 
šşude
 
vho¡
 
´efix
)

53 '/mydom2/¡©ic2': {'toŞs.¡©icdœ.Ú': 
True
,

54 'toŞs.¡©icdœ.roÙ': 
curdœ
,

59 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

61 
def
 
	$‹¡Vœtu®Ho¡
(
£lf
):

62 
£lf
.
	`g‘Page
("/", [('Host', 'www.mydom1.com')])

63 
£lf
.
	`as£¹Body
('Hello, world')

64 
£lf
.
	`g‘Page
("/mydom2/", [('Host', 'www.mydom1.com')])

65 
£lf
.
	`as£¹Body
('Welcomeo Domain 2')

67 
£lf
.
	`g‘Page
("/", [('Host', 'www.mydom2.com')])

68 
£lf
.
	`as£¹Body
('Welcomeo Domain 2')

69 
£lf
.
	`g‘Page
("/", [('Host', 'www.mydom3.com')])

70 
£lf
.
	`as£¹Body
('Welcomeo Domain 3')

71 
£lf
.
	`g‘Page
("/", [('Host', 'www.mydom4.com')])

72 
£lf
.
	`as£¹Body
('Under construction')

74 #Te¡ 
GET
, 
POST
, 
ªd
 
pos™iÚ®
 
·¿ms


75 
£lf
.
	`g‘Page
("/method?value=root")

76 
£lf
.
	`as£¹Body
("You sent„oot")

77 
£lf
.
	`g‘Page
("/vmethod?value=dom2+GET", [('Host', 'www.mydom2.com')])

78 
£lf
.
	`as£¹Body
("You sent dom2 GET")

79 
£lf
.
	`g‘Page
("/vm‘hod", [('Ho¡', 'www.mydom3.com')], 
m‘hod
="POST",

80 
body
="value=dom3+POST")

81 
£lf
.
	`as£¹Body
("You sent dom3 POST")

82 
£lf
.
	`g‘Page
("/vmethod/pos", [('Host', 'www.mydom3.com')])

83 
£lf
.
	`as£¹Body
("You sent…os")

85 #Te¡ 
th©
 
ch”rypy
.
u¾
 
u£s
 
the
 
brow£r
 u¾, 
nÙ
h
vœtu®
 url

86 
£lf
.
	`g‘Page
("/url", [('Host', 'www.mydom2.com')])

87 
£lf
.
	`as£¹Body
("%s://www.mydom2.com/Ãxage" % s–f.
scheme
)

89 
def
 
	$‹¡_VHo¡_¶us_Stic
(
£lf
):

90 #Te¡ 
as
 
a
 
hªdËr


91 
£lf
.
	`g‘Page
("/static/style.css", [('Host', 'www.mydom2.com')])

92 
£lf
.
	`as£¹Stus
('200 OK')

93 
£lf
.
	`as£¹H—d”
('Content-Type', 'text/css;charset=utf-8')

95 #Te¡ 
š
 
cÚfig


96 
£lf
.
	`g‘Page
("/static2/dirback.jpg", [('Host', 'www.mydom2.com')])

97 
£lf
.
	`as£¹Stus
('200 OK')

98 
£lf
.
	`as£¹H—d”In
('Content-Type', ['image/jpeg', 'image/pjpeg'])

100 #Te¡ 
cÚfig
 
w™h
 "šdex" 
¬g


101 
£lf
.
	`g‘Page
("/static2/", [('Host', 'www.mydom2.com')])

102 
£lf
.
	`as£¹Stus
('200 OK')

103 
£lf
.
	`as£¹Body
('Hello, world\r\n')

104 #Sšû 
toŞs
.
Œašg_¦ash
 
is
 
Ú
 
by
 , 
this
 
should
 
»dœeù


105 
£lf
.
	`g‘Page
("/static2", [('Host', 'www.mydom2.com')])

106 
£lf
.
	`as£¹Stus
(301)

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/test_wsgi_ns.py

1 
impÜt
 
ch”rypy


2 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
Áob


3 
äom
 
	gch”rypy
.
‹¡
 
impÜt
 
h–³r


6 
şass
 
	$WSGI_Name¥aû_Te¡
(
h–³r
.
CPWebCa£
):

8 
def
 
	$£tup_£rv”
():

10 
şass
 
	$WSGIRe¥Ú£
(
objeù
):

12 
def
 
	$__š™__
(
£lf
, 
­´esuÉs
):

13 
£lf
.
­´esuÉs
 =‡ppresults

14 
£lf
.
™”
 = 
	$™”
(
­´esuÉs
)

16 
def
 
	$__™”__
(
£lf
):

17  
£lf


19 
def
 
	$Ãxt
(
£lf
):

20  
£lf
.
™”
.
	$Ãxt
()

21 
def
 
	$__Ãxt__
(
£lf
):

22  
	$Ãxt
(
£lf
.
™”
)

24 
def
 
	$şo£
(
£lf
):

25 
	`ha§‰r
(
£lf
.
­´esuÉs
, "close"):

26 
£lf
.
­´esuÉs
.
	$şo£
()

29 
şass
 
	$ChªgeCa£
(
objeù
):

31 
def
 
	$__š™__
(
£lf
, 
­p
, 
to
=
NÚe
):

32 
£lf
.
­p
 =‡pp

33 
£lf
.
to
 =o

35 
def
 
	$__ÿÎ__
(
£lf
, 
’vœÚ
, 
¡¬t_»¥Ú£
):

36 
»s
 = 
£lf
.
	$­p
(
’vœÚ
, 
¡¬t_»¥Ú£
)

37 
şass
 
	$Ca£ResuÉs
(
WSGIRe¥Ú£
):

38 
def
 
	$Ãxt
(
this
):

39  
	`g‘©Œ
(
this
.
™”
.
	`Ãxt
(), 
£lf
.
to
)()

40 
def
 
	$__Ãxt__
(
this
):

41  
	`g‘©Œ
(
	`Ãxt
(
this
.
™”
), 
£lf
.
to
)()

42  
	$Ca£ResuÉs
(
»s
)

44 
şass
 
	$R•Ïûr
(
objeù
):

46 
def
 
	`__š™__
(
£lf
, 
­p
, 
m­
={
	}
}):

47 
£lf
.
­p
 =‡pp

48 
£lf
.
m­
 = map

50 
def
 
	$__ÿÎ__
(
£lf
, 
’vœÚ
, 
¡¬t_»¥Ú£
):

51 
»s
 = 
£lf
.
	$­p
(
’vœÚ
, 
¡¬t_»¥Ú£
)

52 
şass
 
	$R•ÏûResuÉs
(
WSGIRe¥Ú£
):

53 
def
 
	$Ãxt
(
this
):

54 
lše
 = 
this
.
™”
.
	$Ãxt
()

55 
k
, 
v
 
š
 
£lf
.
m­
.
	$™”™ems
():

56 
lše
 =†še.
	$»¶aû
(
k
, 
v
)

57  
lše


58 
def
 
	$__Ãxt__
(
this
):

59 
lše
 = 
	$Ãxt
(
this
.
™”
)

60 
k
, 
v
 
š
 
£lf
.
m­
.
	$™ems
():

61 
lše
 =†še.
	$»¶aû
(
k
, 
v
)

62  
lše


63  
	$R•ÏûResuÉs
(
»s
)

65 
şass
 
	$RoÙ
(
objeù
):

67 
def
 
	$šdex
(
£lf
):

69 
šdex
.
expo£d
 = 
True


72 
roÙ_cÚf
 = {'wsgi.p–še': [('»¶aû', 
R•Ïûr
)],

73 'wsgi.»¶aû.m­': {
	`Áob
('L'):‚tob('X'),

74 
	`Áob
('l'):‚tob('r')},

75 
	}
}

77 
­p
 = 
ch”rypy
.
AµliÿtiÚ
(
	$RoÙ
())

78 
­p
.
wsgŸµ
.
p–še
.
	`­³nd
(('chªgeÿ£', 
ChªgeCa£
))

79 
­p
.
wsgŸµ
.
cÚfig
['chªgeÿ£'] = {'to': 'uµ”'
	}
}

80 
ch”rypy
.
Œ“
.
mouÁ
(
­p
, 
cÚfig
={'/': 
roÙ_cÚf
})

81 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

84 
def
 
	$‹¡_p–še
(
£lf
):

85 
nÙ
 
ch”rypy
.
£rv”
.
h‰p£rv”
:

86  
£lf
.
	$sk
()

88 
£lf
.
	`g‘Page
("/")

89 #Ià
body
 
is
 "HEXXO WORXD!", 
the
 
middËw¬e
 
was
 
­¶›d
 
out
 
of
 
Üd”
.

90 
£lf
.
	`as£¹Body
("HERRO WORRD!")

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/test_wsgi_vhost.py

1 
impÜt
 
ch”rypy


2 
äom
 
	gch”rypy
.
‹¡
 
impÜt
 
h–³r


5 
şass
 
	$WSGI_Vœtu®Ho¡_Te¡
(
h–³r
.
CPWebCa£
):

7 
def
 
	$£tup_£rv”
():

9 
şass
 
	$CÏssOfRoÙ
(
objeù
):

11 
def
 
	$__š™__
(
£lf
, 
Çme
):

12 
£lf
.
Çme
 =‚ame

14 
def
 
	$šdex
(
£lf
):

15  "W–comtØth% webs™e!" % 
£lf
.
Çme


16 
šdex
.
expo£d
 = 
True


19  = 
ch”rypy
.
	$AµliÿtiÚ
(
NÚe
)

21 
domašs
 = {
	}
}

22 
y—r
 
š
 
	$¿nge
(1997, 2008):

23 
­p
 = 
ch”rypy
.
	`AµliÿtiÚ
(
	`CÏssOfRoÙ
('CÏs oà%s' % 
y—r
))

24 
domašs
['www.şassof%s.exam¶e' % 
y—r
] = 
­p


26 
ch”rypy
.
Œ“
.
	`g¿á
(ch”rypy.
_ıwsgi
.
	$Vœtu®Ho¡
(, 
domašs
))

27 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

29 
def
 
	$‹¡_w–come
(
£lf
):

30 
nÙ
 
ch”rypy
.
£rv”
.
usšg_wsgi
:

31  
£lf
.
	`sk
("skipped (not using WSGI)... ")

33 
y—r
 
š
 
	$¿nge
(1997, 2008):

34 
£lf
.
	`g‘Page
("/", 
h—d”s
=[('Ho¡', 'www.şassof%s.exam¶e' % 
y—r
)])

35 
£lf
.
	`as£¹Body
("W–comtØthCÏs oà% webs™e!" % 
y—r
)

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/test_wsgiapps.py

1 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
Áob


2 
äom
 
	gch”rypy
.
‹¡
 
impÜt
 
h–³r


5 
şass
 
	$WSGIG¿áTe¡s
(
h–³r
.
CPWebCa£
):

7 
def
 
	$£tup_£rv”
():

8 
impÜt
 
os


9 
curdœ
 = 
os
.
·th
.
	`još
(os.
	`g‘cwd
(), os.·th.
	$dœÇme
(
__fe__
))

11 
impÜt
 
ch”rypy


13 
def
 
	$‹¡_­p
(
’vœÚ
, 
¡¬t_»¥Ú£
):

14 
¡©us
 = '200 OK'

15 
»¥Ú£_h—d”s
 = [('Content-type', 'text/plain')]

16 
	$¡¬t_»¥Ú£
(
¡©us
, 
»¥Ú£_h—d”s
)

17 
ouut
 = ['Hello, world!\n',

19 
keys
 = 
	`li¡
(
’vœÚ
.
	$keys
())

20 
keys
.
	$sÜt
()

21 
k
 
š
 
keys
:

22 
ouut
.
	`­³nd
('%s: %s\n' % (
k
,
’vœÚ
[k]))

23  [
	`Áob
(
x
, 'utf-8'èx 
š
 
ouut
]

25 
def
 
	$‹¡_em±y_¡ršg_­p
(
’vœÚ
, 
¡¬t_»¥Ú£
):

26 
¡©us
 = '200 OK'

27 
»¥Ú£_h—d”s
 = [('Content-type', 'text/plain')]

28 
	$¡¬t_»¥Ú£
(
¡©us
, 
»¥Ú£_h—d”s
)

29  [
	`Áob
('Hello'),‚tob(''),‚tob(' '),‚tob(''),‚tob('world')]

32 
şass
 
	$WSGIRe¥Ú£
(
objeù
):

34 
def
 
	$__š™__
(
£lf
, 
­´esuÉs
):

35 
£lf
.
­´esuÉs
 =‡ppresults

36 
£lf
.
™”
 = 
	$™”
(
­´esuÉs
)

38 
def
 
	$__™”__
(
£lf
):

39  
£lf


41 
def
 
	$Ãxt
(
£lf
):

42  
£lf
.
™”
.
	$Ãxt
()

43 
def
 
	$__Ãxt__
(
£lf
):

44  
	$Ãxt
(
£lf
.
™”
)

46 
def
 
	$şo£
(
£lf
):

47 
	`ha§‰r
(
£lf
.
­´esuÉs
, "close"):

48 
£lf
.
­´esuÉs
.
	$şo£
()

51 
şass
 
	$Rev”sšgMiddËw¬e
(
objeù
):

53 
def
 
	$__š™__
(
£lf
, 
­p
):

54 
£lf
.
­p
 =‡pp

56 
def
 
	$__ÿÎ__
(
£lf
, 
’vœÚ
, 
¡¬t_»¥Ú£
):

57 
»suÉs
 = 
	$­p
(
’vœÚ
, 
¡¬t_»¥Ú£
)

58 
şass
 
	$Rev”£r
(
WSGIRe¥Ú£
):

59 
def
 
	$Ãxt
(
this
):

60 
lše
 = 
	`li¡
(
this
.
™”
.
	$Ãxt
())

61 
lše
.
	$»v”£
()

62  "".
	$još
(
lše
)

63 
def
 
	$__Ãxt__
(
this
):

64 
lše
 = 
	`li¡
(
	$Ãxt
(
this
.
™”
))

65 
lše
.
	$»v”£
()

66  
	$by‹s
(
lše
)

67  
	$Rev”£r
(
»suÉs
)

69 
şass
 
RoÙ
:

70 
def
 
	$šdex
(
£lf
):

71  
	`Áob
("I'm‡„egular CherryPy…age handler!")

72 
šdex
.
expo£d
 = 
True


75 
ch”rypy
.
Œ“
.
	`mouÁ
(
	$RoÙ
())

77 
ch”rypy
.
Œ“
.
	`g¿á
(
‹¡_­p
, '/hosted/app1')

78 
ch”rypy
.
Œ“
.
	`g¿á
(
‹¡_em±y_¡ršg_­p
, '/hosted/app3')

80 #S‘ 
süt_Çme
 
ex¶ic™ly
 
to
 
NÚe
Ø
sigÇl
 
CP
 
th©
 
™
 
should


81 #b
puÎed
 
äom
 
the
 
WSGI
 
’vœÚ
 
—ch
 
time
.

82 
­p
 = 
ch”rypy
.
	`AµliÿtiÚ
(
	`RoÙ
(), 
süt_Çme
=
NÚe
)

83 
ch”rypy
.
Œ“
.
	`g¿á
(
	`Rev”sšgMiddËw¬e
(
­p
), '/hosted/app2')

84 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

86 
wsgi_ouut
 = '''Hello, world!

87 
This
 
is
 
a
 
wsgi
 
­p
 
ruÂšg
 
w™hš
 
Ch”ryPy
!'''

89 
def
 
	$‹¡_01_¡ªd¬d_­p
(
£lf
):

90 
£lf
.
	`g‘Page
("/")

91 
£lf
.
	`as£¹Body
("I'm‡„egular CherryPy…age handler!")

93 
def
 
	$‹¡_04_pu»_wsgi
(
£lf
):

94 
impÜt
 
ch”rypy


95 
nÙ
 
ch”rypy
.
£rv”
.
usšg_wsgi
:

96  
£lf
.
	`sk
("skipped (not using WSGI)... ")

97 
£lf
.
	`g‘Page
("/hosted/app1")

98 
£lf
.
	`as£¹H—d”
("Content-Type", "text/plain")

99 
£lf
.
	$as£¹InBody
(
£lf
.
wsgi_ouut
)

101 
def
 
	$‹¡_05_w¿µed_ı_­p
(
£lf
):

102 
impÜt
 
ch”rypy


103 
nÙ
 
ch”rypy
.
£rv”
.
usšg_wsgi
:

104  
£lf
.
	`sk
("skipped (not using WSGI)... ")

105 
£lf
.
	`g‘Page
("/hosted/app2/")

106 
body
 = 
	`li¡
("I'm‡„egular CherryPy…age handler!")

107 
body
.
	$»v”£
()

108 
body
 = "".
	$još
(
body
)

109 
£lf
.
	$as£¹InBody
(
body
)

111 
def
 
	$‹¡_06_em±y_¡ršg_­p
(
£lf
):

112 
impÜt
 
ch”rypy


113 
nÙ
 
ch”rypy
.
£rv”
.
usšg_wsgi
:

114  
£lf
.
	`sk
("skipped (not using WSGI)... ")

115 
£lf
.
	`g‘Page
("/hosted/app3")

116 
£lf
.
	`as£¹H—d”
("Content-Type", "text/plain")

117 
£lf
.
	`as£¹InBody
('Hello world')

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/test_xmlrpc.py

1 
impÜt
 
sys


2 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
py3k


4 
	gŒy
:

5 
äom
 
xmÌpşib
 
impÜt
 
D©eTime
, 
	gFauÉ
, 
	gPrÙocŞE¼Ü
, 
	gS”v”Proxy
, 
SaãT¿n¥Üt


6 
exû±
 
	gImpÜtE¼Ü
:

7 
äom
 
xmÌpc
.
ş›Á
 
impÜt
 
D©eTime
, 
	gFauÉ
, 
	gPrÙocŞE¼Ü
, 
	gS”v”Proxy
, 
SaãT¿n¥Üt


9 
	gpy3k
:

10 
HTTPST¿n¥Üt
 = 
SaãT¿n¥Üt


13 
impÜt
 
sock‘


14 
nÙ
 
ha§‰r
(
sock‘
, "ssl"):

15 
sock‘
.
s¦
 = 
True


17 
şass
 
	$HTTPST¿n¥Üt
(
SaãT¿n¥Üt
):

20 
def
 
	$»que¡
(
£lf
, 
ho¡
, 
hªdËr
, 
»que¡_body
, 
v”bo£
=0):

21 #issu
XML
-
RPC
 
»que¡


22 
h
 = 
£lf
.
	$make_cÚÃùiÚ
(
ho¡
)

23 
v”bo£
:

24 
h
.
	$£t_debugËv–
(1)

26 
£lf
.
	$£nd_»que¡
(
h
, 
hªdËr
, 
»que¡_body
)

27 
£lf
.
	$£nd_ho¡
(
h
, 
ho¡
)

28 
£lf
.
	$£nd_u£r_ag’t
(
h
)

29 
£lf
.
	$£nd_cÚ‹Á
(
h
, 
»que¡_body
)

31 
”rcode
, 
”rmsg
, 
h—d”s
 = 
h
.
	$g‘»¶y
()

32 
”rcode
 != 200:

33 
¿i£
 
	`PrÙocŞE¼Ü
(
ho¡
 + 
hªdËr
, 
”rcode
, 
”rmsg
, 
h—d”s
)

35 
£lf
.
v”bo£
 = verbose

39 #sock = 
h
.
_cÚn
.
sock


40 #exû± 
A‰ribu‹E¼Ü
:

41 #sock = 
NÚe


42 #»tuº 
£lf
.
	`_·r£_»¥Ú£
(
h
.
	`g‘fe
(), 
sock
)

44  
£lf
.
	`·r£_»¥Ú£
(
h
.
	$g‘fe
())

46 
impÜt
 
ch”rypy


49 
def
 
	$£tup_£rv”
():

50 
äom
 
ch”rypy
 
impÜt
 
_ıtoŞs


52 
şass
 
RoÙ
:

53 
def
 
	$šdex
(
£lf
):

55 
šdex
.
expo£d
 = 
True


58 
şass
 
	$XmlRpc
(
_ıtoŞs
.
XMLRPCCÚŒŞËr
):

60 
def
 
	$foo
(
£lf
):

62 
foo
.
expo£d
 = 
True


64 
def
 
	$»tuº_sšgË_™em_li¡
(
£lf
):

66 
»tuº_sšgË_™em_li¡
.
expo£d
 = 
True


68 
def
 
	$»tuº_¡ršg
(
£lf
):

70 
»tuº_¡ršg
.
expo£d
 = 
True


72 
def
 
	$»tuº_tu¶e
(
£lf
):

74 
»tuº_tu¶e
.
expo£d
 = 
True


76 
def
 
	$»tuº_diù
(
£lf
):

77  
	$diù
(
a
=1, 
b
=2, 
c
=3)

78 
»tuº_diù
.
expo£d
 = 
True


80 
def
 
	$»tuº_compos™e
(
£lf
):

81  
	`diù
(
a
=1,
z
=26), 'hi', ['welcome', 'friend']

82 
»tuº_compos™e
.
expo£d
 = 
True


84 
def
 
	$»tuº_št
(
£lf
):

86 
»tuº_št
.
expo£d
 = 
True


88 
def
 
	$»tuº_æßt
(
£lf
):

90 
»tuº_æßt
.
expo£d
 = 
True


92 
def
 
	$»tuº_d©‘ime
(
£lf
):

93  
	`D©eTime
((2003, 10, 7, 8, 1, 0, 1, 280, -1))

94 
»tuº_d©‘ime
.
expo£d
 = 
True


96 
def
 
	$»tuº_boŞ—n
(
£lf
):

97  
True


98 
»tuº_boŞ—n
.
expo£d
 = 
True


100 
def
 
	$‹¡_¬gum’t_·ssšg
(
£lf
, 
num
):

101  
num
 * 2

102 
‹¡_¬gum’t_·ssšg
.
expo£d
 = 
True


104 
def
 
	$‹¡_»tuºšg_FauÉ
(
£lf
):

105  
	`FauÉ
(1, "custom Fault„esponse")

106 
‹¡_»tuºšg_FauÉ
.
expo£d
 = 
True


108 
roÙ
 = 
	$RoÙ
()

109 
roÙ
.
xmÌpc
 = 
	$XmlRpc
()

110 
ch”rypy
.
Œ“
.
	`mouÁ
(
roÙ
, 
cÚfig
={'/': {

111 '»que¡.di¥©ch': 
ch”rypy
.
di¥©ch
.
	`XMLRPCDi¥©ch”
(),

113 }
	}
})

116 
äom
 
ch”rypy
.
‹¡
 
impÜt
 
h–³r


118 
şass
 
	$XmlRpcTe¡
(
h–³r
.
CPWebCa£
):

119 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

120 
def
 
	$‹¡XmlRpc
(
£lf
):

122 
scheme
 = 
£lf
.scheme

123 
scheme
 == "https":

124 
u¾
 = 'h‰ps://%s:%s/xmÌpc/' % (
£lf
.
	`š‹rçû
(), s–f.
PORT
)

125 
´oxy
 = 
	`S”v”Proxy
(
u¾
, 
Œª¥Üt
=
	$HTTPST¿n¥Üt
())

127 
u¾
 = 'h‰p://%s:%s/xmÌpc/' % (
£lf
.
	`š‹rçû
(), s–f.
PORT
)

128 
´oxy
 = 
	$S”v”Proxy
(
u¾
)

130 #begš 
the
 
‹¡s
 ...

131 
£lf
.
	`g‘Page
("/xmlrpc/foo")

132 
£lf
.
	`as£¹Body
("Hello world!")

134 
£lf
.
	`as£¹Equ®
(
´oxy
.
	`»tuº_sšgË_™em_li¡
(), [42])

135 
£lf
.
	`as£¹NÙEqu®
(
´oxy
.
	`»tuº_sšgË_™em_li¡
(), 'one bazillion')

136 
£lf
.
	`as£¹Equ®
(
´oxy
.
	`»tuº_¡ršg
(), "here is‡ string")

137 
£lf
.
	`as£¹Equ®
(
´oxy
.
	`»tuº_tu¶e
(), 
	`li¡
(('here', 'is', 1, 'tuple')))

138 
£lf
.
	`as£¹Equ®
(
´oxy
.
	`»tuº_diù
(), {'a': 1, 'c': 3, 'b': 2
	}
})

139 
£lf
.
as£¹Equ®
(
´oxy
.
»tuº_compos™e
(),

141 
	g£lf
.
as£¹Equ®
(
´oxy
.
»tuº_št
(), 42)

142 
	g£lf
.
as£¹Equ®
(
´oxy
.
»tuº_æßt
(), 3.14)

143 
	g£lf
.
as£¹Equ®
(
´oxy
.
»tuº_d©‘ime
(),

144 
D©eTime
((2003, 10, 7, 8, 1, 0, 1, 280, -1)))

145 
	g£lf
.
as£¹Equ®
(
´oxy
.
»tuº_boŞ—n
(), 
True
)

146 
	g£lf
.
as£¹Equ®
(
´oxy
.
‹¡_¬gum’t_·ssšg
(22), 22 * 2)

148 #Te¡ 
ª
 
”rÜ
 
š
 
the
 
·ge
 
hªdËr
 (
should
 
¿i£
‡À
xmÌpşib
.
FauÉ
)

149 
	gŒy
:

150 
´oxy
.
‹¡_¬gum’t_·ssšg
({})

151 
exû±
 
Exû±iÚ
:

152 
x
 = 
sys
.
exc_šfo
()[1]

153 
£lf
.
	$as£¹Equ®
(
x
.
__şass__
, 
FauÉ
)

154 
£lf
.
	`as£¹Equ®
(
x
.
çuÉSŒšg
, ("unsupported operandype(s) "

157 
£lf
.
	`ç
("Expected xmlrpclib.Fault")

160 #ià
a
 
m‘hod
 
is
 
nÙ
 
found
, 
ª
 
xmÌpşib
.
FauÉ
 
should
 
be
 
¿i£d


161 
Œy
:

162 
´oxy
.
	$nÚ_m‘hod
()

163 
exû±
 
Exû±iÚ
:

164 
x
 = 
sys
.
	`exc_šfo
()[1]

165 
£lf
.
	$as£¹Equ®
(
x
.
__şass__
, 
FauÉ
)

166 
£lf
.
	`as£¹Equ®
(
x
.
çuÉSŒšg
, 'method "non_method" is‚ot supported')

168 
£lf
.
	`ç
("Expected xmlrpclib.Fault")

170 #Te¡ 
»tuºšg
 
a
 
FauÉ
 
äom
 
the
 
·ge
 
hªdËr
.

171 
Œy
:

172 
´oxy
.
	$‹¡_»tuºšg_FauÉ
()

173 
exû±
 
Exû±iÚ
:

174 
x
 = 
sys
.
	`exc_šfo
()[1]

175 
£lf
.
	$as£¹Equ®
(
x
.
__şass__
, 
FauÉ
)

176 
£lf
.
	`as£¹Equ®
(
x
.
çuÉSŒšg
, ("custom Fault„esponse"))

178 
£lf
.
	`ç
("Expected xmlrpclib.Fault")

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/webtest.py

3 
U£
 
the
 
	gWebCa£
.
g‘Page
 
m‘hod
 
to
 
»que¡
 
a
 
·ge
 
äom
 
your
 
HTTP
 
	g£rv”
.

5 
F¿mewÜk
 
	gIÁeg¿tiÚ


8 
If
 
you
 
have
 
cÚŒŞ
 
ov”
 
your
 
£rv”
 
´oûss
, you 
ÿn
 
hªdË
 
”rÜs


9 
š
 
the
 
	g£rv”
-
side
 
of
h
HTTP
 
cÚv”§tiÚ
 
a
 
b™
 
	gb‘‹r
. 
You
 
mu¡
 
run


10 
bÙh
 
the
 
	$ş›Á
 (
your
 
WebCa£
 
‹¡s
è
ªd
 
the
 
£rv”
 
š
h
§me
 
´oûss


11 (
but
 
š
 
£·¿‹
 
th»ads
, 
obviou¦y
).

13 
Wh’
 
ª
 
”rÜ
 
occurs
 
š
 
the
 
äamewÜk
, 
ÿÎ
 
£rv”_”rÜ
. 
It
 
wl
 
´št


14 
the
 
Œaûback
 
to
 
¡dout
, 
ªd
 
k“p
 
ªy
 
as£¹iÚs
 
you
 
have
 
äom
 
ruÂšg


15 (
the
 
assum±iÚ
 
is
 
th©
, th
£rv”
 
”rÜs
,h
·ge
 
ouut
 
wl
 
nÙ


16 
be
 
of
 
fu¹h”
 
signifiÿnû
 
to
 
your
 
‹¡s
).

19 
impÜt
 
µršt


20 
impÜt
 
»


21 
impÜt
 
sock‘


22 
impÜt
 
sys


23 
impÜt
 
time


24 
impÜt
 
Œaûback


25 
impÜt
 
ty³s


27 
äom
 
un™‹¡
 
impÜt
 *

28 
äom
 
un™‹¡
 
impÜt
 
_TextTe¡ResuÉ


30 
äom
 
ch”rypy
.
_ıcom·t
 
impÜt
 
ba£¡ršg
, 
Áob
, 
py3k
, 
HTTPCÚÃùiÚ
, 
HTTPSCÚÃùiÚ
, 
unicode¡r


33 
def
 
	$š‹rçû
(
ho¡
):

36 
If
 
the
 
£rv”
 
is
 
li¡’šg
 
Ú
 '0.0.0.0' (
INADDR_ANY
)

37 
Ü
 '::' (
IN6ADDR_ANY
), 
this
 
wl
  
the
 
´İ”
 
loÿlho¡
."""

38 
ho¡
 == '0.0.0.0':

39 #INADDR_ANY, 
which
 
should
 
»¥Úd
 
Ú
 
loÿlho¡
.

41 
ho¡
 == '::':

42 #IN6ADDR_ANY, 
which
 
should
 
»¥Úd
 
Ú
 
loÿlho¡
.

44  
ho¡


47 
şass
 
	$T”£Te¡ResuÉ
(
_TextTe¡ResuÉ
):

49 
def
 
	$´štE¼Üs
(
£lf
):

50 #Ov”ridd’ 
to
 
avoid
 
uÂeûs§ry
 
em±y
 
lše


51 
£lf
.
”rÜs
 
Ü
 s–f.
çu»s
:

52 
£lf
.
dÙs
 
Ü
 s–f.
showAÎ
:

53 
£lf
.
¡»am
.
	$wr™–n
()

54 
£lf
.
	`´štE¼ÜLi¡
('ERROR', s–f.
”rÜs
)

55 
£lf
.
	`´štE¼ÜLi¡
('FAIL', s–f.
çu»s
)

58 
şass
 
	$T”£Te¡RuÂ”
(
TextTe¡RuÂ”
):

61 
def
 
	$_makeResuÉ
(
£lf
):

62  
	$T”£Te¡ResuÉ
(
£lf
.
¡»am
, s–f.
desütiÚs
, s–f.
v”bos™y
)

64 
def
 
	$run
(
£lf
, 
‹¡
):

66 #Ov”ridd’ 
to
 
»move
 
uÂeûs§ry
 
em±y
 
lšes
 
ªd
 
£·¿tÜs


67 
»suÉ
 = 
£lf
.
	$_makeResuÉ
()

68 
	$‹¡
(
»suÉ
)

69 
»suÉ
.
	$´štE¼Üs
()

70 
nÙ
 
»suÉ
.
	$wasSucûssful
():

71 
£lf
.
¡»am
.
	`wr™e
("FAILED (")

72 
çed
, 
”rÜed
 = 
	`li¡
(
	`m­
(
Ën
, (
»suÉ
.
çu»s
,„esuÉ.
”rÜs
)))

73 
çed
:

74 
£lf
.
¡»am
.
	`wr™e
("çu»s=%d" % 
çed
)

75 
”rÜed
:

76 
çed
: 
£lf
.
¡»am
.
	`wr™e
(", ")

77 
£lf
.
¡»am
.
	`wr™e
("”rÜs=%d" % 
”rÜed
)

78 
£lf
.
¡»am
.
	`wr™–n
(")")

79  
»suÉ


82 
şass
 
	$R–ßdšgTe¡Lßd”
(
Te¡Lßd”
):

84 
def
 
	$lßdTe¡sFromName
(
£lf
, 
Çme
, 
moduË
=
NÚe
):

87 
The
 
Çme
 
may
 
»sŞve
 
e™h”
 
to
 
a
 
moduË
,‡ 
‹¡
 
şass
,‡

88 
‹¡
 
m‘hod
 
w™hš
 
a
e¡ 
şass
, 
Ü
‡ 
ÿÎabË
 
objeù
 
which


89 
»tuºs
 
a
 
Te¡Ca£
 
Ü
 
Te¡Su™e
 
š¡ªû
.

91 
The
 
m‘hod
 
İtiÚ®ly
 
»sŞves
 
the
 
Çmes
 
»Ïtive
 
to
 
a
 
giv’
 
moduË
.

93 
·¹s
 = 
Çme
.
	`¥l™
('.')

94 
unu£d_·¹s
 = []

95 
moduË
 
is
 
NÚe
:

96 
nÙ
 
·¹s
:

97 
¿i£
 
	`V®ueE¼Ü
("šcom¶‘‹¡‚ame: %s" % 
Çme
)

99 
·¹s_cİy
 = 
·¹s
[:]

100 
·¹s_cİy
:

101 
rg‘
 = ".".
	$još
(
·¹s_cİy
)

102 
rg‘
 
š
 
sys
.
moduËs
:

103 
moduË
 = 
	$»lßd
(
sys
.
moduËs
[
rg‘
])

104 
·¹s
 = 
unu£d_·¹s


107 
Œy
:

108 
moduË
 = 
	$__impÜt__
(
rg‘
)

109 
·¹s
 = 
unu£d_·¹s


111 
exû±
 
ImpÜtE¼Ü
:

112 
unu£d_·¹s
.
	`š£¹
(0,
·¹s_cİy
[-1])

113 
d–
 
·¹s_cİy
[-1]

114 
nÙ
 
·¹s_cİy
:

115 
¿i£


116 
·¹s
 =…arts[1:]

117 
obj
 = 
moduË


118 
·¹
 
š
 
·¹s
:

119 
obj
 = 
	$g‘©Œ
(
obj
, 
·¹
)

121 
	`ty³
(
obj
è=ğ
ty³s
.
ModuËTy³
:

122  
£lf
.
	$lßdTe¡sFromModuË
(
obj
)

123 
	`–if
 (((
py3k
 
ªd
 
	$isš¡ªû
(
obj
, 
ty³
))

124 
Ü
 
	`isš¡ªû
(
obj
, (
ty³
, 
ty³s
.
CÏssTy³
)))

125 
ªd
 
	$issubşass
(
obj
, 
Te¡Ca£
)):

126  
£lf
.
	$lßdTe¡sFromTe¡Ca£
(
obj
)

127 
–if
 
	`ty³
(
obj
è=ğ
ty³s
.
UnboundM‘hodTy³
:

128 
py3k
:

129  
obj
.
__£lf__
.
	$__şass__
(
obj
.
__Çme__
)

131  
obj
.
	$im_şass
(
obj
.
__Çme__
)

132 
–if
 
	`ha§‰r
(
obj
, '__call__'):

133 
‹¡
 = 
	$obj
()

134 
nÙ
 
	$isš¡ªû
(
‹¡
, 
Te¡Ca£
è
ªd
 \

135 
nÙ
 
	$isš¡ªû
(
‹¡
, 
Te¡Su™e
):

136 
¿i£
 
	`V®ueE¼Ü
("calling %s„eturned %s, "

137 "nÙ‡e¡" % (
obj
,
‹¡
))

138  
‹¡


140 
¿i£
 
	`V®ueE¼Ü
("dØnÙ know howØmak‹¡ from: %s" % 
obj
)

143 
Œy
:

144 #JythÚ 
suµÜt


145 
sys
.
¶©fÜm
[:4] == 'java':

146 
def
 
	$g‘ch¬
():

147 #HİefuÎy 
this
 
is
 
’ough


148  
sys
.
¡dš
.
	$»ad
(1)

150 #OÀ
Wšdows
, 
msvüt
.
g‘ch
 
»ads
 
a
 
sšgË
 
w™hout
 
ouut
.

151 
impÜt
 
msvüt


152 
def
 
	$g‘ch¬
():

153  
msvüt
.
	$g‘ch
()

154 
exû±
 
ImpÜtE¼Ü
:

155 #Unix 
g‘chr


156 
impÜt
 
‰y
, 
‹rmios


157 
def
 
	$g‘ch¬
():

158 
fd
 = 
sys
.
¡dš
.
	$f’o
()

159 
Şd_£‰šgs
 = 
‹rmios
.
	$tcg‘©Œ
(
fd
)

160 
Œy
:

161 
‰y
.
	`£Œaw
(
sys
.
¡dš
.
	$f’o
())

162 
ch
 = 
sys
.
¡dš
.
	$»ad
(1)

163 
fš®ly
:

164 
‹rmios
.
	$tc£‰r
(
fd
, 
‹rmios
.
TCSADRAIN
, 
Şd_£‰šgs
)

165  
ch


168 
şass
 
	$WebCa£
(
Te¡Ca£
):

169 
HOST
 = "127.0.0.1"

170 
PORT
 = 8000

171 
HTTP_CONN
 = 
HTTPCÚÃùiÚ


172 
PROTOCOL
 = "HTTP/1.1"

174 
scheme
 = "http"

175 
u¾
 = 
NÚe


177 
¡©us
 = 
NÚe


178 
h—d”s
 = 
NÚe


179 
body
 = 
NÚe


181 
’codšg
 = 'utf-8'

183 
time
 = 
NÚe


185 
def
 
	$g‘_cÚn
(
£lf
, 
auto_İ’
=
F®£
):

187 
£lf
.
scheme
 == "https":

188 
şs
 = 
HTTPSCÚÃùiÚ


190 
şs
 = 
HTTPCÚÃùiÚ


191 
cÚn
 = 
	`şs
(
£lf
.
	`š‹rçû
(), s–f.
PORT
)

192 #Autom©iÿÎy 
»
-
cÚÃù
?

193 
cÚn
.
auto_İ’
 =‡uto_open

194 
cÚn
.
	$cÚÃù
()

195  
cÚn


197 
def
 
	$£t_³rsi¡’t
(
£lf
, 
Ú
=
True
, 
auto_İ’
=
F®£
):

200 
If
 
the
 'Ú' 
¬gum’t
 
is
 
	`True
 (th), 
th’
 
£lf
.
HTTP_CONN


201 
wl
 
be
 
£t
 
to
 
ª
 
š¡ªû
 
of
 
	`HTTPCÚÃùiÚ
 (
Ü
 
HTTPS


202 
£lf
.
scheme
 
is
 "h‰ps"). 
This
 
wl
 
th’
 
³rsi¡
 
aüoss
 
»que¡s
.

204 
We
 
Úly
 
®low
 
a
 
sšgË
 
İ’
 
cÚÃùiÚ
, 
so
 
you
 
ÿÎ
 
this


205 
ªd
 
we
 
cu¼’y
 
have
 
ª
 
İ’
 
cÚÃùiÚ
, 
™
 
wl
 
be
 
şo£d
.

207 
Œy
:

208 
£lf
.
HTTP_CONN
.
	$şo£
()

209 
	$exû±
 (
Ty³E¼Ü
, 
A‰ribu‹E¼Ü
):

210 
·ss


212 
Ú
:

213 
£lf
.
HTTP_CONN
 = s–f.
	$g‘_cÚn
(
auto_İ’
=auto_open)

215 
£lf
.
scheme
 == "https":

216 
£lf
.
HTTP_CONN
 = 
HTTPSCÚÃùiÚ


218 
£lf
.
HTTP_CONN
 = 
HTTPCÚÃùiÚ


220 
def
 
	$_g‘_³rsi¡’t
(
£lf
):

221  
	`ha§‰r
(
£lf
.
HTTP_CONN
, "__class__")

222 
def
 
	$_£t_³rsi¡’t
(
£lf
, 
Ú
):

223 
£lf
.
	$£t_³rsi¡’t
(
Ú
)

224 
³rsi¡’t
 = 
	$´İ”ty
(
_g‘_³rsi¡’t
, 
_£t_³rsi¡’t
)

226 
def
 
	$š‹rçû
(
£lf
):

229 
If
 
the
 
£rv”
 
is
 
li¡’šg
 
Ú
 '0.0.0.0' (
INADDR_ANY
)

230 
Ü
 '::' (
IN6ADDR_ANY
), 
this
 
wl
  
the
 
´İ”
 
loÿlho¡
."""

231  
	$š‹rçû
(
£lf
.
HOST
)

233 
def
 
	`g‘Page
(
£lf
, 
u¾
, 
h—d”s
=
NÚe
, 
m‘hod
="GET", 
body
=NÚe, 
´ÙocŞ
=None):

235 
S”v”E¼Ü
.
Ú
 = 
F®£


237 
	$isš¡ªû
(
u¾
, 
unicode¡r
):

238 
u¾
 = u¾.
	`’code
('utf-8')

239 
	$isš¡ªû
(
body
, 
unicode¡r
):

240 
body
 = body.
	`’code
('utf-8')

242 
£lf
.
u¾
 = url

243 
£lf
.
time
 = 
NÚe


244 
¡¬t
 = 
time
.
	$time
()

245 
»suÉ
 = 
	$İ’URL
(
u¾
, 
h—d”s
, 
m‘hod
, 
body
, 
£lf
.
HOST
, s–f.
PORT
,

246 
£lf
.
HTTP_CONN
, 
´ÙocŞ
 
Ü
 s–f.
PROTOCOL
)

247 
£lf
.
time
 =ime.
	`time
(è- 
¡¬t


248 
£lf
.
¡©us
, s–f.
h—d”s
, s–f.
body
 = 
»suÉ


250 #Bud 
a
 
li¡
 
of
 
»que¡
 
cook›s
 
äom
 
the
 
´evious
 
»¥Ú£
 cookies.

251 
£lf
.
cook›s
 = [('Cook›', 
v
è
k
, v 
š
 s–f.
h—d”s


252 
k
.
	`low”
() == 'set-cookie']

254 
S”v”E¼Ü
.
Ú
:

255 
¿i£
 
	$S”v”E¼Ü
()

256  
»suÉ


258 
š‹¿ùive
 = 
True


259 
cÚsŞe_height
 = 30

261 
def
 
	$_hªdËwebE¼Ü
(
£lf
, 
msg
):

262 
	`´št
("")

263 
	`´št
(" ERROR: %s" % 
msg
)

265 
nÙ
 
£lf
.
š‹¿ùive
:

266 
¿i£
 
£lf
.
	$çu»Exû±iÚ
(
msg
)

268 
p
 = " Show: [B]ody [H]eaders [S]tatus [U]RL; [I]gnore, [R]aise, or sys.e[X]it >> "

269 
sys
.
¡dout
.
	$wr™e
(
p
)

270 
sys
.
¡dout
.
	$æush
()

271 
True
:

272 
i
 = 
	`g‘ch¬
().
	$uµ”
()

273 
nÙ
 
	`isš¡ªû
(
i
, 
	`ty³
("")):

274 
i
 = i.
	`decode
('ascii')

275 
i
 
nÙ
 
š
 "BHSUIRX":

277 
	`´št
(
i
.
	$uµ”
()è#AlsØ
´šts
 
Ãw
 
lše


278 
i
 == "B":

279 
x
, 
lše
 
š
 
	`’um”©e
(
£lf
.
body
.
	$¥l™lšes
()):

280 ià(
x
 + 1è% 
£lf
.
cÚsŞe_height
 == 0:

281 #Th\
r
 
ªd
 
comma
 
should
 
make
 
the
 
Ãxt
 
lše
 
ov”wr™e


282 
sys
.
¡dout
.
	`wr™e
("<-- More -->\r")

283 
m
 = 
	`g‘ch¬
().
	$low”
()

284 #E¿£ 
our
 "MÜe" 
´om±


285 
sys
.
¡dout
.
	`wr™e
(" \r")

286 
m
 == "q":

288 
	$´št
(
lše
)

289 
–if
 
i
 == "H":

290 
µršt
.
	$µršt
(
£lf
.
h—d”s
)

291 
–if
 
i
 == "S":

292 
	$´št
(
£lf
.
¡©us
)

293 
–if
 
i
 == "U":

294 
	$´št
(
£lf
.
u¾
)

295 
–if
 
i
 == "I":

296 #»tuº 
w™hout
 
¿isšg
 
the
 
nÜm®
 
exû±iÚ


298 
–if
 
i
 == "R":

299 
¿i£
 
£lf
.
	$çu»Exû±iÚ
(
msg
)

300 
–if
 
i
 == "X":

301 
£lf
.
	$ex™
()

302 
sys
.
¡dout
.
	$wr™e
(
p
)

303 
sys
.
¡dout
.
	$æush
()

305 
def
 
	$ex™
(
£lf
):

306 
sys
.
	$ex™
()

308 
def
 
	$as£¹Stus
(
£lf
, 
¡©us
, 
msg
=
NÚe
):

310 
	$isš¡ªû
(
¡©us
, 
ba£¡ršg
):

311 
nÙ
 
£lf
.
¡©us
 == status:

312 
msg
 
is
 
NÚe
:

313 
msg
 = 'Stu (%rè!ğ%r' % (
£lf
.
¡©us
, status)

314 
£lf
.
	$_hªdËwebE¼Ü
(
msg
)

315 
–if
 
	$isš¡ªû
(
¡©us
, ):

316 
code
 = (
£lf
.
¡©us
[:3])

317 
code
 !ğ
¡©us
:

318 
msg
 
is
 
NÚe
:

319 
msg
 = 'Stu (%rè!ğ%r' % (
£lf
.
¡©us
, status)

320 
£lf
.
	$_hªdËwebE¼Ü
(
msg
)

322 #¡©u 
is
 
a
 
tu¶e
 
Ü
 
li¡
.

323 
m©ch
 = 
F®£


324 
s
 
š
 
¡©us
:

325 
	$isš¡ªû
(
s
, 
ba£¡ršg
):

326 
£lf
.
¡©us
 =ğ
s
:

327 
m©ch
 = 
True


329 
–if
 (
£lf
.
¡©us
[:3]è=ğ
s
:

330 
m©ch
 = 
True


332 
nÙ
 
m©ch
:

333 
msg
 
is
 
NÚe
:

334 
msg
 = 'Stu (%rènÙ iÀ%r' % (
£lf
.
¡©us
, status)

335 
£lf
.
	$_hªdËwebE¼Ü
(
msg
)

337 
def
 
	$as£¹H—d”
(
£lf
, 
key
, 
v®ue
=
NÚe
, 
msg
=None):

339 
lowkey
 = 
key
.
	$low”
()

340 
k
, 
v
 
š
 
£lf
.
h—d”s
:

341 
k
.
	`low”
(è=ğ
lowkey
:

342 
v®ue
 
is
 
NÚe
 
Ü
 
	`¡r
(v®ueè=ğ
v
:

343  
v


345 
msg
 
is
 
NÚe
:

346 
v®ue
 
is
 
NÚe
:

347 
msg
 = '%¸nÙ iÀh—d”s' % 
key


349 
msg
 = '%r:%¸nÙ iÀh—d”s' % (
key
, 
v®ue
)

350 
£lf
.
	$_hªdËwebE¼Ü
(
msg
)

352 
def
 
	$as£¹H—d”In
(
£lf
, 
key
, 
v®ues
, 
msg
=
NÚe
):

354 
lowkey
 = 
key
.
	$low”
()

355 
k
, 
v
 
š
 
£lf
.
h—d”s
:

356 
k
.
	`low”
(è=ğ
lowkey
:

357 
m©ches
 = [
v®ue
 v®u
š
 
v®ues
 
	`¡r
(v®ueè=ğ
v
]

358 
m©ches
:

359  
m©ches


361 
msg
 
is
 
NÚe
:

362 
msg
 = '%(keyì‚Ù iÀ%(v®uesì' % 
	$v¬s
()

363 
£lf
.
	$_hªdËwebE¼Ü
(
msg
)

365 
def
 
	$as£¹H—d”I‹mV®ue
(
£lf
, 
key
, 
v®ue
, 
msg
=
NÚe
):

367 
aùu®_v®ue
 = 
£lf
.
	$as£¹H—d”
(
key
, 
msg
=msg)

368 
h—d”_v®ues
 = 
	`m­
(
¡r
.
¡r
, 
aùu®_v®ue
.
	`¥l™
(','))

369 
v®ue
 
š
 
h—d”_v®ues
:

370  
v®ue


372 
msg
 
is
 
NÚe
:

373 
msg
 = "%¸nÙ iÀ%r" % (
v®ue
, 
h—d”_v®ues
)

374 
£lf
.
	$_hªdËwebE¼Ü
(
msg
)

376 
def
 
	$as£¹NoH—d”
(
£lf
, 
key
, 
msg
=
NÚe
):

378 
lowkey
 = 
key
.
	$low”
()

379 
m©ches
 = [
k
 k, 
v
 
š
 
£lf
.
h—d”s
 k.
	`low”
(è=ğ
lowkey
]

380 
m©ches
:

381 
msg
 
is
 
NÚe
:

382 
msg
 = '%¸š h—d”s' % 
key


383 
£lf
.
	$_hªdËwebE¼Ü
(
msg
)

385 
def
 
	$as£¹Body
(
£lf
, 
v®ue
, 
msg
=
NÚe
):

387 
	$isš¡ªû
(
v®ue
, 
unicode¡r
):

388 
v®ue
 = v®ue.
	$’code
(
£lf
.
’codšg
)

389 
v®ue
 !ğ
£lf
.
body
:

390 
msg
 
is
 
NÚe
:

391 
msg
 = 'ex³ùed body:\n%r\n\Çùu® body:\n%r' % (
v®ue
, 
£lf
.
body
)

392 
£lf
.
	$_hªdËwebE¼Ü
(
msg
)

394 
def
 
	$as£¹InBody
(
£lf
, 
v®ue
, 
msg
=
NÚe
):

396 
	$isš¡ªû
(
v®ue
, 
unicode¡r
):

397 
v®ue
 = v®ue.
	$’code
(
£lf
.
’codšg
)

398 
v®ue
 
nÙ
 
š
 
£lf
.
body
:

399 
msg
 
is
 
NÚe
:

400 
msg
 = '%¸nÙ iÀbody: %s' % (
v®ue
, 
£lf
.
body
)

401 
£lf
.
	$_hªdËwebE¼Ü
(
msg
)

403 
def
 
	$as£¹NÙInBody
(
£lf
, 
v®ue
, 
msg
=
NÚe
):

405 
	$isš¡ªû
(
v®ue
, 
unicode¡r
):

406 
v®ue
 = v®ue.
	$’code
(
£lf
.
’codšg
)

407 
v®ue
 
š
 
£lf
.
body
:

408 
msg
 
is
 
NÚe
:

409 
msg
 = '%¸found iÀbody' % 
v®ue


410 
£lf
.
	$_hªdËwebE¼Ü
(
msg
)

412 
def
 
	$as£¹M©chesBody
(
£lf
, 
·‰”n
, 
msg
=
NÚe
, 
æags
=0):

414 
	$isš¡ªû
(
·‰”n
, 
unicode¡r
):

415 
·‰”n
 =…©‹º.
	$’code
(
£lf
.
’codšg
)

416 
»
.
	$£¬ch
(
·‰”n
, 
£lf
.
body
, 
æags
è
is
 
NÚe
:

417 
msg
 
is
 
NÚe
:

418 
msg
 = 'NØm©ch fÜ %¸š body' % 
·‰”n


419 
£lf
.
	$_hªdËwebE¼Ü
(
msg
)

422 
m‘hods_w™h_bod›s
 = ("POST", "PUT")

424 
def
 
	$ş—nH—d”s
(
h—d”s
, 
m‘hod
, 
body
, 
ho¡
, 
pÜt
):

426 
h—d”s
 
is
 
NÚe
:

427 
h—d”s
 = []

429 #Add 
the
 
»quœed
 
Ho¡
 
»que¡
 
h—d”
 
nÙ
 
´e£Á
.

430 #[
This
 
¥ecif›s
 
the
 
ho¡
:
pÜt
 
of
h
£rv”
, 
nÙ
h
ş›Á
.]

431 
found
 = 
F®£


432 
k
, 
v
 
š
 
h—d”s
:

433 
k
.
	`low”
() == 'host':

434 
found
 = 
True


436 
nÙ
 
found
:

437 
pÜt
 == 80:

438 
h—d”s
.
	`­³nd
(("Ho¡", 
ho¡
))

440 
h—d”s
.
	`­³nd
(("Ho¡", "%s:%s" % (
ho¡
, 
pÜt
)))

442 
m‘hod
 
š
 
m‘hods_w™h_bod›s
:

443 #Stick 
š
  
ty³
 
ªd
 
Ëngth
 
h—d”s
 
nÙ
 
´e£Á


444 
found
 = 
F®£


445 
k
, 
v
 
š
 
h—d”s
:

446 
k
.
	`low”
() == 'content-type':

447 
found
 = 
True


449 
nÙ
 
found
:

450 
h—d”s
.
	`­³nd
(("Content-Type", "application/x-www-form-urlencoded"))

451 
h—d”s
.
	`­³nd
(("CÚ‹Á-L’gth", 
	`¡r
(
	`Ën
(
body
 
Ü
 ""))))

453  
h—d”s


456 
def
 
	$shb
(
»¥Ú£
):

458 
py3k
:

459 
h
 = 
»¥Ú£
.
	$g‘h—d”s
()

461 
h
 = []

462 
key
, 
v®ue
 = 
NÚe
, None

463 
lše
 
š
 
»¥Ú£
.
msg
.
h—d”s
:

464 
lše
:

465 
lše
[0] 
š
 " \t":

466 
v®ue
 +ğ
lše
.
	$¡r
()

468 
key
 
ªd
 
v®ue
:

469 
h
.
	`­³nd
((
key
, 
v®ue
))

470 
key
, 
v®ue
 = 
lše
.
	`¥l™
(":", 1)

471 
key
 = key.
	$¡r
()

472 
v®ue
 = v®ue.
	$¡r
()

473 
key
 
ªd
 
v®ue
:

474 
h
.
	`­³nd
((
key
, 
v®ue
))

476  "% %s" % (
»¥Ú£
.
¡©us
,„e¥Ú£.
»asÚ
), 
h
,„e¥Ú£.
	$»ad
()

479 
def
 
	`İ’URL
(
u¾
, 
h—d”s
=
NÚe
, 
m‘hod
="GET", 
body
=None,

480 
ho¡
="127.0.0.1", 
pÜt
=8000, 
h‰p_cÚn
=
HTTPCÚÃùiÚ
,

481 
´ÙocŞ
="HTTP/1.1"):

484 
h—d”s
 = 
	$ş—nH—d”s
(
h—d”s
, 
m‘hod
, 
body
, 
ho¡
, 
pÜt
)

486 #Tryšg 10 
times
 
is
 
sim¶y
 
š
 
of
 
sock‘
 
”rÜs
.

487 #NÜm® --
™
 
should
 
run
 
Úû
.

488 
ŒŸl
 
š
 
	$¿nge
(10):

489 
Œy
:

490 #AÎow 
h‰p_cÚn
 
to
 
be
 
a
 
şass
 
Ü
 
ª
 
š¡ªû


491 
	`ha§‰r
(
h‰p_cÚn
, "host"):

492 
cÚn
 = 
h‰p_cÚn


494 
cÚn
 = 
	`h‰p_cÚn
(
	`š‹rçû
(
ho¡
), 
pÜt
)

496 
cÚn
.
_h‰p_v¢_¡r
 = 
´ÙocŞ


497 
cÚn
.
_h‰p_v¢
 = ("".
	`još
([
x
 x 
š
 
´ÙocŞ
 x.
	`isdig™
()]))

499 #sk_acû±_’codšg 
¬gum’t
 
added
 
š
 
pythÚ
 
v”siÚ
 2.4

500 
sys
.
v”siÚ_šfo
 < (2, 4):

501 
def
 
	$puth—d”
(
£lf
, 
h—d”
, 
v®ue
):

502 
h—d”
 =ğ'Acû±-Encodšg' 
ªd
 
v®ue
 == 'identity':

504 
£lf
.
__şass__
.
	$puth—d”
(
£lf
, 
h—d”
, 
v®ue
)

505 
impÜt
 
Ãw


506 
cÚn
.
puth—d”
 = 
Ãw
.
	$š¡ªûm‘hod
(
puth—d”
, 
cÚn
, cÚn.
__şass__
)

507 
cÚn
.
	`puŒeque¡
(
m‘hod
.
	`uµ”
(), 
u¾
, 
sk_ho¡
=
True
)

508 
–if
 
nÙ
 
py3k
:

509 
cÚn
.
	`puŒeque¡
(
m‘hod
.
	`uµ”
(), 
u¾
, 
sk_ho¡
=
True
,

510 
sk_acû±_’codšg
=
True
)

512 
impÜt
 
h‰p
.
ş›Á


513 #R•Ïû 
the
 
¡dlib
 
m‘hod
, 
which
 
Úly
 
acû±s
 
ASCII
 
u¾
's

514 
def
 
	$puŒeque¡
(
£lf
, 
m‘hod
, 
u¾
):

515 
£lf
.
_HTTPCÚÃùiÚ__»¥Ú£
 
ªd
 s–f._HTTPCÚÃùiÚ__»¥Ú£.
	$isşo£d
():

516 
£lf
.
_HTTPCÚÃùiÚ__»¥Ú£
 = 
NÚe


518 
£lf
.
_HTTPCÚÃùiÚ__¡©e
 =ğ
h‰p
.
ş›Á
.
_CS_IDLE
:

519 
£lf
.
_HTTPCÚÃùiÚ__¡©e
 = 
h‰p
.
ş›Á
.
_CS_REQ_STARTED


521 
¿i£
 
h‰p
.
ş›Á
.
	$CªnÙS’dReque¡
()

523 
£lf
.
_m‘hod
 = 
m‘hod


524 
nÙ
 
u¾
:

525 
u¾
 = 
	`Áob
('/')

526 
»que¡
 = 
	`Áob
(' ').
	`još
((
m‘hod
.
	`’code
("ASCII"), 
u¾
,

527 
£lf
.
_h‰p_v¢_¡r
.
	`’code
("ASCII")))

528 
£lf
.
	$_ouut
(
»que¡
)

529 
impÜt
 
ty³s


530 
cÚn
.
puŒeque¡
 = 
ty³s
.
	$M‘hodTy³
(
puŒeque¡
, 
cÚn
)

532 
cÚn
.
	`puŒeque¡
(
m‘hod
.
	`uµ”
(), 
u¾
)

534 
key
, 
v®ue
 
š
 
h—d”s
:

535 
cÚn
.
	`puth—d”
(
key
, 
v®ue
.
	`’code
("Latin-1"))

536 
cÚn
.
	$’dh—d”s
()

538 
body
 
is
 
nÙ
 
NÚe
:

539 
cÚn
.
	$£nd
(
body
)

541 #HªdË 
»¥Ú£


542 
»¥Ú£
 = 
cÚn
.
	$g‘»¥Ú£
()

544 
s
, 
h
, 
b
 = 
	$shb
(
»¥Ú£
)

546 
nÙ
 
	`ha§‰r
(
h‰p_cÚn
, "host"):

547 #W
made
 
our
 
own
 
cÚn
 
š¡ªû
. 
Clo£
 
™
.

548 
cÚn
.
	$şo£
()

550  
s
, 
h
, 
b


551 
exû±
 
sock‘
.
”rÜ
:

552 
time
.
	$¦“p
(0.5)

553 
ŒŸl
 == 9:

554 
¿i£


557 #Add 
ªy
 
exû±iÚs
 
which
 
your
 
web
 
äamewÜk
 
hªdËs


558 #nÜm®ly (
th©
 
you
 
dÚ
't want server_errororap).

559 
ignÜed_exû±iÚs
 = []

561 #You'Î wªˆ£ˆthi tØTruwh’ you cª'
t
 
gu¬ª‹e


562 #th© 
—ch
 
»¥Ú£
 
wl
 
immedŸ‹ly
 
fŞlow
ƒach 
»que¡
;

563 #fÜ 
exam¶e
, 
wh’
 
hªdlšg
 
»que¡s
 
vŸ
 
muÉË
 
th»ads
.

564 
ignÜe_®l
 = 
F®£


566 
şass
 
	$S”v”E¼Ü
(
Exû±iÚ
):

567 
Ú
 = 
F®£


570 
def
 
	$£rv”_”rÜ
(
exc
=
NÚe
):

573 
You
 
´obably
 
wªt
 
to
 
w¿p
 
this
, 
so
 
you
 
ÿn
 
¡l
 
hªdË
 
ª
 
”rÜ
 
usšg


574 
your
 
äamewÜk
 
wh’
 
™
's ignored.

576 
exc
 
is
 
NÚe
:

577 
exc
 = 
sys
.
	$exc_šfo
()

579 
ignÜe_®l
 
Ü
 
exc
[0] 
š
 
ignÜed_exû±iÚs
:

580  
F®£


582 
S”v”E¼Ü
.
Ú
 = 
True


583 
	`´št
("")

584 
	`´št
("".
	`još
(
Œaûback
.
	$fÜm©_exû±iÚ
(*
exc
)))

585  
True


	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/tutorial/__init__.py

2 #Thi 
is
 
u£d
 
š
 
‹¡_cÚfig
 
to
 
‹¡
 
uÄ•r
 
of
 "from A import B"

3 
	gthšg2
 = 
objeù
()

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/tutorial/bonus-sqlobject.py

2 
BÚus
 
	gTutÜŸl
: 
Usšg
 
SQLObjeù


4 
This
 
is
 
a
 
sly
 
l™e
 
cÚùs
 
mªag”
 
­¶iÿtiÚ
 
š‹nded
 
to


5 
demÚ¡¿‹
 
how
 
to
 
u£
 
SQLObjeù
 
äom
 
w™hš
 
a
 
Ch”ryPy2
 
´ojeù
. 
It


6 
®so
 
shows
 
how
 
to
 
u£
 
šlše
 
Ch“h
 
‹m¶©es
.

8 
SQLObjeù
 
is
 
ª
 
Objeù
/
R–©iÚ®
 
M­³r
 
th©
 
®lows
 
you
 
to
 
acûss


9 
d©a
 
¡Üed
 
š
 
ª
 
RDBMS
 iÀ
a
 
pythÚic
 
çshiÚ
. 
You
 
ü—‹
 d©¨
objeùs


10 
as
 
PythÚ
 
şas£s
 
ªd
 
Ët
 
SQLObjeù
 
ke
 
ÿ»
 
of
 
®l
 
the
 
Ç¡y
 
d‘as
.

12 
This
 
code
 
d•’ds
 
Ú
 
the
 
Ï‹¡
 
dev–İm’t
 
v”siÚ
 (0.6+è
of
 
SQLObjeù
.

13 
You
 
ÿn
 
g‘
 
™
 
äom
 
the
 
SQLObjeù
 
Subv”siÚ
 
£rv”
. You cª 
fšd
 
®l


14 
Ãûs§ry
 
šfÜm©iÚ
 
©
 <
h‰p
:

15 
wÜk
 
w™h
 
the
 0.5.x 
v”siÚ
 
adv”ti£d
 
Ú
 
theœ
 
webs™e
!

17 
This
 
code
 
®so
 
d•’ds
 
Ú
 
a
 
»ûÁ
 
v”siÚ
 
of
 
Ch“h
. 
You
 
ÿn
 
fšd


18 
Ch“h
 
©
 <
h‰p
:

20 
Aá”
 
¡¬tšg
 
this
 
­¶iÿtiÚ
 
the
 
fœ¡
 
time
, 
you
 
wl
 
Ãed
 
to


21 
acûss
 
	gthe
 /
»£t
 
URI
 
š
 
Üd”
 
to
 
ü—‹
 
the
 
d©aba£
 
bË
 
ªd
 
some


22 
§m¶e
 
	gd©a
. 
	gAcûssšg
 /
»£t
 
agaš
 
wl
 
drİ
 
ªd
 
	g»
-
ü—‹
 
the
 
	gbË
,

23 
so
 
you
 
may
 
wªt
 
to
 
be
 
	gÿ»ful
. :-)

25 
This
 
­¶iÿtiÚ
 
i¢
'ˆsuµo£dØbfoŞ-´oof, it'
s
 
nÙ
 
ev’
 
suµo£d


26 
to
 
be
 
v”y
 
GOOD
. 
PÏy
 
¬ound
 
w™h
 
™
 
some
, 
brow£
 
the
 
sourû
 
	gcode
, 
	gsme
.

30 -- 
H’drik
 
Mªs
 <
h’drik
@
mªs
.
de
>

33 
impÜt
 
ch”rypy


34 
äom
 
Ch“h
.
Tem¶©e
 
impÜt
 Template

35 
äom
 
sqlobjeù
 
impÜt
 *

37 #cÚfigu» 
your
 
d©aba£
 
cÚÃùiÚ
 
h”e


38 
__cÚÃùiÚ__
 = 'mysql://root:@localhost/test'

40 #thi 
is
 
our
 (
Úly
è
d©a
 
şass
.

41 
şass
 
	$CÚù
(
SQLObjeù
):

42 
Ï¡Name
 = 
	$SŒšgCŞ
(
Ëngth
 = 50, 
nÙNÚe
 = 
True
)

43 
fœ¡Name
 = 
	$SŒšgCŞ
(
Ëngth
 = 50, 
nÙNÚe
 = 
True
)

44 
phÚe
 = 
	`SŒšgCŞ
(
Ëngth
 = 30, 
nÙNÚe
 = 
True
,  = '')

45 
ema
 = 
	`SŒšgCŞ
(
Ëngth
 = 30, 
nÙNÚe
 = 
True
,  = '')

46 
u¾
 = 
	`SŒšgCŞ
(
Ëngth
 = 100, 
nÙNÚe
 = 
True
,  = '')

49 
şass
 
CÚùMªag”
:

50 
def
 
	$šdex
(
£lf
):

52 
cÚùs
 = 
CÚù
.
	$£Ëù
()

54 
‹m¶©e
 = 
	`Tem¶©e
('''

55 <
h2
>
AÎ
 
CÚùs
</h2>

57 #fÜ 
$cÚù
 
š
 
$cÚùs


58 <
a
 
h»f
="mato:$cÚù.ema">
$cÚù
.
Ï¡Name
, $cÚù.
fœ¡Name
</a>

59 [<
a
 
h»f
="./ed™?id=$cÚù.id">
Ed™
</a>]

60 [<
a
 
h»f
="./d–‘e?id=$cÚù.id">
D–‘e
</a>]

61 <
br
/>

64 <
p
>[<
a
 
h»f
="./ed™">
Add
 
Ãw
 
cÚù
</a>]</p>

67  
‹m¶©e
.
	$»¥Úd
()

69 
šdex
.
expo£d
 = 
True


72 
def
 
	$ed™
(
£lf
, 
id
 = 0):

73 #w
»®ly
 
wªt
 
id
 
as
 
ª
 
š‹g”
. 
Sšû
 
GET
/
POST
 
·¿m‘”s


74 #¬
®ways
 
·s£d
 
as
 
¡ršgs
, 
Ët
's convert it.

75 
id
 = (id)

77 
id
 > 0:

78 #ià
ª
 
id
 
is
 
¥ecif›d
, 
we
'reƒditing‡nƒxisting contact.

79 
cÚù
 = 
CÚù
.
	$g‘
(
id
)

80 
t™Ë
 = "Edit Contact"

82 #ià
no
 
id
 
is
 
¥ecif›d
, 
we
'reƒntering‡‚ew contact.

83 
cÚù
 = 
NÚe


84 
t™Ë
 = "New Contact"

87 #IÀ
the
 
fŞlowšg
 
‹m¶©e
 
code
, 
¶—£
 
nÙe
 
th©
 
we
 
u£


89 #tØdØ
this
 
beÿu£
 
cÚù
 
may
 
be
 
£t
 
to
 
	`NÚe
 (
£e
 
above
).

90 
‹m¶©e
 = 
	`Tem¶©e
('''

91 <
h2
>
$t™Ë
</h2>

93 <
fÜm
 
aùiÚ
="./¡Üe" 
m‘hod
="POST">

94 <
šput
 
ty³
="hidd’" 
Çme
="id" 
v®ue
="$id" />

95 
La¡
 
Name
: <
šput
 
Çme
="Ï¡Name" 
v®ue
="$g‘V¬('cÚù.Ï¡Name', '')" /><
br
/>

96 
Fœ¡
 
Name
: <
šput
 
Çme
="fœ¡Name" 
v®ue
="$g‘V¬('cÚù.fœ¡Name', '')" /><
br
/>

97 
PhÚe
: <
šput
 
Çme
="phÚe" 
v®ue
="$g‘V¬('cÚù.phÚe', '')" /><
br
/>

98 
Ema
: <
šput
 
Çme
="ema" 
v®ue
="$g‘V¬('cÚù.ema', '')" /><
br
/>

99 
URL
: <
šput
 
Çme
="u¾" 
v®ue
="$g‘V¬('cÚù.u¾', '')" /><
br
/>

100 <
šput
 
ty³
="subm™" 
v®ue
="Store" />

101 </
fÜm
>

104  
‹m¶©e
.
	$»¥Úd
()

106 
ed™
.
expo£d
 = 
True


109 
def
 
	$d–‘e
(
£lf
, 
id
):

110 #D–‘
the
 
¥ecif›d
 
cÚù


111 
cÚù
 = 
CÚù
.
	`g‘
((
id
))

112 
cÚù
.
	$de¡royS–f
()

115 
d–‘e
.
expo£d
 = 
True


118 
def
 
	$¡Üe
(
£lf
, 
Ï¡Name
, 
fœ¡Name
, 
phÚe
, 
ema
, 
u¾
, 
id
 = 
NÚe
):

119 
id
 
ªd
 (id) > 0:

120 #Ià
ª
 
id
 
was
 
¥ecif›d
, 
upd©e
‡À
exi¡šg
 
cÚù
.

121 
cÚù
 = 
CÚù
.
	`g‘
((
id
))

123 #W
could
 
£t
 
Úe
 
f›ld
 
aá”
 
ªÙh”
, 
but
 
th©
 
would


124 #ÿu£ 
muÉË
 
UPDATE
 
şau£s
. 
So
 
we
'll just do it‡ll

125 #š 
a
 
sšgË
 
·ss
 
through
 
the
 
	`£t
(è
m‘hod
.

126 
cÚù
.
	$£t
(

127 
Ï¡Name
 =†astName,

128 
fœ¡Name
 = firstName,

129 
phÚe
 =…hone,

130 
ema
 =ƒmail,

131 
u¾
 = url)

133 #Oth”wi£, 
add
 
a
 
Ãw
 
cÚù
.

134 
cÚù
 = 
	$CÚù
(

135 
Ï¡Name
 =†astName,

136 
fœ¡Name
 = firstName,

137 
phÚe
 =…hone,

138 
ema
 =ƒmail,

139 
u¾
 = url)

143 
¡Üe
.
expo£d
 = 
True


146 
def
 
	$»£t
(
£lf
):

147 #Drİ 
exi¡šg
 
bË


148 
CÚù
.
	$drİTabË
(
True
)

150 #C»©
Ãw
 
bË


151 
CÚù
.
	$ü—‹TabË
()

153 #C»©
some
 
§m¶e
 
d©a


154 
	`CÚù
(

155 
fœ¡Name
 = 'Hendrik',

156 
Ï¡Name
 = 'Mans',

157 
ema
 = 'hendrik@mans.de',

158 
phÚe
 = '++49 89 12345678',

159 
u¾
 = 'http://www.mornography.de')

163 
»£t
.
expo£d
 = 
True


166 
	`´št
("If you're„unninghis‡pplication forhe firstime,…lease goo http://localhost:8080/reset once in ordero createhe database!")

168 
ch”rypy
.
	`quick¡¬t
(
	`CÚùMªag”
())

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/tutorial/tut01_helloworld.py

2 
	gTutÜŸl
 - 
H–lo
 
WÜld


4 
The
 
mo¡
 
	$basic
 (
wÜkšg
è
Ch”ryPy
 
­¶iÿtiÚ
 
possibË
.

7 #ImpÜˆ
Ch”ryPy
 
glob®
 
Çme¥aû


8 
impÜt
 
ch”rypy


10 
şass
 
H–loWÜld
:

13 
def
 
	$šdex
(
£lf
):

14 #Ch”ryPy 
wl
 
ÿÎ
 
this
 
m‘hod
 
the
 
roÙ
 
	`URI
 ("/"è
ªd
 
£nd


15 #™  
v®ue
 
to
 
the
 
ş›Á
. 
Beÿu£
 
this
 
is
 
tutÜŸl


16 #ËssÚ 
numb”
 01, 
we
'll just send something„eally simple.

17 #How 
about
...

20 #Expo£ 
the
 
šdex
 
m‘hod
 
through
h
web
. 
Ch”ryPy
 
wl
 
Ãv”


21 #publish 
m‘hods
 
th©
 
dÚ
't haveheƒxposed‡ttribute seto True.

22 
šdex
.
expo£d
 = 
True


25 
impÜt
 
os
.
·th


26 
tutcÚf
 = 
os
.
·th
.
	`još
(os.·th.
	`dœÇme
(
__fe__
), 'tutorial.conf')

28 
__Çme__
 == '__main__':

29 #Ch”ryPy 
®ways
 
¡¬ts
 
w™h
 
­p
.
roÙ
 
wh’
 
Œyšg
 
to
 
m­
 
»que¡
 
URIs


30 #tØ
objeùs
, 
so
 
we
 
Ãed
 
to
 
mouÁ
 
a
 
»que¡
 
hªdËr
 
roÙ
. 
A
„equest

31 #tØ'/' 
wl
 
be
 
m­³d
 
to
 
	`H–loWÜld
().
	`šdex
().

32 
ch”rypy
.
	`quick¡¬t
(
	`H–loWÜld
(), 
cÚfig
=
tutcÚf
)

34 #Thi 
b¿nch
 
is
 
the
 
‹¡
 
su™e
; 
you
 
ÿn
 
ignÜe
 
™
.

35 
ch”rypy
.
Œ“
.
	`mouÁ
(
	`H–loWÜld
(), 
cÚfig
=
tutcÚf
)

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/tutorial/tut02_expose_methods.py

2 
	gTutÜŸl
 - 
MuÉË
 
m‘hods


4 
This
 
tutÜŸl
 
shows
 
you
 
how
 
to
 
lšk
Ø
Ùh”
 
m‘hods
 
of
 
your
 
»que¡


5 
	ghªdËr
.

8 
impÜt
 
ch”rypy


10 
şass
 
	gH–loWÜld
:

12 
def
 
	$šdex
(
£lf
):

15 
šdex
.
expo£d
 = 
True


17 
def
 
	$showMes§ge
(
£lf
):

20 
showMes§ge
.
expo£d
 = 
True


22 
impÜt
 
os
.
·th


23 
tutcÚf
 = 
os
.
·th
.
	`još
(os.·th.
	`dœÇme
(
__fe__
), 'tutorial.conf')

25 
__Çme__
 == '__main__':

26 #Ch”ryPy 
®ways
 
¡¬ts
 
w™h
 
­p
.
roÙ
 
wh’
 
Œyšg
 
to
 
m­
 
»que¡
 
URIs


27 #tØ
objeùs
, 
so
 
we
 
Ãed
 
to
 
mouÁ
 
a
 
»que¡
 
hªdËr
 
roÙ
. 
A
„equest

28 #tØ'/' 
wl
 
be
 
m­³d
 
to
 
	`H–loWÜld
().
	`šdex
().

29 
ch”rypy
.
	`quick¡¬t
(
	`H–loWÜld
(), 
cÚfig
=
tutcÚf
)

31 #Thi 
b¿nch
 
is
 
the
 
‹¡
 
su™e
; 
you
 
ÿn
 
ignÜe
 
™
.

32 
ch”rypy
.
Œ“
.
	`mouÁ
(
	`H–loWÜld
(), 
cÚfig
=
tutcÚf
)

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/tutorial/tut03_get_and_post.py

2 
	gTutÜŸl
 - 
Passšg
 
v¬ŸbËs


4 
This
 
tutÜŸl
 
shows
 
you
 
how
 
to
 
·ss
 
	gGET
/
POST
 
v¬ŸbËs
Ø
	gm‘hods
.

7 
impÜt
 
ch”rypy


10 
şass
 
	gW–comePage
:

12 
def
 
	$šdex
(
£lf
):

13 #Ask 
the
 
u£r
's‚ame.

15 <
fÜm
 
aùiÚ
="g»‘U£r" 
m‘hod
="GET">

16 
Wh©
 
is
 
your
 
Çme
?

17 <
šput
 
ty³
="‹xt" 
Çme
="name" />

18 <
šput
 
ty³
="submit" />

19 </
fÜm
>'''

20 
šdex
.
expo£d
 = 
True


22 
def
 
	$g»‘U£r
(
£lf
, 
Çme
 = 
NÚe
):

23 #Ch”ryPy 
·s£s
 
®l
 
GET
 
ªd
 
POST
 
v¬ŸbËs
 
as
 
m‘hod
 
·¿m‘”s
.

24 #Iˆ
dÛ¢
't make‡ difference wherehe variables come from, how

25 #Ïrg
theœ
 
cÚ‹Ás
 
¬e
, 
ªd
 
so
 
Ú
.

26 #
#You 
ÿn
 
defše
  
·¿m‘”
 
v®ues
 
as
 
usu®
. 
In
 
this


27 #exam¶e, 
the
 "Çme" 
·¿m‘”
 
deçuÉs
 
to
 
NÚe
 
so
 
we
 
ÿn
 
check


28 #ià
a
 
Çme
 
was
 
aùu®ly
 
¥ecif›d
.

30 
Çme
:

31 #G»‘ 
the
 
u£r
!

32  "Hey %s, wh©' up?" % 
Çme


34 
Çme
 
is
 
NÚe
:

35 #NØ
Çme
 
was
 
¥ecif›d


39 
g»‘U£r
.
expo£d
 = 
True


42 
impÜt
 
os
.
·th


43 
tutcÚf
 = 
os
.
·th
.
	`još
(os.·th.
	`dœÇme
(
__fe__
), 'tutorial.conf')

45 
__Çme__
 == '__main__':

46 #Ch”ryPy 
®ways
 
¡¬ts
 
w™h
 
­p
.
roÙ
 
wh’
 
Œyšg
 
to
 
m­
 
»que¡
 
URIs


47 #tØ
objeùs
, 
so
 
we
 
Ãed
 
to
 
mouÁ
 
a
 
»que¡
 
hªdËr
 
roÙ
. 
A
„equest

48 #tØ'/' 
wl
 
be
 
m­³d
 
to
 
	`H–loWÜld
().
	`šdex
().

49 
ch”rypy
.
	`quick¡¬t
(
	`W–comePage
(), 
cÚfig
=
tutcÚf
)

51 #Thi 
b¿nch
 
is
 
the
 
‹¡
 
su™e
; 
you
 
ÿn
 
ignÜe
 
™
.

52 
ch”rypy
.
Œ“
.
	`mouÁ
(
	`W–comePage
(), 
cÚfig
=
tutcÚf
)

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/tutorial/tut04_complex_site.py

2 
	gTutÜŸl
 - 
MuÉË
 
objeùs


4 
This
 
tutÜŸl
 
shows
 
you
 
how
 
to
 
ü—‹
 
a
 
s™e
 
¡ruùu»
 
through
 
muÉË


5 
possibly
 
Ã¡ed
 
»que¡
 
hªdËr
 
	gobjeùs
.

8 
impÜt
 
ch”rypy


11 
şass
 
	gHomePage
:

12 
def
 
	$šdex
(
£lf
):

14 <
p
>
Hi
, 
this
 
is
 
the
 
home
 
·ge
! 
Check
 
out
h
Ùh”


15 
fun
 
¡uff
 
Ú
 
this
 
s™e
:</
p
>

17 <
ul
>

18 <
li
><
a
 
h»f
="/joke/">
A
 
sly
 
joke
</a></li>

19 <
li
><
a
 
h»f
="/lšks/">
U£ful
 
lšks
</a></li>

20 </
ul
>'''

21 
šdex
.
expo£d
 = 
True


24 
şass
 
JokePage
:

25 
def
 
	$šdex
(
£lf
):

27 <
p
>"In Python, how do you create‡ string of„andom

28 
ch¬aù”s
?" -- "
R—d
 
a
 
P”l
 
fe
!"</p>

29 <
p
>[<
a
 
h»f
="../">
R‘uº
</a>]</p>'''

30 
šdex
.
expo£d
 = 
True


33 
şass
 
LšksPage
:

34 
def
 
	$__š™__
(
£lf
):

35 #Reque¡ 
hªdËr
 
objeùs
 
ÿn
 
ü—‹
 
theœ
 
own
 
Ã¡ed
 
»que¡


36 #hªdË¸
objeùs
. 
Sim¶y
 
ü—‹
 
them
 
šside
 
theœ
 
__š™__


38 
£lf
.
exŒa
 = 
	$ExŒaLšksPage
()

40 
def
 
	$šdex
(
£lf
):

41 #NÙ
the
 
way
 
we
 
lšk
 
to
h
exŒa
 
lšks
 
	`·ge
 (
ªd
 
back
).

42 #A 
you
 
ÿn
 
£e
, 
this
 
objeù
 
dÛ¢
't„eally care‡bout its

43 #absŞu‹ 
pos™iÚ
 
š
 
the
 
s™e
 
Œ“
, 
sšû
 
we
 
u£
 
»Ïtive


44 #lšk 
exşusiv–y
.

46 <
p
>
H”e
 
¬e
 
some
 
u£ful
 
lšks
:</p>

48 <
ul
>

49 <
li
><
a
 
h»f
="h‰p://www.ch”rypy.Üg">
The
 
Ch”ryPy
 
Hom•age
</a></li>

50 <
li
><
a
 
h»f
="h‰p://www.pythÚ.Üg">
The
 
PythÚ
 
Hom•age
</a></li>

51 </
ul
>

53 <
p
>
You
 
ÿn
 
check
 
out
 
some
 
exŒa
 
u£ful


54 
lšks
 <
a
 
h»f
="./exŒa/">
h”e
</a>.</
p
>

56 <
p
>[<
a
 
h»f
="../">
R‘uº
</a>]</p>

58 
šdex
.
expo£d
 = 
True


61 
şass
 
ExŒaLšksPage
:

62 
def
 
	$šdex
(
£lf
):

63 #NÙ
the
 
»Ïtive
 
lšk
 
back
 
to
h
Lšks
 
·ge
!

65 <
p
>
H”e
 
¬e
 
some
 
exŒa
 
u£ful
 
lšks
:</p>

67 <
ul
>

68 <
li
><
a
 
h»f
="h‰p://d–.icio.us">
d–
.
icio
.
us
</a></li>

69 <
li
><
a
 
h»f
="h‰p://www.mÜnog¿phy.de">
H’drik
's weblog</a></li>

70 </
ul
>

72 <
p
>[<
a
 
h»f
="../">
R‘uº
 
to
 
lšks
 
·ge
</a>]</p>'''

73 
šdex
.
expo£d
 = 
True


76 #Oà
cour£
 
we
 
ÿn
 
®so
 
mouÁ
 
»que¡
 
hªdËr
 
objeùs
 
right
 
h”e
!

77 
roÙ
 = 
	$HomePage
()

78 
roÙ
.
joke
 = 
	$JokePage
()

79 
roÙ
.
lšks
 = 
	$LšksPage
()

81 #Rememb”, 
we
 
dÚ
't‚eedo mount ExtraLinksPage here, because

82 #LšksPag
dÛs
 
th©
 
™£lf
 
Ú
 
š™Ÿliz©iÚ
. 
In
 
çù
, 
th”e
 
is


83 #nØ
»asÚ
 
why
 
you
 
shouldn
't†et your„oot objectake care of

84 #ü—tšg 
®l
 
cÚšed
 
»que¡
 
hªdËr
 
objeùs
.

87 
impÜt
 
os
.
·th


88 
tutcÚf
 = 
os
.
·th
.
	`još
(os.·th.
	`dœÇme
(
__fe__
), 'tutorial.conf')

90 
__Çme__
 == '__main__':

91 #Ch”ryPy 
®ways
 
¡¬ts
 
w™h
 
­p
.
roÙ
 
wh’
 
Œyšg
 
to
 
m­
 
»que¡
 
URIs


92 #tØ
objeùs
, 
so
 
we
 
Ãed
 
to
 
mouÁ
 
a
 
»que¡
 
hªdËr
 
roÙ
. 
A
„equest

93 #tØ'/' 
wl
 
be
 
m­³d
 
to
 
	`H–loWÜld
().
	`šdex
().

94 
ch”rypy
.
	$quick¡¬t
(
roÙ
, 
cÚfig
=
tutcÚf
)

96 #Thi 
b¿nch
 
is
 
the
 
‹¡
 
su™e
; 
you
 
ÿn
 
ignÜe
 
™
.

97 
ch”rypy
.
Œ“
.
	`mouÁ
(
roÙ
, 
cÚfig
=
tutcÚf
)

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/tutorial/tut05_derived_objects.py

2 
	gTutÜŸl
 - 
Objeù
 
šh”™ªû


4 
You
 
¬e
 
ä“
 
to
 
d”ive
 
your
 
»que¡
 
hªdËr
 
şas£s
 
äom
 
ªy
 
ba£


5 
şass
 
you
 
	gwish
. 
In
 
mo¡
 
	g»®
-
wÜld
 
	g­¶iÿtiÚs
, you 
wl
 
´obably


6 
wªt
 
to
 
ü—‹
 
a
 
ûÁ¿l
 
ba£
 
şass
 
u£d
 
®l
 
your
 
	g·ges
, 
which
 
kes


7 
ÿ»
 
of
 
thšgs
 
like
 
´štšg
 
a
 
commÚ
 
·ge
 
h—d”
 
ªd
 
	gfoÙ”
.

10 
impÜt
 
ch”rypy


13 
şass
 
	gPage
:

14 #StÜ
the
 
·ge
 
t™Ë
 
š
 
a
 
şass
 
©Œibu‹


15 
t™Ë
 = 'Untitled Page'

17 
def
 
	$h—d”
(
£lf
):

19 <
html
>

20 <
h—d
>

21 <
t™Ë
>%
s
</title>

22 <
h—d
>

23 <
body
>

24 <
h2
>%
s
</h2>

27 
def
 
	$foÙ”
(
£lf
):

29 </
body
>

30 </
html
>

33 #NÙ
th©
 
h—d”
 
ªd
 
foÙ”
 
dÚ
't getheirƒxposed‡ttributes

34 #£ˆ
to
 
True
. 
This
 
i¢
'ˆÃûs§ry sšûhu£¸i¢'
t
 
suµo£d


35 #tØ
ÿÎ
 
h—d”
 
Ü
 
foÙ”
 
dœeùly
; 
š¡—d
, 
we
'll callhem from

36 #w™hš 
the
 
aùu®ly
 
expo£d
 
hªdËr
 
m‘hods
 
defšed
 
š
 
this


40 
şass
 
	$HomePage
(
Page
):

41 #Difã»Á 
t™Ë
 
this
 
·ge


42 
t™Ë
 = 'Tutorial 5'

44 
def
 
	$__š™__
(
£lf
):

45 #ü—‹ 
a
 
sub·ge


46 
£lf
.
ªÙh”
 = 
	$AnÙh”Page
()

48 
def
 
	$šdex
(
£lf
):

49 #NÙ
th©
 
we
 
ÿÎ
 
the
 
h—d”
 
ªd
 
foÙ”
 
m‘hods
 
šh”™ed


50 #äom 
the
 
Page
 
şass
!

51  
£lf
.
	`h—d”
() + '''

52 <
p
>

53 
I¢
'ˆthi exc™šg? Th”e'
s


54 <
a
 
h»f
="./ªÙh”/">
ªÙh”
 
·ge
</a>, 
too
!

55 </
p
>

57 
šdex
.
expo£d
 = 
True


60 
şass
 
	$AnÙh”Page
(
Page
):

61 
t™Ë
 = 'Another Page'

63 
def
 
	$šdex
(
£lf
):

64  
£lf
.
	`h—d”
() + '''

65 <
p
>

66 
And
 
this
 
is
 
the
 
amazšg
 
£cÚd
 
·ge
!

67 </
p
>

69 
šdex
.
expo£d
 = 
True


72 
impÜt
 
os
.
·th


73 
tutcÚf
 = 
os
.
·th
.
	`još
(os.·th.
	`dœÇme
(
__fe__
), 'tutorial.conf')

75 
__Çme__
 == '__main__':

76 #Ch”ryPy 
®ways
 
¡¬ts
 
w™h
 
­p
.
roÙ
 
wh’
 
Œyšg
 
to
 
m­
 
»que¡
 
URIs


77 #tØ
objeùs
, 
so
 
we
 
Ãed
 
to
 
mouÁ
 
a
 
»que¡
 
hªdËr
 
roÙ
. 
A
„equest

78 #tØ'/' 
wl
 
be
 
m­³d
 
to
 
	`H–loWÜld
().
	`šdex
().

79 
ch”rypy
.
	`quick¡¬t
(
	`HomePage
(), 
cÚfig
=
tutcÚf
)

81 #Thi 
b¿nch
 
is
 
the
 
‹¡
 
su™e
; 
you
 
ÿn
 
ignÜe
 
™
.

82 
ch”rypy
.
Œ“
.
	`mouÁ
(
	`HomePage
(), 
cÚfig
=
tutcÚf
)

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/tutorial/tut06_default_method.py

2 
	gTutÜŸl
 - 
The
  
m‘hod


4 
Reque¡
 
hªdËr
 
objeùs
 
ÿn
 
im¶em’t
 
a
 
m‘hod
 
	gÿÎed
 "deçuÉ" 
th©


5 
is
 
ÿÎed
 
wh’
 
no
 
Ùh”
 
su™abË
 
	gm‘hod
/
objeù
 
could
 
be
 
	gfound
.

6 
	gEs£ÁŸÎy
, 
Ch”ryPy2
 
	gÿn
't find‡ matching„equest handler object

7 
the
 
giv’
 
»que¡
 
	gURI
, 
™
 
wl
 
u£
h 
m‘hod
 
of
h
objeù


8 
loÿ‹d
 
d“³¡
 
Ú
 
the
 
URI
 
	g·th
.

10 
Usšg
 
this
 
mechªism
 
you
 
ÿn
 
—sy
 
simuÏ‹
 
vœtu®
 
URI
 
¡ruùu»s


11 
by
 
·rsšg
 
the
 
exŒa
 
URI
 
	g¡ršg
, 
which
 
you
 
ÿn
 
acûss
 
through


12 
	gch”rypy
.
	g»que¡
.
	gvœtu®P©h
.

14 
The
 
­¶iÿtiÚ
 
š
 
this
 
tutÜŸl
 
simuÏ‹s
 
ª
 
URI
 
¡ruùu»
 
lookšg


15 
	glike
 /
	gu£rs
/<
	gu£ºame
>. 
Sšû
 
	gthe
 <u£ºame> 
b™
 
wl
 
nÙ
 
be
 
found
 (
as


16 
th”e
 
¬e
 
no
 
m©chšg
 
m‘hods
), 
™
 
is
 
hªdËd
 
by
 
the
  
	gm‘hod
.

19 
impÜt
 
ch”rypy


22 
şass
 
	gU£rsPage
:

24 
def
 
	$šdex
(
£lf
):

25 #Sšû 
this
 
is
 
ju¡
 
a
 
¡upid
 
l™e
 
exam¶e
, 
we
'll simply

26 #di¥Ïy 
a
 
li¡
 
of
 
lšks
 
to
 
¿ndom
, 
made
-
up
 
u£rs
. 
In
‡ 
»®


27 #­¶iÿtiÚ, 
this
 
could
 
be
 
g’”©ed
 
äom
 
a
 
d©aba£
 
»suÉ
 
£t
.

29 <
a
 
h»f
="./»mi">
Remi
 
D–Ú
</a><
br
/>

30 <
a
 
h»f
="./h’drik">
H’drik
 
Mªs
</a><
br
/>

31 <
a
 
h»f
="./lÜ’zo">
LÜ’zo
 
Lamas
</a><
br
/>

33 
šdex
.
expo£d
 = 
True


35 
def
 (
£lf
, 
u£r
):

36 #H”
we
 
»aù
 
d•’dšg
 
Ú
 
the
 
vœtu®P©h
 --h
·¹
 
of
he

37 #·th 
th©
 
could
 
nÙ
 
be
 
m­³d
 
to
 
ª
 
objeù
 
m‘hod
. 
In
 
a
 
»®


38 #­¶iÿtiÚ, 
we
 
would
 
´obably
 dØ
some
 
d©aba£
 
lookups
 
h”e


39 #š¡—d 
of
 
the
 
sly
 /
–if
/
cÚ¡ruù
.

40 
u£r
 == 'remi':

41 
out
 = "Remi Delon, CherryPy†ead developer"

42 
–if
 
u£r
 == 'hendrik':

43 
out
 = "Hendrik Mans, CherryPy co-developer & crazy German"

44 
–if
 
u£r
 == 'lorenzo':

45 
out
 = "Lorenzo Lamas, famous‡ctor‡nd singer!"

47 
out
 = "Unknown user. :-("

49  '% (<¨h»f="./">back</a>)' % 
out


50 .
expo£d
 = 
True


53 
impÜt
 
os
.
·th


54 
tutcÚf
 = 
os
.
·th
.
	`još
(os.·th.
	`dœÇme
(
__fe__
), 'tutorial.conf')

56 
__Çme__
 == '__main__':

57 #Ch”ryPy 
®ways
 
¡¬ts
 
w™h
 
­p
.
roÙ
 
wh’
 
Œyšg
 
to
 
m­
 
»que¡
 
URIs


58 #tØ
objeùs
, 
so
 
we
 
Ãed
 
to
 
mouÁ
 
a
 
»que¡
 
hªdËr
 
roÙ
. 
A
„equest

59 #tØ'/' 
wl
 
be
 
m­³d
 
to
 
	`H–loWÜld
().
	`šdex
().

60 
ch”rypy
.
	`quick¡¬t
(
	`U£rsPage
(), 
cÚfig
=
tutcÚf
)

62 #Thi 
b¿nch
 
is
 
the
 
‹¡
 
su™e
; 
you
 
ÿn
 
ignÜe
 
™
.

63 
ch”rypy
.
Œ“
.
	`mouÁ
(
	`U£rsPage
(), 
cÚfig
=
tutcÚf
)

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/tutorial/tut07_sessions.py

2 
	gTutÜŸl
 - 
SessiÚs


4 
StÜšg
 
£ssiÚ
 
d©a
 
š
 
Ch”ryPy
 
­¶iÿtiÚs
 
is
 
v”y
 
	g—sy
: 
ch”rypy


5 
´ovides
 
a
 
diùiÚ¬y
 
ÿÎed
 "£ssiÚ" 
th©
 
»´e£Ás
 
the
 
£ssiÚ


6 
d©a
 
the
 
cu¼’t
 
u£r
. 
If
 
you
 
u£
 
RAM
 
ba£d
 
£ssiÚs
, you 
ÿn
 
¡Üe


7 
ªy
 
kšd
 
of
 
objeù
 
što
 
th©
 
	gdiùiÚ¬y
; 
	gÙh”wi£
, 
you
 
¬e
 
lim™ed
 
to


8 
objeùs
 
th©
 
ÿn
 
be
 
	gpickËd
.

11 
impÜt
 
ch”rypy


14 
şass
 
	gH™CouÁ”
:

16 
_ı_cÚfig
 = {'toŞs.£ssiÚs.Ú': 
True
}

18 
def
 
	$šdex
(
£lf
):

19 #Inü—£ 
the
 
sly
 
h™
 
couÁ”


20 
couÁ
 = 
ch”rypy
.
£ssiÚ
.
	`g‘
('count', 0) + 1

22 #StÜ
the
 
Ãw
 
v®ue
 
š
h
£ssiÚ
 
diùiÚ¬y


23 
ch”rypy
.
£ssiÚ
['couÁ'] = 
couÁ


25 #And 
di¥Ïy
 
a
 
sly
 
h™
 
couÁ
 
mes§ge
!

27 
Duršg
 
your
 
cu¼’t
 
£ssiÚ
, 
you
've viewedhis

28 
·ge
 %
s
 
times
! 
Your
 
liã
 
is
 
a
 
·tio
 
of
 
fun
!

30 
šdex
.
expo£d
 = 
True


33 
impÜt
 
os
.
·th


34 
tutcÚf
 = 
os
.
·th
.
	`još
(os.·th.
	`dœÇme
(
__fe__
), 'tutorial.conf')

36 
__Çme__
 == '__main__':

37 #Ch”ryPy 
®ways
 
¡¬ts
 
w™h
 
­p
.
roÙ
 
wh’
 
Œyšg
 
to
 
m­
 
»que¡
 
URIs


38 #tØ
objeùs
, 
so
 
we
 
Ãed
 
to
 
mouÁ
 
a
 
»que¡
 
hªdËr
 
roÙ
. 
A
„equest

39 #tØ'/' 
wl
 
be
 
m­³d
 
to
 
	`H–loWÜld
().
	`šdex
().

40 
ch”rypy
.
	`quick¡¬t
(
	`H™CouÁ”
(), 
cÚfig
=
tutcÚf
)

42 #Thi 
b¿nch
 
is
 
the
 
‹¡
 
su™e
; 
you
 
ÿn
 
ignÜe
 
™
.

43 
ch”rypy
.
Œ“
.
	`mouÁ
(
	`H™CouÁ”
(), 
cÚfig
=
tutcÚf
)

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/tutorial/tut08_generators_and_yield.py

2 
BÚus
 
	gTutÜŸl
: 
Usšg
 
g’”©Üs
 
to
  
»suÉ
 
bod›s


4 
In¡—d
 
of
 
»tuºšg
 
a
 
com¶‘e
 
»suÉ
 
¡ršg
, 
you
 
ÿn
 
u£
 
the
 
y›ld


5 
¡©em’t
 
to
  
Úe
 
»suÉ
 
·¹
 
aá”
 
	gªÙh”
. 
This
 
may
 
be
 
cÚv’›Á


6 
š
 
s™u©iÚs
 
wh”e
 
usšg
 
a
 
‹m¶©e
 
·ckage
 
like
 
Ch”ryPy
 
Ü
 
Ch“h


7 
would
 
be
 
	gov”kl
, 
ªd
 
messy
 
¡ršg
 
cÚÿ‹ÇtiÚ
 
too
 
	guncoŞ
. ;-)

10 
impÜt
 
ch”rypy


13 
şass
 
	gG’”©ÜDemo
:

15 
def
 
	$h—d”
(
£lf
):

18 
def
 
	$foÙ”
(
£lf
):

21 
def
 
	$šdex
(
£lf
):

23 
u£rs
 = ['Remi', 'Carlos', 'Hendrik', 'Lorenzo Lamas']

25 #Ev”y 
y›ld
 
lše
 
adds
 
Úe
 
·¹
 
to
 
the
 
tÙ®
 
»suÉ
 
body
.

26 
y›ld
 
£lf
.
	$h—d”
()

27 
y›ld
 "<h3>List of users:</h3>"

29 
u£r
 
š
 
u£rs
:

30 
y›ld
 "%s<br/>" % 
u£r


32 
y›ld
 
£lf
.
	$foÙ”
()

33 
šdex
.
expo£d
 = 
True


36 
impÜt
 
os
.
·th


37 
tutcÚf
 = 
os
.
·th
.
	`još
(os.·th.
	`dœÇme
(
__fe__
), 'tutorial.conf')

39 
__Çme__
 == '__main__':

40 #Ch”ryPy 
®ways
 
¡¬ts
 
w™h
 
­p
.
roÙ
 
wh’
 
Œyšg
 
to
 
m­
 
»que¡
 
URIs


41 #tØ
objeùs
, 
so
 
we
 
Ãed
 
to
 
mouÁ
 
a
 
»que¡
 
hªdËr
 
roÙ
. 
A
„equest

42 #tØ'/' 
wl
 
be
 
m­³d
 
to
 
	`H–loWÜld
().
	`šdex
().

43 
ch”rypy
.
	`quick¡¬t
(
	`G’”©ÜDemo
(), 
cÚfig
=
tutcÚf
)

45 #Thi 
b¿nch
 
is
 
the
 
‹¡
 
su™e
; 
you
 
ÿn
 
ignÜe
 
™
.

46 
ch”rypy
.
Œ“
.
	`mouÁ
(
	`G’”©ÜDemo
(), 
cÚfig
=
tutcÚf
)

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/tutorial/tut09_files.py

3 
	gTutÜŸl
: 
Fe
 
u¶ßd
 
ªd
 
dowÆßd


5 
U¶ßds


8 
Wh’
 
a
 
ş›Á
 
u¶ßds
‡ 
fe
 
to
‡ 
Ch”ryPy
 
­¶iÿtiÚ
, 
	g™
's…laced

9 
Ú
 
disk
 
	gimmedŸ‹ly
. 
Ch”ryPy
 
wl
 
·ss
 
™
 
to
 
your
 
expo£d
 
m‘hod


10 
as
 
ª
 
¬gum’t
 (
£e
 "myFe" 
b–ow
); 
th©
 
¬g
 
wl
 
have
 
	ga
 "file"

11 
	g©Œibu‹
, 
which
 
is
 
a
 
hªdË
 
to
 
the
 
‹mpÜ¬y
 
u¶ßded
 
	gfe
.

12 
If
 
you
 
wish
 
to
 
³rmª’y
 
§ve
 
the
 
	gfe
, you 
Ãed
Ø
	$»ad
()

13 
äom
 
myFe
.
fe
 
ªd
 
	$wr™e
(è
somewh”e
 .

15 
NÙe
 
the
 
u£
 
of
 '’ùy³="muÉ¬t/fÜm-d©a"' 
ªd
 'inputype="file"'

16 
š
 
the
 
HTML
 
which
h
ş›Á
 
u£s
 
to
 
u¶ßd
h
fe
.

19 
DowÆßds


22 
If
 
you
 
wish
 
to
 
£nd
 
a
 
fe
Ø
the
 
ş›Á
, you 
have
 
two
 
İtiÚs
:

23 
Fœ¡
, 
you
 
ÿn
 
sim¶y
  
a
 
fe
-
like
 
objeù
 
äom
 
your
 
·ge
 
hªdËr
.

24 
Ch”ryPy
 
wl
 
»ad
 
the
 
fe
 
ªd
 
£rve
 
™
 
as
h
	$cÚ‹Á
 (
HTTP
 
body
)

25 
of
 
the
 
»¥Ú£
. 
Howev”
, 
th©
 
dÛ¢
'tellhe clienthat

26 
the
 
»¥Ú£
 
is
 
a
 
fe
 
to
 
be
 
§ved
, 
¿th”
 
thª
 
di¥Ïyed
.

27 
U£
 
ch”rypy
.
lib
..
£rve_fe
 
th©
; 
™
 
kes
 
four


28 
¬gum’ts
:

30 
	$£rve_fe
(
·th
, 
cÚ‹Á_ty³
=
NÚe
, 
di¥os™iÚ
=NÚe, 
Çme
=None)

32 
S‘
 "Çme" 
to
 
the
 
f’ame
 
th©
 
you
 
ex³ù
 
ş›Ás
Ø
u£
 
wh’
 
they
 
§ve


33 
your
 
fe
. 
NÙe
 
th©
 
the
 "Çme" 
¬gum’t
 
is
 
ignÜed
 
you
 
dÚ
't‡lso

34 
´ovide
 
a
 "di¥os™iÚ" (
usu®ly
 "©chem’t"). 
You
 
ÿn
 
mªu®ly
 
£t


35 "cÚ‹Á_ty³", 
but
 
be
 
aw¬e
 
th©
 
you
 
®so
 
u£
 
the
 
’codšg
 
toŞ
, 
™


36 
may
 
choke
 
the
 
fe
 
ex‹nsiÚ
 
is
 
nÙ
 
»cognized
 
as
 
b–Úgšg
 
to
 
a
 
known


37 
CÚ‹Á
-
Ty³
. 
S‘tšg
 
the
 
cÚ‹Á_ty³
 
to
 "­¶iÿtiÚ/x-dowÆßd" 
wÜks


38 
š
 
mo¡
 
ÿ£s
, 
ªd
 
should
 
´om±
 
the
 
u£r
 
w™h
 
ª
 
O³n
/
Save
 
dŸlog
 in

39 
pİuÏr
 
brow£rs
.

43 
impÜt
 
os


44 
loÿlDœ
 = 
os
.
·th
.
	$dœÇme
(
__fe__
)

45 
absDœ
 = 
os
.
·th
.
	`još
(os.
	`g‘cwd
(), 
loÿlDœ
)

47 
impÜt
 
ch”rypy


48 
äom
 
ch”rypy
.
lib
 
impÜt
 

51 
şass
 
	$FeDemo
(
objeù
):

53 
def
 
	$šdex
(
£lf
):

55 <
html
><
body
>

56 <
h2
>
U¶ßd
 
a
 
fe
</h2>

57 <
fÜm
 
aùiÚ
="u¶ßd" 
m‘hod
="po¡" 
’ùy³
="multipart/form-data">

58 
f’ame
: <
šput
 
ty³
="fe" 
Çme
="myFe" /><
br
 />

59 <
šput
 
ty³
="submit" />

60 </
fÜm
>

61 <
h2
>
DowÆßd
 
a
 
fe
</h2>

62 <
a
 
h»f
='dowÆßd'>
This
 
Úe
</a>

63 </
body
></
html
>

65 
šdex
.
expo£d
 = 
True


67 
def
 
	$u¶ßd
(
£lf
, 
myFe
):

68 
out
 = """<html>

69 <
body
>

70 
myFe
 
Ëngth
: %
s
<
br
 />

71 
myFe
 
f’ame
: %
s
<
br
 />

72 
myFe
 
mime
-
ty³
: %
s


73 </
body
>

74 </
html
>"""

76 #AÉhough 
this
 
ju¡
 
couÁs
 
the
 
fe
 
Ëngth
, 
™
 
demÚ¡¿‹s


77 #how 
to
 
»ad
 
Ïrge
 
fes
 
š
 
chunks
 
š¡—d
 
of
 
®l
 
©
 
Úû
.

78 #Ch”ryPy 
»ads
 
the
 
u¶ßded
 
fe
 
što
 
a
 
‹mpÜ¬y
 file;

79 #myFe.
fe
.
»ad
 
»ads
 
äom
 
th©
.

80 
size
 = 0

81 
True
:

82 
d©a
 = 
myFe
.
fe
.
	$»ad
(8192)

83 
nÙ
 
d©a
:

85 
size
 +ğ
	$Ën
(
d©a
)

87  
out
 % (
size
, 
myFe
.
f’ame
, myFe.
cÚ‹Á_ty³
)

88 
u¶ßd
.
expo£d
 = 
True


90 
def
 
	$dowÆßd
(
£lf
):

91 
·th
 = 
os
.·th.
	`još
(
absDœ
, "pdf_file.pdf")

92  .
	`£rve_fe
(
·th
, "application/x-download",

93 "©chm’t", 
os
.
·th
.
	$ba£Çme
(
·th
))

94 
dowÆßd
.
expo£d
 = 
True


97 
impÜt
 
os
.
·th


98 
tutcÚf
 = 
os
.
·th
.
	`još
(os.·th.
	`dœÇme
(
__fe__
), 'tutorial.conf')

100 
__Çme__
 == '__main__':

101 #Ch”ryPy 
®ways
 
¡¬ts
 
w™h
 
­p
.
roÙ
 
wh’
 
Œyšg
 
to
 
m­
 
»que¡
 
URIs


102 #tØ
objeùs
, 
so
 
we
 
Ãed
 
to
 
mouÁ
 
a
 
»que¡
 
hªdËr
 
roÙ
. 
A
„equest

103 #tØ'/' 
wl
 
be
 
m­³d
 
to
 
	`H–loWÜld
().
	`šdex
().

104 
ch”rypy
.
	`quick¡¬t
(
	`FeDemo
(), 
cÚfig
=
tutcÚf
)

106 #Thi 
b¿nch
 
is
 
the
 
‹¡
 
su™e
; 
you
 
ÿn
 
ignÜe
 
™
.

107 
ch”rypy
.
Œ“
.
	`mouÁ
(
	`FeDemo
(), 
cÚfig
=
tutcÚf
)

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/tutorial/tut10_http_errors.py

3 
	gTutÜŸl
: 
HTTP
 
”rÜs


5 
HTTPE¼Ü
 
is
 
u£d
 
to
  
ª
 
”rÜ
 
»¥Ú£
Ø
the
 
ş›Á
.

6 
Ch”ryPy
 
has
 
lÙs
 
of
 
İtiÚs
 
»g¬dšg
 
how
 
such
 
”rÜs
 
¬e


7 
logged
, 
	gdi¥Ïyed
, 
ªd
 
	gfÜm©‹d
.

11 
impÜt
 
os


12 
	gloÿlDœ
 = 
os
.
·th
.
	$dœÇme
(
__fe__
)

13 
cu½©h
 = 
os
.
·th
.
	`nÜm·th
(os.·th.
	`još
(os.
	`g‘cwd
(), 
loÿlDœ
))

15 
impÜt
 
ch”rypy


18 
şass
 
	$HTTPE¼ÜDemo
(
objeù
):

20 #S‘ 
a
 
cu¡om
 
»¥Ú£
 403 
”rÜs
.

21 
_ı_cÚfig
 = {'”rÜ_·ge.403' : 
os
.
·th
.
	`još
(
cu½©h
, "cu¡om_”rÜ.html")
	}
}

23 
def
 
	$šdex
(
£lf
):

24 #di¥Ïy 
some
 
lšks
 
th©
 
wl
 
»suÉ
 
š
 
”rÜs


25 
Œaûbacks
 = 
ch”rypy
.
»que¡
.
show_Œaûbacks


26 
Œaûbacks
:

27 
Œaû
 = 'off'

29 
Œaû
 = 'on'

32 <
html
><
body
>

33 <
p
>
ToggË
 
Œaûbacks
 <
a
 
h»f
="toggËT¿ûbacks">%
s
</a></p>

34 <
p
><
a
 
h»f
="/dÛsNÙExi¡">
Click
 
me
; 
I
'm‡ broken†ink!</a></p>

35 <
p
><
a
 
h»f
="/”rÜ?code=403">
U£
‡ 
cu¡om
 
”rÜ
 
·ge
 
äom
‡ 
fe
.</a></p>

36 <
p
>
The£
 
”rÜs
 
¬e
 
ex¶ic™ly
 
¿i£d
 
by
 
the
 
­¶iÿtiÚ
:</p>

37 <
ul
>

38 <
li
><
a
 
h»f
="/error?code=400">400</a></li>

39 <
li
><
a
 
h»f
="/error?code=401">401</a></li>

40 <
li
><
a
 
h»f
="/error?code=402">402</a></li>

41 <
li
><
a
 
h»f
="/error?code=500">500</a></li>

42 </
ul
>

43 <
p
><
a
 
h»f
="/mes§geArg">
You
 
ÿn
 
®so
 
£t
 
the
 
»¥Ú£
 
body


44 
wh’
 
you
 
¿i£
 
ª
 
”rÜ
.</
a
></
p
>

45 </
body
></
html
>

47 
šdex
.
expo£d
 = 
True


49 
def
 
	$toggËT¿ûbacks
(
£lf
):

50 #sim¶
funùiÚ
 
to
 
toggË
 
Œaûbacks
 
Ú
 
ªd
 
off


51 
Œaûbacks
 = 
ch”rypy
.
»que¡
.
show_Œaûbacks


52 
ch”rypy
.
cÚfig
.
	`upd©e
({'»que¡.show_Œaûbacks': 
nÙ
 
Œaûbacks
})

54 #»dœeù 
back
 
to
 
the
 
šdex


55 
¿i£
 
ch”rypy
.
HTTPRedœeù
('/')

56 
toggËT¿ûbacks
.
expo£d
 = 
True


58 
def
 
	$”rÜ
(
£lf
, 
code
):

59 #¿i£ 
ª
 
”rÜ
 
ba£d
 
Ú
 
the
 
g‘
 
qu”y


60 
¿i£
 
ch”rypy
.
	$HTTPE¼Ü
(
¡©us
 = 
code
)

61 
”rÜ
.
expo£d
 = 
True


63 
def
 
	$mes§geArg
(
£lf
):

64 
mes§ge
 = ("If you construct‡n HTTPError with‡ 'message' "

67 
¿i£
 
ch”rypy
.
	$HTTPE¼Ü
(500, 
mes§ge
=message)

68 
mes§geArg
.
expo£d
 = 
True


71 
impÜt
 
os
.
·th


72 
tutcÚf
 = 
os
.
·th
.
	`još
(os.·th.
	`dœÇme
(
__fe__
), 'tutorial.conf')

74 
__Çme__
 == '__main__':

75 #Ch”ryPy 
®ways
 
¡¬ts
 
w™h
 
­p
.
roÙ
 
wh’
 
Œyšg
 
to
 
m­
 
»que¡
 
URIs


76 #tØ
objeùs
, 
so
 
we
 
Ãed
 
to
 
mouÁ
 
a
 
»que¡
 
hªdËr
 
roÙ
. 
A
„equest

77 #tØ'/' 
wl
 
be
 
m­³d
 
to
 
	`H–loWÜld
().
	`šdex
().

78 
ch”rypy
.
	`quick¡¬t
(
	`HTTPE¼ÜDemo
(), 
cÚfig
=
tutcÚf
)

80 #Thi 
b¿nch
 
is
 
the
 
‹¡
 
su™e
; 
you
 
ÿn
 
ignÜe
 
™
.

81 
ch”rypy
.
Œ“
.
	`mouÁ
(
	`HTTPE¼ÜDemo
(), 
cÚfig
=
tutcÚf
)

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/wsgiserver/__init__.py

1 
	g__®l__
 = ['HTTPRequest', 'HTTPConnection', 'HTTPServer',

9 
impÜt
 
sys


10 
	gsys
.
	gv”siÚ_šfo
 < (3, 0):

11 
äom
 
wsgi£rv”2
 
impÜt
 *

13 #L
sigh
. 
Boo
 
backw¬d
-
šcom·tibË
 
syÁax
.

14 
exec
('from .wsgiserver3 import *')

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/wsgiserver/ssl_builtin.py

3 
The
 
s¦
 
moduË
 
mu¡
 
be
 
impÜbË
 
SSL
 
	gfunùiÚ®™y
.

5 
To
 
u£
 
this
 
	gmoduË
, 
	g£t
 ``
	gCh”ryPyWSGIS”v”
.
	gs¦_ad­‹r
`` 
to
 
ª
 
š¡ªû
 
	gof


6 ``
	gButšSSLAd­‹r
``.

9 
	gŒy
:

10 
impÜt
 
s¦


11 
exû±
 
ImpÜtE¼Ü
:

12 
s¦
 = 
NÚe


14 
Œy
:

15 
äom
 
_pyio
 
impÜt
 
DEFAULT_BUFFER_SIZE


16 
exû±
 
ImpÜtE¼Ü
:

17 
Œy
:

18 
äom
 
io
 
impÜt
 
DEFAULT_BUFFER_SIZE


19 
exû±
 
ImpÜtE¼Ü
:

20 
DEFAULT_BUFFER_SIZE
 = -1

22 
impÜt
 
sys


24 
äom
 
ch”rypy
 
impÜt
 
wsgi£rv”


27 
şass
 
	$ButšSSLAd­‹r
(
wsgi£rv”
.
SSLAd­‹r
):

30 
û¹ifiÿ‹
 = 
NÚe


33 
´iv©e_key
 = 
NÚe


36 
def
 
	$__š™__
(
£lf
, 
û¹ifiÿ‹
, 
´iv©e_key
, 
û¹ifiÿ‹_chaš
=
NÚe
):

37 
s¦
 
is
 
NÚe
:

38 
¿i£
 
	`ImpÜtE¼Ü
("You must installhe ssl moduleo use HTTPS.")

39 
£lf
.
û¹ifiÿ‹
 = certificate

40 
£lf
.
´iv©e_key
 =…rivate_key

41 
£lf
.
û¹ifiÿ‹_chaš
 = certificate_chain

43 
def
 
	$bšd
(
£lf
, 
sock
):

45  
sock


47 
def
 
	$w¿p
(
£lf
, 
sock
):

49 
Œy
:

50 
s
 = 
s¦
.
	$w¿p_sock‘
(
sock
, 
do_hªdshake_Ú_cÚÃù
=
True
,

51 
£rv”_side
=
True
, 
û¹fe
=
£lf
.
û¹ifiÿ‹
,

52 
keyfe
=
£lf
.
´iv©e_key
, 
s¦_v”siÚ
=
s¦
.
PROTOCOL_SSLv23
)

53 
exû±
 
s¦
.
SSLE¼Ü
:

54 
e
 = 
sys
.
	`exc_šfo
()[1]

55 
e
.
”ºo
 =ğ
s¦
.
SSL_ERROR_EOF
:

56 #Thi 
is
 
®mo¡
 
û¹ašly
 
due
 
to
 
the
 
ch”rypy
 
’gše


57 #'
pšgšg
'hsock‘Øas£¹ it'
s
 
cÚÃùabË
;

58 #th'pšg' 
i¢
't SSL.

59  
NÚe
, {
	}
}

60 
–if
 
	ge
.
	g”ºo
 =ğ
s¦
.
SSL_ERROR_SSL
:

61 
e
.
¬gs
[1].
’dsw™h
('http„equest'):

62 #Th
ş›Á
 
is
 
¥—kšg
 
HTTP
 
to
 
ª
 
HTTPS
 
£rv”
.

63 
¿i£
 
wsgi£rv”
.
NoSSLE¼Ü


64 
–if
 
e
.
¬gs
[1].
’dsw™h
('unknown…rotocol'):

65 #Th
ş›Á
 
is
 
¥—kšg
 
some
 
nÚ
-
HTTP
 
´ÙocŞ
.

66 #Drİ 
the
 
cÚn
.

67  
NÚe
, {}

68 
¿i£


69  
	gs
, 
	g£lf
.
	$g‘_’vœÚ
(
s
)

71 #TODO: 
fl
 
this
 
out
 
mÜe
 
w™h
 
mod
 
s¦
 
’v


72 
def
 
	$g‘_’vœÚ
(
£lf
, 
sock
):

74 
ch”
 = 
sock
.
	$ch”
()

75 
s¦_’vœÚ
 = {

78 'SSL_PROTOCOL': 
ch”
[1],

79 'SSL_CIPHER': 
ch”
[0]

80 ## 
SSL_VERSION_INTERFACE
 
¡ršg
 
The
 
mod_s¦
 
´og¿m
 
v”siÚ


81 ## 
SSL_VERSION_LIBRARY
 
¡ršg
 
The
 
O³nSSL
 
´og¿m
 
v”siÚ


82 
	}
}

83  
s¦_’vœÚ


85 
sys
.
v”siÚ_šfo
 >= (3, 0):

86 
def
 
makefe
(
£lf
, 
sock
, 
mode
='r', 
bufsize
=
DEFAULT_BUFFER_SIZE
):

87  
wsgi£rv”
.
	$CP_makefe
(
sock
, 
mode
, 
bufsize
)

89 
def
 
	`makefe
(
£lf
, 
sock
, 
mode
='r', 
bufsize
=
DEFAULT_BUFFER_SIZE
):

90  
wsgi£rv”
.
	`CP_feobjeù
(
sock
, 
mode
, 
bufsize
)

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/wsgiserver/ssl_pyopenssl.py

3 
The
 
O³nSSL
 
moduË
 
mu¡
 
be
 
impÜbË
 
SSL
 
	gfunùiÚ®™y
.

4 
You
 
ÿn
 
obš
 
™
 
äom
 
	gh‰p
:

6 
To
 
u£
 
this
 
moduË
, 
£t
 
	gCh”ryPyWSGIS”v”
.
s¦_ad­‹r
 
to
 
ª
 
š¡ªû
 
of


7 
	gSSLAd­‹r
. 
Th”e
 
¬e
 
two
 
ways
 
to
 
u£
 
	gSSL
:

9 
M‘hod
 
OÃ


12 * ``
s¦_ad­‹r
.
cÚ‹xt
``: 
ª
 
š¡ªû
 
of
 
SSL
.
CÚ‹xt
.

14 
If
 
this
 
is
 
nÙ
 
NÚe
, 
™
 i 
assumed
 
to
 
be
 
ª
 
	gSSL
.
CÚ‹xt
 
	gš¡ªû
,

15 
ªd
 
wl
 
be
 
·s£d
 
to
 
	gSSL
.
CÚÃùiÚ
 
Ú
 
bšd
(). 
The
 
dev–İ”
 
is


16 
»¥ÚsibË
 
fÜmšg
 
a
 
v®id
 
CÚ‹xt
 
	gobjeù
. 
This
 
­´ßch
 
is


17 
to
 
be
 
´eã¼ed
 
mÜe
 
	gæexib™y
, 
	ge
.
	gg
. 
the
 
û¹
 
ªd
 
key
 
¬e


18 
¡»ams
 
š¡—d
 
of
 
	gfes
, 
Ü
 
Ãed
 
	gdeüy±iÚ
, o¸
	gSSL
.
SSLv3_METHOD


19 
is
 
desœed
 
š¡—d
 
of
 
the
  
	gSSL
.
	gSSLv23_METHOD
, 
	g‘c
. 
CÚsuÉ


20 
the
 
pyO³nSSL
 
docum’tiÚ
 
com¶‘e
 
	gİtiÚs
.

22 
M‘hod
 
Two
 (
shÜtcut
)

25 * ``
	gs¦_ad­‹r
.
	gû¹ifiÿ‹
``: 
the
 
f’ame
 
of
h
£rv”
 
SSL
 
û¹ifiÿ‹
.

26 * ``
s¦_ad­‹r
.
´iv©e_key
``: 
the
 
f’ame
 
of
h
£rv”
's…rivate key file.

28 
BÙh
 
¬e
 
NÚe
 
by
 . 
If
 
s¦_ad­‹r
.
cÚ‹xt
 
is
 NÚe, 
	gbut
 .
´iv©e_key


29 
	gªd
 .
û¹ifiÿ‹
 
¬e
 
bÙh
 
giv’
 
ªd
 
	gv®id
, 
they
 
wl
 
be
 
	g»ad
,‡nd 
the


30 
cÚ‹xt
 
wl
 
be
 
autom©iÿÎy
 
ü—‹d
 
äom
 
	gthem
.

33 
impÜt
 
sock‘


34 
impÜt
 
th»adšg


35 
impÜt
 
time


37 
äom
 
ch”rypy
 
impÜt
 
wsgi£rv”


39 
	gŒy
:

40 
äom
 
O³nSSL
 
impÜt
 
SSL


41 
äom
 
O³nSSL
 
impÜt
 
üy±o


42 
exû±
 
ImpÜtE¼Ü
:

43 
SSL
 = 
NÚe


46 
şass
 
	$SSL_feobjeù
(
wsgi£rv”
.
CP_feobjeù
):

49 
s¦_timeout
 = 3

50 
s¦_»Œy
 = .01

52 
def
 
	$_§ã_ÿÎ
(
£lf
, 
is_»ad”
, 
ÿÎ
, *
¬gs
, **
kw¬gs
):

55 
is_»ad”
: 
F®£
 
EOF
 
”rÜs
 
wl
 
be
 
¿i£d
. 
If
 
True
, EOFƒrrors

56 
wl
  "" (
to
 
emuÏ‹
 
nÜm®
 
sock‘s
).

58 
¡¬t
 = 
time
.
	$time
()

59 
True
:

60 
Œy
:

61  
	$ÿÎ
(*
¬gs
, **
kw¬gs
)

62 
exû±
 
SSL
.
WªtR—dE¼Ü
:

63 #SË• 
ªd
 
Œy
 
agaš
. 
This
 
is
 
dªg”ous
, 
beÿu£
 
™
 
m—ns


64 #th
»¡
 
of
 
the
 
¡ack
 
has
 
no
 
way
 oà
difã»ÁŸtšg


65 #b‘w“À
a
 "Ãw hªdshake" 
”rÜ
 
ªd
 "client dropped".

66 #NÙ
this
 
i¢
'ˆªƒndËs loİ:h”e'
s
 
a
 
timeout
 
b–ow
.

67 
time
.
	$¦“p
(
£lf
.
s¦_»Œy
)

68 
exû±
 
SSL
.
WªtWr™eE¼Ü
:

69 
time
.
	$¦“p
(
£lf
.
s¦_»Œy
)

70 
exû±
 
SSL
.
SysC®lE¼Ü
, 
e
:

71 
is_»ad”
 
ªd
 
e
.
¬gs
 == (-1, 'Unexpected EOF'):

74 
”ºum
 = 
e
.
¬gs
[0]

75 
is_»ad”
 
ªd
 
”ºum
 
š
 
wsgi£rv”
.
sock‘_”rÜs_to_ignÜe
:

77 
¿i£
 
sock‘
.
	$”rÜ
(
”ºum
)

78 
exû±
 
SSL
.
E¼Ü
, 
e
:

79 
is_»ad”
 
ªd
 
e
.
¬gs
 == (-1, 'Unexpected EOF'):

82 
thœd¬g
 = 
NÚe


83 
Œy
:

84 
thœd¬g
 = 
e
.
¬gs
[0][0][2]

85 
exû±
 
IndexE¼Ü
:

86 
·ss


88 
thœd¬g
 == 'http„equest':

89 #Th
ş›Á
 
is
 
lkšg
 
HTTP
 
to
 
ª
 
HTTPS
 
£rv”
.

90 
¿i£
 
wsgi£rv”
.
	$NoSSLE¼Ü
()

92 
¿i£
 
wsgi£rv”
.
	$F©®SSLAË¹
(*
e
.
¬gs
)

93 
exû±
:

94 
¿i£


96 
time
.
	`time
(è- 
¡¬t
 > 
£lf
.
s¦_timeout
:

97 
¿i£
 
sock‘
.
	`timeout
("timed out")

99 
def
 
	$»cv
(
£lf
, *
¬gs
, **
kw¬gs
):

100 
buf
 = []

101 
r
 = 
	`su³r
(
SSL_feobjeù
, 
£lf
).
»cv


102 
True
:

103 
d©a
 = 
£lf
.
	$_§ã_ÿÎ
(
True
, 
r
, *
¬gs
, **
kw¬gs
)

104 
buf
.
	$­³nd
(
d©a
)

105 
p
 = 
£lf
.
_sock
.
	$³ndšg
()

106 
nÙ
 
p
:

107  "".
	$još
(
buf
)

109 
def
 
	$£nd®l
(
£lf
, *
¬gs
, **
kw¬gs
):

110  
£lf
.
	`_§ã_ÿÎ
(
F®£
, 
	`su³r
(
SSL_feobjeù
, s–f).
£nd®l
,

111 *
¬gs
, **
kw¬gs
)

113 
def
 
	$£nd
(
£lf
, *
¬gs
, **
kw¬gs
):

114  
£lf
.
	`_§ã_ÿÎ
(
F®£
, 
	`su³r
(
SSL_feobjeù
, s–f).
£nd
,

115 *
¬gs
, **
kw¬gs
)

118 
şass
 
SSLCÚÃùiÚ
:

121 ``*
¬gs
``: 
the
 
¬gum’ts
 
to
 
ü—‹
h
w¿µed
 ``
SSL
.
	`CÚÃùiÚ
(*args)``.

124 
def
 
	$__š™__
(
£lf
, *
¬gs
):

125 
£lf
.
_s¦_cÚn
 = 
SSL
.
	$CÚÃùiÚ
(*
¬gs
)

126 
£lf
.
_lock
 = 
th»adšg
.
	$RLock
()

128 
f
 
	`š
 ('get_context', 'pending', 'send', 'write', 'recv', 'read',

136 
	`exec
("""def %s(self, *args):

137 
£lf
.
_lock
.
	$acquœe
()

138 
Œy
:

139  
£lf
.
_s¦_cÚn
.%
	$s
(*
¬gs
)

140 
fš®ly
:

141 
£lf
.
_lock
.
	`»Ëa£
()

144 
def
 
	$shutdown
(
£lf
, *
¬gs
):

145 
£lf
.
_lock
.
	$acquœe
()

146 
Œy
:

147 #pyO³nSSL.
sock‘
.
shutdown
 
kes
 
no
 
¬gs


148  
£lf
.
_s¦_cÚn
.
	$shutdown
()

149 
fš®ly
:

150 
£lf
.
_lock
.
	$»Ëa£
()

153 
şass
 
	$pyO³nSSLAd­‹r
(
wsgi£rv”
.
SSLAd­‹r
):

156 
cÚ‹xt
 = 
NÚe


159 
û¹ifiÿ‹
 = 
NÚe


162 
´iv©e_key
 = 
NÚe


165 
û¹ifiÿ‹_chaš
 = 
NÚe


168 
This
 
is
 
Ãeded
 
ch—³r
 "chašed„oÙ" 
SSL
 
û¹ifiÿ‹s
, 
ªd
 
should
 
be


169 
Ëá
 
as
 
NÚe
 
nÙ
 
»quœed
."""

171 
def
 
	$__š™__
(
£lf
, 
û¹ifiÿ‹
, 
´iv©e_key
, 
û¹ifiÿ‹_chaš
=
NÚe
):

172 
SSL
 
is
 
NÚe
:

173 
¿i£
 
	`ImpÜtE¼Ü
("You must install…yOpenSSLo use HTTPS.")

175 
£lf
.
cÚ‹xt
 = 
NÚe


176 
£lf
.
û¹ifiÿ‹
 = certificate

177 
£lf
.
´iv©e_key
 =…rivate_key

178 
£lf
.
û¹ifiÿ‹_chaš
 = certificate_chain

179 
£lf
.
_’vœÚ
 = 
NÚe


181 
def
 
	$bšd
(
£lf
, 
sock
):

183 
£lf
.
cÚ‹xt
 
is
 
NÚe
:

184 
£lf
.
cÚ‹xt
 = s–f.
	$g‘_cÚ‹xt
()

185 
cÚn
 = 
	$SSLCÚÃùiÚ
(
£lf
.
cÚ‹xt
, 
sock
)

186 
£lf
.
_’vœÚ
 = s–f.
	$g‘_’vœÚ
()

187  
cÚn


189 
def
 
	$w¿p
(
£lf
, 
sock
):

191  
sock
, 
£lf
.
_’vœÚ
.
	$cİy
()

193 
def
 
	$g‘_cÚ‹xt
(
£lf
):

195 #S“ 
h‰p
:

196 
c
 = 
SSL
.
	$CÚ‹xt
(
SSL
.
SSLv23_METHOD
)

197 
c
.
	$u£_´iv©ekey_fe
(
£lf
.
´iv©e_key
)

198 
£lf
.
û¹ifiÿ‹_chaš
:

199 
c
.
	$lßd_v”ify_loÿtiÚs
(
£lf
.
û¹ifiÿ‹_chaš
)

200 
c
.
	$u£_û¹ifiÿ‹_fe
(
£lf
.
û¹ifiÿ‹
)

201  
c


203 
def
 
	$g‘_’vœÚ
(
£lf
):

205 
s¦_’vœÚ
 = {

207 #pyO³nSSL 
dÛ¢
't…rovide‡ccesso‡ny ofhese AFAICT

209 ## 
SSL_CIPHER
 
¡ršg
 
The
 
ch”
 
¥ecifiÿtiÚ
 
Çme


210 ## 
SSL_VERSION_INTERFACE
 
¡ršg
 
The
 
mod_s¦
 
´og¿m
 
v”siÚ


211 ## 
SSL_VERSION_LIBRARY
 
¡ršg
 
The
 
O³nSSL
 
´og¿m
 
v”siÚ


212 
	}
}

214 
£lf
.
û¹ifiÿ‹
:

215 #S”v” 
û¹ifiÿ‹
 
©Œibu‹s


216 
û¹
 = 
İ’
(
£lf
.
û¹ifiÿ‹
, 'rb').
	$»ad
()

217 
û¹
 = 
üy±o
.
	$lßd_û¹ifiÿ‹
(
üy±o
.
FILETYPE_PEM
, 
û¹
)

218 
s¦_’vœÚ
.
	`upd©e
({

219 'SSL_SERVER_M_VERSION': 
û¹
.
	`g‘_v”siÚ
(),

220 'SSL_SERVER_M_SERIAL': 
û¹
.
	`g‘_£rŸl_numb”
(),

221 ## 'SSL_SERVER_V_START': 
V®id™y
 
of
 
£rv”
's certificate (startime),

222 ## 'SSL_SERVER_V_END': 
V®id™y
 
of
 
£rv”
's certificate (endime),

223 
	}
})

225 
	g´efix
, 
dn
 
	gš
 [("I", 
û¹
.
g‘_issu”
()),

226 ("S", 
û¹
.
g‘_subjeù
())]:

227 #X509Nam
objeùs
 
dÚ
't seemo have‡ wayo gethe

228 #com¶‘
DN
 
¡ršg
. 
U£
 
¡r
(è
ªd
 
¦iû
 
™
 
š¡—d
,

229 #beÿu£ 
¡r
(
dn
) == "<X509Name object '/C=US/ST=...'>"

230 
	gdn¡r
 = 
¡r
(
dn
)[18:-2]

232 
wsgikey
 = 'SSL_SERVER_%s_DN' % 
´efix


233 
s¦_’vœÚ
[
wsgikey
] = 
dn¡r


235 #Th
DN
 
should
 
be
 
of
 
the
 
fÜm
: /
k1
=
v1
/
k2
=
v2
, 
but
 
we
 
mu¡
 
®low


236 #fÜ 
ªy
 
v®ue
 
to
 
cÚš
 
¦ashes
 
™£lf
 (
š
 
a
 
URL
).

237 
	gdn¡r
:

238 
pos
 = 
dn¡r
.
rfšd
("=")

239 
dn¡r
, 
	gv®ue
 = dn¡r[:
pos
], 
	gdn¡r
[pos + 1:]

240 
pos
 = 
dn¡r
.
rfšd
("/")

241 
dn¡r
, 
	gkey
 = dn¡r[:
pos
], 
	gdn¡r
[pos + 1:]

242 
key
 
ªd
 
v®ue
:

243 
wsgikey
 = 'SSL_SERVER_%s_DN_%s' % (
´efix
, 
	gkey
)

244 
	gs¦_’vœÚ
[
wsgikey
] = 
v®ue


246  
s¦_’vœÚ


248 
def
 
makefe
(
£lf
, 
sock
, 
mode
='r', 
bufsize
=-1):

249 
SSL
 
ªd
 
	$isš¡ªû
(
sock
, 
SSL
.
CÚÃùiÚTy³
):

250 
timeout
 = 
sock
.
	$g‘timeout
()

251 
f
 = 
	$SSL_feobjeù
(
sock
, 
mode
, 
bufsize
)

252 
f
.
s¦_timeout
 = 
timeout


253  
f


255  
wsgi£rv”
.
	`CP_feobjeù
(
sock
, 
mode
, 
bufsize
)

	@trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/wsgiserver/wsgiserver2.py

3 
Sim¶e¡
 
exam¶e
 
Ú
 
how
 
to
 
u£
 
this
 
moduË
 
	gdœeùly


4 (
w™hout
 
usšg
 
	gCh”ryPy
's‡pplication machinery)::

6 
äom
 
ch”rypy
 
impÜt
 
wsgi£rv”


8 
def
 
	$my_üazy_­p
(
’vœÚ
, 
¡¬t_»¥Ú£
):

9 
¡©us
 = '200 OK'

10 
»¥Ú£_h—d”s
 = [('Content-type','text/plain')]

11 
	$¡¬t_»¥Ú£
(
¡©us
, 
»¥Ú£_h—d”s
)

14 
£rv”
 = 
wsgi£rv”
.
	`Ch”ryPyWSGIS”v”
(

15 ('0.0.0.0', 8070), 
my_üazy_­p
,

16 
£rv”_Çme
='www.cherrypy.example')

17 
£rv”
.
	$¡¬t
()

19 
The
 
Ch”ryPy
 
WSGI
 
£rv”
 
ÿn
 
£rve
 
as
 
mªy
 WSGI 
­¶iÿtiÚs


20 
as
 
you
 
wªt
 
š
 
Úe
 
š¡ªû
 
by
 
usšg
 
a
 
WSGIP©hInfoDi¥©ch”
::

22 
d
 = 
	`WSGIP©hInfoDi¥©ch”
({'/': 
my_üazy_­p
, '/blog': 
my_blog_­p
})

23 
£rv”
 = 
wsgi£rv”
.
Ch”ryPyWSGIS”v”
(('0.0.0.0', 80), 
d
)

25 
Wªt
 
SSL
 
	gsuµÜt
? 
Ju¡
 
£t
 
	g£rv”
.
s¦_ad­‹r
 
to
 
ª
 
SSLAd­‹r
 
	gš¡ªû
.

27 
This
 
	gwÚ
't callhe CherryPyƒngine (application side)‡t‡ll, onlyhe

28 
HTTP
 
	g£rv”
, 
which
 
is
 
šd•’d’t
 
äom
 
the
 
»¡
 
of
 
	gCh”ryPy
. 
	gDÚ
't

29 
Ët
 
the
 
	gÇme
 "Ch”ryPyWSGIS”v”" 
throw
 
	gyou
;h
Çme
 
m”–y
 
»æeùs


30 
™s
 
	gÜigš
, 
nÙ
 it 
	gcou¶šg
.

32 
FÜ
 
tho£
 
of
 
you
 
wªtšg
 
to
 
und”¡ªd
 
š‹º®s
 oà
this
 
	gmoduË
, 
	gh”e
'she

33 
basic
 
ÿÎ
 
	gæow
. 
The
 
	g£rv”
's†isteninghread„uns‡ veryight†oop,

34 
¡ickšg
 
šcomšg
 
cÚÃùiÚs
 
Úto
 
a
 
	gQueue
::

36 
£rv”
 = 
	$Ch”ryPyWSGIS”v”
(...)

37 
£rv”
.
	$¡¬t
()

38 
True
:

39 
	$tick
()

40 #Thi 
blocks
 
uÁ
 
a
 
»que¡
 
comes
 
š
:

41 
chd
 = 
sock‘
.
	$acû±
()

42 
cÚn
 = 
	$HTTPCÚÃùiÚ
(
chd
, ...)

43 
£rv”
.
»que¡s
.
	$put
(
cÚn
)

45 
WÜk”
 
th»ads
 
¬e
 
k•t
 
š
 
a
 
poŞ
 
ªd
 
pŞl
 
the
 
Queue
, 
pİpšg
 
off
‡nd 
th’


46 
hªdlšg
 
—ch
 
cÚÃùiÚ
 
š
 
tuº
. 
Each
 cÚÃùiÚ 
ÿn
 
cÚsi¡
 
of
 
ª
 
¬b™¿ry


47 
numb”
 
of
 
»que¡s
 
ªd
 
theœ
 
»¥Ú£s
, 
so
 
we
 
run
 
a
 
Ã¡ed
 
loİ
::

49 
True
:

50 
cÚn
 = 
£rv”
.
»que¡s
.
	$g‘
()

51 
cÚn
.
	`communiÿ‹
()

52 -> 
True
:

53 
»q
 = 
	$HTTPReque¡
(...)

54 
»q
.
	`·r£_»que¡
()

55 -> #R—d 
the
 
Reque¡
-
Lše
, 
e
.
g
. "GET /page HTTP/1.1"

56 
»q
.
rfe
.
	$»adlše
()

57 
	$»ad_h—d”s
(
»q
.
rfe
,„eq.
šh—d”s
)

58 
»q
.
	`»¥Úd
()

59 -> 
»¥Ú£
 = 
	$­p
(...)

60 
Œy
:

61 
chunk
 
š
 
»¥Ú£
:

62 
chunk
:

63 
»q
.
	$wr™e
(
chunk
)

64 
fš®ly
:

65 
	`ha§‰r
(
»¥Ú£
, "close"):

66 
»¥Ú£
.
	$şo£
()

67 
»q
.
şo£_cÚÃùiÚ
:

71 
__®l__
 = ['HTTPRequest', 'HTTPConnection', 'HTTPServer',

80 
impÜt
 
os


81 
Œy
:

82 
impÜt
 
queue


83 
exû±
:

84 
impÜt
 
Queue
 
as
 
queue


85 
impÜt
 
»


86 
impÜt
 
rfc822


87 
impÜt
 
sock‘


88 
impÜt
 
sys


89 'wš' 
š
 
sys
.
¶©fÜm
 
ªd
 
nÙ
 
	`ha§‰r
(
sock‘
, 'IPPROTO_IPV6'):

90 
sock‘
.
IPPROTO_IPV6
 = 41

91 
Œy
:

92 
impÜt
 
cSŒšgIO
 
as
 
SŒšgIO


93 
exû±
 
ImpÜtE¼Ü
:

94 
impÜt
 
SŒšgIO


95 
DEFAULT_BUFFER_SIZE
 = -1

97 
_feobjeù_u£s_¡r_ty³
 = 
	`isš¡ªû
(
sock‘
.
	`_feobjeù
(
NÚe
).
_rbuf
, 
ba£¡ršg
)

99 
impÜt
 
th»adšg


100 
impÜt
 
time


101 
impÜt
 
Œaûback


102 
def
 
	$fÜm©_exc
(
lim™
=
NÚe
):

104 
Œy
:

105 
‘y³
, 
v®ue
, 
tb
 = 
sys
.
	$exc_šfo
()

106  ''.
	`još
(
Œaûback
.
	$fÜm©_exû±iÚ
(
‘y³
, 
v®ue
, 
tb
, 
lim™
))

107 
fš®ly
:

108 
‘y³
 = 
v®ue
 = 
tb
 = 
NÚe


110 
impÜt
 
İ”©Ü


112 
äom
 
u¾lib
 
impÜt
 
unquÙe


113 
impÜt
 
w¬nšgs


115 
sys
.
v”siÚ_šfo
 >= (3, 0):

116 
by‹¡r
 = 
by‹s


117 
unicode¡r
 = 
¡r


118 
ba£¡ršg
 = (
by‹s
, 
¡r
)

119 
def
 
	`Áob
(
n
, 
’codšg
='ISO-8859-1'):

121 #IÀ
PythÚ
 3, 
the
 
Çtive
 
¡ršg
 
ty³
 
is
 
unicode


122  
n
.
	$’code
(
’codšg
)

124 
by‹¡r
 = 
¡r


125 
unicode¡r
 = 
unicode


126 
ba£¡ršg
 = basestring

127 
def
 
	`Áob
(
n
, 
’codšg
='ISO-8859-1'):

129 #IÀ
PythÚ
 2, 
the
 
Çtive
 
¡ršg
 
ty³
 
is
 
by‹s
. 
Assume
 
™
's‡lready

130 #š 
the
 
giv’
 
’codšg
, 
which
 
ISO
-8859-1 
is
 
®mo¡
 
®ways
 
wh©


131 #wa 
š‹nded
.

132  
n


134 
LF
 = 
	`Áob
('\n')

135 
CRLF
 = 
	`Áob
('\r\n')

136 
TAB
 = 
	`Áob
('\t')

137 
SPACE
 = 
	`Áob
(' ')

138 
COLON
 = 
	`Áob
(':')

139 
SEMICOLON
 = 
	`Áob
(';')

140 
EMPTY
 = 
	`Áob
('')

141 
NUMBER_SIGN
 = 
	`Áob
('#')

142 
QUESTION_MARK
 = 
	`Áob
('?')

143 
ASTERISK
 = 
	`Áob
('*')

144 
FORWARD_SLASH
 = 
	`Áob
('/')

145 
quÙed_¦ash
 = 
»
.
	`compe
(
	`Áob
("(?i)%2F"))

147 
impÜt
 
”ºo


149 
def
 
	$¶©_¥ecific_”rÜs
(*
”ºames
):

152 
The
 '”ºo' 
moduË
 
cÚšs
 
difã»Á
 
glob®
 
cÚ¡ªts
 
d•’dšg
 
Ú


153 
the
 
¥ecific
 
	`¶©fÜm
 (
OS
). 
This
 
funùiÚ
 
wl
 h
li¡
 
of


154 
num”ic
 
v®ues
 
a
 
giv’
 
li¡
 
of
 
pÙ’tŸl
 
Çmes
.

156 
”ºo_Çmes
 = 
	$dœ
(
”ºo
)

157 
nums
 = [
	$g‘©Œ
(
”ºo
, 
k
èk 
š
 
”ºames
 k iÀ
”ºo_Çmes
]

158 #de-
du³
 
the
 
li¡


159  
	`li¡
(
diù
.
	`äomkeys
(
nums
).
	$keys
())

161 
sock‘_”rÜ_ešŒ
 = 
	`¶©_¥ecific_”rÜs
("EINTR", "WSAEINTR")

163 
sock‘_”rÜs_to_ignÜe
 = 
	`¶©_¥ecific_”rÜs
(

174 
sock‘_”rÜs_to_ignÜe
.
	`­³nd
("timed out")

175 
sock‘_”rÜs_to_ignÜe
.
	`­³nd
("The„ead operationimed out")

177 
sock‘_”rÜs_nÚblockšg
 = 
	`¶©_¥ecific_”rÜs
(

180 
comma_£·¿‹d_h—d”s
 = [
	$Áob
(
h
èh 
š


189 
impÜt
 
loggšg


190 
nÙ
 
	`ha§‰r
(
loggšg
, '¡©i¡ics'):†oggšg.
¡©i¡ics
 = {
	}
}

193 
def
 
	$»ad_h—d”s
(
rfe
, 
hdiù
=
NÚe
):

196 
If
 
hdiù
 
is
 
NÚe
, 
a
 
Ãw
 
h—d”
 
diù
 i 
ü—‹d
. 
R‘uºs
 
the
 
pİuÏ‹d


197 
h—d”
 
diù
.

199 
H—d”s
 
which
 
¬e
 
»³©ed
‡» 
fŞded
 
tog‘h”
 
usšg
 
a
 
comma
 
theœ


200 
¥ecifiÿtiÚ
 
so
 
diù©es
.

202 
This
 
funùiÚ
 
¿i£s
 
V®ueE¼Ü
 
wh’
 
the
 
»ad
 
by‹s
 
viŞ©e
h
HTTP
 
¥ec
.

203 
You
 
should
 
´obably
  "400 Bad Reque¡" 
this
 
h­³ns
.

205 
hdiù
 
is
 
NÚe
:

206 
hdiù
 = {
	}
}

208 
True
:

209 
lše
 = 
rfe
.
	$»adlše
()

210 
nÙ
 
lše
:

211 #NØ
mÜe
 
d©a
--
Ëg®
 
’d
 
of
 
h—d”s


212 
¿i£
 
	`V®ueE¼Ü
("Illegalƒnd of headers.")

214 
lše
 =ğ
CRLF
:

215 #NÜm® 
’d
 
of
 
h—d”s


217 
nÙ
 
lše
.
	$’dsw™h
(
CRLF
):

218 
¿i£
 
	`V®ueE¼Ü
("HTTP„equires CRLFerminators")

220 
lše
[0] 
	$š
 (
SPACE
, 
TAB
):

222 
v
 = 
lše
.
	$¡r
()

224 
Œy
:

225 
k
, 
v
 = 
lše
.
	$¥l™
(
COLON
, 1)

226 
exû±
 
V®ueE¼Ü
:

227 
¿i£
 
	`V®ueE¼Ü
("Illegal header†ine.")

228 #TODO: 
wh©
 
about
 
TE
 
ªd
 
WWW
-
Auth’tiÿ‹
?

229 
k
 = k.
	`¡r
().
	$t™Ë
()

230 
v
 = v.
	$¡r
()

231 
hÇme
 = 
k


233 
k
 
š
 
comma_£·¿‹d_h—d”s
:

234 
exi¡šg
 = 
hdiù
.
	$g‘
(
hÇme
)

235 
exi¡šg
:

236 
v
 = ", ".
	`još
((
exi¡šg
, v))

237 
hdiù
[
hÇme
] = 
v


239  
hdiù


242 
şass
 
	$MaxSizeExûeded
(
Exû±iÚ
):

243 
·ss


245 
şass
 
	$SizeCheckW¿µ”
(
objeù
):

248 
def
 
	$__š™__
(
£lf
, 
rfe
, 
maxËn
):

249 
£lf
.
rfe
 =„file

250 
£lf
.
maxËn
 = maxlen

251 
£lf
.
by‹s_»ad
 = 0

253 
def
 
	$_check_Ëngth
(
£lf
):

254 
£lf
.
maxËn
 
ªd
 s–f.
by‹s_»ad
 > self.maxlen:

255 
¿i£
 
	$MaxSizeExûeded
()

257 
def
 
	$»ad
(
£lf
, 
size
=
NÚe
):

258 
d©a
 = 
£lf
.
rfe
.
	$»ad
(
size
)

259 
£lf
.
by‹s_»ad
 +ğ
	$Ën
(
d©a
)

260 
£lf
.
	$_check_Ëngth
()

261  
d©a


263 
def
 
	$»adlše
(
£lf
, 
size
=
NÚe
):

264 
size
 
is
 
nÙ
 
NÚe
:

265 
d©a
 = 
£lf
.
rfe
.
	$»adlše
(
size
)

266 
£lf
.
by‹s_»ad
 +ğ
	$Ën
(
d©a
)

267 
£lf
.
	$_check_Ëngth
()

268  
d©a


270 #U£¸
didn
't specify‡ size ...

271 #W
»ad
 
the
 
lše
 
š
 
chunks
 
to
 
make
 
su»
 
™
's‚ot‡ 100MB†ine !

272 
»s
 = []

273 
True
:

274 
d©a
 = 
£lf
.
rfe
.
	$»adlše
(256)

275 
£lf
.
by‹s_»ad
 +ğ
	$Ën
(
d©a
)

276 
£lf
.
	$_check_Ëngth
()

277 
»s
.
	$­³nd
(
d©a
)

278 #S“ 
h‰p
:

279 
	`Ën
(
d©a
è< 256 
Ü
 data[-1:] == "\n":

280  
EMPTY
.
	$još
(
»s
)

282 
def
 
	$»adlšes
(
£lf
, 
sizehšt
=0):

283 #Sham–es¦y 
¡Ş’
 
äom
 
SŒšgIO


284 
tÙ®
 = 0

285 
lšes
 = []

286 
lše
 = 
£lf
.
	$»adlše
()

287 
lše
:

288 
lšes
.
	$­³nd
(
lše
)

289 
tÙ®
 +ğ
	$Ën
(
lše
)

290 0 < 
sizehšt
 <ğ
tÙ®
:

292 
lše
 = 
£lf
.
	$»adlše
()

293  
lšes


295 
def
 
	$şo£
(
£lf
):

296 
£lf
.
rfe
.
	$şo£
()

298 
def
 
	$__™”__
(
£lf
):

299  
£lf


301 
def
 
	$__Ãxt__
(
£lf
):

302 
d©a
 = 
	$Ãxt
(
£lf
.
rfe
)

303 
£lf
.
by‹s_»ad
 +ğ
	$Ën
(
d©a
)

304 
£lf
.
	$_check_Ëngth
()

305  
d©a


307 
def
 
	$Ãxt
(
£lf
):

308 
d©a
 = 
£lf
.
rfe
.
	$Ãxt
()

309 
£lf
.
by‹s_»ad
 +ğ
	$Ën
(
d©a
)

310 
£lf
.
	$_check_Ëngth
()

311  
d©a


314 
şass
 
	$KnownL’gthRFe
(
objeù
):

317 
def
 
	$__š™__
(
£lf
, 
rfe
, 
cÚ‹Á_Ëngth
):

318 
£lf
.
rfe
 =„file

319 
£lf
.
»maššg
 = 
cÚ‹Á_Ëngth


321 
def
 
	$»ad
(
£lf
, 
size
=
NÚe
):

322 
£lf
.
»maššg
 == 0:

324 
size
 
is
 
NÚe
:

325 
size
 = 
£lf
.
»maššg


327 
size
 = 
	$mš
(
size
, 
£lf
.
»maššg
)

329 
d©a
 = 
£lf
.
rfe
.
	$»ad
(
size
)

330 
£lf
.
»maššg
 -ğ
	$Ën
(
d©a
)

331  
d©a


333 
def
 
	$»adlše
(
£lf
, 
size
=
NÚe
):

334 
£lf
.
»maššg
 == 0:

336 
size
 
is
 
NÚe
:

337 
size
 = 
£lf
.
»maššg


339 
size
 = 
	$mš
(
size
, 
£lf
.
»maššg
)

341 
d©a
 = 
£lf
.
rfe
.
	$»adlše
(
size
)

342 
£lf
.
»maššg
 -ğ
	$Ën
(
d©a
)

343  
d©a


345 
def
 
	$»adlšes
(
£lf
, 
sizehšt
=0):

346 #Sham–es¦y 
¡Ş’
 
äom
 
SŒšgIO


347 
tÙ®
 = 0

348 
lšes
 = []

349 
lše
 = 
£lf
.
	$»adlše
(
sizehšt
)

350 
lše
:

351 
lšes
.
	$­³nd
(
lše
)

352 
tÙ®
 +ğ
	$Ën
(
lše
)

353 0 < 
sizehšt
 <ğ
tÙ®
:

355 
lše
 = 
£lf
.
	$»adlše
(
sizehšt
)

356  
lšes


358 
def
 
	$şo£
(
£lf
):

359 
£lf
.
rfe
.
	$şo£
()

361 
def
 
	$__™”__
(
£lf
):

362  
£lf


364 
def
 
	$__Ãxt__
(
£lf
):

365 
d©a
 = 
	$Ãxt
(
£lf
.
rfe
)

366 
£lf
.
»maššg
 -ğ
	$Ën
(
d©a
)

367  
d©a


370 
şass
 
	$ChunkedRFe
(
objeù
):

373 
This
 
şass
 
is
 
š‹nded
 
to
 
´ovide
 
a
 
cÚfÜmšg
 
wsgi
.
šput
 
v®ue
 

374 
»que¡
 
’t™›s
 
th©
 
have
 
b“n
 
’coded
 
w™h
 
the
 'chunked' 
Œªsãr


375 
’codšg
.

378 
def
 
	$__š™__
(
£lf
, 
rfe
, 
maxËn
, 
bufsize
=8192):

379 
£lf
.
rfe
 =„file

380 
£lf
.
maxËn
 = maxlen

381 
£lf
.
by‹s_»ad
 = 0

382 
£lf
.
bufãr
 = 
EMPTY


383 
£lf
.
bufsize
 = bufsize

384 
£lf
.
şo£d
 = 
F®£


386 
def
 
	$_ãtch
(
£lf
):

387 
£lf
.
şo£d
:

390 
lše
 = 
£lf
.
rfe
.
	$»adlše
()

391 
£lf
.
by‹s_»ad
 +ğ
	$Ën
(
lše
)

393 
£lf
.
maxËn
 
ªd
 s–f.
by‹s_»ad
 > self.maxlen:

394 
¿i£
 
	`MaxSizeExûeded
("Reque¡ EÁ™y ToØL¬ge", 
£lf
.
maxËn
)

396 
lše
 =†še.
	`¡r
().
	$¥l™
(
SEMICOLON
, 1)

398 
Œy
:

399 
chunk_size
 = 
lše
.
	$pİ
(0)

400 
chunk_size
 = (chunk_size, 16)

401 
exû±
 
V®ueE¼Ü
:

402 
¿i£
 
	`V®ueE¼Ü
("Bad chunked¿nsã¸size: " + 
	$»´
(
chunk_size
))

404 
chunk_size
 <= 0:

405 
£lf
.
şo£d
 = 
True


408 ## 
lše
: 
chunk_ex‹nsiÚ
 =†ine[0]

410 
£lf
.
maxËn
 
ªd
 s–f.
by‹s_»ad
 + 
chunk_size
 > self.maxlen:

411 
¿i£
 
	`IOE¼Ü
("Request Entity Too Large")

413 
chunk
 = 
£lf
.
rfe
.
	$»ad
(
chunk_size
)

414 
£lf
.
by‹s_»ad
 +ğ
	$Ën
(
chunk
)

415 
£lf
.
bufãr
 +ğ
chunk


417 
ülf
 = 
£lf
.
rfe
.
	$»ad
(2)

418 
ülf
 !ğ
CRLF
:

419 
¿i£
 
	`V®ueE¼Ü
(

421 "gÙ " + 
	`»´
(
ülf
) + ")")

423 
def
 
	$»ad
(
£lf
, 
size
=
NÚe
):

424 
d©a
 = 
EMPTY


425 
True
:

426 
size
 
ªd
 
	`Ën
(
d©a
) >= size:

427  
d©a


429 
nÙ
 
£lf
.
bufãr
:

430 
£lf
.
	$_ãtch
()

431 
nÙ
 
£lf
.
bufãr
:

433  
d©a


435 
size
:

436 
»maššg
 = 
size
 - 
	$Ën
(
d©a
)

437 
d©a
 +ğ
£lf
.
bufãr
[:
»maššg
]

438 
£lf
.
bufãr
 = s–f.bufãr[
»maššg
:]

440 
d©a
 +ğ
£lf
.
bufãr


442 
def
 
	$»adlše
(
£lf
, 
size
=
NÚe
):

443 
d©a
 = 
EMPTY


444 
True
:

445 
size
 
ªd
 
	`Ën
(
d©a
) >= size:

446  
d©a


448 
nÙ
 
£lf
.
bufãr
:

449 
£lf
.
	$_ãtch
()

450 
nÙ
 
£lf
.
bufãr
:

452  
d©a


454 
Ãwlše_pos
 = 
£lf
.
bufãr
.
	$fšd
(
LF
)

455 
size
:

456 
Ãwlše_pos
 == -1:

457 
»maššg
 = 
size
 - 
	$Ën
(
d©a
)

458 
d©a
 +ğ
£lf
.
bufãr
[:
»maššg
]

459 
£lf
.
bufãr
 = s–f.bufãr[
»maššg
:]

461 
»maššg
 = 
	`mš
(
size
 - 
	`Ën
(
d©a
), 
Ãwlše_pos
)

462 
d©a
 +ğ
£lf
.
bufãr
[:
»maššg
]

463 
£lf
.
bufãr
 = s–f.bufãr[
»maššg
:]

465 
Ãwlše_pos
 == -1:

466 
d©a
 +ğ
£lf
.
bufãr


468 
d©a
 +ğ
£lf
.
bufãr
[:
Ãwlše_pos
]

469 
£lf
.
bufãr
 = s–f.bufãr[
Ãwlše_pos
:]

471 
def
 
	$»adlšes
(
£lf
, 
sizehšt
=0):

472 #Sham–es¦y 
¡Ş’
 
äom
 
SŒšgIO


473 
tÙ®
 = 0

474 
lšes
 = []

475 
lše
 = 
£lf
.
	$»adlše
(
sizehšt
)

476 
lše
:

477 
lšes
.
	$­³nd
(
lše
)

478 
tÙ®
 +ğ
	$Ën
(
lše
)

479 0 < 
sizehšt
 <ğ
tÙ®
:

481 
lše
 = 
£lf
.
	$»adlše
(
sizehšt
)

482  
lšes


484 
def
 
	$»ad_Œa”_lšes
(
£lf
):

485 
nÙ
 
£lf
.
şo£d
:

486 
¿i£
 
	`V®ueE¼Ü
(

489 
True
:

490 
lše
 = 
£lf
.
rfe
.
	$»adlše
()

491 
nÙ
 
lše
:

492 #NØ
mÜe
 
d©a
--
Ëg®
 
’d
 
of
 
h—d”s


493 
¿i£
 
	`V®ueE¼Ü
("Illegalƒnd of headers.")

495 
£lf
.
by‹s_»ad
 +ğ
	$Ën
(
lše
)

496 
£lf
.
maxËn
 
ªd
 s–f.
by‹s_»ad
 > self.maxlen:

497 
¿i£
 
	`IOE¼Ü
("Request Entity Too Large")

499 
lše
 =ğ
CRLF
:

500 #NÜm® 
’d
 
of
 
h—d”s


502 
nÙ
 
lše
.
	$’dsw™h
(
CRLF
):

503 
¿i£
 
	`V®ueE¼Ü
("HTTP„equires CRLFerminators")

505 
y›ld
 
lše


507 
def
 
	$şo£
(
£lf
):

508 
£lf
.
rfe
.
	$şo£
()

510 
def
 
	$__™”__
(
£lf
):

511 #Sham–es¦y 
¡Ş’
 
äom
 
SŒšgIO


512 
tÙ®
 = 0

513 
lše
 = 
£lf
.
	$»adlše
(
sizehšt
)

514 
lše
:

515 
y›ld
 
lše


516 
tÙ®
 +ğ
	$Ën
(
lše
)

517 0 < 
sizehšt
 <ğ
tÙ®
:

519 
lše
 = 
£lf
.
	$»adlše
(
sizehšt
)

522 
şass
 
	$HTTPReque¡
(
objeù
):

525 
A
 
sšgË
 
HTTP
 
cÚÃùiÚ
 
may
 
cÚsi¡
 
of
 
muÉË
 
»que¡
/
»¥Ú£
 
·œs
.

528 
£rv”
 = 
NÚe


531 
cÚn
 = 
NÚe


534 
šh—d”s
 = {
	}
}

537 
outh—d”s
 = []

540 
»ady
 = 
F®£


542 
the
 
»¥Ú£
. 
Wh’
 
F®£
, 
sigÇls
h
ÿÎšg
 
CÚÃùiÚ
 
th©
he„esponse

543 
should
 
nÙ
 
be
 
g’”©ed
 
ªd
 
the
 
cÚÃùiÚ
 should 
	gşo£
."""

545 
	gşo£_cÚÃùiÚ
 = 
F®£


547 
nÙ
 
im¶y
 
ª
 
”rÜ
! 
The
 
ş›Á
 
ªd
/
Ü
 
£rv”
 
may
 
—ch
 
»que¡
 
th©
 
the


548 
cÚÃùiÚ
 
be
 
şo£d
."""

550 
chunked_wr™e
 = 
F®£


551 """IàTrue, ouuˆwÈb’coded w™hh"
chunked
"ransfer-coding.

553 
This
 
v®ue
 
is
 
£t
 
autom©iÿÎy
 
šside
 
£nd_h—d”s
."""

555 
def
 
	$__š™__
(
£lf
, 
£rv”
, 
cÚn
):

556 
£lf
.
£rv”
= server

557 
£lf
.
cÚn
 = conn

559 
£lf
.
»ady
 = 
F®£


560 
£lf
.
¡¬‹d_»que¡
 = 
F®£


561 
£lf
.
scheme
 = 
	`Áob
("http")

562 
£lf
.
£rv”
.
s¦_ad­‹r
 
is
 
nÙ
 
NÚe
:

563 
£lf
.
scheme
 = 
	`Áob
("https")

564 #U£ 
the
 
lowe¡
-
commÚ
 
´ÙocŞ
 
š
 
»ad_»que¡_lše
 
”rÜs
.

565 
£lf
.
»¥Ú£_´ÙocŞ
 = 'HTTP/1.0'

566 
£lf
.
šh—d”s
 = {
	}
}

568 
£lf
.
¡©us
 = ""

569 
£lf
.
outh—d”s
 = []

570 
£lf
.
£Á_h—d”s
 = 
F®£


571 
£lf
.
şo£_cÚÃùiÚ
 = s–f.
__şass__
.close_connection

572 
£lf
.
chunked_»ad
 = 
F®£


573 
£lf
.
chunked_wr™e
 = s–f.
__şass__
.chunked_write

575 
def
 
	$·r£_»que¡
(
£lf
):

577 
£lf
.
rfe
 = 
	$SizeCheckW¿µ”
(
£lf
.
cÚn
.
rfe
,

578 
£lf
.
£rv”
.
max_»que¡_h—d”_size
)

579 
Œy
:

580 
sucûss
 = 
£lf
.
	$»ad_»que¡_lše
()

581 
exû±
 
MaxSizeExûeded
:

582 
£lf
.
	`sim¶e_»¥Ú£
("414 Request-URI Too Long",

587 
nÙ
 
sucûss
:

590 
Œy
:

591 
sucûss
 = 
£lf
.
	$»ad_»que¡_h—d”s
()

592 
exû±
 
MaxSizeExûeded
:

593 
£lf
.
	`sim¶e_»¥Ú£
("413 Request Entity Too Large",

598 
nÙ
 
sucûss
:

601 
£lf
.
»ady
 = 
True


603 
def
 
	$»ad_»que¡_lše
(
£lf
):

604 #HTTP/1.1 
cÚÃùiÚs
 
¬e
 
³rsi¡’t
 
by
 . 
If
 
a
 
ş›Á


605 #»que¡ 
a
 
·ge
, 
th’
 
	`idËs
 (
Ëaves
 
the
 
cÚÃùiÚ
 
İ’
),

606 #th’ 
rfe
.
	`»adlše
(è
wl
 
¿i£
 
sock‘
.
	`”rÜ
("timed out").

607 #NÙ
th©
 
™
 
dÛs
 
this
 
ba£d
 
Ú
 
the
 
v®ue
 
giv’
 
to
 
	`£‰imeout
(),

608 #ªd 
dÛ¢
't‚eedhe cliento„equest or‡cknowledgehe close

609 #(
®though
 
your
 
TCP
 
¡ack
 
might
 
sufãr
 
™
: 
cf
 
A·che
's history

610 #w™h 
FIN_WAIT_2
).

611 
»que¡_lše
 = 
£lf
.
rfe
.
	$»adlše
()

613 #S‘ 
¡¬‹d_»que¡
 
to
 
True
 
so
 
	`communiÿ‹
(è
knows
Ø
£nd
 408

614 #äom 
h”e
 
Ú
 
out
.

615 
£lf
.
¡¬‹d_»que¡
 = 
True


616 
nÙ
 
»que¡_lše
:

617  
F®£


619 
»que¡_lše
 =ğ
CRLF
:

620 #RFC 2616 
£c
 4.1: "...ifhe server is„eadinghe…rotocol

621 #¡»am 
©
 
the
 
begšnšg
 
of
 
a
 
mes§ge
 
ªd
 
»ûives
‡ 
CRLF


622 #fœ¡, 
™
 
should
 
ignÜe
 
the
 
CRLF
."

623 #Buˆ
Úly
 
ignÜe
 
Úe
 
Ëadšg
 
lše
! 
we
 
’abË
 
a
 
DoS
.

624 
»que¡_lše
 = 
£lf
.
rfe
.
	$»adlše
()

625 
nÙ
 
»que¡_lše
:

626  
F®£


628 
nÙ
 
»que¡_lše
.
	$’dsw™h
(
CRLF
):

629 
£lf
.
	`sim¶e_»¥Ú£
("400 Bad Request", "HTTP„equires CRLFerminators")

630  
F®£


632 
Œy
:

633 
m‘hod
, 
uri
, 
»q_´ÙocŞ
 = 
»que¡_lše
.
	`¡r
().
	$¥l™
(
SPACE
, 2)

634 
½
 = (
»q_´ÙocŞ
[5]), (req_protocol[7])

635 
	$exû±
 (
V®ueE¼Ü
, 
IndexE¼Ü
):

636 
£lf
.
	`sim¶e_»¥Ú£
("400 Bad Request", "Malformed Request-Line")

637  
F®£


639 
£lf
.
uri
 = uri

640 
£lf
.
m‘hod
 = method

642 #ur˜
may
 
be
 
ª
 
	`abs_·th
 (
šşudšg
 "http://host.domain.tld");

643 
scheme
, 
authÜ™y
, 
·th
 = 
£lf
.
	$·r£_»que¡_uri
(
uri
)

644 
NUMBER_SIGN
 
š
 
·th
:

645 
£lf
.
	`sim¶e_»¥Ú£
("400 Bad Request",

647  
F®£


649 
scheme
:

650 
£lf
.
scheme
 = scheme

652 
qs
 = 
EMPTY


653 
QUESTION_MARK
 
š
 
·th
:

654 
·th
, 
qs
 =…©h.
	$¥l™
(
QUESTION_MARK
, 1)

656 #UnquÙ
the
 
·th
+
	`·¿ms
 (
e
.
g
. "/this%20path" -> "/this…ath").

658 #
#Buˆ
nÙe
 
th©
 "...a URI must be separated into its components

659 #befÜ
the
 
esÿ³d
 
ch¬aù”s
 
w™hš
 
tho£
 
compÚ’ts
 
ÿn
 
be


660 #§ãly 
decoded
." http://www.ietf.org/rfc/rfc2396.txt, sec 2.4.2

661 #Th”efÜe, "/this%2F·th" 
becomes
 "/this%2F·th", 
nÙ
 "/this/path".

662 
Œy
:

663 
©oms
 = [
	$unquÙe
(
x
èx 
š
 
quÙed_¦ash
.
	`¥l™
(
·th
)]

664 
exû±
 
V®ueE¼Ü
:

665 
ex
 = 
sys
.
	`exc_šfo
()[1]

666 
£lf
.
	`sim¶e_»¥Ú£
("400 Bad Reque¡", 
ex
.
¬gs
[0])

667  
F®£


668 
·th
 = "%2F".
	$još
(
©oms
)

669 
£lf
.
·th
 =…ath

671 #NÙ
th©
, 
like
 
wsgœef
 
ªd
 
mo¡
 
Ùh”
 
HTTP
 
£rv”s
,

672 #w"% HEX HEX"-
unquÙe
 
the
 
·th
 
but
 
nÙ
h
qu”y
 
¡ršg
.

673 
£lf
.
qs
 = qs

675 #Com·» 
»que¡
 
ªd
 
£rv”
 
HTTP
 
´ÙocŞ
 
v”siÚs
, 
š
 
our


676 #£rv” 
dÛs
 
nÙ
 
suµÜt
 
the
 
»que¡ed
 
´ÙocŞ
. 
Lim™
 
our
 
ouut


677 #tØ
	`mš
(
»q
, 
£rv”
). 
We
 
wªt
 
the
 
fŞlowšg
 
ouut
:

678 #»que¡ 
£rv”
 
aùu®
 
wr™‹n
 
suµÜ‹d
 
»¥Ú£


679 #´ÙocŞ 
´ÙocŞ
 
»¥Ú£
…rÙocŞ 
ã©u»
 
£t


684 #NÙiû 
th©
, 
	`š
 (
b
), 
the
 
»¥Ú£
 
wl
 
be
 "HTTP/1.1" 
ev’
 
though


685 #th
ş›Á
 
Úly
 
und”¡ªds
 1.0. 
RFC
 2616 10.5.6 
§ys
 
we
 
should


686 #Úly  505 
the
 
_majÜ_
 
v”siÚ
 
is
 
difã»Á
.

687 
¥
 = (
£lf
.
£rv”
.
´ÙocŞ
[5]), (self.server.protocol[7])

689 
¥
[0] !ğ
½
[0]:

690 
£lf
.
	`sim¶e_»¥Ú£
("505 HTTP Version Not Supported")

691  
F®£


693 
£lf
.
»que¡_´ÙocŞ
 = 
»q_´ÙocŞ


694 
£lf
.
»¥Ú£_´ÙocŞ
 = "HTTP/%s.%s" % 
	$mš
(
½
, 
¥
)

696  
True


698 
def
 
	$»ad_»que¡_h—d”s
(
£lf
):

701 #th’ 
®l
 
the
 
h‰p
 
h—d”s


702 
Œy
:

703 
	$»ad_h—d”s
(
£lf
.
rfe
, s–f.
šh—d”s
)

704 
exû±
 
V®ueE¼Ü
:

705 
ex
 = 
sys
.
	`exc_šfo
()[1]

706 
£lf
.
	`sim¶e_»¥Ú£
("400 Bad Reque¡", 
ex
.
¬gs
[0])

707  
F®£


709 
mrbs
 = 
£lf
.
£rv”
.
max_»que¡_body_size


710 
mrbs
 
ªd
 (
£lf
.
šh—d”s
.
	`g‘
("Content-Length", 0)) > mrbs:

711 
£lf
.
	`sim¶e_»¥Ú£
("413 Request Entity Too Large",

714  
F®£


716 #P”si¡’ˆ
cÚÃùiÚ
 
suµÜt


717 
£lf
.
»¥Ú£_´ÙocŞ
 == "HTTP/1.1":

718 #BÙh 
£rv”
 
ªd
 
ş›Á
 
¬e
 
HTTP
/1.1

719 
£lf
.
šh—d”s
.
	`g‘
("Connection", "") == "close":

720 
£lf
.
şo£_cÚÃùiÚ
 = 
True


722 #E™h” 
the
 
£rv”
 
Ü
 
	`ş›Á
 (Ü 
bÙh
è
¬e
 
HTTP
/1.0

723 
£lf
.
šh—d”s
.
	`g‘
("Connection", "") != "Keep-Alive":

724 
£lf
.
şo£_cÚÃùiÚ
 = 
True


726 #T¿nsãr-
Encodšg
 
suµÜt


727 
‹
 = 
NÚe


728 
£lf
.
»¥Ú£_´ÙocŞ
 == "HTTP/1.1":

729 
‹
 = 
£lf
.
šh—d”s
.
	`g‘
("Transfer-Encoding")

730 
‹
:

731 
‹
 = [
x
.
	`¡r
().
	$low”
(è
x
 
š
 
‹
.
	`¥l™
(","èx.
	`¡r
()]

733 
£lf
.
chunked_»ad
 = 
F®£


735 
‹
:

736 
’c
 
š
 
‹
:

737 
’c
 == "chunked":

738 
£lf
.
chunked_»ad
 = 
True


740 #NÙ
th©
, 
ev’
 
we
 
£e
 "chunked", w
mu¡
 
»jeù


741 #ià
th”e
 
is
 
ª
 
ex‹nsiÚ
 
we
 
dÚ
't„ecognize.

742 
£lf
.
	`sim¶e_»¥Ú£
("501 Unimplemented")

743 
£lf
.
şo£_cÚÃùiÚ
 = 
True


744  
F®£


746 #From 
PEP
 333:

747 #"
S”v”s
 
ªd
 
g©eways
 
th©
 
im¶em’t
 
HTTP
 1.1 
mu¡
 
´ovide


748 #Œª¥¬’ˆ
suµÜt
 
HTTP
 1.1's "expect/continue" mechanism.

749 #Thi 
may
 
be
 
dÚe
 
š
 
ªy
 
of
 
£v”®
 
ways
:

750 #1. 
Re¥Úd
 
to
 
»que¡s
 
cÚššg
 
ª
 
Ex³ù
: 100- 
»que¡


751 #w™h 
ª
 
immedŸ‹
 "100 CÚtšue" 
»¥Ú£
, 
ªd
 
´oûed
 
nÜm®ly
.

752 #2. 
Proûed
 
w™h
 
the
 
»que¡
 
nÜm®ly
, 
but
 
´ovide
h
­¶iÿtiÚ


753 #w™h 
a
 
wsgi
.
šput
 
¡»am
 
th©
 
wl
 
£nd
 
the
 "100 Continue"

754 #»¥Ú£ /
wh’
 
the
 
­¶iÿtiÚ
 
fœ¡
 
©‹m±s
 
to
 
»ad
 
äom


755 #th
šput
 
¡»am
. 
The
 
»ad
 
»que¡
 
mu¡
 
th’
 
»maš
 
blocked


756 #uÁ 
the
 
ş›Á
 
»¥Úds
.

757 #3. 
Wa™
 
uÁ
 
the
 
ş›Á
 
decides
 
th©
h
£rv”
 
dÛs
 
nÙ
 
suµÜt


758 #ex³ù/, 
ªd
 
£nds
 
the
 
»que¡
 
body
 
Ú
 
™s
 
own
.

759 #(
This
 
is
 
subİtim®
, 
ªd
 i 
nÙ
 
»comm’ded
.)

760 #
#W
u£d
 
to
 dØ3, 
but
 
¬e
 
now
 
došg
 1. 
Maybe
 
we
'll do 2 someday,

761 #buˆ
™
 
£ems
 
like
 iˆ
would
 
be
 
a
 
big
 
¦owdown
 
such
‡ 
¿»
 .

762 
£lf
.
šh—d”s
.
	`g‘
("Expect", "") == "100-continue":

764 #w
dÚ
't want. See http://www.cherrypy.org/ticket/951

765 
msg
 = 
£lf
.
£rv”
.
´ÙocŞ
 + " 100 Continue\r\n\r\n"

766 
Œy
:

767 
£lf
.
cÚn
.
wfe
.
	$£nd®l
(
msg
)

768 
exû±
 
sock‘
.
”rÜ
:

769 
x
 = 
sys
.
	`exc_šfo
()[1]

770 
x
.
¬gs
[0] 
nÙ
 
š
 
sock‘_”rÜs_to_ignÜe
:

771 
¿i£


772  
True


774 
def
 
	$·r£_»que¡_uri
(
£lf
, 
uri
):

777 
NÙe
 
th©
 
Reque¡
-
URI
's must be one of::

779 
Reque¡
-
URI
 = "*" | 
absŞu‹URI
 | 
abs_·th
 | 
authÜ™y


781 
Th”efÜe
, 
a
 
Reque¡
-
URI
 
which
 
¡¬ts
 
w™h
‡ 
fÜw¬d
-
¦ash


782 
ÿÂÙ
 
be
 
a
 "net_path"::

784 
Ãt_·th
 = "//" 
authÜ™y
 [ 
abs_·th
 ]

786 
In¡—d
, 
™
 
mu¡
 
be
 
š‹½»‹d
 
as
 
ª
 "abs_·th" 
w™h
‡À
em±y
 
fœ¡


787 
·th
 
£gm’t
::

789 
abs_·th
 = "/" 
·th_£gm’ts


790 
·th_£gm’ts
 = 
£gm’t
 *( "/" segment )

791 
£gm’t
 = *
pch¬
 *Ğ";" 
·¿m
 )

792 
·¿m
 = *
pch¬


794 
uri
 =ğ
ASTERISK
:

795  
NÚe
, NÚe, 
uri


797 
i
 = 
uri
.
	`fšd
('://')

798 
i
 > 0 
ªd
 
QUESTION_MARK
 
nÙ
 
š
 
uri
[:i]:

799 #AÀ
absŞu‹URI
.

800 #Ià
th”e
's‡ scheme (and it must be http or https),hen:

801 #h‰p_URL = "h‰p:" "//" 
ho¡
 [ ":" 
pÜt
 ] [ 
abs_·th
 [ "?" 
qu”y
 ]]

802 
scheme
, 
»mašd”
 = 
uri
[:
i
].
	`low”
(), uri[i + 3:]

803 
authÜ™y
, 
·th
 = 
»mašd”
.
	$¥l™
(
FORWARD_SLASH
, 1)

804 
·th
 = 
FORWARD_SLASH
 +…ath

805  
scheme
, 
authÜ™y
, 
·th


807 
uri
.
	$¡¬tsw™h
(
FORWARD_SLASH
):

808 #AÀ
abs_·th
.

809  
NÚe
, NÚe, 
uri


811 #AÀ
authÜ™y
.

812  
NÚe
, 
uri
, None

814 
def
 
	$»¥Úd
(
£lf
):

816 
mrbs
 = 
£lf
.
£rv”
.
max_»que¡_body_size


817 
£lf
.
chunked_»ad
:

818 
£lf
.
rfe
 = 
	$ChunkedRFe
(
£lf
.
cÚn
.
rfe
, 
mrbs
)

820 
ş
 = (
£lf
.
šh—d”s
.
	`g‘
("Content-Length", 0))

821 
mrbs
 
ªd
 mrb < 
ş
:

822 
nÙ
 
£lf
.
£Á_h—d”s
:

823 
£lf
.
	`sim¶e_»¥Ú£
("413 Request Entity Too Large",

827 
£lf
.
rfe
 = 
	$KnownL’gthRFe
(
£lf
.
cÚn
.
rfe
, 
ş
)

829 
£lf
.
£rv”
.
	`g©eway
(£lf).
	$»¥Úd
()

831 ià(
£lf
.
»ady
 
ªd
 
nÙ
 s–f.
£Á_h—d”s
):

832 
£lf
.
£Á_h—d”s
 = 
True


833 
£lf
.
	$£nd_h—d”s
()

834 
£lf
.
chunked_wr™e
:

835 
£lf
.
cÚn
.
wfe
.
	`£nd®l
("0\r\n\r\n")

837 
def
 
	`sim¶e_»¥Ú£
(
£lf
, 
¡©us
, 
msg
=""):

839 
¡©us
 = 
	$¡r
(
¡©us
)

840 
buf
 = [
£lf
.
£rv”
.
´ÙocŞ
 + 
SPACE
 +

841 
¡©us
 + 
CRLF
,

842 "CÚ‹Á-L’gth: %s\r\n" % 
	`Ën
(
msg
),

845 
¡©us
[:3] 
	`š
 ("413", "414"):

846 #Reque¡ 
EÁ™y
 
Too
 
L¬ge
 / 
Reque¡
-
URI
 ToØ
LÚg


847 
£lf
.
şo£_cÚÃùiÚ
 = 
True


848 
£lf
.
»¥Ú£_´ÙocŞ
 == 'HTTP/1.1':

849 #Thi 
wl
 
nÙ
 
be
 
Œue
 414, 
sšû
 
»ad_»que¡_lše


850 #usu®ly 
¿i£s
 414 
befÜe
 
»adšg
 
the
 
whŞe
 
lše
, 
ªd
 
we


851 #th”efÜ
ÿÂÙ
 
know
 
the
 
´İ”
 
»¥Ú£_´ÙocŞ
.

852 
buf
.
	`­³nd
("Connection: close\r\n")

854 #HTTP/1.0 
had
 
no
 413/414 
¡©us
 
nÜ
 
CÚÃùiÚ
 
h—d”
.

855 #Em™ 400 
š¡—d
 
ªd
 
Œu¡
 
the
 
mes§ge
 
body
 
is
 
’ough
.

856 
¡©us
 = "400 Bad Request"

858 
buf
.
	$­³nd
(
CRLF
)

859 
msg
:

860 
	$isš¡ªû
(
msg
, 
unicode¡r
):

861 
msg
 = msg.
	`’code
("ISO-8859-1")

862 
buf
.
	$­³nd
(
msg
)

864 
Œy
:

865 
£lf
.
cÚn
.
wfe
.
	`£nd®l
("".
	$još
(
buf
))

866 
exû±
 
sock‘
.
”rÜ
:

867 
x
 = 
sys
.
	`exc_šfo
()[1]

868 
x
.
¬gs
[0] 
nÙ
 
š
 
sock‘_”rÜs_to_ignÜe
:

869 
¿i£


871 
def
 
	$wr™e
(
£lf
, 
chunk
):

873 
£lf
.
chunked_wr™e
 
ªd
 
chunk
:

874 
buf
 = [
	`hex
(
	`Ën
(
chunk
))[2:], 
CRLF
, chunk, CRLF]

875 
£lf
.
cÚn
.
wfe
.
	`£nd®l
(
EMPTY
.
	$još
(
buf
))

877 
£lf
.
cÚn
.
wfe
.
	$£nd®l
(
chunk
)

879 
def
 
	$£nd_h—d”s
(
£lf
):

882 
You
 
mu¡
 
£t
 
£lf
.
¡©us
, 
ªd
 s–f.
outh—d”s
 
befÜe
 
ÿÎšg
 
this
.

884 
hkeys
 = [
key
.
	$low”
(è
key
, 
v®ue
 
š
 
£lf
.
outh—d”s
]

885 
¡©us
 = (
£lf
.status[:3])

887 
¡©us
 == 413:

888 #Reque¡ 
EÁ™y
 
Too
 
L¬ge
. 
Clo£
 
cÚn
 
to
 
avoid
 
g¬bage
.

889 
£lf
.
şo£_cÚÃùiÚ
 = 
True


890 
–if
 "cÚ‹Á-Ëngth" 
nÙ
 
š
 
hkeys
:

891 #"
AÎ
 1xx (
šfÜm©iÚ®
), 204 (
no
 
cÚ‹Á
),

892 #ªd 304 (
nÙ
 
modif›d
è
»¥Ú£s
 
MUST
 
NOT


893 #šşud
a
 
mes§ge
-
body
." So‚o…oint chunking.

894 
¡©us
 < 200 
Ü
 stu 
	$š
 (204, 205, 304):

895 
·ss


897 ià(
£lf
.
»¥Ú£_´ÙocŞ
 == 'HTTP/1.1'

898 
ªd
 
£lf
.
m‘hod
 != 'HEAD'):

899 #U£ 
the
 
chunked
 
Œªsãr
-
codšg


900 
£lf
.
chunked_wr™e
 = 
True


901 
£lf
.
outh—d”s
.
	`­³nd
(("Transfer-Encoding", "chunked"))

903 #Closšg 
the
 
cÚn
 
is
h
Úly
 
way
 
to
 
d‘”mše
 
Ën
.

904 
£lf
.
şo£_cÚÃùiÚ
 = 
True


906 "cÚÃùiÚ" 
nÙ
 
š
 
hkeys
:

907 
£lf
.
»¥Ú£_´ÙocŞ
 == 'HTTP/1.1':

908 #BÙh 
£rv”
 
ªd
 
ş›Á
 
¬e
 
HTTP
/1.1 
Ü
 
b‘‹r


909 
£lf
.
şo£_cÚÃùiÚ
:

910 
£lf
.
outh—d”s
.
	`­³nd
(("Connection", "close"))

912 #S”v” 
ªd
/
Ü
 
ş›Á
 
¬e
 
HTTP
/1.0

913 
nÙ
 
£lf
.
şo£_cÚÃùiÚ
:

914 
£lf
.
outh—d”s
.
	`­³nd
(("Connection", "Keep-Alive"))

916 ià(
nÙ
 
£lf
.
şo£_cÚÃùiÚ
è
	$ªd
 (
nÙ
 
£lf
.
chunked_»ad
):

917 #R—d 
ªy
 
»maššg
 
»que¡
 
body
 
d©a
 
Ú
 
the
 
sock‘
.

918 #"
If
 
ª
 
Üigš
 
£rv”
 
»ûives
 
a
 
»que¡
 
th©
 
dÛs
 
nÙ
 
šşude
‡n

919 #Ex³ù 
»que¡
-
h—d”
 
f›ld
 
w™h
 
the
 "100-cÚtšue" 
ex³ù©iÚ
,

920 #th
»que¡
 
šşudes
 
a
„eque¡ 
body
, 
ªd
 
the
 
£rv”
 
»¥Úds


921 #w™h 
a
 
fš®
 
¡©us
 
code
 
befÜe
 
»adšg
 
the
 
’tœe
 
»que¡
 
body


922 #äom 
the
 
Œª¥Üt
 
cÚÃùiÚ
, 
th’
h
£rv”
 
SHOULD
 
NOT
 
şo£


923 #th
Œª¥Üt
 
cÚÃùiÚ
 
uÁ
 
™
 
has
 
»ad
 
the
 
’tœe
 
»que¡
,

924 #Ü 
uÁ
 
the
 
ş›Á
 
şo£s
h
cÚÃùiÚ
. 
Oth”wi£
,he client

925 #mighˆ
nÙ
 
»lŸbly
 
»ûive
 
the
 
»¥Ú£
 
mes§ge
. 
Howev”
, 
this


926 #»quœem’ˆ
is
 
nÙ
 
be
 
cÚ¡rued
 
as
 
´ev’tšg
 
a
 
£rv”
 
äom


927 #deãndšg 
™£lf
 
agaš¡
 
d’Ÿl
-
of
-
£rviû
 
©cks
, 
Ü
 
äom


928 #badly 
brok’
 
ş›Á
 
im¶em’tiÚs
."

929 
»maššg
 = 
	`g‘©Œ
(
£lf
.
rfe
, 'remaining', 0)

930 
»maššg
 > 0:

931 
£lf
.
rfe
.
	$»ad
(
»maššg
)

933 "d©e" 
nÙ
 
š
 
hkeys
:

934 
£lf
.
outh—d”s
.
	`­³nd
(("D©e", 
rfc822
.
	$fÜm©d©e
()))

936 "£rv”" 
nÙ
 
š
 
hkeys
:

937 
£lf
.
outh—d”s
.
	`­³nd
(("S”v”", s–f.
£rv”
.
£rv”_Çme
))

939 
buf
 = [
£lf
.
£rv”
.
´ÙocŞ
 + 
SPACE
 + s–f.
¡©us
 + 
CRLF
]

940 
k
, 
v
 
š
 
£lf
.
outh—d”s
:

941 
buf
.
	`­³nd
(
k
 + 
COLON
 + 
SPACE
 + 
v
 + 
CRLF
)

942 
buf
.
	$­³nd
(
CRLF
)

943 
£lf
.
cÚn
.
wfe
.
	`£nd®l
(
EMPTY
.
	$još
(
buf
))

946 
şass
 
	$NoSSLE¼Ü
(
Exû±iÚ
):

948 
·ss


951 
şass
 
	$F©®SSLAË¹
(
Exû±iÚ
):

953 
·ss


956 
şass
 
	$CP_feobjeù
(
sock‘
.
_feobjeù
):

959 
def
 
	$__š™__
(
£lf
, *
¬gs
, **
kw¬gs
):

960 
£lf
.
by‹s_»ad
 = 0

961 
£lf
.
by‹s_wr™‹n
 = 0

962 
sock‘
.
_feobjeù
.
	$__š™__
(
£lf
, *
¬gs
, **
kw¬gs
)

964 
def
 
	$£nd®l
(
£lf
, 
d©a
):

966 
d©a
:

967 
Œy
:

968 
by‹s_£Á
 = 
£lf
.
	$£nd
(
d©a
)

969 
d©a
 = d©a[
by‹s_£Á
:]

970 
exû±
 
sock‘
.
”rÜ
, 
e
:

971 
e
.
¬gs
[0] 
nÙ
 
š
 
sock‘_”rÜs_nÚblockšg
:

972 
¿i£


974 
def
 
	$£nd
(
£lf
, 
d©a
):

975 
by‹s_£Á
 = 
£lf
.
_sock
.
	$£nd
(
d©a
)

976 
£lf
.
by‹s_wr™‹n
 +ğ
by‹s_£Á


977  
by‹s_£Á


979 
def
 
	$æush
(
£lf
):

980 
£lf
.
_wbuf
:

981 
bufãr
 = "".
	$još
(
£lf
.
_wbuf
)

982 
£lf
.
_wbuf
 = []

983 
£lf
.
	$£nd®l
(
bufãr
)

985 
def
 
	$»cv
(
£lf
, 
size
):

986 
True
:

987 
Œy
:

988 
d©a
 = 
£lf
.
_sock
.
	$»cv
(
size
)

989 
£lf
.
by‹s_»ad
 +ğ
	$Ën
(
d©a
)

990  
d©a


991 
exû±
 
sock‘
.
”rÜ
, 
e
:

992 ià(
e
.
¬gs
[0] 
nÙ
 
š
 
sock‘_”rÜs_nÚblockšg


993 
ªd
 
e
.
¬gs
[0] 
nÙ
 
š
 
sock‘_”rÜ_ešŒ
):

994 
¿i£


996 
nÙ
 
_feobjeù_u£s_¡r_ty³
:

997 
def
 
	`»ad
(
£lf
, 
size
=-1):

998 #U£ 
max
, 
di§Îow
 
tšy
 
»ads
 
š
 
a
 
loİ
 
as
 
they
 
¬e
 
v”y
 
šeffic›Á
.

999 #W
Ãv”
 
Ëave
 
	`»ad
(è
w™h
 
ªy
 
Ëáov”
 
d©a
 
äom
 
a
 
Ãw
 
	`»cv
(è
ÿÎ


1000 #š 
our
 
š‹º®
 
bufãr
.

1001 
rbufsize
 = 
	$max
(
£lf
.
_rbufsize
, s–f.
deçuÉ_bufsize
)

1002 #Ou¸
u£
 
of
 
SŒšgIO
 
¿th”
 
thª
 
li¡s
 oà
¡ršg
 
objeùs
 
»tuºed
 
by


1003 #»cv(è
mšimizes
 
memÜy
 
u§ge
 
ªd
 
äagm’tiÚ
 
th©
 
occurs
 
wh’


1004 #rbufsiz
is
 
Ïrge
 
com·»d
 
to
 
the
 
typiÿl
  
v®ue
 
of
 
	`»cv
().

1005 
buf
 = 
£lf
.
_rbuf


1006 
buf
.
	$£ek
(0, 2è#£ek 
’d


1007 
size
 < 0:

1008 #R—d 
uÁ
 
EOF


1009 
£lf
.
_rbuf
 = 
SŒšgIO
.
	$SŒšgIO
(è#»£ˆ
_rbuf
. 
we
 
cÚsume
 
™
 
vŸ
 
buf
.

1010 
True
:

1011 
d©a
 = 
£lf
.
	$»cv
(
rbufsize
)

1012 
nÙ
 
d©a
:

1014 
buf
.
	$wr™e
(
d©a
)

1015  
buf
.
	$g‘v®ue
()

1017 #R—d 
uÁ
 
size
 
by‹s
 
Ü
 
EOF
 
£’
, 
whichev”
 
comes
 
fœ¡


1018 
buf_Ën
 = 
buf
.
	$‹Î
()

1019 
buf_Ën
 >ğ
size
:

1020 #AÌ—dy 
have
 
size
 
by‹s
 
š
 
our
 
bufãr
? 
ExŒaù
 
ªd
 .

1021 
buf
.
	$£ek
(0)

1022 
rv
 = 
buf
.
	$»ad
(
size
)

1023 
£lf
.
_rbuf
 = 
SŒšgIO
.
	$SŒšgIO
()

1024 
£lf
.
_rbuf
.
	`wr™e
(
buf
.
	$»ad
())

1025  
rv


1027 
£lf
.
_rbuf
 = 
SŒšgIO
.
	$SŒšgIO
(è#»£ˆ
_rbuf
. 
we
 
cÚsume
 
™
 
vŸ
 
buf
.

1028 
True
:

1029 
Ëá
 = 
size
 - 
buf_Ën


1030 #»cv(è
wl
 
m®loc
 
the
 
amouÁ
 
of
 
memÜy
 
giv’
 
as
 
™s


1031 #·¿m‘” 
ev’
 
though
 
™
 
oá’
 
»tuºs
 
much
 
Ëss
 
d©a


1032 #thª 
th©
. 
The
 
»tuºed
 
d©a
 
¡ršg
 
is
 
lived


1033 #a 
we
 
cİy
 
™
 
što
 
a
 
SŒšgIO
 
ªd
 
ä“
 it. 
This
 
avoids


1034 #äagm’tiÚ 
issues
 
Ú
 
mªy
 
¶©fÜms
.

1035 
d©a
 = 
£lf
.
	$»cv
(
Ëá
)

1036 
nÙ
 
d©a
:

1038 
n
 = 
	$Ën
(
d©a
)

1039 
n
 =ğ
size
 
ªd
 
nÙ
 
buf_Ën
:

1040 #ShÜtcut. 
Avoid
 
bufãr
 
d©a
 
cİ›s
 
wh’
:

1041 #- 
We
 
have
 
no
 
d©a
 
š
 
our
 
bufãr
.

1043 #- 
Our
 
ÿÎ
 
to
 
»cv
 
»tuºed
 
exaùly
 
the


1044 #numb” 
of
 
by‹s
 
we
 
w”e
 
asked
 
to
 
»ad
.

1045  
d©a


1046 
n
 =ğ
Ëá
:

1047 
buf
.
	$wr™e
(
d©a
)

1048 
d–
 
d©a
 #ex¶ic™ 
ä“


1050 
as£¹
 
n
 <ğ
Ëá
, "recv(%d)„eturned %d bytes" % (left,‚)

1051 
buf
.
	$wr™e
(
d©a
)

1052 
buf_Ën
 +ğ
n


1053 
d–
 
d©a
 #ex¶ic™ 
ä“


1054 #as£¹ 
buf_Ën
 =ğ
buf
.
	`‹Î
()

1055  
buf
.
	$g‘v®ue
()

1057 
def
 
	`»adlše
(
£lf
, 
size
=-1):

1058 
buf
 = 
£lf
.
_rbuf


1059 
buf
.
	$£ek
(0, 2è#£ek 
’d


1060 
buf
.
	`‹Î
() > 0:

1061 #check 
we
 
®»ady
 
have
 
™
 
š
 
our
 
bufãr


1062 
buf
.
	$£ek
(0)

1063 
blše
 = 
buf
.
	$»adlše
(
size
)

1064 
blše
.
	`’dsw™h
('\n'è
Ü
 
	`Ën
(blšeè=ğ
size
:

1065 
£lf
.
_rbuf
 = 
SŒšgIO
.
	$SŒšgIO
()

1066 
£lf
.
_rbuf
.
	`wr™e
(
buf
.
	$»ad
())

1067  
blše


1068 
d–
 
blše


1069 
size
 < 0:

1070 #R—d 
uÁ
 \
n
 
Ü
 
EOF
, 
whichev”
 
comes
 
fœ¡


1071 
£lf
.
_rbufsize
 <= 1:

1072 #S³ed 
up
 
unbufã»d
 

1073 
buf
.
	$£ek
(0)

1074 
bufãrs
 = [
buf
.
	`»ad
()]

1075 
£lf
.
_rbuf
 = 
SŒšgIO
.
	$SŒšgIO
(è#»£ˆ
_rbuf
. 
we
 
cÚsume
 
™
 
vŸ
 
buf
.

1076 
d©a
 = 
NÚe


1077 
»cv
 = 
£lf
.recv

1078 
d©a
 != "\n":

1079 
d©a
 = 
	$»cv
(1)

1080 
nÙ
 
d©a
:

1082 
bufãrs
.
	$­³nd
(
d©a
)

1083  "".
	$još
(
bufãrs
)

1085 
buf
.
	$£ek
(0, 2è#£ek 
’d


1086 
£lf
.
_rbuf
 = 
SŒšgIO
.
	$SŒšgIO
(è#»£ˆ
_rbuf
. 
we
 
cÚsume
 
™
 
vŸ
 
buf
.

1087 
True
:

1088 
d©a
 = 
£lf
.
	$»cv
(
£lf
.
_rbufsize
)

1089 
nÙ
 
d©a
:

1091 
Æ
 = 
d©a
.
	`fšd
('\n')

1092 
Æ
 >= 0:

1093 
Æ
 += 1

1094 
buf
.
	`wr™e
(
d©a
[:
Æ
])

1095 
£lf
.
_rbuf
.
	`wr™e
(
d©a
[
Æ
:])

1096 
d–
 
d©a


1098 
buf
.
	$wr™e
(
d©a
)

1099  
buf
.
	$g‘v®ue
()

1101 #R—d 
uÁ
 
size
 
by‹s
 
Ü
 \
n
 o¸
EOF
 
£’
, 
whichev”
 
comes
 
fœ¡


1102 
buf
.
	$£ek
(0, 2è#£ek 
’d


1103 
buf_Ën
 = 
buf
.
	$‹Î
()

1104 
buf_Ën
 >ğ
size
:

1105 
buf
.
	$£ek
(0)

1106 
rv
 = 
buf
.
	$»ad
(
size
)

1107 
£lf
.
_rbuf
 = 
SŒšgIO
.
	$SŒšgIO
()

1108 
£lf
.
_rbuf
.
	`wr™e
(
buf
.
	$»ad
())

1109  
rv


1110 
£lf
.
_rbuf
 = 
SŒšgIO
.
	$SŒšgIO
(è#»£ˆ
_rbuf
. 
we
 
cÚsume
 
™
 
vŸ
 
buf
.

1111 
True
:

1112 
d©a
 = 
£lf
.
	$»cv
(
£lf
.
_rbufsize
)

1113 
nÙ
 
d©a
:

1115 
Ëá
 = 
size
 - 
buf_Ën


1116 #did 
we
 
ju¡
 
»ûive
 
a
 
Ãwlše
?

1117 
Æ
 = 
d©a
.
	`fšd
('\n', 0, 
Ëá
)

1118 
Æ
 >= 0:

1119 
Æ
 += 1

1120 #§v
the
 
exûss
 
d©a
 
to
 
_rbuf


1121 
£lf
.
_rbuf
.
	`wr™e
(
d©a
[
Æ
:])

1122 
buf_Ën
:

1123 
buf
.
	`wr™e
(
d©a
[:
Æ
])

1126 #ShÜtcut. 
Avoid
 
d©a
 
cİy
 
through
 
buf
 
wh’
 
»tuºšg


1127 #¨
sub¡ršg
 
of
 
our
 
fœ¡
 
	`»cv
().

1128  
d©a
[:
Æ
]

1129 
n
 = 
	$Ën
(
d©a
)

1130 
n
 =ğ
size
 
ªd
 
nÙ
 
buf_Ën
:

1131 #ShÜtcut. 
Avoid
 
d©a
 
cİy
 
through
 
buf
 
wh’


1132 #»tuºšg 
exaùly
 
®l
 
of
 
our
 
fœ¡
 
	`»cv
().

1133  
d©a


1134 
n
 >ğ
Ëá
:

1135 
buf
.
	`wr™e
(
d©a
[:
Ëá
])

1136 
£lf
.
_rbuf
.
	`wr™e
(
d©a
[
Ëá
:])

1138 
buf
.
	$wr™e
(
d©a
)

1139 
buf_Ën
 +ğ
n


1140 #as£¹ 
buf_Ën
 =ğ
buf
.
	`‹Î
()

1141  
buf
.
	$g‘v®ue
()

1143 
def
 
	`»ad
(
£lf
, 
size
=-1):

1144 
size
 < 0:

1145 #R—d 
uÁ
 
EOF


1146 
bufãrs
 = [
£lf
.
_rbuf
]

1147 
£lf
.
_rbuf
 = ""

1148 
£lf
.
_rbufsize
 <= 1:

1149 
»cv_size
 = 
£lf
.
deçuÉ_bufsize


1151 
»cv_size
 = 
£lf
.
_rbufsize


1153 
True
:

1154 
d©a
 = 
£lf
.
	$»cv
(
»cv_size
)

1155 
nÙ
 
d©a
:

1157 
bufãrs
.
	$­³nd
(
d©a
)

1158  "".
	$još
(
bufãrs
)

1160 #R—d 
uÁ
 
size
 
by‹s
 
Ü
 
EOF
 
£’
, 
whichev”
 
comes
 
fœ¡


1161 
d©a
 = 
£lf
.
_rbuf


1162 
buf_Ën
 = 
	$Ën
(
d©a
)

1163 
buf_Ën
 >ğ
size
:

1164 
£lf
.
_rbuf
 = 
d©a
[
size
:]

1165  
d©a
[:
size
]

1166 
bufãrs
 = []

1167 
d©a
:

1168 
bufãrs
.
	$­³nd
(
d©a
)

1169 
£lf
.
_rbuf
 = ""

1170 
True
:

1171 
Ëá
 = 
size
 - 
buf_Ën


1172 
»cv_size
 = 
	$max
(
£lf
.
_rbufsize
, 
Ëá
)

1173 
d©a
 = 
£lf
.
	$»cv
(
»cv_size
)

1174 
nÙ
 
d©a
:

1176 
bufãrs
.
	$­³nd
(
d©a
)

1177 
n
 = 
	$Ën
(
d©a
)

1178 
n
 >ğ
Ëá
:

1179 
£lf
.
_rbuf
 = 
d©a
[
Ëá
:]

1180 
bufãrs
[-1] = 
d©a
[:
Ëá
]

1182 
buf_Ën
 +ğ
n


1183  "".
	$još
(
bufãrs
)

1185 
def
 
	`»adlše
(
£lf
, 
size
=-1):

1186 
d©a
 = 
£lf
.
_rbuf


1187 
size
 < 0:

1188 #R—d 
uÁ
 \
n
 
Ü
 
EOF
, 
whichev”
 
comes
 
fœ¡


1189 
£lf
.
_rbufsize
 <= 1:

1190 #S³ed 
up
 
unbufã»d
 

1191 
as£¹
 
d©a
 == ""

1192 
bufãrs
 = []

1193 
d©a
 != "\n":

1194 
d©a
 = 
£lf
.
	$»cv
(1)

1195 
nÙ
 
d©a
:

1197 
bufãrs
.
	$­³nd
(
d©a
)

1198  "".
	$još
(
bufãrs
)

1199 
Æ
 = 
d©a
.
	`fšd
('\n')

1200 
Æ
 >= 0:

1201 
Æ
 += 1

1202 
£lf
.
_rbuf
 = 
d©a
[
Æ
:]

1203  
d©a
[:
Æ
]

1204 
bufãrs
 = []

1205 
d©a
:

1206 
bufãrs
.
	$­³nd
(
d©a
)

1207 
£lf
.
_rbuf
 = ""

1208 
True
:

1209 
d©a
 = 
£lf
.
	$»cv
(
£lf
.
_rbufsize
)

1210 
nÙ
 
d©a
:

1212 
bufãrs
.
	$­³nd
(
d©a
)

1213 
Æ
 = 
d©a
.
	`fšd
('\n')

1214 
Æ
 >= 0:

1215 
Æ
 += 1

1216 
£lf
.
_rbuf
 = 
d©a
[
Æ
:]

1217 
bufãrs
[-1] = 
d©a
[:
Æ
]

1219  "".
	$još
(
bufãrs
)

1221 #R—d 
uÁ
 
size
 
by‹s
 
Ü
 \
n
 o¸
EOF
 
£’
, 
whichev”
 
comes
 
fœ¡


1222 
Æ
 = 
d©a
.
	`fšd
('\n', 0, 
size
)

1223 
Æ
 >= 0:

1224 
Æ
 += 1

1225 
£lf
.
_rbuf
 = 
d©a
[
Æ
:]

1226  
d©a
[:
Æ
]

1227 
buf_Ën
 = 
	$Ën
(
d©a
)

1228 
buf_Ën
 >ğ
size
:

1229 
£lf
.
_rbuf
 = 
d©a
[
size
:]

1230  
d©a
[:
size
]

1231 
bufãrs
 = []

1232 
d©a
:

1233 
bufãrs
.
	$­³nd
(
d©a
)

1234 
£lf
.
_rbuf
 = ""

1235 
True
:

1236 
d©a
 = 
£lf
.
	$»cv
(
£lf
.
_rbufsize
)

1237 
nÙ
 
d©a
:

1239 
bufãrs
.
	$­³nd
(
d©a
)

1240 
Ëá
 = 
size
 - 
buf_Ën


1241 
Æ
 = 
d©a
.
	`fšd
('\n', 0, 
Ëá
)

1242 
Æ
 >= 0:

1243 
Æ
 += 1

1244 
£lf
.
_rbuf
 = 
d©a
[
Æ
:]

1245 
bufãrs
[-1] = 
d©a
[:
Æ
]

1247 
n
 = 
	$Ën
(
d©a
)

1248 
n
 >ğ
Ëá
:

1249 
£lf
.
_rbuf
 = 
d©a
[
Ëá
:]

1250 
bufãrs
[-1] = 
d©a
[:
Ëá
]

1252 
buf_Ën
 +ğ
n


1253  "".
	$još
(
bufãrs
)

1256 
şass
 
	$HTTPCÚÃùiÚ
(
objeù
):

1259 
£rv”
: 
the
 
S”v”
 
objeù
 
which
 
»ûived
 
this
 
cÚÃùiÚ
.

1260 
sock‘
: 
the
 
¿w
 sock‘ 
	$objeù
 (
usu®ly
 
TCP
è
this
 
cÚÃùiÚ
.

1261 
makefe
: 
a
 
feobjeù
 
şass
 
»adšg
 
äom
 
the
 
sock‘
.

1264 
»mÙe_addr
 = 
NÚe


1265 
»mÙe_pÜt
 = 
NÚe


1266 
s¦_’v
 = 
NÚe


1267 
rbufsize
 = 
DEFAULT_BUFFER_SIZE


1268 
wbufsize
 = 
DEFAULT_BUFFER_SIZE


1269 
Reque¡HªdËrCÏss
 = 
HTTPReque¡


1271 
def
 
	$__š™__
(
£lf
, 
£rv”
, 
sock
, 
makefe
=
CP_feobjeù
):

1272 
£lf
.
£rv”
 = server

1273 
£lf
.
sock‘
 = 
sock


1274 
£lf
.
rfe
 = 
	`makefe
(
sock
, "rb", s–f.
rbufsize
)

1275 
£lf
.
wfe
 = 
	`makefe
(
sock
, "wb", s–f.
wbufsize
)

1276 
£lf
.
»que¡s_£’
 = 0

1278 
def
 
	$communiÿ‹
(
£lf
):

1280 
»que¡_£’
 = 
F®£


1281 
Œy
:

1282 
True
:

1283 #(
»
)
£t
 
»q
 
to
 
NÚe
 
so
 
th©
 
som‘hšg
 
gÛs
 
wrÚg
 
š


1284 #th
Reque¡HªdËrCÏss
 
cÚ¡ruùÜ
, 
the
 
”rÜ
 
dÛ¢
't

1285 #g‘ 
wr™‹n
 
to
 
the
 
´evious
 
»que¡
.

1286 
»q
 = 
NÚe


1287 
»q
 = 
£lf
.
	$Reque¡HªdËrCÏss
(
£lf
.
£rv”
, self)

1289 #Thi 
Üd”
 
of
 
İ”©iÚs
 
should
 
gu¬ª‹e
 
cÜ»ù
 
p–ššg
.

1290 
»q
.
	$·r£_»que¡
()

1291 
£lf
.
£rv”
.
¡©s
['Enabled']:

1292 
£lf
.
»que¡s_£’
 += 1

1293 
nÙ
 
»q
.
»ady
:

1294 #Som‘hšg 
w’t
 
wrÚg
 
š
 
the
 
	`·rsšg
 (
ªd
h
£rv”
 
has


1295 #´obably 
®»ady
 
made
 
a
 
sim¶e_»¥Ú£
). 
R‘uº
 
ªd


1296 #Ëˆ
the
 
cÚn
 
şo£
.

1299 
»que¡_£’
 = 
True


1300 
»q
.
	$»¥Úd
()

1301 
»q
.
şo£_cÚÃùiÚ
:

1303 
exû±
 
sock‘
.
”rÜ
:

1304 
e
 = 
sys
.
	`exc_šfo
()[1]

1305 
”ºum
 = 
e
.
¬gs
[0]

1306 #§dly 
SSL
 
sock‘s
  
a
 
	`difã»Á
 (
lÚg”
è
time
 
out
 
¡ršg


1307 
”ºum
 =ğ'timed out' 
Ü
ƒrrnum == 'The„ead operationimed out':

1308 #DÚ'ˆ”rÜ iàwe'
»
 
b‘w“n
 
»que¡s
; 
Úly
 
”rÜ


1309 #ià1è
no
 
»que¡
 
has
 
b“n
 
¡¬‹d
 
©
 
®l
, 
Ü
 2è
we
're

1310 #š 
the
 
middË
 
of
 
a
 
»que¡
.

1311 #S“ 
h‰p
:

1312 ià(
nÙ
 
»que¡_£’
è
	$Ü
 (
»q
 
ªd
„eq.
¡¬‹d_»que¡
):

1314 #ha 
®»ady
 
¡¬‹d
 
bešg
 
wr™‹n
.

1315 
»q
 
ªd
 
nÙ
„eq.
£Á_h—d”s
:

1316 
Œy
:

1317 
»q
.
	`sim¶e_»¥Ú£
("408 Request Timeout")

1318 
exû±
 
F©®SSLAË¹
:

1319 #Clo£ 
the
 
cÚÃùiÚ
.

1321 
–if
 
”ºum
 
nÙ
 
š
 
sock‘_”rÜs_to_ignÜe
:

1322 
£lf
.
£rv”
.
	`”rÜ_log
("sock‘.”rÜ %s" % 
	`»´
(
”ºum
),

1323 
Ëv–
=
loggšg
.
WARNING
, 
Œaûback
=
True
)

1324 
»q
 
ªd
 
nÙ
„eq.
£Á_h—d”s
:

1325 
Œy
:

1326 
»q
.
	`sim¶e_»¥Ú£
("500 Internal Server Error")

1327 
exû±
 
F©®SSLAË¹
:

1328 #Clo£ 
the
 
cÚÃùiÚ
.

1331 
	$exû±
 (
KeybßrdIÁ”ru±
, 
Sy¡emEx™
):

1332 
¿i£


1333 
exû±
 
F©®SSLAË¹
:

1334 #Clo£ 
the
 
cÚÃùiÚ
.

1336 
exû±
 
NoSSLE¼Ü
:

1337 
»q
 
ªd
 
nÙ
„eq.
£Á_h—d”s
:

1338 #Unw¿°
our
 
wfe


1339 
£lf
.
wfe
 = 
	`CP_feobjeù
(£lf.
sock‘
.
_sock
, "wb", s–f.
wbufsize
)

1340 
»q
.
	`sim¶e_»¥Ú£
("400 Bad Request",

1343 
£lf
.
lšg”
 = 
True


1344 
exû±
 
Exû±iÚ
:

1345 
e
 = 
sys
.
	`exc_šfo
()[1]

1346 
£lf
.
£rv”
.
	`”rÜ_log
(
	`»´
(
e
), 
Ëv–
=
loggšg
.
ERROR
, 
Œaûback
=
True
)

1347 
»q
 
ªd
 
nÙ
„eq.
£Á_h—d”s
:

1348 
Œy
:

1349 
»q
.
	`sim¶e_»¥Ú£
("500 Internal Server Error")

1350 
exû±
 
F©®SSLAË¹
:

1351 #Clo£ 
the
 
cÚÃùiÚ
.

1354 
lšg”
 = 
F®£


1356 
def
 
	$şo£
(
£lf
):

1358 
£lf
.
rfe
.
	$şo£
()

1360 
nÙ
 
£lf
.
lšg”
:

1362 #wh’ 
you
 
ÿÎ
 
sock‘
.
	`şo£
(). 
We
 dØ
so
 
mªu®ly
 
h”e
 
beÿu£
 
we


1363 #wªˆ
this
 
£rv”
 
to
 
£nd
 
a
 
FIN
 
TCP
 
£gm’t
 
immedŸ‹ly
. 
NÙe
his

1364 #mu¡ 
be
 
ÿÎed
 *
befÜe
* 
ÿÎšg
 
sock‘
.
	`şo£
(), 
beÿu£
 
the
 
Ï‰”


1365 #drİ 
™s
 
»ã»nû
 
to
 
the
 
k”Ãl
 
sock‘
.

1366 
	`ha§‰r
(
£lf
.
sock‘
, '_sock'):

1367 
£lf
.
sock‘
.
_sock
.
	$şo£
()

1368 
£lf
.
sock‘
.
	$şo£
()

1370 #OÀ
the
 
Ùh”
 
hªd
, 
som‘imes
 
we
 
wªt
 
to
 
hªg
 
¬ound
 
a
 
b™


1371 #tØ
make
 
su»
 
the
 
ş›Á
 
has
 
a
 
chªû
 
to
 
»ad
 
our
 
’tœe


1372 #»¥Ú£. 
Skpšg
 
the
 
	`şo£
(è
ÿÎs
 
h”e
 
d–ays
h
FIN


1373 #·ck‘ 
uÁ
 
the
 
sock‘
 
objeù
 
is
 
g¬bage
-
cŞËùed
 
Ï‹r
.

1374 #Someday, 
³rh­s
, 
we
'll dohe full†ingering_closehat

1375 #A·ch
dÛs
, 
but
 
nÙ
 
today
.

1376 
·ss


1379 
şass
 
	$TrueyZ”o
(
objeù
):

1381 
def
 
	$__add__
(
£lf
, 
Ùh”
):

1382  
Ùh”


1383 
def
 
	$__¿dd__
(
£lf
, 
Ùh”
):

1384  
Ùh”


1385 
Œueyz”o
 = 
	$TrueyZ”o
()

1388 
_SHUTDOWNREQUEST
 = 
NÚe


1390 
şass
 
	$WÜk”Th»ad
(
th»adšg
.
Th»ad
):

1393 
Due
 
to
 
the
 
timšg
 
issues
 
of
 
pŞlšg
 
a
 
Queue
,‡ 
WÜk”Th»ad
 
dÛs
 
nÙ


1394 
check
 
™s
 
own
 '»ady' 
æag
 
aá”
 
™
 
has
 
¡¬‹d
. 
To
 
¡İ
 
the
 
th»ad
,

1395 
™
 
is
 
Ãûs§ry
 
to
 
¡ick
 
a
 
_SHUTDOWNREQUEST
 
objeù
 
Úto
 
the
 
Queue


1396 (
Úe
 
—ch
 
ruÂšg
 
WÜk”Th»ad
).

1399 
cÚn
 = 
NÚe


1402 
£rv”
 = 
NÚe


1404 
Queue
 
ªd
 
is
 
¶acšg
 
aùive
 
cÚÃùiÚs
 
što
 
™
."""

1406 
»ady
 = 
F®£


1408 
has
 
begun
 
pŞlšg
 
the
 
Queue
."""

1411 
def
 
	$__š™__
(
£lf
, 
£rv”
):

1412 
£lf
.
»ady
 = 
F®£


1413 
£lf
.
£rv”
 = server

1415 
£lf
.
»que¡s_£’
 = 0

1416 
£lf
.
by‹s_»ad
 = 0

1417 
£lf
.
by‹s_wr™‹n
 = 0

1418 
£lf
.
¡¬t_time
 = 
NÚe


1419 
£lf
.
wÜk_time
 = 0

1420 
£lf
.
¡©s
 = {

1421 'Reque¡s': 
Ïmbda
 
s
: 
£lf
.
»que¡s_£’
 + ((£lf.
¡¬t_time
 
is
 
NÚe
è
ªd
 
Œueyz”o
 
Ü
 s–f.
cÚn
.requests_seen),

1422 'By‹ R—d': 
Ïmbda
 
s
: 
£lf
.
by‹s_»ad
 + ((£lf.
¡¬t_time
 
is
 
NÚe
è
ªd
 
Œueyz”o
 
Ü
 s–f.
cÚn
.
rfe
.bytes_read),

1423 'By‹ Wr™‹n': 
Ïmbda
 
s
: 
£lf
.
by‹s_wr™‹n
 + ((£lf.
¡¬t_time
 
is
 
NÚe
è
ªd
 
Œueyz”o
 
Ü
 s–f.
cÚn
.
wfe
.bytes_written),

1424 'WÜk Time': 
Ïmbda
 
s
: 
£lf
.
wÜk_time
 + ((£lf.
¡¬t_time
 
is
 
NÚe
è
ªd
 
Œueyz”o
 
Ü
 
time
.
	`time
() - self.start_time),

1425 'R—d Throughput': 
Ïmbda
 
s
: s['By‹ R—d'](sè/ (s['WÜk Time'](sè
Ü
 1e-6),

1426 'Wr™Throughput': 
Ïmbda
 
s
: s['By‹ Wr™‹n'](sè/ (s['WÜk Time'](sè
Ü
 1e-6),

1427 
	}
}

1428 
th»adšg
.
Th»ad
.
	$__š™__
(
£lf
)

1430 
def
 
	$run
(
£lf
):

1431 
£lf
.
£rv”
.
¡©s
['WÜk” Th»ads'][£lf.
	`g‘Name
()] = self.stats

1432 
Œy
:

1433 
£lf
.
»ady
 = 
True


1434 
True
:

1435 
cÚn
 = 
£lf
.
£rv”
.
»que¡s
.
	$g‘
()

1436 
cÚn
 
is
 
_SHUTDOWNREQUEST
:

1439 
£lf
.
cÚn
 = conn

1440 
£lf
.
£rv”
.
¡©s
['Enabled']:

1441 
£lf
.
¡¬t_time
 = 
time
.
	$time
()

1442 
Œy
:

1443 
cÚn
.
	$communiÿ‹
()

1444 
fš®ly
:

1445 
cÚn
.
	$şo£
()

1446 
£lf
.
£rv”
.
¡©s
['Enabled']:

1447 
£lf
.
»que¡s_£’
 +ğ£lf.
cÚn
.requests_seen

1448 
£lf
.
by‹s_»ad
 +ğ£lf.
cÚn
.
rfe
.bytes_read

1449 
£lf
.
by‹s_wr™‹n
 +ğ£lf.
cÚn
.
wfe
.bytes_written

1450 
£lf
.
wÜk_time
 +ğ
time
.
	`time
(è- s–f.
¡¬t_time


1451 
£lf
.
¡¬t_time
 = 
NÚe


1452 
£lf
.
cÚn
 = 
NÚe


1453 
	$exû±
 (
KeybßrdIÁ”ru±
, 
Sy¡emEx™
):

1454 
exc
 = 
sys
.
	`exc_šfo
()[1]

1455 
£lf
.
£rv”
.
š‹¼u±
 = 
exc


1458 
şass
 
	$Th»adPoŞ
(
objeù
):

1461 
Th»adPoŞ
 
objeùs
 
mu¡
 
´ovide
 
mš
, 
	`g‘
(), 
	`put
(
obj
), 
	$¡¬t
()

1462 
ªd
 
	$¡İ
(
timeout
è
©Œibu‹s
.

1465 
def
 
	`__š™__
(
£lf
, 
£rv”
, 
mš
=10, 
max
=-1):

1466 
£lf
.
£rv”
 = server

1467 
£lf
.
mš
 = min

1468 
£lf
.
max
 = max

1469 
£lf
.
_th»ads
 = []

1470 
£lf
.
_queue
 = 
queue
.
	$Queue
()

1471 
£lf
.
g‘
 = s–f.
_queue
.get

1473 
def
 
	$¡¬t
(
£lf
):

1475 
i
 
š
 
	$¿nge
(
£lf
.
mš
):

1476 
£lf
.
_th»ads
.
	`­³nd
(
	$WÜk”Th»ad
(
£lf
.
£rv”
))

1477 
wÜk”
 
š
 
£lf
.
_th»ads
:

1478 
wÜk”
.
	`£tName
("CP S”v” " + wÜk”.
	$g‘Name
())

1479 
wÜk”
.
	$¡¬t
()

1480 
wÜk”
 
š
 
£lf
.
_th»ads
:

1481 
nÙ
 
wÜk”
.
»ady
:

1482 
time
.
	$¦“p
(.1)

1484 
def
 
	$_g‘_idË
(
£lf
):

1486  
	$Ën
([
t
 ˆ
š
 
£lf
.
_th»ads
 t.
cÚn
 
is
 
NÚe
])

1487 
idË
 = 
	$´İ”ty
(
_g‘_idË
, 
doc
=_g‘_idË.
__doc__
)

1489 
def
 
	$put
(
£lf
, 
obj
):

1490 
£lf
.
_queue
.
	$put
(
obj
)

1491 
obj
 
is
 
_SHUTDOWNREQUEST
:

1494 
def
 
	$grow
(
£lf
, 
amouÁ
):

1496 
£lf
.
max
 > 0:

1497 
budg‘
 = 
	`max
(
£lf
.
max
 - 
	`Ën
(£lf.
_th»ads
), 0)

1499 #£lf.
max
 <ğ0 
šdiÿ‹s
 
no
 
maximum


1500 
budg‘
 = ('inf')

1502 
n_Ãw
 = 
	$mš
(
amouÁ
, 
budg‘
)

1504 
wÜk”s
 = [
£lf
.
	$_¥awn_wÜk”
(è
i
 
š
 
	`¿nge
(
n_Ãw
)]

1505 
nÙ
 
£lf
.
	`_®l
(
İ”©Ü
.
	`©Œg‘‹r
('»ady'), 
wÜk”s
):

1506 
time
.
	$¦“p
(.1)

1507 
£lf
.
_th»ads
.
	$ex‹nd
(
wÜk”s
)

1509 
def
 
	$_¥awn_wÜk”
(
£lf
):

1510 
wÜk”
 = 
	$WÜk”Th»ad
(
£lf
.
£rv”
)

1511 
wÜk”
.
	`£tName
("CP S”v” " + wÜk”.
	$g‘Name
())

1512 
wÜk”
.
	$¡¬t
()

1513  
wÜk”


1515 
def
 
	$_®l
(
func
, 
™ems
):

1516 
»suÉs
 = [
	$func
(
™em
è™em 
š
 
™ems
]

1517  
	$»duû
(
İ”©Ü
.
ªd_
, 
»suÉs
, 
True
)

1518 
_®l
 = 
	$¡©icm‘hod
(
_®l
)

1520 
def
 
	$shršk
(
£lf
, 
amouÁ
):

1522 #Grow/
shršk
 
the
 
poŞ
 
Ãûs§ry
.

1523 #Remov
ªy
 
d—d
 
th»ads
 
äom
 
our
 
li¡


1524 
t
 
š
 
£lf
.
_th»ads
:

1525 
nÙ
 
t
.
	$isAlive
():

1526 
£lf
.
_th»ads
.
	$»move
(
t
)

1527 
amouÁ
 -= 1

1529 #ÿlcuÏ‹ 
the
 
numb”
 
of
 
th»ads
 
above
h
mšimum


1530 
n_exŒa
 = 
	`max
(
	`Ën
(
£lf
.
_th»ads
è- s–f.
mš
, 0)

1533 
n_to_»move
 = 
	$mš
(
amouÁ
, 
n_exŒa
)

1535 #puˆ
shutdown
 
»que¡s
 
Ú
 
the
 
queue
 
equ®
 
to
h
numb”
 
of
 
th»ads


1536 #tØ
»move
. 
As
 
—ch
 
»que¡
 
is
 
´oûs£d
 
by
 
a
 
wÜk”
, 
th©
 worker

1537 #wÈ
‹rmš©e
 
ªd
 
be
 
cuÎed
 
äom
 
the
 
li¡
.

1538 
n
 
š
 
	$¿nge
(
n_to_»move
):

1539 
£lf
.
_queue
.
	$put
(
_SHUTDOWNREQUEST
)

1541 
def
 
	$¡İ
(
£lf
, 
timeout
=5):

1542 #Mu¡ 
shut
 
down
 
th»ads
 
h”e
 
so
 
the
 
code
 
th©
 
ÿÎs


1543 #thi 
m‘hod
 
ÿn
 
know
 
wh’
 
®l
 
th»ads
 
¬e
 
¡İ³d
.

1544 
wÜk”
 
š
 
£lf
.
_th»ads
:

1545 
£lf
.
_queue
.
	$put
(
_SHUTDOWNREQUEST
)

1548 
cu¼’t
 = 
th»adšg
.
	$cu¼’tTh»ad
()

1549 
timeout
 
ªd
imeout >= 0:

1550 
’dtime
 = 
time
.
	`time
(è+ 
timeout


1551 
£lf
.
_th»ads
:

1552 
wÜk”
 = 
£lf
.
_th»ads
.
	$pİ
()

1553 
wÜk”
 
is
 
nÙ
 
cu¼’t
 
ªd
 wÜk”.
	$isAlive
():

1554 
Œy
:

1555 
timeout
 
is
 
NÚe
 
Ü
imeout < 0:

1556 
wÜk”
.
	$još
()

1558 
»maššg_time
 = 
’dtime
 - 
time
.
	$time
()

1559 
»maššg_time
 > 0:

1560 
wÜk”
.
	$još
(
»maššg_time
)

1561 
wÜk”
.
	$isAlive
():

1562 #W
exhau¡ed
 
the
 
timeout
.

1563 #FÜcibly 
shut
 
down
 
the
 
sock‘
.

1564 
c
 = 
wÜk”
.
cÚn


1565 
c
 
ªd
 
nÙ
 c.
rfe
.
şo£d
:

1566 
Œy
:

1567 
c
.
sock‘
.
	$shutdown
(
sock‘
.
SHUT_RD
)

1568 
exû±
 
Ty³E¼Ü
:

1569 #pyO³nSSL 
sock‘s
 
dÚ
'take‡n‡rg

1570 
c
.
sock‘
.
	$shutdown
()

1571 
wÜk”
.
	$još
()

1572 
	`exû±
 (
As£¹iÚE¼Ü
,

1573 #IgnÜ
»³©ed
 
CŒl
-
C
.

1574 #S“ 
h‰p
:

1575 
KeybßrdIÁ”ru±
):

1576 
·ss


1578 
def
 
	$_g‘_qsize
(
£lf
):

1579  
£lf
.
_queue
.
	$qsize
()

1580 
qsize
 = 
	$´İ”ty
(
_g‘_qsize
)

1584 
Œy
:

1585 
impÜt
 
fú


1586 
exû±
 
ImpÜtE¼Ü
:

1587 
Œy
:

1588 
äom
 
ùy³s
 
impÜt
 
wšdÎ
, 
WšE¼Ü


1589 
exû±
 
ImpÜtE¼Ü
:

1590 
def
 
	$´ev’t_sock‘_šh”™ªû
(
sock
):

1592 
·ss


1594 
def
 
	$´ev’t_sock‘_šh”™ªû
(
sock
):

1596 
nÙ
 
wšdÎ
.
k”Ãl32
.
	`S‘HªdËInfÜm©iÚ
(
sock
.
	`f’o
(), 1, 0):

1597 
¿i£
 
	$WšE¼Ü
()

1599 
def
 
	$´ev’t_sock‘_šh”™ªû
(
sock
):

1601 
fd
 = 
sock
.
	$f’o
()

1602 
Şd_æags
 = 
fú
.
	$fú
(
fd
, 
fú
.
F_GETFD
)

1603 
fú
.
	`fú
(
fd
, fú.
F_SETFD
, 
Şd_æags
 | fú.
FD_CLOEXEC
)

1606 
şass
 
	$SSLAd­‹r
(
objeù
):

1609 
Requœed
 
m‘hods
:

1611 * ``
	`w¿p
(
sock
è-> (
w¿µed
 
sock‘
, 
s¦
 
’vœÚ
 
diù
)``

1612 * ``
	`makefe
(
sock
, 
mode
='r', 
bufsize
=
DEFAULT_BUFFER_SIZE
è-> 
sock‘
 
fe
 
objeù
``

1615 
def
 
	$__š™__
(
£lf
, 
û¹ifiÿ‹
, 
´iv©e_key
, 
û¹ifiÿ‹_chaš
=
NÚe
):

1616 
£lf
.
û¹ifiÿ‹
 = certificate

1617 
£lf
.
´iv©e_key
 =…rivate_key

1618 
£lf
.
û¹ifiÿ‹_chaš
 = certificate_chain

1620 
def
 
	$w¿p
(
£lf
, 
sock
):

1621 
¿i£
 
NÙIm¶em’‹d


1623 
def
 
	`makefe
(
£lf
, 
sock
, 
mode
='r', 
bufsize
=
DEFAULT_BUFFER_SIZE
):

1624 
¿i£
 
NÙIm¶em’‹d


1627 
şass
 
	$HTTPS”v”
(
objeù
):

1630 
_bšd_addr
 = "127.0.0.1"

1631 
_š‹¼u±
 = 
NÚe


1633 
g©eway
 = 
NÚe


1636 
mšth»ads
 = 
NÚe


1639 
maxth»ads
 = 
NÚe


1642 
£rv”_Çme
 = 
NÚe


1645 
´ÙocŞ
 = "HTTP/1.1"

1648 
FÜ
 
exam¶e
, "HTTP/1.1" 
is
 
the
 . 
This
 
®so
 
lim™s
h
suµÜ‹d


1649 
ã©u»s
 
u£d
 
š
 
the
 
»¥Ú£
."""

1651 
»que¡_queue_size
 = 5

1654 
shutdown_timeout
 = 5

1657 
timeout
 = 10

1660 
v”siÚ
 = "CherryPy/3.2.4"

1663 
soáw¬e
 = 
NÚe


1666 
If
 
NÚe
, 
this
 
deçuÉs
 
to
 ``'% S”v”' % 
£lf
.
v”siÚ
``."""

1668 
»ady
 = 
F®£


1671 
max_»que¡_h—d”_size
 = 0

1674 
max_»que¡_body_size
 = 0

1677 
nod–ay
 = 
True


1680 
CÚÃùiÚCÏss
 = 
HTTPCÚÃùiÚ


1683 
s¦_ad­‹r
 = 
NÚe


1686 
You
 
mu¡
 
have
 
the
 
cÜ»¥Údšg
 
SSL
 
driv”
 
lib¿ry
 
š¡®Ëd
."""

1688 
def
 
	`__š™__
(
£lf
, 
bšd_addr
, 
g©eway
, 
mšth»ads
=10, 
maxth»ads
=-1,

1689 
£rv”_Çme
=
NÚe
):

1690 
£lf
.
bšd_addr
 = bind_addr

1691 
£lf
.
g©eway
 = gateway

1693 
£lf
.
»que¡s
 = 
	$Th»adPoŞ
(
£lf
, 
mš
=
mšth»ads
 
Ü
 1, 
max
=
maxth»ads
)

1695 
nÙ
 
£rv”_Çme
:

1696 
£rv”_Çme
 = 
sock‘
.
	$g‘ho¡Çme
()

1697 
£lf
.
£rv”_Çme
 = server_name

1698 
£lf
.
	$ş—r_¡©s
()

1700 
def
 
	$ş—r_¡©s
(
£lf
):

1701 
£lf
.
_¡¬t_time
 = 
NÚe


1702 
£lf
.
_run_time
 = 0

1703 
£lf
.
¡©s
 = {

1704 'EÇbËd': 
F®£
,

1705 'Bšd Add»ss': 
Ïmbda
 
s
: 
	`»´
(
£lf
.
bšd_addr
),

1706 'RuÀtime': 
Ïmbda
 
s
: (
nÙ
 s['EÇbËd']è
ªd
 -1 
Ü
 
£lf
.
	`ruÁime
(),

1708 'Acû±s/£c': 
Ïmbda
 
s
: s['Acû±s'] / 
£lf
.
	`ruÁime
(),

1709 'Queue': 
Ïmbda
 
s
: 
	`g‘©Œ
(
£lf
.
»que¡s
, "qsize", 
NÚe
),

1710 'Th»ads': 
Ïmbda
 
s
: 
	`Ën
(
	`g‘©Œ
(
£lf
.
»que¡s
, "_threads", [])),

1711 'Th»ad IdË': 
Ïmbda
 
s
: 
	`g‘©Œ
(
£lf
.
»que¡s
, "idË", 
NÚe
),

1713 'Reque¡s': 
Ïmbda
 
s
: (
nÙ
 s['EÇbËd']è
ªd
 -1 
Ü
 
	`sum
([
w
['Requests'](w) w

1714 
š
 
s
['WÜk” Th»ads'].
	`v®ues
()], 0),

1715 'By‹ R—d': 
Ïmbda
 
s
: (
nÙ
 s['EÇbËd']è
ªd
 -1 
Ü
 
	`sum
([
w
['Bytes Read'](w) w

1716 
š
 
s
['WÜk” Th»ads'].
	`v®ues
()], 0),

1717 'By‹ Wr™‹n': 
Ïmbda
 
s
: (
nÙ
 s['EÇbËd']è
ªd
 -1 
Ü
 
	`sum
([
w
['Bytes Written'](w) w

1718 
š
 
s
['WÜk” Th»ads'].
	`v®ues
()], 0),

1719 'WÜk Time': 
Ïmbda
 
s
: (
nÙ
 s['EÇbËd']è
ªd
 -1 
Ü
 
	`sum
([
w
['Work Time'](w) w

1720 
š
 
s
['WÜk” Th»ads'].
	`v®ues
()], 0),

1721 'R—d Throughput': 
Ïmbda
 
s
: (
nÙ
 s['EÇbËd']è
ªd
 -1 
Ü
 
	`sum
(

1722 [
w
['By‹ R—d'](wè/ (w['WÜk Time'](wè
Ü
 1e-6)

1723 
w
 
š
 
s
['WÜk” Th»ads'].
	`v®ues
()], 0),

1724 'Wr™Throughput': 
Ïmbda
 
s
: (
nÙ
 s['EÇbËd']è
ªd
 -1 
Ü
 
	`sum
(

1725 [
w
['By‹ Wr™‹n'](wè/ (w['WÜk Time'](wè
Ü
 1e-6)

1726 
w
 
š
 
s
['WÜk” Th»ads'].
	`v®ues
()], 0),

1728 
	}
}

1729 
loggšg
.
¡©i¡ics
["Ch”ryPy HTTPS”v” %d" % 
id
(
£lf
)] = s–f.
¡©s


1731 
def
 
	$ruÁime
(
£lf
):

1732 
£lf
.
_¡¬t_time
 
is
 
NÚe
:

1733  
£lf
.
_run_time


1735  
£lf
.
_run_time
 + (
time
.
	`time
(è- s–f.
_¡¬t_time
)

1737 
def
 
	$__¡r__
(
£lf
):

1738  "%s.%s(%r)" % (
£lf
.
__moduË__
, s–f.
__şass__
.
__Çme__
,

1739 
£lf
.
bšd_addr
)

1741 
def
 
	$_g‘_bšd_addr
(
£lf
):

1742  
£lf
.
_bšd_addr


1743 
def
 
	$_£t_bšd_addr
(
£lf
, 
v®ue
):

1744 
	$isš¡ªû
(
v®ue
, 
tu¶e
è
ªd
 v®ue[0] 
	`š
 ('', 
NÚe
):

1745 #De¥™
the
 
sock‘
 
moduË
 
docs
, 
usšg
 '' 
dÛs
 
nÙ


1746 #®low 
AI_PASSIVE
 
to
 
wÜk
. 
Passšg
 
NÚe
 
š¡—d


1747 #»tuº '0.0.0.0' 
like
 
we
 
wªt
. 
In
 
Ùh”
 
wÜds
:

1748 #ho¡ 
AI_PASSIVE
 
»suÉ


1751 #NÚ
Y
 0.0.0.0

1752 #NÚ
N
 127.0.0.1

1753 #Buˆ
sšû
 
you
 
ÿn
 
g‘
 
the
 
§me
 
efãù
 
w™h
 
ª
 
ex¶ic™


1755 
¿i£
 
	`V®ueE¼Ü
("Host values of '' or None‡re‚ot‡llowed. "

1758 
£lf
.
_bšd_addr
 = 
v®ue


1759 
bšd_addr
 = 
	`´İ”ty
(
_g‘_bšd_addr
, 
_£t_bšd_addr
,

1760 
doc
="""The interface on whicho†isten for connections.

1762 
FÜ
 
TCP
 
sock‘s
, 
	$a
 (
ho¡
, 
pÜt
è
tu¶e
. 
Ho¡
 
v®ues
 
may
 
be
 
ªy
 
IPv4


1763 
Ü
 
IPv6
 
add»ss
, o¸
ªy
 
v®id
 
ho¡Çme
. 
The
 
¡ršg
 'loÿlho¡' 
is
 
a


1764 
synÚym
 '127.0.0.1' (
Ü
 '::1', 
your
 
ho¡s
 
fe
 
´eãrs
 
IPv6
).

1765 
The
 
¡ršg
 '0.0.0.0' 
is
 
a
 
¥ecŸl
 
IPv4
 
’Œy
 
m—nšg
 "any‡ctive

1766 
š‹rçû
" (INADDR_ANY),‡nd '::' ishe similar IN6ADDR_ANY for

1767 
IPv6
. 
The
 
em±y
 
¡ršg
 
Ü
 
NÚe
 
¬e
 
nÙ
 
®lowed
.

1769 
FÜ
 
UNIX
 
sock‘s
, 
suµly
 
the
 
f’ame
 
as
 
a
 
¡ršg
.""")

1771 
def
 
	$¡¬t
(
£lf
):

1773 #W
dÚ
't haveorap KeyboardInterrupt or SystemExit here,

1774 #beÿu£ 
ch”½y
.
£rv”
 
®»ady
 
dÛs
 
so
, 
ÿÎšg
 
£lf
.
	`¡İ
(è
us
.

1775 #Ià
you
're usinghis server with‡nother framework, you should

1776 #Œ­ 
tho£
 
exû±iÚs
 
š
 
wh©ev”
 
code
 
block
 
ÿÎs
 
	`¡¬t
().

1777 
£lf
.
_š‹¼u±
 = 
NÚe


1779 
£lf
.
soáw¬e
 
is
 
NÚe
:

1780 
£lf
.
soáw¬e
 = "% S”v”" % s–f.
v”siÚ


1782 #SSL 
backw¬d
 
com·tib™y


1783 ià(
£lf
.
s¦_ad­‹r
 
is
 
NÚe
 
ªd


1784 
	`g‘©Œ
(
£lf
, 's¦_û¹ifiÿ‹', 
NÚe
è
ªd


1785 
	`g‘©Œ
(
£lf
, 's¦_´iv©e_key', 
NÚe
)):

1786 
w¬nšgs
.
	`w¬n
(

1790 
D•»ÿtiÚW¬nšg


1792 
Œy
:

1793 
äom
 
ch”rypy
.
wsgi£rv”
.
s¦_pyİ’s¦
 
impÜt
 
pyO³nSSLAd­‹r


1794 
exû±
 
ImpÜtE¼Ü
:

1795 
·ss


1797 
£lf
.
s¦_ad­‹r
 = 
	`pyO³nSSLAd­‹r
(

1798 
£lf
.
s¦_û¹ifiÿ‹
, s–f.
s¦_´iv©e_key
,

1799 
	`g‘©Œ
(
£lf
, 's¦_û¹ifiÿ‹_chaš', 
NÚe
))

1801 #S–eù 
the
 
­´İrŸ‹
 
sock‘


1802 
	$isš¡ªû
(
£lf
.
bšd_addr
, 
ba£¡ršg
):

1803 #AF_UNIX 
sock‘


1805 #SØ
we
 
ÿn
 
»u£
 
the
 
sock‘
...

1806 
Œy
: 
os
.
	$uÆšk
(
£lf
.
bšd_addr
)

1807 
exû±
: 
·ss


1809 #SØ
ev”yÚe
 
ÿn
 
acûss
 
the
 
sock‘
...

1810 
Œy
: 
os
.
	$chmod
(
£lf
.
bšd_addr
, 511) #0777

1811 
exû±
: 
·ss


1813 
šfo
 = [(
sock‘
.
AF_UNIX
, sock‘.
SOCK_STREAM
, 0, "", 
£lf
.
bšd_addr
)]

1815 #AF_INET 
Ü
 
AF_INET6
 
sock‘


1816 #G‘ 
the
 
cÜ»ù
 
add»ss
 
çmy
 
our
 
	`ho¡
 (
®lows
 
IPv6
 
add»s£s
)

1817 
ho¡
, 
pÜt
 = 
£lf
.
bšd_addr


1818 
Œy
:

1819 
šfo
 = 
sock‘
.
	$g‘addršfo
(
ho¡
, 
pÜt
, 
sock‘
.
AF_UNSPEC
,

1820 
sock‘
.
SOCK_STREAM
, 0, sock‘.
AI_PASSIVE
)

1821 
exû±
 
sock‘
.
ga›¼Ü
:

1822 ':' 
š
 
£lf
.
bšd_addr
[0]:

1823 
šfo
 = [(
sock‘
.
AF_INET6
, sock‘.
SOCK_STREAM
,

1824 0, "", 
£lf
.
bšd_addr
 + (0, 0))]

1826 
šfo
 = [(
sock‘
.
AF_INET
, sock‘.
SOCK_STREAM
,

1827 0, "", 
£lf
.
bšd_addr
)]

1829 
£lf
.
sock‘
 = 
NÚe


1830 
msg
 = "No socket could be created"

1831 
»s
 
š
 
šfo
:

1832 
af
, 
sockty³
, 
´Ùo
, 
ÿnÚÇme
, 
§
 = 
»s


1833 
Œy
:

1834 
£lf
.
	$bšd
(
af
, 
sockty³
, 
´Ùo
)

1835 
exû±
 
sock‘
.
”rÜ
:

1836 
£lf
.
sock‘
:

1837 
£lf
.
sock‘
.
	$şo£
()

1838 
£lf
.
sock‘
 = 
NÚe


1841 
nÙ
 
£lf
.
sock‘
:

1842 
¿i£
 
sock‘
.
	$”rÜ
(
msg
)

1844 #Timeouˆ
so
 
KeybßrdIÁ”ru±
 
ÿn
 
be
 
ÿught
 
Ú
 
Wš32


1845 
£lf
.
sock‘
.
	$£‰imeout
(1)

1846 
£lf
.
sock‘
.
	$li¡’
(
£lf
.
»que¡_queue_size
)

1848 #C»©
wÜk”
 
th»ads


1849 
£lf
.
»que¡s
.
	$¡¬t
()

1851 
£lf
.
»ady
 = 
True


1852 
£lf
.
_¡¬t_time
 = 
time
.
	$time
()

1853 
£lf
.
»ady
:

1854 
Œy
:

1855 
£lf
.
	$tick
()

1856 
	$exû±
 (
KeybßrdIÁ”ru±
, 
Sy¡emEx™
):

1857 
¿i£


1858 
exû±
:

1859 
£lf
.
	`”rÜ_log
("E¼Ü iÀHTTPS”v”.tick", 
Ëv–
=
loggšg
.
ERROR
,

1860 
Œaûback
=
True
)

1862 
£lf
.
š‹¼u±
:

1863 
£lf
.
š‹¼u±
 
is
 
True
:

1864 #Wa™ 
£lf
.
	`¡İ
(è
to
 
com¶‘e
. 
S“
 
_£t_š‹¼u±
.

1865 
time
.
	$¦“p
(0.1)

1866 
£lf
.
š‹¼u±
:

1867 
¿i£
 
£lf
.
š‹¼u±


1869 
def
 
	`”rÜ_log
(
£lf
, 
msg
="", 
Ëv–
=20, 
Œaûback
=
F®£
):

1870 #Ov”rid
this
 
š
 
subşas£s
 
as
 
desœed


1871 
sys
.
¡d”r
.
	`wr™e
(
msg
 + '\n')

1872 
sys
.
¡d”r
.
	$æush
()

1873 
Œaûback
:

1874 
tblšes
 = 
	$fÜm©_exc
()

1875 
sys
.
¡d”r
.
	$wr™e
(
tblšes
)

1876 
sys
.
¡d”r
.
	$æush
()

1878 
def
 
	$bšd
(
£lf
, 
çmy
, 
ty³
, 
´Ùo
=0):

1880 
£lf
.
sock‘
 = sock‘.
	$sock‘
(
çmy
, 
ty³
, 
´Ùo
)

1881 
	$´ev’t_sock‘_šh”™ªû
(
£lf
.
sock‘
)

1882 
£lf
.
sock‘
.
	$£tsockİt
(
sock‘
.
SOL_SOCKET
, sock‘.
SO_REUSEADDR
, 1)

1883 
£lf
.
nod–ay
 
ªd
 
nÙ
 
	$isš¡ªû
(
£lf
.
bšd_addr
, 
¡r
):

1884 
£lf
.
sock‘
.
	$£tsockİt
(
sock‘
.
IPPROTO_TCP
, sock‘.
TCP_NODELAY
, 1)

1886 
£lf
.
s¦_ad­‹r
 
is
 
nÙ
 
NÚe
:

1887 
£lf
.
sock‘
 = s–f.
s¦_ad­‹r
.
	$bšd
(
£lf
.
sock‘
)

1889 #Ià
li¡’šg
 
Ú
 
the
 
IPV6
 
ªy
 
	`add»ss
 ('::' = 
IN6ADDR_ANY
),

1890 #aùiv©
du®
-
¡ack
. 
S“
 
h‰p
:

1891 ià(
	`ha§‰r
(
sock‘
, 'AF_INET6'è
ªd
 
çmy
 =ğsock‘.
AF_INET6


1892 
ªd
 
£lf
.
bšd_addr
[0] 
	`š
 ('::', '::0', '::0.0.0.0')):

1893 
Œy
:

1894 
£lf
.
sock‘
.
	$£tsockİt
(
sock‘
.
IPPROTO_IPV6
, sock‘.
IPV6_V6ONLY
, 0)

1895 
	$exû±
 (
A‰ribu‹E¼Ü
, 
sock‘
.
”rÜ
):

1896 #Aµ¬’y, 
the
 
sock‘
 
İtiÚ
 
is
 
nÙ
 
avaabË
 
š


1897 #thi 
machše
's TCP stack

1898 
·ss


1900 
£lf
.
sock‘
.
	$bšd
(
£lf
.
bšd_addr
)

1902 
def
 
	$tick
(
£lf
):

1904 
Œy
:

1905 
s
, 
addr
 = 
£lf
.
sock‘
.
	$acû±
()

1906 
£lf
.
¡©s
['Enabled']:

1907 
£lf
.
¡©s
['Accepts'] += 1

1908 
nÙ
 
£lf
.
»ady
:

1911 
	$´ev’t_sock‘_šh”™ªû
(
s
)

1912 
	`ha§‰r
(
s
, 'settimeout'):

1913 
s
.
	$£‰imeout
(
£lf
.
timeout
)

1915 
makefe
 = 
CP_feobjeù


1916 
s¦_’v
 = {
	}
}

1917 #ià
s¦
 
û¹
 
ªd
 
key
 
¬e
 
£t
, 
we
 
Œy
 
to
 
be
 
a
 
£cu»
 
HTTP
 
£rv”


1918 
	g£lf
.
s¦_ad­‹r
 
is
 
nÙ
 
	gNÚe
:

1919 
Œy
:

1920 
s
, 
	gs¦_’v
 = 
£lf
.
s¦_ad­‹r
.
	$w¿p
(
s
)

1921 
exû±
 
NoSSLE¼Ü
:

1922 
msg
 = ("The client sent‡…lain HTTP„equest, but "

1924 
buf
 = ["% 400 Bad Reque¡\r\n" % 
£lf
.
´ÙocŞ
,

1925 "CÚ‹Á-L’gth: %s\r\n" % 
	`Ën
(
msg
),

1927 
msg
]

1929 
wfe
 = 
	`makefe
(
s
, "wb", 
DEFAULT_BUFFER_SIZE
)

1930 
Œy
:

1931 
wfe
.
	`£nd®l
("".
	$još
(
buf
))

1932 
exû±
 
sock‘
.
”rÜ
:

1933 
x
 = 
sys
.
	`exc_šfo
()[1]

1934 
x
.
¬gs
[0] 
nÙ
 
š
 
sock‘_”rÜs_to_ignÜe
:

1935 
¿i£


1937 
nÙ
 
s
:

1939 
makefe
 = 
£lf
.
s¦_ad­‹r
.makefile

1940 #Re-
­¶y
 
our
 
timeout
 
sšû
 
we
 
may
 
have
 
a
 
Ãw
 
sock‘
 
objeù


1941 
	`ha§‰r
(
s
, 'settimeout'):

1942 
s
.
	$£‰imeout
(
£lf
.
timeout
)

1944 
cÚn
 = 
£lf
.
	$CÚÃùiÚCÏss
(
£lf
, 
s
, 
makefe
)

1946 
nÙ
 
	$isš¡ªû
(
£lf
.
bšd_addr
, 
ba£¡ršg
):

1947 #İtiÚ® 
v®ues


1948 #UÁ 
we
 dØ
DNS
 
lookups
, 
om™
 
REMOTE_HOST


1949 
addr
 
is
 
NÚe
: #som‘ime 
this
 
ÿn
 
h­³n


1950 #figu» 
out
 
AF_INET
 
Ü
 
AF_INET6
.

1951 
	`Ën
(
s
.
	`g‘sockÇme
()) == 2:

1953 
addr
 = ('0.0.0.0', 0)

1956 
addr
 = ('::', 0)

1957 
cÚn
.
»mÙe_addr
 = 
addr
[0]

1958 
cÚn
.
»mÙe_pÜt
 = 
addr
[1]

1960 
cÚn
.
s¦_’v
 = ssl_env

1962 
£lf
.
»que¡s
.
	$put
(
cÚn
)

1963 
exû±
 
sock‘
.
timeout
:

1964 #Th
Úly
 
»asÚ
 
the
 
timeout
 
š
 
	`¡¬t
(è
is
 
so
 
we
 
ÿn


1965 #nÙiû 
keybßrd
 
š‹¼u±s
 
Ú
 
Wš32
, 
which
 
dÚ
't interrupt

1966 #acû±(è
by
 

1968 
exû±
 
sock‘
.
”rÜ
:

1969 
x
 = 
sys
.
	`exc_šfo
()[1]

1970 
£lf
.
¡©s
['Enabled']:

1971 
£lf
.
¡©s
['Socket Errors'] += 1

1972 
x
.
¬gs
[0] 
š
 
sock‘_”rÜ_ešŒ
:

1973 #I *
thšk
* 
this
 
is
 
right
. 
EINTR
 
should
 
occur
 
wh’
 
a
 
sigÇl


1974 #i 
»ûived
 
duršg
 
the
 
	`acû±
(è
ÿÎ
; 
®l
 
docs
 
§y
 
»Œy


1975 #th
ÿÎ
, 
ªd
 
I
 *
thšk
* I'm„eading it„ighthat Python

1976 #wÈ
th’
 
go
 
ah—d
 
ªd
 
pŞl
 ªd 
hªdË
 
the
 
sigÇl


1977 #–£wh”e. 
S“
 
h‰p
:

1979 
x
.
¬gs
[0] 
š
 
sock‘_”rÜs_nÚblockšg
:

1980 #Ju¡ 
Œy
 
agaš
. 
S“
 
h‰p
:

1982 
x
.
¬gs
[0] 
š
 
sock‘_”rÜs_to_ignÜe
:

1983 #Ou¸
sock‘
 
was
 
şo£d
.

1984 #S“ 
h‰p
:

1986 
¿i£


1988 
def
 
	$_g‘_š‹¼u±
(
£lf
):

1989  
£lf
.
_š‹¼u±


1990 
def
 
	$_£t_š‹¼u±
(
£lf
, 
š‹¼u±
):

1991 
£lf
.
_š‹¼u±
 = 
True


1992 
£lf
.
	$¡İ
()

1993 
£lf
.
_š‹¼u±
 = 
š‹¼u±


1994 
š‹¼u±
 = 
	`´İ”ty
(
_g‘_š‹¼u±
, 
_£t_š‹¼u±
,

1995 
doc
="Sethiso‡n Exception instanceo "

1998 
def
 
	$¡İ
(
£lf
):

2000 
£lf
.
»ady
 = 
F®£


2001 
£lf
.
_¡¬t_time
 
is
 
nÙ
 
NÚe
:

2002 
£lf
.
_run_time
 +ğ(
time
.
	`time
(è- s–f.
_¡¬t_time
)

2003 
£lf
.
_¡¬t_time
 = 
NÚe


2005 
sock
 = 
	`g‘©Œ
(
£lf
, "sock‘", 
NÚe
)

2006 
sock
:

2007 
nÙ
 
	$isš¡ªû
(
£lf
.
bšd_addr
, 
ba£¡ršg
):

2008 #Touch 
our
 
own
 
sock‘
 
to
 
make
 
	`acû±
(è 
immedŸ‹ly
.

2009 
Œy
:

2010 
ho¡
, 
pÜt
 = 
sock
.
	`g‘sockÇme
()[:2]

2011 
exû±
 
sock‘
.
”rÜ
:

2012 
x
 = 
sys
.
	`exc_šfo
()[1]

2013 
x
.
¬gs
[0] 
nÙ
 
š
 
sock‘_”rÜs_to_ignÜe
:

2014 #Chªged 
to
 
u£
 
”rÜ
 
code
 
ªd
 
nÙ
 
mes§ge


2015 #S“ 
h‰p
:

2016 
¿i£


2018 #NÙ
th©
 
we
'reƒxplicitly NOT using AI_PASSIVE,

2019 #h”e, 
beÿu£
 
we
 
wªt
 
ª
 
aùu®
 
IP
 
to
 
touch
.

2020 #loÿlho¡ 
wÚ
'ˆwÜk iàwe'
ve
 
bound
 
to
 
a
 
public
 
IP
,

2021 #buˆ
™
 
wl
 
we
 
bound
 
to
 '0.0.0.0' (
INADDR_ANY
).

2022 
»s
 
š
 
sock‘
.
	$g‘addršfo
(
ho¡
, 
pÜt
, 
sock‘
.
AF_UNSPEC
,

2023 
sock‘
.
SOCK_STREAM
):

2024 
af
, 
sockty³
, 
´Ùo
, 
ÿnÚÇme
, 
§
 = 
»s


2025 
s
 = 
NÚe


2026 
Œy
:

2027 
s
 = 
sock‘
.
	$sock‘
(
af
, 
sockty³
, 
´Ùo
)

2028 #S“ 
h‰p
:

2029 #brow£_äm/
th»ad
/
bbã5eb39c904ã0


2030 
s
.
	$£‰imeout
(1.0)

2031 
s
.
	`cÚÃù
((
ho¡
, 
pÜt
))

2032 
s
.
	$şo£
()

2033 
exû±
 
sock‘
.
”rÜ
:

2034 
s
:

2035 
s
.
	$şo£
()

2036 
	`ha§‰r
(
sock
, "close"):

2037 
sock
.
	$şo£
()

2038 
£lf
.
sock‘
 = 
NÚe


2040 
£lf
.
»que¡s
.
	$¡İ
(
£lf
.
shutdown_timeout
)

2043 
şass
 
	$G©eway
(
objeù
):

2046 
def
 
	$__š™__
(
£lf
, 
»q
):

2047 
£lf
.
»q
 =„eq

2049 
def
 
	$»¥Úd
(
£lf
):

2051 
¿i£
 
NÙIm¶em’‹d


2054 #The£ 
may
 
e™h”
 
be
 
wsgi£rv”
.
SSLAd­‹r
 
subşas£s
 
Ü
 
the
 
¡ršg
 
Çmes


2055 #oà
such
 
	`şas£s
 (
š
 
which
 
they
 
wl
 
be
 
Ïzy
 
lßded
).

2056 
s¦_ad­‹rs
 = {

2059 
	}
}

2061 
def
 
g‘_s¦_ad­‹r_şass
(
Çme
='pyopenssl'):

2063 
ad­‹r
 = 
s¦_ad­‹rs
[
Çme
.
low”
()]

2064 
	$isš¡ªû
(
ad­‹r
, 
ba£¡ršg
):

2065 
Ï¡_dÙ
 = 
ad­‹r
.
	`rfšd
(".")

2066 
©Œ_Çme
 = 
ad­‹r
[
Ï¡_dÙ
 + 1:]

2067 
mod_·th
 = 
ad­‹r
[:
Ï¡_dÙ
]

2069 
Œy
:

2070 
mod
 = 
sys
.
moduËs
[
mod_·th
]

2071 
mod
 
is
 
NÚe
:

2072 
¿i£
 
	$KeyE¼Ü
()

2073 
exû±
 
KeyE¼Ü
:

2074 #Th
Ï¡
 [''] 
is
 
impÜÁ
.

2075 
mod
 = 
	`__impÜt__
(
mod_·th
, 
	`glob®s
(), 
	`loÿls
(), [''])

2077 #L‘ 
ª
 
A‰ribu‹E¼Ü
 
´İag©e
 
outw¬d
.

2078 
Œy
:

2079 
ad­‹r
 = 
	$g‘©Œ
(
mod
, 
©Œ_Çme
)

2080 
exû±
 
A‰ribu‹E¼Ü
:

2081 
¿i£
 
	`A‰ribu‹E¼Ü
("'%s' object has‚o‡ttribute '%s'"

2082 % (
mod_·th
, 
©Œ_Çme
))

2084  
ad­‹r


2086 #-------------------------------- 
WSGI
 
Stuff
 -------------------------------- #


2088 
şass
 
	$Ch”ryPyWSGIS”v”
(
HTTPS”v”
):

2091 
wsgi_v”siÚ
 = (1, 0)

2094 
def
 
	`__š™__
(
£lf
, 
bšd_addr
, 
wsgi_­p
, 
numth»ads
=10, 
£rv”_Çme
=
NÚe
,

2095 
max
=-1, 
»que¡_queue_size
=5, 
timeout
=10, 
shutdown_timeout
=5):

2096 
£lf
.
»que¡s
 = 
	$Th»adPoŞ
(
£lf
, 
mš
=
numth»ads
 
Ü
 1, 
max
=max)

2097 
£lf
.
wsgi_­p
 = wsgi_app

2098 
£lf
.
g©eway
 = 
wsgi_g©eways
[£lf.
wsgi_v”siÚ
]

2100 
£lf
.
bšd_addr
 = bind_addr

2101 
nÙ
 
£rv”_Çme
:

2102 
£rv”_Çme
 = 
sock‘
.
	$g‘ho¡Çme
()

2103 
£lf
.
£rv”_Çme
 = server_name

2104 
£lf
.
»que¡_queue_size
 =„equest_queue_size

2106 
£lf
.
timeout
 =imeout

2107 
£lf
.
shutdown_timeout
 = shutdown_timeout

2108 
£lf
.
	$ş—r_¡©s
()

2110 
def
 
	$_g‘_numth»ads
(
£lf
):

2111  
£lf
.
»que¡s
.
mš


2112 
def
 
	$_£t_numth»ads
(
£lf
, 
v®ue
):

2113 
£lf
.
»que¡s
.
mš
 = 
v®ue


2114 
numth»ads
 = 
	$´İ”ty
(
_g‘_numth»ads
, 
_£t_numth»ads
)

2117 
şass
 
	$WSGIG©eway
(
G©eway
):

2120 
def
 
	$__š™__
(
£lf
, 
»q
):

2121 
£lf
.
»q
 =„eq

2122 
£lf
.
¡¬‹d_»¥Ú£
 = 
F®£


2123 
£lf
.
’v
 = s–f.
	$g‘_’vœÚ
()

2124 
£lf
.
»maššg_by‹s_out
 = 
NÚe


2126 
def
 
	$g‘_’vœÚ
(
£lf
):

2128 
¿i£
 
NÙIm¶em’‹d


2130 
def
 
	$»¥Úd
(
£lf
):

2132 
»¥Ú£
 = 
£lf
.
»q
.
£rv”
.
	$wsgi_­p
(
£lf
.
’v
, s–f.
¡¬t_»¥Ú£
)

2133 
Œy
:

2134 
chunk
 
š
 
»¥Ú£
:

2135 #"
The
 
¡¬t_»¥Ú£
 
ÿÎabË
 
mu¡
 
nÙ
 
aùu®ly
 
Œªsm™


2136 #th
»¥Ú£
 
h—d”s
. 
In¡—d
, 
™
 
mu¡
 
¡Üe
 
them
 
the


2137 #£rv” 
Ü
 
g©eway
 
to
 
Œªsm™
 
Úly
 
aá”
 
the
 
fœ¡


2138 #™”©iÚ 
of
 
the
 
­¶iÿtiÚ
  
v®ue
 
th©
 
y›lds


2139 #¨
NON
-
EMPTY
 
¡ršg
, 
Ü
 
upÚ
 
the
 
­¶iÿtiÚ
's first

2140 #švoÿtiÚ 
of
 
the
 
	`wr™e
(è
ÿÎabË
." (PEP 333)

2141 
chunk
:

2142 
	$isš¡ªû
(
chunk
, 
unicode¡r
):

2143 
chunk
 = chunk.
	`’code
('ISO-8859-1')

2144 
£lf
.
	$wr™e
(
chunk
)

2145 
fš®ly
:

2146 
	`ha§‰r
(
»¥Ú£
, "close"):

2147 
»¥Ú£
.
	$şo£
()

2149 
def
 
	$¡¬t_»¥Ú£
(
£lf
, 
¡©us
, 
h—d”s
, 
exc_šfo
 = 
NÚe
):

2151 #"
The
 
­¶iÿtiÚ
 
may
 
ÿÎ
 
¡¬t_»¥Ú£
 
mÜe
 
thª
 
Úû
,

2152 #ià
ªd
 
Úly
 
the
 
exc_šfo
 
¬gum’t
 
is
 
´ovided
."

2153 
£lf
.
¡¬‹d_»¥Ú£
 
ªd
 
nÙ
 
exc_šfo
:

2154 
¿i£
 
	`As£¹iÚE¼Ü
("WSGI start_response called‡ second "

2156 
£lf
.
¡¬‹d_»¥Ú£
 = 
True


2158 #"
exc_šfo
 
is
 
´ovided
, 
ªd
 
the
 
HTTP
 
h—d”s
 
have
 
®»ady
 
b“n


2159 #£Á, 
¡¬t_»¥Ú£
 
mu¡
 
¿i£
 
ª
 
”rÜ
, 
ªd
 
should
„ai£ 
the


2160 #exc_šfØ
tu¶e
."

2161 
£lf
.
»q
.
£Á_h—d”s
:

2162 
Œy
:

2163 
¿i£
 
exc_šfo
[0],ƒxc_info[1],ƒxc_info[2]

2164 
fš®ly
:

2165 
exc_šfo
 = 
NÚe


2167 
£lf
.
»q
.
¡©us
 = status

2168 
k
, 
v
 
š
 
h—d”s
:

2169 
nÙ
 
	$isš¡ªû
(
k
, 
¡r
):

2170 
¿i£
 
	`Ty³E¼Ü
("WSGI„e¥Ú£ h—d” key %¸i nÙ oàty³ sŒ." % 
k
)

2171 
nÙ
 
	$isš¡ªû
(
v
, 
¡r
):

2172 
¿i£
 
	`Ty³E¼Ü
("WSGI„e¥Ú£ h—d” v®u%¸i nÙ oàty³ sŒ." % 
v
)

2173 
k
.
	`low”
() == 'content-length':

2174 
£lf
.
»maššg_by‹s_out
 = (
v
)

2175 
£lf
.
»q
.
outh—d”s
.
	$ex‹nd
(
h—d”s
)

2177  
£lf
.
wr™e


2179 
def
 
	$wr™e
(
£lf
, 
chunk
):

2182 
This
 
m‘hod
 
is
 
®so
 
u£d
 
š‹º®ly
 
by
 
	`¡¬t_»¥Ú£
 (
to
 
wr™e


2183 
d©a
 
äom
 
the
 
™”abË
 
»tuºed
 
by
h
WSGI
 
­¶iÿtiÚ
).

2185 
nÙ
 
£lf
.
¡¬‹d_»¥Ú£
:

2186 
¿i£
 
	`As£¹iÚE¼Ü
("WSGI write called before start_response.")

2188 
chunkËn
 = 
	$Ën
(
chunk
)

2189 
rbo
 = 
£lf
.
»maššg_by‹s_out


2190 
rbo
 
is
 
nÙ
 
NÚe
 
ªd
 
chunkËn
 >„bo:

2191 
nÙ
 
£lf
.
»q
.
£Á_h—d”s
:

2192 #Whew. 
We
 
ÿn
 
£nd
 
a
 500 
to
 
the
 
ş›Á
.

2193 
£lf
.
»q
.
	`sim¶e_»¥Ú£
("500 Internal Server Error",

2197 #Dªg. 
We
 
have
 
´obably
 
®»ady
 
£Á
 
d©a
. 
Trunÿ‹
 
the
 
chunk


2198 #tØ
	`f™
 (
so
 
the
 
ş›Á
 
dÛ¢
't hang)‡nd„aise‡nƒrror†ater.

2199 
chunk
 = chunk[:
rbo
]

2201 
nÙ
 
£lf
.
»q
.
£Á_h—d”s
:

2202 
£lf
.
»q
.
£Á_h—d”s
 = 
True


2203 
£lf
.
»q
.
	$£nd_h—d”s
()

2205 
£lf
.
»q
.
	$wr™e
(
chunk
)

2207 
rbo
 
is
 
nÙ
 
NÚe
:

2208 
rbo
 -ğ
chunkËn


2209 
rbo
 < 0:

2210 
¿i£
 
	`V®ueE¼Ü
(

2214 
şass
 
	$WSGIG©eway_10
(
WSGIG©eway
):

2217 
def
 
	$g‘_’vœÚ
(
£lf
):

2219 
»q
 = 
£lf
.req

2220 
’v
 = {

2221 #£ˆ
a
 
nÚ
-
¡ªd¬d
 
’vœÚ
 
’Œy
 
so
 
the
 
WSGI
 
­p
 
ÿn
 
know
 
wh©


2222 #th*
»®
* 
£rv”
 
´ÙocŞ
 
	`is
 (
ªd
 
wh©
 
ã©u»s
 
to
 
suµÜt
).

2223 #S“ 
h‰p
:

2224 'ACTUAL_SERVER_PROTOCOL': 
»q
.
£rv”
.
´ÙocŞ
,

2225 'PATH_INFO': 
»q
.
·th
,

2226 'QUERY_STRING': 
»q
.
qs
,

2227 'REMOTE_ADDR': 
»q
.
cÚn
.
»mÙe_addr
 
Ü
 '',

2228 'REMOTE_PORT': 
	`¡r
(
»q
.
cÚn
.
»mÙe_pÜt
 
Ü
 ''),

2229 'REQUEST_METHOD': 
»q
.
m‘hod
,

2230 'REQUEST_URI': 
»q
.
uri
,

2232 'SERVER_NAME': 
»q
.
£rv”
.
£rv”_Çme
,

2233 #Bah. "SERVER_PROTOCOL" 
is
 
aùu®ly
 
the
 
REQUEST
 
´ÙocŞ
.

2234 'SERVER_PROTOCOL': 
»q
.
»que¡_´ÙocŞ
,

2235 'SERVER_SOFTWARE': 
»q
.
£rv”
.
soáw¬e
,

2236 'wsgi.”rÜs': 
sys
.
¡d”r
,

2237 'wsgi.šput': 
»q
.
rfe
,

2238 'wsgi.muÉroûss': 
F®£
,

2239 'wsgi.muÉ™h»ad': 
True
,

2240 'wsgi.run_Úû': 
F®£
,

2241 'wsgi.u¾_scheme': 
»q
.
scheme
,

2243 
	}
}

2245 
	$isš¡ªû
(
»q
.
£rv”
.
bšd_addr
, 
ba£¡ršg
):

2246 #AF_UNIX. 
This
 
i¢
'ˆ»®ly‡Îowed by WSGI, which dÛ¢'
t


2247 #add»s 
unix
 
domaš
 
sock‘s
. 
But
 
™
's betterhan‚othing.

2248 
’v
["SERVER_PORT"] = ""

2250 
’v
["SERVER_PORT"] = 
	$¡r
(
»q
.
£rv”
.
bšd_addr
[1])

2252 #Reque¡ 
h—d”s


2253 
k
, 
v
 
š
 
»q
.
šh—d”s
.
	$™”™ems
():

2254 
’v
["HTTP_" + 
k
.
	`uµ”
().
	`»¶aû
("-", "_")] = 
v


2256 #CONTENT_TYPE/
CONTENT_LENGTH


2257 
ù
 = 
’v
.
	`pİ
("HTTP_CONTENT_TYPE", 
NÚe
)

2258 
ù
 
is
 
nÙ
 
NÚe
:

2259 
’v
["CONTENT_TYPE"] = 
ù


2260 
ş
 = 
’v
.
	`pİ
("HTTP_CONTENT_LENGTH", 
NÚe
)

2261 
ş
 
is
 
nÙ
 
NÚe
:

2262 
’v
["CONTENT_LENGTH"] = 
ş


2264 
»q
.
cÚn
.
s¦_’v
:

2265 
’v
.
	$upd©e
(
»q
.
cÚn
.
s¦_’v
)

2267  
’v


2270 
şass
 
	$WSGIG©eway_u0
(
WSGIG©eway_10
):

2273 
WSGI
 
u
.0 
is
 
ª
 
ex³rim’l
 
´ÙocŞ
, 
which
 
u£s
 
unicode
 
keys
 
ªd
 
v®ues


2274 
š
 
bÙh
 
PythÚ
 2 
ªd
 Python 3.

2277 
def
 
	$g‘_’vœÚ
(
£lf
):

2279 
»q
 = 
£lf
.req

2280 
’v_10
 = 
WSGIG©eway_10
.
	$g‘_’vœÚ
(
£lf
)

2281 
’v
 = 
	`diù
([(
k
.
	`decode
('ISO-8859-1'), 
v
èk, v 
š
 
’v_10
.
	`™”™ems
()])

2282 
’v
[
u
'wsgi.version'] = ('u', 0)

2284 #Reque¡-
URI


2285 
’v
.
	`£tdeçuÉ
(
u
'wsgi.url_encoding', u'utf-8')

2286 
Œy
:

2287 
key
 
š
 [
u
"PATH_INFO", u"SCRIPT_NAME", u"QUERY_STRING"]:

2288 
’v
[
key
] = 
’v_10
[
	`¡r
(key)].
	`decode
Ónv[
u
'wsgi.url_encoding'])

2289 
exû±
 
UnicodeDecodeE¼Ü
:

2290 #F®È
back
 
to
 
Ïtš
 1 
so
 
­ps
 
ÿn
 
Œªscode
 
Ãeded
.

2291 
’v
[
u
'wsgi.url_encoding'] = u'ISO-8859-1'

2292 
key
 
š
 [
u
"PATH_INFO", u"SCRIPT_NAME", u"QUERY_STRING"]:

2293 
’v
[
key
] = 
’v_10
[
	`¡r
(key)].
	`decode
Ónv[
u
'wsgi.url_encoding'])

2295 
k
, 
v
 
š
 
	`sÜ‹d
(
’v
.
	$™ems
()):

2296 
	$isš¡ªû
(
v
, 
¡r
è
ªd
 
k
 
nÙ
 
	`š
 ('REQUEST_URI', 'wsgi.input'):

2297 
’v
[
k
] = 
v
.
	`decode
('ISO-8859-1')

2299  
’v


2301 
wsgi_g©eways
 = {

2302 (1, 0): 
WSGIG©eway_10
,

2303 ('u', 0): 
WSGIG©eway_u0
,

2304 
	}
}

2306 
şass
 
	$WSGIP©hInfoDi¥©ch”
(
objeù
):

2309 
­ps
: 
a
 
diù
 
Ü
 
li¡
 
	$of
 (
·th_´efix
, 
­p
è
·œs
.

2312 
def
 
	$__š™__
(
£lf
, 
­ps
):

2313 
Œy
:

2314 
­ps
 = 
	`li¡
×µs.
	$™ems
())

2315 
exû±
 
A‰ribu‹E¼Ü
:

2316 
·ss


2318 #SÜˆ
the
 
­ps
 
by
 
	`Ën
(
·th
), 
desûndšg


2319 
­ps
.
	`sÜt
(
cmp
=
Ïmbda
 
x
,
y
: 
	`cmp
(
	`Ën
(x[0]), 
	$Ën
(
y
[0])))

2320 
­ps
.
	$»v”£
()

2322 #Th
·th_´efix
 
¡ršgs
 
mu¡
 
¡¬t
, 
but
 
nÙ
 
’d
, 
w™h
 
a
 
¦ash
.

2323 #U£ "" 
š¡—d
 
of
 "/".

2324 
£lf
.
­ps
 = [(
p
.
	`r¡r
("/"), 
a
èp,‡ 
š
‡pps]

2326 
def
 
	$__ÿÎ__
(
£lf
, 
’vœÚ
, 
¡¬t_»¥Ú£
):

2327 
·th
 = 
’vœÚ
["PATH_INFO"] 
Ü
 "/"

2328 
p
, 
­p
 
š
 
£lf
.
­ps
:

2329 #Th
­ps
 
li¡
 
should
 
be
 
sÜ‹d
 
by
 
Ëngth
, 
desûndšg
.

2330 
·th
.
	`¡¬tsw™h
(
p
 + "/"è
Ü
…ath ==…:

2331 
’vœÚ
 =ƒnvœÚ.
	$cİy
()

2332 
’vœÚ
["SCRIPT_NAME"] =ƒnvœÚ["SCRIPT_NAME"] + 
p


2333 
’vœÚ
["PATH_INFO"] = 
·th
[
	$Ën
(
p
):]

2334  
	$­p
(
’vœÚ
, 
¡¬t_»¥Ú£
)

2336 
	`¡¬t_»¥Ú£
('404 Not Found', [('Content-Type', 'text/plain'),

	@trunk/objs/CherryPy-3.2.4/cherrypy/__init__.py

4 
Ch”ryPy
 
cÚsi¡s
 
of
 
nÙ
 
	gÚe
, 
but
 
four
 
£·¿‹
 
API
 
	gÏy”s
.

6 
The
 
APPLICATION
 
LAYER
 
is
 
the
 
	gsim¶e¡
. 
Ch”ryPy
 
­¶iÿtiÚs
 
¬e
 
wr™‹n
 
as


7 
a
 
Œ“
 
of
 
şas£s
 
ªd
 
	gm‘hods
, 
wh”e
 
—ch
 
b¿nch
 
š
 
the
»
cÜ»¥Úds
 
to


8 
a
 
b¿nch
 
š
 
the
 
URL
 
	g·th
. 
Each
 
m‘hod
 
is
 
	ga
 '·ghªdËr', 
which
 
»ûives


9 
GET
 
ªd
 
POST
 
·¿ms
 
as
 
keywÜd
 
	g¬gum’ts
,‡nd 
»tuºs
 
Ü
 
y›lds
 
	$the
 (
HTML
)

10 
body
 
of
 
the
 
»¥Ú£
. 
The
 
¥ecŸl
 
m‘hod
 
Çme
 'šdex' 
is
 
u£d
 
·ths


11 
th©
 
’d
 
š
 
a
 
¦ash
, 
ªd
 
the
 
¥ecŸl
 
m‘hod
 
Çme
 'deçuÉ' 
is
 
u£d
 
to


12 
hªdË
 
muÉË
 
·ths
 
vŸ
 
a
 
sšgË
 
hªdËr
. 
This
 
Ïy”
 
®so
 
šşudes
:

14 * 
the
 'expo£d' 
	`©Œibu‹
 (
ªd
 
ch”rypy
.
expo£
)

15 * 
ch”rypy
.
	`quick¡¬t
()

16 * 
_ı_cÚfig
 
©Œibu‹s


17 * 
ch”rypy
.
	`toŞs
 (
šşudšg
 ch”rypy.
£ssiÚ
)

18 * 
ch”rypy
.
	$u¾
()

20 
The
 
ENVIRONMENT
 
LAYER
 
is
 
u£d
 
by
 
dev–İ”s
 
©
 
®l
 
Ëv–s
. 
It
 
´ovides


21 
šfÜm©iÚ
 
about
 
the
 
cu¼’t
 
»que¡
 
ªd
 
»¥Ú£
, 
¶us
h
­¶iÿtiÚ


22 
ªd
 
£rv”
 
’vœÚm’t
, 
vŸ
 
	$a
 (è
£t
 
of
 
tİ
-
Ëv–
 
objeùs
:

24 * 
ch”rypy
.
»que¡


25 * 
ch”rypy
.
»¥Ú£


26 * 
ch”rypy
.
’gše


27 * 
ch”rypy
.
£rv”


28 * 
ch”rypy
.
Œ“


29 * 
ch”rypy
.
cÚfig


30 * 
ch”rypy
.
th»ad_d©a


31 * 
ch”rypy
.
log


32 * 
ch”rypy
.
HTTPE¼Ü
, 
NÙFound
, 
ªd
 
HTTPRedœeù


33 * 
ch”rypy
.
lib


35 
The
 
EXTENSION
 
LAYER
 
®lows
 
advªûd
 
u£rs
 
to
 
cÚ¡ruù
 
ªd
 
sh¬e
 
theœ
 
own


36 
¶ugšs
. 
It
 
cÚsi¡s
 
of
:

38 * 
Hook
 
API


39 * 
ToŞ
 
API


40 * 
ToŞbox
 
API


41 * 
Di¥©ch
 
API


42 * 
CÚfig
 
Name¥aû
 
API


44 
Fš®ly
, 
th”e
 
is
 
the
 
CORE
 
LAYER
, 
which
 
u£s
h
cÜe
 
API
'so construct

45 
the
  
compÚ’ts
 
which
 
¬e
 
avaabË
 
©
 
high”
 
Ïy”s
. 
You
 
ÿn
 
thšk


46 
of
 
the
  
compÚ’ts
 
as
h'»ã»nû im¶em’tiÚ' 
Ch”ryPy
.

47 
	$MegaäamewÜks
 (
ªd
 
advªûd
 
u£rs
è
may
 
»¶aû
 
the
  
compÚ’ts


48 
w™h
 
cu¡omized
 
Ü
 
ex‹nded
 
compÚ’ts
. 
The
 
cÜe
 
API
's‡re:

50 * 
AµliÿtiÚ
 
API


51 * 
Engše
 
API


52 * 
Reque¡
 
API


53 * 
S”v”
 
API


54 * 
WSGI
 
API


56 
The£
 
API
's‡re described inhe CherryPy specification:

57 
h‰p
:

60 
__v”siÚ__
 = "3.2.4"

62 
äom
 
ch”rypy
.
_ıcom·t
 
impÜt
 
u¾još
 
as
 
_u¾još
, 
u¾’code
‡ 
_u¾’code


63 
äom
 
ch”rypy
.
_ıcom·t
 
impÜt
 
ba£¡ršg
, 
unicode¡r
, 
£t


65 
äom
 
ch”rypy
.
_ı”rÜ
 
impÜt
 
HTTPE¼Ü
, 
HTTPRedœeù
, 
IÁ”ÇlRedœeù


66 
äom
 
ch”rypy
.
_ı”rÜ
 
impÜt
 
NÙFound
, 
Ch”ryPyExû±iÚ
, 
TimeoutE¼Ü


68 
äom
 
ch”rypy
 
impÜt
 
_ıdi¥©ch
 
as
 
di¥©ch


70 
äom
 
ch”rypy
 
impÜt
 
_ıtoŞs


71 
toŞs
 = 
_ıtoŞs
.
deçuÉ_toŞbox


72 
ToŞ
 = 
_ıtoŞs
.Tool

74 
äom
 
ch”rypy
 
impÜt
 
_ı»que¡


75 
äom
 
ch”rypy
.
lib
 
impÜt
 
h‰put
 
as
 
_h‰put


77 
äom
 
ch”rypy
 
impÜt
 
_ıŒ“


78 
Œ“
 = 
_ıŒ“
.
	$T»e
()

79 
äom
 
ch”rypy
.
_ıŒ“
 
impÜt
 
AµliÿtiÚ


80 
äom
 
ch”rypy
 
impÜt
 
_ıwsgi
 
as
 
wsgi


82 
äom
 
ch”rypy
 
impÜt
 
´oûss


83 
Œy
:

84 
äom
 
ch”rypy
.
´oûss
 
impÜt
 
wš32


85 
’gše
 = 
wš32
.
	$Wš32Bus
()

86 
’gše
.
cÚsŞe_cÚŒŞ_hªdËr
 = 
wš32
.
	$CÚsŞeCŒlHªdËr
(
’gše
)

87 
d–
 
wš32


88 
exû±
 
ImpÜtE¼Ü
:

89 
’gše
 = 
´oûss
.
bus


92 #Timeouˆ
mÚ™Ü
. 
We
 
add
 
two
 
chªÃls
 
to
 
the
 
’gše


93 #tØ
which
 
ch”rypy
.
AµliÿtiÚ
 
wl
 
publish
.

94 
’gše
.
li¡’”s
['befÜe_»que¡'] = 
	$£t
()

95 
’gše
.
li¡’”s
['aá”_»que¡'] = 
	$£t
()

97 
şass
 
	$_TimeoutMÚ™Ü
(
´oûss
.
¶ugšs
.
MÚ™Ü
):

99 
def
 
	$__š™__
(
£lf
, 
bus
):

100 
£lf
.
£rvšgs
 = []

101 
´oûss
.
¶ugšs
.
MÚ™Ü
.
	$__š™__
(
£lf
, 
bus
, s–f.
run
)

103 
def
 
	$befÜe_»que¡
(
£lf
):

104 
£lf
.
£rvšgs
.
	`­³nd
((
£rvšg
.
»que¡
, s”všg.
»¥Ú£
))

106 
def
 
	$aá”_»que¡
(
£lf
):

107 
Œy
:

108 
£lf
.
£rvšgs
.
	`»move
((
£rvšg
.
»que¡
, s”všg.
»¥Ú£
))

109 
exû±
 
V®ueE¼Ü
:

110 
·ss


112 
def
 
	$run
(
£lf
):

114 
»q
, 
»¥
 
š
 
£lf
.
£rvšgs
:

115 
»¥
.
	$check_timeout
()

116 
’gše
.
timeout_mÚ™Ü
 = 
	$_TimeoutMÚ™Ü
(
’gše
)

117 
’gše
.
timeout_mÚ™Ü
.
	$subsüibe
()

119 
’gše
.
autÜ–ßd
 = 
´oûss
.
¶ugšs
.
	$AutÜ–ßd”
(
’gše
)

120 
’gše
.
autÜ–ßd
.
	$subsüibe
()

122 
’gše
.
th»ad_mªag”
 = 
´oûss
.
¶ugšs
.
	$Th»adMªag”
(
’gše
)

123 
’gše
.
th»ad_mªag”
.
	$subsüibe
()

125 
’gše
.
sigÇl_hªdËr
 = 
´oûss
.
¶ugšs
.
	$SigÇlHªdËr
(
’gše
)

128 
şass
 
	$_HªdËSigÇlsPlugš
(
objeù
):

130 
¶©fÜm
 
hªdËrs
 
above
."""

132 
def
 
	$__š™__
(
£lf
, 
bus
):

133 
£lf
.
bus
 = bus

135 
def
 
	$subsüibe
(
£lf
):

137 
	`ha§‰r
(
£lf
.
bus
, "signal_handler"):

138 
£lf
.
bus
.
sigÇl_hªdËr
.
	$subsüibe
()

139 
	`ha§‰r
(
£lf
.
bus
, "console_control_handler"):

140 
£lf
.
bus
.
cÚsŞe_cÚŒŞ_hªdËr
.
	$subsüibe
()

142 
’gše
.
sigÇls
 = 
	$_HªdËSigÇlsPlugš
(
’gše
)

145 
äom
 
ch”rypy
 
impÜt
 
_ı£rv”


146 
£rv”
 = 
_ı£rv”
.
	$S”v”
()

147 
£rv”
.
	$subsüibe
()

150 
def
 
	`quick¡¬t
(
roÙ
=
NÚe
, 
süt_Çme
="", 
cÚfig
=None):

153 
roÙ
: 
ª
 
š¡ªû
 
of
 
a
 "cÚŒŞË¸şass" (¨
cŞËùiÚ
 oà
·ge
 
hªdËr


154 
m‘hods
è
which
 
»´e£Ás
 
the
 
roÙ
 
of
h
­¶iÿtiÚ
.

155 
süt_Çme
: 
a
 
¡ršg
 
cÚššg
 
the
 "mouÁ…ošt" 
of
h
­¶iÿtiÚ
.

156 
This
 
should
 
¡¬t
 
w™h
 
a
 
¦ash
, 
ªd
 
be
 
the
 
·th
 
pÜtiÚ
 
of
h
URL


157 
©
 
which
 
to
 
mouÁ
 
the
 
giv’
 
roÙ
. 
FÜ
 
exam¶e
, roÙ.
	$šdex
(è
wl


158 
hªdË
 
»que¡s
 
to
 "h‰p://www.exam¶e.com:8080/d•t/­p1/", 
th’


159 
the
 
süt_Çme
 
¬gum’t
 
would
 
be
 "/dept/app1".

161 
It
 
MUST
 
NOT
 
’d
 
š
 
a
 
¦ash
. 
If
 
the
 
süt_Çme
 
»ãrs
 
to
h
roÙ


162 
of
 
the
 
URI
, 
™
 
MUST
 
be
 
ª
 
em±y
 
	`¡ršg
 (
nÙ
 "/").

163 
cÚfig
: 
a
 
fe
 
Ü
 
diù
 
cÚššg
 
­¶iÿtiÚ
 cÚfig. 
If
 
this
 
cÚšs


164 
a
 [
glob®
] 
£ùiÚ
, 
tho£
 
’Œ›s
 
wl
 
be
 
u£d
 
š
 
the
 global

165 (
s™e
-
wide
è
cÚfig
.

167 
cÚfig
:

168 
_glob®_cÚf_®Ÿs
.
	$upd©e
(
cÚfig
)

170 
Œ“
.
	$mouÁ
(
roÙ
, 
süt_Çme
, 
cÚfig
)

172 
’gše
.
sigÇls
.
	$subsüibe
()

173 
’gše
.
	$¡¬t
()

174 
’gše
.
	$block
()

177 
äom
 
ch”rypy
.
_ıcom·t
 
impÜt
 
th»adloÿl
 
as
 
_loÿl


179 
şass
 
	$_S”všg
(
_loÿl
):

182 
R©h”
 
thª
 
have
 
a
 
£·¿‹
 "th»ad†oÿl" 
objeù
 
the
 
»que¡
 
ªd


183 
the
 
»¥Ú£
, 
this
 
şass
 
wÜks
 
as
 
a
 
sšgË
 
th»adloÿl
 
cÚš”
 

184 
bÙh
 
	`objeùs
 (
ªd
 
ªy
 
Ùh”s
 
which
 
dev–İ”s
 
wish
 
to
 
defše
). 
In
 
this


185 
way
, 
we
 
ÿn
 
—sy
 
dump
 
tho£
 
objeùs
 
wh’
 w
¡İ
/
¡¬t
 
a
 
Ãw
 
HTTP


186 
cÚv”§tiÚ
, 
y‘
 
¡l
 
»ãr
 
to
 
them
 
as
 
moduË
-
Ëv–
 
glob®s
 
š
 
a


187 
th»ad
-
§ã
 
way
.

190 
»que¡
 = 
_ı»que¡
.
	`Reque¡
(
_h‰put
.
	`Ho¡
("127.0.0.1", 80),

191 
_h‰put
.
	`Ho¡
("127.0.0.1", 1111))

193 
The
 
»que¡
 
objeù
 
the
 
cu¼’t
 
th»ad
. 
In
h
maš
hread,

194 
ªd
 
ªy
 
th»ads
 
which
 
¬e
 
nÙ
 
»ûivšg
 
HTTP
 
»que¡s
, 
this
 
is
 
NÚe
."""

196 
»¥Ú£
 = 
_ı»que¡
.
	`Re¥Ú£
()

198 
The
 
»¥Ú£
 
objeù
 
the
 
cu¼’t
 
th»ad
. 
In
h
maš
hread,

199 
ªd
 
ªy
 
th»ads
 
which
 
¬e
 
nÙ
 
»ûivšg
 
HTTP
 
»que¡s
, 
this
 
is
 
NÚe
."""

201 
def
 
	$lßd
(
£lf
, 
»que¡
, 
»¥Ú£
):

202 
£lf
.
»que¡
 =„equest

203 
£lf
.
»¥Ú£
 =„esponse

205 
def
 
	$ş—r
(
£lf
):

207 
£lf
.
__diù__
.
	$ş—r
()

209 
£rvšg
 = 
	$_S”všg
()

212 
şass
 
	$_Th»adLoÿlProxy
(
objeù
):

214 
__¦Ùs__
 = ['__attrname__', '__dict__']

216 
def
 
	$__š™__
(
£lf
, 
©ŒÇme
):

217 
£lf
.
__©ŒÇme__
 = 
©ŒÇme


219 
def
 
	$__g‘©Œ__
(
£lf
, 
Çme
):

220 
chd
 = 
	$g‘©Œ
(
£rvšg
, 
£lf
.
__©ŒÇme__
)

221  
	$g‘©Œ
(
chd
, 
Çme
)

223 
def
 
	$__£‰r__
(
£lf
, 
Çme
, 
v®ue
):

224 
Çme
 
	`š
 ("__attrname__", ):

225 
objeù
.
	$__£‰r__
(
£lf
, 
Çme
, 
v®ue
)

227 
chd
 = 
	$g‘©Œ
(
£rvšg
, 
£lf
.
__©ŒÇme__
)

228 
	$£‰r
(
chd
, 
Çme
, 
v®ue
)

230 
def
 
	$__d–©Œ__
(
£lf
, 
Çme
):

231 
chd
 = 
	$g‘©Œ
(
£rvšg
, 
£lf
.
__©ŒÇme__
)

232 
	$d–©Œ
(
chd
, 
Çme
)

234 
def
 
	$_g‘_diù
(
£lf
):

235 
chd
 = 
	$g‘©Œ
(
£rvšg
, 
£lf
.
__©ŒÇme__
)

236 
d
 = 
chd
.
__şass__
.
__diù__
.
	$cİy
()

237 
d
.
	$upd©e
(
chd
.
__diù__
)

238  
d


239 
__diù__
 = 
	$´İ”ty
(
_g‘_diù
)

241 
def
 
	$__g‘™em__
(
£lf
, 
key
):

242 
chd
 = 
	$g‘©Œ
(
£rvšg
, 
£lf
.
__©ŒÇme__
)

243  
chd
[
key
]

245 
def
 
	$__£t™em__
(
£lf
, 
key
, 
v®ue
):

246 
chd
 = 
	$g‘©Œ
(
£rvšg
, 
£lf
.
__©ŒÇme__
)

247 
chd
[
key
] = 
v®ue


249 
def
 
	$__d–™em__
(
£lf
, 
key
):

250 
chd
 = 
	$g‘©Œ
(
£rvšg
, 
£lf
.
__©ŒÇme__
)

251 
d–
 
chd
[
key
]

253 
def
 
	$__cÚšs__
(
£lf
, 
key
):

254 
chd
 = 
	$g‘©Œ
(
£rvšg
, 
£lf
.
__©ŒÇme__
)

255  
key
 
š
 
chd


257 
def
 
	$__Ën__
(
£lf
):

258 
chd
 = 
	$g‘©Œ
(
£rvšg
, 
£lf
.
__©ŒÇme__
)

259  
	$Ën
(
chd
)

261 
def
 
	$__nÚz”o__
(
£lf
):

262 
chd
 = 
	$g‘©Œ
(
£rvšg
, 
£lf
.
__©ŒÇme__
)

263  
	$boŞ
(
chd
)

265 
__boŞ__
 = 
__nÚz”o__


267 #C»©
»que¡
 
ªd
 
»¥Ú£
 
	`objeù
 (
the
 
§me
 
objeùs
 
wl
 
be
 
u£d


268 #throughouˆ
the
 
’tœe
 
liã
 
of
h
web£rv”
, 
but
 
wl
 
»dœeù


269 #tØ
the
 "£rvšg" 
objeù
)

270 
»que¡
 = 
	`_Th»adLoÿlProxy
('request')

271 
»¥Ú£
 = 
	`_Th»adLoÿlProxy
('response')

273 #C»©
th»ad_d©a
 
objeù
 
as
 
a
 
th»ad
-
¥ecific
 
®l
-
pu½o£
 
¡Üage


274 
şass
 
	$_Th»adD©a
(
_loÿl
):

276 
th»ad_d©a
 = 
	$_Th»adD©a
()

279 #MÚkey·tch 
pydoc
 
to
 
®low
 
	`h–p
(ètØ
go
 
through
 
the
 
th»adloÿl
 
´oxy
.

280 #Jª 2007: 
no
 
GoogËabË
 
exam¶es
 
of
 
ªyÚe
 
»¶acšg
 
pydoc
.
»sŞve
.

281 #Th
Úly
 
Ùh”
 
way
 
would
 
be
 
to
 
chªge
 
wh©
 
is
 
»tuºed
 
äom
 
	`ty³
(
»que¡
)

282 #ªd 
th©
' nÙ…ossibË iÀpu» PythÚ (you'
d
 
have
 
to
 
çke
 
ob_ty³
).

283 
def
 
	$_ch”rypy_pydoc_»sŞve
(
thšg
, 
fÜûlßd
=0):

285 
	$isš¡ªû
(
thšg
, 
_Th»adLoÿlProxy
):

286 
thšg
 = 
	$g‘©Œ
(
£rvšg
, 
thšg
.
__©ŒÇme__
)

287  
_pydoc
.
	$_butš_»sŞve
(
thšg
, 
fÜûlßd
)

289 
Œy
:

290 
impÜt
 
pydoc
 
as
 
_pydoc


291 
_pydoc
.
_butš_»sŞve
 = _pydoc.
»sŞve


292 
_pydoc
.
»sŞve
 = 
_ch”rypy_pydoc_»sŞve


293 
exû±
 
ImpÜtE¼Ü
:

294 
·ss


297 
äom
 
ch”rypy
 
impÜt
 
_ıloggšg


299 
şass
 
	$_Glob®LogMªag”
(
_ıloggšg
.
LogMªag”
):

302 
This
 :
şass
:`
LogMªag”
<
ch”rypy
.
_ıloggšg
.LogMªag”>` 
im¶em’ts


303 
ch”rypy
.
	$log
(è
ªd
 
ch”rypy
.
log
.
	`acûss
(). 
If
 
e™h”


304 
funùiÚ
 
is
 
ÿÎed
 
duršg
 
a
 
»que¡
, 
the
 
mes§ge
 
wl
 
be
 
£Á
 
to
he

305 
logg”
 
the
 
cu¼’t
 
AµliÿtiÚ
. 
If
 
they
 
¬e
 
ÿÎed
 
outside
 
of
 
a


306 
»que¡
, 
the
 
mes§ge
 
wl
 
be
 
£Á
 
to
h
s™e
-
wide
 
logg”
.

309 
def
 
	$__ÿÎ__
(
£lf
, *
¬gs
, **
kw¬gs
):

311 #DØ
NOT
 
u£
 
Œy
/
exû±
 
h”e
. 
S“
 
h‰p
:

312 
	`ha§‰r
(
»que¡
, '­p'è
ªd
 ha§‰rÔeque¡.
­p
, 'log'):

313 
log
 = 
»que¡
.
­p
.log

315 
log
 = 
£lf


316  
log
.
	$”rÜ
(*
¬gs
, **
kw¬gs
)

318 
def
 
	$acûss
(
£lf
):

320 
Œy
:

321  
»que¡
.
­p
.
log
.
	$acûss
()

322 
exû±
 
A‰ribu‹E¼Ü
:

323  
_ıloggšg
.
LogMªag”
.
	$acûss
(
£lf
)

326 
log
 = 
	$_Glob®LogMªag”
()

327 #S‘ 
a
  
sü“n
 
hªdËr
 
Ú
 
the
 
glob®
 
log
.

328 
log
.
sü“n
 = 
True


329 
log
.
”rÜ_fe
 = ''

330 #Usšg 
ª
 
acûss
 
fe
 
makes
 
CP
 
about
 10% 
¦ow”
. 
L—ve
 
off
 
by
 .

331 
log
.
acûss_fe
 = ''

333 
def
 
	$_bu¦og
(
msg
, 
Ëv–
):

334 
log
.
	`”rÜ
(
msg
, 'ENGINE', 
£v”™y
=
Ëv–
)

335 
’gše
.
	`subsüibe
('log', 
_bu¦og
)

337 #H–³¸
funùiÚs
 
CP
 
­ps
 #


339 
def
 
	$expo£
(
func
=
NÚe
, 
®Ÿs
=None):

341 
def
 
	$expo£_
(
func
):

342 
func
.
expo£d
 = 
True


343 
®Ÿs
 
is
 
nÙ
 
NÚe
:

344 
	$isš¡ªû
(
®Ÿs
, 
ba£¡ršg
):

345 
·»Ás
[
®Ÿs
.
	`»¶aû
(".", "_")] = 
func


347 
a
 
š
 
®Ÿs
:

348 
·»Ás
[
a
.
	`»¶aû
(".", "_")] = 
func


349  
func


351 
impÜt
 
sys
, 
ty³s


352 
	`isš¡ªû
(
func
, (
ty³s
.
FunùiÚTy³
,y³s.
M‘hodTy³
)):

353 
®Ÿs
 
is
 
NÚe
:

354 #@
expo£


355 
func
.
expo£d
 = 
True


356  
func


358 #funøğ
	`expo£
(
func
, 
®Ÿs
)

359 
·»Ás
 = 
sys
.
	`_g‘äame
(1).
f_loÿls


360  
	$expo£_
(
func
)

361 
–if
 
func
 
is
 
NÚe
:

362 
®Ÿs
 
is
 
NÚe
:

363 #@
	`expo£
()

364 
·»Ás
 = 
sys
.
	`_g‘äame
(1).
f_loÿls


365  
expo£_


367 #@
	`expo£
(
®Ÿs
="®Ÿs"è
Ü


368 #@
	`expo£
(
®Ÿs
=["alias1", "alias2"])

369 
·»Ás
 = 
sys
.
	`_g‘äame
(1).
f_loÿls


370  
expo£_


372 #@
	`expo£
("®Ÿs"è
Ü


373 #@
	`expo£
(["alias1", "alias2"])

374 
·»Ás
 = 
sys
.
	`_g‘äame
(1).
f_loÿls


375 
®Ÿs
 = 
func


376  
expo£_


378 
def
 
	$pİ¬gs
(*
¬gs
, **
kw¬gs
):

380 (
ch”rypy
.
di¥©ch
.
Di¥©ch”
.
di¥©ch_m‘hod_Çme
).

382 
O±iÚ®
 
keywÜd
 
¬gum’t
: 
hªdËr
=(
Objeù
 
Ü
 
FunùiÚ
)

384 
Provides
 
a
 
_ı_di¥©ch
 
funùiÚ
 
th©
 
pİs
 
off
 
·th
 
£gm’ts
 
što


385 
ch”rypy
.
»que¡
.
·¿ms
 
und”
 
the
 
Çmes
 
¥ecif›d
. 
The
 
di¥©ch


386 
is
 
th’
 
fÜw¬ded
 
Ú
 
to
 
the
 
Ãxt
 
v·th
 
–em’t
.

388 
NÙe
 
th©
 
ªy
 
	$exi¡šg
 (
ªd
 
expo£d
è
memb”
 
funùiÚ
 
of
 
the
 
şass
 
th©


389 
pİ¬gs
 
is
 
­¶›d
 
to
 
wl
 
ov”ride
 
th©
 
v®ue
 
of
 
the
 
¬gum’t
. 
FÜ


390 
š¡ªû
, 
you
 
have
 
a
 
m‘hod
 
Çmed
 "li¡" 
Ú
 
the
 
şass
 
decÜ©ed
 
w™h


391 
pİ¬gs
, 
th’
 
acûssšg
 "/li¡" 
wl
 
ÿÎ
 
th©
 
funùiÚ
 
š¡—d
 
of
 
pİpšg


392 
™
 
off
 
as
 
the
 
»que¡ed
 
·¿m‘”
. 
This
 
»¡riùiÚ
 
­¶›s
 
to
 
®l


393 
_ı_di¥©ch
 
funùiÚs
. 
The
 
Úly
 
way
 
¬ound
 
this
 
»¡riùiÚ
 
is
 
to
 
ü—‹


394 
a
 "bÏnk cÏss" 
who£
 
Úly
 
funùiÚ
 
is
 
to
 
´ovide
 
_ı_di¥©ch
.

396 
If
 
th”e
 
¬e
 
·th
 
–em’ts
 
aá”
 
the
 
¬gum’ts
, 
Ü
 
mÜe
‡rguments

397 
¬e
 
»que¡ed
 
thª
‡» 
avaabË
 
š
 
the
 
v·th
, 
th’
he 'handler'

398 
keywÜd
 
¬gum’t
 
¥ecif›s
 
the
 
Ãxt
 
objeù
 
to
 
hªdË
h
·¿m‘”ized


399 
»que¡
. 
If
 
hªdËr
 
is
 
nÙ
 
¥ecif›d
 
Ü
 i 
NÚe
, 
th’
 
£lf
 i 
u£d
.

400 
If
 
hªdËr
 
is
 
a
 
funùiÚ
 
¿th”
 
thª
 
ª
 
š¡ªû
, 
th’
 
th©
 function

401 
wl
 
be
 
ÿÎed
 
w™h
 
the
 
¬gs
 
¥ecif›d
 
ªd
h 
v®ue
 
äom
 
th©


402 
funùiÚ
 
u£d
 
as
 
the
 
Ãxt
 
objeù
 
INSTEAD
 
of
 
addšg
h
·¿m‘”s
 
to


403 
ch”rypy
.
»que¡
.
¬gs
.

405 
This
 
decÜ©Ü
 
may
 
be
 
u£d
 
š
 
Úe
 
of
 
two
 
ways
:

407 
As
 
a
 
şass
 
decÜ©Ü
:

408 @
ch”rypy
.
	`pİ¬gs
('year', 'month', 'day')

409 
şass
 
Blog
:

410 
def
 
	$šdex
(
£lf
, 
y—r
=
NÚe
, 
mÚth
=NÚe, 
day
=None):

411 #Proûs 
the
 
·¿m‘”s
 
h”e
; 
ªy
 
u¾
 
like


412 #/, /2009, /2009/12, 
Ü
 /2009/12/31

413 #wÈ
fl
 
š
 
the
 
­´İrŸ‹
 
·¿m‘”s
.

415 
def
 
	$ü—‹
(
£lf
):

416 #Thi 
lšk
 
wl
 
¡l
 
be
 
avaabË
 
©
 /
ü—‹
. 
Defšed
 
funùiÚs


417 #k
´eûd’û
 
ov”
 
¬gum’ts
.

419 
Or
 
as
 
a
 
memb”
 
of
‡ 
şass
:

420 
şass
 
Blog
:

421 
_ı_di¥©ch
 = 
ch”rypy
.
	`pİ¬gs
('year', 'month', 'day')

424 
The
 
hªdËr
 
¬gum’t
 
may
 
be
 
u£d
 
to
 
mix
 
¬gum’ts
 
w™h
 
but
 
š
 
funùiÚs
.

425 
FÜ
 
š¡ªû
, 
the
 
fŞlowšg
 
£tup
 
®lows
 
difã»Á
 
aùiv™›s
 
©
he

426 
day
, 
mÚth
, 
ªd
 
y—r
 
Ëv–
:

428 
şass
 
DayHªdËr
:

429 
def
 
	$šdex
(
£lf
, 
y—r
, 
mÚth
, 
day
):

430 #DØ
som‘hšg
 
w™h
 
this
 
day
; 
´obably
 
li¡
 
’Œ›s


432 
def
 
	$d–‘e
(
£lf
, 
y—r
, 
mÚth
, 
day
):

433 #D–‘
®l
 
’Œ›s
 
this
 
day


435 @
ch”rypy
.
	`pİ¬gs
('day', 
hªdËr
=
	$DayHªdËr
())

436 
şass
 
MÚthHªdËr
:

437 
def
 
	$šdex
(
£lf
, 
y—r
, 
mÚth
):

438 #DØ
som‘hšg
 
w™h
 
this
 
mÚth
; 
´obably
 
li¡
 
’Œ›s


440 
def
 
	$d–‘e
(
£lf
, 
y—r
, 
mÚth
):

441 #D–‘
®l
 
’Œ›s
 
this
 
mÚth


443 @
ch”rypy
.
	`pİ¬gs
('mÚth', 
hªdËr
=
	$MÚthHªdËr
())

444 
şass
 
Y—rHªdËr
:

445 
def
 
	$šdex
(
£lf
, 
y—r
):

446 #DØ
som‘hšg
 
w™h
 
this
 
y—r


450 @
ch”rypy
.
	`pİ¬gs
('y—r', 
hªdËr
=
	$Y—rHªdËr
())

451 
şass
 
RoÙ
:

452 
def
 
	$šdex
(
£lf
):

457 #Sšû 
keywÜd
 
¬g
 
comes
 
aá”
 *
¬gs
, 
we
 
have
 
to
 
´oûss
 
™
 
our£lves


458 #fÜ 
low”
 
v”siÚs
 
of
 
pythÚ
.

460 
hªdËr
 = 
NÚe


461 
hªdËr_ÿÎ
 = 
F®£


462 
k
,
v
 
š
 
kw¬gs
.
	$™ems
():

463 
k
 == 'handler':

464 
hªdËr
 = 
v


466 
¿i£
 
	`Ty³E¼Ü
(

468 .
	$fÜm©
(
k
)

471 
impÜt
 
š¥eù


473 
hªdËr
 
is
 
nÙ
 
NÚe
 \

474 
	`ªd
 (
	`ha§‰r
(
hªdËr
, '__ÿÎ__'è
Ü
 
š¥eù
.
	$isşass
(
hªdËr
)):

475 
hªdËr_ÿÎ
 = 
True


477 
def
 
	$decÜ©ed
(
şs_Ü_£lf
=
NÚe
, 
v·th
=None):

478 
š¥eù
.
	$isşass
(
şs_Ü_£lf
):

479 #ch”rypy.
pİ¬gs
 
is
 
a
 
şass
 
decÜ©Ü


480 
şs
 = 
şs_Ü_£lf


481 
	$£‰r
(
şs
, 
di¥©ch
.
Di¥©ch”
.
di¥©ch_m‘hod_Çme
, 
decÜ©ed
)

482  
şs


485 
£lf
 = 
şs_Ü_£lf


486 
·rms
 = {
	}
}

487 
¬g
 
š
 
¬gs
:

488 
nÙ
 
v·th
:

490 
·rms
[
¬g
] = 
v·th
.
	$pİ
(0)

492 
hªdËr
 
is
 
nÙ
 
NÚe
:

493 
hªdËr_ÿÎ
:

494  
	$hªdËr
(**
·rms
)

496 
»que¡
.
·¿ms
.
	$upd©e
(
·rms
)

497  
hªdËr


499 
»que¡
.
·¿ms
.
	$upd©e
(
·rms
)

501 #Ià
we
 
¬e
 
the
 
uÉim©e
 
hªdËr
, 
th’
 
to
 
´ev’t
 
our
 
_ı_di¥©ch


502 #äom 
bešg
 
ÿÎed
 
agaš
, 
we
 
wl
 
»sŞve
 
»maššg
 
–em’ts
 
through


503 #g‘©Œ(è
dœeùly
.

504 
v·th
:

505  
	`g‘©Œ
(
£lf
, 
v·th
.
	`pİ
(0), 
NÚe
)

507  
£lf


509  
decÜ©ed


511 
def
 
	`u¾
(
·th
="", 
qs
="", 
süt_Çme
=
NÚe
, 
ba£
=NÚe, 
»Ïtive
=None):

514 
If
 '·th' 
¡¬ts
 
w™h
 
a
 
	`¦ash
 ('/'), 
this
 
wl
 

515 (
ba£
 + 
süt_Çme
 + 
·th
 + 
qs
).

516 
If
 
™
 
dÛs
 
nÙ
 
¡¬t
 
w™h
 
a
 
¦ash
, 
this
 
»tuºs


517 (
ba£
 + 
süt_Çme
 [+ 
»que¡
.
·th_šfo
] + 
·th
 + 
qs
).

519 
If
 
süt_Çme
 
is
 
NÚe
, 
ch”rypy
.
»que¡
 
wl
 
be
 
u£d


520 
to
 
fšd
 
a
 
süt_Çme
, 
avaabË
.

522 
If
 
ba£
 
is
 
NÚe
, 
ch”rypy
.
»que¡
.ba£ 
wl
 
be
 
	`u£d
 (
avaabË
).

523 
NÙe
 
th©
 
you
 
ÿn
 
u£
 
ch”rypy
.
toŞs
.
´oxy
 
to
 
chªge
 
this
.

525 
Fš®ly
, 
nÙe
 
th©
 
this
 
funùiÚ
 
ÿn
 
be
 
u£d
 
to
 
obš
 
ª
 
absŞu‹
 
URL


526 
the
 
cu¼’t
 
»que¡
 
	$·th
 (
mšus
 
the
 
qu”y¡ršg
è
by
 
·ssšg
 
no
 
¬gs
.

527 
If
 
you
 
ÿÎ
 
	`u¾
(
qs
=
ch”rypy
.
»que¡
.
qu”y_¡ršg
), you 
should
 
g‘
 
the


528 
Üigš®
 
brow£r
 
	`URL
 (
assumšg
 
no
 
š‹º®
 
»dœeùiÚs
).

530 
If
 
»Ïtive
 
is
 
NÚe
 
Ü
 
nÙ
 
´ovided
, 
»que¡
.
­p
.
»Ïtive_u¾s
 
wl


531 
be
 
	`u£d
 (
avaabË
, 
F®£
). 
If
 F®£, 
the
 
ouut
 
wl
 b
ª


532 
absŞu‹
 
	`URL
 (
šşudšg
 
the
 
scheme
, 
ho¡
, 
vho¡
, 
ªd
 
süt_Çme
).

533 
If
 
True
, 
the
 
ouut
 
wl
 
š¡—d
 
be
 
a
 
URL
 
th©
 
is
 
»Ïtive
 
to
he

534 
cu¼’t
 
»que¡
 
·th
, 
³rh­s
 
šşudšg
 '..' 
©oms
. 
If
 
»Ïtive
 
is


535 
the
 
¡ršg
 '£rv”',h
ouut
 
wl
 
š¡—d
 
be
 
a
 
URL
 
th©
 
is


536 
»Ïtive
 
to
 
the
 
£rv”
 
roÙ
; 
i
.
e
., 
™
 
wl
 
¡¬t
 
w™h
 
a
 
¦ash
.

538 
	`isš¡ªû
(
qs
, (
tu¶e
, 
li¡
, 
diù
)):

539 
qs
 = 
	$_u¾’code
(
qs
)

540 
qs
:

541 
qs
 = '?' + qs

543 
»que¡
.
­p
:

544 
nÙ
 
·th
.
	`¡¬tsw™h
("/"):

545 #Aµ’d/
»move
 
Œašg
 
¦ash
 
äom
 
·th_šfo
 
as
 
Ãeded


546 #(
this
 
is
 
to
 
suµÜt
 
mi¡y³d
 
URL
's without„edirecting;

547 #ià
you
 
wªt
 
to
 
»dœeù
, 
u£
 
toŞs
.
Œašg_¦ash
).

548 
pi
 = 
»que¡
.
·th_šfo


549 
»que¡
.
is_šdex
 
is
 
True
:

550 
nÙ
 
pi
.
	`’dsw™h
('/'):

551 
pi
 =…i + '/'

552 
–if
 
»que¡
.
is_šdex
 
is
 
F®£
:

553 
pi
.
	`’dsw™h
('/'è
ªd
…i != '/':

554 
pi
 =…i[:-1]

556 
·th
 == "":

557 
·th
 = 
pi


559 
·th
 = 
	$_u¾još
(
pi
, 
·th
)

561 
süt_Çme
 
is
 
NÚe
:

562 
süt_Çme
 = 
»que¡
.script_name

563 
ba£
 
is
 
NÚe
:

564 
ba£
 = 
»que¡
.base

566 
Ãwu¾
 = 
ba£
 + 
süt_Çme
 + 
·th
 + 
qs


568 #NØ
»que¡
.
	`­p
 (
we
're being called outside‡„equest).

570 #Thi 
wl
 
´oduû
 
v”y
 
difã»Á
 
»suÉs
 
äom
 
the
 
above


571 #ià
you
're using vhosts orools.proxy.

572 
ba£
 
is
 
NÚe
:

573 
ba£
 = 
£rv”
.
	$ba£
()

575 
·th
 = (
süt_Çme
 
Ü
 "") +…ath

576 
Ãwu¾
 = 
ba£
 + 
·th
 + 
qs


578 './' 
š
 
Ãwu¾
:

579 #NÜm®iz
the
 
URL
 
by
 
»movšg
 ./ 
ªd
 ../

580 
©oms
 = []

581 
©om
 
š
 
Ãwu¾
.
	`¥l™
('/'):

582 
©om
 == '.':

583 
·ss


584 
–if
 
©om
 == '..':

585 
©oms
.
	$pİ
()

587 
©oms
.
	$­³nd
(
©om
)

588 
Ãwu¾
 = '/'.
	$još
(
©oms
)

590 #Aˆ
this
 
pošt
, 
we
 
should
 
have
 
a
 
fuÎy
-
qu®if›d
 
absŞu‹
 
URL
.

592 
»Ïtive
 
is
 
NÚe
:

593 
»Ïtive
 = 
	`g‘©Œ
(
»que¡
.
­p
, "»Ïtive_u¾s", 
F®£
)

595 #S“ 
h‰p
:

596 
»Ïtive
 == 'server':

597 #"
A
 
»Ïtive
 
»ã»nû
 
begšnšg
 
w™h
 
a
 
sšgË
 
¦ash
 
ch¬aù”
 
is


598 #‹rmed 
ª
 
absŞu‹
-
·th
 
»ã»nû
, 
as
 
defšed
 
by
 <
abs_·th
>..."

599 #Thi 
is
 
®so
 
som‘imes
 
ÿÎed
 "server-relative".

600 
Ãwu¾
 = '/' + '/'.
	`još
Òewu¾.
	`¥l™
('/', 3)[3:])

601 
–if
 
»Ïtive
:

602 #"
A
 
»Ïtive
 
»ã»nû
 
th©
 
dÛs
 
nÙ
 
begš
 
w™h
 
a
 
scheme
 
Çme


603 #Ü 
a
 
¦ash
 
ch¬aù”
 
is
 
‹rmed
‡ 
»Ïtive
-
·th
 
»ã»nû
."

604 
Şd
 = 
	`u¾
(
»Ïtive
=
F®£
).
	`¥l™
('/')[:-1]

605 
Ãw
 = 
Ãwu¾
.
	`¥l™
('/')

606 
Şd
 
ªd
 
Ãw
:

607 
a
, 
b
 = 
Şd
[0], 
Ãw
[0]

608 
a
 !ğ
b
:

610 
Şd
.
	$pİ
(0)

611 
Ãw
.
	$pİ
(0)

612 
Ãw
 = (['..'] * 
	`Ën
(
Şd
)) +‚ew

613 
Ãwu¾
 = '/'.
	$još
(
Ãw
)

615  
Ãwu¾


618 #impÜˆ
_ıcÚfig
 
Ï¡
 
so
 
™
 
ÿn
 
»ã»nû
 
Ùh”
 
tİ
-
Ëv–
 
objeùs


619 
äom
 
ch”rypy
 
impÜt
 
_ıcÚfig


620 #U£ 
_glob®_cÚf_®Ÿs
 
so
 
quick¡¬t
 
ÿn
 
u£
 'cÚfig' 
as
 
ª
 
¬g


621 #w™houˆ
shadowšg
 
ch”rypy
.
cÚfig
.

622 
cÚfig
 = 
_glob®_cÚf_®Ÿs
 = 
_ıcÚfig
.
	$CÚfig
()

623 
cÚfig
.
deçuÉs
 = {

624 'toŞs.log_Œaûbacks.Ú': 
True
,

625 'toŞs.log_h—d”s.Ú': 
True
,

626 'toŞs.Œašg_¦ash.Ú': 
True
,

627 'toŞs.’code.Ú': 
True


628 
	}
}

629 
cÚfig
.
Çme¥aûs
["log"] = 
Ïmbda
 
k
, 
	gv
: 
	$£‰r
(
log
, 
k
, 
v
)

630 
cÚfig
.
Çme¥aûs
["check”"] = 
Ïmbda
 
k
, 
v
: 
	$£‰r
(
check”
, 
k
, 
v
)

631 #Mu¡ 
»£t
 
to
 
g‘
 
our
 
deçuÉs
 
­¶›d
.

632 
cÚfig
.
	$»£t
()

634 
äom
 
ch”rypy
 
impÜt
 
_ıcheck”


635 
check”
 = 
_ıcheck”
.
	$Check”
()

636 
’gše
.
	`subsüibe
('¡¬t', 
check”
)

	@trunk/objs/CherryPy-3.2.4/cherrypy/_cpchecker.py

1 
impÜt
 
os


2 
impÜt
 
w¬nšgs


4 
impÜt
 
ch”rypy


5 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
	g™”™ems
, 
	gcİykeys
, 
butšs


8 
şass
 
	$Check”
(
objeù
):

11 
Wh’
 
this
 
objeù
 
is
 
ÿÎed
 
©
 
’gše
 
¡¬tup
, 
™
 
execu‹s
 
—ch


12 
of
 
™s
 
own
 
m‘hods
 
who£
 
Çmes
 
¡¬t
 
w™h
 ``
check_
``. 
If
 
you
 
wish


13 
to
 
di§bË
 
£Ëùed
 
checks
, 
sim¶y
 
add
 
a
 
lše
 
š
 
your
 
glob®


14 
cÚfig
 
which
 
£ts
 
the
 
­´İrŸ‹
 
m‘hod
 
to
 
F®£
::

16 [
glob®
]

17 
check”
.
check_sk³d_­p_cÚfig
 = 
F®£


19 
You
 
may
 
®so
 
dyÇmiÿÎy
 
add
 
Ü
 
»¶aû
 ``
check_
*`` 
m‘hods
 
š
 
this
 
way
.

22 
Ú
 = 
True


26 
def
 
	$__š™__
(
£lf
):

27 
£lf
.
	$_pİuÏ‹_known_ty³s
()

29 
def
 
	$__ÿÎ__
(
£lf
):

31 
£lf
.
Ú
:

32 
ŞdfÜm©w¬nšg
 = 
w¬nšgs
.
fÜm©w¬nšg


33 
w¬nšgs
.
fÜm©w¬nšg
 = 
£lf
.formatwarning

34 
Œy
:

35 
Çme
 
š
 
	$dœ
(
£lf
):

36 
Çme
.
	`¡¬tsw™h
("check_"):

37 
m‘hod
 = 
	$g‘©Œ
(
£lf
, 
Çme
)

38 
m‘hod
 
ªd
 
	`ha§‰r
(method, '__call__'):

39 
	$m‘hod
()

40 
fš®ly
:

41 
w¬nšgs
.
fÜm©w¬nšg
 = 
ŞdfÜm©w¬nšg


43 
def
 
	$fÜm©w¬nšg
(
£lf
, 
mes§ge
, 
ÿ‹gÜy
, 
f’ame
, 
lš’o
, 
lše
=
NÚe
):

45  "Ch”ryPy Check”:\n%s\n\n" % 
mes§ge


47 #Thi 
v®ue
 
should
 
be
 
£t
 
šside
 
_ıcÚfig
.

48 
glob®_cÚfig_cÚšed_·ths
 = 
F®£


50 
def
 
	$check_­p_cÚfig_’Œ›s_dÚt_¡¬t_w™h_süt_Çme
(
£lf
):

52 
¢
, 
­p
 
š
 
ch”rypy
.
Œ“
.
­ps
.
	$™ems
():

53 
nÙ
 
	$isš¡ªû
(
­p
, 
ch”rypy
.
AµliÿtiÚ
):

55 
nÙ
 
­p
.
cÚfig
:

57 
¢
 == '':

59 
¢_©oms
 = 
¢
.
	`¡r
("/").
	`¥l™
("/")

60 
key
 
š
 
­p
.
cÚfig
.
	$keys
():

61 
key_©oms
 = 
key
.
	`¡r
("/").
	`¥l™
("/")

62 
key_©oms
[:
	`Ën
(
¢_©oms
)] == sn_atoms:

63 
w¬nšgs
.
	`w¬n
(

65 "’Œ› th© s¹ w™h it süˆÇme: %r" % (
¢
, 
key
))

67 
def
 
	$check_s™e_cÚfig_’Œ›s_š_­p_cÚfig
(
£lf
):

69 
¢
, 
­p
 
š
 
	$™”™ems
(
ch”rypy
.
Œ“
.
­ps
):

70 
nÙ
 
	$isš¡ªû
(
­p
, 
ch”rypy
.
AµliÿtiÚ
):

73 
msg
 = []

74 
£ùiÚ
, 
’Œ›s
 
š
 
	$™”™ems
(
­p
.
cÚfig
):

75 
£ùiÚ
.
	`¡¬tsw™h
('/'):

76 
key
, 
v®ue
 
š
 
	$™”™ems
(
’Œ›s
):

77 
n
 
	`š
 ("engine.", "server.", "tree.", "checker."):

78 
key
.
	$¡¬tsw™h
(
n
):

79 
msg
.
	`­³nd
("[%s] % ğ%s" % (
£ùiÚ
, 
key
, 
v®ue
))

80 
msg
:

81 
msg
.
	`š£¹
(0,

85 "tØch”rypy.cÚfig.upd©e(èš¡—d oàŒ“.mouÁ()." % 
¢
)

86 
w¬nšgs
.
	`w¬n
(
os
.
lše£p
.
	$još
(
msg
))

88 
def
 
	$check_sk³d_­p_cÚfig
(
£lf
):

90 
¢
, 
­p
 
š
 
ch”rypy
.
Œ“
.
­ps
.
	$™ems
():

91 
nÙ
 
	$isš¡ªû
(
­p
, 
ch”rypy
.
AµliÿtiÚ
):

93 
nÙ
 
­p
.
cÚfig
:

94 
msg
 = "ThAµliÿtiÚ mouÁed‡ˆ%¸ha ªƒm±y cÚfig." % 
¢


95 
£lf
.
glob®_cÚfig_cÚšed_·ths
:

96 
msg
 += (" It†ooks†ikehe config you…assedo "

101 
w¬nšgs
.
	$w¬n
(
msg
)

104 
def
 
	$check_­p_cÚfig_b¿ck‘s
(
£lf
):

106 
¢
, 
­p
 
š
 
ch”rypy
.
Œ“
.
­ps
.
	$™ems
():

107 
nÙ
 
	$isš¡ªû
(
­p
, 
ch”rypy
.
AµliÿtiÚ
):

109 
nÙ
 
­p
.
cÚfig
:

111 
key
 
š
 
­p
.
cÚfig
.
	$keys
():

112 
key
.
	`¡¬tsw™h
("["è
Ü
 key.
	`’dsw™h
("]"):

113 
w¬nšgs
.
	`w¬n
(

117 "Ó.g.…as£dØŒ“.mouÁèdØnÙ." % (
¢
, 
key
))

119 
def
 
	$check_¡©ic_·ths
(
£lf
):

121 #U£ 
the
 
dummy
 
Reque¡
 
objeù
 
š
h
maš
 
th»ad
.

122 
»que¡
 = 
ch”rypy
.request

123 
¢
, 
­p
 
š
 
ch”rypy
.
Œ“
.
­ps
.
	$™ems
():

124 
nÙ
 
	$isš¡ªû
(
­p
, 
ch”rypy
.
AµliÿtiÚ
):

126 
»que¡
.
­p
 =‡pp

127 
£ùiÚ
 
š
 
­p
.
cÚfig
:

128 #g‘_»sourû 
wl
 
pİuÏ‹
 
»que¡
.
cÚfig


129 
»que¡
.
	`g‘_»sourû
(
£ùiÚ
 + "/dummy.html")

130 
cÚf
 = 
»que¡
.
cÚfig
.
g‘


132 
	`cÚf
("toŞs.¡©icdœ.Ú", 
F®£
):

133 
msg
 = ""

134 
roÙ
 = 
	`cÚf
("tools.staticdir.root")

135 
dœ
 = 
	`cÚf
("tools.staticdir.dir")

136 
dœ
 
is
 
NÚe
:

137 
msg
 = "tools.staticdir.dir is‚ot set."

139 
fuÎdœ
 = ""

140 
os
.
·th
.
	$i§bs
(
dœ
):

141 
fuÎdœ
 = 
dœ


142 
roÙ
:

143 
msg
 = ("dir is‡n‡bsolute…ath,ƒven "

145 
‹¡dœ
 = 
os
.
·th
.
	`još
(
roÙ
, 
dœ
[1:])

146 
os
.
·th
.
	$exi¡s
(
‹¡dœ
):

147 
msg
 += ("\nIf you meanto servehe "

149 "thËadšg sÏsh from dœ." % 
‹¡dœ
)

151 
nÙ
 
roÙ
:

152 
msg
 = "dir is‡„elative…ath‡nd‚o„oot…rovided."

154 
fuÎdœ
 = 
os
.
·th
.
	$još
(
roÙ
, 
dœ
)

155 
nÙ
 
os
.
·th
.
	$i§bs
(
fuÎdœ
):

156 
msg
 = "%¸i nÙ‡ÀabsŞu‹…©h." % 
fuÎdœ


158 
fuÎdœ
 
ªd
 
nÙ
 
os
.
·th
.
	$exi¡s
(
fuÎdœ
):

159 
msg
:

160 
msg
 += "\n"

161 
msg
 += ("%r (root + dir) is‚ot‡nƒxisting "

162 "fesy¡em…©h." % 
fuÎdœ
)

164 
msg
:

165 
w¬nšgs
.
	`w¬n
("%s\nsection: [%s]\nroot: %r\ndir: %r"

166 % (
msg
, 
£ùiÚ
, 
roÙ
, 
dœ
))

169 #-------------------------- 
Com·tib™y
 -------------------------- #


170 
obsŞ‘e
 = {

173 'log_cÚfig_İtiÚs': 
NÚe
,

175 'log_fe_nÙ_found': 
NÚe
,

182 
	}
}

184 
d•»ÿ‹d
 = {}

186 
def
 
	$_com·t
(
£lf
, 
cÚfig
):

188 
£ùiÚ
, 
cÚf
 
š
 
cÚfig
.
	$™ems
():

189 
	$isš¡ªû
(
cÚf
, 
diù
):

190 
k
, 
v
 
š
 
cÚf
.
	$™ems
():

191 
k
 
š
 
£lf
.
obsŞ‘e
:

192 
w¬nšgs
.
	`w¬n
("%r is obsolete. Use %r instead.\n"

194 (
k
, 
£lf
.
obsŞ‘e
[k], 
£ùiÚ
))

195 
–if
 
k
 
š
 
£lf
.
d•»ÿ‹d
:

196 
w¬nšgs
.
	`w¬n
("%r is deprecated. Use %r instead.\n"

198 (
k
, 
£lf
.
d•»ÿ‹d
[k], 
£ùiÚ
))

200 
£ùiÚ
 
š
 
£lf
.
obsŞ‘e
:

201 
w¬nšgs
.
	`w¬n
("%r is obsolete. Use %r instead."

202 % (
£ùiÚ
, 
£lf
.
obsŞ‘e
[section]))

203 
–if
 
£ùiÚ
 
š
 
£lf
.
d•»ÿ‹d
:

204 
w¬nšgs
.
	`w¬n
("%r is deprecated. Use %r instead."

205 % (
£ùiÚ
, 
£lf
.
d•»ÿ‹d
[section]))

207 
def
 
	$check_com·tib™y
(
£lf
):

209 
£lf
.
	$_com·t
(
ch”rypy
.
cÚfig
)

210 
¢
, 
­p
 
š
 
ch”rypy
.
Œ“
.
­ps
.
	$™ems
():

211 
nÙ
 
	$isš¡ªû
(
­p
, 
ch”rypy
.
AµliÿtiÚ
):

213 
£lf
.
	$_com·t
(
­p
.
cÚfig
)

216 #------------------------ 
Known
 
Name¥aûs
 ------------------------ #


217 
exŒa_cÚfig_Çme¥aûs
 = []

219 
def
 
	$_known_ns
(
£lf
, 
­p
):

220 
ns
 = ["wsgi"]

221 
ns
.
	`ex‹nd
(
	$cİykeys
(
­p
.
toŞboxes
))

222 
ns
.
	`ex‹nd
(
	$cİykeys
(
­p
.
Çme¥aûs
))

223 
ns
.
	`ex‹nd
(
	$cİykeys
(
­p
.
»que¡_şass
.
Çme¥aûs
))

224 
ns
.
	`ex‹nd
(
	$cİykeys
(
ch”rypy
.
cÚfig
.
Çme¥aûs
))

225 
ns
 +ğ
£lf
.
exŒa_cÚfig_Çme¥aûs


227 
£ùiÚ
, 
cÚf
 
š
 
­p
.
cÚfig
.
	$™ems
():

228 
is_·th_£ùiÚ
 = 
£ùiÚ
.
	`¡¬tsw™h
("/")

229 
is_·th_£ùiÚ
 
ªd
 
	$isš¡ªû
(
cÚf
, 
diù
):

230 
k
, 
v
 
š
 
cÚf
.
	$™ems
():

231 
©oms
 = 
k
.
	`¥l™
(".")

232 
	`Ën
(
©oms
) > 1:

233 
©oms
[0] 
nÙ
 
š
 
ns
:

234 #Sp™ 
out
 
a
 
¥ecŸl
 
w¬nšg
 ¨
known


235 #Çme¥aû 
is
 
´eûded
 
by
 "cherrypy."

236 ià(
©oms
[0] =ğ"ch”rypy" 
ªd
‡toms[1] 
š
 
ns
):

237 
msg
 = ("The configƒntry %r is invalid; "

239 % (
k
, ".".
	`još
(
©oms
[1:]), 
£ùiÚ
))

241 
msg
 = ("The configƒntry %r is invalid, because "

243 "£ùiÚ: [%s]" % (
k
, 
©oms
[0], 
£ùiÚ
))

244 
w¬nšgs
.
	$w¬n
(
msg
)

245 
–if
 
©oms
[0] == "tools":

246 
©oms
[1] 
nÙ
 
š
 
	$dœ
(
ch”rypy
.
toŞs
):

247 
msg
 = ("The configƒntry %r may be invalid, "

249 "£ùiÚ: [%s]" % (
k
, 
©oms
[1], 
£ùiÚ
))

250 
w¬nšgs
.
	$w¬n
(
msg
)

252 
def
 
	$check_cÚfig_Çme¥aûs
(
£lf
):

254 
¢
, 
­p
 
š
 
ch”rypy
.
Œ“
.
­ps
.
	$™ems
():

255 
nÙ
 
	$isš¡ªû
(
­p
, 
ch”rypy
.
AµliÿtiÚ
):

257 
£lf
.
	$_known_ns
(
­p
)

262 #-------------------------- 
CÚfig
 
Ty³s
 -------------------------- #


263 
known_cÚfig_ty³s
 = {
	}
}

265 
def
 
	$_pİuÏ‹_known_ty³s
(
£lf
):

266 
b
 = [
x
 x 
š
 
	`v¬s
(
butšs
).
	$v®ues
()

267 
	$ty³
(
x
è
is
 
	`ty³
(
¡r
)]

269 
def
 
	$Œav”£
(
obj
, 
Çme¥aû
):

270 
Çme
 
š
 
	$dœ
(
obj
):

272 
Çme
 == 'body_params':

274 
vty³
 = 
	`ty³
(
	$g‘©Œ
(
obj
, 
Çme
, 
NÚe
))

275 
vty³
 
š
 
b
:

276 
£lf
.
known_cÚfig_ty³s
[
Çme¥aû
 + "." + 
Çme
] = 
vty³


278 
	`Œav”£
(
ch”rypy
.
»que¡
, "request")

279 
	`Œav”£
(
ch”rypy
.
»¥Ú£
, "response")

280 
	`Œav”£
(
ch”rypy
.
£rv”
, "server")

281 
	`Œav”£
(
ch”rypy
.
’gše
, "engine")

282 
	`Œav”£
(
ch”rypy
.
log
, "log")

284 
def
 
	$_known_ty³s
(
£lf
, 
cÚfig
):

285 
msg
 = ("The configƒntry %r in section %r is ofype %r, "

288 
£ùiÚ
, 
cÚf
 
š
 
cÚfig
.
	$™ems
():

289 
	$isš¡ªû
(
cÚf
, 
diù
):

290 
k
, 
v
 
š
 
cÚf
.
	$™ems
():

291 
v
 
is
 
nÙ
 
NÚe
:

292 
ex³ùed_ty³
 = 
£lf
.
known_cÚfig_ty³s
.
	$g‘
(
k
, 
NÚe
)

293 
vty³
 = 
	$ty³
(
v
)

294 
ex³ùed_ty³
 
ªd
 
vty³
 !=ƒxpected_type:

295 
w¬nšgs
.
	`w¬n
(
msg
 % (
k
, 
£ùiÚ
, 
vty³
.
__Çme__
,

296 
ex³ùed_ty³
.
__Çme__
))

298 
k
, 
v
 = 
£ùiÚ
, 
cÚf


299 
v
 
is
 
nÙ
 
NÚe
:

300 
ex³ùed_ty³
 = 
£lf
.
known_cÚfig_ty³s
.
	$g‘
(
k
, 
NÚe
)

301 
vty³
 = 
	$ty³
(
v
)

302 
ex³ùed_ty³
 
ªd
 
vty³
 !=ƒxpected_type:

303 
w¬nšgs
.
	`w¬n
(
msg
 % (
k
, 
£ùiÚ
, 
vty³
.
__Çme__
,

304 
ex³ùed_ty³
.
__Çme__
))

306 
def
 
	$check_cÚfig_ty³s
(
£lf
):

308 
£lf
.
	$_known_ty³s
(
ch”rypy
.
cÚfig
)

309 
¢
, 
­p
 
š
 
ch”rypy
.
Œ“
.
­ps
.
	$™ems
():

310 
nÙ
 
	$isš¡ªû
(
­p
, 
ch”rypy
.
AµliÿtiÚ
):

312 
£lf
.
	$_known_ty³s
(
­p
.
cÚfig
)

315 #-------------------- 
S³cific
 
cÚfig
 
w¬nšgs
 -------------------- #


316 
def
 
	$check_loÿlho¡
(
£lf
):

318 
k
, 
v
 
š
 
ch”rypy
.
cÚfig
.
	$™ems
():

319 
k
 =ğ'£rv”.sock‘_ho¡' 
ªd
 
v
 == 'localhost':

320 
w¬nšgs
.
	`w¬n
("The use of 'localhost'‡s‡ socket host can "

	@trunk/objs/CherryPy-3.2.4/cherrypy/_cpcompat.py

3 
	gCh”ryPy
 3.2 
is
 
com·tibË
 
w™h
 
PythÚ
 
	gv”siÚs
 2.3+. 
This
 
moduË
 
´ovides
 
a


4 
u£ful
 
ab¡¿ùiÚ
 
ov”
 
the
 
difã»nûs
 
b‘w“n
 
PythÚ
 
	gv”siÚs
, 
som‘imes
 
by


5 
´eã¼šg
 
a
 
Ãw”
 
	gidiom
, 
som‘imes
 
ª
 
Şd”
 
	gÚe
, 
ªd
 som‘ime ¨
cu¡om
 one.

7 
In
 
	g·¹icuÏr
, 
	gPythÚ
 2 
u£s
 
¡r
 
	gªd
 '' 
by‹
 
	g¡ršgs
, Python 3

8 
u£s
 
¡r
 
	gªd
 '' 
unicode
 
	g¡ršgs
. 
We
 
wl
 
ÿÎ
 
—ch
 
of
 
the£
 
	gthe
 'native

9 
	g¡ršg
'ype forƒach version. Because ofhis major difference,his module

10 
´ovides
 
	gÃw
 'by‹¡r', 'unicode¡r', 
	gªd
 'Çtive¡r' 
	g©Œibu‹s
, 
as
 
w–l
‡s

11 
two
 
	gfunùiÚs
: 'Áob', 
which
 
Œª¦©es
 
Çtive
 
¡ršgs
 (
of
 
ty³
 '¡r'è
što


12 
by‹
 
¡ršgs
 
»g¬dËss
 
of
 
PythÚ
 
	gv”siÚ
, 
	gªd
 'Áou', 
which
 
Œª¦©es
 
Çtive


13 
¡ršgs
 
to
 
unicode
 
	g¡ršgs
. 
This
 
®so
 
´ovides
 
	ga
 'By‹sIO' 
Çme
 
d—lšg


14 
¥ecifiÿÎy
 
w™h
 
	gby‹s
, 
ªd
 
	ga
 'SŒšgIO' 
Çme
 
d—lšg
 w™h 
Çtive
 
	g¡ršgs
.

15 
It
 
®so
 
´ovides
 
	ga
 'ba£64_decode' 
funùiÚ
 
w™h
 
Çtive
 
¡ršgs
 
as
 
šput
 
ªd


16 
	gouut
.

18 
impÜt
 
os


19 
impÜt
 
»


20 
impÜt
 
sys


21 
impÜt
 
th»adšg


23 
	gsys
.
	gv”siÚ_šfo
 >= (3, 0):

24 
py3k
 = 
True


25 
by‹¡r
 = 
by‹s


26 
unicode¡r
 = 
¡r


27 
Çtive¡r
 = 
unicode¡r


28 
ba£¡ršg
 = (
by‹s
, 
	g¡r
)

29 
def
 
Áob
(
n
, 
’codšg
='ISO-8859-1'):

31 
	$as£¹_Çtive
(
n
)

32 #IÀ
PythÚ
 3, 
the
 
Çtive
 
¡ršg
 
ty³
 
is
 
unicode


33  
n
.
	$’code
(
’codšg
)

34 
def
 
	`Áou
(
n
, 
’codšg
='ISO-8859-1'):

36 
	$as£¹_Çtive
(
n
)

37 #IÀ
PythÚ
 3, 
the
 
Çtive
 
¡ršg
 
ty³
 
is
 
unicode


38  
n


39 
def
 
	`tÚ©ive
(
n
, 
’codšg
='ISO-8859-1'):

41 #IÀ
PythÚ
 3, 
the
 
Çtive
 
¡ršg
 
ty³
 
is
 
unicode


42 
	$isš¡ªû
(
n
, 
by‹s
):

43  
n
.
	$decode
(
’codšg
)

44  
n


46 
äom
 
io
 
impÜt
 
SŒšgIO


48 
äom
 
io
 
impÜt
 
By‹sIO
 
as
 BytesIO

51 
py3k
 = 
F®£


52 
by‹¡r
 = 
¡r


53 
unicode¡r
 = 
unicode


54 
Çtive¡r
 = 
by‹¡r


55 
ba£¡ršg
 = basestring

56 
def
 
	`Áob
(
n
, 
’codšg
='ISO-8859-1'):

58 
	$as£¹_Çtive
(
n
)

59 #IÀ
PythÚ
 2, 
the
 
Çtive
 
¡ršg
 
ty³
 
is
 
by‹s
. 
Assume
 
™
's‡lready

60 #š 
the
 
giv’
 
’codšg
, 
which
 
ISO
-8859-1 
is
 
®mo¡
 
®ways
 
wh©


61 #wa 
š‹nded
.

62  
n


63 
def
 
	`Áou
(
n
, 
’codšg
='ISO-8859-1'):

65 
	$as£¹_Çtive
(
n
)

66 #IÀ
PythÚ
 2, 
the
 
Çtive
 
¡ršg
 
ty³
 
is
 
by‹s
.

67 #Fœ¡, 
check
 
the
 
¥ecŸl
 
’codšg
 'esÿ³'. 
The
 
‹¡
 
su™e
 
u£s
 
this


68 #tØ
sigÇl
 
th©
 
™
 
wªts
 
to
 
·ss
 
a
 
¡ršg
 
w™h
 
embedded
 \
uXXXX
 
esÿ³s
,

69 #buˆ
w™hout
 
havšg
 
to
 
´efix
 
™
 
w™h
 
u
'' 
PythÚ
 2, 
but
 
no
…refix

70 #fÜ 
PythÚ
 3.

71 
’codšg
 == 'escape':

72  
	`unicode
(

73 
»
.
	`sub
(
r
'\\u([0-9a-zA-Z]{4})',

74 
Ïmbda
 
m
: 
	`unichr
((m.
	`group
(1), 16)),

75 
n
.
	`decode
('ISO-8859-1')))

76 #Assum
™
's‡lready inhe givenƒncoding, which for ISO-8859-1 is‡lmost

77 #®way 
wh©
 
was
 
š‹nded
.

78  
n
.
	$decode
(
’codšg
)

79 
def
 
	`tÚ©ive
(
n
, 
’codšg
='ISO-8859-1'):

81 #IÀ
PythÚ
 2, 
the
 
Çtive
 
¡ršg
 
ty³
 
is
 
by‹s
.

82 
	$isš¡ªû
(
n
, 
unicode
):

83  
n
.
	$’code
(
’codšg
)

84  
n


85 
Œy
:

87 
äom
 
cSŒšgIO
 
impÜt
 
SŒšgIO


88 
exû±
 
ImpÜtE¼Ü
:

90 
äom
 
SŒšgIO
 
impÜt
 StringIO

92 
By‹sIO
 = 
SŒšgIO


94 
def
 
	$as£¹_Çtive
(
n
):

95 
nÙ
 
	$isš¡ªû
(
n
, 
Çtive¡r
):

96 
¿i£
 
	`Ty³E¼Ü
("Àmu¡ b¨Çtiv¡¸(gÙ %s)" % 
	`ty³
(
n
).
__Çme__
)

98 
Œy
:

99 
£t
 = set

100 
exû±
 
NameE¼Ü
:

101 
äom
 
£ts
 
impÜt
 
S‘
 
as
 
£t


103 
Œy
:

105 
äom
 
ba£64
 
impÜt
 
decodeby‹s
 
as
 
_ba£64_decodeby‹s


106 
exû±
 
ImpÜtE¼Ü
:

108 #sšû 
Ch”ryPy
 
şaims
 
com·b™y
 
w™h
 
PythÚ
 2.3, 
we
 
mu¡
 
u£


109 #th
Ëgacy
 
API
 
of
 
ba£64


110 
äom
 
ba£64
 
impÜt
 
decode¡ršg
 
as
 
_ba£64_decodeby‹s


112 
def
 
	`ba£64_decode
(
n
, 
’codšg
='ISO-8859-1'):

114 
	$isš¡ªû
(
n
, 
unicode¡r
):

115 
b
 = 
n
.
	$’code
(
’codšg
)

117 
b
 = 
n


118 
b
 = 
	$_ba£64_decodeby‹s
(
b
)

119 
Çtive¡r
 
is
 
unicode¡r
:

120  
b
.
	$decode
(
’codšg
)

122  
b


124 
Œy
:

126 
äom
 
hashlib
 
impÜt
 
md5


127 
exû±
 
ImpÜtE¼Ü
:

128 
äom
 
md5
 
impÜt
 
Ãw
 
as
 md5

130 
Œy
:

132 
äom
 
hashlib
 
impÜt
 
sha1
 
as
 
sha


133 
exû±
 
ImpÜtE¼Ü
:

134 
äom
 
sha
 
impÜt
 
Ãw
 
as
 sha

136 
Œy
:

137 
sÜ‹d
 = sorted

138 
exû±
 
NameE¼Ü
:

139 
def
 
	$sÜ‹d
(
i
):

140 
i
 = i[:]

141 
i
.
	$sÜt
()

142  
i


144 
Œy
:

145 
»v”£d
 =„eversed

146 
exû±
 
NameE¼Ü
:

147 
def
 
	$»v”£d
(
x
):

148 
i
 = 
	$Ën
(
x
)

149 
i
 > 0:

150 
i
 -= 1

151 
y›ld
 
x
[
i
]

153 
Œy
:

155 
äom
 
u¾lib
.
·r£
 
impÜt
 
u¾još
, 
u¾’code


156 
äom
 
u¾lib
.
·r£
 
impÜt
 
quÙe
, 
quÙe_¶us


157 
äom
 
u¾lib
.
»que¡
 
impÜt
 
unquÙe
, 
u¾İ’


158 
äom
 
u¾lib
.
»que¡
 
impÜt
 
·r£_h‰p_li¡
, 
·r£_keqv_li¡


159 
exû±
 
ImpÜtE¼Ü
:

161 
äom
 
u¾·r£
 
impÜt
 
u¾još


162 
äom
 
u¾lib
 
impÜt
 
u¾’code
, 
u¾İ’


163 
äom
 
u¾lib
 
impÜt
 
quÙe
, 
quÙe_¶us


164 
äom
 
u¾lib
 
impÜt
 
unquÙe


165 
äom
 
u¾lib2
 
impÜt
 
·r£_h‰p_li¡
, 
·r£_keqv_li¡


167 
Œy
:

168 
äom
 
th»adšg
 
impÜt
 
loÿl
 
as
 
th»adloÿl


169 
exû±
 
ImpÜtE¼Ü
:

170 
äom
 
ch”rypy
.
_ıth»adšgloÿl
 
impÜt
 
loÿl
 
as
 
th»adloÿl


172 
Œy
:

173 
diù
.
™”™ems


175 
™”™ems
 = 
Ïmbda
 
d
: d.
	$™”™ems
()

176 
cİy™ems
 = 
Ïmbda
 
d
: d.
	$™ems
()

177 
exû±
 
A‰ribu‹E¼Ü
:

179 
™”™ems
 = 
Ïmbda
 
d
: d.
	$™ems
()

180 
cİy™ems
 = 
Ïmbda
 
d
: 
	`li¡
(d.
	$™ems
())

182 
Œy
:

183 
diù
.
™”keys


185 
™”keys
 = 
Ïmbda
 
d
: d.
	$™”keys
()

186 
cİykeys
 = 
Ïmbda
 
d
: d.
	$keys
()

187 
exû±
 
A‰ribu‹E¼Ü
:

189 
™”keys
 = 
Ïmbda
 
d
: d.
	$keys
()

190 
cİykeys
 = 
Ïmbda
 
d
: 
	`li¡
(d.
	$keys
())

192 
Œy
:

193 
diù
.
™”v®ues


195 
™”v®ues
 = 
Ïmbda
 
d
: d.
	$™”v®ues
()

196 
cİyv®ues
 = 
Ïmbda
 
d
: d.
	$v®ues
()

197 
exû±
 
A‰ribu‹E¼Ü
:

199 
™”v®ues
 = 
Ïmbda
 
d
: d.
	$v®ues
()

200 
cİyv®ues
 = 
Ïmbda
 
d
: 
	`li¡
(d.
	$v®ues
())

202 
Œy
:

204 
impÜt
 
butšs


205 
exû±
 
ImpÜtE¼Ü
:

207 
impÜt
 
__butš__
 
as
 
butšs


209 
Œy
:

210 #PythÚ 2. 
We
 
Œy
 
PythÚ
 2 
fœ¡
 
ş›Ás
 
Ú
 Python 2

211 #dÚ'ˆŒyØimpÜˆth'
h‰p
' module from cherrypy.lib

212 
äom
 
Cook›
 
impÜt
 
Sim¶eCook›
, 
Cook›E¼Ü


213 
äom
 
h‰¶ib
 
impÜt
 
BadStusLše
, 
HTTPCÚÃùiÚ
, 
Incom¶‘eR—d
, 
NÙCÚÃùed


214 
äom
 
Ba£HTTPS”v”
 
impÜt
 
Ba£HTTPReque¡HªdËr


215 
exû±
 
ImpÜtE¼Ü
:

217 
äom
 
h‰p
.
cook›s
 
impÜt
 
Sim¶eCook›
, 
Cook›E¼Ü


218 
äom
 
h‰p
.
ş›Á
 
impÜt
 
BadStusLše
, 
HTTPCÚÃùiÚ
, 
Incom¶‘eR—d
, 
NÙCÚÃùed


219 
äom
 
h‰p
.
£rv”
 
impÜt
 
Ba£HTTPReque¡HªdËr


221 #Som
¶©fÜms
 
dÚ
'tƒxpose HTTPSConnection, so handle it separately

222 
py3k
:

223 
Œy
:

224 
äom
 
h‰p
.
ş›Á
 
impÜt
 
HTTPSCÚÃùiÚ


225 
exû±
 
ImpÜtE¼Ü
:

226 #Som
¶©fÜms
 
which
 
dÚ
'ˆhavSSL dÚ'
t
 
expo£
 
HTTPSCÚÃùiÚ


227 
HTTPSCÚÃùiÚ
 = 
NÚe


229 
Œy
:

230 
äom
 
h‰¶ib
 
impÜt
 
HTTPSCÚÃùiÚ


231 
exû±
 
ImpÜtE¼Ü
:

232 
HTTPSCÚÃùiÚ
 = 
NÚe


234 
Œy
:

236 
x¿nge
 = xrange

237 
exû±
 
NameE¼Ü
:

239 
x¿nge
 = 
¿nge


241 
impÜt
 
th»adšg


242 
	`ha§‰r
(
th»adšg
.
Th»ad
, "daemon"):

244 
def
 
	$g‘_d«mÚ
(
t
):

245  
t
.
d«mÚ


246 
def
 
	$£t_d«mÚ
(
t
, 
v®
):

247 
t
.
d«mÚ
 = 
v®


249 
def
 
	$g‘_d«mÚ
(
t
):

250  
t
.
	$isD«mÚ
()

251 
def
 
	$£t_d«mÚ
(
t
, 
v®
):

252 
t
.
	$£tD«mÚ
(
v®
)

254 
Œy
:

255 
äom
 
ema
.
uts
 
impÜt
 
fÜm©d©e


256 
def
 
	$HTTPD©e
(
timev®
=
NÚe
):

257  
	$fÜm©d©e
(
timev®
, 
u£gmt
=
True
)

258 
exû±
 
ImpÜtE¼Ü
:

259 
äom
 
rfc822
 
impÜt
 
fÜm©d©e
 
as
 
HTTPD©e


261 
Œy
:

263 
äom
 
u¾lib
.
·r£
 
impÜt
 
unquÙe
 
as
 
·r£_unquÙe


264 
def
 
	`unquÙe_qs
(
©om
, 
’codšg
, 
”rÜs
='strict'):

265  
	`·r£_unquÙe
(
©om
.
	`»¶aû
('+', ' '), 
’codšg
óncodšg, 
”rÜs
=errors)

266 
exû±
 
ImpÜtE¼Ü
:

268 
äom
 
u¾lib
 
impÜt
 
unquÙe
 
as
 
·r£_unquÙe


269 
def
 
	`unquÙe_qs
(
©om
, 
’codšg
, 
”rÜs
='strict'):

270  
	`·r£_unquÙe
(
©om
.
	`»¶aû
('+', ' ')).
	$decode
(
’codšg
, 
”rÜs
)

272 
Œy
:

273 #P»ã¸
sim¶ejsÚ
, 
which
 
is
 
usu®ly
 
mÜe
 
advªûd
 
thª
 
the
 
butš
 
moduË
.

274 
impÜt
 
sim¶ejsÚ
 
as
 
jsÚ


275 
jsÚ_decode
 = 
jsÚ
.
	`JSONDecod”
().
decode


276 
jsÚ_’code
 = 
jsÚ
.
	`JSONEncod”
().
™”’code


277 
exû±
 
ImpÜtE¼Ü
:

278 
py3k
:

279 #PythÚ 3.0: 
jsÚ
 
is
 
·¹
 
of
 
the
 
¡ªd¬d
 
lib¿ry
,

280 #buˆ
ouuts
 
unicode
. 
We
 
Ãed
 
by‹s
.

281 
impÜt
 
jsÚ


282 
jsÚ_decode
 = 
jsÚ
.
	`JSONDecod”
().
decode


283 
_jsÚ_’code
 = 
jsÚ
.
	`JSONEncod”
().
™”’code


284 
def
 
	$jsÚ_’code
(
v®ue
):

285 
chunk
 
š
 
	$_jsÚ_’code
(
v®ue
):

286 
y›ld
 
chunk
.
	`’code
('utf8')

287 
–if
 
sys
.
v”siÚ_šfo
 >= (2, 6):

288 #PythÚ 2.6: 
jsÚ
 
is
 
·¹
 
of
 
the
 
¡ªd¬d
 
lib¿ry


289 
impÜt
 
jsÚ


290 
jsÚ_decode
 = 
jsÚ
.
	`JSONDecod”
().
decode


291 
jsÚ_’code
 = 
jsÚ
.
	`JSONEncod”
().
™”’code


293 
jsÚ
 = 
NÚe


294 
def
 
	$jsÚ_decode
(
s
):

295 
¿i£
 
	`V®ueE¼Ü
('No JSON†ibrary is‡vailable')

296 
def
 
	$jsÚ_’code
(
s
):

297 
¿i£
 
	`V®ueE¼Ü
('No JSON†ibrary is‡vailable')

299 
Œy
:

300 
impÜt
 
cPickË
 
as
 
pickË


301 
exû±
 
ImpÜtE¼Ü
:

302 #IÀ
PythÚ
 2, 
pickË
 
is
 
a
 PythÚ 
v”siÚ
.

303 #IÀ
PythÚ
 3, 
pickË
 
is
 
the
 
¥ed
-
up
 
C
 
v”siÚ
.

304 
impÜt
 
pickË


306 
Œy
:

307 
os
.
	$u¿ndom
(20)

308 
impÜt
 
bšascii


309 
def
 
	$¿ndom20
():

310  
bšascii
.
	`hexlify
(
os
.
	`u¿ndom
(20)).
	`decode
('ascii')

311 
	$exû±
 (
A‰ribu‹E¼Ü
, 
NÙIm¶em’‹dE¼Ü
):

312 
impÜt
 
¿ndom


313 #os.
u¿ndom
 
nÙ
 
avaabË
 
uÁ
 
PythÚ
 2.4. 
F®l
 
back
 
to
 
¿ndom
.random.

314 
def
 
	$¿ndom20
():

315  
	`sha
('%s' % 
¿ndom
.
	`¿ndom
()).
	$hexdige¡
()

317 
Œy
:

318 
äom
 
_th»ad
 
impÜt
 
g‘_id’t
 
as
 
g‘_th»ad_id’t


319 
exû±
 
ImpÜtE¼Ü
:

320 
äom
 
th»ad
 
impÜt
 
g‘_id’t
 
as
 
g‘_th»ad_id’t


322 
Œy
:

324 
Ãxt
 =‚ext

325 
exû±
 
NameE¼Ü
:

327 
def
 
	$Ãxt
(
i
):

328  
i
.
	$Ãxt
()

330 
sys
.
v”siÚ_šfo
 >= (3,3):

331 
Tim”
 = 
th»adšg
.Timer

332 
Ev’t
 = 
th»adšg
.Event

334 #PythÚ 3.2 
ªd
 
—¾›r


335 
Tim”
 = 
th»adšg
.
_Tim”


336 
Ev’t
 = 
th»adšg
.
_Ev’t


338 #PriÜ 
to
 
PythÚ
 2.6, 
the
 
Th»ad
 
şass
 
did
 
nÙ
 
have
 
a
 .
d«mÚ
 
´İ”ty
.

339 #Thi 
mix
-
š
 
adds
 
th©
 
´İ”ty
.

340 
şass
 
S‘D«mÚPrİ”ty
:

341 
def
 
	$__g‘_d«mÚ
(
£lf
):

342  
£lf
.
	$isD«mÚ
()

343 
def
 
	$__£t_d«mÚ
(
£lf
, 
d«mÚ
):

344 
£lf
.
	$£tD«mÚ
(
d«mÚ
)

346 
sys
.
v”siÚ_šfo
 < (2,6):

347 
d«mÚ
 = 
	$´İ”ty
(
__g‘_d«mÚ
, 
__£t_d«mÚ
)

349 #U£ 
sub´oûss
 
moduË
 
äom
 
PythÚ
 2.7 
Ú
 Python 2.3-2.6

350 
sys
.
v”siÚ_šfo
 < (2,7):

351 
impÜt
 
ch”rypy
.
_ıcom·t_sub´oûss
 
as
 
sub´oûss


353 
impÜt
 
sub´oûss


	@trunk/objs/CherryPy-3.2.4/cherrypy/_cpcompat_subprocess.py

1 #sub´oûs - 
Sub´oûs£s
 
w™h
 
acûssibË
 
I
/
O
 
¡»ams


2 #
#FÜ 
mÜe
 
šfÜm©iÚ
 
about
 
this
 
moduË
, 
£e
 
PEP
 324.

3 #
#Thi 
moduË
 
should
 
»maš
 
com·tibË
 
w™h
 
PythÚ
 2.2, 
£e
 
PEP
 291.

4 #
#Cİyrighˆ(
c
è2003-2005 
by
 
P‘”
 
A¡¿nd
 <
a¡¿nd
@
ly§tÜ
.
liu
.
£
>

5 #
#Liûn£d 
to
 
PSF
 
und”
 
a
 
CÚŒibutÜ
 
Ag»em’t
.

6 #S“ 
h‰p
:

8 
	gr
"""subprocess - Subprocesses with‡ccessible I/O streams

10 
This
 
moduË
 
®lows
 
you
 
to
 
¥awn
 
	g´oûs£s
, 
cÚÃù
Ø
theœ


11 
	gšput
/
	gouut
/
”rÜ
 
	gpes
, 
ªd
 
obš
 
theœ
  
	gcodes
. 
This
 
moduË


12 
š‹nds
 
to
 
»¶aû
 
£v”®
 
	gÙh”
, 
Şd”
 
moduËs
 
ªd
 
	gfunùiÚs
, 
	glike
:

14 
os
.
sy¡em


15 
os
.
¥awn
*

16 
os
.
pİ’
*

17 
pİ’2
.*

18 
commªds
.*

20 
InfÜm©iÚ
 
about
 
how
 
the
 
sub´oûss
 
moduË
 
ÿn
 
be
 
u£d
 
to
 
»¶aû
 
the£


21 
moduËs
 
ªd
 
funùiÚs
 
ÿn
 
be
 
found
 
b–ow
.

25 
Usšg
 
the
 
sub´oûss
 
moduË


27 
This
 
moduË
 
defšes
 
Úe
 
şass
 
ÿÎed
 
Pİ’
:

29 
şass
 
	$Pİ’
(
¬gs
, 
bufsize
=0, 
execubË
=
NÚe
,

30 
¡dš
=
NÚe
, 
¡dout
=NÚe, 
¡d”r
=None,

31 
´“xec_â
=
NÚe
, 
şo£_fds
=
F®£
, 
sh–l
=False,

32 
cwd
=
NÚe
, 
’v
=NÚe, 
univ”§l_Ãwlšes
=
F®£
,

33 
¡¬tupšfo
=
NÚe
, 
ü—tiÚæags
=0):

36 
Argum’ts
 
¬e
:

38 
¬gs
 
should
 
be
 
a
 
¡ršg
, 
Ü
‡ 
£qu’û
 
of
 
´og¿m
 
¬gum’ts
. 
The


39 
´og¿m
 
to
 
execu‹
 
is
 
nÜm®ly
 
the
 
fœ¡
 
™em
 
š
h
¬gs
 
£qu’û
 
Ü


40 
¡ršg
, 
but
 
ÿn
 
be
 
ex¶ic™ly
 
£t
 
by
 
usšg
 
the
 
execubË
 
¬gum’t
.

42 
On
 
UNIX
, 
w™h
 
sh–l
=
	$F®£
 (): 
In
 
this
 , 
the
 
Pİ’
 
şass


43 
u£s
 
os
.
	$execvp
(è
to
 
execu‹
 
the
 
chd
 
´og¿m
. 
¬gs
 
should
 
nÜm®ly


44 
be
 
a
 
£qu’û
. 
A
 
¡ršg
 
wl
 b
Œ—‹d
 
as
‡ sequ’û 
w™h
 
the
 string

45 
as
 
the
 
Úly
 
	`™em
 (th
´og¿m
 
to
 
execu‹
).

47 
On
 
UNIX
, 
w™h
 
sh–l
=
True
: 
If
 
¬gs
 
is
 
a
 
¡ršg
, 
™
 
¥ecif›s
 
the


48 
commªd
 
¡ršg
 
to
 
execu‹
 
through
 
the
 
sh–l
. 
If
 
¬gs
 
is
 
a
 
£qu’û
,

49 
the
 
fœ¡
 
™em
 
¥ecif›s
h
commªd
 
¡ršg
, 
ªd
 
ªy
 
add™iÚ®
 
™ems


50 
wl
 
be
 
Œ—‹d
 
as
 
add™iÚ®
 
sh–l
 
¬gum’ts
.

52 
On
 
Wšdows
: 
the
 
Pİ’
 
şass
 
u£s
 
	$C»©eProûss
(è
to
 
execu‹
 
the
 
chd


53 
´og¿m
, 
which
 
İ”©es
 
Ú
 
¡ršgs
. 
If
 
¬gs
 
is
 
a
 
£qu’û
, 
™
 
wl
 
be


54 
cÚv”‹d
 
to
 
a
 
¡ršg
 
usšg
 
the
 
li¡2cmdlše
 
m‘hod
. 
PËa£
 
nÙe
 
th©


55 
nÙ
 
®l
 
MS
 
Wšdows
 
­¶iÿtiÚs
 
š‹½»t
 
the
 
commªd
 
lše
h
§me


56 
way
: 
The
 
li¡2cmdlše
 
is
 
desigÃd
 
­¶iÿtiÚs
 
usšg
 
the
 
§me


57 
ruËs
 
as
 
the
 
MS
 
C
 
ruÁime
.

59 
bufsize
, 
giv’
, 
has
 
the
 
§me
 
m—nšg
 
as
h
cÜ»¥Údšg
 
¬gum’t


60 
to
 
the
 
but
-
š
 
	$İ’
(è
funùiÚ
: 0 
m—ns
 
unbufã»d
, 1 m—n 
lše


61 
bufã»d
, 
ªy
 
Ùh”
 
pos™ive
 
v®ue
 
m—ns
 
u£
 
a
 
bufãr
 
of


62 (
­´oxim©–y
è
th©
 
size
. 
A
 
Ãg©ive
 
bufsize
 
m—ns
 
to
 
u£
 
the
 
sy¡em


63 , 
which
 
usu®ly
 
m—ns
 
fuÎy
 
bufã»d
. 
The
  
v®ue
 

64 
bufsize
 
is
 0 (
unbufã»d
).

66 
¡dš
, 
¡dout
 
ªd
 
¡d”r
 
¥ecify
 
the
 
execu‹d
 
´og¿ms
' standard

67 
šput
, 
¡ªd¬d
 
ouut
 
ªd
 snd¬d 
”rÜ
 
fe
 
hªdËs
, 
»¥eùiv–y
.

68 
V®id
 
v®ues
 
¬e
 
PIPE
, 
ª
 
exi¡šg
 
fe
 
	`desütÜ
 (
a
 
pos™ive


69 
š‹g”
), 
ª
 
exi¡šg
 
fe
 
objeù
, 
ªd
 
NÚe
. 
PIPE
 
šdiÿ‹s
 
th©
 
a


70 
Ãw
 
pe
 
to
 
the
 
chd
 
should
 
be
 
ü—‹d
. 
W™h
 
NÚe
, 
no
 
»dœeùiÚ


71 
wl
 
occur
; 
the
 
chd
's file handles will be inherited fromhe

72 
·»Á
. 
Add™iÚ®ly
, 
¡d”r
 
ÿn
 
be
 
STDOUT
, 
which
 
šdiÿ‹s
 
th©
 
the


73 
¡d”r
 
d©a
 
äom
 
the
 
­¶iÿtiÚs
 
should
 
be
 
ÿ±u»d
 
što
h
§me


74 
fe
 
hªdË
 
as
 
¡dout
.

76 
If
 
´“xec_â
 
is
 
£t
 
to
 
a
 
ÿÎabË
 
objeù
, 
this
 objeù 
wl
 
be
 
ÿÎed


77 
š
 
the
 
chd
 
´oûss
 
ju¡
 
befÜe
hchd 
is
 
execu‹d
.

79 
If
 
şo£_fds
 
is
 
Œue
, 
®l
 
fe
 
desütÜs
 
exû±
 0, 1 
ªd
 2 
wl
 
be


80 
şo£d
 
befÜe
 
the
 
chd
 
´oûss
 
is
 
execu‹d
.

82 
sh–l
 
is
 
Œue
, 
the
 
¥ecif›d
 
commªd
 
wl
 
be
 
execu‹d
 
through
he

83 
sh–l
.

85 
If
 
cwd
 
is
 
nÙ
 
NÚe
, 
the
 
cu¼’t
 
dœeùÜy
 
wl
 
be
 
chªged
 
to
 cwd

86 
befÜe
 
the
 
chd
 
is
 
execu‹d
.

88 
If
 
’v
 
is
 
nÙ
 
NÚe
, 
™
 
defšes
 
the
 
’vœÚm’t
 
v¬ŸbËs
 th
Ãw


89 
´oûss
.

91 
If
 
univ”§l_Ãwlšes
 
is
 
Œue
, 
the
 
fe
 
objeùs
 
¡dout
 
ªd
 
¡d”r
 
¬e


92 
İ’ed
 
as
 
a
 
‹xt
 
fes
, 
but
 
lšes
 
may
 
be
 
‹rmš©ed
 
by
 
ªy
 
of
 '\n',

93 
the
 
Unix
 
’d
-
of
-
lše
 
cÚv’tiÚ
, '\r',h
Macštosh
 cÚv’tiÚ 
Ü


94 '\r\n', 
the
 
Wšdows
 
cÚv’tiÚ
. 
AÎ
 
of
 
the£
 
ex‹º®
 
»´e£Á©iÚs


95 
¬e
 
£’
 
as
 '\n' 
by
 
the
 
PythÚ
 
´og¿m
. 
NÙe
: 
This
 
ã©u»
 
is
 
Úly


96 
avaabË
 
PythÚ
 
is
 
but
 
w™h
 
univ”§l
 
Ãwlše
 
	`suµÜt
 (
the


97 ). 
Also
, 
the
 
Ãwlšes
 
©Œibu‹
 
of
h
fe
 
objeùs
 
¡dout
,

98 
¡dš
 
ªd
 
¡d”r
 
¬e
 
nÙ
 
upd©ed
 
by
 
the
 
	$communiÿ‹
(è
m‘hod
.

100 
The
 
¡¬tupšfo
 
ªd
 
ü—tiÚæags
, 
giv’
, 
wl
 
be
 
·s£d
 
to
 
the


101 
und”lyšg
 
	$C»©eProûss
(è
funùiÚ
. 
They
 
ÿn
 
¥ecify
 
thšgs
 
such
 
as


102 
­³¬ªû
 
of
 
the
 
maš
 
wšdow
 
ªd
 
´iÜ™y
 th
Ãw
 
´oûss
.

103 (
Wšdows
 
Úly
)

106 
This
 
moduË
 
®so
 
defšes
 
some
 
shÜtcut
 
funùiÚs
:

108 
	$ÿÎ
(*
pİ’¬gs
, **
kw¬gs
):

109 
Run
 
commªd
 
w™h
 
¬gum’ts
. 
Wa™
 commªd 
to
 
com¶‘e
, 
th’


110  
the
 
»tuºcode
 
©Œibu‹
.

112 
The
 
¬gum’ts
 
¬e
 
the
 
§me
 
as
 th
Pİ’
 
cÚ¡ruùÜ
. 
Exam¶e
:

114 
»tcode
 = 
	`ÿÎ
(["ls", "-l"])

116 
	$check_ÿÎ
(*
pİ’¬gs
, **
kw¬gs
):

117 
Run
 
commªd
 
w™h
 
¬gum’ts
. 
Wa™
 commªd 
to
 
com¶‘e
. 
If
 
the


118 
ex™
 
code
 
was
 
z”o
 
th’
 , 
Ùh”wi£
 
¿i£


119 
C®ËdProûssE¼Ü
. 
The
 C®ËdProûssE¼Ü 
objeù
 
wl
 
have
 
the


120  
code
 
š
 
the
 
»tuºcode
 
©Œibu‹
.

122 
The
 
¬gum’ts
 
¬e
 
the
 
§me
 
as
 th
Pİ’
 
cÚ¡ruùÜ
. 
Exam¶e
:

124 
	`check_ÿÎ
(["ls", "-l"])

126 
	$check_ouut
(*
pİ’¬gs
, **
kw¬gs
):

127 
Run
 
commªd
 
w™h
 
¬gum’ts
 
ªd
  
™s
 
ouut
 
as
 
a
 
by‹
 
¡ršg
.

129 
If
 
the
 
ex™
 
code
 
was
 
nÚ
-
z”o
 
™
 
¿i£s
 
a
 
C®ËdProûssE¼Ü
. 
The


130 
C®ËdProûssE¼Ü
 
objeù
 
wl
 
have
 
the
  
code
 
š
h
»tuºcode


131 
©Œibu‹
 
ªd
 
ouut
 
š
 
the
 output‡ttribute.

133 
The
 
¬gum’ts
 
¬e
 
the
 
§me
 
as
 th
Pİ’
 
cÚ¡ruùÜ
. 
Exam¶e
:

135 
ouut
 = 
	`check_ouut
(["ls", "-l", "/dev/null"])

138 
Exû±iÚs


140 
Exû±iÚs
 
¿i£d
 
š
 
the
 
chd
 
´oûss
, 
befÜe
h
Ãw
 
´og¿m
 
has


141 
¡¬‹d
 
to
 
execu‹
, 
wl
 
be
 
»
-
¿i£d
 
š
 
the
 
·»Á
. 
Add™iÚ®ly
,

142 
the
 
exû±iÚ
 
objeù
 
wl
 
have
 
Úe
 
exŒa
 
©Œibu‹
 
ÿÎed


143 'chd_Œaûback', 
which
 
is
 
a
 
¡ršg
 
cÚššg
 
Œaûback
 
šfÜm©iÚ


144 
äom
 
the
 
chds
 
pošt
 
of
 
v›w
.

146 
The
 
mo¡
 
commÚ
 
exû±iÚ
 
¿i£d
 
is
 
OSE¼Ü
. 
This
 
occurs
, 

147 
exam¶e
, 
wh’
 
Œyšg
 
to
 
execu‹
 
a
 
nÚ
-
exi¡’t
 
fe
. 
AµliÿtiÚs


148 
should
 
´•¬e
 
OSE¼Üs
.

150 
A
 
V®ueE¼Ü
 
wl
 
be
 
¿i£d
 
Pİ’
 
is
 
ÿÎed
 
w™h
 
šv®id
 
¬gum’ts
.

152 
	$check_ÿÎ
(è
ªd
 
	$check_ouut
(è
wl
 
¿i£
 
C®ËdProûssE¼Ü
, 
the


153 
ÿÎed
 
´oûss
 
»tuºs
 
a
 
nÚ
-
z”o
  
code
.

156 
Secur™y


158 
UÆike
 
some
 
Ùh”
 
pİ’
 
funùiÚs
, 
this
 
im¶em’tiÚ
 
wl
 
Ãv”
 
ÿÎ


159 /
bš
/
sh
 
im¶ic™ly
. 
This
 
m—ns
 
th©
 
®l
 
ch¬aù”s
, 
šşudšg
 
sh–l


160 
m‘ach¬aù”s
, 
ÿn
 
§ãly
 
be
 
·s£d
 
to
 
chd
 
´oûs£s
.

163 
Pİ’
 
objeùs


165 
In¡ªûs
 
of
 
the
 
Pİ’
 
şass
 
have
h
fŞlowšg
 
m‘hods
:

167 
	$pŞl
()

168 
Check
 
chd
 
´oûss
 
has
 
‹rmš©ed
. 
R‘uºs
 
»tuºcode


169 
©Œibu‹
.

171 
	$wa™
()

172 
Wa™
 
chd
 
´oûss
 
to
 
‹rmš©e
. 
R‘uºs
 
»tuºcode
 
©Œibu‹
.

174 
	$communiÿ‹
(
šput
=
NÚe
)

175 
IÁ”aù
 
w™h
 
´oûss
: 
S’d
 
d©a
 
to
 
¡dš
. 
R—d
 d©¨
äom
 
¡dout


176 
ªd
 
¡d”r
, 
uÁ
 
’d
-
of
-
fe
 
is
 
»ached
. 
Wa™
 
´oûss
 
to


177 
‹rmš©e
. 
The
 
İtiÚ®
 
šput
 
¬gum’t
 
should
 
be
 
a
 
¡ršg
 
to
 be

178 
£Á
 
to
 
the
 
chd
 
´oûss
, 
Ü
 
NÚe
, 
no
 
d©a
 
should
 
be
 sento

179 
the
 
chd
.

181 
	$communiÿ‹
(è
»tuºs
 
a
 
	`tu¶e
 (
¡dout
, 
¡d”r
).

183 
NÙe
: 
The
 
d©a
 
»ad
 
is
 
bufã»d
 
š
 
memÜy
, 
so
 dØ
nÙ
 
u£
 
this


184 
m‘hod
 
the
 
d©a
 
size
 
is
 
Ïrge
 
Ü
 
uÆim™ed
.

186 
The
 
fŞlowšg
 
©Œibu‹s
 
¬e
 
®so
 
avaabË
:

188 
¡dš


189 
If
 
the
 
¡dš
 
¬gum’t
 
is
 
PIPE
, 
this
 
©Œibu‹
 i 
a
 
fe
 
objeù


190 
th©
 
´ovides
 
šput
 
to
 
the
 
chd
 
´oûss
. 
Oth”wi£
, 
™
 
is
 
NÚe
.

192 
¡dout


193 
If
 
the
 
¡dout
 
¬gum’t
 
is
 
PIPE
, 
this
 
©Œibu‹
 i 
a
 
fe
 
objeù


194 
th©
 
´ovides
 
ouut
 
äom
 
the
 
chd
 
´oûss
. 
Oth”wi£
, 
™
 
is


195 
NÚe
.

197 
¡d”r


198 
If
 
the
 
¡d”r
 
¬gum’t
 
is
 
PIPE
, 
this
 
©Œibu‹
 i 
fe
 
objeù
 
th©


199 
´ovides
 
”rÜ
 
ouut
 
äom
 
the
 
chd
 
´oûss
. 
Oth”wi£
, 
™
 
is


200 
NÚe
.

202 
pid


203 
The
 
´oûss
 
ID
 
of
 
the
 
chd
…rocess.

205 
»tuºcode


206 
The
 
chd
  
code
. 
A
 
NÚe
 
v®ue
 
šdiÿ‹s
 
th©
 
the
 
´oûss


207 
ha¢
'terminated yet. A‚egative value -N indicateshathe

208 
chd
 
was
 
‹rmš©ed
 
by
 
sigÇl
 
	`N
 (
UNIX
 
Úly
).

211 
R•Ïcšg
 
Şd”
 
funùiÚs
 
w™h
 
the
 
sub´oûss
 
moduË


213 
In
 
this
 
£ùiÚ
, "¨==> b" 
m—ns
 
th©
 
b
 
ÿn
 
be
 
u£d
 
as
 
a
 
»¶aûm’t


214 
a
.

216 
NÙe
: 
AÎ
 
funùiÚs
 
š
 
this
 
£ùiÚ
 
	$ç
 (
mÜe
 
Ü
 
Ëss
è
s’y
 

217 
the
 
execu‹d
 
´og¿m
 
ÿÂÙ
 
be
 
found
; 
this
 
moduË
 
¿i£s
 
ª
 
OSE¼Ü


218 
exû±iÚ
.

220 
In
 
the
 
fŞlowšg
 
exam¶es
, 
we
 
assume
 
th©
h
sub´oûss
 
moduË
 
is


221 
impÜ‹d
 
w™h
 "from subprocess import *".

224 
R•Ïcšg
 /
bš
/
sh
 
sh–l
 
backquÙe


226 
ouut
=`
mycmd
 
my¬g
`

228 
ouut
 = 
	`Pİ’
(["mycmd", "my¬g"], 
¡dout
=
PIPE
).
	`communiÿ‹
()[0]

231 
R•Ïcšg
 
sh–l
 
pe
 
lše


233 
ouut
=`
dmesg
 | 
g»p
 
hda
`

235 
p1
 = 
	`Pİ’
(["dmesg"], 
¡dout
=
PIPE
)

236 
p2
 = 
	`Pİ’
(["g»p", "hda"], 
¡dš
=
p1
.
¡dout
, stdout=
PIPE
)

237 
ouut
 = 
p2
.
	`communiÿ‹
()[0]

240 
R•Ïcšg
 
os
.
	`sy¡em
()

242 
¡s
 = 
os
.
	`sy¡em
("mycmd" + " myarg")

244 
p
 = 
	`Pİ’
("mycmd" + " my¬g", 
sh–l
=
True
)

245 
pid
, 
¡s
 = 
os
.
	$wa™pid
(
p
.
pid
, 0)

247 
NÙe
:

249 * 
C®lšg
 
the
 
´og¿m
 
through
h
sh–l
 
is
 
usu®ly
 
nÙ
 
»quœed
.

251 * 
It
'sƒasiero†ook‡the„eturncode‡ttributehanhe

252 
ex™¡©us
.

254 
A
 
mÜe
 
»®
-
wÜld
 
exam¶e
 
would
 
look
 
like
 
this
:

256 
Œy
:

257 
»tcode
 = 
	`ÿÎ
("mycmd" + " my¬g", 
sh–l
=
True
)

258 
»tcode
 < 0:

259 
´št
 >>
sys
.
¡d”r
, "Chd wa ‹rmš©ed by sigÇl", -
»tcode


261 
´št
 >>
sys
.
¡d”r
, "Chd„‘uºed", 
»tcode


262 
exû±
 
OSE¼Ü
, 
e
:

263 
´št
 >>
sys
.
¡d”r
, "ExecutiÚ faed:", 
e


266 
R•Ïcšg
 
os
.
¥awn
*

268 
P_NOWAIT
 
exam¶e
:

270 
pid
 = 
os
.
	`¥awÆp
(os.
P_NOWAIT
, "/bin/mycmd", "mycmd", "myarg")

272 
pid
 = 
	`Pİ’
(["/bin/mycmd", "myarg"]).pid

275 
P_WAIT
 
exam¶e
:

277 
»tcode
 = 
os
.
	`¥awÆp
(os.
P_WAIT
, "/bin/mycmd", "mycmd", "myarg")

279 
»tcode
 = 
	`ÿÎ
(["/bin/mycmd", "myarg"])

282 
VeùÜ
 
exam¶e
:

284 
os
.
	`¥awnvp
(os.
P_NOWAIT
, 
·th
, 
¬gs
)

286 
	`Pİ’
([
·th
] + 
¬gs
[1:])

289 
EnvœÚm’t
 
exam¶e
:

291 
os
.
	`¥awÆ³
(os.
P_NOWAIT
, "/bš/mycmd", "mycmd", "my¬g", 
’v
)

293 
	`Pİ’
(["/bš/mycmd", "my¬g"], 
’v
={"PATH": "/u¤/bš"
	}
})

296 
R•Ïcšg
 
os
.
pİ’
*

298 
pe
 = 
os
.
pİ’
("cmd", 
mode
='r', 
bufsize
)

300 
pe
 = 
Pİ’
("cmd", 
sh–l
=
True
, 
bufsize
=bufsize, 
¡dout
=
PIPE
).stdout

302 
pe
 = 
os
.
pİ’
("cmd", 
mode
='w', 
bufsize
)

304 
pe
 = 
Pİ’
("cmd", 
sh–l
=
True
, 
bufsize
=bufsize, 
¡dš
=
PIPE
).stdin

307 (
chd_¡dš
, 
	gchd_¡dout
èğ
os
.
pİ’2
("cmd", 
mode
, 
bufsize
)

309 
p
 = 
Pİ’
("cmd", 
sh–l
=
True
, 
bufsize
=bufsize,

310 
¡dš
=
PIPE
, 
¡dout
=PIPE, 
şo£_fds
=
True
)

311 (
chd_¡dš
, 
	gchd_¡dout
èğ(
p
.
¡dš
, 
	gp
.
	g¡dout
)

314 (
	gchd_¡dš
,

315 
	gchd_¡dout
,

316 
	gchd_¡d”r
èğ
os
.
pİ’3
("cmd", 
mode
, 
bufsize
)

318 
p
 = 
Pİ’
("cmd", 
sh–l
=
True
, 
bufsize
=bufsize,

319 
¡dš
=
PIPE
, 
¡dout
=PIPE, 
¡d”r
=PIPE, 
şo£_fds
=
True
)

320 (
chd_¡dš
,

321 
	gchd_¡dout
,

322 
	gchd_¡d”r
èğ(
p
.
¡dš
, 
	gp
.
	g¡dout
,….
	g¡d”r
)

325 (
	gchd_¡dš
, 
	gchd_¡dout_ªd_¡d”r
èğ
os
.
pİ’4
("cmd", 
mode
,

326 
bufsize
)

328 
p
 = 
Pİ’
("cmd", 
sh–l
=
True
, 
bufsize
=bufsize,

329 
¡dš
=
PIPE
, 
¡dout
=PIPE, 
¡d”r
=
STDOUT
, 
şo£_fds
=
True
)

330 (
chd_¡dš
, 
	gchd_¡dout_ªd_¡d”r
èğ(
p
.
¡dš
, 
	gp
.
	g¡dout
)

332 
On
 
	gUnix
, 
	gos
.
	gpİ’2
, os.
pİ’3
 
ªd
 os.
pİ’4
 
®so
 
acû±
 
a
 
£qu’û
 
as


333 
the
 
commªd
 
to
 
	gexecu‹
, 
š
 
which
 
¬gum’ts
 
wl
 
be
 
·s£d


334 
dœeùly
 
to
 
the
 
´og¿m
 
w™hout
 
sh–l
 
	gš‹rv’tiÚ
. 
This
 
u§ge
 
ÿn
 
be


335 
»¶aûd
 
as
 
	gfŞlows
:

337 (
chd_¡dš
, 
	gchd_¡dout
èğ
os
.
pİ’2
(["/bš/ls", "-l"], 
mode
,

338 
bufsize
)

340 
p
 = 
Pİ’
(["/bš/ls", "-l"], 
bufsize
=bufsize, 
¡dš
=
PIPE
, 
¡dout
=PIPE)

341 (
chd_¡dš
, 
	gchd_¡dout
èğ(
p
.
¡dš
, 
	gp
.
	g¡dout
)

343 
R‘uº
 
code
 
hªdlšg
 
Œª¦©es
 
as
 
	gfŞlows
:

345 
pe
 = 
os
.
pİ’
("cmd", 'w')

347 
	grc
 = 
pe
.
	$şo£
()

348 
rc
 
is
 
nÙ
 
NÚe
 
ªd
„c % 256:

349 
´št
 "There were someƒrrors"

351 
´oûss
 = 
	`Pİ’
("cmd", 'w', 
sh–l
=
True
, 
¡dš
=
PIPE
)

353 
´oûss
.
¡dš
.
	$şo£
()

354 
´oûss
.
	`wa™
() != 0:

355 
´št
 "There were someƒrrors"

358 
R•Ïcšg
 
pİ’2
.*

360 (
chd_¡dout
, 
chd_¡dš
èğ
pİ’2
.
	`pİ’2
("some¡ršg", 
bufsize
, 
mode
)

362 
p
 = 
	`Pİ’
(["some¡ršg"], 
sh–l
=
True
, 
bufsize
=bufsize

363 
¡dš
=
PIPE
, 
¡dout
=PIPE, 
şo£_fds
=
True
)

364 (
chd_¡dout
, 
chd_¡dš
èğ(
p
.
¡dout
,….
¡dš
)

366 
On
 
Unix
, 
pİ’2
 
®so
 
acû±s
 
a
 
£qu’û
 
as
 
the
 
commªd
 
to
 
execu‹
, 
š


367 
which
 
¬gum’ts
 
wl
 
be
 
·s£d
 
dœeùly
 
to
 
the
 
´og¿m
 
w™hout


368 
sh–l
 
š‹rv’tiÚ
. 
This
 
u§ge
 
ÿn
 
be
 
»¶aûd
 
as
 
fŞlows
:

370 (
chd_¡dout
, 
chd_¡dš
èğ
pİ’2
.
	`pİ’2
(["mycmd", "my¬g"], 
bufsize
,

371 
mode
)

373 
p
 = 
	`Pİ’
(["mycmd", "my¬g"], 
bufsize
=bufsize,

374 
¡dš
=
PIPE
, 
¡dout
=PIPE, 
şo£_fds
=
True
)

375 (
chd_¡dout
, 
chd_¡dš
èğ(
p
.
¡dout
,….
¡dš
)

377 
The
 
pİ’2
.
Pİ’3
 
ªd
…İ’2.
Pİ’4
 
basiÿÎy
 
wÜks
 
as
 
sub´oûss
.
Pİ’
,

378 
exû±
 
th©
:

380 * 
sub´oûss
.
Pİ’
 
¿i£s
 
ª
 
exû±iÚ
 
the
 
executiÚ
 
çs


381 * 
the
 
ÿ±u»¡d”r
 
¬gum’t
 
is
 
»¶aûd
 
w™h
h
¡d”r
‡rgument.

382 * 
¡dš
=
PIPE
 
ªd
 
¡dout
=PIPE 
mu¡
 
be
 
¥ecif›d
.

383 * 
pİ’2
 
şo£s
 
®l
 
fedesütÜs
 
by
 , 
but
 
you
 
have
 
to
 
¥ecify


384 
şo£_fds
=
True
 
w™h
 
sub´oûss
.
Pİ’
.

387 
impÜt
 
sys


388 
mswšdows
 = (
sys
.
¶©fÜm
 == "win32")

390 
impÜt
 
os


391 
impÜt
 
ty³s


392 
impÜt
 
Œaûback


393 
impÜt
 
gc


394 
impÜt
 
sigÇl


395 
impÜt
 
”ºo


397 
Œy
:

398 
£t


399 
exû±
 
NameE¼Ü
:

400 
äom
 
£ts
 
impÜt
 
S‘
 
as
 
£t


402 #Exû±iÚ 
şas£s
 
u£d
 
by
 
this
 
moduË
.

403 
şass
 
	$C®ËdProûssE¼Ü
(
Exû±iÚ
):

405 
	$check_ouut
(è
»tuºs
 
a
 
nÚ
-
z”o
 
ex™
 
¡©us
.

406 
The
 
ex™
 
¡©us
 
wl
 
be
 
¡Üed
 
š
 
the
 
»tuºcode
 
©Œibu‹
;

407 
	$check_ouut
(è
wl
 
®so
 
¡Üe
 
the
 
ouut
 
š
houuˆ
©Œibu‹
.

409 
def
 
	$__š™__
(
£lf
, 
»tuºcode
, 
cmd
, 
ouut
=
NÚe
):

410 
£lf
.
»tuºcode
 =„eturncode

411 
£lf
.
cmd
 = cmd

412 
£lf
.
ouut
 = output

413 
def
 
	$__¡r__
(
£lf
):

414  "Commªd '%s'„‘uºed‚Ú-z”Øex™ stu %d" % (
£lf
.
cmd
, s–f.
»tuºcode
)

417 
mswšdows
:

418 
impÜt
 
th»adšg


419 
impÜt
 
msvüt


420 
impÜt
 
_sub´oûss


421 
şass
 
STARTUPINFO
:

422 
dwFÏgs
 = 0

423 
hStdIÅut
 = 
NÚe


424 
hStdOuut
 = 
NÚe


425 
hStdE¼Ü
 = 
NÚe


426 
wShowWšdow
 = 0

427 
şass
 
pywšty³s
:

428 
”rÜ
 = 
IOE¼Ü


430 
impÜt
 
£Ëù


431 
_has_pŞl
 = 
	`ha§‰r
(
£Ëù
, 'poll')

432 
impÜt
 
fú


433 
impÜt
 
pickË


435 #Wh’ 
£Ëù
 
Ü
 
pŞl
 
has
 
šdiÿ‹d
 
th©
 
the
 
fe
 
is
 
wr™abË
,

436 #w
ÿn
 
wr™e
 
up
 
to
 
_PIPE_BUF
 
by‹s
 
w™hout
 
risk
 
of
 
blockšg
.

437 #POSIX 
defšes
 
PIPE_BUF
 
as
 >= 512.

438 
_PIPE_BUF
 = 
	`g‘©Œ
(
£Ëù
, 'PIPE_BUF', 512)

441 
__®l__
 = ["Popen", "PIPE", "STDOUT", "call", "check_call",

444 
mswšdows
:

445 
äom
 
_sub´oûss
 
impÜt
 
CREATE_NEW_CONSOLE
, 
CREATE_NEW_PROCESS_GROUP
, \

446 
STD_INPUT_HANDLE
, 
STD_OUTPUT_HANDLE
, \

447 
STD_ERROR_HANDLE
, 
SW_HIDE
, \

448 
STARTF_USESTDHANDLES
, 
STARTF_USESHOWWINDOW


450 
__®l__
.
	`ex‹nd
(["CREATE_NEW_CONSOLE", "CREATE_NEW_PROCESS_GROUP",

454 
Œy
:

455 
MAXFD
 = 
os
.
	`syscÚf
("SC_OPEN_MAX")

456 
exû±
:

457 
MAXFD
 = 256

459 
_aùive
 = []

461 
def
 
	$_ş—nup
():

462 
š¡
 
š
 
_aùive
[:]:

463 
»s
 = 
š¡
.
	$_š‹º®_pŞl
(
_d—d¡©e
=
sys
.
maxšt
)

464 
»s
 
is
 
nÙ
 
NÚe
:

465 
Œy
:

466 
_aùive
.
	$»move
(
š¡
)

467 
exû±
 
V®ueE¼Ü
:

468 #Thi 
ÿn
 
h­³n
 
two
 
th»ads
 
ü—‹
 
a
 
Ãw
 
Pİ’
 
š¡ªû
.

470 
·ss


472 
PIPE
 = -1

473 
STDOUT
 = -2

476 
def
 
	$_ešŒ_»Œy_ÿÎ
(
func
, *
¬gs
):

477 
True
:

478 
Œy
:

479  
	$func
(*
¬gs
)

480 
	`exû±
 (
OSE¼Ü
, 
IOE¼Ü
), 
e
:

481 
e
.
”ºo
 =ğ”ºo.
EINTR
:

483 
¿i£


486 
def
 
	$ÿÎ
(*
pİ’¬gs
, **
kw¬gs
):

488  
the
 
»tuºcode
 
©Œibu‹
.

490 
The
 
¬gum’ts
 
¬e
 
the
 
§me
 
as
 th
Pİ’
 
cÚ¡ruùÜ
. 
Exam¶e
:

492 
»tcode
 = 
	`ÿÎ
(["ls", "-l"])

494  
	`Pİ’
(*
pİ’¬gs
, **
kw¬gs
).
	$wa™
()

497 
def
 
	$check_ÿÎ
(*
pİ’¬gs
, **
kw¬gs
):

499 
the
 
ex™
 
code
 
was
 
z”o
 
th’
 , 
Ùh”wi£
 
¿i£


500 
C®ËdProûssE¼Ü
. 
The
 C®ËdProûssE¼Ü 
objeù
 
wl
 
have
 
the


501  
code
 
š
 
the
 
»tuºcode
 
©Œibu‹
.

503 
The
 
¬gum’ts
 
¬e
 
the
 
§me
 
as
 th
Pİ’
 
cÚ¡ruùÜ
. 
Exam¶e
:

505 
	`check_ÿÎ
(["ls", "-l"])

507 
»tcode
 = 
	$ÿÎ
(*
pİ’¬gs
, **
kw¬gs
)

508 
»tcode
:

509 
cmd
 = 
kw¬gs
.
	`g‘
("args")

510 
cmd
 
is
 
NÚe
:

511 
cmd
 = 
pİ’¬gs
[0]

512 
¿i£
 
	$C®ËdProûssE¼Ü
(
»tcode
, 
cmd
)

516 
def
 
	$check_ouut
(*
pİ’¬gs
, **
kw¬gs
):

517 
r
"""Run command with‡rguments‡nd„eturn its output‡s‡ byte string.

519 
If
 
the
 
ex™
 
code
 
was
 
nÚ
-
z”o
 
™
 
¿i£s
 
a
 
C®ËdProûssE¼Ü
. 
The


520 
C®ËdProûssE¼Ü
 
objeù
 
wl
 
have
 
the
  
code
 
š
h
»tuºcode


521 
©Œibu‹
 
ªd
 
ouut
 
š
 
the
 output‡ttribute.

523 
The
 
¬gum’ts
 
¬e
 
the
 
§me
 
as
 th
Pİ’
 
cÚ¡ruùÜ
. 
Exam¶e
:

525 >>> 
	`check_ouut
(["ls", "-l", "/dev/null"])

528 
The
 
¡dout
 
¬gum’t
 
is
 
nÙ
 
®lowed
 
as
 
™
 i 
u£d
 
š‹º®ly
.

529 
To
 
ÿ±u»
 
¡ªd¬d
 
”rÜ
 
š
 
the
 
»suÉ
, 
u£
 
¡d”r
=
STDOUT
.

531 >>> 
	`check_ouut
(["/bin/sh", "-c",

533 ... 
¡d”r
=
STDOUT
)

536 '¡dout' 
š
 
kw¬gs
:

537 
¿i£
 
	`V®ueE¼Ü
('stdout‡rgument‚ot‡llowed, it will be overridden.')

538 
´oûss
 = 
	$Pİ’
(
¡dout
=
PIPE
, *
pİ’¬gs
, **
kw¬gs
)

539 
ouut
, 
unu£d_”r
 = 
´oûss
.
	$communiÿ‹
()

540 
»tcode
 = 
´oûss
.
	$pŞl
()

541 
»tcode
:

542 
cmd
 = 
kw¬gs
.
	`g‘
("args")

543 
cmd
 
is
 
NÚe
:

544 
cmd
 = 
pİ’¬gs
[0]

545 
¿i£
 
	$C®ËdProûssE¼Ü
(
»tcode
, 
cmd
, 
ouut
=output)

546  
ouut


549 
def
 
	$li¡2cmdlše
(
£q
):

551 
T¿n¦©e
 
a
 
£qu’û
 
of
 
¬gum’ts
 
što
‡ 
commªd
 
lše


552 
¡ršg
, 
usšg
 
the
 
§me
 
ruËs
 
as
h
MS
 
C
 
ruÁime
:

554 1è
Argum’ts
 
¬e
 
d–im™ed
 
by
 
wh™e
 
¥aû
, 
which
 
is
 
e™h”
 
a


555 
¥aû
 
Ü
 
a
 
b
.

557 2è
A
 
¡ršg
 
su¼ounded
 
by
 
quÙ©iÚ
 
m¬ks
 
is


558 
š‹½»‹d
 
as
 
a
 
sšgË
 
¬gum’t
, 
»g¬dËss
 
of
 
wh™e
 
¥aû


559 
cÚšed
 
w™hš
. 
A
 
quÙed
 
¡ršg
 
ÿn
 
be
 
embedded
 
š
 
ª


560 
¬gum’t
.

562 3è
A
 
quÙ©iÚ
 
m¬k
 
´eûded
 
by
 
a
 
back¦ash
 
is


563 
š‹½»‹d
 
as
 
a
 
l™”®
 
quÙ©iÚ
 
m¬k
.

565 4è
Back¦ashes
 
¬e
 
š‹½»‹d
 
l™”®ly
, 
uÆess
 
they


566 
immedŸ‹ly
 
´eûde
 
a
 
quÙ©iÚ
 
m¬k
.

568 5è
If
 
back¦ashes
 
immedŸ‹ly
 
´eûde
 
a
 
quÙ©iÚ
 
m¬k
,

569 
ev”y
 
·œ
 
of
 
back¦ashes
 
is
 
š‹½»‹d
 
as
 
a
 
l™”®


570 
back¦ash
. 
If
 
the
 
numb”
 
of
 
back¦ashes
 
is
 
odd
,h
Ï¡


571 
back¦ash
 
esÿ³s
 
the
 
Ãxt
 
quÙ©iÚ
 
m¬k
 
as


572 
desüibed
 
š
 
ruË
 3.

577 #Ü 
£¬ch
 
h‰p
:

578 #"
P¬sšg
 
C
++ 
Commªd
-
Lše
 
Argum’ts
"

579 
»suÉ
 = []

580 
ÃedquÙe
 = 
F®£


581 
¬g
 
š
 
£q
:

582 
bs_buf
 = []

584 #Add 
a
 
¥aû
 
to
 
£·¿‹
 
this
 
¬gum’t
 
äom
 
the
 
Ùh”s


585 
»suÉ
:

586 
»suÉ
.
	`­³nd
(' ')

588 
ÃedquÙe
 = (" " 
š
 
¬g
è
	`Ü
 ("\t" iÀ¬gè
Ü
 
nÙ
‡rg

589 
ÃedquÙe
:

590 
»suÉ
.
	`­³nd
('"')

592 
c
 
š
 
¬g
:

593 
c
 == '\\':

595 
bs_buf
.
	$­³nd
(
c
)

596 
–if
 
c
 == '"':

597 #DoubË 
back¦ashes
.

598 
»suÉ
.
	`­³nd
('\\' * 
	`Ën
(
bs_buf
)*2)

599 
bs_buf
 = []

600 
»suÉ
.
	`­³nd
('\\"')

603 
bs_buf
:

604 
»suÉ
.
	$ex‹nd
(
bs_buf
)

605 
bs_buf
 = []

606 
»suÉ
.
	$­³nd
(
c
)

608 #Add 
»maššg
 
back¦ashes
, 
ªy
.

609 
bs_buf
:

610 
»suÉ
.
	$ex‹nd
(
bs_buf
)

612 
ÃedquÙe
:

613 
»suÉ
.
	$ex‹nd
(
bs_buf
)

614 
»suÉ
.
	`­³nd
('"')

616  ''.
	$još
(
»suÉ
)

619 
şass
 
	$Pİ’
(
objeù
):

620 
def
 
	$__š™__
(
£lf
, 
¬gs
, 
bufsize
=0, 
execubË
=
NÚe
,

621 
¡dš
=
NÚe
, 
¡dout
=NÚe, 
¡d”r
=None,

622 
´“xec_â
=
NÚe
, 
şo£_fds
=
F®£
, 
sh–l
=False,

623 
cwd
=
NÚe
, 
’v
=NÚe, 
univ”§l_Ãwlšes
=
F®£
,

624 
¡¬tupšfo
=
NÚe
, 
ü—tiÚæags
=0):

626 
	$_ş—nup
()

628 
£lf
.
_chd_ü—‹d
 = 
F®£


629 
nÙ
 
	`isš¡ªû
(
bufsize
, (, )):

630 
¿i£
 
	`Ty³E¼Ü
("bufsize must be‡n integer")

632 
mswšdows
:

633 
´“xec_â
 
is
 
nÙ
 
NÚe
:

634 
¿i£
 
	`V®ueE¼Ü
("preexec_fn is‚ot supported on Windows "

636 
şo£_fds
 
	$ªd
 (
¡dš
 
is
 
nÙ
 
NÚe
 
Ü
 
¡dout
 is‚ot None or

637 
¡d”r
 
is
 
nÙ
 
NÚe
):

638 
¿i£
 
	`V®ueE¼Ü
("close_fds is‚ot supported on Windows "

642 
¡¬tupšfo
 
is
 
nÙ
 
NÚe
:

643 
¿i£
 
	`V®ueE¼Ü
("startupinfo is only supported on Windows "

645 
ü—tiÚæags
 != 0:

646 
¿i£
 
	`V®ueE¼Ü
("creationflags is only supported on Windows "

649 
£lf
.
¡dš
 = 
NÚe


650 
£lf
.
¡dout
 = 
NÚe


651 
£lf
.
¡d”r
 = 
NÚe


652 
£lf
.
pid
 = 
NÚe


653 
£lf
.
»tuºcode
 = 
NÚe


654 
£lf
.
univ”§l_Ãwlšes
 = universal_newlines

656 #IÅuˆ
ªd
 
ouut
 
objeùs
. 
The
 
g’”®
 
´šcË
 
is
 
like


658 #
#P¬’ˆ
Chd


660 #p2cwr™---
¡dš
---> 
p2ü—d


661 #c2´—d <--
¡dout
--- 
c2pwr™e


662 #”¼—d <--
¡d”r
--- 
”rwr™e


663 #
#OÀ
POSIX
, 
the
 
chd
 
objeùs
 
¬e
 
fe
 
desütÜs
. 
On


664 #Wšdows, 
the£
 
¬e
 
Wšdows
 
fe
 
hªdËs
. 
The
 
·»Á
 
objeùs


665 #¬
fe
 
desütÜs
 
Ú
 
bÙh
 
¶©fÜms
. 
The
 
·»Á
 
objeùs


666 #¬
NÚe
 
wh’
 
nÙ
 
usšg
 
PIPEs
. 
The
 
chd
 
objeùs
 
¬e
 None

667 #wh’ 
nÙ
 
»dœeùšg
.

669 (
p2ü—d
, 
p2cwr™e
,

670 
c2´—d
, 
c2pwr™e
,

671 
”¼—d
, 
”rwr™e
èğ
£lf
.
	$_g‘_hªdËs
(
¡dš
, 
¡dout
, 
¡d”r
)

673 
£lf
.
	$_execu‹_chd
(
¬gs
, 
execubË
, 
´“xec_â
, 
şo£_fds
,

674 
cwd
, 
’v
, 
univ”§l_Ãwlšes
,

675 
¡¬tupšfo
, 
ü—tiÚæags
, 
sh–l
,

676 
p2ü—d
, 
p2cwr™e
,

677 
c2´—d
, 
c2pwr™e
,

678 
”¼—d
, 
”rwr™e
)

680 
mswšdows
:

681 
p2cwr™e
 
is
 
nÙ
 
NÚe
:

682 
p2cwr™e
 = 
msvüt
.
	`İ’_osfhªdË
Õ2cwr™e.
	`D‘ach
(), 0)

683 
c2´—d
 
is
 
nÙ
 
NÚe
:

684 
c2´—d
 = 
msvüt
.
	`İ’_osfhªdË
(c2´—d.
	`D‘ach
(), 0)

685 
”¼—d
 
is
 
nÙ
 
NÚe
:

686 
”¼—d
 = 
msvüt
.
	`İ’_osfhªdË
Ó¼»ad.
	`D‘ach
(), 0)

688 
p2cwr™e
 
is
 
nÙ
 
NÚe
:

689 
£lf
.
¡dš
 = 
os
.
	`fdİ’
(
p2cwr™e
, 'wb', 
bufsize
)

690 
c2´—d
 
is
 
nÙ
 
NÚe
:

691 
univ”§l_Ãwlšes
:

692 
£lf
.
¡dout
 = 
os
.
	`fdİ’
(
c2´—d
, 'rU', 
bufsize
)

694 
£lf
.
¡dout
 = 
os
.
	`fdİ’
(
c2´—d
, 'rb', 
bufsize
)

695 
”¼—d
 
is
 
nÙ
 
NÚe
:

696 
univ”§l_Ãwlšes
:

697 
£lf
.
¡d”r
 = 
os
.
	`fdİ’
(
”¼—d
, 'rU', 
bufsize
)

699 
£lf
.
¡d”r
 = 
os
.
	`fdİ’
(
”¼—d
, 'rb', 
bufsize
)

702 
def
 
	$_Œª¦©e_Ãwlšes
(
£lf
, 
d©a
):

703 
d©a
 = d©a.
	`»¶aû
("\r\n", "\n")

704 
d©a
 = d©a.
	`»¶aû
("\r", "\n")

705  
d©a


708 
def
 
	$__d–__
(
£lf
, 
_maxšt
=
sys
.
maxšt
, 
_aùive
=_active):

709 #Ià
__š™__
 
ha¢
't had‡ chanceoƒxecute (e.g. if it

710 #wa 
·s£d
 
ª
 
undeş¬ed
 
keywÜd
 
¬gum’t
), 
we
 
dÚ
't

711 #hav
a
 
_chd_ü—‹d
 
©Œibu‹
 
©
 
®l
.

712 
nÙ
 
	`g‘©Œ
(
£lf
, '_chd_ü—‹d', 
F®£
):

713 #W
didn
't geto successfully create‡ child…rocess.

715 #IÀ
the
 
chd
 
ha¢
'ˆb“Àwa™ed on, check ià™'
s
 
dÚe
.

716 
£lf
.
	$_š‹º®_pŞl
(
_d—d¡©e
=
_maxšt
)

717 
£lf
.
»tuºcode
 
is
 
NÚe
 
ªd
 
_aùive
 i 
nÙ
 None:

718 #Chd 
is
 
¡l
 
ruÂšg
, 
k“p
 
us
 
®ive
 
uÁ
 
we
 
ÿn
 
wa™
 
Ú
 
™
.

719 
_aùive
.
	$­³nd
(
£lf
)

722 
def
 
	$communiÿ‹
(
£lf
, 
šput
=
NÚe
):

724 
¡dout
 
ªd
 
¡d”r
, 
uÁ
 
’d
-
of
-
fe
 
is
 
»ached
. 
Wa™
 

725 
´oûss
 
to
 
‹rmš©e
. 
The
 
İtiÚ®
 
šput
 
¬gum’t
 
should
 
be
 
a


726 
¡ršg
 
to
 
be
 
£Á
Ø
the
 
chd
 
´oûss
, 
Ü
 
NÚe
, 
no
 
d©a


727 
should
 
be
 
£Á
 
to
 
the
 
chd
.

729 
	$communiÿ‹
(è
»tuºs
 
a
 
	`tu¶e
 (
¡dout
, 
¡d”r
)."""

731 #O±imiz©iÚ: 
If
 
we
 
¬e
 
Úly
 
usšg
 
Úe
 
pe
, 
Ü
 
no
…
©


732 #®l, 
usšg
 
	`£Ëù
(è
Ü
 
th»ads
 
is
 
uÂeûs§ry
.

733 [
£lf
.
¡dš
, s–f.
¡dout
, s–f.
¡d”r
].
	`couÁ
(
NÚe
) >= 2:

734 
¡dout
 = 
NÚe


735 
¡d”r
 = 
NÚe


736 
£lf
.
¡dš
:

737 
šput
:

738 
Œy
:

739 
£lf
.
¡dš
.
	$wr™e
(
šput
)

740 
exû±
 
IOE¼Ü
, 
e
:

741 
e
.
”ºo
 !ğ”ºo.
EPIPE
 
ªd
ƒ.”ºØ!ğ”ºo.
EINVAL
:

742 
¿i£


743 
£lf
.
¡dš
.
	$şo£
()

744 
–if
 
£lf
.
¡dout
:

745 
¡dout
 = 
	$_ešŒ_»Œy_ÿÎ
(
£lf
.
¡dout
.
»ad
)

746 
£lf
.
¡dout
.
	$şo£
()

747 
–if
 
£lf
.
¡d”r
:

748 
¡d”r
 = 
	$_ešŒ_»Œy_ÿÎ
(
£lf
.
¡d”r
.
»ad
)

749 
£lf
.
¡d”r
.
	$şo£
()

750 
£lf
.
	$wa™
()

751  (
¡dout
, 
¡d”r
)

753  
£lf
.
	$_communiÿ‹
(
šput
)

756 
def
 
	$pŞl
(
£lf
):

757  
£lf
.
	$_š‹º®_pŞl
()

760 
mswšdows
:

761 #
#Wšdow 
m‘hods


762 #
 _g‘_hªdËs(£lf, stdš, stdout, std”r):

764 
p2ü—d
, 
p2cwr™e
, 
c2´—d
, 
c2pwr™e
, 
”¼—d
, 
”rwr™e


766 
¡dš
 
is
 
NÚe
 
ªd
 
¡dout
 i NÚªd 
¡d”r
 is None:

767  (
NÚe
, None, None, None, None, None)

769 
p2ü—d
, 
p2cwr™e
 = 
NÚe
, None

770 
c2´—d
, 
c2pwr™e
 = 
NÚe
, None

771 
”¼—d
, 
”rwr™e
 = 
NÚe
, None

773 
¡dš
 
is
 
NÚe
:

774 
p2ü—d
 = 
_sub´oûss
.
	$G‘StdHªdË
(
_sub´oûss
.
STD_INPUT_HANDLE
)

775 
p2ü—d
 
is
 
NÚe
:

776 
p2ü—d
, 
_
 = 
_sub´oûss
.
	$C»©ePe
(
NÚe
, 0)

777 
–if
 
¡dš
 =ğ
PIPE
:

778 
p2ü—d
, 
p2cwr™e
 = 
_sub´oûss
.
	$C»©ePe
(
NÚe
, 0)

779 
–if
 
	$isš¡ªû
(
¡dš
, ):

780 
p2ü—d
 = 
msvüt
.
	$g‘_osfhªdË
(
¡dš
)

782 #Assumšg 
fe
-
like
 
objeù


783 
p2ü—d
 = 
msvüt
.
	`g‘_osfhªdË
(
¡dš
.
	$f’o
())

784 
p2ü—d
 = 
£lf
.
	$_make_šh”™abË
(
p2ü—d
)

786 
¡dout
 
is
 
NÚe
:

787 
c2pwr™e
 = 
_sub´oûss
.
	$G‘StdHªdË
(
_sub´oûss
.
STD_OUTPUT_HANDLE
)

788 
c2pwr™e
 
is
 
NÚe
:

789 
_
, 
c2pwr™e
 = 
_sub´oûss
.
	$C»©ePe
(
NÚe
, 0)

790 
–if
 
¡dout
 =ğ
PIPE
:

791 
c2´—d
, 
c2pwr™e
 = 
_sub´oûss
.
	$C»©ePe
(
NÚe
, 0)

792 
–if
 
	$isš¡ªû
(
¡dout
, ):

793 
c2pwr™e
 = 
msvüt
.
	$g‘_osfhªdË
(
¡dout
)

795 #Assumšg 
fe
-
like
 
objeù


796 
c2pwr™e
 = 
msvüt
.
	`g‘_osfhªdË
(
¡dout
.
	$f’o
())

797 
c2pwr™e
 = 
£lf
.
	$_make_šh”™abË
(
c2pwr™e
)

799 
¡d”r
 
is
 
NÚe
:

800 
”rwr™e
 = 
_sub´oûss
.
	$G‘StdHªdË
(
_sub´oûss
.
STD_ERROR_HANDLE
)

801 
”rwr™e
 
is
 
NÚe
:

802 
_
, 
”rwr™e
 = 
_sub´oûss
.
	$C»©ePe
(
NÚe
, 0)

803 
–if
 
¡d”r
 =ğ
PIPE
:

804 
”¼—d
, 
”rwr™e
 = 
_sub´oûss
.
	$C»©ePe
(
NÚe
, 0)

805 
–if
 
¡d”r
 =ğ
STDOUT
:

806 
”rwr™e
 = 
c2pwr™e


807 
–if
 
	$isš¡ªû
(
¡d”r
, ):

808 
”rwr™e
 = 
msvüt
.
	$g‘_osfhªdË
(
¡d”r
)

810 #Assumšg 
fe
-
like
 
objeù


811 
”rwr™e
 = 
msvüt
.
	`g‘_osfhªdË
(
¡d”r
.
	$f’o
())

812 
”rwr™e
 = 
£lf
.
	$_make_šh”™abË
(
”rwr™e
)

814  (
p2ü—d
, 
p2cwr™e
,

815 
c2´—d
, 
c2pwr™e
,

816 
”¼—d
, 
”rwr™e
)

819 
def
 
	$_make_šh”™abË
(
£lf
, 
hªdË
):

821  
_sub´oûss
.
	`Du¶iÿ‹HªdË
(_sub´oûss.
	`G‘Cu¼’tProûss
(),

822 
hªdË
, 
_sub´oûss
.
	`G‘Cu¼’tProûss
(), 0, 1,

823 
_sub´oûss
.
DUPLICATE_SAME_ACCESS
)

826 
def
 
	$_fšd_w9xpİ’
(
£lf
):

828 
w9xpİ’
 = 
os
.
·th
.
	`još
(

829 
os
.
·th
.
	`dœÇme
(
_sub´oûss
.
	`G‘ModuËFeName
(0)),

831 
nÙ
 
os
.
·th
.
	$exi¡s
(
w9xpİ’
):

832 #E“k - 
fe
-
nÙ
-
found
 - 
possibly
 
ª
 
embeddšg


833 #s™u©iÚ - 
£e
 
we
 
ÿn
 
loÿ‹
 
™
 
š
 
sys
.
exec_´efix


834 
w9xpİ’
 = 
os
.
·th
.
	`još
(os.·th.
	`dœÇme
(
sys
.
exec_´efix
),

836 
nÙ
 
os
.
·th
.
	$exi¡s
(
w9xpİ’
):

837 
¿i£
 
	`RuÁimeE¼Ü
("Cannot†ocate w9xpopen.exe, which is "

840  
w9xpİ’


843 
def
 
	$_execu‹_chd
(
£lf
, 
¬gs
, 
execubË
, 
´“xec_â
, 
şo£_fds
,

844 
cwd
, 
’v
, 
univ”§l_Ãwlšes
,

845 
¡¬tupšfo
, 
ü—tiÚæags
, 
sh–l
,

846 
p2ü—d
, 
p2cwr™e
,

847 
c2´—d
, 
c2pwr™e
,

848 
”¼—d
, 
”rwr™e
):

851 
nÙ
 
	$isš¡ªû
(
¬gs
, 
ty³s
.
SŒšgTy³s
):

852 
¬gs
 = 
	$li¡2cmdlše
(
¬gs
)

854 #Proûs 
¡¬tup
 
d‘as


855 
¡¬tupšfo
 
is
 
NÚe
:

856 
¡¬tupšfo
 = 
	$STARTUPINFO
()

857 
NÚe
 
nÙ
 
	$š
 (
p2ü—d
, 
c2pwr™e
, 
”rwr™e
):

858 
¡¬tupšfo
.
dwFÏgs
 |ğ
_sub´oûss
.
STARTF_USESTDHANDLES


859 
¡¬tupšfo
.
hStdIÅut
 = 
p2ü—d


860 
¡¬tupšfo
.
hStdOuut
 = 
c2pwr™e


861 
¡¬tupšfo
.
hStdE¼Ü
 = 
”rwr™e


863 
sh–l
:

864 
¡¬tupšfo
.
dwFÏgs
 |ğ
_sub´oûss
.
STARTF_USESHOWWINDOW


865 
¡¬tupšfo
.
wShowWšdow
 = 
_sub´oûss
.
SW_HIDE


866 
com¥ec
 = 
os
.
’vœÚ
.
	`g‘
("COMSPEC", "cmd.exe")

867 
¬gs
 = '{} /ø"{}"'.
	$fÜm©
 (
com¥ec
, 
¬gs
)

868 ià(
_sub´oûss
.
	`G‘V”siÚ
(è>ğ0x80000000 
Ü


869 
os
.
·th
.
	`ba£Çme
(
com¥ec
).
	`low”
() == "command.com"):

870 #Wš9x, 
Ü
 
usšg
 
commªd
.
com
 
Ú
 
NT
. 
We
 
Ãed
 
to


871 #u£ 
the
 
w9xpİ’
 
š‹rmedŸ‹
 
´og¿m
. 
FÜ
 
mÜe


872 #šfÜm©iÚ, 
£e
 
KB
 
Q150956


873 #(
h‰p
:

874 
w9xpİ’
 = 
£lf
.
	$_fšd_w9xpİ’
()

875 
¬gs
 = '"%s" %s' % (
w9xpİ’
,‡rgs)

876 #NÙ 
·ssšg
 
CREATE_NEW_CONSOLE
 
has
 
b“n
 
known
 
to


877 #ÿu£ 
¿ndom
 
çu»s
 
Ú
 
wš9x
. 
S³cifiÿÎy
 
a


879 #u£ 
©
 
xxx
"‡nd‡ hopeful warning‡bouthe

880 #¡ab™y 
of
 
your
 
sy¡em
. 
Co¡
 
is
 
CŒl
+
C
 
wÚt


881 #kÈ
chd»n
.

882 
ü—tiÚæags
 |ğ
_sub´oûss
.
CREATE_NEW_CONSOLE


884 #S¹ 
the
 
´oûss


885 
Œy
:

886 
Œy
:

887 
hp
, 
ht
, 
pid
, 
tid
 = 
_sub´oûss
.
	`C»©eProûss
(
execubË
, 
¬gs
,

888 #nØ
¥ecŸl
 
£cur™y


889 
NÚe
, None,

890 (
nÙ
 
şo£_fds
),

891 
ü—tiÚæags
,

892 
’v
,

893 
cwd
,

894 
¡¬tupšfo
)

895 
exû±
 
pywšty³s
.
”rÜ
, 
e
:

896 #T¿n¦©
pywšty³s
.
”rÜ
 
to
 
WšdowsE¼Ü
, 
which
 
is


897 #¨
subşass
 
of
 
OSE¼Ü
. 
FIXME
: 
We
 
should
 
»®ly


898 #Œª¦©
”ºo
 
usšg
 
	`_sys_”¾i¡
 (
Ü
 
sim¬
), 
but


899 #how 
ÿn
 
this
 
be
 
dÚe
 
äom
 
PythÚ
?

900 
¿i£
 
	$WšdowsE¼Ü
(*
e
.
¬gs
)

901 
fš®ly
:

902 #Chd 
is
 
Ïunched
. 
Clo£
 
the
 
·»Á
's copy ofhose…ipe

903 #hªdË 
th©
 
Úly
 
the
 
chd
 
should
 
have
 
İ’
. 
You
 
Ãed


904 #tØ
make
 
su»
 
th©
 
no
 
hªdËs
 
to
 
the
 
wr™e
 
’d
 
of
he

905 #ouuˆ
pe
 
¬e
 
maššed
 
š
 
this
 
´oûss
 
Ü
 
the


906 #p
wl
 
nÙ
 
şo£
 
wh’
 
the
 
chd
 
´oûss
 
ex™s
 
ªd
he

907 #R—dF
wl
 
hªg
.

908 
p2ü—d
 
is
 
nÙ
 
NÚe
:

909 
p2ü—d
.
	$Clo£
()

910 
c2pwr™e
 
is
 
nÙ
 
NÚe
:

911 
c2pwr™e
.
	$Clo£
()

912 
”rwr™e
 
is
 
nÙ
 
NÚe
:

913 
”rwr™e
.
	$Clo£
()

915 #R‘aš 
the
 
´oûss
 
hªdË
, 
but
 
şo£
h
th»ad
 handle

916 
£lf
.
_chd_ü—‹d
 = 
True


917 
£lf
.
_hªdË
 = 
hp


918 
£lf
.
pid
 =…id

919 
ht
.
	$Clo£
()

921 
def
 
	$_š‹º®_pŞl
(
£lf
, 
_d—d¡©e
=
NÚe
,

922 
_Wa™FÜSšgËObjeù
=
_sub´oûss
.
Wa™FÜSšgËObjeù
,

923 
_WAIT_OBJECT_0
=
_sub´oûss
.
WAIT_OBJECT_0
,

924 
_G‘Ex™CodeProûss
=
_sub´oûss
.
G‘Ex™CodeProûss
):

926 
©Œibu‹
.

928 
This
 
m‘hod
 
is
 
ÿÎed
 
by
 
__d–__
, 
so
 
™
 
ÿn
 
Úly
 
»ãr
 
to
 
objeùs


929 
š
 
™s
 
loÿl
 
scİe
.

932 
£lf
.
»tuºcode
 
is
 
NÚe
:

933 
	`_Wa™FÜSšgËObjeù
(
£lf
.
_hªdË
, 0è=ğ
_WAIT_OBJECT_0
:

934 
£lf
.
»tuºcode
 = 
	$_G‘Ex™CodeProûss
(
£lf
.
_hªdË
)

935  
£lf
.
»tuºcode


938 
def
 
	$wa™
(
£lf
):

940 
©Œibu‹
."""

941 
£lf
.
»tuºcode
 
is
 
NÚe
:

942 
_sub´oûss
.
	$Wa™FÜSšgËObjeù
(
£lf
.
_hªdË
,

943 
_sub´oûss
.
INFINITE
)

944 
£lf
.
»tuºcode
 = 
_sub´oûss
.
	$G‘Ex™CodeProûss
(
£lf
.
_hªdË
)

945  
£lf
.
»tuºcode


948 
def
 
	$_»ad”th»ad
(
£lf
, 
fh
, 
bufãr
):

949 
bufãr
.
	`­³nd
(
fh
.
	$»ad
())

952 
def
 
	$_communiÿ‹
(
£lf
, 
šput
):

953 
¡dout
 = 
NÚe
 #Return

954 
¡d”r
 = 
NÚe
 #Return

956 
£lf
.
¡dout
:

957 
¡dout
 = []

958 
¡dout_th»ad
 = 
th»adšg
.
	`Th»ad
(
rg‘
=
£lf
.
_»ad”th»ad
,

959 
¬gs
=(
£lf
.
¡dout
, stdout))

960 
¡dout_th»ad
.
	$£tD«mÚ
(
True
)

961 
¡dout_th»ad
.
	$¡¬t
()

962 
£lf
.
¡d”r
:

963 
¡d”r
 = []

964 
¡d”r_th»ad
 = 
th»adšg
.
	`Th»ad
(
rg‘
=
£lf
.
_»ad”th»ad
,

965 
¬gs
=(
£lf
.
¡d”r
, stderr))

966 
¡d”r_th»ad
.
	$£tD«mÚ
(
True
)

967 
¡d”r_th»ad
.
	$¡¬t
()

969 
£lf
.
¡dš
:

970 
šput
 
is
 
nÙ
 
NÚe
:

971 
Œy
:

972 
£lf
.
¡dš
.
	$wr™e
(
šput
)

973 
exû±
 
IOE¼Ü
, 
e
:

974 
e
.
”ºo
 !ğ”ºo.
EPIPE
:

975 
¿i£


976 
£lf
.
¡dš
.
	$şo£
()

978 
£lf
.
¡dout
:

979 
¡dout_th»ad
.
	$još
()

980 
£lf
.
¡d”r
:

981 
¡d”r_th»ad
.
	$još
()

983 #AÎ 
d©a
 
exchªged
. 
T¿n¦©e
 
li¡s
 
što
 
¡ršgs
.

984 
¡dout
 
is
 
nÙ
 
NÚe
:

985 
¡dout
 = stdout[0]

986 
¡d”r
 
is
 
nÙ
 
NÚe
:

987 
¡d”r
 = stderr[0]

989 #T¿n¦©
Ãwlšes
, 
»que¡ed
. 
We
 
ÿÂÙ
 
Ët
 
the
 
fe


990 #objeù dØ
the
 
Œª¦©iÚ
: 
It
 
is
 
ba£d
 
Ú
 
¡dio
, 
which
 is

991 #impossibË 
to
 
combše
 
w™h
 
	`£Ëù
 (
uÆess
 
fÜcšg
 
no


993 
£lf
.
univ”§l_Ãwlšes
 
ªd
 
	`ha§‰r
(
fe
, 'newlines'):

994 
¡dout
:

995 
¡dout
 = 
£lf
.
	$_Œª¦©e_Ãwlšes
(
¡dout
)

996 
¡d”r
:

997 
¡d”r
 = 
£lf
.
	$_Œª¦©e_Ãwlšes
(
¡d”r
)

999 
£lf
.
	$wa™
()

1000  (
¡dout
, 
¡d”r
)

1002 
def
 
	$£nd_sigÇl
(
£lf
, 
sig
):

1005 
sig
 =ğ
sigÇl
.
SIGTERM
:

1006 
£lf
.
	$‹rmš©e
()

1007 
–if
 
sig
 =ğ
sigÇl
.
CTRL_C_EVENT
:

1008 
os
.
	$kl
(
£lf
.
pid
, 
sigÇl
.
CTRL_C_EVENT
)

1009 
–if
 
sig
 =ğ
sigÇl
.
CTRL_BREAK_EVENT
:

1010 
os
.
	$kl
(
£lf
.
pid
, 
sigÇl
.
CTRL_BREAK_EVENT
)

1012 
¿i£
 
	`V®ueE¼Ü
("UnsuµÜ‹d sigÇl: {}".
	$fÜm©
(
sig
))

1014 
def
 
	$‹rmš©e
(
£lf
):

1017 
_sub´oûss
.
	$T”mš©eProûss
(
£lf
.
_hªdË
, 1)

1019 
kl
 = 
‹rmš©e


1022 #
#POSIX 
m‘hods


1023 #
 _g‘_hªdËs(£lf, stdš, stdout, std”r):

1025 
p2ü—d
, 
p2cwr™e
, 
c2´—d
, 
c2pwr™e
, 
”¼—d
, 
”rwr™e


1027 
p2ü—d
, 
p2cwr™e
 = 
NÚe
, None

1028 
c2´—d
, 
c2pwr™e
 = 
NÚe
, None

1029 
”¼—d
, 
”rwr™e
 = 
NÚe
, None

1031 
¡dš
 
is
 
NÚe
:

1032 
·ss


1033 
–if
 
¡dš
 =ğ
PIPE
:

1034 
p2ü—d
, 
p2cwr™e
 = 
£lf
.
	$pe_şÛxec
()

1035 
–if
 
	$isš¡ªû
(
¡dš
, ):

1036 
p2ü—d
 = 
¡dš


1038 #Assumšg 
fe
-
like
 
objeù


1039 
p2ü—d
 = 
¡dš
.
	$f’o
()

1041 
¡dout
 
is
 
NÚe
:

1042 
·ss


1043 
–if
 
¡dout
 =ğ
PIPE
:

1044 
c2´—d
, 
c2pwr™e
 = 
£lf
.
	$pe_şÛxec
()

1045 
–if
 
	$isš¡ªû
(
¡dout
, ):

1046 
c2pwr™e
 = 
¡dout


1048 #Assumšg 
fe
-
like
 
objeù


1049 
c2pwr™e
 = 
¡dout
.
	$f’o
()

1051 
¡d”r
 
is
 
NÚe
:

1052 
·ss


1053 
–if
 
¡d”r
 =ğ
PIPE
:

1054 
”¼—d
, 
”rwr™e
 = 
£lf
.
	$pe_şÛxec
()

1055 
–if
 
¡d”r
 =ğ
STDOUT
:

1056 
”rwr™e
 = 
c2pwr™e


1057 
–if
 
	$isš¡ªû
(
¡d”r
, ):

1058 
”rwr™e
 = 
¡d”r


1060 #Assumšg 
fe
-
like
 
objeù


1061 
”rwr™e
 = 
¡d”r
.
	$f’o
()

1063  (
p2ü—d
, 
p2cwr™e
,

1064 
c2´—d
, 
c2pwr™e
,

1065 
”¼—d
, 
”rwr™e
)

1068 
def
 
	$_£t_şÛxec_æag
(
£lf
, 
fd
, 
şÛxec
=
True
):

1069 
Œy
:

1070 
şÛxec_æag
 = 
fú
.
FD_CLOEXEC


1071 
exû±
 
A‰ribu‹E¼Ü
:

1072 
şÛxec_æag
 = 1

1074 
Şd
 = 
fú
.
	$fú
(
fd
, 
fú
.
F_GETFD
)

1075 
şÛxec
:

1076 
fú
.
	`fú
(
fd
, fú.
F_SETFD
, 
Şd
 | 
şÛxec_æag
)

1078 
fú
.
	`fú
(
fd
, fú.
F_SETFD
, 
Şd
 & ~
şÛxec_æag
)

1081 
def
 
	$pe_şÛxec
(
£lf
):

1083 #Pes' FD ¬£ˆCLOEXEC by deçuÉ beÿu£ wdÚ'
t
 
wªt
 
them


1084 #tØ
be
 
šh”™ed
 
by
 
Ùh”
 
sub´oûs£s
: 
the
 
CLOEXEC
 
æag
 
is
 
»moved


1085 #äom 
the
 
chd
's FDs by _dup2(), between fork()‡ndƒxec().

1086 #Thi 
is
 
nÙ
 
©omic
: 
we
 
would
 
Ãed
 
the
 
	`pe2
(è
sysÿÎ
 
th©
.

1087 
r
, 
w
 = 
os
.
	$pe
()

1088 
£lf
.
	$_£t_şÛxec_æag
(
r
)

1089 
£lf
.
	$_£t_şÛxec_æag
(
w
)

1090  
r
, 
w


1093 
def
 
	$_şo£_fds
(
£lf
, 
but
):

1094 
	`ha§‰r
(
os
, 'closerange'):

1095 
os
.
	$şo£¿nge
(3, 
but
)

1096 
os
.
	`şo£¿nge
(
but
 + 1, 
MAXFD
)

1098 
i
 
š
 
	$x¿nge
(3, 
MAXFD
):

1099 
i
 =ğ
but
:

1101 
Œy
:

1102 
os
.
	$şo£
(
i
)

1103 
exû±
:

1104 
·ss


1107 
def
 
	$_execu‹_chd
(
£lf
, 
¬gs
, 
execubË
, 
´“xec_â
, 
şo£_fds
,

1108 
cwd
, 
’v
, 
univ”§l_Ãwlšes
,

1109 
¡¬tupšfo
, 
ü—tiÚæags
, 
sh–l
,

1110 
p2ü—d
, 
p2cwr™e
,

1111 
c2´—d
, 
c2pwr™e
,

1112 
”¼—d
, 
”rwr™e
):

1115 
	$isš¡ªû
(
¬gs
, 
ty³s
.
SŒšgTy³s
):

1116 
¬gs
 = [args]

1118 
¬gs
 = 
	$li¡
(
¬gs
)

1120 
sh–l
:

1121 
¬gs
 = ["/bin/sh", "-c"] +‡rgs

1122 
execubË
:

1123 
¬gs
[0] = 
execubË


1125 
execubË
 
is
 
NÚe
:

1126 
execubË
 = 
¬gs
[0]

1128 #FÜ 
Œªsã¼šg
 
possibË
 
exec
 
çu»
 
äom
 
chd
 
to
 
·»Á


1129 #Th
fœ¡
 
¥ecif›s
 
the
 
exû±iÚ
 
ty³
: 0 
m—ns


1130 #OSE¼Ü, 1 
m—ns
 
some
 
Ùh”
 
”rÜ
.

1131 
”½e_»ad
, 
”½e_wr™e
 = 
£lf
.
	$pe_şÛxec
()

1132 
Œy
:

1133 
Œy
:

1134 
gc_was_’abËd
 = 
gc
.
	$i£ÇbËd
()

1135 #Di§bË 
gc
 
to
 
avoid
 
bug
 
wh”e
 gø-> 
fe_d—Îoc
 ->

1136 #wr™
to
 
¡d”r
 -> 
hªg
. 
h‰p
:

1137 
gc
.
	$di§bË
()

1138 
Œy
:

1139 
£lf
.
pid
 = 
os
.
	$fÜk
()

1140 
exû±
:

1141 
gc_was_’abËd
:

1142 
gc
.
	$’abË
()

1143 
¿i£


1144 
£lf
.
_chd_ü—‹d
 = 
True


1145 
£lf
.
pid
 == 0:

1147 
Œy
:

1148 #Clo£ 
·»Á
's…ipeƒnds

1149 
p2cwr™e
 
is
 
nÙ
 
NÚe
:

1150 
os
.
	$şo£
(
p2cwr™e
)

1151 
c2´—d
 
is
 
nÙ
 
NÚe
:

1152 
os
.
	$şo£
(
c2´—d
)

1153 
”¼—d
 
is
 
nÙ
 
NÚe
:

1154 
os
.
	$şo£
(
”¼—d
)

1155 
os
.
	$şo£
(
”½e_»ad
)

1157 #Wh’ 
dupšg
 
fds
, 
th”e
 
¬i£s
 
a
 
s™u©iÚ


1158 #wh”
Úe
 
of
 
the
 
fds
 
is
 
e™h”
 0, 1 
Ü
 2, 
™


1159 #i 
possibË
 
th©
 
™
 
is
 
	`ov”wr™‹n
 (#12607).

1160 
c2pwr™e
 == 0:

1161 
c2pwr™e
 = 
os
.
	$dup
(
c2pwr™e
)

1162 
”rwr™e
 =ğ0 
Ü
ƒrrwrite == 1:

1163 
”rwr™e
 = 
os
.
	$dup
(
”rwr™e
)

1165 #Du°
fds
 
chd


1166 
def
 
	$_dup2
(
a
, 
b
):

1167 #dup2(è
»moves
 
the
 
CLOEXEC
 
æag
 
but


1168 #w
mu¡
 dØ
™
 
our£lves
 
	`dup2
()

1169 #would 
be
 
a
 
no
-
	`İ
 (
issue
 #10806).

1170 
a
 =ğ
b
:

1171 
£lf
.
	$_£t_şÛxec_æag
(
a
, 
F®£
)

1172 
–if
 
a
 
is
 
nÙ
 
NÚe
:

1173 
os
.
	$dup2
(
a
, 
b
)

1174 
	$_dup2
(
p2ü—d
, 0)

1175 
	$_dup2
(
c2pwr™e
, 1)

1176 
	$_dup2
(
”rwr™e
, 2)

1178 #Clo£ 
pe
 
fds
. 
Make
 
su»
 
we
 
dÚ
't closehe

1179 #§m
fd
 
mÜe
 
thª
 
Úû
, 
Ü
 
¡ªd¬d
 
fds
.

1180 
şo£d
 = 
	$£t
([
NÚe
])

1181 
fd
 
š
 [
p2ü—d
, 
c2pwr™e
, 
”rwr™e
]:

1182 
fd
 
nÙ
 
š
 
şo£d
 
ªd
 fd > 2:

1183 
os
.
	$şo£
(
fd
)

1184 
şo£d
.
	$add
(
fd
)

1186 #Clo£ 
®l
 
Ùh”
 
fds
, 
asked
 

1187 
şo£_fds
:

1188 
£lf
.
	$_şo£_fds
(
but
=
”½e_wr™e
)

1190 
cwd
 
is
 
nÙ
 
NÚe
:

1191 
os
.
	$chdœ
(
cwd
)

1193 
´“xec_â
:

1194 
	$´“xec_â
()

1196 
’v
 
is
 
NÚe
:

1197 
os
.
	$execvp
(
execubË
, 
¬gs
)

1199 
os
.
	$execv³
(
execubË
, 
¬gs
, 
’v
)

1201 
exû±
:

1202 
exc_ty³
, 
exc_v®ue
, 
tb
 = 
sys
.
	$exc_šfo
()

1203 #Sav
the
 
Œaûback
 
ªd
 
©ch
 
™
 
to
h
exû±iÚ
 
objeù


1204 
exc_lšes
 = 
Œaûback
.
	$fÜm©_exû±iÚ
(
exc_ty³
,

1205 
exc_v®ue
,

1206 
tb
)

1207 
exc_v®ue
.
chd_Œaûback
 = ''.
	$još
(
exc_lšes
)

1208 
os
.
	`wr™e
(
”½e_wr™e
, 
pickË
.
	$dumps
(
exc_v®ue
))

1210 #Thi 
ex™code
 
wÚ
't be„eportedo‡pplications, so it

1211 #»®ly 
dÛ¢
't matter what we„eturn.

1212 
os
.
	$_ex™
(255)

1215 
gc_was_’abËd
:

1216 
gc
.
	$’abË
()

1217 
fš®ly
:

1218 #b
su»
 
the
 
FD
 
is
 
şo£d
 
no
 
m©‹r
 
wh©


1219 
os
.
	$şo£
(
”½e_wr™e
)

1221 
p2ü—d
 
is
 
nÙ
 
NÚe
 
ªd
 
p2cwr™e
 is‚ot None:

1222 
os
.
	$şo£
(
p2ü—d
)

1223 
c2pwr™e
 
is
 
nÙ
 
NÚe
 
ªd
 
c2´—d
 is‚ot None:

1224 
os
.
	$şo£
(
c2pwr™e
)

1225 
”rwr™e
 
is
 
nÙ
 
NÚe
 
ªd
 
”¼—d
 is‚ot None:

1226 
os
.
	$şo£
(
”rwr™e
)

1228 #Wa™ 
exec
 
to
 
ç
 
Ü
 
sucûed
; 
possibly
 
¿isšg
 
exû±iÚ


1229 #Exû±iÚ 
lim™ed
 
to
 1
M


1230 
d©a
 = 
	$_ešŒ_»Œy_ÿÎ
(
os
.
»ad
, 
”½e_»ad
, 1048576)

1231 
fš®ly
:

1232 #b
su»
 
the
 
FD
 
is
 
şo£d
 
no
 
m©‹r
 
wh©


1233 
os
.
	$şo£
(
”½e_»ad
)

1235 
d©a
 != "":

1236 
Œy
:

1237 
	$_ešŒ_»Œy_ÿÎ
(
os
.
wa™pid
, 
£lf
.
pid
, 0)

1238 
exû±
 
OSE¼Ü
, 
e
:

1239 
e
.
”ºo
 !ğ”ºo.
ECHILD
:

1240 
¿i£


1241 
chd_exû±iÚ
 = 
pickË
.
	$lßds
(
d©a
)

1242 
fd
 
	$š
 (
p2cwr™e
, 
c2´—d
, 
”¼—d
):

1243 
fd
 
is
 
nÙ
 
NÚe
:

1244 
os
.
	$şo£
(
fd
)

1245 
¿i£
 
chd_exû±iÚ


1248 
def
 
	$_hªdË_ex™¡©us
(
£lf
, 
¡s
, 
_WIFSIGNALED
=
os
.
WIFSIGNALED
,

1249 
_WTERMSIG
=
os
.
WTERMSIG
, 
_WIFEXITED
=os.
WIFEXITED
,

1250 
_WEXITSTATUS
=
os
.
WEXITSTATUS
):

1251 #Thi 
m‘hod
 
is
 
	`ÿÎed
 (
šdœeùly
è
by
 
__d–__
, 
so
 
™
 
ÿÂÙ


1252 #»ã¸
to
 
ªythšg
 
outside
 
of
 
™s
 
loÿl
 
scİe
."""

1253 
	$_WIFSIGNALED
(
¡s
):

1254 
£lf
.
»tuºcode
 = -
	$_WTERMSIG
(
¡s
)

1255 
–if
 
	$_WIFEXITED
(
¡s
):

1256 
£lf
.
»tuºcode
 = 
	$_WEXITSTATUS
(
¡s
)

1258 #Should 
Ãv”
 
h­³n


1259 
¿i£
 
	`RuÁimeE¼Ü
("Unknown childƒxit status!")

1262 
def
 
	$_š‹º®_pŞl
(
£lf
, 
_d—d¡©e
=
NÚe
, 
_wa™pid
=
os
.
wa™pid
,

1263 
_WNOHANG
=
os
.
WNOHANG
, 
_os_”rÜ
=os.
”rÜ
):

1265 
©Œibu‹
.

1267 
This
 
m‘hod
 
is
 
ÿÎed
 
by
 
__d–__
, 
so
 
™
 
ÿÂÙ
 
»ã»nû
 
ªythšg


1268 
outside
 
of
 
the
 
loÿl
 
	`scİe
 (
nÜ
 
ÿn
 
ªy
 
m‘hods
 
™
 
ÿÎs
).

1271 
£lf
.
»tuºcode
 
is
 
NÚe
:

1272 
Œy
:

1273 
pid
, 
¡s
 = 
	$_wa™pid
(
£lf
.
pid
, 
_WNOHANG
)

1274 
pid
 =ğ
£lf
.pid:

1275 
£lf
.
	$_hªdË_ex™¡©us
(
¡s
)

1276 
exû±
 
_os_”rÜ
:

1277 
_d—d¡©e
 
is
 
nÙ
 
NÚe
:

1278 
£lf
.
»tuºcode
 = 
_d—d¡©e


1279  
£lf
.
»tuºcode


1282 
def
 
	$wa™
(
£lf
):

1284 
©Œibu‹
."""

1285 
£lf
.
»tuºcode
 
is
 
NÚe
:

1286 
Œy
:

1287 
pid
, 
¡s
 = 
	$_ešŒ_»Œy_ÿÎ
(
os
.
wa™pid
, 
£lf
.
pid
, 0)

1288 
exû±
 
OSE¼Ü
, 
e
:

1289 
e
.
”ºo
 !ğ”ºo.
ECHILD
:

1290 
¿i£


1291 #Thi 
h­³ns
 
SIGCLD
 
is
 
£t
 
to
 
be
 
ignÜed
 
Ü
 
wa™šg


1292 #fÜ 
chd
 
´oûs£s
 
has
 
Ùh”wi£
 
b“n
 
di§bËd
 
our


1293 #´oûss. 
This
 
chd
 
is
 
d—d
, 
we
 
ÿn
't gethe status.

1294 
¡s
 = 0

1295 
£lf
.
	$_hªdË_ex™¡©us
(
¡s
)

1296  
£lf
.
»tuºcode


1299 
def
 
	$_communiÿ‹
(
£lf
, 
šput
):

1300 
£lf
.
¡dš
:

1301 #Flush 
¡dio
 
bufãr
. 
This
 
might
 
block
, 
the
 
u£r
 
has


1302 #b“À
wr™šg
 
to
 .
¡dš
 
š
 
ª
 
uncÚŒŞËd
 
çshiÚ
.

1303 
£lf
.
¡dš
.
	$æush
()

1304 
nÙ
 
šput
:

1305 
£lf
.
¡dš
.
	$şo£
()

1307 
_has_pŞl
:

1308 
¡dout
, 
¡d”r
 = 
£lf
.
	$_communiÿ‹_w™h_pŞl
(
šput
)

1310 
¡dout
, 
¡d”r
 = 
£lf
.
	$_communiÿ‹_w™h_£Ëù
(
šput
)

1312 #AÎ 
d©a
 
exchªged
. 
T¿n¦©e
 
li¡s
 
što
 
¡ršgs
.

1313 
¡dout
 
is
 
nÙ
 
NÚe
:

1314 
¡dout
 = ''.
	$još
(
¡dout
)

1315 
¡d”r
 
is
 
nÙ
 
NÚe
:

1316 
¡d”r
 = ''.
	$još
(
¡d”r
)

1318 #T¿n¦©
Ãwlšes
, 
»que¡ed
. 
We
 
ÿÂÙ
 
Ët
 
the
 
fe


1319 #objeù dØ
the
 
Œª¦©iÚ
: 
It
 
is
 
ba£d
 
Ú
 
¡dio
, 
which
 is

1320 #impossibË 
to
 
combše
 
w™h
 
	`£Ëù
 (
uÆess
 
fÜcšg
 
no


1322 
£lf
.
univ”§l_Ãwlšes
 
ªd
 
	`ha§‰r
(
fe
, 'newlines'):

1323 
¡dout
:

1324 
¡dout
 = 
£lf
.
	$_Œª¦©e_Ãwlšes
(
¡dout
)

1325 
¡d”r
:

1326 
¡d”r
 = 
£lf
.
	$_Œª¦©e_Ãwlšes
(
¡d”r
)

1328 
£lf
.
	$wa™
()

1329  (
¡dout
, 
¡d”r
)

1332 
def
 
	$_communiÿ‹_w™h_pŞl
(
£lf
, 
šput
):

1333 
¡dout
 = 
NÚe
 #Return

1334 
¡d”r
 = 
NÚe
 #Return

1335 
fd2fe
 = {
	}
}

1336 
fd2ouut
 = {}

1338 
pŞËr
 = 
£Ëù
.
	$pŞl
()

1339 
def
 
	$»gi¡”_ªd_­³nd
(
fe_obj
, 
ev’tmask
):

1340 
pŞËr
.(
fe_obj
.
	`f’o
(), 
ev’tmask
)

1341 
fd2fe
[
fe_obj
.
	`f’o
()] = file_obj

1343 
def
 
	$şo£_uÄegi¡”_ªd_»move
(
fd
):

1344 
pŞËr
.
	$uÄegi¡”
(
fd
)

1345 
fd2fe
[
fd
].
	$şo£
()

1346 
fd2fe
.
	$pİ
(
fd
)

1348 
£lf
.
¡dš
 
ªd
 
šput
:

1349 
	$»gi¡”_ªd_­³nd
(
£lf
.
¡dš
, 
£Ëù
.
POLLOUT
)

1351 
£Ëù_POLLIN_POLLPRI
 = 
£Ëù
.
POLLIN
 | s–eù.
POLLPRI


1352 
£lf
.
¡dout
:

1353 
	$»gi¡”_ªd_­³nd
(
£lf
.
¡dout
, 
£Ëù_POLLIN_POLLPRI
)

1354 
fd2ouut
[
£lf
.
¡dout
.
	`f’o
()] = stdout = []

1355 
£lf
.
¡d”r
:

1356 
	$»gi¡”_ªd_­³nd
(
£lf
.
¡d”r
, 
£Ëù_POLLIN_POLLPRI
)

1357 
fd2ouut
[
£lf
.
¡d”r
.
	`f’o
()] = stderr = []

1359 
šput_off£t
 = 0

1360 
fd2fe
:

1361 
Œy
:

1362 
»ady
 = 
pŞËr
.
	$pŞl
()

1363 
exû±
 
£Ëù
.
”rÜ
, 
e
:

1364 
e
.
¬gs
[0] =ğ
”ºo
.
EINTR
:

1366 
¿i£


1368 
fd
, 
mode
 
š
 
»ady
:

1369 
mode
 & 
£Ëù
.
POLLOUT
:

1370 
chunk
 = 
šput
[
šput_off£t
 : iÅut_off£ˆ+ 
_PIPE_BUF
]

1371 
Œy
:

1372 
šput_off£t
 +ğ
os
.
	$wr™e
(
fd
, 
chunk
)

1373 
exû±
 
OSE¼Ü
, 
e
:

1374 
e
.
”ºo
 =ğ”ºo.
EPIPE
:

1375 
	$şo£_uÄegi¡”_ªd_»move
(
fd
)

1377 
¿i£


1379 
šput_off£t
 >ğ
	$Ën
(
šput
):

1380 
	$şo£_uÄegi¡”_ªd_»move
(
fd
)

1381 
–if
 
mode
 & 
£Ëù_POLLIN_POLLPRI
:

1382 
d©a
 = 
os
.
	$»ad
(
fd
, 4096)

1383 
nÙ
 
d©a
:

1384 
	$şo£_uÄegi¡”_ªd_»move
(
fd
)

1385 
fd2ouut
[
fd
].
	$­³nd
(
d©a
)

1387 #IgnÜ
hªg
 
up
 
Ü
 
”rÜs
.

1388 
	$şo£_uÄegi¡”_ªd_»move
(
fd
)

1390  (
¡dout
, 
¡d”r
)

1393 
def
 
	$_communiÿ‹_w™h_£Ëù
(
£lf
, 
šput
):

1394 
»ad_£t
 = []

1395 
wr™e_£t
 = []

1396 
¡dout
 = 
NÚe
 #Return

1397 
¡d”r
 = 
NÚe
 #Return

1399 
£lf
.
¡dš
 
ªd
 
šput
:

1400 
wr™e_£t
.
	$­³nd
(
£lf
.
¡dš
)

1401 
£lf
.
¡dout
:

1402 
»ad_£t
.
	$­³nd
(
£lf
.
¡dout
)

1403 
¡dout
 = []

1404 
£lf
.
¡d”r
:

1405 
»ad_£t
.
	$­³nd
(
£lf
.
¡d”r
)

1406 
¡d”r
 = []

1408 
šput_off£t
 = 0

1409 
»ad_£t
 
Ü
 
wr™e_£t
:

1410 
Œy
:

1411 
¾i¡
, 
wli¡
, 
xli¡
 = 
£Ëù
.
	$£Ëù
(
»ad_£t
, 
wr™e_£t
, [])

1412 
exû±
 
£Ëù
.
”rÜ
, 
e
:

1413 
e
.
¬gs
[0] =ğ
”ºo
.
EINTR
:

1415 
¿i£


1417 
£lf
.
¡dš
 
š
 
wli¡
:

1418 
chunk
 = 
šput
[
šput_off£t
 : iÅut_off£ˆ+ 
_PIPE_BUF
]

1419 
Œy
:

1420 
by‹s_wr™‹n
 = 
os
.
	`wr™e
(
£lf
.
¡dš
.
	`f’o
(), 
chunk
)

1421 
exû±
 
OSE¼Ü
, 
e
:

1422 
e
.
”ºo
 =ğ”ºo.
EPIPE
:

1423 
£lf
.
¡dš
.
	$şo£
()

1424 
wr™e_£t
.
	$»move
(
£lf
.
¡dš
)

1426 
¿i£


1428 
šput_off£t
 +ğ
by‹s_wr™‹n


1429 
šput_off£t
 >ğ
	$Ën
(
šput
):

1430 
£lf
.
¡dš
.
	$şo£
()

1431 
wr™e_£t
.
	$»move
(
£lf
.
¡dš
)

1433 
£lf
.
¡dout
 
š
 
¾i¡
:

1434 
d©a
 = 
os
.
	`»ad
(
£lf
.
¡dout
.
	`f’o
(), 1024)

1435 
d©a
 == "":

1436 
£lf
.
¡dout
.
	$şo£
()

1437 
»ad_£t
.
	$»move
(
£lf
.
¡dout
)

1438 
¡dout
.
	$­³nd
(
d©a
)

1440 
£lf
.
¡d”r
 
š
 
¾i¡
:

1441 
d©a
 = 
os
.
	`»ad
(
£lf
.
¡d”r
.
	`f’o
(), 1024)

1442 
d©a
 == "":

1443 
£lf
.
¡d”r
.
	$şo£
()

1444 
»ad_£t
.
	$»move
(
£lf
.
¡d”r
)

1445 
¡d”r
.
	$­³nd
(
d©a
)

1447  (
¡dout
, 
¡d”r
)

1450 
def
 
	$£nd_sigÇl
(
£lf
, 
sig
):

1453 
os
.
	$kl
(
£lf
.
pid
, 
sig
)

1455 
def
 
	$‹rmš©e
(
£lf
):

1458 
£lf
.
	$£nd_sigÇl
(
sigÇl
.
SIGTERM
)

1460 
def
 
	$kl
(
£lf
):

1463 
£lf
.
	$£nd_sigÇl
(
sigÇl
.
SIGKILL
)

1466 
def
 
	$_demo_posix
():

1467 #
#Exam¶1: 
Sim¶e
 
»dœeùiÚ
: 
G‘
 
´oûss
 
li¡


1468 #
 = Pİ’(["ps"], stdout=PIPE).communiÿ‹()[0]

1469 
´št
 "Process†ist:"

1470 
´št
 
¶i¡


1472 #
#Exam¶2: 
Chªge
 
uid
 
befÜe
 
executšg
 
chd


1473 #

os
.
	`g‘uid
() == 0:

1474 
p
 = 
	`Pİ’
(["id"], 
´“xec_â
=
Ïmbda
: 
os
.
	$£tuid
(100))

1475 
p
.
	$wa™
()

1477 #
#Exam¶3: 
CÚÃùšg
 
£v”®
 
sub´oûs£s


1478 #
 "Lookšg fÜ 'hda'..."

1479 
p1
 = 
	`Pİ’
(["dmesg"], 
¡dout
=
PIPE
)

1480 
p2
 = 
	`Pİ’
(["g»p", "hda"], 
¡dš
=
p1
.
¡dout
, stdout=
PIPE
)

1481 
´št
 
	`»´
(
p2
.
	`communiÿ‹
()[0])

1483 #
#Exam¶4: 
C©ch
 
executiÚ
 
”rÜ


1484 #


1485 
´št
 "Trying‡ weird file..."

1486 
Œy
:

1487 
´št
 
	`Pİ’
(["/this/·th/dÛs/nÙ/exi¡"]).
	$communiÿ‹
()

1488 
exû±
 
OSE¼Ü
, 
e
:

1489 
e
.
”ºo
 =ğ”ºo.
ENOENT
:

1490 
´št
 "The file didn'tƒxist. Ihought so..."

1491 
´št
 "Childraceback:"

1492 
´št
 
e
.
chd_Œaûback


1494 
´št
 "E¼Ü", 
e
.
”ºo


1496 
´št
 >>
sys
.
¡d”r
, "Gosh. Noƒrror."

1499 
def
 
	$_demo_wšdows
():

1500 #
#Exam¶1: 
CÚÃùšg
 
£v”®
 
sub´oûs£s


1501 #
 "Lookšg fÜ 'PROMPT' iÀ£ˆouut..."

1502 
p1
 = 
	`Pİ’
("£t", 
¡dout
=
PIPE
, 
sh–l
=
True
)

1503 
p2
 = 
	`Pİ’
('fšd "PROMPT"', 
¡dš
=
p1
.
¡dout
, stdout=
PIPE
)

1504 
´št
 
	`»´
(
p2
.
	`communiÿ‹
()[0])

1506 #
#Exam¶2: 
Sim¶e
 
executiÚ
 
of
 
´og¿m


1507 #
 "Executšg c®c..."

1508 
p
 = 
	`Pİ’
("calc")

1509 
p
.
	$wa™
()

1512 
__Çme__
 == "__main__":

1513 
mswšdows
:

1514 
	$_demo_wšdows
()

1516 
	`_demo_posix
()

	@trunk/objs/CherryPy-3.2.4/cherrypy/_cpconfig.py

2 
CÚfigu¿tiÚ
 
sy¡em
 
	gCh”ryPy
.

4 
CÚfigu¿tiÚ
 
š
 
Ch”ryPy
 
is
 
im¶em’‹d
 
vŸ
 
	gdiùiÚ¬›s
. 
Keys
 
¬e
 
¡ršgs


5 
which
 
Çme
 
the
 
m­³d
 
	gv®ue
, which 
may
 
be
 
of
 
ªy
 
	gty³
.

8 
	gArch™eùu»


11 
Ch”ryPy
 
Reque¡s
 
¬e
 
·¹
 
of
 
ª
 
	gAµliÿtiÚ
, 
which
 
runs
 
š
 
a
 
glob®
 
	gcÚ‹xt
,

12 
ªd
 
cÚfigu¿tiÚ
 
d©a
 
may
 
­¶y
 
to
 
ªy
 
of
 
tho£
 
th»e
 
	gscİes
:

14 
Glob®


15 
CÚfigu¿tiÚ
 
’Œ›s
 
which
 
­¶y
 
ev”ywh”e
 
¬e
 
¡Üed
 
š


16 
ch”rypy
.
cÚfig
.

18 
AµliÿtiÚ


19 
EÁr›s
 
which
 
­¶y
 
to
 
—ch
 
mouÁed
 
­¶iÿtiÚ
 
¬e
 
¡Üed


20 
Ú
 
the
 
AµliÿtiÚ
 
objeù
 
™£lf
, 
	gas
 '­p.cÚfig'. 
This
 
is
 
a
 
	gtwo
-
Ëv–


21 
diù
 
wh”e
 
—ch
 
key
 
is
 
a
 
	g·th
, 
	gÜ
 "»ÏtivURL" (
	gexam¶e
, "/" or

22 "/·th/to/my/·ge"), 
ªd
 
—ch
 
v®ue
 
is
 
a
 
cÚfig
 
	gdiù
. 
	gUsu®ly
, 
this


23 
d©a
 
is
 
´ovided
 
š
 
the
 
ÿÎ
 
to
 
	gŒ“
.
mouÁ
(
roÙ
(), 
cÚfig
=
cÚf
),

24 
®though
 
you
 
may
 
®so
 
u£
 
	g­p
.
m”ge
(
cÚf
).

26 
Reque¡


27 
Each
 
Reque¡
 
objeù
 
pos£s£s
 
a
 
	gsšgË
 'Reque¡.cÚfig' 
	gdiù
.

28 
E¬ly
 
š
 
the
 
»que¡
 
	g´oûss
, 
this
 
diù
 
is
 
pİuÏ‹d
 
by
 
m”gšg
 
glob®


29 
cÚfig
 
	g’Œ›s
, 
AµliÿtiÚ
 
’Œ›s
 (
who£
 
·th
 
equ®s
 
Ü
 
is
 
a
 
·»Á


30 
of
 
Reque¡
.
·th_šfo
), 
ªd
 
ªy
 
cÚfig
 
acquœed
 
lookšg
 
up
 
the


31 
·ge
 
hªdËr
 (
£e
 
Ãxt
).

34 
	gDeş¬©iÚ


37 
CÚfigu¿tiÚ
 
d©a
 
may
 
be
 
suµl›d
 
as
 
a
 
PythÚ
 
	gdiùiÚ¬y
,‡ ¨
	gf’ame
,

38 
Ü
 
as
 
ª
 
İ’
 
fe
 
	gobjeù
. 
Wh’
 
you
 
suµly
 
a
 
f’ame
 o¸
	gfe
, 
Ch”ryPy


39 
u£s
 
	gPythÚ
's builtin ConfigParser; you declare Application config by

40 
wr™šg
 
—ch
 
·th
 
as
 
a
 
£ùiÚ
 
	gh—d”
::

42 [/
·th
/
to
/
my
/
·ge
]

43 
»que¡
.
¡»am
 = 
True


45 
To
 
deş¬e
 
glob®
 
cÚfigu¿tiÚ
 
’Œ›s
, 
¶aû
 
them
 
š
 
	ga
 [glob®] 
	g£ùiÚ
.

47 
You
 
may
 
®so
 
deş¬e
 
cÚfig
 
’Œ›s
 
dœeùly
 
Ú
 
the
 
şas£s
 
ªd
 
	gm‘hods


48 (
·ge
 
	ghªdËrs
è
th©
 
make
 
up
 
your
 
Ch”ryPy
 
­¶iÿtiÚ
 
vŸ
 
	gthe
 ``
	g_ı_cÚfig
``

49 
	g©Œibu‹
. 
FÜ
 
	gexam¶e
::

51 
şass
 
Demo
:

52 
_ı_cÚfig
 = {'toŞs.gz.Ú': 
True
}

54 
def
 
	$šdex
(
£lf
):

56 
šdex
.
expo£d
 = 
True


57 
šdex
.
_ı_cÚfig
 = {'»que¡.show_Œaûbacks': 
F®£
}

59 .. 
nÙe
::

61 
This
 
behaviÜ
 
is
 
Úly
 
gu¬ª‹ed
 
the
  
di¥©ch”
.

62 
Oth”
 
di¥©ch”s
 
may
 
have
 
difã»Á
 
»¡riùiÚs
 
Ú
 
wh”e


63 
you
 
ÿn
 
©ch
 
_ı_cÚfig
 
©Œibu‹s
.

66 
Name¥aûs


69 
CÚfigu¿tiÚ
 
keys
 
¬e
 
£·¿‹d
 
što
 
Çme¥aûs
 
by
 
the
 
fœ¡
 "." 
š
h
key
.

70 
Cu¼’t
 
Çme¥aûs
:

72 
’gše


73 
CÚŒŞs
 
the
 '­¶iÿtiÚƒngše', 
šşudšg
 
	gautÜ–ßd
.

74 
The£
 
ÿn
 
Úly
 
be
 
deş¬ed
 
š
 
the
 
glob®
 
	gcÚfig
.

76 
Œ“


77 
G¿ás
 
	gch”rypy
.
AµliÿtiÚ
 
objeùs
 
Úto
 ch”rypy.
	gŒ“
.

78 
The£
 
ÿn
 
Úly
 
be
 
deş¬ed
 
š
 
the
 
glob®
 
	gcÚfig
.

80 
hooks


81 
Deş¬es
 
add™iÚ®
 
	g»que¡
-
´oûssšg
 
	gfunùiÚs
.

83 
log


84 
CÚfigu»s
 
the
 
loggšg
 
—ch
 
	g­¶iÿtiÚ
.

85 
The£
 
ÿn
 
Úly
 
be
 
deş¬ed
 
š
 
the
 
glob®
 
	gÜ
 / 
	gcÚfig
.

87 
»que¡


88 
Adds
 
©Œibu‹s
 
to
 
—ch
 
	gReque¡
.

90 
»¥Ú£


91 
Adds
 
©Œibu‹s
 
to
 
—ch
 
	gRe¥Ú£
.

93 
£rv”


94 
CÚŒŞs
 
the
  
HTTP
 
£rv”
 
vŸ
 
	gch”rypy
.
	g£rv”
.

95 
The£
 
ÿn
 
Úly
 
be
 
deş¬ed
 
š
 
the
 
glob®
 
	gcÚfig
.

97 
toŞs


98 
Runs
 
ªd
 
cÚfigu»s
 
add™iÚ®
 
	g»que¡
-
´oûssšg
 
	g·ckages
.

100 
wsgi


101 
Adds
 
WSGI
 
middËw¬e
 
to
 
ª
 
	gAµliÿtiÚ
's "pipeline".

102 
The£
 
ÿn
 
Úly
 
be
 
deş¬ed
 
š
 
the
 
	g­p
's„oot config ("/").

104 
check”


105 
CÚŒŞs
 
	gthe
 'check”', 
which
 
looks
 
commÚ
 
”rÜs
 
š


106 
­p
 
	$¡©e
 (
šşudšg
 
cÚfig
è
wh’
 
the
 
’gše
 
¡¬ts
.

107 
Glob®
 
cÚfig
 
Úly
.

109 
The
 
Úly
 
key
 
th©
 
dÛs
 
nÙ
 
exi¡
 
š
 
a
 
Çme¥aû
 
is
 
the
 "’vœÚm’t" 
’Œy
.

110 
This
 
¥ecŸl
 
’Œy
 'impÜts' 
Ùh”
 
cÚfig
 
’Œ›s
 
äom
 
a
 
‹m¶©e
 
¡Üed
 
š


111 
ch”rypy
.
_ıcÚfig
.
’vœÚm’ts
[
’vœÚm’t
]. 
It
 
Úly
 
­¶›s
 
to
 
the
 
glob®


112 
cÚfig
, 
ªd
 
Úly
 
wh’
 
you
 
u£
 
ch”rypy
.cÚfig.
upd©e
.

114 
You
 
ÿn
 
defše
 
your
 
own
 
Çme¥aûs
 
to
 
be
 
ÿÎed
 
©
 
the
 
Glob®
, 
AµliÿtiÚ
,

115 
Ü
 
Reque¡
 
Ëv–
, 
by
 
addšg
 
a
 
Çmed
 
hªdËr
 
to
 
ch”rypy
.
cÚfig
.
Çme¥aûs
,

116 
­p
.
Çme¥aûs
, 
Ü
‡µ.
»que¡_şass
.Çme¥aûs. 
The
 
Çme
 
ÿn


117 
be
 
ªy
 
¡ršg
, 
ªd
 
the
 
hªdËr
 
mu¡
 b
e™h”
 
a
 
ÿÎabË
 
Ü
 
	$a
 (
PythÚ
 2.5

118 
¡yË
è
cÚ‹xt
 
mªag”
.

121 
impÜt
 
ch”rypy


122 
äom
 
ch”rypy
.
_ıcom·t
 
impÜt
 
£t
, 
ba£¡ršg


123 
äom
 
ch”rypy
.
lib
 
impÜt
 
»´cÚf


125 #D•»ÿ‹d 
š
 
Ch”ryPy
 3.2--
»move
 in 3.3

126 
Name¥aûS‘
 = 
»´cÚf
.NamespaceSet

128 
def
 
	$m”ge
(
ba£
, 
Ùh”
):

131 
If
 
the
 
giv’
 
cÚfig
 
is
 
a
 
f’ame
, 
™
 
wl
 
be
 
­³nded
 
to


132 
the
 
li¡
 
of
 
fes
 
to
 
mÚ™Ü
 "autÜ–ßd" 
chªges
.

134 
	$isš¡ªû
(
Ùh”
, 
ba£¡ršg
):

135 
ch”rypy
.
’gše
.
autÜ–ßd
.
fes
.
	$add
(
Ùh”
)

137 #Lßd 
Ùh”
 
što
 
ba£


138 
£ùiÚ
, 
v®ue_m­
 
š
 
»´cÚf
.
	`as_diù
(
Ùh”
).
	$™ems
():

139 
nÙ
 
	$isš¡ªû
(
v®ue_m­
, 
diù
):

140 
¿i£
 
	`V®ueE¼Ü
(

145 
ba£
.
	`£tdeçuÉ
(
£ùiÚ
, {
	}
}).
	$upd©e
(
v®ue_m­
)

148 
şass
 
	$CÚfig
(
»´cÚf
.
CÚfig
):

151 
def
 
	$upd©e
(
£lf
, 
cÚfig
):

153 
	$isš¡ªû
(
cÚfig
, 
ba£¡ršg
):

155 
ch”rypy
.
’gše
.
autÜ–ßd
.
fes
.
	$add
(
cÚfig
)

156 
»´cÚf
.
CÚfig
.
	$upd©e
(
£lf
, 
cÚfig
)

158 
def
 
	$_­¶y
(
£lf
, 
cÚfig
):

160 
	`isš¡ªû
(
cÚfig
.
	`g‘
("glob®", 
NÚe
), 
diù
):

161 
	`Ën
(
cÚfig
) > 1:

162 
ch”rypy
.
check”
.
glob®_cÚfig_cÚšed_·ths
 = 
True


163 
cÚfig
 = config["global"]

164 'toŞs.¡©icdœ.dœ' 
š
 
cÚfig
:

165 
cÚfig
['tools.staticdir.section'] = "global"

166 
»´cÚf
.
CÚfig
.
	$_­¶y
(
£lf
, 
cÚfig
)

168 
def
 
	$__ÿÎ__
(
£lf
, *
¬gs
, **
kw¬gs
):

170 
¬gs
:

171 
¿i£
 
	`Ty³E¼Ü
(

174 
def
 
	$toŞ_decÜ©Ü
(
f
):

175 
nÙ
 
	`ha§‰r
(
f
, "_cp_config"):

176 
f
.
_ı_cÚfig
 = {
	}
}

177 
k
, 
v
 
š
 
	gkw¬gs
.
	$™ems
():

178 
f
.
_ı_cÚfig
[
k
] = 
v


179  
f


180  
toŞ_decÜ©Ü


183 
CÚfig
.
’vœÚm’ts
 =ƒnvironments = {

185 '’gše.autÜ–ßd_Ú': 
F®£
,

186 'check”.Ú': 
F®£
,

187 'toŞs.log_h—d”s.Ú': 
F®£
,

188 '»que¡.show_Œaûbacks': 
F®£
,

189 '»que¡.show_mism©ched_·¿ms': 
F®£
,

192 '’gše.autÜ–ßd_Ú': 
F®£
,

193 'check”.Ú': 
F®£
,

194 'toŞs.log_h—d”s.Ú': 
F®£
,

195 '»que¡.show_Œaûbacks': 
F®£
,

196 '»que¡.show_mism©ched_·¿ms': 
F®£
,

197 'log.sü“n': 
F®£
,

200 #FÜ 
u£
 
w™h
 
Ch”ryPy
 
embedded
 
š
 
ªÙh”
 
d•loym’t
 
¡ack
.

201 '’gše.autÜ–ßd_Ú': 
F®£
,

202 'check”.Ú': 
F®£
,

203 'toŞs.log_h—d”s.Ú': 
F®£
,

204 '»que¡.show_Œaûbacks': 
F®£
,

205 '»que¡.show_mism©ched_·¿ms': 
F®£
,

206 'log.sü“n': 
F®£
,

207 '’gše.SIGHUP': 
NÚe
,

208 '’gše.SIGTERM': 
NÚe
,

211 '’gše.autÜ–ßd_Ú': 
F®£
,

212 'check”.Ú': 
F®£
,

213 'toŞs.log_h—d”s.Ú': 
F®£
,

214 '»que¡.show_Œaûbacks': 
True
,

215 '»que¡.show_mism©ched_·¿ms': 
True
,

216 'log.sü“n': 
F®£
,

218 
	}
}

221 
def
 
	$_£rv”_Çme¥aû_hªdËr
(
k
, 
v
):

222 """CÚfig hªdË¸fÜh"
£rv”
"‚amespace."""

223 
©oms
 = 
k
.
	`¥l™
(".", 1)

224 
	`Ën
(
©oms
) > 1:

225 #S³cŸl-
cÚfig
 
keys
 
of
 
the
 
fÜm
 'server.servername.socket_port'

226 #tØ
cÚfigu»
 
add™iÚ®
 
HTTP
 
£rv”s
.

227 
nÙ
 
	`ha§‰r
(
ch”rypy
, "servers"):

228 
ch”rypy
.
£rv”s
 = {
	}
}

230 
£rv”Çme
, 
	gk
 = 
©oms


231 
£rv”Çme
 
nÙ
 
š
 
ch”rypy
.
£rv”s
:

232 
äom
 
ch”rypy
 
impÜt
 
_ı£rv”


233 
ch”rypy
.
£rv”s
[
£rv”Çme
] = 
_ı£rv”
.
	$S”v”
()

234 #OÀ
by
 , 
but
 'Ú = F®£' 
ÿn
 
unsubsüibe
 
	`™
 (
£e
 
b–ow
).

235 
ch”rypy
.
£rv”s
[
£rv”Çme
].
	$subsüibe
()

237 
k
 == 'on':

238 
v
:

239 
ch”rypy
.
£rv”s
[
£rv”Çme
].
	$subsüibe
()

241 
ch”rypy
.
£rv”s
[
£rv”Çme
].
	$unsubsüibe
()

243 
	$£‰r
(
ch”rypy
.
£rv”s
[
£rv”Çme
], 
k
, 
v
)

245 
	$£‰r
(
ch”rypy
.
£rv”
, 
k
, 
v
)

246 
CÚfig
.
Çme¥aûs
["£rv”"] = 
_£rv”_Çme¥aû_hªdËr


248 
def
 
	$_’gše_Çme¥aû_hªdËr
(
k
, 
v
):

249 """Backw¬d com·tib™y hªdË¸fÜh"
’gše
"‚amespace."""

250 
’gše
 = 
ch”rypy
.engine

251 
k
 == 'autoreload_on':

252 
v
:

253 
’gše
.
autÜ–ßd
.
	$subsüibe
()

255 
’gše
.
autÜ–ßd
.
	$unsubsüibe
()

256 
–if
 
k
 == 'autoreload_frequency':

257 
’gše
.
autÜ–ßd
.
äequ’cy
 = 
v


258 
–if
 
k
 == 'autoreload_match':

259 
’gše
.
autÜ–ßd
.
m©ch
 = 
v


260 
–if
 
k
 == 'reload_files':

261 
’gše
.
autÜ–ßd
.
fes
 = 
	$£t
(
v
)

262 
–if
 
k
 == 'deadlock_poll_freq':

263 
’gše
.
timeout_mÚ™Ü
.
äequ’cy
 = 
v


264 
–if
 
k
 == 'SIGHUP':

265 
’gše
.
li¡’”s
['SIGHUP'] = 
	$£t
([
v
])

266 
–if
 
k
 == 'SIGTERM':

267 
’gše
.
li¡’”s
['SIGTERM'] = 
	$£t
([
v
])

268 
–if
 "." 
š
 
k
:

269 
¶ugš
, 
©ŒÇme
 = 
k
.
	`¥l™
(".", 1)

270 
¶ugš
 = 
	$g‘©Œ
(
’gše
, 
¶ugš
)

271 
©ŒÇme
 == 'on':

272 
v
 
ªd
 
	`ha§‰r
(
	`g‘©Œ
(
¶ugš
, 'subsüibe', 
NÚe
), '__call__'):

273 
¶ugš
.
	$subsüibe
()

275 
	$–if
 (
nÙ
 
v
è
ªd
 
	`ha§‰r
(
	`g‘©Œ
(
¶ugš
, 'unsubsüibe', 
NÚe
), '__call__'):

276 
¶ugš
.
	$unsubsüibe
()

278 
	$£‰r
(
¶ugš
, 
©ŒÇme
, 
v
)

280 
	$£‰r
(
’gše
, 
k
, 
v
)

281 
CÚfig
.
Çme¥aûs
["’gše"] = 
_’gše_Çme¥aû_hªdËr


284 
def
 
	$_Œ“_Çme¥aû_hªdËr
(
k
, 
v
):

286 
	$isš¡ªû
(
v
, 
diù
):

287 
süt_Çme
, 
­p
 
š
 
v
.
	$™ems
():

288 
ch”rypy
.
Œ“
.
	$g¿á
(
­p
, 
süt_Çme
)

289 
ch”rypy
.
’gše
.
	`log
("MouÁed: % Ú %s" % (
­p
, 
süt_Çme
 
Ü
 "/"))

291 
ch”rypy
.
Œ“
.
	$g¿á
(
v
, v.
süt_Çme
)

292 
ch”rypy
.
’gše
.
	`log
("MouÁed: % Ú %s" % (
v
, v.
süt_Çme
 
Ü
 "/"))

293 
CÚfig
.
Çme¥aûs
["Œ“"] = 
_Œ“_Çme¥aû_hªdËr


	@trunk/objs/CherryPy-3.2.4/cherrypy/_cpdispatch.py

3 
	gA
 'di¥©ch”' 
is
 
the
 
objeù
 
which
 
looks
 
up
 
	gthe
 '·ghªdËr' 
ÿÎabË


4 
ªd
 
cŞËùs
 
cÚfig
 
the
 
cu¼’t
 
»que¡
 
ba£d
 
Ú
h
	g·th_šfo
, 
Ùh”


5 
»que¡
 
	g©Œibu‹s
, 
ªd
 
the
 
­¶iÿtiÚ
 
	g¬ch™eùu»
. 
The
 
cÜe
 
ÿÎs
he

6 
di¥©ch”
 
as
 
—¾y
‡ 
	gpossibË
, 
·ssšg
 
™
 
	ga
 '·th_šfo' 
	g¬gum’t
.

8 
The
  
di¥©ch”
 
discov”s
 
the
 
·ge
 
hªdËr
 
by
 
m©chšg
 
·th_šfo


9 
to
 
a
 
h›¿rchiÿl
 
¬¿ngem’t
 
of
 
	gobjeùs
, 
¡¬tšg
 
©
 
	g»que¡
.
	g­p
.
	groÙ
.

12 
impÜt
 
¡ršg


13 
impÜt
 
sys


14 
impÜt
 
ty³s


15 
	gŒy
:

16 
şas¡y³
 = (
ty³
, 
	gty³s
.
	gCÏssTy³
)

17 
exû±
 
	gA‰ribu‹E¼Ü
:

18 
şas¡y³
 = 
ty³


20 
impÜt
 
ch”rypy


21 
äom
 
ch”rypy
.
_ıcom·t
 
impÜt
 
£t


24 
şass
 
	$PageHªdËr
(
objeù
):

27 
def
 
	$__š™__
(
£lf
, 
ÿÎabË
, *
¬gs
, **
kw¬gs
):

28 
£lf
.
ÿÎabË
 = callable

29 
£lf
.
¬gs
 =‡rgs

30 
£lf
.
kw¬gs
 = kwargs

32 
def
 
	$__ÿÎ__
(
£lf
):

33 
Œy
:

34  
£lf
.
	$ÿÎabË
(*
£lf
.
¬gs
, **£lf.
kw¬gs
)

35 
exû±
 
Ty³E¼Ü
:

36 
x
 = 
sys
.
	`exc_šfo
()[1]

37 
Œy
:

38 
	$‹¡_ÿÎabË_¥ec
(
£lf
.
ÿÎabË
, s–f.
¬gs
, s–f.
kw¬gs
)

39 
exû±
 
ch”rypy
.
HTTPE¼Ü
:

40 
¿i£
 
sys
.
	`exc_šfo
()[1]

41 
exû±
:

42 
¿i£
 
x


43 
¿i£


46 
def
 
	$‹¡_ÿÎabË_¥ec
(
ÿÎabË
, 
ÿÎabË_¬gs
, 
ÿÎabË_kw¬gs
):

48 
In¥eù
 
ÿÎabË
 
ªd
 
‹¡
 
to
 
£e
 
the
 
giv’
 
¬gs
 
¬e
 
su™abË
 
™
.

50 
Wh’
 
ª
 
”rÜ
 
occurs
 
duršg
 
the
 
hªdËr
's invoking stagehere‡re 2

51 
”rÚeous
 
ÿ£s
:

52 1. 
Too
 
mªy
 
·¿m‘”s
 
·s£d
 
to
 
a
 
funùiÚ
 
which
 
dÛ¢
't define

53 
Úe
 
of
 *
¬gs
 
Ü
 **
kw¬gs
.

54 2. 
Too
 
l™e
 
·¿m‘”s
 
¬e
 
·s£d
 
to
 
the
 
funùiÚ
.

56 
Th”e
 
¬e
 3 
sourûs
 
of
 
·¿m‘”s
 
to
 
a
 
ch”rypy
 
hªdËr
.

57 1. 
qu”y
 
¡ršg
 
·¿m‘”s
 
¬e
 
·s£d
 
as
 
keywÜd
…¬am‘” 
to
 
the
 
hªdËr
.

58 2. 
body
 
·¿m‘”s
 
¬e
 
®so
 
·s£d
 
as
 
keywÜd
…arameters.

59 3. 
wh’
 
·¹Ÿl
 
m©chšg
 
occurs
, 
the
 
fš®
 
·th
 
©oms
 
¬e
 
·s£d
 
as


60 
pos™iÚ®
 
¬gs
.

61 
BÙh
 
the
 
qu”y
 
¡ršg
 
ªd
 
·th
 
©oms
 
¬e
 
·¹
 
of
h
URI
. 
If
 
they
‡re

62 
šcÜ»ù
, 
th’
 
a
 404 
NÙ
 
Found
 
should
 
be
 
¿i£d
. 
CÚv”£ly
 
the
 
body


63 
·¿m‘”s
 
¬e
 
·¹
 
of
 
the
 
»que¡
; 
they
‡» 
šv®id
 
a
 400 
Bad
 
Reque¡
.

65 
show_mism©ched_·¿ms
 = 
	`g‘©Œ
(

66 
ch”rypy
.
£rvšg
.
»que¡
, 'show_mism©ched_·¿ms', 
F®£
)

67 
Œy
:

68 (
¬gs
, 
v¬¬gs
, 
v¬kw
, 
deçuÉs
èğ
š¥eù
.
	$g‘¬g¥ec
(
ÿÎabË
)

69 
exû±
 
Ty³E¼Ü
:

70 
	$isš¡ªû
(
ÿÎabË
, 
objeù
è
ªd
 
	`ha§‰r
(callable, '__call__'):

71 (
¬gs
, 
v¬¬gs
, 
v¬kw
, 
deçuÉs
èğ
š¥eù
.
	$g‘¬g¥ec
(
ÿÎabË
.
__ÿÎ__
)

73 #Ià
™
 
wa¢
't one of our ownypes,„e-raise

74 #th
Üigš®
 
”rÜ


75 
¿i£


77 
¬gs
 
ªd
‡rgs[0] == 'self':

78 
¬gs
 =‡rgs[1:]

80 
¬g_u§ge
 = 
	`diù
([(
¬g
, 0,è¬g 
š
 
¬gs
])

81 
v¬¬g_u§ge
 = 0

82 
v¬kw_u§ge
 = 0

83 
exŒa_kw¬gs
 = 
	$£t
()

85 
i
, 
v®ue
 
š
 
	$’um”©e
(
ÿÎabË_¬gs
):

86 
Œy
:

87 
¬g_u§ge
[
¬gs
[
i
]] += 1

88 
exû±
 
IndexE¼Ü
:

89 
v¬¬g_u§ge
 += 1

91 
key
 
š
 
ÿÎabË_kw¬gs
.
	$keys
():

92 
Œy
:

93 
¬g_u§ge
[
key
] += 1

94 
exû±
 
KeyE¼Ü
:

95 
v¬kw_u§ge
 += 1

96 
exŒa_kw¬gs
.
	$add
(
key
)

98 #figu» 
out
 
which
 
¬gs
 
have
 
deçuÉs
.

99 
¬gs_w™h_deçuÉs
 = 
¬gs
[-
	$Ën
(
deçuÉs
 
Ü
 []):]

100 
i
, 
v®
 
š
 
	$’um”©e
(
deçuÉs
 
Ü
 []):

101 #DeçuÉ 
ke
 
efãù
 
Úly
 
wh’
 
the
 
¬g
 
ha¢
't been used yet.

102 
¬g_u§ge
[
¬gs_w™h_deçuÉs
[
i
]] == 0:

103 
¬g_u§ge
[
¬gs_w™h_deçuÉs
[
i
]] += 1

105 
missšg_¬gs
 = []

106 
muÉË_¬gs
 = []

107 
key
, 
u§ge
 
š
 
¬g_u§ge
.
	$™ems
():

108 
u§ge
 == 0:

109 
missšg_¬gs
.
	$­³nd
(
key
)

110 
–if
 
u§ge
 > 1:

111 
muÉË_¬gs
.
	$­³nd
(
key
)

113 
missšg_¬gs
:

114 #IÀ
the
 
wh”e
h
m‘hod
 
®lows
 
body
 
¬gum’ts


115 #th”
¬e
 3 
pÙ’tŸl
 
”rÜs
:

116 #1. 
nÙ
 
’ough
 
qu”y
 
¡ršg
 
·¿m‘”s
 -> 404

117 #2. 
nÙ
 
’ough
 
body
 
·¿m‘”s
 -> 400

118 #3. 
nÙ
 
’ough
 
·th
 
	`·¹s
 (
·¹Ÿl
 
m©ches
) -> 404

119 #
#W
ÿn
't‡ctuallyell which case it is,

120 #sØ
I
'm„aising‡ 404 becausehat covers 2/3 ofhe

122 #
#IÀ
the
 
wh”e
h
m‘hod
 
dÛs
 
nÙ
 
®low
 
body


123 #¬gum’t 
™
's definitely‡ 404.

124 
mes§ge
 = 
NÚe


125 
show_mism©ched_·¿ms
:

126 
mes§ge
="Missšg…¬am‘”s: %s" % ",".
	$još
(
missšg_¬gs
)

127 
¿i£
 
ch”rypy
.
	$HTTPE¼Ü
(404, 
mes§ge
=message)

129 #th
exŒa
 
pos™iÚ®
 
¬gum’ts
 
come
 
äom
 
the
 
·th
 - 404 
NÙ
 
Found


130 
nÙ
 
v¬¬gs
 
ªd
 
v¬¬g_u§ge
 > 0:

131 
¿i£
 
ch”rypy
.
	$HTTPE¼Ü
(404)

133 
body_·¿ms
 = 
ch”rypy
.
£rvšg
.
»que¡
.
body
.
·¿ms
 
Ü
 {
	}
}

134 
body_·¿ms
 = 
£t
(body_·¿ms.
	$keys
())

135 
qs_·¿ms
 = 
	`£t
(
ÿÎabË_kw¬gs
.
	`keys
()è- 
body_·¿ms


137 
muÉË_¬gs
:

138 
qs_·¿ms
.
	`š‹r£ùiÚ
(
	$£t
(
muÉË_¬gs
)):

139 #Ià
ªy
 
of
 
the
 
muÉË
 
·¿m‘”s
 
ÿme
 
äom
h
qu”y
 
¡ršg
 
th’


141 
”rÜ
 = 404

143 #Oth”wi£ 
™
's‡ 400 Bad Request

144 
”rÜ
 = 400

146 
mes§ge
 = 
NÚe


147 
show_mism©ched_·¿ms
:

148 
mes§ge
="Multiple values for…arameters: "\

149 "%s" % ",".
	$još
(
muÉË_¬gs
)

150 
¿i£
 
ch”rypy
.
	$HTTPE¼Ü
(
”rÜ
, 
mes§ge
=message)

152 
nÙ
 
v¬kw
 
ªd
 
v¬kw_u§ge
 > 0:

154 #Ià
th”e
 
w”e
 
exŒa
 
qu”y
 
¡ršg
 
·¿m‘”s
, 
™
's‡ 404 Not Found

155 
exŒa_qs_·¿ms
 = 
	`£t
(
qs_·¿ms
).
	$š‹r£ùiÚ
(
exŒa_kw¬gs
)

156 
exŒa_qs_·¿ms
:

157 
mes§ge
 = 
NÚe


158 
show_mism©ched_·¿ms
:

159 
mes§ge
="Unexpected query string "\

160 "·¿m‘”s: %s" % ", ".
	$još
(
exŒa_qs_·¿ms
)

161 
¿i£
 
ch”rypy
.
	$HTTPE¼Ü
(404, 
mes§ge
=message)

163 #Ià
th”e
 
w”e
 
ªy
 
exŒa
 
body
 
·¿m‘”s
, 
™
's‡ 400 Not Found

164 
exŒa_body_·¿ms
 = 
	`£t
(
body_·¿ms
).
	$š‹r£ùiÚ
(
exŒa_kw¬gs
)

165 
exŒa_body_·¿ms
:

166 
mes§ge
 = 
NÚe


167 
show_mism©ched_·¿ms
:

168 
mes§ge
="Unexpected body…arameters: "\

169 "%s" % ", ".
	$još
(
exŒa_body_·¿ms
)

170 
¿i£
 
ch”rypy
.
	$HTTPE¼Ü
(400, 
mes§ge
=message)

173 
Œy
:

174 
impÜt
 
š¥eù


175 
exû±
 
ImpÜtE¼Ü
:

176 
‹¡_ÿÎabË_¥ec
 = 
Ïmbda
 
ÿÎabË
, 
¬gs
, 
kw¬gs
: 
NÚe


180 
şass
 
	$L©eP¬amPageHªdËr
(
PageHªdËr
):

182 
wªt
 
to
 
ÿ±u»
 
th©
 
diù
 
too
 
—¾y
; 
we
 wªˆtØ
give
 
toŞs
 
like
 
the


183 
decodšg
 
toŞ
 
a
 
chªû
 
to
 
modify
 
the
 
·¿ms
 
diù
 
š
-
b‘w“n
h
lookup


184 
of
 
the
 
hªdËr
 
ªd
h
aùu®
 
ÿÎšg
 oàthhªdËr. 
This
 
subşass


185 
kes
 
th©
 
što
 
accouÁ
, 
ªd
 
®lows
 
»que¡
.
·¿ms
 
to
 
be
 'bound†ate'

186 (
™
' mÜcom¶iÿ‹dhªh©, buˆth©'
s
 
the
 
efãù
).

189 
def
 
	$_g‘_kw¬gs
(
£lf
):

190 
kw¬gs
 = 
ch”rypy
.
£rvšg
.
»que¡
.
·¿ms
.
	$cİy
()

191 
£lf
.
_kw¬gs
:

192 
kw¬gs
.
	$upd©e
(
£lf
.
_kw¬gs
)

193  
kw¬gs


195 
def
 
	$_£t_kw¬gs
(
£lf
, 
kw¬gs
):

196 
£lf
.
_kw¬gs
 = 
kw¬gs


198 
kw¬gs
 = 
	`´İ”ty
(
_g‘_kw¬gs
, 
_£t_kw¬gs
,

199 
doc
='page handler kwargs (with '

203 
sys
.
v”siÚ_šfo
 < (3, 0):

204 
punùu©iÚ_to_und”scÜes
 = 
¡ršg
.
	`mak‘¿ns
(

205 
¡ršg
.
punùu©iÚ
, '_' * 
	$Ën
(
¡ršg
.
punùu©iÚ
))

206 
def
 
	$v®id©e_Œª¦©Ü
(
t
):

207 
nÙ
 
	$isš¡ªû
(
t
, 
¡r
è
Ü
 
	`Ën
(t) != 256:

208 
¿i£
 
	`V®ueE¼Ü
("Theranslate‡rgument must be‡ str of†en 256.")

210 
punùu©iÚ_to_und”scÜes
 = 
¡r
.
	`mak‘¿ns
(

211 
¡ršg
.
punùu©iÚ
, '_' * 
	$Ën
(
¡ršg
.
punùu©iÚ
))

212 
def
 
	$v®id©e_Œª¦©Ü
(
t
):

213 
nÙ
 
	$isš¡ªû
(
t
, 
diù
):

214 
¿i£
 
	`V®ueE¼Ü
("Theranslate‡rgument must be‡ dict.")

216 
şass
 
	$Di¥©ch”
(
objeù
):

219 
The
 
Œ“
 
is
 
roÙed
 
©
 
ch”rypy
.
»que¡
.
­p
.
roÙ
, 
ªd
 
—ch
 
h›¿rchiÿl


220 
compÚ’t
 
š
 
the
 
·th_šfo
 
¬gum’t
 
is
 
m©ched
 
to
 
a
 
cÜ»¥Údšg
 
Ã¡ed


221 
©Œibu‹
 
of
 
the
 
roÙ
 
objeù
. 
M©chšg
 
hªdËrs
 
mu¡
 
have
 
ª
 'exposed'

222 
©Œibu‹
 
which
 
ev®u©es
 
to
 
True
. 
The
 
¥ecŸl
 
m‘hod
 
Çme
 "index"

223 
m©ches
 
a
 
URI
 
which
 
’ds
 
š
‡ 
	`¦ash
 ("/"). 
The
 
¥ecŸl
 
m‘hod
 
Çme


224 "deçuÉ" 
may
 
m©ch
 
a
 
pÜtiÚ
 
of
 
the
 
	`·th_šfo
 (
but
 
Úly
 
wh’
 
no
 
lÚg”


225 
sub¡ršg
 
of
 
the
 
·th_šfo
 
m©ches
 
some
 
Ùh”
 
objeù
).

227 
This
 
is
 
the
 , 
but
-
š
 
di¥©ch”
 
Ch”ryPy
.

230 
di¥©ch_m‘hod_Çme
 = '_cp_dispatch'

232 
The
 
Çme
 
of
 
the
 
di¥©ch
 
m‘hod
 
th©
 
nodes
 
may
 
İtiÚ®ly
 
im¶em’t


233 
to
 
´ovide
 
theœ
 
own
 
dyÇmic
 
di¥©ch
 
®gÜ™hm
.

236 
def
 
	$__š™__
(
£lf
, 
di¥©ch_m‘hod_Çme
=
NÚe
,

237 
Œª¦©e
=
punùu©iÚ_to_und”scÜes
):

238 
	$v®id©e_Œª¦©Ü
(
Œª¦©e
)

239 
£lf
.
Œª¦©e
 =ranslate

240 
di¥©ch_m‘hod_Çme
:

241 
£lf
.
di¥©ch_m‘hod_Çme
 = dispatch_method_name

243 
def
 
	$__ÿÎ__
(
£lf
, 
·th_šfo
):

245 
»que¡
 = 
ch”rypy
.
£rvšg
.request

246 
func
, 
v·th
 = 
£lf
.
	$fšd_hªdËr
(
·th_šfo
)

248 
func
:

249 #Decod
ªy
 
Ëáov”
 %2F 
š
 
the
 
vœtu®_·th
 
©oms
.

250 
v·th
 = [
x
.
	`»¶aû
("%2F", "/"èx 
š
 vpath]

251 
»que¡
.
hªdËr
 = 
	$L©eP¬amPageHªdËr
(
func
, *
v·th
)

253 
»que¡
.
hªdËr
 = 
ch”rypy
.
	$NÙFound
()

255 
def
 
	$fšd_hªdËr
(
£lf
, 
·th
):

258 
This
 
wl
  
two
 
objeùs
. 
The
 
fœ¡
 wÈ
be
 
a
 
ÿÎabË
,

259 
which
 
ÿn
 
be
 
u£d
 
to
 
g’”©e
 
·ge
 
ouut
. 
Any
 
·¿m‘”s
 
äom


260 
the
 
qu”y
 
¡ršg
 
Ü
 
»que¡
 
body
 
wl
 
be
 
£Á
 
to
 
th©
 
ÿÎabË


261 
as
 
keywÜd
 
¬gum’ts
.

263 
The
 
ÿÎabË
 
is
 
found
 
by
 
Œav”sšg
 
the
 
­¶iÿtiÚ
'sree,

264 
¡¬tšg
 
äom
 
ch”rypy
.
»que¡
.
­p
.
roÙ
, 
ªd
 
m©chšg
 
·th


265 
compÚ’ts
 
to
 
sucûssive
 
objeùs
 
š
 
the
 
Œ“
. 
FÜ
 
exam¶e
,he

266 
URL
 "/·th/to/hªdËr" 
might
  
roÙ
.
·th
.
to
.
hªdËr
.

268 
The
 
£cÚd
 
objeù
 
»tuºed
 
wl
 
be
 
a
 
li¡
 
of
 
Çmes
 
which
 
¬e


269 'vœtu®…©h' 
compÚ’ts
: 
·¹s
 
of
 
the
 
URL
 
which
 
¬e
 
dyÇmic
,

270 
ªd
 
w”e
 
nÙ
 
u£d
 
wh’
 
lookšg
 
up
 
the
 
hªdËr
.

271 
The£
 
vœtu®
 
·th
 
compÚ’ts
 
¬e
 
·s£d
 
to
 
the
 
hªdËr
 
as


272 
pos™iÚ®
 
¬gum’ts
.

274 
»que¡
 = 
ch”rypy
.
£rvšg
.request

275 
­p
 = 
»que¡
.app

276 
roÙ
 = 
­p
.root

277 
di¥©ch_Çme
 = 
£lf
.
di¥©ch_m‘hod_Çme


279 #G‘ 
cÚfig
 
the
 
roÙ
 
objeù
/
·th
.

280 
fuÎ·th
 = [
x
 x 
š
 
·th
.
	`¡r
('/').
	`¥l™
('/') x] + ['index']

281 
fuÎ·th_Ën
 = 
	$Ën
(
fuÎ·th
)

282 
£gËá
 = 
fuÎ·th_Ën


283 
nodecÚf
 = {
	}
}

284 
ha§‰r
(
roÙ
, "_cp_config"):

285 
nodecÚf
.
	$upd©e
(
roÙ
.
_ı_cÚfig
)

286 "/" 
š
 
­p
.
cÚfig
:

287 
nodecÚf
.
	`upd©e
(
­p
.
cÚfig
["/"])

288 
objeù_Œa
 = [['roÙ', 
roÙ
, 
nodecÚf
, 
£gËá
]]

290 
node
 = 
roÙ


291 
™”Çmes
 = 
fuÎ·th
[:]

292 
™”Çmes
:

293 
Çme
 = 
™”Çmes
[0]

294 #m­ 
to
 
Ëg®
 
PythÚ
 
	`id’tif›rs
 (
e
.
g
. 
»¶aû
 '.' 
w™h
 '_')

295 
objÇme
 = 
Çme
.
	$Œª¦©e
(
£lf
.
Œª¦©e
)

297 
nodecÚf
 = {
	}
}

298 
subnode
 = 
	$g‘©Œ
(
node
, 
objÇme
, 
NÚe
)

299 
´e_Ën
 = 
	$Ën
(
™”Çmes
)

300 
subnode
 
is
 
NÚe
:

301 
di¥©ch
 = 
	$g‘©Œ
(
node
, 
di¥©ch_Çme
, 
NÚe
)

302 
di¥©ch
 
ªd
 
	`ha§‰r
(di¥©ch, '__ÿÎ__'èªd 
nÙ
 \

303 
	`g‘©Œ
(
di¥©ch
, 'expo£d', 
F®£
è
ªd
 \

304 
´e_Ën
 > 1:

305 #DÚ'ˆexpo£hhidd’ '
šdex
'okeno _cp_dispatch

306 #W
sk
 
this
 
´e_Ën
 =ğ1 
sšû
 
™
 
makes
 
no
 
£n£


307 #tØ
ÿÎ
 
a
 
di¥©ch”
 
wh’
 
we
 
have
 
no
 
tok’s
 
Ëá
.

308 
šdex_Çme
 = 
™”Çmes
.
	$pİ
()

309 
subnode
 = 
	$di¥©ch
(
v·th
=
™”Çmes
)

310 
™”Çmes
.
	$­³nd
(
šdex_Çme
)

312 #W
didn
't find‡…ath, but keep…rocessing in casehere

313 #i 
a
 (è
hªdËr
.

314 
™”Çmes
.
	$pİ
(0)

316 #W
found
 
the
 
·th
, 
»move
h
v·th
 
’Œy


317 
™”Çmes
.
	$pİ
(0)

318 
£gËá
 = 
	$Ën
(
™”Çmes
)

319 
£gËá
 > 
´e_Ën
:

320 #NØ
·th
 
£gm’t
 
was
 
»moved
. 
Rai£
 
ª
 
”rÜ
.

321 
¿i£
 
ch”rypy
.
	`Ch”ryPyExû±iÚ
(

324 + "{0} iÀ{1}".
	$fÜm©
(
Çme
, 
fuÎ·th
)

326 
–if
 
£gËá
 =ğ
´e_Ën
:

327 #Assum
th©
 
the
 
hªdËr
 
u£d
h
cu¼’t
 
·th
 
£gm’t
, 
but


328 #did 
nÙ
 
pİ
 
™
. 
This
 
®lows
 
thšgs
 
like


329 #»tuº 
	`g‘©Œ
(
£lf
, 
v·th
[0], 
NÚe
)

330 
™”Çmes
.
	$pİ
(0)

331 
£gËá
 -= 1

332 
node
 = 
subnode


334 
node
 
is
 
nÙ
 
NÚe
:

335 #G‘ 
_ı_cÚfig
 
©ched
 
to
 
this
 
node
.

336 
	`ha§‰r
(
node
, "_cp_config"):

337 
nodecÚf
.
	$upd©e
(
node
.
_ı_cÚfig
)

339 #Mix 
š
 
v®ues
 
äom
 
­p
.
cÚfig
 
this
 
·th
.

340 
exi¡šg_Ën
 = 
fuÎ·th_Ën
 - 
´e_Ën


341 
exi¡šg_Ën
 != 0:

342 
cu½©h
 = '/' + '/'.
	`još
(
fuÎ·th
[0:
exi¡šg_Ën
])

344 
cu½©h
 = ''

345 
Ãw_£gs
 = 
fuÎ·th
[
fuÎ·th_Ën
 - 
´e_Ën
:fuÎ·th_ËÀ- 
£gËá
]

346 
£g
 
š
 
Ãw_£gs
:

347 
cu½©h
 +ğ'/' + 
£g


348 
cu½©h
 
š
 
­p
.
cÚfig
:

349 
nodecÚf
.
	$upd©e
(
­p
.
cÚfig
[
cu½©h
])

351 
objeù_Œa
.
	$­³nd
([
Çme
, 
node
, 
nodecÚf
, 
£gËá
])

353 
def
 
	$£t_cÚf
():

355 
ba£
 = 
ch”rypy
.
cÚfig
.
	$cİy
()

356 #NÙ
th©
 
we
 
m”ge
 
the
 
cÚfig
 
äom
 
—ch
 
node


357 #ev’ 
th©
 
node
 
was
 
NÚe
.

358 
Çme
, 
obj
, 
cÚf
, 
£gËá
 
š
 
objeù_Œa
:

359 
ba£
.
	$upd©e
(
cÚf
)

360 'toŞs.¡©icdœ.dœ' 
š
 
cÚf
:

361 
ba£
['toŞs.¡©icdœ.£ùiÚ'] = '/' + '/'.
	`još
(
fuÎ·th
[0:
fuÎ·th_Ën
 - 
£gËá
])

362  
ba£


364 #Try 
sucûssive
 
	`objeùs
 (
»v”£
 
Üd”
)

365 
num_ÿndid©es
 = 
	`Ën
(
objeù_Œa
) - 1

366 
i
 
š
 
	`¿nge
(
num_ÿndid©es
, -1, -1):

368 
Çme
, 
ÿndid©e
, 
nodecÚf
, 
£gËá
 = 
objeù_Œa
[
i
]

369 
ÿndid©e
 
is
 
NÚe
:

372 #Try 
a
 "deçuÉ" 
m‘hod
 
Ú
 
the
 
cu¼’t
 
Ëaf
.

373 
	`ha§‰r
(
ÿndid©e
, "default"):

374 
defhªdËr
 = 
ÿndid©e
.

375 
	`g‘©Œ
(
defhªdËr
, 'expo£d', 
F®£
):

376 #In£¹ 
ªy
 
exŒa
 
_ı_cÚfig
 
äom
 
the
  
hªdËr
.

377 
cÚf
 = 
	`g‘©Œ
(
defhªdËr
, "_ı_cÚfig", {
	}
})

378 
	gobjeù_Œa
.
š£¹
(
i
+1, ["deçuÉ", 
defhªdËr
, 
cÚf
, 
£gËá
])

379 
	g»que¡
.
	gcÚfig
 = 
	$£t_cÚf
()

380 #S“ 
h‰p
:

381 
»que¡
.
is_šdex
 = 
·th
.
	`’dsw™h
("/")

382  
defhªdËr
, 
fuÎ·th
[
fuÎ·th_Ën
 - 
£gËá
:-1]

384 #Uncomm’ˆ
the
 
Ãxt
 
lše
 
to
 
»¡riù
 
pos™iÚ®
 
·¿ms
o "default".

385 #ià
i
 < 
num_ÿndid©es
 - 2: 

387 #Try 
the
 
cu¼’t
 
Ëaf
.

388 
	`g‘©Œ
(
ÿndid©e
, 'expo£d', 
F®£
):

389 
»que¡
.
cÚfig
 = 
	$£t_cÚf
()

390 
i
 =ğ
num_ÿndid©es
:

391 #W
found
 
the
 
exŒa
 ".šdex". 
M¬k
 
»que¡
 
so
 
toŞs


392 #ÿÀ
»dœeù
 
·th_šfo
 
has
 
no
 
Œašg
 
¦ash
.

393 
»que¡
.
is_šdex
 = 
True


395 #We'»‚Ù‡ˆª '
šdex
' handler. Mark„equest soools

396 #ÿÀ
»dœeù
 
·th_šfo
 
has
 
NO
 
Œašg
 
¦ash
.

397 #NÙ
th©
 
this
 
®so
 
šşudes
 
hªdËrs
 
which
 
ke


398 #pos™iÚ® 
	`·¿m‘”s
 (
vœtu®
 
·ths
).

399 
»que¡
.
is_šdex
 = 
F®£


400  
ÿndid©e
, 
fuÎ·th
[
fuÎ·th_Ën
 - 
£gËá
:-1]

402 #W
didn
't find‡nything

403 
»que¡
.
cÚfig
 = 
	$£t_cÚf
()

404  
NÚe
, []

407 
şass
 
	$M‘hodDi¥©ch”
(
Di¥©ch”
):

410 
M‘hods
 
Çmed
 
GET
, 
POST
, 
‘c
 
wl
 
be
 
ÿÎed
 
Ú
 
ª
 
expo£d
 
şass
.

411 
The
 
m‘hod
 
Çmes
 
mu¡
 
be
 
®l
 
ÿps
; 
the
 
­´İrŸ‹
 
AÎow
 
h—d”


412 
wl
 
be
 
ouut
 
showšg
 
®l
 
ÿp™®ized
 
m‘hod
 
Çmes
 
as
 
®lowabË


413 
HTTP
 
v”bs
.

415 
NÙe
 
th©
 
the
 
cÚššg
 
şass
 
mu¡
 
be
 
expo£d
, 
nÙ
h
m‘hods
.

418 
def
 
	$__ÿÎ__
(
£lf
, 
·th_šfo
):

420 
»que¡
 = 
ch”rypy
.
£rvšg
.request

421 
»sourû
, 
v·th
 = 
£lf
.
	$fšd_hªdËr
(
·th_šfo
)

423 
»sourû
:

424 #S‘ 
AÎow
 
h—d”


425 
ava
 = [
m
 m 
š
 
	$dœ
(
»sourû
è
m
.
	`isuµ”
()]

426 "GET" 
š
 
ava
 
ªd
 "HEAD" 
nÙ
 in‡vail:

427 
ava
.
	`­³nd
("HEAD")

428 
ava
.
	$sÜt
()

429 
ch”rypy
.
£rvšg
.
»¥Ú£
.
h—d”s
['AÎow'] = ", ".
	$još
(
ava
)

431 #Fšd 
the
 
subhªdËr


432 
m‘h
 = 
»que¡
.
m‘hod
.
	$uµ”
()

433 
func
 = 
	$g‘©Œ
(
»sourû
, 
m‘h
, 
NÚe
)

434 
func
 
is
 
NÚe
 
ªd
 
m‘h
 == "HEAD":

435 
func
 = 
	`g‘©Œ
(
»sourû
, "GET", 
NÚe
)

436 
func
:

437 #G¿b 
ªy
 
_ı_cÚfig
 
Ú
 
the
 
subhªdËr
.

438 
	`ha§‰r
(
func
, "_cp_config"):

439 
»que¡
.
cÚfig
.
	$upd©e
(
func
.
_ı_cÚfig
)

441 #Decod
ªy
 
Ëáov”
 %2F 
š
 
the
 
vœtu®_·th
 
©oms
.

442 
v·th
 = [
x
.
	`»¶aû
("%2F", "/"èx 
š
 vpath]

443 
»que¡
.
hªdËr
 = 
	$L©eP¬amPageHªdËr
(
func
, *
v·th
)

445 
»que¡
.
hªdËr
 = 
ch”rypy
.
	$HTTPE¼Ü
(405)

447 
»que¡
.
hªdËr
 = 
ch”rypy
.
	$NÙFound
()

450 
şass
 
	$Rou‹sDi¥©ch”
(
objeù
):

453 
def
 
	$__š™__
(
£lf
, 
fuÎ_»suÉ
=
F®£
):

455 
Rou‹s
 
di¥©ch”


457 
S‘
 
fuÎ_»suÉ
 
to
 
True
 
you
 
wish
 
the
 
cÚŒŞËr


458 
ªd
 
the
 
aùiÚ
 
to
 
be
 
·s£d
 
Ú
Øth
·ge
 
hªdËr


459 
·¿m‘”s
. 
By
  
they
 
wÚ
't be.

461 
impÜt
 
rou‹s


462 
£lf
.
fuÎ_»suÉ
 = full_result

463 
£lf
.
cÚŒŞËrs
 = {
	}
}

464 
£lf
.
m­³r
 = 
rou‹s
.
	$M­³r
()

465 
£lf
.
m­³r
.
cÚŒŞËr_sÿn
 = s–f.
cÚŒŞËrs
.
keys


467 
def
 
	$cÚÃù
(
£lf
, 
Çme
, 
rou‹
, 
cÚŒŞËr
, **
kw¬gs
):

468 
£lf
.
cÚŒŞËrs
[
Çme
] = 
cÚŒŞËr


469 
£lf
.
m­³r
.
	$cÚÃù
(
Çme
, 
rou‹
, 
cÚŒŞËr
òame, **
kw¬gs
)

471 
def
 
	$»dœeù
(
£lf
, 
u¾
):

472 
¿i£
 
ch”rypy
.
	$HTTPRedœeù
(
u¾
)

474 
def
 
	$__ÿÎ__
(
£lf
, 
·th_šfo
):

476 
func
 = 
£lf
.
	$fšd_hªdËr
(
·th_šfo
)

477 
func
:

478 
ch”rypy
.
£rvšg
.
»que¡
.
hªdËr
 = 
	$L©eP¬amPageHªdËr
(
func
)

480 
ch”rypy
.
£rvšg
.
»que¡
.
hªdËr
 = ch”rypy.
	$NÙFound
()

482 
def
 
	$fšd_hªdËr
(
£lf
, 
·th_šfo
):

484 
impÜt
 
rou‹s


486 
»que¡
 = 
ch”rypy
.
£rvšg
.request

488 
cÚfig
 = 
rou‹s
.
	$»que¡_cÚfig
()

489 
cÚfig
.
m­³r
 = 
£lf
.mapper

490 
	`ha§‰r
(
»que¡
, 'wsgi_environ'):

491 
cÚfig
.
’vœÚ
 = 
»que¡
.
wsgi_’vœÚ


492 
cÚfig
.
ho¡
 = 
»que¡
.
h—d”s
.
	`g‘
('Ho¡', 
NÚe
)

493 
cÚfig
.
´ÙocŞ
 = 
»que¡
.
scheme


494 
cÚfig
.
»dœeù
 = 
£lf
.redirect

496 
»suÉ
 = 
£lf
.
m­³r
.
	$m©ch
(
·th_šfo
)

498 
cÚfig
.
m­³r_diù
 = 
»suÉ


499 
·¿ms
 = {
	}
}

500 
»suÉ
:

501 
·¿ms
 = 
»suÉ
.
	$cİy
()

502 
nÙ
 
£lf
.
fuÎ_»suÉ
:

503 
·¿ms
.
	`pİ
('cÚŒŞËr', 
NÚe
)

504 
·¿ms
.
	`pİ
('aùiÚ', 
NÚe
)

505 
»que¡
.
·¿ms
.
	$upd©e
(
·¿ms
)

507 #G‘ 
cÚfig
 
the
 
roÙ
 
objeù
/
·th
.

508 
»que¡
.
cÚfig
 = 
ba£
 = 
ch”rypy
.cÚfig.
	$cİy
()

509 
cu½©h
 = ""

511 
def
 
	$m”ge
(
nodecÚf
):

512 'toŞs.¡©icdœ.dœ' 
š
 
nodecÚf
:

513 
nodecÚf
['toŞs.¡©icdœ.£ùiÚ'] = 
cu½©h
 
Ü
 "/"

514 
ba£
.
	$upd©e
(
nodecÚf
)

516 
­p
 = 
»que¡
.app

517 
roÙ
 = 
­p
.root

518 
	`ha§‰r
(
roÙ
, "_cp_config"):

519 
	$m”ge
(
roÙ
.
_ı_cÚfig
)

520 "/" 
š
 
­p
.
cÚfig
:

521 
	`m”ge
(
­p
.
cÚfig
["/"])

523 #Mix 
š
 
v®ues
 
äom
 
­p
.
cÚfig
.

524 
©oms
 = [
x
 x 
š
 
·th_šfo
.
	`¥l™
("/") x]

525 
©oms
:

526 
Ï¡
 = 
©oms
.
	$pİ
()

528 
Ï¡
 = 
NÚe


529 
©om
 
š
 
©oms
:

530 
cu½©h
 = "/".
	`još
((cu½©h, 
©om
))

531 
cu½©h
 
š
 
­p
.
cÚfig
:

532 
	$m”ge
(
­p
.
cÚfig
[
cu½©h
])

534 
hªdËr
 = 
NÚe


535 
»suÉ
:

536 
cÚŒŞËr
 = 
»suÉ
.
	`g‘
('controller')

537 
cÚŒŞËr
 = 
£lf
.
cÚŒŞËrs
.
	$g‘
(
cÚŒŞËr
, controller)

538 
cÚŒŞËr
:

539 
	$isš¡ªû
(
cÚŒŞËr
, 
şas¡y³
):

540 
cÚŒŞËr
 = 
	$cÚŒŞËr
()

541 #G‘ 
cÚfig
 
äom
 
the
 
cÚŒŞËr
.

542 
	`ha§‰r
(
cÚŒŞËr
, "_cp_config"):

543 
	$m”ge
(
cÚŒŞËr
.
_ı_cÚfig
)

545 
aùiÚ
 = 
»suÉ
.
	`g‘
('action')

546 
aùiÚ
 
is
 
nÙ
 
NÚe
:

547 
hªdËr
 = 
	$g‘©Œ
(
cÚŒŞËr
, 
aùiÚ
, 
NÚe
)

548 #G‘ 
cÚfig
 
äom
 
the
 
hªdËr


549 
	`ha§‰r
(
hªdËr
, "_cp_config"):

550 
	$m”ge
(
hªdËr
.
_ı_cÚfig
)

552 
hªdËr
 = 
cÚŒŞËr


554 #DØ
the
 
Ï¡
 
·th
 
©om
 
h”e
 
so
 
™
 
ÿn


555 #ov”rid
the
 
cÚŒŞËr
's _cp_config.

556 
Ï¡
:

557 
cu½©h
 = "/".
	`još
((cu½©h, 
Ï¡
))

558 
cu½©h
 
š
 
­p
.
cÚfig
:

559 
	$m”ge
(
­p
.
cÚfig
[
cu½©h
])

561  
hªdËr


564 
def
 
	`XMLRPCDi¥©ch”
(
Ãxt_di¥©ch”
=
	$Di¥©ch”
()):

565 
äom
 
ch”rypy
.
lib
 
impÜt
 
xmÌpcut


566 
def
 
	$xmÌpc_di¥©ch
(
·th_šfo
):

567 
·th_šfo
 = 
xmÌpcut
.
	$·tched_·th
(
·th_šfo
)

568  
	$Ãxt_di¥©ch”
(
·th_šfo
)

569  
xmÌpc_di¥©ch


572 
def
 
	`Vœtu®Ho¡
(
Ãxt_di¥©ch”
=
	`Di¥©ch”
(), 
u£_x_fÜw¬ded_ho¡
=
True
, **
domašs
):

574 
S–eù
 
a
 
difã»Á
 
hªdËr
 
ba£d
 
Ú
 
the
 
Ho¡
 
h—d”
.

576 
This
 
ÿn
 
be
 
u£ful
 
wh’
 
ruÂšg
 
muÉË
 
s™es
 
w™hš
 
Úe
 
CP
 
£rv”
.

577 
It
 
®lows
 
£v”®
 
domašs
 
to
 
pošt
Ø
difã»Á
 
·¹s
 
of
 
a
 
sšgË


578 
webs™e
 
¡ruùu»
. 
FÜ
 
exam¶e
::

580 
h‰p
:

581 
h‰p
:

582 
h‰p
:

584 
ÿn
 
be
 
accom¶ished
 
vŸ
 
the
 
fŞlowšg
 
cÚfig
::

587 
»que¡
.
di¥©ch
 = 
ch”rypy
.di¥©ch.
	`Vœtu®Ho¡
(

590 
	}
})

592 
Ãxt_di¥©ch”


593 
The
 
Ãxt
 
di¥©ch”
 
objeù
 
š
 
the
 
di¥©ch
 
chaš
.

594 
The
 
Vœtu®Ho¡
 
di¥©ch”
 
adds
 
a
 
´efix
 
to
 
the
 
URL
 
ªd
 
ÿÎs


595 
ªÙh”
 
di¥©ch”
. 
DeçuÉs
 
to
 
ch”rypy
.
di¥©ch
.
Di¥©ch”
().

597 
u£_x_fÜw¬ded_ho¡


598 
If
 
True
 (
the
 ), 
	gªy
 "X-Forwarded-Host"

599 
»que¡
 
h—d”
 
wl
 
be
 
u£d
 
š¡—d
 
of
 
	gthe
 "Ho¡" 
	gh—d”
. 
This


600 
is
 
commÚly
 
added
 
by
 
HTTP
 
	$£rv”s
 (
such
 
as
 
A·che
è
wh’
 
´oxyšg
.

602 ``**
domašs
``

603 
A
 
diù
 
of
 {
ho¡
 
h—d”
 
v®ue
: 
vœtu®
 
´efix
}…aœs.

604 
The
 
šcomšg
 "Ho¡" 
»que¡
 
h—d”
 
is
 
looked
 
up
 
š
 
this
 
diù
,

605 
	gªd
, 
a
 
m©ch
 
is
 
	gfound
, 
the
 
	gcÜ»¥Údšg
 "virtual…refix"

606 
v®ue
 
wl
 
be
 
´•’ded
 
to
 
the
 
URL
 
·th
 
befÜe
 
ÿÎšg
he

607 
Ãxt
 
	gdi¥©ch”
. 
NÙe
 
th©
 
you
 
oá’
 
Ãed
 
£·¿‹
 
’Œ›s


608 "exam¶e.com" 
	gªd
 "www.exam¶e.com". 
In
 
	gadd™iÚ
, "Host"

609 
h—d”s
 
may
 
cÚš
 
the
 
pÜt
 
	gnumb”
.

611 
äom
 
	gch”rypy
.
lib
 
impÜt
 
h‰put


612 
def
 
	$vho¡_di¥©ch
(
·th_šfo
):

613 
»que¡
 = 
ch”rypy
.
£rvšg
.request

614 
h—d”
 = 
»que¡
.
h—d”s
.
g‘


616 
domaš
 = 
	`h—d”
('Host', '')

617 
u£_x_fÜw¬ded_ho¡
:

618 
domaš
 = 
	`h—d”
("X-Forwarded-Host", domain)

620 
´efix
 = 
domašs
.
	`g‘
(
domaš
, "")

621 
´efix
:

622 
·th_šfo
 = 
h‰put
.
	$u¾još
(
´efix
, 
·th_šfo
)

624 
»suÉ
 = 
	$Ãxt_di¥©ch”
(
·th_šfo
)

626 #Touch 
up
 
¡©icdœ
 
cÚfig
. 
S“
 
h‰p
:

627 
£ùiÚ
 = 
»que¡
.
cÚfig
.
	`g‘
('tools.staticdir.section')

628 
£ùiÚ
:

629 
£ùiÚ
 = seùiÚ[
	$Ën
(
´efix
):]

630 
»que¡
.
cÚfig
['toŞs.¡©icdœ.£ùiÚ'] = 
£ùiÚ


632  
»suÉ


633  
vho¡_di¥©ch


	@trunk/objs/CherryPy-3.2.4/cherrypy/_cperror.py

3 
Ch”ryPy
 
	$´ovides
 (
ªd
 
u£s
è
exû±iÚs
 
deş¬šg
 
th©
 
the
 
HTTP
 
»¥Ú£


4 
should
 
be
 
a
 
¡©us
 
Ùh”
 
thª
 
the
  "200 OK". 
You
 
ÿn
 ``
¿i£
`` 
them
 
like


5 
nÜm®
 
PythÚ
 
exû±iÚs
. 
You
 
ÿn
 
®so
 
ÿÎ
 
them
 
ªd
 
they
 
wl
 
¿i£
 
them£lves
;

6 
this
 
m—ns
 
you
 
ÿn
 
£t
 
ª
 :
şass
:`
HTTPE¼Ü
<
ch”rypy
.
_ı”rÜ
.HTTPError>`

7 
Ü
 :
şass
:`
HTTPRedœeù
<
ch”rypy
.
_ı”rÜ
.HTTPRedœeù>` 
as
 
the


8 :
©Œ
:`
»que¡
.
hªdËr
<
ch”rypy
.
_ı»que¡
.
Reque¡
.handler>`.

10 .. 
_»dœeùšgpo¡
:

12 
Redœeùšg
 
POST


15 
Wh’
 
you
 
GET
 
a
 
»sourû
 
ªd
 
¬e
 
»dœeùed
 
by
 
the
 
£rv”
 
to
 
ªÙh”
 
LoÿtiÚ
,

16 
th”e
's generally‚o…roblem since GET is both‡ "safe method" (there should

17 
be
 
no
 
side
-
efãùs
è
ªd
 
ª
 "idempÙ’ˆm‘hod" (
muÉË
 
ÿÎs
 
¬e
‚Ø
difã»Á


18 
thª
 
a
 
sšgË
 
ÿÎ
).

20 
POST
, 
howev”
, 
is
 
Ã™h”
 
§ã
 
nÜ
 
idempÙ’t
--
you


21 
ch¬ge
 
a
 
üed™
 
ÿrd
, 
you
 
dÚ
't wanto be chargedwice by‡„edirect!

23 
FÜ
 
this
 
»asÚ
, *
nÚe
* 
of
 
the
 3xx 
»¥Ú£s
 
³rm™
 
a
 
u£r
-
	$ag’t
 (
brow£r
è
to


24 
»subm™
 
a
 
POST
 
Ú
 
»dœeùiÚ
 
w™hout
 
fœ¡
 
cÚfœmšg
 
the
 
aùiÚ
 
w™h
h
u£r
:

27 300 
MuÉË
 
Choiûs
 
CÚfœm
 
w™h
 
the
 
u£r


28 301 
Moved
 
P”mª’y
 
CÚfœm
 
w™h
 
the
 
u£r


29 302 
	$Found
 (
Objeù
 
moved
 
‹mpÜ¬y
è
CÚfœm
 
w™h
 
the
 
u£r


30 303 
S“
 
Oth”
 
GET
 
the
 
Ãw
 
URI
--
no
 
cÚfœm©iÚ


31 304 
NÙ
 
	`modif›d
 (
cÚd™iÚ®
 
GET
 
Úly
--
POST
 
should
 
nÙ
 
¿i£
 
this
 
”rÜ
)

32 305 
U£
 
Proxy
 
CÚfœm
 
w™h
 
the
 
u£r


33 307 
TempÜ¬y
 
Redœeù
 
CÚfœm
 
w™h
 
the
 
u£r


36 
Howev”
, 
brow£rs
 
have
 
hi¡ÜiÿÎy
 
im¶em’‹d
 
the£
 
»¡riùiÚs
 
poÜly
;

37 
š
 
·¹icuÏr
, 
mªy
 
brow£rs
 dØ
nÙ
 
fÜû
 
the
 
u£r
 
to
 
cÚfœm
 301, 302

38 
Ü
 307 
wh’
 
»dœeùšg
 
POST
. 
FÜ
 
this
 
»asÚ
, 
Ch”ryPy
 
deçuÉs
 
to
 303,

39 
which
 
mo¡
 
u£r
-
ag’ts
 
­³¬
 
to
 
have
 
im¶em’‹d
 
cÜ»ùly
. 
Th”efÜe
, 

40 
you
 
¿i£
 
HTTPRedœeù
 
a
 
POST
 
»que¡
, 
the
 
u£r
-
ag’t
 
wl
 
mo¡
 
lik–y


41 
©‹m±
 
to
 
GET
 
the
 
Ãw
 
	`URI
 (
w™hout
 
askšg
 
cÚfœm©iÚ
 
äom
h
u£r
).

42 
We
 
»®ize
 
this
 
is
 
cÚfusšg
 
dev–İ”s
, 
but
 
™
'she safesthing we

43 
could
 do. 
You
 
¬e
 
of
 
cour£
 
ä“
 
to
 
¿i£
 ``
	`HTTPRedœeù
(
uri
, 
¡©us
=302)``

44 
Ü
 
ªy
 
Ùh”
 3xx 
¡©us
 
you
 
know
 
wh©
 you're doing, but givenhe

45 
’vœÚm’t
, 
we
 
couldn
't†et‡ny ofhose behe default.

47 
Cu¡om
 
E¼Ü
 
Hªdlšg


50 .. 
image
:: /
»fmª
/
ı”rÜs
.
gif


52 
AÁic©ed
 
HTTP
 
»¥Ú£s


55 
The
 '”rÜ_·ge' 
cÚfig
 
Çme¥aû
 
ÿn
 
be
 
u£d
 
to
 
´ovide
 
cu¡om
 
HTML
 
ouut
 

56 
ex³ùed
 
	`»¥Ú£s
 (
like
 404 
NÙ
 
Found
). 
Suµly
 
a
 
f’ame
 
äom
 
which
 
the
 
ouut


57 
wl
 
be
 
»ad
. 
The
 
cÚ‹Ás
 wÈb
š‹½Ş©ed
 
w™h
 
the
 
v®ues
 %(
¡©us
)
s
,

58 %(
mes§ge
)
s
, %(
Œaûback
)s, 
ªd
 %(
v”siÚ
) 
usšg
 
¶aš
 
Şd
 
PythÚ


59 `
¡ršg
 
fÜm©tšg
 <
h‰p
:

63 
_ı_cÚfig
 = {'”rÜ_·ge.404': 
os
.
·th
.
	`još
(
loÿlDœ
, "¡©ic/šdex.html")
	}
}

66 
Begšnšg
 
š
 
v”siÚ
 3.1, 
you
 
may
 
®so
 
´ovide
 
a
 
funùiÚ
 
Ü
 
Ùh”
 
ÿÎabË
 
as


67 
ª
 
”rÜ_·ge
 
	g’Œy
. 
It
 
wl
 
be
 
·s£d
 
the
 
§me
 
	g¡©us
, 
	gmes§ge
, 
Œaûback
 
ªd


68 
v”siÚ
 
¬gum’ts
 
th©
 
¬e
 
š‹½Ş©ed
 
što
 
	g‹m¶©es
::

70 
def
 
	$”rÜ_·ge_402
(
¡©us
, 
mes§ge
, 
Œaûback
, 
v”siÚ
):

71  "E¼Ü % - W–l, I'm v”y sÜry buˆyou hav’'ˆ·id!" % 
¡©us


72 
ch”rypy
.
cÚfig
.
	`upd©e
({'”rÜ_·ge.402': 
”rÜ_·ge_402
})

74 
Also
 
š
 3.1, iÀ
add™iÚ
 
to
 
the
 
numb”ed
 
”rÜ
 
	gcodes
, 
you
 
may
 
®so
 
	gsuµly


75 "”rÜ_·ge.deçuÉ" 
to
 
hªdË
 
®l
 
codes
 
which
 dØ
nÙ
 
have
 
theœ
 
own
 
”rÜ_·ge
 
	g’Œy
.

79 
UÇÁic©ed
 
	g”rÜs


82 
Ch”ryPy
 
®so
 
has
 
a
 
g’”ic
 
”rÜ
 
hªdlšg
 
	gmechªism
: 
wh’ev”
 
ª
 
uÇÁic©ed


83 
”rÜ
 
occurs
 
š
 
your
 
code
, 
™
 
wl
 
	gÿÎ


84 :
func
:`
Reque¡
.
”rÜ_»¥Ú£
<
ch”rypy
.
_ı»que¡
.Reque¡.”rÜ_»¥Ú£>` 
to
 
£t


85 
the
 
»¥Ú£
 
¡©us
, 
	gh—d”s
, 
ªd
 
	gbody
. 
By
 , 
this
 
is
h
§me
 
ouut
 
	gas


86 :
şass
:`
HTTPE¼Ü
(500è<
ch”rypy
.
_ı”rÜ
.HTTPE¼Ü>`. 
If
 
you
 
wªt
 
to
 
´ovide


87 
some
 
Ùh”
 
behaviÜ
, 
you
 
g’”®ly
 
	g»¶aû
 "request.error_response".

89 
H”e
 
is
 
some
 
§m¶e
 
code
 
th©
 
shows
 
how
 
to
 
di¥Ïy
 
a
 
cu¡om
 
”rÜ
 
mes§ge
 
ªd


90 
£nd
 
ª
 
	ge
-
ma
 
cÚššg
 
the
 
	g”rÜ
::

92 
äom
 
ch”rypy
 
impÜt
 
_ı”rÜ


94 
def
 
	$hªdË_”rÜ
():

95 
ch”rypy
.
»¥Ú£
.
¡©us
 = 500

96 
ch”rypy
.
»¥Ú£
.
body
 = ["<html><body>Sorry,‡nƒrror occured</body></html>"]

97 
	`£ndMa
('”rÜ@domaš.com', 'E¼Ü iÀyou¸web‡µ', 
_ı”rÜ
.
	$fÜm©_exc
())

99 
şass
 
RoÙ
:

100 
_ı_cÚfig
 = {'»que¡.”rÜ_»¥Ú£': 
hªdË_”rÜ
}

103 
NÙe
 
th©
 
you
 
have
 
to
 
ex¶ic™ly
 
£t
 :
©Œ
:`
»¥Ú£
.
body
 <
ch”rypy
.
_ı»que¡
.
Re¥Ú£
.body>`

104 
ªd
 
nÙ
 
sim¶y
  
ª
 
”rÜ
 
mes§ge
 
as
 
a
 
»suÉ
.

107 
äom
 
cgi
 
impÜt
 
esÿ³
 
as
 
_esÿ³


108 
äom
 
sys
 
impÜt
 
exc_šfo
 
as
 
_exc_šfo


109 
äom
 
Œaûback
 
impÜt
 
fÜm©_exû±iÚ
 
as
 
_fÜm©_exû±iÚ


110 
äom
 
ch”rypy
.
_ıcom·t
 
impÜt
 
ba£¡ršg
, 
	gby‹¡r
, 
	g™”™ems
, 
	gÁob
, 
	gtÚ©ive
, 
u¾još
 
as
 
_u¾još


111 
äom
 
	gch”rypy
.
lib
 
impÜt
 
h‰put
 
as
 
_h‰put


114 
şass
 
	$Ch”ryPyExû±iÚ
(
Exû±iÚ
):

116 
·ss


119 
şass
 
	$TimeoutE¼Ü
(
Ch”ryPyExû±iÚ
):

121 
·ss


124 
şass
 
	$IÁ”ÇlRedœeù
(
Ch”ryPyExû±iÚ
):

127 
This
 
exû±iÚ
 
wl
 
»dœeù
 
´oûssšg
 
to
 
ªÙh”
 
·th
 
w™hš
 
the
 
s™e


128 (
w™hout
 
šfÜmšg
 
the
 
ş›Á
). 
Provide
h
Ãw
 
·th
 
as
 
ª
 
¬gum’t
 
wh’


129 
¿isšg
 
the
 
exû±iÚ
. 
Provide
 
ªy
 
·¿ms
 
š
h
qu”y¡ršg
 th
Ãw
 
URL
.

132 
def
 
	`__š™__
(
£lf
, 
·th
, 
qu”y_¡ršg
=""):

133 
impÜt
 
ch”rypy


134 
£lf
.
»que¡
 = 
ch”rypy
.
£rvšg
.request

136 
£lf
.
qu”y_¡ršg
 = query_string

137 "?" 
š
 
·th
:

138 #S•¬©
ªy
 
·¿ms
 
šşuded
 
š
 
the
 
·th


139 
·th
, 
£lf
.
qu”y_¡ršg
 =…©h.
	`¥l™
("?", 1)

141 #NÙ
th©
 
u¾još
 
wl
 "dØthrighˆthšg" 
wh‘h”
 
u¾
 
is
:

142 #1. 
a
 
URL
 
»Ïtive
 
to
 
	`roÙ
 (
e
.
g
. "/dummy")

143 #2. 
a
 
URL
 
»Ïtive
 
to
 
the
 
cu¼’t
 
·th


144 #NÙ
th©
 
ªy
 
qu”y
 
¡ršg
 
wl
 
be
 
disÿrded
.

145 
·th
 = 
	$_u¾još
(
£lf
.
»que¡
.
·th_šfo
, 
·th
)

147 #S‘ 
a
 '·th' 
memb”
 
©Œibu‹
 
so
 
th©
 
code
 
which
 
Œ­s
 
this


148 #”rÜ 
ÿn
 
have
 
acûss
 
to
 
™
.

149 
£lf
.
·th
 =…ath

151 
Ch”ryPyExû±iÚ
.
	$__š™__
(
£lf
, 
·th
, s–f.
qu”y_¡ršg
)

154 
şass
 
	$HTTPRedœeù
(
Ch”ryPyExû±iÚ
):

157 
This
 
exû±iÚ
 
wl
 
fÜû
 
a
 
HTTP
 
»dœeù
 
to
 
the
 
URL
 
Ü
 URL's you give it.

158 
The
 
Ãw
 
URL
 
mu¡
 
be
 
·s£d
 
as
 
the
 
fœ¡
 
¬gum’t
 
to
h
Exû±iÚ
,

159 
e
.
g
., 
	`HTTPRedœeù
(
ÃwU¾
). 
MuÉË
 
URLs
 
¬e
 
®lowed
 
š
 
a
 
li¡
.

160 
If
 
a
 
URL
 
is
 
absŞu‹
, 
™
 
wl
 
be
 
u£d
 
as
-is. Ià™ i 
»Ïtive
, it is

161 
assumed
 
to
 
be
 
»Ïtive
Ø
the
 
cu¼’t
 
ch”rypy
.
»que¡
.
·th_šfo
.

163 
If
 
Úe
 
of
 
the
 
´ovided
 
URL
 
is
 
a
 
unicode
 
objeù
, 
™
 
wl
 
be
 
’coded


164 
usšg
 
the
  
’codšg
 
Ü
h
Úe
 
·s£d
 
š
 
·¿m‘”
.

166 
Th”e
 
¬e
 
muÉË
 
ty³s
 
of
 
»dœeù
, 
äom
 
which
 
you
 
ÿn
 
£Ëù
 
vŸ
 
the


167 ``
¡©us
`` 
¬gum’t
. 
If
 
you
 dØ
nÙ
 
´ovide
 
a
 ``¡©us`` 
¬g
, 
™
 
deçuÉs
 
to


168 303 (
Ü
 302 
»¥Údšg
 
w™h
 
HTTP
/1.0).

170 
Exam¶es
::

172 
¿i£
 
ch”rypy
.
	`HTTPRedœeù
("")

173 
¿i£
 
ch”rypy
.
	`HTTPRedœeù
("/abs/path", 307)

174 
¿i£
 
ch”rypy
.
	`HTTPRedœeù
(["path1", "path2?a=1&b=2"], 301)

176 
S“
 :
»f
:`
»dœeùšgpo¡
` 
add™iÚ®
 
ÿv—ts
.

179 
¡©us
 = 
NÚe


182 
u¾s
 = 
NÚe


185 
’codšg
 = 'utf-8'

188 
def
 
	$__š™__
(
£lf
, 
u¾s
, 
¡©us
=
NÚe
, 
’codšg
=None):

189 
impÜt
 
ch”rypy


190 
»que¡
 = 
ch”rypy
.
£rvšg
.request

192 
	$isš¡ªû
(
u¾s
, 
ba£¡ršg
):

193 
u¾s
 = [urls]

195 
abs_u¾s
 = []

196 
u¾
 
š
 
u¾s
:

197 
u¾
 = 
	$tÚ©ive
(
u¾
, 
’codšg
 
Ü
 
£lf
.encoding)

199 #NÙ
th©
 
u¾još
 
wl
 "dØthrighˆthšg" 
wh‘h”
 
u¾
 
is
:

200 #1. 
a
 
com¶‘e
 
URL
 
w™h
 
	`ho¡
 (
e
.
g
. "http://www.example.com/test")

201 #2. 
a
 
URL
 
»Ïtive
 
to
 
	`roÙ
 (
e
.
g
. "/dummy")

202 #3. 
a
 
URL
 
»Ïtive
 
to
 
the
 
cu¼’t
 
·th


203 #NÙ
th©
 
ªy
 
qu”y
 
¡ršg
 
š
 
ch”rypy
.
»que¡
 
is
 
disÿrded
.

204 
u¾
 = 
	`_u¾još
(
ch”rypy
.
	`u¾
(), url)

205 
abs_u¾s
.
	$­³nd
(
u¾
)

206 
£lf
.
u¾s
 = 
abs_u¾s


208 #RFC 2616 
šdiÿ‹s
 
a
 301 
»¥Ú£
 
code
 
f™s
 
our
 
gßl
; 
howev”
,

209 #brow£¸
suµÜt
 301 
is
 
qu™e
 
messy
. 
Do
 302/303 
š¡—d
. 
S“


211 
¡©us
 
is
 
NÚe
:

212 
»que¡
.
´ÙocŞ
 >= (1, 1):

213 
¡©us
 = 303

215 
¡©us
 = 302

217 
¡©us
 = (status)

218 
¡©us
 < 300 
Ü
 status > 399:

219 
¿i£
 
	`V®ueE¼Ü
("status must be between 300‡nd 399.")

221 
£lf
.
¡©us
 = status

222 
Ch”ryPyExû±iÚ
.
	$__š™__
(
£lf
, 
abs_u¾s
, 
¡©us
)

224 
def
 
	$£t_»¥Ú£
(
£lf
):

227 
Ch”ryPy
 
u£s
 
this
 
š‹º®ly
, 
but
 
you
 
ÿn
 
®so
 
u£
 
™
 
to
 
ü—‹
 
ª


228 
HTTPRedœeù
 
objeù
 
ªd
 
£t
 
™s
 
ouut
 
w™hout
 *
¿isšg
* 
the
 
exû±iÚ
.

230 
impÜt
 
ch”rypy


231 
»¥Ú£
 = 
ch”rypy
.
£rvšg
.response

232 
»¥Ú£
.
¡©us
 = stu ğ
£lf
.status

234 
¡©us
 
	$š
 (300, 301, 302, 303, 307):

235 
»¥Ú£
.
h—d”s
['Content-Type'] = "text/html;charset=utf-8"

236 #"
The
 ... 
URI
 
SHOULD
 
be
 
giv’
 
by
 
the
 
LoÿtiÚ
 
f›ld


237 #š 
the
 
»¥Ú£
."

238 
»¥Ú£
.
h—d”s
['LoÿtiÚ'] = 
£lf
.
u¾s
[0]

240 #"
UÆess
 
the
 
»que¡
 
m‘hod
 
was
 
HEAD
,h
’t™y
 
of
h
»¥Ú£


241 #SHOULD 
cÚš
 
a
 
hy³¹ext
 
nÙe
 
w™h
‡ 
hy³¾šk
 
to
 
the


242 #Ãw 
	`URI
(
s
)."

243 
msg
 = {300: "This„esource can be found‡t <a href='%s'>%s</a>.",

248 
	}
}[
¡©us
]

249 
msgs
 = [
msg
 % (
u
, uèu 
š
 
£lf
.
u¾s
]

250 
	g»¥Ú£
.
	gbody
 = 
Áob
("<b¸/>\n".
još
(
msgs
), 'utf-8')

251 #P»viou 
code
 
may
 
have
 
£t
 
C
-
L
, 
so
 
we
 hav
to
 
»£t
 
™


252 #(
®low
 
fš®ize
 
to
 
£t
 
™
).

253 
	g»¥Ú£
.
	gh—d”s
.
pİ
('CÚ‹Á-L’gth', 
NÚe
)

254 
–if
 
	g¡©us
 == 304:

255 #NÙ 
Modif›d
.

256 #"
The
 
»¥Ú£
 
MUST
 
šşude
 
the
 
fŞlowšg
 
h—d”
 
f›lds
:

257 #D©e, 
uÆess
 
™s
 
omissiÚ
 
is
 
»quœed
 
by
 
£ùiÚ
 14.18.1"

258 #Th"D©e" 
h—d”
 
should
 
have
 
b“n
 
£t
 
š
 
Re¥Ú£
.
__š™__


260 #"...
the
 
»¥Ú£
 
SHOULD
 
NOT
 
šşude
 
Ùh”
 
’t™y
-
h—d”s
."

261 
key
 
š
 ('Allow', 'Content-Encoding', 'Content-Language',

265 
key
 
š
 
»¥Ú£
.
h—d”s
:

266 
d–
 
»¥Ú£
.
h—d”s
[
key
]

268 #"
The
 304 
»¥Ú£
 
MUST
 
NOT
 
cÚš
 
a
 
mes§ge
-
body
."

269 
»¥Ú£
.
body
 = 
NÚe


270 #P»viou 
code
 
may
 
have
 
£t
 
C
-
L
, 
so
 
we
 hav
to
 
»£t
 
™
.

271 
	g»¥Ú£
.
	gh—d”s
.
pİ
('CÚ‹Á-L’gth', 
NÚe
)

272 
–if
 
	g¡©us
 == 305:

273 #U£ 
Proxy
.

274 #£lf.
u¾s
[0] 
should
 
be
 
the
 
URI
 
of
h
´oxy
.

275 
»¥Ú£
.
h—d”s
['LoÿtiÚ'] = 
£lf
.
u¾s
[0]

276 
»¥Ú£
.
body
 = 
NÚe


277 #P»viou 
code
 
may
 
have
 
£t
 
C
-
L
, 
so
 
we
 hav
to
 
»£t
 
™
.

278 
	g»¥Ú£
.
	gh—d”s
.
pİ
('CÚ‹Á-L’gth', 
NÚe
)

280 
¿i£
 
V®ueE¼Ü
("Th% ¡©u codi unknown." % 
¡©us
)

282 
def
 
	$__ÿÎ__
(
£lf
):

284 
¿i£
 
£lf


287 
def
 
	$ş—n_h—d”s
(
¡©us
):

289 
impÜt
 
ch”rypy


291 
»¥Ú£
 = 
ch”rypy
.
£rvšg
.response

293 #Remov
h—d”s
 
which
 
­¶›d
 
to
 
the
 
Üigš®
 
cÚ‹Á
,

294 #buˆdØ
nÙ
 
­¶y
 
to
 
the
 
”rÜ
 
·ge
.

295 
»¥h—d”s
 = 
»¥Ú£
.
h—d”s


296 
key
 
š
 ["Accept-Ranges", "Age", "ETag", "Location", "Retry-After",

299 
key
 
š
 
»¥h—d”s
:

300 
d–
 
»¥h—d”s
[
key
]

302 
¡©us
 != 416:

303 #A 
£rv”
 
£ndšg
 
a
 
»¥Ú£
 
w™h
 
¡©us
 
code
 416 (
Reque¡ed


304 #¿ng
nÙ
 
§tisfŸbË
è
SHOULD
 
šşude
 
a
 
CÚ‹Á
-
Rªge
 
f›ld


305 #w™h 
a
 
by‹
-
¿nge
-
»¥
-
¥ec
 
of
 "*". 
The
 
š¡ªû
-
Ëngth


306 #¥ecif› 
the
 
cu¼’t
 
Ëngth
 
of
h
£Ëùed
 
»sourû
.

307 #A 
»¥Ú£
 
w™h
 
¡©us
 
code
 206 (
P¬tŸl
 
CÚ‹Á
è
MUST
 
NOT


308 #šşud
a
 
CÚ‹Á
-
Rªge
 
f›ld
 
w™h
‡ 
by‹
-
¿nge
- 
»¥
-
¥ec
 
of
 "*".

309 "CÚ‹Á-Rªge" 
š
 
»¥h—d”s
:

310 
d–
 
»¥h—d”s
["Content-Range"]

313 
şass
 
	$HTTPE¼Ü
(
Ch”ryPyExû±iÚ
):

316 
This
 
exû±iÚ
 
ÿn
 
be
 
u£d
 
to
 
autom©iÿÎy
 
£nd
 
a
 
»¥Ú£
 
usšg
‡ 
h‰p
 
¡©us


317 
code
, 
w™h
 
ª
 
­´İrŸ‹
 
”rÜ
 
·ge
. 
It
 
kes
‡À
İtiÚ®


318 ``
¡©us
`` 
	`¬gum’t
 (
which
 
mu¡
 
be
 
b‘w“n
 400 
ªd
 599); 
™
 
deçuÉs
 
to
 500

319 ("IÁ”ÇÈS”v” E¼Ü"). 
It
 
®so
 
kes
 
ª
 
İtiÚ®
 ``
mes§ge
`` 
¬gum’t
,

320 
which
 
wl
 
be
 
»tuºed
 
š
 
the
 
»¥Ú£
 
body
. 
S“


321 `
RFC
 2616 <
h‰p
:

322 
a
 
com¶‘e
 
li¡
 
of
 
avaabË
 
”rÜ
 
codes
 
ªd
 
wh’
 
to
 
u£
 
them
.

324 
Exam¶es
::

326 
¿i£
 
ch”rypy
.
	$HTTPE¼Ü
(403)

327 
¿i£
 
ch”rypy
.
	`HTTPE¼Ü
("403 Forbidden", "You‡re‚ot‡llowedo‡ccesshis„esource.")

330 
¡©us
 = 
NÚe


333 
code
 = 
NÚe


336 
»asÚ
 = 
NÚe


339 
def
 
	$__š™__
(
£lf
, 
¡©us
=500, 
mes§ge
=
NÚe
):

340 
£lf
.
¡©us
 = status

341 
Œy
:

342 
£lf
.
code
, s–f.
»asÚ
, 
deçuÉmsg
 = 
_h‰put
.
	$v®id_¡©us
(
¡©us
)

343 
exû±
 
V®ueE¼Ü
:

344 
¿i£
 
£lf
.
	`__şass__
(500, 
	`_exc_šfo
()[1].
¬gs
[0])

346 
£lf
.
code
 < 400 
Ü
 self.code > 599:

347 
¿i£
 
	`V®ueE¼Ü
("status must be between 400‡nd 599.")

349 #S“ 
h‰p
:

350 #£lf.
mes§ge
 = message

351 
£lf
.
_mes§ge
 = 
mes§ge
 
Ü
 
deçuÉmsg


352 
Ch”ryPyExû±iÚ
.
	$__š™__
(
£lf
, 
¡©us
, 
mes§ge
)

354 
def
 
	$£t_»¥Ú£
(
£lf
):

357 
Ch”ryPy
 
u£s
 
this
 
š‹º®ly
, 
but
 
you
 
ÿn
 
®so
 
u£
 
™
 
to
 
ü—‹
 
ª


358 
HTTPE¼Ü
 
objeù
 
ªd
 
£t
 
™s
 
ouut
 
w™hout
 *
¿isšg
* 
the
 
exû±iÚ
.

360 
impÜt
 
ch”rypy


362 
»¥Ú£
 = 
ch”rypy
.
£rvšg
.response

364 
	$ş—n_h—d”s
(
£lf
.
code
)

366 #IÀ
®l
 
ÿ£s
, 
fš®ize
 
wl
 
be
 
ÿÎed
 
aá”
 
this
 
m‘hod
,

367 #sØ
dÚ
't bother cleaning up„esponse values here.

368 
»¥Ú£
.
¡©us
 = 
£lf
.status

369 
tb
 = 
NÚe


370 
ch”rypy
.
£rvšg
.
»que¡
.
show_Œaûbacks
:

371 
tb
 = 
	$fÜm©_exc
()

372 
»¥Ú£
.
h—d”s
['Content-Type'] = "text/html;charset=utf-8"

373 
»¥Ú£
.
h—d”s
.
	`pİ
('CÚ‹Á-L’gth', 
NÚe
)

375 
cÚ‹Á
 = 
£lf
.
	`g‘_”rÜ_·ge
(£lf.
¡©us
, 
Œaûback
=
tb
,

376 
mes§ge
=
£lf
.
_mes§ge
).
	`’code
('utf-8')

377 
»¥Ú£
.
body
 = 
cÚ‹Á


379 
	$_be_›_unä›ndly
(
£lf
.
code
)

381 
def
 
	$g‘_”rÜ_·ge
(
£lf
, *
¬gs
, **
kw¬gs
):

382  
	$g‘_”rÜ_·ge
(*
¬gs
, **
kw¬gs
)

384 
def
 
	$__ÿÎ__
(
£lf
):

386 
¿i£
 
£lf


389 
şass
 
	$NÙFound
(
HTTPE¼Ü
):

392 
This
 
is
 
equiv®’t
 
to
 
¿isšg


393 :
şass
:`
	`HTTPE¼Ü
("404 NÙ Found"è<
ch”rypy
.
_ı”rÜ
.
HTTPE¼Ü
>`.

396 
def
 
	$__š™__
(
£lf
, 
·th
=
NÚe
):

397 
·th
 
is
 
NÚe
:

398 
impÜt
 
ch”rypy


399 
»que¡
 = 
ch”rypy
.
£rvšg
.request

400 
·th
 = 
»que¡
.
süt_Çme
 +„eque¡.
·th_šfo


401 
£lf
.
¬gs
 = (
·th
,)

402 
HTTPE¼Ü
.
	`__š™__
(
£lf
, 404, "Th·th '%s' wa nÙ found." % 
·th
)

405 
_HTTPE¼ÜTem¶©e
 = '''<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"

407 <
html
>

408 <
h—d
>

409 <
m‘a
 
h‰p
-
equiv
="CÚ‹Á-Ty³" 
cÚ‹Á
="text/html; charset=utf-8"></meta>

410 <
t™Ë
>%(
¡©us
)
s
</title>

411 <
¡yË
 
ty³
="text/css">

413 
m¬gš
-
tİ
: 20
px
;

414 
bÜd”
-
tİ
: 2
px
 
sŞid
 
bÏck
;

415 
fÚt
-
¡yË
: 
™®ic
;

416 
	}
}

419 
	gcŞÜ
: 
»d
;

421 </
	g¡yË
>

422 </
	gh—d
>

423 <
	gbody
>

424 <
	gh2
>%(
	g¡©us
)
	gs
</h2>

425 <
	gp
>%(
	gmes§ge
)
	gs
</p>

426 <
´e
 
	gid
="Œaûback">%(
Œaûback
)
s
</pre>

427 <
div
 
id
="powered_by">

428 <
¥ª
>
Pow”ed
 
by
 <
a
 
h»f
="h‰p://www.ch”rypy.Üg">
Ch”ryPy
 %(
v”siÚ
)
s
</a></span>

429 </
div
>

430 </
body
>

431 </
html
>

434 
def
 
	$g‘_”rÜ_·ge
(
¡©us
, **
kw¬gs
):

437 
¡©us
 
should
 
be
 
ª
 
Ü
 
a
 
¡r
.

438 
kw¬gs
 
wl
 
be
 
š‹½Ş©ed
 
što
 
the
 
·ge
 
‹m¶©e
.

440 
impÜt
 
ch”rypy


442 
Œy
:

443 
code
, 
»asÚ
, 
mes§ge
 = 
_h‰put
.
	$v®id_¡©us
(
¡©us
)

444 
exû±
 
V®ueE¼Ü
:

445 
¿i£
 
ch”rypy
.
	`HTTPE¼Ü
(500, 
	`_exc_šfo
()[1].
¬gs
[0])

447 #W
ÿn
't use setdefault here, because some

448 #ÿÎ” 
£nd
 
NÚe
 
kw¬g
 
v®ues
.

449 
kw¬gs
.
	`g‘
('¡©us'è
is
 
NÚe
:

450 
kw¬gs
['¡©us'] = "% %s" % (
code
, 
»asÚ
)

451 
kw¬gs
.
	`g‘
('mes§ge'è
is
 
NÚe
:

452 
kw¬gs
['mes§ge'] = 
mes§ge


453 
kw¬gs
.
	`g‘
('Œaûback'è
is
 
NÚe
:

454 
kw¬gs
['traceback'] = ''

455 
kw¬gs
.
	`g‘
('v”siÚ'è
is
 
NÚe
:

456 
kw¬gs
['v”siÚ'] = 
ch”rypy
.
__v”siÚ__


458 
k
, 
v
 
š
 
	$™”™ems
(
kw¬gs
):

459 
v
 
is
 
NÚe
:

460 
kw¬gs
[
k
] = ""

462 
kw¬gs
[
k
] = 
	$_esÿ³
(
kw¬gs
[
k
])

464 #U£ 
a
 
cu¡om
 
‹m¶©e
 
Ü
 
ÿÎabË
 
the
 
”rÜ
 
·ge
?

465 
·ges
 = 
ch”rypy
.
£rvšg
.
»que¡
.
”rÜ_·ge


466 
”rÜ_·ge
 = 
·ges
.
	$g‘
(
code
è
Ü
 
·ges
.
	`g‘
('default')

467 
”rÜ_·ge
:

468 
Œy
:

469 
	`ha§‰r
(
”rÜ_·ge
, '__call__'):

470  
	$”rÜ_·ge
(**
kw¬gs
)

472 
d©a
 = 
	`İ’
(
”rÜ_·ge
, 'rb').
	$»ad
()

473  
	`tÚ©ive
(
d©a
è% 
kw¬gs


474 
exû±
:

475 
e
 = 
	`_fÜm©_exû±iÚ
(*
	`_exc_šfo
())[-1]

476 
m
 = 
kw¬gs
['message']

477 
m
:

478 
m
 += "<br />"

479 
m
 +ğ"IÀadd™iÚ,hcu¡omƒ¼Ü…agçed:\n<b¸/>%s" % 
e


480 
kw¬gs
['mes§ge'] = 
m


482  
_HTTPE¼ÜTem¶©e
 % 
kw¬gs


485 
_›_ä›ndly_”rÜ_sizes
 = {

489 
	}
}

492 
def
 
	$_be_›_unä›ndly
(
¡©us
):

493 
impÜt
 
ch”rypy


494 
»¥Ú£
 = 
ch”rypy
.
£rvšg
.response

496 #FÜ 
some
 
¡©u£s
, 
IÁ”Ãt
 
Ex¶Ü”
 5+ 
shows
 "friendlyƒrror

498 #thª 
a
 
giv’
 
size
. 
Fix
 
this
 
by
 
»tuºšg
‡ 
body
 
ov”
 
th©
 size

499 #(
by
 
addšg
 
wh™e¥aû
).

500 #S“ 
h‰p
:

501 
s
 = 
_›_ä›ndly_”rÜ_sizes
.
	$g‘
(
¡©us
, 0)

502 
s
:

503 
s
 += 1

504 #Sšû 
we
 
¬e
 
issušg
 
ª
 
HTTP
 
”rÜ
 
¡©us
, w
assume
 
th©


505 #th
’t™y
 
is
 , 
ªd
 
we
 
should
 
ju¡
 
cŞÏp£
 
™
.

506 
cÚ‹Á
 = 
»¥Ú£
.
	$cŞÏp£_body
()

507 
l
 = 
	$Ën
(
cÚ‹Á
)

508 
l
 
ªd
† < 
s
:

509 #IN 
ADDITION
: 
the
 
»¥Ú£
 
mu¡
 
be
 
wr™‹n
 
to
 
IE


510 #š 
Úe
 
chunk
 
Ü
 
™
 
wl
 
¡l
 
g‘
 
»¶aûd
! 
Bah
.

511 
cÚ‹Á
 = cÚ‹Á + (
	`Áob
(" "è* (
s
 - 
l
))

512 
»¥Ú£
.
body
 = 
cÚ‹Á


513 
»¥Ú£
.
h—d”s
['CÚ‹Á-L’gth'] = 
	`¡r
(
	$Ën
(
cÚ‹Á
))

516 
def
 
	$fÜm©_exc
(
exc
=
NÚe
):

518 
Œy
:

519 
exc
 
is
 
NÚe
:

520 
exc
 = 
	$_exc_šfo
()

521 
exc
 =ğ(
NÚe
, None, None):

523 
impÜt
 
Œaûback


524  "".
	`još
(
Œaûback
.
	$fÜm©_exû±iÚ
(*
exc
))

525 
fš®ly
:

526 
d–
 
exc


528 
def
 
	$b¬e_”rÜ
(
exŒabody
=
NÚe
):

531 
R‘uºs
 
a
 
ŒË
 
w™hout
 
ÿÎšg
 
ªy
 
Ùh”
 
que¡iÚabË
 
funùiÚs
,

532 
so
 
™
 
should
 
be
 
as
 
”rÜ
-
ä“
‡ 
possibË
. 
C®l
 iˆ
äom
 
ª
 
HTTP
 
£rv”


533 
you
 
g‘
 
”rÜs
 
outside
 
of
 
the
 
»que¡
.

535 
If
 
exŒabody
 
is
 
NÚe
, 
a
 
ä›ndly
 
but
 
¿th”
 
unh–pful
 
”rÜ
 
mes§ge


536 
is
 
£t
 
š
 
the
 
body
. 
If
 
exŒabody
 i 
a
 
¡ršg
, 
™
 
wl
 
be
 
­³nded


537 
as
-
is
 
to
 
the
 
body
.

540 #Th
whŞe
 
pošt
 
of
 
this
 
funùiÚ
 
is
 
to
 
be
 
a
 
Ï¡
 
lše
-of-
deãn£


541 #š 
hªdlšg
 
”rÜs
. 
Th©
 
is
, 
™
 
mu¡
 
nÙ
 
¿i£
 
ªy
ƒ¼Ü 
™£lf
;

542 #™ 
ÿÂÙ
 
be
 
®lowed
 
to
 
ç
. 
Th”efÜe
, 
dÚ
't‡ddo it!

543 #IÀ
·¹icuÏr
, 
dÚ
't call‡ny other CP functions.

545 
body
 = 
	`Áob
("Unrecoverableƒrror inhe server.")

546 
exŒabody
 
is
 
nÙ
 
NÚe
:

547 
nÙ
 
	$isš¡ªû
(
exŒabody
, 
by‹¡r
):

548 
exŒabody
 =ƒxŒabody.
	`’code
('utf-8')

549 
body
 +ğ
	`Áob
("\n"è+ 
exŒabody


551  (
	`Áob
("500 Internal Server Error"),

552 [(
	`Áob
('Content-Type'),‚tob('text/plain')),

553 (
	`Áob
('CÚ‹Á-L’gth'),‚tob(
	`¡r
(
	`Ën
(
body
)),'ISO-8859-1'))],

554 [
body
])

	@trunk/objs/CherryPy-3.2.4/cherrypy/_cplogging.py

2 
Sim¶e
 
	gcÚfig


5 
AÉhough
 
Ch”ryPy
 
u£s
 
the
 :
mod
:`
PythÚ
 
loggšg
 
moduË
 <loggšg>`, 
™
 
dÛs
 
so


6 
behšd
 
the
 
sûÃs
 
so
 
th©
 
sim¶e
 
loggšg
 
is
 
	gsim¶e
, 
but
 
com¶iÿ‹d
†ogging

7 
is
 
¡l
 
	gpossibË
. "Sim¶e" 
loggšg
 
m—ns
 
th©
 
you
 
ÿn
 
log
 
to
 
the
 
	gsü“n


8 (
	gi
.
	ge
. 
	gcÚsŞe
/
	g¡dout
è
Ü
 
to
 
a
 
	gfe
, 
ªd
 
th©
 
you
 
ÿn
 
—sy
 
have
 
£·¿‹


9 
”rÜ
 
ªd
 
acûss
 
log
 
	gfes
.

11 
H”e
 
¬e
 
the
 
sim¶if›d
 
loggšg
 
	g£‰šgs
. 
You
 
u£
 
the£
 
by
 
addšg
 
lšes
 
to


12 
your
 
cÚfig
 
fe
 
Ü
 
	gdiù
. 
You
 
should
 
£t
 
the£
 
©
 
e™h”
 
the
 
glob®
 
Ëv–
 or

13 
³r
 
­¶iÿtiÚ
 (
£e
 
Ãxt
), 
but
 
g’”®ly
 
nÙ
 
	gbÙh
.

15 * ``
	glog
.
	gsü“n
``: 
S‘
 
this
 
to
 
True
Ø
have
 
bÙh
 "”rÜ" 
ªd
 "acûss" 
mes§ges


16 
´š‹d
 
to
 
¡dout
.

17 * ``
log
.
acûss_fe
``: 
S‘
 
this
 
to
 
ª
 
absŞu‹
 
f’ame
 
wh”e
 
you
 
wªt


18 "acûss" 
mes§ges
 
wr™‹n
.

19 * ``
log
.
”rÜ_fe
``: 
S‘
 
this
 
to
 
ª
 
absŞu‹
 
f’ame
 
wh”e
 
you
 
wªt
 "error"

20 
mes§ges
 
wr™‹n
.

22 
Mªy
 
ev’ts
 
¬e
 
autom©iÿÎy
 
logged
; 
to
 
log
 
your
 
own
 
­¶iÿtiÚ
 
	gev’ts
, 
	gÿÎ


23 :
func
:`
ch”rypy
.
log
`.

25 
Arch™eùu»


28 
S•¬©e
 
scİes


31 
Ch”ryPy
 
´ovides
 
log
 
mªag”s
 
©
 
bÙh
 
the
 
glob®
 
ªd
 
­¶iÿtiÚ
 
Ïy”s
.

32 
This
 
m—ns
 
you
 
ÿn
 
have
 
Úe
 
£t
 
of
 
loggšg
 
ruËs
 
your
 
’tœe
 
s™e
,

33 
ªd
 
ªÙh”
 
£t
 
of
 
ruËs
 
¥ecific
 
to
 
—ch
 
	g­¶iÿtiÚ
. 
The
 
glob®
 
log


34 
mªag”
 
is
 
found
 
	g©
 :
func
:`
ch”rypy
.
log
`, 
ªd
 
the
†og mªag” 
—ch


35 
­¶iÿtiÚ
 
is
 
found
 
	g©
 :
©Œ
:`
­p
.
log
<
ch”rypy
.
_ıŒ“
.
AµliÿtiÚ
.log>`.

36 
If
 
you
're inside‡„equest,he†atter is„eachable from

37 ``
ch”rypy
.
»que¡
.
­p
.
log
``; 
	gyou
'» outsid¨»que¡, you'
Î
 
have
 
to
 
obš


38 
a
 
»ã»nû
 
to
 
	gthe
 ``
	g­p
``: 
e™h”
 
the
  
v®ue
 
of


39 :
func
:`
Œ“
.
mouÁ
()<
ch”rypy
.
_ıŒ“
.
T»e
.mouÁ>` 
Ü
, 
you
 
	gu£d


40 :
func
:`
quick¡¬t
()<
ch”rypy
.quick¡¬t>` 
š¡—d
, 
	gvŸ
 ``
	gch”rypy
.
	gŒ“
.
	g­ps
['/']``.

42 
By
 , 
the
 
glob®
 
logs
 
¬e
 
	gÇmed
 "ch”rypy.”rÜ" 
	gªd
 "cherrypy.access",

43 
ªd
 
the
 
­¶iÿtiÚ
 
logs
 
¬e
 
	gÇmed
 "ch”rypy.”rÜ.2378745" 
	gªd


44 "ch”rypy.acûss.2378745" (
the
 
numb”
 
is
h
id
 
of
h
AµliÿtiÚ
 
	gobjeù
).

45 
This
 
m—ns
 
th©
 
the
 
­¶iÿtiÚ
 
	glogs
 "bubbË up" 
to
h
s™e
†ogs, 
so
 
your


46 
­¶iÿtiÚ
 
has
 
no
 
log
 
	ghªdËrs
, 
the
 
	gs™e
-
Ëv–
 
hªdËrs
 
wl
 
¡l
†oghe

47 
	gmes§ges
.

49 
E¼Üs
 
	gvs
. 
	gAcûss


52 
Each
 
log
 
mªag”
 
hªdËs
 
	gbÙh
 "acûss" 
	$mes§ges
 (
Úe
 
³r
 
HTTP
 
»que¡
è
ªd


53 "”rÜ" 
	`mes§ges
 (
ev”ythšg
 ). 
NÙe
 
th©
 
the
 "”rÜ" 
log
 
is
 
nÙ
 
ju¡
 

54 
”rÜs
! 
The
 
fÜm©
 
of
 
acûss
 
mes§ges
 
is
 
highly
 
fÜm®ized
, 
but
 
the
 
”rÜ
 
log


55 
i¢
't--it„eceives messages from‡ variety of sources (including fullƒrror

56 
Œaûbacks
, 
’abËd
).

59 
Cu¡om
 
HªdËrs


62 
The
 
sim¶e
 
£‰šgs
 
above
 
wÜk
 
by
 
mªuÏtšg
 
PythÚ
's standard :mod:`logging`

63 
moduË
. 
So
 
wh’
 
you
 
Ãed
 
som‘hšg
 
mÜe
 
com¶ex
, 
the
 
fuÎ
 
pow”
 
of
h
¡ªd¬d


64 
moduË
 
is
 
yours
 
to
 
ex¶o™
. 
You
 
ÿn
 
bÜrow
 
Ü
 
ü—‹
 
cu¡om
 
hªdËrs
, 
fÜm©s
,

65 
f‹rs
, 
ªd
 
much
 
mÜe
. 
H”e
's‡nƒxamplehat skipshe standard FileHandler

66 
ªd
 
u£s
 
a
 
RÙ©šgFeHªdËr
 
š¡—d
:

71 
log
 = 
­p
.log

73 #Remov
the
  
FeHªdËrs
 
´e£Á
.

74 
log
.
”rÜ_fe
 = ""

75 
log
.
acûss_fe
 = ""

77 
maxBy‹s
 = 
	`g‘©Œ
(
log
, "rot_maxBytes", 10000000)

78 
backupCouÁ
 = 
	`g‘©Œ
(
log
, "rot_backupCount", 1000)

80 #Mak
a
 
Ãw
 
RÙ©šgFeHªdËr
 
the
 
”rÜ
 
log
.

81 
âame
 = 
	`g‘©Œ
(
log
, "rot_error_file", "error.log")

82 
h
 = 
hªdËrs
.
	`RÙ©šgFeHªdËr
(
âame
, 'a', 
maxBy‹s
, 
backupCouÁ
)

83 
h
.
	$£tLev–
(
DEBUG
)

84 
h
.
	$£tFÜm©‹r
(
_ıloggšg
.
logfmt
)

85 
log
.
”rÜ_log
.
	$addHªdËr
(
h
)

87 #Mak
a
 
Ãw
 
RÙ©šgFeHªdËr
 
the
 
acûss
 
log
.

88 
âame
 = 
	`g‘©Œ
(
log
, "rot_access_file", "access.log")

89 
h
 = 
hªdËrs
.
	`RÙ©šgFeHªdËr
(
âame
, 'a', 
maxBy‹s
, 
backupCouÁ
)

90 
h
.
	$£tLev–
(
DEBUG
)

91 
h
.
	$£tFÜm©‹r
(
_ıloggšg
.
logfmt
)

92 
log
.
acûss_log
.
	$addHªdËr
(
h
)

95 
The
 ``
rÙ_
*`` 
©Œibu‹s
 
¬e
 
puÎed
 
¡¿ight
 
äom
 
the
 
­¶iÿtiÚ
 
log
 
objeù
.

96 
Sšû
 "log.*" 
cÚfig
 
’Œ›s
 
sim¶y
 
£t
 
©Œibu‹s
 
Ú
 
the
 
log
 
objeù
, 
you
 
ÿn


97 
add
 
cu¡om
 
©Œibu‹s
 
to
 
your
 
h—¹
's content. Notehathese handlers‡re

98 
u£d
 ''
š¡—d
'' 
of
 
the
 , 
sim¶e
 
hªdËrs
 
oušed
 
	`above
 (
so
 
dÚ
't set

99 
the
 "log.”rÜ_fe" 
cÚfig
 
’Œy
, 
exam¶e
).

102 
impÜt
 
d©‘ime


103 
impÜt
 
loggšg


104 #S’û 
the
 
no
-
hªdËrs
 "w¬nšg" (
¡d”r
 
wr™e
!è
š
 
¡dlib
 
loggšg


105 
loggšg
.
Logg”
.
mªag”
.
em™‹dNoHªdËrW¬nšg
 = 1

106 
logfmt
 = 
loggšg
.
	`FÜm©‹r
("%(message)s")

107 
impÜt
 
os


108 
impÜt
 
sys


110 
impÜt
 
ch”rypy


111 
äom
 
ch”rypy
 
impÜt
 
_ı”rÜ


112 
äom
 
ch”rypy
.
_ıcom·t
 
impÜt
 
Áob
, 
py3k


115 
şass
 
	$NuÎHªdËr
(
loggšg
.
HªdËr
):

118 
def
 
	$hªdË
(
£lf
, 
»cÜd
):

119 
·ss


121 
def
 
	$em™
(
£lf
, 
»cÜd
):

122 
·ss


124 
def
 
	$ü—‹Lock
(
£lf
):

125 
£lf
.
lock
 = 
NÚe


128 
şass
 
	$LogMªag”
(
objeù
):

131 ``
ch”rypy
.
log
`` 
is
 
ª
 
š¡ªû
 
of
 
this
 
şass
.

134 
­pid
 = 
NÚe


136 
is
 
a
 
glob®
 
log
 
mªag”
, 
­pid
 i 
NÚe
."""

138 
”rÜ_log
 = 
NÚe


141 
acûss_log
 = 
NÚe


144 
py3k
:

145 
acûss_log_fÜm©
 = \

148 
acûss_log_fÜm©
 = \

151 
logg”_roÙ
 = 
NÚe


152 """Th"
tİ
-
Ëv–
"†ogger‚ame.

154 
This
 
¡ršg
 
wl
 
be
 
u£d
 
as
 
the
 
fœ¡
 
£gm’t
 
š
h
Logg”
 
Çmes
.

155 
The
  
is
 "ch”rypy", 
exam¶e
, 
š
 
which
 
the
 
Logg”
 
Çmes


156 
wl
 
be
 
of
 
the
 
fÜm
::

158 
ch”rypy
.
”rÜ
.<
­pid
>

159 
ch”rypy
.
acûss
.<
­pid
>

162 
def
 
	`__š™__
(
£lf
, 
­pid
=
NÚe
, 
logg”_roÙ
="cherrypy"):

163 
£lf
.
logg”_roÙ
 =†ogger_root

164 
£lf
.
­pid
 =‡ppid

165 
­pid
 
is
 
NÚe
:

166 
£lf
.
”rÜ_log
 = 
loggšg
.
	`g‘Logg”
("%s.”rÜ" % 
logg”_roÙ
)

167 
£lf
.
acûss_log
 = 
loggšg
.
	`g‘Logg”
("%s.acûss" % 
logg”_roÙ
)

169 
£lf
.
”rÜ_log
 = 
loggšg
.
	`g‘Logg”
("%s.”rÜ.%s" % (
logg”_roÙ
, 
­pid
))

170 
£lf
.
acûss_log
 = 
loggšg
.
	`g‘Logg”
("%s.acûss.%s" % (
logg”_roÙ
, 
­pid
))

171 
£lf
.
”rÜ_log
.
	$£tLev–
(
loggšg
.
INFO
)

172 
£lf
.
acûss_log
.
	$£tLev–
(
loggšg
.
INFO
)

174 #S’û 
the
 
no
-
hªdËrs
 "w¬nšg" (
¡d”r
 
wr™e
!è
š
 
¡dlib
 
loggšg


175 
£lf
.
”rÜ_log
.
	`addHªdËr
(
	$NuÎHªdËr
())

176 
£lf
.
acûss_log
.
	`addHªdËr
(
	$NuÎHªdËr
())

178 
ch”rypy
.
’gše
.
	`subsüibe
('g¿ûful', 
£lf
.
»İ’_fes
)

180 
def
 
	$»İ’_fes
(
£lf
):

182 
log
 
	$š
 (
£lf
.
”rÜ_log
, s–f.
acûss_log
):

183 
h
 
š
 
log
.
hªdËrs
:

184 
	$isš¡ªû
(
h
, 
loggšg
.
FeHªdËr
):

185 
h
.
	$acquœe
()

186 
h
.
¡»am
.
	$şo£
()

187 
h
.
¡»am
 = 
	$İ’
(
h
.
ba£F’ame
, h.
mode
)

188 
h
.
	$»Ëa£
()

190 
def
 
	`”rÜ
(
£lf
, 
msg
='', 
cÚ‹xt
='', 
£v”™y
=
loggšg
.
INFO
, 
Œaûback
=
F®£
):

193 
This
 
is
 
nÙ
 
ju¡
 
”rÜs
! 
AµliÿtiÚs
 
may
 
ÿÎ
 
this
 
©
 
ªy
 
time


194 
to
 
log
 
­¶iÿtiÚ
-
¥ecific
 
šfÜm©iÚ
.

196 
If
 ``
Œaûback
`` 
is
 
True
, 
the
¿ûback 
of
h
cu¼’t
 
exû±iÚ


197 (
ªy
è
wl
 
be
 
­³nded
 
to
 ``
msg
``.

199 
Œaûback
:

200 
msg
 +ğ
_ı”rÜ
.
	$fÜm©_exc
()

201 
£lf
.
”rÜ_log
.
	`log
(
£v”™y
, ' '.
	`još
((£lf.
	`time
(), 
cÚ‹xt
, 
msg
)))

203 
def
 
	$__ÿÎ__
(
£lf
, *
¬gs
, **
kw¬gs
):

205  
£lf
.
	$”rÜ
(*
¬gs
, **
kw¬gs
)

207 
def
 
	$acûss
(
£lf
):

210 
S“
 
h‰p
:

211 
d‘as
.

213 
Ch”ryPy
 
ÿÎs
 
this
 
autom©iÿÎy
 
you
. 
NÙe
 
th”e
 
¬e
 
no
 
¬gum’ts
;

214 
™
 
cŞËùs
 
the
 
d©a
 
™£lf
 
äom


215 :
şass
:`
ch”rypy
.
»que¡
<ch”rypy.
_ı»que¡
.
Reque¡
>`.

217 
Like
 
A·che
 
¡¬‹d
 
došg
 
š
 2.0.46, 
nÚ
-
´šbË
 
ªd
 
Ùh”
 
¥ecŸl


218 
ch¬aù”s
 
š
 %
	$r
 (
ªd
 
we
 
ex·nd
 
th©
 
to
 
®l
 
·¹s
è
¬e
 
esÿ³d
 
usšg


219 \\
xhh
 
£qu’ûs
, 
wh”e
 
hh
 
¡ªds
 
the
 
hexadecim®
 
»´e£Á©iÚ


220 
of
 
the
 
¿w
 
by‹
. 
Exû±iÚs
 
äom
 
this
 
ruË
 
¬e
 "‡nd \\, which‡re

221 
esÿ³d
 
by
 
´•’dšg
 
a
 
back¦ash
, 
ªd
 
®l
 
wh™e¥aû
 
ch¬aù”s
,

222 
which
 
¬e
 
wr™‹n
 
š
 
theœ
 
C
-
¡yË
 
	`nÙ©iÚ
 (\\
n
, \\
t
, 
‘c
).

224 
»que¡
 = 
ch”rypy
.
£rvšg
.request

225 
»mÙe
 = 
»que¡
.remote

226 
»¥Ú£
 = 
ch”rypy
.
£rvšg
.response

227 
outh—d”s
 = 
»¥Ú£
.
h—d”s


228 
šh—d”s
 = 
»que¡
.
h—d”s


229 
»¥Ú£
.
ouut_¡©us
 
is
 
NÚe
:

230 
¡©us
 = "-"

232 
¡©us
 = 
»¥Ú£
.
ouut_¡©us
.
	`¥l™
(
	`Áob
(" "), 1)[0]

233 
py3k
:

234 
¡©us
 = stus.
	`decode
('ISO-8859-1')

236 
©oms
 = {'h': 
»mÙe
.
Çme
 
Ü
„emÙe.

,

238 'u': 
	`g‘©Œ
(
»que¡
, "logš", 
NÚe
è
Ü
 "-",

239 't': 
£lf
.
	`time
(),

240 'r': 
»que¡
.
»que¡_lše
,

241 's': 
¡©us
,

242 'b': 
diù
.
	`g‘
(
outh—d”s
, 'CÚ‹Á-L’gth', ''è
Ü
 "-",

243 'f': 
diù
.
	`g‘
(
šh—d”s
, 'Referer', ''),

244 'a': 
diù
.
	`g‘
(
šh—d”s
, 'User-Agent', ''),

245 
	}
}

246 
py3k
:

247 
k
, 
v
 
š
 
	g©oms
.
	$™ems
():

248 
nÙ
 
	$isš¡ªû
(
v
, 
¡r
):

249 
v
 = 
	$¡r
(
v
)

250 
v
 = v.
	`»¶aû
('"', '\\"').
	`’code
('utf8')

251 #FÜtuÇ‹ly, 
	`»´
(
¡r
è
esÿ³s
 
uÅršbË
 
ch¬s
, \
n
, \
t
, 
‘c


252 #ªd 
back¦ash
 
us
. 
AÎ
 
we
 
have
 
to
 dØ
is
 
¡r
 
the
 
quÙes
.

253 
v
 = 
	`»´
(v)[2:-1]

255 #š 
pythÚ
 3.0 
the
 
»´
 
of
 
	`by‹s
 (
as
 
»tuºed
 
by
 
’code
)

257 #»suÉšg 
š
 
quadru¶e
 
¦ashes
. 
Remove
 
the
 
exŒa
 
Úe
 
h”e
.

258 
v
 = v.
	`»¶aû
('\\\\', '\\')

260 #Esÿ³ -
quÙe
.

261 
©oms
[
k
] = 
v


263 
Œy
:

264 
£lf
.
acûss_log
.
	`log
(
loggšg
.
INFO
, s–f.
acûss_log_fÜm©
.
	$fÜm©
(**
©oms
))

265 
exû±
:

266 
	$£lf
(
Œaûback
=
True
)

268 
k
, 
v
 
š
 
©oms
.
	$™ems
():

269 
	$isš¡ªû
(
v
, 
unicode
):

270 
v
 = v.
	`’code
('utf8')

271 
–if
 
nÙ
 
	$isš¡ªû
(
v
, 
¡r
):

272 
v
 = 
	$¡r
(
v
)

273 #FÜtuÇ‹ly, 
	`»´
(
¡r
è
esÿ³s
 
uÅršbË
 
ch¬s
, \
n
, \
t
, 
‘c


274 #ªd 
back¦ash
 
us
. 
AÎ
 
we
 
have
 
to
 dØ
is
 
¡r
 
the
 
quÙes
.

275 
v
 = 
	`»´
(v)[1:-1]

276 #Esÿ³ -
quÙe
.

277 
©oms
[
k
] = 
v
.
	`»¶aû
('"', '\\"')

279 
Œy
:

280 
£lf
.
acûss_log
.
	`log
(
loggšg
.
INFO
, s–f.
acûss_log_fÜm©
 % 
©oms
)

281 
exû±
:

282 
	$£lf
(
Œaûback
=
True
)

284 
def
 
	$time
(
£lf
):

286 
now
 = 
d©‘ime
.d©‘ime.
	$now
()

287 
mÚthÇmes
 = ['jan', 'feb', 'mar', 'apr', 'may', 'jun',

289 
mÚth
 = 
mÚthÇmes
[
now
.mÚth - 1].
	$ÿp™®ize
()

291 (
now
.
day
, 
mÚth
,‚ow.
y—r
,‚ow.
hour
,‚ow.
mšu‹
,‚ow.
£cÚd
))

293 
def
 
	$_g‘_butš_hªdËr
(
£lf
, 
log
, 
key
):

294 
h
 
š
 
log
.
hªdËrs
:

295 
	`g‘©Œ
(
h
, "_ıbutš", 
NÚe
è=ğ
key
:

296  
h


299 #------------------------- 
Sü“n
 
hªdËrs
 ------------------------- #


300 
def
 
	$_£t_sü“n_hªdËr
(
£lf
, 
log
, 
’abË
, 
¡»am
=
NÚe
):

301 
h
 = 
£lf
.
	`_g‘_butš_hªdËr
(
log
, "screen")

302 
’abË
:

303 
nÙ
 
h
:

304 
¡»am
 
is
 
NÚe
:

305 
¡»am
=
sys
.
¡d”r


306 
h
 = 
loggšg
.
	$SŒ—mHªdËr
(
¡»am
)

307 
h
.
	$£tFÜm©‹r
(
logfmt
)

308 
h
.
_ıbutš
 = "screen"

309 
log
.
	$addHªdËr
(
h
)

310 
–if
 
h
:

311 
log
.
hªdËrs
.
	$»move
(
h
)

313 
def
 
	$_g‘_sü“n
(
£lf
):

314 
h
 = 
£lf
.
_g‘_butš_hªdËr


315 
has_h
 = 
	`h
(
£lf
.
”rÜ_log
, "sü“n"è
Ü
 h(£lf.
acûss_log
, "screen")

316  
	$boŞ
(
has_h
)

318 
def
 
	$_£t_sü“n
(
£lf
, 
Ãwv®ue
):

319 
£lf
.
	$_£t_sü“n_hªdËr
(
£lf
.
”rÜ_log
, 
Ãwv®ue
, 
¡»am
=
sys
.
¡d”r
)

320 
£lf
.
	$_£t_sü“n_hªdËr
(
£lf
.
acûss_log
, 
Ãwv®ue
, 
¡»am
=
sys
.
¡dout
)

321 
sü“n
 = 
	`´İ”ty
(
_g‘_sü“n
, 
_£t_sü“n
,

322 
doc
="""Turn stderr/stdout†ogging on or off.

324 
If
 
you
 
£t
 
this
 
to
 
True
, 
™
'll‡ddhe‡ppropriate StreamHandler for

325 
you
. 
If
 you 
£t
 
™
 
to
 
F®£
, iˆ
wl
 
»move
 
the
 
hªdËr
.

328 #-------------------------- 
Fe
 
hªdËrs
 -------------------------- #


329 
def
 
	$_add_butš_fe_hªdËr
(
£lf
, 
log
, 
âame
):

330 
h
 = 
loggšg
.
	$FeHªdËr
(
âame
)

331 
h
.
	$£tFÜm©‹r
(
logfmt
)

332 
h
.
_ıbutš
 = "file"

333 
log
.
	$addHªdËr
(
h
)

335 
def
 
	$_£t_fe_hªdËr
(
£lf
, 
log
, 
f’ame
):

336 
h
 = 
£lf
.
	`_g‘_butš_hªdËr
(
log
, "file")

337 
f’ame
:

338 
h
:

339 
h
.
ba£F’ame
 !ğ
os
.
·th
.
	$ab¥©h
(
f’ame
):

340 
h
.
	$şo£
()

341 
log
.
hªdËrs
.
	$»move
(
h
)

342 
£lf
.
	$_add_butš_fe_hªdËr
(
log
, 
f’ame
)

344 
£lf
.
	$_add_butš_fe_hªdËr
(
log
, 
f’ame
)

346 
h
:

347 
h
.
	$şo£
()

348 
log
.
hªdËrs
.
	$»move
(
h
)

350 
def
 
	$_g‘_”rÜ_fe
(
£lf
):

351 
h
 = 
£lf
.
	`_g‘_butš_hªdËr
(£lf.
”rÜ_log
, "file")

352 
h
:

353  
h
.
ba£F’ame


355 
def
 
	$_£t_”rÜ_fe
(
£lf
, 
Ãwv®ue
):

356 
£lf
.
	$_£t_fe_hªdËr
(
£lf
.
”rÜ_log
, 
Ãwv®ue
)

357 
”rÜ_fe
 = 
	`´İ”ty
(
_g‘_”rÜ_fe
, 
_£t_”rÜ_fe
,

358 
doc
="""The filename for self.error_log.

360 
If
 
you
 
£t
 
this
 
to
 
a
 
¡ršg
, 
™
'll‡ddhe‡ppropriate FileHandler for

361 
you
. 
If
 you 
£t
 
™
 
to
 ``
NÚe
`` 
Ü
 ``''``, iˆ
wl
 
»move
 
the
 
hªdËr
.

364 
def
 
	$_g‘_acûss_fe
(
£lf
):

365 
h
 = 
£lf
.
	`_g‘_butš_hªdËr
(£lf.
acûss_log
, "file")

366 
h
:

367  
h
.
ba£F’ame


369 
def
 
	$_£t_acûss_fe
(
£lf
, 
Ãwv®ue
):

370 
£lf
.
	$_£t_fe_hªdËr
(
£lf
.
acûss_log
, 
Ãwv®ue
)

371 
acûss_fe
 = 
	`´İ”ty
(
_g‘_acûss_fe
, 
_£t_acûss_fe
,

372 
doc
="""The filename for self.access_log.

374 
If
 
you
 
£t
 
this
 
to
 
a
 
¡ršg
, 
™
'll‡ddhe‡ppropriate FileHandler for

375 
you
. 
If
 you 
£t
 
™
 
to
 ``
NÚe
`` 
Ü
 ``''``, iˆ
wl
 
»move
 
the
 
hªdËr
.

378 #------------------------- 
WSGI
 
hªdËrs
 ------------------------- #


379 
def
 
	$_£t_wsgi_hªdËr
(
£lf
, 
log
, 
’abË
):

380 
h
 = 
£lf
.
	`_g‘_butš_hªdËr
(
log
, "wsgi")

381 
’abË
:

382 
nÙ
 
h
:

383 
h
 = 
	$WSGIE¼ÜHªdËr
()

384 
h
.
	$£tFÜm©‹r
(
logfmt
)

385 
h
.
_ıbutš
 = "wsgi"

386 
log
.
	$addHªdËr
(
h
)

387 
–if
 
h
:

388 
log
.
hªdËrs
.
	$»move
(
h
)

390 
def
 
	$_g‘_wsgi
(
£lf
):

391  
	`boŞ
(
£lf
.
	`_g‘_butš_hªdËr
(£lf.
”rÜ_log
, "wsgi"))

393 
def
 
	$_£t_wsgi
(
£lf
, 
Ãwv®ue
):

394 
£lf
.
	$_£t_wsgi_hªdËr
(
£lf
.
”rÜ_log
, 
Ãwv®ue
)

395 
wsgi
 = 
	`´İ”ty
(
_g‘_wsgi
, 
_£t_wsgi
,

396 
doc
="""Writeƒrrorso wsgi.errors.

398 
If
 
you
 
£t
 
this
 
to
 
True
, 
™
'll‡ddhe‡ppropriate

399 :
şass
:`
WSGIE¼ÜHªdËr
<
ch”rypy
.
_ıloggšg
.WSGIE¼ÜHªdËr>` 
you


400 (
which
 
wr™es
 
”rÜs
 
to
 ``
wsgi
.errors``).

401 
If
 
you
 
£t
 
™
 
to
 
F®£
, iˆ
wl
 
»move
 
the
 
hªdËr
.

405 
şass
 
	$WSGIE¼ÜHªdËr
(
loggšg
.
HªdËr
):

408 
def
 
	$æush
(
£lf
):

410 
Œy
:

411 
¡»am
 = 
ch”rypy
.
£rvšg
.
»que¡
.
wsgi_’vœÚ
.
	`g‘
('wsgi.errors')

412 
	$exû±
 (
A‰ribu‹E¼Ü
, 
KeyE¼Ü
):

413 
·ss


415 
¡»am
.
	$æush
()

417 
def
 
	$em™
(
£lf
, 
»cÜd
):

419 
Œy
:

420 
¡»am
 = 
ch”rypy
.
£rvšg
.
»que¡
.
wsgi_’vœÚ
.
	`g‘
('wsgi.errors')

421 
	$exû±
 (
A‰ribu‹E¼Ü
, 
KeyE¼Ü
):

422 
·ss


424 
Œy
:

425 
msg
 = 
£lf
.
	$fÜm©
(
»cÜd
)

426 
fs
 = "%s\n"

427 
impÜt
 
ty³s


428 
nÙ
 
	`ha§‰r
(
ty³s
, "UnicodeTy³"): #ià
no
 
unicode
 
suµÜt
...

429 
¡»am
.
	`wr™e
(
fs
 % 
msg
)

431 
Œy
:

432 
¡»am
.
	`wr™e
(
fs
 % 
msg
)

433 
exû±
 
UnicodeE¼Ü
:

434 
¡»am
.
	`wr™e
(
fs
 % 
msg
.
	`’code
("UTF-8"))

435 
£lf
.
	$æush
()

436 
exû±
:

437 
£lf
.
	`hªdËE¼Ü
(
»cÜd
)

	@trunk/objs/CherryPy-3.2.4/cherrypy/_cpmodpy.py

3 
Basic
 
	gu§ge
:

6 #AµliÿtiÚ 
š
 
a
 
moduË
 
ÿÎed
 
my­p
.
py


9 
impÜt
 
ch”rypy


11 
şass
 
RoÙ
:

12 @
ch”rypy
.
expo£


13 
def
 
	$šdex
(
£lf
):

17 #W
wl
 
u£
 
this
 
m‘hod
 
äom
 
the
 
mod_pythÚ
 
cÚfigu¿tiÚ


18 #a 
the
 
’Œy
 
pošt
 
to
 
our
 
­¶iÿtiÚ


19 
def
 
	$£tup_£rv”
():

20 
ch”rypy
.
Œ“
.
	`mouÁ
(
	$RoÙ
())

21 
ch”rypy
.
cÚfig
.
	`upd©e
({'environment': 'production',

22 'log.sü“n': 
F®£
,

23 'show_Œaûbacks': 
F®£
})

26 #mod_pythÚ 
£‰šgs
 
­ache2


27 #Thi 
should
 
»side
 
š
 
your
 
h‰pd
.
cÚf


28 #Ü 
a
 
fe
 
th©
 
wl
 
be
 
lßded
 
©


29 #­ach
¡¬tup


33 
Docum’tRoÙ
 "/"

34 
Li¡’
 8080

35 
LßdModuË
 
pythÚ_moduË
 /
u¤
/
lib
/
­ache2
/
moduËs
/
mod_pythÚ
.
so


37 <
LoÿtiÚ
 "/">

38 
PythÚP©h
 "sys.path+['/path/to/my/application']"

39 
S‘HªdËr
 
pythÚ
-
´og¿m


40 
PythÚHªdËr
 
ch”rypy
.
_ımodpy
::
hªdËr


41 
PythÚO±iÚ
 
ch”rypy
.
£tup
 
my­p
::
£tup_£rv”


42 
PythÚDebug
 
On


43 </
LoÿtiÚ
>

46 
The
 
aùu®
 
·th
 
to
 
your
 
mod_pythÚ
.
so
 
is
 
d•’d’t
 
Ú
 your

47 
’vœÚm’t
. 
In
 
this
 
we
 
suµo£
 
a
 
glob®
 
mod_pythÚ


48 
š¡®ÏtiÚ
 
Ú
 
a
 
Lšux
 
di¡ributiÚ
 
such
 
as
 
UbuÁu
.

50 
We
 dØ
£t
 
the
 
PythÚP©h
 
cÚfigu¿tiÚ
 
£‰šg
 
so
 
th©


51 
your
 
­¶iÿtiÚ
 
ÿn
 
be
 
found
 
by
 
äom
 
the
 
u£r
 
ruÂšg


52 
the
 
­ache2
 
š¡ªû
. 
Of
 
cour£
 
your
 
­¶iÿtiÚ


53 
»sides
 
š
 
the
 
glob®
 
s™e
-
·ckage
 
this
 
wÚ
't be‚eeded.

55 
Th’
 
»¡¬t
 
­ache2
 
ªd
 
acûss
 
h‰p
:

58 
impÜt
 
loggšg


59 
impÜt
 
sys


61 
impÜt
 
ch”rypy


62 
äom
 
ch”rypy
.
_ıcom·t
 
impÜt
 
By‹sIO
, 
	gcİy™ems
, 
Áob


63 
äom
 
	gch”rypy
.
_ı”rÜ
 
impÜt
 
	gfÜm©_exc
, 
b¬e_”rÜ


64 
äom
 
	gch”rypy
.
lib
 
impÜt
 
	gh‰put


67 #------------------------------ 
Reque¡
-
hªdlšg


71 
def
 
	$£tup
(
»q
):

72 
äom
 
mod_pythÚ
 
impÜt
 
­ache


74 #RuÀ
ªy
 
£tup
 
funùiÚs
 
defšed
 
by
 
a
 "PythÚO±iÚ ch”rypy.£tup" 
dœeùive
.

75 
İtiÚs
 = 
»q
.
	$g‘_İtiÚs
()

76 'ch”rypy.£tup' 
š
 
İtiÚs
:

77 
funùiÚ
 
š
 
İtiÚs
['ch”rypy.£tup'].
	$¥l™
():

78 
©oms
 = 
funùiÚ
.
	`¥l™
('::', 1)

79 
	`Ën
(
©oms
) == 1:

80 
mod
 = 
	`__impÜt__
(
©oms
[0], 
	`glob®s
(), 
	$loÿls
())

82 
modÇme
, 
âame
 = 
©oms


83 
mod
 = 
	`__impÜt__
(
modÇme
, 
	`glob®s
(), 
	`loÿls
(), [
âame
])

84 
func
 = 
	$g‘©Œ
(
mod
, 
âame
)

85 
	$func
()

87 
ch”rypy
.
cÚfig
.
	`upd©e
({'log.sü“n': 
F®£
,

88 "toŞs.ignÜe_h—d”s.Ú": 
True
,

90 
	}
})

92 
	g’gše
 = 
ch”rypy
.
’gše


93 
ha§‰r
(
’gše
, "signal_handler"):

94 
’gše
.
sigÇl_hªdËr
.
	$unsubsüibe
()

95 
	`ha§‰r
(
’gše
, "console_control_handler"):

96 
’gše
.
cÚsŞe_cÚŒŞ_hªdËr
.
	$unsubsüibe
()

97 
’gše
.
autÜ–ßd
.
	$unsubsüibe
()

98 
ch”rypy
.
£rv”
.
	$unsubsüibe
()

100 
def
 
	$_log
(
msg
, 
Ëv–
):

101 
ÃwËv–
 = 
­ache
.
APLOG_ERR


102 
loggšg
.
DEBUG
 >ğ
Ëv–
:

103 
ÃwËv–
 = 
­ache
.
APLOG_DEBUG


104 
–if
 
loggšg
.
INFO
 >ğ
Ëv–
:

105 
ÃwËv–
 = 
­ache
.
APLOG_INFO


106 
–if
 
loggšg
.
WARNING
 >ğ
Ëv–
:

107 
ÃwËv–
 = 
­ache
.
APLOG_WARNING


108 #OÀ
Wšdows
, 
»q
.
£rv”
 
is
 
»quœed
 
Ü
 
the
 
msg
 
wl
 
vªish
. 
S“


111 
­ache
.
	$log_”rÜ
(
msg
, 
ÃwËv–
, 
»q
.
£rv”
)

112 
’gše
.
	`subsüibe
('log', 
_log
)

114 
’gše
.
	$¡¬t
()

116 
def
 
	$ch”rypy_ş—nup
(
d©a
):

117 
’gše
.
	$ex™
()

118 
Œy
:

119 #­ache.
»gi¡”_ş—nup
 
wa¢
't‡vailable until 3.1.4.

120 
­ache
.
	$»gi¡”_ş—nup
(
ch”rypy_ş—nup
)

121 
exû±
 
A‰ribu‹E¼Ü
:

122 
»q
.
£rv”
.
	$»gi¡”_ş—nup
(
»q
, 
ch”rypy_ş—nup
)

125 
şass
 
_R—dOÆyReque¡
:

126 
expo£
 = ('read', 'readline', 'readlines')

127 
def
 
	$__š™__
(
£lf
, 
»q
):

128 
m‘hod
 
š
 
£lf
.
expo£
:

129 
£lf
.
__diù__
[
m‘hod
] = 
	$g‘©Œ
(
»q
, 
m‘hod
)

132 
»cursive
 = 
F®£


134 
_isS‘Up
 = 
F®£


135 
def
 
	$hªdËr
(
»q
):

136 
äom
 
mod_pythÚ
 
impÜt
 
­ache


137 
Œy
:

138 
glob®
 
_isS‘Up


139 
nÙ
 
_isS‘Up
:

140 
	$£tup
(
»q
)

141 
_isS‘Up
 = 
True


143 #Obš 
a
 
Reque¡
 
objeù
 
äom
 
Ch”ryPy


144 
loÿl
 = 
»q
.
cÚÃùiÚ
.
loÿl_addr


145 
loÿl
 = 
h‰put
.
	`Ho¡
Öoÿl[0],†oÿl[1], 
»q
.
cÚÃùiÚ
.
loÿl_ho¡
 
Ü
 "")

146 
»mÙe
 = 
»q
.
cÚÃùiÚ
.
»mÙe_addr


147 
»mÙe
 = 
h‰put
.
	`Ho¡
ÔemÙe[0],„emÙe[1], 
»q
.
cÚÃùiÚ
.
»mÙe_ho¡
 
Ü
 "")

149 
scheme
 = 
»q
.
·r£d_uri
[0] 
Ü
 'http'

150 
»q
.
	$g‘_basic_auth_pw
()

152 
Œy
:

153 #­ache.
mpm_qu”y
 
Úly
 
beÿme
 
avaabË
 
š
 
mod_pythÚ
 3.1

154 
q
 = 
­ache
.
mpm_qu”y


155 
th»aded
 = 
	$q
(
­ache
.
AP_MPMQ_IS_THREADED
)

156 
fÜked
 = 
	$q
(
­ache
.
AP_MPMQ_IS_FORKED
)

157 
exû±
 
A‰ribu‹E¼Ü
:

158 
bad_v®ue
 = ("You must…rovide‡ PythonOption '%s', "

162 
th»aded
 = 
İtiÚs
.
	`g‘
('muÉ™h»ad', '').
	$low”
()

163 
th»aded
 == 'on':

164 
th»aded
 = 
True


165 
–if
 
th»aded
 == 'off':

166 
th»aded
 = 
F®£


168 
¿i£
 
	`V®ueE¼Ü
(
bad_v®ue
 % "multithread")

170 
fÜked
 = 
İtiÚs
.
	`g‘
('muÉroûss', '').
	$low”
()

171 
fÜked
 == 'on':

172 
fÜked
 = 
True


173 
–if
 
fÜked
 == 'off':

174 
fÜked
 = 
F®£


176 
¿i£
 
	`V®ueE¼Ü
(
bad_v®ue
 % "multiprocess")

178 
¢
 = 
ch”rypy
.
Œ“
.
	`süt_Çme
(
»q
.
uri
 
Ü
 "/")

179 
¢
 
is
 
NÚe
:

180 
	`£nd_»¥Ú£
(
»q
, '404 Not Found', [], '')

182 
­p
 = 
ch”rypy
.
Œ“
.
­ps
[
¢
]

183 
m‘hod
 = 
»q
.method

184 
·th
 = 
»q
.
uri


185 
qs
 = 
»q
.
¬gs
 
Ü
 ""

186 
»q´Ùo
 = 
»q
.
´ÙocŞ


187 
h—d”s
 = 
	$cİy™ems
(
»q
.
h—d”s_š
)

188 
rfe
 = 
	$_R—dOÆyReque¡
(
»q
)

189 
´ev
 = 
NÚe


191 
Œy
:

192 
»dœeùiÚs
 = []

193 
True
:

194 
»que¡
, 
»¥Ú£
 = 
­p
.
	`g‘_£rvšg
(
loÿl
, 
»mÙe
, 
scheme
,

196 
»que¡
.
logš
 = 
»q
.
u£r


197 
»que¡
.
muÉ™h»ad
 = 
	$boŞ
(
th»aded
)

198 
»que¡
.
muÉroûss
 = 
	$boŞ
(
fÜked
)

199 
»que¡
.
­p
 =‡pp

200 
»que¡
.
´ev
 =…rev

202 #RuÀ
the
 
Ch”ryPy
 
Reque¡
 
objeù
 
ªd
 
obš
h
»¥Ú£


203 
Œy
:

204 
»que¡
.
	$run
(
m‘hod
, 
·th
, 
qs
, 
»q´Ùo
, 
h—d”s
, 
rfe
)

206 
exû±
 
ch”rypy
.
IÁ”ÇlRedœeù
:

207 
œ
 = 
sys
.
	`exc_šfo
()[1]

208 
­p
.
	$»Ëa£_£rvšg
()

209 
´ev
 = 
»que¡


211 
nÙ
 
»cursive
:

212 
œ
.
·th
 
š
 
»dœeùiÚs
:

213 
¿i£
 
	`RuÁimeE¼Ü
("InternalRedirector visitedhe "

214 "§mURLwiû: %r" % 
œ
.
·th
)

216 #Add 
the
 *
´evious
* 
·th_šfo
 + 
qs
 
to
 
»dœeùiÚs
.

217 
qs
:

218 
qs
 = "?" + qs

219 
»dœeùiÚs
.
	`­³nd
(
¢
 + 
·th
 + 
qs
)

221 #Mung
’vœÚm’t
 
ªd
 
Œy
 
agaš
.

222 
m‘hod
 = "GET"

223 
·th
 = 
œ
.path

224 
qs
 = 
œ
.
qu”y_¡ršg


225 
rfe
 = 
	$By‹sIO
()

227 
	$£nd_»¥Ú£
(
»q
, 
»¥Ú£
.
ouut_¡©us
,„e¥Ú£.
h—d”_li¡
,

228 
»¥Ú£
.
body
,„e¥Ú£.
¡»am
)

229 
fš®ly
:

230 
­p
.
	$»Ëa£_£rvšg
()

231 
exû±
:

232 
tb
 = 
	$fÜm©_exc
()

233 
ch”rypy
.
	`log
(
tb
, 'MOD_PYTHON', 
£v”™y
=
loggšg
.
ERROR
)

234 
s
, 
h
, 
b
 = 
	$b¬e_”rÜ
()

235 
	$£nd_»¥Ú£
(
»q
, 
s
, 
h
, 
b
)

236  
­ache
.
OK


239 
def
 
	$£nd_»¥Ú£
(
»q
, 
¡©us
, 
h—d”s
, 
body
, 
¡»am
=
F®£
):

240 #S‘ 
»¥Ú£
 
¡©us


241 
»q
.
¡©us
 = (status[:3])

243 #S‘ 
»¥Ú£
 
h—d”s


244 
»q
.
cÚ‹Á_ty³
 = "text/plain"

245 
h—d”
, 
v®ue
 
š
 
h—d”s
:

246 
h—d”
.
	`low”
() == 'content-type':

247 
»q
.
cÚ‹Á_ty³
 = 
v®ue


249 
»q
.
h—d”s_out
.
	$add
(
h—d”
, 
v®ue
)

251 
¡»am
:

252 #Flush 
now
 
so
 
the
 
¡©us
 
ªd
 
h—d”s
 
¬e
 
£Á
 
immedŸ‹ly
.

253 
»q
.
	$æush
()

255 #S‘ 
»¥Ú£
 
body


256 
	$isš¡ªû
(
body
, 
ba£¡ršg
):

257 
»q
.
	$wr™e
(
body
)

259 
£g
 
š
 
body
:

260 
»q
.
	$wr™e
(
£g
)

264 #--------------- 
S¹up
 
toŞs
 
Ch”ryPy
 + 
mod_pythÚ
 --------------- #


266 
impÜt
 
os


267 
impÜt
 
»


268 
Œy
:

269 
impÜt
 
sub´oûss


270 
def
 
	$pİ’
(
fuÎcmd
):

271 
p
 = 
sub´oûss
.
	$Pİ’
(
fuÎcmd
, 
sh–l
=
True
,

272 
¡dout
=
sub´oûss
.
PIPE
, 
¡d”r
=sub´oûss.
STDOUT
,

273 
şo£_fds
=
True
)

274  
p
.
¡dout


275 
exû±
 
ImpÜtE¼Ü
:

276 
def
 
	$pİ’
(
fuÎcmd
):

277 
peš
, 
peout
 = 
os
.
	$pİ’4
(
fuÎcmd
)

278  
peout


281 
def
 
	`»ad_´oûss
(
cmd
, 
¬gs
=""):

282 
fuÎcmd
 = "% %s" % (
cmd
, 
¬gs
)

283 
peout
 = 
	$pİ’
(
fuÎcmd
)

284 
Œy
:

285 
fœ¡lše
 = 
peout
.
	$»adlše
()

286 ià(
»
.
	`£¬ch
(
	`Áob
("ÒÙ„ecognized|NØsuch fe|nÙ found)"), 
fœ¡lše
,

287 
»
.
IGNORECASE
)):

288 
¿i£
 
	`IOE¼Ü
('% mu¡ bÚ you¸sy¡em…©h.' % 
cmd
)

289 
ouut
 = 
fœ¡lše
 + 
peout
.
	$»ad
()

290 
fš®ly
:

291 
peout
.
	$şo£
()

292  
ouut


295 
şass
 
	$ModPythÚS”v”
(
objeù
):

297 
‹m¶©e
 = """

298 #A·che2 
£rv”
 
cÚfigu¿tiÚ
 
fe
 
ruÂšg
 
Ch”ryPy
 
w™h
 
mod_pythÚ
.

300 
Docum’tRoÙ
 "/"

301 
Li¡’
 %(
pÜt
)
s


302 
LßdModuË
 
pythÚ_moduË
 
moduËs
/
mod_pythÚ
.
so


304 <
LoÿtiÚ
 %(
loc
)
s
>

305 
S‘HªdËr
 
pythÚ
-
´og¿m


306 
PythÚHªdËr
 %(
hªdËr
)
s


307 
PythÚDebug
 
On


308 %(
İts
)
s


309 </
LoÿtiÚ
>

312 
def
 
	`__š™__
(
£lf
, 
loc
="/", 
pÜt
=80, 
İts
=
NÚe
, 
­ache_·th
="apache",

313 
hªdËr
="cherrypy._cpmodpy::handler"):

314 
£lf
.
loc
 =†oc

315 
£lf
.
pÜt
 =…ort

316 
£lf
.
İts
 = opts

317 
£lf
.
­ache_·th
 =‡pache_path

318 
£lf
.
hªdËr
 = handler

320 
def
 
	$¡¬t
(
£lf
):

321 
İts
 = "".
	`još
([" PythÚO±iÚ % %s\n" % (
k
, 
v
)

322 
k
, 
v
 
š
 
£lf
.
İts
])

323 
cÚf_d©a
 = 
£lf
.
‹m¶©e
 % {"pÜt": s–f.
pÜt
,

324 "loc": 
£lf
.
loc
,

325 "İts": 
İts
,

326 "hªdËr": 
£lf
.
hªdËr
,

327 
	}
}

329 
mpcÚf
 = 
os
.
·th
.
još
(os.·th.
dœÇme
(
__fe__
), "cpmodpy.conf")

330 
	gf
 = 
İ’
(
mpcÚf
, 'wb')

331 
	gŒy
:

332 
f
.
	$wr™e
(
cÚf_d©a
)

333 
fš®ly
:

334 
f
.
	$şo£
()

336 
»¥Ú£
 = 
	`»ad_´oûss
(
£lf
.
­ache_·th
, "-k s¹ -à%s" % 
mpcÚf
)

337 
£lf
.
»ady
 = 
True


338  
»¥Ú£


340 
def
 
	$¡İ
(
£lf
):

341 
os
.
	`pİ’
("apache -k stop")

342 
£lf
.
»ady
 = 
F®£


	@trunk/objs/CherryPy-3.2.4/cherrypy/_cpnative_server.py

3 
impÜt
 
loggšg


4 
impÜt
 
sys


6 
impÜt
 
ch”rypy


7 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
By‹sIO


8 
äom
 
	gch”rypy
.
_ı”rÜ
 
impÜt
 
	gfÜm©_exc
, 
b¬e_”rÜ


9 
äom
 
	gch”rypy
.
lib
 
impÜt
 
h‰put


10 
äom
 
ch”rypy
 
impÜt
 
wsgi£rv”


13 
şass
 
	$N©iveG©eway
(
wsgi£rv”
.
G©eway
):

15 
»cursive
 = 
F®£


17 
def
 
	$»¥Úd
(
£lf
):

18 
»q
 = 
£lf
.req

19 
Œy
:

20 #Obš 
a
 
Reque¡
 
objeù
 
äom
 
Ch”ryPy


21 
loÿl
 = 
»q
.
£rv”
.
bšd_addr


22 
loÿl
 = 
h‰put
.
	`Ho¡
(local[0],†ocal[1], "")

23 
»mÙe
 = 
»q
.
cÚn
.
»mÙe_addr
,„eq.cÚn.
»mÙe_pÜt


24 
»mÙe
 = 
h‰put
.
	`Ho¡
(remote[0],„emote[1], "")

26 
scheme
 = 
»q
.scheme

27 
¢
 = 
ch”rypy
.
Œ“
.
	`süt_Çme
(
»q
.
uri
 
Ü
 "/")

28 
¢
 
is
 
NÚe
:

29 
£lf
.
	`£nd_»¥Ú£
('404 Not Found', [], [''])

31 
­p
 = 
ch”rypy
.
Œ“
.
­ps
[
¢
]

32 
m‘hod
 = 
»q
.method

33 
·th
 = 
»q
.path

34 
qs
 = 
»q
.q 
Ü
 ""

35 
h—d”s
 = 
»q
.
šh—d”s
.
	$™ems
()

36 
rfe
 = 
»q
.rfile

37 
´ev
 = 
NÚe


39 
Œy
:

40 
»dœeùiÚs
 = []

41 
True
:

42 
»que¡
, 
»¥Ú£
 = 
­p
.
	`g‘_£rvšg
(

43 
loÿl
, 
»mÙe
, 
scheme
, "HTTP/1.1")

44 
»que¡
.
muÉ™h»ad
 = 
True


45 
»que¡
.
muÉroûss
 = 
F®£


46 
»que¡
.
­p
 =‡pp

47 
»que¡
.
´ev
 =…rev

49 #RuÀ
the
 
Ch”ryPy
 
Reque¡
 
objeù
 
ªd
 
obš
h
»¥Ú£


50 
Œy
:

51 
»que¡
.
	$run
(
m‘hod
, 
·th
, 
qs
, 
»q
.
»que¡_´ÙocŞ
, 
h—d”s
, 
rfe
)

53 
exû±
 
ch”rypy
.
IÁ”ÇlRedœeù
:

54 
œ
 = 
sys
.
	`exc_šfo
()[1]

55 
­p
.
	$»Ëa£_£rvšg
()

56 
´ev
 = 
»que¡


58 
nÙ
 
£lf
.
»cursive
:

59 
œ
.
·th
 
š
 
»dœeùiÚs
:

60 
¿i£
 
	`RuÁimeE¼Ü
("InternalRedirector visitedhe "

61 "§mURLwiû: %r" % 
œ
.
·th
)

63 #Add 
the
 *
´evious
* 
·th_šfo
 + 
qs
 
to
 
»dœeùiÚs
.

64 
qs
:

65 
qs
 = "?" + qs

66 
»dœeùiÚs
.
	`­³nd
(
¢
 + 
·th
 + 
qs
)

68 #Mung
’vœÚm’t
 
ªd
 
Œy
 
agaš
.

69 
m‘hod
 = "GET"

70 
·th
 = 
œ
.path

71 
qs
 = 
œ
.
qu”y_¡ršg


72 
rfe
 = 
	$By‹sIO
()

74 
£lf
.
	$£nd_»¥Ú£
(

75 
»¥Ú£
.
ouut_¡©us
,„e¥Ú£.
h—d”_li¡
,

76 
»¥Ú£
.
body
)

77 
fš®ly
:

78 
­p
.
	$»Ëa£_£rvšg
()

79 
exû±
:

80 
tb
 = 
	$fÜm©_exc
()

81 #´šˆ
tb


82 
ch”rypy
.
	`log
(
tb
, 'NATIVE_ADAPTER', 
£v”™y
=
loggšg
.
ERROR
)

83 
s
, 
h
, 
b
 = 
	$b¬e_”rÜ
()

84 
£lf
.
	$£nd_»¥Ú£
(
s
, 
h
, 
b
)

86 
def
 
	$£nd_»¥Ú£
(
£lf
, 
¡©us
, 
h—d”s
, 
body
):

87 
»q
 = 
£lf
.req

89 #S‘ 
»¥Ú£
 
¡©us


90 
»q
.
¡©us
 = 
	`¡r
(¡©u 
Ü
 "500 Server Error")

92 #S‘ 
»¥Ú£
 
h—d”s


93 
h—d”
, 
v®ue
 
š
 
h—d”s
:

94 
»q
.
outh—d”s
.
	`­³nd
((
h—d”
, 
v®ue
))

95 ià(
»q
.
»ady
 
ªd
 
nÙ
„eq.
£Á_h—d”s
):

96 
»q
.
£Á_h—d”s
 = 
True


97 
»q
.
	$£nd_h—d”s
()

99 #S‘ 
»¥Ú£
 
body


100 
£g
 
š
 
body
:

101 
»q
.
	$wr™e
(
£g
)

104 
şass
 
	$CPHTTPS”v”
(
wsgi£rv”
.
HTTPS”v”
):

107 
wsgi£rv”
 
has
 
b“n
 
desigÃd
 
to
 
nÙ
 
»ã»nû
 
Ch”ryPy
 
š
 
ªy
 
way
,

108 
so
 
th©
 
™
 
ÿn
 
be
 
u£d
 
š
 
Ùh”
 
äamewÜks
 
ªd
 
­¶iÿtiÚs
.

109 
Th”efÜe
, 
we
 
w¿p
 
™
 
h”e
, 
so
 w
ÿn
 
­¶y
 
some
 
©Œibu‹s


110 
äom
 
cÚfig
 -> 
ch”rypy
.
£rv”
 -> 
HTTPS”v”
.

113 
def
 
	$__š™__
(
£lf
, 
£rv”_ad­‹r
=
ch”rypy
.
£rv”
):

114 
£lf
.
£rv”_ad­‹r
 = server_adapter

116 
£rv”_Çme
 = (
£lf
.
£rv”_ad­‹r
.
sock‘_ho¡
 
Ü


117 
£lf
.
£rv”_ad­‹r
.
sock‘_fe
 
Ü


118 
NÚe
)

120 
wsgi£rv”
.
HTTPS”v”
.
	$__š™__
(

121 
£lf
, 
£rv”_ad­‹r
.
bšd_addr
, 
N©iveG©eway
,

122 
mšth»ads
=
£rv”_ad­‹r
.
th»ad_poŞ
,

123 
maxth»ads
=
£rv”_ad­‹r
.
th»ad_poŞ_max
,

124 
£rv”_Çme
=server_name)

126 
£lf
.
max_»que¡_h—d”_size
 = s–f.
£rv”_ad­‹r
.max_»que¡_h—d”_siz
Ü
 0

127 
£lf
.
max_»que¡_body_size
 = s–f.
£rv”_ad­‹r
.max_»que¡_body_siz
Ü
 0

128 
£lf
.
»que¡_queue_size
 = s–f.
£rv”_ad­‹r
.
sock‘_queue_size


129 
£lf
.
timeout
 = s–f.
£rv”_ad­‹r
.
sock‘_timeout


130 
£lf
.
shutdown_timeout
 = s–f.
£rv”_ad­‹r
.shutdown_timeout

131 
£lf
.
´ÙocŞ
 = s–f.
£rv”_ad­‹r
.
´ÙocŞ_v”siÚ


132 
£lf
.
nod–ay
 = s–f.
£rv”_ad­‹r
.nodelay

134 
s¦_moduË
 = 
£lf
.
£rv”_ad­‹r
.s¦_moduË 
Ü
 'pyopenssl'

135 
£lf
.
£rv”_ad­‹r
.
s¦_cÚ‹xt
:

136 
ad­‹r_şass
 = 
wsgi£rv”
.
	$g‘_s¦_ad­‹r_şass
(
s¦_moduË
)

137 
£lf
.
s¦_ad­‹r
 = 
	$ad­‹r_şass
(

138 
£lf
.
£rv”_ad­‹r
.
s¦_û¹ifiÿ‹
,

139 
£lf
.
£rv”_ad­‹r
.
s¦_´iv©e_key
,

140 
£lf
.
£rv”_ad­‹r
.
s¦_û¹ifiÿ‹_chaš
)

141 
£lf
.
s¦_ad­‹r
.
cÚ‹xt
 = s–f.
£rv”_ad­‹r
.
s¦_cÚ‹xt


142 
–if
 
£lf
.
£rv”_ad­‹r
.
s¦_û¹ifiÿ‹
:

143 
ad­‹r_şass
 = 
wsgi£rv”
.
	$g‘_s¦_ad­‹r_şass
(
s¦_moduË
)

144 
£lf
.
s¦_ad­‹r
 = 
	`ad­‹r_şass
(

145 
£lf
.
£rv”_ad­‹r
.
s¦_û¹ifiÿ‹
,

146 
£lf
.
£rv”_ad­‹r
.
s¦_´iv©e_key
,

147 
£lf
.
£rv”_ad­‹r
.
s¦_û¹ifiÿ‹_chaš
)

	@trunk/objs/CherryPy-3.2.4/cherrypy/_cpreqbody.py

3 .. 
	gv”siÚadded
:: 3.2

5 
AµliÿtiÚ
 
authÜs
 
have
 
com¶‘e
 
cÚŒŞ
 
ov”
 
the
 
·rsšg
 
of
 
HTTP
 
»que¡


6 
’t™›s
. 
In
 , :
©Œ
:`
ch”rypy
.
»que¡
.
body
<ch”rypy.
_ı»que¡
.
Reque¡
.body>`

7 
is
 
now
 
®ways
 
£t
 
to
 
ª
 
š¡ªû
 
of
 :
şass
:`
Reque¡Body
<
ch”rypy
.
_ı»qbody
.RequestBody>`,

8 
ªd
 *
th©
* 
şass
 
is
 
a
 
subşass
 
	gof
 :şass:`
EÁ™y
<
ch”rypy
.
_ı»qbody
.Entity>`.

10 
Wh’
 
ª
 
HTTP
 
»que¡
 
šşudes
‡À
’t™y
 
body
, 
™
 
is
 
oá’
 
desœabË
 
to


11 
´ovide
 
th©
 
šfÜm©iÚ
 
to
 
­¶iÿtiÚs
 
š
 
a
 
fÜm
 
Ùh”
 
thª
 
the
 
¿w
 
	gby‹s
.

12 
Difã»Á
 
cÚ‹Á
 
ty³s
 
demªd
 
difã»Á
 
	g­´ßches
. 
	gExam¶es
:

14 * 
FÜ
 
a
 
GIF
 
fe
, 
we
 
wªt
 
the
 
¿w
 
by‹s
 
š
‡ 
	g¡»am
.

15 * 
An
 
HTML
 
fÜm
 
is
 
b‘‹r
 
·r£d
 
što
 
™s
 
compÚ’t
 
	gf›lds
, 
ªd
 
—ch
 
‹xt
 
f›ld


16 
decoded
 
äom
 
by‹s
 
to
 
	gunicode
.

17 * 
A
 
JSON
 
body
 
should
 
be
 
de£rŸlized
 
što
 
a
 
PythÚ
 
diù
 
Ü
 
	gli¡
.

19 
Wh’
 
the
 
»que¡
 
cÚšs
 
a
 
	gCÚ‹Á
-
Ty³
 
	gh—d”
,h
medŸ
 
ty³
 
is
 
u£d
 
as
‡

20 
key
 
to
 
look
 
up
 
a
 
v®ue
 
š
 
	gthe


21 :
©Œ
:`
»que¡
.
body
.
´oûssÜs
<
ch”rypy
.
_ı»qbody
.
EÁ™y
.´oûssÜs>` 
diù
.

22 
If
 
the
 
fuÎ
 
medŸ


23 
ty³
 
is
 
nÙ
 
found
, 
th’
 
the
 
majÜ
y³ i 
	gŒ›d
; 
	gexam¶e
, 
no
 
´oûssÜ


24 
is
 
found
 
	gthe
 'image/j³g' 
	gty³
, 
th’
 
we
 
look
 
a
 
´oûssÜ
 the 'image'

25 
ty³s
 
	g®tog‘h”
. 
If
 
Ã™h”
 
the
 
fuÎ
 
ty³
 
nÜ
h
majÜ
y³ 
has
 
a
 
m©chšg


26 
	g´oûssÜ
, 
th’
 
a
  
´oûssÜ
 
is
 
	gu£d


27 (:
func
:`
deçuÉ_´oc
<
ch”rypy
.
_ı»qbody
.
EÁ™y
.deçuÉ_´oc>`). 
FÜ
 
mo¡


28 
ty³s
, 
this
 
m—ns
 
no
 
´oûssšg
 
is
 
	gdÚe
, 
ªd
 
the
 
body
 i 
Ëá
 
uÄ—d
 
as
 
a


29 
¿w
 
by‹
 
	g¡»am
. 
ProûssÜs
 
¬e
 
cÚfigu¿bË
 
š
 
	gª
 'Ú_¡¬t_»sourû' 
	ghook
.

31 
Some
 
	g´oûssÜs
, 
e¥ecŸÎy
 
tho£
 
	gthe
 '‹xt' 
	gty³s
, 
©‹m±
 
to
 
decode
 
by‹s


32 
to
 
	gunicode
. 
If
 
the
 
	gCÚ‹Á
-
Ty³
 
»que¡
 
h—d”
 
šşudes
 
	ga
 'ch¬£t' 
	g·¿m‘”
,

33 
this
 
is
 
u£d
 
to
 
decode
 
the
 
	g’t™y
. 
	gOth”wi£
, 
Úe
 
Ü
 
mÜe
  
ch¬£ts
 
may


34 
be
 
	g©‹m±ed
, 
®though
 
this
 
decisiÚ
 
is
 
up
 
to
 
—ch
 
	g´oûssÜ
. 
If
 
a
 
´oûssÜ


35 
sucûssfuÎy
 
decodes
 
ª
 
EÁ™y
 
Ü
 
	gP¬t
, 
™
 
should
 
£t
 
	gthe


36 :
©Œ
:`
ch¬£t
<
ch”rypy
.
_ı»qbody
.
EÁ™y
.ch¬£t>` 
©Œibu‹


37 
Ú
 
the
 
EÁ™y
 
Ü
 
P¬t
 
to
h
Çme
 
of
h
sucûssful
 
ch¬£t
, 
so
 
th©


38 
­¶iÿtiÚs
 
ÿn
 
—sy
 
	g»
-
’code
 
Ü
 
Œªscode
 
the
 
v®ue
 
they
 
	gwish
.

40 
If
 
the
 
	gCÚ‹Á
-
Ty³
 
of
h
»que¡
 
’t™y
 
is
 oà
majÜ
 
	gty³
 'muÉ¬t', 
th’


41 
the
 
above
 
·rsšg
 
	g´oûss
, 
ªd
 
possibly
 
a
 
decodšg
…roûss, 
is
 
³rfÜmed
 

42 
—ch
 
	g·¹
.

44 
FÜ
 
bÙh
 
the
 
fuÎ
 
’t™y
 
ªd
 
muÉ¬t
 
	g·¹s
, 
a
 
	gCÚ‹Á
-
Di¥os™iÚ
 
h—d”
 
may


45 
be
 
u£d
 
to
 
	gfl
 :
©Œ
:`
Çme
<
ch”rypy
.
_ı»qbody
.
EÁ™y
.Çme>` 
ªd


46 :
©Œ
:`
f’ame
<
ch”rypy
.
_ı»qbody
.
EÁ™y
.f’ame>` 
©Œibu‹s
 
Ú
 
the


47 
»que¡
.
body
 
Ü
 
the
 
P¬t
.

49 .. 
_cu¡ombody´oûssÜs
:

51 
Cu¡om
 
ProûssÜs


54 
You
 
ÿn
 
add
 
your
 
own
 
´oûssÜs
 
ªy
 
¥ecific
 
Ü
 
majÜ
 
MIME
 
ty³
. 
Sim¶y
‡dd

55 
™
 
to
 
the
 :
©Œ
:`
´oûssÜs
<
ch”rypy
.
_ı»que¡
.
EÁ™y
.´oûssÜs>` 
diù
 
š
 
a


56 
hook
/
toŞ
 
th©
 
runs
 
©
 ``
Ú_¡¬t_»sourû
`` 
Ü
 ``
befÜe_»que¡_body
``.

57 
H”e
'she built-in JSONool for‡nƒxample::

59 
def
 
	$jsÚ_š
(
fÜû
=
True
, 
debug
=
F®£
):

60 
»que¡
 = 
ch”rypy
.
£rvšg
.request

61 
def
 
	$jsÚ_´oûssÜ
(
’t™y
):

63 
nÙ
 
’t™y
.
h—d”s
.
	`g‘
("Content-Length", ""):

64 
¿i£
 
ch”rypy
.
	$HTTPE¼Ü
(411)

66 
body
 = 
’t™y
.
å
.
	$»ad
()

67 
Œy
:

68 
»que¡
.
jsÚ
 = 
	$jsÚ_decode
(
body
)

69 
exû±
 
V®ueE¼Ü
:

70 
¿i£
 
ch”rypy
.
	`HTTPE¼Ü
(400, 'Invalid JSON document')

71 
fÜû
:

72 
»que¡
.
body
.
´oûssÜs
.
	$ş—r
()

73 
»que¡
.
body
.
deçuÉ_´oc
 = 
ch”rypy
.
	`HTTPE¼Ü
(

75 
»que¡
.
body
.
´oûssÜs
['­¶iÿtiÚ/jsÚ'] = 
jsÚ_´oûssÜ


77 
We
 
begš
 
by
 
defššg
 
a
 
Ãw
 ``
jsÚ_´oûssÜ
`` 
funùiÚ
 
to
 
¡ick
 
š
 
the
 ``
´oûssÜs
``

78 
diùiÚ¬y
. 
AÎ
 
´oûssÜ
 
funùiÚs
 
ke
 
a
 
sšgË
 
¬gum’t
, 
the
 ``
EÁ™y
`` 
š¡ªû


79 
they
 
¬e
 
to
 
´oûss
. 
It
 
wl
 
be
 
ÿÎed
 
wh’ev”
 
a
 
»que¡
 
is
 
	`»ûived
 (
tho£


80 
URI
's whereheool isurned on) which has‡ ``Content-Type`` of

83 
Fœ¡
, 
™
 
checks
 
a
 
v®id
 ``
CÚ‹Á
-
L’gth
`` (
¿isšg
 411 
nÙ
 v®id), 
th’


84 
»ads
 
the
 
»maššg
 
by‹s
 
Ú
h
sock‘
. 
The
 ``
å
`` 
objeù
 
knows
 
™s
 
own
 
Ëngth
, 
so


85 
™
 
wÚ
't hang waiting for datahat‚ever‡rrives. It will„eturn when‡ll data

86 
has
 
b“n
 
»ad
. 
Th’
, 
we
 
decode
 
tho£
 
by‹s
 
usšg
 
PythÚ
's built-in ``json`` module,

87 
ªd
 
¡ick
 
the
 
decoded
 
»suÉ
 
Úto
 ``
»que¡
.
jsÚ
`` . 
If
 
™
 
ÿÂÙ
 
be
 decoded, 
we


88 
¿i£
 400.

90 
If
 
the
 "fÜû" 
¬gum’t
 
is
 
	`True
 (th),h``
ToŞ
`` 
ş—rs
h``
´oûssÜs
``

91 
diù
 
so
 
th©
 
»que¡
 
’t™›s
 
of
 
Ùh”
 ``
CÚ‹Á
-
Ty³s
`` 
¬’
't…arsed‡t‡ll. Since

92 
th”e
's‚oƒntry forhose invalid MIMEypes,he ``default_proc`` method of ``cherrypy.request.body``

93 
is
 
ÿÎed
. 
But
 
this
 
dÛs
 
nÙhšg
 
by
  (
usu®ly
 
to
 
´ovide
 
the
 
·ge
 
hªdËr
 
ª
 
İpÜtun™y
Ø
hªdË
 
™
.)

94 
But
 
š
 
our
 , 
we
 
wªt
 
to
 
¿i£
 415, 
so
 w
»¶aû
 ``
»que¡
.
body
.
deçuÉ_´oc
``

95 
w™h
 
the
 
	`”rÜ
 (``
HTTPE¼Ü
`` 
š¡ªûs
, 
wh’
 
ÿÎed
, 
¿i£
 
them£lves
).

97 
If
 
we
 
w”e
 
defššg
 
a
 
cu¡om
 
´oûssÜ
, w
ÿn
 dØ
so
 
w™hout
 
makšg
‡ ``
ToŞ
``. 
Ju¡
 
add
 
the
 
cÚfig
 
’Œy
::

99 
»que¡
.
body
.
´oûssÜs
 = {'­¶iÿtiÚ/jsÚ': 
jsÚ_´oûssÜ
}

101 
NÙe
 
th©
 
you
 
ÿn
 
Úly
 
»¶aû
 
the
 ``
´oûssÜs
`` 
diù
 
whŞe§Ë
 
this
 
way
, 
nÙ
 
upd©e
h
exi¡šg
 
	gÚe
.

104 
	gŒy
:

105 
äom
 
io
 
impÜt
 
DEFAULT_BUFFER_SIZE


106 
exû±
 
ImpÜtE¼Ü
:

107 
DEFAULT_BUFFER_SIZE
 = 8192

108 
impÜt
 
»


109 
impÜt
 
sys


110 
impÜt
 
‹mpfe


111 
Œy
:

112 
äom
 
u¾lib
 
impÜt
 
unquÙe_¶us


113 
exû±
 
ImpÜtE¼Ü
:

114 
def
 
	$unquÙe_¶us
(
bs
):

116 
bs
 = bs.
	`»¶aû
(
	`Áob
('+'),‚tob(' '))

117 
©oms
 = 
bs
.
	`¥l™
(
	`Áob
('%'))

118 
i
 
š
 
	`¿nge
(1, 
	$Ën
(
©oms
)):

119 
™em
 = 
©oms
[
i
]

120 
Œy
:

121 
pù
 = (
™em
[:2], 16)

122 
©oms
[
i
] = 
	`by‹s
([
pù
]è+ 
™em
[2:]

123 
exû±
 
V®ueE¼Ü
:

124 
·ss


125  
	`Áob
('').
	$još
(
©oms
)

127 
impÜt
 
ch”rypy


128 
äom
 
ch”rypy
.
_ıcom·t
 
impÜt
 
ba£¡ršg
, 
Áob
, 
Áou


129 
äom
 
ch”rypy
.
lib
 
impÜt
 
h‰put


132 #-------------------------------- 
ProûssÜs
 -------------------------------- #


133 
def
 
	$´oûss_u¾’coded
(
’t™y
):

135 
qs
 = 
’t™y
.
å
.
	$»ad
()

136 
ch¬£t
 
š
 
’t™y
.
©‹m±_ch¬£ts
:

137 
Œy
:

138 
·¿ms
 = {
	}
}

139 
­¬am
 
š
 
qs
.
¥l™
(
Áob
('&')):

140 
·œ
 
š
 
­¬am
.
¥l™
(
Áob
(';')):

141 
nÙ
 
·œ
:

144 
©oms
 = 
·œ
.
¥l™
(
Áob
('='), 1)

145 
Ën
(
©oms
) == 1:

146 
©oms
.
­³nd
(
Áob
(''))

148 
key
 = 
unquÙe_¶us
(
©oms
[0]).
	$decode
(
ch¬£t
)

149 
v®ue
 = 
	`unquÙe_¶us
(
©oms
[1]).
	$decode
(
ch¬£t
)

151 
key
 
š
 
·¿ms
:

152 
nÙ
 
	$isš¡ªû
(
·¿ms
[
key
], 
li¡
):

153 
·¿ms
[
key
] = [params[key]]

154 
·¿ms
[
key
].
	$­³nd
(
v®ue
)

156 
·¿ms
[
key
] = 
v®ue


157 
exû±
 
UnicodeDecodeE¼Ü
:

158 
·ss


160 
’t™y
.
ch¬£t
 = charset

163 
¿i£
 
ch”rypy
.
	`HTTPE¼Ü
(

165 "ch¬£t w”©‹m±ed: %s" % 
	$»´
(
’t™y
.
©‹m±_ch¬£ts
))

167 #Now 
th©
 
®l
 
v®ues
 
have
 
b“n
 
sucûssfuÎy
 
·r£d
 
ªd
 
decoded
,

168 #­¶y 
them
 
to
 
the
 
’t™y
.
·¿ms
 
diù
.

169 
key
, 
v®ue
 
š
 
·¿ms
.
	$™ems
():

170 
key
 
š
 
’t™y
.
·¿ms
:

171 
nÙ
 
	$isš¡ªû
(
’t™y
.
·¿ms
[
key
], 
li¡
):

172 
’t™y
.
·¿ms
[
key
] = [entity.params[key]]

173 
’t™y
.
·¿ms
[
key
].
	$­³nd
(
v®ue
)

175 
’t™y
.
·¿ms
[
key
] = 
v®ue


178 
def
 
	$´oûss_muÉ¬t
(
’t™y
):

180 
ib
 = ""

181 'bound¬y' 
š
 
’t™y
.
cÚ‹Á_ty³
.
·¿ms
:

183 #"
The
 
g¿mm¬
 
·¿m‘”s
 
Ú
 
the
 
CÚ‹Á
-
ty³
 
f›ld
 
is
 
such
 
th©
 
™


184 #i 
oá’
 
Ãûs§ry
 
to
 
’şo£
 
the
 
bound¬y
 
·¿m‘”
 
v®ues
 
š
 
quÙes


185 #Ú 
the
 
CÚ‹Á
-
ty³
 
lše
"

186 
ib
 = 
’t™y
.
cÚ‹Á_ty³
.
·¿ms
['bound¬y'].
	`¡r
('"')

188 
nÙ
 
»
.
	`m©ch
("^[ -~]{0,200}[!-~]$", 
ib
):

189 
¿i£
 
	`V®ueE¼Ü
('Inv®id bound¬y iÀmuÉ¬ˆfÜm: %r' % (
ib
,))

191 
ib
 = ('--' + ib).
	`’code
('ascii')

193 #Fšd 
the
 
fœ¡
 
m¬k”


194 
True
:

195 
b
 = 
’t™y
.
	$»adlše
()

196 
nÙ
 
b
:

199 
b
 = b.
	$¡r
()

200 
b
 =ğ
ib
:

203 #R—d 
®l
 
·¹s


204 
True
:

205 
·¹
 = 
’t™y
.
·¹_şass
.
	$äom_å
(
’t™y
.
å
, 
ib
)

206 
’t™y
.
·¹s
.
	$­³nd
(
·¹
)

207 
·¹
.
	$´oûss
()

208 
·¹
.
å
.
dÚe
:

211 
def
 
	$´oûss_muÉ¬t_fÜm_d©a
(
’t™y
):

213 
	$´oûss_muÉ¬t
(
’t™y
)

215 
k•t_·¹s
 = []

216 
·¹
 
š
 
’t™y
.
·¹s
:

217 
·¹
.
Çme
 
is
 
NÚe
:

218 
k•t_·¹s
.
	$­³nd
(
·¹
)

220 
·¹
.
f’ame
 
is
 
NÚe
:

222 
v®ue
 = 
·¹
.
	$fuÎv®ue
()

225 #ha 
acûss
 
to
 
™s
 .
fe
 
ªd
 .
f’ame
 
©Œibu‹s
.

226 
v®ue
 = 
·¹


228 
·¹
.
Çme
 
š
 
’t™y
.
·¿ms
:

229 
nÙ
 
	$isš¡ªû
(
’t™y
.
·¿ms
[
·¹
.
Çme
], 
li¡
):

230 
’t™y
.
·¿ms
[
·¹
.
Çme
] = [entity.params[part.name]]

231 
’t™y
.
·¿ms
[
·¹
.
Çme
].
	$­³nd
(
v®ue
)

233 
’t™y
.
·¿ms
[
·¹
.
Çme
] = 
v®ue


235 
’t™y
.
·¹s
 = 
k•t_·¹s


237 
def
 
	$_Şd_´oûss_muÉ¬t
(
’t™y
):

239 
	$´oûss_muÉ¬t
(
’t™y
)

241 
·¿ms
 = 
’t™y
.params

243 
·¹
 
š
 
’t™y
.
·¹s
:

244 
·¹
.
Çme
 
is
 
NÚe
:

245 
key
 = 
	`Áou
('parts')

247 
key
 = 
·¹
.
Çme


249 
·¹
.
f’ame
 
is
 
NÚe
:

251 
v®ue
 = 
·¹
.
	$fuÎv®ue
()

254 #ha 
acûss
 
to
 
™s
 .
fe
 
ªd
 .
f’ame
 
©Œibu‹s
.

255 
v®ue
 = 
·¹


257 
key
 
š
 
·¿ms
:

258 
nÙ
 
	$isš¡ªû
(
·¿ms
[
key
], 
li¡
):

259 
·¿ms
[
key
] = [params[key]]

260 
·¿ms
[
key
].
	$­³nd
(
v®ue
)

262 
·¿ms
[
key
] = 
v®ue


266 #--------------------------------- 
EÁ™›s
 --------------------------------- #


268 
şass
 
	$EÁ™y
(
objeù
):

271 
This
 
şass
 
cŞËùs
 
šfÜm©iÚ
 
about
 
the
 
HTTP
 
»que¡
 
’t™y
. 
Wh’
 
a


272 
giv’
 
’t™y
 
is
 
of
 
MIME
 
ty³
 "muÉ¬t", 
—ch
 
·¹
 i 
·r£d
 
što
 
™s
 
own


273 
EÁ™y
 
š¡ªû
, 
ªd
 
the
 
£t
 
of
 
·¹s
 
¡Üed
 
š


274 :
©Œ
:`
’t™y
.
·¹s
<
ch”rypy
.
_ı»qbody
.
EÁ™y
.parts>`.

276 
B‘w“n
 
the
 ``
befÜe_»que¡_body
`` 
ªd
 ``
befÜe_hªdËr
`` 
toŞs
, 
Ch”ryPy


277 
Œ›s
 
to
 
´oûss
 
the
 
»que¡
 
	$body
 (
ªy
è
by
 
ÿÎšg


278 :
func
:`
»que¡
.
body
.
´oûss
<
ch”rypy
.
_ı»qbody
.
Reque¡Body
.process`.

279 
This
 
u£s
 
the
 ``
cÚ‹Á_ty³
`` 
of
h
EÁ™y
 
to
 
look
 
up
 
a
 
su™abË
 
´oûssÜ


280 
š
 :
©Œ
:`
EÁ™y
.
´oûssÜs
<
ch”rypy
.
_ı»qbody
.EÁ™y.´oûssÜs>`, 
a
 
diù
.

281 
If
 
a
 
m©chšg
 
´oûssÜ
 
ÿÂÙ
 
be
 
found
 
the
 
com¶‘e
 
CÚ‹Á
-
Ty³
,

282 
™
 
Œ›s
 
agaš
 
usšg
 
the
 
majÜ
 
ty³
. 
FÜ
 
exam¶e
, 
a
 
»que¡
 
w™h
 
ª


283 
’t™y
 
of
 
ty³
 "image/j³g" 
¬rives
, 
but
 
no
 
´oûssÜ
 
ÿn
 
be
 
found
 

284 
th©
 
com¶‘e
 
ty³
, 
th’
 
Úe
 
is
 
sought
 
the
 
majÜ
y³ "image". 
If
 
a


285 
´oûssÜ
 
is
 
¡l
 
nÙ
 
found
, 
th’
 
the


286 :
func
:`
deçuÉ_´oc
<
ch”rypy
.
_ı»qbody
.
EÁ™y
.deçuÉ_´oc>` 
m‘hod
 
of
 
the


287 
EÁ™y
 
is
 
	`ÿÎed
 (
which
 
dÛs
 
nÙhšg
 
by
 ; 
you
 
ÿn
 
ov”ride
 
this
 
too
).

289 
Ch”ryPy
 
šşudes
 
´oûssÜs
 
the
 "application/x-www-form-urlencoded"

290 
ty³
, 
the
 "muÉ¬t/fÜm-d©a"y³, 
ªd
h"muÉ¬t" 
majÜ
ype.

291 
Ch”ryPy
 3.2 
´oûs£s
 
the£
 
ty³s
 
®mo¡
 
exaùly
 
as
 
Şd”
 
v”siÚs
.

292 
P¬ts
 
¬e
 
·s£d
 
as
 
¬gum’ts
 
to
 
the
 
·ge
 
hªdËr
 
usšg
 
theœ


293 ``
CÚ‹Á
-
Di¥os™iÚ
.
Çme
`` 
giv’
, 
Ùh”wi£
 
š
 
a
 
g’”ic
 "parts"

294 
¬gum’t
. 
Each
 
such
 
·¹
 
is
 
e™h”
 
a
 
¡ršg
, 
Ü
 
the


295 :
şass
:`
P¬t
<
ch”rypy
.
_ı»qbody
.P¬t>` 
™£lf
 
™
's‡ file. (Inhis

296 
™
 
wl
 
have
 ``
fe
`` 
ªd
 ``
f’ame
`` 
©Œibu‹s
, 
Ü
 
possibly
 
a


297 ``
v®ue
`` 
©Œibu‹
). 
Each
 
P¬t
 
is
 
™£lf
 
a
 
subşass
 
of


298 
EÁ™y
, 
ªd
 
has
 
™s
 
own
 ``
´oûss
`` 
m‘hod
‡nd ``
´oûssÜs
`` 
diù
.

300 
Th”e
 
is
 
a
 
£·¿‹
 
´oûssÜ
 
the
 "muÉ¬t" 
majÜ
 
ty³
 
which
 i 
mÜe


301 
æexibË
, 
ªd
 
sim¶y
 
¡Ües
 
®l
 
muÉ¬t
 
·¹s
 
š


302 :
©Œ
:`
»que¡
.
body
.
·¹s
<
ch”rypy
.
_ı»qbody
.
EÁ™y
.·¹s>`. 
You
 
ÿn


303 
’abË
 
™
 
w™h
::

305 
ch”rypy
.
»que¡
.
body
.
´oûssÜs
['muÉ¬t'] = 
_ı»qbody
.
´oûss_muÉ¬t


307 
š
 
ª
 ``
Ú_¡¬t_»sourû
`` 
toŞ
.

311 #"
The
  
ch¬aù”
 
£t
, 
which
 
mu¡
 
be
 
assumed
 
š
 
the


312 #ab£nû 
of
 
a
 
ch¬£t
 
·¿m‘”
, 
is
 
US
-
ASCII
."

313 #Howev”, 
mªy
 
brow£rs
 
£nd
 
d©a
 
š
 
utf
-8 
w™h
 
no
 
ch¬£t
.

314 
©‹m±_ch¬£ts
 = ['utf-8']

317 
Wh’
 
the
 
CÚ‹Á
-
Ty³
 
of
h
»que¡
 
body
 
w¬¿Ás
 
™
, 
—ch
 oàth
giv’


318 
’codšgs
 
wl
 
be
 
Œ›d
 
š
 
Üd”
. 
The
 
fœ¡
 
Úe
 
to
 
sucûssfuÎy
 
decode
 
the


319 
’t™y
 
w™hout
 
¿isšg
 
ª
 
”rÜ
 
is
 
¡Üed
 
as


320 :
©Œ
:`
’t™y
.
ch¬£t
<
ch”rypy
.
_ı»qbody
.
EÁ™y
.ch¬£t>`. 
This
 
deçuÉs


321 
to
 ``['utf-8']`` (
¶us
 'ISO-8859-1' "‹xt/\*" 
ty³s
, 
as
 
»quœed
 
by


322 `
HTTP
/1.1 <
h‰p
:

323 
but
 ``['us-ascii', 'utf-8']`` 
muÉ¬t
 
·¹s
.

326 
ch¬£t
 = 
NÚe


327 """ThsucûssfuÈdecodšg; s“ "
©‹m±_ch¬£ts
"‡bove."""

329 
cÚ‹Á_ty³
 = 
NÚe


332 
If
 
the
 
EÁ™y
 
is
 
·¹
 
of
 
a
 
muÉ¬t
 
·ylßd
, 
this
 
wl
 
be
h
CÚ‹Á
-
Ty³


333 
giv’
 
š
 
the
 
MIME
 
h—d”s
 
this
 
·¹
.

336 
deçuÉ_cÚ‹Á_ty³
 = 'application/x-www-form-urlencoded'

338 
is
 
giv’
. 
The
 
em±y
 
¡ršg
 i 
u£d
 
Reque¡Body
, 
which
 
»suÉs
 
š
 
the


339 
»que¡
 
body
 
nÙ
 
bešg
 
»ad
 
Ü
 
·r£d
 
©
 
®l
. 
This
 
is
 
by
 
design
; 
a
 
missšg


340 ``
CÚ‹Á
-
Ty³
`` 
h—d”
 
š
 
the
 
HTTP
 
»que¡
 
’t™y
 
is
 
ª
 
”rÜ
 
©
 
be¡
,

341 
ªd
 
a
 
£cur™y
 
hŞe
 
©
 
wÜ¡
. 
FÜ
 
muÉ¬t
 
·¹s
, 
howev”
, 
the
 
MIME
 
¥ec


342 
deş¬es
 
th©
 
a
 
·¹
 
w™h
 
no
 
CÚ‹Á
-
Ty³
 
deçuÉs
 
to
 "text/plain"

343 (
£e
 :
şass
:`
P¬t
<
ch”rypy
.
_ı»qbody
.Part>`).

346 
f’ame
 = 
NÚe


349 
å
 = 
NÚe


352 
h—d”s
 = 
NÚe


355 
This
 
is
 
a
 
cİy
 
of
 
the
 ``
»que¡
.
h—d”s
`` th``»que¡.
body
``;

356 
muÉ¬t
 
·¹s
, 
™
 
is
 
the
 
£t
 
of
 
h—d”s
 
th©
 
·¹
.

359 
Ëngth
 = 
NÚe


362 
Çme
 = 
NÚe


363 """Th"
Çme
"…arameter ofhe ``Content-Disposition`` header, if‡ny."""

365 
·¿ms
 = 
NÚe


367 
If
 
the
 
»que¡
 
CÚ‹Á
-
Ty³
 
is
 '­¶iÿtiÚ/x-www-fÜm-u¾’coded' 
Ü


368 
muÉ¬t
, 
this
 
wl
 
be
 
a
 
diù
 
of
 
the
 
·¿ms
 
puÎed
 
äom
h
’t™y


369 
body
; 
th©
 
is
, 
™
 
wl
 
be
 
the
 
pÜtiÚ
 
of
 
»que¡
.
·¿ms
h© 
come


370 
äom
 
the
 
mes§ge
 
	`body
 (
som‘imes
 
ÿÎed
 "POST…¬ams", 
®though
 
they


371 
ÿn
 
be
 
£Á
 
w™h
 
v¬ious
 
HTTP
 
m‘hod
 
v”bs
). 
This
 
v®ue
 
is
 
£t
 
b‘w“n


372 
the
 'befÜe_»que¡_body' 
ªd
 'befÜe_hªdËr' 
	`hooks
 (
assumšg
 
th©


373 
´oûss_»que¡_body
 
is
 
True
)."""

375 
´oûssÜs
 = {'­¶iÿtiÚ/x-www-fÜm-u¾’coded': 
´oûss_u¾’coded
,

376 'muÉ¬t/fÜm-d©a': 
´oûss_muÉ¬t_fÜm_d©a
,

377 'muÉ¬t': 
´oûss_muÉ¬t
,

378 
	}
}

381 
·¹s
 = 
NÚe


382 """A†i¡ oàP¬ˆš¡ªû ià``CÚ‹Á-Ty³`` i oàmajÜy³ "
muÉ¬t
"."""

384 
·¹_şass
 = 
NÚe


387 
You
 
ÿn
 
»¶aû
 
this
 
w™h
 
cu¡om
 
subşas£s
 
to
 
®‹r
 
the
 
´oûssšg
 
of


388 
muÉ¬t
 
·¹s
.

391 
def
 
	$__š™__
(
£lf
, 
å
, 
h—d”s
, 
·¿ms
=
NÚe
, 
·¹s
=None):

392 #Mak
ª
 
š¡ªû
-
¥ecific
 
cİy
 
of
 
the
 
şass
 
´oûssÜs


393 #sØ
ToŞs
, 
‘c
. 
ÿn
 
»¶aû
 
them
 
³r
-
»que¡
.

394 
£lf
.
´oûssÜs
 = s–f.´oûssÜs.
	$cİy
()

396 
£lf
.
å
 = fp

397 
£lf
.
h—d”s
 = headers

399 
·¿ms
 
is
 
NÚe
:

400 
·¿ms
 = {
	}
}

401 
£lf
.
·¿ms
 =…arams

403 
·¹s
 
is
 
NÚe
:

404 
·¹s
 = []

405 
£lf
.
·¹s
 =…arts

407 #CÚ‹Á-
Ty³


408 
£lf
.
cÚ‹Á_ty³
 = 
h—d”s
.
–em’ts
('Content-Type')

409 
£lf
.
cÚ‹Á_ty³
:

410 
£lf
.
cÚ‹Á_ty³
 = self.content_type[0]

412 
£lf
.
cÚ‹Á_ty³
 = 
h‰put
.
H—d”EËm’t
.
	$äom_¡r
(

413 
£lf
.
deçuÉ_cÚ‹Á_ty³
)

415 #Cİy 
the
 
şass
 '©‹m±_ch¬£ts', 
´•’dšg
 
ªy
 
CÚ‹Á
-
Ty³
 
ch¬£t


416 
dec
 = 
£lf
.
cÚ‹Á_ty³
.
·¿ms
.
	`g‘
("ch¬£t", 
NÚe
)

417 
dec
:

418 
£lf
.
©‹m±_ch¬£ts
 = [
dec
] + [
c
 ø
š
 self.attempt_charsets

419 
c
 !ğ
dec
]

421 
£lf
.
©‹m±_ch¬£ts
 = self.attempt_charsets[:]

424 
£lf
.
Ëngth
 = 
NÚe


425 
ş’
 = 
h—d”s
.
	`g‘
('CÚ‹Á-L’gth', 
NÚe
)

426 #Ià
T¿nsãr
-
Encodšg
 
is
 'chunked', 
ignÜe
 
ªy
 
CÚ‹Á
-
L’gth
.

427 
ş’
 
is
 
nÙ
 
NÚe
 
ªd
 'chunked'‚Ù 
š
 
h—d”s
.
	`g‘
('Transfer-Encoding', ''):

428 
Œy
:

429 
£lf
.
Ëngth
 = (
ş’
)

430 
exû±
 
V®ueE¼Ü
:

431 
·ss


433 #CÚ‹Á-
Di¥os™iÚ


434 
£lf
.
Çme
 = 
NÚe


435 
£lf
.
f’ame
 = 
NÚe


436 
di¥
 = 
h—d”s
.
	`–em’ts
('Content-Disposition')

437 
di¥
:

438 
di¥
 = disp[0]

439 'Çme' 
š
 
di¥
.
·¿ms
:

440 
£lf
.
Çme
 = 
di¥
.
·¿ms
['name']

441 
£lf
.
Çme
.
	`¡¬tsw™h
('"'è
ªd
 s–f.Çme.
	`’dsw™h
('"'):

442 
£lf
.
Çme
 = self.name[1:-1]

443 'f’ame' 
š
 
di¥
.
·¿ms
:

444 
£lf
.
f’ame
 = 
di¥
.
·¿ms
['filename']

445 
£lf
.
f’ame
.
	`¡¬tsw™h
('"'è
ªd
 s–f.f’ame.
	`’dsw™h
('"'):

446 
£lf
.
f’ame
 = self.filename[1:-1]

448 #Th'ty³' 
©Œibu‹
 
is
 
d•»ÿ‹d
 
š
 3.2; 
»move
 
™
 in 3.3.

449 
ty³
 = 
	`´İ”ty
(
Ïmbda
 
£lf
: s–f.
cÚ‹Á_ty³
,

450 
doc
="""A deprecated‡lias for :attr:`content_type<cherrypy._cpreqbody.Entity.content_type>`.""")

452 
def
 
	$»ad
(
£lf
, 
size
=
NÚe
, 
å_out
=None):

453  
£lf
.
å
.
	$»ad
(
size
, 
å_out
)

455 
def
 
	$»adlše
(
£lf
, 
size
=
NÚe
):

456  
£lf
.
å
.
	$»adlše
(
size
)

458 
def
 
	$»adlšes
(
£lf
, 
sizehšt
=
NÚe
):

459  
£lf
.
å
.
	$»adlšes
(
sizehšt
)

461 
def
 
	$__™”__
(
£lf
):

462  
£lf


464 
def
 
	$__Ãxt__
(
£lf
):

465 
lše
 = 
£lf
.
	$»adlše
()

466 
nÙ
 
lše
:

467 
¿i£
 
StİI‹¿tiÚ


468  
lše


470 
def
 
	$Ãxt
(
£lf
):

471  
£lf
.
	$__Ãxt__
()

473 
def
 
	$»ad_što_fe
(
£lf
, 
å_out
=
NÚe
):

475 
å_out
 
is
 
NÚe
:

476 
å_out
 = 
£lf
.
	$make_fe
()

477 
£lf
.
	$»ad
(
å_out
=fp_out)

478  
å_out


480 
def
 
	$make_fe
(
£lf
):

483 
By
 , 
this
 
wl
  
a
 
TempÜ¬yFe
. 
Ov”ride
 
as
 
Ãeded
.

484 
S“
 
®so
 :
©Œ
:`
ch”rypy
.
_ı»qbody
.
P¬t
.
max¿mby‹s
`."""

485  
‹mpfe
.
	$TempÜ¬yFe
()

487 
def
 
	$fuÎv®ue
(
£lf
):

489 
£lf
.
fe
:

490 #Iˆ
was
 
¡Üed
 
š
 
a
 
‹mpfe
. 
R—d
 
™
.

491 
£lf
.
fe
.
	$£ek
(0)

492 
v®ue
 = 
£lf
.
fe
.
	$»ad
()

493 
£lf
.
fe
.
	$£ek
(0)

495 
v®ue
 = 
£lf
.value

496  
v®ue


498 
def
 
	$´oûss
(
£lf
):

500 
´oc
 = 
NÚe


501 
ù
 = 
£lf
.
cÚ‹Á_ty³
.
v®ue


502 
Œy
:

503 
´oc
 = 
£lf
.
´oûssÜs
[
ù
]

504 
exû±
 
KeyE¼Ü
:

505 
tİty³
 = 
ù
.
	`¥l™
('/', 1)[0]

506 
Œy
:

507 
´oc
 = 
£lf
.
´oûssÜs
[
tİty³
]

508 
exû±
 
KeyE¼Ü
:

509 
·ss


510 
´oc
 
is
 
NÚe
:

511 
£lf
.
	$deçuÉ_´oc
()

513 
	$´oc
(
£lf
)

515 
def
 
	$deçuÉ_´oc
(
£lf
):

517 #L—v
the
 
å
 
®Úe
 
someÚe
 
to
 
»ad
. 
This
 
wÜks
 
fše


518 #fÜ 
»que¡
.
body
, 
but
 
the
 
P¬t
 
subşas£s
 
Ãed
 
to
 
ov”ride
 
this


519 #sØ
they
 
ÿn
 
move
 
Ú
 
to
 
the
 
Ãxt
 
·¹
.

520 
·ss


523 
şass
 
	$P¬t
(
EÁ™y
):

526 #"
The
  
ch¬aù”
 
£t
, 
which
 
mu¡
 
be
 
assumed
 
š
 
the
 
ab£nû
 
of
 
a


527 #ch¬£ˆ
·¿m‘”
, 
is
 
US
-
ASCII
."

528 
©‹m±_ch¬£ts
 = ['us-ascii', 'utf-8']

531 
Wh’
 
the
 
CÚ‹Á
-
Ty³
 
of
h
»que¡
 
body
 
w¬¿Ás
 
™
, 
—ch
 oàth
giv’


532 
’codšgs
 
wl
 
be
 
Œ›d
 
š
 
Üd”
. 
The
 
fœ¡
 
Úe
 
to
 
sucûssfuÎy
 
decode
 
the


533 
’t™y
 
w™hout
 
¿isšg
 
ª
 
”rÜ
 
is
 
¡Üed
 
as


534 :
©Œ
:`
’t™y
.
ch¬£t
<
ch”rypy
.
_ı»qbody
.
EÁ™y
.ch¬£t>`. 
This
 
deçuÉs


535 
to
 ``['utf-8']`` (
¶us
 'ISO-8859-1' "‹xt/\*" 
ty³s
, 
as
 
»quœed
 
by


536 `
HTTP
/1.1 <
h‰p
:

537 
but
 ``['us-ascii', 'utf-8']`` 
muÉ¬t
 
·¹s
.

540 
bound¬y
 = 
NÚe


543 
deçuÉ_cÚ‹Á_ty³
 = 'text/plain'

545 
is
 
giv’
. 
The
 
em±y
 
¡ršg
 i 
u£d
 
Reque¡Body
, 
which
 
»suÉs
 
š
 
the


546 
»que¡
 
body
 
nÙ
 
bešg
 
»ad
 
Ü
 
·r£d
 
©
 
®l
. 
This
 
is
 
by
 
design
; 
a
 
missšg


547 ``
CÚ‹Á
-
Ty³
`` 
h—d”
 
š
 
the
 
HTTP
 
»que¡
 
’t™y
 
is
 
ª
 
”rÜ
 
©
 
be¡
,

548 
ªd
 
a
 
£cur™y
 
hŞe
 
©
 
wÜ¡
. 
FÜ
 
muÉ¬t
 
·¹s
, 
	`howev”
 (
this
 
şass
),

549 
the
 
MIME
 
¥ec
 
deş¬es
 
th©
 
a
 
·¹
 
w™h
 
no
 
CÚ‹Á
-
Ty³
 
deçuÉs
 
to


553 #Thi 
is
 
the
  
š
 
¡dlib
 
cgi
. 
We
 
may
 
wªt
 
to
 
šü—£
 
™
.

554 
max¿mby‹s
 = 1000

556 
š
 
a
 
	`fe
 (
g’”©ed
 
by
 :
func
:`
make_fe
<
ch”rypy
.
_ı»que¡
.
EÁ™y
.make_file>`)

557 
š¡—d
 
of
 
a
 
¡ršg
. 
DeçuÉs
 
to
 1000, 
ju¡
 
like
 
the
 :
mod
:`
cgi
` 
moduË
 
š


558 
PythÚ
's standard†ibrary.

561 
def
 
	$__š™__
(
£lf
, 
å
, 
h—d”s
, 
bound¬y
):

562 
EÁ™y
.
	$__š™__
(
£lf
, 
å
, 
h—d”s
)

563 
£lf
.
bound¬y
 = boundary

564 
£lf
.
fe
 = 
NÚe


565 
£lf
.
v®ue
 = 
NÚe


567 
def
 
	$äom_å
(
şs
, 
å
, 
bound¬y
):

568 
h—d”s
 = 
şs
.
	$»ad_h—d”s
(
å
)

569  
	$şs
(
å
, 
h—d”s
, 
bound¬y
)

570 
äom_å
 = 
	$şassm‘hod
(
äom_å
)

572 
def
 
	$»ad_h—d”s
(
şs
, 
å
):

573 
h—d”s
 = 
h‰put
.
	$H—d”M­
()

574 
True
:

575 
lše
 = 
å
.
	$»adlše
()

576 
nÙ
 
lše
:

577 #NØ
mÜe
 
d©a
--
Ëg®
 
’d
 
of
 
h—d”s


578 
¿i£
 
	`EOFE¼Ü
("Illegalƒnd of headers.")

580 
lše
 =ğ
	`Áob
('\r\n'):

581 #NÜm® 
’d
 
of
 
h—d”s


583 
nÙ
 
lše
.
	`’dsw™h
(
	`Áob
('\r\n')):

584 
¿i£
 
	`V®ueE¼Ü
("MIME„equœe CRLF”mš©Üs: %r" % 
lše
)

586 
lše
[0] 
š
 
	`Áob
(' \t'):

588 
v
 = 
lše
.
	`¡r
().
	`decode
('ISO-8859-1')

590 
k
, 
v
 = 
lše
.
	`¥l™
(
	`Áob
(":"), 1)

591 
k
 = k.
	`¡r
().
	`decode
('ISO-8859-1')

592 
v
 = v.
	`¡r
().
	`decode
('ISO-8859-1')

594 
exi¡šg
 = 
h—d”s
.
	$g‘
(
k
)

595 
exi¡šg
:

596 
v
 = ", ".
	`još
((
exi¡šg
, v))

597 
h—d”s
[
k
] = 
v


599  
h—d”s


600 
»ad_h—d”s
 = 
	$şassm‘hod
(
»ad_h—d”s
)

602 
def
 
	$»ad_lšes_to_bound¬y
(
£lf
, 
å_out
=
NÚe
):

605 
If
 
the
 'å_out' 
¬gum’t
 
is
 
	`NÚe
 (th), 
®l
 
by‹s
 
»ad
 
¬e


606 
»tuºed
 
š
 
a
 
sšgË
 
by‹
 
¡ršg
.

608 
If
 
the
 'å_out' 
¬gum’t
 
is
 
nÙ
 
NÚe
, 
™
 
mu¡
 
be
 
a
 
fe
-
like
 
objeù
 
th©


609 
suµÜts
 
the
 'wr™e' 
m‘hod
; 
®l
 
by‹s
 
»ad
 
wl
 
be
 
wr™‹n
 
to
h
å
,

610 
ªd
 
th©
 
å
 
is
 
»tuºed
.

612 
’dm¬k”
 = 
£lf
.
bound¬y
 + 
	`Áob
("--")

613 
d–im
 = 
	`Áob
("")

614 
´ev_lf
 = 
True


615 
lšes
 = []

616 
£’
 = 0

617 
True
:

618 
lše
 = 
£lf
.
å
.
	`»adlše
(1<<16)

619 
nÙ
 
lše
:

620 
¿i£
 
	`EOFE¼Ü
("Illegalƒnd of multipart body.")

621 
lše
.
	`¡¬tsw™h
(
	`Áob
("--")è
ªd
 
´ev_lf
:

622 
¡r³dlše
 = 
lše
.
	$¡r
()

623 
¡r³dlše
 =ğ
£lf
.
bound¬y
:

625 
¡r³dlše
 =ğ
’dm¬k”
:

626 
£lf
.
å
.
	$fšish
()

629 
lše
 = 
d–im
 +†ine

631 
lše
.
	`’dsw™h
(
	`Áob
("\r\n")):

632 
d–im
 = 
	`Áob
("\r\n")

633 
lše
 =†ine[:-2]

634 
´ev_lf
 = 
True


635 
–if
 
lše
.
	`’dsw™h
(
	`Áob
("\n")):

636 
d–im
 = 
	`Áob
("\n")

637 
lše
 =†ine[:-1]

638 
´ev_lf
 = 
True


640 
d–im
 = 
	`Áob
("")

641 
´ev_lf
 = 
F®£


643 
å_out
 
is
 
NÚe
:

644 
lšes
.
	$­³nd
(
lše
)

645 
£’
 +ğ
	$Ën
(
lše
)

646 
£’
 > 
£lf
.
max¿mby‹s
:

647 
å_out
 = 
£lf
.
	$make_fe
()

648 
lše
 
š
 
lšes
:

649 
å_out
.
	$wr™e
(
lše
)

651 
å_out
.
	$wr™e
(
lše
)

653 
å_out
 
is
 
NÚe
:

654 
»suÉ
 = 
	`Áob
('').
	$još
(
lšes
)

655 
ch¬£t
 
š
 
£lf
.
©‹m±_ch¬£ts
:

656 
Œy
:

657 
»suÉ
 =„esuÉ.
	$decode
(
ch¬£t
)

658 
exû±
 
UnicodeDecodeE¼Ü
:

659 
·ss


661 
£lf
.
ch¬£t
 = charset

662  
»suÉ


664 
¿i£
 
ch”rypy
.
	`HTTPE¼Ü
(

666 "ch¬£t w”©‹m±ed: %s" % 
	$»´
(
£lf
.
©‹m±_ch¬£ts
))

668 
å_out
.
	$£ek
(0)

669  
å_out


671 
def
 
	$deçuÉ_´oc
(
£lf
):

673 
£lf
.
f’ame
:

674 #Alway 
»ad
 
što
 
a
 
fe
 ¨.
f’ame
 
was
 
giv’
.

675 
£lf
.
fe
 = s–f.
	$»ad_što_fe
()

677 
»suÉ
 = 
£lf
.
	$»ad_lšes_to_bound¬y
()

678 
	$isš¡ªû
(
»suÉ
, 
ba£¡ršg
):

679 
£lf
.
v®ue
 = 
»suÉ


681 
£lf
.
fe
 = 
»suÉ


683 
def
 
	$»ad_što_fe
(
£lf
, 
å_out
=
NÚe
):

685 
å_out
 
is
 
NÚe
:

686 
å_out
 = 
£lf
.
	$make_fe
()

687 
£lf
.
	$»ad_lšes_to_bound¬y
(
å_out
=fp_out)

688  
å_out


690 
EÁ™y
.
·¹_şass
 = 
P¬t


692 
Œy
:

693 
šf
 = ('inf')

694 
exû±
 
V®ueE¼Ü
:

695 #PythÚ 2.4 
ªd
 
low”


696 
şass
 
	$Infš™y
(
objeù
):

697 
def
 
	$__cmp__
(
£lf
, 
Ùh”
):

699 
def
 
	$__sub__
(
£lf
, 
Ùh”
):

700  
£lf


701 
šf
 = 
	$Infš™y
()

704 
comma_£·¿‹d_h—d”s
 = ['Accept', 'Accept-Charset', 'Accept-Encoding',

711 
şass
 
SizedR—d”
:

713 
def
 
	$__š™__
(
£lf
, 
å
, 
Ëngth
, 
maxby‹s
, 
bufsize
=
DEFAULT_BUFFER_SIZE
, 
has_Œa”s
=
F®£
):

714 #W¿°
our
 
å
 
š
 
a
 
bufãr
 
so
 
	`³ek
(è
wÜks


715 
£lf
.
å
 = fp

716 
£lf
.
Ëngth
 =†ength

717 
£lf
.
maxby‹s
 = maxbytes

718 
£lf
.
bufãr
 = 
	`Áob
('')

719 
£lf
.
bufsize
 = bufsize

720 
£lf
.
by‹s_»ad
 = 0

721 
£lf
.
dÚe
 = 
F®£


722 
£lf
.
has_Œa”s
 = has_trailers

724 
def
 
	$»ad
(
£lf
, 
size
=
NÚe
, 
å_out
=None):

727 
A
 
numb”
 
of
 
by‹s
 
Ëss
 
thª
 
Ü
 
equ®
 
to
 
the
 'size' 
¬gum’t
 
¬e
 
»ad


728 
off
 
the
 
sock‘
. 
The
 
aùu®
 
numb”
 
of
 
by‹s
 
»ad
 
¬e
 
Œacked
 
š


729 
£lf
.
by‹s_»ad
. 
The
 
numb”
 
may
 
be
 
sm®Ër
 
thª
 'size' 
wh’
 1è
the


730 
ş›Á
 
£nds
 
ãw”
 
by‹s
, 2è
the
 'CÚ‹Á-L’gth' 
»que¡
 
h—d”


731 
¥ecif›s
 
ãw”
 
by‹s
 
thª
 
»que¡ed
, 
Ü
 3è
the
 
numb”
 
of
 by‹ 
»ad


732 
exûeds
 
£lf
.
	`maxby‹s
 (
š
 
which
 , 413 
is
 
¿i£d
).

734 
If
 
the
 'å_out' 
¬gum’t
 
is
 
	`NÚe
 (th), 
®l
 
by‹s
 
»ad
 
¬e


735 
»tuºed
 
š
 
a
 
sšgË
 
by‹
 
¡ršg
.

737 
If
 
the
 'å_out' 
¬gum’t
 
is
 
nÙ
 
NÚe
, 
™
 
mu¡
 
be
 
a
 
fe
-
like
 
objeù
 
th©


738 
suµÜts
 
the
 'wr™e' 
m‘hod
; 
®l
 
by‹s
 
»ad
 
wl
 
be
 
wr™‹n
 
to
h
å
,

739 
ªd
 
NÚe
 
is
 
»tuºed
.

742 
£lf
.
Ëngth
 
is
 
NÚe
:

743 
size
 
is
 
NÚe
:

744 
»maššg
 = 
šf


746 
»maššg
 = 
size


748 
»maššg
 = 
£lf
.
Ëngth
 - s–f.
by‹s_»ad


749 
size
 
ªd
 siz< 
»maššg
:

750 
»maššg
 = 
size


751 
»maššg
 == 0:

752 
£lf
.
	$fšish
()

753 
å_out
 
is
 
NÚe
:

754  
	`Áob
('')

756  
NÚe


758 
chunks
 = []

760 #R—d 
by‹s
 
äom
 
the
 
bufãr
.

761 
£lf
.
bufãr
:

762 
»maššg
 
is
 
šf
:

763 
d©a
 = 
£lf
.
bufãr


764 
£lf
.
bufãr
 = 
	`Áob
('')

766 
d©a
 = 
£lf
.
bufãr
[:
»maššg
]

767 
£lf
.
bufãr
 = s–f.bufãr[
»maššg
:]

768 
d©®’
 = 
	$Ën
(
d©a
)

769 
»maššg
 -ğ
d©®’


771 #Check 
Ëngths
.

772 
£lf
.
by‹s_»ad
 +ğ
d©®’


773 
£lf
.
maxby‹s
 
ªd
 s–f.
by‹s_»ad
 > self.maxbytes:

774 
¿i£
 
ch”rypy
.
	$HTTPE¼Ü
(413)

776 #StÜ
the
 
d©a
.

777 
å_out
 
is
 
NÚe
:

778 
chunks
.
	$­³nd
(
d©a
)

780 
å_out
.
	$wr™e
(
d©a
)

782 #R—d 
by‹s
 
äom
 
the
 
sock‘
.

783 
»maššg
 > 0:

784 
chunksize
 = 
	$mš
(
»maššg
, 
£lf
.
bufsize
)

785 
Œy
:

786 
d©a
 = 
£lf
.
å
.
	$»ad
(
chunksize
)

787 
exû±
 
Exû±iÚ
:

788 
e
 = 
sys
.
	`exc_šfo
()[1]

789 
e
.
__şass__
.
__Çme__
 == 'MaxSizeExceeded':

790 #Po¡ 
d©a
 
is
 
too
 
big


791 
¿i£
 
ch”rypy
.
	`HTTPE¼Ü
(

792 413, "Maximum„eque¡†’gth: %r" % 
e
.
¬gs
[1])

794 
¿i£


795 
nÙ
 
d©a
:

796 
£lf
.
	$fšish
()

798 
d©®’
 = 
	$Ën
(
d©a
)

799 
»maššg
 -ğ
d©®’


801 #Check 
Ëngths
.

802 
£lf
.
by‹s_»ad
 +ğ
d©®’


803 
£lf
.
maxby‹s
 
ªd
 s–f.
by‹s_»ad
 > self.maxbytes:

804 
¿i£
 
ch”rypy
.
	$HTTPE¼Ü
(413)

806 #StÜ
the
 
d©a
.

807 
å_out
 
is
 
NÚe
:

808 
chunks
.
	$­³nd
(
d©a
)

810 
å_out
.
	$wr™e
(
d©a
)

812 
å_out
 
is
 
NÚe
:

813  
	`Áob
('').
	$još
(
chunks
)

815 
def
 
	$»adlše
(
£lf
, 
size
=
NÚe
):

817 
chunks
 = []

818 
size
 
is
 
NÚe
 
Ü
 size > 0:

819 
chunksize
 = 
£lf
.
bufsize


820 
size
 
is
 
nÙ
 
NÚe
 
ªd
 siz< 
£lf
.
bufsize
:

821 
chunksize
 = 
size


822 
d©a
 = 
£lf
.
	$»ad
(
chunksize
)

823 
nÙ
 
d©a
:

825 
pos
 = 
d©a
.
	`fšd
(
	`Áob
('\n')) + 1

826 
pos
:

827 
chunks
.
	`­³nd
(
d©a
[:
pos
])

828 
»mašd”
 = 
d©a
[
pos
:]

829 
£lf
.
bufãr
 +ğ
»mašd”


830 
£lf
.
by‹s_»ad
 -ğ
	$Ën
(
»mašd”
)

833 
chunks
.
	$­³nd
(
d©a
)

834  
	`Áob
('').
	$još
(
chunks
)

836 
def
 
	$»adlšes
(
£lf
, 
sizehšt
=
NÚe
):

838 
£lf
.
Ëngth
 
is
 
nÙ
 
NÚe
:

839 
sizehšt
 
is
 
NÚe
:

840 
sizehšt
 = 
£lf
.
Ëngth
 - s–f.
by‹s_»ad


842 
sizehšt
 = 
	`mš
(sizehšt, 
£lf
.
Ëngth
 - s–f.
by‹s_»ad
)

844 
lšes
 = []

845 
£’
 = 0

846 
True
:

847 
lše
 = 
£lf
.
	$»adlše
()

848 
nÙ
 
lše
:

850 
lšes
.
	$­³nd
(
lše
)

851 
£’
 +ğ
	$Ën
(
lše
)

852 
£’
 >ğ
sizehšt
:

854  
lšes


856 
def
 
	$fšish
(
£lf
):

857 
£lf
.
dÚe
 = 
True


858 
£lf
.
has_Œa”s
 
ªd
 
	`ha§‰r
(£lf.
å
, 'read_trailer_lines'):

859 
£lf
.
Œa”s
 = {
	}
}

861 
Œy
:

862 
lše
 
š
 
£lf
.
å
.
	$»ad_Œa”_lšes
():

863 
lše
[0] 
š
 
	`Áob
(' \t'):

865 
v
 = 
lše
.
	$¡r
()

867 
Œy
:

868 
k
, 
v
 = 
lše
.
	`¥l™
(
	`Áob
(":"), 1)

869 
exû±
 
V®ueE¼Ü
:

870 
¿i£
 
	`V®ueE¼Ü
("Illegal header†ine.")

871 
k
 = k.
	`¡r
().
	$t™Ë
()

872 
v
 = v.
	$¡r
()

874 
k
 
š
 
comma_£·¿‹d_h—d”s
:

875 
exi¡šg
 = 
£lf
.
Œa”s
.
	$g‘
(
’vÇme
)

876 
exi¡šg
:

877 
v
 = 
	`Áob
(", ").
	`još
((
exi¡šg
, v))

878 
£lf
.
Œa”s
[
k
] = 
v


879 
exû±
 
Exû±iÚ
:

880 
e
 = 
sys
.
	`exc_šfo
()[1]

881 
e
.
__şass__
.
__Çme__
 == 'MaxSizeExceeded':

882 #Po¡ 
d©a
 
is
 
too
 
big


883 
¿i£
 
ch”rypy
.
	`HTTPE¼Ü
(

884 413, "Maximum„eque¡†’gth: %r" % 
e
.
¬gs
[1])

886 
¿i£


889 
şass
 
	$Reque¡Body
(
EÁ™y
):

892 
bufsize
 = 8 * 1024

895 #DÚ'ˆ·r£h»que¡ body‡ˆ®Èiàthş›Á didn'
t
 
´ovide


896 #¨
CÚ‹Á
-
Ty³
 
h—d”
. 
S“
 
h‰p
:

897 
deçuÉ_cÚ‹Á_ty³
 = ''

899 
is
 
giv’
. 
The
 
em±y
 
¡ršg
 i 
u£d
 
Reque¡Body
, 
which
 
»suÉs
 
š
 
the


900 
»que¡
 
body
 
nÙ
 
bešg
 
»ad
 
Ü
 
·r£d
 
©
 
®l
. 
This
 
is
 
by
 
design
; 
a
 
missšg


901 ``
CÚ‹Á
-
Ty³
`` 
h—d”
 
š
 
the
 
HTTP
 
»que¡
 
’t™y
 
is
 
ª
 
”rÜ
 
©
 
be¡
,

902 
ªd
 
a
 
£cur™y
 
hŞe
 
©
 
wÜ¡
. 
FÜ
 
muÉ¬t
 
·¹s
, 
howev”
, 
the
 
MIME
 
¥ec


903 
deş¬es
 
th©
 
a
 
·¹
 
w™h
 
no
 
CÚ‹Á
-
Ty³
 
deçuÉs
 
to
 "text/plain"

904 (
£e
 :
şass
:`
P¬t
<
ch”rypy
.
_ı»qbody
.Part>`).

907 
maxby‹s
 = 
NÚe


910 
def
 
	$__š™__
(
£lf
, 
å
, 
h—d”s
, 
·¿ms
=
NÚe
, 
»que¡_·¿ms
=None):

911 
EÁ™y
.
	$__š™__
(
£lf
, 
å
, 
h—d”s
, 
·¿ms
)

914 #Wh’ 
no
 
ex¶ic™
 
ch¬£t
 
·¿m‘”
 
is
 
´ovided
 
by
 
the


915 #£nd”, 
medŸ
 
subty³s
 
of
 
the
 "‹xt" 
ty³
 
¬e
 
defšed


916 #tØ
have
 
a
  
ch¬£t
 
v®ue
 
of
 "ISO-8859-1" 
wh’


917 #»ûived 
vŸ
 
HTTP
.

918 
£lf
.
cÚ‹Á_ty³
.
v®ue
.
	`¡¬tsw™h
('text/'):

919 
c
 
	`š
 ('ISO-8859-1', 'iso-8859-1', 'Latin-1', 'latin-1'):

920 
c
 
š
 
£lf
.
©‹m±_ch¬£ts
:

923 
£lf
.
©‹m±_ch¬£ts
.
	`­³nd
('ISO-8859-1')

925 #TempÜ¬y 
fix
 
d•»ÿtšg
 
·ssšg
 .
·¹s
 
as
 .
·¿ms
.

926 
£lf
.
´oûssÜs
['muÉ¬t'] = 
_Şd_´oûss_muÉ¬t


928 
»que¡_·¿ms
 
is
 
NÚe
:

929 
»que¡_·¿ms
 = {
	}
}

930 
£lf
.
»que¡_·¿ms
 =„equest_params

932 
def
 
	$´oûss
(
£lf
):

934 #"
The
 
´e£nû
 
of
 
a
 
mes§ge
-
body
 
š
‡ 
»que¡
 
is
 
sigÇËd
 
by
 
the


935 #šşusiÚ 
of
 
a
 
CÚ‹Á
-
L’gth
 
Ü
 
T¿nsãr
-
Encodšg
 
h—d”
 
f›ld
 
š


936 #th
»que¡
's message-headers."

937 #Iˆ
is
 
possibË
 
to
 
£nd
 
a
 
POST
 
»que¡
 
w™h
 
no
 
body
, 
exam¶e
;

938 #howev”, 
­p
 
dev–İ”s
 
¬e
 
»¥ÚsibË
 
š
 
th©
 
to
 
£t


939 #ch”rypy.
»que¡
.
´oûss_body
 
to
 
F®£
 
so
 
this
 
m‘hod
 
i¢
't called.

940 
h
 = 
ch”rypy
.
£rvšg
.
»que¡
.
h—d”s


941 'CÚ‹Á-L’gth' 
nÙ
 
š
 
h
 
ªd
 'Transfer-Encoding'‚ot in h:

942 
¿i£
 
ch”rypy
.
	$HTTPE¼Ü
(411)

944 
£lf
.
å
 = 
	`SizedR—d”
(£lf.å, s–f.
Ëngth
,

945 
£lf
.
maxby‹s
, 
bufsize
=self.bufsize,

946 
has_Œa”s
='T¿”' 
š
 
h
)

947 
	`su³r
(
Reque¡Body
, 
£lf
).
	$´oûss
()

949 #Body 
·¿ms
 
should
 
®so
 
be
 
a
 
·¹
 
of
 
the
 
»que¡_·¿ms


950 #add 
them
 
š
 
h”e
.

951 
»que¡_·¿ms
 = 
£lf
.request_params

952 
key
, 
v®ue
 
š
 
£lf
.
·¿ms
.
	$™ems
():

953 #PythÚ 2 
Úly
: 
keywÜd
 
¬gum’ts
 
mu¡
 
be
 
by‹
 
	`¡ršgs
 (
ty³
 'str').

954 
sys
.
v”siÚ_šfo
 < (3, 0):

955 
	$isš¡ªû
(
key
, 
unicode
):

956 
key
 = key.
	`’code
('ISO-8859-1')

958 
key
 
š
 
»que¡_·¿ms
:

959 
nÙ
 
	$isš¡ªû
(
»que¡_·¿ms
[
key
], 
li¡
):

960 
»que¡_·¿ms
[
key
] = [request_params[key]]

961 
»que¡_·¿ms
[
key
].
	$­³nd
(
v®ue
)

963 
»que¡_·¿ms
[
key
] = 
v®ue


	@trunk/objs/CherryPy-3.2.4/cherrypy/_cprequest.py

2 
impÜt
 
os


3 
impÜt
 
sys


4 
impÜt
 
time


5 
impÜt
 
w¬nšgs


7 
impÜt
 
ch”rypy


8 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
	gba£¡ršg
, 
	gcİykeys
, 
	gÁob
, 
unicode¡r


9 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
	gSim¶eCook›
, 
	gCook›E¼Ü
, 
py3k


10 
äom
 
ch”rypy
 
impÜt
 
	g_ı»qbody
, 
_ıcÚfig


11 
äom
 
	gch”rypy
.
_ı”rÜ
 
impÜt
 
	gfÜm©_exc
, 
b¬e_”rÜ


12 
äom
 
	gch”rypy
.
lib
 
impÜt
 
	gh‰put
, 
fe_g’”©Ü


15 
şass
 
	$Hook
(
objeù
):

18 
ÿÎback
 = 
NÚe


20 
The
 
b¬e
 
ÿÎabË
 
th©
 
this
 
Hook
 
objeù
 
is
 
w¿µšg
, 
which
 
wl


21 
be
 
ÿÎed
 
wh’
 
the
 
Hook
 
is
 called."""

23 
ç§ã
 = 
F®£


25 
If
 
True
, 
the
 
ÿÎback
 
is
 
gu¬ª‹ed
 
to
 
run
 
ev’
 
Ùh”
 
ÿÎbacks


26 
äom
 
the
 
§me
 
ÿÎ
 
pošt
 
¿i£
 
exû±iÚs
."""

28 
´iÜ™y
 = 50

30 
Defšes
 
the
 
Üd”
 
of
 
executiÚ
 
a
 
li¡
 oà
Hooks
. 
PriÜ™y
 
numb”s


31 
should
 
be
 
lim™ed
 
to
 
the
 
şo£d
 
š‹rv®
 [0, 100], 
but
 
v®ues
 
outside


32 
this
 
¿nge
 
¬e
 
acû±abË
, 
as
‡» 
äaùiÚ®
 
v®ues
."""

34 
kw¬gs
 = {
	}
}

36 
A
 
£t
 
of
 
keywÜd
 
¬gum’ts
 
th©
 
wl
 
be
 
·s£d
 
to
 
the


37 
ÿÎabË
 
Ú
 
—ch
 
ÿÎ
."""

39 
def
 
	$__š™__
(
£lf
, 
ÿÎback
, 
ç§ã
=
NÚe
, 
´iÜ™y
=NÚe, **
kw¬gs
):

40 
£lf
.
ÿÎback
 = callback

42 
ç§ã
 
is
 
NÚe
:

43 
ç§ã
 = 
	`g‘©Œ
(
ÿÎback
, "ç§ã", 
F®£
)

44 
£lf
.
ç§ã
 = failsafe

46 
´iÜ™y
 
is
 
NÚe
:

47 
´iÜ™y
 = 
	`g‘©Œ
(
ÿÎback
, "priority", 50)

48 
£lf
.
´iÜ™y
 =…riority

50 
£lf
.
kw¬gs
 = kwargs

52 
def
 
	$__É__
(
£lf
, 
Ùh”
):

54  
£lf
.
´iÜ™y
 < 
Ùh”
.priority

56 
def
 
	$__cmp__
(
£lf
, 
Ùh”
):

58  
	$cmp
(
£lf
.
´iÜ™y
, 
Ùh”
.priority)

60 
def
 
	$__ÿÎ__
(
£lf
):

62  
£lf
.
	$ÿÎback
(**
£lf
.
kw¬gs
)

64 
def
 
	$__»´__
(
£lf
):

65 
şs
 = 
£lf
.
__şass__


67 % (
şs
.
__moduË__
, cls.
__Çme__
, 
£lf
.
ÿÎback
,

68 
£lf
.
ç§ã
, s–f.
´iÜ™y
,

69 ", ".
	`još
(['%s=%r' % (
k
, 
v
)

70 
k
, 
v
 
š
 
£lf
.
kw¬gs
.
	`™ems
()])))

73 
şass
 
	$HookM­
(
diù
):

76 
def
 
	$__Ãw__
(
şs
, 
pošts
=
NÚe
):

77 
d
 = 
diù
.
	$__Ãw__
(
şs
)

78 
p
 
š
 
pošts
 
Ü
 []:

79 
d
[
p
] = []

80  
d


82 
def
 
	$__š™__
(
£lf
, *
a
, **
kw
):

83 
·ss


85 
def
 
	$©ch
(
£lf
, 
pošt
, 
ÿÎback
, 
ç§ã
=
NÚe
, 
´iÜ™y
=NÚe, **
kw¬gs
):

87 
£lf
[
pošt
].
	`­³nd
(
	$Hook
(
ÿÎback
, 
ç§ã
, 
´iÜ™y
, **
kw¬gs
))

89 
def
 
	$run
(
£lf
, 
pošt
):

91 
exc
 = 
NÚe


92 
hooks
 = 
£lf
[
pošt
]

93 
hooks
.
	$sÜt
()

94 
hook
 
š
 
hooks
:

95 #Som
hooks
 
¬e
 
gu¬ª‹ed
 
to
 
run
 
ev’
 
Ùh”s
 
©


96 #th
§me
 
hookpošt
 
ç
. 
We
 
wl
 
¡l
 
log
 
the
 
çu»
,

97 #buˆ
´oûed
 
Ú
 
to
 
the
 
Ãxt
 
hook
. 
The
 
Úly
 
way


98 #tØ
¡İ
 
®l
 
´oûssšg
 
äom
 
Úe
 
of
 
the£
 
hooks
 
is


99 #tØ
¿i£
 
Sy¡emEx™
 
ªd
 
¡İ
 
the
 
whŞe
 
£rv”
.

100 
exc
 
is
 
NÚe
 
Ü
 
hook
.
ç§ã
:

101 
Œy
:

102 
	$hook
()

103 
	$exû±
 (
KeybßrdIÁ”ru±
, 
Sy¡emEx™
):

104 
¿i£


105 
	$exû±
 (
ch”rypy
.
HTTPE¼Ü
, ch”rypy.
HTTPRedœeù
,

106 
ch”rypy
.
IÁ”ÇlRedœeù
):

107 
exc
 = 
sys
.
	`exc_šfo
()[1]

108 
exû±
:

109 
exc
 = 
sys
.
	`exc_šfo
()[1]

110 
ch”rypy
.
	$log
(
Œaûback
=
True
, 
£v”™y
=40)

111 
exc
:

112 
¿i£
 
exc


114 
def
 
	$__cİy__
(
£lf
):

115 
Ãwm­
 = 
£lf
.
	$__şass__
()

116 #W
ÿn
'ˆju¡ u£ '
upd©e
' because we want copies ofhe

117 #mubË 
	`v®ues
 (
—ch
 
is
 
a
 
li¡
è
as
 
w–l
.

118 
k
, 
v
 
š
 
£lf
.
	$™ems
():

119 
Ãwm­
[
k
] = 
v
[:]

120  
Ãwm­


121 
cİy
 = 
__cİy__


123 
def
 
	$__»´__
(
£lf
):

124 
şs
 = 
£lf
.
__şass__


125  "%s.%sÕošts=%r)" % (
şs
.
__moduË__
, cls.
__Çme__
, 
	$cİykeys
(
£lf
))

128 #CÚfig 
Çme¥aû
 
hªdËrs


130 
def
 
	$hooks_Çme¥aû
(
k
, 
v
):

132 #U£ 
¥l™
 
agaš
 
to
 
®low
 
muÉË
 
hooks
 
a
 
sšgË


133 #hookpošˆ
³r
 
	`·th
 (
e
.
g
. "hooks.before_handler.1").

134 #L™e-
known
 
çù
 
you
 
Úly
 
g‘
 
äom
 
»adšg
 
sourû
 ;)

135 
hookpošt
 = 
k
.
	`¥l™
(".", 1)[0]

136 
	$isš¡ªû
(
v
, 
ba£¡ršg
):

137 
v
 = 
ch”rypy
.
lib
.
	$©Œibu‹s
(
v
)

138 
nÙ
 
	$isš¡ªû
(
v
, 
Hook
):

139 
v
 = 
	$Hook
(
v
)

140 
ch”rypy
.
£rvšg
.
»que¡
.
hooks
[
hookpošt
].
	$­³nd
(
v
)

142 
def
 
	$»que¡_Çme¥aû
(
k
, 
v
):

144 #Provide 
cÚfig
 
’Œ›s
 
to
 
£t
 
»que¡
.
body
 
	`©Œs
 (
like
 
©‹m±_ch¬£ts
).

145 
k
[:5] == 'body.':

146 
	`£‰r
(
ch”rypy
.
£rvšg
.
»que¡
.
body
, 
k
[5:], 
v
)

148 
	$£‰r
(
ch”rypy
.
£rvšg
.
»que¡
, 
k
, 
v
)

150 
def
 
	$»¥Ú£_Çme¥aû
(
k
, 
v
):

152 #Provide 
cÚfig
 
’Œ›s
 
to
 
£t
  
»¥Ú£
 
h—d”s


154 
k
[:8] == 'headers.':

155 
ch”rypy
.
£rvšg
.
»¥Ú£
.
h—d”s
[
k
.
	`¥l™
('.', 1)[1]] = 
v


157 
	$£‰r
(
ch”rypy
.
£rvšg
.
»¥Ú£
, 
k
, 
v
)

159 
def
 
	$”rÜ_·ge_Çme¥aû
(
k
, 
v
):

161 
k
 != 'default':

162 
k
 = (k)

163 
ch”rypy
.
£rvšg
.
»que¡
.
”rÜ_·ge
[
k
] = 
v


166 
hookpošts
 = ['on_start_resource', 'before_request_body',

172 
şass
 
	$Reque¡
(
objeù
):

175 
This
 
objeù
 
»´e£Ás
 
the
 
m‘ad©a
 
of
 
ª
 
HTTP
 
»que¡
 
mes§ge
;

176 
th©
 
is
, 
™
 
cÚšs
 
©Œibu‹s
 
which
 
desüibe
 
the
 
’vœÚm’t


177 
š
 
which
 
the
 
»que¡
 
URL
, 
h—d”s
, 
ªd
 
body
 
w”e
 
	`£Á
 (
you


178 
wªt
 
toŞs
 
to
 
š‹½»t
 
the
 
h—d”s
 
ªd
 
body
, 
tho£
 
¬e
 
–£wh”e
,

179 
mo¡ly
 
š
 
ToŞs
). 
This
 'm‘ad©a' 
cÚsi¡s
 
of
 
sock‘
 
d©a
,

180 
Œª¥Üt
 
ch¬aù”i¡ics
, 
ªd
 
the
 
Reque¡
-
Lše
. 
This
 
objeù


181 
®so
 
cÚšs
 
d©a
 
»g¬dšg
 
the
 
cÚfigu¿tiÚ
 
š
 
efãù
 

182 
the
 
giv’
 
URL
, 
ªd
h
executiÚ
 
¶ª
 
g’”©šg
 
a
 
»¥Ú£
.

185 
´ev
 = 
NÚe


187 
The
 
´evious
 
Reque¡
 
	`objeù
 (
ªy
). 
This
 
should
 
be
 
NÚe


188 
uÆess
 
we
 
¬e
 
´oûssšg
 
ª
 
IÁ”ÇlRedœeù
."""

190 #CÚv”§tiÚ/
cÚÃùiÚ
 
©Œibu‹s


191 
loÿl
 = 
h‰put
.
	`Ho¡
("127.0.0.1", 80)

194 
»mÙe
 = 
h‰put
.
	`Ho¡
("127.0.0.1", 1111)

197 
scheme
 = "http"

199 
The
 
´ÙocŞ
 
u£d
 
b‘w“n
 
ş›Á
 
ªd
 
£rv”
. 
In
 
mo¡
 
ÿ£s
,

200 
this
 
wl
 
be
 
e™h”
 'h‰p' 
Ü
 'https'."""

202 
£rv”_´ÙocŞ
 = "HTTP/1.1"

204 
The
 
HTTP
 
v”siÚ
 
which
 
the
 HTTP 
£rv”
 
is
 
©
 
Ëa¡


205 
cÚd™iÚ®ly
 
com¶ŸÁ
."""

207 
ba£
 = ""

209 
In
 
some
 
	`ÿ£s
 (
e
.
g
. 
wh’
 
´oxyšg
 
vŸ
 
mod_»wr™e
), 
this
 
may
 
cÚš


210 
·th
 
£gm’ts
 
which
 
ch”rypy
.
u¾
 
u£s
 
wh’
 
cÚ¡ruùšg
 url's, but

211 
which
 
Ùh”wi£
 
¬e
 
ignÜed
 
by
 
Ch”ryPy
. 
Reg¬dËss
, 
this
 
v®ue


212 
MUST
 
NOT
 
’d
 
š
 
a
 
¦ash
."""

214 #Reque¡-
Lše
 
©Œibu‹s


215 
»que¡_lše
 = ""

217 
The
 
com¶‘e
 
Reque¡
-
Lše
 
»ûived
 
äom
 
the
 
ş›Á
. 
This
 
is
 
a


218 
sšgË
 
¡ršg
 
cÚsi¡šg
 
of
 
the
 
»que¡
 
m‘hod
, 
URI
, 
ªd
 
´ÙocŞ


219 
	`v”siÚ
 (
jošed
 
by
 
¥aûs
). 
Any
 
fš®
 
CRLF
 
is
 
»moved
."""

221 
m‘hod
 = "GET"

223 
Indiÿ‹s
 
the
 
HTTP
 
m‘hod
 
to
 
be
 
³rfÜmed
 
Ú
h
»sourû
 
id’tif›d


224 
by
 
the
 
Reque¡
-
URI
. 
CommÚ
 
m‘hods
 
šşude
 
GET
, 
HEAD
, 
POST
, 
PUT
, 
ªd


225 
DELETE
. 
Ch”ryPy
 
®lows
 
ªy
 
ex‹nsiÚ
 
m‘hod
; 
howev”
, 
v¬ious
 
HTTP


226 
£rv”s
 
ªd
 
g©eways
 
may
 
»¡riù
 
the
 
£t
 
of
 
®lowabË
 
m‘hods
.

227 
Ch”ryPy
 
­¶iÿtiÚs
 
SHOULD
 
»¡riù
 
the
 
	`£t
 (
Ú
 
a
 
³r
-
URI
 
basis
)."""

229 
qu”y_¡ršg
 = ""

231 
The
 
qu”y
 
compÚ’t
 
of
 
the
 
Reque¡
-
URI
, 
a
 
¡ršg
 oà
šfÜm©iÚ
 
to
 
be


232 
š‹½»‹d
 
by
 
the
 
»sourû
. 
The
 
qu”y
 
pÜtiÚ
 
of
 
a
 
URI
 
fŞlows
he

233 
·th
 
compÚ’t
, 
ªd
 
is
 
£·¿‹d
 
by
 
a
 '?'. 
FÜ
 
exam¶e
, 
the
 
URI


234 'h‰p://www.ch”rypy.Üg/wiki?a=3&b=4' 
has
 
the
 
qu”y
 
compÚ’t
,

237 
qu”y_¡ršg_’codšg
 = 'utf8'

239 
The
 
’codšg
 
ex³ùed
 
qu”y
 
¡ršg
 
¬gum’ts
 
aá”
 % 
HEX
 HEX 
decodšg
).

240 
If
 
a
 
qu”y
 
¡ršg
 
is
 
´ovided
 
th©
 
ÿÂÙ
 
be
 
decoded
 
w™h
 
this
 
’codšg
,

241 404 
is
 
	`¿i£d
 (
sšû
 
‹chniÿÎy
 
™
's‡ different URI). If you want

242 
¬b™¿ry
 
’codšgs
 
to
 
nÙ
 
”rÜ
, 
£t
 
this
Ø'L©š-1'; 
you
 
ÿn
 
th’


243 
’code
 
back
 
to
 
by‹s
 
ªd
 
»
-
decode
Ø
wh©ev”
 
’codšg
 
you
 
like
 
Ï‹r
.

246 
´ÙocŞ
 = (1, 1)

248 
of
 
ã©u»s
 
which
 
should
 
be
 
®lowed
 
š
 
the
 
»¥Ú£
. 
If
 
BOTH


249 
the
 
ş›Á
' »que¡ mes§gANDh£rv”'
s
 
Ëv–
 
of
 
HTTP


250 
com¶Ÿnû
 
is
 
HTTP
/1.1, 
this
 
©Œibu‹
 
wl
 
be
 
the
 
	`tu¶e
 (1, 1).

251 
If
 
e™h”
 
is
 1.0, 
this
 
©Œibu‹
 
wl
 
be
 
the
 
	`tu¶e
 (1, 0).

252 
Low”
 
HTTP
 
´ÙocŞ
 
v”siÚs
 
¬e
 
nÙ
 
ex¶ic™ly
 
suµÜ‹d
."""

254 
·¿ms
 = {
	}
}

256 
A
 
diù
 
which
 
combšes
 
qu”y
 
	$¡ršg
 (
GET
è
ªd
 
»que¡
 
	$’t™y
 (
POST
)

257 
v¬ŸbËs
. 
This
 
is
 
pİuÏ‹d
 
š
 
two
 
¡ages
: 
GET
 
·¿ms
 
¬e
 
added


258 
befÜe
 
the
 'Ú_¡¬t_»sourû' 
hook
, 
ªd
 
POST
 
·¿ms
 
¬e
 
added


259 
b‘w“n
 
the
 'befÜe_»que¡_body' 
ªd
 'befÜe_hªdËr' 
hooks
."""

261 #Mes§g
©Œibu‹s


262 
h—d”_li¡
 = []

264 
A
 
li¡
 
of
 
the
 
HTTP
 
»que¡
 
h—d”s
 
	$as
 (
Çme
, 
v®ue
è
tu¶es
.

265 
In
 
g’”®
, 
you
 
should
 
u£
 
»que¡
.
	$h—d”s
 (
a
 
diù
è
š¡—d
."""

267 
h—d”s
 = 
h‰put
.
	`H—d”M­
()

269 
A
 
diù
-
like
 
objeù
 
cÚššg
 
the
 
»que¡
 
h—d”s
. 
Keys
 
¬e
 
h—d”


270 
	`Çmes
 (
š
 
T™Ë
-
Ca£
 
fÜm©
); 
howev”
, 
you
 
may
 
g‘
 
ªd
 
£t
 
them
 in

271 
a
 -
š£ns™ive
 
mªÃr
. 
Th©
 
is
, 
h—d”s
['CÚ‹Á-Ty³'] 
ªd


272 
h—d”s
['cÚ‹Á-ty³'] 
»ãr
 
to
 
the
 
§me
 
v®ue
. 
V®ues
 
¬e
 
h—d”


273 
	`v®ues
 (
decoded
 
accÜdšg
 
to
 :
rfc
:`2047` 
Ãûs§ry
). 
S“
 
®so
:

274 
h‰put
.
H—d”M­
, h‰put.
H—d”EËm’t
."""

276 
cook›
 = 
	`Sim¶eCook›
()

279 
rfe
 = 
NÚe


281 
If
 
the
 
»que¡
 
šşuded
 
ª
 
	`’t™y
 (
body
), 
™
 
wl
 
be
 
avaabË


282 
as
 
a
 
¡»am
 
š
 
this
 
©Œibu‹
. 
Howev”
, 
the
 
rfe
 
wl
 
nÜm®ly


283 
be
 
»ad
 
you
 
b‘w“n
 
the
 'befÜe_»que¡_body' 
hook
 
ªd
he

284 'befÜe_hªdËr' 
hook
, 
ªd
 
the
 
»suÉšg
 
¡ršg
 
is
 
¶aûd
 
što


285 
e™h”
 
»que¡
.
·¿ms
 
Ü
 
the
„eque¡.
body
 
©Œibu‹
.

287 
You
 
may
 
di§bË
 
the
 
autom©ic
 
cÚsum±iÚ
 
of
h
rfe
 
by
 
£‰šg


288 
»que¡
.
´oûss_»que¡_body
 
to
 
F®£
, 
e™h”
 
š
 
cÚfig
 
the
 
desœed


289 
·th
, 
Ü
 
š
 
ª
 'Ú_¡¬t_»sourû' o¸'befÜe_»que¡_body' 
hook
.

291 
WARNING
: 
In
 
®mo¡
 
ev”y
 , 
you
 
should
 
nÙ
 
©‹m±
 
to
 
»ad
 
äom
 
the


292 
rfe
 
¡»am
 
aá”
 
Ch”ryPy
's‡utomatic mechanism has„ead it. If you

293 
tuº
 
off
 
the
 
autom©ic
 
·rsšg
 
of
 
rfe
, 
you
 
should
 
»ad
 
exaùly
he

294 
numb”
 
of
 
by‹s
 
¥ecif›d
 
š
 
»que¡
.
h—d”s
['Content-Length'].

295 
IgnÜšg
 
e™h”
 
of
 
the£
 
w¬nšgs
 
may
 
»suÉ
 
š
 
a
 
hung
 
»que¡
 
th»ad


296 
Ü
 
š
 
cÜru±iÚ
 
of
 
the
 
	$Ãxt
 (
p–šed
è
»que¡
.

299 
´oûss_»que¡_body
 = 
True


301 
If
 
True
, 
the
 
	$rfe
 (
ªy
è
is
 
autom©iÿÎy
 
»ad
 
ªd
 
·r£d
,

302 
ªd
 
the
 
»suÉ
 
¶aûd
 
što
 
»que¡
.
·¿ms
 
Ü
„eque¡.
body
."""

304 
m‘hods_w™h_bod›s
 = ("POST", "PUT")

306 
A
 
£qu’û
 
of
 
HTTP
 
m‘hods
 
which
 
Ch”ryPy
 
wl
 
autom©iÿÎy


307 
©‹m±
 
to
 
»ad
 
a
 
body
 
äom
 
the
 
rfe
."""

309 
body
 = 
NÚe


311 
If
 
the
 
»que¡
 
CÚ‹Á
-
Ty³
 
is
 'application/x-www-form-urlencoded'

312 
Ü
 
muÉ¬t
, 
this
 
wl
 
be
 
NÚe
. 
Oth”wi£
,hi wÈb
ª
 
š¡ªû


313 
of
 :
şass
:`
Reque¡Body
<
ch”rypy
.
_ı»qbody
.Reque¡Body>` (
which
 
you


314 
ÿn
 .
	`»ad
()); 
this
 
v®ue
 
is
 
£t
 
b‘w“n
 
the
 'befÜe_»que¡_body' 
ªd


315 'befÜe_hªdËr' 
	`hooks
 (
assumšg
 
th©
 
´oûss_»que¡_body
 
is
 
True
)."""

317 #Di¥©ch 
©Œibu‹s


318 
di¥©ch
 = 
ch”rypy
.di¥©ch.
	`Di¥©ch”
()

320 
The
 
objeù
 
which
 
looks
 
up
 
the
 '·ghªdËr' 
ÿÎabË
 
ªd
 
cŞËùs


321 
cÚfig
 
the
 
cu¼’t
 
»que¡
 
ba£d
 
Ú
h
·th_šfo
, 
Ùh”


322 
»que¡
 
©Œibu‹s
, 
ªd
 
the
 
­¶iÿtiÚ
 
¬ch™eùu»
. 
The
 
cÜe


323 
ÿÎs
 
the
 
di¥©ch”
 
as
 
—¾y
‡ 
possibË
, 
·ssšg
 
™
 
a
 'path_info'

324 
¬gum’t
.

326 
The
  
di¥©ch”
 
discov”s
 
the
 
·ge
 
hªdËr
 
by
 
m©chšg
 
·th_šfo


327 
to
 
a
 
h›¿rchiÿl
 
¬¿ngem’t
 
of
 
objeùs
, 
¡¬tšg
 
©
 
»que¡
.
­p
.
roÙ
.

328 
S“
 
	$h–p
(
ch”rypy
.
di¥©ch
è
mÜe
 
šfÜm©iÚ
."""

330 
süt_Çme
 = ""

332 
The
 'mouÁ…ošt' 
of
 
the
 
­¶iÿtiÚ
 
which
 
is
 
hªdlšg
 
this
 
»que¡
.

334 
This
 
©Œibu‹
 
MUST
 
NOT
 
’d
 
š
 
a
 
¦ash
. 
If
 
the
 
süt_Çme
 
»ãrs
 
to


335 
the
 
roÙ
 
of
h
URI
, 
™
 
MUST
 
be
 
ª
 
em±y
 
	`¡ršg
 (
nÙ
 "/").

338 
·th_šfo
 = "/"

340 
The
 '»Ïtiv·th' 
pÜtiÚ
 
of
 
the
 
Reque¡
-
URI
. 
This
 
is
 
»Ïtive


341 
to
 
the
 
	`süt_Çme
 ('mouÁ…ošt'è
of
h
­¶iÿtiÚ
 
which
 
is


342 
hªdlšg
 
this
 
»que¡
."""

344 
logš
 = 
NÚe


346 
Wh’
 
auth’tiÿtiÚ
 
is
 
u£d
 
duršg
 
the
 
»que¡
 
´oûssšg
 
this
 is

347 
£t
 
to
 'F®£' 
™
 
çed
 
ªd
Ø
the
 'u£ºame' 
v®ue
 ™ 
sucûeded
.

348 
The
  'NÚe' 
im¶›s
 
th©
 
no
 
auth’tiÿtiÚ
 
h­³Ãd
."""

350 #NÙ
th©
 
ch”rypy
.
u¾
 
u£s
 "ià»que¡.­p:" 
to
 
d‘”mše
 
wh‘h”


351 #th
ÿÎ
 
is
 
duršg
 
a
 
»®
 
HTTP
 
»que¡
 
Ü
 
nÙ
. 
So
 
Ëave
 
this
 
NÚe
.

352 
­p
 = 
NÚe


355 
hªdËr
 = 
NÚe


357 
The
 
funùiÚ
, 
m‘hod
, 
Ü
 
Ùh”
 
ÿÎabË
 
which
 
Ch”ryPy
 
wl
 
ÿÎ
 
to


358 
´oduû
 
the
 
»¥Ú£
. 
The
 
discov”y
 
of
h
hªdËr
 
ªd
h
¬gum’ts


359 
™
 
wl
 
»ûive
 
¬e
 
d‘”mšed
 
by
 
the
 
»que¡
.
di¥©ch
 
objeù
.

360 
By
 , 
the
 
hªdËr
 
is
 
discov”ed
 
by
 
w®kšg
 
a
 
Œ“
 
of
 
objeùs


361 
¡¬tšg
 
©
 
»que¡
.
­p
.
roÙ
, 
ªd
 
is
 
th’
 
·s£d
 
®l
 
HTTP
 
·¿ms


362 (
äom
 
the
 
qu”y
 
¡ršg
 
ªd
 
POST
 
body
è
as
 
keywÜd
 
¬gum’ts
."""

364 
toŞm­s
 = {
	}
}

366 
A
 
Ã¡ed
 
diù
 
of
 
®l
 
ToŞboxes
 
ªd
 
ToŞs
 
š
 
efãù
 
this
 
»que¡
,

367 
of
 
the
 
	gfÜm
: {
ToŞbox
.
Çme¥aû
: {
ToŞ
.
Çme
: 
cÚfig
 
diù
}}."""

369 
cÚfig
 = 
NÚe


371 
A
 
æ©
 
diù
 
of
 
®l
 
cÚfigu¿tiÚ
 
’Œ›s
 
which
 
­¶y
 
to
 
the


372 
cu¼’t
 
»que¡
. 
The£
 
’Œ›s
 
¬e
 
cŞËùed
 
äom
 
glob®
 
cÚfig
,

373 
­¶iÿtiÚ
 
cÚfig
 (
ba£d
 
Ú
 
»que¡
.
·th_šfo
), 
ªd
 
äom
 
hªdËr


374 
cÚfig
 (
exaùly
 
how
 
is
 
gov”Ãd
 
by
 
the
 
»que¡
.
di¥©ch
 
objeù
 
š


375 
efãù
 
this
 
»que¡
; 
by
 , 
hªdËr
 
cÚfig
 
ÿn
 
be
 
©ched


376 
ªywh”e
 
š
 
the
 
Œ“
 
b‘w“n
 
»que¡
.
­p
.
roÙ
 
ªd
h
fš®
 
hªdËr
,

377 
ªd
 
šh”™s
 
downw¬d
)."""

379 
	gis_šdex
 = 
NÚe


381 
This
 
wl
 
be
 
True
 
the
 
cu¼’t
 
»que¡
 
is
 
m­³d
 
to
 
ª
 'index'

382 
»sourû
 
hªdËr
 (
®so
, 
a
 'deçuÉ' hªdË¸
·th_šfo
 
’ds
 
w™h


383 
a
 
¦ash
). 
The
 
v®ue
 
may
 
be
 
u£d
 
to
 
autom©iÿÎy
 
»dœeù
 
the


384 
	gu£r
-
ag’t
 
to
 
	ga
 'mÜÿnÚiÿl' 
URL
 
which
 
e™h”
 
adds
 
Ü
 
»moves


385 
the
 
Œašg
 
	g¦ash
. 
S“
 
	gch”rypy
.
	gtoŞs
.
	gŒašg_¦ash
."""

387 
	ghooks
 = 
HookM­
(
hookpošts
)

389 
A
 
HookM­
 (
diù
-
like
 
objeù
è
of
 
the
 
fÜm
: {
hookpošt
: [
hook
, ...]}.

390 
Each
 
key
 
is
 
a
 
¡r
 
Çmšg
 
the
 
hook
 
pošt
, 
ªd
 
—ch
 
v®ue
 i ¨
li¡


391 
of
 
hooks
 
which
 
wl
 
be
 
ÿÎed
 
©
 
th©
 
hook
 
pošt
 
duršg
 
this
 
	g»que¡
.

392 
The
 
li¡
 
of
 
hooks
 
is
 
g’”®ly
 
pİuÏ‹d
 
as
 
—¾y
‡ 
possibË
 (
mo¡ly


393 
äom
 
ToŞs
 
¥ecif›d
 
š
 
cÚfig
), 
but
 
may
 
be
 
ex‹nded
 
©
 
ªy
 
	gtime
.

394 
S“
 
	g®so
: 
_ı»que¡
.
Hook
, 
	g_ı»que¡
.
	gHookM­
, 
ªd
 
	gch”rypy
.
	gtoŞs
."""

396 
	g”rÜ_»¥Ú£
 = 
ch”rypy
.
HTTPE¼Ü
(500).
£t_»¥Ú£


398 
The
 
no
-
¬g
 
ÿÎabË
 
which
 
wl
 
hªdË
 
uÃx³ùed
, 
uÁ¿µed
 
”rÜs


399 
duršg
 
»que¡
 
	g´oûssšg
. 
This
 
is
 
nÙ
 
u£d
 
ex³ùed
 
	gexû±iÚs


400 (
like
 
	gNÙFound
, 
	gHTTPE¼Ü
, 
Ü
 
	gHTTPRedœeù
è
which
 
¬e
 
¿i£d
 
š


401 
»¥Ú£
 
to
 
ex³ùed
 
cÚd™iÚs
 (
tho£
 
should
 
be
 
cu¡omized
 
e™h”


402 
vŸ
 
»que¡
.
”rÜ_·ge
 
Ü
 
by
 
ov”ridšg
 
HTTPE¼Ü
.
£t_»¥Ú£
).

403 
By
 , 
”rÜ_»¥Ú£
 
u£s
 
	$HTTPE¼Ü
(500è
to
  
a
 
g’”ic


404 
”rÜ
 
»¥Ú£
 
to
 
the
 
u£r
-
ag’t
."""

406 
”rÜ_·ge
 = {
	}
}

408 
A
 
diù
 
of
 {
”rÜ
 
code
: 
»¥Ú£
 
f’ame
 
Ü
 
ÿÎabË
} 
·œs
.

410 
The
 
”rÜ
 
code
 
mu¡
 
be
 
ª
 
»´e£Ášg
 
a
 
giv’
 
HTTP
ƒrror code,

411 
Ü
 
the
 
	g¡ršg
 'deçuÉ', 
which
 
wl
 
be
 
u£d
 
no
 
m©chšg
 
’Œy


412 
is
 
found
 
a
 
giv’
 
num”ic
 
	gcode
.

414 
If
 
a
 
f’ame
 
is
 
	g´ovided
, 
the
 
fe
 
should
 
cÚš
‡ 
PythÚ
 
	g¡ršg
-

415 
fÜm©tšg
 
	g‹m¶©e
, 
ªd
 
ÿn
 
ex³ù
 
by
  
to
 
»ûive
 
fÜm©


416 
v®ues
 
w™h
 
the
 
m­pšg
 
	gkeys
 %(
	g¡©us
)
	gs
, %(
	gmes§ge
)s, %(
	gŒaûback
)s,

417 
	gªd
 %(
	gv”siÚ
)
	gs
. 
The
 
£t
 
of
 
fÜm©
 
m­pšgs
 
ÿn
 
be
 
ex‹nded
 
by


418 
ov”ridšg
 
	gHTTPE¼Ü
.
	g£t_»¥Ú£
.

420 
If
 
a
 
ÿÎabË
 
is
 
	g´ovided
, 
™
 
wl
 
be
 
ÿÎed
 
by
  
w™h
 
keywÜd


421 
	g¬gum’ts
 '¡©us', 'mes§ge', 'Œaûback', 
	gªd
 'v”siÚ', 
as
 
a


422 
	g¡ršg
-
fÜm©tšg
 
	g‹m¶©e
. 
The
 
ÿÎabË
 
mu¡
  
a
 
¡ršg
 
Ü
 
™”abË
 
of


423 
¡ršgs
 
which
 
wl
 
be
 
£t
 
to
 
	g»¥Ú£
.
	gbody
. 
It
 
may
 
®so
 
ov”ride
 
h—d”s
 
Ü


424 
³rfÜm
 
ªy
 
Ùh”
 
	g´oûssšg
.

426 
If
 
no
 
’Œy
 
is
 
giv’
 
ª
 
”rÜ
 
	gcode
, 
ªd
 
	gno
 'deçuÉ'ƒÁry 
	gexi¡s
,

427 
a
  
‹m¶©e
 
wl
 
be
 
	gu£d
.

430 
	gshow_Œaûbacks
 = 
True


432 
If
 
True
, 
uÃx³ùed
 
”rÜs
 
’couÁ”ed
 
duršg
 
»que¡
 
´oûssšg
 
wl


433 
šşude
 
a
 
Œaûback
 
š
 
the
 
»¥Ú£
 
	gbody
."""

435 
	gshow_mism©ched_·¿ms
 = 
True


437 
If
 
True
, 
mism©ched
 
·¿m‘”s
 
’couÁ”ed
 
duršg
 
PageHªdËr
 
švoÿtiÚ


438 
´oûssšg
 
wl
 
be
 
šşuded
 
š
 
the
 
»¥Ú£
 
	gbody
."""

440 
	gthrows
 = (
KeybßrdIÁ”ru±
, 
	gSy¡emEx™
, 
	gch”rypy
.
	gIÁ”ÇlRedœeù
)

443 
	gthrow_”rÜs
 = 
F®£


445 
If
 
True
, 
	gReque¡
.
run
 
wl
 
nÙ
 
Œ­
 
ªy
 
”rÜs
 (
exû±
 
HTTPRedœeù
 
ªd


446 
HTTPE¼Ü
, 
which
 
¬e
 
mÜe
 
´İ”ly
 
ÿÎed
 'exû±iÚs', 
nÙ
 
”rÜs
)."""

448 
	gşo£d
 = 
F®£


451 
¡age
 = 
NÚe


453 
A
 
¡ršg
 
cÚššg
 
the
 
¡age
 
»ached
 
š
h
»que¡
-
hªdlšg
 
´oûss
.

454 
This
 
is
 
u£ful
 
wh’
 
debuggšg
 
a
 
live
 
£rv”
 
w™h
 
hung
 
»que¡s
."""

456 
Çme¥aûs
 = 
_ıcÚfig
.
Name¥aûS‘
(

457 **{"hooks": 
hooks_Çme¥aû
,

458 "»que¡": 
»que¡_Çme¥aû
,

459 "»¥Ú£": 
»¥Ú£_Çme¥aû
,

460 "”rÜ_·ge": 
”rÜ_·ge_Çme¥aû
,

461 "toŞs": 
ch”rypy
.
toŞs
,

464 
def
 
__š™__
(
£lf
, 
loÿl_ho¡
, 
»mÙe_ho¡
, 
scheme
="http",

465 
£rv”_´ÙocŞ
="HTTP/1.1"):

468 
loÿl_ho¡
 
should
 
be
 
ª
 
h‰put
.
Ho¡
 
objeù
 
w™h
 
the
 
£rv”
 
šfo
.

469 
»mÙe_ho¡
 
should
 
be
 
ª
 
h‰put
.
Ho¡
 
objeù
 
w™h
 
the
 
ş›Á
 
šfo
.

470 
scheme
 
should
 
be
 
a
 
¡ršg
, 
	ge™h”
 "h‰p" 
	gÜ
 "https".

472 
	g£lf
.
	gloÿl
 = 
loÿl_ho¡


473 
£lf
.
»mÙe
 = 
»mÙe_ho¡


474 
£lf
.
scheme
 = scheme

475 
£lf
.
£rv”_´ÙocŞ
 = server_protocol

477 
£lf
.
şo£d
 = 
F®£


479 #Puˆ
a
 *
cİy
* 
of
 
the
 
şass
 
”rÜ_·ge
 
što
 
£lf
.

480 
£lf
.
”rÜ_·ge
 = s–f.”rÜ_·ge.
	$cİy
()

482 #Puˆ
a
 *
cİy
* 
of
 
the
 
şass
 
Çme¥aûs
 
što
 
£lf
.

483 
£lf
.
Çme¥aûs
 = s–f.Çme¥aûs.
	$cİy
()

485 
£lf
.
¡age
 = 
NÚe


487 
def
 
	$şo£
(
£lf
):

489 
nÙ
 
£lf
.
şo£d
:

490 
£lf
.
şo£d
 = 
True


491 
£lf
.
¡age
 = 'on_end_request'

492 
£lf
.
hooks
.
	`run
('on_end_request')

493 
£lf
.
¡age
 = 'close'

495 
def
 
	$run
(
£lf
, 
m‘hod
, 
·th
, 
qu”y_¡ršg
, 
»q_´ÙocŞ
, 
h—d”s
, 
rfe
):

496 
r
"""Processhe Request. (Core)

498 
m‘hod
, 
·th
, 
qu”y_¡ršg
, 
ªd
 
»q_´ÙocŞ
 
should
 
be
 
puÎed
 
dœeùly


499 
äom
 
the
 
Reque¡
-
	`Lše
 (
e
.
g
. "GET /path?key=val HTTP/1.0").

501 
·th


502 
This
 
should
 
be
 %
XX
-
unquÙed
, 
but
 
qu”y_¡ršg
 should 
nÙ
 be.

504 
Wh’
 
usšg
 
PythÚ
 2, 
they
 
bÙh
 
MUST
 
be
 
by‹
 
¡ršgs
,

505 
nÙ
 
unicode
 
¡ršgs
.

507 
Wh’
 
usšg
 
PythÚ
 3, 
they
 
bÙh
 
MUST
 
be
 
unicode
 
¡ršgs
,

508 
nÙ
 
by‹
 
¡ršgs
, 
ªd
 
´eã¿bly
‚Ù 
by‹s
 \
x00
-\
xFF


509 
disgui£d
 
as
 
unicode
.

511 
h—d”s


512 
A
 
li¡
 
	$of
 (
Çme
, 
v®ue
è
tu¶es
.

514 
rfe


515 
A
 
fe
-
like
 
objeù
 
cÚššg
 
the
 
HTTP
 
»que¡
 
’t™y
.

517 
Wh’
 
	$run
(è
is
 
dÚe
, 
the
 
»tuºed
 
objeù
 
should
 
have
 3 
©Œibu‹s
:

519 * 
¡©us
, 
e
.
g
. "200 OK"

520 * 
h—d”_li¡
, 
a
 
li¡
 
	$of
 (
Çme
, 
v®ue
è
tu¶es


521 * 
body
, 
ª
 
™”abË
 
y›ldšg
 
¡ršgs


523 
CÚsum”
 
	$code
 (
HTTP
 
£rv”s
è
should
 
th’
 
acûss
 
the£
 
»¥Ú£


524 
©Œibu‹s
 
to
 
bud
 
the
 
outbound
 
¡»am
.

527 
»¥Ú£
 = 
ch”rypy
.
£rvšg
.response

528 
£lf
.
¡age
 = 'run'

529 
Œy
:

530 
£lf
.
”rÜ_»¥Ú£
 = 
ch”rypy
.
	`HTTPE¼Ü
(500).
£t_»¥Ú£


532 
£lf
.
m‘hod
 = method

533 
·th
 =…©h 
Ü
 "/"

534 
£lf
.
qu”y_¡ršg
 = qu”y_¡ršg 
Ü
 ''

535 
£lf
.
·¿ms
 = {
	}
}

537 #Com·» 
»que¡
 
ªd
 
£rv”
 
HTTP
 
´ÙocŞ
 
v”siÚs
, 
š
 
our


538 #£rv” 
dÛs
 
nÙ
 
suµÜt
 
the
 
»que¡ed
 
´ÙocŞ
. 
Lim™
 
our
 
ouut


539 #tØ
mš
(
»q
, 
£rv”
). 
We
 
wªt
 
the
 
fŞlowšg
 
ouut
:

540 #»que¡ 
£rv”
 
aùu®
 
wr™‹n
 
suµÜ‹d
 
»¥Ú£


541 #´ÙocŞ 
´ÙocŞ
 
»¥Ú£
…rÙocŞ 
ã©u»
 
£t


546 #NÙiû 
th©
, 
š
 (
b
), 
the
 
»¥Ú£
 
wl
 
be
 "HTTP/1.1" 
ev’
 
though


547 #th
ş›Á
 
Úly
 
und”¡ªds
 1.0. 
RFC
 2616 10.5.6 
§ys
 
we
 
should


548 #Úly  505 
the
 
_majÜ_
 
v”siÚ
 
is
 
difã»Á
.

549 
	g½
 = (
»q_´ÙocŞ
[5]), (req_protocol[7])

550 
¥
 = (
£lf
.
£rv”_´ÙocŞ
[5]), (self.server_protocol[7])

551 
£lf
.
´ÙocŞ
 = 
	$mš
(
½
, 
¥
)

552 
»¥Ú£
.
h—d”s
.
´ÙocŞ
 = 
£lf
.protocol

554 #Rebud 
fœ¡
 
lše
 
of
 
the
 
	`»que¡
 (
e
.
g
. "GET /path HTTP/1.0").

555 
u¾
 = 
·th


556 
qu”y_¡ršg
:

557 
u¾
 +ğ'?' + 
qu”y_¡ršg


558 
£lf
.
»que¡_lše
 = '% % %s' % (
m‘hod
, 
u¾
, 
»q_´ÙocŞ
)

560 
£lf
.
h—d”_li¡
 = 
	$li¡
(
h—d”s
)

561 
£lf
.
h—d”s
 = 
h‰put
.
	$H—d”M­
()

563 
£lf
.
rfe
 =„file

564 
£lf
.
body
 = 
NÚe


566 
£lf
.
cook›
 = 
	$Sim¶eCook›
()

567 
£lf
.
hªdËr
 = 
NÚe


569 #·th_šfØ
should
 
be
 
the
 
·th
 
äom
he

570 #­°
	`roÙ
 (
süt_Çme
è
to
 
the
 
hªdËr
.

571 
£lf
.
süt_Çme
 = s–f.
­p
.script_name

572 
£lf
.
·th_šfo
 = 
pi
 = 
·th
[
	$Ën
(
£lf
.
süt_Çme
):]

574 
£lf
.
¡age
 = 'respond'

575 
£lf
.
	$»¥Úd
(
pi
)

577 
exû±
 
£lf
.
throws
:

578 
¿i£


579 
exû±
:

580 
£lf
.
throw_”rÜs
:

581 
¿i£


583 #Fau» 
š
 
£tup
, 
”rÜ
 
hªdËr
 
Ü
 
fš®ize
. 
By·ss
 
them
.

585 
ch”rypy
.
	$log
(
Œaûback
=
True
, 
£v”™y
=40)

586 
£lf
.
show_Œaûbacks
:

587 
body
 = 
	$fÜm©_exc
()

589 
body
 = ""

590 
r
 = 
	$b¬e_”rÜ
(
body
)

591 
»¥Ú£
.
ouut_¡©us
,„e¥Ú£.
h—d”_li¡
,„e¥Ú£.
body
 = 
r


593 
£lf
.
m‘hod
 == "HEAD":

594 #HEAD 
»que¡s
 
MUST
 
NOT
  
a
 
mes§ge
-
body
 
š
 
the
 
»¥Ú£
.

595 
»¥Ú£
.
body
 = []

597 
Œy
:

598 
ch”rypy
.
log
.
	$acûss
()

599 
exû±
:

600 
ch”rypy
.
log
.
	$”rÜ
(
Œaûback
=
True
)

602 
»¥Ú£
.
timed_out
:

603 
¿i£
 
ch”rypy
.
	$TimeoutE¼Ü
()

605  
»¥Ú£


607 #Uncomm’ˆ
¡age
 
debuggšg


608 #¡agğ
	`´İ”ty
(
Ïmbda
 
£lf
: s–f.
_¡age
,†ambd¨£lf, 
v
: 
	`´št
(v))

610 
def
 
	$»¥Úd
(
£lf
, 
·th_šfo
):

612 
»¥Ú£
 = 
ch”rypy
.
£rvšg
.response

613 
Œy
:

614 
Œy
:

615 
Œy
:

616 
£lf
.
­p
 
is
 
NÚe
:

617 
¿i£
 
ch”rypy
.
	$NÙFound
()

619 #G‘ 
the
 'Ho¡' 
h—d”
, 
so
 
we
 
ÿn
 
HTTPRedœeù
 
´İ”ly
.

620 
£lf
.
¡age
 = 'process_headers'

621 
£lf
.
	$´oûss_h—d”s
()

623 #Mak
a
 
cİy
 
of
 
the
 
şass
 
hooks


624 
£lf
.
hooks
 = s–f.
__şass__
.hooks.
	$cİy
()

625 
£lf
.
toŞm­s
 = {
	}
}

627 
£lf
.
¡age
 = 'get_resource'

628 
£lf
.
	$g‘_»sourû
(
·th_šfo
)

630 
£lf
.
body
 = 
_ı»qbody
.
	$Reque¡Body
(

631 
£lf
.
rfe
, s–f.
h—d”s
, 
»que¡_·¿ms
=£lf.
·¿ms
)

633 
£lf
.
	$Çme¥aûs
(
£lf
.
cÚfig
)

635 
£lf
.
¡age
 = 'on_start_resource'

636 
£lf
.
hooks
.
	`run
('on_start_resource')

638 #P¬£ 
the
 
qu”y¡ršg


639 
£lf
.
¡age
 = 'process_query_string'

640 
£lf
.
	$´oûss_qu”y_¡ršg
()

642 #Proûs 
the
 
body


643 
£lf
.
´oûss_»que¡_body
:

644 
£lf
.
m‘hod
 
nÙ
 
š
 s–f.
m‘hods_w™h_bod›s
:

645 
£lf
.
´oûss_»que¡_body
 = 
F®£


646 
£lf
.
¡age
 = 'before_request_body'

647 
£lf
.
hooks
.
	`run
('before_request_body')

648 
£lf
.
´oûss_»que¡_body
:

649 
£lf
.
body
.
	$´oûss
()

651 #RuÀ
the
 
hªdËr


652 
£lf
.
¡age
 = 'before_handler'

653 
£lf
.
hooks
.
	`run
('before_handler')

654 
£lf
.
hªdËr
:

655 
£lf
.
¡age
 = 'handler'

656 
»¥Ú£
.
body
 = 
£lf
.
	$hªdËr
()

659 
£lf
.
¡age
 = 'before_finalize'

660 
£lf
.
hooks
.
	`run
('before_finalize')

661 
»¥Ú£
.
	$fš®ize
()

662 
	$exû±
 (
ch”rypy
.
HTTPRedœeù
, ch”rypy.
HTTPE¼Ü
):

663 
š¡
 = 
sys
.
	`exc_šfo
()[1]

664 
š¡
.
	$£t_»¥Ú£
()

665 
£lf
.
¡age
 = 'before_finalize (HTTPError)'

666 
£lf
.
hooks
.
	`run
('before_finalize')

667 
»¥Ú£
.
	$fš®ize
()

668 
fš®ly
:

669 
£lf
.
¡age
 = 'on_end_resource'

670 
£lf
.
hooks
.
	`run
('on_end_resource')

671 
exû±
 
£lf
.
throws
:

672 
¿i£


673 
exû±
:

674 
£lf
.
throw_”rÜs
:

675 
¿i£


676 
£lf
.
	$hªdË_”rÜ
()

678 
def
 
	$´oûss_qu”y_¡ršg
(
£lf
):

680 
Œy
:

681 
p
 = 
h‰put
.
	$·r£_qu”y_¡ršg
(

682 
£lf
.
qu”y_¡ršg
, 
’codšg
=£lf.
qu”y_¡ršg_’codšg
)

683 
exû±
 
UnicodeDecodeE¼Ü
:

684 
¿i£
 
ch”rypy
.
	`HTTPE¼Ü
(

687 
£lf
.
qu”y_¡ršg_’codšg
)

689 #PythÚ 2 
Úly
: 
keywÜd
 
¬gum’ts
 
mu¡
 
be
 
by‹
 
	`¡ršgs
 (
ty³
 'str').

690 
nÙ
 
py3k
:

691 
key
, 
v®ue
 
š
 
p
.
	$™ems
():

692 
	$isš¡ªû
(
key
, 
unicode
):

693 
d–
 
p
[
key
]

694 
p
[
key
.
	`’code
(
£lf
.
qu”y_¡ršg_’codšg
)] = 
v®ue


695 
£lf
.
·¿ms
.
	$upd©e
(
p
)

697 
def
 
	$´oûss_h—d”s
(
£lf
):

699 #Proûs 
the
 
h—d”s
 
što
 
£lf
.headers

700 
h—d”s
 = 
£lf
.headers

701 
Çme
, 
v®ue
 
š
 
£lf
.
h—d”_li¡
:

702 #C®È
	`t™Ë
(è
	`now
 (
ªd
 
u£
 
diù
.
	`__m‘hod__
(
h—d”s
))

703 #sØ
t™Ë
 
dÛ¢
't haveo be calledwice.

704 
Çme
 =‚ame.
	$t™Ë
()

705 
v®ue
 = v®ue.
	$¡r
()

707 #W¬nšg: 
th”e
 
is
 
mÜe
 
thª
 
Úe
 
h—d”
 
’Œy
 
	`cook›s
 (
AFAIK
,

708 #Úly 
KÚqu”Ü
 
dÛs
 
th©
), 
Úly
 
the
 
Ï¡
 
Úe
 
wl
 
»maš
 
š
 
h—d”s


709 #(
but
 
they
 
wl
 
be
 
cÜ»ùly
 
¡Üed
 
š
 
»que¡
.
cook›
).

710 "=?" 
š
 
v®ue
:

711 
diù
.
	`__£t™em__
(
h—d”s
, 
Çme
, 
h‰put
.
	$decode_TEXT
(
v®ue
))

713 
diù
.
	$__£t™em__
(
h—d”s
, 
Çme
, 
v®ue
)

715 #HªdË 
cook›s
 
difã»Ály
 
beÿu£
 
Ú
 
KÚqu”Ü
, 
muÉË


716 #cook› 
come
 
Ú
 
difã»Á
 
lšes
 
w™h
 
the
 
§me
 
key


717 
Çme
 == 'Cookie':

718 
Œy
:

719 
£lf
.
cook›
.
	$lßd
(
v®ue
)

720 
exû±
 
Cook›E¼Ü
:

721 
msg
 = "IÎeg® cook›‚am%s" % 
v®ue
.
	`¥l™
('=')[0]

722 
¿i£
 
ch”rypy
.
	$HTTPE¼Ü
(400, 
msg
)

724 
nÙ
 
diù
.
	`__cÚšs__
(
h—d”s
, 'Host'):

725 #AÎ 
IÁ”Ãt
-
ba£d
 
HTTP
/1.1 
£rv”s
 
MUST
 
»¥Úd
 
w™h
 
a
 400

726 #(
Bad
 
Reque¡
è
¡©us
 
code
 
to
 
ªy
 
HTTP
/1.1 
»que¡
 
mes§ge


727 #which 
Ïcks
 
a
 
Ho¡
 
h—d”
 
f›ld
.

728 
£lf
.
´ÙocŞ
 >= (1, 1):

729 
msg
 = "HTTP/1.1„equires‡ 'Host'„equest header."

730 
¿i£
 
ch”rypy
.
	$HTTPE¼Ü
(400, 
msg
)

731 
ho¡
 = 
diù
.
	`g‘
(
h—d”s
, 'Host')

732 
nÙ
 
ho¡
:

733 
ho¡
 = 
£lf
.
loÿl
.
Çme
 
Ü
 s–f.loÿl.



734 
£lf
.
ba£
 = "%s://%s" % (£lf.
scheme
, 
ho¡
)

736 
def
 
	$g‘_»sourû
(
£lf
, 
·th
):

738 #Fœ¡, 
£e
 
th”e
 
is
 
a
 
cu¡om
 
di¥©ch
 
©
 
this
 
URI
. 
Cu¡om


739 #di¥©ch” 
ÿn
 
Úly
 
be
 
¥ecif›d
 
š
 
­p
.
cÚfig
, 
nÙ
 iÀ
_ı_cÚfig


740 #(
sšû
 
cu¡om
 
di¥©ch”s
 
may
 
nÙ
 
ev’
 
have
 
ª
 
­p
.
roÙ
).

741 
di¥©ch
 = 
£lf
.
­p
.
	`fšd_cÚfig
(
·th
, "request.dispatch", self.dispatch)

743 #di¥©ch(è
should
 
£t
 
£lf
.
hªdËr
 
ªd
 s–f.
cÚfig


744 
	$di¥©ch
(
·th
)

746 
def
 
	$hªdË_”rÜ
(
£lf
):

748 
Œy
:

749 
£lf
.
hooks
.
	`run
("before_error_response")

750 
£lf
.
”rÜ_»¥Ú£
:

751 
£lf
.
	$”rÜ_»¥Ú£
()

752 
£lf
.
hooks
.
	`run
("after_error_response")

753 
ch”rypy
.
£rvšg
.
»¥Ú£
.
	$fš®ize
()

754 
exû±
 
ch”rypy
.
HTTPRedœeù
:

755 
š¡
 = 
sys
.
	`exc_šfo
()[1]

756 
š¡
.
	$£t_»¥Ú£
()

757 
ch”rypy
.
£rvšg
.
»¥Ú£
.
	$fš®ize
()

759 #------------------------- 
Prİ”t›s
 ------------------------- #


760 
def
 
	$_g‘_body_·¿ms
(
£lf
):

761 
w¬nšgs
.
	`w¬n
(

764 
D•»ÿtiÚW¬nšg


766  
£lf
.
body
.
·¿ms


767 
body_·¿ms
 = 
	`´İ”ty
(
_g‘_body_·¿ms
,

768 
doc
= """

769 
If
 
the
 
»que¡
 
CÚ‹Á
-
Ty³
 
is
 '­¶iÿtiÚ/x-www-fÜm-u¾’coded' 
Ü


770 
muÉ¬t
, 
this
 
wl
 
be
 
a
 
diù
 
of
 
the
 
·¿ms
 
puÎed
 
äom
h
’t™y


771 
body
; 
th©
 
is
, 
™
 
wl
 
be
 
the
 
pÜtiÚ
 
of
 
»que¡
.
·¿ms
h© 
come


772 
äom
 
the
 
mes§ge
 
	`body
 (
som‘imes
 
ÿÎed
 "POST…¬ams", 
®though
 
they


773 
ÿn
 
be
 
£Á
 
w™h
 
v¬ious
 
HTTP
 
m‘hod
 
v”bs
). 
This
 
v®ue
 
is
 
£t
 
b‘w“n


774 
the
 'befÜe_»que¡_body' 
ªd
 'befÜe_hªdËr' 
	`hooks
 (
assumšg
 
th©


775 
´oûss_»que¡_body
 
is
 
True
).

777 
D•»ÿ‹d
 
š
 3.2, 
wl
 
be
 
»moved
 3.3 iÀ
çvÜ
 
of


778 :
©Œ
:`
»que¡
.
body
.
·¿ms
<
ch”rypy
.
_ı»que¡
.
Reque¡Body
.params>`.""")

781 
şass
 
	$Re¥Ú£Body
(
objeù
):

784 
py3k
:

785 
unicode_”r
 = ("Page handlers MUST„eturn bytes. Useools.encode "

788 
def
 
	$__g‘__
(
£lf
, 
obj
, 
objşass
=
NÚe
):

789 
obj
 
is
 
NÚe
:

790 #Wh’ 
ÿÎšg
 
Ú
 
the
 
şass
 
š¡—d
 
of
 
ª
 
š¡ªû
...

791  
£lf


793  
obj
.
_body


795 
def
 
	$__£t__
(
£lf
, 
obj
, 
v®ue
):

796 #CÚv”ˆ
the
 
giv’
 
v®ue
 
to
 
ª
 
™”abË
 
objeù
.

797 
py3k
 
ªd
 
	$isš¡ªû
(
v®ue
, 
¡r
):

798 
¿i£
 
	$V®ueE¼Ü
(
£lf
.
unicode_”r
)

800 
	$isš¡ªû
(
v®ue
, 
ba£¡ršg
):

801 #¡ršg 
g‘
 
w¿µed
 
š
 
a
 
li¡
 
beÿu£
 
™”©šg
 
ov”
‡ 
sšgË


802 #™em 
li¡
 
is
 
much
 
ç¡”
 
thª
 
™”©šg
 
ov”
 
ev”y
 
ch¬aù”


803 #š 
a
 
¡ršg
.

804 
v®ue
:

805 
v®ue
 = [value]

807 #[''] 
dÛ¢
'tƒvaluateo False, so„eplace it with [].

808 
v®ue
 = []

809 
–if
 
py3k
 
ªd
 
	$isš¡ªû
(
v®ue
, 
li¡
):

810 #ev”y 
™em
 
š
 
a
 
li¡
 
mu¡
 
be
 
by‹s
...

811 
i
, 
™em
 
š
 
	$’um”©e
(
v®ue
):

812 
	$isš¡ªû
(
™em
, 
¡r
):

813 
¿i£
 
	$V®ueE¼Ü
(
£lf
.
unicode_”r
)

815 #1000 
times
 
as
 as, 
§y
, 
	`isš¡ªû
(
v®ue
, 
¡r
)

816 
–if
 
	`ha§‰r
(
v®ue
, 'read'):

817 
v®ue
 = 
	$fe_g’”©Ü
(
v®ue
)

818 
–if
 
v®ue
 
is
 
NÚe
:

819 
v®ue
 = []

820 
obj
.
_body
 = 
v®ue


823 
şass
 
	$Re¥Ú£
(
objeù
):

826 
¡©us
 = ""

829 
h—d”_li¡
 = []

831 
A
 
li¡
 
of
 
the
 
HTTP
 
»¥Ú£
 
h—d”s
 
	$as
 (
Çme
, 
v®ue
è
tu¶es
.

832 
In
 
g’”®
, 
you
 
should
 
u£
 
»¥Ú£
.
	$h—d”s
 (
a
 
diù
è
š¡—d
. 
This


833 
©Œibu‹
 
is
 
g’”©ed
 
äom
 
»¥Ú£
.
h—d”s
 
ªd
 i 
nÙ
 
v®id
 
uÁ


834 
aá”
 
the
 
fš®ize
 
pha£
."""

836 
h—d”s
 = 
h‰put
.
	`H—d”M­
()

838 
A
 
diù
-
like
 
objeù
 
cÚššg
 
the
 
»¥Ú£
 
h—d”s
. 
Keys
 
¬e
 
h—d”


839 
	`Çmes
 (
š
 
T™Ë
-
Ca£
 
fÜm©
); 
howev”
, 
you
 
may
 
g‘
 
ªd
 
£t
 
them
 in

840 
a
 -
š£ns™ive
 
mªÃr
. 
Th©
 
is
, 
h—d”s
['CÚ‹Á-Ty³'] 
ªd


841 
h—d”s
['cÚ‹Á-ty³'] 
»ãr
 
to
 
the
 
§me
 
v®ue
. 
V®ues
 
¬e
 
h—d”


842 
	`v®ues
 (
decoded
 
accÜdšg
 
to
 :
rfc
:`2047` 
Ãûs§ry
).

844 .. 
£—lso
:: 
şas£s
 :
şass
:`
H—d”M­
`, :şass:`
H—d”EËm’t
`

847 
cook›
 = 
	`Sim¶eCook›
()

850 
body
 = 
	`Re¥Ú£Body
()

853 
time
 = 
NÚe


856 
timeout
 = 300

859 
timed_out
 = 
F®£


861 
FÏg
 
to
 
šdiÿ‹
 
the
 
»¥Ú£
 
should
 
be
 
abÜ‹d
, 
beÿu£
 
™
 
has


862 
exûeded
 
™s
 
timeout
."""

864 
¡»am
 = 
F®£


867 
def
 
	$__š™__
(
£lf
):

868 
£lf
.
¡©us
 = 
NÚe


869 
£lf
.
h—d”_li¡
 = 
NÚe


870 
£lf
.
_body
 = []

871 
£lf
.
time
 =ime.
	$time
()

873 
£lf
.
h—d”s
 = 
h‰put
.
	$H—d”M­
()

874 #Sšû 
we
 
know
 
®l
 
our
 
keys
 
¬e
 
t™Ëd
 
¡ršgs
, w
ÿn


875 #by·s 
H—d”M­
.
upd©e
 
ªd
 
g‘
 
a
 
big
 
¥“d
 
boo¡
.

876 
diù
.
	`upd©e
(
£lf
.
h—d”s
, {

878 "S”v”": "Ch”ryPy/" + 
ch”rypy
.
__v”siÚ__
,

879 "D©e": 
h‰put
.
	`HTTPD©e
(
£lf
.
time
),

880 
	}
})

881 
	g£lf
.
	gcook›
 = 
	$Sim¶eCook›
()

883 
def
 
	$cŞÏp£_body
(
£lf
):

885 
	$isš¡ªû
(
£lf
.
body
, 
ba£¡ršg
):

886  
£lf
.
body


888 
Ãwbody
 = []

889 
chunk
 
š
 
£lf
.
body
:

890 
py3k
 
ªd
 
nÙ
 
	$isš¡ªû
(
chunk
, 
by‹s
):

891 
¿i£
 
	`Ty³E¼Ü
("Chunk % i nÙ oàty³ 'by‹s'." % 
	$»´
(
chunk
))

892 
Ãwbody
.
	$­³nd
(
chunk
)

893 
Ãwbody
 = 
	`Áob
('').
	$još
(
Ãwbody
)

895 
£lf
.
body
 = 
Ãwbody


896  
Ãwbody


898 
def
 
	$fš®ize
(
£lf
):

900 
Œy
:

901 
code
, 
»asÚ
, 
_
 = 
h‰put
.
	$v®id_¡©us
(
£lf
.
¡©us
)

902 
exû±
 
V®ueE¼Ü
:

903 
¿i£
 
ch”rypy
.
	`HTTPE¼Ü
(500, 
sys
.
	`exc_šfo
()[1].
¬gs
[0])

905 
h—d”s
 = 
£lf
.headers

907 
£lf
.
¡©us
 = "% %s" % (
code
, 
»asÚ
)

908 
£lf
.
ouut_¡©us
 = 
	`Áob
(
	`¡r
(
code
), 'ascii'è+‚tob(" "è+ 
h—d”s
.
	$’code
(
»asÚ
)

910 
£lf
.
¡»am
:

911 #Th
upshÙ
: 
wsgi£rv”
 
wl
 
chunk
 
the
 
»¥Ú£
 

912 #you 
pİ
 
CÚ‹Á
-
	`L’gth
 (
Ü
 
£t
 
™
 
ex¶ic™ly
 
to
 
NÚe
).

913 #NÙ
th©
 
lib
.
£ts
 
C
-
L
 
to
 
the
 
fe
's st_size.

914 
diù
.
	`g‘
(
h—d”s
, 'CÚ‹Á-L’gth'è
is
 
NÚe
:

915 
diù
.
	`pİ
(
h—d”s
, 'CÚ‹Á-L’gth', 
NÚe
)

916 
–if
 
code
 < 200 
Ü
 cod
	$š
 (204, 205, 304):

917 #"
AÎ
 1xx (
šfÜm©iÚ®
), 204 (
no
 
cÚ‹Á
),

918 #ªd 304 (
nÙ
 
modif›d
è
»¥Ú£s
 
MUST
 
NOT


919 #šşud
a
 
mes§ge
-
body
."

920 
diù
.
	`pİ
(
h—d”s
, 'CÚ‹Á-L’gth', 
NÚe
)

921 
£lf
.
body
 = 
	`Áob
("")

923 #Re¥Ú£ 
which
 
¬e
 
nÙ
 
¡»amed
 
should
 
have
 
a
 
CÚ‹Á
-
L’gth
,

924 #buˆ
®low
 
u£r
 
code
 
to
 
£t
 
CÚ‹Á
-
L’gth
 
desœed
.

925 
diù
.
	`g‘
(
h—d”s
, 'CÚ‹Á-L’gth'è
is
 
NÚe
:

926 
cÚ‹Á
 = 
£lf
.
	$cŞÏp£_body
()

927 
diù
.
	`__£t™em__
(
h—d”s
, 'CÚ‹Á-L’gth', 
	$Ën
(
cÚ‹Á
))

929 #T¿nsfÜm 
our
 
h—d”
 
diù
 
što
 
a
 
li¡
 
of
 
tu¶es
.

930 
£lf
.
h—d”_li¡
 = 
h
 = 
h—d”s
.
	$ouut
()

932 
cook›
 = 
£lf
.cook›.
	$ouut
()

933 
cook›
:

934 
lše
 
š
 
cook›
.
	`¥l™
("\n"):

935 
lše
.
	`’dsw™h
("\r"):

936 #PythÚ 2.4 
em™s
 
cook›s
 
jošed
 
by
 
LF
 
but
 2.5+ by 
CRLF
.

937 
lše
 =†ine[:-1]

938 
Çme
, 
v®ue
 = 
lše
.
	`¥l™
(": ", 1)

939 
	$isš¡ªû
(
Çme
, 
unicode¡r
):

940 
Çme
 =‚ame.
	`’code
("ISO-8859-1")

941 
	$isš¡ªû
(
v®ue
, 
unicode¡r
):

942 
v®ue
 = 
h—d”s
.
	$’code
(
v®ue
)

943 
h
.
	`­³nd
((
Çme
, 
v®ue
))

945 
def
 
	$check_timeout
(
£lf
):

948 
This
 
pu½o£fuÎy
 
£ts
 
a
 
æag
, 
¿th”
 
thª
 
¿isšg
 
ª
 
”rÜ
,

949 
so
 
th©
 
a
 
mÚ™Ü
 
th»ad
 
ÿn
 
š‹¼u±
 
the
 
Re¥Ú£
hread.

951 
time
.
	`time
(è> 
£lf
.tim+ s–f.
timeout
:

952 
£lf
.
timed_out
 = 
True


	@trunk/objs/CherryPy-3.2.4/cherrypy/_cpserver.py

3 
impÜt
 
w¬nšgs


5 
impÜt
 
ch”rypy


6 
äom
 
	gch”rypy
.
lib
 
impÜt
 
©Œibu‹s


7 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
	gba£¡ršg
, 
	gpy3k


9 #W
impÜt
 * 
beÿu£
 
we
 
wªt
 
to
 
expÜt
 
check_pÜt


10 #‘ 
®
 
as
 
©Œibu‹s
 
of
 
this
 
moduË
.

11 
äom
 
	gch”rypy
.
	g´oûss
.
£rv”s
 
impÜt
 *

14 
şass
 
	$S”v”
(
S”v”Ad­‹r
):

17 
You
 
ÿn
 
£t
 
	$©Œibu‹s
 (
like
 
sock‘_ho¡
 
ªd
 
sock‘_pÜt
)

18 
Ú
 *
this
* 
	`objeù
 (
which
 
is
 
´obably
 
ch”rypy
.
£rv”
), 
ªd
 
ÿÎ


19 
quick¡¬t
. 
FÜ
 
exam¶e
::

21 
ch”rypy
.
£rv”
.
sock‘_pÜt
 = 80

22 
ch”rypy
.
	`quick¡¬t
()

25 
sock‘_pÜt
 = 8080

28 
_sock‘_ho¡
 = '127.0.0.1'

29 
def
 
	$_g‘_sock‘_ho¡
(
£lf
):

30  
£lf
.
_sock‘_ho¡


31 
def
 
	$_£t_sock‘_ho¡
(
£lf
, 
v®ue
):

32 
v®ue
 == '':

33 
¿i£
 
	`V®ueE¼Ü
("Theƒmpty string ('') is‚ot‡n‡llowed value. "

36 
£lf
.
_sock‘_ho¡
 = 
v®ue


37 
sock‘_ho¡
 = 
	`´İ”ty
(
_g‘_sock‘_ho¡
, 
_£t_sock‘_ho¡
,

38 
doc
="""The hostname or IP‡ddress on whicho†isten for connections.

40 
Ho¡
 
v®ues
 
may
 
be
 
ªy
 
IPv4
 
Ü
 
IPv6
 
add»ss
, o¸ªy 
v®id
 
ho¡Çme
.

41 
The
 
¡ršg
 'loÿlho¡' 
is
 
a
 
synÚym
 '127.0.0.1' (
Ü
 '::1', 

42 
your
 
ho¡s
 
fe
 
´eãrs
 
IPv6
). 
The
 
¡ršg
 '0.0.0.0' 
is
 
a
 
¥ecŸl


43 
IPv4
 
’Œy
 
m—nšg
 "ªy‡ùivš‹rçû" (
INADDR_ANY
), 
ªd
 '::'

44 
is
 
the
 
sim¬
 
IN6ADDR_ANY
 
IPv6
. 
The
 
em±y
 
¡ršg
 
Ü
 
NÚe
 
¬e


45 
nÙ
 
®lowed
.""")

47 
sock‘_fe
 = 
NÚe


50 
Wh’
 
this
 
İtiÚ
 
is
 
nÙ
 
NÚe
, 
the
 `
sock‘_ho¡
` 
ªd
 `
sock‘_pÜt
` 
İtiÚs


51 
¬e
 
ignÜed
."""

53 
sock‘_queue_size
 = 5

55 
of
 
queued
 
	`cÚÃùiÚs
 ( 5)."""

57 
sock‘_timeout
 = 10

60 
shutdown_timeout
 = 5

63 
´ÙocŞ_v”siÚ
 = 'HTTP/1.1'

65 
exam¶e
, "HTTP/1.1" (
the
 ). 
D•’dšg
 
Ú
h
HTTP
 
£rv”
 
u£d
,

66 
this
 
should
 
®so
 
lim™
 
the
 
suµÜ‹d
 
ã©u»s
 
u£d
 
š
h
»¥Ú£
."""

68 
th»ad_poŞ
 = 10

71 
th»ad_poŞ_max
 = -1

74 
max_»que¡_h—d”_size
 = 500 * 1024

76 
the
 
HTTP
 
£rv”
 
should
  "413 Request Entity Too Large"."""

78 
max_»que¡_body_size
 = 100 * 1024 * 1024

80 
the
 
HTTP
 
£rv”
 
should
  "413 Request Entity Too Large"."""

82 
š¡ªû
 = 
NÚe


84 
CPWSGIS”v”
è
which
 
ch”rypy
.
£rv”
 
wl
 
cÚŒŞ
. 
U£
 
this
 
wh’
 
you
 
Ãed


85 
mÜe
 
cÚŒŞ
 
ov”
 
objeù
 
š¡ªtŸtiÚ
 
thª
 
is
 
avaabË
 
š
 
the
 
v¬ious


86 
cÚfigu¿tiÚ
 
İtiÚs
."""

88 
s¦_cÚ‹xt
 = 
NÚe


91 
s¦_û¹ifiÿ‹
 = 
NÚe


94 
s¦_û¹ifiÿ‹_chaš
 = 
NÚe


96 
CÚ‹xt
.
lßd_v”ify_loÿtiÚs
."""

98 
s¦_´iv©e_key
 = 
NÚe


101 
py3k
:

102 
s¦_moduË
 = 'builtin'

104 
WSGI
 
£rv”
. 
Butš
 
İtiÚs
 
¬e
: 'butš' (
to
 
u£
 
the
 
SSL
 
lib¿ry
 
but


105 
što
 
»ûÁ
 
v”siÚs
 
of
 
PythÚ
). 
You
 
may
 
®so
 
your


106 
own
 
şas£s
 
š
 
the
 
wsgi£rv”
.
s¦_ad­‹rs
 
diù
."""

108 
s¦_moduË
 = 'pyopenssl'

110 
WSGI
 
£rv”
. 
Butš
 
İtiÚs
 
¬e
 'butš' (
to
 
u£
 
the
 
SSL
 
lib¿ry
 
but


111 
što
 
»ûÁ
 
v”siÚs
 
of
 
PythÚ
è
ªd
 'pyİ’s¦' (
to
 
u£
 
the
 
PyO³nSSL


112 
´ojeù
, 
which
 
you
 
mu¡
 
š¡®l
 
£·¿‹ly
). 
You
 
may
 
®so
 
your


113 
own
 
şas£s
 
š
 
the
 
wsgi£rv”
.
s¦_ad­‹rs
 
diù
."""

115 
¡©i¡ics
 = 
F®£


118 
nod–ay
 = 
True


121 
wsgi_v”siÚ
 = (1, 0)

123 
The
 
´ovided
 
İtiÚs
 
	`¬e
 (1, 0è[
which
 
šşudes
 
suµÜt
 
PEP
 3333,

124 
which
 
deş¬es
 
™
 
cov”s
 
WSGI
 
v”siÚ
 1.0.1 
but
 
¡l
 
mªd©es
 
the


125 
wsgi
.
	`v”siÚ
 (1, 0)] 
	`ªd
 ('u', 0), 
ª
 
ex³rim’l
 
unicode
 
v”siÚ
.

126 
You
 
may
 
ü—‹
 
ªd
 
your
 
own
 
ex³rim’l
 
v”siÚs
 
of
 
the
 
WSGI


127 
´ÙocŞ
 
by
 
addšg
 
cu¡om
 
şas£s
 
to
 
the
 
wsgi£rv”
.
wsgi_g©eways
 
diù
."""

129 
def
 
	$__š™__
(
£lf
):

130 
£lf
.
bus
 = 
ch”rypy
.
’gše


131 
£lf
.
h‰p£rv”
 = 
NÚe


132 
£lf
.
š‹¼u±
 = 
NÚe


133 
£lf
.
ruÂšg
 = 
F®£


135 
def
 
	$h‰p£rv”_äom_£lf
(
£lf
, 
h‰p£rv”
=
NÚe
):

137 
h‰p£rv”
 
is
 
NÚe
:

138 
h‰p£rv”
 = 
£lf
.
š¡ªû


139 
h‰p£rv”
 
is
 
NÚe
:

140 
äom
 
ch”rypy
 
impÜt
 
_ıwsgi_£rv”


141 
h‰p£rv”
 = 
_ıwsgi_£rv”
.
	$CPWSGIS”v”
(
£lf
)

142 
	$isš¡ªû
(
h‰p£rv”
, 
ba£¡ršg
):

143 #I 
ªyÚe
 
usšg
 
this
? 
Cª
 
I
 
add
 
ª
 
¬g
?

144 
h‰p£rv”
 = 
	$©Œibu‹s
(
h‰p£rv”
)(
£lf
)

145  
h‰p£rv”
, 
£lf
.
bšd_addr


147 
def
 
	$¡¬t
(
£lf
):

149 
nÙ
 
£lf
.
h‰p£rv”
:

150 
£lf
.
h‰p£rv”
, s–f.
bšd_addr
 = s–f.
	$h‰p£rv”_äom_£lf
()

151 
S”v”Ad­‹r
.
	$¡¬t
(
£lf
)

152 
¡¬t
.
´iÜ™y
 = 75

154 
def
 
	$_g‘_bšd_addr
(
£lf
):

155 
£lf
.
sock‘_fe
:

156  
£lf
.
sock‘_fe


157 
£lf
.
sock‘_ho¡
 
is
 
NÚe
 
ªd
 s–f.
sock‘_pÜt
 is None:

158  
NÚe


159  (
£lf
.
sock‘_ho¡
, s–f.
sock‘_pÜt
)

160 
def
 
	$_£t_bšd_addr
(
£lf
, 
v®ue
):

161 
v®ue
 
is
 
NÚe
:

162 
£lf
.
sock‘_fe
 = 
NÚe


163 
£lf
.
sock‘_ho¡
 = 
NÚe


164 
£lf
.
sock‘_pÜt
 = 
NÚe


165 
–if
 
	$isš¡ªû
(
v®ue
, 
ba£¡ršg
):

166 
£lf
.
sock‘_fe
 = 
v®ue


167 
£lf
.
sock‘_ho¡
 = 
NÚe


168 
£lf
.
sock‘_pÜt
 = 
NÚe


170 
Œy
:

171 
£lf
.
sock‘_ho¡
, s–f.
sock‘_pÜt
 = 
v®ue


172 
£lf
.
sock‘_fe
 = 
NÚe


173 
exû±
 
V®ueE¼Ü
:

174 
¿i£
 
	`V®ueE¼Ü
("bind_addr must be‡ (host,…ort)uple "

176 "domaš sock‘s),‚Ù %r" % 
v®ue
)

177 
bšd_addr
 = 
	`´İ”ty
(
_g‘_bšd_addr
, 
_£t_bšd_addr
,

178 
doc
='A (host,…ort)uple for TCP sockets or‡ str for Unix domain sockets.')

180 
def
 
	$ba£
(
£lf
):

182 
£lf
.
sock‘_fe
:

183  
£lf
.
sock‘_fe


185 
ho¡
 = 
£lf
.
sock‘_ho¡


186 
ho¡
 
	`š
 ('0.0.0.0', '::'):

187 #0.0.0.0 
is
 
INADDR_ANY
 
ªd
 :: i 
IN6ADDR_ANY
.

188 #Look 
up
 
the
 
ho¡
 
Çme
, 
which
 
should
 
be
he

189 #§ã¡ 
thšg
 
to
 
¥™
 
out
 
š
 
a
 
URL
.

190 
impÜt
 
sock‘


191 
ho¡
 = 
sock‘
.
	$g‘ho¡Çme
()

193 
pÜt
 = 
£lf
.
sock‘_pÜt


195 
£lf
.
s¦_û¹ifiÿ‹
:

196 
scheme
 = "https"

197 
pÜt
 != 443:

198 
ho¡
 +ğ":%s" % 
pÜt


200 
scheme
 = "http"

201 
pÜt
 != 80:

202 
ho¡
 +ğ":%s" % 
pÜt


204  "%s://%s" % (
scheme
, 
ho¡
)

	@trunk/objs/CherryPy-3.2.4/cherrypy/_cpthreadinglocal.py

1 #Thi 
is
 
a
 
backpÜt
 
of
 
PythÚ
-2.4'shreading.local() implementation

5 (
NÙe
 
th©
 
this
 
moduË
 
´ovides
 
a
 
PythÚ
 
v”siÚ
 
of
 
th»ad


6 
	gth»adšg
.
loÿl
 
	gşass
. 
D•’dšg
 
Ú
 
the
 
v”siÚ
 
of
 
PythÚ
 
	gyou
're

7 
	gusšg
, 
th”e
 
may
 
be
 
a
 
ç¡”
 
Úe
 
	gavaabË
. 
You
 
should
 
®ways
 
impÜt


8 
the
 
loÿl
 
şass
 
äom
 
	gth»adšg
.)

10 
	gTh»ad
-
loÿl
 
objeùs
 
suµÜt
 
the
 
mªagem’t
 
of
 
	gth»ad
-loÿÈ
	gd©a
.

11 
If
 
you
 
have
 
d©a
 
th©
 you 
wªt
 
to
 
be
 
loÿl
Ø
a
 
	gth»ad
, 
sim¶y
 
ü—‹


12 
a
 
	gth»ad
-
loÿl
 
objeù
 
ªd
 
u£
 
™s
 
	g©Œibu‹s
:

14 >>> 
myd©a
 = 
loÿl
()

15 >>> 
myd©a
.
numb”
 = 42

16 >>> 
myd©a
.
numb”


19 
You
 
ÿn
 
®so
 
acûss
 
the
 
loÿl
-
objeù
's dictionary:

21 >>> 
myd©a
.
__diù__


23 >>> 
myd©a
.
__diù__
.
£tdeçuÉ
('widgets', [])

25 >>> 
	gmyd©a
.
	gwidg‘s


28 
	gWh©
's important‡bouthread-local objects ishatheir data‡re

29 
loÿl
 
to
 
a
 
	gth»ad
. 
If
 
we
 
acûss
 
the
 
d©a
 
š
‡ 
difã»Á
hread:

31 >>> 
log
 = []

32 >>> 
def
 
	$f
():

33 ... 
™ems
 = 
myd©a
.
__diù__
.
	`™ems
()

34 ... 
™ems
.
	`sÜt
()

35 ... 
log
.
	`­³nd
(
™ems
)

36 ... 
myd©a
.
numb”
 = 11

37 ... 
log
.
	`­³nd
(
myd©a
.
numb”
)

39 >>> 
impÜt
 
th»adšg


40 >>> 
th»ad
 = 
th»adšg
.
	`Th»ad
(
rg‘
=
f
)

41 >>> 
th»ad
.
	`¡¬t
()

42 >>> 
th»ad
.
	`još
()

43 >>> 
log


46 
we
 
g‘
 
difã»Á
 
d©a
. 
Fu¹h”mÜe
, 
chªges
 
made
 
š
 
the
 
Ùh”
 
th»ad


47 
dÚ
't‡ffect data seen inhishread:

49 >>> 
myd©a
.
numb”


52 
Of
 
cour£
, 
v®ues
 
you
 
g‘
 
äom
 
a
 
loÿl
 
objeù
, 
šşudšg
‡ 
__diù__


53 
©Œibu‹
, 
¬e
 
wh©ev”
 
th»ad
 
was
 
cu¼’t
 
©
 
the
 
time
he

54 
©Œibu‹
 
was
 
»ad
. 
FÜ
 
th©
 
»asÚ
, 
you
 
g’”®ly
 
dÚ
't wanto save

55 
the£
 
v®ues
 
aüoss
 
th»ads
, 
as
 
they
 
­¶y
 
Úly
 
to
 
the
 
th»ad
hey

56 
ÿme
 
äom
.

58 
You
 
ÿn
 
ü—‹
 
cu¡om
 
loÿl
 
objeùs
 
by
 
subşassšg
 
the
†oÿÈ
şass
:

60 >>> 
şass
 
	$MyLoÿl
(
loÿl
):

61 ... 
numb”
 = 2

62 ... 
š™Ÿlized
 = 
F®£


63 ... 
def
 
	$__š™__
(
£lf
, **
kw
):

64 ... 
£lf
.
š™Ÿlized
:

65 ... 
¿i£
 
	`Sy¡emE¼Ü
('__init__ calledoo manyimes')

66 ... 
£lf
.
š™Ÿlized
 = 
True


67 ... 
£lf
.
__diù__
.
	`upd©e
(
kw
)

68 ... 
def
 
	$squ¬ed
(
£lf
):

69 ...  
£lf
.
numb”
 ** 2

71 
This
 
ÿn
 
be
 
u£ful
 
to
 
suµÜt
  
v®ues
, 
m‘hods
 
ªd


72 
š™Ÿliz©iÚ
. 
NÙe
 
th©
 
you
 
defše
 
ª
 
__š™__
 
m‘hod
, 
™
 
wl
 
be


73 
ÿÎed
 
—ch
 
time
 
the
 
loÿl
 
objeù
 
is
 
u£d
 
š
 
a
 
£·¿‹
 
th»ad
. 
This


74 
is
 
Ãûs§ry
 
to
 
š™Ÿlize
 
—ch
 
th»ad
's dictionary.

76 
Now
 
we
 
ü—‹
 
a
 
loÿl
 
objeù
:

78 >>> 
myd©a
 = 
	`MyLoÿl
(
cŞÜ
='red')

80 
Now
 
we
 
have
 
a
  
numb”
:

82 >>> 
myd©a
.
numb”


85 
ª
 
š™Ÿl
 
cŞÜ
:

87 >>> 
myd©a
.
cŞÜ


89 >>> 
d–
 
myd©a
.
cŞÜ


91 
And
 
a
 
m‘hod
 
th©
 
İ”©es
 
Ú
 
the
 
d©a
:

93 >>> 
myd©a
.
	`squ¬ed
()

96 
As
 
befÜe
, 
we
 
ÿn
 
acûss
 
the
 
d©a
 
š
 
a
 
£·¿‹
 
th»ad
:

98 >>> 
log
 = []

99 >>> 
th»ad
 = 
th»adšg
.
	`Th»ad
(
rg‘
=
f
)

100 >>> 
th»ad
.
	`¡¬t
()

101 >>> 
th»ad
.
	`još
()

102 >>> 
log


103 [[('cŞÜ', '»d'), ('š™Ÿlized', 
True
)], 11]

105 
w™hout
 
afãùšg
 
this
 
th»ad
's data:

107 >>> 
myd©a
.
numb”


109 >>> 
myd©a
.
cŞÜ


110 
	$T¿ûback
 (
mo¡
 
»ûÁ
 
ÿÎ
 
Ï¡
):

112 
A‰ribu‹E¼Ü
: 'MyLoÿl' 
objeù
 
has
 
no
 
©Œibu‹
 'color'

114 
NÙe
 
th©
 
subşas£s
 
ÿn
 
defše
 
¦Ùs
, 
but
 
they
 
¬e
 
nÙ
 
th»ad


115 
loÿl
. 
They
 
¬e
 
sh¬ed
 
aüoss
 
th»ads
:

117 >>> 
şass
 
	$MyLoÿl
(
loÿl
):

118 ... 
__¦Ùs__
 = 'number'

120 >>> 
myd©a
 = 
	`MyLoÿl
()

121 >>> 
myd©a
.
numb”
 = 42

122 >>> 
myd©a
.
cŞÜ
 = 'red'

124 
So
, 
the
 
£·¿‹
 
th»ad
:

126 >>> 
th»ad
 = 
th»adšg
.
	`Th»ad
(
rg‘
=
f
)

127 >>> 
th»ad
.
	`¡¬t
()

128 >>> 
th»ad
.
	$još
()

130 
afãùs
 
wh©
 
we
 
£e
:

132 >>> 
myd©a
.
numb”


135 >>> 
d–
 
myd©a


138 #Th»adšg 
impÜt
 
is
 
©
 
’d


140 
şass
 
	$_loÿlba£
(
objeù
):

141 
__¦Ùs__
 = '_local__key', '_local__args', '_local__lock'

143 
def
 
	$__Ãw__
(
şs
, *
¬gs
, **
kw
):

144 
£lf
 = 
objeù
.
	$__Ãw__
(
şs
)

145 
key
 = 'th»ad.loÿl.' + 
	`¡r
(
	$id
(
£lf
))

146 
objeù
.
	`__£‰r__
(
£lf
, '_loÿl__key', 
key
)

147 
objeù
.
	`__£‰r__
(
£lf
, '_loÿl__¬gs', (
¬gs
, 
kw
))

148 
objeù
.
	`__£‰r__
(
£lf
, '_loÿl__lock', 
	$RLock
())

150 
¬gs
 
Ü
 
kw
 
	$ªd
 (
şs
.
__š™__
 
is
 
objeù
.__init__):

151 
¿i£
 
	`Ty³E¼Ü
("Initialization‡rguments‡re‚ot supported")

153 #W
Ãed
 
to
 
ü—‹
 
the
 
th»ad
 
diù
 
š
 
ªtic©iÚ
 
of


154 #__š™__ 
bešg
 
ÿÎed
, 
to
 
make
 
su»
 
we
 
dÚ
't call it

155 #agaš 
our£lves
.

156 
diù
 = 
objeù
.
	`__g‘©Œibu‹__
(
£lf
, '__dict__')

157 
	`cu¼’tTh»ad
().
__diù__
[
key
] = 
diù


159  
£lf


161 
def
 
	$_·tch
(
£lf
):

162 
key
 = 
objeù
.
	`__g‘©Œibu‹__
(
£lf
, '_local__key')

163 
d
 = 
	`cu¼’tTh»ad
().
__diù__
.
	$g‘
(
key
)

164 
d
 
is
 
NÚe
:

165 
d
 = {
	}
}

166 
cu¼’tTh»ad
().
__diù__
[
key
] = 
d


167 
objeù
.
__£‰r__
(
£lf
, '__diù__', 
d
)

169 #w
have
 
a
 
Ãw
 
š¡ªû
 
diù
, 
so
 
ÿÎ
 
out
 
__š™__
 
we
 have

171 
	gşs
 = 
	$ty³
(
£lf
)

172 
şs
.
__š™__
 
is
 
nÙ
 
objeù
.__init__:

173 
¬gs
, 
kw
 = 
objeù
.
	`__g‘©Œibu‹__
(
£lf
, '_local__args')

174 
şs
.
	$__š™__
(
£lf
, *
¬gs
, **
kw
)

176 
objeù
.
	`__£‰r__
(
£lf
, '__diù__', 
d
)

178 
şass
 
	$loÿl
(
_loÿlba£
):

180 
def
 
	$__g‘©Œibu‹__
(
£lf
, 
Çme
):

181 
lock
 = 
objeù
.
	`__g‘©Œibu‹__
(
£lf
, '_local__lock')

182 
lock
.
	$acquœe
()

183 
Œy
:

184 
	$_·tch
(
£lf
)

185  
objeù
.
	$__g‘©Œibu‹__
(
£lf
, 
Çme
)

186 
fš®ly
:

187 
lock
.
	$»Ëa£
()

189 
def
 
	$__£‰r__
(
£lf
, 
Çme
, 
v®ue
):

190 
lock
 = 
objeù
.
	`__g‘©Œibu‹__
(
£lf
, '_local__lock')

191 
lock
.
	$acquœe
()

192 
Œy
:

193 
	$_·tch
(
£lf
)

194  
objeù
.
	$__£‰r__
(
£lf
, 
Çme
, 
v®ue
)

195 
fš®ly
:

196 
lock
.
	$»Ëa£
()

198 
def
 
	$__d–©Œ__
(
£lf
, 
Çme
):

199 
lock
 = 
objeù
.
	`__g‘©Œibu‹__
(
£lf
, '_local__lock')

200 
lock
.
	$acquœe
()

201 
Œy
:

202 
	$_·tch
(
£lf
)

203  
objeù
.
	$__d–©Œ__
(
£lf
, 
Çme
)

204 
fš®ly
:

205 
lock
.
	$»Ëa£
()

208 
def
 
	$__d–__
():

209 
th»adšg_’um”©e
 = 
’um”©e


210 
__g‘©Œibu‹__
 = 
objeù
.__getattribute__

212 
def
 
	$__d–__
(
£lf
):

213 
key
 = 
	`__g‘©Œibu‹__
(
£lf
, '_local__key')

215 
Œy
:

216 
th»ads
 = 
	`li¡
(
	$th»adšg_’um”©e
())

217 
exû±
:

218 #ià
’um”©e
 
çs
, 
as
 
™
 
£ems
 
to
 dØ
duršg


219 #shutdown, 
we
'll skip cleanup underhe‡ssumption

220 #th© 
th”e
 
is
 
nÙhšg
 
to
 
ş—n
 
up


223 
th»ad
 
š
 
th»ads
:

224 
Œy
:

225 
__diù__
 = 
th»ad
.__dict__

226 
exû±
 
A‰ribu‹E¼Ü
:

227 #Th»ad 
is
 
dyšg
, 
»¡
 
š
 
³aû


230 
key
 
š
 
__diù__
:

231 
Œy
:

232 
d–
 
__diù__
[
key
]

233 
exû±
 
KeyE¼Ü
:

234 
·ss
 #didn't have‡nything inhishread

236  
__d–__


237 
__d–__
 = 
	$__d–__
()

239 
äom
 
th»adšg
 
impÜt
 
cu¼’tTh»ad
, 
’um”©e
, 
RLock


	@trunk/objs/CherryPy-3.2.4/cherrypy/_cptools.py

1 """Ch”ryPyoŞs. A "
	gtoŞ
" is‡ny helper,‡daptedo CP.

3 
ToŞs
 
¬e
 
usu®ly
 
desigÃd
 
to
 
be
 
u£d
 
š
 
a
 
v¬›ty
 
of
 
	$ways
 (
®though
 
some


4 
may
 
Úly
 
ofãr
 
Úe
 
they
 
choo£
):

6 
Lib¿ry
 
ÿÎs


7 
AÎ
 
toŞs
 
¬e
 
ÿÎabËs
 
th©
 
ÿn
 
be
 
u£d
 
wh”ev”
 
Ãeded
.

8 
The
 
¬gum’ts
 
¬e
 
¡¿ightfÜw¬d
 
ªd
 
should
 
be
 
d‘aed
 
w™hš
 
the


9 
doc¡ršg
.

11 
FunùiÚ
 
decÜ©Üs


12 
AÎ
 
toŞs
, 
wh’
 
ÿÎed
, 
may
 
be
 
u£d
 
as
 
decÜ©Üs
 
which
 
cÚfigu»


13 
šdividu®
 
Ch”ryPy
 
·ge
 
	`hªdËrs
 (
m‘hods
 
Ú
 
the
 Ch”ryPy 
Œ“
).

14 
Th©
 
is
, "@toŞs.ªytoŞ()" 
should
 "tuº on" 
the
 
toŞ
 
vŸ
he

15 
decÜ©ed
 
funùiÚ
's _cp_config‡ttribute.

17 
Ch”ryPy
 
cÚfig


18 
If
 
a
 
toŞ
 
expo£s
‡ "_£tup" 
ÿÎabË
, 
™
 
wl
 
be
 
ÿÎed


19 
Úû
 
³r
 
	`Reque¡
 (
the
 
ã©u»
 
is
 "tuºed on" 
vŸ
 
cÚfig
).

21 
ToŞs
 
may
 
be
 
im¶em’‹d
 
as
 
ªy
 
objeù
 
w™h
 
a
 
Çme¥aû
. 
The
 
butšs


22 
¬e
 
g’”®ly
 
e™h”
 
moduËs
 
Ü
 
š¡ªûs
 
of
 
the
 
toŞs
.
ToŞ
 
şass
.

25 
impÜt
 
sys


26 
impÜt
 
w¬nšgs


28 
impÜt
 
ch”rypy


31 
def
 
	$_g‘¬gs
(
func
):

33 #U£ 
this
 
š¡—d
 
of
 
impÜtšg
 
š¥eù
 
Ëss
 
mem
 
ov”h—d
.

34 
impÜt
 
ty³s


35 
sys
.
v”siÚ_šfo
 >= (3, 0):

36 
	$isš¡ªû
(
func
, 
ty³s
.
M‘hodTy³
):

37 
func
 = func.
__func__


38 
co
 = 
func
.
__code__


40 
	$isš¡ªû
(
func
, 
ty³s
.
M‘hodTy³
):

41 
func
 = func.
im_func


42 
co
 = 
func
.
func_code


43  
co
.
co_v¬Çmes
[:co.
co_¬gcouÁ
]

46 
_©Œ_”rÜ
 = ("CherryPy Tools cannot beurned on directly. Instead,urnhem "

49 
şass
 
	$ToŞ
(
objeù
):

52 
	$h–p
(
toŞ
.
ÿÎabË
è
should
 
give
 
you
 
mÜe
 
šfÜm©iÚ
 
about
 
this
 
ToŞ
.

55 
Çme¥aû
 = "tools"

57 
def
 
	$__š™__
(
£lf
, 
pošt
, 
ÿÎabË
, 
Çme
=
NÚe
, 
´iÜ™y
=50):

58 
£lf
.
_pošt
 = 
pošt


59 
£lf
.
ÿÎabË
 = callable

60 
£lf
.
_Çme
 = 
Çme


61 
£lf
.
_´iÜ™y
 = 
´iÜ™y


62 
£lf
.
__doc__
 = s–f.
ÿÎabË
.__doc__

63 
£lf
.
	$_£rgs
()

65 
def
 
	$_g‘_Ú
(
£lf
):

66 
¿i£
 
	$A‰ribu‹E¼Ü
(
_©Œ_”rÜ
)

67 
def
 
	$_£t_Ú
(
£lf
, 
v®ue
):

68 
¿i£
 
	$A‰ribu‹E¼Ü
(
_©Œ_”rÜ
)

69 
Ú
 = 
	$´İ”ty
(
_g‘_Ú
, 
_£t_Ú
)

71 
def
 
	$_£rgs
(
£lf
):

73 
Œy
:

74 
¬g
 
š
 
	$_g‘¬gs
(
£lf
.
ÿÎabË
):

75 
	$£‰r
(
£lf
, 
¬g
, 
NÚe
)

76 
	$exû±
 (
Ty³E¼Ü
, 
A‰ribu‹E¼Ü
):

77 
	`ha§‰r
(
£lf
.
ÿÎabË
, "__call__"):

78 
¬g
 
š
 
	$_g‘¬gs
(
£lf
.
ÿÎabË
.
__ÿÎ__
):

79 
	$£‰r
(
£lf
, 
¬g
, 
NÚe
)

80 #IrÚPythÚ 1.0 
¿i£s
 
NÙIm¶em’‹dE¼Ü
 
beÿu£


81 #š¥eù.
g‘¬g¥ec
 
Œ›s
 
to
 
acûss
 
PythÚ
 
by‹code


82 #š 
co_code
 
©Œibu‹
.

83 
exû±
 
NÙIm¶em’‹dE¼Ü
:

84 
·ss


85 #IrÚPythÚ 1B1 
may
 
¿i£
 
IndexE¼Ü
 
š
 
some
 
ÿ£s
,

86 #buˆ
we
 
Œ­
 
™
 
h”e
 iˆ
dÛ¢
't…revent CP from working.

87 
exû±
 
IndexE¼Ü
:

88 
·ss


90 
def
 
	$_m”ged_¬gs
(
£lf
, 
d
=
NÚe
):

92 
d
:

93 
cÚf
 = 
d
.
	$cİy
()

95 
cÚf
 = {
	}
}

97 
tm
 = 
ch”rypy
.
£rvšg
.
»que¡
.
toŞm­s
[
£lf
.
Çme¥aû
]

98 
£lf
.
_Çme
 
š
 
tm
:

99 
cÚf
.
	$upd©e
(
tm
[
£lf
.
_Çme
])

101 "Ú" 
š
 
cÚf
:

102 
d–
 
cÚf
["on"]

104  
cÚf


106 
def
 
	$__ÿÎ__
(
£lf
, *
¬gs
, **
kw¬gs
):

109 
FÜ
 
exam¶e
::

111 @
toŞs
.
	$´oxy
()

112 
def
 
	$wh©s_my_ba£
(
£lf
):

113  
ch”rypy
.
»que¡
.
ba£


114 
wh©s_my_ba£
.
expo£d
 = 
True


116 
¬gs
:

117 
¿i£
 
	`Ty³E¼Ü
("The %r Tool does‚ot‡ccept…ositional "

119 % 
£lf
.
_Çme
)

120 
def
 
	$toŞ_decÜ©Ü
(
f
):

121 
nÙ
 
	`ha§‰r
(
f
, "_cp_config"):

122 
f
.
_ı_cÚfig
 = {
	}
}

123 
sub¥aû
 = 
£lf
.
Çme¥aû
 + "." + s–f.
_Çme
 + "."

124 
f
.
_ı_cÚfig
[
sub¥aû
 + "Ú"] = 
True


125 
k
, 
v
 
š
 
	gkw¬gs
.
	$™ems
():

126 
f
.
_ı_cÚfig
[
sub¥aû
 + 
k
] = 
v


127  
f


128  
toŞ_decÜ©Ü


130 
def
 
	$_£tup
(
£lf
):

133 
The
 
¡ªd¬d
 
Ch”ryPy
 
»que¡
 
objeù
 
wl
 
autom©iÿÎy
 
ÿÎ
 
this


134 
m‘hod
 
wh’
 
the
 
toŞ
 
is
 "tuºed on" 
š
 
cÚfig
.

136 
cÚf
 = 
£lf
.
	$_m”ged_¬gs
()

137 
p
 = 
cÚf
.
	`pİ
("´iÜ™y", 
NÚe
)

138 
p
 
is
 
NÚe
:

139 
p
 = 
	`g‘©Œ
(
£lf
.
ÿÎabË
, "´iÜ™y", s–f.
_´iÜ™y
)

140 
ch”rypy
.
£rvšg
.
»que¡
.
hooks
.
	$©ch
(
£lf
.
_pošt
, s–f.
ÿÎabË
,

141 
´iÜ™y
=
p
, **
cÚf
)

144 
şass
 
	$HªdËrToŞ
(
ToŞ
):

147 
If
 
the
 
toŞ
 
sucûssfuÎy
 
hªdËs
h
	`»que¡
 (
by
 
£‰šg
 
»¥Ú£
.
body
),

148 
should
  
True
. 
This
 
wl
 
ÿu£
 
Ch”ryPy
 
to
 
sk
 
ªy
 'nÜm®' 
·ge


149 
hªdËr
. 
If
 
the
 
toŞ
 
did
 
nÙ
 
hªdË
h
»que¡
, 
™
 
should
  
F®£


150 
to
 
‹Î
 
Ch”ryPy
Ø 
Ú
 
ªd
 
ÿÎ
 
the
 
nÜm®
 
·ge
 
hªdËr
. 
If
he

151 
toŞ
 
is
 
deş¬ed
 
AS
 
a
 
·ge
 
	`hªdËr
 (
£e
 
the
 'hªdËr' 
m‘hod
), 
»tuºšg


152 
F®£
 
wl
 
¿i£
 
NÙFound
.

155 
def
 
	$__š™__
(
£lf
, 
ÿÎabË
, 
Çme
=
NÚe
):

156 
ToŞ
.
	`__š™__
(
£lf
, 'befÜe_hªdËr', 
ÿÎabË
, 
Çme
)

158 
def
 
	$hªdËr
(
£lf
, *
¬gs
, **
kw¬gs
):

161 
FÜ
 
exam¶e
::

163 
şass
 
RoÙ
:

164 
Çv
 = 
toŞs
.
¡©icdœ
.
	`hªdËr
(
£ùiÚ
="/Çv", 
dœ
="nav",

165 
roÙ
=
absDœ
)

167 
def
 
	$hªdË_func
(*
a
, **
kw
):

168 
hªdËd
 = 
£lf
.
	`ÿÎabË
(*
¬gs
, **£lf.
	$_m”ged_¬gs
(
kw¬gs
))

169 
nÙ
 
hªdËd
:

170 
¿i£
 
ch”rypy
.
	$NÙFound
()

171  
ch”rypy
.
£rvšg
.
»¥Ú£
.
body


172 
hªdË_func
.
expo£d
 = 
True


173  
hªdË_func


175 
def
 
	$_w¿µ”
(
£lf
, **
kw¬gs
):

176 
£lf
.
	$ÿÎabË
(**
kw¬gs
):

177 
ch”rypy
.
£rvšg
.
»que¡
.
hªdËr
 = 
NÚe


179 
def
 
	$_£tup
(
£lf
):

182 
The
 
¡ªd¬d
 
Ch”ryPy
 
»que¡
 
objeù
 
wl
 
autom©iÿÎy
 
ÿÎ
 
this


183 
m‘hod
 
wh’
 
the
 
toŞ
 
is
 "tuºed on" 
š
 
cÚfig
.

185 
cÚf
 = 
£lf
.
	$_m”ged_¬gs
()

186 
p
 = 
cÚf
.
	`pİ
("´iÜ™y", 
NÚe
)

187 
p
 
is
 
NÚe
:

188 
p
 = 
	`g‘©Œ
(
£lf
.
ÿÎabË
, "´iÜ™y", s–f.
_´iÜ™y
)

189 
ch”rypy
.
£rvšg
.
»que¡
.
hooks
.
	$©ch
(
£lf
.
_pošt
, s–f.
_w¿µ”
,

190 
´iÜ™y
=
p
, **
cÚf
)

193 
şass
 
	$HªdËrW¿µ”ToŞ
(
ToŞ
):

196 
The
 'ÃwhªdËr' 
¬g
 
mu¡
 
be
 
a
 
hªdËr
 
w¿µ”
 
funùiÚ
 
th©
 
kes
‡

197 'Ãxt_hªdËr' 
¬gum’t
, 
¶us
 ``*
¬gs
`` 
ªd
 ``**
kw¬gs
``. 
Like
 
®l


198 
·ge
 
hªdËr


199 
funùiÚs
, 
™
 
mu¡
  
ª
 
™”abË
 
u£
 
as
 
ch”rypy
.
»¥Ú£
.
body
.

201 
FÜ
 
exam¶e
, 
to
 
®low
 
your
 'šÃr' 
·ge
 
hªdËrs
Ø 
diùs


202 
which
 
th’
 
g‘
 
š‹½Ş©ed
 
što
 
a
 
‹m¶©e
::

204 
def
 
	$š‹½Ş©Ü
(
Ãxt_hªdËr
, *
¬gs
, **
kw¬gs
):

205 
f’ame
 = 
ch”rypy
.
»que¡
.
cÚfig
.
	`g‘
('template')

206 
ch”rypy
.
»¥Ú£
.
‹m¶©e
 = 
’v
.
	$g‘_‹m¶©e
(
f’ame
)

207 
»¥Ú£_diù
 = 
	$Ãxt_hªdËr
(*
¬gs
, **
kw¬gs
)

208  
ch”rypy
.
»¥Ú£
.
‹m¶©e
.
	$»nd”
(**
»¥Ú£_diù
)

209 
ch”rypy
.
toŞs
.
jšja
 = 
	`HªdËrW¿µ”ToŞ
(
š‹½Ş©Ü
)

212 
def
 
	`__š™__
(
£lf
, 
ÃwhªdËr
, 
pošt
='befÜe_hªdËr', 
Çme
=
NÚe
, 
´iÜ™y
=50):

213 
£lf
.
ÃwhªdËr
 =‚ewhandler

214 
£lf
.
_pošt
 = 
pošt


215 
£lf
.
_Çme
 = 
Çme


216 
£lf
.
_´iÜ™y
 = 
´iÜ™y


218 
def
 
	$ÿÎabË
(
£lf
, 
debug
=
F®£
):

219 
šÃrfunc
 = 
ch”rypy
.
£rvšg
.
»que¡
.
hªdËr


220 
def
 
	$w¿p
(*
¬gs
, **
kw¬gs
):

221  
£lf
.
	$ÃwhªdËr
(
šÃrfunc
, *
¬gs
, **
kw¬gs
)

222 
ch”rypy
.
£rvšg
.
»que¡
.
hªdËr
 = 
w¿p


225 
şass
 
	$E¼ÜToŞ
(
ToŞ
):

228 
def
 
	$__š™__
(
£lf
, 
ÿÎabË
, 
Çme
=
NÚe
):

229 
ToŞ
.
	$__š™__
(
£lf
, 
NÚe
, 
ÿÎabË
, 
Çme
)

231 
def
 
	$_w¿µ”
(
£lf
):

232 
£lf
.
	`ÿÎabË
(**£lf.
	$_m”ged_¬gs
())

234 
def
 
	$_£tup
(
£lf
):

237 
The
 
¡ªd¬d
 
Ch”ryPy
 
»que¡
 
objeù
 
wl
 
autom©iÿÎy
 
ÿÎ
 
this


238 
m‘hod
 
wh’
 
the
 
toŞ
 
is
 "tuºed on" 
š
 
cÚfig
.

240 
ch”rypy
.
£rvšg
.
»que¡
.
”rÜ_»¥Ú£
 = 
£lf
.
_w¿µ”


243 #Butš 
toŞs
 #


244 
äom
 
ch”rypy
.
lib
 
impÜt
 
ıtoŞs
, 
’codšg
, 
auth
, , 
jsÚtoŞs


245 
äom
 
ch”rypy
.
lib
 
impÜt
 
£ssiÚs
 
as
 
_£ssiÚs
, 
xmÌpcut
‡ 
_xmÌpc


246 
äom
 
ch”rypy
.
lib
 
impÜt
 
ÿchšg
 
as
 
_ÿchšg


247 
äom
 
ch”rypy
.
lib
 
impÜt
 
auth_basic
, 
auth_dige¡


250 
şass
 
	$SessiÚToŞ
(
ToŞ
):

253 
£ssiÚs
.
lockšg


254 
Wh’
 'im¶ic™' (
the
 ),h
£ssiÚ
 
wl
 
be
 
locked
 
you
,

255 
ju¡
 
befÜe
 
ruÂšg
 
the
 
·ge
 
hªdËr
.

257 
Wh’
 '—¾y', 
the
 
£ssiÚ
 
wl
 
be
 
locked
 
befÜe
 
»adšg
h
»que¡


258 
body
. 
This
 
is
 
off
 
by
  
§ãty
 
»asÚs
; 
exam¶e
,

259 
a
 
Ïrge
 
u¶ßd
 
would
 
block
 
the
 
£ssiÚ
, 
d’yšg
 
ª
 
AJAX


260 
´og»ss
 
	`m‘”
 (
£e
 
h‰p
:

262 
Wh’
 'ex¶ic™' (
Ü
 
ªy
 
Ùh”
 
v®ue
), 
you
 
Ãed
 
to
 
ÿÎ


263 
ch”rypy
.
£ssiÚ
.
	$acquœe_lock
(è
your£lf
 
befÜe
 
usšg


264 
£ssiÚ
 
d©a
.

267 
def
 
	$__š™__
(
£lf
):

268 #_£ssiÚs.
š™
 
mu¡
 
be
 
bound
 
aá”
 
h—d”s
 
¬e
 
»ad


269 
ToŞ
.
	`__š™__
(
£lf
, 'befÜe_»que¡_body', 
_£ssiÚs
.
š™
)

271 
def
 
	$_lock_£ssiÚ
(
£lf
):

272 
ch”rypy
.
£rvšg
.
£ssiÚ
.
	$acquœe_lock
()

274 
def
 
	$_£tup
(
£lf
):

277 
The
 
¡ªd¬d
 
Ch”ryPy
 
»que¡
 
objeù
 
wl
 
autom©iÿÎy
 
ÿÎ
 
this


278 
m‘hod
 
wh’
 
the
 
toŞ
 
is
 "tuºed on" 
š
 
cÚfig
.

280 
hooks
 = 
ch”rypy
.
£rvšg
.
»que¡
.hooks

282 
cÚf
 = 
£lf
.
	$_m”ged_¬gs
()

284 
p
 = 
cÚf
.
	`pİ
("´iÜ™y", 
NÚe
)

285 
p
 
is
 
NÚe
:

286 
p
 = 
	`g‘©Œ
(
£lf
.
ÿÎabË
, "´iÜ™y", s–f.
_´iÜ™y
)

288 
hooks
.
	$©ch
(
£lf
.
_pošt
, s–f.
ÿÎabË
, 
´iÜ™y
=
p
, **
cÚf
)

290 
lockšg
 = 
cÚf
.
	`pİ
('locking', 'implicit')

291 
lockšg
 == 'implicit':

292 
hooks
.
	`©ch
('befÜe_hªdËr', 
£lf
.
_lock_£ssiÚ
)

293 
–if
 
lockšg
 == 'early':

294 #Lock 
befÜe
 
the
 
»que¡
 
	`body
 (
but
 
aá”
 
_£ssiÚs
.
š™
 
runs
!)

295 
hooks
.
	`©ch
('befÜe_»que¡_body', 
£lf
.
_lock_£ssiÚ
,

296 
´iÜ™y
=60)

299 
·ss


301 
hooks
.
	`©ch
('befÜe_fš®ize', 
_£ssiÚs
.
§ve
)

302 
hooks
.
	`©ch
('Ú_’d_»que¡', 
_£ssiÚs
.
şo£
)

304 
def
 
	$»g’”©e
(
£lf
):

306 
£ss
 = 
ch”rypy
.
£rvšg
.
£ssiÚ


307 
£ss
.
	$»g’”©e
()

309 #G¿b 
cook›
-
»Ëvªt
 
toŞ
 
¬gs


310 
cÚf
 = 
	`diù
([(
k
, 
v
èk, v 
š
 
£lf
.
	`_m”ged_¬gs
().
	$™ems
()

311 
k
 
	`š
 ('path', 'path_header', 'name', 'timeout',

313 
_£ssiÚs
.
	$£t_»¥Ú£_cook›
(**
cÚf
)

318 
şass
 
	$XMLRPCCÚŒŞËr
(
objeù
):

321 
To
 
u£
 
™
, 
have
 
your
 
cÚŒŞËrs
 
subşass
 
this
 
ba£
 
	`şass
 (™ 
wl


322 
tuº
 
Ú
 
the
 
toŞ
 
you
).

324 
You
 
ÿn
 
®so
 
suµly
 
the
 
fŞlowšg
 
İtiÚ®
 
cÚfig
 
’Œ›s
::

326 
toŞs
.
xmÌpc
.
’codšg
: 'utf-8'

327 
toŞs
.
xmÌpc
.
®low_nÚe
: 0

329 
XML
-
RPC
 
is
 
a
 
¿th”
 
discÚtšuous
 
Ïy”
 
ov”
 
HTTP
; 
di¥©chšg
 
to
 
the


330 
­´İrŸ‹
 
hªdËr
 
mu¡
 
fœ¡
 
be
 
³rfÜmed
 
accÜdšg
 
to
 
the
 
URL
, 
ªd


331 
th’
 
a
 
£cÚd
 
di¥©ch
 
¡•
 
mu¡
 
ke
 
¶aû
 
accÜdšg
 
to
 
the
 
RPC
 
m‘hod


332 
¥ecif›d
 
š
 
the
 
»que¡
 
body
. 
It
 
®so
 
®lows
 
a
 
su³ræuous
 "/RPC2"

333 
´efix
 
š
 
the
 
URL
, 
suµl›s
 
™s
 
own
 
hªdËr
 
¬gs
 iÀth
body
, 
ªd


334 
»quœes
 
a
 200 
OK
 "FauÉ" 
»¥Ú£
 
š¡—d
 
of
 404 
wh’
 
the
 
desœed


335 
m‘hod
 
is
 
nÙ
 
found
.

337 
Th”efÜe
, 
XML
-
RPC
 
ÿÂÙ
 
be
 
im¶em’‹d
 
Ch”ryPy
 
vŸ
 
a
 
ToŞ
 
®Úe
.

338 
This
 
CÚŒŞËr
 
aùs
 
as
 
the
 
di¥©ch
 
rg‘
 th
fœ¡
 
	`h®f
 (
ba£d


339 
Ú
 
the
 
URL
); 
™
 
th’
 
»ads
h
RPC
 
m‘hod
 
äom
h
»que¡
 
body
 
ªd


340 
dÛs
 
™s
 
own
 
£cÚd
 
di¥©ch
 
¡•
 
ba£d
 
Ú
 
th©
 
m‘hod
. 
It
 
®so
 
»ads


341 
body
 
·¿ms
, 
ªd
 
»tuºs
 
a
 
FauÉ
 
Ú
 
”rÜ
.

343 
The
 
XMLRPCDi¥©ch”
 
¡rs
 
ªy
 /
RPC2
 
´efix
; 
you
 
¬’
't using /RPC2

344 
š
 
your
 
URL
's, you can safely skipurning onhe XMLRPCDispatcher.

345 
Oth”wi£
, 
you
 
Ãed
 
to
 
u£
 
deş¬e
 
™
 
š
 
cÚfig
::

347 
»que¡
.
di¥©ch
: 
ch”rypy
.di¥©ch.
	`XMLRPCDi¥©ch”
()

350 #NÙ
we
'» h¬d-codšghi štØth'
toŞs
'‚amespace. We could do

351 #¨
huge
 
amouÁ
 
of
 
wÜk
 
to
 
make
 
™
 
»loÿbË
, 
but
 
the
 
Úly
 
»asÚ
 
why


352 #would 
be
 
someÚe
 
aùu®ly
 
di§bËd
 
the
 
deçuÉ_toŞbox
. 
Meh
.

353 
_ı_cÚfig
 = {'toŞs.xmÌpc.Ú': 
True
}

355 
def
 (
£lf
, *
v·th
, **
·¿ms
):

356 
½ı¬ams
, 
½cm‘hod
 = 
_xmÌpc
.
	$´oûss_body
()

358 
subhªdËr
 = 
£lf


359 
©Œ
 
š
 
	`¡r
(
½cm‘hod
).
	`¥l™
('.'):

360 
subhªdËr
 = 
	$g‘©Œ
(
subhªdËr
, 
©Œ
, 
NÚe
)

362 
subhªdËr
 
ªd
 
	`g‘©Œ
(subhªdËr, "expo£d", 
F®£
):

363 
body
 = 
	`subhªdËr
(*(
v·th
 + 
½ı¬ams
), **
·¿ms
)

367 #ià
a
 
m‘hod
 
is
 
nÙ
 
found
, 
ª
 
xmÌpşib
.
FauÉ
 
should
 
be
 
»tuºed


368 #¿isšg 
ª
 
exû±iÚ
 
h”e
 
wl
 dØ
th©
; 
£e


369 #ch”rypy.
lib
.
xmÌpcut
.
Ú_”rÜ


370 
¿i£
 
	`Exû±iÚ
('m‘hod "%s" i nÙ suµÜ‹d' % 
©Œ
)

372 
cÚf
 = 
ch”rypy
.
£rvšg
.
»que¡
.
toŞm­s
['toŞs'].
	`g‘
("xmÌpc", {
	}
})

373 
	g_xmÌpc
.
»¥Úd
(
body
,

374 
cÚf
.
g‘
('encoding', 'utf-8'),

375 
cÚf
.
g‘
('allow_none', 0))

376  
	gch”rypy
.
	g£rvšg
.
	g»¥Ú£
.
body


377 .
	gexpo£d
 = 
True


380 
şass
 
	$SessiÚAuthToŞ
(
HªdËrToŞ
):

382 
def
 
	$_£rgs
(
£lf
):

383 
Çme
 
š
 
	$dœ
(
ıtoŞs
.
SessiÚAuth
):

384 
nÙ
 
Çme
.
	`¡¬tsw™h
("__"):

385 
	$£‰r
(
£lf
, 
Çme
, 
NÚe
)

388 
şass
 
	$CachšgToŞ
(
ToŞ
):

391 
def
 
	$_w¿µ”
(
£lf
, **
kw¬gs
):

392 
»que¡
 = 
ch”rypy
.
£rvšg
.request

393 
_ÿchšg
.
	$g‘
(**
kw¬gs
):

394 
»que¡
.
hªdËr
 = 
NÚe


396 
»que¡
.
ÿch—bË
:

397 #NÙ
the
 
devious
 
‹chnique
 
h”e
 
of
 
addšg
 
hooks
 
Ú
h
æy


398 
»que¡
.
hooks
.
	`©ch
('befÜe_fš®ize', 
_ÿchšg
.
‹e_ouut
,

399 
´iÜ™y
 = 90)

400 
_w¿µ”
.
´iÜ™y
 = 20

402 
def
 
	$_£tup
(
£lf
):

404 
cÚf
 = 
£lf
.
	$_m”ged_¬gs
()

406 
p
 = 
cÚf
.
	`pİ
("´iÜ™y", 
NÚe
)

407 
ch”rypy
.
£rvšg
.
»que¡
.
hooks
.
	`©ch
('befÜe_hªdËr', 
£lf
.
_w¿µ”
,

408 
´iÜ™y
=
p
, **
cÚf
)

412 
şass
 
	$ToŞbox
(
objeù
):

415 
This
 
objeù
 
®so
 
funùiÚs
 
as
 
a
 
cÚfig
 
Çme¥aû
 
hªdËr
 
™£lf
.

416 
Cu¡om
 
toŞboxes
 
should
 
be
 
added
 
to
 
—ch
 
AµliÿtiÚ
'soolboxes dict.

419 
def
 
	$__š™__
(
£lf
, 
Çme¥aû
):

420 
£lf
.
Çme¥aû
 =‚amespace

422 
def
 
	$__£‰r__
(
£lf
, 
Çme
, 
v®ue
):

423 #Ià
the
 
ToŞ
.
_Çme
 
is
 
NÚe
, 
suµly
 
™
 
äom
h
©Œibu‹
 
Çme
.

424 
	$isš¡ªû
(
v®ue
, 
ToŞ
):

425 
v®ue
.
_Çme
 
is
 
NÚe
:

426 
v®ue
.
_Çme
 = 
Çme


427 
v®ue
.
Çme¥aû
 = 
£lf
.namespace

428 
objeù
.
	$__£‰r__
(
£lf
, 
Çme
, 
v®ue
)

430 
def
 
	$__’‹r__
(
£lf
):

432 
ch”rypy
.
£rvšg
.
»que¡
.
toŞm­s
[
£lf
.
Çme¥aû
] = 
m­
 = {
	}
}

433 
def
 
	$pİuÏ‹
(
k
, 
v
):

434 
toŞÇme
, 
¬g
 = 
k
.
	`¥l™
(".", 1)

435 
buck‘
 = 
m­
.
	`£tdeçuÉ
(
toŞÇme
, {
	}
})

436 
	gbuck‘
[
¬g
] = 
v


437  
pİuÏ‹


439 
def
 
	$__ex™__
(
£lf
, 
exc_ty³
, 
exc_v®
, 
exc_tb
):

441 
m­
 = 
ch”rypy
.
£rvšg
.
»que¡
.
toŞm­s
.
	$g‘
(
£lf
.
Çme¥aû
)

442 
m­
:

443 
Çme
, 
£‰šgs
 
š
 
m­
.
	$™ems
():

444 
£‰šgs
.
	`g‘
("Ú", 
F®£
):

445 
toŞ
 = 
	$g‘©Œ
(
£lf
, 
Çme
)

446 
toŞ
.
	$_£tup
()

449 
şass
 
	$D•»ÿ‹dToŞ
(
ToŞ
):

451 
_Çme
 = 
NÚe


452 
w¬nmsg
 = "This Tool is deprecated."

454 
def
 
	$__š™__
(
£lf
, 
pošt
, 
w¬nmsg
=
NÚe
):

455 
£lf
.
pošt
 =…oint

456 
w¬nmsg
 
is
 
nÙ
 
NÚe
:

457 
£lf
.
w¬nmsg
 = warnmsg

459 
def
 
	$__ÿÎ__
(
£lf
, *
¬gs
, **
kw¬gs
):

460 
w¬nšgs
.
	$w¬n
(
£lf
.
w¬nmsg
)

461 
def
 
	$toŞ_decÜ©Ü
(
f
):

462  
f


463  
toŞ_decÜ©Ü


465 
def
 
	$_£tup
(
£lf
):

466 
w¬nšgs
.
	$w¬n
(
£lf
.
w¬nmsg
)

469 
deçuÉ_toŞbox
 = 
_d
 = 
	`ToŞbox
("tools")

470 
_d
.
£ssiÚ_auth
 = 
	$SessiÚAuthToŞ
(
ıtoŞs
.
£ssiÚ_auth
)

471 
_d
.
®low
 = 
	`ToŞ
('Ú_¡¬t_»sourû', 
ıtoŞs
.allow)

472 
_d
.
´oxy
 = 
	`ToŞ
('befÜe_»que¡_body', 
ıtoŞs
.´oxy, 
´iÜ™y
=30)

473 
_d
.
»¥Ú£_h—d”s
 = 
	`ToŞ
('Ú_¡¬t_»sourû', 
ıtoŞs
.response_headers)

474 
_d
.
log_Œaûbacks
 = 
	`ToŞ
('befÜe_”rÜ_»¥Ú£', 
ıtoŞs
.
log_Œaûback
)

475 
_d
.
log_h—d”s
 = 
	`ToŞ
('befÜe_”rÜ_»¥Ú£', 
ıtoŞs
.
log_»que¡_h—d”s
)

476 
_d
.
log_hooks
 = 
	`ToŞ
('Ú_’d_»que¡', 
ıtoŞs
.log_hooks, 
´iÜ™y
=100)

477 
_d
.
”r_»dœeù
 = 
	$E¼ÜToŞ
(
ıtoŞs
.
»dœeù
)

478 
_d
.
‘ags
 = 
	`ToŞ
('befÜe_fš®ize', 
ıtoŞs
.
v®id©e_‘ags
, 
´iÜ™y
=75)

479 
_d
.
decode
 = 
	`ToŞ
('befÜe_»que¡_body', 
’codšg
.decode)

480 #th
Üd”
 
of
 
’codšg
, 
gz
, 
ÿchšg
 
is
 
impÜÁ


481 
_d
.
’code
 = 
	`ToŞ
('befÜe_hªdËr', 
’codšg
.
Re¥Ú£Encod”
, 
´iÜ™y
=70)

482 
_d
.
gz
 = 
	`ToŞ
('befÜe_fš®ize', 
’codšg
.gz, 
´iÜ™y
=80)

483 
_d
.
¡©icdœ
 = 
	$HªdËrToŞ
(.
¡©icdœ
)

484 
_d
.
¡©icfe
 = 
	$HªdËrToŞ
(.
¡©icfe
)

485 
_d
.
£ssiÚs
 = 
	$SessiÚToŞ
()

486 
_d
.
xmÌpc
 = 
	$E¼ÜToŞ
(
_xmÌpc
.
Ú_”rÜ
)

487 
_d
.
ÿchšg
 = 
	`CachšgToŞ
('befÜe_hªdËr', 
_ÿchšg
.
g‘
, 'caching')

488 
_d
.
expœes
 = 
	`ToŞ
('befÜe_fš®ize', 
_ÿchšg
.expires)

489 
_d
.
tidy
 = 
	`D•»ÿ‹dToŞ
('before_finalize',

492 
_d
.
nsgmls
 = 
	`D•»ÿ‹dToŞ
('before_finalize',

495 
_d
.
ignÜe_h—d”s
 = 
	`ToŞ
('befÜe_»que¡_body', 
ıtoŞs
.ignore_headers)

496 
_d
.
»ã»r
 = 
	`ToŞ
('befÜe_»que¡_body', 
ıtoŞs
.referer)

497 
_d
.
basic_auth
 = 
	`ToŞ
('Ú_¡¬t_»sourû', 
auth
.basic_auth)

498 
_d
.
dige¡_auth
 = 
	`ToŞ
('Ú_¡¬t_»sourû', 
auth
.digest_auth)

499 
_d
.
Œašg_¦ash
 = 
	`ToŞ
('befÜe_hªdËr', 
ıtoŞs
.Œašg_¦ash, 
´iÜ™y
=60)

500 
_d
.
æ©‹n
 = 
	`ToŞ
('befÜe_fš®ize', 
ıtoŞs
.flatten)

501 
_d
.
acû±
 = 
	`ToŞ
('Ú_¡¬t_»sourû', 
ıtoŞs
.accept)

502 
_d
.
»dœeù
 = 
	`ToŞ
('Ú_¡¬t_»sourû', 
ıtoŞs
.redirect)

503 
_d
.
autov¬y
 = 
	`ToŞ
('Ú_¡¬t_»sourû', 
ıtoŞs
.autov¬y, 
´iÜ™y
=0)

504 
_d
.
jsÚ_š
 = 
	`ToŞ
('befÜe_»que¡_body', 
jsÚtoŞs
.jsÚ_š, 
´iÜ™y
=30)

505 
_d
.
jsÚ_out
 = 
	`ToŞ
('befÜe_hªdËr', 
jsÚtoŞs
.jsÚ_out, 
´iÜ™y
=30)

506 
_d
.
auth_basic
 = 
	`ToŞ
('befÜe_hªdËr',‡uth_basic.
basic_auth
, 
´iÜ™y
=1)

507 
_d
.
auth_dige¡
 = 
	`ToŞ
('befÜe_hªdËr',‡uth_dige¡.
dige¡_auth
, 
´iÜ™y
=1)

509 
d–
 
_d
, 
ıtoŞs
, 
’codšg
, 
auth
, 

	@trunk/objs/CherryPy-3.2.4/cherrypy/_cptree.py

3 
impÜt
 
os


4 
impÜt
 
sys


6 
impÜt
 
ch”rypy


7 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
	gÁou
, 
py3k


8 
äom
 
ch”rypy
 
impÜt
 
	g_ıcÚfig
, 
	g_ıloggšg
, 
	g_ı»que¡
, 
	g_ıwsgi
, 
toŞs


9 
äom
 
	gch”rypy
.
lib
 
impÜt
 
h‰put


12 
şass
 
	$AµliÿtiÚ
(
objeù
):

15 
S”v”s
 
ªd
 
g©eways
 
should
 
nÙ
 
š¡ªtŸ‹
 
Reque¡
 
objeùs
 
dœeùly
.

16 
In¡—d
, 
they
 
should
 
ask
 
ª
 
AµliÿtiÚ
 
objeù
 
a
 
»que¡
 object.

18 
An
 
š¡ªû
 
of
 
this
 
şass
 
may
 
®so
 
be
 
u£d
 
as
 
a
 
WSGI
 
ÿÎabË


19 (
WSGI
 
­¶iÿtiÚ
 
objeù
è
™£lf
.

22 
roÙ
 = 
NÚe


24 
be
 
¬¿nged
 
š
 
a
 
h›¿rchy
 
of
 
©Œibu‹s
, 
m©chšg
 
the
 
ex³ùed
 
URI


25 
h›¿rchy
; 
the
  
di¥©ch”
 
th’
 
£¬ches
 
this
 h›¿rchy 
a


26 
m©chšg
 
hªdËr
. 
Wh’
 
usšg
 
a
 
di¥©ch”
 
Ùh”
 
thª
 
the
 ,

27 
this
 
v®ue
 
may
 
be
 
NÚe
."""

29 
cÚfig
 = {
	}
}

31 
of
 {
key
: 
v®ue
} 
·œs
."""

33 
Çme¥aûs
 = 
_ıcÚfig
.
	$Name¥aûS‘
()

34 
toŞboxes
 = {'toŞs': 
ch”rypy
.
toŞs
}

36 
log
 = 
NÚe


39 
wsgŸµ
 = 
NÚe


42 
»que¡_şass
 = 
_ı»que¡
.
Reque¡


43 
»¥Ú£_şass
 = 
_ı»que¡
.
Re¥Ú£


45 
»Ïtive_u¾s
 = 
F®£


47 
def
 
__š™__
(
£lf
, 
roÙ
, 
süt_Çme
="", 
cÚfig
=
NÚe
):

48 
£lf
.
log
 = 
_ıloggšg
.
LogMªag”
(
id
(£lf), 
ch”rypy
.log.
logg”_roÙ
)

49 
	g£lf
.
	groÙ
 = 
roÙ


50 
£lf
.
süt_Çme
 = script_name

51 
£lf
.
wsgŸµ
 = 
_ıwsgi
.
	$CPWSGIAµ
(
£lf
)

53 
£lf
.
Çme¥aûs
 = s–f.Çme¥aûs.
	$cİy
()

54 
£lf
.
Çme¥aûs
["log"] = 
Ïmbda
 
k
, 
v
: 
	$£‰r
(
£lf
.
log
, 
k
, 
v
)

55 
£lf
.
Çme¥aûs
["wsgi"] = s–f.
wsgŸµ
.
Çme¥aû_hªdËr


57 
£lf
.
cÚfig
 = s–f.
__şass__
.cÚfig.
	$cİy
()

58 
cÚfig
:

59 
£lf
.
	$m”ge
(
cÚfig
)

61 
def
 
	$__»´__
(
£lf
):

62  "%s.%s(%r, %r)" % (
£lf
.
__moduË__
, s–f.
__şass__
.
__Çme__
,

63 
£lf
.
roÙ
, s–f.
süt_Çme
)

65 
süt_Çme_doc
 = """ThURI "
mouÁ
 
pošt
" forhis‡pp. A mount…oint ishat…ortion of

66 
the
 
URI
 
which
 
is
 
cÚ¡ªt
 
®l
 
URIs
 
th©
 
¬e
 
£rviûd
 
by
 
this


67 
­¶iÿtiÚ
; 
™
 
dÛs
 
nÙ
 
šşude
 
scheme
, 
ho¡
, 
Ü
 
	`´oxy
 ("virtual host")

68 
pÜtiÚs
 
of
 
the
 
URI
.

70 
FÜ
 
exam¶e
, 
süt_Çme
 
is
 "/my/coŞ/­p", 
th’
 
the
 
URL


71 "h‰p://www.exam¶e.com/my/coŞ/­p/·ge1" 
might
 
be
 
hªdËd
 
by
 
a


72 "·ge1" 
m‘hod
 
Ú
 
the
 
roÙ
 
objeù
.

74 
The
 
v®ue
 
of
 
süt_Çme
 
MUST
 
NOT
 
’d
 
š
 
a
 
¦ash
. 
If
 
the
 script_name

75 
»ãrs
 
to
 
the
 
roÙ
 
of
h
URI
, 
™
 
MUST
 
be
 
ª
 
em±y
 
	`¡ršg
 (
nÙ
 "/").

77 
If
 
süt_Çme
 
is
 
ex¶ic™ly
 
£t
 
to
 
NÚe
, 
th’
 
the
 süt_Çm
wl
 
be


78 
´ovided
 
—ch
 
ÿÎ
 
äom
 
»que¡
.
wsgi_’vœÚ
['SCRIPT_NAME'].

80 
def
 
	$_g‘_süt_Çme
(
£lf
):

81 
£lf
.
_süt_Çme
 
is
 
NÚe
:

82 #NÚ
sigÇls
 
th©
 
the
 
süt
 
Çme
 
should
 
be
 
puÎed
 
äom
 
WSGI
 
’vœÚ
.

83  
ch”rypy
.
£rvšg
.
»que¡
.
wsgi_’vœÚ
['SCRIPT_NAME'].
	`r¡r
("/")

84  
£lf
.
_süt_Çme


85 
def
 
	$_£t_süt_Çme
(
£lf
, 
v®ue
):

86 
v®ue
:

87 
v®ue
 = v®ue.
	`r¡r
("/")

88 
£lf
.
_süt_Çme
 = 
v®ue


89 
süt_Çme
 = 
	$´İ”ty
(
fg‘
=
_g‘_süt_Çme
, 
f£t
=
_£t_süt_Çme
,

90 
doc
=
süt_Çme_doc
)

92 
def
 
	$m”ge
(
£lf
, 
cÚfig
):

94 
_ıcÚfig
.
	$m”ge
(
£lf
.
cÚfig
, config)

96 #HªdË 
Çme¥aûs
 
¥ecif›d
 
š
 
cÚfig
.

97 
£lf
.
	`Çme¥aûs
(£lf.
cÚfig
.
	`g‘
("/", {
	}
}))

99 
def
 
	$fšd_cÚfig
(
£lf
, 
·th
, 
key
, =
NÚe
):

101 
Œa
 = 
·th
 
Ü
 "/"

102 
Œa
:

103 
nodecÚf
 = 
£lf
.
cÚfig
.
	`g‘
(
Œa
, {
	}
})

105 
key
 
š
 
	gnodecÚf
:

106  
nodecÚf
[
key
]

108 
Ï¡¦ash
 = 
Œa
.
rfšd
("/")

109 
Ï¡¦ash
 == -1:

111 
–if
 
Ï¡¦ash
 =ğ0 
ªd
 
Œa
 != "/":

112 
Œa
 = "/"

114 
Œa
 =¿[:
Ï¡¦ash
]

118 
def
 
	$g‘_£rvšg
(
£lf
, 
loÿl
, 
»mÙe
, 
scheme
, 
¥rÙo
):

120 
»q
 = 
£lf
.
	$»que¡_şass
(
loÿl
, 
»mÙe
, 
scheme
, 
¥rÙo
)

121 
»q
.
­p
 = 
£lf


123 
Çme
, 
toŞbox
 
š
 
£lf
.
toŞboxes
.
	$™ems
():

124 
»q
.
Çme¥aûs
[
Çme
] = 
toŞbox


126 
»¥
 = 
£lf
.
	$»¥Ú£_şass
()

127 
ch”rypy
.
£rvšg
.
	$lßd
(
»q
, 
»¥
)

128 
ch”rypy
.
’gše
.
	`publish
('acquire_thread')

129 
ch”rypy
.
’gše
.
	`publish
('before_request')

131  
»q
, 
»¥


133 
def
 
	$»Ëa£_£rvšg
(
£lf
):

135 
»q
 = 
ch”rypy
.
£rvšg
.
»que¡


137 
ch”rypy
.
’gše
.
	`publish
('after_request')

139 
Œy
:

140 
»q
.
	$şo£
()

141 
exû±
:

142 
ch”rypy
.
	$log
(
Œaûback
=
True
, 
£v”™y
=40)

144 
ch”rypy
.
£rvšg
.
	$ş—r
()

146 
def
 
	$__ÿÎ__
(
£lf
, 
’vœÚ
, 
¡¬t_»¥Ú£
):

147  
£lf
.
	$wsgŸµ
(
’vœÚ
, 
¡¬t_»¥Ú£
)

150 
şass
 
	$T»e
(
objeù
):

153 
An
 
š¡ªû
 
of
 
this
 
şass
 
may
 
®so
 
be
 
u£d
 
as
 
a
 
WSGI
 
ÿÎabË


154 (
WSGI
 
­¶iÿtiÚ
 
objeù
), 
š
 
which
 
™
 
di¥©ches
 
to
 
®l


155 
mouÁed
 
­ps
.

158 
­ps
 = {
	}
}

160 
A
 
diù
 
of
 
the
 
fÜm
 {
süt
 
Çme
: 
­¶iÿtiÚ
}, 
	gwh”e
 "script‚ame"

161 
is
 
a
 
¡ršg
 
deş¬šg
 
the
 
URI
 
mouÁ
 
pošt
 (
no
 
Œašg
 
¦ash
), 
	gªd


162 "­¶iÿtiÚ" 
is
 
ª
 
š¡ªû
 
of
 
	gch”rypy
.
AµliÿtiÚ
 (
Ü
‡À
¬b™¿ry


163 
WSGI
 
ÿÎabË
 
you
 
h­³n
 
to
 
be
 
usšg
 
a
 WSGI 
£rv”
)."""

165 
def
 
	$__š™__
(
£lf
):

166 
£lf
.
­ps
 = {
	}
}

168 
def
 
mouÁ
(
£lf
, 
roÙ
, 
süt_Çme
="", 
cÚfig
=
NÚe
):

171 
roÙ


172 
An
 
š¡ªû
 
of
 
a
 "cÚŒŞË¸şass" (¨
cŞËùiÚ
 oà
·ge


173 
hªdËr
 
m‘hods
è
which
 
»´e£Ás
 
the
 
roÙ
 
of
h
­¶iÿtiÚ
.

174 
This
 
may
 
®so
 
be
 
ª
 
AµliÿtiÚ
 
š¡ªû
, 
Ü
 
NÚe
 
usšg


175 
a
 
di¥©ch”
 
Ùh”
 
thª
 
the
 .

177 
süt_Çme


178 
A
 
¡ršg
 
cÚššg
 
	gthe
 "mouÁ…ošt" 
of
 
the
 
	g­¶iÿtiÚ
.

179 
This
 
should
 
¡¬t
 
w™h
 
a
 
	g¦ash
, 
ªd
 
be
 
the
 
·th
 
pÜtiÚ
 
of
he

180 
URL
 
©
 
which
 
to
 
mouÁ
 
the
 
giv’
 
	groÙ
. 
FÜ
 
	gexam¶e
, roÙ.
	$šdex
()

181 
wl
 
hªdË
 
»que¡s
 
to
 "http://www.example.com:8080/dept/app1/",

182 
th’
 
the
 
süt_Çme
 
¬gum’t
 
would
 
be
 "/dept/app1".

184 
It
 
MUST
 
NOT
 
’d
 
š
 
a
 
¦ash
. 
If
 
the
 
süt_Çme
 
»ãrs
 
to
he

185 
roÙ
 
of
 
the
 
URI
, 
™
 
MUST
 
be
 
ª
 
em±y
 
	`¡ršg
 (
nÙ
 "/").

187 
cÚfig


188 
A
 
fe
 
Ü
 
diù
 
cÚššg
 
­¶iÿtiÚ
 
cÚfig
.

190 
süt_Çme
 
is
 
NÚe
:

191 
¿i£
 
	`Ty³E¼Ü
(

198 #Nexˆ
lše
 
bÙh
 1è
¡rs
 
Œašg
 
¦ash
 
ªd
 2è
m­s
 "/" -> "".

199 
süt_Çme
 = süt_Çme.
	`r¡r
("/")

201 
	$isš¡ªû
(
roÙ
, 
AµliÿtiÚ
):

202 
­p
 = 
roÙ


203 
süt_Çme
 !ğ"" 
ªd
 süt_Çm!ğ
­p
.script_name:

204 
¿i£
 
	`V®ueE¼Ü
("Cannot specify‡ different script‚ame‡nd "

206 
süt_Çme
 = 
­p
.script_name

208 
­p
 = 
	$AµliÿtiÚ
(
roÙ
, 
süt_Çme
)

210 #Ià
mouÁed
 
©
 "", 
add
 
çvicÚ
.
ico


211 ià(
süt_Çme
 =ğ"" 
ªd
 
roÙ
 
is
 
nÙ
 
NÚe


212 
ªd
 
nÙ
 
	`ha§‰r
(
roÙ
, "favicon_ico")):

213 
çvicÚ
 = 
os
.
·th
.
	`još
(os.
	`g‘cwd
(), os.·th.
	`dœÇme
(
__fe__
),

215 
roÙ
.
çvicÚ_ico
 = 
toŞs
.
¡©icfe
.
	$hªdËr
(
çvicÚ
)

217 
cÚfig
:

218 
­p
.
	$m”ge
(
cÚfig
)

220 
£lf
.
­ps
[
süt_Çme
] = 
­p


222  
­p


224 
def
 
	`g¿á
(
£lf
, 
wsgi_ÿÎabË
, 
süt_Çme
=""):

226 #Nexˆ
lše
 
bÙh
 1è
¡rs
 
Œašg
 
¦ash
 
ªd
 2è
m­s
 "/" -> "".

227 
süt_Çme
 = süt_Çme.
	`r¡r
("/")

228 
£lf
.
­ps
[
süt_Çme
] = 
wsgi_ÿÎabË


230 
def
 
	$süt_Çme
(
£lf
, 
·th
=
NÚe
):

233 
If
 
·th
 
is
 
NÚe
, 
ch”rypy
.
»que¡
 i 
u£d
.

235 
·th
 
is
 
NÚe
:

236 
Œy
:

237 
»que¡
 = 
ch”rypy
.
£rvšg
.request

238 
·th
 = 
h‰put
.
	$u¾još
(
»que¡
.
süt_Çme
,

239 
»que¡
.
·th_šfo
)

240 
exû±
 
A‰ribu‹E¼Ü
:

241  
NÚe


243 
True
:

244 
·th
 
š
 
£lf
.
­ps
:

245  
·th


247 
·th
 == "":

248  
NÚe


250 #Mov
Úe
 
node
 
up
 
the
 
Œ“
 
ªd
 
Œy
 
agaš
.

251 
·th
 =…©h[:·th.
	`rfšd
("/")]

253 
def
 
	$__ÿÎ__
(
£lf
, 
’vœÚ
, 
¡¬t_»¥Ú£
):

254 #Ià
you
'» c®lšghis,h’ you'
»
 
´obably
 
£‰šg
 
SCRIPT_NAME


255 #tØ'' (
some
 
WSGI
 
£rv”s
 
®ways
 
£t
 
SCRIPT_NAME
 
to
 '').

256 #Try 
to
 
look
 
up
 
the
 
­p
 
usšg
h
fuÎ
 
·th
.

257 
’v1x
 = 
’vœÚ


258 
’vœÚ
.
	`g‘
(
	`Áou
('wsgi.version')) == (ntou('u'), 0):

259 
’v1x
 = 
_ıwsgi
.
	$downg¿de_wsgi_ux_to_1x
(
’vœÚ
)

260 
·th
 = 
h‰put
.
	`u¾još
(
’v1x
.
	`g‘
('SCRIPT_NAME', ''),

261 
’v1x
.
	`g‘
('PATH_INFO', ''))

262 
¢
 = 
£lf
.
	`süt_Çme
(
·th
 
Ü
 "/")

263 
¢
 
is
 
NÚe
:

264 
	`¡¬t_»¥Ú£
('404 Not Found', [])

267 
­p
 = 
£lf
.
­ps
[
¢
]

269 #CÜ»ù 
the
 
SCRIPT_NAME
 
ªd
 
PATH_INFO
 
’vœÚ
 
’Œ›s
.

270 
’vœÚ
 =ƒnvœÚ.
	$cİy
()

271 
nÙ
 
py3k
:

272 
’vœÚ
.
	`g‘
(
	`Áou
('wsgi.version')) == (ntou('u'), 0):

273 #PythÚ 2/
WSGI
 
u
.0: 
®l
 
¡ršgs
 
MUST
 
be
 
of
 
ty³
 
unicode


274 
’c
 = 
’vœÚ
[
	`Áou
('wsgi.url_encoding')]

275 
’vœÚ
[
	`Áou
('SCRIPT_NAME')] = 
¢
.
	$decode
(
’c
)

276 
’vœÚ
[
	`Áou
('PATH_INFO')] = 
·th
[
	`Ën
(
¢
.
	`r¡r
("/")):].
	$decode
(
’c
)

278 #PythÚ 2/
WSGI
 1.x: 
®l
 
¡ršgs
 
MUST
 
be
 
of
 
ty³
 
¡r


279 
’vœÚ
['SCRIPT_NAME'] = 
¢


280 
’vœÚ
['PATH_INFO'] = 
·th
[
	`Ën
(
¢
.
	`r¡r
("/")):]

282 
’vœÚ
.
	`g‘
(
	`Áou
('wsgi.version')) == (ntou('u'), 0):

283 #PythÚ 3/
WSGI
 
u
.0: 
®l
 
¡ršgs
 
MUST
 
be
 
fuÎ
 
unicode


284 
’vœÚ
['SCRIPT_NAME'] = 
¢


285 
’vœÚ
['PATH_INFO'] = 
·th
[
	`Ën
(
¢
.
	`r¡r
("/")):]

287 #PythÚ 3/
WSGI
 1.x: 
®l
 
¡ršgs
 
MUST
 
be
 
ISO
-8859-1 
¡r


288 
’vœÚ
['SCRIPT_NAME'] = 
¢
.
	`’code
('utf-8').
	`decode
('ISO-8859-1')

289 
’vœÚ
['PATH_INFO'] = 
·th
[
	`Ën
(
¢
.
	`r¡r
("/")):].
	`’code
('utf-8').
	`decode
('ISO-8859-1')

290  
	`­p
(
’vœÚ
, 
¡¬t_»¥Ú£
)

	@trunk/objs/CherryPy-3.2.4/cherrypy/_cpwsgi.py

3 
NÙe
 
th©
 
WSGI
 
’vœÚ
 
keys
 
ªd
 
v®ues
 
	g¬e
 'Çtiv¡ršgs';h© 
	gis
,

4 
wh©ev”
 
the
 
ty³
 
	gof
 "" 
	gis
. 
FÜ
 
	gPythÚ
 2, 
	gth©
's‡ byte string; for Python 3,

5 
	g™
' ¨unicod¡ršg. BuˆPEP 3333 says: "ev’ iàPythÚ'
s
 
¡r
 
ty³
 
is


6 
aùu®ly
 
	gUnicode
 "und”hhood", 
the
 
cÚ‹Á
 
of
 
Çtive
 
¡ršgs
 
mu¡


7 
¡l
 
be
 
Œª¦©abË
 
to
 
by‹s
 
vŸ
 
the
 
	gL©š
-1 
	g’codšg
!"

10 
impÜt
 
sys
 
as
 
_sys


12 
impÜt
 
ch”rypy
 
as
 
_ch”rypy


13 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
	gBy‹sIO
, 
	gby‹¡r
, 
	gÁob
, 
	gÁou
, 
	gpy3k
, 
unicode¡r


14 
äom
 
ch”rypy
 
impÜt
 
_ı”rÜ


15 
äom
 
	gch”rypy
.
lib
 
impÜt
 
h‰put


18 
def
 
	$downg¿de_wsgi_ux_to_1x
(
’vœÚ
):

20 
’v1x
 = {
	}
}

22 
u¾_’codšg
 = 
’vœÚ
[
Áou
('wsgi.url_encoding')]

23 
k
, 
v
 
š
 
li¡
(
’vœÚ
.
	$™ems
()):

24 
k
 
š
 [
	`Áou
('PATH_INFO'),‚tou('SCRIPT_NAME'),‚tou('QUERY_STRING')]:

25 
v
 = v.
	$’code
(
u¾_’codšg
)

26 
–if
 
	$isš¡ªû
(
v
, 
unicode¡r
):

27 
v
 = v.
	`’code
('ISO-8859-1')

28 
’v1x
[
k
.
	`’code
('ISO-8859-1')] = 
v


30  
’v1x


33 
şass
 
	$Vœtu®Ho¡
(
objeù
):

36 
This
 
ÿn
 
be
 
u£ful
 
wh’
 
ruÂšg
 
muÉË
 
s™es
 
w™hš
 
Úe
 
CP
 
£rv”
.

37 
It
 
®lows
 
£v”®
 
domašs
 
to
 
pošt
Ø
difã»Á
 
­¶iÿtiÚs
. 
FÜ
 
exam¶e
::

39 
roÙ
 = 
	$RoÙ
()

40 
RoÙAµ
 = 
ch”rypy
.
	$AµliÿtiÚ
(
roÙ
)

41 
Domaš2Aµ
 = 
ch”rypy
.
	$AµliÿtiÚ
(
roÙ
)

42 
Secu»Aµ
 = 
ch”rypy
.
	`AµliÿtiÚ
(
	$Secu»
())

44 
vho¡
 = 
ch”rypy
.
_ıwsgi
.
	`Vœtu®Ho¡
(
RoÙAµ
,

45 
domašs
={'www.domaš2.exam¶e': 
Domaš2Aµ
,

46 'www.domaš2.exam¶e:443': 
Secu»Aµ
,

47 
	}
})

49 
ch”rypy
.
Œ“
.
g¿á
(
vho¡
)

51  = 
NÚe


54 
u£_x_fÜw¬ded_ho¡
 = 
True


55 """IàTruÑhdeçuÉ),‡ny "
X
-
FÜw¬ded
-
Ho¡
"

56 
»que¡
 
h—d”
 
wl
 
be
 
u£d
 
š¡—d
 
of
 
the
 "Ho¡" h—d”. 
This


57 
is
 
commÚly
 
added
 
by
 
HTTP
 
	$£rv”s
 (
such
 
as
 
A·che
è
wh’
 
´oxyšg
."""

59 
domašs
 = {
	}
}

61 
The
 
šcomšg
 "Ho¡" 
»que¡
 
h—d”
 
is
 
looked
 
up
 
š
 
this
 
diù
,

62 
	gªd
, 
a
 
m©ch
 
is
 
	gfound
, 
the
 
cÜ»¥Údšg
 
WSGI
 
­¶iÿtiÚ


63 
wl
 
be
 
ÿÎed
 
š¡—d
 
of
 
the
 . 
NÙe
 
th©
 
you
 
oá’
 
Ãed


64 
£·¿‹
 
’Œ›s
 "exam¶e.com" 
	gªd
 "www.example.com".

65 
In
 
	gadd™iÚ
, "Ho¡" 
h—d”s
 
may
 
cÚš
 
the
 
pÜt
 
	gnumb”
.

68 
def
 
	$__š™__
(
£lf
, , 
domašs
=
NÚe
, 
u£_x_fÜw¬ded_ho¡
=
True
):

69 
£lf
. = 

70 
£lf
.
domašs
 = domaš 
Ü
 {
	}
}

71 
£lf
.
u£_x_fÜw¬ded_ho¡
 = use_x_forwarded_host

73 
def
 
	$__ÿÎ__
(
£lf
, 
’vœÚ
, 
¡¬t_»¥Ú£
):

74 
domaš
 = 
’vœÚ
.
	`g‘
('HTTP_HOST', '')

75 
£lf
.
u£_x_fÜw¬ded_ho¡
:

76 
domaš
 = 
’vœÚ
.
	`g‘
("HTTP_X_FORWARDED_HOST", domain)

78 
Ãxµ
 = 
£lf
.
domašs
.
	$g‘
(
domaš
)

79 
Ãxµ
 
is
 
NÚe
:

80 
Ãxµ
 = 
£lf
.

81  
	$Ãxµ
(
’vœÚ
, 
¡¬t_»¥Ú£
)

84 
şass
 
	$IÁ”ÇlRedœeùÜ
(
objeù
):

87 
def
 
	$__š™__
(
£lf
, 
Ãxµ
, 
»cursive
=
F®£
):

88 
£lf
.
Ãxµ
 =‚extapp

89 
£lf
.
»cursive
 =„ecursive

91 
def
 
	$__ÿÎ__
(
£lf
, 
’vœÚ
, 
¡¬t_»¥Ú£
):

92 
»dœeùiÚs
 = []

93 
True
:

94 
’vœÚ
 =ƒnvœÚ.
	$cİy
()

95 
Œy
:

96  
£lf
.
	$Ãxµ
(
’vœÚ
, 
¡¬t_»¥Ú£
)

97 
exû±
 
_ch”rypy
.
IÁ”ÇlRedœeù
:

98 
œ
 = 
_sys
.
	`exc_šfo
()[1]

99 
¢
 = 
’vœÚ
.
	`g‘
('SCRIPT_NAME', '')

100 
·th
 = 
’vœÚ
.
	`g‘
('PATH_INFO', '')

101 
qs
 = 
’vœÚ
.
	`g‘
('QUERY_STRING', '')

103 #Add 
the
 *
´evious
* 
·th_šfo
 + 
qs
 
to
 
»dœeùiÚs
.

104 
Şd_uri
 = 
¢
 + 
·th


105 
qs
:

106 
Şd_uri
 +ğ"?" + 
qs


107 
»dœeùiÚs
.
	$­³nd
(
Şd_uri
)

109 
nÙ
 
£lf
.
»cursive
:

110 #Check 
to
 
£e
 
the
 
Ãw
 
URI
 
has
 
b“n
 
»dœeùed
Ø
®»ady


111 
Ãw_uri
 = 
¢
 + 
œ
.
·th


112 
œ
.
qu”y_¡ršg
:

113 
Ãw_uri
 +ğ"?" + 
œ
.
qu”y_¡ršg


114 
Ãw_uri
 
š
 
»dœeùiÚs
:

115 
œ
.
»que¡
.
	$şo£
()

116 
¿i£
 
	`RuÁimeE¼Ü
("InternalRedirector visitedhe "

117 "§mURLwiû: %r" % 
Ãw_uri
)

119 #Mung
the
 
’vœÚm’t
 
ªd
 
Œy
 
agaš
.

120 
’vœÚ
['REQUEST_METHOD'] = "GET"

121 
’vœÚ
['PATH_INFO'] = 
œ
.
·th


122 
’vœÚ
['QUERY_STRING'] = 
œ
.
qu”y_¡ršg


123 
’vœÚ
['wsgi.šput'] = 
	$By‹sIO
()

124 
’vœÚ
['CONTENT_LENGTH'] = "0"

125 
’vœÚ
['ch”rypy.´evious_»que¡'] = 
œ
.
»que¡


128 
şass
 
	$Exû±iÚT¿µ”
(
objeù
):

131 
def
 
	`__š™__
(
£lf
, 
Ãxµ
, 
throws
=(
KeybßrdIÁ”ru±
, 
Sy¡emEx™
)):

132 
£lf
.
Ãxµ
 =‚extapp

133 
£lf
.
throws
 =hrows

135 
def
 
	$__ÿÎ__
(
£lf
, 
’vœÚ
, 
¡¬t_»¥Ú£
):

136  
	$_T¿µedRe¥Ú£
(
£lf
.
Ãxµ
, 
’vœÚ
, 
¡¬t_»¥Ú£
, s–f.
throws
)

139 
şass
 
	$_T¿µedRe¥Ú£
(
objeù
):

141 
»¥Ú£
 = 
	$™”
([])

143 
def
 
	$__š™__
(
£lf
, 
Ãxµ
, 
’vœÚ
, 
¡¬t_»¥Ú£
, 
throws
):

144 
£lf
.
Ãxµ
 =‚extapp

145 
£lf
.
’vœÚ
 =ƒnviron

146 
£lf
.
¡¬t_»¥Ú£
 = start_response

147 
£lf
.
throws
 =hrows

148 
£lf
.
¡¬‹d_»¥Ú£
 = 
F®£


149 
£lf
.
»¥Ú£
 = s–f.
	$Œ­
(
£lf
.
Ãxµ
, s–f.
’vœÚ
, s–f.
¡¬t_»¥Ú£
)

150 
£lf
.
™”_»¥Ú£
 = 
	$™”
(
£lf
.
»¥Ú£
)

152 
def
 
	$__™”__
(
£lf
):

153 
£lf
.
¡¬‹d_»¥Ú£
 = 
True


154  
£lf


156 
py3k
:

157 
def
 
	$__Ãxt__
(
£lf
):

158  
£lf
.
	$Œ­
(
Ãxt
, 
£lf
.
™”_»¥Ú£
)

160 
def
 
	$Ãxt
(
£lf
):

161  
£lf
.
	$Œ­
(
£lf
.
™”_»¥Ú£
.
Ãxt
)

163 
def
 
	$şo£
(
£lf
):

164 
	`ha§‰r
(
£lf
.
»¥Ú£
, 'close'):

165 
£lf
.
»¥Ú£
.
	$şo£
()

167 
def
 
	$Œ­
(
£lf
, 
func
, *
¬gs
, **
kw¬gs
):

168 
Œy
:

169  
	$func
(*
¬gs
, **
kw¬gs
)

170 
exû±
 
£lf
.
throws
:

171 
¿i£


172 
exû±
 
StİI‹¿tiÚ
:

173 
¿i£


174 
exû±
:

175 
tb
 = 
_ı”rÜ
.
	$fÜm©_exc
()

176 #´št('Œ­³d (¡¬‹d %s):' % 
£lf
.
¡¬‹d_»¥Ú£
, 
tb
)

177 
_ch”rypy
.
	$log
(
tb
, 
£v”™y
=40)

178 
nÙ
 
_ch”rypy
.
»que¡
.
show_Œaûbacks
:

179 
tb
 = ""

180 
s
, 
h
, 
b
 = 
_ı”rÜ
.
	$b¬e_”rÜ
(
tb
)

181 
py3k
:

182 #Wh© 
fun
.

183 
s
 = s.
	`decode
('ISO-8859-1')

184 
h
 = [(
k
.
	`decode
('ISO-8859-1'), 
v
.decode('ISO-8859-1'))

185 
k
, 
v
 
š
 
h
]

186 
£lf
.
¡¬‹d_»¥Ú£
:

187 #Em±y 
our
 
	`™”abË
 (
so
 
futu»
 
ÿÎs
 
¿i£
 
StİI‹¿tiÚ
)

188 
£lf
.
™”_»¥Ú£
 = 
	$™”
([])

190 
£lf
.
™”_»¥Ú£
 = 
	$™”
(
b
)

192 
Œy
:

193 
£lf
.
	`¡¬t_»¥Ú£
(
s
, 
h
, 
_sys
.
	$exc_šfo
())

194 
exû±
:

195 #"
The
 
­¶iÿtiÚ
 
mu¡
 
nÙ
 
Œ­
 
ªy
 
exû±iÚs
 
¿i£d
 
by


196 #¡¬t_»¥Ú£, 
™
 
ÿÎed
 
¡¬t_»¥Ú£
 
w™h
 
exc_šfo
.

197 #In¡—d, 
™
 
should
 
®low
 
such
 
exû±iÚs
 
to
 
´İag©e


198 #back 
to
 
the
 
£rv”
 
Ü
 
g©eway
."

199 #Buˆ
we
 
¡l
 
log
 
ªd
 
ÿÎ
 
	`şo£
(è
to
 
ş—n
 
up
 
our£lves
.

200 
_ch”rypy
.
	$log
(
Œaûback
=
True
, 
£v”™y
=40)

201 
¿i£


203 
£lf
.
¡¬‹d_»¥Ú£
:

204  
	`Áob
("").
	$još
(
b
)

206  
b


209 #WSGI-
to
-
CP
 
Ad­‹r
 #


211 
şass
 
	$AµRe¥Ú£
(
objeù
):

214 
def
 
	$__š™__
(
£lf
, 
’vœÚ
, 
¡¬t_»¥Ú£
, 
ı­p
):

215 
£lf
.
ı­p
 = cpapp

216 
Œy
:

217 
nÙ
 
py3k
:

218 
’vœÚ
.
	`g‘
(
	`Áou
('wsgi.version')) == (ntou('u'), 0):

219 
’vœÚ
 = 
	$downg¿de_wsgi_ux_to_1x
(
’vœÚ
)

220 
£lf
.
’vœÚ
 =ƒnviron

221 
£lf
.
	$run
()

223 
r
 = 
_ch”rypy
.
£rvšg
.
»¥Ú£


225 
out¡©us
 = 
r
.
ouut_¡©us


226 
nÙ
 
	$isš¡ªû
(
out¡©us
, 
by‹¡r
):

227 
¿i£
 
	`Ty³E¼Ü
("response.output_status is‚ot‡ byte string.")

229 
outh—d”s
 = []

230 
k
, 
v
 
š
 
r
.
h—d”_li¡
:

231 
nÙ
 
	$isš¡ªû
(
k
, 
by‹¡r
):

232 
¿i£
 
	`Ty³E¼Ü
("»¥Ú£.h—d”_li¡ key %¸i nÙ‡ by‹ sŒšg." % 
k
)

233 
nÙ
 
	$isš¡ªû
(
v
, 
by‹¡r
):

234 
¿i£
 
	`Ty³E¼Ü
("»¥Ú£.h—d”_li¡ v®u%¸i nÙ‡ by‹ sŒšg." % 
v
)

235 
outh—d”s
.
	`­³nd
((
k
, 
v
))

237 
py3k
:

238 #AccÜdšg 
to
 
PEP
 3333, 
wh’
 
usšg
 
PythÚ
 3, 
the
 
»¥Ú£
 
¡©us


239 #ªd 
h—d”s
 
mu¡
 
be
 
by‹s
 
masqu”adšg
 
as
 
unicode
; 
th©
 
is
, 
they


240 #mu¡ 
be
 
of
 
ty³
 "¡r" 
but
 
¬e
 
»¡riùed
 
to
 
code
 
pošts
 
š
 
the


241 #"
Ïtš
-1" set.

242 
out¡©us
 = out¡©us.
	`decode
('ISO-8859-1')

243 
outh—d”s
 = [(
k
.
	`decode
('ISO-8859-1'), 
v
.decode('ISO-8859-1'))

244 
k
, 
v
 
š
 
outh—d”s
]

246 
£lf
.
™”_»¥Ú£
 = 
	$™”
(
r
.
body
)

247 
£lf
.
wr™e
 = 
	$¡¬t_»¥Ú£
(
out¡©us
, 
outh—d”s
)

248 
exû±
:

249 
£lf
.
	$şo£
()

250 
¿i£


252 
def
 
	$__™”__
(
£lf
):

253  
£lf


255 
py3k
:

256 
def
 
	$__Ãxt__
(
£lf
):

257  
	$Ãxt
(
£lf
.
™”_»¥Ú£
)

259 
def
 
	$Ãxt
(
£lf
):

260  
£lf
.
™”_»¥Ú£
.
	$Ãxt
()

262 
def
 
	$şo£
(
£lf
):

264 
£lf
.
ı­p
.
	$»Ëa£_£rvšg
()

266 
def
 
	$run
(
£lf
):

268 
’v
 = 
£lf
.
’vœÚ
.
g‘


270 
loÿl
 = 
h‰put
.
	`Ho¡
('', (
	`’v
('SERVER_PORT', 80)),

271 
	`’v
('SERVER_NAME', ''))

272 
»mÙe
 = 
h‰put
.
	`Ho¡
(
	`’v
('REMOTE_ADDR', ''),

273 (
	`’v
('REMOTE_PORT', -1è
Ü
 -1),

274 
	`’v
('REMOTE_HOST', ''))

275 
scheme
 = 
	`’v
('wsgi.url_scheme')

276 
¥rÙo
 = 
	`’v
('ACTUAL_SERVER_PROTOCOL', "HTTP/1.1")

277 
»que¡
, 
»¥
 = 
£lf
.
ı­p
.
	$g‘_£rvšg
(
loÿl
, 
»mÙe
, 
scheme
, 
¥rÙo
)

279 #LOGON_USER 
is
 
£rved
 
by
 
IIS
, 
ªd
 i 
the
 
Çme
 
of
he

280 #u£¸
aá”
 
havšg
 
b“n
 
m­³d
 
to
 
a
 
loÿl
 
accouÁ
.

281 #BÙh 
IIS
 
ªd
 
A·che
 
£t
 
REMOTE_USER
, 
wh’
 
possibË
.

282 
»que¡
.
logš
 = 
	`’v
('LOGON_USER'è
Ü
ƒnv('REMOTE_USER'èÜ 
NÚe


283 
»que¡
.
muÉ™h»ad
 = 
£lf
.
’vœÚ
['wsgi.multithread']

284 
»que¡
.
muÉroûss
 = 
£lf
.
’vœÚ
['wsgi.multiprocess']

285 
»que¡
.
wsgi_’vœÚ
 = 
£lf
.
’vœÚ


286 
»que¡
.
´ev
 = 
	`’v
('ch”rypy.´evious_»que¡', 
NÚe
)

288 
m‘h
 = 
£lf
.
’vœÚ
['REQUEST_METHOD']

290 
·th
 = 
h‰put
.
	`u¾još
(
£lf
.
’vœÚ
.
	`g‘
('SCRIPT_NAME', ''),

291 
£lf
.
’vœÚ
.
	`g‘
('PATH_INFO', ''))

292 
qs
 = 
£lf
.
’vœÚ
.
	`g‘
('QUERY_STRING', '')

294 
py3k
:

295 #Thi 
i¢
't…erfect; ifhe given PATH_INFO is inhe wrongƒncoding,

296 #™ 
may
 
ç
 
to
 
m©ch
 
the
 
­´İrŸ‹
 
cÚfig
 
£ùiÚ
 
URI
. 
But
 
meh
.

297 
Şd_’c
 = 
£lf
.
’vœÚ
.
	`g‘
('wsgi.url_encoding', 'ISO-8859-1')

298 
Ãw_’c
 = 
£lf
.
ı­p
.
	`fšd_cÚfig
(£lf.
’vœÚ
.
	`g‘
('PATH_INFO', ''),

300 
Ãw_’c
.
	`low”
(è!ğ
Şd_’c
.
	$low”
():

301 #Ev’ 
though
 
the
 
·th
 
ªd
 
qs
 
¬e
 
unicode
,h
WSGI
 
£rv”
 
is


302 #»quœed 
by
 
PEP
 3333 
to
 
cÛrû
 
them
Ø
ISO
-8859-1 
masqu”adšg


303 #a 
unicode
. 
So
 
we
 
have
 
to
 
’code
 
back
Ø
by‹s
 
ªd
 
th’
 
decode


304 #agaš 
usšg
 
the
 "cÜ»ù" 
’codšg
.

305 
Œy
:

306 
u_·th
 = 
·th
.
	`’code
(
Şd_’c
).
	$decode
(
Ãw_’c
)

307 
u_qs
 = 
qs
.
	`’code
(
Şd_’c
).
	$decode
(
Ãw_’c
)

308 
	$exû±
 (
UnicodeEncodeE¼Ü
, 
UnicodeDecodeE¼Ü
):

309 #Ju¡ 
·ss
 
them
 
through
 
w™hout
 
Œªscodšg
 
ªd
 
hİe
.

310 
·ss


312 #OÆy 
£t
 
Œªscoded
 
v®ues
 
they
 
bÙh
 
sucûed
.

313 
·th
 = 
u_·th


314 
qs
 = 
u_qs


316 
½rÙo
 = 
£lf
.
’vœÚ
.
	`g‘
('SERVER_PROTOCOL')

317 
h—d”s
 = 
£lf
.
	$Œª¦©e_h—d”s
(
£lf
.
’vœÚ
)

318 
rfe
 = 
£lf
.
’vœÚ
['wsgi.input']

319 
»que¡
.
	$run
(
m‘h
, 
·th
, 
qs
, 
½rÙo
, 
h—d”s
, 
rfe
)

321 
h—d”Names
 = {'HTTP_CGI_AUTHORIZATION': 'Authorization',

326 
	}
}

328 
def
 
	$Œª¦©e_h—d”s
(
£lf
, 
’vœÚ
):

330 
cgiName
 
š
 
’vœÚ
:

331 #W
assume
 
®l
 
šcomšg
 
h—d”
 
keys
 
¬e
 
uµ”ÿ£
 
®»ady
.

332 
cgiName
 
š
 
£lf
.
h—d”Names
:

333 
y›ld
 
£lf
.
h—d”Names
[
cgiName
], 
’vœÚ
[cgiName]

334 
–if
 
cgiName
[:5] == "HTTP_":

335 #Hackish 
©‹m±
 
©
 
»cov”šg
 
Üigš®
 
h—d”
 
Çmes
.

336 
Œª¦©edH—d”
 = 
cgiName
[5:].
	`»¶aû
("_", "-")

337 
y›ld
 
Œª¦©edH—d”
, 
’vœÚ
[
cgiName
]

340 
şass
 
	$CPWSGIAµ
(
objeù
):

343 
p–še
 = [('Exû±iÚT¿µ”', 
Exû±iÚT¿µ”
),

344 ('IÁ”ÇlRedœeùÜ', 
IÁ”ÇlRedœeùÜ
),

347 
cÚ¡ruùÜ
 
th©
 
kes
 
ª
 
š™Ÿl
, 
pos™iÚ®
 'Ãxµ' 
¬gum’t
,

348 
¶us
 
İtiÚ®
 
keywÜd
 
¬gum’ts
, 
ªd
 
»tuºs
 
a
 
WSGI
 
­¶iÿtiÚ


349 (
th©
 
kes
 
’vœÚ
 
ªd
 
¡¬t_»¥Ú£
 
¬gum’ts
). 
The
 'Çme' 
ÿn


350 
be
 
ªy
 
you
 
choo£
, 
ªd
 
wl
 
cÜ»¥Úd
 
to
 
keys
 
š
 
£lf
.
cÚfig
."""

352 
h—d
 = 
NÚe


354 
dÚe
 
the
 
fœ¡
 
time
, 
ªd
h
»suÉ
 
is
 
memoized
 
što
 
£lf
.
h—d
. 
S‘


355 
this
 
to
 
NÚe
 
agaš
 
you
 
chªge
 
£lf
.
p–še
 
aá”
 
ÿÎšg
 self."""

357 
cÚfig
 = {
	}
}

359 
v®ue
 
is
 
a
 
fu¹h”
 
diù
 
which
 
wl
 
be
 
·s£d
 
to
 
the
 
cÜ»¥Údšg


360 
Çmed
 
WSGI
 
	$ÿÎabË
 (
äom
 
the
 
p–še
è
as
 
keywÜd
 
¬gum’ts
."""

362 
»¥Ú£_şass
 = 
AµRe¥Ú£


365 
def
 
	$__š™__
(
£lf
, 
ı­p
, 
p–še
=
NÚe
):

366 
£lf
.
ı­p
 = cpapp

367 
£lf
.
p–še
 = self.pipeline[:]

368 
p–še
:

369 
£lf
.
p–še
.
	$ex‹nd
(
p–še
)

370 
£lf
.
cÚfig
 = s–f.cÚfig.
	$cİy
()

372 
def
 
	$
(
£lf
, 
’vœÚ
, 
¡¬t_»¥Ú£
):

375 
You
 
´obably
 
shouldn
't callhis; call self.__call__ instead,

376 
so
 
th©
 
ªy
 
WSGI
 
middËw¬e
 
š
 
£lf
.
p–še
 
ÿn
 
run
 
fœ¡
.

378  
£lf
.
	$»¥Ú£_şass
(
’vœÚ
, 
¡¬t_»¥Ú£
, 
£lf
.
ı­p
)

380 
def
 
	$__ÿÎ__
(
£lf
, 
’vœÚ
, 
¡¬t_»¥Ú£
):

381 
h—d
 = 
£lf
.head

382 
h—d
 
is
 
NÚe
:

383 #C»©
ªd
 
Ã¡
 
the
 
WSGI
 
­ps
 
š
 
our
 
	`p–še
 (š 
»v”£
 
Üd”
).

384 #Th’ 
memoize
 
the
 
»suÉ
 
š
 
£lf
.
h—d
.

385 
h—d
 = 
£lf
.



386 
Çme
, 
ÿÎabË
 
š
 
£lf
.
p–še
[::-1]:

387 
cÚf
 = 
£lf
.
cÚfig
.
	`g‘
(
Çme
, {
	}
})

388 
	gh—d
 = 
	$ÿÎabË
(
h—d
, **
cÚf
)

389 
£lf
.
h—d
 = head

390  
	$h—d
(
’vœÚ
, 
¡¬t_»¥Ú£
)

392 
def
 
	$Çme¥aû_hªdËr
(
£lf
, 
k
, 
v
):

394 
k
 == "pipeline":

395 #NÙ
this
 
®lows
 
muÉË
 'wsgi.p–še' 
cÚfig
 
’Œ›s


396 #(
but
 
—ch
 
’Œy
 
wl
 
be
 
´oûs£d
 
š
 
a
 '¿ndom' 
Üd”
).

397 #Iˆ
should
 
®so
 
®low
 
dev–İ”s
 
to
 
£t
  
middËw¬e


398 #š 
	`code
 (
·s£d
 
to
 
£lf
.
__š™__
è
th©
 
d•loy”s
 
ÿn
 
add
o

399 #(
but
 
nÙ
 
»move
è
vŸ
 
cÚfig
.

400 
£lf
.
p–še
.
	$ex‹nd
(
v
)

401 
–if
 
k
 == "response_class":

402 
£lf
.
»¥Ú£_şass
 = 
v


404 
Çme
, 
¬g
 = 
k
.
	`¥l™
(".", 1)

405 
buck‘
 = 
£lf
.
cÚfig
.
	`£tdeçuÉ
(
Çme
, {
	}
})

406 
	gbuck‘
[
¬g
] = 
v


	@trunk/objs/CherryPy-3.2.4/cherrypy/_cpwsgi_server.py

2 
the
 
	gäamewÜk
-
agno¡ic
 
wsgi£rv”
 
	g·ckage
.

4 
impÜt
 
sys


6 
impÜt
 
ch”rypy


7 
äom
 
ch”rypy
 
impÜt
 
wsgi£rv”


10 
şass
 
	$CPWSGIS”v”
(
wsgi£rv”
.
Ch”ryPyWSGIS”v”
):

13 
wsgi£rv”
 
has
 
b“n
 
desigÃd
 
to
 
nÙ
 
»ã»nû
 
Ch”ryPy
 
š
 
ªy
 
way
,

14 
so
 
th©
 
™
 
ÿn
 
be
 
u£d
 
š
 
Ùh”
 
äamewÜks
 
ªd
 
­¶iÿtiÚs
. 
Th”efÜe
,

15 
we
 
w¿p
 
™
 
h”e
, 
so
 w
ÿn
 
£t
 
our
 
own
 
mouÁ
 
pošts
 
äom
 
ch”rypy
.
Œ“


16 
ªd
 
­¶y
 
some
 
©Œibu‹s
 
äom
 
cÚfig
 -> 
ch”rypy
.
£rv”
 -> 
wsgi£rv”
.

19 
def
 
	$__š™__
(
£lf
, 
£rv”_ad­‹r
=
ch”rypy
.
£rv”
):

20 
£lf
.
£rv”_ad­‹r
 = server_adapter

21 
£lf
.
max_»que¡_h—d”_size
 = s–f.
£rv”_ad­‹r
.max_»que¡_h—d”_siz
Ü
 0

22 
£lf
.
max_»que¡_body_size
 = s–f.
£rv”_ad­‹r
.max_»que¡_body_siz
Ü
 0

24 
£rv”_Çme
 = (
£lf
.
£rv”_ad­‹r
.
sock‘_ho¡
 
Ü


25 
£lf
.
£rv”_ad­‹r
.
sock‘_fe
 
Ü


26 
NÚe
)

28 
£lf
.
wsgi_v”siÚ
 = s–f.
£rv”_ad­‹r
.wsgi_version

29 
s
 = 
wsgi£rv”
.
Ch”ryPyWSGIS”v”


30 
s
.
	$__š™__
(
£lf
, 
£rv”_ad­‹r
.
bšd_addr
, 
ch”rypy
.
Œ“
,

31 
£lf
.
£rv”_ad­‹r
.
th»ad_poŞ
,

32 
£rv”_Çme
,

33 
max
 = 
£lf
.
£rv”_ad­‹r
.
th»ad_poŞ_max
,

34 
»que¡_queue_size
 = 
£lf
.
£rv”_ad­‹r
.
sock‘_queue_size
,

35 
timeout
 = 
£lf
.
£rv”_ad­‹r
.
sock‘_timeout
,

36 
shutdown_timeout
 = 
£lf
.
£rv”_ad­‹r
.shutdown_timeout,

38 
£lf
.
´ÙocŞ
 = s–f.
£rv”_ad­‹r
.
´ÙocŞ_v”siÚ


39 
£lf
.
nod–ay
 = s–f.
£rv”_ad­‹r
.nodelay

41 
sys
.
v”siÚ_šfo
 >= (3, 0):

42 
s¦_moduË
 = 
£lf
.
£rv”_ad­‹r
.s¦_moduË 
Ü
 'builtin'

44 
s¦_moduË
 = 
£lf
.
£rv”_ad­‹r
.s¦_moduË 
Ü
 'pyopenssl'

45 
£lf
.
£rv”_ad­‹r
.
s¦_cÚ‹xt
:

46 
ad­‹r_şass
 = 
wsgi£rv”
.
	$g‘_s¦_ad­‹r_şass
(
s¦_moduË
)

47 
£lf
.
s¦_ad­‹r
 = 
	$ad­‹r_şass
(

48 
£lf
.
£rv”_ad­‹r
.
s¦_û¹ifiÿ‹
,

49 
£lf
.
£rv”_ad­‹r
.
s¦_´iv©e_key
,

50 
£lf
.
£rv”_ad­‹r
.
s¦_û¹ifiÿ‹_chaš
)

51 
£lf
.
s¦_ad­‹r
.
cÚ‹xt
 = s–f.
£rv”_ad­‹r
.
s¦_cÚ‹xt


52 
–if
 
£lf
.
£rv”_ad­‹r
.
s¦_û¹ifiÿ‹
:

53 
ad­‹r_şass
 = 
wsgi£rv”
.
	$g‘_s¦_ad­‹r_şass
(
s¦_moduË
)

54 
£lf
.
s¦_ad­‹r
 = 
	$ad­‹r_şass
(

55 
£lf
.
£rv”_ad­‹r
.
s¦_û¹ifiÿ‹
,

56 
£lf
.
£rv”_ad­‹r
.
s¦_´iv©e_key
,

57 
£lf
.
£rv”_ad­‹r
.
s¦_û¹ifiÿ‹_chaš
)

59 
£lf
.
¡©s
['EÇbËd'] = 
	`g‘©Œ
(£lf.
£rv”_ad­‹r
, '¡©i¡ics', 
F®£
)

61 
def
 
	`”rÜ_log
(
£lf
, 
msg
="", 
Ëv–
=20, 
Œaûback
=
F®£
):

62 
ch”rypy
.
’gše
.
	`log
(
msg
, 
Ëv–
, 
Œaûback
)

	@trunk/objs/CherryPy-3.2.4/cherrypy/lib/__init__.py

3 #D•»ÿ‹d 
š
 
Ch”ryPy
 3.2 -- 
»move
 in CherryPy 3.3

4 
äom
 
	gch”rypy
.
	glib
.
»´cÚf
 
impÜt
 
	guÄ•r
, 
	gmoduËs
, 
©Œibu‹s


6 
şass
 
	$fe_g’”©Ü
(
objeù
):

9 
def
 
	$__š™__
(
£lf
, 
šput
, 
chunkSize
=65536):

10 
£lf
.
šput
 = input

11 
£lf
.
chunkSize
 = chunkSize

13 
def
 
	$__™”__
(
£lf
):

14  
£lf


16 
def
 
	$__Ãxt__
(
£lf
):

17 
chunk
 = 
£lf
.
šput
.
	$»ad
(
£lf
.
chunkSize
)

18 
chunk
:

19  
chunk


21 
	`ha§‰r
(
£lf
.
šput
, 'close'):

22 
£lf
.
šput
.
	$şo£
()

23 
¿i£
 
	$StİI‹¿tiÚ
()

24 
Ãxt
 = 
__Ãxt__


26 
def
 
	$fe_g’”©Ü_lim™ed
(
feobj
, 
couÁ
, 
chunk_size
=65536):

28 
by‹s
 
has
 
b“n
 
em™‹d
. 
DeçuÉ
 
chunk
 
size
 
is
 64
kB
. (
CÜe
)

30 
»maššg
 = 
couÁ


31 
»maššg
 > 0:

32 
chunk
 = 
feobj
.
	`»ad
(
	$mš
(
chunk_size
, 
»maššg
))

33 
chunkËn
 = 
	$Ën
(
chunk
)

34 
chunkËn
 == 0:

36 
»maššg
 -ğ
chunkËn


37 
y›ld
 
chunk


39 
def
 
	$£t_v¬y_h—d”
(
»¥Ú£
, 
h—d”_Çme
):

41 
v¬›s
 = 
»¥Ú£
.
h—d”s
.
	`g‘
("Vary", "")

42 
v¬›s
 = [
x
.
	$¡r
(è
x
 
š
 
v¬›s
.
	`¥l™
(","èx.
	`¡r
()]

43 
h—d”_Çme
 
nÙ
 
š
 
v¬›s
:

44 
v¬›s
.
	$­³nd
(
h—d”_Çme
)

45 
»¥Ú£
.
h—d”s
['V¬y'] = ", ".
	`još
(
v¬›s
)

	@trunk/objs/CherryPy-3.2.4/cherrypy/lib/auth.py

1 
impÜt
 
ch”rypy


2 
äom
 
	gch”rypy
.
lib
 
impÜt
 
h‰·uth


5 
def
 
	$check_auth
(
u£rs
, 
’üy±
=
NÚe
, 
»®m
=None):

7 
»que¡
 = 
ch”rypy
.
£rvšg
.request

8 'authÜiz©iÚ' 
š
 
»que¡
.
h—d”s
:

9 #mak
su»
 
the
 
´ovided
 
üed’tŸls
 
¬e
 
cÜ»ùly
 
£t


10 
ah
 = 
h‰·uth
.
	`·r£AuthÜiz©iÚ
(
»que¡
.
h—d”s
['authorization'])

11 
ah
 
is
 
NÚe
:

12 
¿i£
 
ch”rypy
.
	`HTTPE¼Ü
(400, 'Bad Request')

14 
nÙ
 
’üy±
:

15 
’üy±
 = 
h‰·uth
.
DIGEST_AUTH_ENCODERS
[h‰·uth.
MD5
]

17 
	`ha§‰r
(
u£rs
, '__call__'):

18 
Œy
:

19 #backw¬d 
com·tib™y


20 
u£rs
 = 
	$u£rs
(è#ex³ù 
™
 
to
  
a
 
diùiÚ¬y


22 
nÙ
 
	$isš¡ªû
(
u£rs
, 
diù
):

23 
¿i£
 
	`V®ueE¼Ü
("Authentication users must be‡ dictionary")

25 #ãtch 
the
 
u£r
 
·sswÜd


26 
·sswÜd
 = 
u£rs
.
	`g‘
(
ah
["u£ºame"], 
NÚe
)

27 
exû±
 
Ty³E¼Ü
:

28 #»tuº 
a
 
	`·sswÜd
 (
’üy±ed
 
Ü
 
ş—r
 
‹xt
)

29 
·sswÜd
 = 
	`u£rs
(
ah
["username"])

31 
nÙ
 
	$isš¡ªû
(
u£rs
, 
diù
):

32 
¿i£
 
	`V®ueE¼Ü
("Authentication users must be‡ dictionary")

34 #ãtch 
the
 
u£r
 
·sswÜd


35 
·sswÜd
 = 
u£rs
.
	`g‘
(
ah
["u£ºame"], 
NÚe
)

37 #v®id©
the
 
authÜiz©iÚ
 
by
 
»
-
computšg
 
™
 
h”e


38 #ªd 
com·»
 
™
 
w™h
 
wh©
 
the
 
u£r
-
ag’t
 
´ovided


39 
h‰·uth
.
	$checkRe¥Ú£
(
ah
, 
·sswÜd
, 
m‘hod
=
»que¡
.method,

40 
’üy±
ónüy±, 
»®m
=realm):

41 
»que¡
.
logš
 = 
ah
["username"]

42  
True


44 
»que¡
.
logš
 = 
F®£


45  
F®£


47 
def
 
	$basic_auth
(
»®m
, 
u£rs
, 
’üy±
=
NÚe
, 
debug
=
F®£
):

50 
»®m


51 
A
 
¡ršg
 
cÚššg
 
the
 
auth’tiÿtiÚ
 
»®m
.

53 
u£rs


54 
A
 
diù
 
of
 
the
 
fÜm
: {
u£ºame
: 
·sswÜd
} o¸¨ÿÎabË„‘uºšg‡ diù.

56 
’üy±


57 
ÿÎabË
 
u£d
 
to
 
’üy±
 
the
 
·sswÜd
 
»tuºed
 
äom
h
u£r
-
ag’t
.

58 
NÚe
 
™
 
deçuÉs
 
to
 
a
 
md5
 
’üy±iÚ
.

61 
	$check_auth
(
u£rs
, 
’üy±
):

62 
debug
:

63 
ch”rypy
.
	`log
('Auth successful', 'TOOLS.BASIC_AUTH')

66 #šfÜm 
the
 
u£r
-
ag’t
 
this
 
·th
 
is
 
´Ùeùed


67 
ch”rypy
.
£rvšg
.
»¥Ú£
.
h—d”s
['www-auth’tiÿ‹'] = 
h‰·uth
.
	$basicAuth
(
»®m
)

69 
¿i£
 
ch”rypy
.
	`HTTPE¼Ü
(401, "You‡re‚ot‡uthorizedo‡ccesshat„esource")

71 
def
 
	$dige¡_auth
(
»®m
, 
u£rs
, 
debug
=
F®£
):

74 
»®m


75 
A
 
¡ršg
 
cÚššg
 
the
 
auth’tiÿtiÚ
 
»®m
.

76 
u£rs


77 
A
 
diù
 
of
 
the
 
fÜm
: {
u£ºame
: 
·sswÜd
} o¸¨ÿÎabË„‘uºšg‡ diù.

79 
	$check_auth
(
u£rs
, 
»®m
=realm):

80 
debug
:

81 
ch”rypy
.
	`log
('Auth successful', 'TOOLS.DIGEST_AUTH')

84 #šfÜm 
the
 
u£r
-
ag’t
 
this
 
·th
 
is
 
´Ùeùed


85 
ch”rypy
.
£rvšg
.
»¥Ú£
.
h—d”s
['www-auth’tiÿ‹'] = 
h‰·uth
.
	$dige¡Auth
(
»®m
)

87 
¿i£
 
ch”rypy
.
	`HTTPE¼Ü
(401, "You‡re‚ot‡uthorizedo‡ccesshat„esource")

	@trunk/objs/CherryPy-3.2.4/cherrypy/lib/auth_basic.py

1 #Thi 
fe
 
is
 
·¹
 
of
 
Ch”ryPy
 <
h‰p
:

2 #-*- 
codšg
: 
utf
-8 -*-

3 #vim:
ts
=4:
sw
=4:
ex·ndb
:
f“ncodšg
=
utf
-8

5 
	g__doc__
 = """This module…rovides‡ CherryPy 3.xool which implements

6 
the
 
£rv”
-
side
 
of
 
HTTP
 
Basic
 
Acûss
 
Auth’tiÿtiÚ
, 
as
 
desüibed
 
	gš
 :
rfc
:`2617`.

8 
Exam¶e
 
u§ge
, 
usšg
 
the
 
	gbut
-
š
 
check·sswÜd_diù
 
funùiÚ
 
which
 
u£s
 
a
 
diù


9 
as
 
the
 
üed’tŸls
 
	g¡Üe
::

11 
u£½assdiù
 = {'bird' : 'bebop', 'ornette' : 'wayout'}

12 
check·sswÜd
 = 
ch”rypy
.
lib
.
auth_basic
.
	$check·sswÜd_diù
(
u£½assdiù
)

13 
basic_auth
 = {'toŞs.auth_basic.Ú': 
True
,

15 'toŞs.auth_basic.check·sswÜd': 
check·sswÜd
,

16 
	}
}

17 
­p_cÚfig
 = { '/' : 
basic_auth
 }

21 
__authÜ__
 = 'visteya'

22 
__d©e__
 = 'April 2009'

24 
impÜt
 
bšascii


25 
äom
 
ch”rypy
.
_ıcom·t
 
impÜt
 
ba£64_decode


26 
impÜt
 
ch”rypy


29 
def
 
	$check·sswÜd_diù
(
u£r_·sswÜd_diù
):

31 
agaš¡
 
a
 
diùiÚ¬y
 
of
 
the
 
fÜm
: {
u£ºame
 : 
·sswÜd
}.

33 
If
 
you
 
wªt
 
a
 
sim¶e
 
diùiÚ¬y
-
ba£d
 
auth’tiÿtiÚ
 
scheme
, 
u£


34 
	$check·sswÜd_diù
(
my_üed’tŸls_diù
è
as
 
the
 
v®ue
 the

35 
check·sswÜd
 
¬gum’t
 
to
 
	`basic_auth
().

37 
def
 
	$check·sswÜd
(
»®m
, 
u£r
, 
·sswÜd
):

38 
p
 = 
u£r_·sswÜd_diù
.
	$g‘
(
u£r
)

39  
p
 
ªd
… =ğ
·sswÜd
 
Ü
 
F®£


41  
check·sswÜd


44 
def
 
	$basic_auth
(
»®m
, 
check·sswÜd
, 
debug
=
F®£
):

46 
HTTP
 
Basic
 
Acûss
 
Auth’tiÿtiÚ
, 
as
 
¥ecif›d
 
š
 :
rfc
:`2617`.

48 
If
 
the
 
»que¡
 
has
 
ª
 'authÜiz©iÚ' 
h—d”
 
w™h
 
a
 'Basic' 
scheme
, 
this


49 
toŞ
 
©‹m±s
 
to
 
auth’tiÿ‹
 
the
 
üed’tŸls
 
suµl›d
 
š
 
th©
 
h—d”
. 
If


50 
the
 
»que¡
 
has
 
no
 'authÜiz©iÚ' 
h—d”
, 
Ü
 
™
 
dÛs
 
but
h
scheme
 
is


51 
nÙ
 'Basic', 
Ü
 
auth’tiÿtiÚ
 
çs
, 
the
 
toŞ
 
£nds
 
a
 401 
»¥Ú£
 
w™h


52 
a
 'WWW-Auth’tiÿ‹' 
Basic
 
h—d”
.

54 
»®m


55 
A
 
¡ršg
 
cÚššg
 
the
 
auth’tiÿtiÚ
 
»®m
.

57 
check·sswÜd


58 
A
 
ÿÎabË
 
which
 
checks
 
the
 
auth’tiÿtiÚ
 
üed’tŸls
.

59 
Its
 
sigÇtu»
 
is
 
	`check·sswÜd
(
»®m
, 
u£ºame
, 
·sswÜd
). 
wh”e


60 
u£ºame
 
ªd
 
·sswÜd
 
¬e
 
the
 
v®ues
 
obšed
 
äom
h
»que¡
's

61 'authÜiz©iÚ' 
h—d”
. 
If
 
auth’tiÿtiÚ
 
sucûeds
, 
check·sswÜd


62 
»tuºs
 
True
, 
™
„‘uº 
F®£
.

66 '"' 
š
 
»®m
:

67 
¿i£
 
	`V®ueE¼Ü
('Realm cannot containhe " (quote) character.')

68 
»que¡
 = 
ch”rypy
.
£rvšg
.request

70 
auth_h—d”
 = 
»que¡
.
h—d”s
.
	`g‘
('authorization')

71 
auth_h—d”
 
is
 
nÙ
 
NÚe
:

72 
Œy
:

73 
scheme
, 
·¿ms
 = 
auth_h—d”
.
	`¥l™
(' ', 1)

74 
scheme
.
	`low”
() == 'basic':

75 
u£ºame
, 
·sswÜd
 = 
	`ba£64_decode
(
·¿ms
).
	`¥l™
(':', 1)

76 
	$check·sswÜd
(
»®m
, 
u£ºame
, 
·sswÜd
):

77 
debug
:

78 
ch”rypy
.
	`log
('Auth succeeded', 'TOOLS.AUTH_BASIC')

79 
»que¡
.
logš
 = 
u£ºame


80  #sucûssfuÈ
auth’tiÿtiÚ


81 
	$exû±
 (
V®ueE¼Ü
, 
bšascii
.
E¼Ü
): #¥l™(è
”rÜ
, 
ba£64
.
	$decode¡ršg
(è
”rÜ


82 
¿i£
 
ch”rypy
.
	`HTTPE¼Ü
(400, 'Bad Request')

84 #Re¥Úd 
w™h
 401 
¡©us
 
ªd
 
a
 
WWW
-
Auth’tiÿ‹
 
h—d”


85 
ch”rypy
.
£rvšg
.
»¥Ú£
.
h—d”s
['www-auth’tiÿ‹'] = 'Basiø»®m="%s"' % 
»®m


86 
¿i£
 
ch”rypy
.
	`HTTPE¼Ü
(401, "You‡re‚ot‡uthorizedo‡ccesshat„esource")

	@trunk/objs/CherryPy-3.2.4/cherrypy/lib/auth_digest.py

1 #Thi 
fe
 
is
 
·¹
 
of
 
Ch”ryPy
 <
h‰p
:

2 #-*- 
codšg
: 
utf
-8 -*-

3 #vim:
ts
=4:
sw
=4:
ex·ndb
:
f“ncodšg
=
utf
-8

5 
	g__doc__
 = """An implementation ofhe server-side of HTTP Digest Access

6 
Auth’tiÿtiÚ
, 
which
 
is
 
desüibed
 
	gš
 :
rfc
:`2617`.

8 
Exam¶e
 
u§ge
, 
usšg
 
the
 
	gbut
-
š
 
g‘_ha1_diù_¶aš
 
funùiÚ
 
which
 
u£s
 
a
 
diù


9 
of
 
¶aš‹xt
 
·sswÜds
 
as
 
the
 
üed’tŸls
 
	g¡Üe
::

11 
u£½assdiù
 = {'alice' : '4x5istwelve'}

12 
g‘_ha1
 = 
ch”rypy
.
lib
.
auth_dige¡
.
	$g‘_ha1_diù_¶aš
(
u£½assdiù
)

13 
dige¡_auth
 = {'toŞs.auth_dige¡.Ú': 
True
,

15 'toŞs.auth_dige¡.g‘_ha1': 
g‘_ha1
,

17 
	}
}

18 
­p_cÚfig
 = { '/' : 
dige¡_auth
 }

21 
__authÜ__
 = 'visteya'

22 
__d©e__
 = 'April 2009'

25 
impÜt
 
time


26 
äom
 
ch”rypy
.
_ıcom·t
 
impÜt
 
·r£_h‰p_li¡
, 
·r£_keqv_li¡


28 
impÜt
 
ch”rypy


29 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
	gmd5
, 
Áob


30 
	gmd5_hex
 = 
Ïmbda
 
s
: 
md5
(
Áob
(s)).
	$hexdige¡
()

32 
qİ_auth
 = 'auth'

33 
qİ_auth_št
 = 'auth-int'

34 
v®id_qİs
 = (
qİ_auth
, 
qİ_auth_št
)

36 
v®id_®gÜ™hms
 = ('MD5', 'MD5-sess')

39 
def
 
	$TRACE
(
msg
):

40 
ch”rypy
.
	`log
(
msg
, 
cÚ‹xt
='TOOLS.AUTH_DIGEST')

42 #Th»
h–³r
 
funùiÚs
 
u£rs
 
of
 
the
 
toŞ
, 
´ovidšg
 
th»e
 
v¬ŸÁs


43 #oà
	`g‘_ha1
(è
funùiÚs
 
th»e
 
difã»Á
 
kšds
 
of
 
üed’tŸl
 
¡Ües
.

44 
def
 
	$g‘_ha1_diù_¶aš
(
u£r_·sswÜd_diù
):

46 
diùiÚ¬y
 
of
 
the
 
fÜm
: {
u£ºame
 : 
·sswÜd
}.

48 
If
 
you
 
wªt
 
a
 
sim¶e
 
diùiÚ¬y
-
ba£d
 
auth’tiÿtiÚ
 
scheme
, 
w™h
 
¶aš‹xt


49 
	g·sswÜds
, 
u£
 
	$g‘_ha1_diù_¶aš
(
my_u£½ass_diù
è
as
 
the
 
v®ue
 the

50 
g‘_ha1
 
¬gum’t
 
to
 
	`dige¡_auth
().

52 
def
 
	$g‘_ha1
(
»®m
, 
u£ºame
):

53 
·sswÜd
 = 
u£r_·sswÜd_diù
.
	$g‘
(
u£ºame
)

54 
·sswÜd
:

55  
	`md5_hex
('%s:%s:%s' % (
u£ºame
, 
»®m
, 
·sswÜd
))

56  
NÚe


58  
g‘_ha1


60 
def
 
	$g‘_ha1_diù
(
u£r_ha1_diù
):

62 
diùiÚ¬y
 
of
 
the
 
fÜm
: {
u£ºame
 : 
HA1
}.

64 
If
 
you
 
wªt
 
a
 
diùiÚ¬y
-
ba£d
 
auth’tiÿtiÚ
 
scheme
, 
but
 
w™h


65 
	g´e
-
compu‹d
 
HA1
 
hashes
 
š¡—d
 
of
 
	g¶aš
-
‹xt
 
	g·sswÜds
, 
u£


66 
	$g‘_ha1_diù
(
my_u£rha1_diù
è
as
 
the
 
v®ue
 th
g‘_ha1


67 
¬gum’t
 
to
 
	`dige¡_auth
().

69 
def
 
	$g‘_ha1
(
»®m
, 
u£ºame
):

70  
u£r_ha1_diù
.
	$g‘
(
u£r
)

72  
g‘_ha1


74 
def
 
	$g‘_ha1_fe_htdige¡
(
f’ame
):

76 
æ©
 
fe
 
w™h
 
lšes
 
of
 
the
 
§me
 
fÜm©
 
as
 
th©
 
´oduûd
 
by
h
A·che


77 
htdige¡
 
ut™y
. 
FÜ
 
exam¶e
, 
»®m
 'wÚd”Ïnd', 
u£ºame
 'alice',

78 
ªd
 
·sswÜd
 '4x5i¡w–ve', 
the
 
htdige¡
 
lše
 
would
 
be
::

80 
®iû
:
wÚd”Ïnd
:3238cdfe91a8b2ed8e39646921a02d4c

82 
If
 
you
 
wªt
 
to
 
u£
 
ª
 
A·che
 
htdige¡
 
fe
 
as
 
the
 
üed’tŸls
 
¡Üe
,

83 
th’
 
u£
 
	$g‘_ha1_fe_htdige¡
(
my_htdige¡_fe
è
as
 
the
 
v®ue
 the

84 
g‘_ha1
 
¬gum’t
 
to
 
	`dige¡_auth
(). 
It
 
is
 
»comm’ded
 
th©
 
the
 
f’ame


85 
¬gum’t
 
be
 
ª
 
absŞu‹
 
·th
, 
to
 
avoid
 
´obËms
.

87 
def
 
	$g‘_ha1
(
»®m
, 
u£ºame
):

88 
»suÉ
 = 
NÚe


89 
f
 = 
	`İ’
(
f’ame
, 'r')

90 
lše
 
š
 
f
:

91 
u
, 
r
, 
ha1
 = 
lše
.
	`r¡r
().
	`¥l™
(':')

92 
u
 =ğ
u£ºame
 
ªd
 
r
 =ğ
»®m
:

93 
»suÉ
 = 
ha1


95 
f
.
	$şo£
()

96  
»suÉ


98  
g‘_ha1


101 
def
 
	$syÁhesize_nÚû
(
s
, 
key
, 
time¡amp
=
NÚe
):

103 
R‘uºs
 
a
 
¡ršg
 
su™abË
 
as
 
the
 
v®ue
 'nÚû' 
š
h
www
-
auth’tiÿ‹
 
h—d”
.

105 
s


106 
A
 
¡ršg
 
»Ï‹d
 
to
 
the
 
»sourû
, 
such
 
as
h
ho¡Çme
 
of
h
£rv”
.

108 
key


109 
A
 
£ü‘
 
¡ršg
 
known
 
Úly
 
to
 
the
 
£rv”
.

111 
time¡amp


112 
An
 
š‹g”
 
£cÚds
-
sšû
-
the
-
•och
 
time¡amp


115 
time¡amp
 
is
 
NÚe
:

116 
time¡amp
 = (
time
.
	$time
())

117 
h
 = 
	`md5_hex
('%s:%s:%s' % (
time¡amp
, 
s
, 
key
))

118 
nÚû
 = '%s:%s' % (
time¡amp
, 
h
)

119  
nÚû


122 
def
 
	$H
(
s
):

124  
	$md5_hex
(
s
)

127 
şass
 
	$H‰pDige¡AuthÜiz©iÚ
 (
objeù
):

129 
of
 
the
 
dige¡
.

132 
def
 
	$”rmsg
(
£lf
, 
s
):

133  'Dige¡ AuthÜiz©iÚ h—d”: %s' % 
s


135 
def
 
	$__š™__
(
£lf
, 
auth_h—d”
, 
h‰p_m‘hod
, 
debug
=
F®£
):

136 
£lf
.
h‰p_m‘hod
 = http_method

137 
£lf
.
debug
 = debug

138 
scheme
, 
·¿ms
 = 
auth_h—d”
.
	`¥l™
(" ", 1)

139 
£lf
.
scheme
 = scheme.
	$low”
()

140 
£lf
.
scheme
 != 'digest':

141 
¿i£
 
	`V®ueE¼Ü
('Authorization scheme is‚ot "Digest"')

143 
£lf
.
auth_h—d”
 =‡uth_header

145 #mak
a
 
diù
 
of
 
the
 
·¿ms


146 
™ems
 = 
	$·r£_h‰p_li¡
(
·¿ms
)

147 
·¿msd
 = 
	$·r£_keqv_li¡
(
™ems
)

149 
£lf
.
»®m
 = 
·¿msd
.
	`g‘
('realm')

150 
£lf
.
u£ºame
 = 
·¿msd
.
	`g‘
('username')

151 
£lf
.
nÚû
 = 
·¿msd
.
	`g‘
('nonce')

152 
£lf
.
uri
 = 
·¿msd
.
	`g‘
('uri')

153 
£lf
.
m‘hod
 = 
·¿msd
.
	`g‘
('method')

154 
£lf
.
»¥Ú£
 = 
·¿msd
.
	`g‘
('»¥Ú£'è#th»¥Ú£ 
dige¡


155 
£lf
.
®gÜ™hm
 = 
·¿msd
.
	`g‘
('algorithm', 'MD5')

156 
£lf
.
úÚû
 = 
·¿msd
.
	`g‘
('cnonce')

157 
£lf
.
İaque
 = 
·¿msd
.
	`g‘
('opaque')

158 
£lf
.
qİ
 = 
·¿msd
.
	`g‘
('qop') #qop

159 
£lf
.
nc
 = 
·¿msd
.
	`g‘
('nc'è#nÚû 
couÁ


161 #³rfÜm 
some
 
cÜ»ùÃss
 
checks


162 
£lf
.
®gÜ™hm
 
nÙ
 
š
 
v®id_®gÜ™hms
:

163 
¿i£
 
	`V®ueE¼Ü
(
£lf
.
	`”rmsg
("UnsuµÜ‹d v®ufÜ‡lgÜ™hm: '%s'" % s–f.
®gÜ™hm
))

165 
has_»qd
 = 
£lf
.
u£ºame
 
ªd
 \

166 
£lf
.
»®m
 
ªd
 \

167 
£lf
.
nÚû
 
ªd
 \

168 
£lf
.
uri
 
ªd
 \

169 
£lf
.
»¥Ú£


170 
nÙ
 
has_»qd
:

171 
¿i£
 
	`V®ueE¼Ü
(
£lf
.
	`”rmsg
("Not‡ll„equired…arameters‡re…resent."))

173 
£lf
.
qİ
:

174 
£lf
.
qİ
 
nÙ
 
š
 
v®id_qİs
:

175 
¿i£
 
	`V®ueE¼Ü
(
£lf
.
	`”rmsg
("UnsuµÜ‹d v®ufÜ qİ: '%s'" % s–f.
qİ
))

176 
	$nÙ
 (
£lf
.
úÚû
 
ªd
 s–f.
nc
):

177 
¿i£
 
	`V®ueE¼Ü
(
£lf
.
	`”rmsg
("If qop is senthen cnonce‡nd‚c MUST be…resent"))

179 
£lf
.
úÚû
 
Ü
 s–f.
nc
:

180 
¿i£
 
	`V®ueE¼Ü
(
£lf
.
	`”rmsg
("If qop is‚ot sent,‚either cnonce‚or‚c can be…resent"))

183 
def
 
	$__¡r__
(
£lf
):

184  'authÜiz©iÚ : %s' % 
£lf
.
auth_h—d”


186 
def
 
	$v®id©e_nÚû
(
£lf
, 
s
, 
key
):

188 
R‘uºs
 
True
 
nÚû
 
was
 
g’”©ed
 
by
 
	$syÁhesize_nÚû
(è
ªd
 
the
 
time¡amp


189 
is
 
nÙ
 
¥ooãd
, 
»tuºs
 
F®£
.

191 
s


192 
A
 
¡ršg
 
»Ï‹d
 
to
 
the
 
»sourû
, 
such
 
as
h
ho¡Çme
 
of
h
£rv”
.

194 
key


195 
A
 
£ü‘
 
¡ršg
 
known
 
Úly
 
to
 
the
 
£rv”
.

197 
BÙh
 
s
 
ªd
 
key
 
mu¡
 
be
 
the
 
§me
 
v®ues
 
which
 
w”e
 
u£d
 
to
 
syÁhesize
h
nÚû


198 
we
 
¬e
 
Œyšg
 
to
 
v®id©e
.

200 
Œy
:

201 
time¡amp
, 
hash·¹
 = 
£lf
.
nÚû
.
	`¥l™
(':', 1)

202 
s_time¡amp
, 
s_hash·¹
 = 
	`syÁhesize_nÚû
(
s
, 
key
, 
time¡amp
).
	`¥l™
(':', 1)

203 
is_v®id
 = 
s_hash·¹
 =ğ
hash·¹


204 
£lf
.
debug
:

205 
	`TRACE
('v®id©e_nÚû: %s' % 
is_v®id
)

206  
is_v®id


207 
exû±
 
V®ueE¼Ü
: #¥l™(è
”rÜ


208 
·ss


209  
F®£


212 
def
 
	$is_nÚû_¡®e
(
£lf
, 
max_age_£cÚds
=600):

214 
time¡amp
 
š
 
¶aš‹xt
 
ªd
 
®so
 
a
 
£cu»
 
hash
 
of
 
the
ime¡amp. 
You
 
should


215 
fœ¡
 
v®id©e
 
the
 
nÚû
 
to
 
’su»
h
¶aš‹xt
 
time¡amp
 
is
 
nÙ
 
¥ooãd
.

217 
Œy
:

218 
time¡amp
, 
hash·¹
 = 
£lf
.
nÚû
.
	`¥l™
(':', 1)

219 (
time¡amp
è+ 
max_age_£cÚds
 > (
time
.
	$time
()):

220  
F®£


221 
exû±
 
V®ueE¼Ü
: #št(è
”rÜ


222 
·ss


223 
£lf
.
debug
:

224 
	`TRACE
("nonce is stale")

225  
True


228 
def
 
	`HA2
(
£lf
, 
’t™y_body
=''):

231 #Ià
the
 "qİ" 
dœeùive
's value is "auth" or is unspecified,hen A2 is:

232 #A2 = 
m‘hod
 ":" 
dige¡
-
uri
-
v®ue


233 #
#Ià
the
 "qİ" 
v®ue
 
is
 "auth-št", 
th’
 
A2
 is:

234 #A2 = 
m‘hod
 ":" 
dige¡
-
uri
-
v®ue
 ":" 
	`H
(
’t™y
-
body
)

235 
£lf
.
qİ
 
is
 
NÚe
 
Ü
 self.qop == "auth":

236 
a2
 = '%s:%s' % (
£lf
.
h‰p_m‘hod
, s–f.
uri
)

237 
–if
 
£lf
.
qİ
 == "auth-int":

238 
a2
 = "%s:%s:%s" % (
£lf
.
h‰p_m‘hod
, s–f.
uri
, 
	$H
(
’t™y_body
))

240 #š 
theÜy
, 
this
 
should
 
Ãv”
 
h­³n
, 
sšû
 
I
 
v®id©e
 
qİ
 
š
 
	`__š™__
()

241 
¿i£
 
	`V®ueE¼Ü
(
£lf
.
	`”rmsg
("Unrecognized value for qop!"))

242  
	$H
(
a2
)

245 
def
 
	`»que¡_dige¡
(
£lf
, 
ha1
, 
’t™y_body
=''):

248 
ha1


249 
The
 
HA1
 
¡ršg
 
obšed
 
äom
 
the
 
üed’tŸls
 
¡Üe
.

251 
’t™y_body


252 
If
 'qİ' 
is
 
£t
 
to
 'auth-št', 
th’
 
A2
 
šşudes
 
a
 
hash


253 
of
 
the
 "’t™y body". 
The
 
’t™y
 
body
 
is
h
·¹
 ofhe

254 
mes§ge
 
which
 
fŞlows
 
the
 
HTTP
 
h—d”s
. 
S“
 :
rfc
:`2617` 
£ùiÚ


255 4.3. 
This
 
»ãrs
 
to
 
the
 
’t™y
h
u£r
 
ag’t
 
£Á
 
š
h
»que¡
 
which


256 
has
 
the
 
AuthÜiz©iÚ
 
h—d”
. 
TypiÿÎy
 
GET
 
»que¡s
 
dÚ
't have‡nƒntity,

257 
ªd
 
POST
 
»que¡s
 do.

260 
ha2
 = 
£lf
.
	$HA2
(
’t™y_body
)

261 #Reque¡-
Dige¡
 -- 
RFC
 2617 3.2.2.1

262 
£lf
.
qİ
:

263 
»q
 = "%s:%s:%s:%s:%s" % (
£lf
.
nÚû
, s–f.
nc
, s–f.
úÚû
, s–f.
qİ
, 
ha2
)

265 
»q
 = "%s:%s" % (
£lf
.
nÚû
, 
ha2
)

268 #
#Ià
the
 "®gÜ™hm" 
dœeùive
's value is "MD5" or is unspecified,hen A1 is:

269 #A1 = 
	`unq
(
u£ºame
-
v®ue
è":" unq(
»®m
-v®ueè":" 
·sswd


270 #
#Ià
the
 "®gÜ™hm" 
dœeùive
's value is "MD5-sess",hen A1 is

271 #ÿlcuÏ‹d 
Úly
 
Úû
 - 
Ú
 
the
 
fœ¡
 
»que¡
 
by
h
ş›Á
 
fŞlowšg


272 #»ûˆ
of
 
a
 
WWW
-
Auth’tiÿ‹
 
ch®Ënge
 
äom
 
the
 
£rv”
.

273 #A1 = 
	`H
Ğ
	`unq
(
u£ºame
-
v®ue
è":" unq(
»®m
-v®ueè":" 
·sswd
 )

275 
£lf
.
®gÜ™hm
 == 'MD5-sess':

276 
ha1
 = 
	`H
('%s:%s:%s' % (ha1, 
£lf
.
nÚû
, s–f.
úÚû
))

278 
dige¡
 = 
	`H
('%s:%s' % (
ha1
, 
»q
))

279  
dige¡


283 
def
 
	`www_auth’tiÿ‹
(
»®m
, 
key
, 
®gÜ™hm
='MD5', 
nÚû
=
NÚe
, 
qİ
=
qİ_auth
, 
¡®e
=
F®£
):

285 
qİ
 
nÙ
 
š
 
v®id_qİs
:

286 
¿i£
 
	`V®ueE¼Ü
("UnsuµÜ‹d v®ufÜ qİ: '%s'" % 
qİ
)

287 
®gÜ™hm
 
nÙ
 
š
 
v®id_®gÜ™hms
:

288 
¿i£
 
	`V®ueE¼Ü
("UnsuµÜ‹d v®ufÜ‡lgÜ™hm: '%s'" % 
®gÜ™hm
)

290 
nÚû
 
is
 
NÚe
:

291 
nÚû
 = 
	$syÁhesize_nÚû
(
»®m
, 
key
)

292 
s
 = 'Digest„ealm="%s",‚once="%s",‡lgorithm="%s", qop="%s"' % (

293 
»®m
, 
nÚû
, 
®gÜ™hm
, 
qİ
)

294 
¡®e
:

295 
s
 += ', stale="true"'

296  
s


299 
def
 
	$dige¡_auth
(
»®m
, 
g‘_ha1
, 
key
, 
debug
=
F®£
):

301 
HTTP
 
Dige¡
 
Acûss
 
Auth’tiÿtiÚ
, 
as
 
¥ecif›d
 
š
 :
rfc
:`2617`.

303 
If
 
the
 
»que¡
 
has
 
ª
 'authÜiz©iÚ' 
h—d”
 
w™h
 
a
 'Dige¡' 
scheme
, 
this


304 
toŞ
 
auth’tiÿ‹s
 
the
 
üed’tŸls
 
suµl›d
 
š
 
th©
 
h—d”
. 
If


305 
the
 
»que¡
 
has
 
no
 'authÜiz©iÚ' 
h—d”
, 
Ü
 
™
 
dÛs
 
but
h
scheme
 
is


306 
nÙ
 "Dige¡", 
Ü
 
auth’tiÿtiÚ
 
çs
, 
the
 
toŞ
 
£nds
 
a
 401 
»¥Ú£
 
w™h


307 
a
 'WWW-Auth’tiÿ‹' 
Dige¡
 
h—d”
.

309 
»®m


310 
A
 
¡ršg
 
cÚššg
 
the
 
auth’tiÿtiÚ
 
»®m
.

312 
g‘_ha1


313 
A
 
ÿÎabË
 
which
 
looks
 
up
 
a
 
u£ºame
 
š
‡ 
üed’tŸls
 
¡Üe


314 
ªd
 
»tuºs
 
the
 
HA1
 
¡ršg
, 
which
 
is
 
defšed
 
š
h
RFC
 
to
 
be


315 
	`MD5
(
u£ºame
 : 
»®m
 : 
·sswÜd
). 
The
 
funùiÚ
's signature is:

316 ``
	`g‘_ha1
(
»®m
, 
u£ºame
)``

317 
wh”e
 
u£ºame
 
is
 
obšed
 
äom
 
the
 
»que¡
' '
authÜiz©iÚ
' header.

318 
If
 
u£ºame
 
is
 
nÙ
 
found
 
š
 
the
 
üed’tŸls
 
¡Üe
, 
	$g‘_ha1
(è
»tuºs


319 
NÚe
.

321 
key


322 
A
 
£ü‘
 
¡ršg
 
known
 
Úly
 
to
 
the
 
£rv”
, 
u£d
 
š
h
syÁhesis
 
of
 
nÚûs
.

325 
»que¡
 = 
ch”rypy
.
£rvšg
.request

327 
auth_h—d”
 = 
»que¡
.
h—d”s
.
	`g‘
('authorization')

328 
nÚû_is_¡®e
 = 
F®£


329 
auth_h—d”
 
is
 
nÙ
 
NÚe
:

330 
Œy
:

331 
auth
 = 
	$H‰pDige¡AuthÜiz©iÚ
(
auth_h—d”
, 
»que¡
.
m‘hod
, 
debug
=debug)

332 
exû±
 
V®ueE¼Ü
:

333 
¿i£
 
ch”rypy
.
	`HTTPE¼Ü
(400, "The Authorization header could‚ot be…arsed.")

335 
debug
:

336 
	`TRACE
(
	$¡r
(
auth
))

338 
auth
.
	$v®id©e_nÚû
(
»®m
, 
key
):

339 
ha1
 = 
	$g‘_ha1
(
»®m
, 
auth
.
u£ºame
)

340 
ha1
 
is
 
nÙ
 
NÚe
:

341 #nÙ
th©
 
»que¡
.
body
 
to
 
be
 
avaabË
 
we
 
Ãed
Ø
hook
 
š
 
©


342 #befÜe_hªdËr, 
nÙ
 
Ú_¡¬t_»sourû
 
like
 3.1.x 
dige¡_auth
 
dÛs
.

343 
dige¡
 = 
auth
.
	$»que¡_dige¡
(
ha1
, 
’t™y_body
=
»que¡
.
body
)

344 
dige¡
 =ğ
auth
.
»¥Ú£
: #authenticated

345 
debug
:

346 
	`TRACE
("digest matches‡uth.response")

347 #Now 
check
 
nÚû
 
is
 
¡®e
.

348 #Th
choiû
 
of
 
‹n
 
mšu‹s
'†ifetime for‚once is somewhat‡rbitrary

349 
nÚû_is_¡®e
 = 
auth
.
	$is_nÚû_¡®e
(
max_age_£cÚds
=600)

350 
nÙ
 
nÚû_is_¡®e
:

351 
»que¡
.
logš
 = 
auth
.
u£ºame


352 
debug
:

353 
	`TRACE
("auth’tiÿtiÚ oà% sucûssful" % 
auth
.
u£ºame
)

356 #Re¥Úd 
w™h
 401 
¡©us
 
ªd
 
a
 
WWW
-
Auth’tiÿ‹
 
h—d”


357 
h—d”
 = 
	$www_auth’tiÿ‹
(
»®m
, 
key
, 
¡®e
=
nÚû_is_¡®e
)

358 
debug
:

359 
	$TRACE
(
h—d”
)

360 
ch”rypy
.
£rvšg
.
»¥Ú£
.
h—d”s
['WWW-Auth’tiÿ‹'] = 
h—d”


361 
¿i£
 
ch”rypy
.
	`HTTPE¼Ü
(401, "You‡re‚ot‡uthorizedo‡ccesshat„esource")

	@trunk/objs/CherryPy-3.2.4/cherrypy/lib/caching.py

2 
Ch”ryPy
 
im¶em’ts
 
a
 
sim¶e
 
ÿchšg
 
sy¡em
 
as
‡ 
¶uggabË
 
	gToŞ
. 
This
 
toŞ
 
Œ›s


3 
to
 
be
 
ª
 (
š
-
´oûss
è
	gHTTP
/1.1-
com¶ŸÁ
 
	gÿche
. 
	gIt
's‚ot quitehere yet, but

4 
	g™
's…robably goodƒnough for most sites.

6 
In
 
	gg’”®
, 
GET
 
»¥Ú£s
 
¬e
 
	$ÿched
 (
®Úg
 
w™h
 
£Ëùšg
 
h—d”s
è
ªd
, 

7 
ªÙh”
 
»que¡
 
¬rives
 
the
 
§me
 
»sourû
,h
ÿchšg
 
ToŞ
 
wl
  304

8 
NÙ
 
Modif›d
 
possibË
, 
Ü
 
£rve
 
the
 
ÿched
 
»¥Ú£
 
Ùh”wi£
. 
It
 
®so
 
£ts


9 
»que¡
.
ÿched
 
to
 
True
 
£rvšg
 
a
 cached 
»´e£Á©iÚ
, 
ªd
 
£ts


10 
»que¡
.
ÿch—bË
 
to
 
	`F®£
 (
so
 
™
 
dÛ¢
't get cached‡gain).

12 
If
 
POST
, 
PUT
, 
Ü
 
DELETE
 
»que¡s
 
¬e
 
made
 
a
 
ÿched
 
»sourû
, 
they
 
šv®id©e


13 (
d–‘e
è
ªy
 
ÿched
 
»¥Ú£
.

15 
U§ge


18 
CÚfigu¿tiÚ
 
fe
 
exam¶e
::

21 
toŞs
.
ÿchšg
.
Ú
 = 
True


22 
toŞs
.
ÿchšg
.
d–ay
 = 3600

24 
You
 
may
 
u£
 
a
 
şass
 
Ùh”
 
thª
 
the
 

25 :
şass
:`
MemÜyCache
<
ch”rypy
.
lib
.
ÿchšg
.MemÜyCache>` 
by
 
suµlyšg
 
the
 
cÚfig


26 
’Œy
 ``
ÿche_şass
``; 
suµly
 
the
 
fuÎ
 
dÙ‹d
 
Çme
 
of
h
»¶aûm’t
 
şass


27 
as
 
the
 
cÚfig
 
v®ue
. 
It
 
mu¡
 
im¶em’t
h
basic
 
m‘hods
 ``
g‘
``, ``
put
``,

28 ``
d–‘e
``, 
ªd
 ``
ş—r
``.

30 
You
 
may
 
£t
 
ªy
 
©Œibu‹
, 
šşudšg
 
ov”ridšg
 
m‘hods
, 
Ú
 
the
 
ÿche


31 
š¡ªû
 
by
 
´ovidšg
 
them
 
š
 
cÚfig
. 
The
 
above
 
£ts
 
the


32 :
©Œ
:`
d–ay
<
ch”rypy
.
lib
.
ÿchšg
.
MemÜyCache
.d–ay>` 
©Œibu‹
, 
exam¶e
.

35 
impÜt
 
d©‘ime


36 
impÜt
 
sys


37 
impÜt
 
th»adšg


38 
impÜt
 
time


40 
impÜt
 
ch”rypy


41 
äom
 
ch”rypy
.
lib
 
impÜt
 
ıtoŞs
, 
h‰put


42 
äom
 
ch”rypy
.
_ıcom·t
 
impÜt
 
cİy™ems
, 
Áob
, 
£t_d«mÚ
, 
sÜ‹d
, 
Ev’t


45 
şass
 
	$Cache
(
objeù
):

48 
def
 
	$g‘
(
£lf
):

50 
¿i£
 
NÙIm¶em’‹d


52 
def
 
	$put
(
£lf
, 
obj
, 
size
):

54 
¿i£
 
NÙIm¶em’‹d


56 
def
 
	$d–‘e
(
£lf
):

58 
¿i£
 
NÙIm¶em’‹d


60 
def
 
	$ş—r
(
£lf
):

62 
¿i£
 
NÙIm¶em’‹d


66 #------------------------------- 
MemÜy
 
Cache
 ------------------------------- #


68 
şass
 
	$AÁiSm³deCache
(
diù
):

71 
def
 
	$wa™
(
£lf
, 
key
, 
timeout
=5, 
debug
=
F®£
):

74 
If
 
timeout
 
is
 
nÙ
 
NÚe
, 
ªd
 
the
 
v®ue
 i 
®»ady


75 
bešg
 
ÿlcuÏ‹d
 
by
 
ªÙh”
 
th»ad
, 
wa™
 
uÁ
 
the
 
giv’
 
timeout
 
has


76 
–­£d
. 
If
 
the
 
v®ue
 
is
 
avaabË
 
befÜe
h
timeout
 
expœes
, 
™
 is

77 
»tuºed
. 
If
 
nÙ
, 
NÚe
 
is
„‘uºed, 
ªd
 
a
 
£Áš–
 
¶aûd
 
š
 
the
 
ÿche


78 
to
 
sigÇl
 
Ùh”
 
th»ads
Ø
wa™
.

80 
If
 
timeout
 
is
 
NÚe
, 
no
 
wa™šg
 i 
³rfÜmed
 
nÜ
 
£Áš–s
 
u£d
.

82 
v®ue
 = 
£lf
.
	$g‘
(
key
)

83 
	$isš¡ªû
(
v®ue
, 
Ev’t
):

84 
timeout
 
is
 
NÚe
:

85 #IgnÜ
the
 
Ùh”
 
th»ad
 
ªd
 
»ÿlc
 
™
 
our£lves
.

86 
debug
:

87 
ch”rypy
.
	`log
('Noimeout', 'TOOLS.CACHING')

88  
NÚe


90 #Wa™ 
uÁ
 
™
's done orimes out.

91 
debug
:

92 
ch”rypy
.
	`log
('Wa™šg u°tØ% £cÚds' % 
timeout
, 'TOOLS.CACHING')

93 
v®ue
.
	$wa™
(
timeout
)

94 
v®ue
.
»suÉ
 
is
 
nÙ
 
NÚe
:

95 #Th
Ùh”
 
th»ad
 
fšished
 
™s
 
ÿlcuÏtiÚ
. 
U£
 
™
.

96 
debug
:

97 
ch”rypy
.
	`log
('Result!', 'TOOLS.CACHING')

98  
v®ue
.
»suÉ


99 #Timed 
out
. 
Stick
 
ª
 
Ev’t
 
š
 
the
 
¦Ù
 
so
 
Ùh”
 
th»ads
 
wa™


100 #Ú 
this
 
Úe
 
to
 
fšish
 
ÿlcuÏtšg
 
the
 
v®ue
.

101 
debug
:

102 
ch”rypy
.
	`log
('Timed out', 'TOOLS.CACHING')

103 
e
 = 
th»adšg
.
	$Ev’t
()

104 
e
.
»suÉ
 = 
NÚe


105 
diù
.
	$__£t™em__
(
£lf
, 
key
, 
e
)

107  
NÚe


108 
–if
 
v®ue
 
is
 
NÚe
:

109 #Stick 
ª
 
Ev’t
 
š
 
the
 
¦Ù
 
so
 
Ùh”
 
th»ads
 
wa™


110 #Ú 
this
 
Úe
 
to
 
fšish
 
ÿlcuÏtšg
 
the
 
v®ue
.

111 
debug
:

112 
ch”rypy
.
	`log
('Timed out', 'TOOLS.CACHING')

113 
e
 = 
th»adšg
.
	$Ev’t
()

114 
e
.
»suÉ
 = 
NÚe


115 
diù
.
	$__£t™em__
(
£lf
, 
key
, 
e
)

116  
v®ue


118 
def
 
	$__£t™em__
(
£lf
, 
key
, 
v®ue
):

120 
exi¡šg
 = 
£lf
.
	$g‘
(
key
)

121 
diù
.
	$__£t™em__
(
£lf
, 
key
, 
v®ue
)

122 
	$isš¡ªû
(
exi¡šg
, 
Ev’t
):

123 #S‘ 
Ev’t
.
»suÉ
 
so
 
Ùh”
 
th»ads
 
wa™šg
 
Ú
 
™
 
have


124 #immedŸ‹ 
acûss
 
w™hout
 
Ãedšg
 
to
 
pŞl
 
the
 
ÿche
 
agaš
.

125 
exi¡šg
.
»suÉ
 = 
v®ue


126 
exi¡šg
.
	$£t
()

129 
şass
 
	$MemÜyCache
(
Cache
):

132 
Each
 
key
 
š
 
£lf
.
¡Üe
 
is
 
a
 
URI
, 
ªd
 
—ch
 
v®ue
 i 
ª
 
AÁiSm³deCache
.

133 
The
 
»¥Ú£
 
ªy
 
giv’
 
URI
 
may
 
v¬y
 
ba£d
 
Ú
 
the
 
v®ues
 
of


134 "£Ëùšg„eque¡ h—d”s"; 
th©
 
is
, 
tho£
 
Çmed
 
š
 
the
 
V¬y


135 
»¥Ú£
 
h—d”
. 
We
 
assume
 
the
 
li¡
 
of
 h—d” 
Çmes
 
to
 
be
 
cÚ¡ªt


136 
—ch
 
URI
 
throughout
 
the
 
liãtime
 
of
h
­¶iÿtiÚ
, 
ªd
 
¡Üe


137 
th©
 
li¡
 
š
 ``
£lf
.
¡Üe
[
uri
].
£Ëùšg_h—d”s
``.

139 
The
 
™ems
 
cÚšed
 
š
 ``
£lf
.
¡Üe
[
uri
]`` 
have
 
keys
 
which
 
¬e
 
tu¶es
 
of


140 
»que¡
 
h—d”
 
	`v®ues
 (
š
 
the
 
§me
 
Üd”
 
as
h
Çmes
 iÀ
™s


141 
£Ëùšg_h—d”s
), 
ªd
 
v®ues
 
which
 
¬e
 
the
 
aùu®
 
»¥Ú£s
.

144 
maxobjeùs
 = 1000

147 
maxobj_size
 = 100000

150 
maxsize
 = 10000000

153 
d–ay
 = 600

156 
ªti¡am³de_timeout
 = 5

159 
expœe_äeq
 = 0.1

162 
debug
 = 
F®£


164 
def
 
	$__š™__
(
£lf
):

165 
£lf
.
	$ş—r
()

167 #RuÀ
£lf
.
expœe_ÿche
 
š
 
a
 
£·¿‹
 
d«mÚ
 
th»ad
.

168 
t
 = 
th»adšg
.
	`Th»ad
(
rg‘
=
£lf
.
expœe_ÿche
, 
Çme
='expire_cache')

169 
£lf
.
expœ©iÚ_th»ad
 = 
t


170 
	$£t_d«mÚ
(
t
, 
True
)

171 
t
.
	$¡¬t
()

173 
def
 
	$ş—r
(
£lf
):

175 
£lf
.
¡Üe
 = {
	}
}

176 
£lf
.
expœ©iÚs
 = {}

177 
£lf
.
tÙ_puts
 = 0

178 
£lf
.
tÙ_g‘s
 = 0

179 
£lf
.
tÙ_hi¡
 = 0

180 
£lf
.
tÙ_expœes
 = 0

181 
£lf
.
tÙ_nÚ_modif›d
 = 0

182 
£lf
.
cursize
 = 0

184 
def
 
	$expœe_ÿche
(
£lf
):

187 
This
 
funùiÚ
 
is
 
desigÃd
 
to
 
be
 
run
 
š
 
™s
 
own
 
d«mÚ
 
th»ad
,

188 
»ã»nûd
 
©
 ``
£lf
.
expœ©iÚ_th»ad
``.

191 #¬b™¿ry, 
so
 
we
 
check
 "whtime" 
to
 
avoid
 
exû±iÚs
.

192 #S“ 
tick‘s
 #99 
ªd
 #180 
mÜe
 
šfÜm©iÚ
.

193 
time
:

194 
now
 = 
time
.
	$time
()

195 #Mu¡ 
make
 
a
 
cİy
 
of
 
expœ©iÚs
 
so
 
™
 
dÛ¢
't change size

196 #duršg 
™”©iÚ


197 
expœ©iÚ_time
, 
objeùs
 
š
 
	$cİy™ems
(
£lf
.
expœ©iÚs
):

198 
expœ©iÚ_time
 <ğ
now
:

199 
obj_size
, 
uri
, 
£l_h—d”_v®ues
 
š
 
objeùs
:

200 
Œy
:

201 
d–
 
£lf
.
¡Üe
[
uri
][
	`tu¶e
(
£l_h—d”_v®ues
)]

202 
£lf
.
tÙ_expœes
 += 1

203 
£lf
.
cursize
 -ğ
obj_size


204 
exû±
 
KeyE¼Ü
:

205 #th
key
 
may
 
have
 
b“n
 
d–‘ed
 
–£wh”e


206 
·ss


207 
d–
 
£lf
.
expœ©iÚs
[
expœ©iÚ_time
]

208 
time
.
	$¦“p
(
£lf
.
expœe_äeq
)

210 
def
 
	$g‘
(
£lf
):

212 
»que¡
 = 
ch”rypy
.
£rvšg
.request

213 
£lf
.
tÙ_g‘s
 += 1

215 
uri
 = 
ch”rypy
.
	$u¾
(
qs
=
»que¡
.
qu”y_¡ršg
)

216 
uriÿche
 = 
£lf
.
¡Üe
.
	$g‘
(
uri
)

217 
uriÿche
 
is
 
NÚe
:

218  
NÚe


220 
h—d”_v®ues
 = [
»que¡
.
h—d”s
.
	`g‘
(
h
, '')

221 
h
 
š
 
uriÿche
.
£Ëùšg_h—d”s
]

222 
v¬ŸÁ
 = 
uriÿche
.
	`wa™
(
key
=
	`tu¶e
(
	`sÜ‹d
(
h—d”_v®ues
)),

223 
timeout
=
£lf
.
ªti¡am³de_timeout
,

224 
debug
=
£lf
.debug)

225 
v¬ŸÁ
 
is
 
nÙ
 
NÚe
:

226 
£lf
.
tÙ_hi¡
 += 1

227  
v¬ŸÁ


229 
def
 
	$put
(
£lf
, 
v¬ŸÁ
, 
size
):

231 
»que¡
 = 
ch”rypy
.
£rvšg
.request

232 
»¥Ú£
 = 
ch”rypy
.
£rvšg
.response

234 
uri
 = 
ch”rypy
.
	$u¾
(
qs
=
»que¡
.
qu”y_¡ršg
)

235 
uriÿche
 = 
£lf
.
¡Üe
.
	$g‘
(
uri
)

236 
uriÿche
 
is
 
NÚe
:

237 
uriÿche
 = 
	$AÁiSm³deCache
()

238 
uriÿche
.
£Ëùšg_h—d”s
 = [

239 
e
.
v®ue
 
š
 
»¥Ú£
.
h—d”s
.
	`–em’ts
('Vary')]

240 
£lf
.
¡Üe
[
uri
] = 
uriÿche


242 
	`Ën
(
£lf
.
¡Üe
è< s–f.
maxobjeùs
:

243 
tÙ®_size
 = 
£lf
.
cursize
 + 
size


245 #check 
th”e
's space forhe object

246 ià(
size
 < 
£lf
.
maxobj_size
 
ªd
 
tÙ®_size
 < s–f.
maxsize
):

247 #add 
to
 
the
 
expœ©iÚs
 
li¡


248 
expœ©iÚ_time
 = 
»¥Ú£
.
time
 + 
£lf
.
d–ay


249 
buck‘
 = 
£lf
.
expœ©iÚs
.
	$£tdeçuÉ
(
expœ©iÚ_time
, [])

250 
buck‘
.
	`­³nd
((
size
, 
uri
, 
uriÿche
.
£Ëùšg_h—d”s
))

252 #add 
to
 
the
 
ÿche


253 
h—d”_v®ues
 = [
»que¡
.
h—d”s
.
	`g‘
(
h
, '')

254 
h
 
š
 
uriÿche
.
£Ëùšg_h—d”s
]

255 
uriÿche
[
	`tu¶e
(
	`sÜ‹d
(
h—d”_v®ues
))] = 
v¬ŸÁ


256 
£lf
.
tÙ_puts
 += 1

257 
£lf
.
cursize
 = 
tÙ®_size


259 
def
 
	$d–‘e
(
£lf
):

261 
uri
 = 
ch”rypy
.
	$u¾
(
qs
=
ch”rypy
.
£rvšg
.
»que¡
.
qu”y_¡ršg
)

262 
£lf
.
¡Üe
.
	$pİ
(
uri
, 
NÚe
)

265 
def
 
	`g‘
(
šv®id_m‘hods
=("POST", "PUT", "DELETE"), 
debug
=
F®£
, **
kw¬gs
):

268 
If
 
POST
, 
PUT
, 
Ü
 
DELETE
:

269 * 
	$šv®id©es
 (
d–‘es
è
ªy
 
ÿched
 
»¥Ú£
 
this
 
»sourû


270 * 
£ts
 
»que¡
.
ÿched
 = 
F®£


271 * 
£ts
 
»que¡
.
ÿch—bË
 = 
F®£


273 
a
 
ÿched
 
cİy
 
exi¡s
:

274 * 
£ts
 
»que¡
.
ÿched
 = 
True


275 * 
£ts
 
»que¡
.
ÿch—bË
 = 
F®£


276 * 
£ts
 
»¥Ú£
.
h—d”s
 
to
 
the
 
ÿched
 
v®ues


277 * 
checks
 
the
 
ÿched
 
La¡
-
Modif›d
 
»¥Ú£
 
h—d”
 
agaš¡
he

278 
cu¼’t
 
If
-(
Un
)
Modif›d
-
Sšû
 
»que¡
 
h—d”s
; 
¿i£s
 304

279 
Ãûs§ry
.

280 * 
£ts
 
»¥Ú£
.
¡©us
 
ªd
„e¥Ú£.
body
 
to
 
the
 
ÿched
 
v®ues


281 * 
»tuºs
 
True


283 
Ùh”wi£
:

284 * 
£ts
 
»que¡
.
ÿched
 = 
F®£


285 * 
£ts
 
»que¡
.
ÿch—bË
 = 
True


286 * 
»tuºs
 
F®£


288 
»que¡
 = 
ch”rypy
.
£rvšg
.request

289 
»¥Ú£
 = 
ch”rypy
.
£rvšg
.response

291 
nÙ
 
	`ha§‰r
(
ch”rypy
, "_cache"):

292 #Mak
a
 
´oûss
-
wide
 
Cache
 
objeù
.

293 
ch”rypy
.
_ÿche
 = 
kw¬gs
.
	`pİ
("ÿche_şass", 
MemÜyCache
)()

295 #Tak
®l
 
»maššg
 
kw¬gs
 
ªd
 
£t
 
them
 
Ú
 
the
 
Cache
 
objeù
.

296 
k
, 
v
 
š
 
kw¬gs
.
	$™ems
():

297 
	$£‰r
(
ch”rypy
.
_ÿche
, 
k
, 
v
)

298 
ch”rypy
.
_ÿche
.
debug
 = debug

300 #POST, 
PUT
, 
DELETE
 
should
 
	`šv®id©e
 (
d–‘e
è
the
 
ÿched
 
cİy
.

301 #S“ 
h‰p
:

302 
»que¡
.
m‘hod
 
š
 
šv®id_m‘hods
:

303 
debug
:

304 
ch”rypy
.
	`log
('request.method %r in invalid_methods %r' %

305 (
»que¡
.
m‘hod
, 
šv®id_m‘hods
), 'TOOLS.CACHING')

306 
ch”rypy
.
_ÿche
.
	$d–‘e
()

307 
»que¡
.
ÿched
 = 
F®£


308 
»que¡
.
ÿch—bË
 = 
F®£


309  
F®£


311 'no-ÿche' 
š
 [
e
.
v®ue
 š 
»que¡
.
h—d”s
.
	`–em’ts
('Pragma')]:

312 
»que¡
.
ÿched
 = 
F®£


313 
»que¡
.
ÿch—bË
 = 
True


314  
F®£


316 
ÿche_d©a
 = 
ch”rypy
.
_ÿche
.
	$g‘
()

317 
»que¡
.
ÿched
 = 
	$boŞ
(
ÿche_d©a
)

318 
»que¡
.
ÿch—bË
 = 
nÙ
„eque¡.
ÿched


319 
»que¡
.
ÿched
:

320 #S”v
the
 
ÿched
 
cİy
.

321 
max_age
 = 
ch”rypy
.
_ÿche
.
d–ay


322 
v
 
š
 [
e
.
v®ue
 š 
»que¡
.
h—d”s
.
	`–em’ts
('Cache-Control')]:

323 
©oms
 = 
v
.
	`¥l™
('=', 1)

324 
dœeùive
 = 
©oms
.
	$pİ
(0)

325 
dœeùive
 == 'max-age':

326 
	`Ën
(
©oms
è!ğ1 
Ü
 
nÙ
‡toms[0].
	$isdig™
():

327 
¿i£
 
ch”rypy
.
	`HTTPE¼Ü
(400, "Invalid Cache-Control header")

328 
max_age
 = (
©oms
[0])

330 
–if
 
dœeùive
 == 'no-cache':

331 
debug
:

332 
ch”rypy
.
	`log
('Ignoring cache dueo Cache-Control:‚o-cache',

334 
»que¡
.
ÿched
 = 
F®£


335 
»que¡
.
ÿch—bË
 = 
True


336  
F®£


338 
debug
:

339 
ch”rypy
.
	`log
('Reading„esponse from cache', 'TOOLS.CACHING')

340 
s
, 
h
, 
b
, 
ü—‹_time
 = 
ÿche_d©a


341 
age
 = (
»¥Ú£
.
time
 - 
ü—‹_time
)

342 ià(
age
 > 
max_age
):

343 
debug
:

344 
ch”rypy
.
	`log
('IgnÜšg cachdutØag> %d' % 
max_age
,

346 
»que¡
.
ÿched
 = 
F®£


347 
»que¡
.
ÿch—bË
 = 
True


348  
F®£


350 #Cİy 
the
 
»¥Ú£
 
h—d”s
. 
S“
 
h‰p
:

351 
»¥Ú£
.
h—d”s
 = 
rh
 = 
h‰put
.
	$H—d”M­
()

352 
k
 
š
 
h
:

353 
diù
.
	`__£t™em__
(
rh
, 
k
, diù.
	$__g‘™em__
(
h
, 
k
))

355 #Add 
the
 
»quœed
 
Age
 
h—d”


356 
»¥Ú£
.
h—d”s
["Age"] = 
	$¡r
(
age
)

358 
Œy
:

359 #NÙ
th©
 
v®id©e_sšû
 
d•’ds
 
Ú
 
a
 
La¡
-
Modif›d
 
h—d”
;

360 #thi 
was
 
put
 
što
 
the
 
ÿched
 
cİy
, 
ªd
 
should
 
have
 
b“n


361 #»su¼eùed 
ju¡
 
	`above
 (
»¥Ú£
.
h—d”s
 = 
ÿche_d©a
[1]).

362 
ıtoŞs
.
	$v®id©e_sšû
()

363 
exû±
 
ch”rypy
.
HTTPRedœeù
:

364 
x
 = 
sys
.
	`exc_šfo
()[1]

365 
x
.
¡©us
 == 304:

366 
ch”rypy
.
_ÿche
.
tÙ_nÚ_modif›d
 += 1

367 
¿i£


369 #£rv
™
 & 
g‘
 
out
 
äom
 
the
 
»que¡


370 
»¥Ú£
.
¡©us
 = 
s


371 
»¥Ú£
.
body
 = 
b


373 
debug
:

374 
ch”rypy
.
	`log
('request is‚ot cached', 'TOOLS.CACHING')

375  
»que¡
.
ÿched


378 
def
 
	$‹e_ouut
():

380 #U£d 
by
 
CachšgToŞ
 by 
©chšg
 
to
 
»que¡
.
hooks


382 
»que¡
 = 
ch”rypy
.
£rvšg
.request

383 'no-¡Üe' 
š
 
»que¡
.
h—d”s
.
	`v®ues
('Cache-Control'):

386 
def
 
	$‹e
(
body
):

388 ià('no-ÿche' 
š
 
»¥Ú£
.
h—d”s
.
	`v®ues
('P¿gma'è
Ü


389 'no-¡Üe' 
š
 
»¥Ú£
.
h—d”s
.
	`v®ues
('Cache-Control')):

390 
chunk
 
š
 
body
:

391 
y›ld
 
chunk


394 
ouut
 = []

395 
chunk
 
š
 
body
:

396 
ouut
.
	$­³nd
(
chunk
)

397 
y›ld
 
chunk


399 #§v
the
 
ÿche
 
d©a


400 
body
 = 
	`Áob
('').
	$još
(
ouut
)

401 
ch”rypy
.
_ÿche
.
	`put
((
»¥Ú£
.
¡©us
,„e¥Ú£.
h—d”s
 
Ü
 {
	}
},

402 
	gbody
, 
	g»¥Ú£
.
	gtime
), 
	$Ën
(
body
))

404 
»¥Ú£
 = 
ch”rypy
.
£rvšg
.response

405 
»¥Ú£
.
body
 = 
	$‹e
(
»¥Ú£
.
body
)

408 
def
 
	$expœes
(
£cs
=0, 
fÜû
=
F®£
, 
debug
=False):

411 
£cs


412 
Mu¡
 
be
 
e™h”
 
ª
 
Ü
 
a
 
d©‘ime
.
timed–
, 
ªd
 
šdiÿ‹s
 
the


413 
numb”
 
of
 
£cÚds
 
b‘w“n
 
»¥Ú£
.
time
 
ªd
 
wh’
 
the
„e¥Ú£ 
should


414 
expœe
. 
The
 'Expœes' 
h—d”
 
wl
 
be
 
£t
 
to
 
»¥Ú£
.
time
 + 
£cs
.

415 
If
 
£cs
 
is
 
z”o
, 
the
 'Expœes' 
h—d”
 i 
£t
 
Úe
 
y—r
 
š
h
·¡
, 
ªd


416 
the
 
fŞlowšg
 "ÿch´ev’tiÚ" 
h—d”s
 
¬e
 
®so
 
£t
:

418 * 
P¿gma
: 
no
-
ÿche


419 * 
Cache
-
CÚŒŞ
':‚o-cache, must-revalidate

421 
fÜû


422 
If
 
F®£
, 
the
 
fŞlowšg
 
h—d”s
 
¬e
 
checked
:

424 * 
Eg


425 * 
La¡
-
Modif›d


426 * 
Age


427 * 
Expœes


429 
If
 
ªy
 
¬e
 
®»ady
 
´e£Á
, 
nÚe
 
of
 
the
 
above
 
»¥Ú£
 
h—d”s
‡» 
£t
.

433 
»¥Ú£
 = 
ch”rypy
.
£rvšg
.response

434 
h—d”s
 = 
»¥Ú£
.headers

436 
ÿch—bË
 = 
F®£


437 
nÙ
 
fÜû
:

438 #som
h—d”
 
Çmes
 
th©
 
šdiÿ‹
h© 
the
 
»¥Ú£
 
ÿn
 
be
 
ÿched


439 
šdiÿtÜ
 
	`š
 ('Etag', 'Last-Modified', 'Age', 'Expires'):

440 
šdiÿtÜ
 
š
 
h—d”s
:

441 
ÿch—bË
 = 
True


444 
nÙ
 
ÿch—bË
 
ªd
‚Ù 
fÜû
:

445 
debug
:

446 
ch”rypy
.
	`log
('request is‚ot cacheable', 'TOOLS.EXPIRES')

448 
debug
:

449 
ch”rypy
.
	`log
('request is cacheable', 'TOOLS.EXPIRES')

450 
	$isš¡ªû
(
£cs
, 
d©‘ime
.
timed–
):

451 
£cs
 = (86400 * secs.
days
è+ secs.
£cÚds


453 
£cs
 == 0:

454 
fÜû
 
	`Ü
 ("P¿gma" 
nÙ
 
š
 
h—d”s
):

455 
h—d”s
["Pragma"] = "no-cache"

456 
ch”rypy
.
£rvšg
.
»que¡
.
´ÙocŞ
 >= (1, 1):

457 
fÜû
 
Ü
 "Cache-CÚŒŞ" 
nÙ
 
š
 
h—d”s
:

458 
h—d”s
["Cache-Control"] = "no-cache, must-revalidate"

459 #S‘ 
ª
 
ex¶ic™
 
Expœes
 
d©e
 
š
 
the
 
·¡
.

460 
expœy
 = 
h‰put
.
	$HTTPD©e
(1169942400.0)

462 
expœy
 = 
h‰put
.
	`HTTPD©e
(
»¥Ú£
.
time
 + 
£cs
)

463 
fÜû
 
Ü
 "Expœes" 
nÙ
 
š
 
h—d”s
:

464 
h—d”s
["Expœes"] = 
expœy


	@trunk/objs/CherryPy-3.2.4/cherrypy/lib/covercp.py

3 
To
 
u£
 
this
 
	gmoduË
, 
Ü
 
the
 
cov”age
 
toŞs
 
š
h
‹¡
 
	gsu™e
,

4 
you
 
Ãed
 
to
 
	gdowÆßd
 'cov”age.py', 
e™h”
 
G¬‘h
 
	gR“s
' `original

5 
	gim¶em’tiÚ
 <
	gh‰p
:

6 
Ü
 
Ned
 
B©ch–d”
's `enhanced version:

7 <
h‰p
:

9 
To
 
tuº
 
Ú
 
cov”age
 
Œacšg
, 
u£
 
the
 
fŞlowšg
 
	gcode
::

11 
ch”rypy
.
’gše
.
subsüibe
('¡¬t', 
cov”ı
.
¡¬t
)

13 
DO
 
NOT
 
subsüibe
 
ªythšg
 
Ú
 
	gthe
 '¡¬t_th»ad' 
	gchªÃl
, 
as
 
´eviou¦y


14 
	g»comm’ded
. 
C®lšg
 
¡¬t
 
Úû
 
š
 
the
 
maš
 
th»ad
 
should
 
be
 
suffic›Á


15 
to
 
¡¬t
 
cov”age
 
Ú
 
®l
 
	gth»ads
. 
C®lšg
 s¹ 
agaš
 
š
 
—ch
 
th»ad


16 
efãùiv–y
 
ş—rs
 
ªy
 
cov”age
 
d©a
 
g©h”ed
 
up
 
to
 
th©
 
	gpošt
.

18 
Run
 
your
 
	gcode
, 
th’
 
u£
 
	gthe
 ``
	gcov”ı
.
£rve
()`` 
funùiÚ
 
to
 
brow£
 
the


19 
»suÉs
 
š
 
a
 
web
 
	gbrow£r
. 
If
 
you
 
run
 
this
 
moduË
 
äom
 
the
 
commªd
 
	glše
,

20 
™
 
wl
 
	gÿÎ
 ``
£rve
()`` 
	gyou
.

23 
impÜt
 
»


24 
impÜt
 
sys


25 
impÜt
 
cgi


26 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
quÙe_¶us


27 
impÜt
 
	gos
, os.
·th


28 
	gloÿlFe
 = 
os
.
·th
.
još
(os.·th.
dœÇme
(
__fe__
), "coverage.cache")

30 
	gthe_cov”age
 = 
NÚe


31 
Œy
:

32 
äom
 
cov”age
 
impÜt
 coverage

33 
the_cov”age
 = 
	$cov”age
(
d©a_fe
=
loÿlFe
)

34 
def
 
	$¡¬t
():

35 
the_cov”age
.
	$¡¬t
()

36 
exû±
 
ImpÜtE¼Ü
:

37 #S‘tšg 
the_cov”age
 
to
 
NÚe
 
wl
 
¿i£
 
”rÜs


38 #th© 
Ãed
 
to
 
be
 
Œ­³d
 
down¡»am
.

39 
the_cov”age
 = 
NÚe


41 
impÜt
 
w¬nšgs


42 
w¬nšgs
.
	`w¬n
("No code coverage will be…erformed; coverage.py could‚ot be imported.")

44 
def
 
	$¡¬t
():

45 
·ss


46 
¡¬t
.
´iÜ™y
 = 20

48 
TEMPLATE_MENU
 = """<html>

49 <
h—d
>

50 <
t™Ë
>
Ch”ryPy
 
Cov”age
 
M’u
</title>

51 <
¡yË
>

52 
body
 {
fÚt
: 9
±
 
ArŸl
, 
£rif
;
	}
}

54 
	gfÚt
-
	gsize
: 8
±
;

55 
	gfÚt
-
	gçmy
: 
And®e
 
MÚo
, 
	gmÚo¥aû
;

56 
	gwh™e
-
	g¥aû
: 
´e
;

58 #Œ“ 
a
:
aùive
,‡:
focus
 {

59 
	gbackground
-
	gcŞÜ
: 
bÏck
;

60 
	g·ddšg
: 1
px
;

61 
	gcŞÜ
: 
wh™e
;

62 
	gbÜd”
: 0
px
 
sŞid
 #9999FF;

63 -
	gmoz
-
	gouše
-
	g¡yË
: 
nÚe
;

65 .
	gç
 { 
	gcŞÜ
: 
»d
;}

66 .
	g·ss
 { 
	gcŞÜ
: #888;}

67 #pù { 
‹xt
-
®ign
: 
right
;}

68 
	gh3
 {

69 
	gfÚt
-
	gsize
: 
sm®l
;

70 
	gfÚt
-
	gweight
: 
bŞd
;

71 
	gfÚt
-
	g¡yË
: 
™®ic
;

72 
	gm¬gš
-
	gtİ
: 5
px
;

74 
	gšput
 { 
	gbÜd”
: 1
px
 
sŞid
 #ccc; 
	g·ddšg
: 2px; }

75 .
	gdœeùÜy
 {

76 
	gcŞÜ
: #933;

77 
	gfÚt
-
	g¡yË
: 
™®ic
;

78 
	gfÚt
-
	gweight
: 
bŞd
;

79 
	gfÚt
-
	gsize
: 10
±
;

81 .
	gfe
 {

82 
	gcŞÜ
: #400;

84 
	ga
 { 
	g‹xt
-
	gdecÜ©iÚ
: 
nÚe
; }

86 
	gcŞÜ
: 
wh™e
;

87 
	gfÚt
-
	gsize
: 8
±
;

88 
	gfÚt
-
	gçmy
: 
And®e
 
MÚo
, 
	gmÚo¥aû
;

89 
	gwidth
: 100%;

90 
	gbackground
-
	gcŞÜ
: 
bÏck
;

92 #üumb 
a
 {

93 
	gcŞÜ
: #f88;

96 
	glše
-
	gheight
: 2.3e
m
;

97 
	gbÜd”
: 1
px
 
sŞid
 
bÏck
;

98 
	gbackground
-
	gcŞÜ
: #eee;

99 
	g·ddšg
: 4
px
;

102 
	gwidth
: 100%;

103 
	gm¬gš
-
	gbÙtom
: 3
px
;

104 
	gbÜd”
: 1
px
 
sŞid
 #999;

107 
	gbackground
-
	gcŞÜ
: 
bÏck
;

108 
	gcŞÜ
: 
wh™e
;

109 
	gbÜd”
: 0;

110 
	gm¬gš
-
	gbÙtom
: -9
px
;

112 </
	g¡yË
>

113 </
	gh—d
>

114 <
	gbody
>

115 <
	gh2
>
Ch”ryPy
 
	gCov”age
</h2>"""

117 
	gTEMPLATE_FORM
 = """

118 <
div
 
id
="options">

119 <
fÜm
 
aùiÚ
='m’u' 
m‘hod
=
GET
>

120 <
šput
 
ty³
='hidd’' 
Çme
='ba£' 
v®ue
='%(base)s' />

121 
Show
 
³rûÁages
 <
šput
 
ty³
='checkbox' %(
showpù
)
s
 
Çme
='showpù' 
v®ue
='checked' /><
br
 />

122 
Hide
 
fes
 
ov”
 <
šput
 
ty³
='‹xt' 
id
='pù' 
Çme
='pù' 
v®ue
='%Õù)s' 
size
='3' />%%<
br
 />

123 
Exşude
 
fes
 
m©chšg
<
br
 />

124 <
šput
 
ty³
='‹xt' 
id
='exşude' 
Çme
='exşude' 
v®ue
='%Óxşude)s' 
size
='20' />

125 <
br
 />

127 <
šput
 
ty³
='subm™' 
v®ue
='Chªgv›w' 
id
="submit"/>

128 </
fÜm
>

129 </
div
>"""

131 
TEMPLATE_FRAMESET
 = """<html>

132 <
h—d
><
t™Ë
>
Ch”ryPy
 
cov”age
 
d©a
</title></head>

133 <
äame£t
 
cŞs
='250, 1*'>

134 <
äame
 
¤c
='menu?base=%s' />

135 <
äame
 
Çme
='maš' 
¤c
='' />

136 </
äame£t
>

137 </
html
>

140 
TEMPLATE_COVERAGE
 = """<html>

141 <
h—d
>

142 <
t™Ë
>
Cov”age
 %(
Çme
)
s
</title>

143 <
¡yË
>

144 
h2
 { 
m¬gš
-
bÙtom
: .25e
m
; }

145 
	gp
 { 
	gm¬gš
: .25e
m
; }

146 .
	gcov”ed
 { 
	gcŞÜ
: #000; 
	gbackground
-color: #fff; }

147 .
	gnÙcov”ed
 { 
	gcŞÜ
: #ãe; 
	gbackground
-color: #500; }

148 .
	gexşuded
 { 
	gcŞÜ
: #00f; 
	gbackground
-color: #fff; }

149 
	gbË
 .
	gcov”ed
,abË .
	gnÙcov”ed
,abË .
	gexşuded


150 { 
	gfÚt
-
	gçmy
: 
And®e
 
MÚo
, 
	gmÚo¥aû
;

151 
	gfÚt
-
	gsize
: 10
±
; 
	gwh™e
-
	g¥aû
: 
´e
; }

153 .
	glš’o
 { 
	gbackground
-
	gcŞÜ
: #eee;}

154 .
	gnÙcov”ed
 .
	glš’o
 { 
	gbackground
-
	gcŞÜ
: #000;}

155 
	gbË
 { 
	gbÜd”
-
	gcŞÏp£
: 
cŞÏp£
;

156 </
	g¡yË
>

157 </
	gh—d
>

158 <
	gbody
>

159 <
	gh2
>%(
	gÇme
)
	gs
</h2>

160 <
	gp
>%(
	gfuÎ·th
)
	gs
</p>

161 <
	gp
>
	gCov”age
: %(
pc
)
s
%%</
p
>"""

163 
TEMPLATE_LOC_COVERED
 = """<Œ cÏss="
cov”ed
">

164 <
td
 
şass
="lš’o">%
s
&
nb¥
;</
	gtd
>

165 <
	gtd
>%
	gs
</td>

166 </
	gŒ
>\
	gn
"""

167 
	gTEMPLATE_LOC_NOT_COVERED
 = """<Œ cÏss="
nÙcov”ed
">

168 <
td
 
şass
="lš’o">%
s
&
nb¥
;</
	gtd
>

169 <
	gtd
>%
	gs
</td>

170 </
	gŒ
>\
	gn
"""

171 
	gTEMPLATE_LOC_EXCLUDED
 = """<Œ cÏss="
exşuded
">

172 <
td
 
şass
="lš’o">%
s
&
nb¥
;</
	gtd
>

173 <
	gtd
>%
	gs
</td>

174 </
	gŒ
>\
	gn
"""

176 
	gTEMPLATE_ITEM
 = "%s%s<a class='file' href='report?name=%s'arget='main'>%s</a>\n"

178 
def
 
_³rûÁ
(
¡©em’ts
, 
missšg
):

179 
s
 = 
Ën
(
¡©em’ts
)

180 
e
 = 
s
 - 
Ën
(
missšg
)

181 
s
 > 0:

182  (
round
(100.0 * 
e
 / 
s
))

185 
def
 
_show_b¿nch
(
roÙ
, 
ba£
, 
·th
, 
pù
=0, 
showpù
=
F®£
, 
exşude
="",

186 
cov”age
=
the_cov”age
):

188 #Show 
the
 
dœeùÜy
 
Çme
 
ªd
 
ªy
 
of
 
our
 
chd»n


189 
dœs
 = [
k
 k, 
v
 
š
 
roÙ
.
™ems
() v]

190 
	gdœs
.
sÜt
()

191 
Çme
 
š
 
	gdœs
:

192 
Ãw·th
 = 
os
.
·th
.
još
Õ©h, 
Çme
)

194 
	gÃw·th
.
low”
().
¡¬tsw™h
(
ba£
):

195 
»Í©h
 = 
Ãw·th
[
Ën
(
ba£
):]

196 
y›ld
 "| " * 
»Í©h
.
couÁ
(
os
.
£p
)

197 
y›ld
 "<a class='directory' href='menu?base=%s&exclude=%s'>%s</a>\n" % \

198 (
Ãw·th
, 
quÙe_¶us
(
exşude
), 
	gÇme
)

200 
chunk
 
š
 
_show_b¿nch
(
roÙ
[
Çme
], 
ba£
, 
Ãw·th
, 
pù
, 
showpù
, 
exşude
, 
cov”age
=coverage):

201 
y›ld
 
chunk


203 #Now 
li¡
 
the
 
fes


204 
·th
.
low”
().
¡¬tsw™h
(
ba£
):

205 
»Í©h
 = 
·th
[
Ën
(
ba£
):]

206 
fes
 = [
k
 k, 
v
 
š
 
roÙ
.
™ems
(è
nÙ
 v]

207 
	gfes
.
sÜt
()

208 
Çme
 
š
 
	gfes
:

209 
Ãw·th
 = 
os
.
·th
.
još
Õ©h, 
Çme
)

211 
	gpc_¡r
 = ""

212 
showpù
:

213 
Œy
:

214 
_
, 
	g¡©em’ts
, 
	g_
, 
	gmissšg
, _ = 
cov”age
.
ª®ysis2
(
Ãw·th
)

215 
exû±
:

216 #Yes, 
we
 
»®ly
 
wªt
 
to
 
·ss
 
Ú
 
®l
 
”rÜs
.

217 
·ss


219 
pc
 = 
_³rûÁ
(
¡©em’ts
, 
missšg
)

220 
	gpc_¡r
 = ("%3d%% " % 
pc
).
»¶aû
(' ','&nbsp;')

221 
	gpc
 < (
	gpù
è
Ü
…c == -1:

222 
pc_¡r
 = "<span class='fail'>%s</span>" %…c_str

224 
pc_¡r
 = "<span class='pass'>%s</span>" %…c_str

226 
y›ld
 
TEMPLATE_ITEM
 % ("| " * (
»Í©h
.
couÁ
(
os
.
£p
) + 1),

227 
	gpc_¡r
, 
	gÃw·th
, 
	gÇme
)

229 
def
 
_sk_fe
(
·th
, 
exşude
):

230 
exşude
:

231  
boŞ
(
»
.
£¬ch
(
exşude
, 
·th
))

233 
def
 
_g¿á
(
·th
, 
Œ“
):

234 
d
 = 
Œ“


236 
p
 = 
·th


237 
©oms
 = []

238 
True
:

239 
p
, 
	g
 = 
os
.
·th
.
¥l™
(p)

240 
nÙ
 

:

242 
©oms
.
­³nd
(

)

243 
©oms
.
­³nd
(
p
)

244 
p
 != "/":

245 
©oms
.
­³nd
("/")

247 
©oms
.
»v”£
()

248 
node
 
š
 
©oms
:

249 
node
:

250 
d
 = d.
£tdeçuÉ
(
node
, {})

252 
def
 
g‘_Œ“
(
ba£
, 
exşude
, 
cov”age
=
the_cov”age
):

254 
Œ“
 = {}

255 
runs
 = 
cov”age
.
d©a
.
execu‹d_fes
()

256 
·th
 
š
 
runs
:

257 
nÙ
 
_sk_fe
(
·th
, 
exşude
è
ªd
‚Ù 
	gos
.
	g·th
.
isdœ
(path):

258 
_g¿á
(
·th
, 
Œ“
)

259  
Œ“


261 
şass
 
Cov”Sts
(
objeù
):

263 
def
 
__š™__
(
£lf
, 
cov”age
, 
roÙ
=
NÚe
):

264 
£lf
.
cov”age
 = coverage

265 
roÙ
 
is
 
NÚe
:

266 #Gues 
š™Ÿl
 
d•th
. 
Fes
 
outside
 
this
 
·th
 
wl
 
nÙ
 
be


267 #»achabË 
äom
 
the
 
web
 
š‹rçû
.

268 
impÜt
 
ch”rypy


269 
roÙ
 = 
os
.
·th
.
dœÇme
(
ch”rypy
.
__fe__
)

270 
£lf
.
roÙ
 =„oot

272 
def
 
šdex
(
£lf
):

273  
TEMPLATE_FRAMESET
 % 
£lf
.
roÙ
.
low”
()

274 
šdex
.
expo£d
 = 
True


276 
def
 
m’u
(
£lf
, 
ba£
="/", 
pù
="50", 
showpù
="",

277 
exşude
=
r
'python\d\.\d|test|tut\d|tutorial'):

279 #Th
cov”age
 
moduË
 
u£s
 
®l
-
low”
-
Çmes
.

280 
ba£
 = ba£.
low”
().
r¡r
(
os
.
£p
)

282 
y›ld
 
TEMPLATE_MENU


283 
y›ld
 
TEMPLATE_FORM
 % 
loÿls
()

285 #S¹ 
by
 
showšg
 
lšks
 
·»Á
 
·ths


286 
y›ld
 "<div id='crumbs'>"

287 
·th
 = ""

288 
©oms
 = 
ba£
.
¥l™
(
os
.
£p
)

289 
©oms
.
pİ
()

290 
©om
 
š
 
©oms
:

291 
·th
 +ğ
©om
 + 
os
.
£p


292 
y›ld
 ("<a href='menu?base=%s&exclude=%s'>%s</a> %s"

293 % (
·th
, 
quÙe_¶us
(
exşude
), 
©om
, 
os
.
£p
))

294 
	gy›ld
 "</div>"

296 
	gy›ld
 "<div id='tree'>"

298 #Th’ 
di¥Ïy
 
the
 
Œ“


299 
	gŒ“
 = 
g‘_Œ“
(
ba£
, 
exşude
, 
£lf
.
cov”age
)

300 
nÙ
 
	gŒ“
:

301 
y›ld
 "<p>No modules covered.</p>"

303 
chunk
 
š
 
_show_b¿nch
(
Œ“
, 
ba£
, "/", 
pù
,

304 
showpù
=='checked', 
exşude
, 
cov”age
=
£lf
.coverage):

305 
y›ld
 
chunk


307 
y›ld
 "</div>"

308 
y›ld
 "</body></html>"

309 
m’u
.
expo£d
 = 
True


311 
def
 
ªnÙ©ed_fe
(
£lf
, 
f’ame
, 
¡©em’ts
, 
exşuded
, 
missšg
):

312 
sourû
 = 
İ’
(
f’ame
, 'r')

313 
	gbufãr
 = []

314 
lš’o
, 
lše
 
š
 
’um”©e
(
sourû
.
»adlšes
()):

315 
lš’o
 += 1

316 
lše
 =†še.
¡r
("\n\r")

317 
em±y_the_bufãr
 = 
True


318 
lš’o
 
š
 
exşuded
:

319 
‹m¶©e
 = 
TEMPLATE_LOC_EXCLUDED


320 
–if
 
lš’o
 
š
 
missšg
:

321 
‹m¶©e
 = 
TEMPLATE_LOC_NOT_COVERED


322 
–if
 
lš’o
 
š
 
¡©em’ts
:

323 
‹m¶©e
 = 
TEMPLATE_LOC_COVERED


325 
em±y_the_bufãr
 = 
F®£


326 
bufãr
.
­³nd
((
lš’o
, 
lše
))

327 
	gem±y_the_bufãr
:

328 
Êo
, 
·¡lše
 
š
 
	gbufãr
:

329 
y›ld
 
‹m¶©e
 % (
Êo
, 
	gcgi
.
esÿ³
(
·¡lše
))

330 
	gbufãr
 = []

331 
y›ld
 
‹m¶©e
 % (
lš’o
, 
	gcgi
.
esÿ³
(
lše
))

333 
def
 
»pÜt
(
£lf
, 
Çme
):

334 
f’ame
, 
	g¡©em’ts
, 
	gexşuded
, 
	gmissšg
, 
	g_
 = 
£lf
.
cov”age
.
ª®ysis2
(
Çme
)

335 
pc
 = 
_³rûÁ
(
¡©em’ts
, 
missšg
)

336 
y›ld
 
	gTEMPLATE_COVERAGE
 % 
diù
(
Çme
=
os
.
·th
.
ba£Çme
(name),

337 
fuÎ·th
=
Çme
,

338 
pc
=pc)

339 
y›ld
 '<table>\n'

340 
lše
 
š
 
£lf
.
ªnÙ©ed_fe
(
f’ame
, 
¡©em’ts
, 
exşuded
,

341 
missšg
):

342 
y›ld
 
lše


343 
y›ld
 '</table>'

344 
y›ld
 '</body>'

345 
y›ld
 '</html>'

346 
»pÜt
.
expo£d
 = 
True


349 
def
 
£rve
(
·th
=
loÿlFe
, 
pÜt
=8080, 
roÙ
=
NÚe
):

350 
cov”age
 
is
 
NÚe
:

351 
¿i£
 
ImpÜtE¼Ü
("The coverage module could‚ot be imported.")

352 
äom
 
cov”age
 
impÜt
 coverage

353 
cov
 = 
cov”age
(
d©a_fe
 = 
·th
)

354 
cov
.
lßd
()

356 
impÜt
 
ch”rypy


357 
ch”rypy
.
cÚfig
.
upd©e
({'£rv”.sock‘_pÜt': (
pÜt
),

361 
ch”rypy
.
quick¡¬t
(
Cov”Sts
(
cov
, 
roÙ
))

363 
	g__Çme__
 == "__main__":

364 
£rve
(*
tu¶e
(
sys
.
¬gv
[1:]))

	@trunk/objs/CherryPy-3.2.4/cherrypy/lib/cpstats.py

3 
	gOv”v›w


6 
Sti¡ics
 
about
 
´og¿m
 
İ”©iÚ
 
¬e
 
ª
 
šv®uabË
 
mÚ™Üšg
 
ªd
 
debuggšg


7 
toŞ
. 
UnfÜtuÇ‹ly
, 
the
 
g©h”šg
 
ªd
 
»pÜtšg
 
of
 
the£
 
ü™iÿl
 
v®ues
 
is


8 
usu®ly
 
	gad
-
	ghoc
. 
This
 
·ckage
 
aims
 
to
 
add
 
a
 
ûÁ¿lized
 
¶aû
 
g©h”šg


9 
¡©i¡iÿl
 
³rfÜmªû
 
	gd©a
, 
a
 
¡ruùu»
 
»cÜdšg
 
th©
 
d©a
 
which


10 
´ovides
 
exŒ­Ş©iÚ
 
of
 
th©
 
d©a
 
što
 
mÜe
 
u£ful
 
	gšfÜm©iÚ
,

11 
ªd
 
a
 
m‘hod
 
of
 
£rvšg
 
th©
 
d©a
 
to
 
bÙh
 
humª
 
šve¡ig©Üs
‡nd

12 
mÚ™Üšg
 
	gsoáw¬e
. 
	gL‘
'sƒxamineƒach ofhose in more detail.

14 
D©a
 
	gG©h”šg


17 
Ju¡
 
as
 
	gPythÚ
's `logging` module…rovides‡ common importable for gathering

18 
ªd
 
£ndšg
 
	gmes§ges
, 
³rfÜmªû
 
¡©i¡ics
 
would
 
b’ef™
 
äom
 
a
 
sim¬


19 
commÚ
 
	gmechªism
, 
ªd
 
Úe
 
th©
 
dÛs
 *
nÙ
* 
»quœe
 
—ch
 
·ckage
 
which
 
wishes


20 
to
 
cŞËù
 
¡©s
Ø
impÜt
 
a
 
	gthœd
-
·¹y
 
	gmoduË
. 
	gTh”efÜe
, 
we
 
choo£
o

21 
	g»
-
u£
 
	gthe
 `
	gloggšg
` 
moduË
 
by
 
addšg
 
	ga
 `
	g¡©i¡ics
` 
objeù
 
to
 
	g™
.

23 
	gTh©
 `
	gloggšg
.
	g¡©i¡ics
` 
objeù
 
is
 
a
 
Ã¡ed
 
	gdiù
. 
It
 i 
nÙ
‡ 
cu¡om
 
	gşass
,

24 
beÿu£
 
th©
 
	gwould
 1è
»quœe
 
lib¿r›s
 
ªd
 
­¶iÿtiÚs
 
to
 
impÜt
 
a
 
	gthœd
-

25 
·¹y
 
moduË
 
š
 
Üd”
 
to
 
	g·¹ic©e
, 2è
šhib™
 
šnov©iÚ
 iÀ
exŒ­Ş©iÚ


26 
­´ßches
 
ªd
 
š
 
»pÜtšg
 
	gtoŞs
, 
	gªd
 3è
be
 
	g¦ow
. 
Th”e
 
	g¬e
, 
	ghowev”
, 
some


27 
¥ecifiÿtiÚs
 
»g¬dšg
 
the
 
¡ruùu»
 
of
h
	gdiù
.

33 | 
Ïmbda
 
s
: s["In£¹s"] / (
time
() - s["Start"]),

34 | 
	gC
 +---"Table Statistics": {

35 | 
o
 | "widgets": {-----------+

36 
N
 | 
l
 | "Rows": 1.3
M
, | 
RecÜd


37 
	ga
 | 
	gl
 | "Inserts": 400, |

38 
	gm
 | 
	ge
 | },---------------------+

39 
	ge
 | 
	gc
 | "froobles": {

40 
s
 | 
t
 | "Rows": 7845,

41 
	gp
 | 
	gi
 | "Inserts": 0,

42 
	ga
 | 
	go
 | },

43 
	gc
 | 
	gn
 +---},

44 
	ge
 | "Slow Queries":

52 
	gThe
 `
	gloggšg
.
	g¡©i¡ics
` 
diù
 
has
 
four
 
	gËv–s
. 
The
 
tİmo¡
 
Ëv–
 
is
 
nÙhšg


53 
mÜe
 
thª
 
a
 
£t
 
of
 
Çmes
 
to
 
šŒoduû
 
	gmoduÏr™y
, 
usu®ly
 
®Úg
 
the
 
lšes
 of

54 
·ckage
 
	gÇmes
. 
If
 
the
 
SQLAlchemy
 
´ojeù
 
wª‹d
 
to
 
	g·¹ic©e
, 
	gexam¶e
,

55 
™
 
might
 
pİuÏ‹
 
the
 
	g™em
 `
	gloggšg
.
	g¡©i¡ics
['SQLAlchemy']`, 
who£
 
v®ue


56 
would
 
be
 
a
 
	g£cÚd
-
Ïy”
 
diù
 
we
 
ÿÎ
 
	ga
 "Çme¥aû". 
Name¥aûs
 
h–p
 
muÉË


57 
·ckages
 
to
 
avoid
 
cŞlisiÚs
 
ov”
 
key
 
	gÇmes
, 
ªd
 
make
 
»pÜts
 
—s›r
Ø
	g»ad
,

58 
to
 
	gboÙ
. 
The
 
mašš”s
 
of
 
SQLAlchemy
 
should
 
ã–
 
ä“
Ø
u£
 
mÜe
 
thª
 
Úe


59 
Çme¥aû
 
Ãeded
 (
such
 
as
 'SQLAlchemy ORM'). 
NÙe
 
th©
 
th”e
 
¬e
 
no
 

60 
Ü
 
Ùh”
 
syÁax
 
cÚ¡¿šts
 
Ú
 
the
 
Çme¥aû
 
	gÇmes
; 
they
 
should
 
be
 
cho£n


61 
to
 
be
 
maxim®ly
 
»adabË
 
by
 
humªs
 (
Ã™h”
 
too
 
nÜ
oo ).

63 
Each
 
	gÇme¥aû
, 
	gth’
, 
is
 
a
 
diù
 
of
 
Çmed
 
¡©i¡iÿl
 
	gv®ues
, 
such
 
	gas


64 'Reque¡s/£c' 
	gÜ
 'U±ime'. 
You
 
should
 
choo£
 
Çmes
 
which
 
wl
 
look


65 
good
 
Ú
 
a
 
	g»pÜt
: 
¥aûs
 
ªd
 
ÿp™®iz©iÚ
 
¬e
 
ju¡
 
fše
.

67 
In
 
add™iÚ
 
to
 
sÿÏrs
, 
v®ues
 
š
 
a
 
Çme¥aû
 
MAY
 
be
‡ (
thœd
-
Ïy”
)

68 
	gdiù
, 
Ü
 
a
 
	gli¡
, 
ÿÎed
 
	ga
 "cŞËùiÚ". 
FÜ
 
	gexam¶e
, 
the
 
Ch”ryPy
 
StsToŞ


69 
k“ps
 
Œack
 
of
 
wh©
 
—ch
 
»que¡
 
is
 
	$došg
 (
Ü
 
has
 
mo¡
 
»ûÁly
 
dÚe
)

70 
š
 
a
 'Reque¡s' 
cŞËùiÚ
, 
wh”e
 
—ch
 
key
 
is
‡ 
th»ad
 
ID
;ƒach

71 
v®ue
 
š
 
the
 
subdiù
 
MUST
 
be
 
a
 
fou¹h
 
	`diù
 (
whew
!è
of
 
¡©i¡iÿl
 
d©a
 
about


72 
—ch
 
th»ad
. 
We
 
ÿÎ
ƒach 
subdiù
 
š
 
the
 
cŞËùiÚ
 
a
 "»cÜd". 
Sim¬ly
,

73 
the
 
StsToŞ
 
®so
 
k“ps
 
a
 
li¡
 
of
 
¦ow
 
qu”›s
, 
wh”e
 
—ch
 
»cÜd
 
cÚšs


74 
d©a
 
about
 
—ch
 
¦ow
 
qu”y
, 
š
 
Üd”
.

76 
V®ues
 
š
 
a
 
Çme¥aû
 
Ü
 
»cÜd
 
may
 
®so
 
be
 
funùiÚs
, 
which
 
bršgs
 
us
 
to
:

78 
ExŒ­Ş©iÚ


81 
The
 
cŞËùiÚ
 
of
 
¡©i¡iÿl
 
d©a
 
Ãeds
 
to
 
be
 
ç¡
, 
as
 
şo£
Ø
uÂÙiûabË


82 
as
 
possibË
 
to
 
the
 
ho¡
 
´og¿m
. 
Th©
 
»quœes
 
us
Ø
mšimize
 
I
/
O
, 
exam¶e
,

83 
but
 
š
 
PythÚ
 
™
 
®so
 
m—ns
 
we
 
Ãed
 
to
 
mšimize
 
funùiÚ
 
ÿÎs
. 
So
 
wh’
 
you


84 
¬e
 
designšg
 
your
 
Çme¥aû
 
ªd
 
»cÜd
 
v®ues
, 
Œy
 
to
 
š£¹
 
the
 
mo¡
 
basic


85 
sÿÏr
 
v®ues
 
you
 
®»ady
 
have
 
Ú
 
hªd
.

87 
Wh’
 
™
 
comes
 
time
 
to
 
»pÜt
 
Ú
 
the
 
g©h”ed
 
d©a
, 
howev”
, 
we
 
usu®ly
 
have


88 
much
 
mÜe
 
ä“dom
 
š
 
wh©
 
we
 
ÿn
 
ÿlcuÏ‹
. 
Th”efÜe
, 
wh’ev”
 
»pÜtšg


89 
	$toŞs
 (
like
 
the
 
´ovided
 
StsPage
 
Ch”ryPy
 
şass
è
ãtch
h
cÚ‹Ás
 
of


90 `
loggšg
.
¡©i¡ics
` 
»pÜtšg
, 
they
 
fœ¡
 
ÿÎ
 `
exŒ­Ş©e_¡©i¡ics
`

91 (
·ssšg
 
the
 
whŞe
 `
¡©i¡ics
` 
diù
 
as
h
Úly
 
¬gum’t
). 
This
 
makes
 
a


92 
d“p
 
cİy
 
of
 
the
 
¡©i¡ics
 
diù
 
so
 
th©
h
»pÜtšg
 
toŞ
 
ÿn
 
bÙh
 
™”©e


93 
ov”
 
™
 
ªd
 
ev’
 
chªge
 iˆ
w™hout
 
h¬mšg
 
the
 
Üigš®
. 
But
 iˆ
®so
 
ex·nds


94 
ªy
 
funùiÚs
 
š
 
the
 
diù
 
by
 
ÿÎšg
 
them
. 
FÜ
 
exam¶e
, 
you
 
might
 
have
 
a


95 'Cu¼’ˆTime' 
’Œy
 
š
 
the
 
Çme¥aû
 
w™h
h
v®ue
 "lambda scope:ime.time()".

96 
The
 "scİe" 
·¿m‘”
 
is
 
the
 
cu¼’t
 
Çme¥aû
 
	`diù
 (
Ü
 
»cÜd
, 
we
're

97 
cu¼’y
 
ex·ndšg
 
Úe
 
of
 
tho£
 
š¡—d
), 
®lowšg
 
you
 
acûss
 
to
 
exi¡šg


98 
’Œ›s
. 
If
 
you
'rerulyƒvil, you canƒven modify morehan oneƒntry

99 
©
 
a
 
time
.

101 
Howev”
, 
dÚ
'tryo calculate‡nƒntry‡ndhen use its value in further

102 
exŒ­Ş©iÚs
; 
the
 
Üd”
 
š
 
which
h
funùiÚs
 
¬e
 
ÿÎed
 
is
 
nÙ
 
gu¬ª‹ed
.

103 
This
 
ÿn
 
Ëad
 
to
 
a
 
û¹aš
 
amouÁ
 
of
 
du¶iÿ‹d
 
	`wÜk
 (
Ü
‡ 
»design
 oà
your


104 
schema
), 
but
 
th©
's betterhan complicatinghe spec.

106 
Aá”
 
the
 
whŞe
 
thšg
 
has
 
b“n
 
exŒ­Ş©ed
, 
™
'sime for:

108 
R•Ütšg


111 
The
 
StsPage
 
şass
 
g¿bs
 
the
 `
loggšg
.
¡©i¡ics
` 
diù
, 
exŒ­Ş©es
 
™
 
®l
,

112 
ªd
 
th’
 
ŒªsfÜms
 
™
 
to
 
HTML
 
—sy
 
v›wšg
. 
Each
 
Çme¥aû
 
g‘s
 
™s
 
own


113 
h—d”
 
ªd
 
©Œibu‹
 
bË
, 
¶us
 
ª
 
exŒa
abË 
—ch
 
cŞËùiÚ
. 
This
 
is


114 
NOT
 
·¹
 
of
 
the
 
¡©i¡ics
 
¥ecifiÿtiÚ
; 
Ùh”
 
toŞs
 
ÿn
 
fÜm©
 
how
 
they
 
like
.

116 
You
 
ÿn
 
cÚŒŞ
 
which
 
cŞumns
 
¬e
 
ouut
 
ªd
 
how
 
they
‡» 
fÜm©‹d
 
by
 
upd©šg


117 
StsPage
.
fÜm©tšg
, 
which
 
is
 
a
 
diù
 
th©
 
mœrÜs
 
the
 
keys
 
ªd
 
Ã¡šg
 
of


118 `
loggšg
.
¡©i¡ics
`. 
The
 
difã»nû
 
is
 
th©
, 
š¡—d
 
of
 
d©a
 
v®ues
, 
™
 
has


119 
fÜm©tšg
 
v®ues
. 
U£
 
NÚe
 
a
 
giv’
 
key
 
to
 
šdiÿ‹
Ø
the
 
StsPage
 
th©
‡

120 
giv’
 
cŞumn
 
should
 
nÙ
 
be
 
ouut
. 
U£
 
a
 
¡ršg
 
w™h
 
	`fÜm©tšg
 (
such
 
as
 '%.3f')

121 
to
 
š‹½Ş©e
 
the
 
	`v®ue
(
s
), 
Ü
 
u£
 
a
 
	`ÿÎabË
 (
such
 
as
 
Ïmbda
 
v
: v.
	$isofÜm©
())

122 
mÜe
 
advªûd
 
fÜm©tšg
. 
Any
 
’Œy
 
which
 
is
 
nÙ
 
m’tiÚed
 
š
 
the
 formatting

123 
diù
 
is
 
ouut
 
unchªged
.

125 
MÚ™Üšg


128 
AÉhough
 
the
 
HTML
 
ouut
 
kes
 
·šs
 
to
 
assign
 
unique
 
id
'soƒach <td> with

129 
¡©i¡iÿl
 
d©a
, 
you
're…robably better off fetching /cpstats/data, which

130 
ouuts
 
the
 
	`whŞe
 (
exŒ­Ş©ed
è`
loggšg
.
¡©i¡ics
` 
diù
 
š
 
JSON
 
fÜm©
.

131 
Th©
 
is
 
´obably
 
—s›r
 
to
 
·r£
, 
ªd
 
dÛ¢
't have‡ny formatting controls,

132 
so
 
you
 
g‘
 
the
 "Üigš®" 
d©a
 
š
 
a
 
cÚsi¡’y
-
£rŸlized
 
fÜm©
.

133 
NÙe
: 
th”e
's‚oreatment yet for datetime objects. Tryime.time() instead

134 
now
 
you
 
ÿn
. 
Nagios
 
wl
 
´obably
 
thªk
 you.

136 
Tuºšg
 
CŞËùiÚ
 
Off


139 
It
 
is
 
»comm’ded
 
—ch
 
Çme¥aû
 
have
 
ª
 "EÇbËd" 
™em
 
which
, 
F®£
,

140 
¡İs
 
	$cŞËùiÚ
 (
but
 
nÙ
 
»pÜtšg
è
of
 
¡©i¡iÿl
 
d©a
. 
AµliÿtiÚs


141 
SHOULD
 
´ovide
 
cÚŒŞs
 
to
 
·u£
 
ªd
 
»sume
 
cŞËùiÚ
 
by
 
£‰šg
 
the£


142 
’Œ›s
 
to
 
F®£
 
Ü
 
True
, 
´e£Á
.

145 
U§ge


148 
To
 
cŞËù
 
¡©i¡ics
 
Ú
 
Ch”ryPy
 
­¶iÿtiÚs
:

150 
äom
 
ch”rypy
.
lib
 
impÜt
 
ı¡©s


151 
­pcÚfig
['/']['toŞs.ı¡©s.Ú'] = 
True


153 
To
 
cŞËù
 
¡©i¡ics
 
Ú
 
your
 
own
 
code
:

155 
impÜt
 
loggšg


156 #In™Ÿliz
the
 
»pos™Üy


157 
nÙ
 
	`ha§‰r
(
loggšg
, '¡©i¡ics'):†oggšg.
¡©i¡ics
 = {
	}
}

158 #In™Ÿliz
my
 
Çme¥aû


159 
my¡©s
 = 
loggšg
.
¡©i¡ics
.
£tdeçuÉ
('My Stuff', {})

160 #In™Ÿliz
my
 
Çme¥aû
's scalars‡nd collections

161 
	gmy¡©s
.
upd©e
({

162 'EÇbËd': 
True
,

163 'S¹ Time': 
time
.time(),

165 'Ev’ts/SecÚd': 
Ïmbda
 
s
: (

166 (
s
['ImpÜÁ Ev’ts'] / (
time
.time() - s['Start Time']))),

169 
ev’t
 
š
 
	gev’ts
:

171 #CŞËù 
¡©s


172 
my¡©s
.
g‘
('EÇbËd', 
F®£
):

173 
my¡©s
['Important Events'] += 1

175 
To
 
»pÜt
 
¡©i¡ics
:

177 
roÙ
.
ı¡©s
 = cp¡©s.
	$StsPage
()

179 
To
 
fÜm©
 
¡©i¡ics
 
»pÜts
:

181 
S“
 'R•Ütšg', 
above
.

185 #-------------------------------- 
Sti¡ics
 -------------------------------- #


186 
impÜt
 
loggšg


187 
nÙ
 
	`ha§‰r
(
loggšg
, '¡©i¡ics'):†oggšg.
¡©i¡ics
 = {
	}
}

189 
def
 
	$exŒ­Ş©e_¡©i¡ics
(
scİe
):

191 
c
 = {
	}
}

192 
k
, 
v
 
š
 
li¡
(
scİe
.
	$™ems
()):

193 
	$isš¡ªû
(
v
, 
diù
):

194 
v
 = 
	$exŒ­Ş©e_¡©i¡ics
(
v
)

195 
–if
 
	`isš¡ªû
(
v
, (
li¡
, 
tu¶e
)):

196 
v
 = [
	$exŒ­Ş©e_¡©i¡ics
(
»cÜd
è»cÜd 
š
 
v
]

197 
–if
 
	`ha§‰r
(
v
, '__call__'):

198 
v
 = 
	$v
(
scİe
)

199 
c
[
k
] = 
v


200  
c


203 #--------------------- 
Ch”ryPy
 
AµliÿtiÚs
 
Sti¡ics
 --------------------- #


204 
impÜt
 
th»adšg


205 
impÜt
 
time


207 
impÜt
 
ch”rypy


209 
­p¡©s
 = 
loggšg
.
¡©i¡ics
.
	`£tdeçuÉ
('Ch”ryPy AµliÿtiÚs', {
	}
})

210 
	g­p¡©s
.
upd©e
({

211 'EÇbËd': 
True
,

212 'By‹ R—d/Reque¡': 
Ïmbda
 
s
: (s['TÙ® Reque¡s'] 
ªd


213 (
s
['TÙ® By‹ R—d'] / (s['TÙ® Reque¡s'])è
Ü
 0.0),

214 'By‹ R—d/SecÚd': 
Ïmbda
 
s
: s['Total Bytes Read'] / s['Uptime'](s),

215 'By‹ Wr™‹n/Reque¡': 
Ïmbda
 
s
: (s['TÙ® Reque¡s'] 
ªd


216 (
s
['TÙ® By‹ Wr™‹n'] / (s['TÙ® Reque¡s'])è
Ü
 0.0),

217 'By‹ Wr™‹n/SecÚd': 
Ïmbda
 
s
: s['Total Bytes Written'] / s['Uptime'](s),

218 'Cu¼’ˆTime': 
Ïmbda
 
s
: 
time
.time(),

220 'Reque¡s/SecÚd': 
Ïmbda
 
s
: (s['Total Requests']) / s['Uptime'](s),

221 'S”v” V”siÚ': 
ch”rypy
.
__v”siÚ__
,

222 'S¹ Time': 
time
.time(),

227 'U±ime': 
Ïmbda
 
s
: 
time
.time() - s['Start Time'],

231 
	g´oc_time
 = 
Ïmbda
 
s
: 
time
.time() - s['Start Time']

234 
şass
 
	$By‹CouÁW¿µ”
(
objeù
):

237 
def
 
	$__š™__
(
£lf
, 
rfe
):

238 
£lf
.
rfe
 =„file

239 
£lf
.
by‹s_»ad
 = 0

241 
def
 
	`»ad
(
£lf
, 
size
=-1):

242 
d©a
 = 
£lf
.
rfe
.
	$»ad
(
size
)

243 
£lf
.
by‹s_»ad
 +ğ
	$Ën
(
d©a
)

244  
d©a


246 
def
 
	`»adlše
(
£lf
, 
size
=-1):

247 
d©a
 = 
£lf
.
rfe
.
	$»adlše
(
size
)

248 
£lf
.
by‹s_»ad
 +ğ
	$Ën
(
d©a
)

249  
d©a


251 
def
 
	$»adlšes
(
£lf
, 
sizehšt
=0):

252 #Sham–es¦y 
¡Ş’
 
äom
 
SŒšgIO


253 
tÙ®
 = 0

254 
lšes
 = []

255 
lše
 = 
£lf
.
	$»adlše
()

256 
lše
:

257 
lšes
.
	$­³nd
(
lše
)

258 
tÙ®
 +ğ
	$Ën
(
lše
)

259 0 < 
sizehšt
 <ğ
tÙ®
:

261 
lše
 = 
£lf
.
	$»adlše
()

262  
lšes


264 
def
 
	$şo£
(
£lf
):

265 
£lf
.
rfe
.
	$şo£
()

267 
def
 
	$__™”__
(
£lf
):

268  
£lf


270 
def
 
	$Ãxt
(
£lf
):

271 
d©a
 = 
£lf
.
rfe
.
	$Ãxt
()

272 
£lf
.
by‹s_»ad
 +ğ
	$Ën
(
d©a
)

273  
d©a


276 
av”age_uri£t_time
 = 
Ïmbda
 
s
: s['CouÁ'] 
	`ªd
 (s['Sum'] / s['CouÁ']è
Ü
 0

279 
şass
 
	$StsToŞ
(
ch”rypy
.
ToŞ
):

282 
def
 
	$__š™__
(
£lf
):

283 
ch”rypy
.
ToŞ
.
	`__š™__
(
£lf
, 'Ú_’d_»que¡', s–f.
»cÜd_¡İ
)

285 
def
 
	$_£tup
(
£lf
):

288 
The
 
¡ªd¬d
 
Ch”ryPy
 
»que¡
 
objeù
 
wl
 
autom©iÿÎy
 
ÿÎ
 
this


289 
m‘hod
 
wh’
 
the
 
toŞ
 
is
 "tuºed on" 
š
 
cÚfig
.

291 
­p¡©s
.
	`g‘
('EÇbËd', 
F®£
):

292 
ch”rypy
.
ToŞ
.
	$_£tup
(
£lf
)

293 
£lf
.
	$»cÜd_¡¬t
()

295 
def
 
	$»cÜd_¡¬t
(
£lf
):

297 
»que¡
 = 
ch”rypy
.
£rvšg
.request

298 
nÙ
 
	`ha§‰r
(
»que¡
.
rfe
, 'bytes_read'):

299 
»que¡
.
rfe
 = 
	$By‹CouÁW¿µ”
(
»que¡
.
rfe
)

300 
»que¡
.
body
.
å
 =„eque¡.
rfe


302 
r
 = 
»que¡
.
»mÙe


304 
­p¡©s
['Current Requests'] += 1

305 
­p¡©s
['Total Requests'] += 1

306 
­p¡©s
['Reque¡s'][
th»adšg
.
	`_g‘_id’t
()] = {

307 'By‹ R—d': 
NÚe
,

308 'By‹ Wr™‹n': 
NÚe
,

309 #U£ 
a
 
Ïmbda
 
so
 
the
 

 
g‘s
 
upd©ed
 
by
 
toŞs
.
´oxy
 
Ï‹r


310 'Cl›Á': 
Ïmbda
 
s
: '%s:%s' % (
r
.

,„.
pÜt
),

311 'End Time': 
NÚe
,

312 'Proûssšg Time': 
´oc_time
,

313 'Reque¡-Lše': 
»que¡
.
»que¡_lše
,

314 'Re¥Ú£ Stus': 
NÚe
,

315 'S¹ Time': 
time
.
	`time
(),

316 
	}
}

318 
def
 
	$»cÜd_¡İ
(
£lf
, 
uri£t
=
NÚe
, 
¦ow_qu”›s
=1.0, 
¦ow_qu”›s_couÁ
=100,

319 
debug
=
F®£
, **
kw¬gs
):

321 
»¥
 = 
ch”rypy
.
£rvšg
.
»¥Ú£


322 
w
 = 
­p¡©s
['Reque¡s'][
th»adšg
.
	`_g‘_id’t
()]

324 
r
 = 
ch”rypy
.
»que¡
.
rfe
.
by‹s_»ad


325 
w
['By‹ R—d'] = 
r


326 
­p¡©s
['TÙ® By‹ R—d'] +ğ
r


328 
»¥
.
¡»am
:

329 
w
['Bytes Written'] = 'chunked'

331 
ş
 = (
»¥
.
h—d”s
.
	`g‘
('Content-Length', 0))

332 
w
['By‹ Wr™‹n'] = 
ş


333 
­p¡©s
['TÙ® By‹ Wr™‹n'] +ğ
ş


335 
w
['Re¥Ú£ Stus'] = 
	`g‘©Œ
(
»¥
, 'ouut_¡©us', 
NÚe
è
Ü
„e¥.
¡©us


337 
w
['End Time'] = 
time
.
	$time
()

338 
p
 = 
w
['End Time'] - w['Start Time']

339 
w
['Proûssšg Time'] = 
p


340 
­p¡©s
['TÙ® Time'] +ğ
p


342 
­p¡©s
['Current Requests'] -= 1

344 
debug
:

345 
ch”rypy
.
	`log
('St »cÜded: %s' % 
	`»´
(
w
), 'TOOLS.CPSTATS')

347 
uri£t
:

348 
rs
 = 
­p¡©s
.
	`£tdeçuÉ
('URI S‘ T¿ckšg', {
	}
})

349 
	gr
 = 
rs
.
£tdeçuÉ
(
uri£t
, {

350 'Mš': 
NÚe
, 'Max': None, 'Count': 0, 'Sum': 0,

351 'Avg': 
av”age_uri£t_time
})

352 
r
['Mš'] 
is
 
NÚe
 
Ü
 
p
 <„['Min']:

353 
r
['Mš'] = 
p


354 
r
['Max'] 
is
 
NÚe
 
Ü
 
p
 >„['Max']:

355 
r
['Max'] = 
p


356 
r
['Count'] += 1

357 
r
['Sum'] +ğ
p


359 
¦ow_qu”›s
 
ªd
 
p
 > slow_queries:

360 
sq
 = 
­p¡©s
.
£tdeçuÉ
('Slow Queries', [])

361 
	gsq
.
­³nd
(
w
.
	$cİy
())

362 
	`Ën
(
sq
è> 
¦ow_qu”›s_couÁ
:

363 
sq
.
	$pİ
(0)

366 
impÜt
 
ch”rypy


367 
ch”rypy
.
toŞs
.
ı¡©s
 = 
	$StsToŞ
()

370 #---------------------- 
Ch”ryPy
 
Sti¡ics
 
R•Ütšg
 ---------------------- #


371 
impÜt
 
os


372 
thisdœ
 = 
os
.
·th
.
	`ab¥©h
(os.·th.
	$dœÇme
(
__fe__
))

374 
Œy
:

375 
impÜt
 
jsÚ


376 
exû±
 
ImpÜtE¼Ü
:

377 
Œy
:

378 
impÜt
 
sim¶ejsÚ
 
as
 
jsÚ


379 
exû±
 
ImpÜtE¼Ü
:

380 
jsÚ
 = 
NÚe


383 
missšg
 = 
	$objeù
()

385 
loÿË_d©e
 = 
Ïmbda
 
v
: 
time
.
	`¡ráime
('%c',ime.
	$gmtime
(
v
))

386 
iso_fÜm©
 = 
Ïmbda
 
v
: 
time
.
	`¡ráime
('%Y-%m-%d %H:%M:%S',ime.
	$gmtime
(
v
))

388 
def
 
	$·u£_»sume
(
ns
):

389 
def
 
	$_·u£_»sume
(
’abËd
):

390 
·u£_di§bËd
 = ''

391 
»sume_di§bËd
 = ''

392 
’abËd
:

393 
»sume_di§bËd
 = 'disabled="disabled" '

395 
·u£_di§bËd
 = 'disabled="disabled" '

397 <
fÜm
 
aùiÚ
="·u£" 
m‘hod
="POST" 
¡yË
="display:inline">

398 <
šput
 
ty³
="hidd’" 
Çme
="Çme¥aû" 
v®ue
="%s" />

399 <
šput
 
ty³
="subm™" 
v®ue
="Pau£" %
s
/>

400 </
fÜm
>

401 <
fÜm
 
aùiÚ
="»sume" 
m‘hod
="POST" 
¡yË
="display:inline">

402 <
šput
 
ty³
="hidd’" 
Çme
="Çme¥aû" 
v®ue
="%s" />

403 <
šput
 
ty³
="subm™" 
v®ue
="Resume" %
s
/>

404 </
fÜm
>

406  
_·u£_»sume


409 
şass
 
	$StsPage
(
objeù
):

411 
fÜm©tšg
 = {

413 'EÇbËd': 
	`·u£_»sume
('CherryPy Applications'),

418 'Cu¼’ˆTime': 
iso_fÜm©
,

420 'S¹ Time': 
iso_fÜm©
,

424 'End Time': 
NÚe
,

426 'S¹ Time': 
iso_fÜm©
,

437 'End Time': 
NÚe
,

439 'S¹ Time': 
NÚe
,

443 'EÇbËd': 
	`·u£_»sume
('CherryPy WSGIServer'),

445 'S¹ime': 
iso_fÜm©
,

447 
	}
}

450 
def
 
	$šdex
(
£lf
):

451 #T¿nsfÜm 
the
 
¿w
 
d©a
 
što
 
´‘ty
 
ouut
 
HTML


452 
y›ld
 """

453 <
html
>

454 <
h—d
>

455 <
t™Ë
>
Sti¡ics
</title>

456 <
¡yË
>

458 
th
, 
td
 {

459 
·ddšg
: 0.25e
m
 0.5em;

460 
bÜd”
: 1
px
 
sŞid
 #666699;

461 
	}
}

463 
	gbË
 {

464 
	gbÜd”
-
	gcŞÏp£
: 
cŞÏp£
;

467 
	gbË
.
	g¡©s1
 {

468 
	gwidth
: 100%;

471 
	gbË
.
¡©s1
 
	gth
 {

472 
	gfÚt
-
	gweight
: 
bŞd
;

473 
	g‹xt
-
	g®ign
: 
right
;

474 
	gbackground
-
	gcŞÜ
: #CCD5DD;

477 
	gbË
.
	g¡©s2
, 
	gh2
 {

478 
	gm¬gš
-
	gËá
: 50
px
;

481 
	gbË
.
¡©s2
 
	gth
 {

482 
	gfÚt
-
	gweight
: 
bŞd
;

483 
	g‹xt
-
	g®ign
: 
ûÁ”
;

484 
	gbackground
-
	gcŞÜ
: #CCD5DD;

487 </
	g¡yË
>

488 </
	gh—d
>

489 <
	gbody
>

491 
	gt™Ë
, 
	gsÿÏrs
, 
cŞËùiÚs
 
š
 
	g£lf
.
	$g‘_Çme¥aûs
():

492 
y›ld
 """

493 <
h1
>%
s
</h1>

495 <
bË
 
şass
='stats1'>

496 <
tbody
>

498 
i
, (
key
, 
v®ue
è
š
 
	$’um”©e
(
sÿÏrs
):

499 
cŞnum
 = 
i
 % 3

500 
cŞnum
 =ğ0: 
y›ld
 """

501 <
Œ
>"""

502 
y›ld
 """

503 <
th
>%(
key
)
s
</th><
td
 
id
='%Ñ™Ë)s-%(key)s'>%(
v®ue
)s</td>""" % vars()

504 
cŞnum
 =ğ2: 
y›ld
 """

505 </
Œ
>"""

507 
cŞnum
 =ğ0: 
y›ld
 """

508 <
th
></th><
td
></td>

509 <
th
></th><
td
></td>

510 </
Œ
>"""

511 
–if
 
cŞnum
 =ğ1: 
y›ld
 """

512 <
th
></th><
td
></td>

513 </
Œ
>"""

514 
y›ld
 """

515 </
tbody
>

516 </
bË
>"""

518 
subt™Ë
, 
h—d”s
, 
subrows
 
š
 
cŞËùiÚs
:

519 
y›ld
 """

520 <
h2
>%
s
</h2>

521 <
bË
 
şass
='stats2'>

522 <
th—d
>

523 <
Œ
>""" % subtitle

524 
key
 
š
 
h—d”s
:

525 
y›ld
 """

526 <
th
>%
s
</th>""" % key

527 
y›ld
 """

528 </
Œ
>

529 </
th—d
>

530 <
tbody
>"""

531 
subrow
 
š
 
subrows
:

532 
y›ld
 """

533 <
Œ
>"""

534 
v®ue
 
š
 
subrow
:

535 
y›ld
 """

536 <
td
>%
s
</td>""" % value

537 
y›ld
 """

538 </
Œ
>"""

539 
y›ld
 """

540 </
tbody
>

541 </
bË
>"""

542 
y›ld
 """

543 </
body
>

544 </
html
>

546 
šdex
.
expo£d
 = 
True


548 
def
 
	$g‘_Çme¥aûs
(
£lf
):

550 
s
 = 
	$exŒ­Ş©e_¡©i¡ics
(
loggšg
.
¡©i¡ics
)

551 
t™Ë
, 
ns
 
š
 
	`sÜ‹d
(
s
.
	$™ems
()):

552 
sÿÏrs
 = []

553 
cŞËùiÚs
 = []

554 
ns_fmt
 = 
£lf
.
fÜm©tšg
.
	`g‘
(
t™Ë
, {
	}
})

555 
	gk
, 
v
 
š
 
sÜ‹d
(
ns
.
	$™ems
()):

556 
fmt
 = 
ns_fmt
.
	`g‘
(
k
, {
	}
})

557 
	$isš¡ªû
(
v
, 
diù
):

558 
h—d”s
, 
subrows
 = 
£lf
.
	$g‘_diù_cŞËùiÚ
(
v
, 
fmt
)

559 
cŞËùiÚs
.
	`­³nd
((
k
, ['ID'] + 
h—d”s
, 
subrows
))

560 
–if
 
	`isš¡ªû
(
v
, (
li¡
, 
tu¶e
)):

561 
h—d”s
, 
subrows
 = 
£lf
.
	$g‘_li¡_cŞËùiÚ
(
v
, 
fmt
)

562 
cŞËùiÚs
.
	`­³nd
((
k
, 
h—d”s
, 
subrows
))

564 
fÜm©
 = 
ns_fmt
.
	$g‘
(
k
, 
missšg
)

565 
fÜm©
 
is
 
NÚe
:

568 
	`ha§‰r
(
fÜm©
, '__call__'):

569 
v
 = 
	$fÜm©
(
v
)

570 
–if
 
fÜm©
 
is
 
nÙ
 
missšg
:

571 
v
 = 
fÜm©
 % v

572 
sÿÏrs
.
	`­³nd
((
k
, 
v
))

573 
y›ld
 
t™Ë
, 
sÿÏrs
, 
cŞËùiÚs


575 
def
 
	$g‘_diù_cŞËùiÚ
(
£lf
, 
v
, 
fÜm©tšg
):

577 #E.
g
., 
the
 'Reque¡s' 
diù
.

578 
h—d”s
 = []

579 
»cÜd
 
š
 
v
.
	$™”v®ues
():

580 
k3
 
š
 
»cÜd
:

581 
fÜm©
 = 
fÜm©tšg
.
	$g‘
(
k3
, 
missšg
)

582 
fÜm©
 
is
 
NÚe
:

585 
k3
 
nÙ
 
š
 
h—d”s
:

586 
h—d”s
.
	$­³nd
(
k3
)

587 
h—d”s
.
	$sÜt
()

589 
subrows
 = []

590 
k2
, 
»cÜd
 
š
 
	`sÜ‹d
(
v
.
	$™ems
()):

591 
subrow
 = [
k2
]

592 
k3
 
š
 
h—d”s
:

593 
v3
 = 
»cÜd
.
	`g‘
(
k3
, '')

594 
fÜm©
 = 
fÜm©tšg
.
	$g‘
(
k3
, 
missšg
)

595 
fÜm©
 
is
 
NÚe
:

598 
	`ha§‰r
(
fÜm©
, '__call__'):

599 
v3
 = 
	$fÜm©
(
v3
)

600 
–if
 
fÜm©
 
is
 
nÙ
 
missšg
:

601 
v3
 = 
fÜm©
 % v3

602 
subrow
.
	$­³nd
(
v3
)

603 
subrows
.
	$­³nd
(
subrow
)

605  
h—d”s
, 
subrows


607 
def
 
	$g‘_li¡_cŞËùiÚ
(
£lf
, 
v
, 
fÜm©tšg
):

609 #E.
g
., 
the
 'Slow Qu”›s' 
li¡
.

610 
h—d”s
 = []

611 
»cÜd
 
š
 
v
:

612 
k3
 
š
 
»cÜd
:

613 
fÜm©
 = 
fÜm©tšg
.
	$g‘
(
k3
, 
missšg
)

614 
fÜm©
 
is
 
NÚe
:

617 
k3
 
nÙ
 
š
 
h—d”s
:

618 
h—d”s
.
	$­³nd
(
k3
)

619 
h—d”s
.
	$sÜt
()

621 
subrows
 = []

622 
»cÜd
 
š
 
v
:

623 
subrow
 = []

624 
k3
 
š
 
h—d”s
:

625 
v3
 = 
»cÜd
.
	`g‘
(
k3
, '')

626 
fÜm©
 = 
fÜm©tšg
.
	$g‘
(
k3
, 
missšg
)

627 
fÜm©
 
is
 
NÚe
:

630 
	`ha§‰r
(
fÜm©
, '__call__'):

631 
v3
 = 
	$fÜm©
(
v3
)

632 
–if
 
fÜm©
 
is
 
nÙ
 
missšg
:

633 
v3
 = 
fÜm©
 % v3

634 
subrow
.
	$­³nd
(
v3
)

635 
subrows
.
	$­³nd
(
subrow
)

637  
h—d”s
, 
subrows


639 
jsÚ
 
is
 
nÙ
 
NÚe
:

640 
def
 
	$d©a
(
£lf
):

641 
s
 = 
	$exŒ­Ş©e_¡©i¡ics
(
loggšg
.
¡©i¡ics
)

642 
ch”rypy
.
»¥Ú£
.
h—d”s
['Content-Type'] = 'application/json'

643  
jsÚ
.
	$dumps
(
s
, 
sÜt_keys
=
True
, 
šd’t
=4)

644 
d©a
.
expo£d
 = 
True


646 
def
 
	$·u£
(
£lf
, 
Çme¥aû
):

647 
loggšg
.
¡©i¡ics
.
	`g‘
(
Çme¥aû
, {
	}
})['EÇbËd'] = 
F®£


648 
¿i£
 
ch”rypy
.
HTTPRedœeù
('./')

649 
·u£
.
expo£d
 = 
True


650 
·u£
.
ı_cÚfig
 = {'toŞs.®low.Ú': 
True
,

653 
def
 
	$»sume
(
£lf
, 
Çme¥aû
):

654 
loggšg
.
¡©i¡ics
.
	`g‘
(
Çme¥aû
, {
	}
})['EÇbËd'] = 
True


655 
¿i£
 
ch”rypy
.
HTTPRedœeù
('./')

656 
»sume
.
expo£d
 = 
True


657 
»sume
.
ı_cÚfig
 = {'toŞs.®low.Ú': 
True
,

	@trunk/objs/CherryPy-3.2.4/cherrypy/lib/cptools.py

3 
impÜt
 
loggšg


4 
impÜt
 
»


6 
impÜt
 
ch”rypy


7 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
	gba£¡ršg
, 
	gmd5
, 
	g£t
, 
unicode¡r


8 
äom
 
	gch”rypy
.
lib
 
impÜt
 
h‰put
 
as
 
	g_h‰put


11 #CÚd™iÚ® 
HTTP
 
»que¡
 
suµÜt
 #


12 
def
 
	$v®id©e_‘ags
(
autÙags
=
F®£
, 
debug
=False):

15 
If
 
autÙags
 
is
 
True
, 
ª
 
ETag
 
»¥Ú£
-
h—d”
 
v®ue
 
wl
 
be
 
´ovided


16 
äom
 
ª
 
MD5
 
hash
 
of
 
the
 
»¥Ú£
 
	`body
 (
uÆess
 
some
 
Ùh”
 
code
 
has


17 
®»ady
 
´ovided
 
ª
 
ETag
 
h—d”
). 
If
 
	`F®£
 (
the
 ),he ETag

18 
wl
 
nÙ
 
be
 
autom©ic
.

20 
WARNING
: 
the
 
autÙags
 
ã©u»
 
is
 
nÙ
 
desigÃd
 
URL
's which‡llow

21 
m‘hods
 
Ùh”
 
thª
 
GET
. 
FÜ
 
exam¶e
, 
a
 
POST
 
to
 
the
 
§me
 
URL
 
»tuºs


22 
no
 
cÚ‹Á
, 
the
 
autom©ic
 
ETag
 
wl
 
be
 
šcÜ»ù
, 
b»akšg
 
a
 
fundam’l


23 
u£
 
’t™y
 
gs
 
š
 
a
 
possibly
 
de¡ruùive
 
çshiÚ
. 
Likewi£
, 
you


24 
¿i£
 304 
NÙ
 
Modif›d
, 
the
 
»¥Ú£
 
body
 
wl
 
be
 
em±y
,h
ETag
 
hash


25 
wl
 
be
 
šcÜ»ù
, 
ªd
 
your
 
­¶iÿtiÚ
 will .

26 
S“
 :
rfc
:`2616` 
SeùiÚ
 14.24.

28 
»¥Ú£
 = 
ch”rypy
.
£rvšg
.response

30 #Gu¬d 
agaš¡
 
bešg
 
run
 
twiû
.

31 
	`ha§‰r
(
»¥Ú£
, "ETag"):

34 
¡©us
, 
»asÚ
, 
msg
 = 
_h‰put
.
	$v®id_¡©us
(
»¥Ú£
.
¡©us
)

36 
‘ag
 = 
»¥Ú£
.
h—d”s
.
	`g‘
('ETag')

38 #Autom©iø
ETag
 
g’”©iÚ
. 
S“
 
w¬nšg
 
š
 
doc¡ršg
.

39 
‘ag
:

40 
debug
:

41 
ch”rypy
.
	`log
('ETag‡Ì—dy s‘: %s' % 
‘ag
, 'TOOLS.ETAGS')

42 
–if
 
nÙ
 
autÙags
:

43 
debug
:

44 
ch”rypy
.
	`log
('Autotags off', 'TOOLS.ETAGS')

45 
–if
 
¡©us
 != 200:

46 
debug
:

47 
ch”rypy
.
	`log
('Status‚ot 200', 'TOOLS.ETAGS')

49 
‘ag
 = 
»¥Ú£
.
	$cŞÏp£_body
()

50 
‘ag
 = '"%s"' % 
	`md5
Óg).
	$hexdige¡
()

51 
debug
:

52 
ch”rypy
.
	`log
('S‘tšg ETag: %s' % 
‘ag
, 'TOOLS.ETAGS')

53 
»¥Ú£
.
h—d”s
['ETag'] = 
‘ag


55 
»¥Ú£
.
ETag
 = 
‘ag


57 #"
If
 
the
 
»que¡
 
would
, 
w™hout
hIf-
M©ch
 
h—d”
 
f›ld
, 
»suÉ
 
š


58 #ªythšg 
Ùh”
 
thª
 
a
 2xx 
Ü
 412 
¡©us
, 
th’
 
the
 
If
-
M©ch
 
h—d”


59 #MUST 
be
 
ignÜed
."

60 
debug
:

61 
ch”rypy
.
	`log
('Stus: %s' % 
¡©us
, 'TOOLS.ETAGS')

62 
¡©us
 >ğ200 
ªd
 status <= 299:

63 
»que¡
 = 
ch”rypy
.
£rvšg
.request

65 
cÚd™iÚs
 = 
»que¡
.
h—d”s
.
	`–em’ts
('If-M©ch'è
Ü
 []

66 
cÚd™iÚs
 = [
	$¡r
(
x
èx 
š
 
cÚd™iÚs
]

67 
debug
:

68 
ch”rypy
.
	`log
('If-M©ch cÚd™iÚs: %s' % 
	`»´
(
cÚd™iÚs
),

70 
cÚd™iÚs
 
ªd
 
	`nÙ
 (cÚd™iÚ =ğ["*"] 
Ü
 
‘ag
 
š
 conditions):

71 
¿i£
 
ch”rypy
.
	`HTTPE¼Ü
(412, "If-Match failed: ETag %r did "

72 "nÙ m©ch %r" % (
‘ag
, 
cÚd™iÚs
))

74 
cÚd™iÚs
 = 
»que¡
.
h—d”s
.
	`–em’ts
('If-NÚe-M©ch'è
Ü
 []

75 
cÚd™iÚs
 = [
	$¡r
(
x
èx 
š
 
cÚd™iÚs
]

76 
debug
:

77 
ch”rypy
.
	`log
('If-NÚe-M©ch cÚd™iÚs: %s' % 
	`»´
(
cÚd™iÚs
),

79 
cÚd™iÚs
 =ğ["*"] 
Ü
 
‘ag
 
š
 conditions:

80 
debug
:

81 
ch”rypy
.
	`log
('»que¡.m‘hod: %s' % 
»que¡
.
m‘hod
, 'TOOLS.ETAGS')

82 
»que¡
.
m‘hod
 
	`š
 ("GET", "HEAD"):

83 
¿i£
 
ch”rypy
.
	$HTTPRedœeù
([], 304)

85 
¿i£
 
ch”rypy
.
	`HTTPE¼Ü
(412, "If-None-Match failed: ETag %r "

86 "m©ched %r" % (
‘ag
, 
cÚd™iÚs
))

88 
def
 
	$v®id©e_sšû
():

91 
If
 
no
 
code
 
has
 
£t
 
the
 
La¡
-
Modif›d
 
»¥Ú£
 
h—d”
, 
th’
‚Ø
v®id©iÚ


92 
wl
 
be
 
³rfÜmed
.

94 
»¥Ú£
 = 
ch”rypy
.
£rvšg
.response

95 
Ï¡mod
 = 
»¥Ú£
.
h—d”s
.
	`g‘
('Last-Modified')

96 
Ï¡mod
:

97 
¡©us
, 
»asÚ
, 
msg
 = 
_h‰put
.
	$v®id_¡©us
(
»¥Ú£
.
¡©us
)

99 
»que¡
 = 
ch”rypy
.
£rvšg
.request

101 
sšû
 = 
»que¡
.
h—d”s
.
	`g‘
('If-Unmodified-Since')

102 
sšû
 
ªd
 sšû !ğ
Ï¡mod
:

103 ià(
¡©us
 >ğ200 
ªd
 stu <ğ299è
Ü
 status == 412:

104 
¿i£
 
ch”rypy
.
	$HTTPE¼Ü
(412)

106 
sšû
 = 
»que¡
.
h—d”s
.
	`g‘
('If-Modified-Since')

107 
sšû
 
ªd
 sšû =ğ
Ï¡mod
:

108 ià(
¡©us
 >ğ200 
ªd
 stu <ğ299è
Ü
 status == 304:

109 
»que¡
.
m‘hod
 
	`š
 ("GET", "HEAD"):

110 
¿i£
 
ch”rypy
.
	$HTTPRedœeù
([], 304)

112 
¿i£
 
ch”rypy
.
	$HTTPE¼Ü
(412)

115 #ToŞ 
code
 #


116 
def
 
	$®low
(
m‘hods
=
NÚe
, 
debug
=
F®£
):

119 
The
 
giv’
 
m‘hods
 
¬e
 -
š£ns™ive
, 
ªd
 
may
 
be
 
š
 
ªy
 
Üd”
.

120 
If
 
Úly
 
Úe
 
m‘hod
 
is
 
®lowed
, 
you
 
may
 
suµly
 
a
 
sšgË
 
¡ršg
;

121 
mÜe
 
thª
 
Úe
, 
suµly
 
a
 
li¡
 
of
 
¡ršgs
.

123 
Reg¬dËss
 
of
 
wh‘h”
 
the
 
cu¼’t
 
m‘hod
 
is
 
®lowed
 
Ü
 
nÙ
, 
this


124 
®so
 
em™s
 
ª
 'AÎow' 
»¥Ú£
 
h—d”
, 
cÚššg
 
the
 
giv’
 
m‘hods
.

126 
nÙ
 
	`isš¡ªû
(
m‘hods
, (
tu¶e
, 
li¡
)):

127 
m‘hods
 = [methods]

128 
m‘hods
 = [
m
.
	$uµ”
(è
m
 
š
 
m‘hods
 m]

129 
nÙ
 
m‘hods
:

130 
m‘hods
 = ['GET', 'HEAD']

131 
–if
 'GET' 
š
 
m‘hods
 
ªd
 'HEAD' 
nÙ
 in methods:

132 
m‘hods
.
	`­³nd
('HEAD')

134 
ch”rypy
.
»¥Ú£
.
h—d”s
['AÎow'] = ', '.
	$još
(
m‘hods
)

135 
ch”rypy
.
»que¡
.
m‘hod
 
nÙ
 
š
 
m‘hods
:

136 
debug
:

137 
ch”rypy
.
	`log
('request.method %r‚ot in methods %r' %

138 (
ch”rypy
.
»que¡
.
m‘hod
, 
m‘hods
), 'TOOLS.ALLOW')

139 
¿i£
 
ch”rypy
.
	$HTTPE¼Ü
(405)

141 
debug
:

142 
ch”rypy
.
	`log
('request.method %r in methods %r' %

143 (
ch”rypy
.
»que¡
.
m‘hod
, 
m‘hods
), 'TOOLS.ALLOW')

146 
def
 
	`´oxy
(
ba£
=
NÚe
, 
loÿl
='X-FÜw¬ded-Ho¡', 
»mÙe
='X-Forwarded-For',

147 
scheme
='X-FÜw¬ded-PrÙo', 
debug
=
F®£
):

150 
FÜ
 
ruÂšg
 
a
 
CP
 
£rv”
 
behšd
 
A·che
, 
ligh‰pd
, 
Ü
 
Ùh”
 
HTTP
 server.

152 
FÜ
 
A·che
 
ªd
 
ligh‰pd
, 
you
 
should
 
Ëave
 
the
 'loÿl' 
¬gum’t
 
©
he

153  
v®ue
 
of
 'X-FÜw¬ded-Ho¡'. 
FÜ
 
Squid
, 
you
 
´obably
 
wªt
 
to
 
£t


154 
toŞs
.
´oxy
.
loÿl
 = 'Origin'.

156 
If
 
you
 
wªt
 
the
 
Ãw
 
»que¡
.
ba£
 
to
 
šşude
 
·th
 
	`šfo
 (
nÙ
 
ju¡
h
ho¡
),

157 
you
 
mu¡
 
ex¶ic™ly
 
£t
 
ba£
 
to
 
the
 
fuÎ
 ba£ 
·th
, 
ªd
 
ALSO
 set 'local'

158 
to
 '', 
so
 
th©
 
the
 
X
-
FÜw¬ded
-
Ho¡
 
»que¡
 
	$h—d”
 (
which
 
Ãv”
 
šşudes


159 
·th
 
šfo
è
dÛs
 
nÙ
 
ov”ride
 
™
. 
Reg¬dËss
, 
the
 
v®ue
 'ba£' 
MUST


160 
NOT
 
’d
 
š
 
a
 
¦ash
.

162 
ch”rypy
.
»que¡
.
»mÙe
.
	$
 (
the
 
IP
 
add»ss
 
of
h
ş›Á
è
wl
 
be


163 
»wr™‹n
 
the
 
h—d”
 
¥ecif›d
 
by
h'»mÙe' 
¬g
 
is
 
v®id
.

164 
By
 , '»mÙe' 
is
 
£t
 
to
 'X-FÜw¬ded-FÜ'. 
If
 
you
 dØ
nÙ


165 
wªt
 
to
 
»wr™e
 
»mÙe
.

, 
£t
 
the
 '»mÙe' 
¬g
Ø
ª
 
em±y
 
¡ršg
.

168 
»que¡
 = 
ch”rypy
.
£rvšg
.request

170 
scheme
:

171 
s
 = 
»que¡
.
h—d”s
.
	$g‘
(
scheme
, 
NÚe
)

172 
debug
:

173 
ch”rypy
.
	`log
('Te¡šg schem%r:%r' % (
scheme
, 
s
), 'TOOLS.PROXY')

174 
s
 =ğ'Ú' 
ªd
 's¦' 
š
 
scheme
.
	$low”
():

175 #Thi 
hªdËs
 
e
.
g
. 
webçùiÚ
' '
X
-
FÜw¬ded
-
S¦
: 
Ú
' header

176 
scheme
 = 'https'

178 #Thi 
is
 
ligh‰pd
/
pound
/
MÚg»l
' '
X
-
FÜw¬ded
-
PrÙo
: 
h‰ps
'

179 
scheme
 = 
s


180 
nÙ
 
scheme
:

181 
scheme
 = 
»que¡
.
ba£
[:»que¡.ba£.
	`fšd
("://")]

183 
loÿl
:

184 
lba£
 = 
»que¡
.
h—d”s
.
	$g‘
(
loÿl
, 
NÚe
)

185 
debug
:

186 
ch”rypy
.
	`log
('Te¡šg†oÿÈ%r:%r' % (
loÿl
, 
lba£
), 'TOOLS.PROXY')

187 
lba£
 
is
 
nÙ
 
NÚe
:

188 
ba£
 = 
lba£
.
	`¥l™
(',')[0]

189 
nÙ
 
ba£
:

190 
pÜt
 = 
»que¡
.
loÿl
.port

191 
pÜt
 == 80:

192 
ba£
 = '127.0.0.1'

194 
ba£
 = '127.0.0.1:%s' % 
pÜt


196 
ba£
.
	`fšd
("://") == -1:

197 #add 
h‰p
:

198 
ba£
 = 
scheme
 + "://" + base

200 
»que¡
.
ba£
 = base

202 
»mÙe
:

203 
xff
 = 
»que¡
.
h—d”s
.
	$g‘
(
»mÙe
)

204 
debug
:

205 
ch”rypy
.
	`log
('Te¡šg„emÙ%r:%r' % (
»mÙe
, 
xff
), 'TOOLS.PROXY')

206 
xff
:

207 
»mÙe
 == 'X-Forwarded-For':

208 #S“ 
h‰p
:

209 
xff
 = xff.
	`¥l™
(',')[-1].
	$¡r
()

210 
»que¡
.
»mÙe
.

 = 
xff


213 
def
 
	`ignÜe_h—d”s
(
h—d”s
=('Rªge',), 
debug
=
F®£
):

216 
This
 
is
 
a
 
u£ful
 
toŞ
 
wÜkšg
 
behšd
 
û¹aš
 
HTTP
 
£rv”s
;

217 
exam¶e
, 
A·che
 
du¶iÿ‹s
 
the
 
wÜk
 
th©
 
CP
 
dÛs
 'Range'

218 
h—d”s
, 
ªd
 
wl
 
doubly
-
Œunÿ‹
 
the
 
»¥Ú£
.

220 
»que¡
 = 
ch”rypy
.
£rvšg
.request

221 
Çme
 
š
 
h—d”s
:

222 
Çme
 
š
 
»que¡
.
h—d”s
:

223 
debug
:

224 
ch”rypy
.
	`log
('IgnÜšg„eque¡ h—d” %r' % 
Çme
,

226 
d–
 
»que¡
.
h—d”s
[
Çme
]

229 
def
 
	$»¥Ú£_h—d”s
(
h—d”s
=
NÚe
, 
debug
=
F®£
):

231 
debug
:

232 
ch”rypy
.
	`log
('S‘tšg„e¥Ú£ h—d”s: %s' % 
	`»´
(
h—d”s
),

234 
Çme
, 
v®ue
 
	$š
 (
h—d”s
 
Ü
 []):

235 
ch”rypy
.
£rvšg
.
»¥Ú£
.
h—d”s
[
Çme
] = 
v®ue


236 
»¥Ú£_h—d”s
.
ç§ã
 = 
True


239 
def
 
	`»ã»r
(
·‰”n
, 
acû±
=
True
, 
acû±_missšg
=
F®£
, 
”rÜ
=403,

240 
mes§ge
='FÜbidd’ Reã»¸h—d”.', 
debug
=
F®£
):

243 
·‰”n


244 
A
 
»guÏr
 
ex´essiÚ
 
·‰”n
 
to
 
‹¡
 
agaš¡
 
the
 
Reã»r
.

246 
acû±


247 
If
 
True
, 
the
 
Reã»r
 
mu¡
 
m©ch
h
·‰”n
; 
F®£
,

248 
the
 
Reã»r
 
mu¡
 
NOT
 
m©ch
h
·‰”n
.

250 
acû±_missšg


251 
If
 
True
, 
³rm™
 
»que¡s
 
w™h
 
no
 
Reã»r
 
h—d”
.

253 
”rÜ


254 
The
 
HTTP
 
”rÜ
 
code
 
to
 Ø
the
 
ş›Á
 
Ú
 
çu»
.

256 
mes§ge


257 
A
 
¡ršg
 
to
 
šşude
 
š
 
the
 
»¥Ú£
 
body
 
Ú
 
çu»
.

260 
Œy
:

261 
»f
 = 
ch”rypy
.
£rvšg
.
»que¡
.
h—d”s
['Referer']

262 
m©ch
 = 
	`boŞ
(
»
.
	$m©ch
(
·‰”n
, 
»f
))

263 
debug
:

264 
ch”rypy
.
	`log
('Reã»¸%¸m©che %r' % (
»f
, 
·‰”n
),

266 
acû±
 =ğ
m©ch
:

268 
exû±
 
KeyE¼Ü
:

269 
debug
:

270 
ch”rypy
.
	`log
('No Referer header', 'TOOLS.REFERER')

271 
acû±_missšg
:

274 
¿i£
 
ch”rypy
.
	$HTTPE¼Ü
(
”rÜ
, 
mes§ge
)

277 
şass
 
	$SessiÚAuth
(
objeù
):

280 
£ssiÚ_key
 = "username"

281 
debug
 = 
F®£


283 
def
 
	$check_u£ºame_ªd_·sswÜd
(
£lf
, 
u£ºame
, 
·sswÜd
):

284 
·ss


286 
def
 
	$ªÚymous
(
£lf
):

288 
·ss


290 
def
 
	$Ú_logš
(
£lf
, 
u£ºame
):

291 
·ss


293 
def
 
	$Ú_logout
(
£lf
, 
u£ºame
):

294 
·ss


296 
def
 
	$Ú_check
(
£lf
, 
u£ºame
):

297 
·ss


299 
def
 
	`logš_sü“n
(
£lf
, 
äom_·ge
='..', 
u£ºame
='', 
”rÜ_msg
='', **
kw¬gs
):

300  (
	`unicode¡r
("""<html><body>

301 
Mes§ge
: %(
”rÜ_msg
)
s


302 <
fÜm
 
m‘hod
="po¡" 
aùiÚ
="do_login">

303 
Logš
: <
šput
 
ty³
="‹xt" 
Çme
="u£ºame" 
v®ue
="%(u£ºame)s" 
size
="10" /><
br
 />

304 
PasswÜd
: <
šput
 
ty³
="·sswÜd" 
Çme
="·sswÜd" 
size
="10" /><
br
 />

305 <
šput
 
ty³
="hidd’" 
Çme
="äom_·ge" 
v®ue
="%(äom_·ge)s" /><
br
 />

306 <
šput
 
ty³
="submit" />

307 </
fÜm
>

308 </
body
></
html
>"""è% v¬s()).’code("
utf
-8")

310 
def
 
	`do_logš
(
£lf
, 
u£ºame
, 
·sswÜd
, 
äom_·ge
='..', **
kw¬gs
):

312 
»¥Ú£
 = 
ch”rypy
.
£rvšg
.response

313 
”rÜ_msg
 = 
£lf
.
	$check_u£ºame_ªd_·sswÜd
(
u£ºame
, 
·sswÜd
)

314 
”rÜ_msg
:

315 
body
 = 
£lf
.
	$logš_sü“n
(
äom_·ge
, 
u£ºame
, 
”rÜ_msg
)

316 
»¥Ú£
.
body
 = body

317 "CÚ‹Á-L’gth" 
š
 
»¥Ú£
.
h—d”s
:

318 #D–‘
CÚ‹Á
-
L’gth
 
h—d”
 
so
 
	`fš®ize
(è
»ÿlcs
 
™
.

319 
d–
 
»¥Ú£
.
h—d”s
["Content-Length"]

320  
True


322 
ch”rypy
.
£rvšg
.
»que¡
.
logš
 = 
u£ºame


323 
ch”rypy
.
£ssiÚ
[
£lf
.
£ssiÚ_key
] = 
u£ºame


324 
£lf
.
	$Ú_logš
(
u£ºame
)

325 
¿i£
 
ch”rypy
.
	`HTTPRedœeù
(
äom_·ge
 
Ü
 "/")

327 
def
 
	`do_logout
(
£lf
, 
äom_·ge
='..', **
kw¬gs
):

329 
£ss
 = 
ch”rypy
.
£ssiÚ


330 
u£ºame
 = 
£ss
.
	$g‘
(
£lf
.
£ssiÚ_key
)

331 
£ss
[
£lf
.
£ssiÚ_key
] = 
NÚe


332 
u£ºame
:

333 
ch”rypy
.
£rvšg
.
»que¡
.
logš
 = 
NÚe


334 
£lf
.
	$Ú_logout
(
u£ºame
)

335 
¿i£
 
ch”rypy
.
	$HTTPRedœeù
(
äom_·ge
)

337 
def
 
	$do_check
(
£lf
):

339 
£ss
 = 
ch”rypy
.
£ssiÚ


340 
»que¡
 = 
ch”rypy
.
£rvšg
.request

341 
»¥Ú£
 = 
ch”rypy
.
£rvšg
.response

343 
u£ºame
 = 
£ss
.
	$g‘
(
£lf
.
£ssiÚ_key
)

344 
nÙ
 
u£ºame
:

345 
£ss
[
£lf
.
£ssiÚ_key
] = 
u£ºame
 = s–f.
	$ªÚymous
()

346 
£lf
.
debug
:

347 
ch”rypy
.
	`log
('No session[username],rying‡nonymous', 'TOOLS.SESSAUTH')

348 
nÙ
 
u£ºame
:

349 
u¾
 = 
ch”rypy
.
	$u¾
(
qs
=
»que¡
.
qu”y_¡ršg
)

350 
£lf
.
debug
:

351 
ch”rypy
.
	`log
('No username,„outingo†ogin_screen with '

352 'äom_·g%r' % 
u¾
, 'TOOLS.SESSAUTH')

353 
»¥Ú£
.
body
 = 
£lf
.
	$logš_sü“n
(
u¾
)

354 "CÚ‹Á-L’gth" 
š
 
»¥Ú£
.
h—d”s
:

355 #D–‘
CÚ‹Á
-
L’gth
 
h—d”
 
so
 
	`fš®ize
(è
»ÿlcs
 
™
.

356 
d–
 
»¥Ú£
.
h—d”s
["Content-Length"]

357  
True


358 
£lf
.
debug
:

359 
ch”rypy
.
	`log
('S‘tšg„eque¡.logšØ%r' % 
u£ºame
, 'TOOLS.SESSAUTH')

360 
»que¡
.
logš
 = 
u£ºame


361 
£lf
.
	$Ú_check
(
u£ºame
)

363 
def
 
	$run
(
£lf
):

364 
»que¡
 = 
ch”rypy
.
£rvšg
.request

365 
»¥Ú£
 = 
ch”rypy
.
£rvšg
.response

367 
·th
 = 
»que¡
.
·th_šfo


368 
·th
.
	`’dsw™h
('login_screen'):

369 
£lf
.
debug
:

370 
ch”rypy
.
	`log
('routšg %¸tØlogš_sü“n' % 
·th
, 'TOOLS.SESSAUTH')

371  
£lf
.
	$logš_sü“n
(**
»que¡
.
·¿ms
)

372 
–if
 
·th
.
	`’dsw™h
('do_login'):

373 
»que¡
.
m‘hod
 != 'POST':

374 
»¥Ú£
.
h—d”s
['Allow'] = "POST"

375 
£lf
.
debug
:

376 
ch”rypy
.
	`log
('do_login„equires POST', 'TOOLS.SESSAUTH')

377 
¿i£
 
ch”rypy
.
	$HTTPE¼Ü
(405)

378 
£lf
.
debug
:

379 
ch”rypy
.
	`log
('routšg %¸tØdo_logš' % 
·th
, 'TOOLS.SESSAUTH')

380  
£lf
.
	$do_logš
(**
»que¡
.
·¿ms
)

381 
–if
 
·th
.
	`’dsw™h
('do_logout'):

382 
»que¡
.
m‘hod
 != 'POST':

383 
»¥Ú£
.
h—d”s
['Allow'] = "POST"

384 
¿i£
 
ch”rypy
.
	$HTTPE¼Ü
(405)

385 
£lf
.
debug
:

386 
ch”rypy
.
	`log
('routšg %¸tØdo_logout' % 
·th
, 'TOOLS.SESSAUTH')

387  
£lf
.
	$do_logout
(**
»que¡
.
·¿ms
)

389 
£lf
.
debug
:

390 
ch”rypy
.
	`log
('No special…ath,„unning do_check', 'TOOLS.SESSAUTH')

391  
£lf
.
	$do_check
()

394 
def
 
	$£ssiÚ_auth
(**
kw¬gs
):

395 
§
 = 
	$SessiÚAuth
()

396 
k
, 
v
 
š
 
kw¬gs
.
	$™ems
():

397 
	$£‰r
(
§
, 
k
, 
v
)

398  
§
.
	$run
()

399 
£ssiÚ_auth
.
__doc__
 = """Session‡uthentication hook.

401 
Any
 
©Œibu‹
 
of
 
the
 
SessiÚAuth
 
şass
 
may
 
be
 
ov”ridd’
 
vŸ
 
a
 
keywÜd
 
¬g


402 
to
 
this
 
funùiÚ
:

404 """ + "\
n
".još(["%
s
: %s" % (k,ype(getattr(SessionAuth, k)).__name__)

405 
k
 
š
 
	$dœ
(
SessiÚAuth
è
nÙ
 
k
.
	`¡¬tsw™h
("__")])

408 
def
 
	$log_Œaûback
(
£v”™y
=
loggšg
.
ERROR
, 
debug
=
F®£
):

410 
ch”rypy
.
	`log
("", "HTTP", 
£v”™y
=£v”™y, 
Œaûback
=
True
)

412 
def
 
	$log_»que¡_h—d”s
(
debug
=
F®£
):

414 
h
 = [" %s: %s" % (
k
, 
v
èk, v 
š
 
ch”rypy
.
£rvšg
.
»que¡
.
h—d”_li¡
]

415 
ch”rypy
.
	`log
('\nReque¡ H—d”s:\n' + '\n'.
	`još
(
h
), "HTTP")

417 
def
 
	$log_hooks
(
debug
=
F®£
):

419 
»que¡
 = 
ch”rypy
.
£rvšg
.request

421 
msg
 = []

422 #SÜˆ
by
 
the
 
¡ªd¬d
 
pošts
 
possibË
.

423 
äom
 
ch”rypy
 
impÜt
 
_ı»que¡


424 
pošts
 = 
_ı»que¡
.
hookpošts


425 
k
 
š
 
»que¡
.
hooks
.
	$keys
():

426 
k
 
nÙ
 
š
 
pošts
:

427 
pošts
.
	$­³nd
(
k
)

429 
k
 
š
 
pošts
:

430 
msg
.
	`­³nd
(" %s:" % 
k
)

431 
v
 = 
»que¡
.
hooks
.
	$g‘
(
k
, [])

432 
v
.
	$sÜt
()

433 
h
 
š
 
v
:

434 
msg
.
	`­³nd
(" %r" % 
h
)

435 
ch”rypy
.
	`log
('\nReque¡ Hook fÜ ' + ch”rypy.
	`u¾
() +

436 ':\n' + '\n'.
	`još
(
msg
), "HTTP")

438 
def
 
	`»dœeù
(
u¾
='', 
š‹º®
=
True
, 
debug
=
F®£
):

440 
debug
:

441 
ch”rypy
.
	`log
('Redirecting %sto: %s' %

442 ({
True
: 'š‹º® ', 
F®£
: ''
	}
}[
š‹º®
], 
	gu¾
),

444 
	gš‹º®
:

445 
¿i£
 
ch”rypy
.
	$IÁ”ÇlRedœeù
(
u¾
)

447 
¿i£
 
ch”rypy
.
	$HTTPRedœeù
(
u¾
)

449 
def
 
	$Œašg_¦ash
(
missšg
=
True
, 
exŒa
=
F®£
, 
¡©us
=
NÚe
, 
debug
=False):

451 
»que¡
 = 
ch”rypy
.
£rvšg
.request

452 
pi
 = 
»que¡
.
·th_šfo


454 
debug
:

455 
ch”rypy
.
	`log
('is_index: %r, missing: %r,ƒxtra: %r,…ath_info: %r' %

456 (
»que¡
.
is_šdex
, 
missšg
, 
exŒa
, 
pi
),

458 
»que¡
.
is_šdex
 
is
 
True
:

459 
missšg
:

460 
nÙ
 
pi
.
	`’dsw™h
('/'):

461 
Ãw_u¾
 = 
ch”rypy
.
	`u¾
(
pi
 + '/', 
»que¡
.
qu”y_¡ršg
)

462 
¿i£
 
ch”rypy
.
	$HTTPRedœeù
(
Ãw_u¾
, 
¡©us
=¡©u 
Ü
 301)

463 
–if
 
»que¡
.
is_šdex
 
is
 
F®£
:

464 
exŒa
:

465 #Ià
pi
 =ğ'/', 
dÚ
't„edirecto ''!

466 
pi
.
	`’dsw™h
('/'è
ªd
…i != '/':

467 
Ãw_u¾
 = 
ch”rypy
.
	`u¾
(
pi
[:-1], 
»que¡
.
qu”y_¡ršg
)

468 
¿i£
 
ch”rypy
.
	$HTTPRedœeù
(
Ãw_u¾
, 
¡©us
=¡©u 
Ü
 301)

470 
def
 
	$æ©‹n
(
debug
=
F®£
):

473 
This
 
®lows
 
ch”rypy
.
»¥Ú£
.
body
 
to
 
cÚsi¡
 
of
 'nested generators';

474 
th©
 
is
, 
a
 
£t
 
of
 
g’”©Üs
h© 
y›ld
 generators.

476 
impÜt
 
ty³s


477 
def
 
	$æ©‹Ãr
(
šput
):

478 
numchunks
 = 0

479 
x
 
š
 
šput
:

480 
nÙ
 
	$isš¡ªû
(
x
, 
ty³s
.
G’”©ÜTy³
):

481 
numchunks
 += 1

482 
y›ld
 
x


484 
y
 
š
 
	$æ©‹Ãr
(
x
):

485 
numchunks
 += 1

486 
y›ld
 
y


487 
debug
:

488 
ch”rypy
.
	`log
('FÏ‰’ed %d chunks' % 
numchunks
, 'TOOLS.FLATTEN')

489 
»¥Ú£
 = 
ch”rypy
.
£rvšg
.response

490 
»¥Ú£
.
body
 = 
	$æ©‹Ãr
(
»¥Ú£
.
body
)

493 
def
 
	$acû±
(
medŸ
=
NÚe
, 
debug
=
F®£
):

496 
If
 'medŸ' 
is
 
	`NÚe
 (
the
 ), 
no
 
‹¡
 
wl
 
be
 
³rfÜmed
.

498 
If
 'medŸ' 
is
 
´ovided
, 
™
 
should
 
be
 
the
 
CÚ‹Á
-
Ty³
 
	$v®ue
 (
as
 
a
 
¡ršg
)

499 
Ü
 
	$v®ues
 (
as
 
a
 
li¡
 
Ü
 
tu¶e
 
of
 
¡ršgs
è
which
 
the
 
cu¼’t
 
»sourû


500 
ÿn
 
em™
. 
The
 
ş›Á
's‡cceptable media„anges (as declared inhe

501 
Acû±
 
»que¡
 
h—d”
è
wl
 
be
 
m©ched
 
š
 
Üd”
 
to
 
the£
 
CÚ‹Á
-
Ty³


502 
v®ues
; 
the
 
fœ¡
 
such
 
¡ršg
 
is
 
»tuºed
. 
Th©
 is,h 
v®ue


503 
wl
 
®ways
 
be
 
Úe
 
of
 
the
 
¡ršgs
 
´ovided
 
š
h'medŸ' 
	`¬g
 (
Ü
 
NÚe


504 'medŸ' 
is
 
NÚe
).

506 
If
 
no
 
m©ch
 
is
 
found
, 
th’
 
HTTPE¼Ü
 406 (
NÙ
 
Acû±abË
èi 
¿i£d
.

507 
NÙe
 
th©
 
mo¡
 
web
 
brow£rs
 
£nd
 *

536 #M©che 
ªy
 
ty³
 
Ü
 
subty³


537 
debug
:

538 
ch”rypy
.
	`log
('Match dueo */*', 'TOOLS.ACCEPT')

539  
medŸ
[0]

540 
–if
 
–em’t
.
v®ue
.
	`’dsw™h
("/*"):

541 #M©che 
ªy
 
subty³


542 
mty³
 = 
–em’t
.
v®ue
[:-1] #K“°
the
 
¦ash


543 
m
 
š
 
medŸ
:

544 
m
.
	$¡¬tsw™h
(
mty³
):

545 
debug
:

546 
ch”rypy
.
	`log
('M©ch dutØ%s' % 
–em’t
.
v®ue
,

548  
m


550 #M©che 
exaù
 
v®ue


551 
–em’t
.
v®ue
 
š
 
medŸ
:

552 
debug
:

553 
ch”rypy
.
	`log
('M©ch dutØ%s' % 
–em’t
.
v®ue
,

555  
–em’t
.
v®ue


557 #NØ
su™abË
 
medŸ
-
¿nge
 
found
.

558 
ah
 = 
»que¡
.
h—d”s
.
	`g‘
('Accept')

559 
ah
 
is
 
NÚe
:

560 
msg
 = "Your client did‚ot send‡n Accept header."

562 
msg
 = "You¸ş›Á s’ˆthi Acû± h—d”: %s." % 
ah


563 
msg
 += (" Buthis„esource onlyƒmitshese mediaypes: %s." %

564 ", ".
	$još
(
medŸ
))

565 
¿i£
 
ch”rypy
.
	$HTTPE¼Ü
(406, 
msg
)

568 
şass
 
	$MÚ™ÜedH—d”M­
(
_h‰put
.
H—d”M­
):

570 
def
 
	$__š™__
(
£lf
):

571 
£lf
.
acûs£d_h—d”s
 = 
	$£t
()

573 
def
 
	$__g‘™em__
(
£lf
, 
key
):

574 
£lf
.
acûs£d_h—d”s
.
	$add
(
key
)

575  
_h‰put
.
H—d”M­
.
	$__g‘™em__
(
£lf
, 
key
)

577 
def
 
	$__cÚšs__
(
£lf
, 
key
):

578 
£lf
.
acûs£d_h—d”s
.
	$add
(
key
)

579  
_h‰put
.
H—d”M­
.
	$__cÚšs__
(
£lf
, 
key
)

581 
def
 
	$g‘
(
£lf
, 
key
, =
NÚe
):

582 
£lf
.
acûs£d_h—d”s
.
	$add
(
key
)

583  
_h‰put
.
H—d”M­
.
	$g‘
(
£lf
, 
key
, =)

585 
	`ha§‰r
({
	}
}, 'has_key'):

587 
def
 
	$has_key
(
£lf
, 
key
):

588 
£lf
.
acûs£d_h—d”s
.
	$add
(
key
)

589  
_h‰put
.
H—d”M­
.
	$has_key
(
£lf
, 
key
)

592 
def
 
	$autov¬y
(
ignÜe
=
NÚe
, 
debug
=
F®£
):

594 
»que¡
 = 
ch”rypy
.
£rvšg
.request

596 
»q_h
 = 
»que¡
.
h—d”s


597 
»que¡
.
h—d”s
 = 
	$MÚ™ÜedH—d”M­
()

598 
»que¡
.
h—d”s
.
	$upd©e
(
»q_h
)

599 
ignÜe
 
is
 
NÚe
:

600 
ignÜe
 = 
	`£t
(['Content-Disposition', 'Content-Length', 'Content-Type'])

602 
def
 
	$£t_»¥Ú£_h—d”
():

603 
»¥_h
 = 
ch”rypy
.
£rvšg
.
»¥Ú£
.
h—d”s


604 
v
 = 
	`£t
([
e
.
v®ue
 
š
 
»¥_h
.
	`–em’ts
('Vary')])

605 
debug
:

606 
ch”rypy
.
	`log
('Acûs£d h—d”s: %s' % 
»que¡
.
h—d”s
.
acûs£d_h—d”s
,

608 
v
 = v.(
»que¡
.
h—d”s
.
acûs£d_h—d”s
)

609 
v
 = v.
	$difã»nû
(
ignÜe
)

610 
v
 = 
	$li¡
(
v
)

611 
v
.
	$sÜt
()

612 
»¥_h
['V¬y'] = ', '.
	$još
(
v
)

613 
»que¡
.
hooks
.
	`©ch
('befÜe_fš®ize', 
£t_»¥Ú£_h—d”
, 95)

	@trunk/objs/CherryPy-3.2.4/cherrypy/lib/encoding.py

1 
impÜt
 

2 
impÜt
 
time


4 
impÜt
 
ch”rypy


5 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
	gba£¡ršg
, 
	gBy‹sIO
, 
	gÁob
, 
	g£t
, 
unicode¡r


6 
äom
 
	gch”rypy
.
lib
 
impÜt
 
fe_g’”©Ü


7 
äom
 
	gch”rypy
.
lib
 
impÜt
 
£t_v¬y_h—d”


10 
def
 
decode
(
’codšg
=
NÚe
, 
deçuÉ_’codšg
='utf-8'):

13 
E™h”
 
¬gum’t
 
may
 
be
 
a
 
sšgË
 
¡ršg
 
Ü
‡ 
li¡
 
of
 
¡ršgs
.

15 
’codšg


16 
If
 
nÙ
 
NÚe
, 
»¡riùs
 
the
 
£t
 
of
 
ch¬£ts
 
©‹m±ed
 
decodšg


17 
a
 
»que¡
 
’t™y
 
to
 
the
 
giv’
 
£t
 (
ev’
 ¨
difã»Á
 
ch¬£t
 
is
 giv’ 
š


18 
the
 
CÚ‹Á
-
Ty³
 
»que¡
 
h—d”
).

20 
deçuÉ_’codšg


21 
OÆy
 
š
 
efãù
 
	gthe
 '’codšg' 
¬gum’t
 
is
 
nÙ
 
	ggiv’
.

22 
If
 
	ggiv’
, 
the
 
£t
 
of
 
ch¬£ts
 
©‹m±ed
 
decodšg
 
a
 
»que¡
 
’t™y
 
is


23 *
ex‹nded
* 
w™h
 
the
 
giv’
 
v®ue
(
s
).

26 
	gbody
 = 
ch”rypy
.
»que¡
.
body


27 
’codšg
 
is
 
nÙ
 
NÚe
:

28 
nÙ
 
	$isš¡ªû
(
’codšg
, 
li¡
):

29 
’codšg
 = [encoding]

30 
body
.
©‹m±_ch¬£ts
 = 
’codšg


31 
–if
 
deçuÉ_’codšg
:

32 
nÙ
 
	$isš¡ªû
(
deçuÉ_’codšg
, 
li¡
):

33 
deçuÉ_’codšg
 = [default_encoding]

34 
body
.
©‹m±_ch¬£ts
 = body.©‹m±_ch¬£t + 
deçuÉ_’codšg


37 
şass
 
Re¥Ú£Encod”
:

39 
deçuÉ_’codšg
 = 'utf-8'

40 
çmsg
 = "Response body could‚ot beƒncoded with %r."

41 
’codšg
 = 
NÚe


42 
”rÜs
 = 'strict'

43 
‹xt_Úly
 = 
True


44 
add_ch¬£t
 = 
True


45 
debug
 = 
F®£


47 
def
 
	$__š™__
(
£lf
, **
kw¬gs
):

48 
k
, 
v
 
š
 
kw¬gs
.
	$™ems
():

49 
	$£‰r
(
£lf
, 
k
, 
v
)

51 
£lf
.
©‹m±ed_ch¬£ts
 = 
	$£t
()

52 
»que¡
 = 
ch”rypy
.
£rvšg
.request

53 
»que¡
.
hªdËr
 
is
 
nÙ
 
NÚe
:

54 #R•Ïû 
»que¡
.
hªdËr
 
w™h
 
£lf


55 
£lf
.
debug
:

56 
ch”rypy
.
	`log
('Replacing„equest.handler', 'TOOLS.ENCODE')

57 
£lf
.
ŞdhªdËr
 = 
»que¡
.
hªdËr


58 
»que¡
.
hªdËr
 = 
£lf


60 
def
 
	$’code_¡»am
(
£lf
, 
’codšg
):

63 
U£
 
a
 
g’”©Ü
 
w¿µ”
, 
ªd
 
ju¡
 
´ay
 
™
 
wÜks
 
as
 
the
 
¡»am
 
is


64 
bešg
 
wr™‹n
 
out
.

66 
’codšg
 
š
 
£lf
.
©‹m±ed_ch¬£ts
:

67  
F®£


68 
£lf
.
©‹m±ed_ch¬£ts
.
	$add
(
’codšg
)

70 
def
 
	$’cod”
(
body
):

71 
chunk
 
š
 
body
:

72 
	$isš¡ªû
(
chunk
, 
unicode¡r
):

73 
chunk
 = chunk.
	$’code
(
’codšg
, 
£lf
.
”rÜs
)

74 
y›ld
 
chunk


75 
£lf
.
body
 = 
	$’cod”
(
£lf
.
body
)

76  
True


78 
def
 
	$’code_¡ršg
(
£lf
, 
’codšg
):

80 
’codšg
 
š
 
£lf
.
©‹m±ed_ch¬£ts
:

81  
F®£


82 
£lf
.
©‹m±ed_ch¬£ts
.
	$add
(
’codšg
)

84 
Œy
:

85 
body
 = []

86 
chunk
 
š
 
£lf
.
body
:

87 
	$isš¡ªû
(
chunk
, 
unicode¡r
):

88 
chunk
 = chunk.
	$’code
(
’codšg
, 
£lf
.
”rÜs
)

89 
body
.
	$­³nd
(
chunk
)

90 
£lf
.
body
 = body

91 
	$exû±
 (
LookupE¼Ü
, 
UnicodeE¼Ü
):

92  
F®£


94  
True


96 
def
 
	$fšd_acû±abË_ch¬£t
(
£lf
):

97 
»que¡
 = 
ch”rypy
.
£rvšg
.request

98 
»¥Ú£
 = 
ch”rypy
.
£rvšg
.response

100 
£lf
.
debug
:

101 
ch”rypy
.
	`log
('»¥Ú£.¡»am %r' % 
»¥Ú£
.
¡»am
, 'TOOLS.ENCODE')

102 
»¥Ú£
.
¡»am
:

103 
’cod”
 = 
£lf
.
’code_¡»am


105 
’cod”
 = 
£lf
.
’code_¡ršg


106 "CÚ‹Á-L’gth" 
š
 
»¥Ú£
.
h—d”s
:

107 #D–‘
CÚ‹Á
-
L’gth
 
h—d”
 
so
 
	`fš®ize
(è
»ÿlcs
 
™
.

108 #Encoded 
¡ršgs
 
may
 
be
 
of
 
difã»Á
 
Ëngths
 
äom
 
theœ


109 #unicod
equiv®’ts
, 
ªd
 
ev’
 
äom
 
—ch
 
Ùh”
. 
FÜ
 
exam¶e
:

110 #>>> 
t
 = 
u
"\u7007\u3040"

111 #>>> 
	`Ën
(
t
)

113 #>>> 
	`Ën
(
t
.
	`’code
("UTF-8"))

115 #>>> 
	`Ën
(
t
.
	`’code
("utf7"))

117 
d–
 
»¥Ú£
.
h—d”s
["Content-Length"]

119 #P¬£ 
the
 
Acû±
-
Ch¬£t
 
»que¡
 
h—d”
, 
ªd
 
Œy
 
to
 
´ovide
 
Úe


120 #oà
the
 
»que¡ed
 
	`ch¬£ts
 (
š
 
Üd”
 
of
 
u£r
 
´eã»nû
).

121 
’cs
 = 
»que¡
.
h—d”s
.
	`–em’ts
('Accept-Charset')

122 
ch¬£ts
 = [
’c
.
v®ue
.
	$low”
(è
’c
 
š
 
’cs
]

123 
£lf
.
debug
:

124 
ch”rypy
.
	`log
('ch¬£t %s' % 
	`»´
(
ch¬£ts
), 'TOOLS.ENCODE')

126 
£lf
.
’codšg
 
is
 
nÙ
 
NÚe
:

127 #Ià
¥ecif›d
, 
fÜû
 
this
 
’codšg
 
to
 
be
 
u£d
, 
Ü
 
ç
.

128 
’codšg
 = 
£lf
.’codšg.
	$low”
()

129 
£lf
.
debug
:

130 
ch”rypy
.
	`log
('S³cif›dƒncodšg %r' % 
’codšg
, 'TOOLS.ENCODE')

131 ià(
nÙ
 
ch¬£ts
è
Ü
 "*" 
š
 ch¬£t Ü 
’codšg
 in charsets:

132 
£lf
.
debug
:

133 
ch”rypy
.
	`log
('A‰em±šgƒncodšg %r' % 
’codšg
, 'TOOLS.ENCODE')

134 
	$’cod”
(
’codšg
):

135  
’codšg


137 
nÙ
 
’cs
:

138 
£lf
.
debug
:

139 
ch”rypy
.
	`log
('Attempting defaultƒncoding %r' %

140 
£lf
.
deçuÉ_’codšg
, 'TOOLS.ENCODE')

141 #Any 
ch¬aù”
-
£t
 
is
 
acû±abË
.

142 
	$’cod”
(
£lf
.
deçuÉ_’codšg
):

143  
£lf
.
deçuÉ_’codšg


145 
¿i£
 
ch”rypy
.
	`HTTPE¼Ü
(500, 
£lf
.
çmsg
 % s–f.
deçuÉ_’codšg
)

147 
–em’t
 
š
 
’cs
:

148 
–em’t
.
qv®ue
 > 0:

149 
–em’t
.
v®ue
 == "*":

150 #M©che 
ªy
 
ch¬£t
. 
Try
 
our
 .

151 
£lf
.
debug
:

152 
ch”rypy
.
	`log
('Attempting defaultƒncoding due '

153 'tØ%r' % 
–em’t
, 'TOOLS.ENCODE')

154 
	$’cod”
(
£lf
.
deçuÉ_’codšg
):

155  
£lf
.
deçuÉ_’codšg


157 
’codšg
 = 
–em’t
.
v®ue


158 
£lf
.
debug
:

159 
ch”rypy
.
	`log
('Attemptingƒncoding %s (qvalue >'

160 '0)' % 
–em’t
, 'TOOLS.ENCODE')

161 
	$’cod”
(
’codšg
):

162  
’codšg


164 "*" 
nÙ
 
š
 
ch¬£ts
:

165 #Ià
no
 "*" 
is
 
´e£Á
 
š
 
ª
 
Acû±
-
Ch¬£t
 
f›ld
, 
th’
 
®l


166 #ch¬aù” 
£ts
 
nÙ
 
ex¶ic™ly
 
m’tiÚed
 
g‘
 
a
 
qu®™y


167 #v®u
of
 0, 
exû±
 
ISO
-8859-1, 
which
 
g‘s
 
a
 
qu®™y


168 #v®u
of
 1 
nÙ
 
ex¶ic™ly
 
m’tiÚed
.

169 
iso
 = 'iso-8859-1'

170 
iso
 
nÙ
 
š
 
ch¬£ts
:

171 
£lf
.
debug
:

172 
ch”rypy
.
	`log
('Attempting ISO-8859-1ƒncoding',

174 
	$’cod”
(
iso
):

175  
iso


177 #NØ
su™abË
 
’codšg
 
found
.

178 
ac
 = 
»que¡
.
h—d”s
.
	`g‘
('Accept-Charset')

179 
ac
 
is
 
NÚe
:

180 
msg
 = "Your client did‚ot send‡n Accept-Charset header."

182 
msg
 = "You¸ş›Á s’ˆthi Acû±-Ch¬£ˆh—d”: %s." % 
ac


183 
msg
 +ğ" WŒ›dhe£ ch¬£ts: %s." % ", ".
	$još
(
£lf
.
©‹m±ed_ch¬£ts
)

184 
¿i£
 
ch”rypy
.
	$HTTPE¼Ü
(406, 
msg
)

186 
def
 
	$__ÿÎ__
(
£lf
, *
¬gs
, **
kw¬gs
):

187 
»¥Ú£
 = 
ch”rypy
.
£rvšg
.response

188 
£lf
.
body
 = s–f.
	$ŞdhªdËr
(*
¬gs
, **
kw¬gs
)

190 
	$isš¡ªû
(
£lf
.
body
, 
ba£¡ršg
):

191 #¡ršg 
g‘
 
w¿µed
 
š
 
a
 
li¡
 
beÿu£
 
™”©šg
 
ov”
‡ 
sšgË


192 #™em 
li¡
 
is
 
much
 
ç¡”
 
thª
 
™”©šg
 
ov”
 
ev”y
 
ch¬aù”


193 #š 
a
 
¡ršg
.

194 
£lf
.
body
:

195 
£lf
.
body
 = [self.body]

197 #[''] 
dÛ¢
'tƒvaluateo False, so„eplace it with [].

198 
£lf
.
body
 = []

199 
–if
 
	`ha§‰r
(
£lf
.
body
, 'read'):

200 
£lf
.
body
 = 
	$fe_g’”©Ü
(
£lf
.
body
)

201 
–if
 
£lf
.
body
 
is
 
NÚe
:

202 
£lf
.
body
 = []

204 
ù
 = 
»¥Ú£
.
h—d”s
.
	`–em’ts
("Content-Type")

205 
£lf
.
debug
:

206 
ch”rypy
.
	`log
('CÚ‹Á-Ty³: %r' % [
	$¡r
(
h
èh 
š
 
ù
], 'TOOLS.ENCODE')

207 
ù
:

208 
ù
 = ct[0]

209 
£lf
.
‹xt_Úly
:

210 
ù
.
v®ue
.
	`low”
().
	`¡¬tsw™h
("text/"):

211 
£lf
.
debug
:

212 
ch”rypy
.
	`log
('CÚ‹Á-Ty³ % ¡¬t w™h "‹xt/"' % 
ù
,

214 
do_fšd
 = 
True


216 
£lf
.
debug
:

217 
ch”rypy
.
	`log
('Not finding because Content-Type %s does '

218 'nÙ s¹ w™h "‹xt/"' % 
ù
,

220 
do_fšd
 = 
F®£


222 
£lf
.
debug
:

223 
ch”rypy
.
	`log
('Finding because‚otext_only', 'TOOLS.ENCODE')

224 
do_fšd
 = 
True


226 
do_fšd
:

227 #S‘ "ch¬£t=..." 
·¿m
 
Ú
 
»¥Ú£
 
CÚ‹Á
-
Ty³
 
h—d”


228 
ù
.
·¿ms
['ch¬£t'] = 
£lf
.
	$fšd_acû±abË_ch¬£t
()

229 
£lf
.
add_ch¬£t
:

230 
£lf
.
debug
:

231 
ch”rypy
.
	`log
('S‘tšg CÚ‹Á-Ty³ %s' % 
ù
,

233 
»¥Ú£
.
h—d”s
["CÚ‹Á-Ty³"] = 
	$¡r
(
ù
)

235  
£lf
.
body


239 
def
 
	$com´ess
(
body
, 
com´ess_Ëv–
):

241 
impÜt
 
zlib


243 #S“ 
h‰p
:

244 
y›ld
 
	`Áob
('\x1f\x8b'è#ID1 
ªd
 
ID2
: 
gz
 
m¬k”


245 
y›ld
 
	`Áob
('\x08'è#CM: 
com´essiÚ
 
m‘hod


246 
y›ld
 
	`Áob
('\x00'è#FLG: 
nÚe
 
£t


247 #MTIME: 4 
by‹s


248 
y›ld
 .
	`·ck
("<L", (
time
.
	`time
()) & ('FFFFFFFF', 16))

249 
y›ld
 
	`Áob
('\x02'è#XFL: 
max
 
com´essiÚ
, 
¦owe¡
 
®go


250 
y›ld
 
	`Áob
('\xff'è#OS: 
unknown


252 
üc
 = 
zlib
.
	`üc32
(
	`Áob
(""))

253 
size
 = 0

254 
zobj
 = 
zlib
.
	`com´essobj
(
com´ess_Ëv–
,

255 
zlib
.
DEFLATED
, -zlib.
MAX_WBITS
,

256 
zlib
.
DEF_MEM_LEVEL
, 0)

257 
lše
 
š
 
body
:

258 
size
 +ğ
	$Ën
(
lše
)

259 
üc
 = 
zlib
.
	$üc32
(
lše
, 
üc
)

260 
y›ld
 
zobj
.
	$com´ess
(
lše
)

261 
y›ld
 
zobj
.
	$æush
()

263 #CRC32: 4 
by‹s


264 
y›ld
 .
	`·ck
("<L", 
üc
 & ('FFFFFFFF', 16))

265 #ISIZE: 4 
by‹s


266 
y›ld
 .
	`·ck
("<L", 
size
 & ('FFFFFFFF', 16))

268 
def
 
	$decom´ess
(
body
):

269 
impÜt
 
gz


271 
zbuf
 = 
	$By‹sIO
()

272 
zbuf
.
	$wr™e
(
body
)

273 
zbuf
.
	$£ek
(0)

274 
zfe
 = 
gz
.
	`GzFe
(
mode
='rb', 
feobj
=
zbuf
)

275 
d©a
 = 
zfe
.
	$»ad
()

276 
zfe
.
	$şo£
()

277  
d©a


280 
def
 
	`gz
(
com´ess_Ëv–
=5, 
mime_ty³s
=['‹xt/html', '‹xt/¶aš'], 
debug
=
F®£
):

283 
ch”rypy
.
»¥Ú£
.
h—d”s
['CÚ‹Á-Ty³'] 
mu¡
 
be
 
£t
 
to
 
Úe
 
of
 
the


284 
v®ues
 
š
 
the
 
mime_ty³s
 
¬g
 
befÜe
 
ÿÎšg
 
this
 
funùiÚ
.

286 
The
 
´ovided
 
li¡
 
of
 
mime
-
ty³s
 
mu¡
 
be
 oà
Úe
 oà
the
 
fŞlowšg
 
fÜm
:

287 * 
ty³
/
subty³


288 * 
ty³


	@trunk/objs/CherryPy-3.2.4/cherrypy/lib/gctools.py

1 
impÜt
 
gc


2 
impÜt
 
š¥eù


3 
impÜt
 
os


4 
impÜt
 
sys


5 
impÜt
 
time


7 
	gŒy
:

8 
impÜt
 
objg¿ph


9 
exû±
 
ImpÜtE¼Ü
:

10 
objg¿ph
 = 
NÚe


12 
impÜt
 
ch”rypy


13 
äom
 
ch”rypy
 
impÜt
 
_ı»que¡
, 
_ıwsgi


14 
äom
 
	gch”rypy
.
	g´oûss
.
¶ugšs
 
impÜt
 
Sim¶ePlugš


17 
şass
 
	$Reã¼”T»e
(
objeù
):

20 
³ek_Ëngth
 = 40

22 
def
 
	$__š™__
(
£lf
, 
ignÜe
=
NÚe
, 
maxd•th
=2, 
max·»Ás
=10):

23 
£lf
.
ignÜe
 = ignÜ
Ü
 []

24 
£lf
.
ignÜe
.
	`­³nd
(
š¥eù
.
	`cu¼’täame
().
f_back
)

25 
£lf
.
maxd•th
 = maxdepth

26 
£lf
.
max·»Ás
 = maxparents

28 
def
 
	$asûnd
(
£lf
, 
obj
, 
d•th
=1):

30 
d•th
 += 1

31 
·»Ás
 = []

33 #G©h” 
®l
 
»ã¼”s
 
š
 
Úe
 
¡•
 
to
 
mšimize


34 #ÿsÿdšg 
»ã»nûs
 
due
 
to
 
	`»´
(è
logic
.

35 
»fs
 = 
gc
.
	$g‘_»ã¼”s
(
obj
)

36 
£lf
.
ignÜe
.
	$­³nd
(
»fs
)

37 
	`Ën
(
»fs
è> 
£lf
.
max·»Ás
:

38  [("[% »ã¼”s]" % 
	`Ën
(
»fs
), [])]

40 
Œy
:

41 
asûndcode
 = 
£lf
.
asûnd
.
__code__


42 
exû±
 
A‰ribu‹E¼Ü
:

43 
asûndcode
 = 
£lf
.
asûnd
.
im_func
.
func_code


44 
·»Á
 
š
 
»fs
:

45 
š¥eù
.
	$isäame
(
·»Á
è
ªd
…¬’t.
f_code
 
is
 
asûndcode
:

47 
·»Á
 
š
 
£lf
.
ignÜe
:

49 
d•th
 <ğ
£lf
.
maxd•th
:

50 
·»Ás
.
	`­³nd
((
·»Á
, 
£lf
.
	$asûnd
(
·»Á
, 
d•th
)))

52 
·»Ás
.
	`­³nd
((
·»Á
, []))

54  
·»Ás


56 
def
 
	$³ek
(
£lf
, 
s
):

58 
	`Ën
(
s
è> (
£lf
.
³ek_Ëngth
 + 3):

59 
h®f
 = 
£lf
.
³ek_Ëngth


60  
s
[:
h®f
] + '...' + s[-half:]

62  
s


64 
def
 
	$_fÜm©
(
£lf
, 
obj
, 
desûnd
=
True
):

66 
š¥eù
.
	$isäame
(
obj
):

67 
f’ame
, 
lš’o
, 
func
, 
cÚ‹xt
, 
šdex
 = 
š¥eù
.
	$g‘äamešfo
(
obj
)

68  "<äamoàfunùiÚ '%s'>" % 
func


70 
nÙ
 
desûnd
:

71  
£lf
.
	`³ek
(
	$»´
(
obj
))

73 
	$isš¡ªû
(
obj
, 
diù
):

74  "{" + ", ".
	`još
(["%s: %s" % (
£lf
.
	`_fÜm©
(
k
, 
desûnd
=
F®£
),

75 
£lf
.
	$_fÜm©
(
v
, 
desûnd
=
F®£
))

76 
k
, 
v
 
š
 
obj
.
	`™ems
()]) + "}"

77 
–if
 
	$isš¡ªû
(
obj
, 
li¡
):

78  "[" + ", ".
	`još
([
£lf
.
	$_fÜm©
(
™em
, 
desûnd
=
F®£
)

79 
™em
 
š
 
obj
]) + "]"

80 
–if
 
	$isš¡ªû
(
obj
, 
tu¶e
):

81  "(" + ", ".
	`još
([
£lf
.
	$_fÜm©
(
™em
, 
desûnd
=
F®£
)

82 
™em
 
š
 
obj
]) + ")"

84 
r
 = 
£lf
.
	`³ek
(
	$»´
(
obj
))

85 
	`isš¡ªû
(
obj
, (
¡r
, , )):

86  
r


87  "%s: %s" % (
	`ty³
(
obj
), 
r
)

89 
def
 
	$fÜm©
(
£lf
, 
Œ“
):

91 
ouut
 = []

92 
def
 
	$asûnd
(
b¿nch
, 
d•th
=1):

93 
·»Á
, 
g¿nd·»Ás
 
š
 
b¿nch
:

94 
ouut
.
	`­³nd
((" " * 
d•th
è+ 
£lf
.
	$_fÜm©
(
·»Á
))

95 
g¿nd·»Ás
:

96 
	`asûnd
(
g¿nd·»Ás
, 
d•th
 + 1)

97 
	$asûnd
(
Œ“
)

98  
ouut


101 
def
 
	$g‘_š¡ªûs
(
şs
):

102  [
x
 x 
š
 
gc
.
	$g‘_objeùs
(è
	`isš¡ªû
(
x
, 
şs
)]

105 
şass
 
	$Reque¡CouÁ”
(
Sim¶ePlugš
):

107 
def
 
	$¡¬t
(
£lf
):

108 
£lf
.
couÁ
 = 0

110 
def
 
	$befÜe_»que¡
(
£lf
):

111 
£lf
.
couÁ
 += 1

113 
def
 
	$aá”_»que¡
(
£lf
):

114 
£lf
.
couÁ
 -=1

115 
»que¡_couÁ”
 = 
	$Reque¡CouÁ”
(
ch”rypy
.
’gše
)

116 
»que¡_couÁ”
.
	$subsüibe
()

119 
def
 
	$g‘_cÚ‹xt
(
obj
):

120 
	$isš¡ªû
(
obj
, 
_ı»que¡
.
Reque¡
):

121  "·th=%s;¡age=%s" % (
obj
.
·th_šfo
, obj.
¡age
)

122 
–if
 
	$isš¡ªû
(
obj
, 
_ı»que¡
.
Re¥Ú£
):

123  "¡©us=%s" % 
obj
.
¡©us


124 
–if
 
	$isš¡ªû
(
obj
, 
_ıwsgi
.
AµRe¥Ú£
):

125  "PATH_INFO=%s" % 
obj
.
’vœÚ
.
	`g‘
('PATH_INFO', '')

126 
–if
 
	`ha§‰r
(
obj
, "tb_lineno"):

127  "tb_lš’o=%s" % 
obj
.
tb_lš’o


131 
şass
 
	$GCRoÙ
(
objeù
):

134 
şas£s
 = [(
_ı»que¡
.
Reque¡
, 2, 2,

136 (
_ı»que¡
.
Re¥Ú£
, 2, 2,

138 (
_ıwsgi
.
AµRe¥Ú£
, 1, 1,

142 
def
 
	$šdex
(
£lf
):

144 
šdex
.
expo£d
 = 
True


146 
def
 
	$¡©s
(
£lf
):

147 
ouut
 = ["Statistics:"]

149 
ŒŸl
 
š
 
	$¿nge
(10):

150 
»que¡_couÁ”
.
couÁ
 > 0:

152 
time
.
	$¦“p
(0.5)

154 
ouut
.
	`­³nd
("\nNot‡ll„equests closed…roperly.")

156 #gc_cŞËù 
i¢
't…erfectly synchronous, because it may

157 #b»ak 
»ã»nû
 
cyşes
 
th©
 
th’
 
ke
 
time
 
to
 
fuÎy


158 #fš®ize. 
C®l
 
™
 
thriû
 
ªd
 
hİe
 
the
 
be¡
.

159 
gc
.
	$cŞËù
()

160 
gc
.
	$cŞËù
()

161 
uÄ—chabË
 = 
gc
.
	$cŞËù
()

162 
uÄ—chabË
:

163 
objg¿ph
 
is
 
nÙ
 
NÚe
:

164 
fš®
 = 
objg¿ph
.
	`by_ty³
('Nondestructible')

165 
fš®
:

166 
objg¿ph
.
	`show_back»fs
(
fš®
, 
f’ame
='finalizers.png')

168 
Œash
 = {
	}
}

169 
x
 
š
 
gc
.
g¬bage
:

170 
Œash
[
ty³
(
x
)] =¿sh.
g‘
(type(x), 0) + 1

171 
	gŒash
:

172 
ouut
.
š£¹
(0, "\n% uÄ—chabË objeùs:" % 
uÄ—chabË
)

173 
	gŒash
 = [(
v
, 
k
èk, v 
š
 
Œash
.
™ems
()]

174 
	gŒash
.
	$sÜt
()

175 
·œ
 
š
 
Œash
:

176 
ouut
.
	`­³nd
(" " + 
	$»´
(
·œ
))

178 #Check 
deş¬ed
 
şas£s
 
to
 
v”ify
 
uncŞËùed
 
š¡ªûs
.

179 #The£ 
dÚ
't haveo be…art of‡ cycle;hey can be

180 #ªy 
objeùs
 
th©
 
have
 
uÇÁic©ed
 
»ã¼”s
h© 
k“p


181 #them 
äom
 
bešg
 
cŞËùed
.

182 
®lobjs
 = {
	}
}

183 
şs
, 
	gmšobj
, 
	gmaxobj
, 
msg
 
š
 
	g£lf
.
	gşas£s
:

184 
®lobjs
[
şs
] = 
	$g‘_š¡ªûs
(
şs
)

186 
şs
, 
mšobj
, 
maxobj
, 
msg
 
š
 
£lf
.
şas£s
:

187 
objs
 = 
®lobjs
[
şs
]

188 
Ënobj
 = 
	$Ën
(
objs
)

189 
Ënobj
 < 
mšobj
 
Ü
†’obj > 
maxobj
:

190 
mšobj
 =ğ
maxobj
:

191 
ouut
.
	`­³nd
(

193 (
mšobj
, 
şs
, 
Ënobj
))

195 
ouut
.
	`­³nd
(

197 (
mšobj
, 
maxobj
, 
şs
, 
Ënobj
))

199 
obj
 
š
 
objs
:

200 
objg¿ph
 
is
 
nÙ
 
NÚe
:

201 
ig
 = [
	`id
(
objs
), id(
š¥eù
.
	`cu¼’täame
())]

202 
âame
 = "g¿ph_%s_%s.²g" % (
şs
.
__Çme__
, 
	$id
(
obj
))

203 
objg¿ph
.
	$show_back»fs
(

204 
obj
, 
exŒa_ignÜe
=
ig
, 
max_d•th
=4, 
too_mªy
=20,

205 
f’ame
=
âame
, 
exŒa_šfo
=
g‘_cÚ‹xt
)

206 
ouut
.
	`­³nd
("\nReferrers for %s (refcount=%s):" %

207 (
	`»´
(
obj
), 
sys
.
	$g‘»fcouÁ
(
obj
)))

208 
t
 = 
	$Reã¼”T»e
(
ignÜe
=[
objs
], 
maxd•th
=3)

209 
Œ“
 = 
t
.
	$asûnd
(
obj
)

210 
ouut
.
	`ex‹nd
(
t
.
	$fÜm©
(
Œ“
))

212  "\n".
	$još
(
ouut
)

213 
¡©s
.
expo£d
 = 
True


	@trunk/objs/CherryPy-3.2.4/cherrypy/lib/http.py

1 
impÜt
 
w¬nšgs


2 
	gw¬nšgs
.
w¬n
('cherrypy.lib.http has been deprecated‡nd will be„emoved '

4 
D•»ÿtiÚW¬nšg
)

6 
äom
 
	gch”rypy
.
	glib
.
h‰put
 
	gimpÜt
 *

	@trunk/objs/CherryPy-3.2.4/cherrypy/lib/httpauth.py

2 
This
 
moduË
 
defšes
 
funùiÚs
 
to
 
im¶em’t
 
HTTP
 
Dige¡
 
Auth’tiÿtiÚ
 (:
rfc
:`2617`).

3 
This
 
has
 
fuÎ
 
com¶Ÿnû
 
w™h
 'Dige¡' 
ªd
 'Basic' 
auth’tiÿtiÚ
 
m‘hods
. 
In


4 'Dige¡' 
™
 
suµÜts
 
bÙh
 
MD5
 
ªd
 MD5-
£ss
 
®gÜ™hms
.

6 
U§ge
:

7 
Fœ¡
 
u£
 'doAuth' 
to
 
»que¡
 
the
 
ş›Á
 
auth’tiÿtiÚ
 
a


8 
û¹aš
 
»sourû
. 
You
 
should
 
£nd
 
ª
 
h‰¶ib
.
UNAUTHORIZED
 
»¥Ú£
 
to
 
the


9 
ş›Á
 
so
 
he
 
knows
 h
has
 
to
 
auth’tiÿ‹
 
™£lf
.

11 
Th’
 
u£
 '·r£AuthÜiz©iÚ' 
to
 
»Œ›ve
 
the
 'auth_m­' 
u£d
 
š


14 
To
 
u£
 'checkRe¥Ú£' 
you
 
mu¡
 
have
 
®»ady
 
v”if›d
 
the
 
·sswÜd
 
assocŸ‹d


15 
w™h
 
the
 'u£ºame' 
key
 
š
 'auth_m­' 
diù
. 
Th’
 
you
 
u£
he 'checkResponse'

16 
funùiÚ
 
to
 
v”ify
 
the
 
·sswÜd
 
m©ches
h
Úe
 
£Á
 
by
h
ş›Á
.

18 
SUPPORTED_ALGORITHM
 - 
li¡
 
of
 
suµÜ‹d
 'Dige¡' 
®gÜ™hms


19 
SUPPORTED_QOP
 - 
li¡
 
of
 
suµÜ‹d
 'Digest' 'qop'.

21 
__v”siÚ__
 = 1, 0, 1

22 
	g__authÜ__
 = "Tiago Cogumbreiro <cogumbreiro@users.sf.net>"

23 
__üed™s__
 = """

24 
P‘”
 
vª
 
Kam³n
 
™s
 
»ce
 
which
 
im¶em’t
 
mo¡
 
of
 
Dige¡
 
auth’tiÿtiÚ
:

25 
h‰p
:

28 
__liûn£__
 = """

29 
Cİyright
 (
c
è2005, 
TŸgo
 
	gCogumb»œo
 <
	gcogumb»œo
@
	gu£rs
.
	gsf
.
	gÃt
>

30 
AÎ
 
rights
 
	g»£rved
.

32 
Redi¡ributiÚ
 
ªd
 
u£
 
š
 
sourû
‡nd 
bš¬y
 
	gfÜms
, 
w™h
 
Ü
 
w™hout
 
	gmodifiÿtiÚ
,

33 
¬e
 
³rm™‹d
 
´ovided
 
th©
 
the
 
fŞlowšg
 
cÚd™iÚs
‡» 
	gm‘
:

35 * 
Redi¡ributiÚs
 
of
 
sourû
 
code
 
mu¡
 
»š
 
the
 
above
 
cİyright
 
nÙiû
,

36 
this
 
li¡
 
of
 
cÚd™iÚs
 
ªd
 
the
 
fŞlowšg
 
	gdisşaim”
.

37 * 
Redi¡ributiÚs
 
š
 
bš¬y
 
fÜm
 
mu¡
 
»´oduû
 
the
 
above
 
cİyright
 
	gnÙiû
,

38 
this
 
li¡
 
of
 
cÚd™iÚs
 
ªd
 
the
 
fŞlowšg
 
disşaim”
 
š
h
docum’tiÚ


39 
	gªd
/
Ü
 
Ùh”
 
m©”Ÿls
 
´ovided
 
w™h
 
the
 
	gdi¡ributiÚ
.

40 * 
Ne™h”
 
the
 
Çme
 
of
 
Sylvaš
 
H–Ëgou¬ch
 
nÜ
h
Çmes
 oà
his
 
cÚŒibutÜs


41 
may
 
be
 
u£d
 
to
 
’dÜ£
 
Ü
 
´omÙe
 
´oduùs
 
d”ived
 
äom
 
this
 
soáw¬e


42 
w™hout
 
¥ecific
 
´iÜ
 
wr™‹n
 
	g³rmissiÚ
.

44 
THIS
 
SOFTWARE
 
IS
 
PROVIDED
 
BY
 
THE
 
COPYRIGHT
 
HOLDERS
 
AND
 
	gCONTRIBUTORS
 "AS IS" AND

45 
ANY
 
EXPRESS
 
OR
 
IMPLIED
 
	gWARRANTIES
, 
	gINCLUDING
, 
BUT
 
NOT
 
LIMITED
 
	gTO
, 
THE
 IMPLIED

46 
WARRANTIES
 
OF
 
MERCHANTABILITY
 
AND
 
FITNESS
 
FOR
 
A
 
PARTICULAR
 
PURPOSE
 
ARE


47 
	gDISCLAIMED
. 
IN
 
NO
 
EVENT
 
SHALL
 
THE
 
COPYRIGHT
 
OWNER
 
OR
 
CONTRIBUTORS
 
BE
 
LIABLE


48 
FOR
 
ANY
 
	gDIRECT
, 
	gINDIRECT
, 
	gINCIDENTAL
, 
	gSPECIAL
, 
	gEXEMPLARY
, 
OR
 
CONSEQUENTIAL


49 
DAMAGES
 (
INCLUDING
, 
BUT
 
NOT
 
LIMITED
 
TO
, 
PROCUREMENT
 
OF
 
SUBSTITUTE
 
GOODS
 
OR


50 
SERVICES
; 
LOSS
 
OF
 
USE
, 
DATA
, 
OR
 
PROFITS
; OR 
BUSINESS
 
INTERRUPTION
è
HOWEVER


51 
CAUSED
 
AND
 
ON
 
ANY
 
THEORY
 
OF
 
	gLIABILITY
, 
WHETHER
 
IN
 
	gCONTRACT
, 
STRICT
 LIABILITY,

52 
OR
 
	$TORT
 (
INCLUDING
 
NEGLIGENCE
 
OR
 
OTHERWISE
è
ARISING
 
IN
 
ANY
 
WAY
 
OUT
 
OF
 
THE
 
USE


53 
OF
 
THIS
 
SOFTWARE
, 
EVEN
 
IF
 
ADVISED
 OF 
THE
 
POSSIBILITY
 OF 
SUCH
 
DAMAGE
.

56 
__®l__
 = ("digestAuth", "basicAuth", "doAuth", "checkResponse",

61 
impÜt
 
time


62 
äom
 
ch”rypy
.
_ıcom·t
 
impÜt
 
ba£64_decode
, 
Áob
, 
md5


63 
äom
 
ch”rypy
.
_ıcom·t
 
impÜt
 
·r£_h‰p_li¡
, 
·r£_keqv_li¡


65 
MD5
 = "MD5"

66 
MD5_SESS
 = "MD5-sess"

67 
AUTH
 = "auth"

68 
AUTH_INT
 = "auth-int"

70 
SUPPORTED_ALGORITHM
 = (
MD5
, 
MD5_SESS
)

71 
SUPPORTED_QOP
 = (
AUTH
, 
AUTH_INT
)

75 #
_AUTH_ENCODERS = {

76 
MD5
: 
Ïmbda
 
v®
: 
	`md5
(
	`Áob
(v®)).
	`hexdige¡
(),

77 
MD5_SESS
: 
Ïmbda
 
v®
: 
	`md5
(
	`Áob
(v®)).
	`hexdige¡
(),

78 #SHA: 
Ïmbda
 
v®
: 
sha
.
	`Ãw
(
	`Áob
(v®)).
	`hexdige¡
 (),

79 
	}
}

81 
def
 
	$ÿlcuÏ‹NÚû
 (
»®m
, 
®gÜ™hm
 = 
MD5
):

83 
to
 
hªdË
 
£ssiÚs
."""

85 
glob®
 
SUPPORTED_ALGORITHM
, 
DIGEST_AUTH_ENCODERS


86 
as£¹
 
®gÜ™hm
 
š
 
SUPPORTED_ALGORITHM


88 
Œy
:

89 
’cod”
 = 
DIGEST_AUTH_ENCODERS
[
®gÜ™hm
]

90 
exû±
 
KeyE¼Ü
:

91 
¿i£
 
	`NÙIm¶em’‹dE¼Ü
 ("The chosen‡lgorithm (%s) does‚ot have "\

92 "ª im¶em’tiÚ y‘" % 
®gÜ™hm
)

94  
	`’cod”
 ("%d:%s" % (
time
.
	`time
(), 
»®m
))

96 
def
 
	$dige¡Auth
 (
»®m
, 
®gÜ™hm
 = 
MD5
, 
nÚû
 = 
NÚe
, 
qİ
 = 
AUTH
):

98 
glob®
 
SUPPORTED_ALGORITHM
, 
DIGEST_AUTH_ENCODERS
, 
SUPPORTED_QOP


99 
as£¹
 
®gÜ™hm
 
š
 
SUPPORTED_ALGORITHM


100 
as£¹
 
qİ
 
š
 
SUPPORTED_QOP


102 
nÚû
 
is
 
NÚe
:

103 
nÚû
 = 
	$ÿlcuÏ‹NÚû
 (
»®m
, 
®gÜ™hm
)

106 
»®m
, 
nÚû
, 
®gÜ™hm
, 
qİ


109 
def
 
	$basicAuth
 (
»®m
):

111 
as£¹
 '"' 
nÙ
 
š
 
»®m
, "Realms cannot containhe \" (quote) character."

113  'Basiø»®m="%s"' % 
»®m


115 
def
 
	$doAuth
 (
»®m
):

117 
Dige¡
 
ªd
 
çÎback
 
to
 
Basic
 
auth’tiÿtiÚ
 
wh’
 
the
 
brow£r
 
dÛ¢
't

118 
suµÜt
 
the
 
fœ¡
 
Úe
.

120 
This
 
should
 
be
 
£t
 
š
 
the
 
HTTP
 
h—d”
 
und”
h
key
 'WWW-Authenticate'."""

122  
	`dige¡Auth
 (
»®m
è+ " " + 
	$basicAuth
 (
»®m
)

126 #P¬£ 
authÜiz©iÚ
 
·¿m‘”s


127 #
 _·r£Dige¡AuthÜiz©iÚ (auth_·¿ms):

128 #CÚv”ˆ
the
 
auth
 
·¿ms
 
to
 
a
 
diù


129 
™ems
 = 
	$·r£_h‰p_li¡
(
auth_·¿ms
)

130 
·¿ms
 = 
	$·r£_keqv_li¡
(
™ems
)

132 #Now 
v®id©e
 
the
 
·¿ms


134 #Check 
»quœed
 
·¿m‘”s


135 
»quœed
 = ["username", "realm", "nonce", "uri", "response"]

136 
k
 
š
 
»quœed
:

137 
k
 
nÙ
 
š
 
·¿ms
:

138  
NÚe


140 #Ià
qİ
 
is
 
£Á
 
th’
 
úÚû
 
ªd
 
nc
 
MUST
 
be
 
´e£Á


141 "qİ" 
š
 
·¿ms
 
ªd
 
	`nÙ
 ("cnonce" in…arams \

142 
ªd
 "nc" 
š
 
·¿ms
):

143  
NÚe


145 #Ià
qİ
 
is
 
nÙ
 
£Á
, 
Ã™h”
 
úÚû
 
nÜ
 
nc
 
ÿn
 
be
 
´e£Á


146 ià("úÚû" 
š
 
·¿ms
 
Ü
 "nc" iÀ·¿msè
ªd
 \

147 "qİ" 
nÙ
 
š
 
·¿ms
:

148  
NÚe


150  
·¿ms


153 
def
 
	$_·r£BasicAuthÜiz©iÚ
 (
auth_·¿ms
):

154 
u£ºame
, 
·sswÜd
 = 
	`ba£64_decode
(
auth_·¿ms
).
	`¥l™
(":", 1)

155  {"u£ºame": 
u£ºame
, "·sswÜd": 
·sswÜd
}

157 
AUTH_SCHEMES
 = {

158 "basic": 
_·r£BasicAuthÜiz©iÚ
,

159 "dige¡": 
_·r£Dige¡AuthÜiz©iÚ
,

162 
def
 
	$·r£AuthÜiz©iÚ
 (
üed’tŸls
):

164 
the
 
HTTP
 
h—d”
 
to
 
a
 
m­
 
™£lf
. 
If
h
·rsšg
 
çs
 'NÚe' 
is
 
»tuºed
.

167 
glob®
 
AUTH_SCHEMES


169 
auth_scheme
, 
auth_·¿ms
 = 
üed’tŸls
.
	`¥l™
(" ", 1)

170 
auth_scheme
 =‡uth_scheme.
	$low”
 ()

172 
·r£r
 = 
AUTH_SCHEMES
[
auth_scheme
]

173 
·¿ms
 = 
	$·r£r
 (
auth_·¿ms
)

175 
·¿ms
 
is
 
NÚe
:

178 
as£¹
 "auth_scheme" 
nÙ
 
š
 
·¿ms


179 
·¿ms
["auth_scheme"] = 
auth_scheme


180  
·¿ms


184 #Check 
´ovided
 
»¥Ú£
 
a
 
v®id
 
·sswÜd


185 #
 md5SessiÚKey (·¿ms,…asswÜd):

187 
If
 
the
 "®gÜ™hm" 
dœeùive
's value is "MD5-sess",hen A1

188 [
the
 
£ssiÚ
 
key
] 
is
 
ÿlcuÏ‹d
 
Úly
 
Úû
 - 
Ú
h
fœ¡
 
»que¡
 
by
he

189 
ş›Á
 
fŞlowšg
 
»ût
 
of
 
a
 
WWW
-
Auth’tiÿ‹
 
ch®Ënge
 
äom
 
the
 
£rv”
.

191 
This
 
ü—‹s
 
a
 '£ssiÚ key' 
the
 
auth’tiÿtiÚ
 
of
 
sub£qu’t


192 
»que¡s
 
ªd
 
»¥Ú£s
 
which
 
is
 
difã»Á
 
—ch
 "authentication

193 
£ssiÚ
",hus†imitinghe‡mount of material hashed with‡ny one

194 
key
.

196 
Beÿu£
 
the
 
£rv”
 
Ãed
 
Úly
 
u£
h
hash
 
of
h
u£r


197 
üed’tŸls
 
š
 
Üd”
 
to
 
ü—‹
 
the
 
A1
 
v®ue
, 
this
 
cÚ¡ruùiÚ
 
could


198 
be
 
u£d
 
š
 
cÚjunùiÚ
 
w™h
 
a
 
thœd
 
·¹y
 
auth’tiÿtiÚ
 
£rviû
 
so


199 
th©
 
the
 
web
 
£rv”
 
would
 
nÙ
 
Ãed
h
aùu®
 
·sswÜd
 
v®ue
. 
The


200 
¥ecifiÿtiÚ
 
of
 
such
 
a
 
´ÙocŞ
 
is
 
beyÚd
 
the
 
scİe
 oà
this


201 
¥ecifiÿtiÚ
.

204 
keys
 = ("username", "realm", "nonce", "cnonce")

205 
·¿ms_cİy
 = {
	}
}

206 
key
 
š
 
keys
:

207 
·¿ms_cİy
[
key
] = 
·¿ms
[key]

209 
·¿ms_cİy
["®gÜ™hm"] = 
MD5_SESS


210  
	$_A1
 (
·¿ms_cİy
, 
·sswÜd
)

212 
def
 
	$_A1
(
·¿ms
, 
·sswÜd
):

213 
®gÜ™hm
 = 
·¿ms
.
	`g‘
 ("®gÜ™hm", 
MD5
)

214 
H
 = 
DIGEST_AUTH_ENCODERS
[
®gÜ™hm
]

216 
®gÜ™hm
 =ğ
MD5
:

217 #Ià
the
 "®gÜ™hm" 
dœeùive
's value is "MD5" or is

218 #un¥ecif›d, 
th’
 
A1
 
is
:

219 #A1 = 
	`unq
(
u£ºame
-
v®ue
è":" unq(
»®m
-v®ueè":" 
·sswd


220  "%s:%s:%s" % (
·¿ms
["u£ºame"],…¬ams["»®m"], 
·sswÜd
)

222 
–if
 
®gÜ™hm
 =ğ
MD5_SESS
:

224 #Thi 
is
 
A1
 
qİ
 i 
£t


225 #A1 = 
	`H
Ğ
	`unq
(
u£ºame
-
v®ue
è":" unq(
»®m
-v®ueè":" 
·sswd
 )

227 
h_a1
 = 
	`H
 ("%s:%s:%s" % (
·¿ms
["u£ºame"],…¬ams["»®m"], 
·sswÜd
))

228  "%s:%s:%s" % (
h_a1
, 
·¿ms
["nonce"],…arams["cnonce"])

231 
def
 
	$_A2
(
·¿ms
, 
m‘hod
, 
kw¬gs
):

232 #Ià
the
 "qİ" 
dœeùive
's value is "auth" or is unspecified,hen A2 is:

233 #A2 = 
M‘hod
 ":" 
dige¡
-
uri
-
v®ue


235 
qİ
 = 
·¿ms
.
	`g‘
 ("qop", "auth")

236 
qİ
 == "auth":

237  
m‘hod
 + ":" + 
·¿ms
["uri"]

238 
–if
 
qİ
 == "auth-int":

239 #Ià
the
 "qİ" 
v®ue
 
is
 "auth-št", 
th’
 
A2
 is:

240 #A2 = 
M‘hod
 ":" 
dige¡
-
uri
-
v®ue
 ":" 
	`H
(
’t™y
-
body
)

241 
’t™y_body
 = 
kw¬gs
.
	`g‘
 ("entity_body", "")

242 
H
 = 
kw¬gs
["H"]

245 
m‘hod
,

246 
·¿ms
["uri"],

247 
	$H
(
’t™y_body
)

251 
¿i£
 
	`NÙIm¶em’‹dE¼Ü
 ("Th'qİ' m‘hod i unknown: %s" % 
qİ
)

253 
def
 
	`_compu‹Dige¡Re¥Ú£
(
auth_m­
, 
·sswÜd
, 
m‘hod
 = "GET", 
A1
 = 
NÚe
,**
kw¬gs
):

255 
G’”©es
 
a
 
»¥Ú£
 
»¥eùšg
 
the
 
®gÜ™hm
 
defšed
 
š
 
RFC
 2617

257 
·¿ms
 = 
auth_m­


259 
®gÜ™hm
 = 
·¿ms
.
	`g‘
 ("®gÜ™hm", 
MD5
)

261 
H
 = 
DIGEST_AUTH_ENCODERS
[
®gÜ™hm
]

262 
KD
 = 
Ïmbda
 
£ü‘
, 
d©a
: 
	`H
(secret + ":" + data)

264 
qİ
 = 
·¿ms
.
	`g‘
 ("qİ", 
NÚe
)

266 
H_A2
 = 
	`H
(
	$_A2
(
·¿ms
, 
m‘hod
, 
kw¬gs
))

268 
®gÜ™hm
 =ğ
MD5_SESS
 
ªd
 
A1
 
is
 
nÙ
 
NÚe
:

269 
H_A1
 = 
	$H
(
A1
)

271 
H_A1
 = 
	`H
(
	$_A1
(
·¿ms
, 
·sswÜd
))

273 
qİ
 
	`š
 ("auth", "auth-int"):

274 #Ià
the
 "qİ" 
v®ue
 
is
 "auth" 
Ü
 "auth-int":

275 #»que¡-
dige¡
 = <"> < KD ( H(A1), unq(nonce-value)

281 
»que¡
 = "%s:%s:%s:%s:%s" % (

282 
·¿ms
["nonce"],

283 
·¿ms
["nc"],

284 
·¿ms
["cnonce"],

285 
·¿ms
["qop"],

286 
H_A2
,

288 
–if
 
qİ
 
is
 
NÚe
:

289 #Ià
the
 "qİ" 
dœeùive
 
is
 
nÙ
 
	`´e£Á
 (
this
 
cÚ¡ruùiÚ
 is

290 #fÜ 
com·tib™y
 
w™h
 
RFC
 2069):

291 #»que¡-
dige¡
 =

293 
»que¡
 = "%s:%s" % (
·¿ms
["nÚû"], 
H_A2
)

295  
	$KD
(
H_A1
, 
»que¡
)

297 
def
 
	`_checkDige¡Re¥Ú£
(
auth_m­
, 
·sswÜd
, 
m‘hod
 = "GET", 
A1
 = 
NÚe
, **
kw¬gs
):

299 
he
 
Œ›s
 
to
 
auth’tiÿ‹
.

300 
O±iÚ®
 
¬gum’ts
:

301 
’t™y_body
 - 
wh’
 'qİ' 
is
 
£t
 
to
 'auth-št' 
you
 
MUST
 
´ovide
 
the


302 
¿w
 
d©a
 
you
 
¬e
 
gošg
 
to
 
£nd
Ø
the
 
	`ş›Á
 (
usu®ly
he

303 
HTML
 
·ge
.

304 
»que¡_uri
 - 
the
 
uri
 
äom
h
»que¡
 
lše
 
com·»d
 
w™h
he 'uri'

305 
dœeùive
 
of
 
the
 
authÜiz©iÚ
 
m­
. 
They
 
mu¡
 
»´e£Á


306 
the
 
§me
 
	`»sourû
 (
unu£d
 
©
 
this
 
time
).

309 
auth_m­
['»®m'] !ğ
kw¬gs
.
	`g‘
('»®m', 
NÚe
):

310  
F®£


312 
»¥Ú£
 = 
	$_compu‹Dige¡Re¥Ú£
(
auth_m­
, 
·sswÜd
, 
m‘hod
, 
A1
,**
kw¬gs
)

314  
»¥Ú£
 =ğ
auth_m­
["response"]

316 
def
 
	`_checkBasicRe¥Ú£
 (
auth_m­
, 
·sswÜd
, 
m‘hod
='GET', 
’üy±
=
NÚe
, **
kw¬gs
):

317 #NÙ
th©
 
the
 
Basic
 
»¥Ú£
 
dÛ¢
't…rovidehe„ealm value so we cannot

318 #‹¡ 
™


319 
Œy
:

320  
	`’üy±
(
auth_m­
["·sswÜd"],‡uth_m­["u£ºame"]è=ğ
·sswÜd


321 
exû±
 
Ty³E¼Ü
:

322  
	`’üy±
(
auth_m­
["·sswÜd"]è=ğ
·sswÜd


324 
AUTH_RESPONSES
 = {

325 "basic": 
_checkBasicRe¥Ú£
,

326 "dige¡": 
_checkDige¡Re¥Ú£
,

327 
	}
}

329 
def
 
checkRe¥Ú£
 (
auth_m­
, 
·sswÜd
, 
m‘hod
 = "GET", 
’üy±
=
NÚe
, **
kw¬gs
):

331 
Ùh”
 
¬gum’ts
 
th©
 
—ch
 
im¶em’tiÚ
 
might
 
Ãed
.

333 
If
 
the
 
»¥Ú£
 
is
 
of
 
ty³
 'Basic' 
th’
h
funùiÚ
 
has
h
fŞlowšg


334 
sigÇtu»
::

336 
checkBasicRe¥Ú£
 (
auth_m­
, 
·sswÜd
è-> 
boŞ


338 
If
 
the
 
»¥Ú£
 
is
 
of
 
	gty³
 'Dige¡' 
th’
h
funùiÚ
 
has
h
fŞlowšg


339 
	gsigÇtu»
::

341 
checkDige¡Re¥Ú£
 (
auth_m­
, 
·sswÜd
, 
m‘hod
 = 'GET', 
A1
 = 
NÚe
è-> 
boŞ


343 
The
 'A1' 
¬gum’t
 
is
 
Úly
 
u£d
 
š
 
MD5_SESS
 
®gÜ™hm
 
ba£d
 
»¥Ú£s
.

344 
Check
 
	$md5SessiÚKey
(è
mÜe
 
šfo
.

346 
check”
 = 
AUTH_RESPONSES
[
auth_m­
["auth_scheme"]]

347  
	`check”
 (
auth_m­
, 
·sswÜd
, 
m‘hod
=m‘hod, 
’üy±
ónüy±, **
kw¬gs
)

	@trunk/objs/CherryPy-3.2.4/cherrypy/lib/httputil.py

3 
This
 
moduË
 
cÚšs
 
funùiÚs
 
budšg
 
ª
 
HTTP
 
­¶iÿtiÚ


4 
	gäamewÜk
: 
ªy
 
Úe
, 
nÙ
 
ju¡
 oÃ 
who£
 
Çme
 
¡¬ts
 
	gw™h
 "Ch". ;è
If
 
you


5 
»ã»nû
 
ªy
 
moduËs
 
äom
 
some
 
pİuÏr
 
äamewÜk
 
šside
 *
this
* 
	gmoduË
,

6 
FuMªChu
 
wl
 
³rsÚ®ly
 
hªg
 
you
 
up
 
by
 
your
 
thumbs
 
ªd
 
subm™
 you

7 
to
 
a
 
public
 
	gÿnšg
.

10 
äom
 
bšascii
 
impÜt
 
b2a_ba£64


11 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
	gBa£HTTPReque¡HªdËr
, 
	gHTTPD©e
, 
	gÁob
, 
	gÁou
, 
	g»v”£d
, 
sÜ‹d


12 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
	gba£¡ršg
, 
	gby‹¡r
, 
	g™”™ems
, 
	gÇtive¡r
, 
	gunicode¡r
, 
unquÙe_qs


13 
	g»¥Ú£_codes
 = 
Ba£HTTPReque¡HªdËr
.
»¥Ú£s
.
	$cİy
()

15 #From 
h‰p
:

16 
»¥Ú£_codes
[500] = ('Internal Server Error',

19 
»¥Ú£_codes
[503] = ('Service Unavailable',

24 
impÜt
 
»


25 
impÜt
 
u¾lib


29 
def
 
	$u¾još
(*
©oms
):

32 
This
 
wl
 
cÜ»ùly
 
još
 
a
 
SCRIPT_NAME
 
ªd
 
PATH_INFO
 
što
 
the


33 
Üigš®
 
URL
, 
ev’
 
e™h”
 
©om
 
is
 
bÏnk
.

35 
u¾
 = "/".
	$još
([
x
 x 
š
 
©oms
 x])

36 "//" 
š
 
u¾
:

37 
u¾
 = u¾.
	`»¶aû
("//", "/")

38 #S³cŸl-
the
 
fš®
 
u¾
 
of
 "", 
ªd
  "/" 
š¡—d
.

39  
u¾
 
Ü
 "/"

41 
def
 
	$u¾još_by‹s
(*
©oms
):

44 
This
 
wl
 
cÜ»ùly
 
još
 
a
 
SCRIPT_NAME
 
ªd
 
PATH_INFO
 
što
 
the


45 
Üigš®
 
URL
, 
ev’
 
e™h”
 
©om
 
is
 
bÏnk
.

47 
u¾
 = 
	`Áob
("/").
	$još
([
x
 x 
š
 
©oms
 x])

48 
	`Áob
("//"è
š
 
u¾
:

49 
u¾
 = u¾.
	`»¶aû
(
	`Áob
("//"),‚tob("/"))

50 #S³cŸl-
the
 
fš®
 
u¾
 
of
 "", 
ªd
  "/" 
š¡—d
.

51  
u¾
 
Ü
 
	`Áob
("/")

53 
def
 
	$´ÙocŞ_äom_h‰p
(
´ÙocŞ_¡r
):

55  (
´ÙocŞ_¡r
[5]), (protocol_str[7])

57 
def
 
	$g‘_¿nges
(
h—d”v®ue
, 
cÚ‹Á_Ëngth
):

60 
	$Each
 (
¡¬t
, 
¡İ
è
tu¶e
 
wl
 
be
 
compo£d
 
of
 
two
 
šts
, 
which
 
¬e
 
su™abË


61 
u£
 
š
 
a
 
¦icšg
 
İ”©iÚ
. 
Th©
 
is
, 
the
 
h—d”
 "Range: bytes=3-6",

62 
­¶›d
 
agaš¡
 
a
 
PythÚ
 
¡ršg
, 
is
 
»que¡šg
 
»sourû
[3:7]. 
This


63 
funùiÚ
 
wl
  
the
 
li¡
 [(3, 7)].

65 
If
 
this
 
funùiÚ
 
»tuºs
 
ª
 
em±y
 
li¡
, 
you
 
should
  
HTTP
 416.

68 
nÙ
 
h—d”v®ue
:

69  
NÚe


71 
»suÉ
 = []

72 
by‹sun™
, 
by‹¿nges
 = 
h—d”v®ue
.
	`¥l™
("=", 1)

73 
b¿nge
 
š
 
by‹¿nges
.
	`¥l™
(","):

74 
¡¬t
, 
¡İ
 = [
x
.
	$¡r
(è
x
 
š
 
b¿nge
.
	`¥l™
("-", 1)]

75 
¡¬t
:

76 
nÙ
 
¡İ
:

77 
¡İ
 = 
cÚ‹Á_Ëngth
 - 1

78 
¡¬t
, 
¡İ
 = (start), (stop)

79 
¡¬t
 >ğ
cÚ‹Á_Ëngth
:

80 #From 
rfc
 2616 
£c
 14.16:

81 #"
If
 
the
 
£rv”
 
»ûives
 
a
 
	`»que¡
 (
Ùh”
 
thª
 
Úe


82 #šşudšg 
ª
 
If
-
Rªge
 
»que¡
-
h—d”
 
f›ld
è
w™h
‡n

83 #un§tisfŸbË 
Rªge
 
»que¡
-
h—d”
 
	`f›ld
 (
th©
 
is
,

84 #®È
of
 
who£
 
by‹
-
¿nge
-
¥ec
 
v®ues
 
have
 
a
 
fœ¡
-by‹-
pos


85 #v®u
g»©”
 
thª
 
the
 
cu¼’t
 
Ëngth
 
of
h
£Ëùed


86 #»sourû), 
™
 
SHOULD
  
a
 
»¥Ú£
 
code
 
of
 416

87 #(
Reque¡ed
 
¿nge
 
nÙ
 
§tisfŸbË
)."

89 
¡İ
 < 
¡¬t
:

90 #From 
rfc
 2616 
£c
 14.16:

91 #"
If
 
the
 
£rv”
 
ignÜes
 
a
 
by‹
-
¿nge
-
¥ec
 
beÿu£
 
™


92 #i 
syÁaùiÿÎy
 
šv®id
, 
the
 
£rv”
 
SHOULD
 
Œ—t


93 #th
»que¡
 
as
 
the
 
šv®id
 
Rªge
 
h—d”
 
f›ld


94 #did 
nÙ
 
exi¡
. (
NÜm®ly
, 
this
 
m—ns
  
a
 200

95 #»¥Ú£ 
cÚššg
 
the
 
fuÎ
 
’t™y
)."

96  
NÚe


97 
»suÉ
.
	`­³nd
((
¡¬t
, 
¡İ
 + 1))

99 
nÙ
 
¡İ
:

100 #S“ 
rfc
 
quÙe
 
above
.

101  
NÚe


102 #Neg©iv
	`subsüt
 (
Ï¡
 
N
 
by‹s
)

103 
»suÉ
.
	`­³nd
((
cÚ‹Á_Ëngth
 - (
¡İ
), content_length))

105  
»suÉ


108 
şass
 
	$H—d”EËm’t
(
objeù
):

111 
def
 
	$__š™__
(
£lf
, 
v®ue
, 
·¿ms
=
NÚe
):

112 
£lf
.
v®ue
 = value

113 
·¿ms
 
is
 
NÚe
:

114 
·¿ms
 = {
	}
}

115 
£lf
.
·¿ms
 =…arams

117 
def
 
	$__cmp__
(
£lf
, 
Ùh”
):

118  
	$cmp
(
£lf
.
v®ue
, 
Ùh”
.value)

120 
def
 
	$__É__
(
£lf
, 
Ùh”
):

121  
£lf
.
v®ue
 < 
Ùh”
.value

123 
def
 
	$__¡r__
(
£lf
):

124 
p
 = [";%s=%s" % (
k
, 
v
èk, v 
š
 
	`™”™ems
(
£lf
.
·¿ms
)]

125  
	`¡r
("%s%s" % (
£lf
.
v®ue
, "".
	$još
(
p
)))

127 
def
 
	$__by‹s__
(
£lf
):

128  
	`Áob
(
£lf
.
	$__¡r__
())

130 
def
 
	$__unicode__
(
£lf
):

131  
	`Áou
(
£lf
.
	$__¡r__
())

133 
def
 
	$·r£
(
–em’t¡r
):

135 #S¶™ 
the
 
–em’t
 
što
 
a
 
v®ue
 
ªd
 
·¿m‘”s
. 
The
 'v®ue' 
may


136 #b
of
 
the
 
fÜm
, "tok’ñok’", 
but
 
we
 
dÚ
't splithat here.

137 
©oms
 = [
x
.
	$¡r
(è
x
 
š
 
–em’t¡r
.
	`¥l™
(";"èx.
	`¡r
()]

138 
nÙ
 
©oms
:

139 
š™Ÿl_v®ue
 = ''

141 
š™Ÿl_v®ue
 = 
©oms
.
	`pİ
(0).
	$¡r
()

142 
·¿ms
 = {
	}
}

143 
©om
 
š
 
©oms
:

144 
©om
 = [
x
.
	$¡r
(è
x
 
š
 
©om
.
	`¥l™
("=", 1èx.
	`¡r
()]

145 
key
 = 
©om
.
	$pİ
(0)

146 
©om
:

147 
v®
 = 
©om
[0]

149 
v®
 = ""

150 
·¿ms
[
key
] = 
v®


151  
š™Ÿl_v®ue
, 
·¿ms


152 
·r£
 = 
	$¡©icm‘hod
(
·r£
)

154 
def
 
	$äom_¡r
(
şs
, 
–em’t¡r
):

156 
iv®
, 
·¿ms
 = 
şs
.
	$·r£
(
–em’t¡r
)

157  
	$şs
(
iv®
, 
·¿ms
)

158 
äom_¡r
 = 
	$şassm‘hod
(
äom_¡r
)

161 
q_£·¿tÜ
 = 
»
.
	`compe
(
r
'; *q *=')

163 
şass
 
	$Acû±EËm’t
(
H—d”EËm’t
):

166 
Acû±EËm’t
 
objeùs
 
¬e
 
com·¿bË
; 
the
 
mÜe
-
´eã¼ed
 
objeù
 
wl
 
be


167 "Ës thª" 
the
 
Ëss
-
´eã¼ed
 
objeù
. 
They
 
¬e
 
®so
 
th”efÜe
 
sÜbË
;

168 
you
 
sÜt
 
a
 
li¡
 
of
 
Acû±EËm’t
 
objeùs
, 
they
 
wl
 
be
 
li¡ed
 
š


169 
´iÜ™y
 
Üd”
; 
the
 
mo¡
 
´eã¼ed
 
v®ue
 
wl
 
be
 
fœ¡
. 
Yes
, 
™
 
should


170 
have
 
b“n
 
the
 
Ùh”
 
way
 
¬ound
, 
but
 
™
'soo†ateo fix‚ow.

173 
def
 
	$äom_¡r
(
şs
, 
–em’t¡r
):

174 
qv®ue
 = 
NÚe


175 #Th
fœ¡
 "q" 
	`·¿m‘”
 (
ªy
è
£·¿‹s
 
the
 
š™Ÿl


176 #medŸ-
¿nge
 
	`·¿m‘”
(
s
è(
ªy
è
äom
 
the
 
acû±
-
·¿ms
.

177 
©oms
 = 
q_£·¿tÜ
.
	$¥l™
(
–em’t¡r
, 1)

178 
medŸ_¿nge
 = 
©oms
.
	`pİ
(0).
	$¡r
()

179 
©oms
:

180 #Th
qv®ue
 
ª
 
Acû±
 
h—d”
 
ÿn
 
have
 
ex‹nsiÚs
. 
The
 
Ùh”


181 #h—d” 
ÿÂÙ
, 
but
 
™
'sƒasiero…arsehem‡s ifhey did.

182 
qv®ue
 = 
H—d”EËm’t
.
	`äom_¡r
(
©oms
[0].
	$¡r
())

184 
medŸ_ty³
, 
·¿ms
 = 
şs
.
	$·r£
(
medŸ_¿nge
)

185 
qv®ue
 
is
 
nÙ
 
NÚe
:

186 
·¿ms
["q"] = 
qv®ue


187  
	$şs
(
medŸ_ty³
, 
·¿ms
)

188 
äom_¡r
 = 
	$şassm‘hod
(
äom_¡r
)

190 
def
 
	$qv®ue
(
£lf
):

191 
v®
 = 
£lf
.
·¿ms
.
	`g‘
("q", "1")

192 
	$isš¡ªû
(
v®
, 
H—d”EËm’t
):

193 
v®
 = v®.
v®ue


194  (
v®
)

195 
qv®ue
 = 
	`´İ”ty
(qv®ue, 
doc
="The qvalue, or…riority, ofhis value.")

197 
def
 
	$__cmp__
(
£lf
, 
Ùh”
):

198 
diff
 = 
	$cmp
(
£lf
.
qv®ue
, 
Ùh”
.qvalue)

199 
diff
 == 0:

200 
diff
 = 
	`cmp
(
	`¡r
(
£lf
), 
	$¡r
(
Ùh”
))

201  
diff


203 
def
 
	$__É__
(
£lf
, 
Ùh”
):

204 
£lf
.
qv®ue
 =ğ
Ùh”
.qvalue:

205  
	`¡r
(
£lf
è< 
	$¡r
(
Ùh”
)

207  
£lf
.
qv®ue
 < 
Ùh”
.qvalue

210 
def
 
	$h—d”_–em’ts
(
f›ldÇme
, 
f›ldv®ue
):

212 
nÙ
 
f›ldv®ue
:

215 
»suÉ
 = []

216 
–em’t
 
š
 
f›ldv®ue
.
	`¥l™
(","):

217 
f›ldÇme
.
	`¡¬tsw™h
("Acû±"è
Ü
 fieldname == 'TE':

218 
hv
 = 
Acû±EËm’t
.
	$äom_¡r
(
–em’t
)

220 
hv
 = 
H—d”EËm’t
.
	$äom_¡r
(
–em’t
)

221 
»suÉ
.
	$­³nd
(
hv
)

223  
	`li¡
(
	`»v”£d
(
	$sÜ‹d
(
»suÉ
)))

225 
def
 
	$decode_TEXT
(
v®ue
):

226 
r
"""Decod:rfc:`2047` TEXT (e.g. "=?
utf
-8?
q
?
f
=
C3
=
BCr
?=" -> "f\
xfü
")."""

227 
Œy
:

229 
äom
 
ema
.
h—d”
 
impÜt
 
decode_h—d”


230 
exû±
 
ImpÜtE¼Ü
:

231 
äom
 
ema
.
H—d”
 
impÜt
 
decode_h—d”


232 
©oms
 = 
	$decode_h—d”
(
v®ue
)

233 
decodedv®ue
 = ""

234 
©om
, 
ch¬£t
 
š
 
©oms
:

235 
ch¬£t
 
is
 
nÙ
 
NÚe
:

236 
©om
 =‡tom.
	$decode
(
ch¬£t
)

237 
decodedv®ue
 +ğ
©om


238  
decodedv®ue


240 
def
 
	$v®id_¡©us
(
¡©us
):

243 
The
 
¡©us
 
¬g
 
mu¡
 
be
 
ª
 , 
Ü
 
a
 
¡r
 
th©
 
begšs
 
w™h
‡n .

245 
If
 
¡©us
 
is
 
ª
 , 
Ü
 
a
 
¡r
 
ªd
 
no
 
»asÚ
-
ph¿£
 i 
suµl›d
,

246 
a
  
»asÚ
-
ph¿£
 
wl
 
be
 
´ovided
.

249 
nÙ
 
¡©us
:

250 
¡©us
 = 200

252 
¡©us
 = 
	$¡r
(
¡©us
)

253 
·¹s
 = 
¡©us
.
	`¥l™
(" ", 1)

254 
	`Ën
(
·¹s
) == 1:

255 #NØ
»asÚ
 
suµl›d
.

256 
code
, = 
·¹s


257 
»asÚ
 = 
NÚe


259 
code
, 
»asÚ
 = 
·¹s


260 
»asÚ
 =„—sÚ.
	$¡r
()

262 
Œy
:

263 
code
 = (code)

264 
exû±
 
V®ueE¼Ü
:

265 
¿i£
 
	`V®ueE¼Ü
("Illegal„esponse status from server "

266 "(% i nÚ-num”ic)." % 
	$»´
(
code
))

268 
code
 < 100 
Ü
 code > 599:

269 
¿i£
 
	`V®ueE¼Ü
("Illegal„esponse status from server "

270 "(% i ouˆoà¿nge)." % 
	$»´
(
code
))

272 
code
 
nÙ
 
š
 
»¥Ú£_codes
:

273 #cod
is
 
unknown
 
but
 
nÙ
 
Ëg®


274 
deçuÉ_»asÚ
, 
mes§ge
 = "", ""

276 
deçuÉ_»asÚ
, 
mes§ge
 = 
»¥Ú£_codes
[
code
]

278 
»asÚ
 
is
 
NÚe
:

279 
»asÚ
 = 
deçuÉ_»asÚ


281  
code
, 
»asÚ
, 
mes§ge


284 #NOTE: 
the
 
·r£_qs
 
funùiÚs
 
th©
 
fŞlow
 
¬e
 
modif›d
 
v”siÚ
 
of
 
tho£


285 #š 
the
 
pythÚ3
.0 
sourû
 - 
we
 
Ãed
 
to
 
·ss
 
through
 
ª
 
’codšg
Øth
unquÙe


286 #m‘hod, 
but
 
the
  
·r£_qs
 
funùiÚ
 
dÛ¢
't‡llow uso. These do.

288 
def
 
	`_·r£_qs
(
qs
, 
k“p_bÏnk_v®ues
=0, 
¡riù_·rsšg
=0, 
’codšg
='utf-8'):

291 
Argum’ts
:

293 
qs
: 
URL
-
’coded
 
qu”y
 
¡ršg
 
to
 
be
 
·r£d


295 
k“p_bÏnk_v®ues
: 
æag
 
šdiÿtšg
 
wh‘h”
 
bÏnk
 
v®ues
 
š


296 
URL
 
’coded
 
qu”›s
 
should
 
be
 
Œ—‹d
 
as
 
bÏnk
 
¡ršgs
. 
A


297 
Œue
 
v®ue
 
šdiÿ‹s
 
th©
 
bÏnks
 
should
 
be
 
»šed
 
as
 
bÏnk


298 
¡ršgs
. 
The
  
çl£
 
v®ue
 
šdiÿ‹s
 
th©
 
bÏnk
 
v®ues


299 
¬e
 
to
 
be
 
ignÜed
 
ªd
 
Œ—‹d
 
as
 
they
 
w”e
 
nÙ
 
šşuded
.

301 
¡riù_·rsšg
: 
æag
 
šdiÿtšg
 
wh©
 
to
 dØ
w™h
 
·rsšg
 
”rÜs
. 
If


302 
	`çl£
 (
the
 ), 
”rÜs
 
¬e
 
s’y
 
ignÜed
. 
If
 
Œue
,

303 
”rÜs
 
¿i£
 
a
 
V®ueE¼Ü
 
exû±iÚ
.

305 
R‘uºs
 
a
 
diù
, 
as
 
G
-
d
 
š‹nded
.

307 
·œs
 = [
s2
 
s1
 
š
 
qs
.
	`¥l™
('&') s2 in s1.split(';')]

308 
d
 = {
	}
}

309 
Çme_v®ue
 
š
 
·œs
:

310 
nÙ
 
Çme_v®ue
 
ªd
‚Ù 
¡riù_·rsšg
:

312 
nv
 = 
Çme_v®ue
.
¥l™
('=', 1)

313 
Ën
(
nv
) != 2:

314 
¡riù_·rsšg
:

315 
¿i£
 
V®ueE¼Ü
("bad qu”y f›ld: %r" % (
Çme_v®ue
,))

316 #HªdË 
of
 
a
 
cÚŒŞ
-
Çme
 
w™h
 
no
 
equ®
 
sign


317 
	gk“p_bÏnk_v®ues
:

318 
nv
.
­³nd
('')

321 
	$Ën
(
nv
[1]è
Ü
 
k“p_bÏnk_v®ues
:

322 
Çme
 = 
	$unquÙe_qs
(
nv
[0], 
’codšg
)

323 
v®ue
 = 
	$unquÙe_qs
(
nv
[1], 
’codšg
)

324 
Çme
 
š
 
d
:

325 
nÙ
 
	$isš¡ªû
(
d
[
Çme
], 
li¡
):

326 
d
[
Çme
] = [d[name]]

327 
d
[
Çme
].
	$­³nd
(
v®ue
)

329 
d
[
Çme
] = 
v®ue


330  
d


333 
image_m­_·‰”n
 = 
»
.
	`compe
(
r
"[0-9]+,[0-9]+")

335 
def
 
	`·r£_qu”y_¡ršg
(
qu”y_¡ršg
, 
k“p_bÏnk_v®ues
=
True
, 
’codšg
='utf-8'):

338 
Du¶iÿ‹
 
key
/
v®ue
 
·œs
 
š
 
the
 
´ovided
 
qu”y_¡ršg
 
wl
 
be


339 
»tuºed
 
as
 {'key': [
v®1
, 
v®2
, ...]
	}
}. 
SšgË
 
key
/
v®ues
 
wl


340 
be
 
»tuºed
 
as
 
¡ršgs
: {'key': 'value'}.

342 
image_m­_·‰”n
.
	$m©ch
(
qu”y_¡ršg
):

343 #S”v”-
side
 
image
 
m­
. 
M­
 
the
 
coÜds
 
to
 'x' 
ªd
 'y'

344 #(
like
 
CGI
::
Reque¡
 
dÛs
).

345 
pm
 = 
qu”y_¡ršg
.
	`¥l™
(",")

346 
pm
 = {'x': Õm[0]), 'y': Õm[1])
	}
}

348 
pm
 = 
	$_·r£_qs
(
qu”y_¡ršg
, 
k“p_bÏnk_v®ues
, 
’codšg
=encoding)

349  
pm


352 
şass
 
	$Ca£In£ns™iveDiù
(
diù
):

355 
Each
 
key
 
is
 
chªged
 
Ú
 
’Œy
 
to
 
	`¡r
(key).
	`t™Ë
().

358 
def
 
	$__g‘™em__
(
£lf
, 
key
):

359  
diù
.
	`__g‘™em__
(
£lf
, 
	`¡r
(
key
).
	$t™Ë
())

361 
def
 
	$__£t™em__
(
£lf
, 
key
, 
v®ue
):

362 
diù
.
	`__£t™em__
(
£lf
, 
	`¡r
(
key
).
	`t™Ë
(), 
v®ue
)

364 
def
 
	$__d–™em__
(
£lf
, 
key
):

365 
diù
.
	`__d–™em__
(
£lf
, 
	`¡r
(
key
).
	$t™Ë
())

367 
def
 
	$__cÚšs__
(
£lf
, 
key
):

368  
diù
.
	`__cÚšs__
(
£lf
, 
	`¡r
(
key
).
	$t™Ë
())

370 
def
 
	$g‘
(
£lf
, 
key
, =
NÚe
):

371  
diù
.
	`g‘
(
£lf
, 
	`¡r
(
key
).
	`t™Ë
(), )

373 
	`ha§‰r
({
	}
}, 'has_key'):

374 
def
 
	$has_key
(
£lf
, 
key
):

375  
diù
.
	`has_key
(
£lf
, 
	`¡r
(
key
).
	$t™Ë
())

377 
def
 
	$upd©e
(
£lf
, 
E
):

378 
k
 
š
 
E
.
	$keys
():

379 
£lf
[
	`¡r
(
k
).
	`t™Ë
()] = 
E
[k]

381 
def
 
	$äomkeys
(
şs
, 
£q
, 
v®ue
=
NÚe
):

382 
Ãwdiù
 = 
	$şs
()

383 
k
 
š
 
£q
:

384 
Ãwdiù
[
	`¡r
(
k
).
	`t™Ë
()] = 
v®ue


385  
Ãwdiù


386 
äomkeys
 = 
	$şassm‘hod
(
äomkeys
)

388 
def
 
	$£tdeçuÉ
(
£lf
, 
key
, 
x
=
NÚe
):

389 
key
 = 
	`¡r
(key).
	$t™Ë
()

390 
Œy
:

391  
£lf
[
key
]

392 
exû±
 
KeyE¼Ü
:

393 
£lf
[
key
] = 
x


394  
x


396 
def
 
	$pİ
(
£lf
, 
key
, ):

397  
diù
.
	`pİ
(
£lf
, 
	`¡r
(
key
).
	`t™Ë
(), )

400 #TEXT = <
ªy
 
OCTET
 
exû±
 
CTLs
, 
but
 
šşudšg
 
LWS
>

401 #
#A 
CRLF
 
is
 
®lowed
 
š
 
the
 
defš™iÚ
 
of
 
TEXT
 
Úly
 
as
 
·¹
 oà
a
 
h—d”


402 #f›ld 
cÚtšu©iÚ
. 
It
 
is
 
ex³ùed
 
th©
 
the
 
fŞdšg
 
LWS
 
wl
 
be


403 #»¶aûd 
w™h
 
a
 
sšgË
 
SP
 
befÜe
 
š‹½»tiÚ
 
of
 
the
 
TEXT
 
v®ue
."

404 
Çtive¡r
 =ğ
by‹¡r
:

405 
h—d”_Œª¦©e_bË
 = ''.
	`još
([
	$chr
(
i
è˜
š
 
	`x¿nge
(256)])

406 
h—d”_Œª¦©e_d–‘ech¬s
 = ''.
	`još
([
	$chr
(
i
è˜
š
 
	`x¿nge
(32)]è+ 
	$chr
(127)

408 
h—d”_Œª¦©e_bË
 = 
NÚe


409 
h—d”_Œª¦©e_d–‘ech¬s
 = 
	`by‹s
(
	`¿nge
(32)è+ 
	$by‹s
([127])

412 
şass
 
	$H—d”M­
(
Ca£In£ns™iveDiù
):

415 
Each
 
key
 
is
 
chªged
 
Ú
 
’Œy
 
to
 
	`¡r
(key).
	`t™Ë
(). 
This
 
®lows
 
h—d”s


416 
to
 
be
 -
š£ns™ive
 
ªd
 
avoid
 
du¶iÿ‹s
.

418 
V®ues
 
¬e
 
h—d”
 
	`v®ues
 (
decoded
 
accÜdšg
 
to
 :
rfc
:`2047` 
Ãûs§ry
).

421 
´ÙocŞ
=(1, 1)

422 
’codšgs
 = ["ISO-8859-1"]

424 #Someday, 
wh’
 
h‰p
-
bis
 
is
 
dÚe
, 
this
 
wl
 
´obably
 
g‘
 
drİ³d


425 #sšû 
ãw
 
£rv”s
, 
ş›Ás
, 
Ü
 
š‹rmedŸr›s
 dØ
™
. 
But
 
uÁ
 
th’
,

427 #"
WÜds
 
of
 *
TEXT
 
MAY
 
cÚš
 
ch¬aù”s
 
äom
 
ch¬aù”
 
£ts
 
Ùh”
 
thª


428 #ISO-8859-1 
Úly
 
wh’
 
’coded
 
accÜdšg
 
to
 
the
 
ruËs
 
of
 
RFC
 2047."

429 
u£_rfc_2047
 = 
True


431 
def
 
	$–em’ts
(
£lf
, 
key
):

433 
key
 = 
	`¡r
(key).
	$t™Ë
()

434 
v®ue
 = 
£lf
.
	$g‘
(
key
)

435  
	$h—d”_–em’ts
(
key
, 
v®ue
)

437 
def
 
	$v®ues
(
£lf
, 
key
):

439  [
e
.
v®ue
 
š
 
£lf
.
	`–em’ts
(
key
)]

441 
def
 
	$ouut
(
£lf
):

443  
	`li¡
(
£lf
.
	`’code_h—d”_™ems
(£lf.
	$™ems
()))

445 
def
 
	$’code_h—d”_™ems
(
şs
, 
h—d”_™ems
):

447 
P»·»
 
the
 
£qu’û
 
of
 
Çme
, 
v®ue
 
tu¶es
 
što
 
a
 
fÜm
 
su™abË
 

448 
Œªsm™tšg
 
Ú
 
the
 
wœe
 
HTTP
.

450 
k
, 
v
 
š
 
h—d”_™ems
:

451 
	$isš¡ªû
(
k
, 
unicode¡r
):

452 
k
 = 
şs
.
	$’code
(
k
)

454 
nÙ
 
	$isš¡ªû
(
v
, 
ba£¡ršg
):

455 
v
 = 
	$¡r
(
v
)

457 
	$isš¡ªû
(
v
, 
unicode¡r
):

458 
v
 = 
şs
.
	$’code
(
v
)

460 #S“ 
h—d”_Œª¦©e_
* 
cÚ¡ªts
 
above
.

461 #R•Ïû 
Úly
 
you
 
»®ly
 
know
 
wh©
 you're doing.

462 
k
 = k.
	$Œª¦©e
(
h—d”_Œª¦©e_bË
, 
h—d”_Œª¦©e_d–‘ech¬s
)

463 
v
 = v.
	$Œª¦©e
(
h—d”_Œª¦©e_bË
, 
h—d”_Œª¦©e_d–‘ech¬s
)

465 
	$y›ld
 (
k
, 
v
)

466 
’code_h—d”_™ems
 = 
	$şassm‘hod
(
’code_h—d”_™ems
)

468 
def
 
	$’code
(
şs
, 
v
):

470 
’c
 
š
 
şs
.
’codšgs
:

471 
Œy
:

472  
v
.
	$’code
(
’c
)

473 
exû±
 
UnicodeEncodeE¼Ü
:

476 
şs
.
´ÙocŞ
 =ğ(1, 1è
ªd
 cls.
u£_rfc_2047
:

477 #Encod
RFC
-2047 
TEXT


478 #(
e
.
g
. 
u
"\u8200" -> "=?utf-8?b?6IiA?=").

479 #WdØ
our
 
own
 
h”e
 
š¡—d
 
of
 
usšg
 
the
 
ema
 
moduË


480 #beÿu£ 
we
 
Ãv”
 
wªt
 
to
 
fŞd
 
lšes
--
fŞdšg
 
has


481 #b“À
d•»ÿ‹d
 
by
 
the
 
HTTP
 
wÜkšg
 
group
.

482 
v
 = 
	`b2a_ba£64
(v.
	`’code
('utf-8'))

483  (
	`Áob
('=?utf-8?b?'è+ 
v
.
	`¡r
(ntob('\n')) +‚tob('?='))

485 
¿i£
 
	`V®ueE¼Ü
("Could‚otƒncode header…art %r using "

487 (
v
, 
şs
.
’codšgs
))

488 
’code
 = 
	$şassm‘hod
(
’code
)

490 
şass
 
	$Ho¡
(
objeù
):

493 
Çme


494 
Should
 
be
 
the
 
ş›Á
's host‚ame. If‚ot‡vailable (because‚o DNS

495 
lookup
 
is
 
³rfÜmed
), 
the
 
IP
 
add»ss
 
should
 
be
 
u£d
 
š¡—d
.

499 

 = "0.0.0.0"

500 
pÜt
 = 80

501 
Çme
 = "unknown.tld"

503 
def
 
	$__š™__
(
£lf
, 

, 
pÜt
, 
Çme
=
NÚe
):

504 
£lf
.

 = ip

505 
£lf
.
pÜt
 =…ort

506 
Çme
 
is
 
NÚe
:

507 
Çme
 = 



508 
£lf
.
Çme
 =‚ame

510 
def
 
	$__»´__
(
£lf
):

511  "h‰put.Ho¡(%r, %r, %r)" % (
£lf
.

, s–f.
pÜt
, s–f.
Çme
)

	@trunk/objs/CherryPy-3.2.4/cherrypy/lib/jsontools.py

1 
impÜt
 
sys


2 
impÜt
 
ch”rypy


3 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
	gba£¡ršg
, 
	gÁou
, 
	gjsÚ
, 
	gjsÚ_’code
, 
jsÚ_decode


5 
def
 
	$jsÚ_´oûssÜ
(
’t™y
):

7 
nÙ
 
’t™y
.
h—d”s
.
	`g‘
(
	`Áou
("Content-Length"),‚tou("")):

8 
¿i£
 
ch”rypy
.
	$HTTPE¼Ü
(411)

10 
body
 = 
’t™y
.
å
.
	$»ad
()

11 
Œy
:

12 
ch”rypy
.
£rvšg
.
»que¡
.
jsÚ
 = 
	`jsÚ_decode
(
body
.
	`decode
('utf-8'))

13 
exû±
 
V®ueE¼Ü
:

14 
¿i£
 
ch”rypy
.
	`HTTPE¼Ü
(400, 'Invalid JSON document')

16 
def
 
	`jsÚ_š
(
cÚ‹Á_ty³
=[
	`Áou
('application/json'),‚tou('text/javascript')],

17 
fÜû
=
True
, 
debug
=
F®£
, 
´oûssÜ
 = 
jsÚ_´oûssÜ
):

19 
The
  
´oûssÜ
 
¶aûs
 
the
 
·r£d
 
d©a
 
što
 
»que¡
.
jsÚ
.

21 
Incomšg
 
»que¡
 
’t™›s
 
which
 
m©ch
 
the
 
giv’
 
	$cÚ‹Á_ty³
(
s
è
wl


22 
be
 
de£rŸlized
 
äom
 
JSON
 
to
 
the
 
PythÚ
 
equiv®’t
, 
ªd
h
»suÉ


23 
¡Üed
 
©
 
ch”rypy
.
»que¡
.
jsÚ
. 
The
 'cÚ‹Á_ty³' 
¬gum’t
 
may


24 
be
 
a
 
CÚ‹Á
-
Ty³
 
¡ršg
 
Ü
‡ 
li¡
 
of
 
®lowabË
 CÚ‹Á-Ty³ 
¡ršgs
.

26 
If
 
the
 'fÜû' 
¬gum’t
 
is
 
	`True
 (th), 
th’
 
’t™›s
 
of
 
Ùh”


27 
cÚ‹Á
 
ty³s
 
wl
 
nÙ
 
be
 
®lowed
; "415 UnsuµÜ‹d MedŸ Ty³" 
is


28 
¿i£d
 
š¡—d
.

30 
Suµly
 
your
 
own
 
´oûssÜ
 
to
 
u£
 
a
 
cu¡om
 
decod”
, 
Ü
Ø
hªdË
 
the
 
·r£d


31 
d©a
 
difã»Ály
. 
The
 
´oûssÜ
 
ÿn
 
be
 
cÚfigu»d
 
vŸ


32 
toŞs
.
jsÚ_š
.
´oûssÜ
 
Ü
 
vŸ
 
the
 
decÜ©Ü
 
m‘hod
.

34 
NÙe
 
th©
 
the
 
de£rŸliz”
 
»quœes
h
ş›Á
 
£nd
 
a
 
CÚ‹Á
-
L’gth


35 
»que¡
 
h—d”
, 
Ü
 
™
 
wl
 
¿i£
 "411 L’gth Requœed". 
If
 
ªy


36 
Ùh”
 
»asÚ
 
the
 
»que¡
 
’t™y
 
ÿÂÙ
 
be
 
de£rŸlized
 
äom
 
JSON
,

37 
™
 
wl
 
¿i£
 "400 Bad Request: Invalid JSON document".

39 
You
 
mu¡
 
be
 
usšg
 
PythÚ
 2.6 
Ü
 
g»©”
, o¸
have
 
the
 'simplejson'

40 
·ckage
 
impÜbË
; 
Ùh”wi£
, 
V®ueE¼Ü
 
is
 
¿i£d
 
duršg
 
´oûssšg
.

42 
»que¡
 = 
ch”rypy
.
£rvšg
.request

43 
	$isš¡ªû
(
cÚ‹Á_ty³
, 
ba£¡ršg
):

44 
cÚ‹Á_ty³
 = [content_type]

46 
fÜû
:

47 
debug
:

48 
ch”rypy
.
	`log
('Removing body…rocessors %s' %

49 
	`»´
(
»que¡
.
body
.
´oûssÜs
.
	`keys
()), 'TOOLS.JSON_IN')

50 
»que¡
.
body
.
´oûssÜs
.
	$ş—r
()

51 
»que¡
.
body
.
deçuÉ_´oc
 = 
ch”rypy
.
	`HTTPE¼Ü
(

53 ', '.
	$još
(
cÚ‹Á_ty³
))

55 
ù
 
š
 
cÚ‹Á_ty³
:

56 
debug
:

57 
ch”rypy
.
	`log
('Addšg body…roûssÜ fÜ %s' % 
ù
, 'TOOLS.JSON_IN')

58 
»que¡
.
body
.
´oûssÜs
[
ù
] = 
´oûssÜ


60 
def
 
	$jsÚ_hªdËr
(*
¬gs
, **
kw¬gs
):

61 
v®ue
 = 
ch”rypy
.
£rvšg
.
»que¡
.
	$_jsÚ_šÃr_hªdËr
(*
¬gs
, **
kw¬gs
)

62  
	$jsÚ_’code
(
v®ue
)

64 
def
 
	`jsÚ_out
(
cÚ‹Á_ty³
='­¶iÿtiÚ/jsÚ', 
debug
=
F®£
, 
hªdËr
=
jsÚ_hªdËr
):

67 
If
 
the
 
giv’
 
cÚ‹Á_ty³
 
is
 
NÚe
,h
CÚ‹Á
-
Ty³
 
»¥Ú£
 
h—d”


68 
is
 
nÙ
 
£t
.

70 
Provide
 
your
 
own
 
hªdËr
 
to
 
u£
 
a
 
cu¡om
 
’cod”
. 
FÜ
 
exam¶e


71 
ch”rypy
.
cÚfig
['toŞs.jsÚ_out.hªdËr'] = <
funùiÚ
>, 
Ü


72 @
	`jsÚ_out
(
hªdËr
=
funùiÚ
).

74 
You
 
mu¡
 
be
 
usšg
 
PythÚ
 2.6 
Ü
 
g»©”
, o¸
have
 
the
 'simplejson'

75 
·ckage
 
impÜbË
; 
Ùh”wi£
, 
V®ueE¼Ü
 
is
 
¿i£d
 
duršg
 
´oûssšg
.

77 
»que¡
 = 
ch”rypy
.
£rvšg
.request

78 
debug
:

79 
ch”rypy
.
	`log
('R•Ïcšg % w™h JSON hªdËr' % 
»que¡
.
hªdËr
,

81 
»que¡
.
_jsÚ_šÃr_hªdËr
 =„eque¡.
hªdËr


82 
»que¡
.
hªdËr
 = handler

83 
cÚ‹Á_ty³
 
is
 
nÙ
 
NÚe
:

84 
debug
:

85 
ch”rypy
.
	`log
('S‘tšg CÚ‹Á-Ty³Ø%s' % 
cÚ‹Á_ty³
, 'TOOLS.JSON_OUT')

86 
ch”rypy
.
£rvšg
.
»¥Ú£
.
h—d”s
['CÚ‹Á-Ty³'] = 
cÚ‹Á_ty³


	@trunk/objs/CherryPy-3.2.4/cherrypy/lib/profiler.py

3 
Ch”ryPy
 
	gu£rs


6 
You
 
ÿn
 
´ofe
 
ªy
 
of
 
your
 
·ges
 
as
 
fŞlows
::

8 
äom
 
ch”rypy
.
lib
 
impÜt
 
´of”


10 
şass
 
RoÙ
:

11 
p
 = 
´ofe
.
Prof”
("/path/to/profile/dir")

13 
def
 
	$šdex
(
£lf
):

14 
£lf
.
p
.
	$run
(
£lf
.
_šdex
)

15 
šdex
.
expo£d
 = 
True


17 
def
 
	$_šdex
(
£lf
):

20 
ch”rypy
.
Œ“
.
	`mouÁ
(
	$RoÙ
())

22 
You
 
ÿn
 
®so
 
tuº
 
Ú
 
´ofšg
 
®l
 
»que¡s


23 
usšg
 
the
 ``
make_­p
`` 
funùiÚ
 
as
 
WSGI
 
middËw¬e
.

25 
Ch”ryPy
 
dev–İ”s


28 
This
 
moduË
 
ÿn
 
be
 
u£d
 
wh’ev”
 
you
 
make
 
chªges
 
to
 
Ch”ryPy
,

29 
to
 
g‘
 
a
 
quick
 
§n™y
-
check
 
Ú
 
ov”®l
 
CP
 
³rfÜmªû
. 
U£
 
the


30 ``--
´ofe
`` 
æag
 
wh’
 
ruÂšg
 
the
 
‹¡
 
su™e
. 
Th’
, 
u£
h``
	`£rve
()``

31 
funùiÚ
 
to
 
brow£
 
the
 
»suÉs
 
š
 
a
 
web
 
brow£r
. 
If
 
you
 
run
 
this


32 
moduË
 
äom
 
the
 
commªd
 
lše
, 
™
 
wl
 
ÿÎ
 ``
	`£rve
()`` 
you
.

37 
def
 
	$Ãw_func_¡r_·th
(
func_Çme
):

39 
f’ame
, 
lše
, 
Çme
 = 
func_Çme


40 
f’ame
.
	`’dsw™h
("__init__.py"):

41  
os
.
·th
.
	`ba£Çme
(
f’ame
[:-12]è+ f’ame[-12:], 
lše
, 
Çme


42  
os
.
·th
.
	`ba£Çme
(
f’ame
), 
lše
, 
Çme


44 
Œy
:

45 
impÜt
 
´ofe


46 
impÜt
 
p¡©s


47 
p¡©s
.
func_¡r_·th
 = 
Ãw_func_¡r_·th


48 
exû±
 
ImpÜtE¼Ü
:

49 
´ofe
 = 
NÚe


50 
p¡©s
 = 
NÚe


52 
impÜt
 
os
, os.
·th


53 
impÜt
 
sys


54 
impÜt
 
w¬nšgs


56 
äom
 
ch”rypy
.
_ıcom·t
 
impÜt
 
By‹sIO


58 
_couÁ
 = 0

60 
şass
 
	$Prof”
(
objeù
):

62 
def
 
	$__š™__
(
£lf
, 
·th
=
NÚe
):

63 
nÙ
 
·th
:

64 
·th
 = 
os
.·th.
	`još
(os.·th.
	`dœÇme
(
__fe__
), "profile")

65 
£lf
.
·th
 =…ath

66 
nÙ
 
os
.
·th
.
	$exi¡s
(
·th
):

67 
os
.
	$makedœs
(
·th
)

69 
def
 
	$run
(
£lf
, 
func
, *
¬gs
, **
·¿ms
):

71 
glob®
 
_couÁ


72 
c
 = 
_couÁ
 = _count + 1

73 
·th
 = 
os
.·th.
	`još
(
£lf
.·th, "ı_%04d.´of" % 
c
)

74 
´of
 = 
´ofe
.
	$Profe
()

75 
»suÉ
 = 
´of
.
	$runÿÎ
(
func
, *
¬gs
, **
·¿ms
)

76 
´of
.
	$dump_¡©s
(
·th
)

77  
»suÉ


79 
def
 
	$¡©fes
(
£lf
):

82  [
f
 à
š
 
os
.
	$li¡dœ
(
£lf
.
·th
)

83 
f
.
	`¡¬tsw™h
("ı_"è
ªd
 f.
	`’dsw™h
(".prof")]

85 
def
 
	`¡©s
(
£lf
, 
f’ame
, 
sÜtby
='cumulative'):

88 
sio
 = 
	$By‹sIO
()

89 
sys
.
v”siÚ_šfo
 >= (2, 5):

90 
s
 = 
p¡©s
.
	`Sts
(
os
.
·th
.
	`još
(
£lf
.·th, 
f’ame
), 
¡»am
=
sio
)

91 
s
.
	$¡r_dœs
()

92 
s
.
	$sÜt_¡©s
(
sÜtby
)

93 
s
.
	$´št_¡©s
()

95 #p¡©s.
Sts
 
befÜe
 
PythÚ
 2.5 
didn
'ˆk¨'
¡»am
'‡rg,

96 #buˆ
ju¡
 
´š‹d
 
to
 
¡dout
. 
So
 
»
-
rou‹
 stdout.

97 
s
 = 
p¡©s
.
	`Sts
(
os
.
·th
.
	$još
(
£lf
.
·th
, 
f’ame
))

98 
s
.
	$¡r_dœs
()

99 
s
.
	$sÜt_¡©s
(
sÜtby
)

100 
Şdout
 = 
sys
.
¡dout


101 
Œy
:

102 
sys
.
¡dout
 = 
sio


103 
s
.
	$´št_¡©s
()

104 
fš®ly
:

105 
sys
.
¡dout
 = 
Şdout


106 
»¥Ú£
 = 
sio
.
	$g‘v®ue
()

107 
sio
.
	$şo£
()

108  
»¥Ú£


110 
def
 
	$šdex
(
£lf
):

112 <
h—d
><
t™Ë
>
Ch”ryPy
 
´ofe
 
d©a
</title></head>

113 <
äame£t
 
cŞs
='200, 1*'>

114 <
äame
 
¤c
='menu' />

115 <
äame
 
Çme
='maš' 
¤c
='' />

116 </
äame£t
>

117 </
html
>

119 
šdex
.
expo£d
 = 
True


121 
def
 
	$m’u
(
£lf
):

122 
y›ld
 "<h2>Profiling„uns</h2>"

123 
y›ld
 "<p>Click on one ofhe„uns belowo see…rofiling data.</p>"

124 
runs
 = 
£lf
.
	$¡©fes
()

125 
runs
.
	$sÜt
()

126 
i
 
š
 
runs
:

127 
y›ld
 "<¨h»f='»pÜt?f’ame=%s'¬g‘='maš'>%s</a><b¸/>" % (
i
, i)

128 
m’u
.
expo£d
 = 
True


130 
def
 
	$»pÜt
(
£lf
, 
f’ame
):

131 
impÜt
 
ch”rypy


132 
ch”rypy
.
»¥Ú£
.
h—d”s
['Content-Type'] = 'text/plain'

133  
£lf
.
	$¡©s
(
f’ame
)

134 
»pÜt
.
expo£d
 = 
True


137 
şass
 
	$ProfeAgg»g©Ü
(
Prof”
):

139 
def
 
	$__š™__
(
£lf
, 
·th
=
NÚe
):

140 
Prof”
.
	$__š™__
(
£lf
, 
·th
)

141 
glob®
 
_couÁ


142 
£lf
.
couÁ
 = 
_couÁ
 = _count + 1

143 
£lf
.
´of”
 = 
´ofe
.
	$Profe
()

145 
def
 
	$run
(
£lf
, 
func
, *
¬gs
):

146 
·th
 = 
os
.·th.
	`još
(
£lf
.·th, "ı_%04d.´of" % s–f.
couÁ
)

147 
»suÉ
 = 
£lf
.
´of”
.
	$runÿÎ
(
func
, *
¬gs
)

148 
£lf
.
´of”
.
	$dump_¡©s
(
·th
)

149  
»suÉ


152 
şass
 
make_­p
:

153 
def
 
	$__š™__
(
£lf
, 
Ãxµ
, 
·th
=
NÚe
, 
agg»g©e
=
F®£
):

156 
Ãxµ


157 
the
 
WSGI
 
­¶iÿtiÚ
 
to
 
w¿p
, 
usu®ly
 
ª
 
š¡ªû
 
of


158 
ch”rypy
.
AµliÿtiÚ
.

160 
·th


161 
wh”e
 
to
 
dump
 
the
 
´ofšg
 
ouut
.

163 
agg»g©e


164 
True
, 
´ofe
 
d©a
 
®l
 
HTTP
 
»que¡s
 
wl
 
go
 
š


165 
a
 
sšgË
 
fe
. 
If
 
	`F®£
 (
the
 ), 
—ch
 
HTTP
 
»que¡
 
wl


166 
dump
 
™s
 
´ofe
 
d©a
 
što
 
a
 
£·¿‹
 
fe
.

169 
´ofe
 
is
 
NÚe
 
Ü
 
p¡©s
 is None:

170 
msg
 = ("Your installation of Python does‚ot have‡…rofile module. "

173 
w¬nšgs
.
	$w¬n
(
msg
)

175 
£lf
.
Ãxµ
 =‚extapp

176 
£lf
.
agg»g©e
 =‡ggregate

177 
agg»g©e
:

178 
£lf
.
´of”
 = 
	$ProfeAgg»g©Ü
(
·th
)

180 
£lf
.
´of”
 = 
	$Prof”
(
·th
)

182 
def
 
	$__ÿÎ__
(
£lf
, 
’vœÚ
, 
¡¬t_»¥Ú£
):

183 
def
 
	$g©h”
():

184 
»suÉ
 = []

185 
lše
 
š
 
£lf
.
	$Ãxµ
(
’vœÚ
, 
¡¬t_»¥Ú£
):

186 
»suÉ
.
	$­³nd
(
lše
)

187  
»suÉ


188  
£lf
.
´of”
.
	$run
(
g©h”
)

191 
def
 
	$£rve
(
·th
=
NÚe
, 
pÜt
=8080):

192 
´ofe
 
is
 
NÚe
 
Ü
 
p¡©s
 is None:

193 
msg
 = ("Your installation of Python does‚ot have‡…rofile module. "

196 
w¬nšgs
.
	$w¬n
(
msg
)

198 
impÜt
 
ch”rypy


199 
ch”rypy
.
cÚfig
.
	`upd©e
({'£rv”.sock‘_pÜt': (
pÜt
),

202 
	}
})

203 
ch”rypy
.
quick¡¬t
(
	$Prof”
(
·th
))

206 
__Çme__
 == "__main__":

207 
	`£rve
(*
	`tu¶e
(
sys
.
¬gv
[1:]))

	@trunk/objs/CherryPy-3.2.4/cherrypy/lib/reprconf.py

3 
CÚfigu¿tiÚ
 
d©a
 
may
 
be
 
suµl›d
 
as
 
a
 
PythÚ
 
	gdiùiÚ¬y
,‡ ¨
	gf’ame
,

4 
Ü
 
as
 
ª
 
İ’
 
fe
 
	gobjeù
. 
Wh’
 
you
 
suµly
 
a
 
f’ame
 o¸
	gfe
, 
	gPythÚ
's

5 
butš
 
CÚfigP¬£r
 
is
 
u£d
 (
w™h
 
some
 
ex‹nsiÚs
).

7 
	gName¥aûs


10 
CÚfigu¿tiÚ
 
keys
 
¬e
 
£·¿‹d
 
što
 
Çme¥aûs
 
by
 
the
 
	gfœ¡
 "." 
š
h
	gkey
.

12 
The
 
Úly
 
key
 
th©
 
ÿÂÙ
 
exi¡
 
š
 
a
 
Çme¥aû
 
is
 
	gthe
 "’vœÚm’t" 
	g’Œy
.

13 
This
 
¥ecŸl
 
	g’Œy
 'impÜts' 
Ùh”
 
cÚfig
 
’Œ›s
 
äom
 
a
 
‹m¶©e
 
¡Üed
 
š


14 
the
 
	gCÚfig
.
’vœÚm’ts
 
	gdiù
.

16 
You
 
ÿn
 
defše
 
your
 
own
 
Çme¥aûs
 
to
 
be
 
ÿÎed
 
wh’
 
Ãw
 
cÚfig
 
is
 
m”ged


17 
by
 
addšg
 
a
 
Çmed
 
hªdËr
 
to
 
	gCÚfig
.
	gÇme¥aûs
. 
The
 
Çme
 
ÿn
 
be
 
ªy
 
	g¡ršg
,

18 
ªd
 
the
 
hªdËr
 
mu¡
 
be
 
e™h”
 
a
 
ÿÎabË
 
Ü
‡ 
cÚ‹xt
 
	gmªag”
.

21 
	gŒy
:

23 
äom
 
cÚfig·r£r
 
impÜt
 
CÚfigP¬£r


24 
exû±
 
ImpÜtE¼Ü
:

25 
äom
 
CÚfigP¬£r
 
impÜt
 ConfigParser

27 
Œy
:

28 
£t


29 
exû±
 
NameE¼Ü
:

30 
äom
 
£ts
 
impÜt
 
S‘
 
as
 
£t


32 
Œy
:

33 
ba£¡ršg


34 
exû±
 
NameE¼Ü
:

35 
ba£¡ršg
 = 
¡r


37 
Œy
:

39 
impÜt
 
butšs


40 
exû±
 
ImpÜtE¼Ü
:

42 
impÜt
 
__butš__
 
as
 
butšs


44 
impÜt
 
İ”©Ü
 
as
 
_İ”©Ü


45 
impÜt
 
sys


47 
def
 
	$as_diù
(
cÚfig
):

49 
	$isš¡ªû
(
cÚfig
, 
ba£¡ršg
):

50 
cÚfig
 = 
	`P¬£r
().
	$diù_äom_fe
(
cÚfig
)

51 
–if
 
	`ha§‰r
(
cÚfig
, 'read'):

52 
cÚfig
 = 
	`P¬£r
().
	$diù_äom_fe
(
cÚfig
)

53  
cÚfig


56 
şass
 
	$Name¥aûS‘
(
diù
):

59 
Each
 
cÚfig
 
’Œy
 
should
 
begš
 
w™h
 
a
 
Çme¥aû
 
Çme
; 
the
 
cÜ»¥Údšg


60 
Çme¥aû
 
hªdËr
 
wl
 
be
 
ÿÎed
 
Úû
 
—ch
 
cÚfig
 
’Œy
 
š
 
th©


61 
Çme¥aû
, 
ªd
 
wl
 
be
 
·s£d
 
two
 
¬gum’ts
: 
the
 
cÚfig
 
	$key
 (
w™h
 
the


62 
Çme¥aû
 
»moved
è
ªd
 
the
 
cÚfig
 
v®ue
.

64 
Name¥aû
 
hªdËrs
 
may
 
be
 
ªy
 
PythÚ
 
ÿÎabË
; 
they
 may 
®so
 be

65 
PythÚ
 2.5-
¡yË
 'cÚ‹xˆmªag”s', 
š
 
which
 
theœ
 
__’‹r__


66 
m‘hod
 
should
  
a
 
ÿÎabË
 
to
 
be
 
u£d
 
as
 
the
 
hªdËr
.

67 
S“
 
ch”rypy
.
	$toŞs
 (
the
 
ToŞbox
 
şass
è
ª
 
exam¶e
.

70 
def
 
	$__ÿÎ__
(
£lf
, 
cÚfig
):

73 
cÚfig


74 
A
 
æ©
 
diù
, 
wh”e
 
keys
 
u£
 
dÙs
 
to
 
£·¿‹


75 
Çme¥aûs
, 
ªd
 
v®ues
 
¬e
 
¬b™¿ry
.

77 
The
 
fœ¡
 
Çme
 
š
 
—ch
 
cÚfig
 
key
 
is
 
u£d
 
to
 
look
 
up
 
the
 
cÜ»¥Údšg


78 
Çme¥aû
 
hªdËr
. 
FÜ
 
exam¶e
, 
a
 
cÚfig
 
’Œy
 
of
 {'toŞs.gz.Ú': 
v
}

79 
wl
 
ÿÎ
 
the
 'toŞs' 
Çme¥aû
 
hªdËr
 
w™h
h
¬gs
: ('gz.Ú', 
	gv
)

81 #S•¬©
the
 
giv’
 
cÚfig
 
što
 
Çme¥aûs


82 
	gns_cÚfs
 = {}

83 
k
 
š
 
cÚfig
:

84 "." 
š
 
k
:

85 
ns
, 
	gÇme
 = 
k
.
¥l™
(".", 1)

86 
	gbuck‘
 = 
ns_cÚfs
.
£tdeçuÉ
(
ns
, {})

87 
	gbuck‘
[
Çme
] = 
cÚfig
[
k
]

89 #I 
cho£
 
__’‹r__
 
ªd
 
__ex™__
 
so
 
someday
 
this
 
could
 
be


90 #»wr™‹À
usšg
 
PythÚ
 2.5' '
w™h
' statement:

91 #fÜ 
ns
, 
hªdËr
 
š
 
£lf
.
™”™ems
():

92 #w™h 
hªdËr
 
as
 
ÿÎabË
:

93 #fÜ 
k
, 
v
 
š
 
ns_cÚfs
.
g‘
(
ns
, {}).
™”™ems
():

94 #ÿÎabË(
k
, 
v
)

95 
	gns
, 
hªdËr
 
š
 
	g£lf
.
	$™ems
():

96 
ex™
 = 
	`g‘©Œ
(
hªdËr
, "__ex™__", 
NÚe
)

97 
ex™
:

98 
ÿÎabË
 = 
hªdËr
.
	$__’‹r__
()

99 
no_exc
 = 
True


100 
Œy
:

101 
Œy
:

102 
k
, 
v
 
š
 
ns_cÚfs
.
	`g‘
(
ns
, {
	}
}).
	$™ems
():

103 
	$ÿÎabË
(
k
, 
v
)

104 
exû±
:

105 #Th
exû±iÚ®
 
is
 
hªdËd
 
h”e


106 
no_exc
 = 
F®£


107 
ex™
 
is
 
NÚe
:

108 
¿i£


109 
nÙ
 
	`ex™
(*
sys
.
	$exc_šfo
()):

110 
¿i£


111 #Th
exû±iÚ
 
is
 
sw®lowed
 
	`ex™
(è
»tuºs
 
Œue


112 
fš®ly
:

113 #Th
nÜm®
 
ªd
 
nÚ
-
loÿl
-
ÿ£s
 
¬e
 
hªdËd
 
h”e


114 
no_exc
 
ªd
 
ex™
:

115 
	$ex™
(
NÚe
, None, None)

117 
k
, 
v
 
š
 
ns_cÚfs
.
	`g‘
(
ns
, {
	}
}).
	$™ems
():

118 
	$hªdËr
(
k
, 
v
)

120 
def
 
	$__»´__
(
£lf
):

121  "%s.%s(%s)" % (
£lf
.
__moduË__
, s–f.
__şass__
.
__Çme__
,

122 
diù
.
	$__»´__
(
£lf
))

124 
def
 
	$__cİy__
(
£lf
):

125 
Ãwobj
 = 
£lf
.
	$__şass__
()

126 
Ãwobj
.
	$upd©e
(
£lf
)

127  
Ãwobj


128 
cİy
 = 
__cİy__


131 
şass
 
	$CÚfig
(
diù
):

134 
May
 
ke
 
a
 
fe
, 
f’ame
, 
Ü
 
diù
.

137 
deçuÉs
 = {
	}
}

138 
’vœÚm’ts
 = {}

139 
Çme¥aûs
 = 
	$Name¥aûS‘
()

141 
def
 
	$__š™__
(
£lf
, 
fe
=
NÚe
, **
kw¬gs
):

142 
£lf
.
	$»£t
()

143 
fe
 
is
 
nÙ
 
NÚe
:

144 
£lf
.
	$upd©e
(
fe
)

145 
kw¬gs
:

146 
£lf
.
	$upd©e
(
kw¬gs
)

148 
def
 
	$»£t
(
£lf
):

150 
£lf
.
	$ş—r
()

151 
diù
.
	$upd©e
(
£lf
, s–f.
deçuÉs
)

153 
def
 
	$upd©e
(
£lf
, 
cÚfig
):

155 
	$isš¡ªû
(
cÚfig
, 
ba£¡ršg
):

157 
cÚfig
 = 
	`P¬£r
().
	$diù_äom_fe
(
cÚfig
)

158 
–if
 
	`ha§‰r
(
cÚfig
, 'read'):

159 #O³À
fe
 
objeù


160 
cÚfig
 = 
	`P¬£r
().
	$diù_äom_fe
(
cÚfig
)

162 
cÚfig
 = cÚfig.
	$cİy
()

163 
£lf
.
	$_­¶y
(
cÚfig
)

165 
def
 
	$_­¶y
(
£lf
, 
cÚfig
):

167 
which_’v
 = 
cÚfig
.
	`g‘
('environment')

168 
which_’v
:

169 
’v
 = 
£lf
.
’vœÚm’ts
[
which_’v
]

170 
k
 
š
 
’v
:

171 
k
 
nÙ
 
š
 
cÚfig
:

172 
cÚfig
[
k
] = 
’v
[k]

174 
diù
.
	$upd©e
(
£lf
, 
cÚfig
)

175 
£lf
.
	$Çme¥aûs
(
cÚfig
)

177 
def
 
	$__£t™em__
(
£lf
, 
k
, 
v
):

178 
diù
.
	$__£t™em__
(
£lf
, 
k
, 
v
)

179 
£lf
.
	`Çme¥aûs
({
k
: 
v
})

182 
şass
 
	$P¬£r
(
CÚfigP¬£r
):

184 
¿i£s
 
ª
 
exû±iÚ
 
the
 
fe
 
ÿÂÙ
 
be
 
»ad
.

187 
def
 
	$İtiÚxfÜm
(
£lf
, 
İtiÚ¡r
):

188  
İtiÚ¡r


190 
def
 
	$»ad
(
£lf
, 
f’ames
):

191 
	$isš¡ªû
(
f’ames
, 
ba£¡ršg
):

192 
f’ames
 = [filenames]

193 
f’ame
 
š
 
f’ames
:

195 #å = 
	`İ’
(
f’ame
)

196 #exû± 
IOE¼Ü
:

198 
å
 = 
	$İ’
(
f’ame
)

199 
Œy
:

200 
£lf
.
	$_»ad
(
å
, 
f’ame
)

201 
fš®ly
:

202 
å
.
	$şo£
()

204 
def
 
	$as_diù
(
£lf
, 
¿w
=
F®£
, 
v¬s
=
NÚe
):

206 #Lßd 
INI
 
fe
 
što
 
a
 
diù


207 
»suÉ
 = {
	}
}

208 
£ùiÚ
 
š
 
£lf
.
	$£ùiÚs
():

209 
£ùiÚ
 
nÙ
 
š
 
»suÉ
:

210 
»suÉ
[
£ùiÚ
] = {
	}
}

211 
İtiÚ
 
š
 
£lf
.
	$İtiÚs
(
£ùiÚ
):

212 
v®ue
 = 
£lf
.
	$g‘
(
£ùiÚ
, 
İtiÚ
, 
¿w
ôaw, 
v¬s
=vars)

213 
Œy
:

214 
v®ue
 = 
	$uÄ•r
(
v®ue
)

215 
exû±
 
Exû±iÚ
:

216 
x
 = 
sys
.
	`exc_šfo
()[1]

217 
msg
 = ("Configƒrror in section: %r, option: %r, "

219 (
£ùiÚ
, 
İtiÚ
, 
v®ue
))

220 
¿i£
 
	$V®ueE¼Ü
(
msg
, 
x
.
__şass__
.
__Çme__
, x.
¬gs
)

221 
»suÉ
[
£ùiÚ
][
İtiÚ
] = 
v®ue


222  
»suÉ


224 
def
 
	$diù_äom_fe
(
£lf
, 
fe
):

225 
	`ha§‰r
(
fe
, 'read'):

226 
£lf
.
	$»adå
(
fe
)

228 
£lf
.
	$»ad
(
fe
)

229  
£lf
.
	$as_diù
()

232 #publiø
domaš
 "uÄ•r" 
im¶em’tiÚ
, 
found
 
Ú
 
the
 
web
 
ªd
 
th’
 
im´oved
.

235 
şass
 
_Bud”2
:

237 
def
 
	$bud
(
£lf
, 
o
):

238 
m
 = 
	`g‘©Œ
(
£lf
, 'bud_' + 
o
.
__şass__
.
__Çme__
, 
NÚe
)

239 
m
 
is
 
NÚe
:

240 
¿i£
 
	`Ty³E¼Ü
("unrepr does‚ot„ecognize %s" %

241 
	$»´
(
o
.
__şass__
.
__Çme__
))

242  
	$m
(
o
)

244 
def
 
	$a¡node
(
£lf
, 
s
):

246 
Œy
:

247 
impÜt
 
comp”


248 
exû±
 
ImpÜtE¼Ü
:

249 #F®lback 
to
 
ev®
 
wh’
 
comp”
 
·ckage
 
is
 
nÙ
 
avaabË
,

250 #e.
g
. 
IrÚPythÚ
 1.0.

251  
	$ev®
(
s
)

253 
p
 = 
comp”
.
	`·r£
("__‹mpv®ue__ = " + 
s
)

254  
p
.
	`g‘Chd»n
()[1].getChildren()[0].getChildren()[1]

256 
def
 
	$bud_Subsüt
(
£lf
, 
o
):

257 
ex´
, 
æags
, 
subs
 = 
o
.
	$g‘Chd»n
()

258 
ex´
 = 
£lf
.
	$bud
(
ex´
)

259 
subs
 = 
£lf
.
	$bud
(
subs
)

260  
ex´
[
subs
]

262 
def
 
	$bud_C®lFunc
(
£lf
, 
o
):

263 
chd»n
 = 
	`m­
(
£lf
.
bud
, 
o
.
	$g‘Chd»n
())

264 
ÿÎ“
 = 
chd»n
.
	$pİ
(0)

265 
kw¬gs
 = 
chd»n
.
	$pİ
(è
Ü
 {
	}
}

266 
¡¬¬gs
 = 
chd»n
.
	$pİ
(è
	$Ü
 ()

267 
¬gs
 = 
	`tu¶e
(
chd»n
è+ 
	$tu¶e
(
¡¬¬gs
)

268  
	$ÿÎ“
(*
¬gs
, **
kw¬gs
)

270 
def
 
	$bud_Li¡
(
£lf
, 
o
):

271  
	`m­
(
£lf
.
bud
, 
o
.
	$g‘Chd»n
())

273 
def
 
	$bud_CÚ¡
(
£lf
, 
o
):

274  
o
.
v®ue


276 
def
 
	$bud_Diù
(
£lf
, 
o
):

277 
d
 = {
	}
}

278 
i
 = 
™”
(
m­
(
£lf
.
bud
, 
o
.
	$g‘Chd»n
()))

279 
–
 
š
 
i
:

280 
d
[
–
] = 
i
.
	$Ãxt
()

281  
d


283 
def
 
	$bud_Tu¶e
(
£lf
, 
o
):

284  
	`tu¶e
(
£lf
.
	$bud_Li¡
(
o
))

286 
def
 
	$bud_Name
(
£lf
, 
o
):

287 
Çme
 = 
o
.name

288 
Çme
 == 'None':

289  
NÚe


290 
Çme
 == 'True':

291  
True


292 
Çme
 == 'False':

293  
F®£


295 #S“ 
the
 
Name
 
is
 
a
 
·ckage
 
Ü
 
moduË
. 
If
 
™
 is, 
impÜt
 it.

296 
Œy
:

297  
	$moduËs
(
Çme
)

298 
exû±
 
ImpÜtE¼Ü
:

299 
·ss


301 #S“ 
the
 
Name
 
is
 
š
 
butšs
.

302 
Œy
:

303  
	$g‘©Œ
(
butšs
, 
Çme
)

304 
exû±
 
A‰ribu‹E¼Ü
:

305 
·ss


307 
¿i£
 
	`Ty³E¼Ü
("uÄ•¸could‚Ù„esŞvthÇm%s" % 
	$»´
(
Çme
))

309 
def
 
	$bud_Add
(
£lf
, 
o
):

310 
Ëá
, 
right
 = 
	`m­
(
£lf
.
bud
, 
o
.
	$g‘Chd»n
())

311  
Ëá
 + 
right


313 
def
 
	$bud_Mul
(
£lf
, 
o
):

314 
Ëá
, 
right
 = 
	`m­
(
£lf
.
bud
, 
o
.
	$g‘Chd»n
())

315  
Ëá
 * 
right


317 
def
 
	$bud_G‘©Œ
(
£lf
, 
o
):

318 
·»Á
 = 
£lf
.
	$bud
(
o
.
ex´
)

319  
	$g‘©Œ
(
·»Á
, 
o
.
©ŒÇme
)

321 
def
 
	$bud_NÚeTy³
(
£lf
, 
o
):

322  
NÚe


324 
def
 
	$bud_UÇrySub
(
£lf
, 
o
):

325  -
£lf
.
	`bud
(
o
.
	`g‘Chd»n
()[0])

327 
def
 
	$bud_UÇryAdd
(
£lf
, 
o
):

328  
£lf
.
	`bud
(
o
.
	`g‘Chd»n
()[0])

331 
şass
 
_Bud”3
:

333 
def
 
	$bud
(
£lf
, 
o
):

334 
m
 = 
	`g‘©Œ
(
£lf
, 'bud_' + 
o
.
__şass__
.
__Çme__
, 
NÚe
)

335 
m
 
is
 
NÚe
:

336 
¿i£
 
	`Ty³E¼Ü
("unrepr does‚ot„ecognize %s" %

337 
	$»´
(
o
.
__şass__
.
__Çme__
))

338  
	$m
(
o
)

340 
def
 
	$a¡node
(
£lf
, 
s
):

342 
Œy
:

343 
impÜt
 
a¡


344 
exû±
 
ImpÜtE¼Ü
:

345 #F®lback 
to
 
ev®
 
wh’
 
a¡
 
·ckage
 
is
 
nÙ
 
avaabË
,

346 #e.
g
. 
IrÚPythÚ
 1.0.

347  
	$ev®
(
s
)

349 
p
 = 
a¡
.
	`·r£
("__‹mpv®ue__ = " + 
s
)

350  
p
.
body
[0].
v®ue


352 
def
 
	$bud_Subsüt
(
£lf
, 
o
):

353  
£lf
.
	`bud
(
o
.
v®ue
)[£lf.bud(o.
¦iû
)]

355 
def
 
	$bud_Index
(
£lf
, 
o
):

356  
£lf
.
	$bud
(
o
.
v®ue
)

358 
def
 
	$bud_C®l
(
£lf
, 
o
):

359 
ÿÎ“
 = 
£lf
.
	$bud
(
o
.
func
)

361 
o
.
¬gs
 
is
 
NÚe
:

362 
¬gs
 = ()

364 
¬gs
 = 
	`tu¶e
([
£lf
.
	$bud
(
a
è¨
š
 
o
.
¬gs
])

366 
o
.
¡¬¬gs
 
is
 
NÚe
:

367 
¡¬¬gs
 = ()

369 
¡¬¬gs
 = 
£lf
.
	$bud
(
o
.
¡¬¬gs
)

371 
o
.
kw¬gs
 
is
 
NÚe
:

372 
kw¬gs
 = {
	}
}

374 
kw¬gs
 = 
£lf
.
	$bud
(
o
.
kw¬gs
)

376  
	`ÿÎ“
(*(
¬gs
 + 
¡¬¬gs
), **
kw¬gs
)

378 
def
 
	$bud_Li¡
(
£lf
, 
o
):

379  
	`li¡
(
	$m­
(
£lf
.
bud
, 
o
.
–ts
))

381 
def
 
	$bud_SŒ
(
£lf
, 
o
):

382  
o
.
s


384 
def
 
	$bud_Num
(
£lf
, 
o
):

385  
o
.
n


387 
def
 
	$bud_Diù
(
£lf
, 
o
):

388  
	`diù
([(
£lf
.
	`bud
(
k
), s–f.
	$bud
(
v
))

389 
k
, 
v
 
š
 
	`z
(
o
.
keys
, o.
v®ues
)])

391 
def
 
	$bud_Tu¶e
(
£lf
, 
o
):

392  
	`tu¶e
(
£lf
.
	$bud_Li¡
(
o
))

394 
def
 
	$bud_Name
(
£lf
, 
o
):

395 
Çme
 = 
o
.
id


396 
Çme
 == 'None':

397  
NÚe


398 
Çme
 == 'True':

399  
True


400 
Çme
 == 'False':

401  
F®£


403 #S“ 
the
 
Name
 
is
 
a
 
·ckage
 
Ü
 
moduË
. 
If
 
™
 is, 
impÜt
 it.

404 
Œy
:

405  
	$moduËs
(
Çme
)

406 
exû±
 
ImpÜtE¼Ü
:

407 
·ss


409 #S“ 
the
 
Name
 
is
 
š
 
butšs
.

410 
Œy
:

411 
impÜt
 
butšs


412  
	$g‘©Œ
(
butšs
, 
Çme
)

413 
exû±
 
A‰ribu‹E¼Ü
:

414 
·ss


416 
¿i£
 
	`Ty³E¼Ü
("uÄ•¸could‚Ù„esŞvthÇm%s" % 
	$»´
(
Çme
))

418 
def
 
	$bud_UÇryOp
(
£lf
, 
o
):

419 
İ
, 
İ”ªd
 = 
	$m­
(
£lf
.
bud
, [
o
.
İ
, o.
İ”ªd
])

420  
	$İ
(
İ”ªd
)

422 
def
 
	$bud_BšOp
(
£lf
, 
o
):

423 
Ëá
, 
İ
, 
right
 = 
	$m­
(
£lf
.
bud
, [
o
.
Ëá
, o.
İ
, o.
right
])

424  
	$İ
(
Ëá
, 
right
)

426 
def
 
	$bud_Add
(
£lf
, 
o
):

427  
_İ”©Ü
.
add


429 
def
 
	$bud_MuÉ
(
£lf
, 
o
):

430  
_İ”©Ü
.
mul


432 
def
 
	$bud_USub
(
£lf
, 
o
):

433  
_İ”©Ü
.
Ãg


435 
def
 
	$bud_A‰ribu‹
(
£lf
, 
o
):

436 
·»Á
 = 
£lf
.
	$bud
(
o
.
v®ue
)

437  
	$g‘©Œ
(
·»Á
, 
o
.
©Œ
)

439 
def
 
	$bud_NÚeTy³
(
£lf
, 
o
):

440  
NÚe


443 
def
 
	$uÄ•r
(
s
):

445 
nÙ
 
s
:

446  
s


447 
sys
.
v”siÚ_šfo
 < (3, 0):

448 
b
 = 
	$_Bud”2
()

450 
b
 = 
	$_Bud”3
()

451 
obj
 = 
b
.
	$a¡node
(
s
)

452  
b
.
	$bud
(
obj
)

455 
def
 
	$moduËs
(
moduËP©h
):

457 
Œy
:

458 
mod
 = 
sys
.
moduËs
[
moduËP©h
]

459 
mod
 
is
 
NÚe
:

460 
¿i£
 
	$KeyE¼Ü
()

461 
exû±
 
KeyE¼Ü
:

462 
	$__impÜt__
(
moduËP©h
)

463 
mod
 = 
sys
.
moduËs
[
moduËP©h
]

464  
mod


466 
def
 
	$©Œibu‹s
(
fuÎ_©Œibu‹_Çme
):

469 #P¬£ 
out
 
the
 
·th
, 
moduË
, 
ªd
 
©Œibu‹


470 
Ï¡_dÙ
 = 
fuÎ_©Œibu‹_Çme
.
	`rfšd
(".")

471 
©Œ_Çme
 = 
fuÎ_©Œibu‹_Çme
[
Ï¡_dÙ
 + 1:]

472 
mod_·th
 = 
fuÎ_©Œibu‹_Çme
[:
Ï¡_dÙ
]

474 
mod
 = 
	$moduËs
(
mod_·th
)

475 #L‘ 
ª
 
A‰ribu‹E¼Ü
 
´İag©e
 
outw¬d
.

476 
Œy
:

477 
©Œ
 = 
	$g‘©Œ
(
mod
, 
©Œ_Çme
)

478 
exû±
 
A‰ribu‹E¼Ü
:

479 
¿i£
 
	`A‰ribu‹E¼Ü
("'%s' object has‚o‡ttribute '%s'"

480 % (
mod_·th
, 
©Œ_Çme
))

482 #R‘uº 
a
 
»ã»nû
 
to
 
the
 
©Œibu‹
.

483  
©Œ


	@trunk/objs/CherryPy-3.2.4/cherrypy/lib/sessions.py

3 
You
 
Ãed
 
to
 
ed™
 
your
 
cÚfig
 
fe
Ø
u£
 
	g£ssiÚs
. 
	gH”e
's‡nƒxample::

6 
	gtoŞs
.
	g£ssiÚs
.
	gÚ
 = 
True


7 
toŞs
.
£ssiÚs
.
¡Üage_ty³
 = "file"

8 
toŞs
.
£ssiÚs
.
¡Üage_·th
 = "/home/site/sessions"

9 
toŞs
.
£ssiÚs
.
timeout
 = 60

11 
This
 
£ts
 
the
 
£ssiÚ
 
to
 
be
 
¡Üed
 
š
 
fes
 iÀth
dœeùÜy
 /
home
/
s™e
/
£ssiÚs
,

12 
ªd
 
the
 
£ssiÚ
 
timeout
 
	gto
 60 
	gmšu‹s
. 
If
 
you
 
	gom™
 ``
	g¡Üage_ty³
``h
£ssiÚs


13 
wl
 
be
 
§ved
 
š
 
	gRAM
. ``
	gtoŞs
.
	g£ssiÚs
.
	gÚ
`` 
is
 
the
 
Úly
 
»quœed
 
lše
 

14 
wÜkšg
 
	g£ssiÚs
, 
the
 
»¡
 
¬e
 
	gİtiÚ®
.

16 
By
 , 
the
 
£ssiÚ
 
ID
 
is
 
·s£d
 
š
 
a
 
	gcook›
, 
so
h
	gş›Á
's browser must

17 
have
 
cook›s
 
’abËd
 
your
 
	gs™e
.

19 
To
 
£t
 
d©a
 
the
 
cu¼’t
 
	g£ssiÚ
, 
	gu£


20 ``
	gch”rypy
.
	g£ssiÚ
['fieldname'] = 'fieldvalue'``;

21 
to
 
g‘
 
d©a
 
	gu£
 ``
	gch”rypy
.
	g£ssiÚ
.get('fieldname')``.

24 
Lockšg
 
£ssiÚs


27 
By
 , 
	gthe
 ``'lockšg'`` 
mode
 
of
 
£ssiÚs
 
	gis
 ``'im¶ic™'``, 
which
 
m—ns


28 
the
 
£ssiÚ
 
is
 
locked
 
—¾y
 
ªd
 
uÆocked
 
	gÏ‹
. 
If
 
you
 
wªt
 
to
 
cÚŒŞ
 
wh’
he

29 
£ssiÚ
 
d©a
 
is
 
locked
 
ªd
 
	guÆocked
, 
	g£t
 ``
	gtoŞs
.
	g£ssiÚs
.
	glockšg
 = 'explicit'``.

30 
Th’
 
ÿÎ
 ``
ch”rypy
.
£ssiÚ
.
acquœe_lock
()`` 
ªd
 ``ch”rypy.£ssiÚ.
»Ëa£_lock
()``.

31 
Reg¬dËss
 
of
 
which
 
mode
 
you
 
u£
, 
the
 
£ssiÚ
 
is
 
gu¬ª‹ed
 
to
 
be
 
uÆocked
 
wh’


32 
the
 
»que¡
 
is
 
	gcom¶‘e
.

35 
Expœšg
 
SessiÚs


38 
You
 
ÿn
 
fÜû
 
a
 
£ssiÚ
 
to
 
expœe
 
w™h
 :
func
:`
ch”rypy
.
lib
.
£ssiÚs
.expire`.

39 
Sim¶y
 
ÿÎ
 
th©
 
funùiÚ
 
©
 
the
 
pošt
 
you
 
wªt
h
£ssiÚ
 
to
 
expœe
, 
ªd
 
™


40 
wl
 
ÿu£
 
the
 
£ssiÚ
 
cook›
 
to
 
expœe
 
	gş›Á
-
	gside
.

43 
SessiÚ
 
Fix©iÚ
 
PrÙeùiÚ


46 
If
 
Ch”ryPy
 
»ûives
, 
vŸ
 
a
 
»que¡
 
	gcook›
,‡ 
£ssiÚ
 
id
 
th©
 
™
 
dÛs
 
nÙ


47 
	g»cognize
, 
™
 
wl
 
»jeù
 
th©
 
id
 
ªd
 
ü—‹
 
a
 
Ãw
 
Úe
 
to
  
š
 
the


48 
»¥Ú£
 
	gcook›
. 
	gThis
 `
h–ps
 
´ev’t
 
£ssiÚ
 
fix©iÚ
 
	g©cks


49 <
	gh‰p
:

50 
Howev”
, 
	gCh”ryPy
 "»cognizes" 
a
 
£ssiÚ
 
id
 
by
 
lookšg
 
up
 
the
 
§ved
 session

51 
d©a
 
th©
 
	gid
. 
	gTh”efÜe
, 
you
 
Ãv”
 
§ve
 
ªy
 
£ssiÚ
 
	gd©a
,

52 **
you
 
wl
 
g‘
 
a
 
Ãw
 
£ssiÚ
 
id
 
ev”y
 
	g»que¡
**.

55 
Sh¬šg
 
SessiÚs


58 
If
 
you
 
run
 
muÉË
 
š¡ªûs
 
of
 
Ch”ryPy
 (
exam¶e
 
vŸ
 
mod_pythÚ
 
behšd


59 
A·che
 
´efÜk
), 
you
 
mo¡
 
lik–y
 
ÿÂÙ
 
u£
 
the
 
RAM
 
£ssiÚ
 
	gback’d
, 
sšû
 
—ch


60 
š¡ªû
 
of
 
Ch”ryPy
 
wl
 
have
 
™s
 
own
 
memÜy
 
	g¥aû
. 
U£
 
a
 
difã»Á
 
back’d


61 
	gš¡—d
, 
ªd
 
v”ify
 
th©
 
®l
 
š¡ªûs
 
¬e
 
poštšg
 
©
 
the
 
§me
 
fe
 
Ü
 
db


62 
	gloÿtiÚ
. 
	gAÉ”Ç‹ly
, 
you
 
might
 
Œy
 
a
 
lßd
 
b®ªûr
 
which
 
makes
 
	g£ssiÚs


63 "¡icky". 
GoogË
 
is
 
your
 
	gä›nd
, 
	gth”e
.

66 
Expœ©iÚ
 
D©es


69 
The
 
»¥Ú£
 
cook›
 
wl
 
pos£ss
 
ª
 
expœ©iÚ
 
d©e
 
to
 
šfÜm
 
the
 
ş›Á
 
©


70 
which
 
pošt
 
to
 
¡İ
 
£ndšg
 
the
 
cook›
 
back
 
š
 
»que¡s
. 
If
h
£rv”
 
time


71 
ªd
 
ş›Á
 
time
 
difãr
, 
ex³ù
 
£ssiÚs
 
to
 
be
 
	guÄ–ŸbË
. **
Make
 
su»
 
the


72 
sy¡em
 
time
 
of
 
your
 
£rv”
 
is
 
	gaccu¿‹
**.

74 
Ch”ryPy
 
deçuÉs
 
to
 
	ga
 60-
mšu‹
 
£ssiÚ
 
	gtimeout
, 
which
 
®so
 
­¶›s
Ø
the


75 
cook›
 
which
 
is
 
£Á
 
to
 
the
 
	gş›Á
. 
	gUnfÜtuÇ‹ly
, 
some
 
v”siÚs
 
of
 
	gSaçri


76 ("4…ubliøb‘a" 
Ú
 
Wšdows
 
XP
 
©
 
	gËa¡
è
­³¬
 
to
 
have
 
a
 
bug
 
š
 
theœ
 
·rsšg


77 
of
 
the
 
GMT
 
expœ©iÚ
 
	gd©e
--
they
 
­³¬
 
to
 
š‹½»t
h
d©e
 
as
 
Úe
 
hour
 
š


78 
the
 
	g·¡
. 
Sixty
 
mšu‹s
 
mšus
 
Úe
 
hour
 
is
 
´‘ty
 
şo£
 
to
 
	gz”o
, 
so
 
you
 
may


79 
ex³r›nû
 
this
 
bug
 
as
 
a
 
Ãw
 
£ssiÚ
 
id
 
ev”y
 
	g»que¡
, 
uÆess
 
the
 
»que¡s


80 
¬e
 
Ëss
 
thª
 
Úe
 
£cÚd
 
	g­¬t
. 
To
 
	gfix
, 
Œy
 
šü—sšg
 
the
 
	g£ssiÚ
.
	gtimeout
.

82 
On
 
the
 
Ùh”
 
	gexŒeme
, 
some
 
u£rs
 
»pÜt
 
Fœefox
 
£ndšg
 
cook›s
 
aá”
 
theœ


83 
expœ©iÚ
 
	gd©e
, 
®though
 
this
 
was
 
Ú
 
a
 
sy¡em
 
w™h
 
ª
 
šaccu¿‹
 sy¡em 
	gtime
.

84 
Maybe
 
FF
 
	gdÛ¢
'trust systemime.

87 
impÜt
 
d©‘ime


88 
impÜt
 
os


89 
impÜt
 
¿ndom


90 
impÜt
 
time


91 
impÜt
 
th»adšg


92 
impÜt
 
ty³s


93 
äom
 
w¬nšgs
 
impÜt
 
w¬n


95 
impÜt
 
ch”rypy


96 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
	gcİy™ems
, 
	gpickË
, 
	g¿ndom20
, 
unicode¡r


97 
äom
 
	gch”rypy
.
lib
 
impÜt
 
h‰put


100 
	gmissšg
 = 
	$objeù
()

102 
şass
 
	$SessiÚ
(
objeù
):

105 
_id
 = 
NÚe


107 
id_ob£rv”s
 = 
NÚe


110 
def
 
	$_g‘_id
(
£lf
):

111  
£lf
.
_id


112 
def
 
	$_£t_id
(
£lf
, 
v®ue
):

113 
£lf
.
_id
 = 
v®ue


114 
o
 
š
 
£lf
.
id_ob£rv”s
:

115 
	$o
(
v®ue
)

116 
id
 = 
	`´İ”ty
(
_g‘_id
, 
_£t_id
, 
doc
="The current session ID.")

118 
timeout
 = 60

121 
locked
 = 
F®£


123 
If
 
True
, 
this
 
£ssiÚ
 
š¡ªû
 
has
 
exşusive
 
»ad
/
wr™e
 
acûss


124 
to
 
£ssiÚ
 
d©a
."""

126 
lßded
 = 
F®£


128 
If
 
True
, 
d©a
 
has
 
b“n
 
»Œ›ved
 
äom
 
¡Üage
. 
This
 
should
 
h­³n


129 
autom©iÿÎy
 
Ú
 
the
 
fœ¡
 
©‹m±
 
to
 
acûss
 
£ssiÚ
 
d©a
."""

131 
ş—n_th»ad
 = 
NÚe


134 
ş—n_äeq
 = 5

137 
Üigš®id
 = 
NÚe


140 
missšg
 = 
F®£


143 
»g’”©ed
 = 
F®£


145 
True
 
the
 
­¶iÿtiÚ
 
ÿÎed
 
£ssiÚ
.
	`»g’”©e
(). 
This
 
is
 
nÙ
 
£t
 
by


146 
š‹º®
 
ÿÎs
 
to
 
»g’”©e
 
the
 
£ssiÚ
 
id
."""

148 
debug
=
F®£


150 
def
 
	$__š™__
(
£lf
, 
id
=
NÚe
, **
kw¬gs
):

151 
£lf
.
id_ob£rv”s
 = []

152 
£lf
.
_d©a
 = {
	}
}

154 
k
, 
v
 
š
 
	gkw¬gs
.
	$™ems
():

155 
	$£‰r
(
£lf
, 
k
, 
v
)

157 
£lf
.
Üigš®id
 = 
id


158 
£lf
.
missšg
 = 
F®£


159 
id
 
is
 
NÚe
:

160 
£lf
.
debug
:

161 
ch”rypy
.
	`log
('No id given; making‡‚ew one', 'TOOLS.SESSIONS')

162 
£lf
.
	$_»g’”©e
()

164 
£lf
.
id
 = id

165 
nÙ
 
£lf
.
	$_exi¡s
():

166 
£lf
.
debug
:

167 
ch”rypy
.
	`log
('Expired or malicious session %r; '

168 'makšg‡‚ew oÃ' % 
id
, 'TOOLS.SESSIONS')

169 #Expœed 
Ü
 
m®icious
 
£ssiÚ
. 
Make
 
a
 
Ãw
 
Úe
.

170 #S“ 
h‰p
:

171 
£lf
.
id
 = 
NÚe


172 
£lf
.
missšg
 = 
True


173 
£lf
.
	$_»g’”©e
()

175 
def
 
	$now
(
£lf
):

178 
Oth”
 
£ssiÚ
 
´ovid”s
 
ÿn
 
ov”ride
 
this
 
to
 
u£
 
®‹º©ive
,

179 
possibly
 
timezÚe
 
aw¬e
, 
v”siÚs
 
of
 'now'.

181  
d©‘ime
.d©‘ime.
	$now
()

183 
def
 
	$»g’”©e
(
£lf
):

185 
£lf
.
»g’”©ed
 = 
True


186 
£lf
.
	$_»g’”©e
()

188 
def
 
	$_»g’”©e
(
£lf
):

189 
£lf
.
id
 
is
 
nÙ
 
NÚe
:

190 
£lf
.
	$d–‘e
()

192 
Şd_£ssiÚ_was_locked
 = 
£lf
.
locked


193 
Şd_£ssiÚ_was_locked
:

194 
£lf
.
	$»Ëa£_lock
()

196 
£lf
.
id
 = 
NÚe


197 
£lf
.
id
 
is
 
NÚe
:

198 
£lf
.
id
 = s–f.
	$g’”©e_id
()

199 #As£¹ 
th©
 
the
 
g’”©ed
 
id
 
is
 
nÙ
 
®»ady
 
¡Üed
.

200 
£lf
.
	$_exi¡s
():

201 
£lf
.
id
 = 
NÚe


203 
Şd_£ssiÚ_was_locked
:

204 
£lf
.
	$acquœe_lock
()

206 
def
 
	$ş—n_up
(
£lf
):

208 
·ss


210 
def
 
	$g’”©e_id
(
£lf
):

212  
	$¿ndom20
()

214 
def
 
	$§ve
(
£lf
):

216 
Œy
:

217 #Ià
£ssiÚ
 
d©a
 
has
 
Ãv”
 
b“n
 
lßded
 
th’
 
™
's‚ever been

218 #acûs£d: 
no
 
Ãed
 
to
 
§ve
 
™


219 
£lf
.
lßded
:

220 
t
 = 
d©‘ime
.
	$timed–
(
£cÚds
 = 
£lf
.
timeout
 * 60)

221 
expœ©iÚ_time
 = 
£lf
.
	`now
(è+ 
t


222 
£lf
.
debug
:

223 
ch”rypy
.
	`log
('Savšg w™hƒxpœy %s' % 
expœ©iÚ_time
,

225 
£lf
.
	$_§ve
(
expœ©iÚ_time
)

227 
fš®ly
:

228 
£lf
.
locked
:

229 #Alway 
»Ëa£
 
the
 
lock
 th
u£r
 
didn
't„elease it

230 
£lf
.
	$»Ëa£_lock
()

232 
def
 
	$lßd
(
£lf
):

234 
d©a
 = 
£lf
.
	$_lßd
()

235 #d©¨
is
 
e™h”
 
NÚe
 
Ü
 
a
 
	`tu¶e
 (
£ssiÚ_d©a
, 
expœ©iÚ_time
)

236 
d©a
 
is
 
NÚe
 
Ü
 d©a[1] < 
£lf
.
	$now
():

237 
£lf
.
debug
:

238 
ch”rypy
.
	`log
('Expired session, flushing data', 'TOOLS.SESSIONS')

239 
£lf
.
_d©a
 = {
	}
}

241 
£lf
.
_d©a
 = 
d©a
[0]

242 
£lf
.
lßded
 = 
True


244 #Stick 
the
 
ş—n_th»ad
 
š
h
şass
, 
nÙ
h
š¡ªû
.

245 #Th
š¡ªûs
 
¬e
 
ü—‹d
 
ªd
 
de¡royed
 
³r
-
»que¡
.

246 
	gşs
 = 
£lf
.
__şass__


247 
£lf
.
ş—n_äeq
 
ªd
 
nÙ
 
şs
.
ş—n_th»ad
:

248 #ş—n_u°
is
 
š
 
š¡ªûm‘hod
 
ªd
 
nÙ
 
a
 
şassm‘hod
,

249 #sØ
th©
 
toŞ
 
cÚfig
 
ÿn
 
be
 
acûs£d
 
šside
 
the
 
m‘hod
.

250 
	gt
 = 
ch”rypy
.
´oûss
.
¶ugšs
.
MÚ™Ü
(

251 
ch”rypy
.
’gše
, 
£lf
.
ş—n_up
, s–f.
ş—n_äeq
 * 60,

252 
Çme
='Session cleanup')

253 
t
.
	$subsüibe
()

254 
şs
.
ş—n_th»ad
 = 
t


255 
t
.
	$¡¬t
()

257 
def
 
	$d–‘e
(
£lf
):

259 
£lf
.
	$_d–‘e
()

261 
def
 
	$__g‘™em__
(
£lf
, 
key
):

262 
nÙ
 
£lf
.
lßded
: s–f.
	$lßd
()

263  
£lf
.
_d©a
[
key
]

265 
def
 
	$__£t™em__
(
£lf
, 
key
, 
v®ue
):

266 
nÙ
 
£lf
.
lßded
: s–f.
	$lßd
()

267 
£lf
.
_d©a
[
key
] = 
v®ue


269 
def
 
	$__d–™em__
(
£lf
, 
key
):

270 
nÙ
 
£lf
.
lßded
: s–f.
	$lßd
()

271 
d–
 
£lf
.
_d©a
[
key
]

273 
def
 
	$pİ
(
£lf
, 
key
, =
missšg
):

275 
If
 
key
 
is
 
nÙ
 
found
,  i 
»tuºed
 
giv’
,

276 
Ùh”wi£
 
KeyE¼Ü
 
is
 
¿i£d
.

278 
nÙ
 
£lf
.
lßded
: s–f.
	$lßd
()

279  
is
 
missšg
:

280  
£lf
.
_d©a
.
	$pİ
(
key
)

282  
£lf
.
_d©a
.
	$pİ
(
key
, )

284 
def
 
	$__cÚšs__
(
£lf
, 
key
):

285 
nÙ
 
£lf
.
lßded
: s–f.
	$lßd
()

286  
key
 
š
 
£lf
.
_d©a


288 
	`ha§‰r
({
	}
}, 'has_key'):

289 
def
 
	$has_key
(
£lf
, 
key
):

291 
nÙ
 
£lf
.
lßded
: s–f.
	$lßd
()

292  
key
 
š
 
£lf
.
_d©a


294 
def
 
	$g‘
(
£lf
, 
key
, =
NÚe
):

296 
nÙ
 
£lf
.
lßded
: s–f.
	$lßd
()

297  
£lf
.
_d©a
.
	$g‘
(
key
, )

299 
def
 
	$upd©e
(
£lf
, 
d
):

301 
nÙ
 
£lf
.
lßded
: s–f.
	$lßd
()

302 
£lf
.
_d©a
.
	$upd©e
(
d
)

304 
def
 
	$£tdeçuÉ
(
£lf
, 
key
, =
NÚe
):

306 
nÙ
 
£lf
.
lßded
: s–f.
	$lßd
()

307  
£lf
.
_d©a
.
	$£tdeçuÉ
(
key
, )

309 
def
 
	$ş—r
(
£lf
):

311 
nÙ
 
£lf
.
lßded
: s–f.
	$lßd
()

312 
£lf
.
_d©a
.
	$ş—r
()

314 
def
 
	$keys
(
£lf
):

316 
nÙ
 
£lf
.
lßded
: s–f.
	$lßd
()

317  
£lf
.
_d©a
.
	$keys
()

319 
def
 
	$™ems
(
£lf
):

321 
nÙ
 
£lf
.
lßded
: s–f.
	$lßd
()

322  
£lf
.
_d©a
.
	$™ems
()

324 
def
 
	$v®ues
(
£lf
):

326 
nÙ
 
£lf
.
lßded
: s–f.
	$lßd
()

327  
£lf
.
_d©a
.
	$v®ues
()

330 
şass
 
	$RamSessiÚ
(
SessiÚ
):

332 #CÏss-
Ëv–
 
objeùs
. 
DÚ
't„ebindhese!

333 
ÿche
 = {
	}
}

334 
locks
 = {}

336 
def
 
	$ş—n_up
(
£lf
):

338 
now
 = 
£lf
.
	$now
()

339 
id
, (
d©a
, 
expœ©iÚ_time
è
š
 
	$cİy™ems
(
£lf
.
ÿche
):

340 
expœ©iÚ_time
 <ğ
now
:

341 
Œy
:

342 
d–
 
£lf
.
ÿche
[
id
]

343 
exû±
 
KeyE¼Ü
:

344 
·ss


345 
Œy
:

346 
d–
 
£lf
.
locks
[
id
]

347 
exû±
 
KeyE¼Ü
:

348 
·ss


350 #added 
to
 
»move
 
obsŞ‘e
 
lock
 
objeùs


351 
id
 
š
 
	$li¡
(
£lf
.
locks
):

352 
id
 
nÙ
 
š
 
£lf
.
ÿche
:

353 
£lf
.
locks
.
	$pİ
(
id
, 
NÚe
)

355 
def
 
	$_exi¡s
(
£lf
):

356  
£lf
.
id
 
š
 s–f.
ÿche


358 
def
 
	$_lßd
(
£lf
):

359  
£lf
.
ÿche
.
	$g‘
(
£lf
.
id
)

361 
def
 
	$_§ve
(
£lf
, 
expœ©iÚ_time
):

362 
£lf
.
ÿche
[£lf.
id
] = (£lf.
_d©a
, 
expœ©iÚ_time
)

364 
def
 
	$_d–‘e
(
£lf
):

365 
£lf
.
ÿche
.
	$pİ
(
£lf
.
id
, 
NÚe
)

367 
def
 
	$acquœe_lock
(
£lf
):

369 
£lf
.
locked
 = 
True


370 
£lf
.
locks
.
	`£tdeçuÉ
(£lf.
id
, 
th»adšg
.
	`RLock
()).
	$acquœe
()

372 
def
 
	$»Ëa£_lock
(
£lf
):

374 
£lf
.
locks
[£lf.
id
].
	$»Ëa£
()

375 
£lf
.
locked
 = 
F®£


377 
def
 
	$__Ën__
(
£lf
):

379  
	$Ën
(
£lf
.
ÿche
)

382 
şass
 
	$FeSessiÚ
(
SessiÚ
):

385 
¡Üage_·th


386 
The
 
fŞd”
 
wh”e
 
£ssiÚ
 
d©a
 
wl
 
be
 
§ved
. 
Each
 session

387 
wl
 
be
 
§ved
 
as
 
pickË
.
	$dump
(
d©a
, 
expœ©iÚ_time
è
š
 
™s
 
own
 
fe
;

388 
the
 
f’ame
 
wl
 
be
 
£lf
.
SESSION_PREFIX
 + s–f.
id
.

392 
SESSION_PREFIX
 = 'session-'

393 
LOCK_SUFFIX
 = '.lock'

394 
pickË_´ÙocŞ
 = 
pickË
.
HIGHEST_PROTOCOL


396 
def
 
	$__š™__
(
£lf
, 
id
=
NÚe
, **
kw¬gs
):

397 #Th'¡Üage_·th' 
¬g
 
is
 
»quœed
 
fe
-
ba£d
 
£ssiÚs
.

398 
kw¬gs
['¡Üage_·th'] = 
os
.
·th
.
	`ab¥©h
(kwargs['storage_path'])

399 
SessiÚ
.
	$__š™__
(
£lf
, 
id
=id, **
kw¬gs
)

401 
def
 
	$£tup
(
şs
, **
kw¬gs
):

404 
This
 
should
 
Úly
 
be
 
ÿÎed
 
Úû
 
³r
 
´oûss
; 
this
 
wl
 b
dÚe


405 
autom©iÿÎy
 
wh’
 
usšg
 
£ssiÚs
.
	`š™
 (
as
 
the
 
but
-
š
 
ToŞ
 
dÛs
).

407 #Th'¡Üage_·th' 
¬g
 
is
 
»quœed
 
fe
-
ba£d
 
£ssiÚs
.

408 
kw¬gs
['¡Üage_·th'] = 
os
.
·th
.
	`ab¥©h
(kwargs['storage_path'])

410 
k
, 
v
 
š
 
kw¬gs
.
	$™ems
():

411 
	$£‰r
(
şs
, 
k
, 
v
)

413 #W¬À
ªy
 
lock
 
fes
 
exi¡
 
©
 
¡¬tup
.

414 
lockfes
 = [
âame
 âam
š
 
os
.
	$li¡dœ
(
şs
.
¡Üage_·th
)

415 ià(
âame
.
	$¡¬tsw™h
(
şs
.
SESSION_PREFIX
)

416 
ªd
 
âame
.
	`’dsw™h
(
şs
.
LOCK_SUFFIX
))]

417 
lockfes
:

418 
¶u¿l
 = ('', 's')[
	`Ën
(
lockfes
) > 1]

419 
	`w¬n
("%s session†ockfile%s found‡t startup. If you‡re "

422 % (
	`Ën
(
lockfes
), 
¶u¿l
, 
şs
.
¡Üage_·th
))

423 
£tup
 = 
	$şassm‘hod
(
£tup
)

425 
def
 
	$_g‘_fe_·th
(
£lf
):

426 
f
 = 
os
.
·th
.
	`još
(
£lf
.
¡Üage_·th
, s–f.
SESSION_PREFIX
 + s–f.
id
)

427 
nÙ
 
os
.
·th
.
	`ab¥©h
(
f
).
	$¡¬tsw™h
(
£lf
.
¡Üage_·th
):

428 
¿i£
 
ch”rypy
.
	`HTTPE¼Ü
(400, "Invalid session id in cookie.")

429  
f


431 
def
 
	$_exi¡s
(
£lf
):

432 
·th
 = 
£lf
.
	$_g‘_fe_·th
()

433  
os
.
·th
.
	$exi¡s
(
·th
)

435 
def
 
	$_lßd
(
£lf
, 
·th
=
NÚe
):

436 
·th
 
is
 
NÚe
:

437 
·th
 = 
£lf
.
	$_g‘_fe_·th
()

438 
Œy
:

439 
f
 = 
	`İ’
(
·th
, "rb")

440 
Œy
:

441  
pickË
.
	$lßd
(
f
)

442 
fš®ly
:

443 
f
.
	$şo£
()

444 
	$exû±
 (
IOE¼Ü
, 
EOFE¼Ü
):

445  
NÚe


447 
def
 
	$_§ve
(
£lf
, 
expœ©iÚ_time
):

448 
f
 = 
	`İ’
(
£lf
.
	`_g‘_fe_·th
(), "wb")

449 
Œy
:

450 
pickË
.
	`dump
((
£lf
.
_d©a
, 
expœ©iÚ_time
), 
f
, s–f.
pickË_´ÙocŞ
)

451 
fš®ly
:

452 
f
.
	$şo£
()

454 
def
 
	$_d–‘e
(
£lf
):

455 
Œy
:

456 
os
.
	`uÆšk
(
£lf
.
	$_g‘_fe_·th
())

457 
exû±
 
OSE¼Ü
:

458 
·ss


460 
def
 
	$acquœe_lock
(
£lf
, 
·th
=
NÚe
):

462 
·th
 
is
 
NÚe
:

463 
·th
 = 
£lf
.
	$_g‘_fe_·th
()

464 
·th
 +ğ
£lf
.
LOCK_SUFFIX


465 
True
:

466 
Œy
:

467 
lockfd
 = 
os
.
	`İ’
(
·th
, os.
O_CREAT
|os.
O_WRONLY
|os.
O_EXCL
)

468 
exû±
 
OSE¼Ü
:

469 
time
.
	$¦“p
(0.1)

471 
os
.
	$şo£
(
lockfd
)

473 
£lf
.
locked
 = 
True


475 
def
 
	$»Ëa£_lock
(
£lf
, 
·th
=
NÚe
):

477 
·th
 
is
 
NÚe
:

478 
·th
 = 
£lf
.
	$_g‘_fe_·th
()

479 
os
.
	`uÆšk
(
·th
 + 
£lf
.
LOCK_SUFFIX
)

480 
£lf
.
locked
 = 
F®£


482 
def
 
	$ş—n_up
(
£lf
):

484 
now
 = 
£lf
.
	$now
()

485 #I‹¿‹ 
ov”
 
®l
 
£ssiÚ
 
fes
 
š
 
£lf
.
¡Üage_·th


486 
âame
 
š
 
os
.
	$li¡dœ
(
£lf
.
¡Üage_·th
):

487 ià(
âame
.
	$¡¬tsw™h
(
£lf
.
SESSION_PREFIX
)

488 
ªd
 
nÙ
 
âame
.
	$’dsw™h
(
£lf
.
LOCK_SUFFIX
)):

489 #W
have
 
a
 
£ssiÚ
 
fe
: 
lock
 
ªd
 
lßd
 
™
‡nd 
check


490 #ià
™
'sƒxpired. If it fails,‚evermind.

491 
·th
 = 
os
.·th.
	$još
(
£lf
.
¡Üage_·th
, 
âame
)

492 
£lf
.
	$acquœe_lock
(
·th
)

493 
Œy
:

494 
cÚ‹Ás
 = 
£lf
.
	$_lßd
(
·th
)

495 #_lßd 
»tuºs
 
NÚe
 
Ú
 
IOE¼Ü


496 
cÚ‹Ás
 
is
 
nÙ
 
NÚe
:

497 
d©a
, 
expœ©iÚ_time
 = 
cÚ‹Ás


498 
expœ©iÚ_time
 < 
now
:

499 #SessiÚ 
expœed
: 
d–‘šg
 
™


500 
os
.
	$uÆšk
(
·th
)

501 
fš®ly
:

502 
£lf
.
	$»Ëa£_lock
(
·th
)

504 
def
 
	$__Ën__
(
£lf
):

506  
	`Ën
([
âame
 âam
š
 
os
.
	$li¡dœ
(
£lf
.
¡Üage_·th
)

507 ià(
âame
.
	$¡¬tsw™h
(
£lf
.
SESSION_PREFIX
)

508 
ªd
 
nÙ
 
âame
.
	`’dsw™h
(
£lf
.
LOCK_SUFFIX
))])

511 
şass
 
	$Po¡g»sqlSessiÚ
(
SessiÚ
):

513 
a
 
bË
 
like
 
this
::

515 
ü—‹
 
bË
 
	`£ssiÚ
 (

516 
id
 
	`v¬ch¬
(40),

517 
d©a
 
‹xt
,

518 
expœ©iÚ_time
 
time¡amp


521 
You
 
mu¡
 
´ovide
 
your
 
own
 
g‘_db
 
funùiÚ
.

524 
pickË_´ÙocŞ
 = 
pickË
.
HIGHEST_PROTOCOL


526 
def
 
	$__š™__
(
£lf
, 
id
=
NÚe
, **
kw¬gs
):

527 
SessiÚ
.
	$__š™__
(
£lf
, 
id
, **
kw¬gs
)

528 
£lf
.
cursÜ
 = s–f.
db
.
	$cursÜ
()

530 
def
 
	$£tup
(
şs
, **
kw¬gs
):

533 
This
 
should
 
Úly
 
be
 
ÿÎed
 
Úû
 
³r
 
´oûss
; 
this
 
wl
 b
dÚe


534 
autom©iÿÎy
 
wh’
 
usšg
 
£ssiÚs
.
	`š™
 (
as
 
the
 
but
-
š
 
ToŞ
 
dÛs
).

536 
k
, 
v
 
š
 
kw¬gs
.
	$™ems
():

537 
	$£‰r
(
şs
, 
k
, 
v
)

539 
£lf
.
db
 = s–f.
	$g‘_db
()

540 
£tup
 = 
	$şassm‘hod
(
£tup
)

542 
def
 
	$__d–__
(
£lf
):

543 
£lf
.
cursÜ
:

544 
£lf
.
cursÜ
.
	$şo£
()

545 
£lf
.
db
.
	$comm™
()

547 
def
 
	$_exi¡s
(
£lf
):

548 #S–eù 
£ssiÚ
 
d©a
 
äom
 
bË


549 
£lf
.
cursÜ
.
	`execu‹
('select data,ƒxpiration_time from session '

550 'wh”id=%s', (
£lf
.
id
,))

551 
rows
 = 
£lf
.
cursÜ
.
	$ãtch®l
()

552  
	$boŞ
(
rows
)

554 
def
 
	$_lßd
(
£lf
):

555 #S–eù 
£ssiÚ
 
d©a
 
äom
 
bË


556 
£lf
.
cursÜ
.
	`execu‹
('select data,ƒxpiration_time from session '

557 'wh”id=%s', (
£lf
.
id
,))

558 
rows
 = 
£lf
.
cursÜ
.
	$ãtch®l
()

559 
nÙ
 
rows
:

560  
NÚe


562 
pickËd_d©a
, 
expœ©iÚ_time
 = 
rows
[0]

563 
d©a
 = 
pickË
.
	$lßds
(
pickËd_d©a
)

564  
d©a
, 
expœ©iÚ_time


566 
def
 
	$_§ve
(
£lf
, 
expœ©iÚ_time
):

567 
pickËd_d©a
 = 
pickË
.
	$dumps
(
£lf
.
_d©a
, s–f.
pickË_´ÙocŞ
)

568 
£lf
.
cursÜ
.
	`execu‹
('update session set data = %s, '

570 (
pickËd_d©a
, 
expœ©iÚ_time
, 
£lf
.
id
))

572 
def
 
	$_d–‘e
(
£lf
):

573 
£lf
.
cursÜ
.
	`execu‹
('d–‘äom sessiÚ wh”id=%s', (£lf.
id
,))

575 
def
 
	$acquœe_lock
(
£lf
):

577 #W
u£
 
the
 "fÜ upd©e" 
şau£
 
to
 
lock
h
row


578 
£lf
.
locked
 = 
True


579 
£lf
.
cursÜ
.
	`execu‹
('select id from session where id=%s for update',

580 (
£lf
.
id
,))

582 
def
 
	$»Ëa£_lock
(
£lf
):

584 #W
ju¡
 
şo£
 
the
 
cursÜ
 
ªd
 
th©
 
wl
 
»move
h
lock


585 #šŒoduûd 
by
 
the
 "fÜ upd©e" 
şau£


586 
£lf
.
cursÜ
.
	$şo£
()

587 
£lf
.
locked
 = 
F®£


589 
def
 
	$ş—n_up
(
£lf
):

591 
£lf
.
cursÜ
.
	`execu‹
('delete from session whereƒxpiration_time < %s',

592 (
£lf
.
	`now
(),))

595 
şass
 
	$MemÿchedSessiÚ
(
SessiÚ
):

597 #Th
mo¡
 
pİuÏr
 
memÿched
 
ş›Á
 
PythÚ
 
i¢
'thread-safe.

598 #W¿°
®l
 .
g‘
 
ªd
 .
£t
 
İ”©iÚs
 
š
 
a
 
sšgË
 
lock
.

599 
mc_lock
 = 
th»adšg
.
	$RLock
()

601 #Thi 
is
 
a
 
£³¿‹
 
£t
 
of
 
locks
 
³r
 
£ssiÚ
 
id
.

602 
locks
 = {
	}
}

604 
£rv”s
 = ['127.0.0.1:11211']

606 
def
 
	$£tup
(
şs
, **
kw¬gs
):

609 
This
 
should
 
Úly
 
be
 
ÿÎed
 
Úû
 
³r
 
´oûss
; 
this
 
wl
 b
dÚe


610 
autom©iÿÎy
 
wh’
 
usšg
 
£ssiÚs
.
	`š™
 (
as
 
the
 
but
-
š
 
ToŞ
 
dÛs
).

612 
k
, 
v
 
š
 
kw¬gs
.
	$™ems
():

613 
	$£‰r
(
şs
, 
k
, 
v
)

615 
impÜt
 
memÿche


616 
şs
.
ÿche
 = 
memÿche
.
	$Cl›Á
(
şs
.
£rv”s
)

617 
£tup
 = 
	$şassm‘hod
(
£tup
)

619 
def
 
	$_g‘_id
(
£lf
):

620  
£lf
.
_id


621 
def
 
	$_£t_id
(
£lf
, 
v®ue
):

622 #Thi 
	`’code
(è
ÿÎ
 
is
 
wh”e
 
we
 
difãr
 
äom
 
the
 
su³rşass
.

623 #Memÿch
keys
 
MUST
 
be
 
by‹
 
¡ršgs
, 
nÙ
 
unicode
.

624 
	$isš¡ªû
(
v®ue
, 
unicode¡r
):

625 
v®ue
 = v®ue.
	`’code
('utf-8')

627 
£lf
.
_id
 = 
v®ue


628 
o
 
š
 
£lf
.
id_ob£rv”s
:

629 
	$o
(
v®ue
)

630 
id
 = 
	`´İ”ty
(
_g‘_id
, 
_£t_id
, 
doc
="The current session ID.")

632 
def
 
	$_exi¡s
(
£lf
):

633 
£lf
.
mc_lock
.
	$acquœe
()

634 
Œy
:

635  
	`boŞ
(
£lf
.
ÿche
.
	$g‘
(
£lf
.
id
))

636 
fš®ly
:

637 
£lf
.
mc_lock
.
	$»Ëa£
()

639 
def
 
	$_lßd
(
£lf
):

640 
£lf
.
mc_lock
.
	$acquœe
()

641 
Œy
:

642  
£lf
.
ÿche
.
	$g‘
(
£lf
.
id
)

643 
fš®ly
:

644 
£lf
.
mc_lock
.
	$»Ëa£
()

646 
def
 
	$_§ve
(
£lf
, 
expœ©iÚ_time
):

647 #S’d 
the
 
expœ©iÚ
 
time
 
as
 "Unixime" (
£cÚds
 
sšû
 1/1/1970)

648 
td
 = (
time
.
	`mktime
(
expœ©iÚ_time
.
	$tim‘u¶e
()))

649 
£lf
.
mc_lock
.
	$acquœe
()

650 
Œy
:

651 
nÙ
 
£lf
.
ÿche
.
	`£t
(£lf.
id
, (£lf.
_d©a
, 
expœ©iÚ_time
), 
td
):

652 
¿i£
 
	`As£¹iÚE¼Ü
("SessiÚ d©¨fÜ id %¸nÙ s‘." % 
£lf
.
id
)

653 
fš®ly
:

654 
£lf
.
mc_lock
.
	$»Ëa£
()

656 
def
 
	$_d–‘e
(
£lf
):

657 
£lf
.
ÿche
.
	$d–‘e
(
£lf
.
id
)

659 
def
 
	$acquœe_lock
(
£lf
):

661 
£lf
.
locked
 = 
True


662 
£lf
.
locks
.
	`£tdeçuÉ
(£lf.
id
, 
th»adšg
.
	`RLock
()).
	$acquœe
()

664 
def
 
	$»Ëa£_lock
(
£lf
):

666 
£lf
.
locks
[£lf.
id
].
	$»Ëa£
()

667 
£lf
.
locked
 = 
F®£


669 
def
 
	$__Ën__
(
£lf
):

671 
¿i£
 
NÙIm¶em’‹dE¼Ü


674 #Hook 
	`funùiÚs
 (
Ch”ryPy
 
toŞs
)

676 
def
 
	$§ve
():

679 
nÙ
 
	`ha§‰r
(
ch”rypy
.
£rvšg
, "session"):

681 
»que¡
 = 
ch”rypy
.
£rvšg
.request

682 
»¥Ú£
 = 
ch”rypy
.
£rvšg
.response

684 #Gu¬d 
agaš¡
 
ruÂšg
 
twiû


685 
	`ha§‰r
(
»que¡
, "_sessionsaved"):

687 
»que¡
.
_£ssiÚ§ved
 = 
True


689 
»¥Ú£
.
¡»am
:

690 #Ià
the
 
body
 
is
 
bešg
 
¡»amed
, 
we
 
have
 
to
 
§ve
h
d©a


691 #*
aá”
* 
the
 
»¥Ú£
 
has
 
b“n
 
wr™‹n
 
out


692 
»que¡
.
hooks
.
	`©ch
('Ú_’d_»que¡', 
ch”rypy
.
£ssiÚ
.
§ve
)

694 #Ià
the
 
body
 
is
 
nÙ
 
bešg
 
¡»amed
, 
we
 
§ve
h
d©a
 
now


695 #(
so
 
we
 
ÿn
 
»Ëa£
 
the
 
lock
).

696 
	$isš¡ªû
(
»¥Ú£
.
body
, 
ty³s
.
G’”©ÜTy³
):

697 
»¥Ú£
.
	$cŞÏp£_body
()

698 
ch”rypy
.
£ssiÚ
.
	$§ve
()

699 
§ve
.
ç§ã
 = 
True


701 
def
 
	$şo£
():

703 
£ss
 = 
	`g‘©Œ
(
ch”rypy
.
£rvšg
, "£ssiÚ", 
NÚe
)

704 
	`g‘©Œ
(
£ss
, "locked", 
F®£
):

705 #Ià
the
 
£ssiÚ
 
is
 
¡l
 
locked
 
we
 
»Ëa£
h
lock


706 
£ss
.
	$»Ëa£_lock
()

707 
şo£
.
ç§ã
 = 
True


708 
şo£
.
´iÜ™y
 = 90

711 
def
 
	`š™
(
¡Üage_ty³
='¿m', 
·th
=
NÚe
, 
·th_h—d”
=NÚe, 
Çme
='session_id',

712 
timeout
=60, 
domaš
=
NÚe
, 
£cu»
=
F®£
, 
ş—n_äeq
=5,

713 
³rsi¡’t
=
True
, 
h‰pÚly
=
F®£
, 
debug
=F®£, **
kw¬gs
):

716 
¡Üage_ty³


717 
OÃ
 
of
 '¿m', 'fe', 'po¡g»sql', 'memÿched'. 
This
 
wl
 
be


718 
u£d
 
to
 
look
 
up
 
the
 
cÜ»¥Údšg
 
şass
 
š
 
ch”rypy
.
lib
.
£ssiÚs


719 
glob®s
. 
FÜ
 
exam¶e
, 'fe' 
wl
 
u£
 
the
 
FeSessiÚ
 
şass
.

721 
·th


722 
The
 '·th' 
v®ue
 
to
 
¡ick
 
š
 
the
 
»¥Ú£
 
cook›
 
m‘ad©a
.

724 
·th_h—d”


725 
If
 '·th' 
is
 
	`NÚe
 (
the
 ), 
th’
h
»¥Ú£


726 
cook›
 '·th' 
wl
 
be
 
puÎed
 
äom
 
»que¡
.
h—d”s
[
·th_h—d”
].

728 
Çme


729 
The
 
Çme
 
of
 
the
 
cook›
.

731 
timeout


732 
The
 
expœ©iÚ
 
	$timeout
 (
š
 
mšu‹s
è
the
 
¡Üed
 
£ssiÚ
 
d©a
.

733 
If
 '³rsi¡’t' 
is
 
	`True
 (
the
 ), 
this
 i 
®so
h
timeout


734 
the
 
cook›
.

736 
domaš


737 
The
 
cook›
 
domaš
.

739 
£cu»


740 
If
 
	$F®£
 (
the
 èth
cook›
 '£cu»' 
v®ue
 
wl
 
nÙ


741 
be
 
£t
. 
If
 
True
, 
the
 
cook›
 '£cu»' 
v®ue
 
wl
 b
	`£t
 (
to
 1).

743 
	$ş—n_äeq
 (
mšu‹s
)

744 
The
 
pŞl
 
¿‹
 
expœed
 
£ssiÚ
 
ş—nup
.

746 
³rsi¡’t


747 
If
 
	`True
 (
the
 ),h'timeout' 
¬gum’t
 
wl
 
be
 
u£d


748 
to
 
expœe
 
the
 
cook›
. 
If
 
F®£
,hcook› 
wl
 
nÙ
 
have
 
ª
 
expœy
,

749 
ªd
 
the
 
cook›
 
wl
 
be
 
a
 "£ssiÚ cook›" 
which
 
expœes
 
wh’
he

750 
brow£r
 
is
 
şo£d
.

752 
h‰pÚly


753 
If
 
	$F®£
 (
the
 èth
cook›
 'h‰pÚly' 
v®ue
 
wl
 
nÙ
 
be
 
£t
.

754 
If
 
True
, 
the
 
cook›
 'h‰pÚly' 
v®ue
 
wl
 
be
 
	`£t
 (
to
 1).

756 
Any
 
add™iÚ®
 
kw¬gs
 
wl
 
be
 
bound
 
to
 
the
 
Ãw
 
SessiÚ
 
š¡ªû
,

757 
ªd
 
may
 
be
 
¥ecific
 
to
 
the
 
¡Üage
 
ty³
. 
S“
h
subşass
 
of
 
SessiÚ


758 
you
're using for more information.

761 
»que¡
 = 
ch”rypy
.
£rvšg
.request

763 #Gu¬d 
agaš¡
 
ruÂšg
 
twiû


764 
	`ha§‰r
(
»que¡
, "_session_init_flag"):

766 
»que¡
.
_£ssiÚ_š™_æag
 = 
True


768 #Check 
»que¡
 
ÿme
 
w™h
 
a
 
£ssiÚ
 
ID


769 
id
 = 
NÚe


770 
Çme
 
š
 
»que¡
.
cook›
:

771 
id
 = 
»que¡
.
cook›
[
Çme
].
v®ue


772 
debug
:

773 
ch”rypy
.
	`log
('ID obšed from„eque¡.cook›: %r' % 
id
,

776 #Fšd 
the
 
¡Üage
 
şass
 
ªd
 
ÿÎ
 
	`£tup
 (
fœ¡
 
time
 
Úly
).

777 
¡Üage_şass
 = 
¡Üage_ty³
.
	`t™Ë
() + 'Session'

778 
¡Üage_şass
 = 
	`glob®s
()[storage_class]

779 
nÙ
 
	`ha§‰r
(
ch”rypy
, "session"):

780 
	`ha§‰r
(
¡Üage_şass
, "setup"):

781 
¡Üage_şass
.
	$£tup
(**
kw¬gs
)

783 #C»©
ªd
 
©ch
 
a
 
Ãw
 
SessiÚ
 
š¡ªû
 
to
 
ch”rypy
.
£rvšg
.

784 #Iˆ
wl
 
pos£ss
 
a
 
»ã»nû
 
	`to
 (
ªd
 
lock
,‡nd 
Ïzy
 
lßd
)

785 #th
»que¡ed
 
£ssiÚ
 
d©a
.

786 
kw¬gs
['timeout'] = 
timeout


787 
kw¬gs
['ş—n_äeq'] = 
ş—n_äeq


788 
ch”rypy
.
£rvšg
.
£ssiÚ
 = 
£ss
 = 
	$¡Üage_şass
(
id
, **
kw¬gs
)

789 
£ss
.
debug
 = debug

790 
def
 
	$upd©e_cook›
(
id
):

792 
ch”rypy
.
£rvšg
.
»¥Ú£
.
cook›
[
Çme
] = 
id


793 
£ss
.
id_ob£rv”s
.
	$­³nd
(
upd©e_cook›
)

795 #C»©
ch”rypy
.
£ssiÚ
 
which
 
wl
 
´oxy
 
to
 ch”rypy.
£rvšg
.session

796 
nÙ
 
	`ha§‰r
(
ch”rypy
, "session"):

797 
ch”rypy
.
£ssiÚ
 = ch”rypy.
	`_Th»adLoÿlProxy
('session')

799 
³rsi¡’t
:

800 
cook›_timeout
 = 
timeout


802 #S“ 
h‰p
:

803 #ªd 
h‰p
:

804 
cook›_timeout
 = 
NÚe


805 
	$£t_»¥Ú£_cook›
(
·th
õ©h, 
·th_h—d”
õ©h_h—d”, 
Çme
=name,

806 
timeout
=
cook›_timeout
, 
domaš
=domaš, 
£cu»
=secure,

807 
h‰pÚly
=httponly)

810 
def
 
	`£t_»¥Ú£_cook›
(
·th
=
NÚe
, 
·th_h—d”
=NÚe, 
Çme
='session_id',

811 
timeout
=60, 
domaš
=
NÚe
, 
£cu»
=
F®£
, 
h‰pÚly
=False):

814 
·th


815 
the
 '·th' 
v®ue
 
to
 
¡ick
 
š
h
»¥Ú£
 
cook›
 
m‘ad©a
.

817 
·th_h—d”


818 '·th' 
is
 
	`NÚe
 (
the
 ), 
th’
h
»¥Ú£


819 
cook›
 '·th' 
wl
 
be
 
puÎed
 
äom
 
»que¡
.
h—d”s
[
·th_h—d”
].

821 
Çme


822 
the
 
Çme
 
of
h
cook›
.

824 
timeout


825 
the
 
expœ©iÚ
 
timeout
 th
cook›
. 
If
 0 
Ü
 
Ùh”
 
boŞ—n


826 
F®£
, 
no
 'expœes' 
·¿m
 
wl
 
be
 
£t
, 
ªd
 
the
 
cook›
 wÈb
a


827 "£ssiÚ cook›" 
which
 
expœes
 
wh’
 
the
 
brow£r
 
is
 
şo£d
.

829 
domaš


830 
the
 
cook›
 
domaš
.

832 
£cu»


833 
	$F®£
 (
the
 èth
cook›
 '£cu»' 
v®ue
 
wl
 
nÙ


834 
be
 
£t
. 
If
 
True
, 
the
 
cook›
 '£cu»' 
v®ue
 
wl
 b
	`£t
 (
to
 1).

836 
h‰pÚly


837 
If
 
	$F®£
 (
the
 èth
cook›
 'h‰pÚly' 
v®ue
 
wl
 
nÙ
 
be
 
£t
.

838 
If
 
True
, 
the
 
cook›
 'h‰pÚly' 
v®ue
 
wl
 
be
 
	`£t
 (
to
 1).

841 #S‘ 
»¥Ú£
 
cook›


842 
cook›
 = 
ch”rypy
.
£rvšg
.
»¥Ú£
.cookie

843 
cook›
[
Çme
] = 
ch”rypy
.
£rvšg
.
£ssiÚ
.
id


844 
cook›
[
Çme
]['·th'] = (
·th
 
Ü
 
ch”rypy
.
£rvšg
.
»que¡
.
h—d”s
.
	$g‘
(
·th_h—d”
)

845 
Ü
 '/')

849 #§v
™
 
to
 
disk
 
ªd
 
the
 
£ssiÚ
 
is
 
lo¡
 
³İË
 
şo£


850 #th
brow£r
. 
So
 
we
 
have
 
to
 
u£
 
the
 
Şd
 "expœes" ... 
sigh
 ...

851 ## 
cook›
[
Çme
]['max-age'] = 
timeout
 * 60

852 
timeout
:

853 
e
 = 
time
.
	`time
(è+ (
timeout
 * 60)

854 
cook›
[
Çme
]['expœes'] = 
h‰put
.
	$HTTPD©e
(
e
)

855 
domaš
 
is
 
nÙ
 
NÚe
:

856 
cook›
[
Çme
]['domaš'] = 
domaš


857 
£cu»
:

858 
cook›
[
Çme
]['secure'] = 1

859 
h‰pÚly
:

860 
nÙ
 
cook›
[
Çme
].
	`isRe£rvedKey
('httponly'):

861 
¿i£
 
	`V®ueE¼Ü
("The httponly cookieoken is‚ot supported.")

862 
cook›
[
Çme
]['httponly'] = 1

864 
def
 
	$expœe
():

866 
Çme
 = 
ch”rypy
.
£rvšg
.
»que¡
.
cÚfig
.
	`g‘
('tools.sessions.name', 'session_id')

867 
Úe_y—r
 = 60 * 60 * 24 * 365

868 
e
 = 
time
.
	`time
(è- 
Úe_y—r


869 
ch”rypy
.
£rvšg
.
»¥Ú£
.
cook›
[
Çme
]['expœes'] = 
h‰put
.
	`HTTPD©e
(
e
)

	@trunk/objs/CherryPy-3.2.4/cherrypy/lib/static.py

1 
	gŒy
:

2 
äom
 
io
 
impÜt
 
UnsuµÜ‹dO³¿tiÚ


3 
exû±
 
ImpÜtE¼Ü
:

4 
UnsuµÜ‹dO³¿tiÚ
 = 
	$objeù
()

5 
impÜt
 
loggšg


6 
impÜt
 
mim‘y³s


7 
mim‘y³s
.
	$š™
()

8 
mim‘y³s
.
ty³s_m­
['.dwg']='image/x-dwg'

9 
mim‘y³s
.
ty³s_m­
['.ico']='image/x-icon'

10 
mim‘y³s
.
ty³s_m­
['.bz2']='application/x-bzip2'

11 
mim‘y³s
.
ty³s_m­
['.gz']='application/x-gzip'

13 
impÜt
 
os


14 
impÜt
 
»


15 
impÜt
 
¡©


16 
impÜt
 
time


18 
impÜt
 
ch”rypy


19 
äom
 
ch”rypy
.
_ıcom·t
 
impÜt
 
Áob
, 
unquÙe


20 
äom
 
ch”rypy
.
lib
 
impÜt
 
ıtoŞs
, 
h‰put
, 
fe_g’”©Ü_lim™ed


23 
def
 
	$£rve_fe
(
·th
, 
cÚ‹Á_ty³
=
NÚe
, 
di¥os™iÚ
=NÚe, 
Çme
=NÚe, 
debug
=
F®£
):

26 
The
 
CÚ‹Á
-
Ty³
 
h—d”
 
wl
 
be
 
£t
 
to
 
the
 
cÚ‹Á_ty³
 
¬g
, 
´ovided
.

27 
If
 
nÙ
 
´ovided
, 
the
 
CÚ‹Á
-
Ty³
 
wl
 
be
 
gues£d
 
by
h
fe
 
ex‹nsiÚ


28 
of
 
the
 '·th' 
¬gum’t
.

30 
If
 
di¥os™iÚ
 
is
 
nÙ
 
NÚe
, 
the
 
CÚ‹Á
-
Di¥os™iÚ
 
h—d”
 
wl
 
be
 
£t


31 
to
 "<di¥os™iÚ>; f’ame=<Çme>". 
If
 
Çme
 
is
 
NÚe
, 
™
 
wl
 
be
 
£t


32 
to
 
the
 
ba£Çme
 
of
 
·th
. 
If
 
di¥os™iÚ
 
is
 
NÚe
, 
no
 
CÚ‹Á
-
Di¥os™iÚ


33 
h—d”
 
wl
 
be
 
wr™‹n
.

36 
»¥Ú£
 = 
ch”rypy
.
£rvšg
.response

38 #Ià
·th
 
is
 
»Ïtive
, 
u£rs
 
should
 
fix
 
™
 
by
 
makšg
…©h 
absŞu‹
.

39 #Th© 
is
, 
Ch”ryPy
 
should
 
nÙ
 
guess
 
wh”e
 
the
 
­¶iÿtiÚ
 
roÙ
 is.

40 #Iˆ
û¹ašly
 
should
 *
nÙ
* 
u£
 
	`cwd
 (
sšû
 
CP
 
may
 
be
 
švoked
 
äom
 
a


41 #v¬›ty 
of
 
·ths
). 
If
 
usšg
 
toŞs
.
¡©icdœ
, 
you
 
ÿn
 
make
 
your
 
»Ïtive


42 #·th 
become
 
absŞu‹
 
by
 
suµlyšg
 
a
 
v®ue
 "tools.staticdir.root".

43 
nÙ
 
os
.
·th
.
	$i§bs
(
·th
):

44 
msg
 = "'%s' i nÙ‡ÀabsŞu‹…©h." % 
·th


45 
debug
:

46 
ch”rypy
.
	`log
(
msg
, 'TOOLS.STATICFILE')

47 
¿i£
 
	$V®ueE¼Ü
(
msg
)

49 
Œy
:

50 
¡
 = 
os
.
	$¡©
(
·th
)

51 
exû±
 
OSE¼Ü
:

52 
debug
:

53 
ch”rypy
.
	`log
('os.¡©(%rèçed' % 
·th
, 'TOOLS.STATIC')

54 
¿i£
 
ch”rypy
.
	$NÙFound
()

56 #Check 
·th
 
is
 
a
 
dœeùÜy
.

57 
¡©
.
	$S_ISDIR
(
¡
.
¡_mode
):

58 #L‘ 
the
 
ÿÎ”
 
d—l
 
w™h
 
™
 
as
 
they
 
like
.

59 
debug
:

60 
ch”rypy
.
	`log
('%¸i ¨dœeùÜy' % 
·th
, 'TOOLS.STATIC')

61 
¿i£
 
ch”rypy
.
	$NÙFound
()

63 #S‘ 
the
 
La¡
-
Modif›d
 
»¥Ú£
 
h—d”
, 
so
 
th©


64 #modif›d-
sšû
 
v®id©iÚ
 
code
 
ÿn
 
wÜk
.

65 
»¥Ú£
.
h—d”s
['La¡-Modif›d'] = 
h‰put
.
	$HTTPD©e
(
¡
.
¡_mtime
)

66 
ıtoŞs
.
	$v®id©e_sšû
()

68 
cÚ‹Á_ty³
 
is
 
NÚe
:

69 #S‘ 
cÚ‹Á
-
ty³
 
ba£d
 
Ú
 
f’ame
 
ex‹nsiÚ


70 
ext
 = ""

71 
i
 = 
·th
.
	`rfšd
('.')

72 
i
 != -1:

73 
ext
 = 
·th
[
i
:].
	$low”
()

74 
cÚ‹Á_ty³
 = 
mim‘y³s
.
ty³s_m­
.
	$g‘
(
ext
, 
NÚe
)

75 
cÚ‹Á_ty³
 
is
 
nÙ
 
NÚe
:

76 
»¥Ú£
.
h—d”s
['CÚ‹Á-Ty³'] = 
cÚ‹Á_ty³


77 
debug
:

78 
ch”rypy
.
	`log
('CÚ‹Á-Ty³: %r' % 
cÚ‹Á_ty³
, 'TOOLS.STATIC')

80 
cd
 = 
NÚe


81 
di¥os™iÚ
 
is
 
nÙ
 
NÚe
:

82 
Çme
 
is
 
NÚe
:

83 
Çme
 = 
os
.
·th
.
	$ba£Çme
(
·th
)

84 
cd
 = '%s; f’ame="%s"' % (
di¥os™iÚ
, 
Çme
)

85 
»¥Ú£
.
h—d”s
["CÚ‹Á-Di¥os™iÚ"] = 
cd


86 
debug
:

87 
ch”rypy
.
	`log
('CÚ‹Á-Di¥os™iÚ: %r' % 
cd
, 'TOOLS.STATIC')

89 #S‘ 
CÚ‹Á
-
L’gth
 
ªd
 
u£
 
ª
 
	`™”abË
 (
fe
 
objeù
)

90 #thi 
way
 
CP
 
wÚ
't†oadhe whole file in memory

91 
cÚ‹Á_Ëngth
 = 
¡
.
¡_size


92 
feobj
 = 
	`İ’
(
·th
, 'rb')

93  
	$_£rve_feobj
(
feobj
, 
cÚ‹Á_ty³
, 
cÚ‹Á_Ëngth
, 
debug
=debug)

95 
def
 
	$£rve_feobj
(
feobj
, 
cÚ‹Á_ty³
=
NÚe
, 
di¥os™iÚ
=NÚe, 
Çme
=None,

96 
debug
=
F®£
):

99 
The
 
CÚ‹Á
-
Ty³
 
h—d”
 
wl
 
be
 
£t
 
to
 
the
 
cÚ‹Á_ty³
 
¬g
, 
´ovided
.

101 
If
 
di¥os™iÚ
 
is
 
nÙ
 
NÚe
, 
the
 
CÚ‹Á
-
Di¥os™iÚ
 
h—d”
 
wl
 
be
 
£t


102 
to
 "<di¥os™iÚ>; f’ame=<Çme>". 
If
 
Çme
 
is
 
NÚe
, 'f’ame' 
wl


103 
nÙ
 
be
 
£t
. 
If
 
di¥os™iÚ
 
is
 
NÚe
, 
no
 
CÚ‹Á
-
Di¥os™iÚ
 
h—d”
 
wl


104 
be
 
wr™‹n
.

106 
CAUTION
: 
If
 
the
 
»que¡
 
cÚšs
 
a
 'Rªge' 
h—d”
, 
Úe
 
Ü
 
mÜe
 
	$£ek
()
s
 
wl


107 
be
 
³rfÜmed
 
Ú
 
the
 
fe
 
objeù
. 
This
 
may
 
ÿu£
 
undesœed
 
behaviÜ
 

108 
the
 
fe
 
objeù
 
is
 
nÙ
 
£ekabË
. 
It
 
could
 
®so
 
´oduû
 
undesœed
 
»suÉs


109 
the
 
ÿÎ”
 
£t
h
»ad
 
pos™iÚ
 
of
h
fe
 
objeù
 
´iÜ
 
to
 
ÿÎšg


110 
	`£rve_feobj
(), 
ex³ùšg
 
th©
 
the
 
d©a
 
would
 
be
 
£rved
 
¡¬tšg
 
äom
hat

111 
pos™iÚ
.

114 
»¥Ú£
 = 
ch”rypy
.
£rvšg
.response

116 
Œy
:

117 
¡
 = 
os
.
	`f¡©
(
feobj
.
	$f’o
())

118 
exû±
 
A‰ribu‹E¼Ü
:

119 
debug
:

120 
ch”rypy
.
	`log
('os has‚o fstat‡ttribute', 'TOOLS.STATIC')

121 
cÚ‹Á_Ëngth
 = 
NÚe


122 
exû±
 
UnsuµÜ‹dO³¿tiÚ
:

123 
cÚ‹Á_Ëngth
 = 
NÚe


125 #S‘ 
the
 
La¡
-
Modif›d
 
»¥Ú£
 
h—d”
, 
so
 
th©


126 #modif›d-
sšû
 
v®id©iÚ
 
code
 
ÿn
 
wÜk
.

127 
»¥Ú£
.
h—d”s
['La¡-Modif›d'] = 
h‰put
.
	$HTTPD©e
(
¡
.
¡_mtime
)

128 
ıtoŞs
.
	$v®id©e_sšû
()

129 
cÚ‹Á_Ëngth
 = 
¡
.
¡_size


131 
cÚ‹Á_ty³
 
is
 
nÙ
 
NÚe
:

132 
»¥Ú£
.
h—d”s
['CÚ‹Á-Ty³'] = 
cÚ‹Á_ty³


133 
debug
:

134 
ch”rypy
.
	`log
('CÚ‹Á-Ty³: %r' % 
cÚ‹Á_ty³
, 'TOOLS.STATIC')

136 
cd
 = 
NÚe


137 
di¥os™iÚ
 
is
 
nÙ
 
NÚe
:

138 
Çme
 
is
 
NÚe
:

139 
cd
 = 
di¥os™iÚ


141 
cd
 = '%s; f’ame="%s"' % (
di¥os™iÚ
, 
Çme
)

142 
»¥Ú£
.
h—d”s
["CÚ‹Á-Di¥os™iÚ"] = 
cd


143 
debug
:

144 
ch”rypy
.
	`log
('CÚ‹Á-Di¥os™iÚ: %r' % 
cd
, 'TOOLS.STATIC')

146  
	$_£rve_feobj
(
feobj
, 
cÚ‹Á_ty³
, 
cÚ‹Á_Ëngth
, 
debug
=debug)

148 
def
 
	$_£rve_feobj
(
feobj
, 
cÚ‹Á_ty³
, 
cÚ‹Á_Ëngth
, 
debug
=
F®£
):

150 
»¥Ú£
 = 
ch”rypy
.
£rvšg
.response

152 #HTTP/1.0 
didn
't have Range/Accept-Ranges headers, orhe 206 code

153 
»que¡
 = 
ch”rypy
.
£rvšg
.request

154 
»que¡
.
´ÙocŞ
 >= (1, 1):

155 
»¥Ú£
.
h—d”s
["Accept-Ranges"] = "bytes"

156 
r
 = 
h‰put
.
	`g‘_¿nges
(
»que¡
.
h—d”s
.
	`g‘
('Rªge'), 
cÚ‹Á_Ëngth
)

157 
r
 == []:

158 
»¥Ú£
.
h—d”s
['CÚ‹Á-Rªge'] = "by‹ */%s" % 
cÚ‹Á_Ëngth


159 
mes§ge
 = "Invalid Range (first-byte-pos greaterhan Content-Length)"

160 
debug
:

161 
ch”rypy
.
	`log
(
mes§ge
, 'TOOLS.STATIC')

162 
¿i£
 
ch”rypy
.
	$HTTPE¼Ü
(416, 
mes§ge
)

164 
r
:

165 
	`Ën
(
r
) == 1:

166 #R‘uº 
a
 
sšgË
-
·¹
 
»¥Ú£
.

167 
¡¬t
, 
¡İ
 = 
r
[0]

168 
¡İ
 > 
cÚ‹Á_Ëngth
:

169 
¡İ
 = 
cÚ‹Á_Ëngth


170 
r_Ën
 = 
¡İ
 - 
¡¬t


171 
debug
:

172 
ch”rypy
.
	`log
('SšgË…¬t; s¹: %r, stİ: %r' % (
¡¬t
, 
¡İ
),

174 
»¥Ú£
.
¡©us
 = "206 Partial Content"

175 
»¥Ú£
.
h—d”s
['Content-Range'] = (

176 "by‹ %s-%s/%s" % (
¡¬t
, 
¡İ
 - 1, 
cÚ‹Á_Ëngth
))

177 
»¥Ú£
.
h—d”s
['CÚ‹Á-L’gth'] = 
r_Ën


178 
feobj
.
	$£ek
(
¡¬t
)

179 
»¥Ú£
.
body
 = 
	$fe_g’”©Ü_lim™ed
(
feobj
, 
r_Ën
)

181 #R‘uº 
a
 
muÉ¬t
/
by‹¿nges
 
»¥Ú£
.

182 
»¥Ú£
.
¡©us
 = "206 Partial Content"

183 
Œy
:

185 
äom
 
ema
.
g’”©Ü
 
impÜt
 
_make_bound¬y
 
as
 
choo£_bound¬y


186 
exû±
 
ImpÜtE¼Ü
:

188 
äom
 
mim‘oŞs
 
impÜt
 
choo£_bound¬y


189 
bound¬y
 = 
	$choo£_bound¬y
()

190 
ù
 = "muÉ¬t/by‹¿nges; bound¬y=%s" % 
bound¬y


191 
»¥Ú£
.
h—d”s
['CÚ‹Á-Ty³'] = 
ù


192 "CÚ‹Á-L’gth" 
š
 
»¥Ú£
.
h—d”s
:

193 #D–‘
CÚ‹Á
-
L’gth
 
h—d”
 
so
 
	`fš®ize
(è
»ÿlcs
 
™
.

194 
d–
 
»¥Ú£
.
h—d”s
["Content-Length"]

196 
def
 
	$fe_¿nges
():

197 #A·ch
com·tib™y
:

198 
y›ld
 
	`Áob
("\r\n")

200 
¡¬t
, 
¡İ
 
š
 
r
:

201 
debug
:

202 
ch”rypy
.
	`log
('MuÉ¬t; s¹: %r, stİ: %r' % (
¡¬t
, 
¡İ
),

204 
y›ld
 
	`Áob
("--" + 
bound¬y
, 'ascii')

205 
y›ld
 
	`Áob
("\r\nCÚ‹Á-ty³: %s" % 
cÚ‹Á_ty³
, 'ascii')

206 
y›ld
 
	`Áob
("\r\nContent-range: bytes %s-%s/%s\r\n\r\n"

207 % (
¡¬t
, 
¡İ
 - 1, 
cÚ‹Á_Ëngth
), 'ascii')

208 
feobj
.
	$£ek
(
¡¬t
)

209 
chunk
 
š
 
	`fe_g’”©Ü_lim™ed
(
feobj
, 
¡İ
-
¡¬t
):

210 
y›ld
 
chunk


211 
y›ld
 
	`Áob
("\r\n")

212 #Fš® 
bound¬y


213 
y›ld
 
	`Áob
("--" + 
bound¬y
 + "--", 'ascii')

215 #A·ch
com·tib™y
:

216 
y›ld
 
	`Áob
("\r\n")

217 
»¥Ú£
.
body
 = 
	$fe_¿nges
()

218  
»¥Ú£
.
body


220 
debug
:

221 
ch”rypy
.
	`log
('No byteranges„equested', 'TOOLS.STATIC')

223 #S‘ 
CÚ‹Á
-
L’gth
 
ªd
 
u£
 
ª
 
	`™”abË
 (
fe
 
objeù
)

224 #thi 
way
 
CP
 
wÚ
't†oadhe whole file in memory

225 
»¥Ú£
.
h—d”s
['CÚ‹Á-L’gth'] = 
cÚ‹Á_Ëngth


226 
»¥Ú£
.
body
 = 
feobj


227  
»¥Ú£
.
body


229 
def
 
	$£rve_dowÆßd
(
·th
, 
Çme
=
NÚe
):

231 #Thi 
is
 
such
 
a
 
commÚ
 
idiom
 
I
 
ãÉ
 
™
 
de£rved
 
™s
 
own
 
w¿µ”
.

232  
	`£rve_fe
(
·th
, "­¶iÿtiÚ/x-dowÆßd", "©chm’t", 
Çme
)

235 
def
 
	$_©‹m±
(
f’ame
, 
cÚ‹Á_ty³s
, 
debug
=
F®£
):

236 
debug
:

237 
ch”rypy
.
	`log
('Attempting %r (content_types %r)' %

238 (
f’ame
, 
cÚ‹Á_ty³s
), 'TOOLS.STATICDIR')

239 
Œy
:

240 #you 
ÿn
 
£t
 
the
 
cÚ‹Á
 
ty³s
 
a


241 #com¶‘
dœeùÜy
 
³r
 
ex‹nsiÚ


242 
cÚ‹Á_ty³
 = 
NÚe


243 
cÚ‹Á_ty³s
:

244 
r
, 
ext
 = 
os
.
·th
.
	$¥l™ext
(
f’ame
)

245 
cÚ‹Á_ty³
 = 
cÚ‹Á_ty³s
.
	`g‘
(
ext
[1:], 
NÚe
)

246 
	$£rve_fe
(
f’ame
, 
cÚ‹Á_ty³
=cÚ‹Á_ty³, 
debug
=debug)

247  
True


248 
exû±
 
ch”rypy
.
NÙFound
:

249 #Ià
we
 
didn
't findhe static file, continue handlinghe

250 #»que¡. 
We
 
might
 
fšd
 
a
 
dyÇmic
 
hªdËr
 
š¡—d
.

251 
debug
:

252 
ch”rypy
.
	`log
('NotFound', 'TOOLS.STATICFILE')

253  
F®£


255 
def
 
	`¡©icdœ
(
£ùiÚ
, 
dœ
, 
roÙ
="", 
m©ch
="", 
cÚ‹Á_ty³s
=
NÚe
, 
šdex
="",

256 
debug
=
F®£
):

259 
m©ch


260 
If
 
giv’
, 
»que¡
.
·th_šfo
 
wl
 
be
 
£¬ched
 
the
 given

261 
»guÏr
 
ex´essiÚ
 
befÜe
 
©‹m±šg
 
to
 
£rve
 
cÚ‹Á
.

263 
cÚ‹Á_ty³s


264 
If
 
giv’
, 
™
 
should
 
be
 
a
 
PythÚ
 
diùiÚ¬y
 
of


265 {
fe
-
ex‹nsiÚ
: 
cÚ‹Á
-
ty³
}…aœs, wh”'fe-ex‹nsiÚ' is

266 
a
 
¡ršg
 (
e
.
g
. "gif"è
	gªd
 'cÚ‹Á-ty³' 
is
 
the
 
v®ue
 
to
 
wr™e


267 
out
 
š
 
the
 
	gCÚ‹Á
-
Ty³
 
»¥Ú£
 
h—d”
 (
e
.
g
. "image/gif").

269 
šdex


270 
If
 
	g´ovided
, 
™
 
should
 
be
 
	$the
 (
»Ïtive
è
Çme
 
of
 
a
 
fe
 
to


271 
£rve
 
dœeùÜy
 
»que¡s
. 
FÜ
 
exam¶e
, 
the
 
dœ
 
¬gum’t
 
is


272 '/home/me', 
the
 
Reque¡
-
URI
 
is
 'my­p', 
ªd
h
šdex
 
¬g
 is

273 'šdex.html', 
the
 
fe
 '/home/me/my­p/šdex.html' 
wl
 
be
 
sought
.

275 
»que¡
 = 
ch”rypy
.
£rvšg
.request

276 
»que¡
.
m‘hod
 
nÙ
 
	`š
 ('GET', 'HEAD'):

277 
debug
:

278 
ch”rypy
.
	`log
('request.method‚ot GET or HEAD', 'TOOLS.STATICDIR')

279  
F®£


281 
m©ch
 
ªd
 
nÙ
 
»
.
	$£¬ch
(
m©ch
, 
»que¡
.
·th_šfo
):

282 
debug
:

283 
ch”rypy
.
	`log
('request.path_info %r does‚ot match…attern %r' %

284 (
»que¡
.
·th_šfo
, 
m©ch
), 'TOOLS.STATICDIR')

285  
F®£


287 #AÎow 
the
 
u£
 
of
 '~' 
to
 
»ãr
Ø
a
 
u£r
's home directory.

288 
dœ
 = 
os
.
·th
.
	$ex·ndu£r
(
dœ
)

290 #Ià
dœ
 
is
 
»Ïtive
, 
make
 
absŞu‹
 
usšg
 "root".

291 
nÙ
 
os
.
·th
.
	$i§bs
(
dœ
):

292 
nÙ
 
roÙ
:

293 
msg
 = "Static dir„equires‡n‡bsolute dir (or„oot)."

294 
debug
:

295 
ch”rypy
.
	`log
(
msg
, 'TOOLS.STATICDIR')

296 
¿i£
 
	$V®ueE¼Ü
(
msg
)

297 
dœ
 = 
os
.
·th
.
	$još
(
roÙ
, 
dœ
)

299 #D‘”mš
wh”e
 
we
 
¬e
 
š
 
the
 
objeù
 
Œ“
 
»Ïtive
 
to
 'section'

300 #(
wh”e
 
the
 
toŞ
 
was
 
defšed
).

301 
£ùiÚ
 == 'global':

302 
£ùiÚ
 = "/"

303 
£ùiÚ
 = seùiÚ.
	`r¡r
(
r
"\/")

304 
b¿nch
 = 
»que¡
.
·th_šfo
[
	`Ën
(
£ùiÚ
) + 1:]

305 
b¿nch
 = 
	`unquÙe
(b¿nch.
	`l¡r
(
r
"\/"))

307 #Ià
b¿nch
 
is
 "", 
f’ame
 
wl
 
’d
 
š
 
a
 
¦ash


308 
f’ame
 = 
os
.
·th
.
	$još
(
dœ
, 
b¿nch
)

309 
debug
:

310 
ch”rypy
.
	`log
('Checking file %ro fulfill %r' %

311 (
f’ame
, 
»que¡
.
·th_šfo
), 'TOOLS.STATICDIR')

314 #hav".." 
Ü
 
sim¬
 
u¶ev–
 
©cks
 
š
 
™
. 
Check
 
th©
 
the
 
fš®


315 #f’am
is
 
a
 
chd
 
of
 
dœ
.

316 
nÙ
 
os
.
·th
.
	`nÜm·th
(
f’ame
).
	`¡¬tsw™h
(os.·th.
	$nÜm·th
(
dœ
)):

317 
¿i£
 
ch”rypy
.
	$HTTPE¼Ü
(403) #Forbidden

319 
hªdËd
 = 
	$_©‹m±
(
f’ame
, 
cÚ‹Á_ty³s
)

320 
nÙ
 
hªdËd
:

321 #Check 
ª
 
šdex
 
fe
 
a
 
fŞd”
 
was
 
»que¡ed
.

322 
šdex
:

323 
hªdËd
 = 
	`_©‹m±
(
os
.
·th
.
	`još
(
f’ame
, 
šdex
), 
cÚ‹Á_ty³s
)

324 
hªdËd
:

325 
»que¡
.
is_šdex
 = 
f’ame
[-1] 
	`š
 (
r
"\/")

326  
hªdËd


328 
def
 
	`¡©icfe
(
f’ame
, 
roÙ
=
NÚe
, 
m©ch
="", 
cÚ‹Á_ty³s
=NÚe, 
debug
=
F®£
):

331 
m©ch


332 
If
 
giv’
, 
»que¡
.
·th_šfo
 
wl
 
be
 
£¬ched
 
the
 given

333 
»guÏr
 
ex´essiÚ
 
befÜe
 
©‹m±šg
 
to
 
£rve
 
cÚ‹Á
.

335 
cÚ‹Á_ty³s


336 
If
 
giv’
, 
™
 
should
 
be
 
a
 
PythÚ
 
diùiÚ¬y
 
of


337 {
fe
-
ex‹nsiÚ
: 
cÚ‹Á
-
ty³
}…aœs, wh”'fe-ex‹nsiÚ' is

338 
a
 
¡ršg
 (
e
.
g
. "gif"è
	gªd
 'cÚ‹Á-ty³' 
is
 
the
 
v®ue
 
to
 
wr™e


339 
out
 
š
 
the
 
	gCÚ‹Á
-
Ty³
 
»¥Ú£
 
h—d”
 (
e
.
g
. "image/gif").

342 
	g»que¡
 = 
ch”rypy
.
£rvšg
.
»que¡


343 
»que¡
.
m‘hod
 
nÙ
 
š
 ('GET', 'HEAD'):

344 
debug
:

345 
ch”rypy
.
log
('request.method‚ot GET or HEAD', 'TOOLS.STATICFILE')

346  
F®£


348 
m©ch
 
ªd
 
nÙ
 
	g»
.
	$£¬ch
(
m©ch
, 
»que¡
.
·th_šfo
):

349 
debug
:

350 
ch”rypy
.
	`log
('request.path_info %r does‚ot match…attern %r' %

351 (
»que¡
.
·th_šfo
, 
m©ch
), 'TOOLS.STATICFILE')

352  
F®£


354 #Ià
f’ame
 
is
 
»Ïtive
, 
make
 
absŞu‹
 
usšg
 "root".

355 
nÙ
 
os
.
·th
.
	$i§bs
(
f’ame
):

356 
nÙ
 
roÙ
:

357 
msg
 = "StiøtoŞ„equœe ª‡bsŞu‹ f’am(gÙ '%s')." % 
f’ame


358 
debug
:

359 
ch”rypy
.
	`log
(
msg
, 'TOOLS.STATICFILE')

360 
¿i£
 
	$V®ueE¼Ü
(
msg
)

361 
f’ame
 = 
os
.
·th
.
	$još
(
roÙ
, 
f’ame
)

363  
	`_©‹m±
(
f’ame
, 
cÚ‹Á_ty³s
, 
debug
=debug)

	@trunk/objs/CherryPy-3.2.4/cherrypy/lib/xmlrpcutil.py

1 
impÜt
 
sys


3 
impÜt
 
ch”rypy


4 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
Áob


6 
def
 
	$g‘_xmÌpşib
():

7 
Œy
:

8 
impÜt
 
xmÌpc
.
ş›Á
 
as
 
x


9 
exû±
 
ImpÜtE¼Ü
:

10 
impÜt
 
xmÌpşib
 
as
 
x


11  
x


13 
def
 
	$´oûss_body
():

15 
Œy
:

16  
	`g‘_xmÌpşib
().
	`lßds
(
ch”rypy
.
»que¡
.
body
.
	$»ad
())

17 
exû±
 
Exû±iÚ
:

21 
def
 
	$·tched_·th
(
·th
):

23 
nÙ
 
·th
.
	`’dsw™h
('/'):

24 
·th
 += '/'

25 
·th
.
	`¡¬tsw™h
('/RPC2/'):

26 #¡r 
the
 
fœ¡
 /
½c2


27 
·th
 =…ath[5:]

28  
·th


31 
def
 
	$_£t_»¥Ú£
(
body
):

32 #Th
XML
-
RPC
 
	`¥ec
 (
h‰p
:

33 #"
UÆess
 
th”e
's‡†ower-levelƒrror,‡lways„eturn 200 OK."

34 #Sšû 
PythÚ
's xmlrpclib interprets‡‚on-200„esponse

35 #a 
a
 "PrÙocŞ E¼Ü", 
we
'll just„eturn 200ƒveryime.

36 
»¥Ú£
 = 
ch”rypy
.response

37 
»¥Ú£
.
¡©us
 = '200 OK'

38 
»¥Ú£
.
body
 = 
	`Áob
(body, 'utf-8')

39 
»¥Ú£
.
h—d”s
['Content-Type'] = 'text/xml'

40 
»¥Ú£
.
h—d”s
['CÚ‹Á-L’gth'] = 
	$Ën
(
body
)

43 
def
 
	`»¥Úd
(
body
, 
’codšg
='utf-8', 
®low_nÚe
=0):

44 
xmÌpşib
 = 
	$g‘_xmÌpşib
()

45 
nÙ
 
	$isš¡ªû
(
body
, 
xmÌpşib
.
FauÉ
):

46 
body
 = (body,)

47 
	`_£t_»¥Ú£
(
xmÌpşib
.
	$dumps
(
body
, 
m‘hod»¥Ú£
=1,

48 
’codšg
=encoding,

49 
®low_nÚe
=allow_none))

51 
def
 
	$Ú_”rÜ
(*
¬gs
, **
kw¬gs
):

52 
body
 = 
	`¡r
(
sys
.
	`exc_šfo
()[1])

53 
xmÌpşib
 = 
	$g‘_xmÌpşib
()

54 
	`_£t_»¥Ú£
(
xmÌpşib
.
	`dumps
(xmÌpşib.
	`FauÉ
(1, 
body
)))

	@trunk/objs/CherryPy-3.2.4/cherrypy/process/__init__.py

3 
A
 
Web
 
S™e
 
Proûss
 
Bus
 
objeù
 
is
 
u£d
 
to
 
cÚÃù
 
	g­¶iÿtiÚs
, 
	g£rv”s
,

4 
ªd
 
äamewÜks
 
w™h
 
	gs™e
-
wide
 
£rviûs
 
such
 
as
 
	gd«mÚiz©iÚ
, 
´oûss


5 
	g»lßd
, 
sigÇl
 
	ghªdlšg
, 
drİ
 
	g´iveges
, 
PID
 
fe
 
	gmªagem’t
, 
loggšg


6 
®l
 
of
 
	gthe£
, 
ªd
 
mªy
 
	gmÜe
.

8 
	gThe
 '¶ugšs' 
moduË
 
defšes
 
a
 
ãw
 
ab¡¿ù
 
ªd
 
cÚü‘e
 
£rviûs
 

9 
u£
 
w™h
 
the
 
	gbus
. 
Some
 u£ 
	gtoŞ
-
¥ecific
 
	gchªÃls
; 
£e
h
docum’tiÚ


10 
—ch
 
	gşass
.

13 
äom
 
	gch”rypy
.
	g´oûss
.
w¥bus
 
impÜt
 
bus


14 
äom
 
	gch”rypy
.
´oûss
 
impÜt
 
	g¶ugšs
, 
	g£rv”s


	@trunk/objs/CherryPy-3.2.4/cherrypy/process/plugins.py

3 
impÜt
 
os


4 
impÜt
 
»


5 
impÜt
 
sigÇl
 
as
 
_sigÇl


6 
impÜt
 
sys


7 
impÜt
 
time


8 
impÜt
 
th»adšg


10 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
	gba£¡ršg
, 
	gg‘_d«mÚ
, 
	gg‘_th»ad_id’t
, 
	gÁob
, 
	g£t
, 
	gTim”
, 
	gS‘D«mÚPrİ”ty


12 #_moduË__fe__ba£ 
is
 
u£d
 
by
 
AutÜ–ßd
 
to
 
make


13 #absŞu‹ 
ªy
 
f’ames
 
»Œ›ved
 
äom
 
sys
.
moduËs
 
which
 
¬e
 
nÙ


14 #®»ady 
absŞu‹
 
·ths
. 
This
 
is
 
to
 
wÜk
 
¬ound
 
PythÚ
's quirk

15 #oà
impÜtšg
 
the
 
¡¬tup
 
süt
 
ªd
 
usšg
 
a
 
»Ïtive
 
f’ame


16 #fÜ 
™
 
š
 
sys
.
moduËs
.

17 #
#AutÜ–ßd 
examšes
 
sys
.
moduËs
 
aäesh
 
ev”y
 
time
 
™
 
runs
. 
If
 
ª
 
­¶iÿtiÚ


18 #chªge 
the
 
cu¼’t
 
dœeùÜy
 
by
 
executšg
 
os
.
chdœ
(), 
th’
h
Ãxt
 
time


19 #AutÜ–ßd 
runs
, 
™
 
wl
 
nÙ
 
be
 
abË
 
to
 
fšd
 
ªy
 
f’ames
 
which
 
¬e


20 #nÙ 
absŞu‹
 
·ths
, 
beÿu£
 
the
 
cu¼’t
 
dœeùÜy
 
is
 
nÙ
h
§me
 
as
 
wh’
he

21 #moduË 
was
 
fœ¡
 
impÜ‹d
. 
AutÜ–ßd
 
wl
 
th’
 
wrÚgly
 
cÚşude
 
the
 
fe
 
has


22 #"
chªged
",‡nd initiatehe shutdown/re-exec sequence.

23 #S“ 
tick‘
 #917.

24 #FÜ 
this
 
wÜk¬ound
 
to
 
have
 
a
 
deûÁ
 
´obab™y
 
of
 
sucûss
,hi 
moduË


25 #Ãed 
to
 
be
 
impÜ‹d
 
as
 
—¾y
‡ 
possibË
, 
befÜe
 
the
 
­p
 
has
 
much
 
chªû


26 #tØ
chªge
 
the
 
wÜkšg
 
dœeùÜy
.

27 
	g_moduË__fe__ba£
 = 
os
.
	$g‘cwd
()

30 
şass
 
	$Sim¶ePlugš
(
objeù
):

33 
bus
 = 
NÚe


36 
def
 
	$__š™__
(
£lf
, 
bus
):

37 
£lf
.
bus
 = bus

39 
def
 
	$subsüibe
(
£lf
):

41 
chªÃl
 
š
 
£lf
.
bus
.
li¡’”s
:

42 #Subsüib
£lf
.
¡¬t
, s–f.
ex™
, 
‘c
. 
´e£Á
.

43 
m‘hod
 = 
	$g‘©Œ
(
£lf
, 
chªÃl
, 
NÚe
)

44 
m‘hod
 
is
 
nÙ
 
NÚe
:

45 
£lf
.
bus
.
	$subsüibe
(
chªÃl
, 
m‘hod
)

47 
def
 
	$unsubsüibe
(
£lf
):

49 
chªÃl
 
š
 
£lf
.
bus
.
li¡’”s
:

50 #Unsubsüib
£lf
.
¡¬t
, s–f.
ex™
, 
‘c
. 
´e£Á
.

51 
m‘hod
 = 
	$g‘©Œ
(
£lf
, 
chªÃl
, 
NÚe
)

52 
m‘hod
 
is
 
nÙ
 
NÚe
:

53 
£lf
.
bus
.
	$unsubsüibe
(
chªÃl
, 
m‘hod
)

57 
şass
 
	$SigÇlHªdËr
(
objeù
):

60 
You
 
ÿn
 
modify
 
wh©
 
sigÇls
 
your
 
­¶iÿtiÚ
 
li¡’s
 , 
ªd
 wh© 
™
 
dÛs


61 
wh’
 
™
 
»ûives
 
sigÇls
, 
by
 
modifyšg
 :
©Œ
:`
SigÇlHªdËr
.
hªdËrs
`,

62 
a
 
diù
 
of
 {
sigÇl
 
Çme
: 
ÿÎback
}…aœs. Th s‘ is::

64 
hªdËrs
 = {'SIGTERM': 
£lf
.
bus
.
ex™
,

65 'SIGHUP': 
£lf
.
hªdË_SIGHUP
,

66 'SIGUSR1': 
£lf
.
bus
.
g¿ûful
,

69 
The
 :
func
:`
SigÇlHªdËr
.
hªdË_SIGHUP
`` 
m‘hod
 
ÿÎs


70 :
func
:`
bus
.
»¡¬t
()<
ch”rypy
.
´oûss
.
w¥bus
.
Bus
.restart>`

71 
the
 
´oûss
 
is
 
d«mÚized
, 
	gbut


72 :
func
:`
bus
.
ex™
()<
ch”rypy
.
´oûss
.
w¥bus
.
Bus
.exit>`

73 
the
 
´oûss
 
is
 
©ched
 
to
 
a
 
TTY
. 
This
 i 
beÿu£
 
Unix
 
wšdow


74 
mªag”s
 
‹nd
 
to
 
£nd
 
SIGHUP
Ø
‹rmš®
 
wšdows
 
wh’
 
the
 
u£r
 
şo£s
 
them
.

76 
F“l
 
ä“
 
to
 
add
 
sigÇls
 
which
 
¬e
 
nÙ
 
avaabË
 
Ú
 
ev”y
 
¶©fÜm
. 
The


77 :
şass
:`
SigÇlHªdËr
` 
wl
 
ignÜe
 
”rÜs
 
¿i£d
 
äom
 
©‹m±šg
 
to
 

78 
hªdËrs
 
unknown
 
sigÇls
.

81 
hªdËrs
 = {}

84 
sigÇls
 = {}

87 
k
, 
v
 
š
 
v¬s
(
_sigÇl
).
	$™ems
():

88 
k
.
	`¡¬tsw™h
('SIG'è
ªd
 
nÙ
 k.startswith('SIG_'):

89 
sigÇls
[
v
] = 
k


90 
d–
 
k
, 
v


92 
def
 
	$__š™__
(
£lf
, 
bus
):

93 
£lf
.
bus
 = bus

94 #S‘  
hªdËrs


95 
£lf
.
hªdËrs
 = {'SIGTERM': s–f.
bus
.
ex™
,

96 'SIGHUP': 
£lf
.
hªdË_SIGHUP
,

97 'SIGUSR1': 
£lf
.
bus
.
g¿ûful
,

98 
	}
}

100 
sys
.
¶©fÜm
[:4] == 'java':

101 
d–
 
£lf
.
hªdËrs
['SIGUSR1']

102 
£lf
.
hªdËrs
['SIGUSR2'] = s–f.
bus
.
g¿ûful


103 
£lf
.
bus
.
log
("SIGUSR1 cannot be set onhe JVM…latform. "

105 
£lf
.
hªdËrs
['SIGINT'] = s–f.
_jythÚ_SIGINT_hªdËr


107 
£lf
.
_´evious_hªdËrs
 = {}

109 
def
 
	$_jythÚ_SIGINT_hªdËr
(
£lf
, 
signum
=
NÚe
, 
äame
=None):

110 #S“ 
h‰p
:

111 
£lf
.
bus
.
	`log
('Keyboard Interrupt: shutting down bus')

112 
£lf
.
bus
.
	$ex™
()

114 
def
 
	$subsüibe
(
£lf
):

116 
sig
, 
func
 
š
 
£lf
.
hªdËrs
.
	$™ems
():

117 
Œy
:

118 
£lf
.
	$£t_hªdËr
(
sig
, 
func
)

119 
exû±
 
V®ueE¼Ü
:

120 
·ss


122 
def
 
	$unsubsüibe
(
£lf
):

124 
signum
, 
hªdËr
 
š
 
£lf
.
_´evious_hªdËrs
.
	$™ems
():

125 
sigÇme
 = 
£lf
.
sigÇls
[
signum
]

127 
hªdËr
 
is
 
NÚe
:

128 
£lf
.
bus
.
	`log
("Re¡Üšg % hªdË¸tØSIG_DFL." % 
sigÇme
)

129 
hªdËr
 = 
_sigÇl
.
SIG_DFL


131 
£lf
.
bus
.
	`log
("Re¡Üšg % hªdË¸%r." % (
sigÇme
, 
hªdËr
))

133 
Œy
:

134 
our_hªdËr
 = 
_sigÇl
.
	$sigÇl
(
signum
, 
hªdËr
)

135 
our_hªdËr
 
is
 
NÚe
:

136 
£lf
.
bus
.
	`log
("Restored old %s handler %r, but our "

138 (
sigÇme
, 
hªdËr
), 
Ëv–
=30)

139 
exû±
 
V®ueE¼Ü
:

140 
£lf
.
bus
.
	`log
("Unableo„estore %s handler %r." %

141 (
sigÇme
, 
hªdËr
), 
Ëv–
=40, 
Œaûback
=
True
)

143 
def
 
	$£t_hªdËr
(
£lf
, 
sigÇl
, 
li¡’”
=
NÚe
):

146 
If
 
the
 
İtiÚ®
 'li¡’”' 
¬gum’t
 
is
 
´ovided
, 
™
 
wl
 
be


147 
subsüibed
 
as
 
a
 
li¡’”
 
the
 
giv’
 
sigÇl
's channel.

149 
If
 
the
 
giv’
 
sigÇl
 
Çme
 
Ü
 
numb”
 
is
 
nÙ
 
avaabË
 
Ú
h
cu¼’t


150 
¶©fÜm
, 
V®ueE¼Ü
 
is
 
¿i£d
.

152 
	$isš¡ªû
(
sigÇl
, 
ba£¡ršg
):

153 
signum
 = 
	$g‘©Œ
(
_sigÇl
, 
sigÇl
, 
NÚe
)

154 
signum
 
is
 
NÚe
:

155 
¿i£
 
	`V®ueE¼Ü
("NØsuch sigÇl: %r" % 
sigÇl
)

156 
sigÇme
 = 
sigÇl


158 
Œy
:

159 
sigÇme
 = 
£lf
.
sigÇls
[
sigÇl
]

160 
exû±
 
KeyE¼Ü
:

161 
¿i£
 
	`V®ueE¼Ü
("NØsuch sigÇl: %r" % 
sigÇl
)

162 
signum
 = 
sigÇl


164 
´ev
 = 
_sigÇl
.
	$sigÇl
(
signum
, 
£lf
.
_hªdË_sigÇl
)

165 
£lf
.
_´evious_hªdËrs
[
signum
] = 
´ev


167 
li¡’”
 
is
 
nÙ
 
NÚe
:

168 
£lf
.
bus
.
	`log
("Li¡’šg fÜ %s." % 
sigÇme
)

169 
£lf
.
bus
.
	$subsüibe
(
sigÇme
, 
li¡’”
)

171 
def
 
	$_hªdË_sigÇl
(
£lf
, 
signum
=
NÚe
, 
äame
=None):

173 
sigÇme
 = 
£lf
.
sigÇls
[
signum
]

174 
£lf
.
bus
.
	`log
("CaughˆsigÇÈ%s." % 
sigÇme
)

175 
£lf
.
bus
.
	$publish
(
sigÇme
)

177 
def
 
	$hªdË_SIGHUP
(
£lf
):

179 
os
.
	`i§‰y
(
sys
.
¡dš
.
	$f’o
()):

180 #nÙ 
	`d«mÚized
 (
may
 
be
 
fÜeground
 
Ü
 
background
)

181 
£lf
.
bus
.
	`log
("SIGHUP caught but‚ot daemonized. Exiting.")

182 
£lf
.
bus
.
	$ex™
()

184 
£lf
.
bus
.
	`log
("SIGHUP caught while daemonized. Restarting.")

185 
£lf
.
bus
.
	$»¡¬t
()

188 
Œy
:

189 
impÜt
 
pwd
, 
g½


190 
exû±
 
ImpÜtE¼Ü
:

191 
pwd
, 
g½
 = 
NÚe
, None

194 
şass
 
	$DrİPriveges
(
Sim¶ePlugš
):

197 
S³cŸl
 
thªks
 
to
 
Gavš
 
Bak”
: 
h‰p
:

200 
def
 
	$__š™__
(
£lf
, 
bus
, 
umask
=
NÚe
, 
uid
=NÚe, 
gid
=None):

201 
Sim¶ePlugš
.
	$__š™__
(
£lf
, 
bus
)

202 
£lf
.
fš®ized
 = 
F®£


203 
£lf
.
uid
 = uid

204 
£lf
.
gid
 = gid

205 
£lf
.
umask
 = umask

207 
def
 
	$_g‘_uid
(
£lf
):

208  
£lf
.
_uid


209 
def
 
	$_£t_uid
(
£lf
, 
v®
):

210 
v®
 
is
 
nÙ
 
NÚe
:

211 
pwd
 
is
 
NÚe
:

212 
£lf
.
bus
.
	`log
("pwd module‚ot‡vailable; ignoring uid.",

213 
Ëv–
=30)

214 
v®
 = 
NÚe


215 
–if
 
	$isš¡ªû
(
v®
, 
ba£¡ršg
):

216 
v®
 = 
pwd
.
	`g‘pwÇm
(val)[2]

217 
£lf
.
_uid
 = 
v®


218 
uid
 = 
	`´İ”ty
(
_g‘_uid
, 
_£t_uid
,

219 
doc
="The uid under whicho„un. Availability: Unix.")

221 
def
 
	$_g‘_gid
(
£lf
):

222  
£lf
.
_gid


223 
def
 
	$_£t_gid
(
£lf
, 
v®
):

224 
v®
 
is
 
nÙ
 
NÚe
:

225 
g½
 
is
 
NÚe
:

226 
£lf
.
bus
.
	`log
("grp module‚ot‡vailable; ignoring gid.",

227 
Ëv–
=30)

228 
v®
 = 
NÚe


229 
–if
 
	$isš¡ªû
(
v®
, 
ba£¡ršg
):

230 
v®
 = 
g½
.
	`g‘gºam
(val)[2]

231 
£lf
.
_gid
 = 
v®


232 
gid
 = 
	`´İ”ty
(
_g‘_gid
, 
_£t_gid
,

233 
doc
="The gid under whicho„un. Availability: Unix.")

235 
def
 
	$_g‘_umask
(
£lf
):

236  
£lf
.
_umask


237 
def
 
	$_£t_umask
(
£lf
, 
v®
):

238 
v®
 
is
 
nÙ
 
NÚe
:

239 
Œy
:

240 
os
.
umask


241 
exû±
 
A‰ribu‹E¼Ü
:

242 
£lf
.
bus
.
	`log
("umask function‚ot‡vailable; ignoring umask.",

243 
Ëv–
=30)

244 
v®
 = 
NÚe


245 
£lf
.
_umask
 = 
v®


246 
umask
 = 
	`´İ”ty
(
_g‘_umask
, 
_£t_umask
,

247 
doc
="""The default…ermission mode for‚ewly created files‡nd directories.

249 
Usu®ly
 
ex´es£d
 
š
 
où®
 
fÜm©
, 
exam¶e
, ``0644``.

250 
Avaab™y
: 
Unix
, 
Wšdows
.

253 
def
 
	$¡¬t
(
£lf
):

254 #uid/
gid


255 
def
 
	$cu¼’t_ids
():

257 
Çme
, 
group
 = 
NÚe
, None

258 
pwd
:

259 
Çme
 = 
pwd
.
	`g‘pwuid
(
os
.
	`g‘uid
())[0]

260 
g½
:

261 
group
 = 
g½
.
	`g‘grgid
(
os
.
	`g‘gid
())[0]

262  
Çme
, 
group


264 
£lf
.
fš®ized
:

265 
	$nÙ
 (
£lf
.
uid
 
is
 
NÚe
 
ªd
 s–f.
gid
 is None):

266 
£lf
.
bus
.
	`log
('Already„unning‡s uid: %r gid: %r' %

267 
	$cu¼’t_ids
())

269 
£lf
.
uid
 
is
 
NÚe
 
ªd
 s–f.
gid
 is None:

270 
pwd
 
Ü
 
g½
:

271 
£lf
.
bus
.
	`log
('uid/gid‚Ù s‘', 
Ëv–
=30)

273 
£lf
.
bus
.
	`log
('S¹ed‡ uid: %¸gid: %r' % 
	$cu¼’t_ids
())

274 
£lf
.
gid
 
is
 
nÙ
 
NÚe
:

275 
os
.
	$£tgid
(
£lf
.
gid
)

276 
os
.
	$£tgroups
([])

277 
£lf
.
uid
 
is
 
nÙ
 
NÚe
:

278 
os
.
	$£tuid
(
£lf
.
uid
)

279 
£lf
.
bus
.
	`log
('RuÂšg‡ uid: %¸gid: %r' % 
	$cu¼’t_ids
())

282 
£lf
.
fš®ized
:

283 
£lf
.
umask
 
is
 
nÙ
 
NÚe
:

284 
£lf
.
bus
.
	`log
('umask‡Ì—dy s‘o: %03o' % s–f.
umask
)

286 
£lf
.
umask
 
is
 
NÚe
:

287 
£lf
.
bus
.
	`log
('umask‚Ù s‘', 
Ëv–
=30)

289 
Şd_umask
 = 
os
.
	$umask
(
£lf
.
umask
)

290 
£lf
.
bus
.
	`log
('umask old: %03o,‚ew: %03o' %

291 (
Şd_umask
, 
£lf
.
umask
))

293 
£lf
.
fš®ized
 = 
True


294 #Thi 
is
 
¦ighy
 
high”
 
thª
 
the
 
´iÜ™y
 
£rv”
.
¡¬t


295 #š 
Üd”
 
to
 
çc™©e
 
the
 
mo¡
 
commÚ
 
u£
: 
¡¬tšg
 
Ú
 
a
 
low


296 #pÜˆ(
which
 
»quœes
 
roÙ
è
ªd
 
th’
 
drİpšg
 
to
 
ªÙh”
 
u£r
.

297 
¡¬t
.
´iÜ™y
 = 77

300 
şass
 
	$D«mÚiz”
(
Sim¶ePlugš
):

303 
U£
 
this
 
w™h
 
a
 
Web
 
S™e
 
Proûss
 
Bus
 
vŸ
::

305 
	`D«mÚiz”
(
bus
).
	$subsüibe
()

307 
Wh’
 
this
 
compÚ’t
 
fšishes
, 
the
 
´oûss
 
is
 
com¶‘–y
 
decou¶ed
 
äom


308 
the
 
·»Á
 
’vœÚm’t
. 
PËa£
 
nÙe
 
th©
 
wh’
 
this
 
compÚ’t
 
is
 
u£d
,

309 
the
  
code
 
äom
h
·»Á
 
´oûss
 
wl
 
¡l
 
be
 0 
a
 
¡¬tup


310 
”rÜ
 
occurs
 
š
 
the
 
fÜked
 
chd»n
. 
E¼Üs
 iÀth
š™Ÿl
 
d«mÚizšg


311 
´oûss
 
¡l
  
´İ”
 
ex™
 
codes
. 
Th”efÜe
, 
you
 
u£
 
this


312 
¶ugš
 
to
 
d«mÚize
, 
dÚ
't usehe„eturn code‡s‡n‡ccurate indicator

313 
of
 
wh‘h”
 
the
 
´oûss
 
fuÎy
 
¡¬‹d
. 
In
 
çù
, 
th©
  
code
 
Úly


314 
šdiÿ‹s
 
the
 
´oûss
 
sucûsfuÎy
 
fšished
h
fœ¡
 
fÜk
.

317 
def
 
	`__š™__
(
£lf
, 
bus
, 
¡dš
='/dev/nuÎ', 
¡dout
='/dev/null',

318 
¡d”r
='/dev/null'):

319 
Sim¶ePlugš
.
	$__š™__
(
£lf
, 
bus
)

320 
£lf
.
¡dš
 = stdin

321 
£lf
.
¡dout
 = stdout

322 
£lf
.
¡d”r
 = stderr

323 
£lf
.
fš®ized
 = 
F®£


325 
def
 
	$¡¬t
(
£lf
):

326 
£lf
.
fš®ized
:

327 
£lf
.
bus
.
	`log
('Already deamonized.')

329 #fÜkšg 
has
 
issues
 
w™h
 
th»ads
:

331 #"
The
 
g’”®
 
´obËm
 
w™h
 
makšg
 
	`fÜk
(è
wÜk
 
š
 
a
 
muÉi
-
th»aded


332 #wÜld 
is
 
wh©
 
to
 dØ
w™h
 
®l
 
of
 
the
 
th»ads
..."

333 #SØ
we
 
check
 
aùive
 
th»ads
:

334 
th»adšg
.
	`aùiveCouÁ
() != 1:

335 
£lf
.
bus
.
	`log
('There‡re %r‡ctivehreads. '

337 
th»adšg
.
	`’um”©e
(), 
Ëv–
=30)

339 #S“ 
h‰p
:

340 #(
Ü
 
h‰p
:

341 #ªd 
h‰p
:

343 #Fšish 
up
 
w™h
 
the
 
cu¼’t
 
¡dout
/
¡d”r


344 
sys
.
¡dout
.
	$æush
()

345 
sys
.
¡d”r
.
	$æush
()

347 #DØ
fœ¡
 
fÜk
.

348 
Œy
:

349 
pid
 = 
os
.
	$fÜk
()

350 
pid
 == 0:

351 #Thi 
is
 
the
 
chd
 
´oûss
. 
CÚtšue
.

352 
·ss


354 #Thi 
is
 
the
 
fœ¡
 
·»Á
. 
Ex™
, 
now
 
th©
 
we
've forked.

355 
£lf
.
bus
.
	`log
('Forking once.')

356 
os
.
	$_ex™
(0)

357 
exû±
 
OSE¼Ü
:

358 #PythÚ 
¿i£s
 
OSE¼Ü
 
¿th”
 
thª
 
»tuºšg
 
Ãg©ive
 
numb”s
.

359 
exc
 = 
sys
.
	`exc_šfo
()[1]

360 
sys
.
	`ex™
("%s: fork #1 failed: (%d) %s\n"

361 % (
sys
.
¬gv
[0], 
exc
.
”ºo
,ƒxc.
¡»¼Ü
))

363 
os
.
	$£tsid
()

365 #DØ
£cÚd
 
fÜk


366 
Œy
:

367 
pid
 = 
os
.
	$fÜk
()

368 
pid
 > 0:

369 
£lf
.
bus
.
	`log
('Forkingwice.')

370 
os
.
	$_ex™
(0è#Ex™ 
£cÚd
 
·»Á


371 
exû±
 
OSE¼Ü
:

372 
exc
 = 
sys
.
	`exc_šfo
()[1]

373 
sys
.
	`ex™
("%s: fork #2 failed: (%d) %s\n"

374 % (
sys
.
¬gv
[0], 
exc
.
”ºo
,ƒxc.
¡»¼Ü
))

376 
os
.
	`chdœ
("/")

377 
os
.
	$umask
(0)

379 
si
 = 
	`İ’
(
£lf
.
¡dš
, "r")

380 
so
 = 
	`İ’
(
£lf
.
¡dout
, "a+")

381 
£
 = 
	`İ’
(
£lf
.
¡d”r
, "a+")

383 #os.
	`dup2
(
fd
, 
fd2
è
wl
 
şo£
 fd2 
Ãûs§ry
,

384 #sØ
we
 
dÚ
'tƒxplicitly close stdin/out/err.

385 #S“ 
h‰p
:

386 
os
.
	`dup2
(
si
.
	`f’o
(), 
sys
.
¡dš
.
	$f’o
())

387 
os
.
	`dup2
(
so
.
	`f’o
(), 
sys
.
¡dout
.
	$f’o
())

388 
os
.
	`dup2
(
£
.
	`f’o
(), 
sys
.
¡d”r
.
	$f’o
())

390 
£lf
.
bus
.
	`log
('D«mÚizedØPID: %s' % 
os
.
	$g‘pid
())

391 
£lf
.
fš®ized
 = 
True


392 
¡¬t
.
´iÜ™y
 = 65

395 
şass
 
	$PIDFe
(
Sim¶ePlugš
):

398 
def
 
	$__š™__
(
£lf
, 
bus
, 
pidfe
):

399 
Sim¶ePlugš
.
	$__š™__
(
£lf
, 
bus
)

400 
£lf
.
pidfe
 =…idfile

401 
£lf
.
fš®ized
 = 
F®£


403 
def
 
	$¡¬t
(
£lf
):

404 
pid
 = 
os
.
	$g‘pid
()

405 
£lf
.
fš®ized
:

406 
£lf
.
bus
.
	`log
('PID %¸®»ady wr™‹ÀtØ%r.' % (
pid
, s–f.
pidfe
))

408 
	`İ’
(
£lf
.
pidfe
, "wb").
	`wr™e
(
	`Áob
("%s" % 
pid
, 'utf8'))

409 
£lf
.
bus
.
	`log
('PID %¸wr™‹ÀtØ%r.' % (
pid
, s–f.
pidfe
))

410 
£lf
.
fš®ized
 = 
True


411 
¡¬t
.
´iÜ™y
 = 70

413 
def
 
	$ex™
(
£lf
):

414 
Œy
:

415 
os
.
	$»move
(
£lf
.
pidfe
)

416 
£lf
.
bus
.
	`log
('PID f»moved: %r.' % s–f.
pidfe
)

417 
	$exû±
 (
KeybßrdIÁ”ru±
, 
Sy¡emEx™
):

418 
¿i£


419 
exû±
:

420 
·ss


423 
şass
 
	$P”³tu®Tim”
(
Tim”
):

426 
U£
 
this
 
tim”
 
Úly
 
wh’
 
you
 
»®ly
 
Ãed
 
a
 
v”y
 
š‹¼u±ibË
imer;

427 
this
 
checks
 
™s
 'fšished' 
cÚd™iÚ
 
up
 
to
 20 
times
 
a
 
£cÚd
, 
which
 
ÿn


428 
»suÉs
 
š
 
´‘ty
 
high
 
CPU
 
u§ge


431 
def
 
	$__š™__
(
£lf
, *
¬gs
, **
kw¬gs
):

433 
£lf
.
bus
 = 
kw¬gs
.
	`pİ
('bus', 
NÚe
)

434 
	`su³r
(
P”³tu®Tim”
, 
£lf
).
	$__š™__
(*
¬gs
, **
kw¬gs
)

436 
def
 
	$run
(
£lf
):

437 
True
:

438 
£lf
.
fšished
.
	$wa™
(
£lf
.
š‹rv®
)

439 
£lf
.
fšished
.
	$isS‘
():

441 
Œy
:

442 
£lf
.
	$funùiÚ
(*
£lf
.
¬gs
, **£lf.
kw¬gs
)

443 
exû±
 
Exû±iÚ
:

444 
£lf
.
bus
:

445 
£lf
.
bus
.
	`log
(

447 
£lf
.
funùiÚ
, 
Ëv–
=40, 
Œaûback
=
True
)

448 #Qu™ 
Ú
 
fœ¡
 
”rÜ
 
to
 
avoid
 
massive
 
logs
.

449 
¿i£


452 
şass
 
	$BackgroundTask
(
S‘D«mÚPrİ”ty
, 
th»adšg
.
Th»ad
):

455 
U£
 
this
 
şass
 
mo¡
 
»³©šg
 
sks
. 
It
 
u£s
 
time
.
	$¦“p
(è
to
 
wa™


456 
—ch
 
š‹rv®
, 
which
 
i¢
't very„esponsive;hat is,ƒven if you call

457 
£lf
.
	`ÿnûl
(), 
you
'll haveo wait untilhe sleep() call finishes before

458 
the
 
th»ad
 
¡İs
. 
To
 
com³n§‹
, 
™
 
deçuÉs
 
to
 
bešg
 
d«mÚic
, 
which
 
m—ns


459 
™
 
wÚ
't delay stoppinghe whole…rocess.

462 
def
 
	`__š™__
(
£lf
, 
š‹rv®
, 
funùiÚ
, 
¬gs
=[], 
kw¬gs
={
	}
}, 
	gbus
=
NÚe
):

463 
th»adšg
.
Th»ad
.
	$__š™__
(
£lf
)

464 
£lf
.
š‹rv®
 = interval

465 
£lf
.
funùiÚ
 = function

466 
£lf
.
¬gs
 =‡rgs

467 
£lf
.
kw¬gs
 = kwargs

468 
£lf
.
ruÂšg
 = 
F®£


469 
£lf
.
bus
 = bus

471 #deçuÉ 
to
 
d«mÚic


472 
£lf
.
d«mÚ
 = 
True


474 
def
 
	$ÿnûl
(
£lf
):

475 
£lf
.
ruÂšg
 = 
F®£


477 
def
 
	$run
(
£lf
):

478 
£lf
.
ruÂšg
 = 
True


479 
£lf
.
ruÂšg
:

480 
time
.
	$¦“p
(
£lf
.
š‹rv®
)

481 
nÙ
 
£lf
.
ruÂšg
:

483 
Œy
:

484 
£lf
.
	$funùiÚ
(*
£lf
.
¬gs
, **£lf.
kw¬gs
)

485 
exû±
 
Exû±iÚ
:

486 
£lf
.
bus
:

487 
£lf
.
bus
.
	`log
("Error in backgroundaskhread function %r."

488 % 
£lf
.
funùiÚ
, 
Ëv–
=40, 
Œaûback
=
True
)

489 #Qu™ 
Ú
 
fœ¡
 
”rÜ
 
to
 
avoid
 
massive
 
logs
.

490 
¿i£


493 
şass
 
	$MÚ™Ü
(
Sim¶ePlugš
):

496 
ÿÎback
 = 
NÚe


499 
äequ’cy
 = 60

502 
th»ad
 = 
NÚe


505 
def
 
	$__š™__
(
£lf
, 
bus
, 
ÿÎback
, 
äequ’cy
=60, 
Çme
=
NÚe
):

506 
Sim¶ePlugš
.
	$__š™__
(
£lf
, 
bus
)

507 
£lf
.
ÿÎback
 = callback

508 
£lf
.
äequ’cy
 = frequency

509 
£lf
.
th»ad
 = 
NÚe


510 
£lf
.
Çme
 =‚ame

512 
def
 
	$¡¬t
(
£lf
):

514 
£lf
.
äequ’cy
 > 0:

515 
th»adÇme
 = 
£lf
.
Çme
 
Ü
 s–f.
__şass__
.
__Çme__


516 
£lf
.
th»ad
 
is
 
NÚe
:

517 
£lf
.
th»ad
 = 
	$BackgroundTask
(
£lf
.
äequ’cy
, s–f.
ÿÎback
,

518 
bus
 = 
£lf
.bus)

519 
£lf
.
th»ad
.
	$£tName
(
th»adÇme
)

520 
£lf
.
th»ad
.
	$¡¬t
()

521 
£lf
.
bus
.
	`log
("S¹ed mÚ™Üh»ad %r." % 
th»adÇme
)

523 
£lf
.
bus
.
	`log
("MÚ™Üh»ad %¸®»ady s¹ed." % 
th»adÇme
)

524 
¡¬t
.
´iÜ™y
 = 70

526 
def
 
	$¡İ
(
£lf
):

528 
£lf
.
th»ad
 
is
 
NÚe
:

529 
£lf
.
bus
.
	`log
("NØth»ad„uÂšg fÜ %s." % s–f.
Çme
 
Ü
 s–f.
__şass__
.
__Çme__
)

531 
£lf
.
th»ad
 
is
 
nÙ
 
th»adšg
.
	$cu¼’tTh»ad
():

532 
Çme
 = 
£lf
.
th»ad
.
	$g‘Name
()

533 
£lf
.
th»ad
.
	$ÿnûl
()

534 
nÙ
 
	$g‘_d«mÚ
(
£lf
.
th»ad
):

535 
£lf
.
bus
.
	`log
("Joššg %r" % 
Çme
)

536 
£lf
.
th»ad
.
	$još
()

537 
£lf
.
bus
.
	`log
("Stİ³dh»ad %r." % 
Çme
)

538 
£lf
.
th»ad
 = 
NÚe


540 
def
 
	$g¿ûful
(
£lf
):

542 
£lf
.
	$¡İ
()

543 
£lf
.
	$¡¬t
()

546 
şass
 
	$AutÜ–ßd”
(
MÚ™Ü
):

549 
This
 :
»f
:`
¶ugš
<
¶ugšs
>` 
»¡¬ts
 
the
 
	`´oûss
 (
vŸ
 :
func
:`
os
.
execv
`)

550 
ªy
 
of
 
the
 
fes
 
™
 
mÚ™Üs
 
	`chªge
 (
Ü
 
is
 
d–‘ed
). 
By
 ,he

551 
autÜ–ßd”
 
mÚ™Üs
 
®l
 
impÜ‹d
 
moduËs
; 
you
 
ÿn
 
add
 
to
 
the


552 
£t
 
by
 
addšg
 
to
 ``
autÜ–ßd
.
fes
``::

554 
ch”rypy
.
’gše
.
autÜ–ßd
.
fes
.
	$add
(
myFe
)

556 
If
 
th”e
 
¬e
 
impÜ‹d
 
fes
 
you
 dØ*
nÙ
* 
wish
 
to
 
mÚ™Ü
, you 
ÿn
 
adju¡
 
the


557 ``
m©ch
`` 
©Œibu‹
, 
a
 
»guÏr
 
ex´essiÚ
. 
FÜ
 
exam¶e
, 
to
 
¡İ
 
mÚ™Üšg


558 
ch”rypy
 
™£lf
::

560 
ch”rypy
.
’gše
.
autÜ–ßd
.
m©ch
 = 
r
'^(?!cherrypy).+'

562 
Like
 
®l
 :
şass
:`
MÚ™Ü
<
ch”rypy
.
´oûss
.
¶ugšs
.Monitor>`…lugins,

563 
the
 
autÜ–ßd
 
¶ugš
 
kes
 
a
 ``
äequ’cy
`` 
¬gum’t
. 
The
  
is


564 1 
£cÚd
; 
th©
 
is
, 
the
 
autÜ–ßd”
 
wl
 
examše
 
fes
 
Úû
 
—ch
 second.

567 
fes
 = 
NÚe


570 
äequ’cy
 = 1

573 
m©ch
 = '.*'

576 
def
 
	`__š™__
(
£lf
, 
bus
, 
äequ’cy
=1, 
m©ch
='.*'):

577 
£lf
.
mtimes
 = {
	}
}

578 
£lf
.
fes
 = 
	$£t
()

579 
£lf
.
m©ch
 = match

580 
MÚ™Ü
.
	$__š™__
(
£lf
, 
bus
, s–f.
run
, 
äequ’cy
)

582 
def
 
	$¡¬t
(
£lf
):

584 
£lf
.
th»ad
 
is
 
NÚe
:

585 
£lf
.
mtimes
 = {
	}
}

586 
MÚ™Ü
.
	$¡¬t
(
£lf
)

587 
¡¬t
.
´iÜ™y
 = 70

589 
def
 
	$sysfes
(
£lf
):

591 
fes
 = 
	$£t
()

592 
k
, 
m
 
š
 
sys
.
moduËs
.
	$™ems
():

593 
»
.
	$m©ch
(
£lf
.
m©ch
, 
k
):

594 
	`ha§‰r
(
m
, '__lßd”__'è
ªd
 ha§‰r(m.
__lßd”__
, 'archive'):

595 
f
 = 
m
.
__lßd”__
.
¬chive


597 
f
 = 
	`g‘©Œ
(
m
, '__fe__', 
NÚe
)

598 
f
 
is
 
nÙ
 
NÚe
 
ªd
‚Ù 
os
.
·th
.
	$i§bs
(
f
):

599 #’su» 
absŞu‹
 
·ths
 
so
 
a
 
os
.
	`chdœ
(è
š
 
the
 
­p
 
dÛ¢
't break me

600 
f
 = 
os
.
·th
.
	`nÜm·th
(os.·th.
	$još
(
_moduË__fe__ba£
, 
f
))

601 
fes
.
	$add
(
f
)

602  
fes


604 
def
 
	$run
(
£lf
):

606 
f’ame
 
š
 
£lf
.
	`sysfes
(è| s–f.
fes
:

607 
f’ame
:

608 
f’ame
.
	`’dsw™h
('.pyc'):

609 
f’ame
 = filename[:-1]

611 
Şdtime
 = 
£lf
.
mtimes
.
	$g‘
(
f’ame
, 0)

612 
Şdtime
 
is
 
NÚe
:

613 #ModuË 
w™h
 
no
 .
py
 
fe
. 
Sk
 
™
.

616 
Œy
:

617 
mtime
 = 
os
.
	`¡©
(
f’ame
).
¡_mtime


618 
exû±
 
OSE¼Ü
:

619 #E™h” 
a
 
moduË
 
w™h
 
no
 .
py
 
fe
, 
Ü
 
™
's been deleted.

620 
mtime
 = 
NÚe


622 
f’ame
 
nÙ
 
š
 
£lf
.
mtimes
:

623 #Ià
a
 
moduË
 
has
 
no
 .
py
 
fe
, 
this
 
wl
 
be
 
NÚe
.

624 
£lf
.
mtimes
[
f’ame
] = 
mtime


626 
mtime
 
is
 
NÚe
 
Ü
 mtim> 
Şdtime
:

627 #Th
fe
 
has
 
b“n
 
d–‘ed
 
Ü
 
modif›d
.

628 
£lf
.
bus
.
	`log
("Re¡¬tšg beÿu£ % chªged." % 
f’ame
)

629 
£lf
.
th»ad
.
	$ÿnûl
()

630 
£lf
.
bus
.
	`log
("Stİ³dh»ad %r." % s–f.
th»ad
.
	$g‘Name
())

631 
£lf
.
bus
.
	$»¡¬t
()

635 
şass
 
	$Th»adMªag”
(
Sim¶ePlugš
):

638 
If
 
you
 
have
 
cÚŒŞ
 
ov”
 
th»ad
 
ü—tiÚ
 
ªd
 
de¡ruùiÚ
, 
publish
 
to


639 
the
 'acquœe_th»ad' 
ªd
 '»Ëa£_th»ad' 
	`chªÃls
 (
—ch
 
th»ad
).

640 
This
 
wl
 /
uÄegi¡”
 
the
 
cu¼’t
 
th»ad
 
ªd
 
publish
 
to


641 '¡¬t_th»ad' 
ªd
 '¡İ_th»ad' 
li¡’”s
 
š
 
the
 
bus
 
as
 
Ãeded
.

643 
If
 
th»ads
 
¬e
 
ü—‹d
 
ªd
 
de¡royed
 
by
 
code
 
you
 dØ
nÙ
 
cÚŒŞ


644 (
e
.
g
., 
A·che
), 
th’
, 
©
 
the
 
begšnšg
 
of
 
ev”y
 
HTTP
 
»que¡
,

645 
publish
 
to
 'acquœe_th»ad' 
Úly
. 
You
 
should
 
nÙ
…ublisho

646 '»Ëa£_th»ad' 
š
 
this
 , 
sšû
 
you
 dØ
nÙ
 
know
 
wh‘h”


647 
the
 
th»ad
 
wl
 
be
 
»
-
u£d
 
Ü
 
nÙ
. 
The
 
bus
 wÈ
ÿÎ


648 '¡İ_th»ad' 
li¡’”s
 
you
 
wh’
 
™
 
¡İs
.

651 
th»ads
 = 
NÚe


654 
def
 
	$__š™__
(
£lf
, 
bus
):

655 
£lf
.
th»ads
 = {
	}
}

656 
Sim¶ePlugš
.
	$__š™__
(
£lf
, 
bus
)

657 
£lf
.
bus
.
li¡’”s
.
	`£tdeçuÉ
('acquœe_th»ad', 
	$£t
())

658 
£lf
.
bus
.
li¡’”s
.
	`£tdeçuÉ
('¡¬t_th»ad', 
	$£t
())

659 
£lf
.
bus
.
li¡’”s
.
	`£tdeçuÉ
('»Ëa£_th»ad', 
	$£t
())

660 
£lf
.
bus
.
li¡’”s
.
	`£tdeçuÉ
('¡İ_th»ad', 
	$£t
())

662 
def
 
	$acquœe_th»ad
(
£lf
):

665 
If
 
the
 
cu¼’t
 
th»ad
 
has
 
®»ady
 
b“n
 
£’
, 
ªy
 'start_thread'

666 
li¡’”s
 
wl
 
nÙ
 
be
 
run
 
agaš
.

668 
th»ad_id’t
 = 
	$g‘_th»ad_id’t
()

669 
th»ad_id’t
 
nÙ
 
š
 
£lf
.
th»ads
:

670 #W
ÿn
't just use get_ident‡shehread ID

671 #beÿu£ 
some
 
¶©fÜms
 
»u£
 
th»ad
 
ID
's.

672 
i
 = 
	`Ën
(
£lf
.
th»ads
) + 1

673 
£lf
.
th»ads
[
th»ad_id’t
] = 
i


674 
£lf
.
bus
.
	`publish
('¡¬t_th»ad', 
i
)

676 
def
 
	$»Ëa£_th»ad
(
£lf
):

678 
th»ad_id’t
 = 
	$g‘_th»ad_id’t
()

679 
i
 = 
£lf
.
th»ads
.
	$pİ
(
th»ad_id’t
, 
NÚe
)

680 
i
 
is
 
nÙ
 
NÚe
:

681 
£lf
.
bus
.
	`publish
('¡İ_th»ad', 
i
)

683 
def
 
	$¡İ
(
£lf
):

685 
th»ad_id’t
, 
i
 
š
 
£lf
.
th»ads
.
	$™ems
():

686 
£lf
.
bus
.
	`publish
('¡İ_th»ad', 
i
)

687 
£lf
.
th»ads
.
	$ş—r
()

688 
g¿ûful
 = 
¡İ


	@trunk/objs/CherryPy-3.2.4/cherrypy/process/servers.py

2 
S¹šg
 
š
 
	gCh”ryPy
 3.1, 
	gch”rypy
.
£rv”
 
is
 
im¶em’‹d
 
as
 
	gª


3 :
»f
:`
Engše
 
Plugš
<
¶ugšs
>`. 
It
's‡n instance of

4 :
şass
:`
ch”rypy
.
_ı£rv”
.
S”v”
`, 
which
 
is
 
a
 
subşass
 
	gof


5 :
şass
:`
ch”rypy
.
´oûss
.
£rv”s
.
S”v”Ad­‹r
`. 
The
 ``ServerAdapter`` class

6 
is
 
desigÃd
 
to
 
cÚŒŞ
 
Ùh”
 
£rv”s
, 
as
 
	gw–l
.

8 
MuÉË
 
	g£rv”s
/
	gpÜts


11 
If
 
you
 
Ãed
 
to
 
¡¬t
 
mÜe
 
thª
 
Úe
 
HTTP
 
£rv”
 (tØ
£rve
 
Ú
 
muÉË
 
pÜts
, 
Ü


12 
´ÙocŞs
, 
‘c
.), 
you
 
ÿn
 
mªu®ly
 
—ch
 
Úe
 
ªd
 
th’
 
¡¬t
 
them
 
®l


13 
w™h
 
	g’gše
.
	g¡¬t
::

15 
s1
 = 
S”v”Ad­‹r
(
ch”rypy
.
’gše
, 
MyWSGIS”v”
(
ho¡
='0.0.0.0', 
pÜt
=80))

16 
s2
 = 
S”v”Ad­‹r
(
ch”rypy
.
’gše
, 
ªÙh”
.
HTTPS”v”
(
ho¡
='127.0.0.1', 
SSL
=
True
))

17 
s1
.
	$subsüibe
()

18 
s2
.
	$subsüibe
()

19 
ch”rypy
.
’gše
.
	`¡¬t
()

21 .. 
šdex
:: 
SCGI


23 
Fa¡CGI
/
SCGI


26 
Th”e
 
¬e
 
®so
 
Flup
\ **
F
**\ 
CGIS”v”
 
ªd
 Flup\ **
S
**\ CGIS”v” 
şas£s
 
š


27 :
mod
:`
ch”rypy
.
´oûss
.
£rv”s
`. 
To
 
¡¬t
 
ª
 
fcgi
 
£rv”
, 
exam¶e
,

28 
w¿p
 
ª
 
š¡ªû
 
of
 
™
 
š
 
a
 
S”v”Ad­‹r
::

30 
addr
 = ('0.0.0.0', 4000)

31 
f
 = 
£rv”s
.
	$FlupFCGIS”v”
(
­¶iÿtiÚ
=
ch”rypy
.
Œ“
, 
bšdAdd»ss
=
addr
)

32 
s
 = 
£rv”s
.
	$S”v”Ad­‹r
(
ch”rypy
.
’gše
, 
h‰p£rv”
=
f
, 
bšd_addr
=
addr
)

33 
s
.
	$subsüibe
()

35 
The
 :
doc
:`
ch”ryd
</
d•loyguide
/ch”ryd>` 
¡¬tup
 
süt
 
wl
 dØ
the
 
above
 

36 
you
 
vŸ
 
™s
 `-
f
` 
æag
.

37 
NÙe
 
th©
 
you
 
Ãed
 
to
 
dowÆßd
 
ªd
 
š¡®l
 `
æup
 <
h‰p
:

38 
your£lf
, 
wh‘h”
 
you
 
u£
 ``
ch”ryd
`` 
Ü
 
nÙ
.

40 .. 
_ç¡cgi
:

41 .. 
šdex
:: 
Fa¡CGI


43 
Fa¡CGI


46 
A
 
v”y
 
sim¶e
 
£tup
 
Ëts
 
your
 
ch”ry
 
run
 
w™h
 
Fa¡CGI
.

47 
You
 
ju¡
 
Ãed
 
the
 
æup
 
lib¿ry
,

48 
¶us
 
a
 
ruÂšg
 
A·che
 
	`£rv”
 (
w™h
 ``
mod_ç¡cgi
``è
Ü
 
ligh‰pd
 
£rv”
.

50 
Ch”ryPy
 
code


53 
h–lo
.
py
::

55 #!/
u¤
/
bš
/
pythÚ


56 
impÜt
 
ch”rypy


58 
şass
 
H–loWÜld
:

60 
def
 
	$šdex
(
£lf
):

62 
šdex
.
expo£d
 = 
True


64 
ch”rypy
.
Œ“
.
	`mouÁ
(
	$H–loWÜld
())

65 #Ch”ryPy 
autÜ–ßd
 
mu¡
 
be
 
di§bËd
 
the
 
æup
 
£rv”
 
to
 
wÜk


66 
ch”rypy
.
cÚfig
.
	`upd©e
({'’gše.autÜ–ßd_Ú':
F®£
})

68 
Th’
 
run
 :
doc
:`/
d•loyguide
/
ch”ryd
` 
w™h
 
the
 '-f' 
¬g
::

70 
ch”ryd
 -
c
 <
mycÚfig
> -
d
 -
f
 -
i
 
h–lo
.
py


72 
A·che


75 
At
 
the
 
tİ
 
Ëv–
 
š
 
h‰pd
.
cÚf
::

77 
Fa¡CgiIpcDœ
 /
tmp


78 
Fa¡CgiS”v”
 /
·th
/
to
/
ch”ry
.
fcgi
 -
idË
-
timeout
 120 -
´oûs£s
 4

80 
And
 
šside
 
the
 
»Ëvªt
 
Vœtu®Ho¡
 
£ùiÚ
::

82 #Fa¡CGI 
cÚfig


83 
AddHªdËr
 
ç¡cgi
-
süt
 .
fcgi


84 
SütAlŸsM©ch
 (.*
$
è/
·th
/
to
/
ch”ry
.
fcgi$1


86 
Ligh‰pd


89 
FÜ
 `
Ligh‰pd
 <
h‰p
:

90 
š¡ruùiÚs
. 
W™hš
 ``
ligh‰pd
.
cÚf
`` 
make
 
su»
 ``
mod_ç¡cgi
`` 
is


91 
aùive
 
w™hš
 ``
£rv”
.
moduËs
``. 
Th’
, w™hš 
	gyour
 ``
	g$HTTP
["host"]``

92 
	gdœeùive
, 
cÚfigu»
 
your
 
ç¡cgi
 
süt
 
like
 
the
 
	gfŞlowšg
::

94 
$HTTP
["url"] =~ "" {

95 
ç¡cgi
.
£rv”
 = (

103 "max-´ocs" => 1, #adju¡ 
as
 
	gÃeded


107 } #’d 
of
 
	g$HTTP
["url"] =~ "^/"

109 
PËa£
 
£e
 `
Ligh‰pd
 
Fa¡CGI
 
Docs


110 <
h‰p
:

111 
of
 
the
 
possibË
 
cÚfigu¿tiÚ
 
İtiÚs
.

114 
impÜt
 
sys


115 
impÜt
 
time


116 
impÜt
 
w¬nšgs


119 
şass
 
	$S”v”Ad­‹r
(
objeù
):

122 
If
 
you
 
Ãed
 
to
 
¡¬t
 
mÜe
 
thª
 
Úe
 
HTTP
 
	`£rv”
 (tØ
£rve
 
Ú
 
muÉË


123 
pÜts
, 
Ü
 
´ÙocŞs
, 
‘c
.), 
you
 
ÿn
 
mªu®ly
 
—ch
 
Úe
 
ªd
 
th’


124 
¡¬t
 
them
 
®l
 
w™h
 
bus
.start:

126 
s1
 = 
	`S”v”Ad­‹r
(
bus
, 
	`MyWSGIS”v”
(
ho¡
='0.0.0.0', 
pÜt
=80))

127 
s2
 = 
	`S”v”Ad­‹r
(
bus
, 
ªÙh”
.
	`HTTPS”v”
(
ho¡
='127.0.0.1', 
SSL
=
True
))

128 
s1
.
	$subsüibe
()

129 
s2
.
	$subsüibe
()

130 
bus
.
	`¡¬t
()

133 
def
 
	$__š™__
(
£lf
, 
bus
, 
h‰p£rv”
=
NÚe
, 
bšd_addr
=None):

134 
£lf
.
bus
 = bus

135 
£lf
.
h‰p£rv”
 = httpserver

136 
£lf
.
bšd_addr
 = bind_addr

137 
£lf
.
š‹¼u±
 = 
NÚe


138 
£lf
.
ruÂšg
 = 
F®£


140 
def
 
	$subsüibe
(
£lf
):

141 
£lf
.
bus
.
	`subsüibe
('¡¬t', s–f.
¡¬t
)

142 
£lf
.
bus
.
	`subsüibe
('¡İ', s–f.
¡İ
)

144 
def
 
	$unsubsüibe
(
£lf
):

145 
£lf
.
bus
.
	`unsubsüibe
('¡¬t', s–f.
¡¬t
)

146 
£lf
.
bus
.
	`unsubsüibe
('¡İ', s–f.
¡İ
)

148 
def
 
	$¡¬t
(
£lf
):

150 
£lf
.
bšd_addr
 
is
 
NÚe
:

151 
Ú_wh©
 = "unknown interface (dynamic?)"

152 
–if
 
	$isš¡ªû
(
£lf
.
bšd_addr
, 
tu¶e
):

153 
ho¡
, 
pÜt
 = 
£lf
.
bšd_addr


154 
Ú_wh©
 = "%s:%s" % (
ho¡
, 
pÜt
)

156 
Ú_wh©
 = "sock‘ fe: %s" % 
£lf
.
bšd_addr


158 
£lf
.
ruÂšg
:

159 
£lf
.
bus
.
	`log
("AÌ—dy s”všg oÀ%s" % 
Ú_wh©
)

162 
£lf
.
š‹¼u±
 = 
NÚe


163 
nÙ
 
£lf
.
h‰p£rv”
:

164 
¿i£
 
	`V®ueE¼Ü
("No HTTP server has been created.")

166 #S¹ 
the
 
h‰p£rv”
 
š
 
a
 
Ãw
 
th»ad
.

167 
	$isš¡ªû
(
£lf
.
bšd_addr
, 
tu¶e
):

168 
	$wa™_fÜ_ä“_pÜt
(*
£lf
.
bšd_addr
)

170 
impÜt
 
th»adšg


171 
t
 = 
th»adšg
.
	$Th»ad
(
rg‘
=
£lf
.
_¡¬t_h‰p_th»ad
)

172 
t
.
	`£tName
("HTTPS”v” " +.
	$g‘Name
())

173 
t
.
	$¡¬t
()

175 
£lf
.
	$wa™
()

176 
£lf
.
ruÂšg
 = 
True


177 
£lf
.
bus
.
	`log
("S”všg oÀ%s" % 
Ú_wh©
)

178 
¡¬t
.
´iÜ™y
 = 75

180 
def
 
	$_¡¬t_h‰p_th»ad
(
£lf
):

182 
maš
 
th»ad
 
³rsi¡s
 
to
 
»ûive
 
KeybßrdIÁ”ru±
's. If‡n

183 
exû±iÚ
 
is
 
¿i£d
 
š
 
the
 
h‰p£rv”
' th»adh’ it'
s


184 
Œ­³d
 
h”e
, 
ªd
 
the
 
	$bus
 (
ªd
 
th”efÜe
 
our
 
h‰p£rv”
)

185 
¬e
 
shut
 
down
.

187 
Œy
:

188 
£lf
.
h‰p£rv”
.
	$¡¬t
()

189 
exû±
 
KeybßrdIÁ”ru±
:

190 
£lf
.
bus
.
	`log
("<Ctrl-C> hit: shutting down HTTP server")

191 
£lf
.
š‹¼u±
 = 
sys
.
	`exc_šfo
()[1]

192 
£lf
.
bus
.
	$ex™
()

193 
exû±
 
Sy¡emEx™
:

194 
£lf
.
bus
.
	`log
("SystemExit„aised: shutting down HTTP server")

195 
£lf
.
š‹¼u±
 = 
sys
.
	`exc_šfo
()[1]

196 
£lf
.
bus
.
	$ex™
()

197 
¿i£


198 
exû±
:

199 
£lf
.
š‹¼u±
 = 
sys
.
	`exc_šfo
()[1]

200 
£lf
.
bus
.
	`log
("Error in HTTP server: shutting down",

201 
Œaûback
=
True
, 
Ëv–
=40)

202 
£lf
.
bus
.
	$ex™
()

203 
¿i£


205 
def
 
	$wa™
(
£lf
):

207 
nÙ
 
	`g‘©Œ
(
£lf
.
h‰p£rv”
, "»ady", 
F®£
):

208 
£lf
.
š‹¼u±
:

209 
¿i£
 
£lf
.
š‹¼u±


210 
time
.
	$¦“p
(.1)

212 #Wa™ 
pÜt
 
to
 
be
 
occup›d


213 
	$isš¡ªû
(
£lf
.
bšd_addr
, 
tu¶e
):

214 
ho¡
, 
pÜt
 = 
£lf
.
bšd_addr


215 
	$wa™_fÜ_occup›d_pÜt
(
ho¡
, 
pÜt
)

217 
def
 
	$¡İ
(
£lf
):

219 
£lf
.
ruÂšg
:

220 #¡İ(è
MUST
 
block
 
uÁ
 
the
 
£rv”
 
is
 *
Œuly
* 
¡İ³d
.

221 
£lf
.
h‰p£rv”
.
	$¡İ
()

222 #Wa™ 
the
 
sock‘
 
to
 
be
 
Œuly
 
ä“d
.

223 
	$isš¡ªû
(
£lf
.
bšd_addr
, 
tu¶e
):

224 
	$wa™_fÜ_ä“_pÜt
(*
£lf
.
bšd_addr
)

225 
£lf
.
ruÂšg
 = 
F®£


226 
£lf
.
bus
.
	`log
("HTTP S”v” % shuˆdown" % s–f.
h‰p£rv”
)

228 
£lf
.
bus
.
	`log
("HTTP S”v” % ®»ady shuˆdown" % s–f.
h‰p£rv”
)

229 
¡İ
.
´iÜ™y
 = 25

231 
def
 
	$»¡¬t
(
£lf
):

233 
£lf
.
	$¡İ
()

234 
£lf
.
	$¡¬t
()

237 
şass
 
	$FlupCGIS”v”
(
objeù
):

240 
def
 
	$__š™__
(
£lf
, *
¬gs
, **
kw¬gs
):

241 
£lf
.
¬gs
 =‡rgs

242 
£lf
.
kw¬gs
 = kwargs

243 
£lf
.
»ady
 = 
F®£


245 
def
 
	$¡¬t
(
£lf
):

247 #W
have
 
to
 
š¡ªtŸ‹
 
the
 
£rv”
 
şass
 
h”e
 
beÿu£
 
™s
 
__š™__


248 #¡¬t 
a
 
th»adpoŞ
. 
If
 
we
 dØ
™
 
too
 
—¾y
, 
d«mÚize
 
wÚ
't work.

249 
äom
 
æup
.
£rv”
.
cgi
 
impÜt
 
WSGIS”v”


251 
£lf
.
cgi£rv”
 = 
	$WSGIS”v”
(*
£lf
.
¬gs
, **£lf.
kw¬gs
)

252 
£lf
.
»ady
 = 
True


253 
£lf
.
cgi£rv”
.
	$run
()

255 
def
 
	$¡İ
(
£lf
):

257 
£lf
.
»ady
 = 
F®£


260 
şass
 
	$FlupFCGIS”v”
(
objeù
):

263 
def
 
	$__š™__
(
£lf
, *
¬gs
, **
kw¬gs
):

264 
kw¬gs
.
	`g‘
('bšdAdd»ss', 
NÚe
è
is
 None:

265 
impÜt
 
sock‘


266 
nÙ
 
	`ha§‰r
(
sock‘
, 'fromfd'):

267 
¿i£
 
	`V®ueE¼Ü
(

271 
£lf
.
¬gs
 =‡rgs

272 
£lf
.
kw¬gs
 = kwargs

273 
£lf
.
»ady
 = 
F®£


275 
def
 
	$¡¬t
(
£lf
):

277 #W
have
 
to
 
š¡ªtŸ‹
 
the
 
£rv”
 
şass
 
h”e
 
beÿu£
 
™s
 
__š™__


278 #¡¬t 
a
 
th»adpoŞ
. 
If
 
we
 dØ
™
 
too
 
—¾y
, 
d«mÚize
 
wÚ
't work.

279 
äom
 
æup
.
£rv”
.
fcgi
 
impÜt
 
WSGIS”v”


280 
£lf
.
fcgi£rv”
 = 
	$WSGIS”v”
(*
£lf
.
¬gs
, **£lf.
kw¬gs
)

281 #TODO: 
»pÜt
 
this
 
bug
 
up¡»am
 
to
 
æup
.

282 #Ià
we
 
dÚ
't set _oldSIGs on Windows, we get:

284 #lš108, 
š
 
run


285 #£lf.
	`_»¡ÜeSigÇlHªdËrs
()

287 #lš156, 
š
 
_»¡ÜeSigÇlHªdËrs


288 #fÜ 
signum
,
hªdËr
 
š
 
£lf
.
_ŞdSIGs
:

289 #A‰ribu‹E¼Ü: 'WSGIS”v”' 
objeù
 
has
 
no
 
©Œibu‹
 '_oldSIGs'

290 
£lf
.
fcgi£rv”
.
_š¡®lSigÇlHªdËrs
 = 
Ïmbda
: 
NÚe


291 
£lf
.
fcgi£rv”
.
_ŞdSIGs
 = []

292 
£lf
.
»ady
 = 
True


293 
£lf
.
fcgi£rv”
.
	$run
()

295 
def
 
	$¡İ
(
£lf
):

297 #FÜcibly 
¡İ
 
the
 
fcgi
 
£rv”
 
maš
 
ev’t
 
loİ
.

298 
£lf
.
fcgi£rv”
.
_k“pGošg
 = 
F®£


299 #FÜû 
®l
 
wÜk”
 
th»ads
 
to
 
d›
 
off
.

300 
£lf
.
fcgi£rv”
.
_th»adPoŞ
.
maxS·»
 = s–f.fcgi£rv”._th»adPoŞ.
_idËCouÁ


301 
£lf
.
»ady
 = 
F®£


304 
şass
 
	$FlupSCGIS”v”
(
objeù
):

307 
def
 
	$__š™__
(
£lf
, *
¬gs
, **
kw¬gs
):

308 
£lf
.
¬gs
 =‡rgs

309 
£lf
.
kw¬gs
 = kwargs

310 
£lf
.
»ady
 = 
F®£


312 
def
 
	$¡¬t
(
£lf
):

314 #W
have
 
to
 
š¡ªtŸ‹
 
the
 
£rv”
 
şass
 
h”e
 
beÿu£
 
™s
 
__š™__


315 #¡¬t 
a
 
th»adpoŞ
. 
If
 
we
 dØ
™
 
too
 
—¾y
, 
d«mÚize
 
wÚ
't work.

316 
äom
 
æup
.
£rv”
.
scgi
 
impÜt
 
WSGIS”v”


317 
£lf
.
scgi£rv”
 = 
	$WSGIS”v”
(*
£lf
.
¬gs
, **£lf.
kw¬gs
)

318 #TODO: 
»pÜt
 
this
 
bug
 
up¡»am
 
to
 
æup
.

319 #Ià
we
 
dÚ
't set _oldSIGs on Windows, we get:

321 #lš108, 
š
 
run


322 #£lf.
	`_»¡ÜeSigÇlHªdËrs
()

324 #lš156, 
š
 
_»¡ÜeSigÇlHªdËrs


325 #fÜ 
signum
,
hªdËr
 
š
 
£lf
.
_ŞdSIGs
:

326 #A‰ribu‹E¼Ü: 'WSGIS”v”' 
objeù
 
has
 
no
 
©Œibu‹
 '_oldSIGs'

327 
£lf
.
scgi£rv”
.
_š¡®lSigÇlHªdËrs
 = 
Ïmbda
: 
NÚe


328 
£lf
.
scgi£rv”
.
_ŞdSIGs
 = []

329 
£lf
.
»ady
 = 
True


330 
£lf
.
scgi£rv”
.
	$run
()

332 
def
 
	$¡İ
(
£lf
):

334 
£lf
.
»ady
 = 
F®£


335 #FÜcibly 
¡İ
 
the
 
scgi
 
£rv”
 
maš
 
ev’t
 
loİ
.

336 
£lf
.
scgi£rv”
.
_k“pGošg
 = 
F®£


337 #FÜû 
®l
 
wÜk”
 
th»ads
 
to
 
d›
 
off
.

338 
£lf
.
scgi£rv”
.
_th»adPoŞ
.
maxS·»
 = 0

341 
def
 
	$ş›Á_ho¡
(
£rv”_ho¡
):

343 
£rv”_ho¡
 == '0.0.0.0':

344 #0.0.0.0 
is
 
INADDR_ANY
, 
which
 
should
 
ªsw”
 
Ú
 
loÿlho¡
.

346 
£rv”_ho¡
 
	`š
 ('::', '::0', '::0.0.0.0'):

347 #:: 
is
 
IN6ADDR_ANY
, 
which
 
should
 
ªsw”
 
Ú
 
loÿlho¡
.

348 #::0 
ªd
 ::0.0.0.0 
¬e
 
nÚ
-
ÿnÚiÿl
 
but
 
commÚ
 
ways
 
to
 
wr™e
 
IN6ADDR_ANY
.

350  
£rv”_ho¡


352 
def
 
	$check_pÜt
(
ho¡
, 
pÜt
, 
timeout
=1.0):

354 
nÙ
 
ho¡
:

355 
¿i£
 
	`V®ueE¼Ü
("Host values of '' or None‡re‚ot‡llowed.")

356 
ho¡
 = 
	$ş›Á_ho¡
(
ho¡
)

357 
pÜt
 = (port)

359 
impÜt
 
sock‘


361 #AF_INET 
Ü
 
AF_INET6
 
sock‘


362 #G‘ 
the
 
cÜ»ù
 
add»ss
 
çmy
 
our
 
	`ho¡
 (
®lows
 
IPv6
 
add»s£s
)

363 
Œy
:

364 
šfo
 = 
sock‘
.
	$g‘addršfo
(
ho¡
, 
pÜt
, 
sock‘
.
AF_UNSPEC
,

365 
sock‘
.
SOCK_STREAM
)

366 
exû±
 
sock‘
.
ga›¼Ü
:

367 ':' 
š
 
ho¡
:

368 
šfo
 = [(
sock‘
.
AF_INET6
, sock‘.
SOCK_STREAM
, 0, "", (
ho¡
, 
pÜt
, 0, 0))]

370 
šfo
 = [(
sock‘
.
AF_INET
, sock‘.
SOCK_STREAM
, 0, "", (
ho¡
, 
pÜt
))]

372 
»s
 
š
 
šfo
:

373 
af
, 
sockty³
, 
´Ùo
, 
ÿnÚÇme
, 
§
 = 
»s


374 
s
 = 
NÚe


375 
Œy
:

376 
s
 = 
sock‘
.
	$sock‘
(
af
, 
sockty³
, 
´Ùo
)

377 #S“ 
h‰p
:

378 #brow£_äm/
th»ad
/
bbã5eb39c904ã0


379 
s
.
	$£‰imeout
(
timeout
)

380 
s
.
	`cÚÃù
((
ho¡
, 
pÜt
))

381 
s
.
	$şo£
()

382 
exû±
 
sock‘
.
”rÜ
:

383 
s
:

384 
s
.
	$şo£
()

386 
¿i£
 
	`IOE¼Ü
("Port %s is in use on %s;…erhapshe…revious "

388 (
	`»´
(
pÜt
), 
	$»´
(
ho¡
)))

391 #F“È
ä“
 
to
 
šü—£
 
the£
 
deçuÉs
 
Ú
 
¦ow
 
sy¡ems
:

392 
ä“_pÜt_timeout
 = 0.1

393 
occup›d_pÜt_timeout
 = 1.0

395 
def
 
	$wa™_fÜ_ä“_pÜt
(
ho¡
, 
pÜt
, 
timeout
=
NÚe
):

397 
nÙ
 
ho¡
:

398 
¿i£
 
	`V®ueE¼Ü
("Host values of '' or None‡re‚ot‡llowed.")

399 
timeout
 
is
 
NÚe
:

400 
timeout
 = 
ä“_pÜt_timeout


402 
ŒŸl
 
š
 
	$¿nge
(50):

403 
Œy
:

404 #w
¬e
 
ex³ùšg
 
a
 
ä“
 
pÜt
, 
so
 
»duû
 
the
 
timeout


405 
	$check_pÜt
(
ho¡
, 
pÜt
, 
timeout
=timeout)

406 
exû±
 
IOE¼Ü
:

407 #Giv
the
 
Şd
 
£rv”
 
th»ad
 
time
 
to
 
ä“
h
pÜt
.

408 
time
.
	$¦“p
(
timeout
)

412 
¿i£
 
	`IOE¼Ü
("PÜˆ%¸nÙ f»Ú %r" % (
pÜt
, 
ho¡
))

414 
def
 
	$wa™_fÜ_occup›d_pÜt
(
ho¡
, 
pÜt
, 
timeout
=
NÚe
):

416 
nÙ
 
ho¡
:

417 
¿i£
 
	`V®ueE¼Ü
("Host values of '' or None‡re‚ot‡llowed.")

418 
timeout
 
is
 
NÚe
:

419 
timeout
 = 
occup›d_pÜt_timeout


421 
ŒŸl
 
š
 
	$¿nge
(50):

422 
Œy
:

423 
	$check_pÜt
(
ho¡
, 
pÜt
, 
timeout
=timeout)

424 
exû±
 
IOE¼Ü
:

425 #pÜˆ
is
 
occup›d


428 
time
.
	$¦“p
(
timeout
)

430 
ho¡
 =ğ
	$ş›Á_ho¡
(
ho¡
):

431 
¿i£
 
	`IOE¼Ü
("PÜˆ%¸nÙ bound oÀ%r" % (
pÜt
, 
ho¡
))

433 #OÀ
sy¡ems
 
wh”e
 
a
 
loİback
 
š‹rçû
 
is
 
nÙ
 
avaabË
 
ªd
 
the


434 #£rv” 
is
 
bound
 
to
 
®l
 
š‹rçûs
, 
™
's difficulto determine

435 #wh‘h” 
the
 
£rv”
 
is
 
š
 
çù
 
occupyšg
h
pÜt
. 
In
 
this
 ,

436 #ju¡ 
issue
 
a
 
w¬nšg
 
ªd
 
move
 
Ú
. 
S“
 issue #1100.

437 
msg
 = "UÇbËØv”ifyh©h£rv” i bound oÀ%r" % 
pÜt


438 
w¬nšgs
.
	`w¬n
(
msg
)

	@trunk/objs/CherryPy-3.2.4/cherrypy/process/win32.py

3 
impÜt
 
os


4 
impÜt
 
wš32­i


5 
impÜt
 
wš32cÚ


6 
impÜt
 
wš32ev’t


7 
impÜt
 
wš32£rviû


8 
impÜt
 
wš32£rviûut


10 
äom
 
	gch”rypy
.
´oûss
 
impÜt
 
	gw¥bus
, 
¶ugšs


13 
şass
 
	$CÚsŞeCŒlHªdËr
(
¶ugšs
.
Sim¶ePlugš
):

16 
def
 
	$__š™__
(
£lf
, 
bus
):

17 
£lf
.
is_£t
 = 
F®£


18 
¶ugšs
.
Sim¶ePlugš
.
	$__š™__
(
£lf
, 
bus
)

20 
def
 
	$¡¬t
(
£lf
):

21 
£lf
.
is_£t
:

22 
£lf
.
bus
.
	`log
('HªdË¸fÜ cÚsŞev’t ®»ady s‘.', 
Ëv–
=40)

25 
»suÉ
 = 
wš32­i
.
	$S‘CÚsŞeCŒlHªdËr
(
£lf
.
hªdË
, 1)

26 
»suÉ
 == 0:

27 
£lf
.
bus
.
	`log
('Could‚ot SetConsoleCtrlHandler (error %r)' %

28 
wš32­i
.
	`G‘La¡E¼Ü
(), 
Ëv–
=40)

30 
£lf
.
bus
.
	`log
('S‘ hªdË¸fÜ cÚsŞev’ts.', 
Ëv–
=40)

31 
£lf
.
is_£t
 = 
True


33 
def
 
	$¡İ
(
£lf
):

34 
nÙ
 
£lf
.
is_£t
:

35 
£lf
.
bus
.
	`log
('HªdË¸fÜ cÚsŞev’t ®»ady off.', 
Ëv–
=40)

38 
Œy
:

39 
»suÉ
 = 
wš32­i
.
	$S‘CÚsŞeCŒlHªdËr
(
£lf
.
hªdË
, 0)

40 
exû±
 
V®ueE¼Ü
:

41 #"
V®ueE¼Ü
: 
The
 
objeù
 
has
 
nÙ
 
b“n
 
»gi¡”ed
"

42 
»suÉ
 = 1

44 
»suÉ
 == 0:

45 
£lf
.
bus
.
	`log
('Could‚ot„emove SetConsoleCtrlHandler (error %r)' %

46 
wš32­i
.
	`G‘La¡E¼Ü
(), 
Ëv–
=40)

48 
£lf
.
bus
.
	`log
('Removed hªdË¸fÜ cÚsŞev’ts.', 
Ëv–
=40)

49 
£lf
.
is_£t
 = 
F®£


51 
def
 
	$hªdË
(
£lf
, 
ev’t
):

53 
ev’t
 
	$š
 (
wš32cÚ
.
CTRL_C_EVENT
, wš32cÚ.
CTRL_LOGOFF_EVENT
,

54 
wš32cÚ
.
CTRL_BREAK_EVENT
, wš32cÚ.
CTRL_SHUTDOWN_EVENT
,

55 
wš32cÚ
.
CTRL_CLOSE_EVENT
):

56 
£lf
.
bus
.
	`log
('CÚsŞev’ˆ%s: shu‰šg dowÀbus' % 
ev’t
)

58 #Remov
£lf
 
immedŸ‹ly
 
so
 
»³©ed
 
CŒl
-
C
 
dÛ¢
't„e-call it.

59 
Œy
:

60 
£lf
.
	$¡İ
()

61 
exû±
 
V®ueE¼Ü
:

62 
·ss


64 
£lf
.
bus
.
	$ex™
()

65 #'
Fœ¡
 
to
  
True
 
¡İs
 
the
 
ÿÎs
'

70 
şass
 
	$Wš32Bus
(
w¥bus
.
Bus
):

73 
In¡—d
 
of
 
time
.
¦“p
, 
this
 
bus
 
blocks
 
usšg
 
Çtive
 
wš32ev’t
 
objeùs
.

76 
def
 
	$__š™__
(
£lf
):

77 
£lf
.
ev’ts
 = {
	}
}

78 
w¥bus
.
Bus
.
	$__š™__
(
£lf
)

80 
def
 
	$_g‘_¡©e_ev’t
(
£lf
, 
¡©e
):

82 
Œy
:

83  
£lf
.
ev’ts
[
¡©e
]

84 
exû±
 
KeyE¼Ü
:

85 
ev’t
 = 
wš32ev’t
.
	`C»©eEv’t
(
NÚe
, 0, 0,

87 (
¡©e
.
Çme
, 
os
.
	$g‘pid
()))

88 
£lf
.
ev’ts
[
¡©e
] = 
ev’t


89  
ev’t


91 
def
 
	$_g‘_¡©e
(
£lf
):

92  
£lf
.
_¡©e


93 
def
 
	$_£t_¡©e
(
£lf
, 
v®ue
):

94 
£lf
.
_¡©e
 = 
v®ue


95 
ev’t
 = 
£lf
.
	$_g‘_¡©e_ev’t
(
v®ue
)

96 
wš32ev’t
.
	$Pul£Ev’t
(
ev’t
)

97 
¡©e
 = 
	$´İ”ty
(
_g‘_¡©e
, 
_£t_¡©e
)

99 
def
 
	$wa™
(
£lf
, 
¡©e
, 
š‹rv®
=0.1, 
chªÃl
=
NÚe
):

102 
Sšû
 
this
 
şass
 
u£s
 
Çtive
 
wš32ev’t
 
objeùs
, 
the
 
š‹rv®


103 
¬gum’t
 
is
 
ignÜed
.

105 
	`isš¡ªû
(
¡©e
, (
tu¶e
, 
li¡
)):

107 
£lf
.
¡©e
 
nÙ
 
š
 state:

108 
ev’ts
 = 
	`tu¶e
([
£lf
.
	$_g‘_¡©e_ev’t
(
s
è 
š
 
¡©e
])

109 
wš32ev’t
.
	$Wa™FÜMuÉËObjeùs
(
ev’ts
, 0, 
wš32ev’t
.
INFINITE
)

112 
£lf
.
¡©e
 != state:

113 
ev’t
 = 
£lf
.
	$_g‘_¡©e_ev’t
(
¡©e
)

114 
wš32ev’t
.
	$Wa™FÜSšgËObjeù
(
ev’t
, 
wš32ev’t
.
INFINITE
)

117 
şass
 
	$_CÚŒŞCodes
(
diù
):

118 """CÚŒŞ code u£dØ"
sigÇl
"‡ service via ControlService.

120 
U£r
-
defšed
 
cÚŒŞ
 
codes
 
¬e
 
š
 
the
 
¿nge
 128-255. 
We
 
g’”®ly
 
u£


121 
the
 
¡ªd¬d
 
PythÚ
 
v®ue
 th
Lšux
 
sigÇl
 
ªd
 
add
 128. 
Exam¶e
:

123 >>> 
sigÇl
.
SIGUSR1


125 
cÚŒŞ_codes
['graceful'] = 128 + 10

128 
def
 
	$key_fÜ
(
£lf
, 
obj
):

130 
key
, 
v®
 
š
 
£lf
.
	$™ems
():

131 
v®
 
is
 
obj
:

132  
key


133 
¿i£
 
	`V®ueE¼Ü
("Thgiv’ objeù could‚Ù bfound: %r" % 
obj
)

135 
cÚŒŞ_codes
 = 
	`_CÚŒŞCodes
({'g¿ûful': 138
	}
})

138 
def
 
	$sigÇl_chd
(
£rviû
, 
commªd
):

139 
commªd
 == 'stop':

140 
wš32£rviûut
.
	$StİS”viû
(
£rviû
)

141 
–if
 
commªd
 == 'restart':

142 
wš32£rviûut
.
	$Re¡¬tS”viû
(
£rviû
)

144 
wš32£rviûut
.
	$CÚŒŞS”viû
(
£rviû
, 
cÚŒŞ_codes
[
commªd
])

147 
şass
 
	$PyWebS”viû
(
wš32£rviûut
.
S”viûF¿mewÜk
):

150 
_svc_Çme_
 = "Python Web Service"

151 
_svc_di¥Ïy_Çme_
 = "Python Web Service"

152 
_svc_d•s_
 = 
NÚe
 #£qu’û 
of
 
£rviû
 
Çmes
 
Ú
 
which
 
this
 
d•’ds


153 
_exe_Çme_
 = "pywebsvc"

154 
_exe_¬gs_
 = 
NÚe
 #DeçuÉ 
to
 
no
 
¬gum’ts


156 #OÆy 
exi¡s
 
Ú
 
Wšdows
 2000 
Ü
 
Ï‹r
, 
ignÜed
 oÀ
wšdows
 
NT


157 
_svc_desütiÚ_
 = "Python Web Service"

159 
def
 
	$SvcDoRun
(
£lf
):

160 
äom
 
ch”rypy
 
impÜt
 
´oûss


161 
´oûss
.
bus
.
	$¡¬t
()

162 
´oûss
.
bus
.
	$block
()

164 
def
 
	$SvcStİ
(
£lf
):

165 
äom
 
ch”rypy
 
impÜt
 
´oûss


166 
£lf
.
	$R•ÜtS”viûStus
(
wš32£rviû
.
SERVICE_STOP_PENDING
)

167 
´oûss
.
bus
.
	$ex™
()

169 
def
 
	$SvcOth”
(
£lf
, 
cÚŒŞ
):

170 
´oûss
.
bus
.
	`publish
(
cÚŒŞ_codes
.
	$key_fÜ
(
cÚŒŞ
))

173 
__Çme__
 == '__main__':

174 
wš32£rviûut
.
	`HªdËCommªdLše
(
PyWebS”viû
)

	@trunk/objs/CherryPy-3.2.4/cherrypy/process/wspbus.py

3 
This
 
moduË
 
is
 
com¶‘–y
 
	g¡ªd®Úe
, 
d•’dšg
 
Úly
 
Ú
 
the
 
	g¡dlib
.

5 
Web
 
S™e
 
Proûss
 
	gBus


8 
A
 
Bus
 
objeù
 
is
 
u£d
 
to
 
cÚš
 
ªd
 
mªage
 
	gs™e
-
wide
 
	gbehaviÜ
:

9 
d«mÚiz©iÚ
, 
HTTP
 
£rv”
 
	g¡¬t
/
	g¡İ
, 
´oûss
 
	g»lßd
, 
sigÇl
 
	ghªdlšg
,

10 
drİ
 
	g´iveges
, 
PID
 
fe
 
	gmªagem’t
, 
loggšg
 
®l
 
of
 
	gthe£
,

11 
ªd
 
mªy
 
	gmÜe
.

13 
In
 
	gadd™iÚ
, 
a
 
Bus
 
objeù
 
´ovides
‡ 
¶aû
 
—ch
 
web
 
äamewÜk


14 
to
 
code
 
th©
 
runs
 
š
 
»¥Ú£
Ø
	gs™e
-
wide
 
ev’ts
 (
like


15 
´oûss
 
¡¬t
 
ªd
 
¡İ
), 
Ü
 
which
 
cÚŒŞs
 o¸
Ùh”wi£
 
š‹¿ùs
 
w™h


16 
the
 
	gs™e
-
wide
 
compÚ’ts
 
m’tiÚed
 
	gabove
. 
FÜ
 
	gexam¶e
, 
a
 
äamewÜk
 
which


17 
u£s
 
	gfe
-
ba£d
 
‹m¶©es
 
would
 
add
 
known
 
‹m¶©e
 
f’ames
 
to
 
ª


18 
autÜ–ßd
 
	gcompÚ’t
.

20 
	gId—Îy
, 
a
 
Bus
 
objeù
 
wl
 
be
 
æexibË
 
’ough
 
to
 b
u£ful
 
š
‡ 
v¬›ty


21 
of
 
švoÿtiÚ
 
	gsûÇrios
:

23 1. 
The
 
d•loy”
 
¡¬ts
 
a
 
s™e
 
äom
 
the
 
commªd
 
lše
 
vŸ
‡

24 
äamewÜk
-
ÃuŒ®
 
d•loym’t
 
süt
; 
­¶iÿtiÚs
 
äom
 
muÉË
 
äamewÜks


25 
¬e
 
mixed
 
š
 
a
 
sšgË
 
	gs™e
. 
	gCommªd
-
lše
 
¬gum’ts
 
ªd
 
cÚfigu¿tiÚ


26 
fes
 
¬e
 
u£d
 
to
 
defše
 
	gs™e
-
wide
 
compÚ’ts
 
such
 
as
 
the
 
HTTP
 
	g£rv”
,

27 
WSGI
 
compÚ’t
 
	gg¿ph
, 
autÜ–ßd
 
	gbehaviÜ
, 
sigÇl
 
	ghªdlšg
, 
	g‘c
.

28 2. 
The
 
d•loy”
 
¡¬ts
 
a
 
s™e
 
vŸ
 
some
 
Ùh”
 
	g´oûss
, 
such
 
as
 
	gA·che
;

29 
­¶iÿtiÚs
 
äom
 
muÉË
 
äamewÜks
 
¬e
 
mixed
 
š
 
a
 
sšgË
 
	gs™e
.

30 
AutÜ–ßd
 
ªd
 
sigÇl
 
	$hªdlšg
 (
äom
 
PythÚ
 
©
 
Ëa¡
è
¬e
 
di§bËd
.

31 3. 
The
 
d•loy”
 
¡¬ts
 
a
 
s™e
 
vŸ
‡ 
äamewÜk
-
¥ecific
 
mechªism
;

32 
exam¶e
, 
wh’
 
ruÂšg
 
‹¡s
, 
ex¶Üšg
 
tutÜŸls
, 
Ü
 
d•loyšg


33 
sšgË
 
­¶iÿtiÚs
 
äom
 
a
 sšgË 
äamewÜk
. 
The
 f¿mewÜk 
cÚŒŞs


34 
which
 
s™e
-
wide
 
compÚ’ts
 
¬e
 
’abËd
 
as
 
™
 
£es
 
f™
.

36 
The
 
Bus
 
objeù
 
š
 
this
 
·ckage
 
u£s
 
tİic
-
ba£d
 
publish
-
subsüibe


37 
mes§gšg
 
to
 
accom¶ish
 
®l
 
this
. 
A
 
ãw
 
tİic
 
chªÃls
 
¬e
 
but
 
š


38 ('¡¬t', '¡İ', 'ex™', 'g¿ûful', 'log', 
ªd
 'maš'). 
F¿mewÜks
‡nd

39 
s™e
 
cÚš”s
 
¬e
 
ä“
 
to
 
defše
 
theœ
 
own
. 
If
 
a
 
mes§ge
 
is
 
£Á
o‡

40 
chªÃl
 
th©
 
has
 
nÙ
 
b“n
 
defšed
 
Ü
 ha 
no
 
li¡’”s
, 
th”e
 
is
‚Ø
efãù
.

42 
In
 
g’”®
, 
th”e
 
should
 
Úly
 
ev”
 
be
 
a
 
sšgË
 
Bus
 
objeù
 
³r
 
´oûss
.

43 
F¿mewÜks
 
ªd
 
s™e
 
cÚš”s
 
sh¬e
 
a
 
sšgË
 
Bus
 
objeù
 
by
 
publishšg


44 
mes§ges
 
ªd
 
subsüibšg
 
li¡’”s
.

46 
The
 
Bus
 
objeù
 
wÜks
 
as
 
a
 
fš™e
 
¡©e
 
machše
 
which
 
mod–s
 
the
 
cu¼’t


47 
¡©e
 
of
 
the
 
´oûss
. 
Bus
 
m‘hods
 
move
 
™
 
äom
 
Úe
 s‹ 
to
 
ªÙh”
;

48 
tho£
 
m‘hods
 
th’
 
publish
 
to
 
subsüibed
 
li¡’”s
 
Ú
 
the
 
chªÃl
 

49 
the
 
Ãw
 
¡©e
.::

51 
O


53 
V


54 
STOPPING
 --> 
STOPPED
 --> 
EXITING
 -> 
X


55 
A
 A |

56 | \
___
 |

58 | 
V
 V

59 
STARTED
 <-- 
STARTING


63 
impÜt
 
©ex™


64 
impÜt
 
os


65 
impÜt
 
sys


66 
impÜt
 
th»adšg


67 
impÜt
 
time


68 
impÜt
 
Œaûback
 
as
 
_Œaûback


69 
impÜt
 
w¬nšgs


71 
äom
 
ch”rypy
.
_ıcom·t
 
impÜt
 
£t


73 #H”
I
 
§ve
 
the
 
v®ue
 
of
 
os
.
	`g‘cwd
(), 
which
, I 
am
 
impÜ‹d
 
—¾y
 
’ough
,

74 #wÈ
be
 
the
 
dœeùÜy
 
äom
 
which
h
¡¬tup
 
süt
 
was
 
run
. 
This
 
is
 
Ãeded


75 #by 
	`_do_execv
(), 
to
 
chªge
 
back
Ø
the
 
Üigš®
 
dœeùÜy
 
befÜe
 
	`execv
()
šg
 
a


76 #Ãw 
´oûss
. 
This
 
is
 
a
 
deãn£
 
agaš¡
 
the
 
­¶iÿtiÚ
 
havšg
 
chªged
he

77 #cu¼’ˆ
wÜkšg
 
	`dœeùÜy
 (
which
 
could
 
make
 
sys
.
execubË
 "not found" 

78 #sys.
execubË
 
is
 
a
 
»Ïtive
-
·th
, 
ªd
/
Ü
 
ÿu£
 
Ùh”
 
´obËms
).

79 
_¡¬tup_cwd
 = 
os
.
	$g‘cwd
()

81 
şass
 
	$ChªÃlFau»s
(
Exû±iÚ
):

83 
d–im™”
 = '\n'

85 
def
 
	$__š™__
(
£lf
, *
¬gs
, **
kw¬gs
):

86 #DÚ'ˆu£ '
su³r
' here; Exceptions‡re old-style in Py2.4

87 #S“ 
h‰p
:

88 
Exû±iÚ
.
	$__š™__
(
£lf
, *
¬gs
, **
kw¬gs
)

89 
£lf
.
_exû±iÚs
 = 
	$li¡
()

91 
def
 
	$hªdË_exû±iÚ
(
£lf
):

93 
£lf
.
_exû±iÚs
.
	`­³nd
(
sys
.
	`exc_šfo
()[1])

95 
def
 
	$g‘_š¡ªûs
(
£lf
):

97  
£lf
.
_exû±iÚs
[:]

99 
def
 
	$__¡r__
(
£lf
):

100 
exû±iÚ_¡ršgs
 = 
	`m­
(
»´
, 
£lf
.
	$g‘_š¡ªûs
())

101  
£lf
.
d–im™”
.
	$još
(
exû±iÚ_¡ršgs
)

103 
__»´__
 = 
__¡r__


105 
def
 
	$__boŞ__
(
£lf
):

106  
	$boŞ
(
£lf
.
_exû±iÚs
)

107 
__nÚz”o__
 = 
__boŞ__


109 #U£ 
a
 
æag
 
to
 
šdiÿ‹
 
the
 
¡©e
 
of
h
bus
.

110 
şass
 
	$_S‹Enum
(
objeù
):

111 
şass
 
	$S‹
(
objeù
):

112 
Çme
 = 
NÚe


113 
def
 
	$__»´__
(
£lf
):

114  "¡©es.%s" % 
£lf
.
Çme


116 
def
 
	$__£‰r__
(
£lf
, 
key
, 
v®ue
):

117 
	$isš¡ªû
(
v®ue
, 
£lf
.
S‹
):

118 
v®ue
.
Çme
 = 
key


119 
objeù
.
	$__£‰r__
(
£lf
, 
key
, 
v®ue
)

120 
¡©es
 = 
	$_S‹Enum
()

121 
¡©es
.
STOPPED
 = s‹s.
	$S‹
()

122 
¡©es
.
STARTING
 = s‹s.
	$S‹
()

123 
¡©es
.
STARTED
 = s‹s.
	$S‹
()

124 
¡©es
.
STOPPING
 = s‹s.
	$S‹
()

125 
¡©es
.
EXITING
 = s‹s.
	$S‹
()

128 
Œy
:

129 
impÜt
 
fú


130 
exû±
 
ImpÜtE¼Ü
:

131 
max_fes
 = 0

133 
Œy
:

134 
max_fes
 = 
os
.
	`syscÚf
('SC_OPEN_MAX')

135 
exû±
 
A‰ribu‹E¼Ü
:

136 
max_fes
 = 1024

139 
şass
 
	$Bus
(
objeù
):

142 
AÎ
 
li¡’”s
 
a
 
giv’
 
chªÃl
 
¬e
 
gu¬ª‹ed
 
to
 
be
 
ÿÎed
 
ev’


143 
Ùh”s
 
©
 
the
 
§me
 
chªÃl
 
ç
. 
Each
 
çu»
 
is
 
logged
, 
but


144 
executiÚ
 
´oûeds
 
Ú
 
to
 
the
 
Ãxt
 
li¡’”
. 
The
 
Úly
 
way
Ø
¡İ
 
®l


145 
´oûssšg
 
äom
 
šside
 
a
 
li¡’”
 
is
 
to
 
¿i£
 
Sy¡emEx™
 
ªd
 
¡İ
 
the


146 
whŞe
 
£rv”
.

149 
¡©es
 = states

150 
¡©e
 = 
¡©es
.
STOPPED


151 
execv
 = 
F®£


152 
max_şÛxec_fes
 = 
max_fes


154 
def
 
	$__š™__
(
£lf
):

155 
£lf
.
execv
 = 
F®£


156 
£lf
.
¡©e
 = 
¡©es
.
STOPPED


157 
£lf
.
li¡’”s
 = 
	`diù
(

158 [(
chªÃl
, 
	$£t
()è
chªÃl


159 
	`š
 ('start', 'stop', 'exit', 'graceful', 'log', 'main')])

160 
£lf
.
_´iÜ™›s
 = {
	}
}

162 
def
 
	$subsüibe
(
£lf
, 
chªÃl
, 
ÿÎback
, 
´iÜ™y
=
NÚe
):

164 
chªÃl
 
nÙ
 
š
 
£lf
.
li¡’”s
:

165 
£lf
.
li¡’”s
[
chªÃl
] = 
	$£t
()

166 
£lf
.
li¡’”s
[
chªÃl
].
	$add
(
ÿÎback
)

168 
´iÜ™y
 
is
 
NÚe
:

169 
´iÜ™y
 = 
	`g‘©Œ
(
ÿÎback
, 'priority', 50)

170 
£lf
.
_´iÜ™›s
[(
chªÃl
, 
ÿÎback
)] = 
´iÜ™y


172 
def
 
	$unsubsüibe
(
£lf
, 
chªÃl
, 
ÿÎback
):

174 
li¡’”s
 = 
£lf
.li¡’”s.
	$g‘
(
chªÃl
)

175 
li¡’”s
 
ªd
 
ÿÎback
 
š
†isteners:

176 
li¡’”s
.
	$disÿrd
(
ÿÎback
)

177 
d–
 
£lf
.
_´iÜ™›s
[(
chªÃl
, 
ÿÎback
)]

179 
def
 
	$publish
(
£lf
, 
chªÃl
, *
¬gs
, **
kw¬gs
):

181 
chªÃl
 
nÙ
 
š
 
£lf
.
li¡’”s
:

184 
exc
 = 
	$ChªÃlFau»s
()

185 
ouut
 = []

187 
™ems
 = [(
£lf
.
_´iÜ™›s
[(
chªÃl
, 
li¡’”
)],†istener)

188 
li¡’”
 
š
 
£lf
.
li¡’”s
[
chªÃl
]]

189 
Œy
:

190 
™ems
.
	`sÜt
(
key
=
Ïmbda
 
™em
: item[0])

191 
exû±
 
Ty³E¼Ü
:

192 #PythÚ 2.3 
had
 
no
 'key' 
¬g
, 
but
 
th©
 
dÛ¢
't matter

193 #sšû 
™
 
could
 
sÜt
 
dissim¬
 
ty³s
 
ju¡
 
fše
.

194 
™ems
.
	$sÜt
()

195 
´iÜ™y
, 
li¡’”
 
š
 
™ems
:

196 
Œy
:

197 
ouut
.
	`­³nd
(
	$li¡’”
(*
¬gs
, **
kw¬gs
))

198 
exû±
 
KeybßrdIÁ”ru±
:

199 
¿i£


200 
exû±
 
Sy¡emEx™
:

201 
e
 = 
sys
.
	`exc_šfo
()[1]

202 #Ià
we
 
have
 
´evious
 
”rÜs
 
’su»
 
the
 
ex™
 
code
 
is
 
nÚ
-
z”o


203 
exc
 
ªd
 
e
.
code
 == 0:

204 
e
.
code
 = 1

205 
¿i£


206 
exû±
:

207 
exc
.
	$hªdË_exû±iÚ
()

208 
chªÃl
 == 'log':

209 #Assum
ªy
 
fu¹h”
 
mes§ges
 
to
 'log' 
wl
 
ç
.

210 
·ss


212 
£lf
.
	`log
("E¼Ü iÀ%¸li¡’” %r" % (
chªÃl
, 
li¡’”
),

213 
Ëv–
=40, 
Œaûback
=
True
)

214 
exc
:

215 
¿i£
 
exc


216  
ouut


218 
def
 
	$_ş—n_ex™
(
£lf
):

220 
£lf
.
¡©e
 !ğ
¡©es
.
EXITING
:

221 
w¬nšgs
.
	`w¬n
(

225 "mašh»adƒx™s." % 
£lf
.
¡©e
, 
RuÁimeW¬nšg
)

226 
£lf
.
	$ex™
()

228 
def
 
	$¡¬t
(
£lf
):

230 
©ex™
.(
£lf
.
_ş—n_ex™
)

232 
£lf
.
¡©e
 = 
¡©es
.
STARTING


233 
£lf
.
	`log
('Bus STARTING')

234 
Œy
:

235 
£lf
.
	`publish
('start')

236 
£lf
.
¡©e
 = 
¡©es
.
STARTED


237 
£lf
.
	`log
('Bus STARTED')

238 
	$exû±
 (
KeybßrdIÁ”ru±
, 
Sy¡emEx™
):

239 
¿i£


240 
exû±
:

241 
£lf
.
	`log
("Shutting down dueoƒrror in start†istener:",

242 
Ëv–
=40, 
Œaûback
=
True
)

243 
e_šfo
 = 
sys
.
	`exc_šfo
()[1]

244 
Œy
:

245 
£lf
.
	$ex™
()

246 
exû±
:

247 #Any 
¡İ
/
ex™
 
”rÜs
 
wl
 
be
 
logged
 
šside
 
	`publish
().

248 
·ss


249 #Re-
¿i£
 
the
 
Üigš®
 
”rÜ


250 
¿i£
 
e_šfo


252 
def
 
	$ex™
(
£lf
):

254 
ex™¡©e
 = 
£lf
.
¡©e


255 
Œy
:

256 
£lf
.
	$¡İ
()

258 
£lf
.
¡©e
 = 
¡©es
.
EXITING


259 
£lf
.
	`log
('Bus EXITING')

260 
£lf
.
	`publish
('exit')

261 #Thi 
i¢
'ˆ¡riùly‚eûs§ry, buˆ™'
s
 
b‘‹r
 
thª
 
£ešg


262 #"
Wa™šg
 
chd
 
th»ads
 
to
 
‹rmš©e
..."‡ndhen‚othing.

263 
£lf
.
	`log
('Bus EXITED')

264 
exû±
:

265 #Thi 
m‘hod
 
is
 
oá’
 
ÿÎed
 
	`asynchrÚou¦y
 (
wh‘h”
 
th»ad
,

266 #sigÇÈ
hªdËr
, 
cÚsŞe
 hªdËr, 
Ü
 
©ex™
 hªdËr), 
so
 
we


268 #Assum
™
's been†ogged‡nd just die.

269 
os
.
	$_ex™
(70) #EX_SOFTWARE

271 
ex™¡©e
 =ğ
¡©es
.
STARTING
:

272 #ex™(è
was
 
ÿÎed
 
befÜe
 
	`¡¬t
(è
fšished
, 
possibly
 
due
 
to


273 #CŒl-
C
 
beÿu£
 
a
 
¡¬t
 
li¡’”
 
gÙ
 
¡uck
. 
In
 
this
 ,

274 #w
could
 
g‘
 
¡uck
 
š
 
a
 
loİ
 
wh”e
 
CŒl
-
C
 
Ãv”
 
ex™s
 
the


275 #´oûss, 
so
 
we
 
ju¡
 
ÿÎ
 
os
.
ex™
 
h”e
.

276 
os
.
	$_ex™
(70) #EX_SOFTWARE

278 
def
 
	$»¡¬t
(
£lf
):

281 
This
 
m‘hod
 
dÛs
 
nÙ
 
»¡¬t
 
the
 
´oûss
 
äom
h
ÿÎšg
 
th»ad
;

282 
š¡—d
, 
™
 
¡İs
 
the
 
bus
 
ªd
 
asks
h
maš
 
th»ad
 
to
 
ÿÎ
 
execv
.

284 
£lf
.
execv
 = 
True


285 
£lf
.
	$ex™
()

287 
def
 
	$g¿ûful
(
£lf
):

289 
£lf
.
	`log
('Bus graceful')

290 
£lf
.
	`publish
('graceful')

292 
def
 
	$block
(
£lf
, 
š‹rv®
=0.1):

295 
This
 
funùiÚ
 
is
 
š‹nded
 
to
 
be
 
ÿÎed
 
Úly
 
by
 
the
 
maš
 
th»ad
.

296 
Aá”
 
wa™šg
 
the
 
EXITING
 
¡©e
, 
™
 
®so
 
wa™s
 
®l
 
th»ads


297 
to
 
‹rmš©e
, 
ªd
 
th’
 
ÿÎs
 
os
.
execv
 
£lf
.execv 
is
 
True
. 
This


298 
design
 
®lows
 
ªÙh”
 
th»ad
 
to
 
ÿÎ
 
bus
.
»¡¬t
, 
y‘
 
have
 
the
 
maš


299 
th»ad
 
³rfÜm
 
the
 
aùu®
 
execv
 
	`ÿÎ
 (
»quœed
 
Ú
 
some
 
¶©fÜms
).

301 
Œy
:

302 
£lf
.
	`wa™
(
¡©es
.
EXITING
, 
š‹rv®
=š‹rv®, 
chªÃl
='main')

303 
	$exû±
 (
KeybßrdIÁ”ru±
, 
IOE¼Ü
):

304 #Th
time
.
¦“p
 
ÿÎ
 
might
 
¿i£


305 #"
IOE¼Ü
: [
E¼no
 4] 
IÁ”ru±ed
 
funùiÚ
 
ÿÎ
" on KBInt.

306 
£lf
.
	`log
('Keyboard Interrupt: shutting down bus')

307 
£lf
.
	$ex™
()

308 
exû±
 
Sy¡emEx™
:

309 
£lf
.
	`log
('SystemExit„aised: shutting down bus')

310 
£lf
.
	$ex™
()

311 
¿i£


313 #Wa™šg 
ALL
 
chd
 
th»ads
 
to
 
fšish
 
is
 
Ãûs§ry
 
Ú
 
OS
 
X
.

314 #S“ 
h‰p
:

316 #th
maš
 
th»ad
 
to
 
ÿÎ
 
©ex™
 
hªdËrs
.

317 #S“ 
h‰p
:

318 
£lf
.
	`log
("Waiting for childhreadsoerminate...")

319 
t
 
š
 
th»adšg
.
	$’um”©e
():

320 
t
 !ğ
th»adšg
.
	$cu¼’tTh»ad
(è
ªd
 
t
.
	$isAlive
():

321 #NÙ
th©
 
ªy
 
	`dummy
 (
ex‹º®
è
th»ads
 
¬e
 
®ways
 
d«mÚic
.

322 
	`ha§‰r
(
th»adšg
.
Th»ad
, "daemon"):

324 
d
 = 
t
.
d«mÚ


326 
d
 = 
t
.
	$isD«mÚ
()

327 
nÙ
 
d
:

328 
£lf
.
	`log
("Wa™šg fÜh»ad %s." % 
t
.
	$g‘Name
())

329 
t
.
	$još
()

331 
£lf
.
execv
:

332 
£lf
.
	$_do_execv
()

334 
def
 
	$wa™
(
£lf
, 
¡©e
, 
š‹rv®
=0.1, 
chªÃl
=
NÚe
):

336 
	`isš¡ªû
(
¡©e
, (
tu¶e
, 
li¡
)):

337 
¡©es
 = 
¡©e


339 
¡©es
 = [
¡©e
]

341 
def
 
	$_wa™
():

342 
£lf
.
¡©e
 
nÙ
 
š
 
¡©es
:

343 
time
.
	$¦“p
(
š‹rv®
)

344 
£lf
.
	$publish
(
chªÃl
)

346 #From 
h‰p
:

347 #"
The
 
comped
 
machše
 
code
 
dÛs
 
nÙ
 
šşude
 
the
 
»guÏr
 
pŞlšg


348 #dÚ
by
 
PythÚ
, 
m—nšg
 
th©
 
a
 
KeybßrdIÁ”ru±
 
wl
 
nÙ
 
be


349 #d‘eùed 
befÜe
 
executiÚ
 
comes
 
back
 
to
 
the
 
»guÏr
 
PythÚ


350 #š‹½»‹r. 
Your
 
´og¿m
 
ÿÂÙ
 
be
 
š‹¼u±ed
 
ÿught


351 #štØ
ª
 
šfš™e
 
Psyco
-
comped
 
loİ
."

352 
Œy
:

353 
sys
.
moduËs
['psyco'].
	$ÿÂÙcompe
(
_wa™
)

354 
	$exû±
 (
KeyE¼Ü
, 
A‰ribu‹E¼Ü
):

355 
·ss


357 
	$_wa™
()

359 
def
 
	$_do_execv
(
£lf
):

362 
This
 
mu¡
 
be
 
ÿÎed
 
äom
 
the
 
maš
 
th»ad
, 
beÿu£
 
û¹aš
 
¶©fÜms


363 (
OS
 
X
è
dÚ
't‡llowƒxecvo be called in‡ childhread very well.

365 
¬gs
 = 
sys
.
¬gv
[:]

366 
£lf
.
	`log
('Re-¥awnšg %s' % ' '.
	$još
(
¬gs
))

368 
sys
.
¶©fÜm
[:4] == 'java':

369 
äom
 
_sy¡em»¡¬t
 
impÜt
 
Sy¡emRe¡¬t


370 
¿i£
 
Sy¡emRe¡¬t


372 
¬gs
.
	$š£¹
(0, 
sys
.
execubË
)

373 
sys
.
¶©fÜm
 == 'win32':

374 
¬gs
 = ['"%s"' % 
¬g
 ¬g 
š
‡rgs]

376 
os
.
	$chdœ
(
_¡¬tup_cwd
)

377 
£lf
.
max_şÛxec_fes
:

378 
£lf
.
	$_£t_şÛxec
()

379 
os
.
	$execv
(
sys
.
execubË
, 
¬gs
)

381 
def
 
	$_£t_şÛxec
(
£lf
):

384 
If
 
£lf
.
max_şÛxec_fes
 
is
 
ª
 
	`š‹g”
 (
the
 ), 
th’
 
Ú


385 
¶©fÜms
 
which
 
suµÜt
 
™
, iˆ
»´e£Ás
 
the
 
max
 
İ’
 
fes
 
£‰šg


386 
the
 
İ”©šg
 
sy¡em
. 
This
 
funùiÚ
 
wl
 
be
 
ÿÎed
 
ju¡
 
befÜe


387 
the
 
´oûss
 
is
 
»¡¬‹d
 
vŸ
 
os
.
	$execv
(è
to
 
´ev’t
 
İ’
 
fes


388 
äom
 
³rsi¡šg
 
što
 
the
 
Ãw
 
´oûss
.

390 
S‘
 
£lf
.
max_şÛxec_fes
 
to
 0Ø
di§bË
 
this
 
behaviÜ
.

392 
fd
 
š
 
	$¿nge
(3, 
£lf
.
max_şÛxec_fes
): #sk 
¡dš
/
out
/
”r


393 
Œy
:

394 
æags
 = 
fú
.
	$fú
(
fd
, 
fú
.
F_GETFD
)

395 
exû±
 
IOE¼Ü
:

397 
fú
.
	`fú
(
fd
, fú.
F_SETFD
, 
æags
 | fú.
FD_CLOEXEC
)

399 
def
 
	$¡İ
(
£lf
):

401 
£lf
.
¡©e
 = 
¡©es
.
STOPPING


402 
£lf
.
	`log
('Bus STOPPING')

403 
£lf
.
	`publish
('stop')

404 
£lf
.
¡©e
 = 
¡©es
.
STOPPED


405 
£lf
.
	`log
('Bus STOPPED')

407 
def
 
	$¡¬t_w™h_ÿÎback
(
£lf
, 
func
, 
¬gs
=
NÚe
, 
kw¬gs
=None):

409 
¬gs
 
is
 
NÚe
:

410 
¬gs
 = ()

411 
kw¬gs
 
is
 
NÚe
:

412 
kw¬gs
 = {
	}
}

413 
¬gs
 = (
func
,) +‡rgs

415 
def
 
	$_ÿÎback
(
func
, *
a
, **
kw
):

416 
£lf
.
	$wa™
(
¡©es
.
STARTED
)

417 
	$func
(*
a
, **
kw
)

418 
t
 = 
th»adšg
.
	$Th»ad
(
rg‘
=
_ÿÎback
, 
¬gs
÷rgs, 
kw¬gs
=kwargs)

419 
t
.
	`£tName
('Bu C®lback ' +.
	$g‘Name
())

420 
t
.
	$¡¬t
()

422 
£lf
.
	$¡¬t
()

424  
t


426 
def
 
	`log
(
£lf
, 
msg
="", 
Ëv–
=20, 
Œaûback
=
F®£
):

428 
Œaûback
:

429 
msg
 +ğ"\n" + "".
	`još
(
_Œaûback
.
	`fÜm©_exû±iÚ
(*
sys
.
	$exc_šfo
()))

430 
£lf
.
	`publish
('log', 
msg
, 
Ëv–
)

432 
bus
 = 
	`Bus
()

	@trunk/objs/CherryPy-3.2.4/cherrypy/scaffold/__init__.py

3 
U£
 
this
 
as
 
a
 
ba£
 
ü—tšg
 
Ãw
 
Ch”ryPy
 
	g­¶iÿtiÚs
. 
Wh’
 
you
 
wªt


4 
to
 
make
 
a
 
Ãw
 
	g­p
, 
cİy
 
ªd
 
·¡e
 
this
 
fŞd”
Ø
some
 
Ùh”
 
	gloÿtiÚ


5 (
maybe
 
	gs™e
-
	g·ckages
è
ªd
 
»Çme
 
™
 
to
 
the
 
Çme
 
of
 
your
 
	g´ojeù
,

6 
th’
 
tw—k
 
as
 
	gdesœed
.

8 
Ev’
 
befÜe
 
ªy
 
	gtw—kšg
, 
this
 
should
 
£rve
 
a
 
ãw
 
demÚ¡¿tiÚ
 
	g·ges
.

9 
Chªge
 
to
 
this
 
dœeùÜy
 
ªd
 
	grun
:

11 ../
ch”ryd
 -
c
 
s™e
.
cÚf


15 
impÜt
 
ch”rypy


16 
äom
 
ch”rypy
 
impÜt
 
toŞs
, 
u¾


18 
impÜt
 
os


19 
	gloÿl_dœ
 = 
os
.
·th
.
još
(os.
g‘cwd
(), os.·th.
	$dœÇme
(
__fe__
))

22 
şass
 
RoÙ
:

24 
_ı_cÚfig
 = {'toŞs.log_Œaûbacks.Ú': 
True
,

25 
	}
}

27 
def
 
	$šdex
(
£lf
):

29 <
body
>
Try
 
some
 <
a
 
h»f
='%s?a=7'>
Ùh”
</a> 
·th
,

30 
Ü
 
a
 <¨
h»f
='%s?n=14'></a> 
·th
.<
br
 />

31 
Or
, 
ju¡
 
look
 
©
 
the
 
´‘ty
 
piùu»
:<
br
 />

32 <
img
 
¤c
='%s' />

33 </
body
></
html
>""" % (u¾("
Ùh”
"), url(""),

34 
	`u¾
("files/made_with_cherrypy_small.png"))

35 
šdex
.
expo£d
 = 
True


37 
def
 (
£lf
, *
¬gs
, **
kw¬gs
):

38  "¬gs: % kw¬gs: %s" % (
¬gs
, 
kw¬gs
)

39 .
expo£d
 = 
True


41 
def
 
	`Ùh”
(
£lf
, 
a
=2, 
b
='bªªas', 
c
=
NÚe
):

42 
ch”rypy
.
»¥Ú£
.
h—d”s
['Content-Type'] = 'text/plain'

43 
c
 
is
 
NÚe
:

44  "Hav%d %s." % ((
a
), 
b
)

46  "Hav%d %s, %s." % ((
a
), 
b
, 
c
)

47 
Ùh”
.
expo£d
 = 
True


49 
fes
 = 
ch”rypy
.
toŞs
.
¡©icdœ
.
	`hªdËr
(

50 
£ùiÚ
="/files",

51 
dœ
=
os
.
·th
.
	`još
(
loÿl_dœ
, "static"),

52 #IgnÜ.
php
 
fes
, 
‘c
.

53 
m©ch
=
r
'\.(css|gif|html?|ico|jpe?g|js|png|swf|xml)$',

57 
roÙ
 = 
	$RoÙ
()

59 #Uncomm’ˆ
the
 
fŞlowšg
 
to
 
u£
 
your
 
own
 
çvicÚ
 
š¡—d
 
of
 
CP
's default.

60 #çvicÚ_·th = 
os
.
·th
.
	`još
(
loÿl_dœ
, "favicon.ico")

61 #roÙ.
çvicÚ_ico
 = 
toŞs
.
¡©icfe
.
	`hªdËr
(
f’ame
=
çvicÚ_·th
)

	@trunk/objs/CherryPy-3.2.4/cherrypy/scaffold/apache-fcgi.conf

1 #A·che2 
£rv”
 
cÚf
 
fe
 
usšg
 
Ch”ryPy
 
w™h
 
mod_fcgid
.

3 #Thi 
dÛ¢
't haveo be "C:/", but it haso be‡ directory somewhere,‡nd

4 #MUST 
m©ch
 
the
 
dœeùÜy
 
u£d
 
š
h
Fa¡CgiEx‹º®S”v”
 
dœeùive
, 
b–ow
.

5 
	gDocum’tRoÙ
 "C:/"

7 
	gS”v”Name
 127.0.0.1

8 
	gLi¡’
 80

9 
LßdModuË
 
ç¡cgi_moduË
 
	gmoduËs
/
	gmod_ç¡cgi
.
dÎ


10 
LßdModuË
 
»wr™e_moduË
 
	gmoduËs
/
	gmod_»wr™e
.
so


12 
O±iÚs
 
ExecCGI


13 
S‘HªdËr
 
	gç¡cgi
-
süt


14 
Rewr™eEngše
 
	gOn


15 #S’d 
»que¡s
 
ªy
 
URI
 
to
 
our
 
ç¡cgi
 
hªdËr
.

16 
	gRewr™eRuË
 ^(.*)
	g$
 /
	gç¡cgi
.
	gpyc
 [
L
]

18 #Th
Fa¡CgiEx‹º®S”v”
 
dœeùive
 
defšes
 
f’ame
 
as
 
ª
 
ex‹º®
 
Fa¡CGI
 
­¶iÿtiÚ
.

19 #Ià
f’ame
 
dÛs
 
nÙ
 
begš
 
w™h
 
a
 
¦ash
 (/è
th’
 
™
 
is
 
assumed
 
to
 
be
 
»Ïtive
Ø
the
 
S”v”RoÙ
.

20 #Th
f’ame
 
dÛs
 
nÙ
 
have
 
to
 
exi¡
 
š
 
the
 
loÿl
 
fesy¡em
. 
URIs
 
th©
 
A·che
 
»sŞves
Ø
this


21 #f’am
wl
 
be
 
hªdËd
 
by
 
this
 
ex‹º®
 
Fa¡CGI
 
­¶iÿtiÚ
.

22 
	gFa¡CgiEx‹º®S”v”
 "C:/ç¡cgi.pyc" -
	gho¡
 127.0.0.1:8088

	@trunk/objs/CherryPy-3.2.4/cherrypy/scaffold/example.conf

2 
	glog
.
	g”rÜ_fe
: "error.log"

3 
log
.
acûss_fe
: "access.log"

	@trunk/objs/CherryPy-3.2.4/cherrypy/scaffold/site.conf

1 [
glob®
]

2 #Uncomm’ˆ
this
 
wh’
 
you
're done developing

5 
	g£rv”
.
	gsock‘_ho¡
: "0.0.0.0"

6 
£rv”
.
sock‘_pÜt
: 8088

8 #Uncomm’ˆ
the
 
fŞlowšg
 
lšes
 
to
 
run
 
Ú
 
HTTPS
 
©
h
§me
 
time


9 #£rv”.2.
sock‘_ho¡
: "0.0.0.0"

10 #£rv”.2.
sock‘_pÜt
: 8433

11 #£rv”.2.
s¦_û¹ifiÿ‹
: '../test/test.pem'

12 #£rv”.2.
s¦_´iv©e_key
: '../test/test.pem'

14 
Œ“
.
my­p
: 
ch”rypy
.
AµliÿtiÚ
(
sÿffŞd
.
roÙ
, "/", "example.conf")

	@trunk/objs/CherryPy-3.2.4/cherrypy/test/__init__.py

3 
	gRun
 'no£‹¡ - ‹¡/' 
to
 
ex”ci£
 
®l
 
	g‹¡s
.

5 
	gThe
 '-s' 
æag
 
š¡ruùs
 
no£
 
to
 
ouut
 
¡dout
 
	gmes§ges
, 
wihch
 
is
 
üucŸl
o

6 
	gthe
 'š‹¿ùive' 
mode
 
of
 
	gweb‹¡
.
	gpy
. 
If
 
you
 
run
 
the£
 
‹¡s
 
w™hout
he '-s'

7 
	gæag
, 
	gdÚ
'ˆbsu½ri£d iàth‹¡ s“m tØhªg: it'
s
 
wa™šg
 
your


8 
š‹¿ùive
 
	gšput
.

11 
impÜt
 
os


12 
impÜt
 
sys


14 
def
 
	$Ãwex™
():

15 
os
.
	$_ex™
(1)

17 
def
 
	$£tup
():

18 #W
wªt
 
to
 
mÚkey
 
·tch
 
sys
.
ex™
 
so
 
th©
 
we
 
ÿn
 
g‘
 
some


19 #šfÜm©iÚ 
about
 
wh”e
 
ex™
 
is
 
bešg
 
ÿÎed
.

20 
Ãwex™
.
_Şd
 = 
sys
.
ex™


21 
sys
.
ex™
 = 
Ãwex™


23 
def
 
	$‹¬down
():

24 
Œy
:

25 
sys
.
ex™
 = sys.ex™.
_Şd


26 
exû±
 
A‰ribu‹E¼Ü
:

27 
sys
.
ex™
 = sys.
_ex™


	@trunk/objs/CherryPy-3.2.4/cherrypy/test/_test_decorators.py

3 
äom
 
ch”rypy
 
impÜt
 
	gexpo£
, 
toŞs


4 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
Áob


7 
şass
 
	$Expo£Exam¶es
(
objeù
):

9 @
expo£


10 
def
 
	$no_ÿÎ
(
£lf
):

13 @
	$expo£
()

14 
def
 
	$ÿÎ_em±y
(
£lf
):

17 @
	`expo£
("call_alias")

18 
def
 
	$Ãsb™t
(
£lf
):

21 @
	`expo£
(["alias1", "alias2"])

22 
def
 
	$ªd»ws
(
£lf
):

25 @
	`expo£
(
®Ÿs
="alias3")

26 
def
 
	$w©sÚ
(
£lf
):

30 
şass
 
	$ToŞExam¶es
(
objeù
):

32 @
expo£


33 @
toŞs
.
	`»¥Ú£_h—d”s
(
h—d”s
=[('Content-Type', 'application/data')])

34 
def
 
	$bÏh
(
£lf
):

35 
y›ld
 
	`Áob
("blah")

36 #Thi 
is
 
h”e
 
to
 
demÚ¡¿‹
 
th©
 
_ı_cÚfig
 = {...
	}
} 
ov”wr™es


37 #th
_ı_cÚfig
 
©Œibu‹
 
added
 
by
 
the
 
ToŞ
 
decÜ©Ü
. 
You
 
have


38 #tØ
wr™e
 
_ı_cÚfig
[
k
] = 
v
 
Ü
 _ı_cÚfig.
upd©e
(...è
š¡—d
.

39 
bÏh
.
_ı_cÚfig
['»¥Ú£.¡»am'] = 
True


	@trunk/objs/CherryPy-3.2.4/cherrypy/test/_test_states_demo.py

1 
impÜt
 
os


2 
impÜt
 
sys


3 
impÜt
 
time


4 
	g¡¬‰ime
 = 
time
.
	$time
()

6 
impÜt
 
ch”rypy


9 
şass
 
RoÙ
:

11 
def
 
	$šdex
(
£lf
):

13 
šdex
.
expo£d
 = 
True


15 
def
 
	$mtimes
(
£lf
):

16  
	`»´
(
ch”rypy
.
’gše
.
	`publish
("Autoreloader", "mtimes"))

17 
mtimes
.
expo£d
 = 
True


19 
def
 
	$pid
(
£lf
):

20  
	`¡r
(
os
.
	$g‘pid
())

21 
pid
.
expo£d
 = 
True


23 
def
 
	$¡¬t
(
£lf
):

24  
	$»´
(
¡¬‰ime
)

25 
¡¬t
.
expo£d
 = 
True


27 
def
 
	$ex™
(
£lf
):

28 #Thi 
hªdËr
 
might
 
be
 
ÿÎed
 
befÜe
 
the
 
’gše
 
is
 
STARTED
 
ª


29 #HTTP 
wÜk”
 
th»ad
 
hªdËs
 
™
 
befÜe
 
the
 
HTTP
 
£rv”
 
»tuºs


30 #cÚŒŞ 
to
 
’gše
.
¡¬t
. 
We
 
avoid
 
th©
 
¿û
 
cÚd™iÚ
 
h”e


31 #by 
wa™šg
 
the
 
Bus
 
to
 
be
 
STARTED
.

32 
ch”rypy
.
’gše
.
	$wa™
(
¡©e
=
ch”rypy
.
’gše
.
¡©es
.
STARTED
)

33 
ch”rypy
.
’gše
.
	$ex™
()

34 
ex™
.
expo£d
 = 
True


37 
def
 
	$unsub_sig
():

38 
ch”rypy
.
	`log
("unsubsig: %s" % ch”rypy.
cÚfig
.
	`g‘
('unsubsig', 
F®£
))

39 
ch”rypy
.
cÚfig
.
	`g‘
('unsubsig', 
F®£
):

40 
ch”rypy
.
	`log
("Unsubscribinghe default cherrypy signal handler")

41 
ch”rypy
.
’gše
.
sigÇl_hªdËr
.
	$unsubsüibe
()

42 
Œy
:

43 
äom
 
sigÇl
 
impÜt
 sigÇl, 
SIGTERM


44 
exû±
 
ImpÜtE¼Ü
:

45 
·ss


47 
def
 
	$Şd_‹rm_hªdËr
(
signum
=
NÚe
, 
äame
=None):

48 
ch”rypy
.
	`log
("I‡m‡n old SIGTERM handler.")

49 
sys
.
	$ex™
(0)

50 
ch”rypy
.
	`log
("Subscribinghe‚ew one.")

51 
	$sigÇl
(
SIGTERM
, 
Şd_‹rm_hªdËr
)

52 
ch”rypy
.
’gše
.
	`subsüibe
('¡¬t', 
unsub_sig
, 
´iÜ™y
=100)

55 
def
 
	$¡¬‹¼Ü
():

56 
ch”rypy
.
cÚfig
.
	`g‘
('¡¬‹¼Ü', 
F®£
):

57 
z”odiv
 = 1 / 0

58 
ch”rypy
.
’gše
.
	`subsüibe
('¡¬t', 
¡¬‹¼Ü
, 
´iÜ™y
=6)

60 
def
 
	$log_‹¡_ÿ£_Çme
():

61 
ch”rypy
.
cÚfig
.
	`g‘
('‹¡_ÿ£_Çme', 
F®£
):

62 
ch”rypy
.
	`log
("STARTED FROM: %s" % ch”rypy.
cÚfig
.
	`g‘
('test_case_name'))

63 
ch”rypy
.
’gše
.
	`subsüibe
('¡¬t', 
log_‹¡_ÿ£_Çme
, 
´iÜ™y
=6)

66 
ch”rypy
.
Œ“
.
	`mouÁ
(
	`RoÙ
(), '/', {'/': {}
	}
})

	@trunk/objs/CherryPy-3.2.4/cherrypy/test/benchmark.py

3 
	gU§ge
:

4 
b’chm¬k
.
py
 --
nuÎ
 --
nÙe¡s
 --
h–p
 --
ımodpy
 --
modpythÚ
 --
ab
=
·th
 --
­ache
=path

6 --
nuÎ
: 
u£
 
a
‚uÎ 
Reque¡
 
objeù
 (
to
 
b’ch
 
the
 
HTTP
 
£rv”
 
Úly
)

7 --
nÙe¡s
: 
¡¬t
 
the
 
£rv”
 
but
 dØ
nÙ
 
run
h
‹¡s
; 
this
 
®lows


8 
you
 
to
 
check
 
the
 
‹¡ed
 
·ges
 
w™h
 
a
 
	gbrow£r


9 --
	gh–p
: 
show
 
this
 
h–p
 
mes§ge


10 --
ımodpy
: 
run
 
‹¡s
 
vŸ
 
­ache
 
Ú
 54583 (
w™h
 
the
 
butš
 
_ımodpy
)

11 --
modpythÚ
: 
run
 
‹¡s
 
vŸ
 
­ache
 
Ú
 54583 (
w™h
 
modpythÚ_g©eway
)

12 --
ab
=
·th
: 
U£
 
the
‡b 
süt
/
execubË
 
©
 '·th' (
£e
 
b–ow
)

13 --
­ache
=
·th
: 
U£
 
the
‡·ch
süt
/
exe
 
©
 '·th' (
£e
 
b–ow
)

15 
To
 
run
 
the
 
b’chm¬ks
,h
A·che
 
B’chm¬k
 
	gtoŞ
 "ab" 
mu¡
 
e™h”
 
be
 
Ú


16 
your
 
sy¡em
 
	g·th
, 
Ü
 
¥ecif›d
 
vŸ
 
	gthe
 --
	gab
=
·th
 
İtiÚ
.

18 
To
 
run
 
the
 
modpythÚ
 
‹¡s
, 
	gthe
 "­ache" 
execubË
 
Ü
 
süt
 
mu¡
 
be


19 
Ú
 
your
 
sy¡em
 
	g·th
, 
Ü
 
´ovided
 
vŸ
 
	gthe
 --
	g­ache
=
·th
 
İtiÚ
. 
On
 
some


20 
¶©fÜms
, "­ache" 
may
 
be
 
	gÿÎed
 "­acheùl" 
	gÜ
 "­ache2ùl"--
ü—‹


21 
a
 
symlšk
 
to
 
them
 
	gÃeded
.

24 
impÜt
 
g‘İt


25 
impÜt
 
os


26 
	gcurdœ
 = 
os
.
·th
.
još
(os.
g‘cwd
(), os.·th.
	$dœÇme
(
__fe__
))

28 
impÜt
 
»


29 
impÜt
 
sys


30 
impÜt
 
time


31 
impÜt
 
Œaûback


33 
impÜt
 
ch”rypy


34 
äom
 
ch”rypy
.
_ıcom·t
 
impÜt
 
Áob


35 
äom
 
ch”rypy
 
impÜt
 
_ı”rÜ
, 
_ımodpy


36 
äom
 
ch”rypy
.
lib
 
impÜt
 
h‰put


39 
AB_PATH
 = ""

40 
APACHE_PATH
 = "apache"

41 
SCRIPT_NAME
 = "/cpbench/users/rdelon/apps/blog"

43 
__®l__
 = ['ABSession', 'Root', 'print_report',

48 
size_ÿche
 = {
	}
}

50 
şass
 
RoÙ
:

52 
def
 
	$šdex
(
£lf
):

54 <
h—d
>

55 <
t™Ë
>
Ch”ryPy
 
B’chm¬k
</title>

56 </
h—d
>

57 <
body
>

58 <
ul
>

59 <
li
><
a
 
h»f
="h–lo">
H–lo
, 
wÜld
! (14 
by‹
 
dyÇmic
)</a></li>

60 <
li
><
a
 
h»f
="¡©ic/šdex.html">
Stic
 
	`fe
 (14 
by‹s
 )</a></li>

61 <
li
><
fÜm
 
aùiÚ
="siz”">
Re¥Ú£
 
of
 
Ëngth
:

62 <
šput
 
ty³
='‹xt' 
Çme
='size' 
v®ue
='10' /></
fÜm
>

63 </
li
>

64 </
ul
>

65 </
body
>

66 </
html
>"""

67 
šdex
.
expo£d
 = 
True


69 
def
 
	$h–lo
(
£lf
):

71 
h–lo
.
expo£d
 = 
True


73 
def
 
	$siz”
(
£lf
, 
size
):

74 
»¥
 = 
size_ÿche
.
	$g‘
(
size
, 
NÚe
)

75 
»¥
 
is
 
NÚe
:

76 
size_ÿche
[
size
] = 
»¥
 = "X" * (size)

77  
»¥


78 
siz”
.
expo£d
 = 
True


81 
ch”rypy
.
cÚfig
.
	`upd©e
({

89 
	}
})

91 #Ch—ˆ
mode
 
Ú
 ;)

92 
d–
 
	gch”rypy
.
	gcÚfig
['tools.log_tracebacks.on']

93 
d–
 
	gch”rypy
.
	gcÚfig
['tools.log_headers.on']

94 
d–
 
	gch”rypy
.
	gcÚfig
['tools.trailing_slash.on']

96 
	g­pcÚf
 = {

98 'toŞs.¡©icdœ.Ú': 
True
,

100 'toŞs.¡©icdœ.roÙ': 
curdœ
,

103 
­p
 = 
ch”rypy
.
Œ“
.
mouÁ
(
RoÙ
(), 
SCRIPT_NAME
, 
­pcÚf
)

106 
şass
 
	gNuÎReque¡
:

109 
def
 
__š™__
(
£lf
, 
loÿl
, 
»mÙe
, 
scheme
="http"):

110 
·ss


112 
def
 
	$şo£
(
£lf
):

113 
·ss


115 
def
 
	$run
(
£lf
, 
m‘hod
, 
·th
, 
qu”y_¡ršg
, 
´ÙocŞ
, 
h—d”s
, 
rfe
):

116 
ch”rypy
.
»¥Ú£
.
¡©us
 = "200 OK"

117 
ch”rypy
.
»¥Ú£
.
h—d”_li¡
 = [("Content-Type", 'text/html'),

119 ("D©e", 
h‰put
.
	`HTTPD©e
()),

122 
ch”rypy
.
»¥Ú£
.
body
 = [""]

123  
ch”rypy
.
»¥Ú£


126 
şass
 
NuÎRe¥Ú£
:

127 
·ss


130 
şass
 
ABSessiÚ
:

133 
Exam¶e
 
ouut
 
äom
 
ab
:

135 
This
 
is
 
A·cheB’ch
, 
V”siÚ
 2.0.40-
dev
 <
$RevisiÚ
: 1.121.2.1 
$
> 
­ache
-2.0

136 
	`Cİyright
 (
c
è1996 
Adam
 
Twiss
, 
Zeus
 
TechnŞogy
 
Ltd
, 
h‰p
:

137 
	`Cİyright
 (
c
è1998-2002 
The
 
A·che
 
Soáw¬e
 
Found©iÚ
, 
h‰p
:

139 
B’chm¬kšg
 127.0.0.1 (
be
 
·t›Á
)

140 
Com¶‘ed
 100 
»que¡s


141 
Com¶‘ed
 200 
»que¡s


142 
Com¶‘ed
 300 
»que¡s


143 
Com¶‘ed
 400 
»que¡s


144 
Com¶‘ed
 500 
»que¡s


145 
Com¶‘ed
 600 
»que¡s


146 
Com¶‘ed
 700 
»que¡s


147 
Com¶‘ed
 800 
»que¡s


148 
Com¶‘ed
 900 
»que¡s


151 
S”v”
 
Soáw¬e
: 
Ch”ryPy
/3.1be



152 
S”v”
 
Ho¡Çme
: 127.0.0.1

153 
S”v”
 
PÜt
: 54583

155 
Docum’t
 
P©h
: //
šdex
.
html


156 
Docum’t
 
L’gth
: 14 
by‹s


158 
CÚcu¼’cy
 
Lev–
: 10

159 
Time
 
k’
 
‹¡s
: 9.643867 
£cÚds


160 
Com¶‘e
 
»que¡s
: 1000

161 
Faed
 
»que¡s
: 0

162 
Wr™e
 
”rÜs
: 0

163 
TÙ®
 
Œªsã¼ed
: 189000 
by‹s


164 
HTML
 
Œªsã¼ed
: 14000 
by‹s


165 
Reque¡s
 
³r
 
£cÚd
: 103.69 [#/
£c
] (
m—n
)

166 
Time
 
³r
 
»que¡
: 96.439 [
ms
] (
m—n
)

167 
Time
 
³r
 
»que¡
: 9.644 [
ms
] (
m—n
, 
aüoss
 
®l
 
cÚcu¼’t
 
»que¡s
)

168 
T¿nsãr
 
¿‹
: 19.08 [
Kby‹s
/
£c
] 
»ûived


170 
CÚÃùiÚ
 
	$Times
 (
ms
)

171 
mš
 
m—n
[+/-
sd
] 
medŸn
 
max


172 
CÚÃù
: 0 0 2.9 0 10

173 
Proûssšg
: 20 94 7.3 90 130

174 
Wa™šg
: 0 43 28.1 40 100

175 
TÙ®
: 20 95 7.3 100 130

177 
P”ûÁage
 
of
 
the
 
»que¡s
 
£rved
 
w™hš
 
a
 
û¹aš
 
	`time
 (
ms
)

186 100% 130 (
lÚge¡
 
»que¡
)

187 
Fšished
 1000 
»que¡s


190 
·r£_·‰”ns
 = [('complete_requests', 'Completed',

191 
	`Áob
(
r
'^Complete„equests:\s*(\d+)')),

193 
	`Áob
(
r
'^Failed„equests:\s*(\d+)')),

195 
	`Áob
(
r
'^Requests…er second:\s*([0-9.]+)')),

197 
	`Áob
(
r
'^Time…er„equest:\s*([0-9.]+).*concurrent„equests\)$')),

199 
	`Áob
(
r
'^Transfer„ate:\s*([0-9.]+)')),

202 
def
 
	`__š™__
(
£lf
, 
·th
=
SCRIPT_NAME
 + "/h–lo", 
»que¡s
=1000, 
cÚcu¼’cy
=10):

203 
£lf
.
·th
 =…ath

204 
£lf
.
»que¡s
 =„equests

205 
£lf
.
cÚcu¼’cy
 = concurrency

207 
def
 
	$¬gs
(
£lf
):

208 
pÜt
 = 
ch”rypy
.
£rv”
.
sock‘_pÜt


209 
as£¹
 
£lf
.
cÚcu¼’cy
 > 0

210 
as£¹
 
£lf
.
»que¡s
 > 0

212 #Cà
h‰p
:

214 (
£lf
.
»que¡s
, s–f.
cÚcu¼’cy
, 
pÜt
, s–f.
·th
))

216 
def
 
	$run
(
£lf
):

217 #P¬£ 
ouut
 
of
 
ab
, 
£‰šg
 
©Œibu‹s
 
Ú
 
£lf


218 
Œy
:

219 
£lf
.
ouut
 = 
_ımodpy
.
	`»ad_´oûss
(
AB_PATH
 
Ü
 "ab", s–f.
	$¬gs
())

220 
exû±
:

221 
	`´št
(
_ı”rÜ
.
	$fÜm©_exc
())

222 
¿i£


224 
©Œ
, 
Çme
, 
·‰”n
 
š
 
£lf
.
·r£_·‰”ns
:

225 
v®
 = 
»
.
	$£¬ch
(
·‰”n
, 
£lf
.
ouut
, 
»
.
MULTILINE
)

226 
v®
:

227 
v®
 = v®.
	$group
(1)

228 
	$£‰r
(
£lf
, 
©Œ
, 
v®
)

230 
	$£‰r
(
£lf
, 
©Œ
, 
NÚe
)

233 
§ã_th»ads
 = (25, 50, 100, 200, 400)

234 
sys
.
¶©fÜm
 
	`š
 ("win32",):

235 #FÜ 
some
 
»asÚ
, 
ab
 
üashes
 
w™h
 > 50 
th»ads
 
Ú
 
my
 
Wš2k
 
Ï±İ
.

236 
§ã_th»ads
 = (10, 20, 30, 40, 50)

239 
def
 
	`th»ad_»pÜt
(
·th
=
SCRIPT_NAME
 + "/h–lo", 
cÚcu¼’cy
=
§ã_th»ads
):

240 
£ss
 = 
	$ABSessiÚ
(
·th
)

241 
©Œs
, 
Çmes
, 
·‰”ns
 = 
	`li¡
(
	$z
(*
£ss
.
·r£_·‰”ns
))

242 
avg
 = 
diù
.
	$äomkeys
(
©Œs
, 0.0)

244 
	`y›ld
 ('th»ads',è+ 
Çmes


245 
c
 
š
 
cÚcu¼’cy
:

246 
£ss
.
cÚcu¼’cy
 = 
c


247 
£ss
.
	$run
()

248 
row
 = [
c
]

249 
©Œ
 
š
 
©Œs
:

250 
v®
 = 
	$g‘©Œ
(
£ss
, 
©Œ
)

251 
v®
 
is
 
NÚe
:

252 
	$´št
(
£ss
.
ouut
)

253 
row
 = 
NÚe


255 
v®
 = (val)

256 
avg
[
©Œ
] +ğ(
v®
)

257 
row
.
	$­³nd
(
v®
)

258 
row
:

259 
y›ld
 
row


261 #Add 
a
 
row
 
of
 
av”ages
.

262 
y›ld
 ["Av”age"] + [
	`¡r
(
avg
[
©Œ
] / 
	$Ën
(
cÚcu¼’cy
)è
©Œ
 
š
 
©Œs
]

264 
def
 
	`size_»pÜt
(
sizes
=(10, 100, 1000, 10000, 100000, 100000000),

265 
cÚcu¼’cy
=50):

266 
£ss
 = 
	$ABSessiÚ
(
cÚcu¼’cy
=concurrency)

267 
©Œs
, 
Çmes
, 
·‰”ns
 = 
	`li¡
(
	$z
(*
£ss
.
·r£_·‰”ns
))

268 
	`y›ld
 ('by‹s',è+ 
Çmes


269 
sz
 
š
 
sizes
:

270 
£ss
.
·th
 = "%s/siz”?size=%s" % (
SCRIPT_NAME
, 
sz
)

271 
£ss
.
	$run
()

272 
y›ld
 [
sz
] + [
	$g‘©Œ
(
£ss
, 
©Œ
è©Œ 
š
 
©Œs
]

274 
def
 
	$´št_»pÜt
(
rows
):

275 
row
 
š
 
rows
:

276 
	`´št
("")

277 
i
, 
v®
 
š
 
	$’um”©e
(
row
):

278 
sys
.
¡dout
.
	`wr™e
(
	`¡r
(
v®
).
	`rju¡
(10) + " | ")

279 
	`´št
("")

282 
def
 
	$run_¡ªd¬d_b’chm¬ks
():

283 
	`´št
("")

284 
	`´št
("Client Thread Report (1000„equests, 14 byte„esponse body, "

285 "% £rv”h»ads):" % 
ch”rypy
.
£rv”
.
th»ad_poŞ
)

286 
	`´št_»pÜt
(
	$th»ad_»pÜt
())

288 
	`´št
("")

289 
	`´št
("Client Thread Report (1000„equests, 14 bytes via staticdir, "

290 "% £rv”h»ads):" % 
ch”rypy
.
£rv”
.
th»ad_poŞ
)

291 
	`´št_»pÜt
(
	`th»ad_»pÜt
("%s/¡©ic/šdex.html" % 
SCRIPT_NAME
))

293 
	`´št
("")

294 
	`´št
("Size Report (1000„equests, 50 clienthreads, "

295 "% £rv”h»ads):" % 
ch”rypy
.
£rv”
.
th»ad_poŞ
)

296 
	`´št_»pÜt
(
	$size_»pÜt
())

299 #modpythÚ 
ªd
 
Ùh”
 
WSGI
 #


300 
def
 
	$¡¬tup_modpythÚ
(
»q
=
NÚe
):

302 
ch”rypy
.
’gše
.
¡©e
 =ğch”rypy.
_ı’gše
.
STOPPED
:

303 
»q
:

304 "nuÎ»q" 
š
 
»q
.
	$g‘_İtiÚs
():

305 
ch”rypy
.
’gše
.
»que¡_şass
 = 
NuÎReque¡


306 
ch”rypy
.
’gše
.
»¥Ú£_şass
 = 
NuÎRe¥Ú£


307 
ab_İt
 = 
»q
.
	`g‘_İtiÚs
().
	`g‘
("ab", "")

308 
ab_İt
:

309 
glob®
 
AB_PATH


310 
AB_PATH
 = 
ab_İt


311 
ch”rypy
.
’gše
.
	$¡¬t
()

312 
ch”rypy
.
’gše
.
¡©e
 =ğch”rypy.
_ı’gše
.
STARTING
:

313 
ch”rypy
.
’gše
.
	$wa™
()

314  0 #­ache.
OK


317 
def
 
	$run_modpythÚ
(
u£_wsgi
=
F®£
):

318 
	`´št
("Starting mod_python...")

319 
pyİts
 = []

321 #Pas 
the
 
nuÎ
 
ªd
 
ab
=
·th
 
İtiÚs
 
through
 
A·che


322 "--nuÎ" 
š
 
İts
:

323 
pyİts
.
	`­³nd
(("nullreq", ""))

325 "--ab" 
š
 
İts
:

326 
pyİts
.
	`­³nd
(("ab", 
İts
["--ab"]))

328 
s
 = 
_ımodpy
.
ModPythÚS”v”


329 
u£_wsgi
:

330 
pyİts
.
	`­³nd
(("wsgi.application", "cherrypy::tree"))

331 
pyİts
.
	`­³nd
(("wsgi.startup", "cherrypy.test.benchmark::startup_modpython"))

332 
hªdËr
 = "modpython_gateway::handler"

333 
s
 = 
	$s
(
pÜt
=54583, 
İts
=
pyİts
, 
­ache_·th
=
APACHE_PATH
, 
hªdËr
=handler)

335 
pyİts
.
	`­³nd
(("cherrypy.setup", "cherrypy.test.benchmark::startup_modpython"))

336 
s
 = 
	$s
(
pÜt
=54583, 
İts
=
pyİts
, 
­ache_·th
=
APACHE_PATH
)

338 
Œy
:

339 
s
.
	$¡¬t
()

340 
	$run
()

341 
fš®ly
:

342 
s
.
	$¡İ
()

346 
__Çme__
 == '__main__':

347 
lÚgİts
 = ['cpmodpy', 'modpython', 'null', 'notests',

349 
Œy
:

350 
sw™ches
, 
¬gs
 = 
g‘İt
.
	`g‘İt
(
sys
.
¬gv
[1:], "", 
lÚgİts
)

351 
İts
 = 
	$diù
(
sw™ches
)

352 
exû±
 
g‘İt
.
G‘İtE¼Ü
:

353 
	$´št
(
__doc__
)

354 
sys
.
	$ex™
(2)

356 "--h–p" 
š
 
İts
:

357 
	$´št
(
__doc__
)

358 
sys
.
	$ex™
(0)

360 "--ab" 
š
 
İts
:

361 
AB_PATH
 = 
İts
['--ab']

363 "--nÙe¡s" 
š
 
İts
:

364 #R‘uº 
w™hout
 
¡İpšg
 
the
 
£rv”
, 
so
 
th©
h
·ges


365 #ÿÀ
be
 
‹¡ed
 
äom
 
a
 
¡ªd¬d
 
web
 
brow£r
.

366 
def
 
	$run
():

367 
pÜt
 = 
ch”rypy
.
£rv”
.
sock‘_pÜt


368 
	`´št
("You may‚ow open http://127.0.0.1:%s%s/" %

369 (
pÜt
, 
SCRIPT_NAME
))

371 "--nuÎ" 
š
 
İts
:

372 
	`´št
("Using‚ull Request object")

374 
def
 
	$run
():

375 
’d
 = 
time
.
	`time
(è- 
¡¬t


376 
	`´št
("S¹ed iÀ% £cÚds" % 
’d
)

377 "--nuÎ" 
š
 
İts
:

378 
	`´št
("\nUsing‚ull Request object")

379 
Œy
:

380 
Œy
:

381 
	$run_¡ªd¬d_b’chm¬ks
()

382 
exû±
:

383 
	`´št
(
_ı”rÜ
.
	$fÜm©_exc
())

384 
¿i£


385 
fš®ly
:

386 
ch”rypy
.
’gše
.
	$ex™
()

388 
	`´št
("Starting CherryPy‡pp server...")

390 
şass
 
	$NuÎWr™”
(
objeù
):

392 
def
 
	$wr™e
(
£lf
, 
d©a
):

393 
·ss


394 
sys
.
¡d”r
 = 
	$NuÎWr™”
()

396 
¡¬t
 = 
time
.
	$time
()

398 "--ımodpy" 
š
 
İts
:

399 
	$run_modpythÚ
()

400 
–if
 "--modpythÚ" 
š
 
İts
:

401 
	$run_modpythÚ
(
u£_wsgi
=
True
)

403 "--nuÎ" 
š
 
İts
:

404 
ch”rypy
.
£rv”
.
»que¡_şass
 = 
NuÎReque¡


405 
ch”rypy
.
£rv”
.
»¥Ú£_şass
 = 
NuÎRe¥Ú£


407 
ch”rypy
.
’gše
.
	$¡¬t_w™h_ÿÎback
(
run
)

408 
ch”rypy
.
’gše
.
	`block
()

	@trunk/objs/CherryPy-3.2.4/cherrypy/test/checkerdemo.py

3 
This
 
­¶iÿtiÚ
 
is
 
š‹ÁiÚ®ly
 
brok’
 
ªd
 
badly
 
	gdesigÃd
.

4 
To
 
demÚ¡¿‹
 
the
 
ouut
 
of
h
Ch”ryPy
 
	gCheck”
, 
sim¶y
 
execu‹


5 
this
 
	gmoduË
.

8 
impÜt
 
os


9 
impÜt
 
ch”rypy


10 
	gthisdœ
 = 
os
.
·th
.
dœÇme
(os.·th.
	$ab¥©h
(
__fe__
))

12 
şass
 
RoÙ
:

13 
·ss


15 
__Çme__
 == '__main__':

16 
cÚf
 = {'/ba£': {'toŞs.¡©icdœ.roÙ': 
thisdœ
,

17 #ObsŞ‘
key
.

18 'throw_”rÜs': 
True
,

20 #Thi 
’Œy
 
should
 
be
 
OK
.

21 '/ba£/¡©ic': {'toŞs.¡©icdœ.Ú': 
True
,

23 #W¬À
Ú
 
missšg
 
fŞd”
.

24 '/ba£/js': {'toŞs.¡©icdœ.Ú': 
True
,

26 #W¬À
Ú
 
dœ
 
w™h
 
ª
 
abs
 
·th
 
ev’
 
though
 
we
 
´ovide
 
roÙ
.

27 '/ba£/¡©ic2': {'toŞs.¡©icdœ.Ú': 
True
,

29 #W¬À
Ú
 
dœ
 
w™h
 
a
 
»Ïtive
 
·th
 w™h 
no
 
roÙ
.

30 '/¡©ic3': {'toŞs.¡©icdœ.Ú': 
True
,

32 #W¬À
Ú
 
unknown
 
Çme¥aû


33 '/unknown': {'toobËs.gz.Ú': 
True
},

34 #W¬À
¥ecŸl
 
Ú
 
ch”rypy
.<
known
 
ns
>.*

35 '/ıknown': {'ch”rypy.toŞs.’code.Ú': 
True
},

36 #W¬À
Ú
 
mism©ched
 
ty³s


38 #W¬À
Ú
 
unknown
 
toŞ
.

39 '/web': {'toŞs.unknown.Ú': 
True
},

40 #W¬À
Ú
 
£rv”
.* 
š
 
­p
 
cÚfig
.

42 #W¬À
Ú
 'localhost'

44 #W¬À
Ú
 '[name]'

46 
	}
}

47 
ch”rypy
.
quick¡¬t
(
RoÙ
(), 
cÚfig
=
cÚf
)

	@trunk/objs/CherryPy-3.2.4/cherrypy/test/helper.py

3 
impÜt
 
d©‘ime


4 
impÜt
 
loggšg


5 
	glog
 = 
loggšg
.
	$g‘Logg”
(
__Çme__
)

6 
impÜt
 
os


7 
thisdœ
 = 
os
.
·th
.
	`ab¥©h
(os.·th.
	$dœÇme
(
__fe__
))

8 
£rv”³m
 = 
os
.
·th
.
	`još
(os.
	`g‘cwd
(), 
thisdœ
, 'test.pem')

10 
impÜt
 
»


11 
impÜt
 
sys


12 
impÜt
 
time


13 
impÜt
 
w¬nšgs


15 
impÜt
 
ch”rypy


16 
äom
 
ch”rypy
.
_ıcom·t
 
impÜt
 
ba£¡ršg
, 
cİy™ems
, 
HTTPSCÚÃùiÚ
, 
Áob


17 
äom
 
ch”rypy
.
_ıcom·t
 
impÜt
 
sub´oûss


18 
äom
 
ch”rypy
.
lib
 
impÜt
 
h‰put


19 
äom
 
ch”rypy
.
lib
 
impÜt
 
gùoŞs


20 
äom
 
ch”rypy
.
lib
.
»´cÚf
 
impÜt
 
uÄ•r


21 
äom
 
ch”rypy
.
‹¡
 
impÜt
 
web‹¡


23 
impÜt
 
no£


25 
_‹¡cÚfig
 = 
NÚe


27 
def
 
	`g‘_t¡_cÚfig
(
ov”cÚf
 = {
	}
}):

28 
glob®
 
_‹¡cÚfig


29 
_‹¡cÚfig
 
is
 
NÚe
:

30 
cÚf
 = {

35 'v®id©e': 
F®£
,

36 'cÚqu”': 
F®£
,

39 
Œy
:

40 
impÜt
 
‹¡cÚfig


41 
_cÚf
 = 
‹¡cÚfig
.
cÚfig
.
g‘
('su³rvisÜ', 
NÚe
)

42 
_cÚf
 
is
 
nÙ
 
	gNÚe
:

43 
k
, 
v
 
š
 
	g_cÚf
.
	$™ems
():

44 
	$isš¡ªû
(
v
, 
ba£¡ršg
):

45 
_cÚf
[
k
] = 
	$uÄ•r
(
v
)

46 
cÚf
.
	$upd©e
(
_cÚf
)

47 
exû±
 
ImpÜtE¼Ü
:

48 
·ss


49 
_‹¡cÚfig
 = 
cÚf


50 
cÚf
 = 
_‹¡cÚfig
.
	$cİy
()

51 
cÚf
.
	$upd©e
(
ov”cÚf
)

53  
cÚf


55 
şass
 
	$Su³rvisÜ
(
objeù
):

58 
def
 
	$__š™__
(
£lf
, **
kw¬gs
):

59 
k
, 
v
 
š
 
kw¬gs
.
	$™ems
():

60 
k
 == 'port':

61 
	`£‰r
(
£lf
, 
k
, (
v
))

62 
	$£‰r
(
£lf
, 
k
, 
v
)

65 
log_to_¡d”r
 = 
Ïmbda
 
msg
, 
Ëv–
: 
sys
.
¡d”r
.
	`wr™e
(msg + 
os
.
lše£p
)

67 
şass
 
	$LoÿlSu³rvisÜ
(
Su³rvisÜ
):

70 
Wh’
 
the
 
£rv”
 
side
 
runs
 
š
 
a
 
difã»Á
 
´oûss
, 
¡¬t
/
¡İ
 
ÿn
 
dump
 
®l


71 
¡©e
 
b‘w“n
 
—ch
 
‹¡
 
moduË
 
—sy
. 
Wh’
 
the
 
£rv”
 
side
 
runs
 
š
he

72 
§me
 
´oûss
 
as
 
the
 
ş›Á
, 
howev”
, 
we
 
have
 
to
 dØ
a
 
b™
 
mÜe
 
wÜk
Ø
’su»


73 
cÚfig
 
ªd
 
mouÁed
 
­ps
 
¬e
 
»£t
 
b‘w“n
 
‹¡s
.

76 
usšg_­ache
 = 
F®£


77 
usšg_wsgi
 = 
F®£


79 
def
 
	$__š™__
(
£lf
, **
kw¬gs
):

80 
k
, 
v
 
š
 
kw¬gs
.
	$™ems
():

81 
	$£‰r
(
£lf
, 
k
, 
v
)

83 
ch”rypy
.
£rv”
.
h‰p£rv”
 = 
£lf
.
h‰p£rv”_şass


85 #Thi 
is
 
³rh­s
 
the
 
wrÚg
 
¶aû
 
this
 
ÿÎ
 
but
hi i th
Úly


86 #¶aû 
th©
 
i
've found so farhat I KNOW isƒarlyƒnougho sethis.

87 
ch”rypy
.
cÚfig
.
	`upd©e
({'log.sü“n': 
F®£
})

88 
’gše
 = 
ch”rypy
.engine

89 
ha§‰r
(
’gše
, "signal_handler"):

90 
’gše
.
sigÇl_hªdËr
.
	$subsüibe
()

91 
	`ha§‰r
(
’gše
, "console_control_handler"):

92 
’gše
.
cÚsŞe_cÚŒŞ_hªdËr
.
	$subsüibe
()

93 #’gše.
	`subsüibe
('log', 
log_to_¡d”r
)

95 
def
 
	$¡¬t
(
£lf
, 
moduËÇme
=
NÚe
):

97 
moduËÇme
:

98 #Unhook 
h‰p£rv”
 
so
 
ch”rypy
.
£rv”
.
	`¡¬t
(è
ü—‹s
 
a
 
Ãw


99 #Ú(
w™h
 
cÚfig
 
äom
 
£tup_£rv”
, 
deş¬ed
).

100 
ch”rypy
.
£rv”
.
h‰p£rv”
 = 
NÚe


102 
ch”rypy
.
’gše
.
	$¡¬t
()

104 
£lf
.
	$sync_­ps
()

106 
def
 
	$sync_­ps
(
£lf
):

108 
·ss


110 
def
 
	$¡İ
(
£lf
):

111 
td
 = 
	`g‘©Œ
(
£lf
, '‹¬down', 
NÚe
)

112 
td
:

113 
	$td
()

115 
ch”rypy
.
’gše
.
	$ex™
()

117 
Çme
, 
£rv”
 
š
 
	`cİy™ems
(
	`g‘©Œ
(
ch”rypy
, '£rv”s', {
	}
})):

118 
£rv”
.
	$unsubsüibe
()

119 
d–
 
ch”rypy
.
£rv”s
[
Çme
]

122 
şass
 
	$N©iveS”v”Su³rvisÜ
(
LoÿlSu³rvisÜ
):

125 
h‰p£rv”_şass
 = "cherrypy._cpnative_server.CPHTTPServer"

126 
usšg_­ache
 = 
F®£


127 
usšg_wsgi
 = 
F®£


129 
def
 
	$__¡r__
(
£lf
):

130  "Butš HTTP S”v” oÀ%s:%s" % (
£lf
.
ho¡
, s–f.
pÜt
)

133 
şass
 
	$LoÿlWSGISu³rvisÜ
(
LoÿlSu³rvisÜ
):

136 
h‰p£rv”_şass
 = "cherrypy._cpwsgi_server.CPWSGIServer"

137 
usšg_­ache
 = 
F®£


138 
usšg_wsgi
 = 
True


140 
def
 
	$__¡r__
(
£lf
):

141  "Butš WSGI S”v” oÀ%s:%s" % (
£lf
.
ho¡
, s–f.
pÜt
)

143 
def
 
	$sync_­ps
(
£lf
):

145 
ch”rypy
.
£rv”
.
h‰p£rv”
.
wsgi_­p
 = 
£lf
.
	$g‘_­p
()

147 
def
 
	$g‘_­p
(
£lf
, 
­p
=
NÚe
):

149 
­p
 
is
 
NÚe
:

150 
­p
 = 
ch”rypy
.
Œ“


152 
£lf
.
cÚqu”
:

153 
Œy
:

154 
impÜt
 
wsgicÚq


155 
exû±
 
ImpÜtE¼Ü
:

156 
w¬nšgs
.
	`w¬n
("Error importing wsgiconq.…yconquer will‚ot„un.")

158 
­p
 = 
wsgicÚq
.
	$WSGILogg”
(
­p
, 
c_ÿÎs
=
True
)

160 
£lf
.
v®id©e
:

161 
Œy
:

162 
äom
 
wsgœef
 
impÜt
 
v®id©e


163 
exû±
 
ImpÜtE¼Ü
:

164 
w¬nšgs
.
	`w¬n
("Error importing wsgiref. The validator will‚ot„un.")

166 #w¿p 
the
 
­p
 
š
h
v®id©Ü


167 
­p
 = 
v®id©e
.
	$v®id©Ü
(
­p
)

169  
­p


172 
def
 
	$g‘_ımodpy_su³rvisÜ
(**
İtiÚs
):

173 
äom
 
ch”rypy
.
‹¡
 
impÜt
 
modpy


174 
sup
 = 
modpy
.
	$ModPythÚSu³rvisÜ
(**
İtiÚs
)

175 
sup
.
‹m¶©e
 = 
modpy
.
cÚf_ımodpy


176  
sup


178 
def
 
	$g‘_modpygw_su³rvisÜ
(**
İtiÚs
):

179 
äom
 
ch”rypy
.
‹¡
 
impÜt
 
modpy


180 
sup
 = 
modpy
.
	$ModPythÚSu³rvisÜ
(**
İtiÚs
)

181 
sup
.
‹m¶©e
 = 
modpy
.
cÚf_modpythÚ_g©eway


182 
sup
.
usšg_wsgi
 = 
True


183  
sup


185 
def
 
	$g‘_modwsgi_su³rvisÜ
(**
İtiÚs
):

186 
äom
 
ch”rypy
.
‹¡
 
impÜt
 
modwsgi


187  
modwsgi
.
	$ModWSGISu³rvisÜ
(**
İtiÚs
)

189 
def
 
	$g‘_modfcgid_su³rvisÜ
(**
İtiÚs
):

190 
äom
 
ch”rypy
.
‹¡
 
impÜt
 
modfcgid


191  
modfcgid
.
	$ModFCGISu³rvisÜ
(**
İtiÚs
)

193 
def
 
	$g‘_modç¡cgi_su³rvisÜ
(**
İtiÚs
):

194 
äom
 
ch”rypy
.
‹¡
 
impÜt
 
modç¡cgi


195  
modç¡cgi
.
	$ModFCGISu³rvisÜ
(**
İtiÚs
)

197 
def
 
	$g‘_wsgi_u_su³rvisÜ
(**
İtiÚs
):

198 
ch”rypy
.
£rv”
.
wsgi_v”siÚ
 = ('u', 0)

199  
	$LoÿlWSGISu³rvisÜ
(**
İtiÚs
)

202 
şass
 
	$CPWebCa£
(
web‹¡
.
WebCa£
):

204 
süt_Çme
 = ""

205 
scheme
 = "http"

207 
avaabË_£rv”s
 = {'wsgi': 
LoÿlWSGISu³rvisÜ
,

208 'wsgi_u': 
g‘_wsgi_u_su³rvisÜ
,

209 'Çtive': 
N©iveS”v”Su³rvisÜ
,

210 'ımodpy': 
g‘_ımodpy_su³rvisÜ
,

211 'modpygw': 
g‘_modpygw_su³rvisÜ
,

212 'modwsgi': 
g‘_modwsgi_su³rvisÜ
,

213 'modfcgid': 
g‘_modfcgid_su³rvisÜ
,

214 'modç¡cgi': 
g‘_modç¡cgi_su³rvisÜ
,

215 
	}
}

216 
deçuÉ_£rv”
 = "wsgi"

218 
def
 
	$_£tup_£rv”
(
şs
, 
su³rvisÜ
, 
cÚf
):

219 
v
 = 
sys
.
v”siÚ
.
	`¥l™
()[0]

220 
log
.
	`šfo
("PythÚ v”siÚ u£dØruÀthi ‹¡ süt: %s" % 
v
)

221 
log
.
	`šfo
("Ch”ryPy v”siÚ: %s" % 
ch”rypy
.
__v”siÚ__
)

222 
su³rvisÜ
.
scheme
 == "https":

223 
s¦
 = " (ssl)"

225 
s¦
 = ""

226 
log
.
	`šfo
("HTTP s”v” v”siÚ: %s%s" % (
su³rvisÜ
.
´ÙocŞ
, 
s¦
))

227 
log
.
	`šfo
("PID: %s" % 
os
.
	$g‘pid
())

229 
ch”rypy
.
£rv”
.
usšg_­ache
 = 
su³rvisÜ
.using_apache

230 
ch”rypy
.
£rv”
.
usšg_wsgi
 = 
su³rvisÜ
.using_wsgi

232 
sys
.
¶©fÜm
[:4] == 'java':

233 
ch”rypy
.
cÚfig
.
	`upd©e
({'£rv”.nod–ay': 
F®£
})

235 
	$isš¡ªû
(
cÚf
, 
ba£¡ršg
):

236 
·r£r
 = 
ch”rypy
.
lib
.
»´cÚf
.
	$P¬£r
()

237 
cÚf
 = 
·r£r
.
	`diù_äom_fe
(cÚf).
	`g‘
('glob®', {
	}
})

239 
cÚf
 = cÚà
Ü
 {}

240 
ba£cÚf
 = 
cÚf
.
	$cİy
()

241 
ba£cÚf
.
	`upd©e
({'£rv”.sock‘_ho¡': 
su³rvisÜ
.
ho¡
,

242 '£rv”.sock‘_pÜt': 
su³rvisÜ
.
pÜt
,

243 '£rv”.´ÙocŞ_v”siÚ': 
su³rvisÜ
.
´ÙocŞ
,

245 
	}
})

246 
su³rvisÜ
.
scheme
 == "https":

248 
ba£cÚf
['£rv”.s¦_û¹ifiÿ‹'] = 
£rv”³m


249 
ba£cÚf
['£rv”.s¦_´iv©e_key'] = 
£rv”³m


251 #h–³¸
mu¡
 
be
 
impÜ‹d
 
Ïzy
 
so
 
the
 
cov”age
 
toŞ


252 #ÿÀ
run
 
agaš¡
 
moduË
-
Ëv–
 
¡©em’ts
 
w™hš
 
ch”rypy
.

253 #Also, 
we
 
have
 
to
 do "from cherrypy.test import helper",

254 #exaùly 
like
 
—ch
 
‹¡
 
moduË
 
dÛs
, 
beÿu£
 
a
 
»Ïtive
 
impÜt


255 #would 
¡ick
 
a
 
£cÚd
 
š¡ªû
 
of
 
web‹¡
 
š
 
sys
.
moduËs
,

256 #ªd 
we
 
wouldn
't be‡bleo globally overridehe…ort‡nymore.

257 
	gsu³rvisÜ
.
	gscheme
 == "https":

258 
web‹¡
.
WebCa£
.
HTTP_CONN
 = 
HTTPSCÚÃùiÚ


259  
ba£cÚf


260 
_£tup_£rv”
 = 
	$şassm‘hod
(
_£tup_£rv”
)

262 
def
 
	$£tup_şass
(
şs
):

264 #C»©e 
a
 
£rv”


265 
cÚf
 = 
	$g‘_t¡_cÚfig
()

266 
su³rvisÜ_çùÜy
 = 
şs
.
avaabË_£rv”s
.
	`g‘
(
cÚf
.get('server', 'wsgi'))

267 
su³rvisÜ_çùÜy
 
is
 
NÚe
:

268 
¿i£
 
	`RuÁimeE¼Ü
('UnknowÀ£rv” iÀcÚfig: %s' % 
cÚf
['server'])

269 
su³rvisÜ
 = 
	$su³rvisÜ_çùÜy
(**
cÚf
)

271 #Cİ›d 
äom
 "run_test_suite"

272 
ch”rypy
.
cÚfig
.
	$»£t
()

273 
ba£cÚf
 = 
şs
.
	$_£tup_£rv”
(
su³rvisÜ
, 
cÚf
)

274 
ch”rypy
.
cÚfig
.
	$upd©e
(
ba£cÚf
)

275 
	$£tup_ş›Á
()

277 
	`ha§‰r
(
şs
, 'setup_server'):

278 #CË¬ 
the
 
ch”rypy
 
Œ“
 
ªd
 
ş—r
h
wsgi
 
£rv”
 
so
 
th©


279 #™ 
ÿn
 
be
 
upd©ed
 
w™h
 
the
 
Ãw
 
roÙ


280 
ch”rypy
.
Œ“
 = ch”rypy.
_ıŒ“
.
	$T»e
()

281 
ch”rypy
.
£rv”
.
h‰p£rv”
 = 
NÚe


282 
şs
.
	$£tup_£rv”
()

283 #Add 
a
 
»sourû
 
v”ifyšg
 
th”e
 
¬e
 
no
 
»æ—ks


284 #tØ*
ev”y
* 
‹¡
 
şass
.

285 
ch”rypy
.
Œ“
.
	`mouÁ
(
gùoŞs
.
	`GCRoÙ
(), '/gc')

286 
şs
.
do_gc_‹¡
 = 
True


287 
su³rvisÜ
.
	$¡¬t
(
şs
.
__moduË__
)

289 
şs
.
su³rvisÜ
 = supervisor

290 
£tup_şass
 = 
	$şassm‘hod
(
£tup_şass
)

292 
def
 
	$‹¬down_şass
(
şs
):

294 
	`ha§‰r
(
şs
, 'setup_server'):

295 
şs
.
su³rvisÜ
.
	$¡İ
()

296 
‹¬down_şass
 = 
	$şassm‘hod
(
‹¬down_şass
)

298 
do_gc_‹¡
 = 
F®£


300 
def
 
	$‹¡_gc
(
£lf
):

301 
£lf
.
do_gc_‹¡
:

302 
£lf
.
	`g‘Page
("/gc/stats")

303 
£lf
.
	`as£¹Body
("Statistics:")

304 #T–È
no£
 
to
 
run
 
this
 
Ï¡
 
š
 
—ch
 
şass
.

305 #P»ã¸
sys
.
maxšt
 
PythÚ
 2.3, 
which
 
didn
'ˆhavæßt('
šf
')

306 
‹¡_gc
.
com·t_co_fœ¡lš’o
 = 
	`g‘©Œ
(
sys
, 'maxšt', 
NÚe
è
Ü
 ('inf')

308 
def
 
	$´efix
(
£lf
):

309  
£lf
.
süt_Çme
.
	`r¡r
("/")

311 
def
 
	$ba£
(
£lf
):

312 ià((
£lf
.
scheme
 =ğ"h‰p" 
ªd
 s–f.
PORT
 =ğ80è
Ü


313 (
£lf
.
scheme
 =ğ"h‰ps" 
ªd
 s–f.
PORT
 == 443)):

314 
pÜt
 = ""

316 
pÜt
 = ":%s" % 
£lf
.
PORT


318  "%s://%s%s%s" % (
£lf
.
scheme
, s–f.
HOST
, 
pÜt
,

319 
£lf
.
süt_Çme
.
	`r¡r
("/"))

321 
def
 
	$ex™
(
£lf
):

322 
sys
.
	$ex™
()

324 
def
 
	`g‘Page
(
£lf
, 
u¾
, 
h—d”s
=
NÚe
, 
m‘hod
="GET", 
body
=NÚe, 
´ÙocŞ
=None):

326 
£lf
.
süt_Çme
:

327 
u¾
 = 
h‰put
.
	$u¾još
(
£lf
.
süt_Çme
, 
u¾
)

328  
web‹¡
.
WebCa£
.
	$g‘Page
(
£lf
, 
u¾
, 
h—d”s
, 
m‘hod
, 
body
, 
´ÙocŞ
)

330 
def
 
	`sk
(
£lf
, 
msg
='skipped '):

331 
¿i£
 
no£
.
	$SkTe¡
(
msg
)

333 
def
 
	`as£¹E¼ÜPage
(
£lf
, 
¡©us
, 
mes§ge
=
NÚe
, 
·‰”n
=''):

336 
The
 
funùiÚ
 
wl
 
İtiÚ®ly
 
look
 
the
 
»gexp
 
·‰”n
,

337 
w™hš
 
the
 
exû±iÚ
 
embedded
 
š
h
”rÜ
 
·ge
."""

339 #Thi 
wl
 
Ãv”
 
cÚš
 
a
 
Œaûback


340 
·ge
 = 
ch”rypy
.
_ı”rÜ
.
	$g‘_”rÜ_·ge
(
¡©us
, 
mes§ge
=message)

342 #Fœ¡, 
‹¡
 
the
 
»¥Ú£
 
body
 
w™hout
 
checkšg
h
Œaûback
.

343 #Stick 
a
 
m©ch
-
®l
 
	`group
 (.*è
š
 
to
 
g¿b
 
the
 
Œaûback
.

344 
esc
 = 
»
.
esÿ³


345 
•age
 = 
	$esc
(
·ge
)

346 
•age
 =ƒ·ge.
	`»¶aû
(
	`esc
('<pre id="traceback"></pre>'),

347 
	`esc
('<pre id="traceback">') + '(.*)' +ƒsc('</pre>'))

348 
m
 = 
»
.
	`m©ch
(
	`Áob
(
•age
, 
£lf
.
’codšg
), s–f.
body
,„e.
DOTALL
)

349 
nÙ
 
m
:

350 
£lf
.
	`_hªdËwebE¼Ü
('E¼Ü…agdÛ nÙ m©ch;ƒx³ùed:\n' + 
·ge
)

353 #Now 
‹¡
 
the
 
·‰”n
 
agaš¡
h
Œaûback


354 
·‰”n
 
is
 
NÚe
:

355 #S³cŸl-
NÚe
 
to
 
m—n
 
th©
 
th”e
 
should
 
be
 *
no
* 
Œaûback
.

356 
m
 
ªd
 m.
	$group
(1):

357 
£lf
.
	`_hªdËwebE¼Ü
('Error…age containsraceback')

359 ià(
m
 
is
 
NÚe
è
	`Ü
 (

360 
nÙ
 
»
.
	`£¬ch
(
	`Áob
Ôe.
	`esÿ³
(
·‰”n
), 
£lf
.
’codšg
),

361 
m
.
	$group
(1))):

362 
msg
 = 'Error…age does‚ot contain %s inraceback'

363 
£lf
.
	`_hªdËwebE¼Ü
(
msg
 % 
	$»´
(
·‰”n
))

365 
d©e_tŞ”ªû
 = 2

367 
def
 
	$as£¹Equ®D©es
(
£lf
, 
dt1
, 
dt2
, 
£cÚds
=
NÚe
):

369 
£cÚds
 
is
 
NÚe
:

370 
£cÚds
 = 
£lf
.
d©e_tŞ”ªû


372 
dt1
 > 
dt2
:

373 
diff
 = 
dt1
 - 
dt2


375 
diff
 = 
dt2
 - 
dt1


376 
nÙ
 
diff
 < 
d©‘ime
.
	$timed–
(
£cÚds
=seconds):

377 
¿i£
 
	`As£¹iÚE¼Ü
('%r‡nd %r‡re‚ot within %r seconds.' %

378 (
dt1
, 
dt2
, 
£cÚds
))

381 
def
 
	$£tup_ş›Á
():

383 
web‹¡
.
WebCa£
.
PORT
 = 
ch”rypy
.
£rv”
.
sock‘_pÜt


384 
web‹¡
.
WebCa£
.
HOST
 = 
ch”rypy
.
£rv”
.
sock‘_ho¡


385 
ch”rypy
.
£rv”
.
s¦_û¹ifiÿ‹
:

386 
CPWebCa£
.
scheme
 = 'https'

388 #--------------------------- 
S·wnšg
 
h–³rs
 --------------------------- #


390 
şass
 
	$CPProûss
(
objeù
):

392 
pid_fe
 = 
os
.
·th
.
	`još
(
thisdœ
, 'test.pid')

393 
cÚfig_fe
 = 
os
.
·th
.
	`još
(
thisdœ
, 'test.conf')

394 
cÚfig_‹m¶©e
 = """[global]

395 
£rv”
.
sock‘_ho¡
: '%(host)s'

396 
£rv”
.
sock‘_pÜt
: %(
pÜt
)
s


397 
check”
.
Ú
: 
F®£


398 
log
.
sü“n
: 
F®£


399 
log
.
”rÜ_fe
: 
r
'%(error_log)s'

400 
log
.
acûss_fe
: 
r
'%(access_log)s'

401 %(
s¦
)
s


402 %(
exŒa
)
s


404 
”rÜ_log
 = 
os
.
·th
.
	`još
(
thisdœ
, 'test.error.log')

405 
acûss_log
 = 
os
.
·th
.
	`još
(
thisdœ
, 'test.access.log')

407 
def
 
	$__š™__
(
£lf
, 
wa™
=
F®£
, 
d«mÚize
=F®£, 
s¦
=F®£, 
sock‘_ho¡
=
NÚe
, 
sock‘_pÜt
=None):

408 
£lf
.
wa™
 = wait

409 
£lf
.
d«mÚize
 = daemonize

410 
£lf
.
s¦
 = ssl

411 
£lf
.
ho¡
 = 
sock‘_ho¡
 
Ü
 
ch”rypy
.
£rv”
.socket_host

412 
£lf
.
pÜt
 = 
sock‘_pÜt
 
Ü
 
ch”rypy
.
£rv”
.socket_port

414 
def
 
	`wr™e_cÚf
(
£lf
, 
exŒa
=""):

415 
£lf
.
s¦
:

416 
£rv”³m
 = 
os
.
·th
.
	`još
(
thisdœ
, 'test.pem')

417 
s¦
 = """

418 
£rv”
.
s¦_û¹ifiÿ‹
: 
r
'%s'

419 
£rv”
.
s¦_´iv©e_key
: 
r
'%s'

422 
s¦
 = ""

424 
cÚf
 = 
£lf
.
cÚfig_‹m¶©e
 % {

425 'ho¡': 
£lf
.
ho¡
,

426 'pÜt': 
£lf
.
pÜt
,

427 '”rÜ_log': 
£lf
.
”rÜ_log
,

428 'acûss_log': 
£lf
.
acûss_log
,

429 's¦': 
s¦
,

430 'exŒa': 
exŒa
,

431 
	}
}

432 
f
 = 
İ’
(
£lf
.
cÚfig_fe
, 'wb')

433 
	gf
.
wr™e
(
Áob
(
cÚf
, 'utf-8'))

434 
	gf
.
	$şo£
()

436 
def
 
	$¡¬t
(
£lf
, 
impÜts
=
NÚe
):

438 
ch”rypy
.
_ı£rv”
.
	$wa™_fÜ_ä“_pÜt
(
£lf
.
ho¡
, s–f.
pÜt
)

440 
¬gs
 = [

441 
os
.
·th
.
	`još
(
thisdœ
, '..', 'cherryd'),

442 '-c', 
£lf
.
cÚfig_fe
,

443 '-p', 
£lf
.
pid_fe
,

446 
nÙ
 
	`isš¡ªû
(
impÜts
, (
li¡
, 
tu¶e
)):

447 
impÜts
 = [imports]

448 
i
 
š
 
impÜts
:

449 
i
:

450 
¬gs
.
	`­³nd
('-i')

451 
¬gs
.
	$­³nd
(
i
)

453 
£lf
.
d«mÚize
:

454 
¬gs
.
	`­³nd
('-d')

456 
’v
 = 
os
.
’vœÚ
.
	$cİy
()

457 #Mak
su»
 
we
 
impÜt
 
the
 
ch”rypy
 
·ckage
 
š
 
which
 
this
 
moduË
 
is
 
defšed
.

458 
g¿nd·»Ádœ
 = 
os
.
·th
.
	`ab¥©h
(os.·th.
	`još
(
thisdœ
, '..', '..'))

459 
’v
.
	`g‘
('PYTHONPATH', ''):

460 
’v
['PYTHONPATH'] = 
os
.
·th£p
.
	`još
((
g¿nd·»Ádœ
,ƒnv['PYTHONPATH']))

462 
’v
['PYTHONPATH'] = 
g¿nd·»Ádœ


463 
£lf
.
_´oc
 = 
sub´oûss
.
	`Pİ’
([
sys
.
execubË
] + 
¬gs
, 
’v
=env)

464 
£lf
.
wa™
:

465 
£lf
.
ex™_code
 = s–f.
_´oc
.
	$wa™
()

467 
ch”rypy
.
_ı£rv”
.
	$wa™_fÜ_occup›d_pÜt
(
£lf
.
ho¡
, s–f.
pÜt
)

469 #Giv
the
 
’gše
 
a
 
w“
 
b™
 
mÜe
 
time
 
to
 
fšish
 
STARTING


470 
£lf
.
d«mÚize
:

471 
time
.
	$¦“p
(2)

473 
time
.
	$¦“p
(1)

475 
def
 
	$g‘_pid
(
£lf
):

476 
£lf
.
d«mÚize
:

477  (
	`İ’
(
£lf
.
pid_fe
, 'rb').
	$»ad
())

478  
£lf
.
_´oc
.
pid


480 
def
 
	$još
(
£lf
):

482 
£lf
.
d«mÚize
:

483  
£lf
.
	$_još_d«mÚ
()

484 
£lf
.
_´oc
.
	$wa™
()

486 
def
 
	$_još_d«mÚ
(
£lf
):

487 
Œy
:

488 
Œy
:

489 #Mac, 
UNIX


490 
os
.
	$wa™
()

491 
exû±
 
A‰ribu‹E¼Ü
:

493 
Œy
:

494 
pid
 = 
£lf
.
	$g‘_pid
()

495 
exû±
 
IOE¼Ü
:

496 #Assum
the
 
sub´oûss
 
d–‘ed
h
pidfe
 
Ú
 
shutdown
.

497 
·ss


499 
os
.
	$wa™pid
(
pid
, 0)

500 
exû±
 
OSE¼Ü
:

501 
x
 = 
sys
.
	`exc_šfo
()[1]

502 
x
.
¬gs
 != (10, 'No child…rocesses'):

503 
¿i£


	@trunk/objs/CherryPy-3.2.4/cherrypy/test/logtest.py

3 
impÜt
 
sys


4 
impÜt
 
time


6 
impÜt
 
ch”rypy


7 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
	gba£¡ršg
, 
	gÁob
, 
unicode¡r


10 
	gŒy
:

11 #OÀ
Wšdows
, 
msvüt
.
g‘ch
 
»ads
 
a
 
sšgË
 
w™hout
 
ouut
.

12 
impÜt
 
msvüt


13 
def
 
	$g‘ch¬
():

14  
msvüt
.
	$g‘ch
()

15 
exû±
 
ImpÜtE¼Ü
:

16 #Unix 
g‘chr


17 
impÜt
 
‰y
, 
‹rmios


18 
def
 
	$g‘ch¬
():

19 
fd
 = 
sys
.
¡dš
.
	$f’o
()

20 
Şd_£‰šgs
 = 
‹rmios
.
	$tcg‘©Œ
(
fd
)

21 
Œy
:

22 
‰y
.
	`£Œaw
(
sys
.
¡dš
.
	$f’o
())

23 
ch
 = 
sys
.
¡dš
.
	$»ad
(1)

24 
fš®ly
:

25 
‹rmios
.
	$tc£‰r
(
fd
, 
‹rmios
.
TCSADRAIN
, 
Şd_£‰šgs
)

26  
ch


29 
şass
 
	$LogCa£
(
objeù
):

32 
logfe
: 
a
 
f’ame
 
the
 
desœed
 
log
. 
Yes
, 
I
 
know
 
modes
 
¬e
 
ev
,

33 
but
 
™
 
makes
 
the
 
‹¡
 
funùiÚs
 
so
 
much
 
ş—Ãr
 
to
 
£t
 
this
 
Úû
.

35 
Ï¡m¬k”
: 
the
 
Ï¡
 
m¬k”
 
š
h
log
. 
This
 
ÿn
 
be
 
u£d
 
to
 
£¬ch
 

36 
mes§ges
 
sšû
 
the
 
Ï¡
 
m¬k”
.

38 
m¬k”P»fix
: 
a
 
¡ršg
 
w™h
 
which
 
to
 
´efix
 
log
 
m¬k”s
. 
This
 
should
 
be


39 
unique
 
’ough
 
äom
 
nÜm®
 
log
 
ouut
 
to
 
u£
 
m¬k”
 
id’tifiÿtiÚ
.

42 
logfe
 = 
NÚe


43 
Ï¡m¬k”
 = 
NÚe


44 
m¬k”P»fix
 = 
	`Áob
("test suite marker: ")

46 
def
 
	$_hªdËLogE¼Ü
(
£lf
, 
msg
, 
d©a
, 
m¬k”
, 
·‰”n
):

47 
	`´št
("")

48 
	`´št
(" ERROR: %s" % 
msg
)

50 
nÙ
 
£lf
.
š‹¿ùive
:

51 
¿i£
 
£lf
.
	$çu»Exû±iÚ
(
msg
)

53 
p
 = " Show: [L]og [M]arker [P]attern; [I]gnore, [R]aise, or sys.e[X]it >> "

54 
sys
.
¡dout
.
	`wr™e
(
p
 + ' ')

56 
sys
.
¡dout
.
	$æush
()

57 
True
:

58 
i
 = 
	`g‘ch¬
().
	$uµ”
()

59 
i
 
nÙ
 
š
 "MPLIRX":

61 
	`´št
(
i
.
	$uµ”
()è#AlsØ
´šts
 
Ãw
 
lše


62 
i
 == "L":

63 
x
, 
lše
 
š
 
	$’um”©e
(
d©a
):

64 ià(
x
 + 1è% 
£lf
.
cÚsŞe_height
 == 0:

65 #Th\
r
 
ªd
 
comma
 
should
 
make
 
the
 
Ãxt
 
lše
 
ov”wr™e


66 
sys
.
¡dout
.
	`wr™e
("<-- More -->\r ")

67 
m
 = 
	`g‘ch¬
().
	$low”
()

68 #E¿£ 
our
 "MÜe" 
´om±


69 
sys
.
¡dout
.
	`wr™e
(" \r ")

70 
m
 == "q":

72 
	`´št
(
lše
.
	$r¡r
())

73 
–if
 
i
 == "M":

74 
	`´št
(
	$»´
(
m¬k”
 
Ü
 
£lf
.
Ï¡m¬k”
))

75 
–if
 
i
 == "P":

76 
	`´št
(
	$»´
(
·‰”n
))

77 
–if
 
i
 == "I":

78 #»tuº 
w™hout
 
¿isšg
 
the
 
nÜm®
 
exû±iÚ


80 
–if
 
i
 == "R":

81 
¿i£
 
£lf
.
	$çu»Exû±iÚ
(
msg
)

82 
–if
 
i
 == "X":

83 
£lf
.
	$ex™
()

84 
sys
.
¡dout
.
	`wr™e
(
p
 + ' ')

86 
def
 
	$ex™
(
£lf
):

87 
sys
.
	$ex™
()

89 
def
 
	$em±yLog
(
£lf
):

91 
	`İ’
(
£lf
.
logfe
, 'wb').
	`wr™e
("")

93 
def
 
	$m¬kLog
(
£lf
, 
key
=
NÚe
):

95 
key
 
is
 
NÚe
:

96 
key
 = 
	`¡r
(
time
.
	$time
())

97 
£lf
.
Ï¡m¬k”
 = 
key


99 
	`İ’
(
£lf
.
logfe
, 'ab+').
	`wr™e
(
	`Áob
("%s%s\n" % (£lf.
m¬k”P»fix
, 
key
),"utf-8"))

101 
def
 
	$_»ad_m¬ked_»giÚ
(
£lf
, 
m¬k”
=
NÚe
):

104 
If
 
m¬k”
 
is
 
NÚe
, 
£lf
.
Ï¡m¬k”
 i 
u£d
. Ià
the
 
log
 
ha¢
't

105 
b“n
 
	`m¬ked
 (
usšg
 
£lf
.
m¬kLog
), 
the
 
’tœe
 
log
 
wl
 
be
 
»tuºed
.

107 ## #Giv
the
 
logg”
 
time
 
to
 
fšish
 
wr™šg
?

108 ## 
time
.
	`¦“p
(0.5)

110 
logfe
 = 
£lf
.logfile

111 
m¬k”
 = m¬k” 
Ü
 
£lf
.
Ï¡m¬k”


112 
m¬k”
 
is
 
NÚe
:

113  
	`İ’
(
logfe
, 'rb').
	$»adlšes
()

115 
	$isš¡ªû
(
m¬k”
, 
unicode¡r
):

116 
m¬k”
 = m¬k”.
	`’code
('utf-8')

117 
d©a
 = []

118 
š_»giÚ
 = 
F®£


119 
lše
 
š
 
	`İ’
(
logfe
, 'rb'):

120 
š_»giÚ
:

121 ià(
lše
.
	$¡¬tsw™h
(
£lf
.
m¬k”P»fix
è
ªd
 
nÙ
 
m¬k”
 
š
 
lše
):

124 
d©a
.
	$­³nd
(
lše
)

125 
–if
 
m¬k”
 
š
 
lše
:

126 
š_»giÚ
 = 
True


127  
d©a


129 
def
 
	$as£¹InLog
(
£lf
, 
lše
, 
m¬k”
=
NÚe
):

132 
The
 
log
 
wl
 
be
 
£¬ched
 
äom
 
the
 
giv’
 
m¬k”
 
to
h
Ãxt
 marker.

133 
If
 
m¬k”
 
is
 
NÚe
, 
£lf
.
Ï¡m¬k”
 i 
u£d
. Ià
the
 
log
 
ha¢
't

134 
b“n
 
	`m¬ked
 (
usšg
 
£lf
.
m¬kLog
), 
the
 
’tœe
 
log
 
wl
 
be
 
£¬ched
.

136 
d©a
 = 
£lf
.
	$_»ad_m¬ked_»giÚ
(
m¬k”
)

137 
loglše
 
š
 
d©a
:

138 
lše
 
š
 
loglše
:

140 
msg
 = "%¸nÙ found iÀlog" % 
lše


141 
£lf
.
	$_hªdËLogE¼Ü
(
msg
, 
d©a
, 
m¬k”
, 
lše
)

143 
def
 
	$as£¹NÙInLog
(
£lf
, 
lše
, 
m¬k”
=
NÚe
):

146 
The
 
log
 
wl
 
be
 
£¬ched
 
äom
 
the
 
giv’
 
m¬k”
 
to
h
Ãxt
 marker.

147 
If
 
m¬k”
 
is
 
NÚe
, 
£lf
.
Ï¡m¬k”
 i 
u£d
. Ià
the
 
log
 
ha¢
't

148 
b“n
 
	`m¬ked
 (
usšg
 
£lf
.
m¬kLog
), 
the
 
’tœe
 
log
 
wl
 
be
 
£¬ched
.

150 
d©a
 = 
£lf
.
	$_»ad_m¬ked_»giÚ
(
m¬k”
)

151 
loglše
 
š
 
d©a
:

152 
lše
 
š
 
loglše
:

153 
msg
 = "%¸found iÀlog" % 
lše


154 
£lf
.
	$_hªdËLogE¼Ü
(
msg
, 
d©a
, 
m¬k”
, 
lše
)

156 
def
 
	$as£¹Log
(
£lf
, 
¦iû¬gs
, 
lšes
, 
m¬k”
=
NÚe
):

159 
The
 
log
 
wl
 
be
 
£¬ched
 
äom
 
the
 
giv’
 
m¬k”
 
to
h
Ãxt
 marker.

160 
If
 
m¬k”
 
is
 
NÚe
, 
£lf
.
Ï¡m¬k”
 i 
u£d
. Ià
the
 
log
 
ha¢
't

161 
b“n
 
	`m¬ked
 (
usšg
 
£lf
.
m¬kLog
), 
the
 
’tœe
 
log
 
wl
 
be
 
£¬ched
.

163 
d©a
 = 
£lf
.
	$_»ad_m¬ked_»giÚ
(
m¬k”
)

164 
	$isš¡ªû
(
¦iû¬gs
, ):

165 #SšgË 
¬g
. 
U£
 
__g‘™em__
 
ªd
 
®low
 
lšes
 
to
 
be
 
¡r
 
Ü
 
li¡
.

166 
	`isš¡ªû
(
lšes
, (
tu¶e
, 
li¡
)):

167 
lšes
 =†ines[0]

168 
	$isš¡ªû
(
lšes
, 
unicode¡r
):

169 
lšes
 =†šes.
	`’code
('utf-8')

170 
lšes
 
nÙ
 
š
 
d©a
[
¦iû¬gs
]:

171 
msg
 = "%¸nÙ found oÀlog†š%r" % (
lšes
, 
¦iû¬gs
)

172 
£lf
.
	`_hªdËLogE¼Ü
(
msg
, [
d©a
[
¦iû¬gs
],"--EXTRA CONTEXT--"] + d©a[¦iû¬gs+1:¦iû¬gs+6], 
m¬k”
, 
lšes
)

174 #MuÉË 
¬gs
. 
U£
 
__g‘¦iû__
 
ªd
 
»quœe
 
lšes
 
to
 
be
 
li¡
.

175 
	$isš¡ªû
(
lšes
, 
tu¶e
):

176 
lšes
 = 
	$li¡
(
lšes
)

177 
–if
 
	$isš¡ªû
(
lšes
, 
ba£¡ršg
):

178 
¿i£
 
	`Ty³E¼Ü
("The 'lines'‡rg must be‡†ist when "

181 
¡¬t
, 
¡İ
 = 
¦iû¬gs


182 
lše
, 
loglše
 
š
 
	`z
(
lšes
, 
d©a
[
¡¬t
:
¡İ
]):

183 
	$isš¡ªû
(
lše
, 
unicode¡r
):

184 
lše
 =†še.
	`’code
('utf-8')

185 
lše
 
nÙ
 
š
 
loglše
:

186 
msg
 = "%¸nÙ found iÀlog" % 
lše


187 
£lf
.
	`_hªdËLogE¼Ü
(
msg
, 
d©a
[
¡¬t
:
¡İ
], 
m¬k”
, 
lše
)

	@trunk/objs/CherryPy-3.2.4/cherrypy/test/modfastcgi.py

3 
To
 
auto¡¬t
 
	gç¡cgi
, 
	gthe
 "­ache" 
execubË
 
Ü
 
süt
 
mu¡
 
be


4 
Ú
 
your
 
sy¡em
 
	g·th
, 
Ü
 
you
 
mu¡
 
ov”ride
 
the
 
glob®
 
	gAPACHE_PATH
.

5 
On
 
some
 
	g¶©fÜms
, "­ache" 
may
 
be
 
	gÿÎed
 "apachectl", "apache2ctl",

6 
	gÜ
 "h‰pd"--
ü—‹
 
a
 
symlšk
 
to
 
them
 
	gÃeded
.

8 
	gYou
'll‡lso‚eedhe WSGIServer from flup.servers.

9 
S“
 
	gh‰p
:

12 
KNOWN
 
BUGS


15 1. 
A·che
 
´oûs£s
 
Rªge
 
h—d”s
 
autom©iÿÎy
; 
	gCh”ryPy
'sruncated

16 
ouut
 
is
 
th’
 
Œunÿ‹d
 
agaš
 
by
 
	gA·che
. 
S“
 
	g‹¡_cÜe
.
	g‹¡Rªges
.

17 
This
 
was
 
wÜked
 
¬ound
 
š
 
	gh‰p
:

18 2. 
A·che
 
dÛs
 
nÙ
 
®low
 
cu¡om
 
HTTP
 
m‘hods
 
like
 
CONNECT
 
as
 
³r
 
the
 
¥ec
.

19 
S“
 
‹¡_cÜe
.
‹¡HTTPM‘hods
.

20 3. 
Max
 
»que¡
 
h—d”
 
ªd
 
body
 
£‰šgs
 dØ
nÙ
 
wÜk
 
w™h
 
A·che
.

21 4. 
A·che
 
»¶aûs
 
¡©us
 "»asÚ…h¿£s" 
autom©iÿÎy
. 
FÜ
 
exam¶e
,

22 
Ch”ryPy
 
may
 
	g£t
 "304 NÙ modif›d" 
but
 
A·che
 
wl
 
wr™e
 
	gout


23 "304 NÙ Modif›d" (
	gÿp™®
 "M").

24 5. 
A·che
 
dÛs
 
nÙ
 
®low
 
cu¡om
 
”rÜ
 
codes
 
as
 
³r
 
the
 
	g¥ec
.

25 6. 
	$A·che
 (
Ü
 
³rh­s
 
modpythÚ
, o¸
modpythÚ_g©eway
è
unquÙes
 %
xx
 
š
 
the


26 
Reque¡
-
URI
 
too
 
—¾y
.

27 7. 
mod_pythÚ
 
wl
 
nÙ
 
»ad
 
»que¡
 
bod›s
 
which
 
u£
 
the
 "chunked"

28 
Œªsãr
-
	`codšg
 (
™
 
·s£s
 
REQUEST_CHUNKED_ERROR
 
to
 
­_£tup_ş›Á_block


29 
š¡—d
 
of
 
REQUEST_CHUNKED_DECHUNK
, 
£e
 
A·che2
's http_protocol.c‡nd

30 
mod_pythÚ
's„equestobject.c).

31 8. 
A·che
 
wl
 
ouut
 
a
 "CÚ‹Á-L’gth: 0" 
»¥Ú£
 
h—d”
 
ev’
 
th”e
's

32 
no
 
»¥Ú£
 
’t™y
 
body
. 
This
 
i¢
't„eally‡ bug; it just differs from

33 
the
 
Ch”ryPy
 .

36 
impÜt
 
os


37 
curdœ
 = 
os
.
·th
.
	`još
(os.
	`g‘cwd
(), os.·th.
	$dœÇme
(
__fe__
))

38 
impÜt
 
»


39 
impÜt
 
sys


40 
impÜt
 
time


42 
impÜt
 
ch”rypy


43 
äom
 
ch”rypy
.
´oûss
 
impÜt
 
¶ugšs
, 
£rv”s


44 
äom
 
ch”rypy
.
‹¡
 
impÜt
 
h–³r


47 
def
 
	`»ad_´oûss
(
cmd
, 
¬gs
=""):

48 
peš
, 
peout
 = 
os
.
	`pİ’4
("% %s" % (
cmd
, 
¬gs
))

49 
Œy
:

50 
fœ¡lše
 = 
peout
.
	$»adlše
()

51 ià(
»
.
	`£¬ch
(
r
"ÒÙ„ecognized|NØsuch fe|nÙ found)", 
fœ¡lše
,

52 
»
.
IGNORECASE
)):

53 
¿i£
 
	`IOE¼Ü
('% mu¡ bÚ you¸sy¡em…©h.' % 
cmd
)

54 
ouut
 = 
fœ¡lše
 + 
peout
.
	$»ad
()

55 
fš®ly
:

56 
peout
.
	$şo£
()

57  
ouut


60 
APACHE_PATH
 = "apache2ctl"

61 
CONF_PATH
 = "fastcgi.conf"

63 
cÚf_ç¡cgi
 = """

64 #A·che2 
£rv”
 
cÚf
 
fe
 
‹¡šg
 
Ch”ryPy
 
w™h
 
mod_ç¡cgi
.

65 #fumªchu: 
I
 
had
 
to
 
h¬d
-
code
 
·ths
 
due
Ø
üazy
 
DebŸn
 
Ïyouts
 :(

66 
S”v”RoÙ
 /
u¤
/
lib
/
­ache2


67 
U£r
 #1000

68 
E¼ÜLog
 %(
roÙ
)
s
/
mod_ç¡cgi
.
”rÜ
.
log


70 
Docum’tRoÙ
 "%(root)s"

71 
S”v”Name
 127.0.0.1

72 
Li¡’
 %(
pÜt
)
s


73 
LßdModuË
 
ç¡cgi_moduË
 
moduËs
/
mod_ç¡cgi
.
so


74 
LßdModuË
 
»wr™e_moduË
 
moduËs
/
mod_»wr™e
.
so


76 
O±iÚs
 +
ExecCGI


77 
S‘HªdËr
 
ç¡cgi
-
süt


78 
Rewr™eEngše
 
On


79 
Rewr™eRuË
 ^(.*)
$
 /
ç¡cgi
.
pyc
 [
L
]

80 
Fa¡CgiEx‹º®S”v”
 "%(£rv”)s" -
ho¡
 127.0.0.1:4000

83 
def
 
	$”a£_süt_Çme
(
’vœÚ
, 
¡¬t_»¥Ú£
):

84 
’vœÚ
['SCRIPT_NAME'] = ''

85  
ch”rypy
.
	$Œ“
(
’vœÚ
, 
¡¬t_»¥Ú£
)

87 
şass
 
	$ModFCGISu³rvisÜ
(
h–³r
.
LoÿlWSGISu³rvisÜ
):

89 
h‰p£rv”_şass
 = "cherrypy.process.servers.FlupFCGIServer"

90 
usšg_­ache
 = 
True


91 
usšg_wsgi
 = 
True


92 
‹m¶©e
 = 
cÚf_ç¡cgi


94 
def
 
	$__¡r__
(
£lf
):

95  "FCGI S”v” oÀ%s:%s" % (
£lf
.
ho¡
, s–f.
pÜt
)

97 
def
 
	$¡¬t
(
£lf
, 
moduËÇme
):

98 
ch”rypy
.
£rv”
.
h‰p£rv”
 = 
£rv”s
.
	`FlupFCGIS”v”
(

99 
­¶iÿtiÚ
=
”a£_süt_Çme
, 
bšdAdd»ss
=('127.0.0.1', 4000))

100 
ch”rypy
.
£rv”
.
h‰p£rv”
.
bšd_addr
 = ('127.0.0.1', 4000)

101 
ch”rypy
.
£rv”
.
sock‘_pÜt
 = 4000

102 #FÜ 
FCGI
, 
we
 
bÙh
 
¡¬t
 
­ache
...

103 
£lf
.
	$¡¬t_­ache
()

104 #...
ªd
 
our
 
loÿl
 
£rv”


105 
ch”rypy
.
’gše
.
	$¡¬t
()

106 
£lf
.
	$sync_­ps
()

108 
def
 
	$¡¬t_­ache
(
£lf
):

109 
fcgicÚf
 = 
CONF_PATH


110 
nÙ
 
os
.
·th
.
	$i§bs
(
fcgicÚf
):

111 
fcgicÚf
 = 
os
.
·th
.
	$još
(
curdœ
, 
fcgicÚf
)

113 #Wr™
the
 
A·che
 
cÚf
 
fe
.

114 
f
 = 
	`İ’
(
fcgicÚf
, 'wb')

115 
Œy
:

116 
£rv”
 = 
	`»´
(
os
.
·th
.
	`još
(
curdœ
, 'fastcgi.pyc'))[1:-1]

117 
ouut
 = 
£lf
.
‹m¶©e
 % {'pÜt': s–f.
pÜt
, 'roÙ': 
curdœ
,

118 '£rv”': 
£rv”
}

119 
ouut
 = ouut.
»¶aû
('\r\n', '\n')

120 
	gf
.
	$wr™e
(
ouut
)

121 
fš®ly
:

122 
f
.
	$şo£
()

124 
»suÉ
 = 
	`»ad_´oûss
(
APACHE_PATH
, "-k s¹ -à%s" % 
fcgicÚf
)

125 
»suÉ
:

126 
	$´št
(
»suÉ
)

128 
def
 
	$¡İ
(
£lf
):

130 
	`»ad_´oûss
(
APACHE_PATH
, "-k stop")

131 
h–³r
.
LoÿlWSGISu³rvisÜ
.
	$¡İ
(
£lf
)

133 
def
 
	$sync_­ps
(
£lf
):

134 
ch”rypy
.
£rv”
.
h‰p£rv”
.
fcgi£rv”
.
­¶iÿtiÚ
 = 
£lf
.
	`g‘_­p
(
”a£_süt_Çme
)

	@trunk/objs/CherryPy-3.2.4/cherrypy/test/modfcgid.py

3 
To
 
auto¡¬t
 
	gfcgid
, 
	gthe
 "­ache" 
execubË
 
Ü
 
süt
 
mu¡
 
be


4 
Ú
 
your
 
sy¡em
 
	g·th
, 
Ü
 
you
 
mu¡
 
ov”ride
 
the
 
glob®
 
	gAPACHE_PATH
.

5 
On
 
some
 
	g¶©fÜms
, "­ache" 
may
 
be
 
	gÿÎed
 "apachectl", "apache2ctl",

6 
	gÜ
 "h‰pd"--
ü—‹
 
a
 
symlšk
 
to
 
them
 
	gÃeded
.

8 
	gYou
'll‡lso‚eedhe WSGIServer from flup.servers.

9 
S“
 
	gh‰p
:

12 
KNOWN
 
BUGS


15 1. 
A·che
 
´oûs£s
 
Rªge
 
h—d”s
 
autom©iÿÎy
; 
	gCh”ryPy
'sruncated

16 
ouut
 
is
 
th’
 
Œunÿ‹d
 
agaš
 
by
 
	gA·che
. 
S“
 
	g‹¡_cÜe
.
	g‹¡Rªges
.

17 
This
 
was
 
wÜked
 
¬ound
 
š
 
	gh‰p
:

18 2. 
A·che
 
dÛs
 
nÙ
 
®low
 
cu¡om
 
HTTP
 
m‘hods
 
like
 
CONNECT
 
as
 
³r
 
the
 
¥ec
.

19 
S“
 
‹¡_cÜe
.
‹¡HTTPM‘hods
.

20 3. 
Max
 
»que¡
 
h—d”
 
ªd
 
body
 
£‰šgs
 dØ
nÙ
 
wÜk
 
w™h
 
A·che
.

21 4. 
A·che
 
»¶aûs
 
¡©us
 "»asÚ…h¿£s" 
autom©iÿÎy
. 
FÜ
 
exam¶e
,

22 
Ch”ryPy
 
may
 
	g£t
 "304 NÙ modif›d" 
but
 
A·che
 
wl
 
wr™e
 
	gout


23 "304 NÙ Modif›d" (
	gÿp™®
 "M").

24 5. 
A·che
 
dÛs
 
nÙ
 
®low
 
cu¡om
 
”rÜ
 
codes
 
as
 
³r
 
the
 
	g¥ec
.

25 6. 
	$A·che
 (
Ü
 
³rh­s
 
modpythÚ
, o¸
modpythÚ_g©eway
è
unquÙes
 %
xx
 
š
 
the


26 
Reque¡
-
URI
 
too
 
—¾y
.

27 7. 
mod_pythÚ
 
wl
 
nÙ
 
»ad
 
»que¡
 
bod›s
 
which
 
u£
 
the
 "chunked"

28 
Œªsãr
-
	`codšg
 (
™
 
·s£s
 
REQUEST_CHUNKED_ERROR
 
to
 
­_£tup_ş›Á_block


29 
š¡—d
 
of
 
REQUEST_CHUNKED_DECHUNK
, 
£e
 
A·che2
's http_protocol.c‡nd

30 
mod_pythÚ
's„equestobject.c).

31 8. 
A·che
 
wl
 
ouut
 
a
 "CÚ‹Á-L’gth: 0" 
»¥Ú£
 
h—d”
 
ev’
 
th”e
's

32 
no
 
»¥Ú£
 
’t™y
 
body
. 
This
 
i¢
't„eally‡ bug; it just differs from

33 
the
 
Ch”ryPy
 .

36 
impÜt
 
os


37 
curdœ
 = 
os
.
·th
.
	`još
(os.
	`g‘cwd
(), os.·th.
	$dœÇme
(
__fe__
))

38 
impÜt
 
»


39 
impÜt
 
sys


40 
impÜt
 
time


42 
impÜt
 
ch”rypy


43 
äom
 
ch”rypy
.
_ıcom·t
 
impÜt
 
Áob


44 
äom
 
ch”rypy
.
´oûss
 
impÜt
 
¶ugšs
, 
£rv”s


45 
äom
 
ch”rypy
.
‹¡
 
impÜt
 
h–³r


48 
def
 
	`»ad_´oûss
(
cmd
, 
¬gs
=""):

49 
peš
, 
peout
 = 
os
.
	`pİ’4
("% %s" % (
cmd
, 
¬gs
))

50 
Œy
:

51 
fœ¡lše
 = 
peout
.
	$»adlše
()

52 ià(
»
.
	`£¬ch
(
r
"ÒÙ„ecognized|NØsuch fe|nÙ found)", 
fœ¡lše
,

53 
»
.
IGNORECASE
)):

54 
¿i£
 
	`IOE¼Ü
('% mu¡ bÚ you¸sy¡em…©h.' % 
cmd
)

55 
ouut
 = 
fœ¡lše
 + 
peout
.
	$»ad
()

56 
fš®ly
:

57 
peout
.
	$şo£
()

58  
ouut


61 
APACHE_PATH
 = "httpd"

62 
CONF_PATH
 = "fcgi.conf"

64 
cÚf_fcgid
 = """

65 #A·che2 
£rv”
 
cÚf
 
fe
 
‹¡šg
 
Ch”ryPy
 
w™h
 
mod_fcgid
.

67 
Docum’tRoÙ
 "%(root)s"

68 
S”v”Name
 127.0.0.1

69 
Li¡’
 %(
pÜt
)
s


70 
LßdModuË
 
ç¡cgi_moduË
 
moduËs
/
mod_ç¡cgi
.
dÎ


71 
LßdModuË
 
»wr™e_moduË
 
moduËs
/
mod_»wr™e
.
so


73 
O±iÚs
 
ExecCGI


74 
S‘HªdËr
 
ç¡cgi
-
süt


75 
Rewr™eEngše
 
On


76 
Rewr™eRuË
 ^(.*)
$
 /
ç¡cgi
.
pyc
 [
L
]

77 
Fa¡CgiEx‹º®S”v”
 "%(£rv”)s" -
ho¡
 127.0.0.1:4000

80 
şass
 
	$ModFCGISu³rvisÜ
(
h–³r
.
LoÿlSu³rvisÜ
):

82 
usšg_­ache
 = 
True


83 
usšg_wsgi
 = 
True


84 
‹m¶©e
 = 
cÚf_fcgid


86 
def
 
	$__¡r__
(
£lf
):

87  "FCGI S”v” oÀ%s:%s" % (
£lf
.
ho¡
, s–f.
pÜt
)

89 
def
 
	$¡¬t
(
£lf
, 
moduËÇme
):

90 
ch”rypy
.
£rv”
.
h‰p£rv”
 = 
£rv”s
.
	`FlupFCGIS”v”
(

91 
­¶iÿtiÚ
=
ch”rypy
.
Œ“
, 
bšdAdd»ss
=('127.0.0.1', 4000))

92 
ch”rypy
.
£rv”
.
h‰p£rv”
.
bšd_addr
 = ('127.0.0.1', 4000)

93 #FÜ 
FCGI
, 
we
 
bÙh
 
¡¬t
 
­ache
...

94 
£lf
.
	$¡¬t_­ache
()

95 #...
ªd
 
our
 
loÿl
 
£rv”


96 
h–³r
.
LoÿlS”v”
.
	$¡¬t
(
£lf
, 
moduËÇme
)

98 
def
 
	$¡¬t_­ache
(
£lf
):

99 
fcgicÚf
 = 
CONF_PATH


100 
nÙ
 
os
.
·th
.
	$i§bs
(
fcgicÚf
):

101 
fcgicÚf
 = 
os
.
·th
.
	$još
(
curdœ
, 
fcgicÚf
)

103 #Wr™
the
 
A·che
 
cÚf
 
fe
.

104 
f
 = 
	`İ’
(
fcgicÚf
, 'wb')

105 
Œy
:

106 
£rv”
 = 
	`»´
(
os
.
·th
.
	`još
(
curdœ
, 'fastcgi.pyc'))[1:-1]

107 
ouut
 = 
£lf
.
‹m¶©e
 % {'pÜt': s–f.
pÜt
, 'roÙ': 
curdœ
,

108 '£rv”': 
£rv”
}

109 
ouut
 = 
Áob
(ouut.
»¶aû
('\r\n', '\n'))

110 
	gf
.
	$wr™e
(
ouut
)

111 
fš®ly
:

112 
f
.
	$şo£
()

114 
»suÉ
 = 
	`»ad_´oûss
(
APACHE_PATH
, "-k s¹ -à%s" % 
fcgicÚf
)

115 
»suÉ
:

116 
	$´št
(
»suÉ
)

118 
def
 
	$¡İ
(
£lf
):

120 
	`»ad_´oûss
(
APACHE_PATH
, "-k stop")

121 
h–³r
.
LoÿlS”v”
.
	$¡İ
(
£lf
)

123 
def
 
	$sync_­ps
(
£lf
):

124 
ch”rypy
.
£rv”
.
h‰p£rv”
.
fcgi£rv”
.
­¶iÿtiÚ
 = 
£lf
.
	`g‘_­p
()

	@trunk/objs/CherryPy-3.2.4/cherrypy/test/modpy.py

3 
To
 
auto¡¬t
 
	gmodpythÚ
, 
	gthe
 "­ache" 
execubË
 
Ü
 
süt
 
mu¡
 
be


4 
Ú
 
your
 
sy¡em
 
	g·th
, 
Ü
 
you
 
mu¡
 
ov”ride
 
the
 
glob®
 
	gAPACHE_PATH
.

5 
On
 
some
 
	g¶©fÜms
, "­ache" 
may
 
be
 
	gÿÎed
 "­acheùl" 
	gÜ
 "apache2ctl"--

6 
ü—‹
 
a
 
symlšk
 
to
 
them
 
	gÃeded
.

8 
If
 
you
 
wish
 
to
 
‹¡
 
the
 
WSGI
 
š‹rçû
 
š¡—d
 
of
 
our
 
_ımodpy
 
	gš‹rçû
,

9 
you
 
®so
 
Ãed
 
	gthe
 'modpythÚ_g©eway' 
moduË
 
	g©
:

10 
h‰p
:

13 
KNOWN
 
BUGS


16 1. 
A·che
 
´oûs£s
 
Rªge
 
h—d”s
 
autom©iÿÎy
; 
	gCh”ryPy
'sruncated

17 
ouut
 
is
 
th’
 
Œunÿ‹d
 
agaš
 
by
 
	gA·che
. 
S“
 
	g‹¡_cÜe
.
	g‹¡Rªges
.

18 
This
 
was
 
wÜked
 
¬ound
 
š
 
	gh‰p
:

19 2. 
A·che
 
dÛs
 
nÙ
 
®low
 
cu¡om
 
HTTP
 
m‘hods
 
like
 
CONNECT
 
as
 
³r
 
the
 
¥ec
.

20 
S“
 
‹¡_cÜe
.
‹¡HTTPM‘hods
.

21 3. 
Max
 
»que¡
 
h—d”
 
ªd
 
body
 
£‰šgs
 dØ
nÙ
 
wÜk
 
w™h
 
A·che
.

22 4. 
A·che
 
»¶aûs
 
¡©us
 "»asÚ…h¿£s" 
autom©iÿÎy
. 
FÜ
 
exam¶e
,

23 
Ch”ryPy
 
may
 
	g£t
 "304 NÙ modif›d" 
but
 
A·che
 
wl
 
wr™e
 
	gout


24 "304 NÙ Modif›d" (
	gÿp™®
 "M").

25 5. 
A·che
 
dÛs
 
nÙ
 
®low
 
cu¡om
 
”rÜ
 
codes
 
as
 
³r
 
the
 
	g¥ec
.

26 6. 
	$A·che
 (
Ü
 
³rh­s
 
modpythÚ
, o¸
modpythÚ_g©eway
è
unquÙes
 %
xx
 
š
 
the


27 
Reque¡
-
URI
 
too
 
—¾y
.

28 7. 
mod_pythÚ
 
wl
 
nÙ
 
»ad
 
»que¡
 
bod›s
 
which
 
u£
 
the
 "chunked"

29 
Œªsãr
-
	`codšg
 (
™
 
·s£s
 
REQUEST_CHUNKED_ERROR
 
to
 
­_£tup_ş›Á_block


30 
š¡—d
 
of
 
REQUEST_CHUNKED_DECHUNK
, 
£e
 
A·che2
's http_protocol.c‡nd

31 
mod_pythÚ
's„equestobject.c).

32 8. 
A·che
 
wl
 
ouut
 
a
 "CÚ‹Á-L’gth: 0" 
»¥Ú£
 
h—d”
 
ev’
 
th”e
's

33 
no
 
»¥Ú£
 
’t™y
 
body
. 
This
 
i¢
't„eally‡ bug; it just differs from

34 
the
 
Ch”ryPy
 .

37 
impÜt
 
os


38 
curdœ
 = 
os
.
·th
.
	`još
(os.
	`g‘cwd
(), os.·th.
	$dœÇme
(
__fe__
))

39 
impÜt
 
»


40 
impÜt
 
time


42 
äom
 
ch”rypy
.
‹¡
 
impÜt
 
h–³r


45 
def
 
	`»ad_´oûss
(
cmd
, 
¬gs
=""):

46 
peš
, 
peout
 = 
os
.
	`pİ’4
("% %s" % (
cmd
, 
¬gs
))

47 
Œy
:

48 
fœ¡lše
 = 
peout
.
	$»adlše
()

49 ià(
»
.
	`£¬ch
(
r
"ÒÙ„ecognized|NØsuch fe|nÙ found)", 
fœ¡lše
,

50 
»
.
IGNORECASE
)):

51 
¿i£
 
	`IOE¼Ü
('% mu¡ bÚ you¸sy¡em…©h.' % 
cmd
)

52 
ouut
 = 
fœ¡lše
 + 
peout
.
	$»ad
()

53 
fš®ly
:

54 
peout
.
	$şo£
()

55  
ouut


58 
APACHE_PATH
 = "httpd"

59 
CONF_PATH
 = "test_mp.conf"

61 
cÚf_modpythÚ_g©eway
 = """

62 #A·che2 
£rv”
 
cÚf
 
fe
 
‹¡šg
 
Ch”ryPy
 
w™h
 
modpythÚ_g©eway
.

64 
S”v”Name
 127.0.0.1

65 
Docum’tRoÙ
 "/"

66 
Li¡’
 %(
pÜt
)
s


67 
LßdModuË
 
pythÚ_moduË
 
moduËs
/
mod_pythÚ
.
so


69 
S‘HªdËr
 
pythÚ
-
´og¿m


70 
PythÚFixupHªdËr
 
ch”rypy
.
‹¡
.
modpy
::
wsgi£tup


71 
PythÚO±iÚ
 
‹¡mod
 %(
moduËÇme
)
s


72 
PythÚHªdËr
 
modpythÚ_g©eway
::
hªdËr


73 
PythÚO±iÚ
 
wsgi
.
­¶iÿtiÚ
 
ch”rypy
::
Œ“


74 
PythÚO±iÚ
 
sock‘_ho¡
 %(
ho¡
)
s


75 
PythÚDebug
 
On


78 
cÚf_ımodpy
 = """

79 #A·che2 
£rv”
 
cÚf
 
fe
 
‹¡šg
 
Ch”ryPy
 
w™h
 
_ımodpy
.

81 
S”v”Name
 127.0.0.1

82 
Docum’tRoÙ
 "/"

83 
Li¡’
 %(
pÜt
)
s


84 
LßdModuË
 
pythÚ_moduË
 
moduËs
/
mod_pythÚ
.
so


86 
S‘HªdËr
 
pythÚ
-
´og¿m


87 
PythÚFixupHªdËr
 
ch”rypy
.
‹¡
.
modpy
::
ımodpy£tup


88 
PythÚHªdËr
 
ch”rypy
.
_ımodpy
::
hªdËr


89 
PythÚO±iÚ
 
ch”rypy
.
£tup
 ch”rypy.
‹¡
.%(
moduËÇme
)
s
::
£tup_£rv”


90 
PythÚO±iÚ
 
sock‘_ho¡
 %(
ho¡
)
s


91 
PythÚDebug
 
On


94 
şass
 
	$ModPythÚSu³rvisÜ
(
h–³r
.
Su³rvisÜ
):

96 
usšg_­ache
 = 
True


97 
usšg_wsgi
 = 
F®£


98 
‹m¶©e
 = 
NÚe


100 
def
 
	$__¡r__
(
£lf
):

101  "ModPythÚ S”v” oÀ%s:%s" % (
£lf
.
ho¡
, s–f.
pÜt
)

103 
def
 
	$¡¬t
(
£lf
, 
moduËÇme
):

104 
mpcÚf
 = 
CONF_PATH


105 
nÙ
 
os
.
·th
.
	$i§bs
(
mpcÚf
):

106 
mpcÚf
 = 
os
.
·th
.
	$još
(
curdœ
, 
mpcÚf
)

108 
f
 = 
	`İ’
(
mpcÚf
, 'wb')

109 
Œy
:

110 
f
.
	`wr™e
(
£lf
.
‹m¶©e
 %

111 {'pÜt': 
£lf
.
pÜt
, 'moduËÇme': 
moduËÇme
,

112 'ho¡': 
£lf
.
ho¡
})

113 
fš®ly
:

114 
f
.
	$şo£
()

116 
»suÉ
 = 
	`»ad_´oûss
(
APACHE_PATH
, "-k s¹ -à%s" % 
mpcÚf
)

117 
»suÉ
:

118 
	$´št
(
»suÉ
)

120 
def
 
	$¡İ
(
£lf
):

122 
	`»ad_´oûss
(
APACHE_PATH
, "-k stop")

125 
lßded
 = 
F®£


126 
def
 
	$wsgi£tup
(
»q
):

127 
glob®
 
lßded


128 
nÙ
 
lßded
:

129 
lßded
 = 
True


130 
İtiÚs
 = 
»q
.
	$g‘_İtiÚs
()

132 
impÜt
 
ch”rypy


133 
ch”rypy
.
cÚfig
.
	`upd©e
({

134 "log.”rÜ_fe": 
os
.
·th
.
	`još
(
curdœ
, "test.log"),

136 "£rv”.sock‘_ho¡": 
İtiÚs
['socket_host'],

137 
	}
})

139 
modÇme
 = 
İtiÚs
['testmod']

140 
mod
 = 
__impÜt__
(
modÇme
, 
glob®s
(), 
loÿls
(), [''])

141 
	gmod
.
	$£tup_£rv”
()

143 
ch”rypy
.
£rv”
.
	$unsubsüibe
()

144 
ch”rypy
.
’gše
.
	$¡¬t
()

145 
äom
 
mod_pythÚ
 
impÜt
 
­ache


146  
­ache
.
OK


149 
def
 
	$ımodpy£tup
(
»q
):

150 
glob®
 
lßded


151 
nÙ
 
lßded
:

152 
lßded
 = 
True


153 
İtiÚs
 = 
»q
.
	$g‘_İtiÚs
()

155 
impÜt
 
ch”rypy


156 
ch”rypy
.
cÚfig
.
	`upd©e
({

157 "log.”rÜ_fe": 
os
.
·th
.
	`još
(
curdœ
, "test.log"),

159 "£rv”.sock‘_ho¡": 
İtiÚs
['socket_host'],

160 
	}
})

161 
äom
 
mod_pythÚ
 
impÜt
 
­ache


162  
­ache
.
OK


	@trunk/objs/CherryPy-3.2.4/cherrypy/test/modwsgi.py

3 
To
 
auto¡¬t
 
	gmodwsgi
, 
	gthe
 "­ache" 
execubË
 
Ü
 
süt
 
mu¡
 
be


4 
Ú
 
your
 
sy¡em
 
	g·th
, 
Ü
 
you
 
mu¡
 
ov”ride
 
the
 
glob®
 
	gAPACHE_PATH
.

5 
On
 
some
 
	g¶©fÜms
, "­ache" 
may
 
be
 
	gÿÎed
 "­acheùl" 
	gÜ
 "apache2ctl"--

6 
ü—‹
 
a
 
symlšk
 
to
 
them
 
	gÃeded
.

9 
KNOWN
 
	gBUGS


12 ##1. 
A·che
 
´oûs£s
 
Rªge
 
h—d”s
 
autom©iÿÎy
; 
Ch”ryPy
'sruncated

13 ## 
ouut
 
is
 
th’
 
Œunÿ‹d
 
agaš
 
by
 
A·che
. 
S“
 
‹¡_cÜe
.
‹¡Rªges
.

14 ## 
This
 
was
 
wÜked
 
¬ound
 
š
 
h‰p
:

15 2. 
A·che
 
dÛs
 
nÙ
 
®low
 
cu¡om
 
HTTP
 
m‘hods
 
like
 
CONNECT
 
as
 
³r
 
the
 
	g¥ec
.

16 
S“
 
	g‹¡_cÜe
.
	g‹¡HTTPM‘hods
.

17 3. 
Max
 
»que¡
 
h—d”
 
ªd
 
body
 
£‰šgs
 dØ
nÙ
 
wÜk
 
w™h
 
	gA·che
.

18 ##4. 
A·che
 
»¶aûs
 
¡©us
 "»asÚ…h¿£s" 
autom©iÿÎy
. 
FÜ
 
exam¶e
,

19 ## 
Ch”ryPy
 
may
 
£t
 "304 NÙ modif›d" 
but
 
A·che
 
wl
 
wr™e
 
out


20 ## "304 NÙ Modif›d" (
ÿp™®
 "M").

21 ##5. 
A·che
 
dÛs
 
nÙ
 
®low
 
cu¡om
 
”rÜ
 
codes
 
as
 
³r
 
the
 
¥ec
.

22 ##6. 
A·che
 (
Ü
 
³rh­s
 
modpythÚ
, o¸
modpythÚ_g©eway
è
unquÙes
 %
xx
 
š
 
the


23 ## 
Reque¡
-
URI
 
too
 
—¾y
.

24 7. 
mod_wsgi
 
wl
 
nÙ
 
»ad
 
»que¡
 
bod›s
 
which
 
u£
 
	gthe
 "chunked"

25 
	gŒªsãr
-
codšg
 (
™
 
·s£s
 
REQUEST_CHUNKED_ERROR
 
to
 
­_£tup_ş›Á_block


26 
š¡—d
 
of
 
REQUEST_CHUNKED_DECHUNK
, 
£e
 
A·che2
's http_protocol.c‡nd

27 
mod_pythÚ
's„equestobject.c).

28 8. 
Wh’
 
»¥Údšg
 
w™h
 204 
No
 
CÚ‹Á
, 
mod_wsgi
 
adds
 
a
 CÚ‹Á-
L’gth


29 
h—d”
 
you
.

30 9. 
Wh’
 
ª
 
”rÜ
 
is
 
¿i£d
, 
mod_wsgi
 
has
 
no
 
çc™y
 
´štšg
 
a


31 
Œaûback
 
as
 
the
 
»¥Ú£
 
cÚ‹Á
 (
™
's sentohe Apache†og instead).

32 10. 
S¹up
 
ªd
 
shutdown
 
of
 
A·che
 
wh’
 
ruÂšg
 
mod_wsgi
 
£ems
 
¦ow
.

35 
impÜt
 
os


36 
curdœ
 = 
os
.
·th
.
ab¥©h
(os.·th.
	$dœÇme
(
__fe__
))

37 
impÜt
 
»


38 
impÜt
 
sys


39 
impÜt
 
time


41 
impÜt
 
ch”rypy


42 
äom
 
ch”rypy
.
‹¡
 
impÜt
 
h–³r
, 
web‹¡


45 
def
 
	`»ad_´oûss
(
cmd
, 
¬gs
=""):

46 
peš
, 
peout
 = 
os
.
	`pİ’4
("% %s" % (
cmd
, 
¬gs
))

47 
Œy
:

48 
fœ¡lše
 = 
peout
.
	$»adlše
()

49 ià(
»
.
	`£¬ch
(
r
"ÒÙ„ecognized|NØsuch fe|nÙ found)", 
fœ¡lše
,

50 
»
.
IGNORECASE
)):

51 
¿i£
 
	`IOE¼Ü
('% mu¡ bÚ you¸sy¡em…©h.' % 
cmd
)

52 
ouut
 = 
fœ¡lše
 + 
peout
.
	$»ad
()

53 
fš®ly
:

54 
peout
.
	$şo£
()

55  
ouut


58 
sys
.
¶©fÜm
 == 'win32':

59 
APACHE_PATH
 = "httpd"

61 
APACHE_PATH
 = "apache"

63 
CONF_PATH
 = "test_mw.conf"

65 
cÚf_modwsgi
 = 
r
"""

66 #A·che2 
£rv”
 
cÚf
 
fe
 
‹¡šg
 
Ch”ryPy
 
w™h
 
modpythÚ_g©eway
.

68 
S”v”Name
 127.0.0.1

69 
Docum’tRoÙ
 "/"

70 
Li¡’
 %(
pÜt
)
s


72 
AÎowEncodedSÏshes
 
On


73 
LßdModuË
 
»wr™e_moduË
 
moduËs
/
mod_»wr™e
.
so


74 
Rewr™eEngše
 
Ú


75 
Rewr™eM­
 
esÿpšg
 :
esÿ³


77 
LßdModuË
 
log_cÚfig_moduË
 
moduËs
/
mod_log_cÚfig
.
so


78 
LogFÜm©
 "%%h %%È%%u %%ˆ\"%%r\" %%> %%b \"%%{Reã»r}i\" \"%%{U£r-ag’t}i\"" 
combšed


79 
Cu¡omLog
 "%(curdœ)s/­ache.acûss.log" 
combšed


80 
E¼ÜLog
 "%(curdir)s/apache.error.log"

81 
LogLev–
 
debug


83 
LßdModuË
 
wsgi_moduË
 
moduËs
/
mod_wsgi
.
so


84 
LßdModuË
 
’v_moduË
 
moduËs
/
mod_’v
.
so


86 
WSGISütAlŸs
 / "%(curdir)s/modwsgi.py"

87 
S‘Env
 
‹¡mod
 %Ñe¡mod)
s


91 
şass
 
	$ModWSGISu³rvisÜ
(
h–³r
.
Su³rvisÜ
):

94 
usšg_­ache
 = 
True


95 
usšg_wsgi
 = 
True


96 
‹m¶©e
=
cÚf_modwsgi


98 
def
 
	$__¡r__
(
£lf
):

99  "ModWSGI S”v” oÀ%s:%s" % (
£lf
.
ho¡
, s–f.
pÜt
)

101 
def
 
	$¡¬t
(
£lf
, 
moduËÇme
):

102 
mpcÚf
 = 
CONF_PATH


103 
nÙ
 
os
.
·th
.
	$i§bs
(
mpcÚf
):

104 
mpcÚf
 = 
os
.
·th
.
	$još
(
curdœ
, 
mpcÚf
)

106 
f
 = 
	`İ’
(
mpcÚf
, 'wb')

107 
Œy
:

108 
ouut
 = (
£lf
.
‹m¶©e
 %

109 {'pÜt': 
£lf
.
pÜt
, '‹¡mod': 
moduËÇme
,

110 'curdœ': 
curdœ
})

111 
f
.
	$wr™e
(
ouut
)

112 
fš®ly
:

113 
f
.
	$şo£
()

115 
»suÉ
 = 
	`»ad_´oûss
(
APACHE_PATH
, "-k s¹ -à%s" % 
mpcÚf
)

116 
»suÉ
:

117 
	$´št
(
»suÉ
)

119 #Mak
a
 
»que¡
 
so
 
mod_wsgi
 
¡¬ts
 
up
 
our
 
­p
.

120 #Ià
we
 
dÚ
't, concurrent initial„equests will 404.

121 
ch”rypy
.
_ı£rv”
.
	`wa™_fÜ_occup›d_pÜt
("127.0.0.1", 
£lf
.
pÜt
)

122 
web‹¡
.
	`İ’URL
('/ihİ‘h”e¢odeçuÉ', 
pÜt
=
£lf
.port)

123 
time
.
	$¦“p
(1)

125 
def
 
	$¡İ
(
£lf
):

127 
	`»ad_´oûss
(
APACHE_PATH
, "-k stop")

130 
lßded
 = 
F®£


131 
def
 
	$­¶iÿtiÚ
(
’vœÚ
, 
¡¬t_»¥Ú£
):

132 
impÜt
 
ch”rypy


133 
glob®
 
lßded


134 
nÙ
 
lßded
:

135 
lßded
 = 
True


136 
modÇme
 = "ch”rypy.‹¡." + 
’vœÚ
['testmod']

137 
mod
 = 
	`__impÜt__
(
modÇme
, 
	`glob®s
(), 
	`loÿls
(), [''])

138 
mod
.
	$£tup_£rv”
()

140 
ch”rypy
.
cÚfig
.
	`upd©e
({

141 "log.”rÜ_fe": 
os
.
·th
.
	`još
(
curdœ
, "test.error.log"),

142 "log.acûss_fe": 
os
.
·th
.
	`još
(
curdœ
, "test.access.log"),

144 "’gše.SIGHUP": 
NÚe
,

145 "’gše.SIGTERM": 
NÚe
,

146 
	}
})

147  
ch”rypy
.
Œ“
(
’vœÚ
, 
¡¬t_»¥Ú£
)

	@trunk/objs/CherryPy-3.2.4/cherrypy/test/sessiondemo.py

1 #!/
u¤
/
bš
/
pythÚ


4 
impÜt
 
ÿËnd¬


5 
äom
 
d©‘ime
 
impÜt
 datetime

6 
impÜt
 
sys


7 
impÜt
 
ch”rypy


8 
äom
 
	gch”rypy
.
lib
 
impÜt
 
£ssiÚs


9 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
cİy™ems


12 
	g·ge
 = """

13 <
html
>

14 <
h—d
>

15 <
¡yË
 
ty³
='text/css'>

16 
bË
 { 
bÜd”
-
cŞÏp£
: cŞÏp£; 
	gbÜd”
: 1
px
 
sŞid
 #663333; }

17 
	gth
 { 
	g‹xt
-
	g®ign
: 
right
; 
	gbackground
-
	gcŞÜ
: #663333; cŞÜ: 
wh™e
; 
	g·ddšg
: 0.5e
m
; }

18 
	gtd
 { 
	gwh™e
-
	g¥aû
: 
´e
-
w¿p
; 
	gfÚt
-
	gçmy
: 
mÚo¥aû
; 
	g·ddšg
: 0.5e
m
;

19 
	gbÜd”
: 1
px
 
sŞid
 #663333; }

20 .
	gw¬n
 { 
	gfÚt
-
	gçmy
: 
£rif
; 
	gcŞÜ
: #990000; }

21 </
	g¡yË
>

22 <
süt
 
	gty³
="text/javascript">

24 
funùiÚ
 
	$twodig™
(
d
è{  d < 10 ? "0" + d : d; 
	}
}

25 
funùiÚ
 
	$fÜm©time
(
t
) {

26 
v¬
 
mÚth
 = 
t
.
	`g‘UTCMÚth
() + 1;

27 
v¬
 
day
 = 
t
.
	`g‘UTCD©e
();

28 
v¬
 
y—r
 = 
t
.
	`g‘UTCFuÎY—r
();

29 
v¬
 
hours
 = 
t
.
	`g‘UTCHours
();

30 
v¬
 
mšu‹s
 = 
t
.
	`g‘UTCMšu‹s
();

31  (
y—r
 + "/" + 
	`twodig™
(
mÚth
è+ "/" +wodig™(
day
) + " " +

32 
hours
 + ":" + 
	`twodig™
(
mšu‹s
) + " UTC");

33 
	}
}

35 
funùiÚ
 
	$š‹rv®
(
s
) {

37 
v¬
 
£cÚds
 = 
s
 %% 60;

38 
s
 = 
M©h
.
	`æoÜ
(s / 60);

39 
v¬
 
mšu‹s
 = 
s
 %% 60;

40 
s
 = 
M©h
.
	`æoÜ
(s / 60);

41 
v¬
 
hours
 = 
s
 %% 24;

42 
v¬
 
v
 = 
	`twodig™
(
hours
è+ ":" +wodig™(
mšu‹s
è+ ":" +wodig™(
£cÚds
);

43 
v¬
 
days
 = 
M©h
.
	`æoÜ
(
s
 / 24);

44 ià(
days
 !ğ0è
v
 = days + ' days, ' + v;

45  
v
;

46 
	}
}

48 
v¬
 
	gfudge_£cÚds
 = 5;

50 
funùiÚ
 
	$š™
() {

52 
v¬
 
cu¼’tTime
 = 
Ãw
 
	`D©e
();

53 
v¬
 
bunixtime
 = 
M©h
.
	`æoÜ
(
cu¼’tTime
.
	`g‘Time
() / 1000);

55 
v¬
 
v
 = 
	`fÜm©time
(
cu¼’tTime
);

56 
v
 +ğ" (Unixime: " + 
bunixtime
 + ")";

58 
v¬
 
diff
 = 
M©h
.
	`abs
(%(
£rv”unixtime
)
s
 - 
bunixtime
);

59 ià(
diff
 > 
fudge_£cÚds
è
v
 += "<p class='warn'>Browser‡nd Serverimes disagree.</p>";

61 
docum’t
.
	`g‘EËm’tById
('btime').
šÃrHTML
 = 
v
;

65 
v¬
 
expœes
 = 
D©e
.
	`·r£
("%(expires)s") / 1000;

66 
v¬
 
Úehour
 = (60 * 60);

67 ià(
M©h
.
	`abs
(
expœes
 - (
bunixtime
 + 
Úehour
)è> 
fudge_£cÚds
) {

68 
diff
 = 
M©h
.
	`æoÜ
(
expœes
 - 
bunixtime
);

69 ià(
expœes
 > (
bunixtime
 + 
Úehour
)) {

70 
v¬
 
msg
 = "Re¥Ú£ cook› 'expœes' d©i " + 
	`š‹rv®
(
diff
) + " inhe future.";

72 
v¬
 
msg
 = "Re¥Ú£ cook› 'expœes' d©i " + 
	`š‹rv®
(0 - 
diff
) + " inhe…ast.";

74 
docum’t
.
	`g‘EËm’tById
('»¥cook›w¬n').
šÃrHTML
 = 
msg
;

76 
	}
}

78 </
	gsüt
>

79 </
	gh—d
>

81 <
body
 
	gÚlßd
='init()'>

82 <
h2
>
SessiÚ
 
Demo
</h2>

83 <
p
>
R–ßd
 
this
 
·ge
. 
The
 
£ssiÚ
 
ID
 
should
 
nÙ
 
chªge
 
äom
 
Úe
 
»lßd
 
to
 
the
 
Ãxt
</p>

84 <
p
><
a
 
h»f
='../'>
Index
</a> | <¨h»f='expœe'>
Expœe
</a> | <¨h»f='»g’'>
Reg’”©e
</a></p>

85 <
bË
>

86 <
Œ
><
th
>
SessiÚ
 
ID
:</th><
td
>%(
£ssiÚid
)
s
<
p
 
şass
='w¬n'>%(
chªgemsg
)s</p></td></tr>

87 <
Œ
><
th
>
Reque¡
 
Cook›
</th><
td
>%(
»qcook›
)
s
</td></tr>

88 <
Œ
><
th
>
Re¥Ú£
 
Cook›
</th><
td
>%(
»¥cook›
)
s
<
p
 
id
='»¥cook›w¬n' 
şass
='warn'></p></td></tr>

89 <
Œ
><
th
>
SessiÚ
 
D©a
</th><
td
>%(
£ssiÚd©a
)
s
</td></tr>

90 <
Œ
><
th
>
S”v”
 
Time
</th><
td
 
id
='¡ime'>%(
£rv”time
)
s
 (
Unix
 
time
: %(
£rv”unixtime
)s)</td></tr>

91 <
Œ
><
th
>
Brow£r
 
Time
</th><
td
 
id
='btime'>&
nb¥
;</
	gtd
></
	gŒ
>

92 <
	gŒ
><
	gth
>
Ch”rypy
 
	gV”siÚ
:</
th
><
td
>%(
ıv”siÚ
)
s
</td></
Œ
>

93 <
Œ
><
th
>
PythÚ
 
V”siÚ
:</th><
td
>%(
pyv”siÚ
)
s
</td></tr>

94 </
bË
>

95 </
body
></
html
>

98 
şass
 
	$RoÙ
(
objeù
):

100 
def
 
	$·ge
(
£lf
):

101 
chªgemsg
 = []

102 
ch”rypy
.
£ssiÚ
.
id
 !ğch”rypy.£ssiÚ.
Üigš®id
:

103 
ch”rypy
.
£ssiÚ
.
Üigš®id
 
is
 
NÚe
:

104 
chªgemsg
.
	`­³nd
('Created‚ew session because‚o session id was given.')

105 
ch”rypy
.
£ssiÚ
.
missšg
:

106 
chªgemsg
.
	`­³nd
('Created‚ew session dueo missing (expired or malicious) session.')

107 
ch”rypy
.
£ssiÚ
.
»g’”©ed
:

108 
chªgemsg
.
	`­³nd
('Application generated‡‚ew session.')

110 
Œy
:

111 
expœes
 = 
ch”rypy
.
»¥Ú£
.
cook›
['session_id']['expires']

112 
exû±
 
KeyE¼Ü
:

113 
expœes
 = ''

115  
·ge
 % {

116 '£ssiÚid': 
ch”rypy
.
£ssiÚ
.
id
,

117 'chªgemsg': '<br>'.
	`još
(
chªgemsg
),

118 '»¥cook›': 
ch”rypy
.
»¥Ú£
.
cook›
.
	`ouut
(),

119 '»qcook›': 
ch”rypy
.
»que¡
.
cook›
.
	`ouut
(),

120 '£ssiÚd©a': 
	`cİy™ems
(
ch”rypy
.
£ssiÚ
),

121 '£rv”time': 
d©‘ime
.
	`utúow
().
	`¡ráime
("%Y/%m/%d %H:%M") + " UTC",

122 '£rv”unixtime': 
ÿËnd¬
.
	`timegm
(
d©‘ime
.
	`utúow
().
	`tim‘u¶e
()),

123 'ıv”siÚ': 
ch”rypy
.
__v”siÚ__
,

124 'pyv”siÚ': 
sys
.
v”siÚ
,

125 'expœes': 
expœes
,

126 
	}
}

128 
def
 
	$šdex
(
£lf
):

129 #Mu¡ 
modify
 
d©a
 
Ü
 
the
 
£ssiÚ
 
wl
 
nÙ
 
be
 
§ved
.

130 
ch”rypy
.
£ssiÚ
['color'] = 'green'

131  
£lf
.
	$·ge
()

132 
šdex
.
expo£d
 = 
True


134 
def
 
	$expœe
(
£lf
):

135 
£ssiÚs
.
	$expœe
()

136  
£lf
.
	$·ge
()

137 
expœe
.
expo£d
 = 
True


139 
def
 
	$»g’
(
£lf
):

140 
ch”rypy
.
£ssiÚ
.
	$»g’”©e
()

141 #Mu¡ 
modify
 
d©a
 
Ü
 
the
 
£ssiÚ
 
wl
 
nÙ
 
be
 
§ved
.

142 
ch”rypy
.
£ssiÚ
['color'] = 'yellow'

143  
£lf
.
	$·ge
()

144 
»g’
.
expo£d
 = 
True


146 
__Çme__
 == '__main__':

147 
ch”rypy
.
cÚfig
.
	`upd©e
({

148 #'
’vœÚm’t
': '
´oduùiÚ
',

149 'log.sü“n': 
True
,

150 'toŞs.£ssiÚs.Ú': 
True
,

151 
	}
})

152 
ch”rypy
.
quick¡¬t
(
RoÙ
())

	@trunk/objs/CherryPy-3.2.4/cherrypy/test/static/index.html

1 
	gH–lo
, 
	gwÜld


	@trunk/objs/CherryPy-3.2.4/cherrypy/test/style.css

1 
Dummy
 
	g¡yËsh“t


	@trunk/objs/CherryPy-3.2.4/cherrypy/test/test_auth_basic.py

1 #Thi 
fe
 
is
 
·¹
 
of
 
Ch”ryPy
 <
h‰p
:

2 #-*- 
codšg
: 
utf
-8 -*-

3 #vim:
ts
=4:
sw
=4:
ex·ndb
:
f“ncodšg
=
utf
-8

5 
impÜt
 
ch”rypy


6 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
	gmd5
, 
Áob


7 
äom
 
	gch”rypy
.
lib
 
impÜt
 
auth_basic


8 
äom
 
	gch”rypy
.
‹¡
 
impÜt
 
h–³r


11 
şass
 
	$BasicAuthTe¡
(
h–³r
.
CPWebCa£
):

13 
def
 
	$£tup_£rv”
():

14 
şass
 
RoÙ
:

15 
def
 
	$šdex
(
£lf
):

17 
šdex
.
expo£d
 = 
True


19 
şass
 
BasicPrÙeùed
:

20 
def
 
	$šdex
(
£lf
):

21  "H–lØ%s, you'vb“ÀauthÜized." % 
ch”rypy
.
»que¡
.
logš


22 
šdex
.
expo£d
 = 
True


24 
şass
 
BasicPrÙeùed2
:

25 
def
 
	$šdex
(
£lf
):

26  "H–lØ%s, you'vb“ÀauthÜized." % 
ch”rypy
.
»que¡
.
logš


27 
šdex
.
expo£d
 = 
True


29 
u£½assdiù
 = {'xu£r' : 'x·sswÜd'
	}
}

30 
u£rhashdiù
 = {'xu£r' : 
md5
(
Áob
('x·sswÜd')).
hexdige¡
()}

32 
def
 
	$check·sshash
(
»®m
, 
u£r
, 
·sswÜd
):

33 
p
 = 
u£rhashdiù
.
	$g‘
(
u£r
)

34  
p
 
ªd
… =ğ
	`md5
(
	`Áob
(
·sswÜd
)).
	$hexdige¡
(è
Ü
 
F®£


36 
cÚf
 = {'/basic': {'toŞs.auth_basic.Ú': 
True
,

38 'toŞs.auth_basic.check·sswÜd': 
auth_basic
.
	`check·sswÜd_diù
(
u£½assdiù
)},

39 '/basic2': {'toŞs.auth_basic.Ú': 
True
,

41 'toŞs.auth_basic.check·sswÜd': 
check·sshash
},

42 
	}
}

44 
roÙ
 = 
	$RoÙ
()

45 
roÙ
.
basic
 = 
	$BasicPrÙeùed
()

46 
roÙ
.
basic2
 = 
	$BasicPrÙeùed2
()

47 
ch”rypy
.
Œ“
.
	$mouÁ
(
roÙ
, 
cÚfig
=
cÚf
)

48 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

50 
def
 
	$‹¡Public
(
£lf
):

51 
£lf
.
	`g‘Page
("/")

52 
£lf
.
	`as£¹Stus
('200 OK')

53 
£lf
.
	`as£¹H—d”
('Content-Type', 'text/html;charset=utf-8')

54 
£lf
.
	`as£¹Body
('This is…ublic.')

56 
def
 
	$‹¡Basic
(
£lf
):

57 
£lf
.
	`g‘Page
("/basic/")

58 
£lf
.
	$as£¹Stus
(401)

59 
£lf
.
	`as£¹H—d”
('WWW-Authenticate', 'Basic„ealm="wonderland"')

61 
£lf
.
	`g‘Page
('/basic/', [('Authorization', 'BasicƒHVzZXI6eHBhc3N3b3JX')])

62 
£lf
.
	$as£¹Stus
(401)

64 
£lf
.
	`g‘Page
('/basic/', [('Authorization', 'BasicƒHVzZXI6eHBhc3N3b3Jk')])

65 
£lf
.
	`as£¹Stus
('200 OK')

66 
£lf
.
	`as£¹Body
("Hello xuser, you've been‡uthorized.")

68 
def
 
	$‹¡Basic2
(
£lf
):

69 
£lf
.
	`g‘Page
("/basic2/")

70 
£lf
.
	$as£¹Stus
(401)

71 
£lf
.
	`as£¹H—d”
('WWW-Authenticate', 'Basic„ealm="wonderland"')

73 
£lf
.
	`g‘Page
('/basic2/', [('Authorization', 'BasicƒHVzZXI6eHBhc3N3b3JX')])

74 
£lf
.
	$as£¹Stus
(401)

76 
£lf
.
	`g‘Page
('/basic2/', [('Authorization', 'BasicƒHVzZXI6eHBhc3N3b3Jk')])

77 
£lf
.
	`as£¹Stus
('200 OK')

78 
£lf
.
	`as£¹Body
("Hello xuser, you've been‡uthorized.")

	@trunk/objs/CherryPy-3.2.4/cherrypy/test/test_auth_digest.py

1 #Thi 
fe
 
is
 
·¹
 
of
 
Ch”ryPy
 <
h‰p
:

2 #-*- 
codšg
: 
utf
-8 -*-

3 #vim:
ts
=4:
sw
=4:
ex·ndb
:
f“ncodšg
=
utf
-8

6 
impÜt
 
ch”rypy


7 
äom
 
	gch”rypy
.
lib
 
impÜt
 
auth_dige¡


9 
äom
 
	gch”rypy
.
‹¡
 
impÜt
 
h–³r


11 
şass
 
	$Dige¡AuthTe¡
(
h–³r
.
CPWebCa£
):

13 
def
 
	$£tup_£rv”
():

14 
şass
 
RoÙ
:

15 
def
 
	$šdex
(
£lf
):

17 
šdex
.
expo£d
 = 
True


19 
şass
 
Dige¡PrÙeùed
:

20 
def
 
	$šdex
(
£lf
):

21  "H–lØ%s, you'vb“ÀauthÜized." % 
ch”rypy
.
»que¡
.
logš


22 
šdex
.
expo£d
 = 
True


24 
def
 
	$ãtch_u£rs
():

25  {'‹¡': '‹¡'
	}
}

28 
g‘_ha1
 = 
ch”rypy
.
lib
.
auth_dige¡
.
g‘_ha1_diù_¶aš
(
	$ãtch_u£rs
())

29 
cÚf
 = {'/dige¡': {'toŞs.auth_dige¡.Ú': 
True
,

31 'toŞs.auth_dige¡.g‘_ha1': 
g‘_ha1
,

33 'toŞs.auth_dige¡.debug': 'True'}
	}
}

35 
roÙ
 = 
	$RoÙ
()

36 
roÙ
.
dige¡
 = 
	$Dige¡PrÙeùed
()

37 
ch”rypy
.
Œ“
.
	$mouÁ
(
roÙ
, 
cÚfig
=
cÚf
)

38 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

40 
def
 
	$‹¡Public
(
£lf
):

41 
£lf
.
	`g‘Page
("/")

42 
£lf
.
	`as£¹Stus
('200 OK')

43 
£lf
.
	`as£¹H—d”
('Content-Type', 'text/html;charset=utf-8')

44 
£lf
.
	`as£¹Body
('This is…ublic.')

46 
def
 
	$‹¡Dige¡
(
£lf
):

47 
£lf
.
	`g‘Page
("/digest/")

48 
£lf
.
	$as£¹Stus
(401)

50 
v®ue
 = 
NÚe


51 
k
, 
v
 
š
 
£lf
.
h—d”s
:

52 
k
.
	`low”
() == "www-authenticate":

53 
v
.
	`¡¬tsw™h
("Digest"):

54 
v®ue
 = 
v


57 
v®ue
 
is
 
NÚe
:

58 
£lf
.
	`_hªdËwebE¼Ü
("Digest‡uthentification scheme was‚ot found")

60 
v®ue
 = value[7:]

61 
™ems
 = 
v®ue
.
	`¥l™
(', ')

62 
tok’s
 = {
	}
}

63 
™em
 
š
 
™ems
:

64 
key
, 
	gv®ue
 = 
™em
.
¥l™
('=')

65 
tok’s
[
key
.
low”
()] = 
v®ue


67 
missšg_msg
 = "%s is missing"

68 
bad_v®ue_msg
 = "'%s' wasƒxpecting '%s' but found '%s'"

69 
nÚû
 = 
NÚe


70 '»®m' 
nÙ
 
š
 
tok’s
:

71 
£lf
.
_hªdËwebE¼Ü
(
missšg_msg
 % 'realm')

72 
–if
 
tok’s
['realm'] != '"localhost"':

73 
£lf
.
_hªdËwebE¼Ü
(
bad_v®ue_msg
 % ('»®m', '"loÿlho¡"', 
tok’s
['realm']))

74 'nÚû' 
nÙ
 
š
 
	gtok’s
:

75 
£lf
.
_hªdËwebE¼Ü
(
missšg_msg
 % 'nonce')

77 
nÚû
 = 
tok’s
['nÚû'].
¡r
('"')

78 '®gÜ™hm' 
nÙ
 
š
 
tok’s
:

79 
£lf
.
_hªdËwebE¼Ü
(
missšg_msg
 % 'algorithm')

80 
–if
 
tok’s
['algorithm'] != '"MD5"':

81 
£lf
.
_hªdËwebE¼Ü
(
bad_v®ue_msg
 % ('®gÜ™hm', '"MD5"', 
tok’s
['algorithm']))

82 'qİ' 
nÙ
 
š
 
	gtok’s
:

83 
£lf
.
_hªdËwebE¼Ü
(
missšg_msg
 % 'qop')

84 
–if
 
tok’s
['qop'] != '"auth"':

85 
£lf
.
_hªdËwebE¼Ü
(
bad_v®ue_msg
 % ('qİ', '"auth"', 
tok’s
['qop']))

87 
	gg‘_ha1
 = 
auth_dige¡
.
g‘_ha1_diù_¶aš
({'test' : 'test'})

89 #Te¡ 
u£r
 
ag’t
 
»¥Ú£
 
w™h
 
a
 
wrÚg
 
v®ue
 'realm'

90 
ba£_auth
 = 'Digest username="test",„ealm="wrong„ealm",‚once="%s", uri="/digest/",‡lgorithm=MD5,„esponse="%s", qop=auth,‚c=%s, cnonce="1522e61005789929"'

92 
auth_h—d”
 = 
ba£_auth
 % (
nÚû
, '11111111111111111111111111111111', '00000001')

93 
	gauth
 = 
auth_dige¡
.
H‰pDige¡AuthÜiz©iÚ
(
auth_h—d”
, 'GET')

94 #ÿlcuÏ‹ 
the
 
»¥Ú£
 
dige¡


95 
	gha1
 = 
g‘_ha1
(
auth
.
»®m
, 'test')

96 
	g»¥Ú£
 = 
auth
.
	$»que¡_dige¡
(
ha1
)

97 #£nd 
»¥Ú£
 
w™h
 
cÜ»ù
„e¥Ú£ 
dige¡
, 
but
 
wrÚg
 
»®m


98 
auth_h—d”
 = 
ba£_auth
 % (
nÚû
, 
»¥Ú£
, '00000001')

99 
£lf
.
	`g‘Page
('/dige¡/', [('AuthÜiz©iÚ', 
auth_h—d”
)])

100 
£lf
.
	$as£¹Stus
(401)

102 #Te¡ 
th©
 
mu¡
 
·ss


103 
ba£_auth
 = 'Digest username="test",„ealm="localhost",‚once="%s", uri="/digest/",‡lgorithm=MD5,„esponse="%s", qop=auth,‚c=%s, cnonce="1522e61005789929"'

105 
auth_h—d”
 = 
ba£_auth
 % (
nÚû
, '11111111111111111111111111111111', '00000001')

106 
auth
 = 
auth_dige¡
.
	`H‰pDige¡AuthÜiz©iÚ
(
auth_h—d”
, 'GET')

107 #ÿlcuÏ‹ 
the
 
»¥Ú£
 
dige¡


108 
ha1
 = 
	`g‘_ha1
('localhost', 'test')

109 
»¥Ú£
 = 
auth
.
	$»que¡_dige¡
(
ha1
)

110 #£nd 
»¥Ú£
 
w™h
 
cÜ»ù
„e¥Ú£ 
dige¡


111 
auth_h—d”
 = 
ba£_auth
 % (
nÚû
, 
»¥Ú£
, '00000001')

112 
£lf
.
	`g‘Page
('/dige¡/', [('AuthÜiz©iÚ', 
auth_h—d”
)])

113 
£lf
.
	`as£¹Stus
('200 OK')

114 
£lf
.
	`as£¹Body
("Helloest, you've been‡uthorized.")

	@trunk/objs/CherryPy-3.2.4/cherrypy/test/test_bus.py

1 
impÜt
 
th»adšg


2 
impÜt
 
time


3 
impÜt
 
un™‹¡


5 
impÜt
 
ch”rypy


6 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
	gg‘_d«mÚ
, 
£t


7 
äom
 
	gch”rypy
.
´oûss
 
impÜt
 
w¥bus


10 
	gmsg
 = "Listener %d on channel %s: %s."

13 
şass
 
	$PublishSubsüibeTe¡s
(
un™‹¡
.
Te¡Ca£
):

15 
def
 
	$g‘_li¡’”
(
£lf
, 
chªÃl
, 
šdex
):

16 
def
 
	$li¡’”
(
¬g
=
NÚe
):

17 
£lf
.
»¥Ú£s
.
	`­³nd
(
msg
 % (
šdex
, 
chªÃl
, 
¬g
))

18  
li¡’”


20 
def
 
	$‹¡_butš_chªÃls
(
£lf
):

21 
b
 = 
w¥bus
.
	$Bus
()

23 
£lf
.
»¥Ú£s
, 
ex³ùed
 = [], []

25 
chªÃl
 
š
 
b
.
li¡’”s
:

26 
šdex
, 
´iÜ™y
 
š
 
	$’um”©e
([100, 50, 0, 51]):

27 
b
.
	`subsüibe
(
chªÃl
, 
£lf
.
	`g‘_li¡’”
(chªÃl, 
šdex
), 
´iÜ™y
)

29 
chªÃl
 
š
 
b
.
li¡’”s
:

30 
b
.
	$publish
(
chªÃl
)

31 
ex³ùed
.
	`ex‹nd
([
msg
 % (
i
, 
chªÃl
, 
NÚe
è˜
	`š
 (2, 1, 3, 0)])

32 
b
.
	$publish
(
chªÃl
, 
¬g
=79347)

33 
ex³ùed
.
	`ex‹nd
([
msg
 % (
i
, 
chªÃl
, 79347è˜
	`š
 (2, 1, 3, 0)])

35 
£lf
.
	$as£¹Equ®
(
£lf
.
»¥Ú£s
, 
ex³ùed
)

37 
def
 
	$‹¡_cu¡om_chªÃls
(
£lf
):

38 
b
 = 
w¥bus
.
	$Bus
()

40 
£lf
.
»¥Ú£s
, 
ex³ùed
 = [], []

42 
cu¡om_li¡’”s
 = ('hugh', 'louis', 'dewey')

43 
chªÃl
 
š
 
cu¡om_li¡’”s
:

44 
šdex
, 
´iÜ™y
 
š
 
	$’um”©e
([
NÚe
, 10, 60, 40]):

45 
b
.
	`subsüibe
(
chªÃl
, 
£lf
.
	`g‘_li¡’”
(chªÃl, 
šdex
), 
´iÜ™y
)

47 
chªÃl
 
š
 
cu¡om_li¡’”s
:

48 
b
.
	`publish
(
chªÃl
, 'ah so')

49 
ex³ùed
.
	`ex‹nd
([
msg
 % (
i
, 
chªÃl
, 'ah so'è˜
	`š
 (1, 3, 0, 2)])

50 
b
.
	$publish
(
chªÃl
)

51 
ex³ùed
.
	`ex‹nd
([
msg
 % (
i
, 
chªÃl
, 
NÚe
è˜
	`š
 (1, 3, 0, 2)])

53 
£lf
.
	$as£¹Equ®
(
£lf
.
»¥Ú£s
, 
ex³ùed
)

55 
def
 
	$‹¡_li¡’”_”rÜs
(
£lf
):

56 
b
 = 
w¥bus
.
	$Bus
()

58 
£lf
.
»¥Ú£s
, 
ex³ùed
 = [], []

59 
chªÃls
 = [
c
 ø
š
 
b
.
li¡’”s
 c != 'log']

61 
chªÃl
 
š
 
chªÃls
:

62 
b
.
	`subsüibe
(
chªÃl
, 
£lf
.
	$g‘_li¡’”
(
chªÃl
, 1))

63 #Thi 
wl
  
sšû
 
the
 
Ïmbda
 
kes
 
no
 
¬gs
.

64 
b
.
	`subsüibe
(
chªÃl
, 
Ïmbda
: 
NÚe
, 
´iÜ™y
=20)

66 
chªÃl
 
š
 
chªÃls
:

67 
£lf
.
	$as£¹Rai£s
(
w¥bus
.
ChªÃlFau»s
, 
b
.
publish
, 
chªÃl
, 123)

68 
ex³ùed
.
	`­³nd
(
msg
 % (1, 
chªÃl
, 123))

70 
£lf
.
	$as£¹Equ®
(
£lf
.
»¥Ú£s
, 
ex³ùed
)

73 
şass
 
	$BusM‘hodTe¡s
(
un™‹¡
.
Te¡Ca£
):

75 
def
 
	$log
(
£lf
, 
bus
):

76 
£lf
.
_log_’Œ›s
 = []

77 
def
 
	$log™
(
msg
, 
Ëv–
):

78 
£lf
.
_log_’Œ›s
.
	$­³nd
(
msg
)

79 
bus
.
	`subsüibe
('log', 
log™
)

81 
def
 
	$as£¹Log
(
£lf
, 
’Œ›s
):

82 
£lf
.
	$as£¹Equ®
(
£lf
.
_log_’Œ›s
, 
’Œ›s
)

84 
def
 
	$g‘_li¡’”
(
£lf
, 
chªÃl
, 
šdex
):

85 
def
 
	$li¡’”
(
¬g
=
NÚe
):

86 
£lf
.
»¥Ú£s
.
	`­³nd
(
msg
 % (
šdex
, 
chªÃl
, 
¬g
))

87  
li¡’”


89 
def
 
	$‹¡_¡¬t
(
£lf
):

90 
b
 = 
w¥bus
.
	$Bus
()

91 
£lf
.
	$log
(
b
)

93 
£lf
.
»¥Ú£s
 = []

94 
num
 = 3

95 
šdex
 
š
 
	$¿nge
(
num
):

96 
b
.
	`subsüibe
('¡¬t', 
£lf
.
	`g‘_li¡’”
('¡¬t', 
šdex
))

98 
b
.
	$¡¬t
()

99 
Œy
:

100 #Th
¡¬t
 
m‘hod
 
MUST
 
ÿÎ
 
®l
 '¡¬t' 
li¡’”s
.

101 
£lf
.
	`as£¹Equ®
(
	`£t
(£lf.
»¥Ú£s
),

102 
	`£t
([
msg
 % (
i
, '¡¬t', 
NÚe
è˜
š
 
	`¿nge
(
num
)]))

103 #Th
¡¬t
 
m‘hod
 
MUST
 
move
 
the
 
¡©e
 
to
 
STARTED


104 #(
Ü
 
EXITING
, 
”rÜs
 
occur
)

105 
£lf
.
	$as£¹Equ®
(
b
.
¡©e
, b.
¡©es
.
STARTED
)

106 #Th
¡¬t
 
m‘hod
 
MUST
 
log
 
™s
 
¡©es
.

107 
£lf
.
	`as£¹Log
(['Bus STARTING', 'Bus STARTED'])

108 
fš®ly
:

109 #Ex™ 
so
 
the
 
©ex™
 
hªdËr
 
dÛ¢
't complain.

110 
b
.
	$ex™
()

112 
def
 
	$‹¡_¡İ
(
£lf
):

113 
b
 = 
w¥bus
.
	$Bus
()

114 
£lf
.
	$log
(
b
)

116 
£lf
.
»¥Ú£s
 = []

117 
num
 = 3

118 
šdex
 
š
 
	$¿nge
(
num
):

119 
b
.
	`subsüibe
('¡İ', 
£lf
.
	`g‘_li¡’”
('¡İ', 
šdex
))

121 
b
.
	$¡İ
()

123 #Th
¡İ
 
m‘hod
 
MUST
 
ÿÎ
 
®l
 '¡İ' 
li¡’”s
.

124 
£lf
.
	`as£¹Equ®
(
	`£t
(£lf.
»¥Ú£s
),

125 
	`£t
([
msg
 % (
i
, '¡İ', 
NÚe
è˜
š
 
	`¿nge
(
num
)]))

126 #Th
¡İ
 
m‘hod
 
MUST
 
move
 
the
 
¡©e
 
to
 
STOPPED


127 
£lf
.
	$as£¹Equ®
(
b
.
¡©e
, b.
¡©es
.
STOPPED
)

128 #Th
¡İ
 
m‘hod
 
MUST
 
log
 
™s
 
¡©es
.

129 
£lf
.
	`as£¹Log
(['Bus STOPPING', 'Bus STOPPED'])

131 
def
 
	$‹¡_g¿ûful
(
£lf
):

132 
b
 = 
w¥bus
.
	$Bus
()

133 
£lf
.
	$log
(
b
)

135 
£lf
.
»¥Ú£s
 = []

136 
num
 = 3

137 
šdex
 
š
 
	$¿nge
(
num
):

138 
b
.
	`subsüibe
('g¿ûful', 
£lf
.
	`g‘_li¡’”
('g¿ûful', 
šdex
))

140 
b
.
	$g¿ûful
()

142 #Th
g¿ûful
 
m‘hod
 
MUST
 
ÿÎ
 
®l
 'g¿ûful' 
li¡’”s
.

143 
£lf
.
	`as£¹Equ®
(
	`£t
(£lf.
»¥Ú£s
),

144 
	`£t
([
msg
 % (
i
, 'g¿ûful', 
NÚe
è˜
š
 
	`¿nge
(
num
)]))

145 #Th
g¿ûful
 
m‘hod
 
MUST
 
log
 
™s
 
¡©es
.

146 
£lf
.
	`as£¹Log
(['Bus graceful'])

148 
def
 
	$‹¡_ex™
(
£lf
):

149 
b
 = 
w¥bus
.
	$Bus
()

150 
£lf
.
	$log
(
b
)

152 
£lf
.
»¥Ú£s
 = []

153 
num
 = 3

154 
šdex
 
š
 
	$¿nge
(
num
):

155 
b
.
	`subsüibe
('¡İ', 
£lf
.
	`g‘_li¡’”
('¡İ', 
šdex
))

156 
b
.
	`subsüibe
('ex™', 
£lf
.
	`g‘_li¡’”
('ex™', 
šdex
))

158 
b
.
	$ex™
()

160 #Th
ex™
 
m‘hod
 
MUST
 
ÿÎ
 
®l
 '¡İ' 
li¡’”s
,

161 #ªd 
th’
 
®l
 'ex™' 
li¡’”s
.

162 
£lf
.
	`as£¹Equ®
(
	`£t
(£lf.
»¥Ú£s
),

163 
	`£t
([
msg
 % (
i
, '¡İ', 
NÚe
è˜
š
 
	`¿nge
(
num
)] +

164 [
msg
 % (
i
, 'ex™', 
NÚe
è˜
š
 
	`¿nge
(
num
)]))

165 #Th
ex™
 
m‘hod
 
MUST
 
move
 
the
 
¡©e
 
to
 
EXITING


166 
£lf
.
	$as£¹Equ®
(
b
.
¡©e
, b.
¡©es
.
EXITING
)

167 #Th
ex™
 
m‘hod
 
MUST
 
log
 
™s
 
¡©es
.

168 
£lf
.
	`as£¹Log
(['Bus STOPPING', 'Bus STOPPED', 'Bus EXITING', 'Bus EXITED'])

170 
def
 
	$‹¡_wa™
(
£lf
):

171 
b
 = 
w¥bus
.
	$Bus
()

173 
def
 
	$f
(
m‘hod
):

174 
time
.
	$¦“p
(0.2)

175 
	$g‘©Œ
(
b
, 
m‘hod
)()

177 
m‘hod
, 
¡©es
 
š
 [('¡¬t', [
b
.¡©es.
STARTED
]),

178 ('¡İ', [
b
.
¡©es
.
STOPPED
]),

179 ('¡¬t', [
b
.
¡©es
.
STARTING
, b.¡©es.
STARTED
]),

180 ('ex™', [
b
.
¡©es
.
EXITING
]),

182 
th»adšg
.
	`Th»ad
(
rg‘
=
f
, 
¬gs
=(
m‘hod
,)).
	$¡¬t
()

183 
b
.
	$wa™
(
¡©es
)

185 #Th
wa™
 
m‘hod
 
MUST
 wa™ 
the
 
giv’
 
	`¡©e
(
s
).

186 
b
.
¡©e
 
nÙ
 
š
 
¡©es
:

187 
£lf
.
	`ç
("S‹ %¸nÙ iÀ%r" % (
b
.
¡©e
, 
¡©es
))

189 
def
 
	$‹¡_block
(
£lf
):

190 
b
 = 
w¥bus
.
	$Bus
()

191 
£lf
.
	$log
(
b
)

193 
def
 
	$f
():

194 
time
.
	$¦“p
(0.2)

195 
b
.
	$ex™
()

196 
def
 
	$g
():

197 
time
.
	$¦“p
(0.4)

198 
th»adšg
.
	`Th»ad
(
rg‘
=
f
).
	$¡¬t
()

199 
th»adšg
.
	`Th»ad
(
rg‘
=
g
).
	$¡¬t
()

200 
th»ads
 = [
t
 ˆ
š
 
th»adšg
.
	$’um”©e
(è
nÙ
 
	`g‘_d«mÚ
(
t
)]

201 
£lf
.
	`as£¹Equ®
(
	`Ën
(
th»ads
), 3)

203 
b
.
	$block
()

205 #Th
block
 
m‘hod
 
MUST
 
wa™
 
the
 
EXITING
 
¡©e
.

206 
£lf
.
	$as£¹Equ®
(
b
.
¡©e
, b.
¡©es
.
EXITING
)

207 #Th
block
 
m‘hod
 
MUST
 
wa™
 
ALL
 
nÚ
-
maš
,‚Ú-
d«mÚ
 
th»ads
 
to
 
fšish
.

208 
th»ads
 = [
t
 ˆ
š
 
th»adšg
.
	$’um”©e
(è
nÙ
 
	`g‘_d«mÚ
(
t
)]

209 
£lf
.
	`as£¹Equ®
(
	`Ën
(
th»ads
), 1)

210 #Th
Ï¡
 
mes§ge
 
wl
 
m’tiÚ
 
ª
 
šd‘”mšabË
 
th»ad
 
Çme
; 
ignÜe
 
™


211 
£lf
.
	`as£¹Equ®
(£lf.
_log_’Œ›s
[:-1],

216 
def
 
	$‹¡_¡¬t_w™h_ÿÎback
(
£lf
):

217 
b
 = 
w¥bus
.
	$Bus
()

218 
£lf
.
	$log
(
b
)

219 
Œy
:

220 
ev’ts
 = []

221 
def
 
	$f
(*
¬gs
, **
kw¬gs
):

222 
ev’ts
.
	`­³nd
(("f", 
¬gs
, 
kw¬gs
))

223 
def
 
	$g
():

224 
ev’ts
.
	`­³nd
("g")

225 
b
.
	`subsüibe
("¡¬t", 
g
)

226 
b
.
	`¡¬t_w™h_ÿÎback
(
f
, (1, 3, 5), {"foo": "b¬"
	}
})

227 #Giv
wa™
(è
time
 
to
 
run
 
f
()

228 
time
.
	$¦“p
(0.2)

230 #Th
ÿÎback
 
m‘hod
 
MUST
 
wa™
 
the
 
STARTED
 
¡©e
.

231 
£lf
.
	$as£¹Equ®
(
b
.
¡©e
, b.
¡©es
.
STARTED
)

232 #Th
ÿÎback
 
m‘hod
 
MUST
 
run
 
aá”
 
®l
 
¡¬t
 
m‘hods
.

233 
£lf
.
	`as£¹Equ®
(
ev’ts
, ["g", ("f", (1, 3, 5), {"foo": "b¬"
	}
})])

234 
fš®ly
:

235 
b
.
	$ex™
()

237 
def
 
	$‹¡_log
(
£lf
):

238 
b
 = 
w¥bus
.
	$Bus
()

239 
£lf
.
	$log
(
b
)

240 
£lf
.
	$as£¹Log
([])

242 #Try 
a
 
nÜm®
 
mes§ge
.

243 
ex³ùed
 = []

244 
msg
 
š
 ["O mah darlin'"] * 3 + ["Clementiiiiiiiine"]:

245 
b
.
	$log
(
msg
)

246 
ex³ùed
.
	$­³nd
(
msg
)

247 
£lf
.
	$as£¹Log
(
ex³ùed
)

249 #Try 
ª
 
”rÜ
 
mes§ge


250 
Œy
:

251 
foo


252 
exû±
 
NameE¼Ü
:

253 
b
.
	`log
("You‡»†o¡‡nd gÚfÜev”", 
Œaûback
=
True
)

254 
Ï¡msg
 = 
£lf
.
_log_’Œ›s
[-1]

255 "T¿ûback" 
nÙ
 
š
 
Ï¡msg
 
Ü
 "NameError"‚ot in†astmsg:

256 
£lf
.
	`ç
("Last†og message %r did‚ot contain "

257 "thex³ùed¿ûback." % 
Ï¡msg
)

259 
£lf
.
	`ç
("NameError was‚ot„aised‡sƒxpected.")

262 
__Çme__
 == "__main__":

263 
un™‹¡
.
	`maš
()

	@trunk/objs/CherryPy-3.2.4/cherrypy/test/test_caching.py

1 
impÜt
 
d©‘ime


2 
impÜt
 
gz


3 
äom
 
™”toŞs
 
impÜt
 
couÁ


4 
impÜt
 
os


5 
	gcurdœ
 = 
os
.
·th
.
još
(os.
g‘cwd
(), os.·th.
	$dœÇme
(
__fe__
))

6 
impÜt
 
sys


7 
impÜt
 
th»adšg


8 
impÜt
 
time


9 
impÜt
 
u¾lib


11 
impÜt
 
ch”rypy


12 
äom
 
ch”rypy
.
_ıcom·t
 
impÜt
 
Ãxt
, 
Áob
, 
quÙe
, 
x¿nge


13 
äom
 
ch”rypy
.
lib
 
impÜt
 
h‰put


15 
gif_by‹s
 = 
	`Áob
('GIF89a\x01\x00\x01\x00\x82\x00\x01\x99"\x1e\x00\x00\x00\x00\x00'

21 
äom
 
ch”rypy
.
‹¡
 
impÜt
 
h–³r


23 
şass
 
	$CacheTe¡
(
h–³r
.
CPWebCa£
):

25 
def
 
	$£tup_£rv”
():

27 
şass
 
RoÙ
:

29 
_ı_cÚfig
 = {'toŞs.ÿchšg.Ú': 
True
}

31 
def
 
	$__š™__
(
£lf
):

32 
£lf
.
couÁ”
 = 0

33 
£lf
.
cÚŒŞ_couÁ”
 = 0

34 
£lf
.
lÚglock
 = 
th»adšg
.
	$Lock
()

36 
def
 
	$šdex
(
£lf
):

37 
£lf
.
couÁ”
 += 1

38 
msg
 = "vis™ #%s" % 
£lf
.
couÁ”


39  
msg


40 
šdex
.
expo£d
 = 
True


42 
def
 
	$cÚŒŞ
(
£lf
):

43 
£lf
.
cÚŒŞ_couÁ”
 += 1

44  "vis™ #%s" % 
£lf
.
cÚŒŞ_couÁ”


45 
cÚŒŞ
.
expo£d
 = 
True


47 
def
 
	$a_gif
(
£lf
):

48 
ch”rypy
.
»¥Ú£
.
h—d”s
['La¡-Modif›d'] = 
h‰put
.
	$HTTPD©e
()

49  
gif_by‹s


50 
a_gif
.
expo£d
 = 
True


52 
def
 
	`lÚg_´oûss
(
£lf
, 
£cÚds
='1'):

53 
Œy
:

54 
£lf
.
lÚglock
.
	$acquœe
()

55 
time
.
	`¦“p
((
£cÚds
))

56 
fš®ly
:

57 
£lf
.
lÚglock
.
	$»Ëa£
()

59 
lÚg_´oûss
.
expo£d
 = 
True


61 
def
 
	$ş—r_ÿche
(
£lf
, 
·th
):

62 
ch”rypy
.
_ÿche
.
¡Üe
[ch”rypy.
»que¡
.
ba£
 + 
·th
].
	$ş—r
()

63 
ş—r_ÿche
.
expo£d
 = 
True


65 
şass
 
	$V¬yH—d”CachšgS”v”
(
objeù
):

67 
_ı_cÚfig
 = {'toŞs.ÿchšg.Ú': 
True
,

68 'toŞs.»¥Ú£_h—d”s.Ú': 
True
,

70 
	}
}

72 
def
 
	$__š™__
(
£lf
):

73 
£lf
.
couÁ”
 = 
	$couÁ
(1)

75 
def
 
	$šdex
(
£lf
):

76  "vis™ #%s" % 
	$Ãxt
(
£lf
.
couÁ”
)

77 
šdex
.
expo£d
 = 
True


79 
şass
 
	$UnCached
(
objeù
):

80 
_ı_cÚfig
 = {'toŞs.expœes.Ú': 
True
,

82 'toŞs.¡©icdœ.Ú': 
True
,

84 'toŞs.¡©icdœ.roÙ': 
curdœ
,

85 
	}
}

87 
def
 
	$fÜû
(
£lf
):

88 
ch”rypy
.
»¥Ú£
.
h—d”s
['Etag'] = 'bibbitybobbityboo'

89 
£lf
.
_ı_cÚfig
['toŞs.expœes.fÜû'] = 
True


90 
£lf
.
_ı_cÚfig
['tools.expires.secs'] = 0

92 
fÜû
.
expo£d
 = 
True


93 
fÜû
.
_ı_cÚfig
 = {'toŞs.expœes.£cs': 0
	}
}

95 
def
 
	$dyÇmic
(
£lf
):

96 
ch”rypy
.
»¥Ú£
.
h—d”s
['Etag'] = 'bibbitybobbityboo'

97 
ch”rypy
.
»¥Ú£
.
h—d”s
['Cache-Control'] = 'private'

99 
dyÇmic
.
expo£d
 = 
True


101 
def
 
	$ÿch—bË
(
£lf
):

102 
ch”rypy
.
»¥Ú£
.
h—d”s
['Etag'] = 'bibbitybobbityboo'

104 
ÿch—bË
.
expo£d
 = 
True


106 
def
 
	$¥ecific
(
£lf
):

107 
ch”rypy
.
»¥Ú£
.
h—d”s
['Etag'] = 'need_this_to_make_me_cacheable'

109 
¥ecific
.
expo£d
 = 
True


110 
¥ecific
.
_ı_cÚfig
 = {'toŞs.expœes.£cs': 86400
	}
}

112 
şass
 
	$Foo
(
objeù
):
·ss


114 
def
 
	$wrÚgty³
(
£lf
):

115 
ch”rypy
.
»¥Ú£
.
h—d”s
['Etag'] = 'need_this_to_make_me_cacheable'

117 
wrÚgty³
.
expo£d
 = 
True


118 
wrÚgty³
.
_ı_cÚfig
 = {'toŞs.expœes.£cs': 
	`Foo
()
	}
}

120 
ch”rypy
.
Œ“
.
mouÁ
(
	$RoÙ
())

121 
ch”rypy
.
Œ“
.
	`mouÁ
(
	`UnCached
(), "/expires")

122 
ch”rypy
.
Œ“
.
	`mouÁ
(
	`V¬yH—d”CachšgS”v”
(), "/varying_headers")

123 
ch”rypy
.
cÚfig
.
	`upd©e
({'toŞs.gz.Ú': 
True
})

124 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

126 
def
 
	$‹¡Cachšg
(
£lf
):

127 
–­£d
 = 0.0

128 
ŒŸl
 
š
 
	$¿nge
(10):

129 
£lf
.
	`g‘Page
("/")

130 #Th
»¥Ú£
 
should
 
be
 
the
 
§me
 
ev”y
 
time
,

131 #exû± 
the
 
Age
 
»¥Ú£
 
h—d”
.

132 
£lf
.
	`as£¹Body
('visit #1')

133 
ŒŸl
 != 0:

134 
age
 = (
£lf
.
	`as£¹H—d”
("Age"))

135 
£lf
.
	`as£¹_
(
age
 >ğ
–­£d
)

136 
–­£d
 = 
age


138 #POST, 
PUT
, 
DELETE
 
should
 
nÙ
 
be
 
ÿched
.

139 
£lf
.
	`g‘Page
("/", 
m‘hod
="POST")

140 
£lf
.
	`as£¹Body
('visit #2')

141 #Beÿu£ 
gz
 
is
 
tuºed
 
Ú
, 
the
 
V¬y
 
h—d”
 
should
 
®ways
 V¬y 
cÚ‹Á
-
’codšg


142 
£lf
.
	`as£¹H—d”
('Vary', 'Accept-Encoding')

143 #Th
´evious
 
»que¡
 
should
 
have
 
šv®id©ed
 
the
 
ÿche
,

144 #sØ
this
 
»que¡
 
wl
 
»ÿlc
 
the
 
»¥Ú£
.

145 
£lf
.
	`g‘Page
("/", 
m‘hod
="GET")

146 
£lf
.
	`as£¹Body
('visit #3')

147 #...
but
 
this
 
»que¡
 
should
 
g‘
 
the
 
ÿched
 
cİy
.

148 
£lf
.
	`g‘Page
("/", 
m‘hod
="GET")

149 
£lf
.
	`as£¹Body
('visit #3')

150 
£lf
.
	`g‘Page
("/", 
m‘hod
="DELETE")

151 
£lf
.
	`as£¹Body
('visit #4')

153 #Th
´evious
 
»que¡
 
should
 
have
 
šv®id©ed
 
the
 
ÿche
,

154 #sØ
this
 
»que¡
 
wl
 
»ÿlc
 
the
 
»¥Ú£
.

155 
£lf
.
	`g‘Page
("/", 
m‘hod
="GET", 
h—d”s
=[('Accept-Encoding', 'gzip')])

156 
£lf
.
	`as£¹H—d”
('Content-Encoding', 'gzip')

157 
£lf
.
	`as£¹H—d”
('Vary')

158 
£lf
.
	`as£¹Equ®
(
ch”rypy
.
lib
.
’codšg
.
	`decom´ess
(£lf.
body
), 
	`Áob
("visit #5"))

160 #Now 
check
 
th©
 
a
 
£cÚd
 
»que¡
 
g‘s
 
the
 
gz
 
h—d”
 
ªd
 
gz³d
 
body


161 #Thi 
®so
 
‹¡s
 
a
 
bug
 
š
 3.0 
to
 3.0.2 
wh”eby
 
the
 
ÿched
, 
gz³d


162 #»¥Ú£ 
body
 
was
 
bešg
 
gz³d
 
a
 
£cÚd
 
time
.

163 
£lf
.
	`g‘Page
("/", 
m‘hod
="GET", 
h—d”s
=[('Accept-Encoding', 'gzip')])

164 
£lf
.
	`as£¹H—d”
('Content-Encoding', 'gzip')

165 
£lf
.
	`as£¹Equ®
(
ch”rypy
.
lib
.
’codšg
.
	`decom´ess
(£lf.
body
), 
	`Áob
("visit #5"))

167 #Now 
check
 
th©
 
a
 
thœd
 
»que¡
h© 
dÛ¢
't‡ccept gzip

168 #sk 
the
 
	`ÿche
 (
beÿu£
h'V¬y' 
h—d”
 
d’›s
 
™
).

169 
£lf
.
	`g‘Page
("/", 
m‘hod
="GET")

170 
£lf
.
	`as£¹NoH—d”
('Content-Encoding')

171 
£lf
.
	`as£¹Body
('visit #6')

173 
def
 
	$‹¡V¬yH—d”
(
£lf
):

174 
£lf
.
	`g‘Page
("/varying_headers/")

175 
£lf
.
	`as£¹Stus
("200 OK")

176 
£lf
.
	`as£¹H—d”I‹mV®ue
('Vary', 'Our-Varying-Header')

177 
£lf
.
	`as£¹Body
('visit #1')

179 #Now 
check
 
th©
 
difã»Á
 'V¬y'-
f›lds
 
dÚ
'tƒvictƒach other.

180 #Thi 
‹¡
 
ü—‹s
 2 
»que¡s
 
w™h
 
difã»Á
 'Our-Varying-Header'

181 #ªd 
th’
 
‹¡s
 
the
 
fœ¡
 
Úe
 
¡l
 
exi¡s
.

182 
£lf
.
	`g‘Page
("/v¬yšg_h—d”s/", 
h—d”s
=[('Our-Varying-Header', 'request 2')])

183 
£lf
.
	`as£¹Stus
("200 OK")

184 
£lf
.
	`as£¹Body
('visit #2')

186 
£lf
.
	`g‘Page
("/v¬yšg_h—d”s/", 
h—d”s
=[('Our-Varying-Header', 'request 2')])

187 
£lf
.
	`as£¹Stus
("200 OK")

188 
£lf
.
	`as£¹Body
('visit #2')

190 
£lf
.
	`g‘Page
("/varying_headers/")

191 
£lf
.
	`as£¹Stus
("200 OK")

192 
£lf
.
	`as£¹Body
('visit #1')

194 
def
 
	$‹¡ExpœesToŞ
(
£lf
):

195 #‹¡ 
£‰šg
 
ª
 
expœes
 
h—d”


196 
£lf
.
	`g‘Page
("/expires/specific")

197 
£lf
.
	`as£¹Stus
("200 OK")

198 
£lf
.
	`as£¹H—d”
("Expires")

200 #‹¡ 
exû±iÚs
 
bad
 
time
 
v®ues


201 
£lf
.
	`g‘Page
("/expires/wrongtype")

202 
£lf
.
	$as£¹Stus
(500)

203 
£lf
.
	`as£¹InBody
("TypeError")

205 #¡©iø
cÚ‹Á
 
should
 
nÙ
 
have
 "ÿch´ev’tiÚ" 
h—d”s


206 
£lf
.
	`g‘Page
("/expires/index.html")

207 
£lf
.
	`as£¹Stus
("200 OK")

208 
£lf
.
	`as£¹NoH—d”
("Pragma")

209 
£lf
.
	`as£¹NoH—d”
("Cache-Control")

210 
£lf
.
	`as£¹H—d”
("Expires")

212 #dyÇmiø
cÚ‹Á
 
th©
 
£ts
 
šdiÿtÜs
 
should
 
nÙ
 
have


213 #"
ÿche
 
´ev’tiÚ
" headers

214 
£lf
.
	`g‘Page
("/expires/cacheable")

215 
£lf
.
	`as£¹Stus
("200 OK")

216 
£lf
.
	`as£¹NoH—d”
("Pragma")

217 
£lf
.
	`as£¹NoH—d”
("Cache-Control")

218 
£lf
.
	`as£¹H—d”
("Expires")

220 
£lf
.
	`g‘Page
('/expires/dynamic')

221 
£lf
.
	`as£¹Body
("D-d-d-dynamic!")

222 #th
Cache
-
CÚŒŞ
 
h—d”
 
should
 
be
 
uÁouched


223 
£lf
.
	`as£¹H—d”
("Cache-Control", "private")

224 
£lf
.
	`as£¹H—d”
("Expires")

226 #cÚfigu» 
the
 
toŞ
 
to
 
ignÜe
 
šdiÿtÜs
 
ªd
 
»¶aû
 
exi¡šg
 
h—d”s


227 
£lf
.
	`g‘Page
("/expires/force")

228 
£lf
.
	`as£¹Stus
("200 OK")

229 #Thi 
®so
 
gives
 
us
 
a
 
chªû
 
to
 
‹¡
 0 
expœy
 
w™h
 
no
 
Ùh”
 
h—d”s


230 
£lf
.
	`as£¹H—d”
("Pragma", "no-cache")

231 
ch”rypy
.
£rv”
.
´ÙocŞ_v”siÚ
 == "HTTP/1.1":

232 
£lf
.
	`as£¹H—d”
("Cache-Control", "no-cache, must-revalidate")

233 
£lf
.
	`as£¹H—d”
("Expires", "Sun, 28 Jan 2007 00:00:00 GMT")

235 #¡©iø
cÚ‹Á
 
should
 
now
 
have
 "ÿch´ev’tiÚ" 
h—d”s


236 
£lf
.
	`g‘Page
("/expires/index.html")

237 
£lf
.
	`as£¹Stus
("200 OK")

238 
£lf
.
	`as£¹H—d”
("Pragma", "no-cache")

239 
ch”rypy
.
£rv”
.
´ÙocŞ_v”siÚ
 == "HTTP/1.1":

240 
£lf
.
	`as£¹H—d”
("Cache-Control", "no-cache, must-revalidate")

241 
£lf
.
	`as£¹H—d”
("Expires", "Sun, 28 Jan 2007 00:00:00 GMT")

243 #th
ÿch—bË
 
hªdËr
 
should
 
now
 
have
 "ÿch´ev’tiÚ" 
h—d”s


244 
£lf
.
	`g‘Page
("/expires/cacheable")

245 
£lf
.
	`as£¹Stus
("200 OK")

246 
£lf
.
	`as£¹H—d”
("Pragma", "no-cache")

247 
ch”rypy
.
£rv”
.
´ÙocŞ_v”siÚ
 == "HTTP/1.1":

248 
£lf
.
	`as£¹H—d”
("Cache-Control", "no-cache, must-revalidate")

249 
£lf
.
	`as£¹H—d”
("Expires", "Sun, 28 Jan 2007 00:00:00 GMT")

251 
£lf
.
	`g‘Page
('/expires/dynamic')

252 
£lf
.
	`as£¹Body
("D-d-d-dynamic!")

253 #dyÇmiø
£ts
 
Cache
-
CÚŒŞ
 
to
 
´iv©e
 
but
 
™
 
should
 
be


254 #ov”wr™‹À
h”e
 ...

255 
£lf
.
	`as£¹H—d”
("Pragma", "no-cache")

256 
ch”rypy
.
£rv”
.
´ÙocŞ_v”siÚ
 == "HTTP/1.1":

257 
£lf
.
	`as£¹H—d”
("Cache-Control", "no-cache, must-revalidate")

258 
£lf
.
	`as£¹H—d”
("Expires", "Sun, 28 Jan 2007 00:00:00 GMT")

260 
def
 
	$‹¡La¡Modif›d
(
£lf
):

261 
£lf
.
	`g‘Page
("/a.gif")

262 
£lf
.
	$as£¹Stus
(200)

263 
£lf
.
	$as£¹Body
(
gif_by‹s
)

264 
lm1
 = 
£lf
.
	`as£¹H—d”
("Last-Modified")

266 #thi 
»que¡
 
should
 
g‘
 
the
 
ÿched
 
cİy
.

267 
£lf
.
	`g‘Page
("/a.gif")

268 
£lf
.
	$as£¹Stus
(200)

269 
£lf
.
	$as£¹Body
(
gif_by‹s
)

270 
£lf
.
	`as£¹H—d”
("Age")

271 
lm2
 = 
£lf
.
	`as£¹H—d”
("Last-Modified")

272 
£lf
.
	$as£¹Equ®
(
lm1
, 
lm2
)

274 #thi 
»que¡
 
should
 
m©ch
 
the
 
ÿched
 
cİy
, 
but
 
¿i£
 304.

275 
£lf
.
	`g‘Page
("/a.gif", [('If-Modif›d-Sšû', 
lm1
)])

276 
£lf
.
	$as£¹Stus
(304)

277 
£lf
.
	`as£¹NoH—d”
("Last-Modified")

278 
nÙ
 
	`g‘©Œ
(
ch”rypy
.
£rv”
, "usšg_­ache", 
F®£
):

279 
£lf
.
	`as£¹H—d”
("Age")

281 
def
 
	$‹¡_ªti¡am³de
(
£lf
):

282 
SECONDS
 = 4

283 #W
MUST
 
make
 
ª
 
š™Ÿl
 
synchrÚous
 
»que¡
 
š
 
Üd”
 
to
 
ü—‹
 
the


284 #AÁiSm³deCach
objeù
, 
ªd
 
pİuÏ‹
 
™s
 
£Ëùšg_h—d”s
,

285 #befÜ
the
 
aùu®
 
¡am³de
.

286 
£lf
.
	`g‘Page
("/lÚg_´oûss?£cÚds=%d" % 
SECONDS
)

287 
£lf
.
	`as£¹Body
('success!')

288 
£lf
.
	`g‘Page
("/clear_cache?path=" +

289 
	`quÙe
('/lÚg_´oûss?£cÚds=%d' % 
SECONDS
, 
§ã
=''))

290 
£lf
.
	$as£¹Stus
(200)

292 
¡¬t
 = 
d©‘ime
.d©‘ime.
	$now
()

293 
def
 
	$run
():

294 
£lf
.
	`g‘Page
("/lÚg_´oûss?£cÚds=%d" % 
SECONDS
)

295 #Th
»¥Ú£
 
should
 
be
 
the
 
§me
 
ev”y
 
time


296 
£lf
.
	`as£¹Body
('success!')

297 
ts
 = [
th»adšg
.
	$Th»ad
(
rg‘
=
run
è
i
 
š
 
	`x¿nge
(100)]

298 
t
 
š
 
ts
:

299 
t
.
	$¡¬t
()

300 
t
 
š
 
ts
:

301 
t
.
	$još
()

302 
£lf
.
	`as£¹Equ®D©es
(
¡¬t
, 
d©‘ime
.d©‘ime.
	`now
(),

303 #AÎow 
a
 
	`£cÚd
 (
two
, 
¦ow
 
ho¡s
)

304 #fÜ 
our
 
th»ad
/
TCP
 
ov”h—d
 
‘c
.

305 
£cÚds
=
SECONDS
 + 2)

307 
def
 
	$‹¡_ÿche_cÚŒŞ
(
£lf
):

308 
£lf
.
	`g‘Page
("/control")

309 
£lf
.
	`as£¹Body
('visit #1')

310 
£lf
.
	`g‘Page
("/control")

311 
£lf
.
	`as£¹Body
('visit #1')

313 
£lf
.
	`g‘Page
("/cÚŒŞ", 
h—d”s
=[('Cache-Control', 'no-cache')])

314 
£lf
.
	`as£¹Body
('visit #2')

315 
£lf
.
	`g‘Page
("/control")

316 
£lf
.
	`as£¹Body
('visit #2')

318 
£lf
.
	`g‘Page
("/cÚŒŞ", 
h—d”s
=[('Pragma', 'no-cache')])

319 
£lf
.
	`as£¹Body
('visit #3')

320 
£lf
.
	`g‘Page
("/control")

321 
£lf
.
	`as£¹Body
('visit #3')

323 
time
.
	$¦“p
(1)

324 
£lf
.
	`g‘Page
("/cÚŒŞ", 
h—d”s
=[('Cache-Control', 'max-age=0')])

325 
£lf
.
	`as£¹Body
('visit #4')

326 
£lf
.
	`g‘Page
("/control")

327 
£lf
.
	`as£¹Body
('visit #4')

	@trunk/objs/CherryPy-3.2.4/cherrypy/test/test_compat.py

1 
impÜt
 
un™‹¡


3 
impÜt
 
no£


5 
äom
 
ch”rypy
 
impÜt
 
_ıcom·t
 
as
 
com·t


7 
şass
 
	$SŒšgTe¡”
(
un™‹¡
.
Te¡Ca£
):

8 
def
 
	$‹¡_Áob_nÚ_Çtive
(
£lf
):

10 
Áob
 
should
 
¿i£
 
ª
 
Exû±iÚ
 
Ú
 
unicode
.

11 (
PythÚ
 2 
Úly
)

13 
S“
 #1132 
discussiÚ
.

15 
com·t
.
py3k
:

16 
¿i£
 
no£
.
	`SkTe¡
("Only useful on Python 2")

17 
£lf
.
	`as£¹Rai£s
(
Exû±iÚ
, 
com·t
.
Áob
, 
	`unicode
('fight'))

	@trunk/objs/CherryPy-3.2.4/cherrypy/test/test_config.py

3 
impÜt
 
	gos
, 
sys


4 
	gloÿlDœ
 = 
os
.
·th
.
još
(os.
g‘cwd
(), os.·th.
	$dœÇme
(
__fe__
))

6 
äom
 
ch”rypy
.
_ıcom·t
 
impÜt
 
Áob
, 
SŒšgIO


7 
impÜt
 
un™‹¡


9 
impÜt
 
ch”rypy


11 
def
 
	$£tup_£rv”
():

13 
şass
 
RoÙ
:

15 
_ı_cÚfig
 = {'foo': 'this',

16 'b¬': 'th©'
	}
}

18 
def
 
	$__š™__
(
£lf
):

19 
ch”rypy
.
cÚfig
.
Çme¥aûs
['db'] = 
£lf
.
db_Çme¥aû


21 
def
 
	$db_Çme¥aû
(
£lf
, 
k
, 
v
):

22 
k
 == "scheme":

23 
£lf
.
db
 = 
v


25 #@
ch”rypy
.
	`expo£
(
®Ÿs
=('global_', 'xyz'))

26 
def
 
	$šdex
(
£lf
, 
key
):

27  
ch”rypy
.
»que¡
.
cÚfig
.
	`g‘
(
key
, "None")

28 
šdex
 = 
ch”rypy
.
	`expo£
(šdex, 
®Ÿs
=('global_', 'xyz'))

30 
def
 
	$»´
(
£lf
, 
key
):

31  
	`»´
(
ch”rypy
.
»que¡
.
cÚfig
.
	$g‘
(
key
, 
NÚe
))

32 
»´
.
expo£d
 = 
True


34 
def
 
	$dbscheme
(
£lf
):

35  
£lf
.
db


36 
dbscheme
.
expo£d
 = 
True


38 
def
 
	$¶aš
(
£lf
, 
x
):

39  
x


40 
¶aš
.
expo£d
 = 
True


41 
¶aš
.
_ı_cÚfig
 = {'»que¡.body.©‹m±_ch¬£ts': ['utf-16']
	}
}

43 
çvicÚ_ico
 = 
ch”rypy
.
toŞs
.
¡©icfe
.
hªdËr
(

44 
f’ame
=
os
.
·th
.
još
(
loÿlDœ
, '../favicon.ico'))

46 
şass
 
	gFoo
:

48 
_ı_cÚfig
 = {'foo': 'this2',

51 
def
 
	$šdex
(
£lf
, 
key
):

52  
ch”rypy
.
»que¡
.
cÚfig
.
	`g‘
(
key
, "None")

53 
šdex
.
expo£d
 = 
True


54 
Ãx
 = 
šdex


56 
def
 
	$sly
(
£lf
):

58 
sly
.
expo£d
 = 
True


59 
sly
.
_ı_cÚfig
 = {'»¥Ú£.h—d”s.X-sly': 'slyv®'
	}
}

61 #Te¡ 
the
 
expo£
 
ªd
 
cÚfig
 
decÜ©Üs


62 #@
ch”rypy
.
expo£


63 #@
ch”rypy
.
cÚfig
(
foo
='this3', **{'bax': 'this4'})

64 
def
 
	$b¬
(
£lf
, 
key
):

65  
	`»´
(
ch”rypy
.
»que¡
.
cÚfig
.
	$g‘
(
key
, 
NÚe
))

66 
b¬
.
expo£d
 = 
True


67 
b¬
.
_ı_cÚfig
 = {'foo': 'this3', 'bax': 'this4'
	}
}

69 
şass
 
AnÙh”
:

71 
def
 
	$šdex
(
£lf
, 
key
):

72  
	`¡r
(
ch”rypy
.
»que¡
.
cÚfig
.
	`g‘
(
key
, "None"))

73 
šdex
.
expo£d
 = 
True


76 
def
 
	$¿w_Çme¥aû
(
key
, 
v®ue
):

77 
key
 == 'input.map':

78 
hªdËr
 = 
ch”rypy
.
»que¡
.handler

79 
def
 
	$w¿µ”
():

80 
·¿ms
 = 
ch”rypy
.
»que¡
.params

81 
Çme
, 
cÛrûr
 
š
 
	`li¡
(
v®ue
.
	$™ems
()):

82 
Œy
:

83 
·¿ms
[
Çme
] = 
	$cÛrûr
(
·¿ms
[
Çme
])

84 
exû±
 
KeyE¼Ü
:

85 
·ss


86  
	$hªdËr
()

87 
ch”rypy
.
»que¡
.
hªdËr
 = 
w¿µ”


88 
–if
 
key
 == 'output':

89 
hªdËr
 = 
ch”rypy
.
»que¡
.handler

90 
def
 
	$w¿µ”
():

91 #'
v®ue
' is‡ype (like int or str).

92  
	`v®ue
(
	$hªdËr
())

93 
ch”rypy
.
»que¡
.
hªdËr
 = 
w¿µ”


95 
şass
 
Raw
:

97 
_ı_cÚfig
 = {'¿w.ouut': 
»´
}

99 
def
 
	$šü
(
£lf
, 
num
):

100  
num
 + 1

101 
šü
.
expo£d
 = 
True


102 
šü
.
_ı_cÚfig
 = {'¿w.šput.m­': {'num': }
	}
}

104 
iocÚf
 = 
SŒšgIO
("""

106 
Ãg
: -1234

107 
f’ame
: 
os
.
·th
.
još
(
sys
.
´efix
, "hello.py")

108 
thšg1
: 
ch”rypy
.
lib
.
h‰put
.
»¥Ú£_codes
[404]

109 
thšg2
: 
__impÜt__
('ch”rypy.tutÜŸl', 
glob®s
(), 
loÿls
(), ['']).thing2

110 
com¶ex
: 3+2
j


111 
mul
: 6*3

112 
Úes
: "11"

113 
twos
: "22"

114 
¡¿dd
: %%(
Úes
)
s
 + %%(
twos
)s + "33"

116 [/
çvicÚ
.
ico
]

117 
toŞs
.
¡©icfe
.
f’ame
 = %
r


120 
roÙ
 = 
	$RoÙ
()

121 
roÙ
.
foo
 = 
	$Foo
()

122 
roÙ
.
¿w
 = 
	$Raw
()

123 
­p
 = 
ch”rypy
.
Œ“
.
	$mouÁ
(
roÙ
, 
cÚfig
=
iocÚf
)

124 
­p
.
»que¡_şass
.
Çme¥aûs
['¿w'] = 
¿w_Çme¥aû


126 
ch”rypy
.
Œ“
.
	`mouÁ
(
	`AnÙh”
(), "/another")

127 
ch”rypy
.
cÚfig
.
	`upd©e
({'luxuryyacht': 'throatwobblermangrove',

128 'db.scheme': 
r
"sqlite///memory",

129 
	}
})

132 #Cl›Á-
side
 
code
 #


133 
äom
 
ch”rypy
.
‹¡
 
impÜt
 
h–³r


135 
şass
 
	$CÚfigTe¡s
(
h–³r
.
CPWebCa£
):

136 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

138 
def
 
	$‹¡CÚfig
(
£lf
):

139 
‹¡s
 = [

149 #Ià'foo' =ğ'this', 
th’
 
the
 
mouÁ
 
pošt
 '/ªÙh”' 
Ëaks
 
što
 '/'.

152 
·th
, 
key
, 
ex³ùed
 
š
 
‹¡s
:

153 
£lf
.
	`g‘Page
(
·th
 + "?key=" + 
key
)

154 
£lf
.
	$as£¹Body
(
ex³ùed
)

156 
ex³ùedcÚf
 = {

157 #From 
CP
 
deçuÉs


158 'toŞs.log_h—d”s.Ú': 
F®£
,

159 'toŞs.log_Œaûbacks.Ú': 
True
,

160 '»que¡.show_Œaûbacks': 
True
,

161 'log.sü“n': 
F®£
,

163 '’gše.autÜ–ßd_Ú': 
F®£
,

164 #From 
glob®
 
cÚfig


166 #From 
RoÙ
.
_ı_cÚfig


168 #From 
Foo
.
_ı_cÚfig


170 #From 
Foo
.
b¬
.
_ı_cÚfig


173 
	}
}

174 
key
, 
ex³ùed
 
š
 
ex³ùedcÚf
.
	$™ems
():

175 
£lf
.
	`g‘Page
("/foo/b¬?key=" + 
key
)

176 
£lf
.
	`as£¹Body
(
	$»´
(
ex³ùed
))

178 
def
 
	$‹¡UÄ•r
(
£lf
):

179 
£lf
.
	`g‘Page
("/repr?key=neg")

180 
£lf
.
	`as£¹Body
("-1234")

182 
£lf
.
	`g‘Page
("/repr?key=filename")

183 
£lf
.
	`as£¹Body
(
	`»´
(
os
.
·th
.
	`još
(
sys
.
´efix
, "hello.py")))

185 
£lf
.
	`g‘Page
("/repr?key=thing1")

186 
£lf
.
	`as£¹Body
(
	$»´
(
ch”rypy
.
lib
.
h‰put
.
»¥Ú£_codes
[404]))

188 
nÙ
 
	`g‘©Œ
(
ch”rypy
.
£rv”
, "usšg_­ache", 
F®£
):

189 #Th
objeù
 
ID
' wÚ'
t
 
m©ch
 
up
 
wh’
 
usšg
 
A·che
, 
sšû
 
the


190 #£rv” 
ªd
 
ş›Á
 
¬e
 
ruÂšg
 
š
 
difã»Á
 
´oûs£s
.

191 
£lf
.
	`g‘Page
("/repr?key=thing2")

192 
äom
 
ch”rypy
.
tutÜŸl
 
impÜt
 
thšg2


193 
£lf
.
	`as£¹Body
(
	$»´
(
thšg2
))

195 
£lf
.
	`g‘Page
("/repr?key=complex")

196 
£lf
.
	`as£¹Body
("(3+2j)")

198 
£lf
.
	`g‘Page
("/repr?key=mul")

199 
£lf
.
	`as£¹Body
("18")

201 
£lf
.
	`g‘Page
("/repr?key=stradd")

202 
£lf
.
	`as£¹Body
(
	`»´
("112233"))

204 
def
 
	$‹¡Re¥Name¥aûs
(
£lf
):

205 
£lf
.
	`g‘Page
("/foo/silly")

206 
£lf
.
	`as£¹H—d”
('X-silly', 'sillyval')

207 
£lf
.
	`as£¹Body
('Hello world')

209 
def
 
	$‹¡Cu¡omName¥aûs
(
£lf
):

210 
£lf
.
	`g‘Page
("/raw/incr?num=12")

211 
£lf
.
	`as£¹Body
("13")

213 
£lf
.
	`g‘Page
("/dbscheme")

214 
£lf
.
	`as£¹Body
(
r
"sqlite///memory")

216 
def
 
	$‹¡HªdËrToŞCÚfigOv”ride
(
£lf
):

217 #As£¹ 
th©
 
cÚfig
 
ov”rides
 
toŞ
 
cÚ¡ruùÜ
 
¬gs
. 
Above
, 
we
 
£t


218 #th
çvicÚ
 
š
 
the
 
·ge
 
hªdËr
 
to
 
be
 '../favicon.ico',

219 #buˆ
th’
 
ov”rode
 
™
 
š
 
cÚfig
 
to
 
be
 './static/dirback.jpg'.

220 
£lf
.
	`g‘Page
("/favicon.ico")

221 
£lf
.
	`as£¹Body
(
	`İ’
(
os
.
·th
.
	`još
(
loÿlDœ
, "static/dirback.jpg"),

222 "rb").
	$»ad
())

224 
def
 
	$‹¡_»que¡_body_Çme¥aû
(
£lf
):

225 
£lf
.
	`g‘Page
("/¶aš", 
m‘hod
='POST', 
h—d”s
=[

228 
body
=
	`Áob
('\xff\xfex\x00=\xff\xfea\x00b\x00c\x00'))

229 
£lf
.
	`as£¹Body
("abc")

232 
şass
 
	$V¬ŸbËSub¡™utiÚTe¡s
(
un™‹¡
.
Te¡Ca£
):

233 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

235 
def
 
	$‹¡_cÚfig
(
£lf
):

236 
äom
 
‹xtw¿p
 
impÜt
 
ded’t


238 #v¬ŸbË 
sub¡™utiÚ
 
w™h
 [
DEFAULT
]

239 
cÚf
 = 
	`ded’t
("""

240 [
DEFAULT
]

241 
dœ
 = "/some/dir"

242 
my
.
dœ
 = %(dœ)
s
 + "/sub"

244 [
my
]

245 
my
.
dœ
 = %(dœ)
s
 + "/my/dir"

246 
my
.
dœ2
 = %(my.
dœ
)
s
 + '/dir2'

250 
å
 = 
	$SŒšgIO
(
cÚf
)

252 
ch”rypy
.
cÚfig
.
	$upd©e
(
å
)

253 
£lf
.
	`as£¹Equ®
(
ch”rypy
.
cÚfig
["my"]["my.dir"], "/some/dir/my/dir")

254 
£lf
.
	`as£¹Equ®
(
ch”rypy
.
cÚfig
["my"]["my.dir2"], "/some/dir/my/dir/dir2")

	@trunk/objs/CherryPy-3.2.4/cherrypy/test/test_config_server.py

3 
impÜt
 
	gos
, 
sys


4 
	gloÿlDœ
 = 
os
.
·th
.
još
(os.
g‘cwd
(), os.·th.
	$dœÇme
(
__fe__
))

5 
impÜt
 
sock‘


6 
impÜt
 
time


8 
impÜt
 
ch”rypy


11 #Cl›Á-
side
 
code
 #


12 
äom
 
ch”rypy
.
‹¡
 
impÜt
 
h–³r


14 
şass
 
	$S”v”CÚfigTe¡s
(
h–³r
.
CPWebCa£
):

16 
def
 
	$£tup_£rv”
():

18 
şass
 
RoÙ
:

19 
def
 
	$šdex
(
£lf
):

20  
ch”rypy
.
»que¡
.
wsgi_’vœÚ
['SERVER_PORT']

21 
šdex
.
expo£d
 = 
True


23 
def
 
	$u¶ßd
(
£lf
, 
fe
):

24  "Size: %s" % 
	`Ën
(
fe
.fe.
	$»ad
())

25 
u¶ßd
.
expo£d
 = 
True


27 
def
 
	$tšyu¶ßd
(
£lf
):

28  
ch”rypy
.
»que¡
.
body
.
	$»ad
()

29 
tšyu¶ßd
.
expo£d
 = 
True


30 
tšyu¶ßd
.
_ı_cÚfig
 = {'»que¡.body.maxby‹s': 100
	}
}

32 
ch”rypy
.
Œ“
.
mouÁ
(
	$RoÙ
())

34 
ch”rypy
.
cÚfig
.
	`upd©e
({

41 #Te¡ 
ex¶ic™
 
£rv”
.
š¡ªû


45 #Te¡ 
nÚ
-
num”ic
 <
£rv”Çme
>

46 #AlsØ
‹¡
  
£rv”
.
š¡ªû
 = 
butš
 server

48 
	}
})

49 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

51 
PORT
 = 9876

53 
def
 
	$‹¡BasicCÚfig
(
£lf
):

54 
£lf
.
	`g‘Page
("/")

55 
£lf
.
	`as£¹Body
(
	$¡r
(
£lf
.
PORT
))

57 
def
 
	$‹¡Add™iÚ®S”v”s
(
£lf
):

58 
£lf
.
scheme
 == 'https':

59  
£lf
.
	`sk
("not‡vailable under ssl")

60 
£lf
.
PORT
 = 9877

61 
£lf
.
	`g‘Page
("/")

62 
£lf
.
	`as£¹Body
(
	$¡r
(
£lf
.
PORT
))

63 
£lf
.
PORT
 = 9878

64 
£lf
.
	`g‘Page
("/")

65 
£lf
.
	`as£¹Body
(
	$¡r
(
£lf
.
PORT
))

67 
def
 
	$‹¡MaxReque¡SizeP”HªdËr
(
£lf
):

68 
	`g‘©Œ
(
ch”rypy
.
£rv”
, "usšg_­ache", 
F®£
):

69  
£lf
.
	`sk
("skipped dueo known Apache differences... ")

71 
£lf
.
	`g‘Page
('/tšyu¶ßd', 
m‘hod
="POST",

72 
h—d”s
=[('Content-Type', 'text/plain'),

74 
body
="x" * 100)

75 
£lf
.
	$as£¹Stus
(200)

76 
£lf
.
	`as£¹Body
("x" * 100)

78 
£lf
.
	`g‘Page
('/tšyu¶ßd', 
m‘hod
="POST",

79 
h—d”s
=[('Content-Type', 'text/plain'),

81 
body
="x" * 101)

82 
£lf
.
	$as£¹Stus
(413)

84 
def
 
	$‹¡MaxReque¡Size
(
£lf
):

85 
	`g‘©Œ
(
ch”rypy
.
£rv”
, "usšg_­ache", 
F®£
):

86  
£lf
.
	`sk
("skipped dueo known Apache differences... ")

88 
size
 
	$š
 (500, 5000, 50000):

89 
£lf
.
	`g‘Page
("/", 
h—d”s
=[('From', "x" * 500)])

90 
£lf
.
	$as£¹Stus
(413)

92 #Te¡ 
h‰p
:

93 #(
IncÜ»ù
 
bÜd”
 
cÚd™iÚ
 
š
 
»adlše
 
of
 
SizeCheckW¿µ”
).

94 #Thi 
hªgs
 
š
 
»v
 891 
ªd
 
—¾›r
.

95 
lšes256
 = "x" * 248

96 
£lf
.
	`g‘Page
("/",

97 
h—d”s
=[('Ho¡', '%s:%s' % (
£lf
.
HOST
, s–f.
PORT
)),

98 ('From', 
lšes256
)])

100 #Te¡ 
u¶ßd


101 
body
 = '\r\n'.
	`još
([

108 
·¹Ën
 = 200 - 
	$Ën
(
body
)

109 
b
 = 
body
 % ("x" * 
·¹Ën
)

110 
h
 = [("Content-type", "multipart/form-data; boundary=x"),

111 ("CÚ‹Á-L’gth", "%s" % 
	`Ën
(
b
))]

112 
£lf
.
	`g‘Page
('/u¶ßd', 
h
, "POST", 
b
)

113 
£lf
.
	`as£¹Body
('Size: %d' % 
·¹Ën
)

115 
b
 = 
body
 % ("x" * 200)

116 
h
 = [("Content-type", "multipart/form-data; boundary=x"),

117 ("CÚ‹Á-L’gth", "%s" % 
	`Ën
(
b
))]

118 
£lf
.
	`g‘Page
('/u¶ßd', 
h
, "POST", 
b
)

119 
£lf
.
	`as£¹Stus
(413)

	@trunk/objs/CherryPy-3.2.4/cherrypy/test/test_conn.py

3 
impÜt
 
sock‘


4 
impÜt
 
sys


5 
impÜt
 
time


6 
	gtimeout
 = 1

9 
impÜt
 
ch”rypy


10 
äom
 
ch”rypy
.
_ıcom·t
 
impÜt
 
HTTPCÚÃùiÚ
, 
	gHTTPSCÚÃùiÚ
, 
	gNÙCÚÃùed
, 
BadStusLše


11 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
	gÁob
, 
	gu¾İ’
, 
unicode¡r


12 
äom
 
	gch”rypy
.
‹¡
 
impÜt
 
web‹¡


13 
äom
 
ch”rypy
 
impÜt
 
_ı”rÜ


16 
	gpov
 = 'pPeErRsSiIsStTeEnNcCeE oOfF vViIsSiIoOnN'

18 
def
 
	$£tup_£rv”
():

20 
def
 
	$¿i£500
():

21 
¿i£
 
ch”rypy
.
	$HTTPE¼Ü
(500)

23 
şass
 
RoÙ
:

25 
def
 
	$šdex
(
£lf
):

26  
pov


27 
šdex
.
expo£d
 = 
True


28 
·ge1
 = 
šdex


29 
·ge2
 = 
šdex


30 
·ge3
 = 
šdex


32 
def
 
	$h–lo
(
£lf
):

34 
h–lo
.
expo£d
 = 
True


36 
def
 
	$timeout
(
£lf
, 
t
):

37  
	$¡r
(
ch”rypy
.
£rv”
.
h‰p£rv”
.
timeout
)

38 
timeout
.
expo£d
 = 
True


40 
def
 
	$¡»am
(
£lf
, 
£t_ş
=
F®£
):

41 
£t_ş
:

42 
ch”rypy
.
»¥Ú£
.
h—d”s
['Content-Length'] = 10

44 
def
 
	$cÚ‹Á
():

45 
x
 
š
 
	$¿nge
(10):

46 
y›ld
 
	$¡r
(
x
)

48  
	$cÚ‹Á
()

49 
¡»am
.
expo£d
 = 
True


50 
¡»am
.
_ı_cÚfig
 = {'»¥Ú£.¡»am': 
True
}

52 
def
 
	$”rÜ
(
£lf
, 
code
=500):

53 
¿i£
 
ch”rypy
.
	$HTTPE¼Ü
(
code
)

54 
”rÜ
.
expo£d
 = 
True


56 
def
 
	$u¶ßd
(
£lf
):

57 
nÙ
 
ch”rypy
.
»que¡
.
m‘hod
 == 'POST':

58 
¿i£
 
	`As£¹iÚE¼Ü
("'POST' !=„equest.method %r" %

59 
ch”rypy
.
»que¡
.
m‘hod
)

60  "thªk fÜ '%s'" % 
ch”rypy
.
»que¡
.
body
.
	$»ad
()

61 
u¶ßd
.
expo£d
 = 
True


63 
def
 
	$cu¡om
(
£lf
, 
»¥Ú£_code
):

64 
ch”rypy
.
»¥Ú£
.
¡©us
 = 
»¥Ú£_code


65  "Codğ%s" % 
»¥Ú£_code


66 
cu¡om
.
expo£d
 = 
True


68 
def
 
	$”r_befÜe_»ad
(
£lf
):

70 
”r_befÜe_»ad
.
expo£d
 = 
True


71 
”r_befÜe_»ad
.
_ı_cÚfig
 = {'hooks.Ú_¡¬t_»sourû': 
¿i£500
}

73 
def
 
	$Úe_megaby‹_of_a
(
£lf
):

75 
Úe_megaby‹_of_a
.
expo£d
 = 
True


77 
def
 
	$cu¡om_ş
(
£lf
, 
body
, 
ş
):

78 
ch”rypy
.
»¥Ú£
.
h—d”s
['CÚ‹Á-L’gth'] = 
ş


79 
nÙ
 
	$isš¡ªû
(
body
, 
li¡
):

80 
body
 = [body]

81 
Ãwbody
 = []

82 
chunk
 
š
 
body
:

83 
	$isš¡ªû
(
chunk
, 
unicode¡r
):

84 
chunk
 = chunk.
	`’code
('ISO-8859-1')

85 
Ãwbody
.
	$­³nd
(
chunk
)

86  
Ãwbody


87 
cu¡om_ş
.
expo£d
 = 
True


88 #Tuº 
off
 
the
 
’codšg
 
toŞ
 
so
 
™
 
dÛns
't collapse

89 #ou¸
»¥Ú£
 
body
 
ªd
 
»şacuÏ‹
 
the
 
CÚ‹Á
-
L’gth
.

90 
cu¡om_ş
.
_ı_cÚfig
 = {'toŞs.’code.Ú': 
F®£
}

92 
ch”rypy
.
Œ“
.
mouÁ
(
	$RoÙ
())

93 
ch”rypy
.
cÚfig
.
	`upd©e
({

95 '£rv”.sock‘_timeout': 
timeout
,

96 
	}
})

99 
äom
 
ch”rypy
.
‹¡
 
impÜt
 
h–³r


101 
şass
 
	$CÚÃùiÚClo£Te¡s
(
h–³r
.
CPWebCa£
):

102 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

104 
def
 
	$‹¡_HTTP11
(
£lf
):

105 
ch”rypy
.
£rv”
.
´ÙocŞ_v”siÚ
 != "HTTP/1.1":

106  
£lf
.
	$sk
()

108 
£lf
.
PROTOCOL
 = "HTTP/1.1"

110 
£lf
.
³rsi¡’t
 = 
True


112 #Mak
the
 
fœ¡
 
»que¡
 
ªd
 
as£¹
 
th”e
's‚o "Connection: close".

113 
£lf
.
	`g‘Page
("/")

114 
£lf
.
	`as£¹Stus
('200 OK')

115 
£lf
.
	$as£¹Body
(
pov
)

116 
£lf
.
	`as£¹NoH—d”
("Connection")

118 #Mak
ªÙh”
 
»que¡
 
Ú
 
the
 
§me
 
cÚÃùiÚ
.

119 
£lf
.
	`g‘Page
("/page1")

120 
£lf
.
	`as£¹Stus
('200 OK')

121 
£lf
.
	$as£¹Body
(
pov
)

122 
£lf
.
	`as£¹NoH—d”
("Connection")

124 #Te¡ 
ş›Á
-
side
 
şo£
.

125 
£lf
.
	`g‘Page
("/·ge2", 
h—d”s
=[("Connection", "close")])

126 
£lf
.
	`as£¹Stus
('200 OK')

127 
£lf
.
	$as£¹Body
(
pov
)

128 
£lf
.
	`as£¹H—d”
("Connection", "close")

130 #Mak
ªÙh”
 
»que¡
 
Ú
 
the
 
§me
 
cÚÃùiÚ
, 
which
 
should
 
”rÜ
.

131 
£lf
.
	`as£¹Rai£s
(
NÙCÚÃùed
, s–f.
g‘Page
, "/")

133 
def
 
	$‹¡_SŒ—mšg_no_Ën
(
£lf
):

134 
£lf
.
	$_¡»amšg
(
£t_ş
=
F®£
)

136 
def
 
	$‹¡_SŒ—mšg_w™h_Ën
(
£lf
):

137 
£lf
.
	$_¡»amšg
(
£t_ş
=
True
)

139 
def
 
	$_¡»amšg
(
£lf
, 
£t_ş
):

140 
ch”rypy
.
£rv”
.
´ÙocŞ_v”siÚ
 == "HTTP/1.1":

141 
£lf
.
PROTOCOL
 = "HTTP/1.1"

143 
£lf
.
³rsi¡’t
 = 
True


145 #Mak
the
 
fœ¡
 
»que¡
 
ªd
 
as£¹
 
th”e
's‚o "Connection: close".

146 
£lf
.
	`g‘Page
("/")

147 
£lf
.
	`as£¹Stus
('200 OK')

148 
£lf
.
	$as£¹Body
(
pov
)

149 
£lf
.
	`as£¹NoH—d”
("Connection")

151 #Mak
ªÙh”
, 
¡»amed
 
»que¡
 
Ú
 
the
 
§me
 
cÚÃùiÚ
.

152 
£t_ş
:

153 #Wh’ 
a
 
CÚ‹Á
-
L’gth
 
is
 
´ovided
, 
the
 
cÚ‹Á
 
should
 
¡»am


154 #w™houˆ
şosšg
 
the
 
cÚÃùiÚ
.

155 
£lf
.
	`g‘Page
("/stream?set_cl=Yes")

156 
£lf
.
	`as£¹H—d”
("Content-Length")

157 
£lf
.
	`as£¹NoH—d”
("Connection", "close")

158 
£lf
.
	`as£¹NoH—d”
("Transfer-Encoding")

160 
£lf
.
	`as£¹Stus
('200 OK')

161 
£lf
.
	`as£¹Body
('0123456789')

163 #Wh’ 
no
 
CÚ‹Á
-
L’gth
 
»¥Ú£
 
h—d”
 
is
 
´ovided
,

164 #¡»amed 
ouut
 
wl
 
e™h”
 
şo£
 
the
 
cÚÃùiÚ
, 
Ü
 
u£


165 #chunked 
’codšg
, 
to
 
d‘”mše
 
Œªsãr
-
Ëngth
.

166 
£lf
.
	`g‘Page
("/stream")

167 
£lf
.
	`as£¹NoH—d”
("Content-Length")

168 
£lf
.
	`as£¹Stus
('200 OK')

169 
£lf
.
	`as£¹Body
('0123456789')

171 
chunked_»¥Ú£
 = 
F®£


172 
k
, 
v
 
š
 
£lf
.
h—d”s
:

173 
k
.
	`low”
() == "transfer-encoding":

174 
	`¡r
(
v
) == "chunked":

175 
chunked_»¥Ú£
 = 
True


177 
chunked_»¥Ú£
:

178 
£lf
.
	`as£¹NoH—d”
("Connection", "close")

180 
£lf
.
	`as£¹H—d”
("Connection", "close")

182 #Mak
ªÙh”
 
»que¡
 
Ú
 
the
 
§me
 
cÚÃùiÚ
, 
which
 
should
 
”rÜ
.

183 
£lf
.
	`as£¹Rai£s
(
NÙCÚÃùed
, s–f.
g‘Page
, "/")

185 #Try 
HEAD
. 
S“
 
h‰p
:

186 
£lf
.
	`g‘Page
("/¡»am", 
m‘hod
='HEAD')

187 
£lf
.
	`as£¹Stus
('200 OK')

188 
£lf
.
	`as£¹Body
('')

189 
£lf
.
	`as£¹NoH—d”
("Transfer-Encoding")

191 
£lf
.
PROTOCOL
 = "HTTP/1.0"

193 
£lf
.
³rsi¡’t
 = 
True


195 #Mak
the
 
fœ¡
 
»que¡
 
ªd
 
as£¹
 
K“p
-
Alive
.

196 
£lf
.
	`g‘Page
("/", 
h—d”s
=[("Connection", "Keep-Alive")])

197 
£lf
.
	`as£¹Stus
('200 OK')

198 
£lf
.
	$as£¹Body
(
pov
)

199 
£lf
.
	`as£¹H—d”
("Connection", "Keep-Alive")

201 #Mak
ªÙh”
, 
¡»amed
 
»que¡
 
Ú
 
the
 
§me
 
cÚÃùiÚ
.

202 
£t_ş
:

203 #Wh’ 
a
 
CÚ‹Á
-
L’gth
 
is
 
´ovided
, 
the
 
cÚ‹Á
 
should


204 #¡»am 
w™hout
 
şosšg
 
the
 
cÚÃùiÚ
.

205 
£lf
.
	`g‘Page
("/stream?set_cl=Yes",

206 
h—d”s
=[("Connection", "Keep-Alive")])

207 
£lf
.
	`as£¹H—d”
("Content-Length")

208 
£lf
.
	`as£¹H—d”
("Connection", "Keep-Alive")

209 
£lf
.
	`as£¹NoH—d”
("Transfer-Encoding")

210 
£lf
.
	`as£¹Stus
('200 OK')

211 
£lf
.
	`as£¹Body
('0123456789')

213 #Wh’ 
a
 
CÚ‹Á
-
L’gth
 
is
 
nÙ
 
´ovided
,

214 #th
£rv”
 
should
 
şo£
 
the
 
cÚÃùiÚ
.

215 
£lf
.
	`g‘Page
("/¡»am", 
h—d”s
=[("Connection", "Keep-Alive")])

216 
£lf
.
	`as£¹Stus
('200 OK')

217 
£lf
.
	`as£¹Body
('0123456789')

219 
£lf
.
	`as£¹NoH—d”
("Content-Length")

220 
£lf
.
	`as£¹NoH—d”
("Connection", "Keep-Alive")

221 
£lf
.
	`as£¹NoH—d”
("Transfer-Encoding")

223 #Mak
ªÙh”
 
»que¡
 
Ú
 
the
 
§me
 
cÚÃùiÚ
, 
which
 
should
 
”rÜ
.

224 
£lf
.
	`as£¹Rai£s
(
NÙCÚÃùed
, s–f.
g‘Page
, "/")

226 
def
 
	$‹¡_HTTP10_K“pAlive
(
£lf
):

227 
£lf
.
PROTOCOL
 = "HTTP/1.0"

228 
£lf
.
scheme
 == "https":

229 
£lf
.
HTTP_CONN
 = 
HTTPSCÚÃùiÚ


231 
£lf
.
HTTP_CONN
 = 
HTTPCÚÃùiÚ


233 #Te¡ 
a
 
nÜm®
 
HTTP
/1.0 
»que¡
.

234 
£lf
.
	`g‘Page
("/page2")

235 
£lf
.
	`as£¹Stus
('200 OK')

236 
£lf
.
	$as£¹Body
(
pov
)

237 #A·che, 
exam¶e
, 
may
 
em™
 
a
 
CÚÃùiÚ
 
h—d”
 
ev’
 
HTTP
/1.0

238 ## 
£lf
.
	`as£¹NoH—d”
("Connection")

240 #Te¡ 
a
 
k“p
-
®ive
 
HTTP
/1.0 
»que¡
.

241 
£lf
.
³rsi¡’t
 = 
True


243 
£lf
.
	`g‘Page
("/·ge3", 
h—d”s
=[("Connection", "Keep-Alive")])

244 
£lf
.
	`as£¹Stus
('200 OK')

245 
£lf
.
	$as£¹Body
(
pov
)

246 
£lf
.
	`as£¹H—d”
("Connection", "Keep-Alive")

248 #Remov
the
 
k“p
-
®ive
 
h—d”
 
agaš
.

249 
£lf
.
	`g‘Page
("/page3")

250 
£lf
.
	`as£¹Stus
('200 OK')

251 
£lf
.
	$as£¹Body
(
pov
)

252 #A·che, 
exam¶e
, 
may
 
em™
 
a
 
CÚÃùiÚ
 
h—d”
 
ev’
 
HTTP
/1.0

253 ## 
£lf
.
	`as£¹NoH—d”
("Connection")

256 
şass
 
	$P–šeTe¡s
(
h–³r
.
CPWebCa£
):

257 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

259 
def
 
	$‹¡_HTTP11_Timeout
(
£lf
):

260 #Ià
we
 
timeout
 
w™hout
 
£ndšg
 
ªy
 
d©a
,

261 #th
£rv”
 
wl
 
şo£
 
the
 
cÚn
 
w™h
 
a
 408.

262 
ch”rypy
.
£rv”
.
´ÙocŞ_v”siÚ
 != "HTTP/1.1":

263  
£lf
.
	$sk
()

265 
£lf
.
PROTOCOL
 = "HTTP/1.1"

267 #CÚÃù 
but
 
£nd
 
nÙhšg
.

268 
£lf
.
³rsi¡’t
 = 
True


269 
cÚn
 = 
£lf
.
HTTP_CONN


270 
cÚn
.
auto_İ’
 = 
F®£


271 
cÚn
.
	$cÚÃù
()

273 #Wa™ 
our
 
sock‘
 
timeout


274 
time
.
	$¦“p
(
timeout
 * 2)

276 #Th
»que¡
 
should
 
have
 
»tuºed
 408 
®»ady
.

277 
»¥Ú£
 = 
cÚn
.
	`»¥Ú£_şass
(cÚn.
sock
, 
m‘hod
="GET")

278 
»¥Ú£
.
	$begš
()

279 
£lf
.
	$as£¹Equ®
(
»¥Ú£
.
¡©us
, 408)

280 
cÚn
.
	$şo£
()

282 #CÚÃù 
but
 
£nd
 
h®f
 
the
 
h—d”s
 
Úly
.

283 
£lf
.
³rsi¡’t
 = 
True


284 
cÚn
 = 
£lf
.
HTTP_CONN


285 
cÚn
.
auto_İ’
 = 
F®£


286 
cÚn
.
	$cÚÃù
()

287 
cÚn
.
	`£nd
(
	`Áob
('GET /hello HTTP/1.1'))

288 
cÚn
.
	`£nd
(("Ho¡: %s" % 
£lf
.
HOST
).
	`’code
('ascii'))

290 #Wa™ 
our
 
sock‘
 
timeout


291 
time
.
	$¦“p
(
timeout
 * 2)

293 #Th
cÚn
 
should
 
have
 
®»ady
 
£Á
 408.

294 
»¥Ú£
 = 
cÚn
.
	`»¥Ú£_şass
(cÚn.
sock
, 
m‘hod
="GET")

295 
»¥Ú£
.
	$begš
()

296 
£lf
.
	$as£¹Equ®
(
»¥Ú£
.
¡©us
, 408)

297 
cÚn
.
	$şo£
()

299 
def
 
	$‹¡_HTTP11_Timeout_aá”_»que¡
(
£lf
):

300 #Ià
we
 
timeout
 
aá”
 
©
 
Ëa¡
 
Úe
 
»que¡
 
has
 
sucûeded
,

301 #th
£rv”
 
wl
 
şo£
 
the
 
cÚn
 
w™hout
 408.

302 
ch”rypy
.
£rv”
.
´ÙocŞ_v”siÚ
 != "HTTP/1.1":

303  
£lf
.
	$sk
()

305 
£lf
.
PROTOCOL
 = "HTTP/1.1"

307 #Mak
ª
 
š™Ÿl
 
»que¡


308 
£lf
.
³rsi¡’t
 = 
True


309 
cÚn
 = 
£lf
.
HTTP_CONN


310 
cÚn
.
	`puŒeque¡
("GET", "/timeout?t=%s" % 
timeout
, 
sk_ho¡
=
True
)

311 
cÚn
.
	`puth—d”
("Ho¡", 
£lf
.
HOST
)

312 
cÚn
.
	$’dh—d”s
()

313 
»¥Ú£
 = 
cÚn
.
	`»¥Ú£_şass
(cÚn.
sock
, 
m‘hod
="GET")

314 
»¥Ú£
.
	$begš
()

315 
£lf
.
	$as£¹Equ®
(
»¥Ú£
.
¡©us
, 200)

316 
£lf
.
body
 = 
»¥Ú£
.
	$»ad
()

317 
£lf
.
	`as£¹Body
(
	$¡r
(
timeout
))

319 #Mak
a
 
£cÚd
 
»que¡
 
Ú
 
the
 
§me
 
sock‘


320 
cÚn
.
	`_ouut
(
	`Áob
('GET /hello HTTP/1.1'))

321 
cÚn
.
	`_ouut
(
	`Áob
("Ho¡: %s" % 
£lf
.
HOST
, 'ascii'))

322 
cÚn
.
	$_£nd_ouut
()

323 
»¥Ú£
 = 
cÚn
.
	`»¥Ú£_şass
(cÚn.
sock
, 
m‘hod
="GET")

324 
»¥Ú£
.
	$begš
()

325 
£lf
.
	$as£¹Equ®
(
»¥Ú£
.
¡©us
, 200)

326 
£lf
.
body
 = 
»¥Ú£
.
	$»ad
()

327 
£lf
.
	`as£¹Body
("Hello, world!")

329 #Wa™ 
our
 
sock‘
 
timeout


330 
time
.
	$¦“p
(
timeout
 * 2)

332 #Mak
ªÙh”
 
»que¡
 
Ú
 
the
 
§me
 
sock‘
, 
which
 
should
 
”rÜ


333 
cÚn
.
	`_ouut
(
	`Áob
('GET /hello HTTP/1.1'))

334 
cÚn
.
	`_ouut
(
	`Áob
("Ho¡: %s" % 
£lf
.
HOST
, 'ascii'))

335 
cÚn
.
	$_£nd_ouut
()

336 
»¥Ú£
 = 
cÚn
.
	`»¥Ú£_şass
(cÚn.
sock
, 
m‘hod
="GET")

337 
Œy
:

338 
»¥Ú£
.
	$begš
()

339 
exû±
:

340 
nÙ
 
	`isš¡ªû
(
sys
.
	`exc_šfo
()[1],

341 (
sock‘
.
”rÜ
, 
BadStusLše
)):

342 
£lf
.
	`ç
("Writingoimed out socket didn't fail"

343 "‡ ™ should have: %s" % 
sys
.
	`exc_šfo
()[1])

345 
»¥Ú£
.
¡©us
 != 408:

346 
£lf
.
	`ç
("Writingoimed out socket didn't fail"

348 
»¥Ú£
.
	$»ad
())

350 
cÚn
.
	$şo£
()

352 #Mak
ªÙh”
 
»que¡
 
Ú
 
a
 
Ãw
 
sock‘
, 
which
 
should
 
wÜk


353 
£lf
.
³rsi¡’t
 = 
True


354 
cÚn
 = 
£lf
.
HTTP_CONN


355 
cÚn
.
	`puŒeque¡
("GET", "/", 
sk_ho¡
=
True
)

356 
cÚn
.
	`puth—d”
("Ho¡", 
£lf
.
HOST
)

357 
cÚn
.
	$’dh—d”s
()

358 
»¥Ú£
 = 
cÚn
.
	`»¥Ú£_şass
(cÚn.
sock
, 
m‘hod
="GET")

359 
»¥Ú£
.
	$begš
()

360 
£lf
.
	$as£¹Equ®
(
»¥Ú£
.
¡©us
, 200)

361 
£lf
.
body
 = 
»¥Ú£
.
	$»ad
()

362 
£lf
.
	$as£¹Body
(
pov
)

365 #Mak
ªÙh”
 
»que¡
 
Ú
 
the
 
§me
 
sock‘
,

366 #buˆ
timeout
 
Ú
 
the
 
h—d”s


367 
cÚn
.
	`£nd
(
	`Áob
('GET /hello HTTP/1.1'))

368 #Wa™ 
our
 
sock‘
 
timeout


369 
time
.
	$¦“p
(
timeout
 * 2)

370 
»¥Ú£
 = 
cÚn
.
	`»¥Ú£_şass
(cÚn.
sock
, 
m‘hod
="GET")

371 
Œy
:

372 
»¥Ú£
.
	$begš
()

373 
exû±
:

374 
nÙ
 
	`isš¡ªû
(
sys
.
	`exc_šfo
()[1],

375 (
sock‘
.
”rÜ
, 
BadStusLše
)):

376 
£lf
.
	`ç
("Writingoimed out socket didn't fail"

377 "‡ ™ should have: %s" % 
sys
.
	`exc_šfo
()[1])

379 
£lf
.
	`ç
("Writingoimed out socket didn't fail"

381 
»¥Ú£
.
	$»ad
())

383 
cÚn
.
	$şo£
()

385 #R‘ry 
the
 
»que¡
 
Ú
 
a
 
Ãw
 
cÚÃùiÚ
, 
which
 
should
 
wÜk


386 
£lf
.
³rsi¡’t
 = 
True


387 
cÚn
 = 
£lf
.
HTTP_CONN


388 
cÚn
.
	`puŒeque¡
("GET", "/", 
sk_ho¡
=
True
)

389 
cÚn
.
	`puth—d”
("Ho¡", 
£lf
.
HOST
)

390 
cÚn
.
	$’dh—d”s
()

391 
»¥Ú£
 = 
cÚn
.
	`»¥Ú£_şass
(cÚn.
sock
, 
m‘hod
="GET")

392 
»¥Ú£
.
	$begš
()

393 
£lf
.
	$as£¹Equ®
(
»¥Ú£
.
¡©us
, 200)

394 
£lf
.
body
 = 
»¥Ú£
.
	$»ad
()

395 
£lf
.
	$as£¹Body
(
pov
)

396 
cÚn
.
	$şo£
()

398 
def
 
	$‹¡_HTTP11_p–ššg
(
£lf
):

399 
ch”rypy
.
£rv”
.
´ÙocŞ_v”siÚ
 != "HTTP/1.1":

400  
£lf
.
	$sk
()

402 
£lf
.
PROTOCOL
 = "HTTP/1.1"

404 #Te¡ 
p–ššg
. 
h‰¶ib
 
dÛ¢
't supporthis directly.

405 
£lf
.
³rsi¡’t
 = 
True


406 
cÚn
 = 
£lf
.
HTTP_CONN


408 #Puˆ
»que¡
 1

409 
cÚn
.
	`puŒeque¡
("GET", "/h–lo", 
sk_ho¡
=
True
)

410 
cÚn
.
	`puth—d”
("Ho¡", 
£lf
.
HOST
)

411 
cÚn
.
	$’dh—d”s
()

413 
ŒŸl
 
š
 
	$¿nge
(5):

414 #Puˆ
Ãxt
 
»que¡


415 
cÚn
.
	`_ouut
(
	`Áob
('GET /hello HTTP/1.1'))

416 
cÚn
.
	`_ouut
(
	`Áob
("Ho¡: %s" % 
£lf
.
HOST
, 'ascii'))

417 
cÚn
.
	$_£nd_ouut
()

419 #R‘r›v
´evious
 
»¥Ú£


420 
»¥Ú£
 = 
cÚn
.
	`»¥Ú£_şass
(cÚn.
sock
, 
m‘hod
="GET")

421 
»¥Ú£
.
	$begš
()

422 
body
 = 
»¥Ú£
.
	$»ad
(13)

423 
£lf
.
	$as£¹Equ®
(
»¥Ú£
.
¡©us
, 200)

424 
£lf
.
	`as£¹Equ®
(
body
, 
	`Áob
("Hello, world!"))

426 #R‘r›v
fš®
 
»¥Ú£


427 
»¥Ú£
 = 
cÚn
.
	`»¥Ú£_şass
(cÚn.
sock
, 
m‘hod
="GET")

428 
»¥Ú£
.
	$begš
()

429 
body
 = 
»¥Ú£
.
	$»ad
()

430 
£lf
.
	$as£¹Equ®
(
»¥Ú£
.
¡©us
, 200)

431 
£lf
.
	`as£¹Equ®
(
body
, 
	`Áob
("Hello, world!"))

433 
cÚn
.
	$şo£
()

435 
def
 
	$‹¡_100_CÚtšue
(
£lf
):

436 
ch”rypy
.
£rv”
.
´ÙocŞ_v”siÚ
 != "HTTP/1.1":

437  
£lf
.
	$sk
()

439 
£lf
.
PROTOCOL
 = "HTTP/1.1"

441 
£lf
.
³rsi¡’t
 = 
True


442 
cÚn
 = 
£lf
.
HTTP_CONN


444 #Try 
a
 
·ge
 
w™hout
 
ª
 
Ex³ù
 
»que¡
 
h—d”
 
fœ¡
.

445 #NÙ
th©
 
h‰¶ib
's„esponse.begin‡utomatically ignores

446 #100 
CÚtšue
 
»¥Ú£s
, 
so
 
we
 
mu¡
 
mªu®ly
 
check
 
™
.

447 
cÚn
.
	`puŒeque¡
("POST", "/u¶ßd", 
sk_ho¡
=
True
)

448 
cÚn
.
	`puth—d”
("Ho¡", 
£lf
.
HOST
)

449 
cÚn
.
	`puth—d”
("Content-Type", "text/plain")

450 
cÚn
.
	`puth—d”
("Content-Length", "4")

451 
cÚn
.
	$’dh—d”s
()

452 
cÚn
.
	`£nd
(
	`Áob
("d'oh"))

453 
»¥Ú£
 = 
cÚn
.
	`»¥Ú£_şass
(cÚn.
sock
, 
m‘hod
="POST")

454 
v”siÚ
, 
¡©us
, 
»asÚ
 = 
»¥Ú£
.
	$_»ad_¡©us
()

455 
£lf
.
	$as£¹NÙEqu®
(
¡©us
, 100)

456 
cÚn
.
	$şo£
()

458 #Now 
Œy
 
a
 
·ge
 
w™h
 
ª
 
Ex³ù
 
h—d”
...

459 
cÚn
.
	$cÚÃù
()

460 
cÚn
.
	`puŒeque¡
("POST", "/u¶ßd", 
sk_ho¡
=
True
)

461 
cÚn
.
	`puth—d”
("Ho¡", 
£lf
.
HOST
)

462 
cÚn
.
	`puth—d”
("Content-Type", "text/plain")

463 
cÚn
.
	`puth—d”
("Content-Length", "17")

464 
cÚn
.
	`puth—d”
("Expect", "100-continue")

465 
cÚn
.
	$’dh—d”s
()

466 
»¥Ú£
 = 
cÚn
.
	`»¥Ú£_şass
(cÚn.
sock
, 
m‘hod
="POST")

468 #...
as£¹
 
ªd
 
th’
 
sk
 
the
 100 
»¥Ú£


469 
v”siÚ
, 
¡©us
, 
»asÚ
 = 
»¥Ú£
.
	$_»ad_¡©us
()

470 
£lf
.
	$as£¹Equ®
(
¡©us
, 100)

471 
True
:

472 
lše
 = 
»¥Ú£
.
å
.
	`»adlše
().
	$¡r
()

473 
lše
:

474 
£lf
.
	`ç
("100 CÚtšushould‚Ù ouuˆªy h—d”s. GÙ %r" % 
lše
)

478 #...
£nd
 
the
 
body


479 
body
 = 
	`Áob
("I‡m‡ small file")

480 
cÚn
.
	$£nd
(
body
)

482 #...
g‘
 
the
 
fš®
 
»¥Ú£


483 
»¥Ú£
.
	$begš
()

484 
£lf
.
¡©us
, s–f.
h—d”s
, s–f.
body
 = 
web‹¡
.
	$shb
(
»¥Ú£
)

485 
£lf
.
	$as£¹Stus
(200)

486 
£lf
.
	`as£¹Body
("thªk fÜ '%s'" % 
body
)

487 
cÚn
.
	$şo£
()

490 
şass
 
	$CÚÃùiÚTe¡s
(
h–³r
.
CPWebCa£
):

491 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

493 
def
 
	$‹¡_»ad®l_Ü_şo£
(
£lf
):

494 
ch”rypy
.
£rv”
.
´ÙocŞ_v”siÚ
 != "HTTP/1.1":

495  
£lf
.
	$sk
()

497 
£lf
.
PROTOCOL
 = "HTTP/1.1"

499 
£lf
.
scheme
 == "https":

500 
£lf
.
HTTP_CONN
 = 
HTTPSCÚÃùiÚ


502 
£lf
.
HTTP_CONN
 = 
HTTPCÚÃùiÚ


504 #Te¡ 
a
 
max
 
of
 0 (
the
 è
ªd
 
th’
 
»£t
 
to
 
wh©
 
™
 
was
 
above
.

505 
Şd_max
 = 
ch”rypy
.
£rv”
.
max_»que¡_body_size


506 
Ãw_max
 
	$š
 (0, 
Şd_max
):

507 
ch”rypy
.
£rv”
.
max_»que¡_body_size
 = 
Ãw_max


509 
£lf
.
³rsi¡’t
 = 
True


510 
cÚn
 = 
£lf
.
HTTP_CONN


512 #G‘ 
a
 
POST
 
·ge
 
w™h
 
ª
 
”rÜ


513 
cÚn
.
	`puŒeque¡
("POST", "/”r_befÜe_»ad", 
sk_ho¡
=
True
)

514 
cÚn
.
	`puth—d”
("Ho¡", 
£lf
.
HOST
)

515 
cÚn
.
	`puth—d”
("Content-Type", "text/plain")

516 
cÚn
.
	`puth—d”
("Content-Length", "1000")

517 
cÚn
.
	`puth—d”
("Expect", "100-continue")

518 
cÚn
.
	$’dh—d”s
()

519 
»¥Ú£
 = 
cÚn
.
	`»¥Ú£_şass
(cÚn.
sock
, 
m‘hod
="POST")

521 #...
as£¹
 
ªd
 
th’
 
sk
 
the
 100 
»¥Ú£


522 
v”siÚ
, 
¡©us
, 
»asÚ
 = 
»¥Ú£
.
	$_»ad_¡©us
()

523 
£lf
.
	$as£¹Equ®
(
¡©us
, 100)

524 
True
:

525 
sk
 = 
»¥Ú£
.
å
.
	`»adlše
().
	$¡r
()

526 
nÙ
 
sk
:

529 #...
£nd
 
the
 
body


530 
cÚn
.
	`£nd
(
	`Áob
("x" * 1000))

532 #...
g‘
 
the
 
fš®
 
»¥Ú£


533 
»¥Ú£
.
	$begš
()

534 
£lf
.
¡©us
, s–f.
h—d”s
, s–f.
body
 = 
web‹¡
.
	$shb
(
»¥Ú£
)

535 
£lf
.
	$as£¹Stus
(500)

537 #Now 
Œy
 
a
 
wÜkšg
 
·ge
 
w™h
 
ª
 
Ex³ù
 
h—d”
...

538 
cÚn
.
	`_ouut
(
	`Áob
('POST /upload HTTP/1.1'))

539 
cÚn
.
	`_ouut
(
	`Áob
("Ho¡: %s" % 
£lf
.
HOST
, 'ascii'))

540 
cÚn
.
	`_ouut
(
	`Áob
("Content-Type:ext/plain"))

541 
cÚn
.
	`_ouut
(
	`Áob
("Content-Length: 17"))

542 
cÚn
.
	`_ouut
(
	`Áob
("Expect: 100-continue"))

543 
cÚn
.
	$_£nd_ouut
()

544 
»¥Ú£
 = 
cÚn
.
	`»¥Ú£_şass
(cÚn.
sock
, 
m‘hod
="POST")

546 #...
as£¹
 
ªd
 
th’
 
sk
 
the
 100 
»¥Ú£


547 
v”siÚ
, 
¡©us
, 
»asÚ
 = 
»¥Ú£
.
	$_»ad_¡©us
()

548 
£lf
.
	$as£¹Equ®
(
¡©us
, 100)

549 
True
:

550 
sk
 = 
»¥Ú£
.
å
.
	`»adlše
().
	$¡r
()

551 
nÙ
 
sk
:

554 #...
£nd
 
the
 
body


555 
body
 = 
	`Áob
("I‡m‡ small file")

556 
cÚn
.
	$£nd
(
body
)

558 #...
g‘
 
the
 
fš®
 
»¥Ú£


559 
»¥Ú£
.
	$begš
()

560 
£lf
.
¡©us
, s–f.
h—d”s
, s–f.
body
 = 
web‹¡
.
	$shb
(
»¥Ú£
)

561 
£lf
.
	$as£¹Stus
(200)

562 
£lf
.
	`as£¹Body
("thªk fÜ '%s'" % 
body
)

563 
cÚn
.
	$şo£
()

565 
def
 
	$‹¡_No_Mes§ge_Body
(
£lf
):

566 
ch”rypy
.
£rv”
.
´ÙocŞ_v”siÚ
 != "HTTP/1.1":

567  
£lf
.
	$sk
()

569 
£lf
.
PROTOCOL
 = "HTTP/1.1"

571 #S‘ 
our
 
HTTP_CONN
 
to
 
ª
 
š¡ªû
 
so
 
™
 
³rsi¡s
 
b‘w“n
 
»que¡s
.

572 
£lf
.
³rsi¡’t
 = 
True


574 #Mak
the
 
fœ¡
 
»que¡
 
ªd
 
as£¹
 
th”e
's‚o "Connection: close".

575 
£lf
.
	`g‘Page
("/")

576 
£lf
.
	`as£¹Stus
('200 OK')

577 
£lf
.
	$as£¹Body
(
pov
)

578 
£lf
.
	`as£¹NoH—d”
("Connection")

580 #Mak
a
 204 
»que¡
 
Ú
 
the
 
§me
 
cÚÃùiÚ
.

581 
£lf
.
	`g‘Page
("/custom/204")

582 
£lf
.
	$as£¹Stus
(204)

583 
£lf
.
	`as£¹NoH—d”
("Content-Length")

584 
£lf
.
	`as£¹Body
("")

585 
£lf
.
	`as£¹NoH—d”
("Connection")

587 #Mak
a
 304 
»que¡
 
Ú
 
the
 
§me
 
cÚÃùiÚ
.

588 
£lf
.
	`g‘Page
("/custom/304")

589 
£lf
.
	$as£¹Stus
(304)

590 
£lf
.
	`as£¹NoH—d”
("Content-Length")

591 
£lf
.
	`as£¹Body
("")

592 
£lf
.
	`as£¹NoH—d”
("Connection")

594 
def
 
	$‹¡_Chunked_Encodšg
(
£lf
):

595 
ch”rypy
.
£rv”
.
´ÙocŞ_v”siÚ
 != "HTTP/1.1":

596  
£lf
.
	$sk
()

598 ià(
	`ha§‰r
(
£lf
, 'h¬Ãss'è
ªd


599 "modpythÚ" 
š
 
£lf
.
h¬Ãss
.
__şass__
.
__Çme__
.
	$low”
()):

600 #mod_pythÚ 
fÜbids
 
chunked
 
’codšg


601  
£lf
.
	$sk
()

603 
£lf
.
PROTOCOL
 = "HTTP/1.1"

605 #S‘ 
our
 
HTTP_CONN
 
to
 
ª
 
š¡ªû
 
so
 
™
 
³rsi¡s
 
b‘w“n
 
»que¡s
.

606 
£lf
.
³rsi¡’t
 = 
True


607 
cÚn
 = 
£lf
.
HTTP_CONN


609 #Try 
a
 
nÜm®
 
chunked
 
	`»que¡
 (
w™h
 
ex‹nsiÚs
)

610 
body
 = 
	`Áob
("8;key=value\r\nxx\r\nxxxx\r\n5\r\nyyyyy\r\n0\r\n"

613 
cÚn
.
	`puŒeque¡
("POST", "/u¶ßd", 
sk_ho¡
=
True
)

614 
cÚn
.
	`puth—d”
("Ho¡", 
£lf
.
HOST
)

615 
cÚn
.
	`puth—d”
("Transfer-Encoding", "chunked")

616 
cÚn
.
	`puth—d”
("Trailer", "Content-Type")

617 #NÙ
th©
 
this
 
is
 
somewh©
 
m®fÜmed
:

618 #w
shouldn
't be sending Content-Length.

619 #RFC 2616 
§ys
 
the
 
£rv”
 
should
 
ignÜe
 
™
.

620 
cÚn
.
	`puth—d”
("Content-Length", "3")

621 
cÚn
.
	$’dh—d”s
()

622 
cÚn
.
	$£nd
(
body
)

623 
»¥Ú£
 = 
cÚn
.
	$g‘»¥Ú£
()

624 
£lf
.
¡©us
, s–f.
h—d”s
, s–f.
body
 = 
web‹¡
.
	$shb
(
»¥Ú£
)

625 
£lf
.
	`as£¹Stus
('200 OK')

626 
£lf
.
	`as£¹Body
("thªk fÜ '%s'" % 
	`Áob
('xx\r\nxxxxyyyyy'))

628 #Try 
a
 
chunked
 
»que¡
 
th©
 
exûeds
 
£rv”
.
max_»que¡_body_size
.

629 #NÙ
th©
 
the
 
d–im™”s
 
ªd
 
Œa”
 
¬e
 
šşuded
.

630 
body
 = 
	`Áob
("3e3\r\n" + ("x" * 995) + "\r\n0\r\n\r\n")

631 
cÚn
.
	`puŒeque¡
("POST", "/u¶ßd", 
sk_ho¡
=
True
)

632 
cÚn
.
	`puth—d”
("Ho¡", 
£lf
.
HOST
)

633 
cÚn
.
	`puth—d”
("Transfer-Encoding", "chunked")

634 
cÚn
.
	`puth—d”
("Content-Type", "text/plain")

635 #Chunked 
»que¡s
 
dÚ
't‚eed‡ content-length

636 ## 
cÚn
.
	`puth—d”
("CÚ‹Á-L’gth", 
	`Ën
(
body
))

637 
cÚn
.
	$’dh—d”s
()

638 
cÚn
.
	$£nd
(
body
)

639 
»¥Ú£
 = 
cÚn
.
	$g‘»¥Ú£
()

640 
£lf
.
¡©us
, s–f.
h—d”s
, s–f.
body
 = 
web‹¡
.
	$shb
(
»¥Ú£
)

641 
£lf
.
	$as£¹Stus
(413)

642 
cÚn
.
	$şo£
()

644 
def
 
	$‹¡_CÚ‹Á_L’gth_š
(
£lf
):

645 #Try 
a
 
nÚ
-
chunked
 
»que¡
 
wh”e
 
CÚ‹Á
-
L’gth
 
exûeds


646 #£rv”.
max_»que¡_body_size
. 
As£¹
 
”rÜ
 
befÜe
 
body
 
£nd
.

647 
£lf
.
³rsi¡’t
 = 
True


648 
cÚn
 = 
£lf
.
HTTP_CONN


649 
cÚn
.
	`puŒeque¡
("POST", "/u¶ßd", 
sk_ho¡
=
True
)

650 
cÚn
.
	`puth—d”
("Ho¡", 
£lf
.
HOST
)

651 
cÚn
.
	`puth—d”
("Content-Type", "text/plain")

652 
cÚn
.
	`puth—d”
("Content-Length", "9999")

653 
cÚn
.
	$’dh—d”s
()

654 
»¥Ú£
 = 
cÚn
.
	$g‘»¥Ú£
()

655 
£lf
.
¡©us
, s–f.
h—d”s
, s–f.
body
 = 
web‹¡
.
	$shb
(
»¥Ú£
)

656 
£lf
.
	$as£¹Stus
(413)

657 
£lf
.
	`as£¹Body
("Theƒntity sent withhe„equestƒxceeds "

659 
cÚn
.
	$şo£
()

661 
def
 
	$‹¡_CÚ‹Á_L’gth_out_´eh—d”s
(
£lf
):

662 #Try 
a
 
nÚ
-
chunked
 
»¥Ú£
 
wh”e
 
CÚ‹Á
-
L’gth
 
is
 
Ëss
 
thª


663 #th
aùu®
 
by‹s
 
š
 
the
 
»¥Ú£
 
body
.

664 
£lf
.
³rsi¡’t
 = 
True


665 
cÚn
 = 
£lf
.
HTTP_CONN


666 
cÚn
.
	`puŒeque¡
("GET", "/custom_cl?body=I+have+too+many+bytes&cl=5",

667 
sk_ho¡
=
True
)

668 
cÚn
.
	`puth—d”
("Ho¡", 
£lf
.
HOST
)

669 
cÚn
.
	$’dh—d”s
()

670 
»¥Ú£
 = 
cÚn
.
	$g‘»¥Ú£
()

671 
£lf
.
¡©us
, s–f.
h—d”s
, s–f.
body
 = 
web‹¡
.
	$shb
(
»¥Ú£
)

672 
£lf
.
	$as£¹Stus
(500)

673 
£lf
.
	`as£¹Body
(

676 
cÚn
.
	$şo£
()

678 
def
 
	$‹¡_CÚ‹Á_L’gth_out_po¡h—d”s
(
£lf
):

679 #Try 
a
 
nÚ
-
chunked
 
»¥Ú£
 
wh”e
 
CÚ‹Á
-
L’gth
 
is
 
Ëss
 
thª


680 #th
aùu®
 
by‹s
 
š
 
the
 
»¥Ú£
 
body
.

681 
£lf
.
³rsi¡’t
 = 
True


682 
cÚn
 = 
£lf
.
HTTP_CONN


683 
cÚn
.
	`puŒeque¡
("GET", "/custom_cl?body=I+too&body=+have+too+many&cl=5",

684 
sk_ho¡
=
True
)

685 
cÚn
.
	`puth—d”
("Ho¡", 
£lf
.
HOST
)

686 
cÚn
.
	$’dh—d”s
()

687 
»¥Ú£
 = 
cÚn
.
	$g‘»¥Ú£
()

688 
£lf
.
¡©us
, s–f.
h—d”s
, s–f.
body
 = 
web‹¡
.
	$shb
(
»¥Ú£
)

689 
£lf
.
	$as£¹Stus
(200)

690 
£lf
.
	`as£¹Body
("Ioo")

691 
cÚn
.
	$şo£
()

693 
def
 
	$‹¡_598
(
£lf
):

694 
»mÙe_d©a_cÚn
 = 
	`u¾İ’
('%s://%s:%s/one_megabyte_of_a/' %

695 (
£lf
.
scheme
, s–f.
HOST
, s–f.
PORT
,))

696 
buf
 = 
»mÙe_d©a_cÚn
.
	$»ad
(512)

697 
time
.
	$¦“p
(
timeout
 * 0.6)

698 
»maššg
 = (1024 * 1024) - 512

699 
»maššg
:

700 
d©a
 = 
»mÙe_d©a_cÚn
.
	$»ad
(
»maššg
)

701 
nÙ
 
d©a
:

704 
buf
 +ğ
d©a


705 
»maššg
 -ğ
	$Ën
(
d©a
)

707 
£lf
.
	`as£¹Equ®
(
	`Ën
(
buf
), 1024 * 1024)

708 
£lf
.
	`as£¹Equ®
(
buf
, 
	`Áob
("a" * 1024 * 1024))

709 
£lf
.
	$as£¹Equ®
(
»maššg
, 0)

710 
»mÙe_d©a_cÚn
.
	$şo£
()

713 
şass
 
	$BadReque¡Te¡s
(
h–³r
.
CPWebCa£
):

714 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

716 
def
 
	$‹¡_No_CRLF
(
£lf
):

717 
£lf
.
³rsi¡’t
 = 
True


719 
cÚn
 = 
£lf
.
HTTP_CONN


720 
cÚn
.
	`£nd
(
	`Áob
('GET /hello HTTP/1.1\n\n'))

721 
»¥Ú£
 = 
cÚn
.
	`»¥Ú£_şass
(cÚn.
sock
, 
m‘hod
="GET")

722 
»¥Ú£
.
	$begš
()

723 
£lf
.
body
 = 
»¥Ú£
.
	$»ad
()

724 
£lf
.
	`as£¹Body
("HTTP„equires CRLFerminators")

725 
cÚn
.
	$şo£
()

727 
cÚn
.
	$cÚÃù
()

728 
cÚn
.
	`£nd
(
	`Áob
('GET /hello HTTP/1.1\r\n\n'))

729 
»¥Ú£
 = 
cÚn
.
	`»¥Ú£_şass
(cÚn.
sock
, 
m‘hod
="GET")

730 
»¥Ú£
.
	$begš
()

731 
£lf
.
body
 = 
»¥Ú£
.
	$»ad
()

732 
£lf
.
	`as£¹Body
("HTTP„equires CRLFerminators")

733 
cÚn
.
	`şo£
()

	@trunk/objs/CherryPy-3.2.4/cherrypy/test/test_core.py

3 
impÜt
 
os


4 
	gloÿlDœ
 = 
os
.
·th
.
	$dœÇme
(
__fe__
)

5 
impÜt
 
sys


6 
impÜt
 
ty³s


8 
impÜt
 
ch”rypy


9 
äom
 
ch”rypy
.
_ıcom·t
 
impÜt
 
Incom¶‘eR—d
, 
™”v®ues
, 
Áob


10 
äom
 
ch”rypy
 
impÜt
 
_ıtoŞs
, 
toŞs


11 
äom
 
ch”rypy
.
lib
 
impÜt
 
h‰put
, 

14 
çvicÚ_·th
 = 
os
.
·th
.
	`još
(os.
	`g‘cwd
(), 
loÿlDœ
, "../favicon.ico")

16 #Cl›Á-
side
 
code
 #


17 
äom
 
ch”rypy
.
‹¡
 
impÜt
 
h–³r


19 
şass
 
	$CÜeReque¡HªdlšgTe¡
(
h–³r
.
CPWebCa£
):

21 
def
 
	$£tup_£rv”
():

22 
şass
 
RoÙ
:

24 
def
 
	$šdex
(
£lf
):

26 
šdex
.
expo£d
 = 
True


28 
çvicÚ_ico
 = 
toŞs
.
¡©icfe
.
	$hªdËr
(
f’ame
=
çvicÚ_·th
)

30 
def
 
	$defù
(
£lf
, 
Ãwù
):

31 
Ãwù
 = "text/%s" %‚ewct

32 
ch”rypy
.
cÚfig
.
	`upd©e
({'toŞs.»¥Ú£_h—d”s.Ú': 
True
,

34 [('CÚ‹Á-Ty³', 
Ãwù
)]
	}
})

35 
defù
.
expo£d
 = 
True


37 
def
 
	$ba£u¾
(
£lf
, 
·th_šfo
, 
»Ïtive
=
NÚe
):

38  
ch”rypy
.
	`u¾
(
·th_šfo
, 
»Ïtive
=
	$boŞ
(
»Ïtive
))

39 
ba£u¾
.
expo£d
 = 
True


41 
roÙ
 = 
	$RoÙ
()

43 
sys
.
v”siÚ_šfo
 >= (2, 5):

44 
äom
 
ch”rypy
.
‹¡
.
_‹¡_decÜ©Üs
 
impÜt
 
Expo£Exam¶es


45 
roÙ
.
expo£_dec
 = 
	$Expo£Exam¶es
()

48 
şass
 
	$Te¡Ty³
(
ty³
):

50 
ªd
 
adds
 
ª
 
š¡ªû
 
of
 
the
 
subşass
 
as
‡À
©Œibu‹
 oà
roÙ
.

52 
def
 
	$__š™__
(
şs
, 
Çme
, 
ba£s
, 
dù
):

53 
ty³
.
	$__š™__
(
şs
, 
Çme
, 
ba£s
, 
dù
)

54 
v®ue
 
š
 
	$™”v®ues
(
dù
):

55 
	$isš¡ªû
(
v®ue
, 
ty³s
.
FunùiÚTy³
):

56 
v®ue
.
expo£d
 = 
True


57 
	`£‰r
(
roÙ
, 
Çme
.
	`low”
(), 
	$şs
())

58 
Te¡
 = 
	`Te¡Ty³
('Te¡', (
objeù
, ), {
	}
})

61 
şass
 
	$URL
(
Te¡
):

63 
_ı_cÚfig
 = {'toŞs.Œašg_¦ash.Ú': 
F®£
}

65 
def
 
	$šdex
(
£lf
, 
·th_šfo
, 
»Ïtive
=
NÚe
):

66 
»Ïtive
 != 'server':

67 
»Ïtive
 = 
	$boŞ
(
»Ïtive
)

68  
ch”rypy
.
	$u¾
(
·th_šfo
, 
»Ïtive
=relative)

70 
def
 
	$Ëaf
(
£lf
, 
·th_šfo
, 
»Ïtive
=
NÚe
):

71 
»Ïtive
 != 'server':

72 
»Ïtive
 = 
	$boŞ
(
»Ïtive
)

73  
ch”rypy
.
	$u¾
(
·th_šfo
, 
»Ïtive
=relative)

76 
def
 
	$log_¡©us
():

77 
Stus
.
¡©u£s
.
	$­³nd
(
ch”rypy
.
»¥Ú£
.
¡©us
)

78 
ch”rypy
.
toŞs
.
log_¡©us
 = ch”rypy.
	`ToŞ
('on_end_resource',†og_status)

81 
şass
 
	$Stus
(
Te¡
):

83 
def
 
	$šdex
(
£lf
):

86 
def
 
	$bÏnk
(
£lf
):

87 
ch”rypy
.
»¥Ú£
.
¡©us
 = ""

89 #AccÜdšg 
to
 
RFC
 2616, 
Ãw
 
¡©us
 
codes
 
¬e
 
OK
 
as
 a 
they


90 #¬
b‘w“n
 100 
ªd
 599.

92 #H”
is
 
ª
 
Ëg®
 
code
...

93 
def
 
	$Ëg®
(
£lf
):

94 
ch”rypy
.
»¥Ú£
.
¡©us
 = 781

97 #...
ªd
 
h”e
 
is
 
ª
 
unknown
 
but
 
Ëg®
 
code
.

98 
def
 
	$unknown
(
£lf
):

99 
ch”rypy
.
»¥Ú£
.
¡©us
 = "431 My customƒrror"

102 #NÚ-
num”ic
 
code


103 
def
 
	$bad
(
£lf
):

104 
ch”rypy
.
»¥Ú£
.
¡©us
 = "error"

107 
¡©u£s
 = []

108 
def
 
	$Ú_’d_»sourû_¡age
(
£lf
):

109  
	$»´
(
£lf
.
¡©u£s
)

110 
Ú_’d_»sourû_¡age
.
_ı_cÚfig
 = {'toŞs.log_¡©us.Ú': 
True
}

113 
şass
 
	$Redœeù
(
Te¡
):

115 
şass
 
E¼Ü
:

116 
_ı_cÚfig
 = {"toŞs.”r_»dœeù.Ú": 
True
,

118 "toŞs.”r_»dœeù.š‹º®": 
F®£
,

119 
	}
}

121 
def
 
	$šdex
(
£lf
):

122 
¿i£
 
	`NameE¼Ü
("redirect_test")

123 
šdex
.
expo£d
 = 
True


124 
”rÜ
 = 
	$E¼Ü
()

126 
def
 
	$šdex
(
£lf
):

129 
def
 
	$cu¡om
(
£lf
, 
u¾
, 
code
):

130 
¿i£
 
ch”rypy
.
	$HTTPRedœeù
(
u¾
, 
code
)

132 
def
 
	$by_code
(
£lf
, 
code
):

133 
¿i£
 
ch”rypy
.
	`HTTPRedœeù
("somewh”e%20–£", 
code
)

134 
by_code
.
_ı_cÚfig
 = {'toŞs.Œašg_¦ash.exŒa': 
True
}

136 
def
 
	$nomodify
(
£lf
):

137 
¿i£
 
ch”rypy
.
	`HTTPRedœeù
("", 304)

139 
def
 
	$´oxy
(
£lf
):

140 
¿i£
 
ch”rypy
.
	`HTTPRedœeù
("proxy", 305)

142 
def
 
	$¡ršgify
(
£lf
):

143  
	`¡r
(
ch”rypy
.
	`HTTPRedœeù
("/"))

145 
def
 
	$äagm’t
(
£lf
, 
äag
):

146 
¿i£
 
ch”rypy
.
	`HTTPRedœeù
("/some/u¾#%s" % 
äag
)

148 
def
 
	$logš_»dœ
():

149 
nÙ
 
	`g‘©Œ
(
ch”rypy
.
»que¡
, "logš", 
NÚe
):

150 
¿i£
 
ch”rypy
.
	`IÁ”ÇlRedœeù
("/internalredirect/login")

151 
toŞs
.
logš_»dœ
 = 
_ıtoŞs
.
	`ToŞ
('before_handler',†ogin_redir)

153 
def
 
	$»dœ_cu¡om
():

154 
¿i£
 
ch”rypy
.
	`IÁ”ÇlRedœeù
("/internalredirect/custom_err")

156 
şass
 
	$IÁ”ÇlRedœeù
(
Te¡
):

158 
def
 
	$šdex
(
£lf
):

159 
¿i£
 
ch”rypy
.
	`IÁ”ÇlRedœeù
("/")

161 
def
 
	$choke
(
£lf
):

163 
choke
.
expo£d
 = 
True


164 
choke
.
_ı_cÚfig
 = {'hooks.befÜe_”rÜ_»¥Ú£': 
»dœ_cu¡om
}

166 
def
 
	$»Ïtive
(
£lf
, 
a
, 
b
):

167 
¿i£
 
ch”rypy
.
	`IÁ”ÇlRedœeù
("cousin?t=6")

169 
def
 
	$cousš
(
£lf
, 
t
):

170 
as£¹
 
ch”rypy
.
»que¡
.
´ev
.
şo£d


171  
ch”rypy
.
»que¡
.
´ev
.
qu”y_¡ršg


173 
def
 
	$³tshİ
(
£lf
, 
u£r_id
):

174 
u£r_id
 == "parrot":

175 #T¿d
™
 
a
 
¦ug
 
wh’
 
»dœeùšg


176 
¿i£
 
ch”rypy
.
	`IÁ”ÇlRedœeù
('/image/getImagesByUser?user_id=slug')

177 
–if
 
u£r_id
 == "terrier":

178 #T¿d
™
 
a
 
fish
 
wh’
 
»dœeùšg


179 
¿i£
 
ch”rypy
.
	`IÁ”ÇlRedœeù
('/image/getImagesByUser?user_id=fish')

181 #Thi 
should
 
·ss
 
the
 
u£r_id
 
through
 
to
 
g‘ImagesByU£r


182 
¿i£
 
ch”rypy
.
	`IÁ”ÇlRedœeù
(

183 '/image/g‘ImagesByU£r?u£r_id=%s' % 
	$¡r
(
u£r_id
))

185 #W
suµÜt
 
PythÚ
 2.3, 
but
 
the
 @-
deco
 
syÁax
 
would
 
look
 
like
 
this
:

186 #@
toŞs
.
	`logš_»dœ
()

187 
def
 
	$£cu»
(
£lf
):

189 
£cu»
 = 
toŞs
.
	$logš_»dœ
()(
£cu»
)

190 #Sšû 
ÿÎšg
 
the
 
toŞ
 
»tuºs
h
§me
 
funùiÚ
 
you
 
·ss
 
š
,

191 #you 
could
 
sk
 
bšdšg
 
the
  
v®ue
, 
ªd
 
ju¡
 
wr™e
:

192 #toŞs.
	`logš_»dœ
()(
£cu»
)

194 
def
 
	$logš
(
£lf
):

197 
def
 
	$cu¡om_”r
(
£lf
):

200 
def
 
	$—¾y_œ
(
£lf
, 
¬g
):

202 
—¾y_œ
.
_ı_cÚfig
 = {'hooks.befÜe_»que¡_body': 
»dœ_cu¡om
}

205 
şass
 
	$Image
(
Te¡
):

207 
def
 
	$g‘ImagesByU£r
(
£lf
, 
u£r_id
):

208  "0 image fÜ %s" % 
u£r_id


211 
şass
 
	$FÏ‰’
(
Te¡
):

213 
def
 
	$as_¡ršg
(
£lf
):

216 
def
 
	$as_li¡
(
£lf
):

219 
def
 
	$as_y›ld
(
£lf
):

220 
y›ld
 
	`Áob
("content")

222 
def
 
	$as_dbly›ld
(
£lf
):

223 
y›ld
 
£lf
.
	$as_y›ld
()

224 
as_dbly›ld
.
_ı_cÚfig
 = {'toŞs.æ©‹n.Ú': 
True
}

226 
def
 
	$as_»fy›ld
(
£lf
):

227 
chunk
 
š
 
£lf
.
	$as_y›ld
():

228 
y›ld
 
chunk


231 
şass
 
	$Rªges
(
Te¡
):

233 
def
 
	$g‘_¿nges
(
£lf
, 
by‹s
):

234  
	`»´
(
h‰put
.
	`g‘_¿nges
('by‹s=%s' % 
by‹s
, 8))

236 
def
 
	$¦iû_fe
(
£lf
):

237 
·th
 = 
os
.·th.
	`još
(os.
	`g‘cwd
(), os.·th.
	$dœÇme
(
__fe__
))

238  .
	`£rve_fe
(
os
.
·th
.
	`još
(path, "static/index.html"))

241 
şass
 
	$Cook›s
(
Te¡
):

243 
def
 
	$sšgË
(
£lf
, 
Çme
):

244 
cook›
 = 
ch”rypy
.
»que¡
.cook›[
Çme
]

245 #PythÚ2' Sim¶eCook›.__£t™em__ wÚ'
t
 
ke
 
unicode
 
keys
.

246 
ch”rypy
.
»¥Ú£
.
cook›
[
	`¡r
(
Çme
)] = cook›.
v®ue


248 
def
 
	$muÉË
(
£lf
, 
Çmes
):

249 
Çme
 
š
 
Çmes
:

250 
cook›
 = 
ch”rypy
.
»que¡
.cook›[
Çme
]

251 #PythÚ2' Sim¶eCook›.__£t™em__ wÚ'
t
 
ke
 
unicode
 
keys
.

252 
ch”rypy
.
»¥Ú£
.
cook›
[
	`¡r
(
Çme
)] = cook›.
v®ue


254 
def
 
	$­³nd_h—d”s
(
h—d”_li¡
, 
debug
=
F®£
):

255 
debug
:

256 
ch”rypy
.
	`log
(

257 "Ex‹ndšg„e¥Ú£ h—d” w™h %s" % 
	`»´
(
h—d”_li¡
),

259 
ch”rypy
.
£rvšg
.
»¥Ú£
.
h—d”_li¡
.
	$ex‹nd
(
h—d”_li¡
)

260 
ch”rypy
.
toŞs
.
­³nd_h—d”s
 = ch”rypy.
	`ToŞ
('on_end_resource',‡ppend_headers)

262 
şass
 
	$MuÉiH—d”
(
Te¡
):

264 
def
 
	$h—d”_li¡
(
£lf
):

265 
·ss


266 
h—d”_li¡
 = 
ch”rypy
.
toŞs
.
	`­³nd_h—d”s
(header_list=[

267 (
	`Áob
('WWW-Authenticate'),‚tob('Negotiate')),

268 (
	`Áob
('WWW-Authenticate'),‚tob('Basic„ealm="foo"')),

269 ])(
h—d”_li¡
)

271 
def
 
	$commas
(
£lf
):

272 
ch”rypy
.
»¥Ú£
.
h—d”s
['WWW-Authenticate'] = 'Negotiate,Basic„ealm="foo"'

275 
ch”rypy
.
Œ“
.
	$mouÁ
(
roÙ
)

276 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

279 
def
 
	$‹¡Stus
(
£lf
):

280 
£lf
.
	`g‘Page
("/status/")

281 
£lf
.
	`as£¹Body
('normal')

282 
£lf
.
	$as£¹Stus
(200)

284 
£lf
.
	`g‘Page
("/status/blank")

285 
£lf
.
	`as£¹Body
('')

286 
£lf
.
	$as£¹Stus
(200)

288 
£lf
.
	`g‘Page
("/status/illegal")

289 
£lf
.
	$as£¹Stus
(500)

290 
msg
 = "Illegal„esponse status from server (781 is out of„ange)."

291 
£lf
.
	$as£¹E¼ÜPage
(500, 
msg
)

293 
nÙ
 
	`g‘©Œ
(
ch”rypy
.
£rv”
, 'usšg_­ache', 
F®£
):

294 
£lf
.
	`g‘Page
("/status/unknown")

295 
£lf
.
	`as£¹Body
('funky')

296 
£lf
.
	$as£¹Stus
(431)

298 
£lf
.
	`g‘Page
("/status/bad")

299 
£lf
.
	$as£¹Stus
(500)

300 
msg
 = "Illegal„esponse status from server ('error' is‚on-numeric)."

301 
£lf
.
	$as£¹E¼ÜPage
(500, 
msg
)

303 
def
 
	$‹¡_Ú_’d_»sourû_¡©us
(
£lf
):

304 
£lf
.
	`g‘Page
('/status/on_end_resource_stage')

305 
£lf
.
	`as£¹Body
('[]')

306 
£lf
.
	`g‘Page
('/status/on_end_resource_stage')

307 
£lf
.
	`as£¹Body
(
	`»´
(["200 OK"]))

309 
def
 
	$‹¡SÏshes
(
£lf
):

310 #Te¡ 
th©
 
»que¡s
 
šdex
 
m‘hods
 
w™hout
 
a
 
Œašg
 
¦ash


311 #g‘ 
»dœeùed
 
to
 
the
 
§me
 
URI
 
·th
 
w™h
 
a
 
Œašg
 
¦ash
.

312 #Mak
su»
 
GET
 
·¿ms
 
¬e
 
´e£rved
.

313 
£lf
.
	`g‘Page
("/redirect?id=3")

314 
£lf
.
	$as£¹Stus
(301)

315 
£lf
.
	`as£¹InBody
("<a href='%s/redirect/?id=3'>"

316 "%s/»dœeù/?id=3</a>" % (
£lf
.
	`ba£
(), s–f.
	$ba£
()))

318 
£lf
.
	$´efix
():

319 #CÜÃ¸: 
the
 "Œašg sÏsh" 
»dœeù
 
could
 
be
 
Œicky
 

321 
£lf
.
	`g‘Page
("")

322 
£lf
.
	$as£¹Stus
(301)

323 
£lf
.
	`as£¹InBody
("<a href='%s/'>%s/</a>" %

324 (
£lf
.
	`ba£
(), s–f.
	$ba£
()))

326 #Te¡ 
th©
 
»que¡s
 
NON
-
šdex
 
m‘hods
 
WITH
 
a
 
Œašg
 
¦ash


327 #g‘ 
»dœeùed
 
to
 
the
 
§me
 
URI
 
·th
 
WITHOUT
 
a
 
Œašg
 
¦ash
.

328 #Mak
su»
 
GET
 
·¿ms
 
¬e
 
´e£rved
.

329 
£lf
.
	`g‘Page
("/redirect/by_code/?code=307")

330 
£lf
.
	$as£¹Stus
(301)

331 
£lf
.
	`as£¹InBody
("<a href='%s/redirect/by_code?code=307'>"

333 % (
£lf
.
	`ba£
(), s–f.
	$ba£
()))

335 #Ià
the
 
Œašg_¦ash
 
toŞ
 
is
 
off
, 
CP
 
should
 
ju¡
 

336 #a 
the
 
¦ashes
 
w”e
 
cÜ»ù
. 
But
 
™
 
Ãeds
 
some
 
h–p


337 #šsid
ch”rypy
.
u¾
 
to
 
fÜm
 
cÜ»ù
 
ouut
.

338 
£lf
.
	`g‘Page
('/url?path_info=page1')

339 
£lf
.
	`as£¹Body
('%s/u¾/·ge1' % s–f.
	$ba£
())

340 
£lf
.
	`g‘Page
('/url/leaf/?path_info=page1')

341 
£lf
.
	`as£¹Body
('%s/u¾/·ge1' % s–f.
	$ba£
())

343 
def
 
	$‹¡Redœeù
(
£lf
):

344 
£lf
.
	`g‘Page
("/redirect/")

345 
£lf
.
	`as£¹Body
('child')

346 
£lf
.
	$as£¹Stus
(200)

348 
£lf
.
	`g‘Page
("/redirect/by_code?code=300")

349 
£lf
.
	`as£¹M©chesBody
(
r
"<a href='(.*)somewhere%20else'>\1somewhere%20else</a>")

350 
£lf
.
	$as£¹Stus
(300)

352 
£lf
.
	`g‘Page
("/redirect/by_code?code=301")

353 
£lf
.
	`as£¹M©chesBody
(
r
"<a href='(.*)somewhere%20else'>\1somewhere%20else</a>")

354 
£lf
.
	$as£¹Stus
(301)

356 
£lf
.
	`g‘Page
("/redirect/by_code?code=302")

357 
£lf
.
	`as£¹M©chesBody
(
r
"<a href='(.*)somewhere%20else'>\1somewhere%20else</a>")

358 
£lf
.
	$as£¹Stus
(302)

360 
£lf
.
	`g‘Page
("/redirect/by_code?code=303")

361 
£lf
.
	`as£¹M©chesBody
(
r
"<a href='(.*)somewhere%20else'>\1somewhere%20else</a>")

362 
£lf
.
	$as£¹Stus
(303)

364 
£lf
.
	`g‘Page
("/redirect/by_code?code=307")

365 
£lf
.
	`as£¹M©chesBody
(
r
"<a href='(.*)somewhere%20else'>\1somewhere%20else</a>")

366 
£lf
.
	$as£¹Stus
(307)

368 
£lf
.
	`g‘Page
("/redirect/nomodify")

369 
£lf
.
	`as£¹Body
('')

370 
£lf
.
	$as£¹Stus
(304)

372 
£lf
.
	`g‘Page
("/redirect/proxy")

373 
£lf
.
	`as£¹Body
('')

374 
£lf
.
	$as£¹Stus
(305)

376 #HTTPRedœeù 
Ú
 
”rÜ


377 
£lf
.
	`g‘Page
("/redirect/error/")

378 
£lf
.
	`as£¹Stus
(('302 Found', '303 See Other'))

379 
£lf
.
	`as£¹InBody
('/errpage')

381 #Mak
su»
 
	`¡r
(
	`HTTPRedœeù
()è
wÜks
.

382 
£lf
.
	`g‘Page
("/»dœeù/¡ršgify", 
´ÙocŞ
="HTTP/1.0")

383 
£lf
.
	$as£¹Stus
(200)

384 
£lf
.
	`as£¹Body
("(['%s/'], 302)" % s–f.
	$ba£
())

385 
ch”rypy
.
£rv”
.
´ÙocŞ_v”siÚ
 == "HTTP/1.1":

386 
£lf
.
	`g‘Page
("/»dœeù/¡ršgify", 
´ÙocŞ
="HTTP/1.1")

387 
£lf
.
	$as£¹Stus
(200)

388 
£lf
.
	`as£¹Body
("(['%s/'], 303)" % s–f.
	$ba£
())

390 #check 
th©
 #äagm’t 
¬e
 
hªdËd
 
´İ”ly


392 
äag
 = "foo"

393 
£lf
.
	`g‘Page
("/»dœeù/äagm’t/%s" % 
äag
)

394 
£lf
.
	`as£¹M©chesBody
(
r
"<¨h»f='(.*)\/some\/u¾\#%s'>\1\/some\/u¾\#%s</a>" % (
äag
, frag))

395 
loc
 = 
£lf
.
	`as£¹H—d”
('Location')

396 
as£¹
 
loc
.
	`’dsw™h
("#%s" % 
äag
)

397 
£lf
.
	`as£¹Stus
(('302 Found', '303 See Other'))

399 #check 
šjeùiÚ
 
´ÙeùiÚ


400 #S“ 
h‰p
:

401 
£lf
.
	`g‘Page
("/redirect/custom?code=303&url=/foobar/%0d%0aSet-Cookie:%20somecookie=someval")

402 
£lf
.
	$as£¹Stus
(303)

403 
loc
 = 
£lf
.
	`as£¹H—d”
('Location')

404 
as£¹
 'S‘-Cook›' 
š
 
loc


405 
£lf
.
	`as£¹NoH—d”
('Set-Cookie')

407 
def
 
	$‹¡_IÁ”ÇlRedœeù
(
£lf
):

409 
£lf
.
	`g‘Page
("/internalredirect/")

410 
£lf
.
	`as£¹Body
('hello')

411 
£lf
.
	$as£¹Stus
(200)

413 #Te¡ 
·s¡hrough


414 
£lf
.
	`g‘Page
("/internalredirect/petshop?user_id=Sir-not-appearing-in-this-film")

415 
£lf
.
	`as£¹Body
('0 images for Sir-not-appearing-in-this-film')

416 
£lf
.
	$as£¹Stus
(200)

418 #Te¡ 
¬gs


419 
£lf
.
	`g‘Page
("/internalredirect/petshop?user_id=parrot")

420 
£lf
.
	`as£¹Body
('0 images for slug')

421 
£lf
.
	$as£¹Stus
(200)

423 #Te¡ 
POST


424 
£lf
.
	`g‘Page
("/š‹º®»dœeù/³tshİ", 
m‘hod
="POST",

425 
body
="user_id=terrier")

426 
£lf
.
	`as£¹Body
('0 images for fish')

427 
£lf
.
	$as£¹Stus
(200)

429 #Te¡ 
œ
 
befÜe
 
body
 
»ad


430 
£lf
.
	`g‘Page
("/š‹º®»dœeù/—¾y_œ", 
m‘hod
="POST",

431 
body
="arg=aha!")

432 
£lf
.
	`as£¹Body
("Something went horribly wrong.")

433 
£lf
.
	$as£¹Stus
(200)

435 
£lf
.
	`g‘Page
("/internalredirect/secure")

436 
£lf
.
	`as£¹Body
('Please†og in')

437 
£lf
.
	$as£¹Stus
(200)

439 #R–©iv
·th
 
š
 
IÁ”ÇlRedœeù
.

440 #AlsØ
‹¡s
 
»que¡
.
´ev
.

441 
£lf
.
	`g‘Page
("/internalredirect/relative?a=3&b=5")

442 
£lf
.
	`as£¹Body
("a=3&b=5")

443 
£lf
.
	$as£¹Stus
(200)

445 #IÁ”ÇlRedœeù 
Ú
 
”rÜ


446 
£lf
.
	`g‘Page
("/internalredirect/choke")

447 
£lf
.
	$as£¹Stus
(200)

448 
£lf
.
	`as£¹Body
("Something went horribly wrong.")

450 
def
 
	$‹¡FÏ‰’
(
£lf
):

451 
u¾
 
š
 ["/flatten/as_string", "/flatten/as_list",

454 
£lf
.
	$g‘Page
(
u¾
)

455 
£lf
.
	`as£¹Body
('content')

457 
def
 
	$‹¡Rªges
(
£lf
):

458 
£lf
.
	`g‘Page
("/ranges/get_ranges?bytes=3-6")

459 
£lf
.
	`as£¹Body
("[(3, 7)]")

461 #Te¡ 
muÉË
 
¿nges
 
ªd
 
a
 
suffix
-
by‹
-
¿nge
-
¥ec
, 
good
 
m—su»
.

462 
£lf
.
	`g‘Page
("/ranges/get_ranges?bytes=2-4,-1")

463 
£lf
.
	`as£¹Body
("[(2, 5), (7, 8)]")

465 #G‘ 
a
 
·¹Ÿl
 
fe
.

466 
ch”rypy
.
£rv”
.
´ÙocŞ_v”siÚ
 == "HTTP/1.1":

467 
£lf
.
	`g‘Page
("/ranges/slice_file", [('Range', 'bytes=2-5')])

468 
£lf
.
	$as£¹Stus
(206)

469 
£lf
.
	`as£¹H—d”
("Content-Type", "text/html;charset=utf-8")

470 
£lf
.
	`as£¹H—d”
("Content-Range", "bytes 2-5/14")

471 
£lf
.
	`as£¹Body
("llo,")

473 #Wh© 
h­³ns
 
w™h
 
ov”Ïµšg
 
	`¿nges
 (
ªd
 
out
 
of
 
Üd”
, 
too
)?

474 
£lf
.
	`g‘Page
("/ranges/slice_file", [('Range', 'bytes=4-6,2-5')])

475 
£lf
.
	$as£¹Stus
(206)

476 
ù
 = 
£lf
.
	`as£¹H—d”
("Content-Type")

477 
ex³ùed_ty³
 = "multipart/byteranges; boundary="

478 
£lf
.
	`as£¹_
(
ù
.
	$¡¬tsw™h
(
ex³ùed_ty³
))

479 
bound¬y
 = 
ù
[
	$Ën
(
ex³ùed_ty³
):]

480 
ex³ùed_body
 = ("\r\n--%s\r\n"

490 "--%s--\r\n" % (
bound¬y
, boundary, boundary))

491 
£lf
.
	$as£¹Body
(
ex³ùed_body
)

492 
£lf
.
	`as£¹H—d”
("Content-Length")

495 
£lf
.
	`g‘Page
("/ranges/slice_file", [('Range', 'bytes=2300-2900')])

496 
£lf
.
	$as£¹Stus
(416)

497 #"
Wh’
 
this
 
¡©us
 
code
 
is
 
»tuºed
 
a
 
by‹
-
¿nge
 
»que¡
,

498 #th
»¥Ú£
 
SHOULD
 
šşude
 
a
 
CÚ‹Á
-
Rªge
 
’t™y
-
h—d”


499 #f›ld 
¥ecifyšg
 
the
 
cu¼’t
 
Ëngth
 
of
h
£Ëùed
 
»sourû
"

500 
£lf
.
	`as£¹H—d”
("Content-Range", "bytes */14")

501 
–if
 
ch”rypy
.
£rv”
.
´ÙocŞ_v”siÚ
 == "HTTP/1.0":

502 #Te¡ 
Rªge
 
behaviÜ
 
w™h
 
HTTP
/1.0 
»que¡


503 
£lf
.
	`g‘Page
("/ranges/slice_file", [('Range', 'bytes=2-5')])

504 
£lf
.
	$as£¹Stus
(200)

505 
£lf
.
	`as£¹Body
("Hello, world\r\n")

507 
def
 
	$‹¡FavicÚ
(
£lf
):

508 #çvicÚ.
ico
 
is
 
£rved
 
by
 
¡©icfe
.

509 
icof’ame
 = 
os
.
·th
.
	`još
(
loÿlDœ
, "../favicon.ico")

510 
icofe
 = 
	`İ’
(
icof’ame
, "rb")

511 
d©a
 = 
icofe
.
	$»ad
()

512 
icofe
.
	$şo£
()

514 
£lf
.
	`g‘Page
("/favicon.ico")

515 
£lf
.
	$as£¹Body
(
d©a
)

517 
def
 
	$‹¡Cook›s
(
£lf
):

518 
sys
.
v”siÚ_šfo
 >= (2, 5):

519 
h—d”_v®ue
 = 
Ïmbda
 
x
: x

521 
h—d”_v®ue
 = 
Ïmbda
 
x
: x+';'

523 
£lf
.
	`g‘Page
("/cookies/single?name=First",

525 
£lf
.
	`as£¹H—d”
('S‘-Cook›', 
	`h—d”_v®ue
('First=Dinsdale'))

527 
£lf
.
	`g‘Page
("/cookies/multiple?names=First&names=Last",

530 
£lf
.
	`as£¹H—d”
('S‘-Cook›', 
	`h—d”_v®ue
('First=Dinsdale'))

531 
£lf
.
	`as£¹H—d”
('S‘-Cook›', 
	`h—d”_v®ue
('Last=Piranha'))

533 
£lf
.
	`g‘Page
("/cookies/single?name=Something-With:Colon",

535 
£lf
.
	$as£¹Stus
(400)

537 
def
 
	$‹¡DeçuÉCÚ‹ÁTy³
(
£lf
):

538 
£lf
.
	`g‘Page
('/')

539 
£lf
.
	`as£¹H—d”
('Content-Type', 'text/html;charset=utf-8')

540 
£lf
.
	`g‘Page
('/defct/plain')

541 
£lf
.
	`g‘Page
('/')

542 
£lf
.
	`as£¹H—d”
('Content-Type', 'text/plain;charset=utf-8')

543 
£lf
.
	`g‘Page
('/defct/html')

545 
def
 
	$‹¡_muÉË_h—d”s
(
£lf
):

546 
£lf
.
	`g‘Page
('/multiheader/header_list')

547 
£lf
.
	`as£¹Equ®
([(
k
, 
v
èk, v 
š
 s–f.
h—d”s
 k == 'WWW-Authenticate'],

551 
£lf
.
	`g‘Page
('/multiheader/commas')

552 
£lf
.
	`as£¹H—d”
('WWW-Authenticate', 'Negotiate,Basic„ealm="foo"')

554 
def
 
	$‹¡_ch”rypy_u¾
(
£lf
):

555 #IÅuˆ
»Ïtive
 
to
 
cu¼’t


556 
£lf
.
	`g‘Page
('/url/leaf?path_info=page1')

557 
£lf
.
	`as£¹Body
('%s/u¾/·ge1' % s–f.
	$ba£
())

558 
£lf
.
	`g‘Page
('/url/?path_info=page1')

559 
£lf
.
	`as£¹Body
('%s/u¾/·ge1' % s–f.
	$ba£
())

560 #Oth” 
ho¡
 
h—d”


561 
ho¡
 = 'www.mydomain.example'

562 
£lf
.
	`g‘Page
('/url/leaf?path_info=page1',

563 
h—d”s
=[('Ho¡', 
ho¡
)])

564 
£lf
.
	`as£¹Body
('%s://%s/u¾/·ge1' % (£lf.
scheme
, 
ho¡
))

566 #IÅuˆ
is
 'absŞu‹'; 
th©
 is, 
»Ïtive
 
to
 
süt_Çme


567 
£lf
.
	`g‘Page
('/url/leaf?path_info=/page1')

568 
£lf
.
	`as£¹Body
('%s/·ge1' % s–f.
	$ba£
())

569 
£lf
.
	`g‘Page
('/url/?path_info=/page1')

570 
£lf
.
	`as£¹Body
('%s/·ge1' % s–f.
	$ba£
())

572 #SšgË 
dÙs


573 
£lf
.
	`g‘Page
('/url/leaf?path_info=./page1')

574 
£lf
.
	`as£¹Body
('%s/u¾/·ge1' % s–f.
	$ba£
())

575 
£lf
.
	`g‘Page
('/url/leaf?path_info=other/./page1')

576 
£lf
.
	`as£¹Body
('%s/u¾/Ùh”/·ge1' % s–f.
	$ba£
())

577 
£lf
.
	`g‘Page
('/url/?path_info=/other/./page1')

578 
£lf
.
	`as£¹Body
('%s/Ùh”/·ge1' % s–f.
	$ba£
())

580 #DoubË 
dÙs


581 
£lf
.
	`g‘Page
('/url/leaf?path_info=../page1')

582 
£lf
.
	`as£¹Body
('%s/·ge1' % s–f.
	$ba£
())

583 
£lf
.
	`g‘Page
('/url/leaf?path_info=other/../page1')

584 
£lf
.
	`as£¹Body
('%s/u¾/·ge1' % s–f.
	$ba£
())

585 
£lf
.
	`g‘Page
('/url/leaf?path_info=/other/../page1')

586 
£lf
.
	`as£¹Body
('%s/·ge1' % s–f.
	$ba£
())

588 #Ouuˆ
»Ïtive
 
to
 
cu¼’t
 
·th
 
Ü
 
süt_Çme


589 
£lf
.
	`g‘Page
('/url/?path_info=page1&relative=True')

590 
£lf
.
	`as£¹Body
('page1')

591 
£lf
.
	`g‘Page
('/url/leaf?path_info=/page1&relative=True')

592 
£lf
.
	`as£¹Body
('../page1')

593 
£lf
.
	`g‘Page
('/url/leaf?path_info=page1&relative=True')

594 
£lf
.
	`as£¹Body
('page1')

595 
£lf
.
	`g‘Page
('/url/leaf?path_info=leaf/page1&relative=True')

596 
£lf
.
	`as£¹Body
('leaf/page1')

597 
£lf
.
	`g‘Page
('/url/leaf?path_info=../page1&relative=True')

598 
£lf
.
	`as£¹Body
('../page1')

599 
£lf
.
	`g‘Page
('/url/?path_info=other/../page1&relative=True')

600 
£lf
.
	`as£¹Body
('page1')

602 #Ouuˆ
»Ïtive
 
to
 /

603 
£lf
.
	`g‘Page
('/baseurl?path_info=ab&relative=True')

604 
£lf
.
	`as£¹Body
('ab')

605 #Ouuˆ
»Ïtive
 
to
 /

606 
£lf
.
	`g‘Page
('/baseurl?path_info=/ab&relative=True')

607 
£lf
.
	`as£¹Body
('ab')

609 #absŞu‹-
·th
 
	`»ã»nûs
 ("server-relative")

610 #IÅuˆ
»Ïtive
 
to
 
cu¼’t


611 
£lf
.
	`g‘Page
('/url/leaf?path_info=page1&relative=server')

612 
£lf
.
	`as£¹Body
('/url/page1')

613 
£lf
.
	`g‘Page
('/url/?path_info=page1&relative=server')

614 
£lf
.
	`as£¹Body
('/url/page1')

615 #IÅuˆ
is
 'absŞu‹'; 
th©
 is, 
»Ïtive
 
to
 
süt_Çme


616 
£lf
.
	`g‘Page
('/url/leaf?path_info=/page1&relative=server')

617 
£lf
.
	`as£¹Body
('/page1')

618 
£lf
.
	`g‘Page
('/url/?path_info=/page1&relative=server')

619 
£lf
.
	`as£¹Body
('/page1')

621 
def
 
	$‹¡_expo£_decÜ©Ü
(
£lf
):

622 
nÙ
 
sys
.
v”siÚ_šfo
 >= (2, 5):

623  
£lf
.
	`sk
("skipped (Python 2.5+ only) ")

625 #Te¡ @
expo£


626 
£lf
.
	`g‘Page
("/expose_dec/no_call")

627 
£lf
.
	$as£¹Stus
(200)

628 
£lf
.
	`as£¹Body
("Mr E. R. Bradshaw")

630 #Te¡ @
	`expo£
()

631 
£lf
.
	`g‘Page
("/expose_dec/call_empty")

632 
£lf
.
	$as£¹Stus
(200)

633 
£lf
.
	`as£¹Body
("Mrs. B.J. Smegma")

635 #Te¡ @
	`expo£
("alias")

636 
£lf
.
	`g‘Page
("/expose_dec/call_alias")

637 
£lf
.
	$as£¹Stus
(200)

638 
£lf
.
	`as£¹Body
("Mr Nesbitt")

639 #DÛ 
the
 
Üigš®
 
Çme
 
wÜk
?

640 
£lf
.
	`g‘Page
("/expose_dec/nesbitt")

641 
£lf
.
	$as£¹Stus
(200)

642 
£lf
.
	`as£¹Body
("Mr Nesbitt")

644 #Te¡ @
	`expo£
(["alias1", "alias2"])

645 
£lf
.
	`g‘Page
("/expose_dec/alias1")

646 
£lf
.
	$as£¹Stus
(200)

647 
£lf
.
	`as£¹Body
("Mr Ken Andrews")

648 
£lf
.
	`g‘Page
("/expose_dec/alias2")

649 
£lf
.
	$as£¹Stus
(200)

650 
£lf
.
	`as£¹Body
("Mr Ken Andrews")

651 #DÛ 
the
 
Üigš®
 
Çme
 
wÜk
?

652 
£lf
.
	`g‘Page
("/expose_dec/andrews")

653 
£lf
.
	$as£¹Stus
(200)

654 
£lf
.
	`as£¹Body
("Mr Ken Andrews")

656 #Te¡ @
	`expo£
(
®Ÿs
="alias")

657 
£lf
.
	`g‘Page
("/expose_dec/alias3")

658 
£lf
.
	$as£¹Stus
(200)

659 
£lf
.
	`as£¹Body
("Mr.‡nd Mrs. Watson")

662 
şass
 
	$E¼ÜTe¡s
(
h–³r
.
CPWebCa£
):

664 
def
 
	$£tup_£rv”
():

665 
def
 
	$b»ak_h—d”
():

666 #Add 
a
 
h—d”
 
aá”
 
fš®ize
 
th©
 
is
 
šv®id


667 
ch”rypy
.
£rvšg
.
»¥Ú£
.
h—d”_li¡
.
	`­³nd
((2, 3))

668 
ch”rypy
.
toŞs
.
b»ak_h—d”
 = ch”rypy.
	`ToŞ
('on_end_resource', break_header)

670 
şass
 
RoÙ
:

671 
def
 
	$šdex
(
£lf
):

673 
šdex
.
expo£d
 = 
True


675 
def
 
	$¡¬t_»¥Ú£_”rÜ
(
£lf
):

677 
¡¬t_»¥Ú£_”rÜ
.
_ı_cÚfig
 = {'toŞs.b»ak_h—d”.Ú': 
True
}

678 
roÙ
 = 
	$RoÙ
()

680 
ch”rypy
.
Œ“
.
	$mouÁ
(
roÙ
)

681 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

683 
def
 
	$‹¡_¡¬t_»¥Ú£_”rÜ
(
£lf
):

684 
£lf
.
	`g‘Page
("/start_response_error")

685 
£lf
.
	$as£¹Stus
(500)

686 
£lf
.
	`as£¹InBody
("TypeError:„esponse.header_list key 2 is‚ot‡ byte string.")

	@trunk/objs/CherryPy-3.2.4/cherrypy/test/test_dynamicobjectmapping.py

1 
impÜt
 
ch”rypy


2 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
	gsÜ‹d
, 
unicode¡r


3 
äom
 
	gch”rypy
.
_ıŒ“
 
impÜt
 
AµliÿtiÚ


4 
äom
 
	gch”rypy
.
‹¡
 
impÜt
 
h–³r


6 
	gsüt_Çmes
 = ["", "/foo", "/users/fred/blog", "/corp/blog"]

10 
def
 
	$£tup_£rv”
():

11 
şass
 
SubSubRoÙ
:

12 
def
 
	$šdex
(
£lf
):

14 
šdex
.
expo£d
 = 
True


16 
def
 (
£lf
, *
¬gs
):

18 .
expo£d
 = 
True


20 
def
 
	$hªdËr
(
£lf
):

22 
hªdËr
.
expo£d
 = 
True


24 
def
 
	$di¥©ch
(
£lf
):

26 
di¥©ch
.
expo£d
 = 
True


28 
subsubnodes
 = {

29 '1': 
	`SubSubRoÙ
(),

30 '2': 
	`SubSubRoÙ
(),

31 
	}
}

33 
şass
 
SubRoÙ
:

34 
def
 
	$šdex
(
£lf
):

36 
šdex
.
expo£d
 = 
True


38 
def
 (
£lf
, *
¬gs
):

39  "SubRoÙ %s" % (
¬gs
,)

40 .
expo£d
 = 
True


42 
def
 
	$hªdËr
(
£lf
):

44 
hªdËr
.
expo£d
 = 
True


46 
def
 
	$_ı_di¥©ch
(
£lf
, 
v·th
):

47  
subsubnodes
.
	$g‘
(
v·th
[0], 
NÚe
)

49 
subnodes
 = {

50 '1': 
	`SubRoÙ
(),

51 '2': 
	`SubRoÙ
(),

52 
	}
}

53 
şass
 
RoÙ
:

54 
def
 
	$šdex
(
£lf
):

56 
šdex
.
expo£d
 = 
True


58 
def
 (
£lf
, *
¬gs
):

59  "deçuÉ %s" % (
¬gs
,)

60 .
expo£d
 = 
True


62 
def
 
	$hªdËr
(
£lf
):

64 
hªdËr
.
expo£d
 = 
True


66 
def
 
	$_ı_di¥©ch
(
£lf
, 
v·th
):

67  
subnodes
.
	$g‘
(
v·th
[0])

70 #DyÇmicNodeAndM‘hodDi¥©ch” 
exam¶e
.

71 #Thi 
exam¶e
 
expo£s
 
a
 
çœly
 
Çive
 
HTTP
 
­i


72 
şass
 
	$U£r
(
objeù
):

73 
def
 
	$__š™__
(
£lf
, 
id
, 
Çme
):

74 
£lf
.
id
 = id

75 
£lf
.
Çme
 =‚ame

77 
def
 
	$__unicode__
(
£lf
):

78  
	$unicode
(
£lf
.
Çme
)

79 
def
 
	$__¡r__
(
£lf
):

80  
	$¡r
(
£lf
.
Çme
)

82 
u£r_lookup
 = {

83 1: 
	`U£r
(1, 'foo'),

84 2: 
	`U£r
(2, 'bar'),

85 
	}
}

87 
def
 
	$make_u£r
(
Çme
, 
id
=
NÚe
):

88 
nÙ
 
id
:

89 
id
 = 
	`max
(*
	`li¡
(
u£r_lookup
.
	`keys
())) + 1

90 
u£r_lookup
[
id
] = 
	$U£r
(
id
, 
Çme
)

91  
id


93 
şass
 
	$U£rCÚš”Node
(
objeù
):

94 
expo£d
 = 
True


96 
def
 
	$POST
(
£lf
, 
Çme
):

98 
AÎow
 
the
 
ü—tiÚ
 
of
 
a
 
Ãw
 
Objeù


100  "POST %d" % 
	$make_u£r
(
Çme
)

102 
def
 
	$GET
(
£lf
):

103  
	`unicode¡r
(
	`sÜ‹d
(
u£r_lookup
.
	$keys
()))

105 
def
 
	$dyÇmic_di¥©ch
(
£lf
, 
v·th
):

106 
Œy
:

107 
id
 = (
v·th
[0])

108 
	$exû±
 (
V®ueE¼Ü
, 
IndexE¼Ü
):

109  
NÚe


110  
	$U£rIn¡ªûNode
(
id
)

112 
şass
 
	$U£rIn¡ªûNode
(
objeù
):

113 
expo£d
 = 
True


114 
def
 
	$__š™__
(
£lf
, 
id
):

115 
£lf
.
id
 = id

116 
£lf
.
u£r
 = 
u£r_lookup
.
	$g‘
(
id
, 
NÚe
)

118 #FÜ 
®l
 
but
 
PUT
 
m‘hods
 
th”e
 
MUST
 
be
 
a
 
v®id
 
u£r
 
id’tif›d


119 #by 
£lf
.
id


120 
nÙ
 
£lf
.
u£r
 
ªd
 
ch”rypy
.
»que¡
.
m‘hod
 != 'PUT':

121 
¿i£
 
ch”rypy
.
	$HTTPE¼Ü
(404)

123 
def
 
	$GET
(
£lf
, *
¬gs
, **
kw¬gs
):

125 
R‘uº
 
the
 
­´İrŸ‹
 
»´e£Á©iÚ
 
of
h
š¡ªû
.

127  
	$unicode¡r
(
£lf
.
u£r
)

129 
def
 
	$POST
(
£lf
, 
Çme
):

131 
Upd©e
 
the
 
f›lds
 
of
h
u£r
 
š¡ªû
.

133 
£lf
.
u£r
.
Çme
 =‚ame

134  "POST %d" % 
£lf
.
u£r
.
id


136 
def
 
	$PUT
(
£lf
, 
Çme
):

138 
C»©e
 
a
 
Ãw
 
u£r
 
w™h
 
the
 
¥ecif›d
 
id
, 
Ü
 
ed™
 
™
 ™ 
®»ady
 
exi¡s


140 
£lf
.
u£r
:

141 #Ed™ 
the
 
cu¼’t
 
u£r


142 
£lf
.
u£r
.
Çme
 =‚ame

143  "PUT %d" % 
£lf
.
u£r
.
id


145 #Mak
a
 
Ãw
 
u£r
 
w™h
 
§id
 
©Œibu‹s
.

146  "PUT %d" % 
	$make_u£r
(
Çme
, 
£lf
.
id
)

148 
def
 
	$DELETE
(
£lf
):

150 
D–‘e
 
the
 
u£r
 
¥ecif›d
 
©
h
id
.

152 
id
 = 
£lf
.
u£r
.id

153 
d–
 
u£r_lookup
[
£lf
.
u£r
.
id
]

154 
d–
 
£lf
.
u£r


155  "DELETE %d" % 
id


158 
şass
 
ABHªdËr
:

159 
şass
 
Cu¡omDi¥©ch
:

160 
def
 
	$šdex
(
£lf
, 
a
, 
b
):

162 
šdex
.
expo£d
 = 
True


164 
def
 
	$_ı_di¥©ch
(
£lf
, 
v·th
):

166 
´oûssšg
 
¡l
 
wÜks
.

168  
£lf
.
	$Cu¡omDi¥©ch
()

170 
def
 
	$šdex
(
£lf
, 
a
, 
b
=
NÚe
):

171 
body
 = [ 'a:' + 
	`¡r
(
a
) ]

172 
b
 
is
 
nÙ
 
NÚe
:

173 
body
.
	`­³nd
(',b:' + 
	$¡r
(
b
))

174  ''.
	$još
(
body
)

175 
šdex
.
expo£d
 = 
True


177 
def
 
	$d–‘e
(
£lf
, 
a
, 
b
):

178  'd–‘šg ' + 
	`¡r
(
a
è+ '‡nd ' + 
	$¡r
(
b
)

179 
d–‘e
.
expo£d
 = 
True


181 
şass
 
IndexOÆy
:

182 
def
 
	$_ı_di¥©ch
(
£lf
, 
v·th
):

184 
hªdËr
.

186 
v·th
:

187 
v·th
.
	$pİ
()

188  
£lf


190 
def
 
	$šdex
(
£lf
):

192 
šdex
.
expo£d
 = 
True


194 
şass
 
DecÜ©edPİArgs
:

196 
def
 
	$šdex
(
£lf
):

198 
šdex
.
expo£d
 = 
True


200 
def
 
	$hi
(
£lf
):

202 
hi
.
expo£d
 = 
True


203 
DecÜ©edPİArgs
 = 
ch”rypy
.
	`pİ¬gs
('a', 'b', 
hªdËr
=
	$ABHªdËr
())(
DecÜ©edPİArgs
)

205 
şass
 
NÚDecÜ©edPİArgs
:

208 
_ı_di¥©ch
 = 
ch”rypy
.
	`pİ¬gs
('a')

210 
def
 
	$šdex
(
£lf
, 
a
):

211  "šdex: " + 
	$¡r
(
a
)

212 
šdex
.
expo£d
 = 
True


214 
şass
 
P¬am‘”izedHªdËr
:

217 
def
 
	$__š™__
(
£lf
, 
a
):

218 
£lf
.
a
 =‡

220 
def
 
	$šdex
(
£lf
):

221 'a' 
š
 
ch”rypy
.
»que¡
.
·¿ms
:

222 
¿i£
 
	`Exû±iÚ
("Parameterized handler‡rgumentƒnded up in„equest.params")

223  
£lf
.
a


224 
šdex
.
expo£d
 = 
True


226 
şass
 
P¬am‘”izedPİArgs
:

228 
P¬am‘”izedPİArgs
 = 
ch”rypy
.
	`pİ¬gs
('a', 
hªdËr
=
P¬am‘”izedHªdËr
)(ParameterizedPopArgs)

230 
RoÙ
.
decÜ©ed
 = 
	$DecÜ©edPİArgs
()

231 
RoÙ
.
undecÜ©ed
 = 
	$NÚDecÜ©edPİArgs
()

232 
RoÙ
.
šdex_Úly
 = 
	$IndexOÆy
()

233 
RoÙ
.
·¿m‘”_‹¡
 = 
	$P¬am‘”izedPİArgs
()

235 
RoÙ
.
u£rs
 = 
	$U£rCÚš”Node
()

237 
md
 = 
ch”rypy
.
di¥©ch
.
	`M‘hodDi¥©ch”
('dynamic_dispatch')

238 
u¾
 
š
 
süt_Çmes
:

239 
cÚf
 = {'/': {

240 'u£r': (
u¾
 
Ü
 "/").
	`¥l™
("/")[-2],

243 '»que¡.di¥©ch': 
md


245 
	}
}

246 
ch”rypy
.
Œ“
.
mouÁ
(
RoÙ
(), 
u¾
, 
cÚf
)

248 
şass
 
	$DyÇmicObjeùM­pšgTe¡
(
h–³r
.
CPWebCa£
):

249 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

251 
def
 
	$‹¡ObjeùM­pšg
(
£lf
):

252 
u¾
 
š
 
süt_Çmes
:

253 
´efix
 = 
£lf
.
süt_Çme
 = 
u¾


255 
£lf
.
	`g‘Page
('/')

256 
£lf
.
	`as£¹Body
('index')

258 
£lf
.
	`g‘Page
('/handler')

259 
£lf
.
	`as£¹Body
('handler')

261 #DyÇmiø
di¥©ch
 
wl
 
sucûed
 
h”e
 
the
 
subnodes


262 #sØ
the
 
subroÙ
 
g‘s
 
ÿÎed


263 
£lf
.
	`g‘Page
('/1/')

264 
£lf
.
	`as£¹Body
('SubRoot index')

266 
£lf
.
	`g‘Page
('/2/')

267 
£lf
.
	`as£¹Body
('SubRoot index')

269 
£lf
.
	`g‘Page
('/1/handler')

270 
£lf
.
	`as£¹Body
('SubRoot handler')

272 
£lf
.
	`g‘Page
('/2/handler')

273 
£lf
.
	`as£¹Body
('SubRoot handler')

275 #DyÇmiø
di¥©ch
 
wl
 
ç
 
h”e
 
the
 
subnodes


276 #sØ
the
  
g‘s
 
ÿÎed


277 
£lf
.
	`g‘Page
('/asdf/')

278 
£lf
.
	`as£¹Body
("default ('asdf',)")

280 
£lf
.
	`g‘Page
('/asdf/asdf')

281 
£lf
.
	`as£¹Body
("default ('asdf', 'asdf')")

283 
£lf
.
	`g‘Page
('/asdf/handler')

284 
£lf
.
	`as£¹Body
("default ('asdf', 'handler')")

286 #DyÇmiø
di¥©ch
 
wl
 
sucûed
 
h”e
 
the
 
subsubnodes


287 #sØ
the
 
subsubroÙ
 
g‘s
 
ÿÎed


288 
£lf
.
	`g‘Page
('/1/1/')

289 
£lf
.
	`as£¹Body
('SubSubRoot index')

291 
£lf
.
	`g‘Page
('/2/2/')

292 
£lf
.
	`as£¹Body
('SubSubRoot index')

294 
£lf
.
	`g‘Page
('/1/1/handler')

295 
£lf
.
	`as£¹Body
('SubSubRoot handler')

297 
£lf
.
	`g‘Page
('/2/2/handler')

298 
£lf
.
	`as£¹Body
('SubSubRoot handler')

300 
£lf
.
	`g‘Page
('/2/2/dispatch')

301 
£lf
.
	`as£¹Body
('SubSubRoot dispatch')

303 #Th
expo£d
 
di¥©ch
 
wl
 
nÙ
 
be
 
ÿÎed
 
as
 
a
 dispatch

305 
£lf
.
	`g‘Page
('/2/2/foo/foo')

306 
£lf
.
	`as£¹Body
("SubSubRoot default")

308 #DyÇmiø
di¥©ch
 
wl
 
ç
 
h”e
 
the
 
subsubnodes


309 #sØ
the
 
SubRoÙ
 
g‘s
 
ÿÎed


310 
£lf
.
	`g‘Page
('/1/asdf/')

311 
£lf
.
	`as£¹Body
("SubRoot ('asdf',)")

313 
£lf
.
	`g‘Page
('/1/asdf/asdf')

314 
£lf
.
	`as£¹Body
("SubRoot ('asdf', 'asdf')")

316 
£lf
.
	`g‘Page
('/1/asdf/handler')

317 
£lf
.
	`as£¹Body
("SubRoot ('asdf', 'handler')")

319 
def
 
	$‹¡M‘hodDi¥©ch
(
£lf
):

320 #GET 
aùs
 
like
 
a
 
cÚš”


321 
£lf
.
	`g‘Page
("/users")

322 
£lf
.
	`as£¹Body
("[1, 2]")

323 
£lf
.
	`as£¹H—d”
('Allow', 'GET, HEAD, POST')

325 #POST 
to
 
the
 
cÚš”
 
URI
 
®lows
 
ü—tiÚ


326 
£lf
.
	`g‘Page
("/u£rs", 
m‘hod
="POST", 
body
="name=baz")

327 
£lf
.
	`as£¹Body
("POST 3")

328 
£lf
.
	`as£¹H—d”
('Allow', 'GET, HEAD, POST')

330 #POST 
to
 
a
 
¥ecific
 
š¡ªù
 
URI
 
»suÉs
 
š
‡ 404

331 #a 
the
 
»sourû
 
dÛs
 
nÙ
 
ex™
.

332 
£lf
.
	`g‘Page
("/u£rs/5", 
m‘hod
="POST", 
body
="name=baz")

333 
£lf
.
	$as£¹Stus
(404)

335 #PUT 
to
 
a
 
¥ecific
 
š¡ªù
 
URI
 
»suÉs
 
š
 
ü—tiÚ


336 
£lf
.
	`g‘Page
("/u£rs/5", 
m‘hod
="PUT", 
body
="name=boris")

337 
£lf
.
	`as£¹Body
("PUT 5")

338 
£lf
.
	`as£¹H—d”
('Allow', 'DELETE, GET, HEAD, POST, PUT')

340 #GET 
aùs
 
like
 
a
 
cÚš”


341 
£lf
.
	`g‘Page
("/users")

342 
£lf
.
	`as£¹Body
("[1, 2, 3, 5]")

343 
£lf
.
	`as£¹H—d”
('Allow', 'GET, HEAD, POST')

345 
‹¡_ÿ£s
 = (

351 
id
, 
Çme
, 
upd©edÇme
, 
h—d”s
 
š
 
‹¡_ÿ£s
:

352 
£lf
.
	`g‘Page
("/u£rs/%d" % 
id
)

353 
£lf
.
	$as£¹Body
(
Çme
)

354 
£lf
.
	`as£¹H—d”
('AÎow', 
h—d”s
)

356 #Mak
su»
 
POSTs
 
upd©e
 
®»ady
 
exi¡šgs
 
»sourûs


357 
£lf
.
	`g‘Page
("/u£rs/%d" % 
id
, 
m‘hod
='POST', 
body
="Çme=%s" % 
upd©edÇme
)

358 
£lf
.
	`as£¹Body
("POST %d" % 
id
)

359 
£lf
.
	`as£¹H—d”
('AÎow', 
h—d”s
)

361 #Mak
su»
 
PUTs
 
Upd©e
 
®»ady
 
exi¡šg
 
»sourûs
.

362 
£lf
.
	`g‘Page
("/u£rs/%d" % 
id
, 
m‘hod
='PUT', 
body
="Çme=%s" % 
upd©edÇme
)

363 
£lf
.
	`as£¹Body
("PUT %d" % 
id
)

364 
£lf
.
	`as£¹H—d”
('AÎow', 
h—d”s
)

366 #Mak
su»
 
DELETES
 
Remove
 
®»ady
 
exi¡šg
 
»sourûs
.

367 
£lf
.
	`g‘Page
("/u£rs/%d" % 
id
, 
m‘hod
='DELETE')

368 
£lf
.
	`as£¹Body
("DELETE %d" % 
id
)

369 
£lf
.
	`as£¹H—d”
('AÎow', 
h—d”s
)

372 #GET 
aùs
 
like
 
a
 
cÚš”


373 
£lf
.
	`g‘Page
("/users")

374 
£lf
.
	`as£¹Body
("[]")

375 
£lf
.
	`as£¹H—d”
('Allow', 'GET, HEAD, POST')

377 
def
 
	$‹¡V·thDi¥©ch
(
£lf
):

378 
£lf
.
	`g‘Page
("/decorated/")

379 
£lf
.
	`as£¹Body
("no…arams")

381 
£lf
.
	`g‘Page
("/decorated/hi")

382 
£lf
.
	`as£¹Body
("hi was‚ot interpreted‡s 'a'…aram")

384 
£lf
.
	`g‘Page
("/decorated/yo/")

385 
£lf
.
	`as£¹Body
("a:yo")

387 
£lf
.
	`g‘Page
("/decorated/yo/there/")

388 
£lf
.
	`as£¹Body
("a:yo,b:there")

390 
£lf
.
	`g‘Page
("/decorated/yo/there/delete")

391 
£lf
.
	`as£¹Body
("deleting yo‡ndhere")

393 
£lf
.
	`g‘Page
("/decorated/yo/there/handled_by_dispatch/")

394 
£lf
.
	`as£¹Body
("custom")

396 
£lf
.
	`g‘Page
("/undecorated/blah/")

397 
£lf
.
	`as£¹Body
("index: blah")

399 
£lf
.
	`g‘Page
("/index_only/a/b/c/d/e/f/g/")

400 
£lf
.
	`as£¹Body
("IndexOnly index")

402 
£lf
.
	`g‘Page
("/parameter_test/argument2/")

403 
£lf
.
	`as£¹Body
("argument2")

	@trunk/objs/CherryPy-3.2.4/cherrypy/test/test_encoding.py

2 
impÜt
 
gz


3 
impÜt
 
sys


5 
impÜt
 
ch”rypy


6 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
	gBy‹sIO
, 
	gIncom¶‘eR—d
, 
	gÁob
, 
Áou


8 
	geurİoundUnicode
 = 
Áou
('\x80\xa3')

9 
sšg
 = 
Áou
("\u6bdb\u6cfd\u4e1c: Sing, Little Birdie?", 'escape')

10 
	gsšg8
 = 
sšg
.
’code
('utf-8')

11 
sšg16
 = 
sšg
.
’code
('utf-16')

14 
äom
 
ch”rypy
.
‹¡
 
impÜt
 
h–³r


17 
şass
 
	$EncodšgTe¡s
(
h–³r
.
CPWebCa£
):

19 
def
 
	$£tup_£rv”
():

20 
şass
 
RoÙ
:

21 
def
 
	$šdex
(
£lf
, 
·¿m
):

22 
as£¹
 
·¿m
 =ğ
eurİoundUnicode
, "%r != %r" % (param,ƒuropoundUnicode)

23 
y›ld
 
eurİoundUnicode


24 
šdex
.
expo£d
 = 
True


26 
def
 
	$mao_zedÚg
(
£lf
):

27  
sšg


28 
mao_zedÚg
.
expo£d
 = 
True


30 
def
 
	$utf8
(
£lf
):

31  
sšg8


32 
utf8
.
expo£d
 = 
True


33 
utf8
.
_ı_cÚfig
 = {'toŞs.’code.’codšg': 'utf-8'
	}
}

35 
def
 
	$cook›s_ªd_h—d”s
(
£lf
):

36 #ià
the
 
h—d”s
 
have
 
nÚ
-
ascii
 
ch¬aù”s
 
ªd
 
a
 
cook›
 
has


37 #ªy 
·¹
 
which
 
is
 
	`unicode
 (
ev’
 
ascii
), 
the
 
»¥Ú£


38 #should 
nÙ
 
ç
.

39 
ch”rypy
.
»¥Ú£
.
cook›
['candy'] = 'bar'

40 
ch”rypy
.
»¥Ú£
.
cook›
['candy']['domain'] = 'cherrypy.org'

41 
ch”rypy
.
»¥Ú£
.
h—d”s
['Some-Header'] = 'My d\xc3\xb6g has fleas'

43 
cook›s_ªd_h—d”s
.
expo£d
 = 
True


45 
def
 
	$»q·¿ms
(
£lf
, *
¬gs
, **
kw¬gs
):

46  
	`Áob
(', ').
	`još
([": ".još((
k
, 
v
)).
	`’code
('utf8')

47 
k
, 
v
 
š
 
ch”rypy
.
»que¡
.
·¿ms
.
	`™ems
()])

48 
»q·¿ms
.
expo£d
 = 
True


50 
def
 
	$nÚ‹xt
(
£lf
, *
¬gs
, **
kw¬gs
):

51 
ch”rypy
.
»¥Ú£
.
h—d”s
['Content-Type'] = 'application/binary'

53 
nÚ‹xt
.
expo£d
 = 
True


54 
nÚ‹xt
.
_ı_cÚfig
 = {'toŞs.’code.‹xt_Úly': 
F®£
,

55 'toŞs.’code.add_ch¬£t': 
True
,

56 
	}
}

58 
şass
 
GZIP
:

59 
def
 
	$šdex
(
£lf
):

60 
y›ld
 "Hello, world"

61 
šdex
.
expo£d
 = 
True


63 
def
 
	$noshow
(
£lf
):

64 #Te¡ 
tick‘
 #147, 
wh”e
 
y›ld
 
showed
 
no
 
	`exû±iÚs
 (
cÚ‹Á
-

65 #’codšg 
was
 
¡l
 
gz
 
ev’
 
though
 
Œaûback
 
wa¢
't zipped).

66 
¿i£
 
	$IndexE¼Ü
()

67 
y›ld
 "Here be dragons"

68 
noshow
.
expo£d
 = 
True


69 #Tuº 
’codšg
 
off
 
so
 
the
 
gz
 
toŞ
 
is
h
Úe
 
došg
h
cŞÏp£
.

70 
noshow
.
_ı_cÚfig
 = {'toŞs.’code.Ú': 
F®£
}

72 
def
 
	$noshow_¡»am
(
£lf
):

73 #Te¡ 
tick‘
 #147, 
wh”e
 
y›ld
 
showed
 
no
 
	`exû±iÚs
 (
cÚ‹Á
-

74 #’codšg 
was
 
¡l
 
gz
 
ev’
 
though
 
Œaûback
 
wa¢
't zipped).

75 
¿i£
 
	$IndexE¼Ü
()

76 
y›ld
 "Here be dragons"

77 
noshow_¡»am
.
expo£d
 = 
True


78 
noshow_¡»am
.
_ı_cÚfig
 = {'»¥Ú£.¡»am': 
True
}

80 
şass
 
Decode
:

81 
def
 
	$exŒa_ch¬£t
(
£lf
, *
¬gs
, **
kw¬gs
):

82  ', '.
	`još
([": ".još((
k
, 
v
))

83 
k
, 
v
 
š
 
ch”rypy
.
»que¡
.
·¿ms
.
	`™ems
()])

84 
exŒa_ch¬£t
.
expo£d
 = 
True


85 
exŒa_ch¬£t
.
_ı_cÚfig
 = {

86 'toŞs.decode.Ú': 
True
,

88 
	}
}

90 
def
 
	$fÜû_ch¬£t
(
£lf
, *
¬gs
, **
kw¬gs
):

91  ', '.
	`još
([": ".još((
k
, 
v
))

92 
k
, 
v
 
š
 
ch”rypy
.
»que¡
.
·¿ms
.
	`™ems
()])

93 
fÜû_ch¬£t
.
expo£d
 = 
True


94 
fÜû_ch¬£t
.
_ı_cÚfig
 = {

95 'toŞs.decode.Ú': 
True
,

97 
	}
}

99 
roÙ
 = 
	$RoÙ
()

100 
roÙ
.
gz
 = 
	$GZIP
()

101 
roÙ
.
decode
 = 
	$Decode
()

102 
ch”rypy
.
Œ“
.
	`mouÁ
(
roÙ
, 
cÚfig
={'/gz': {'toŞs.gz.Ú': 
True
}
	}
})

103 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

105 
def
 
	$‹¡_qu”y_¡ršg_decodšg
(
£lf
):

106 
eurİoundUtf8
 = 
eurİoundUnicode
.
	`’code
('utf-8')

107 
£lf
.
	`g‘Page
(
	`Áob
('/?·¿m='è+ 
eurİoundUtf8
)

108 
£lf
.
	$as£¹Body
(
eurİoundUtf8
)

110 #Encoded 
utf8
 
qu”y
 
¡ršgs
 
MUST
 
be
 
·r£d
 
cÜ»ùly
.

111 #H”e, 
q
 
is
 
the
 
POUND
 
SIGN
 
U
+00A3 
’coded
 
š
 
utf8
 
ªd
 
th’
 %
HEX


112 
£lf
.
	`g‘Page
("/reqparams?q=%C2%A3")

113 #Th 
v®ue
 
wl
 
be
 
’coded
 
as
 
utf8
.

114 
£lf
.
	`as£¹Body
(
	`Áob
("q: \xc2\xa3"))

116 #Qu”y 
¡ršgs
 
th©
 
¬e
 
šcÜ»ùly
 
’coded
 
MUST
 
¿i£
 404.

117 #H”e, 
q
 
is
 
the
 
POUND
 
SIGN
 
U
+00A3 
’coded
 
š
 
Ïtš1
 
ªd
 
th’
 %
HEX


118 
£lf
.
	`g‘Page
("/reqparams?q=%A3")

119 
£lf
.
	$as£¹Stus
(404)

120 
£lf
.
	`as£¹E¼ÜPage
(404,

124 
def
 
	$‹¡_u¾’coded_decodšg
(
£lf
):

125 #Te¡ 
the
 
decodšg
 
of
 
ª
 
­¶iÿtiÚ
/
x
-
www
-
fÜm
-
u¾’coded
 
’t™y
.

126 
eurİoundUtf8
 = 
eurİoundUnicode
.
	`’code
('utf-8')

127 
body
=
	`Áob
("·¿m="è+ 
eurİoundUtf8


128 
£lf
.
	`g‘Page
('/', 
m‘hod
='POST',

129 
h—d”s
=[("Content-Type", "application/x-www-form-urlencoded"),

130 ("CÚ‹Á-L’gth", 
	`¡r
(
	`Ën
(
body
))),

132 
body
=body),

133 
£lf
.
	$as£¹Body
(
eurİoundUtf8
)

135 #Encoded 
utf8
 
’t™›s
 
MUST
 
be
 
·r£d
 
ªd
 
decoded
 
cÜ»ùly
.

136 #H”e, 
q
 
is
 
the
 
POUND
 
SIGN
 
U
+00A3 
’coded
 
š
 
utf8


137 
body
 = 
	`Áob
("q=\xc2\xa3")

138 
£lf
.
	`g‘Page
('/»q·¿ms', 
m‘hod
='POST',

139 
h—d”s
=[("Content-Type", "application/x-www-form-urlencoded"),

140 ("CÚ‹Á-L’gth", 
	`¡r
(
	`Ën
(
body
))),

142 
body
=body),

143 
£lf
.
	`as£¹Body
(
	`Áob
("q: \xc2\xa3"))

145 #...
ªd
 
š
 
utf16
, 
which
 
is
 
nÙ
 iÀ
the
  
©‹m±_ch¬£ts
 
li¡
:

146 
body
 = 
	`Áob
("\xff\xfeq\x00=\xff\xfe\xa3\x00")

147 
£lf
.
	`g‘Page
('/»q·¿ms', 
m‘hod
='POST',

148 
h—d”s
=[("Content-Type", "application/x-www-form-urlencoded;charset=utf-16"),

149 ("CÚ‹Á-L’gth", 
	`¡r
(
	`Ën
(
body
))),

151 
body
=body),

152 
£lf
.
	`as£¹Body
(
	`Áob
("q: \xc2\xa3"))

154 #EÁ™› 
th©
 
¬e
 
šcÜ»ùly
 
’coded
 
MUST
 
¿i£
 400.

155 #H”e, 
q
 
is
 
the
 
POUND
 
SIGN
 
U
+00A3 
’coded
 
š
 
utf16
, 
but


156 #th
CÚ‹Á
-
Ty³
 
šcÜ»ùly
 
Ïb–s
 
™
 
utf
-8.

157 
body
 = 
	`Áob
("\xff\xfeq\x00=\xff\xfe\xa3\x00")

158 
£lf
.
	`g‘Page
('/»q·¿ms', 
m‘hod
='POST',

159 
h—d”s
=[("Content-Type", "application/x-www-form-urlencoded;charset=utf-8"),

160 ("CÚ‹Á-L’gth", 
	`¡r
(
	`Ën
(
body
))),

162 
body
=body),

163 
£lf
.
	$as£¹Stus
(400)

164 
£lf
.
	`as£¹E¼ÜPage
(400,

168 
def
 
	$‹¡_decode_toŞ
(
£lf
):

169 #AÀ
exŒa
 
ch¬£t
 
should
 
be
 
Œ›d
 
fœ¡
, 
ªd
 
sucûed
 
™
 
m©ches
.

170 #H”e, 
we
 
add
 
utf
-16 
as
 
a
 
ch¬£t
 
ªd
 
·ss
‡ utf-16 
body
.

171 
body
 = 
	`Áob
("\xff\xfeq\x00=\xff\xfe\xa3\x00")

172 
£lf
.
	`g‘Page
('/decode/exŒa_ch¬£t', 
m‘hod
='POST',

173 
h—d”s
=[("Content-Type", "application/x-www-form-urlencoded"),

174 ("CÚ‹Á-L’gth", 
	`¡r
(
	`Ën
(
body
))),

176 
body
=body),

177 
£lf
.
	`as£¹Body
(
	`Áob
("q: \xc2\xa3"))

179 #AÀ
exŒa
 
ch¬£t
 
should
 
be
 
Œ›d
 
fœ¡
, 
ªd
  
to
 
Ùh”
 

180 #ch¬£t 
™
 
dÛ¢
't match.

181 #H”e, 
we
 
add
 
utf
-16 
as
 
a
 
ch¬£t
 
but
 
¡l
 
·ss
‡ utf-8 
body
.

182 
body
 = 
	`Áob
("q=\xc2\xa3")

183 
£lf
.
	`g‘Page
('/decode/exŒa_ch¬£t', 
m‘hod
='POST',

184 
h—d”s
=[("Content-Type", "application/x-www-form-urlencoded"),

185 ("CÚ‹Á-L’gth", 
	`¡r
(
	`Ën
(
body
))),

187 
body
=body),

188 
£lf
.
	`as£¹Body
(
	`Áob
("q: \xc2\xa3"))

190 #AÀ
exŒa
 
ch¬£t
 
should
 
”rÜ
 
fÜû
 
is
 
True
 
ªd
 
™
 
dÛ¢
't match.

191 #H”e, 
we
 
fÜû
 
utf
-16 
as
 
a
 
ch¬£t
 
but
 
¡l
 
·ss
‡ utf-8 
body
.

192 
body
 = 
	`Áob
("q=\xc2\xa3")

193 
£lf
.
	`g‘Page
('/decode/fÜû_ch¬£t', 
m‘hod
='POST',

194 
h—d”s
=[("Content-Type", "application/x-www-form-urlencoded"),

195 ("CÚ‹Á-L’gth", 
	`¡r
(
	`Ën
(
body
))),

197 
body
=body),

198 
£lf
.
	`as£¹E¼ÜPage
(400,

202 
def
 
	$‹¡_muÉ¬t_decodšg
(
£lf
):

203 #Te¡ 
the
 
decodšg
 
of
 
a
 
muÉ¬t
 
’t™y
 
wh’
h
	`ch¬£t
 (
utf16
è
is


204 #ex¶ic™ly 
giv’
.

205 
body
=
	`Áob
('\r\n'.
	`još
(['--X',

216 
£lf
.
	`g‘Page
('/»q·¿ms', 
m‘hod
='POST',

217 
h—d”s
=[("Content-Type", "multipart/form-data;boundary=X"),

218 ("CÚ‹Á-L’gth", 
	`¡r
(
	`Ën
(
body
))),

220 
body
=body),

221 
£lf
.
	`as£¹Body
(
	`Áob
("text:‡b\xe2\x80\x9cc, submit: Create"))

223 
def
 
	$‹¡_muÉ¬t_decodšg_no_ch¬£t
(
£lf
):

224 #Te¡ 
the
 
decodšg
 
of
 
a
 
muÉ¬t
 
’t™y
 
wh’
h
	`ch¬£t
 (
utf8
è
is


225 #NOT 
ex¶ic™ly
 
giv’
, 
but
 
is
 
š
 
the
 
li¡
 
of
 
ch¬£ts
 
to
 
©‹m±
.

226 
body
=
	`Áob
('\r\n'.
	`još
(['--X',

235 
£lf
.
	`g‘Page
('/»q·¿ms', 
m‘hod
='POST',

236 
h—d”s
=[("Content-Type", "multipart/form-data;boundary=X"),

237 ("CÚ‹Á-L’gth", 
	`¡r
(
	`Ën
(
body
))),

239 
body
=body),

240 
£lf
.
	`as£¹Body
(
	`Áob
("text: \xe2\x80\x9c, submit: Create"))

242 
def
 
	$‹¡_muÉ¬t_decodšg_no_sucûssful_ch¬£t
(
£lf
):

243 #Te¡ 
the
 
decodšg
 
of
 
a
 
muÉ¬t
 
’t™y
 
wh’
h
	`ch¬£t
 (
utf16
è
is


244 #NOT 
ex¶ic™ly
 
giv’
, 
ªd
 
is
 
NOT
 
š
 
the
 
li¡
 
of
 
ch¬£ts
 
to
 
©‹m±
.

245 
body
=
	`Áob
('\r\n'.
	`još
(['--X',

254 
£lf
.
	`g‘Page
('/»q·¿ms', 
m‘hod
='POST',

255 
h—d”s
=[("Content-Type", "multipart/form-data;boundary=X"),

256 ("CÚ‹Á-L’gth", 
	`¡r
(
	`Ën
(
body
))),

258 
body
=body),

259 
£lf
.
	$as£¹Stus
(400)

260 
£lf
.
	`as£¹E¼ÜPage
(400,

264 
def
 
	$‹¡_nÚ‹xt
(
£lf
):

265 
£lf
.
	`g‘Page
('/nontext')

266 
£lf
.
	`as£¹H—d”
('Content-Type', 'application/binary;charset=utf-8')

267 
£lf
.
	`as£¹Body
('\x00\x01\x02\x03')

269 
def
 
	$‹¡Encodšg
(
£lf
):

270 #DeçuÉ 
’codšg
 
should
 
be
 
utf
-8

271 
£lf
.
	`g‘Page
('/mao_zedong')

272 
£lf
.
	$as£¹Body
(
sšg8
)

274 #Ask 
utf
-16.

275 
£lf
.
	`g‘Page
('/mao_zedong', [('Accept-Charset', 'utf-16')])

276 
£lf
.
	`as£¹H—d”
('Content-Type', 'text/html;charset=utf-16')

277 
£lf
.
	$as£¹Body
(
sšg16
)

279 #Ask 
muÉË
 
’codšgs
. 
ISO
-8859-1 
should
 
ç
, 
ªd
 
utf
-16

280 #should 
be
 
´oduûd
.

281 
£lf
.
	`g‘Page
('/mao_zedong', [('Accept-Charset',

283 
£lf
.
	$as£¹Body
(
sšg16
)

285 #Th"*" 
v®ue
 
should
  
to
 
our
 
deçuÉ_’codšg
, 
utf
-8

286 
£lf
.
	`g‘Page
('/mao_zedong', [('Accept-Charset', '*;q=1, utf-7;q=.2')])

287 
£lf
.
	$as£¹Body
(
sšg8
)

289 #OÆy 
®low
 
iso
-8859-1, 
which
 
should
 
ç
 
ªd
 
¿i£
 406.

290 
£lf
.
	`g‘Page
('/mao_zedong', [('Accept-Charset', 'iso-8859-1, *;q=0')])

291 
£lf
.
	`as£¹Stus
("406 Not Acceptable")

292 
£lf
.
	`as£¹InBody
("Your client senthis Accept-Charset header: "

296 #Ask 
x
-
mac
-
û
, 
which
 
should
 
be
 
unknown
. 
S“
 
tick‘
 #569.

297 
£lf
.
	`g‘Page
('/mao_zedong', [('Accept-Charset',

299 
£lf
.
	`as£¹Stus
("406 Not Acceptable")

300 
£lf
.
	`as£¹InBody
("Your client senthis Accept-Charset header: "

304 #Te¡ 
the
 '’codšg' 
¬g
 
to
 
’code
.

305 
£lf
.
	`g‘Page
('/utf8')

306 
£lf
.
	$as£¹Body
(
sšg8
)

307 
£lf
.
	`g‘Page
('/utf8', [('Accept-Charset', 'us-ascii, ISO-8859-1')])

308 
£lf
.
	`as£¹Stus
("406 Not Acceptable")

310 
def
 
	$‹¡Gz
(
£lf
):

311 
zbuf
 = 
	$By‹sIO
()

312 
zfe
 = 
gz
.
	`GzFe
(
mode
='wb', 
feobj
=
zbuf
, 
com´es¦ev–
=9)

313 
zfe
.
	`wr™e
(
	`Áob
("Hello, world"))

314 
zfe
.
	$şo£
()

316 
£lf
.
	`g‘Page
('/gz/', 
h—d”s
=[("Accept-Encoding", "gzip")])

317 
£lf
.
	`as£¹InBody
(
zbuf
.
	`g‘v®ue
()[:3])

318 
£lf
.
	`as£¹H—d”
("Vary", "Accept-Encoding")

319 
£lf
.
	`as£¹H—d”
("Content-Encoding", "gzip")

321 #Te¡ 
wh’
 
gz
 
is
 
d’›d
.

322 
£lf
.
	`g‘Page
('/gz/', 
h—d”s
=[("Accept-Encoding", "identity")])

323 
£lf
.
	`as£¹H—d”
("Vary", "Accept-Encoding")

324 
£lf
.
	`as£¹NoH—d”
("Content-Encoding")

325 
£lf
.
	`as£¹Body
("Hello, world")

327 
£lf
.
	`g‘Page
('/gz/', 
h—d”s
=[("Accept-Encoding", "gzip;q=0")])

328 
£lf
.
	`as£¹H—d”
("Vary", "Accept-Encoding")

329 
£lf
.
	`as£¹NoH—d”
("Content-Encoding")

330 
£lf
.
	`as£¹Body
("Hello, world")

332 
£lf
.
	`g‘Page
('/gz/', 
h—d”s
=[("Accept-Encoding", "*;q=0")])

333 
£lf
.
	$as£¹Stus
(406)

334 
£lf
.
	`as£¹NoH—d”
("Content-Encoding")

335 
£lf
.
	`as£¹E¼ÜPage
(406, "identity, gzip")

337 #Te¡ 
tick‘
 #147

338 
£lf
.
	`g‘Page
('/gz/noshow', 
h—d”s
=[("Accept-Encoding", "gzip")])

339 
£lf
.
	`as£¹NoH—d”
('Content-Encoding')

340 
£lf
.
	$as£¹Stus
(500)

341 
£lf
.
	`as£¹E¼ÜPage
(500, 
·‰”n
="IndexError\n")

343 #IÀ
this
 , 
th”e
's‚othing we can doo deliver‡

344 #»adabË 
·ge
, 
sšû
 1è
the
 
gz
 
h—d”
 
is
 
®»ady
 
£t
,

345 #ªd 2è
we
 
may
 
have
 
®»ady
 
wr™‹n
 
some
 
of
 
the
 
body
.

346 #Th
fix
 
is
 
to
 
Ãv”
 
¡»am
 
y›lds
 
wh’
 
usšg
 
gz
.

347 ià(
ch”rypy
.
£rv”
.
´ÙocŞ_v”siÚ
 =ğ"HTTP/1.0" 
Ü


348 
	`g‘©Œ
(
ch”rypy
.
£rv”
, "usšg_­ache", 
F®£
)):

349 
£lf
.
	`g‘Page
('/gzip/noshow_stream',

350 
h—d”s
=[("Accept-Encoding", "gzip")])

351 
£lf
.
	`as£¹H—d”
('Content-Encoding', 'gzip')

352 
£lf
.
	`as£¹InBody
('\x1f\x8b\x08\x00')

354 #Th
wsgi£rv”
 
wl
 
sim¶y
 
¡İ
 
£ndšg
 
d©a
, 
ªd
 
the
 
HTTP
 
ş›Á


355 #wÈ
”rÜ
 
due
 
to
 
ª
 
šcom¶‘e
 
chunk
-
’coded
 
¡»am
.

356 
£lf
.
	`as£¹Rai£s
((
V®ueE¼Ü
, 
Incom¶‘eR—d
), s–f.
g‘Page
,

358 
h—d”s
=[("Accept-Encoding", "gzip")])

360 
def
 
	$‹¡_UnicodeH—d”s
(
£lf
):

361 
£lf
.
	`g‘Page
('/cookies_and_headers')

362 
£lf
.
	`as£¹Body
('Any content')

	@trunk/objs/CherryPy-3.2.4/cherrypy/test/test_etags.py

1 
impÜt
 
ch”rypy


2 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
Áou


3 
äom
 
	gch”rypy
.
‹¡
 
impÜt
 
h–³r


6 
şass
 
	$ETagTe¡
(
h–³r
.
CPWebCa£
):

8 
def
 
	$£tup_£rv”
():

9 
şass
 
RoÙ
:

10 
def
 
	$»sourû
(
£lf
):

12 
»sourû
.
expo£d
 = 
True


14 
def
 
	$ç
(
£lf
, 
code
):

15 
code
 = (code)

16 300 <ğ
code
 <= 399:

17 
¿i£
 
ch”rypy
.
	$HTTPRedœeù
([], 
code
)

19 
¿i£
 
ch”rypy
.
	$HTTPE¼Ü
(
code
)

20 
ç
.
expo£d
 = 
True


22 
def
 
	$unicoded
(
£lf
):

23  
	`Áou
('I‡m‡ \u1ee4nicode string.', 'escape')

24 
unicoded
.
expo£d
 = 
True


25 #IÀ
PythÚ
 3, 
toŞs
.
’code
 
is
 
Ú
 
by
 

26 
unicoded
.
_ı_cÚfig
 = {'toŞs.’code.Ú': 
True
}

28 
cÚf
 = {'/': {'toŞs.‘ags.Ú': 
True
,

29 'toŞs.‘ags.autÙags': 
True
,

31 
ch”rypy
.
Œ“
.
mouÁ
(
RoÙ
(), 
cÚfig
=
cÚf
)

32 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

34 
def
 
	$‹¡_‘ags
(
£lf
):

35 
£lf
.
	`g‘Page
("/resource")

36 
£lf
.
	`as£¹Stus
('200 OK')

37 
£lf
.
	`as£¹H—d”
('Content-Type', 'text/html;charset=utf-8')

38 
£lf
.
	`as£¹Body
('Oh waha goo Siam.')

39 
‘ag
 = 
£lf
.
	`as£¹H—d”
('ETag')

41 #Te¡ 
If
-
	`M©ch
 (
bÙh
 
v®id
 
ªd
 
šv®id
)

42 
£lf
.
	`g‘Page
("/»sourû", 
h—d”s
=[('If-M©ch', 
‘ag
)])

43 
£lf
.
	`as£¹Stus
("200 OK")

44 
£lf
.
	`g‘Page
("/»sourû", 
h—d”s
=[('If-Match', "*")])

45 
£lf
.
	`as£¹Stus
("200 OK")

46 
£lf
.
	`g‘Page
("/»sourû", 
h—d”s
=[('If-M©ch', "*")], 
m‘hod
="POST")

47 
£lf
.
	`as£¹Stus
("200 OK")

48 
£lf
.
	`g‘Page
("/»sourû", 
h—d”s
=[('If-Match', "a bogusag")])

49 
£lf
.
	`as£¹Stus
("412 Precondition Failed")

51 #Te¡ 
If
-
NÚe
-
	`M©ch
 (
bÙh
 
v®id
 
ªd
 
šv®id
)

52 
£lf
.
	`g‘Page
("/»sourû", 
h—d”s
=[('If-NÚe-M©ch', 
‘ag
)])

53 
£lf
.
	$as£¹Stus
(304)

54 
£lf
.
	`g‘Page
("/»sourû", 
m‘hod
='POST', 
h—d”s
=[('If-NÚe-M©ch', 
‘ag
)])

55 
£lf
.
	`as£¹Stus
("412 Precondition Failed")

56 
£lf
.
	`g‘Page
("/»sourû", 
h—d”s
=[('If-None-Match', "*")])

57 
£lf
.
	$as£¹Stus
(304)

58 
£lf
.
	`g‘Page
("/»sourû", 
h—d”s
=[('If-None-Match', "a bogusag")])

59 
£lf
.
	`as£¹Stus
("200 OK")

61 
def
 
	$‹¡_”rÜs
(
£lf
):

62 
£lf
.
	`g‘Page
("/resource")

63 
£lf
.
	$as£¹Stus
(200)

64 
‘ag
 = 
£lf
.
	`as£¹H—d”
('ETag')

66 #Te¡ 
¿isšg
 
”rÜs
 
š
 
·ge
 
hªdËr


67 
£lf
.
	`g‘Page
("/ç/412", 
h—d”s
=[('If-M©ch', 
‘ag
)])

68 
£lf
.
	$as£¹Stus
(412)

69 
£lf
.
	`g‘Page
("/ç/304", 
h—d”s
=[('If-M©ch', 
‘ag
)])

70 
£lf
.
	$as£¹Stus
(304)

71 
£lf
.
	`g‘Page
("/ç/412", 
h—d”s
=[('If-None-Match', "*")])

72 
£lf
.
	$as£¹Stus
(412)

73 
£lf
.
	`g‘Page
("/ç/304", 
h—d”s
=[('If-None-Match', "*")])

74 
£lf
.
	$as£¹Stus
(304)

76 
def
 
	$‹¡_unicode_body
(
£lf
):

77 
£lf
.
	`g‘Page
("/unicoded")

78 
£lf
.
	$as£¹Stus
(200)

79 
‘ag1
 = 
£lf
.
	`as£¹H—d”
('ETag')

80 
£lf
.
	`g‘Page
("/unicoded", 
h—d”s
=[('If-M©ch', 
‘ag1
)])

81 
£lf
.
	$as£¹Stus
(200)

82 
£lf
.
	`as£¹H—d”
('ETag', 
‘ag1
)

	@trunk/objs/CherryPy-3.2.4/cherrypy/test/test_http.py

3 
impÜt
 
”ºo


4 
impÜt
 
mim‘y³s


5 
impÜt
 
sock‘


6 
impÜt
 
sys


8 
impÜt
 
ch”rypy


9 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
	gHTTPCÚÃùiÚ
, 
	gHTTPSCÚÃùiÚ
, 
	gÁob
, 
py3k


12 
def
 
	$’code_muÉ¬t_fÜmd©a
(
fes
):

15 
fes
: 
a
 
£qu’û
 
	$of
 (
Çme
, 
f’ame
, 
v®ue
è
tu¶es
 
muÉ¬t
 
u¶ßds
.

17 
BOUNDARY
 = '________ThIs_Is_tHe_bouNdaRY_$'

18 
L
 = []

19 
key
, 
f’ame
, 
v®ue
 
š
 
fes
:

20 
L
.
	`­³nd
('--' + 
BOUNDARY
)

21 
L
.
	`­³nd
('Content-Disposition: form-data;‚ame="%s"; filename="%s"' %

22 (
key
, 
f’ame
))

23 
ù
 = 
mim‘y³s
.
	`guess_ty³
(
f’ame
)[0] 
Ü
 'application/octet-stream'

24 
L
.
	`­³nd
('CÚ‹Á-Ty³: %s' % 
ù
)

25 
L
.
	`­³nd
('')

26 
L
.
	$­³nd
(
v®ue
)

27 
L
.
	`­³nd
('--' + 
BOUNDARY
 + '--')

28 
L
.
	`­³nd
('')

29 
body
 = '\r\n'.
	$još
(
L
)

30 
cÚ‹Á_ty³
 = 'muÉ¬t/fÜm-d©a; bound¬y=%s' % 
BOUNDARY


31  
cÚ‹Á_ty³
, 
body


36 
äom
 
ch”rypy
.
‹¡
 
impÜt
 
h–³r


38 
şass
 
	$HTTPTe¡s
(
h–³r
.
CPWebCa£
):

40 
def
 
	$£tup_£rv”
():

41 
şass
 
RoÙ
:

42 
def
 
	$šdex
(
£lf
, *
¬gs
, **
kw¬gs
):

44 
šdex
.
expo£d
 = 
True


46 
def
 
	$no_body
(
£lf
, *
¬gs
, **
kw¬gs
):

48 
no_body
.
expo£d
 = 
True


49 
no_body
.
_ı_cÚfig
 = {'»que¡.´oûss_»que¡_body': 
F®£
}

51 
def
 
	$po¡_muÉ¬t
(
£lf
, 
fe
):

52 """R‘uº‡ summ¬y ("
a
 * 65536\
nb
 * 65536") ofhe uploaded file."""

53 
cÚ‹Ás
 = 
fe
.fe.
	$»ad
()

54 
summ¬y
 = []

55 
curch¬
 = 
NÚe


56 
couÁ
 = 0

57 
c
 
š
 
cÚ‹Ás
:

58 
c
 =ğ
curch¬
:

59 
couÁ
 += 1

61 
couÁ
:

62 
py3k
: 
curch¬
 = 
	$chr
(
curch¬
)

63 
summ¬y
.
	`­³nd
("% * %d" % (
curch¬
, 
couÁ
))

64 
couÁ
 = 1

65 
curch¬
 = 
c


66 
couÁ
:

67 
py3k
: 
curch¬
 = 
	$chr
(
curch¬
)

68 
summ¬y
.
	`­³nd
("% * %d" % (
curch¬
, 
couÁ
))

69  ", ".
	$još
(
summ¬y
)

70 
po¡_muÉ¬t
.
expo£d
 = 
True


72 
ch”rypy
.
Œ“
.
	`mouÁ
(
	$RoÙ
())

73 
ch”rypy
.
cÚfig
.
	`upd©e
({'£rv”.max_»que¡_body_size': 30000000
	}
})

74 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

76 
def
 
	$‹¡_no_cÚ‹Á_Ëngth
(
£lf
):

77 #"
The
 
´e£nû
 
of
 
a
 
mes§ge
-
body
 
š
‡ 
»que¡
 
is
 
sigÇËd
 
by
 
the


78 #šşusiÚ 
of
 
a
 
CÚ‹Á
-
L’gth
 
Ü
 
T¿nsãr
-
Encodšg
 
h—d”
 
f›ld
 
š


79 #th
»que¡
's message-headers."

80 #
#S’d 
a
 
mes§ge
 
w™h
 
Ã™h”
 
h—d”
 
ªd
 
no
 
body
. 
Ev’
 
though


81 #th
»que¡
 
is
 
of
 
m‘hod
 
POST
, 
this
 
should
 
be
 
OK
 
beÿu£
 
we
 
£t


82 #»que¡.
´oûss_»que¡_body
 
to
 
F®£
 
our
 
hªdËr
.

83 
£lf
.
scheme
 == "https":

84 
c
 = 
	`HTTPSCÚÃùiÚ
('%s:%s' % (
£lf
.
	`š‹rçû
(), s–f.
PORT
))

86 
c
 = 
	`HTTPCÚÃùiÚ
('%s:%s' % (
£lf
.
	`š‹rçû
(), s–f.
PORT
))

87 
c
.
	`»que¡
("POST", "/no_body")

88 
»¥Ú£
 = 
c
.
	$g‘»¥Ú£
()

89 
£lf
.
body
 = 
»¥Ú£
.
å
.
	$»ad
()

90 
£lf
.
¡©us
 = 
	$¡r
(
»¥Ú£
.
¡©us
)

91 
£lf
.
	$as£¹Stus
(200)

92 
£lf
.
	`as£¹Body
(
	`Áob
('Hello world!'))

94 #Now 
£nd
 
a
 
mes§ge
 
th©
 
has
 
no
 
CÚ‹Á
-
L’gth
, 
but
 
dÛs
 s’d‡ 
body
.

95 #V”ify 
th©
 
CP
 
times
 
out
 
the
 
sock‘
 
ªd
 
»¥Úds


96 #w™h 411 
L’gth
 
Requœed
.

97 
£lf
.
scheme
 == "https":

98 
c
 = 
	`HTTPSCÚÃùiÚ
('%s:%s' % (
£lf
.
	`š‹rçû
(), s–f.
PORT
))

100 
c
 = 
	`HTTPCÚÃùiÚ
('%s:%s' % (
£lf
.
	`š‹rçû
(), s–f.
PORT
))

101 
c
.
	`»que¡
("POST", "/")

102 
»¥Ú£
 = 
c
.
	$g‘»¥Ú£
()

103 
£lf
.
body
 = 
»¥Ú£
.
å
.
	$»ad
()

104 
£lf
.
¡©us
 = 
	$¡r
(
»¥Ú£
.
¡©us
)

105 
£lf
.
	$as£¹Stus
(411)

107 
def
 
	$‹¡_po¡_muÉ¬t
(
£lf
):

108 
®phab‘
 = "abcdefghijklmnopqrstuvwxyz"

109 #g’”©
fe
 
cÚ‹Ás
 
a
 
Ïrge
 
po¡


110 
cÚ‹Ás
 = "".
	$još
([
c
 * 65536 ø
š
 
®phab‘
])

112 #’cod
as
 
muÉ¬t
 
fÜm
 
d©a


113 
fes
=[('fe', 'fe.txt', 
cÚ‹Ás
)]

114 
cÚ‹Á_ty³
, 
body
 = 
	$’code_muÉ¬t_fÜmd©a
(
fes
)

115 
body
 = body.
	`’code
('Latin-1')

117 #po¡ 
fe


118 
£lf
.
scheme
 == 'https':

119 
c
 = 
	`HTTPSCÚÃùiÚ
('%s:%s' % (
£lf
.
	`š‹rçû
(), s–f.
PORT
))

121 
c
 = 
	`HTTPCÚÃùiÚ
('%s:%s' % (
£lf
.
	`š‹rçû
(), s–f.
PORT
))

122 
c
.
	`puŒeque¡
('POST', '/post_multipart')

123 
c
.
	`puth—d”
('CÚ‹Á-Ty³', 
cÚ‹Á_ty³
)

124 
c
.
	`puth—d”
('CÚ‹Á-L’gth', 
	`¡r
(
	$Ën
(
body
)))

125 
c
.
	$’dh—d”s
()

126 
c
.
	$£nd
(
body
)

128 
»¥Ú£
 = 
c
.
	$g‘»¥Ú£
()

129 
£lf
.
body
 = 
»¥Ú£
.
å
.
	$»ad
()

130 
£lf
.
¡©us
 = 
	$¡r
(
»¥Ú£
.
¡©us
)

131 
£lf
.
	$as£¹Stus
(200)

132 
£lf
.
	`as£¹Body
(", ".
	`još
(["% * 65536" % 
c
 ø
š
 
®phab‘
]))

134 
def
 
	$‹¡_m®fÜmed_»que¡_lše
(
£lf
):

135 
	`g‘©Œ
(
ch”rypy
.
£rv”
, "usšg_­ache", 
F®£
):

136  
£lf
.
	`sk
("skipped dueo known Apache differences...")

138 #Te¡ 
missšg
 
v”siÚ
 
š
 
Reque¡
-
Lše


139 
£lf
.
scheme
 == 'https':

140 
c
 = 
	`HTTPSCÚÃùiÚ
('%s:%s' % (
£lf
.
	`š‹rçû
(), s–f.
PORT
))

142 
c
 = 
	`HTTPCÚÃùiÚ
('%s:%s' % (
£lf
.
	`š‹rçû
(), s–f.
PORT
))

143 
c
.
	`_ouut
(
	`Áob
('GET /'))

144 
c
.
	$_£nd_ouut
()

145 
	`ha§‰r
(
c
, 'strict'):

146 
»¥Ú£
 = 
c
.
	`»¥Ú£_şass
(c.
sock
, 
¡riù
=c.¡riù, 
m‘hod
='GET')

148 #PythÚ 3.2 
»moved
 
the
 '¡riù' 
ã©u»
, 
§yšg
:

149 #"
h‰p
.
ş›Á
 
now
 
®ways
 
assumes
 
HTTP
/1.x 
com¶ŸÁ
 
£rv”s
."

150 
»¥Ú£
 = 
c
.
	`»¥Ú£_şass
(c.
sock
, 
m‘hod
='GET')

151 
»¥Ú£
.
	$begš
()

152 
£lf
.
	$as£¹Equ®
(
»¥Ú£
.
¡©us
, 400)

153 
£lf
.
	`as£¹Equ®
(
»¥Ú£
.
å
.
	`»ad
(22), 
	`Áob
("Malformed Request-Line"))

154 
c
.
	$şo£
()

156 
def
 
	$‹¡_m®fÜmed_h—d”
(
£lf
):

157 
£lf
.
scheme
 == 'https':

158 
c
 = 
	`HTTPSCÚÃùiÚ
('%s:%s' % (
£lf
.
	`š‹rçû
(), s–f.
PORT
))

160 
c
 = 
	`HTTPCÚÃùiÚ
('%s:%s' % (
£lf
.
	`š‹rçû
(), s–f.
PORT
))

161 
c
.
	`puŒeque¡
('GET', '/')

162 
c
.
	`puth—d”
('Content-Type', 'text/plain')

163 #S“ 
h‰p
:

164 
c
.
	`_ouut
(
	`Áob
('Re, 1.2.3.4#015#012'))

165 
c
.
	$’dh—d”s
()

167 
»¥Ú£
 = 
c
.
	$g‘»¥Ú£
()

168 
£lf
.
¡©us
 = 
	$¡r
(
»¥Ú£
.
¡©us
)

169 
£lf
.
	$as£¹Stus
(400)

170 
£lf
.
body
 = 
»¥Ú£
.
å
.
	$»ad
(20)

171 
£lf
.
	`as£¹Body
("Illegal header†ine.")

173 
def
 
	$‹¡_h‰p_ov”_h‰ps
(
£lf
):

174 
£lf
.
scheme
 != 'https':

175  
£lf
.
	`sk
("skipped (not„unning HTTPS)... ")

177 #Try 
cÚÃùšg
 
w™hout
 
SSL
.

178 
cÚn
 = 
	`HTTPCÚÃùiÚ
('%s:%s' % (
£lf
.
	`š‹rçû
(), s–f.
PORT
))

179 
cÚn
.
	`puŒeque¡
("GET", "/", 
sk_ho¡
=
True
)

180 
cÚn
.
	`puth—d”
("Ho¡", 
£lf
.
HOST
)

181 
cÚn
.
	$’dh—d”s
()

182 
»¥Ú£
 = 
cÚn
.
	`»¥Ú£_şass
(cÚn.
sock
, 
m‘hod
="GET")

183 
Œy
:

184 
»¥Ú£
.
	$begš
()

185 
£lf
.
	$as£¹Equ®
(
»¥Ú£
.
¡©us
, 400)

186 
£lf
.
body
 = 
»¥Ú£
.
	$»ad
()

187 
£lf
.
	`as£¹Body
("The client sent‡…lain HTTP„equest, buthis "

189 
exû±
 
sock‘
.
”rÜ
:

190 
e
 = 
sys
.
	`exc_šfo
()[1]

191 #"
CÚÃùiÚ
 
»£t
 
by
 
³”
" is‡lso‡cceptable.

192 
e
.
”ºo
 !ğ”ºo.
ECONNRESET
:

193 
¿i£


195 
def
 
	$‹¡_g¬bage_š
(
£lf
):

196 #CÚÃù 
w™hout
 
SSL
 
»g¬dËss
 
of
 
£rv”
.
scheme


197 
c
 = 
	`HTTPCÚÃùiÚ
('%s:%s' % (
£lf
.
	`š‹rçû
(), s–f.
PORT
))

198 
c
.
	`_ouut
(
	`Áob
('gjkgjklsgjklsgjkljklsg'))

199 
c
.
	$_£nd_ouut
()

200 
»¥Ú£
 = 
c
.
	`»¥Ú£_şass
(c.
sock
, 
m‘hod
="GET")

201 
Œy
:

202 
»¥Ú£
.
	$begš
()

203 
£lf
.
	$as£¹Equ®
(
»¥Ú£
.
¡©us
, 400)

204 
£lf
.
	`as£¹Equ®
(
»¥Ú£
.
å
.
	`»ad
(22), 
	`Áob
("Malformed Request-Line"))

205 
c
.
	$şo£
()

206 
exû±
 
sock‘
.
”rÜ
:

207 
e
 = 
sys
.
	`exc_šfo
()[1]

208 #"
CÚÃùiÚ
 
»£t
 
by
 
³”
" is‡lso‡cceptable.

209 
e
.
”ºo
 !ğ”ºo.
ECONNRESET
:

210 
¿i£


	@trunk/objs/CherryPy-3.2.4/cherrypy/test/test_httpauth.py

1 
impÜt
 
ch”rypy


2 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
	gmd5
, 
	gsha
, 
Áob


3 
äom
 
	gch”rypy
.
lib
 
impÜt
 
h‰·uth


5 
äom
 
	gch”rypy
.
‹¡
 
impÜt
 
h–³r


7 
şass
 
	$HTTPAuthTe¡
(
h–³r
.
CPWebCa£
):

9 
def
 
	$£tup_£rv”
():

10 
şass
 
RoÙ
:

11 
def
 
	$šdex
(
£lf
):

13 
šdex
.
expo£d
 = 
True


15 
şass
 
Dige¡PrÙeùed
:

16 
def
 
	$šdex
(
£lf
):

17  "H–lØ%s, you'vb“ÀauthÜized." % 
ch”rypy
.
»que¡
.
logš


18 
šdex
.
expo£d
 = 
True


20 
şass
 
BasicPrÙeùed
:

21 
def
 
	$šdex
(
£lf
):

22  "H–lØ%s, you'vb“ÀauthÜized." % 
ch”rypy
.
»que¡
.
logš


23 
šdex
.
expo£d
 = 
True


25 
şass
 
BasicPrÙeùed2
:

26 
def
 
	$šdex
(
£lf
):

27  "H–lØ%s, you'vb“ÀauthÜized." % 
ch”rypy
.
»que¡
.
logš


28 
šdex
.
expo£d
 = 
True


30 
def
 
	$ãtch_u£rs
():

31  {'‹¡': '‹¡'
	}
}

33 
def
 
	$sha_·sswÜd_’üy±”
(
·sswÜd
):

34  
	`sha
(
	`Áob
(
·sswÜd
)).
	$hexdige¡
()

36 
def
 
	$ãtch_·sswÜd
(
u£ºame
):

37  
	`sha
(
	`Áob
('‹¡')).
	$hexdige¡
()

39 
cÚf
 = {'/dige¡': {'toŞs.dige¡_auth.Ú': 
True
,

41 'toŞs.dige¡_auth.u£rs': 
ãtch_u£rs
},

42 '/basic': {'toŞs.basic_auth.Ú': 
True
,

44 'toŞs.basic_auth.u£rs': {'‹¡': 
	`md5
(
	`Áob
('‹¡')).
	`hexdige¡
()}},

45 '/basic2': {'toŞs.basic_auth.Ú': 
True
,

47 'toŞs.basic_auth.u£rs': 
ãtch_·sswÜd
,

48 'toŞs.basic_auth.’üy±': 
sha_·sswÜd_’üy±”
}
	}
}

50 
roÙ
 = 
	$RoÙ
()

51 
roÙ
.
dige¡
 = 
	$Dige¡PrÙeùed
()

52 
roÙ
.
basic
 = 
	$BasicPrÙeùed
()

53 
roÙ
.
basic2
 = 
	$BasicPrÙeùed2
()

54 
ch”rypy
.
Œ“
.
	$mouÁ
(
roÙ
, 
cÚfig
=
cÚf
)

55 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

58 
def
 
	$‹¡Public
(
£lf
):

59 
£lf
.
	`g‘Page
("/")

60 
£lf
.
	`as£¹Stus
('200 OK')

61 
£lf
.
	`as£¹H—d”
('Content-Type', 'text/html;charset=utf-8')

62 
£lf
.
	`as£¹Body
('This is…ublic.')

64 
def
 
	$‹¡Basic
(
£lf
):

65 
£lf
.
	`g‘Page
("/basic/")

66 
£lf
.
	$as£¹Stus
(401)

67 
£lf
.
	`as£¹H—d”
('WWW-Authenticate', 'Basic„ealm="localhost"')

69 
£lf
.
	`g‘Page
('/basic/', [('Authorization', 'Basic dGVzdDp0ZX60')])

70 
£lf
.
	$as£¹Stus
(401)

72 
£lf
.
	`g‘Page
('/basic/', [('Authorization', 'Basic dGVzdDp0ZXN0')])

73 
£lf
.
	`as£¹Stus
('200 OK')

74 
£lf
.
	`as£¹Body
("Helloest, you've been‡uthorized.")

76 
def
 
	$‹¡Basic2
(
£lf
):

77 
£lf
.
	`g‘Page
("/basic2/")

78 
£lf
.
	$as£¹Stus
(401)

79 
£lf
.
	`as£¹H—d”
('WWW-Authenticate', 'Basic„ealm="localhost"')

81 
£lf
.
	`g‘Page
('/basic2/', [('Authorization', 'Basic dGVzdDp0ZX60')])

82 
£lf
.
	$as£¹Stus
(401)

84 
£lf
.
	`g‘Page
('/basic2/', [('Authorization', 'Basic dGVzdDp0ZXN0')])

85 
£lf
.
	`as£¹Stus
('200 OK')

86 
£lf
.
	`as£¹Body
("Helloest, you've been‡uthorized.")

88 
def
 
	$‹¡Dige¡
(
£lf
):

89 
£lf
.
	`g‘Page
("/digest/")

90 
£lf
.
	$as£¹Stus
(401)

92 
v®ue
 = 
NÚe


93 
k
, 
v
 
š
 
£lf
.
h—d”s
:

94 
k
.
	`low”
() == "www-authenticate":

95 
v
.
	`¡¬tsw™h
("Digest"):

96 
v®ue
 = 
v


99 
v®ue
 
is
 
NÚe
:

100 
£lf
.
	`_hªdËwebE¼Ü
("Digest‡uthentification scheme was‚ot found")

102 
v®ue
 = value[7:]

103 
™ems
 = 
v®ue
.
	`¥l™
(', ')

104 
tok’s
 = {
	}
}

105 
™em
 
š
 
™ems
:

106 
key
, 
	gv®ue
 = 
™em
.
¥l™
('=')

107 
tok’s
[
key
.
low”
()] = 
v®ue


109 
missšg_msg
 = "%s is missing"

110 
bad_v®ue_msg
 = "'%s' wasƒxpecting '%s' but found '%s'"

111 
nÚû
 = 
NÚe


112 '»®m' 
nÙ
 
š
 
tok’s
:

113 
£lf
.
_hªdËwebE¼Ü
(
missšg_msg
 % 'realm')

114 
–if
 
tok’s
['realm'] != '"localhost"':

115 
£lf
.
_hªdËwebE¼Ü
(
bad_v®ue_msg
 % ('»®m', '"loÿlho¡"', 
tok’s
['realm']))

116 'nÚû' 
nÙ
 
š
 
	gtok’s
:

117 
£lf
.
_hªdËwebE¼Ü
(
missšg_msg
 % 'nonce')

119 
nÚû
 = 
tok’s
['nÚû'].
¡r
('"')

120 '®gÜ™hm' 
nÙ
 
š
 
tok’s
:

121 
£lf
.
_hªdËwebE¼Ü
(
missšg_msg
 % 'algorithm')

122 
–if
 
tok’s
['algorithm'] != '"MD5"':

123 
£lf
.
_hªdËwebE¼Ü
(
bad_v®ue_msg
 % ('®gÜ™hm', '"MD5"', 
tok’s
['algorithm']))

124 'qİ' 
nÙ
 
š
 
	gtok’s
:

125 
£lf
.
_hªdËwebE¼Ü
(
missšg_msg
 % 'qop')

126 
–if
 
tok’s
['qop'] != '"auth"':

127 
£lf
.
_hªdËwebE¼Ü
(
bad_v®ue_msg
 % ('qİ', '"auth"', 
tok’s
['qop']))

129 #Te¡ 
a
 
wrÚg
 '»®m' 
v®ue


130 
	gba£_auth
 = 'Digest username="test",„ealm="wrong„ealm",‚once="%s", uri="/digest/",‡lgorithm=MD5,„esponse="%s", qop=auth,‚c=%s, cnonce="1522e61005789929"'

132 
auth
 = 
ba£_auth
 % (
nÚû
, '', '00000001')

133 
	g·¿ms
 = 
h‰·uth
.
	$·r£AuthÜiz©iÚ
(
auth
)

134 
»¥Ú£
 = 
h‰·uth
.
	`_compu‹Dige¡Re¥Ú£
(
·¿ms
, 'test')

136 
auth
 = 
ba£_auth
 % (
nÚû
, 
»¥Ú£
, '00000001')

137 
£lf
.
	`g‘Page
('/dige¡/', [('AuthÜiz©iÚ', 
auth
)])

138 
£lf
.
	$as£¹Stus
(401)

140 #Te¡ 
th©
 
mu¡
 
·ss


141 
ba£_auth
 = 'Digest username="test",„ealm="localhost",‚once="%s", uri="/digest/",‡lgorithm=MD5,„esponse="%s", qop=auth,‚c=%s, cnonce="1522e61005789929"'

143 
auth
 = 
ba£_auth
 % (
nÚû
, '', '00000001')

144 
·¿ms
 = 
h‰·uth
.
	$·r£AuthÜiz©iÚ
(
auth
)

145 
»¥Ú£
 = 
h‰·uth
.
	`_compu‹Dige¡Re¥Ú£
(
·¿ms
, 'test')

147 
auth
 = 
ba£_auth
 % (
nÚû
, 
»¥Ú£
, '00000001')

148 
£lf
.
	`g‘Page
('/dige¡/', [('AuthÜiz©iÚ', 
auth
)])

149 
£lf
.
	`as£¹Stus
('200 OK')

150 
£lf
.
	`as£¹Body
("Helloest, you've been‡uthorized.")

	@trunk/objs/CherryPy-3.2.4/cherrypy/test/test_httplib.py

3 
impÜt
 
un™‹¡


4 
äom
 
	gch”rypy
.
lib
 
impÜt
 
h‰put


7 
şass
 
	$Ut™yTe¡s
(
un™‹¡
.
Te¡Ca£
):

9 
def
 
	$‹¡_u¾još
(
£lf
):

10 #Te¡ 
®l
 
¦ash
+
©om
 
combš©iÚs
 
SCRIPT_NAME
 
ªd
 
PATH_INFO


11 
£lf
.
	`as£¹Equ®
(
h‰put
.
	`u¾još
("/sn/", "/pi/"), "/sn/pi/")

12 
£lf
.
	`as£¹Equ®
(
h‰put
.
	`u¾još
("/sn/", "/pi"), "/sn/pi")

13 
£lf
.
	`as£¹Equ®
(
h‰put
.
	`u¾još
("/sn/", "/"), "/sn/")

14 
£lf
.
	`as£¹Equ®
(
h‰put
.
	`u¾još
("/sn/", ""), "/sn/")

15 
£lf
.
	`as£¹Equ®
(
h‰put
.
	`u¾još
("/sn", "/pi/"), "/sn/pi/")

16 
£lf
.
	`as£¹Equ®
(
h‰put
.
	`u¾još
("/sn", "/pi"), "/sn/pi")

17 
£lf
.
	`as£¹Equ®
(
h‰put
.
	`u¾još
("/sn", "/"), "/sn/")

18 
£lf
.
	`as£¹Equ®
(
h‰put
.
	`u¾još
("/sn", ""), "/sn")

19 
£lf
.
	`as£¹Equ®
(
h‰put
.
	`u¾još
("/", "/pi/"), "/pi/")

20 
£lf
.
	`as£¹Equ®
(
h‰put
.
	`u¾još
("/", "/pi"), "/pi")

21 
£lf
.
	`as£¹Equ®
(
h‰put
.
	`u¾još
("/", "/"), "/")

22 
£lf
.
	`as£¹Equ®
(
h‰put
.
	`u¾još
("/", ""), "/")

23 
£lf
.
	`as£¹Equ®
(
h‰put
.
	`u¾još
("", "/pi/"), "/pi/")

24 
£lf
.
	`as£¹Equ®
(
h‰put
.
	`u¾još
("", "/pi"), "/pi")

25 
£lf
.
	`as£¹Equ®
(
h‰put
.
	`u¾još
("", "/"), "/")

26 
£lf
.
	`as£¹Equ®
(
h‰put
.
	`u¾još
("", ""), "/")

28 
__Çme__
 == '__main__':

29 
un™‹¡
.
	`maš
()

	@trunk/objs/CherryPy-3.2.4/cherrypy/test/test_json.py

1 
impÜt
 
ch”rypy


2 
äom
 
	gch”rypy
.
‹¡
 
impÜt
 
h–³r


4 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
jsÚ


6 
şass
 
	$JsÚTe¡
(
h–³r
.
CPWebCa£
):

7 
def
 
	$£tup_£rv”
():

8 
şass
 
	$RoÙ
(
objeù
):

9 
def
 
	$¶aš
(
£lf
):

11 
¶aš
.
expo£d
 = 
True


13 
def
 
	$jsÚ_¡ršg
(
£lf
):

15 
jsÚ_¡ršg
.
expo£d
 = 
True


16 
jsÚ_¡ršg
.
_ı_cÚfig
 = {'toŞs.jsÚ_out.Ú': 
True
}

18 
def
 
	$jsÚ_li¡
(
£lf
):

20 
jsÚ_li¡
.
expo£d
 = 
True


21 
jsÚ_li¡
.
_ı_cÚfig
 = {'toŞs.jsÚ_out.Ú': 
True
}

23 
def
 
	$jsÚ_diù
(
£lf
):

24  {'ªsw”': 42
	}
}

25 
jsÚ_diù
.
expo£d
 = 
True


26 
jsÚ_diù
.
_ı_cÚfig
 = {'toŞs.jsÚ_out.Ú': 
True
}

28 
def
 
	$jsÚ_po¡
(
£lf
):

29 
ch”rypy
.
»que¡
.
jsÚ
 == [13, 'c']:

33 
jsÚ_po¡
.
expo£d
 = 
True


34 
jsÚ_po¡
.
_ı_cÚfig
 = {'toŞs.jsÚ_š.Ú': 
True
}

36 
roÙ
 = 
	$RoÙ
()

37 
ch”rypy
.
Œ“
.
	$mouÁ
(
roÙ
)

38 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

40 
def
 
	$‹¡_jsÚ_ouut
(
£lf
):

41 
jsÚ
 
is
 
NÚe
:

42 
£lf
.
	`sk
("json‚ot found ")

45 
£lf
.
	`g‘Page
("/plain")

46 
£lf
.
	`as£¹Body
("hello")

48 
£lf
.
	`g‘Page
("/json_string")

49 
£lf
.
	`as£¹Body
('"hello"')

51 
£lf
.
	`g‘Page
("/json_list")

52 
£lf
.
	`as£¹Body
('["a", "b", 42]')

54 
£lf
.
	`g‘Page
("/json_dict")

55 
£lf
.
	`as£¹Body
('{"answer": 42}')

57 
def
 
	$‹¡_jsÚ_šput
(
£lf
):

58 
jsÚ
 
is
 
NÚe
:

59 
£lf
.
	`sk
("json‚ot found ")

62 
body
 = '[13, "c"]'

63 
h—d”s
 = [('Content-Type', 'application/json'),

64 ('CÚ‹Á-L’gth', 
	`¡r
(
	`Ën
(
body
)))]

65 
£lf
.
	`g‘Page
("/jsÚ_po¡", 
m‘hod
="POST", 
h—d”s
=h—d”s, 
body
=body)

66 
£lf
.
	`as£¹Body
('ok')

68 
body
 = '[13, "c"]'

69 
h—d”s
 = [('Content-Type', 'text/plain'),

70 ('CÚ‹Á-L’gth', 
	`¡r
(
	`Ën
(
body
)))]

71 
£lf
.
	`g‘Page
("/jsÚ_po¡", 
m‘hod
="POST", 
h—d”s
=h—d”s, 
body
=body)

72 
£lf
.
	`as£¹Stus
(415, 'Expected‡n‡pplication/json contentype')

74 
body
 = '[13, -]'

75 
h—d”s
 = [('Content-Type', 'application/json'),

76 ('CÚ‹Á-L’gth', 
	`¡r
(
	`Ën
(
body
)))]

77 
£lf
.
	`g‘Page
("/jsÚ_po¡", 
m‘hod
="POST", 
h—d”s
=h—d”s, 
body
=body)

78 
£lf
.
	`as£¹Stus
(400, 'Invalid JSON document')

	@trunk/objs/CherryPy-3.2.4/cherrypy/test/test_logging.py

3 
impÜt
 
os


4 
	gloÿlDœ
 = 
os
.
·th
.
	$dœÇme
(
__fe__
)

6 
impÜt
 
ch”rypy


7 
äom
 
ch”rypy
.
_ıcom·t
 
impÜt
 
Áob
, 
Áou
, 
py3k


9 
acûss_log
 = 
os
.
·th
.
	`još
(
loÿlDœ
, "access.log")

10 
”rÜ_log
 = 
os
.
·th
.
	`još
(
loÿlDœ
, "error.log")

12 #Som
unicode
 
¡ršgs
.

13 
¹¬os
 = 
	`Áou
('\u03a4\u1f71\u03c1\u03c4\u03b1\u03c1\u03bf\u03c2', 'escape')

14 
”ebos
 = 
	`Áou
('\u0388\u03c1\u03b5\u03b2\u03bf\u03c2.com', 'escape')

17 
def
 
	$£tup_£rv”
():

18 
şass
 
RoÙ
:

20 
def
 
	$šdex
(
£lf
):

22 
šdex
.
expo£d
 = 
True


24 
def
 
	$uni_code
(
£lf
):

25 
ch”rypy
.
»que¡
.
logš
 = 
¹¬os


26 
ch”rypy
.
»que¡
.
»mÙe
.
Çme
 = 
”ebos


27 
uni_code
.
expo£d
 = 
True


29 
def
 
	$¦ashes
(
£lf
):

30 
ch”rypy
.
»que¡
.
»que¡_lše
 = 
r
'GET /slashed\path HTTP/1.1'

31 
¦ashes
.
expo£d
 = 
True


33 
def
 
	$wh™e¥aû
(
£lf
):

34 #U£r-
Ag’t
 = "U£r-Ag’t" ":" 1*Ğ
´oduù
 | 
comm’t
 )

35 #comm’ˆğ"(" *Ğ
ùext
 | 
quÙed
-
·œ
 | 
comm’t
 ) ")"

36 #ùexˆğ<
ªy
 
TEXT
 
exşudšg
 "(" 
ªd
 ")">

37 #TEXT = <
ªy
 
OCTET
 
exû±
 
CTLs
, 
but
 
šşudšg
 
LWS
>

38 #LWS = [
CRLF
] 1*Ğ
SP
 | 
HT
 )

39 
ch”rypy
.
»que¡
.
h—d”s
['User-Agent'] = 'Browzuh (1.0\r\n\t\t.3)'

40 
wh™e¥aû
.
expo£d
 = 
True


42 
def
 
	$as_¡ršg
(
£lf
):

44 
as_¡ršg
.
expo£d
 = 
True


46 
def
 
	$as_y›ld
(
£lf
):

47 
y›ld
 "content"

48 
as_y›ld
.
expo£d
 = 
True


50 
def
 
	$”rÜ
(
£lf
):

51 
¿i£
 
	$V®ueE¼Ü
()

52 
”rÜ
.
expo£d
 = 
True


53 
”rÜ
.
_ı_cÚfig
 = {'toŞs.log_Œaûbacks.Ú': 
True
}

55 
roÙ
 = 
	$RoÙ
()

58 
ch”rypy
.
cÚfig
.
	`upd©e
({'log.”rÜ_fe': 
”rÜ_log
,

59 'log.acûss_fe': 
acûss_log
,

60 
	}
})

61 
ch”rypy
.
Œ“
.
	$mouÁ
(
roÙ
)

65 
äom
 
ch”rypy
.
‹¡
 
impÜt
 
h–³r
, 
log‹¡


67 
şass
 
	$AcûssLogTe¡s
(
h–³r
.
CPWebCa£
, 
log‹¡
.
LogCa£
):

68 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

70 
logfe
 = 
acûss_log


72 
def
 
	$‹¡NÜm®R‘uº
(
£lf
):

73 
£lf
.
	$m¬kLog
()

74 
£lf
.
	`g‘Page
("/as_string",

75 
h—d”s
=[('Referer', 'http://www.cherrypy.org/'),

77 
£lf
.
	`as£¹Body
('content')

78 
£lf
.
	$as£¹Stus
(200)

80 
šŒo
 = '% - - [' % 
£lf
.
	$š‹rçû
()

82 
£lf
.
	`as£¹Log
(-1, 
šŒo
)

84 [
k
 k, 
v
 
š
 
£lf
.
h—d”s
 k.
	`low”
() == 'content-length']:

85 
£lf
.
	`as£¹Log
(-1, '] "GET %s/as_string HTTP/1.1" 200 7 '

87 % 
£lf
.
	$´efix
())

89 
£lf
.
	`as£¹Log
(-1, '] "GET %s/as_string HTTP/1.1" 200 - '

91 % 
£lf
.
	$´efix
())

93 
def
 
	$‹¡NÜm®Y›ld
(
£lf
):

94 
£lf
.
	$m¬kLog
()

95 
£lf
.
	`g‘Page
("/as_yield")

96 
£lf
.
	`as£¹Body
('content')

97 
£lf
.
	$as£¹Stus
(200)

99 
šŒo
 = '% - - [' % 
£lf
.
	$š‹rçû
()

101 
£lf
.
	`as£¹Log
(-1, 
šŒo
)

102 [
k
 k, 
v
 
š
 
£lf
.
h—d”s
 k.
	`low”
() == 'content-length']:

103 
£lf
.
	`as£¹Log
(-1, '] "GET %s/as_yield HTTP/1.1" 200 7 "" ""' %

104 
£lf
.
	$´efix
())

106 
£lf
.
	`as£¹Log
(-1, '] "GET %s/as_yield HTTP/1.1" 200 - "" ""'

107 % 
£lf
.
	$´efix
())

109 
def
 
	$‹¡Esÿ³dOuut
(
£lf
):

110 #Te¡ 
unicode
 
š
 
acûss
 
log
 
p›ûs
.

111 
£lf
.
	$m¬kLog
()

112 
£lf
.
	`g‘Page
("/uni_code")

113 
£lf
.
	$as£¹Stus
(200)

114 
py3k
:

115 #Th
»´
 
of
 
a
 
by‹¡ršg
 
š
 
py3k
 
šşudes
‡ 
b
'' 
´efix


116 
£lf
.
	`as£¹Log
(-1, 
	`»´
(
¹¬os
.
	`’code
('utf8'))[2:-1])

118 
£lf
.
	`as£¹Log
(-1, 
	`»´
(
¹¬os
.
	`’code
('utf8'))[1:-1])

119 #Te¡ 
the
 
”ebos
 
v®ue
. 
Inşuded
 
šlše
 
your
 
’ligh‹nm’t
.

120 #NÙ
the
 'r' 
´efix
--
tho£
 
back¦ashes
 
¬e
 
l™”®s
.

121 
£lf
.
	`as£¹Log
(-1, 
r
'\xce\x88\xcf\x81\xce\xb5\xce\xb2\xce\xbf\xcf\x82')

123 #Te¡ 
back¦ashes
 
š
 
ouut
.

124 
£lf
.
	$m¬kLog
()

125 
£lf
.
	`g‘Page
("/slashes")

126 
£lf
.
	$as£¹Stus
(200)

127 
py3k
:

128 
£lf
.
	`as£¹Log
(-1, 
	`Áob
('"GET /slashed\\path HTTP/1.1"'))

130 
£lf
.
	`as£¹Log
(-1, 
r
'"GET /slashed\\path HTTP/1.1"')

132 #Te¡ 
wh™e¥aû
 
š
 
ouut
.

133 
£lf
.
	$m¬kLog
()

134 
£lf
.
	`g‘Page
("/whitespace")

135 
£lf
.
	$as£¹Stus
(200)

136 #Agaš, 
nÙe
 
the
 'r' 
´efix
.

137 
£lf
.
	`as£¹Log
(-1, 
r
'"Browzuh (1.0\r\n\t\t.3)"')

140 
şass
 
	$E¼ÜLogTe¡s
(
h–³r
.
CPWebCa£
, 
log‹¡
.
LogCa£
):

141 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

143 
logfe
 = 
”rÜ_log


145 
def
 
	$‹¡T¿ûbacks
(
£lf
):

146 #Te¡ 
th©
 
Œaûbacks
 
g‘
 
wr™‹n
 
to
 
the
 
”rÜ
 
log
.

147 
£lf
.
	$m¬kLog
()

148 
ignÜe
 = 
h–³r
.
web‹¡
.
ignÜed_exû±iÚs


149 
ignÜe
.
	$­³nd
(
V®ueE¼Ü
)

150 
Œy
:

151 
£lf
.
	`g‘Page
("/error")

152 
£lf
.
	`as£¹InBody
("raise ValueError()")

153 
£lf
.
	`as£¹Log
(0, 'HTTP Traceback (most„ecent call†ast):')

154 
£lf
.
	`as£¹Log
(-3, 'raise ValueError()')

155 
fš®ly
:

156 
ignÜe
.
	`pİ
()

	@trunk/objs/CherryPy-3.2.4/cherrypy/test/test_mime.py

3 
impÜt
 
ch”rypy


4 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
	gÁob
, 
	gÁou
, 
sÜ‹d


6 
def
 
	$£tup_£rv”
():

8 
şass
 
RoÙ
:

10 
def
 
	$muÉ¬t
(
£lf
, 
·¹s
):

11  
	$»´
(
·¹s
)

12 
muÉ¬t
.
expo£d
 = 
True


14 
def
 
	$muÉ¬t_fÜm_d©a
(
£lf
, **
kw¬gs
):

15  
	`»´
(
	`li¡
(
	`sÜ‹d
(
kw¬gs
.
	$™ems
())))

16 
muÉ¬t_fÜm_d©a
.
expo£d
 = 
True


18 
def
 
	$æashu¶ßd
(
£lf
, 
Fed©a
, 
U¶ßd
, 
F’ame
):

20 (
U¶ßd
, 
F’ame
, 
Fed©a
.
fe
.
	$»ad
()))

21 
æashu¶ßd
.
expo£d
 = 
True


23 
ch”rypy
.
cÚfig
.
	`upd©e
({'£rv”.max_»que¡_body_size': 0
	}
})

24 
ch”rypy
.
Œ“
.
mouÁ
(
	$RoÙ
())

27 #Cl›Á-
side
 
code
 #


28 
äom
 
ch”rypy
.
‹¡
 
impÜt
 
h–³r


30 
şass
 
	$MuÉ¬tTe¡
(
h–³r
.
CPWebCa£
):

31 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

33 
def
 
	$‹¡_muÉ¬t
(
£lf
):

34 
‹xt_·¹
 = 
	`Áou
("This isheext version")

35 
html_·¹
 = 
	`Áou
("""<!DOCTYPE html PUBLIC "-

36 <
html
>

37 <
h—d
>

38 <
m‘a
 
cÚ‹Á
="‹xt/html;ch¬£t=ISO-8859-1" 
h‰p
-
equiv
="Content-Type">

39 </
h—d
>

40 <
body
 
bgcŞÜ
="#ffffff" 
‹xt
="#000000">

42 
This
 
is
 
the
 <
¡rÚg
>
HTML
</¡rÚg> 
v”siÚ


43 </
body
>

44 </
html
>

46 
body
 = '\r\n'.
	`još
([

51 
‹xt_·¹
,

55 
html_·¹
,

57 
h—d”s
 = [

59 ('CÚ‹Á-L’gth', 
	`¡r
(
	`Ën
(
body
))),

61 
£lf
.
	`g‘Page
('/muÉ¬t', 
h—d”s
, "POST", 
body
)

62 
£lf
.
	`as£¹Body
(
	$»´
([
‹xt_·¹
, 
html_·¹
]))

64 
def
 
	$‹¡_muÉ¬t_fÜm_d©a
(
£lf
):

65 
body
='\r\n'.
	`još
(['--X',

70 #Te¡ 
a
 
·¿m
 
w™h
 
mÜe
 
thª
 
Úe
 
v®ue
.

71 #S“ 
h‰p
:

80 
£lf
.
	`g‘Page
('/muÉ¬t_fÜm_d©a', 
m‘hod
='POST',

81 
h—d”s
=[("Content-Type", "multipart/form-data;boundary=X"),

82 ("CÚ‹Á-L’gth", 
	`¡r
(
	`Ën
(
body
))),

84 
body
=body),

85 
£lf
.
	`as£¹Body
(
	`»´
([('baz', [
	`Áou
('111'),‚tou('333')]), ('foo',‚tou('bar'))]))

88 
şass
 
	$SaãMuÉ¬tHªdlšgTe¡
(
h–³r
.
CPWebCa£
):

89 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

91 
def
 
	$‹¡_FÏsh_U¶ßd
(
£lf
):

92 
h—d”s
 = [

102 
fed©a
 = 
	`Áob
('<?xml version="1.0"ƒncoding="UTF-8"?>\r\n'

105 
body
 = (
	`Áob
(

115 + 
fed©a
 +

116 
	`Áob
('\r\n'

121 #FÏsh 
­ps
 
om™
 
the
 
Œašg
 \
r
\
n
 
Ú
h
Ï¡
 
lše
:

124 
£lf
.
	`g‘Page
('/æashu¶ßd', 
h—d”s
, "POST", 
body
)

125 
£lf
.
	`as£¹Body
("Upload: Submit Query, Filename: .project, "

126 "Fed©a: %r" % 
fed©a
)

	@trunk/objs/CherryPy-3.2.4/cherrypy/test/test_misc_tools.py

1 
impÜt
 
os


2 
	gloÿlDœ
 = 
os
.
·th
.
	$dœÇme
(
__fe__
)

3 
logfe
 = 
os
.
·th
.
	`još
(
loÿlDœ
, "test_misc_tools.log")

5 
impÜt
 
ch”rypy


6 
äom
 
ch”rypy
 
impÜt
 
toŞs


9 
def
 
	$£tup_£rv”
():

10 
şass
 
RoÙ
:

11 
def
 
	$šdex
(
£lf
):

12 
y›ld
 "Hello, world"

13 
šdex
.
expo£d
 = 
True


14 
h
 = [("Content-Language", "en-GB"), ('Content-Type', 'text/plain')]

15 
toŞs
.
	$»¥Ú£_h—d”s
(
h—d”s
=
h
)(
šdex
)

17 
def
 
	$Ùh”
(
£lf
):

19 
Ùh”
.
expo£d
 = 
True


20 
Ùh”
.
_ı_cÚfig
 = {

21 'toŞs.»¥Ú£_h—d”s.Ú': 
True
,

24 'toŞs.log_hooks.Ú': 
True
,

25 
	}
}

28 
şass
 
Acû±
:

29 
_ı_cÚfig
 = {'toŞs.acû±.Ú': 
True
}

31 
def
 
	$šdex
(
£lf
):

33 
šdex
.
expo£d
 = 
True


35 #IÀ
PythÚ
 2.4+, 
we
 
could
 
u£
 
a
 
decÜ©Ü
 
š¡—d
:

36 #@
toŞs
.
	`acû±
('application/atom+xml')

37 
def
 
	$ãed
(
£lf
):

38  """<?xmÈv”siÚ="1.0"ƒncodšg="
utf
-8"?>

39 <
ãed
 
xmÊs
="http://www.w3.org/2005/Atom">

40 <
t™Ë
>
Unknown
 
Blog
</title>

41 </
ãed
>"""

42 
ãed
.
expo£d
 = 
True


43 
ãed
.
_ı_cÚfig
 = {'toŞs.acû±.medŸ': '­¶iÿtiÚ/©om+xml'
	}
}

45 
def
 
	$£Ëù
(
£lf
):

46 #W
could
 
®so
 
wr™e
 
this
: 
mty³
 = 
ch”rypy
.
lib
.
acû±
.
	`acû±
(...)

47 
mty³
 = 
toŞs
.
acû±
.
	`ÿÎabË
(['text/html', 'text/plain'])

48 
mty³
 == 'text/html':

52 
£Ëù
.
expo£d
 = 
True


54 
şass
 
Reã»r
:

55 
def
 
	$acû±
(
£lf
):

57 
acû±
.
expo£d
 = 
True


58 
»jeù
 = 
acû±


60 
şass
 
AutoV¬y
:

61 
def
 
	$šdex
(
£lf
):

62 #R—d 
a
 
h—d”
 
dœeùly
 
w™h
 'get'

63 
«
 = 
ch”rypy
.
»que¡
.
h—d”s
.
	`g‘
('Accept-Encoding')

64 #R—d 
a
 
h—d”
 
dœeùly
 
w™h
 '__getitem__'

65 
ş
 = 
ch”rypy
.
»que¡
.
h—d”s
['Host']

66 #R—d 
a
 
h—d”
 
dœeùly
 
w™h
 '__contains__'

67 
hasif
 = 'If-Modif›d-Sšû' 
š
 
ch”rypy
.
»que¡
.
h—d”s


68 #R—d 
a
 
h—d”
 
dœeùly
 
w™h
 'has_key'

69 
	`ha§‰r
(
diù
, 'has_key'):

71 
has
 = 
ch”rypy
.
»que¡
.
h—d”s
.
	`has_key
('Range')

74 
has
 = 'Rªge' 
š
 
ch”rypy
.
»que¡
.
h—d”s


75 #C®È
a
 
lib
 
funùiÚ


76 
mty³
 = 
toŞs
.
acû±
.
	`ÿÎabË
(['text/html', 'text/plain'])

78 
šdex
.
expo£d
 = 
True


80 
cÚf
 = {'/»ã»r': {'toŞs.»ã»r.Ú': 
True
,

81 'toŞs.»ã»r.·‰”n': 
r
'http://[^/]*example\.com',

83 '/»ã»r/»jeù': {'toŞs.»ã»r.acû±': 
F®£
,

84 'toŞs.»ã»r.acû±_missšg': 
True
,

86 '/autov¬y': {'toŞs.autov¬y.Ú': 
True
},

87 
	}
}

89 
roÙ
 = 
	$RoÙ
()

90 
roÙ
.
»ã»r
 = 
	$Reã»r
()

91 
roÙ
.
acû±
 = 
	$Acû±
()

92 
roÙ
.
autov¬y
 = 
	$AutoV¬y
()

93 
ch”rypy
.
Œ“
.
	$mouÁ
(
roÙ
, 
cÚfig
=
cÚf
)

94 
ch”rypy
.
cÚfig
.
	`upd©e
({'log.”rÜ_fe': 
logfe
})

97 
äom
 
ch”rypy
.
‹¡
 
impÜt
 
h–³r


99 
şass
 
	$Re¥Ú£H—d”sTe¡
(
h–³r
.
CPWebCa£
):

100 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

102 
def
 
	$‹¡Re¥Ú£H—d”sDecÜ©Ü
(
£lf
):

103 
£lf
.
	`g‘Page
('/')

104 
£lf
.
	`as£¹H—d”
("Content-Language", "en-GB")

105 
£lf
.
	`as£¹H—d”
('Content-Type', 'text/plain;charset=utf-8')

107 
def
 
	$‹¡Re¥Ú£H—d”s
(
£lf
):

108 
£lf
.
	`g‘Page
('/other')

109 
£lf
.
	`as£¹H—d”
("Content-Language", "fr")

110 
£lf
.
	`as£¹H—d”
('Content-Type', 'text/plain;charset=utf-8')

113 
şass
 
	$Reã»rTe¡
(
h–³r
.
CPWebCa£
):

114 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

116 
def
 
	$‹¡Reã»r
(
£lf
):

117 
£lf
.
	`g‘Page
('/referer/accept')

118 
£lf
.
	`as£¹E¼ÜPage
(403, 'Forbidden Referer header.')

120 
£lf
.
	`g‘Page
('/referer/accept',

121 
h—d”s
=[('Referer', 'http://www.example.com/')])

122 
£lf
.
	$as£¹Stus
(200)

123 
£lf
.
	`as£¹Body
('Accepted!')

126 
£lf
.
	`g‘Page
('/referer/reject')

127 
£lf
.
	$as£¹Stus
(200)

128 
£lf
.
	`as£¹Body
('Accepted!')

130 
£lf
.
	`g‘Page
('/referer/reject',

131 
h—d”s
=[('Referer', 'http://www.example.com/')])

132 
£lf
.
	`as£¹E¼ÜPage
(403, 'Forbidden Referer header.')

135 
şass
 
	$Acû±Te¡
(
h–³r
.
CPWebCa£
):

136 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

138 
def
 
	$‹¡_Acû±_ToŞ
(
£lf
):

139 #Te¡ 
w™h
 
no
 
h—d”
 
´ovided


140 
£lf
.
	`g‘Page
('/accept/feed')

141 
£lf
.
	$as£¹Stus
(200)

142 
£lf
.
	`as£¹InBody
('<title>Unknown Blog</title>')

144 #S³cify 
exaù
 
medŸ
 
ty³


145 
£lf
.
	`g‘Page
('/acû±/ãed', 
h—d”s
=[('Accept', 'application/atom+xml')])

146 
£lf
.
	$as£¹Stus
(200)

147 
£lf
.
	`as£¹InBody
('<title>Unknown Blog</title>')

149 #S³cify 
m©chšg
 
medŸ
 
¿nge


150 
£lf
.
	`g‘Page
('/acû±/ãed', 
h—d”s
=[('Accept', 'application/*')])

151 
£lf
.
	$as£¹Stus
(200)

152 
£lf
.
	`as£¹InBody
('<title>Unknown Blog</title>')

154 #S³cify 
®l
 
medŸ
 
¿nges


155 
£lf
.
	`g‘Page
('/acû±/ãed', 
h—d”s
=[('Accept', '*/*')])

156 
£lf
.
	$as£¹Stus
(200)

157 
£lf
.
	`as£¹InBody
('<title>Unknown Blog</title>')

159 #S³cify 
uÇcû±abË
 
medŸ
 
ty³s


160 
£lf
.
	`g‘Page
('/acû±/ãed', 
h—d”s
=[('Accept', 'text/html')])

161 
£lf
.
	`as£¹E¼ÜPage
(406,

166 #Te¡ 
»sourû
 
wh”e
 
toŞ
 
is
 'Ú' 
but
 
medŸ
 i 
	`NÚe
 (
nÙ
 
£t
).

167 
£lf
.
	`g‘Page
('/accept/')

168 
£lf
.
	$as£¹Stus
(200)

169 
£lf
.
	`as£¹Body
('<a href="feed">Atom feed</a>')

171 
def
 
	$‹¡_acû±_£ËùiÚ
(
£lf
):

172 #Try 
bÙh
 
our
 
ex³ùed
 
medŸ
 
ty³s


173 
£lf
.
	`g‘Page
('/accept/select', [('Accept', 'text/html')])

174 
£lf
.
	$as£¹Stus
(200)

175 
£lf
.
	`as£¹Body
('<h2>Page Title</h2>')

176 
£lf
.
	`g‘Page
('/accept/select', [('Accept', 'text/plain')])

177 
£lf
.
	$as£¹Stus
(200)

178 
£lf
.
	`as£¹Body
('PAGE TITLE')

179 
£lf
.
	`g‘Page
('/accept/select', [('Accept', 'text/plain,ext/*;q=0.5')])

180 
£lf
.
	$as£¹Stus
(200)

181 
£lf
.
	`as£¹Body
('PAGE TITLE')

183 #‹xˆ* 
should
 
´eãr
 
‹xt
/
html
 
sšû
 
™
 
comes
 
fœ¡


184 #š 
our
 'medŸ' 
¬gum’t
 
to
 
toŞs
.
acû±


185 
£lf
.
	`g‘Page
('/accept/select', [('Accept', 'text/*')])

186 
£lf
.
	$as£¹Stus
(200)

187 
£lf
.
	`as£¹Body
('<h2>Page Title</h2>')

188 
£lf
.
	`g‘Page
('/accept/select', [('Accept', '*/*')])

189 
£lf
.
	$as£¹Stus
(200)

190 
£lf
.
	`as£¹Body
('<h2>Page Title</h2>')

192 #Try 
uÇcû±abË
 
medŸ
 
ty³s


193 
£lf
.
	`g‘Page
('/accept/select', [('Accept', 'application/xml')])

194 
£lf
.
	`as£¹E¼ÜPage
(406,

200 
şass
 
	$AutoV¬yTe¡
(
h–³r
.
CPWebCa£
):

201 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

203 
def
 
	$‹¡AutoV¬y
(
£lf
):

204 
£lf
.
	`g‘Page
('/autovary/')

205 
£lf
.
	`as£¹H—d”
(

	@trunk/objs/CherryPy-3.2.4/cherrypy/test/test_objectmapping.py

1 
impÜt
 
ch”rypy


2 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
Áou


3 
äom
 
	gch”rypy
.
_ıŒ“
 
impÜt
 
AµliÿtiÚ


4 
äom
 
	gch”rypy
.
‹¡
 
impÜt
 
h–³r


6 
	gsüt_Çmes
 = ["", "/foo", "/users/fred/blog", "/corp/blog"]

9 
şass
 
	$ObjeùM­pšgTe¡
(
h–³r
.
CPWebCa£
):

11 
def
 
	$£tup_£rv”
():

12 
şass
 
RoÙ
:

13 
def
 
	`šdex
(
£lf
, 
Çme
="world"):

14  
Çme


15 
šdex
.
expo£d
 = 
True


17 
def
 
	$foob¬
(
£lf
):

19 
foob¬
.
expo£d
 = 
True


21 
def
 (
£lf
, *
·¿ms
, **
kw¬gs
):

22  "deçuÉ:" + 
	$»´
(
·¿ms
)

23 .
expo£d
 = 
True


25 
def
 
	$Ùh”
(
£lf
):

27 
Ùh”
.
expo£d
 = 
True


29 
def
 
	$exŒa
(
£lf
, *
p
):

30  
	$»´
(
p
)

31 
exŒa
.
expo£d
 = 
True


33 
def
 
	$»dœeù
(
£lf
):

34 
¿i£
 
ch”rypy
.
	`HTTPRedœeù
('dir1/', 302)

35 
»dœeù
.
expo£d
 = 
True


37 
def
 
	$nÙExpo£d
(
£lf
):

40 
def
 
	$cÚfv®ue
(
£lf
):

41  
ch”rypy
.
»que¡
.
cÚfig
.
	`g‘
("user")

42 
cÚfv®ue
.
expo£d
 = 
True


44 
def
 
	$»dœeù_vŸ_u¾
(
£lf
, 
·th
):

45 
¿i£
 
ch”rypy
.
	`HTTPRedœeù
(ch”rypy.
	$u¾
(
·th
))

46 
»dœeù_vŸ_u¾
.
expo£d
 = 
True


48 
def
 
	$Œª¦©e_html
(
£lf
):

50 
Œª¦©e_html
.
expo£d
 = 
True


52 
def
 
	$m­³d_func
(
£lf
, 
ID
=
NÚe
):

53  "ID i %s" % 
ID


54 
m­³d_func
.
expo£d
 = 
True


55 
	`£‰r
(
RoÙ
, "VÚ B\xfşow", 
m­³d_func
)

58 
şass
 
Exposšg
:

59 
def
 
	$ba£
(
£lf
):

61 
ch”rypy
.
	$expo£
(
ba£
)

62 
ch”rypy
.
	`expo£
(
ba£
, "1")

63 
ch”rypy
.
	`expo£
(
ba£
, "2")

65 
şass
 
	$ExposšgNewStyË
(
objeù
):

66 
def
 
	$ba£
(
£lf
):

68 
ch”rypy
.
	$expo£
(
ba£
)

69 
ch”rypy
.
	`expo£
(
ba£
, "1")

70 
ch”rypy
.
	`expo£
(
ba£
, "2")

73 
şass
 
Dœ1
:

74 
def
 
	$šdex
(
£lf
):

76 
šdex
.
expo£d
 = 
True


78 
def
 
	$myM‘hod
(
£lf
):

79  "myM‘hod from dœ1,…©h_šfØis:" + 
	$»´
(
ch”rypy
.
»que¡
.
·th_šfo
)

80 
myM‘hod
.
expo£d
 = 
True


81 
myM‘hod
.
_ı_cÚfig
 = {'toŞs.Œašg_¦ash.exŒa': 
True
}

83 
def
 (
£lf
, *
·¿ms
):

84  "deçuÉ fÜ dœ1,…¬am is:" + 
	$»´
(
·¿ms
)

85 .
expo£d
 = 
True


88 
şass
 
Dœ2
:

89 
def
 
	$šdex
(
£lf
):

90  "šdex fÜ dœ2,…©h is:" + 
ch”rypy
.
»que¡
.
·th_šfo


91 
šdex
.
expo£d
 = 
True


93 
def
 
	$süt_Çme
(
£lf
):

94  
ch”rypy
.
Œ“
.
	$süt_Çme
()

95 
süt_Çme
.
expo£d
 = 
True


97 
def
 
	$ch”rypy_u¾
(
£lf
):

98  
ch”rypy
.
	`u¾
("/extra")

99 
ch”rypy_u¾
.
expo£d
 = 
True


101 
def
 
	$po¥¬am
(
£lf
, *
v·th
):

102  "/".
	$još
(
v·th
)

103 
po¥¬am
.
expo£d
 = 
True


106 
şass
 
Dœ3
:

107 
def
 (
£lf
):

110 
şass
 
Dœ4
:

111 
def
 
	$šdex
(
£lf
):

114 
şass
 
DefNoIndex
:

115 
def
 (
£lf
, *
¬gs
):

116 
¿i£
 
ch”rypy
.
	`HTTPRedœeù
("contact")

117 .
expo£d
 = 
True


119 #M‘hodDi¥©ch” 
code


120 
şass
 
ByM‘hod
:

121 
expo£d
 = 
True


123 
def
 
	$__š™__
(
£lf
, *
thšgs
):

124 
£lf
.
thšgs
 = 
	$li¡
(
thšgs
)

126 
def
 
	$GET
(
£lf
):

127  
	$»´
(
£lf
.
thšgs
)

129 
def
 
	$POST
(
£lf
, 
thšg
):

130 
£lf
.
thšgs
.
	$­³nd
(
thšg
)

132 
şass
 
CŞËùiÚ
:

133  = 
	`ByM‘hod
('a', 'bit')

135 
RoÙ
.
exposšg
 = 
	$Exposšg
()

136 
RoÙ
.
exposšgÃw
 = 
	$ExposšgNewStyË
()

137 
RoÙ
.
dœ1
 = 
	$Dœ1
()

138 
RoÙ
.
dœ1
.
dœ2
 = 
	$Dœ2
()

139 
RoÙ
.
dœ1
.
dœ2
.
dœ3
 = 
	$Dœ3
()

140 
RoÙ
.
dœ1
.
dœ2
.
dœ3
.
dœ4
 = 
	$Dœ4
()

141 
RoÙ
.
deâošdex
 = 
	$DefNoIndex
()

142 
RoÙ
.
bym‘hod
 = 
	`ByM‘hod
('another')

143 
RoÙ
.
cŞËùiÚ
 = 
	$CŞËùiÚ
()

145 
d
 = 
ch”rypy
.
di¥©ch
.
	$M‘hodDi¥©ch”
()

146 
u¾
 
š
 
süt_Çmes
:

147 
cÚf
 = {'/': {'u£r': (
u¾
 
Ü
 "/").
	`¥l™
("/")[-2]},

148 '/bym‘hod': {'»que¡.di¥©ch': 
d
},

149 '/cŞËùiÚ': {'»que¡.di¥©ch': 
d
},

150 
	}
}

151 
ch”rypy
.
Œ“
.
mouÁ
(
RoÙ
(), 
u¾
, 
cÚf
)

154 
şass
 
	gIsŞ©ed
:

155 
def
 
	$šdex
(
£lf
):

157 
šdex
.
expo£d
 = 
True


159 
ch”rypy
.
Œ“
.
	`mouÁ
(
	`IsŞ©ed
(), "/isolated")

161 
şass
 
AnÙh”Aµ
:

163 
expo£d
 = 
True


165 
def
 
	$GET
(
£lf
):

168 
ch”rypy
.
Œ“
.
	`mouÁ
(
	`AnÙh”Aµ
(), "/­p", {'/': {'»que¡.di¥©ch': 
d
}
	}
})

169 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

172 
def
 
	$‹¡ObjeùM­pšg
(
£lf
):

173 
u¾
 
š
 
süt_Çmes
:

174 
´efix
 = 
£lf
.
süt_Çme
 = 
u¾


176 
£lf
.
	`g‘Page
('/')

177 
£lf
.
	`as£¹Body
('world')

179 
£lf
.
	`g‘Page
("/dir1/myMethod")

180 
£lf
.
	`as£¹Body
("myMethod from dir1,…ath_info is:'/dir1/myMethod'")

182 
£lf
.
	`g‘Page
("/this/method/does/not/exist")

183 
£lf
.
	`as£¹Body
("default:('this', 'method', 'does', 'not', 'exist')")

185 
£lf
.
	`g‘Page
("/extra/too/much")

186 
£lf
.
	`as£¹Body
("('too', 'much')")

188 
£lf
.
	`g‘Page
("/other")

189 
£lf
.
	`as£¹Body
('other')

191 
£lf
.
	`g‘Page
("/notExposed")

192 
£lf
.
	`as£¹Body
("default:('notExposed',)")

194 
£lf
.
	`g‘Page
("/dir1/dir2/")

195 
£lf
.
	`as£¹Body
('index for dir2,…ath is:/dir1/dir2/')

197 #Te¡ 
om™‹d
 
Œašg
 
	`¦ash
 (
should
 
be
 
»dœeùed
 
by
 ).

198 
£lf
.
	`g‘Page
("/dir1/dir2")

199 
£lf
.
	$as£¹Stus
(301)

200 
£lf
.
	`as£¹H—d”
('LoÿtiÚ', '%s/dœ1/dœ2/' % s–f.
	$ba£
())

202 #Te¡ 
exŒa
 
Œašg
 
	`¦ash
 (
should
 
be
 
»dœeùed
 
cÚfigu»d
).

203 
£lf
.
	`g‘Page
("/dir1/myMethod/")

204 
£lf
.
	$as£¹Stus
(301)

205 
£lf
.
	`as£¹H—d”
('LoÿtiÚ', '%s/dœ1/myM‘hod' % s–f.
	$ba£
())

207 #Te¡ 
th©
  
m‘hod
 
mu¡
 
be
 
expo£d
 
š
 
Üd”
 
to
 
m©ch
.

208 
£lf
.
	`g‘Page
("/dir1/dir2/dir3/dir4/index")

209 
£lf
.
	`as£¹Body
("default for dir1,…aram is:('dir2', 'dir3', 'dir4', 'index')")

211 #Te¡ *
v·th
 
wh’
 (è
is
 
defšed
 
but
 
nÙ
 
	`šdex
()

212 #Thi 
®so
 
‹¡s
 
HTTPRedœeù
 
w™h
 .

213 
£lf
.
	`g‘Page
("/defnoindex")

214 
£lf
.
	`as£¹Stus
((302, 303))

215 
£lf
.
	`as£¹H—d”
('LoÿtiÚ', '%s/cÚù' % s–f.
	$ba£
())

216 
£lf
.
	`g‘Page
("/defnoindex/")

217 
£lf
.
	`as£¹Stus
((302, 303))

218 
£lf
.
	`as£¹H—d”
('LoÿtiÚ', '%s/deâošdex/cÚù' % s–f.
	$ba£
())

219 
£lf
.
	`g‘Page
("/defnoindex/page")

220 
£lf
.
	`as£¹Stus
((302, 303))

221 
£lf
.
	`as£¹H—d”
('LoÿtiÚ', '%s/deâošdex/cÚù' % s–f.
	$ba£
())

223 
£lf
.
	`g‘Page
("/redirect")

224 
£lf
.
	`as£¹Stus
('302 Found')

225 
£lf
.
	`as£¹H—d”
('LoÿtiÚ', '%s/dœ1/' % s–f.
	$ba£
())

227 
nÙ
 
	`g‘©Œ
(
ch”rypy
.
£rv”
, "usšg_­ache", 
F®£
):

228 #Te¡ 
th©
 
we
 
ÿn
 
u£
 
URL
' which‡»n'
t
 
®l
 
v®id
 
PythÚ
 
id’tif›rs


229 #Thi 
should
 
®so
 
‹¡
 
the
 %
XX
-
unquÙšg
 
of
 
URL
's.

230 
£lf
.
	`g‘Page
("/Von%20B%fclow?ID=14")

231 
£lf
.
	`as£¹Body
("ID is 14")

233 #Te¡ 
th©
 %2F 
š
 
the
 
·th
 
dÛ¢
't get unquotedooƒarly;

234 #th© 
is
, 
™
 
should
 
nÙ
 
be
 
u£d
 
to
 
£·¿‹
 
·th
 
compÚ’ts
.

235 #S“ 
tick‘
 #393.

236 
£lf
.
	`g‘Page
("/page%2Fname")

237 
£lf
.
	`as£¹Body
("default:('page/name',)")

239 
£lf
.
	`g‘Page
("/dir1/dir2/script_name")

240 
£lf
.
	$as£¹Body
(
u¾
)

241 
£lf
.
	`g‘Page
("/dir1/dir2/cherrypy_url")

242 
£lf
.
	`as£¹Body
("%s/exŒa" % s–f.
	$ba£
())

244 #Te¡ 
th©
 
cÚfigs
 
dÚ
't overwriteƒach other from diferent‡pps

245 
£lf
.
	`g‘Page
("/confvalue")

246 
£lf
.
	`as£¹Body
((
u¾
 
Ü
 "/").
	`¥l™
("/")[-2])

248 
£lf
.
süt_Çme
 = ""

250 #Te¡ 
absŞu‹URI
's inhe Request-Line

251 
£lf
.
	`g‘Page
('h‰p://%s:%s/' % (£lf.
	`š‹rçû
(), s–f.
PORT
))

252 
£lf
.
	`as£¹Body
('world')

254 
£lf
.
	`g‘Page
('http://%s:%s/abs/?service=http://192.168.0.1/x/y/z' %

255 (
£lf
.
	`š‹rçû
(), s–f.
PORT
))

256 
£lf
.
	`as£¹Body
("default:('abs',)")

258 
£lf
.
	`g‘Page
('/rel/?service=http://192.168.120.121:8000/x/y/z')

259 
£lf
.
	`as£¹Body
("default:('rel',)")

261 #Te¡ 
th©
 
the
 "isŞ©ed" 
­p
 
dÛ¢
'ˆËak u¾'
s
 
što
h
roÙ
‡pp.

262 #Ià
™
 
did
 
Ëak
, 
RoÙ
.(è
would
 
ªsw”
 
w™h


264 
£lf
.
	`g‘Page
("/isolated/")

265 
£lf
.
	`as£¹Stus
("200 OK")

266 
£lf
.
	`as£¹Body
("made it!")

267 
£lf
.
	`g‘Page
("/isolated/doesnt/exist")

268 
£lf
.
	`as£¹Stus
("404 Not Found")

270 #Mak
su»
 /
foob¬
 
m­s
 
to
 
RoÙ
.foob¬ 
ªd
 
nÙ
Ø
the
 
­p


271 #mouÁed 
©
 /
foo
. 
S“
 
h‰p
:

272 
£lf
.
	`g‘Page
("/foobar")

273 
£lf
.
	`as£¹Body
("bar")

275 
def
 
	$‹¡_Œª¦©e
(
£lf
):

276 
£lf
.
	`g‘Page
("/translate_html")

277 
£lf
.
	`as£¹Stus
("200 OK")

278 
£lf
.
	`as£¹Body
("OK")

280 
£lf
.
	`g‘Page
("/translate.html")

281 
£lf
.
	`as£¹Stus
("200 OK")

282 
£lf
.
	`as£¹Body
("OK")

284 
£lf
.
	`g‘Page
("/translate-html")

285 
£lf
.
	`as£¹Stus
("200 OK")

286 
£lf
.
	`as£¹Body
("OK")

288 
def
 
	$‹¡_»dœ_usšg_u¾
(
£lf
):

289 
u¾
 
š
 
süt_Çmes
:

290 
´efix
 = 
£lf
.
süt_Çme
 = 
u¾


292 #Te¡ 
the
 
absŞu‹
 
·th
 
to
h
	`·»Á
 (
Ëadšg
 
¦ash
)

293 
£lf
.
	`g‘Page
('/redirect_via_url?path=./')

294 
£lf
.
	`as£¹Stus
(('302 Found', '303 See Other'))

295 
£lf
.
	`as£¹H—d”
('LoÿtiÚ', '%s/' % s–f.
	$ba£
())

297 #Te¡ 
the
 
»Ïtive
 
·th
 
to
h
	`·»Á
 (
no
 
Ëadšg
 
¦ash
)

298 
£lf
.
	`g‘Page
('/redirect_via_url?path=./')

299 
£lf
.
	`as£¹Stus
(('302 Found', '303 See Other'))

300 
£lf
.
	`as£¹H—d”
('LoÿtiÚ', '%s/' % s–f.
	$ba£
())

302 #Te¡ 
the
 
absŞu‹
 
·th
 
to
h
	`·»Á
 (
Ëadšg
 
¦ash
)

303 
£lf
.
	`g‘Page
('/redirect_via_url/?path=./')

304 
£lf
.
	`as£¹Stus
(('302 Found', '303 See Other'))

305 
£lf
.
	`as£¹H—d”
('LoÿtiÚ', '%s/' % s–f.
	$ba£
())

307 #Te¡ 
the
 
»Ïtive
 
·th
 
to
h
	`·»Á
 (
no
 
Ëadšg
 
¦ash
)

308 
£lf
.
	`g‘Page
('/redirect_via_url/?path=./')

309 
£lf
.
	`as£¹Stus
(('302 Found', '303 See Other'))

310 
£lf
.
	`as£¹H—d”
('LoÿtiÚ', '%s/' % s–f.
	$ba£
())

312 
def
 
	$‹¡Pos™iÚ®P¬ams
(
£lf
):

313 
£lf
.
	`g‘Page
("/dir1/dir2/posparam/18/24/hut/hike")

314 
£lf
.
	`as£¹Body
("18/24/hut/hike")

316 #š‹rmedŸ‹ 
šdex
 
m‘hods
 
should
 
nÙ
 
»ûive
 
po¥¬ams
;

317 #Úly 
the
 "fš®" 
šdex
 
m‘hod
 
should
 dØ
so
.

318 
£lf
.
	`g‘Page
("/dir1/dir2/5/3/sir")

319 
£lf
.
	`as£¹Body
("default for dir1,…aram is:('dir2', '5', '3', 'sir')")

321 #‹¡ 
th©
 
exŒa
 
pos™iÚ®
 
¬gs
 
¿i£s
 
ª
 404 
NÙ
 
Found


322 #S“ 
h‰p
:

323 
£lf
.
	`g‘Page
("/dir1/dir2/script_name/extra/stuff")

324 
£lf
.
	$as£¹Stus
(404)

326 
def
 
	$‹¡Expo£
(
£lf
):

327 #Te¡ 
the
 
ch”rypy
.
expo£
 
funùiÚ
/
decÜ©Ü


328 
£lf
.
	`g‘Page
("/exposing/base")

329 
£lf
.
	`as£¹Body
("expose works!")

331 
£lf
.
	`g‘Page
("/exposing/1")

332 
£lf
.
	`as£¹Body
("expose works!")

334 
£lf
.
	`g‘Page
("/exposing/2")

335 
£lf
.
	`as£¹Body
("expose works!")

337 
£lf
.
	`g‘Page
("/exposingnew/base")

338 
£lf
.
	`as£¹Body
("expose works!")

340 
£lf
.
	`g‘Page
("/exposingnew/1")

341 
£lf
.
	`as£¹Body
("expose works!")

343 
£lf
.
	`g‘Page
("/exposingnew/2")

344 
£lf
.
	`as£¹Body
("expose works!")

346 
def
 
	$‹¡M‘hodDi¥©ch
(
£lf
):

347 
£lf
.
	`g‘Page
("/bymethod")

348 
£lf
.
	`as£¹Body
("['another']")

349 
£lf
.
	`as£¹H—d”
('Allow', 'GET, HEAD, POST')

351 
£lf
.
	`g‘Page
("/bym‘hod", 
m‘hod
="HEAD")

352 
£lf
.
	`as£¹Body
("")

353 
£lf
.
	`as£¹H—d”
('Allow', 'GET, HEAD, POST')

355 
£lf
.
	`g‘Page
("/bym‘hod", 
m‘hod
="POST", 
body
="thing=one")

356 
£lf
.
	`as£¹Body
("")

357 
£lf
.
	`as£¹H—d”
('Allow', 'GET, HEAD, POST')

359 
£lf
.
	`g‘Page
("/bymethod")

360 
£lf
.
	`as£¹Body
(
	`»´
(['ªÙh”', 
	`Áou
('one')]))

361 
£lf
.
	`as£¹H—d”
('Allow', 'GET, HEAD, POST')

363 
£lf
.
	`g‘Page
("/bym‘hod", 
m‘hod
="PUT")

364 
£lf
.
	$as£¹E¼ÜPage
(405)

365 
£lf
.
	`as£¹H—d”
('Allow', 'GET, HEAD, POST')

367 #Te¡  
w™h
 
po¥¬ams


368 
£lf
.
	`g‘Page
("/cŞËùiÚ/sly", 
m‘hod
="POST")

369 
£lf
.
	`g‘Page
("/cŞËùiÚ", 
m‘hod
="GET")

370 
£lf
.
	`as£¹Body
("['a', 'bit', 'silly']")

372 #Te¡ 
cu¡om
 
di¥©ch”
 
£t
 
Ú
 
­p
 
	`roÙ
 (
£e
 #737).

373 
£lf
.
	`g‘Page
("/app")

374 
£lf
.
	`as£¹Body
("milk")

376 
def
 
	$‹¡T»eMouÁšg
(
£lf
):

377 
şass
 
	$RoÙ
(
objeù
):

378 
def
 
	$h–lo
(
£lf
):

380 
h–lo
.
expo£d
 = 
True


382 #Wh’ 
mouÁšg
 
ª
 
­¶iÿtiÚ
 
š¡ªû
,

383 #w
ÿn
't specify‡ different script‚ame inhe callo mount.

384 
a
 = 
	`AµliÿtiÚ
(
	`RoÙ
(), '/somewhere')

385 
£lf
.
	`as£¹Rai£s
(
V®ueE¼Ü
, 
ch”rypy
.
Œ“
.
mouÁ
, 
a
, '/somewhereelse')

387 #Wh’ 
mouÁšg
 
ª
 
­¶iÿtiÚ
 
š¡ªû
...

388 
a
 = 
	`AµliÿtiÚ
(
	`RoÙ
(), '/somewhere')

389 #...
we
 
MUST
 
®low
 
š
 
id’tiÿl
 
süt
 
Çme
 iÀ
the
 
ÿÎ
 
to
 
mouÁ
...

390 
ch”rypy
.
Œ“
.
	`mouÁ
(
a
, '/somewhere')

391 
£lf
.
	`g‘Page
('/somewhere/hello')

392 
£lf
.
	$as£¹Stus
(200)

393 #...
ªd
 
MUST
 
®low
 
a
 
missšg
 
süt_Çme
.

394 
d–
 
ch”rypy
.
Œ“
.
­ps
['/somewhere']

395 
ch”rypy
.
Œ“
.
	$mouÁ
(
a
)

396 
£lf
.
	`g‘Page
('/somewhere/hello')

397 
£lf
.
	$as£¹Stus
(200)

399 #IÀ
add™iÚ
, 
we
 
MUST
 
be
 
abË
 
to
 
ü—‹
 
ª
 
AµliÿtiÚ
 
usšg


400 #süt_Çm=ğ
NÚe
 
acûss
 
to
 
the
 
wsgi_’vœÚ
.

401 
a
 = 
	`AµliÿtiÚ
(
	`RoÙ
(), 
süt_Çme
=
NÚe
)

402 #Howev”, 
this
 
dÛs
 
nÙ
 
­¶y
 
to
 
Œ“
.
mouÁ


403 
£lf
.
	`as£¹Rai£s
(
Ty³E¼Ü
, 
ch”rypy
.
Œ“
.
mouÁ
, 
a
, 
NÚe
)

	@trunk/objs/CherryPy-3.2.4/cherrypy/test/test_proxy.py

1 
impÜt
 
ch”rypy


2 
äom
 
	gch”rypy
.
‹¡
 
impÜt
 
h–³r


4 
	gsüt_Çmes
 = ["", "/path/to/myapp"]

7 
şass
 
	$ProxyTe¡
(
h–³r
.
CPWebCa£
):

9 
def
 
	$£tup_£rv”
():

11 #S‘ 
up
 
s™e


12 
ch”rypy
.
cÚfig
.
	`upd©e
({

13 'toŞs.´oxy.Ú': 
True
,

15 
	}
})

17 #S‘ 
up
 
­¶iÿtiÚ


19 
şass
 
	gRoÙ
:

21 
def
 
	$__š™__
(
£lf
, 
¢
):

22 #C®cuÏ‹ 
a
 
URL
 
outside
 
of
 
ªy
 
»que¡s
.

23 
£lf
.
thi¢ew·ge
 = 
ch”rypy
.
	`u¾
("/this/Ãw/·ge", 
süt_Çme
=
¢
)

25 
def
 
	$·geu¾
(
£lf
):

26  
£lf
.
thi¢ew·ge


27 
·geu¾
.
expo£d
 = 
True


29 
def
 
	$šdex
(
£lf
):

30 
¿i£
 
ch”rypy
.
	`HTTPRedœeù
('dummy')

31 
šdex
.
expo£d
 = 
True


33 
def
 
	$»mÙe
(
£lf
):

34  
ch”rypy
.
»que¡
.
»mÙe
.



35 
»mÙe
.
expo£d
 = 
True


37 
def
 
	$xho¡
(
£lf
):

38 
¿i£
 
ch”rypy
.
	`HTTPRedœeù
('blah')

39 
xho¡
.
expo£d
 = 
True


40 
xho¡
.
_ı_cÚfig
 = {'tools.proxy.local': 'X-Host',

41 'toŞs.Œašg_¦ash.exŒa': 
True
,

42 
	}
}

44 
def
 
	$ba£
(
£lf
):

45  
ch”rypy
.
»que¡
.
ba£


46 
ba£
.
expo£d
 = 
True


48 
def
 
	$s¦
(
£lf
):

49  
ch”rypy
.
»que¡
.
ba£


50 
s¦
.
expo£d
 = 
True


51 
s¦
.
_ı_cÚfig
 = {'toŞs.´oxy.scheme': 'X-FÜw¬ded-S¦'
	}
}

53 
def
 
	$Ãwu¾
(
£lf
):

55 % 
ch”rypy
.
	`u¾
("/this/new/page"))

56 
Ãwu¾
.
expo£d
 = 
True


58 
¢
 
š
 
süt_Çmes
:

59 
ch”rypy
.
Œ“
.
	`mouÁ
(
	`RoÙ
(
¢
), sn)

60 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

62 
def
 
	$‹¡Proxy
(
£lf
):

63 
£lf
.
	`g‘Page
("/")

64 
£lf
.
	`as£¹H—d”
('Location',

66 (
£lf
.
scheme
, s–f.
	$´efix
()))

68 #Te¡ 
X
-
FÜw¬ded
-
	`Ho¡
 (
A·che
 1.3.33+ 
ªd
 Apache 2)

69 
£lf
.
	`g‘Page
("/", 
h—d”s
=[('X-Forwarded-Host', 'http://www.example.test')])

70 
£lf
.
	`as£¹H—d”
('Location', "http://www.example.test/dummy")

71 
£lf
.
	`g‘Page
("/", 
h—d”s
=[('X-Forwarded-Host', 'www.example.test')])

72 
£lf
.
	`as£¹H—d”
('LoÿtiÚ', "%s://www.exam¶e.‹¡/dummy" % s–f.
scheme
)

73 #Te¡ 
muÉË
 
X
-
FÜw¬ded
-
Ho¡
 
h—d”s


74 
£lf
.
	`g‘Page
("/", 
h—d”s
=[

77 
£lf
.
	`as£¹H—d”
('Location', "http://www.example.test/dummy")

79 #Te¡ 
X
-
FÜw¬ded
-
	`FÜ
 (
A·che2
)

80 
£lf
.
	`g‘Page
("/remoteip",

81 
h—d”s
=[('X-Forwarded-For', '192.168.0.20')])

82 
£lf
.
	`as£¹Body
("192.168.0.20")

83 
£lf
.
	`g‘Page
("/remoteip",

84 
h—d”s
=[('X-Forwarded-For', '67.15.36.43, 192.168.0.20')])

85 
£lf
.
	`as£¹Body
("192.168.0.20")

87 #Te¡ 
X
-
	`Ho¡
 (
ligh‰pd
; 
£e
 
h‰ps
:

88 
£lf
.
	`g‘Page
("/xho¡", 
h—d”s
=[('X-Host', 'www.example.test')])

89 
£lf
.
	`as£¹H—d”
('LoÿtiÚ', "%s://www.exam¶e.‹¡/bÏh" % s–f.
scheme
)

91 #Te¡ 
X
-
FÜw¬ded
-
	`PrÙo
 (
ligh‰pd
)

92 
£lf
.
	`g‘Page
("/ba£", 
h—d”s
=[('X-Forwarded-Proto', 'https')])

93 
£lf
.
	`as£¹Body
("https://www.mydomain.test")

95 #Te¡ 
X
-
FÜw¬ded
-
	`S¦
 (
webçùiÚ
?)

96 
£lf
.
	`g‘Page
("/s¦", 
h—d”s
=[('X-Forwarded-Ssl', 'on')])

97 
£lf
.
	`as£¹Body
("https://www.mydomain.test")

99 #Te¡ 
ch”rypy
.
	`u¾
()

100 
¢
 
š
 
süt_Çmes
:

101 #Te¡ 
the
 
v®ue
 
šside
 
»que¡s


102 
£lf
.
	`g‘Page
(
¢
 + "/newurl")

103 
£lf
.
	`as£¹Body
("Brow£Ø<¨h»f='%s://www.mydomaš.‹¡" % s–f.
scheme


104 + 
¢
 + "/this/new/page'>this…age</a>.")

105 
£lf
.
	`g‘Page
(
¢
 + "/Ãwu¾", 
h—d”s
=[('X-Forwarded-Host',

107 
£lf
.
	`as£¹Body
("Browseo <a href='http://www.example.test"

108 + 
¢
 + "/this/new/page'>this…age</a>.")

110 #Te¡ 
the
 
v®ue
 
outside
 
»que¡s


111 
pÜt
 = ""

112 
£lf
.
scheme
 =ğ"h‰p" 
ªd
 s–f.
PORT
 != 80:

113 
pÜt
 = ":%s" % 
£lf
.
PORT


114 
–if
 
£lf
.
scheme
 =ğ"h‰ps" 
ªd
 s–f.
PORT
 != 443:

115 
pÜt
 = ":%s" % 
£lf
.
PORT


116 
ho¡
 = 
£lf
.
HOST


117 
ho¡
 
	`š
 ('0.0.0.0', '::'):

118 
impÜt
 
sock‘


119 
ho¡
 = 
sock‘
.
	$g‘ho¡Çme
()

120 
ex³ùed
 = ("%s://%s%s%s/this/new/page"

121 % (
£lf
.
scheme
, 
ho¡
, 
pÜt
, 
¢
))

122 
£lf
.
	`g‘Page
(
¢
 + "/pageurl")

123 
£lf
.
	$as£¹Body
(
ex³ùed
)

125 #Te¡ 
Œašg
 
	`¦ash
 (
£e
 
h‰p
:

126 
£lf
.
	`g‘Page
("/xho¡/", 
h—d”s
=[('X-Host', 'www.example.test')])

127 
£lf
.
	`as£¹H—d”
('Location', "%s://www.example.test/xhost"

128 % 
£lf
.
scheme
)

	@trunk/objs/CherryPy-3.2.4/cherrypy/test/test_refleaks.py

3 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
	gHTTPCÚÃùiÚ
, 
	gHTTPSCÚÃùiÚ
, 
Áob


4 
impÜt
 
th»adšg


6 
impÜt
 
ch”rypy


9 
	gd©a
 = 
	$objeù
()

12 
äom
 
ch”rypy
.
‹¡
 
impÜt
 
h–³r


15 
şass
 
	$Reã»nûTe¡s
(
h–³r
.
CPWebCa£
):

17 
def
 
	$£tup_£rv”
():

19 
şass
 
RoÙ
:

20 
def
 
	$šdex
(
£lf
, *
¬gs
, **
kw¬gs
):

21 
ch”rypy
.
»que¡
.
thšg
 = 
d©a


23 
šdex
.
expo£d
 = 
True


25 
ch”rypy
.
Œ“
.
	`mouÁ
(
	$RoÙ
())

26 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

28 
def
 
	$‹¡_th»adloÿl_g¬bage
(
£lf
):

29 
sucûss
 = []

31 
def
 
	$g‘·ge
():

32 
ho¡
 = '%s:%s' % (
£lf
.
	`š‹rçû
(), s–f.
PORT
)

33 
£lf
.
scheme
 == 'https':

34 
c
 = 
	$HTTPSCÚÃùiÚ
(
ho¡
)

36 
c
 = 
	$HTTPCÚÃùiÚ
(
ho¡
)

37 
Œy
:

38 
c
.
	`puŒeque¡
('GET', '/')

39 
c
.
	$’dh—d”s
()

40 
»¥Ú£
 = 
c
.
	$g‘»¥Ú£
()

41 
body
 = 
»¥Ú£
.
	$»ad
()

42 
£lf
.
	$as£¹Equ®
(
»¥Ú£
.
¡©us
, 200)

43 
£lf
.
	`as£¹Equ®
(
body
, 
	`Áob
("Hello world!"))

44 
fš®ly
:

45 
c
.
	$şo£
()

46 
sucûss
.
	$­³nd
(
True
)

48 
ITERATIONS
 = 25

49 
ts
 = []

50 
_
 
š
 
	$¿nge
(
ITERATIONS
):

51 
t
 = 
th»adšg
.
	$Th»ad
(
rg‘
=
g‘·ge
)

52 
ts
.
	$­³nd
(
t
)

53 
t
.
	$¡¬t
()

55 
t
 
š
 
ts
:

56 
t
.
	$još
()

58 
£lf
.
	`as£¹Equ®
(
	`Ën
(
sucûss
), 
ITERATIONS
)

	@trunk/objs/CherryPy-3.2.4/cherrypy/test/test_request_obj.py

3 
impÜt
 
os


4 
	gloÿlDœ
 = 
os
.
·th
.
	$dœÇme
(
__fe__
)

5 
impÜt
 
sys


6 
impÜt
 
ty³s


7 
äom
 
ch”rypy
.
_ıcom·t
 
impÜt
 
Incom¶‘eR—d
, 
Áob
, 
Áou
, 
unicode¡r


9 
impÜt
 
ch”rypy


10 
äom
 
ch”rypy
 
impÜt
 
_ıtoŞs
, 
toŞs


11 
äom
 
ch”rypy
.
lib
 
impÜt
 
h‰put


13 
defšed_h‰p_m‘hods
 = ("OPTIONS", "GET", "HEAD", "POST", "PUT", "DELETE",

17 #Cl›Á-
side
 
code
 #


18 
äom
 
ch”rypy
.
‹¡
 
impÜt
 
h–³r


20 
şass
 
	$Reque¡ObjeùTe¡s
(
h–³r
.
CPWebCa£
):

22 
def
 
	$£tup_£rv”
():

23 
şass
 
RoÙ
:

25 
def
 
	$šdex
(
£lf
):

27 
šdex
.
expo£d
 = 
True


29 
def
 
	$scheme
(
£lf
):

30  
ch”rypy
.
»que¡
.
scheme


31 
scheme
.
expo£d
 = 
True


33 
roÙ
 = 
	$RoÙ
()

36 
şass
 
	$Te¡Ty³
(
ty³
):

38 
ªd
 
adds
 
ª
 
š¡ªû
 
of
 
the
 
subşass
 
as
‡À
©Œibu‹
 oà
roÙ
.

40 
def
 
	$__š™__
(
şs
, 
Çme
, 
ba£s
, 
dù
):

41 
ty³
.
	$__š™__
(
şs
, 
Çme
, 
ba£s
, 
dù
)

42 
v®ue
 
š
 
dù
.
	$v®ues
():

43 
	$isš¡ªû
(
v®ue
, 
ty³s
.
FunùiÚTy³
):

44 
v®ue
.
expo£d
 = 
True


45 
	`£‰r
(
roÙ
, 
Çme
.
	`low”
(), 
	$şs
())

46 
Te¡
 = 
	`Te¡Ty³
('Te¡', (
objeù
,), {
	}
})

48 
şass
 
	$P©hInfo
(
Te¡
):

50 
def
 (
£lf
, *
¬gs
):

51  
ch”rypy
.
»que¡
.
·th_šfo


53 
şass
 
	$P¬ams
(
Te¡
):

55 
def
 
	$šdex
(
£lf
, 
thšg
):

56  
	$»´
(
thšg
)

58 
def
 
	$ism­
(
£lf
, 
x
, 
y
):

59  "CoÜdš©es: %s, %s" % (
x
, 
y
)

61 
def
 (
£lf
, *
¬gs
, **
kw¬gs
):

62  "¬gs: % kw¬gs: %s" % (
¬gs
, 
kw¬gs
)

63 .
_ı_cÚfig
 = {'»que¡.qu”y_¡ršg_’codšg': 'Ïtš1'
	}
}

66 
şass
 
	$P¬amE¼ÜsC®ÏbË
(
objeù
):

67 
expo£d
 = 
True


68 
def
 
	$__ÿÎ__
(
£lf
):

71 
şass
 
	$P¬amE¼Üs
(
Te¡
):

73 
def
 
	$Úe_pos™iÚ®
(
£lf
, 
·¿m1
):

75 
Úe_pos™iÚ®
.
expo£d
 = 
True


77 
def
 
	$Úe_pos™iÚ®_¬gs
(
£lf
, 
·¿m1
, *
¬gs
):

79 
Úe_pos™iÚ®_¬gs
.
expo£d
 = 
True


81 
def
 
	$Úe_pos™iÚ®_¬gs_kw¬gs
(
£lf
, 
·¿m1
, *
¬gs
, **
kw¬gs
):

83 
Úe_pos™iÚ®_¬gs_kw¬gs
.
expo£d
 = 
True


85 
def
 
	$Úe_pos™iÚ®_kw¬gs
(
£lf
, 
·¿m1
, **
kw¬gs
):

87 
Úe_pos™iÚ®_kw¬gs
.
expo£d
 = 
True


89 
def
 
	$no_pos™iÚ®
(
£lf
):

91 
no_pos™iÚ®
.
expo£d
 = 
True


93 
def
 
	$no_pos™iÚ®_¬gs
(
£lf
, *
¬gs
):

95 
no_pos™iÚ®_¬gs
.
expo£d
 = 
True


97 
def
 
	$no_pos™iÚ®_¬gs_kw¬gs
(
£lf
, *
¬gs
, **
kw¬gs
):

99 
no_pos™iÚ®_¬gs_kw¬gs
.
expo£d
 = 
True


101 
def
 
	$no_pos™iÚ®_kw¬gs
(
£lf
, **
kw¬gs
):

103 
no_pos™iÚ®_kw¬gs
.
expo£d
 = 
True


105 
ÿÎabË_objeù
 = 
	$P¬amE¼ÜsC®ÏbË
()

107 
def
 
	$¿i£_ty³_”rÜ
(
£lf
, **
kw¬gs
):

108 
¿i£
 
	`Ty³E¼Ü
("Client Error")

109 
¿i£_ty³_”rÜ
.
expo£d
 = 
True


111 
def
 
	$¿i£_ty³_”rÜ_w™h_deçuÉ_·¿m
(
£lf
, 
x
, 
y
=
NÚe
):

112  '%d' % 'a' #throw 
ª
 
exû±iÚ


113 
¿i£_ty³_”rÜ_w™h_deçuÉ_·¿m
.
expo£d
 = 
True


115 
def
 
	$ÿÎabË_”rÜ_·ge
(
¡©us
, **
kw¬gs
):

116  "E¼Ü % - W–l, I'm v”y sÜry buˆyou hav’'ˆ·id!" % 
¡©us


119 
şass
 
	$E¼Ü
(
Te¡
):

121 
_ı_cÚfig
 = {'toŞs.log_Œaûbacks.Ú': 
True
,

122 
	}
}

124 
def
 
	$»asÚ_ph¿£
(
£lf
):

125 
¿i£
 
ch”rypy
.
	`HTTPE¼Ü
("410 Gone fishin'")

127 
def
 
	`cu¡om
(
£lf
, 
”r
='404'):

128 
¿i£
 
ch”rypy
.
	`HTTPE¼Ü
((
”r
), "No, <b>really</b>,‚ot found!")

129 
cu¡om
.
_ı_cÚfig
 = {'”rÜ_·ge.404': 
os
.
·th
.
	`još
(
loÿlDœ
, "static/index.html"),

130 '”rÜ_·ge.401': 
ÿÎabË_”rÜ_·ge
,

131 
	}
}

133 
def
 
	$cu¡om_deçuÉ
(
£lf
):

134  1 + 'a' #¿i£ 
ª
 
uÃx³ùed
 
”rÜ


135 
cu¡om_deçuÉ
.
_ı_cÚfig
 = {'”rÜ_·ge.deçuÉ': 
ÿÎabË_”rÜ_·ge
}

137 
def
 
	$nÛxi¡
(
£lf
):

138 
¿i£
 
ch”rypy
.
	`HTTPE¼Ü
(404, "No, <b>really</b>,‚ot found!")

139 
nÛxi¡
.
_ı_cÚfig
 = {'”rÜ_·ge.404': "nÚexi¡’t.html"
	}
}

141 
def
 
	$·ge_m‘hod
(
£lf
):

142 
¿i£
 
	$V®ueE¼Ü
()

144 
def
 
	$·ge_y›ld
(
£lf
):

145 
y›ld
 "howdy"

146 
¿i£
 
	$V®ueE¼Ü
()

148 
def
 
	$·ge_¡»amed
(
£lf
):

149 
y›ld
 "word up"

150 
¿i£
 
	$V®ueE¼Ü
()

151 
y›ld
 "very oops"

152 
·ge_¡»amed
.
_ı_cÚfig
 = {"»¥Ú£.¡»am": 
True
}

154 
def
 
	$ÿu£_”r_š_fš®ize
(
£lf
):

155 #Sšû 
¡©us
 
mu¡
 
¡¬t
 
w™h
 
ª
 , 
this
 
should
 
”rÜ
.

156 
ch”rypy
.
»¥Ú£
.
¡©us
 = "ZOO OK"

157 
ÿu£_”r_š_fš®ize
.
_ı_cÚfig
 = {'»que¡.show_Œaûbacks': 
F®£
}

159 
def
 
	$»throw
(
£lf
):

161 
¿i£
 
	$V®ueE¼Ü
()

162 
»throw
.
_ı_cÚfig
 = {'»que¡.throw_”rÜs': 
True
}

165 
şass
 
	$Ex³ù
(
Te¡
):

167 
def
 
	$ex³ù©iÚ_çed
(
£lf
):

168 
ex³ù
 = 
ch”rypy
.
»que¡
.
h—d”s
.
	`–em’ts
("Expect")

169 
ex³ù
 
ªd
ƒx³ù[0].
v®ue
 != '100-continue':

170 
¿i£
 
ch”rypy
.
	$HTTPE¼Ü
(400)

171 
¿i£
 
ch”rypy
.
	`HTTPE¼Ü
(417, 'Expectation Failed')

173 
şass
 
	$H—d”s
(
Te¡
):

175 
def
 (
£lf
, 
h—d”Çme
):

177  
ch”rypy
.
»que¡
.
h—d”s
[
h—d”Çme
]

179 
def
 
	$doubËdh—d”s
(
£lf
):

180 #From 
h‰p
:

181 #"
h—d”
 
f›ld
 
Çmes
 
should
 
nÙ
 
be
 
£ns™ive
 
§yes
 
the
 
rfc
.

182 #ià
i
 
£t
 
a
 
h—d”f›ld
 
š
 
com¶‘e
 
low”ÿ£
 i 
’d
 
up
 
w™h
 
two


183 #h—d” 
f›lds
, 
Úe
 
š
 
low”ÿ£
, 
the
 
Ùh”
 iÀ
mixed
-."

185 #S‘ 
the
 
mo¡
 
commÚ
 
h—d”s


186 
hM­
 = 
ch”rypy
.
»¥Ú£
.
h—d”s


187 
hM­
['content-type'] = "text/html"

188 
hM­
['content-length'] = 18

189 
hM­
['server'] = 'CherryPy headertest'

190 
hM­
['location'] = ('%s://%s:%s/headers/'

191 % (
ch”rypy
.
»que¡
.
loÿl
.

,

192 
ch”rypy
.
»que¡
.
loÿl
.
pÜt
,

193 
ch”rypy
.
»que¡
.
scheme
))

195 #S‘ 
a
 
¿»
 
h—d”
 
fun


196 
hM­
['Expires'] = 'Thu, 01 Dec 2194 16:00:00 GMT'

200 
def
 
	$ifm©ch
(
£lf
):

201 
v®
 = 
ch”rypy
.
»que¡
.
h—d”s
['If-Match']

202 
as£¹
 
	$isš¡ªû
(
v®
, 
unicode¡r
)

203 
ch”rypy
.
»¥Ú£
.
h—d”s
['ETag'] = 
v®


204  
v®


207 
şass
 
	$H—d”EËm’ts
(
Te¡
):

209 
def
 
	$g‘_–em’ts
(
£lf
, 
h—d”Çme
):

210 
e
 = 
ch”rypy
.
»que¡
.
h—d”s
.
	$–em’ts
(
h—d”Çme
)

211  "\n".
	`još
([
	$unicode¡r
(
x
èx 
š
 
e
])

214 
şass
 
	$M‘hod
(
Te¡
):

216 
def
 
	$šdex
(
£lf
):

217 
m
 = 
ch”rypy
.
»que¡
.
m‘hod


218 
m
 
š
 
defšed_h‰p_m‘hods
 
Ü
 m == "CONNECT":

219  
m


221 
m
 == "LINK":

222 
¿i£
 
ch”rypy
.
	$HTTPE¼Ü
(405)

224 
¿i£
 
ch”rypy
.
	$HTTPE¼Ü
(501)

226 
def
 
	$·¿m‘”ized
(
£lf
, 
d©a
):

227  
d©a


229 
def
 
	$»que¡_body
(
£lf
):

230 #Thi 
should
 
be
 
a
 
fe
 
	`objeù
 (
‹mp
 file),

231 #which 
CP
 
wl
 
ju¡
 
pe
 
back
 
out
 
we
 
‹Î
 
™
 
to
.

232  
ch”rypy
.
»que¡
.
body


234 
def
 
	$»achabË
(
£lf
):

237 
şass
 
DivÜû
:

239 
FÜ
 
exam¶e
, 
a
 
GET
-
hªdËr
 
shouldn
'ˆcŞlidw™h‡ m‘hod‚amed '
g‘
'.

241 
If
 
you
 
bud
 
HTTP
 
m‘hod
 
di¥©chšg
 
što
 
Ch”ryPy
, 
»wr™e
 
this
 
şass


242 
to
 
u£
 
your
 
Ãw
 
di¥©ch
 
mechªism
 
ªd
 
make
 
su»
 
th©
:

243 "GET /divÜû HTTP/1.1" 
m­s
 
to
 
divÜû
.
	$šdex
(è
ªd


244 "GET /divÜû/g‘?ID=13 HTTP/1.1" 
m­s
 
to
 
divÜû
.
	`g‘
()

247 
docum’ts
 = {
	}
}

249 
def
 
	$šdex
(
£lf
):

250 
y›ld
 "<h1>Choose your document</h1>\n"

251 
y›ld
 "<ul>\n"

252 
id
, 
cÚ‹Ás
 
š
 
£lf
.
docum’ts
.
	$™ems
():

253 
	`y›ld
 (" <li><a href='/divorce/get?ID=%s'>%s</a>: %s</li>\n"

254 % (
id
, id, 
cÚ‹Ás
))

255 
y›ld
 "</ul>"

256 
šdex
.
expo£d
 = 
True


258 
def
 
	$g‘
(
£lf
, 
ID
):

260 (
ID
, 
£lf
.
docum’ts
.
	`g‘
(ID, "empty")))

261 
g‘
.
expo£d
 = 
True


263 
roÙ
.
divÜû
 = 
	$DivÜû
()

266 
şass
 
	$Th»adLoÿl
(
Te¡
):

268 
def
 
	$šdex
(
£lf
):

269 
exi¡šg
 = 
	`»´
(
	`g‘©Œ
(
ch”rypy
.
»que¡
, "asdf", 
NÚe
))

270 
ch”rypy
.
»que¡
.
asdf
 = "rassfrassin"

271  
exi¡šg


273 
­pcÚf
 = {

275 
	}
}

276 
ch”rypy
.
Œ“
.
	$mouÁ
(
roÙ
, 
cÚfig
=
­pcÚf
)

277 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

279 
def
 
	$‹¡_scheme
(
£lf
):

280 
£lf
.
	`g‘Page
("/scheme")

281 
£lf
.
	$as£¹Body
(
£lf
.
scheme
)

283 
def
 
	$‹¡R–©iveURIP©hInfo
(
£lf
):

284 
£lf
.
	`g‘Page
("/pathinfo/foo/bar")

285 
£lf
.
	`as£¹Body
("/pathinfo/foo/bar")

287 
def
 
	$‹¡AbsŞu‹URIP©hInfo
(
£lf
):

289 
£lf
.
	`g‘Page
("http://localhost/pathinfo/foo/bar")

290 
£lf
.
	`as£¹Body
("/pathinfo/foo/bar")

292 
def
 
	$‹¡P¬ams
(
£lf
):

293 
£lf
.
	`g‘Page
("/params/?thing=a")

294 
£lf
.
	`as£¹Body
(
	`»´
(
	`Áou
("a")))

296 
£lf
.
	`g‘Page
("/params/?thing=a&thing=b&thing=c")

297 
£lf
.
	`as£¹Body
(
	`»´
([
	`Áou
('a'),‚tou('b'),‚tou('c')]))

299 #Te¡ 
ä›ndly
 
”rÜ
 
mes§ge
 
wh’
 
giv’
 
·¿ms
 
¬e
 
nÙ
 
acû±ed
.

300 
ch”rypy
.
cÚfig
.
	`upd©e
({"»que¡.show_mism©ched_·¿ms": 
True
})

301 
£lf
.
g‘Page
("/params/?notathing=meeting")

302 
£lf
.
as£¹InBody
("Missing…arameters:hing")

303 
£lf
.
g‘Page
("/params/?thing=meeting&notathing=meeting")

304 
£lf
.
as£¹InBody
("Unexpected query string…arameters:‚otathing")

306 #Te¡ 
ab™y
 
to
 
tuº
 
off
 
ä›ndly
 
”rÜ
 
mes§ges


307 
ch”rypy
.
cÚfig
.
upd©e
({"»que¡.show_mism©ched_·¿ms": 
F®£
})

308 
£lf
.
g‘Page
("/params/?notathing=meeting")

309 
£lf
.
as£¹InBody
("Not Found")

310 
£lf
.
g‘Page
("/params/?thing=meeting&notathing=meeting")

311 
£lf
.
as£¹InBody
("Not Found")

313 #Te¡ "% HEX HEX"-
’coded
 
URL
, 
·¿m
 
keys
, 
ªd
 
v®ues


314 
	g£lf
.
g‘Page
("/params/%d4%20%e3/cheese?Gruy%E8re=Bulgn%e9ville")

315 
	g£lf
.
as£¹Body
("args: %s kwargs: %s" %

317 {'Gruy\xe8»': 
Áou
('Bulgn\xe9ville')}))

319 #Mak
su»
 
th©
 
’coded
 = 
ªd
 & 
g‘
 
·r£d
 
cÜ»ùly


320 
£lf
.
g‘Page
("/params/code?url=http%3A//cherrypy.org/index%3Fa%3D1%26b%3D2")

321 
£lf
.
as£¹Body
("args: %s kwargs: %s" %

323 {'u¾': 
Áou
('http://cherrypy.org/index?a=1&b=2')}))

325 #Te¡ 
coÜdš©es
 
£Á
 
by
 <
img
 
ism­
>

326 
£lf
.
g‘Page
("/params/ismap?223,114")

327 
£lf
.
as£¹Body
("Coordinates: 223, 114")

329 #Te¡ "Çme[key]" 
diù
-
like
 
·¿ms


330 
£lf
.
g‘Page
("/params/dictlike?a[1]=1&a[2]=2&b=foo&b[bar]=baz")

331 
£lf
.
as£¹Body
("args: %s kwargs: %s" %

333 {'a[1]': 
Áou
('1'), 'b[bar]':‚tou('baz'),

334 'b': 
Áou
('foo'), 'a[2]':‚tou('2')}))

336 
def
 
	$‹¡P¬amE¼Üs
(
£lf
):

338 #‹¡ 
th©
 
®l
 
of
 
the
 
hªdËrs
 
wÜk
 
wh’
 
giv’


339 #th
cÜ»ù
 
·¿m‘”s
 
š
 
Üd”
 
to
 
’su»
 
th©
 
the


340 #”rÜ 
b–ow
 
¬’
't coming from some other source.

341 
uri
 
	`š
 (

360 
£lf
.
	$g‘Page
(
uri
)

361 
£lf
.
	$as£¹Stus
(200)

363 #qu”y 
¡ršg
 
·¿m‘”s
 
¬e
 
·¹
 
of
 
the
 
URI
, 
so
 
they
‡» 
wrÚg


364 #fÜ 
a
 
·¹icuÏr
 
hªdËr
, 
the
 
¡©us
 
MUST
 
be
‡ 404.

365 
”rÜ_msgs
 = [

372 
uri
, 
msg
 
	`š
 (

373 ('/·¿m”rÜs/Úe_pos™iÚ®', 
”rÜ_msgs
[0]),

374 ('/·¿m”rÜs/Úe_pos™iÚ®?foo=foo', 
”rÜ_msgs
[0]),

375 ('/·¿m”rÜs/Úe_pos™iÚ®/foo/b¬/baz', 
”rÜ_msgs
[1]),

376 ('/·¿m”rÜs/Úe_pos™iÚ®/foo?·¿m1=foo', 
”rÜ_msgs
[2]),

377 ('/·¿m”rÜs/Úe_pos™iÚ®/foo?·¿m1=foo&·¿m2=foo', 
”rÜ_msgs
[2]),

378 ('/·¿m”rÜs/Úe_pos™iÚ®_¬gs/foo?·¿m1=foo&·¿m2=foo', 
”rÜ_msgs
[2]),

379 ('/·¿m”rÜs/Úe_pos™iÚ®_¬gs/foo/b¬/baz?·¿m2=foo', 
”rÜ_msgs
[3]),

380 ('/·¿m”rÜs/Úe_pos™iÚ®_¬gs_kw¬gs/foo/b¬/baz?·¿m1=b¬&·¿m3=baz', 
”rÜ_msgs
[2]),

381 ('/·¿m”rÜs/Úe_pos™iÚ®_kw¬gs/foo?·¿m1=foo&·¿m2=b¬&·¿m3=baz', 
”rÜ_msgs
[2]),

382 ('/·¿m”rÜs/no_pos™iÚ®/boo', 
”rÜ_msgs
[1]),

383 ('/·¿m”rÜs/no_pos™iÚ®?·¿m1=foo', 
”rÜ_msgs
[3]),

384 ('/·¿m”rÜs/no_pos™iÚ®_¬gs/boo?·¿m1=foo', 
”rÜ_msgs
[3]),

385 ('/·¿m”rÜs/no_pos™iÚ®_kw¬gs/boo?·¿m1=foo', 
”rÜ_msgs
[1]),

386 ('/·¿m”rÜs/ÿÎabË_objeù?·¿m1=foo', 
”rÜ_msgs
[3]),

387 ('/·¿m”rÜs/ÿÎabË_objeù/boo', 
”rÜ_msgs
[1]),

389 
show_mism©ched_·¿ms
 
	$š
 (
True
, 
F®£
):

390 
ch”rypy
.
cÚfig
.
	`upd©e
({'»que¡.show_mism©ched_·¿ms': 
show_mism©ched_·¿ms
})

391 
£lf
.
	$g‘Page
(
uri
)

392 
£lf
.
	$as£¹Stus
(404)

393 
show_mism©ched_·¿ms
:

394 
£lf
.
	$as£¹InBody
(
msg
)

396 
£lf
.
	`as£¹InBody
("Not Found")

398 #ià
body
 
·¿m‘”s
 
¬e
 
wrÚg
, 
a
 400 
mu¡
 
be
 
»tuºed
.

399 
uri
, 
body
, 
msg
 
	`š
 (

400 ('/·¿m”rÜs/Úe_pos™iÚ®/foo', '·¿m1=foo', 
”rÜ_msgs
[2]),

401 ('/·¿m”rÜs/Úe_pos™iÚ®/foo', '·¿m1=foo&·¿m2=foo', 
”rÜ_msgs
[2]),

402 ('/·¿m”rÜs/Úe_pos™iÚ®_¬gs/foo', '·¿m1=foo&·¿m2=foo', 
”rÜ_msgs
[2]),

403 ('/·¿m”rÜs/Úe_pos™iÚ®_¬gs/foo/b¬/baz', '·¿m2=foo', 
”rÜ_msgs
[4]),

404 ('/·¿m”rÜs/Úe_pos™iÚ®_¬gs_kw¬gs/foo/b¬/baz', '·¿m1=b¬&·¿m3=baz', 
”rÜ_msgs
[2]),

405 ('/·¿m”rÜs/Úe_pos™iÚ®_kw¬gs/foo', '·¿m1=foo&·¿m2=b¬&·¿m3=baz', 
”rÜ_msgs
[2]),

406 ('/·¿m”rÜs/no_pos™iÚ®', '·¿m1=foo', 
”rÜ_msgs
[4]),

407 ('/·¿m”rÜs/no_pos™iÚ®_¬gs/boo', '·¿m1=foo', 
”rÜ_msgs
[4]),

408 ('/·¿m”rÜs/ÿÎabË_objeù', '·¿m1=foo', 
”rÜ_msgs
[4]),

410 
show_mism©ched_·¿ms
 
	$š
 (
True
, 
F®£
):

411 
ch”rypy
.
cÚfig
.
	`upd©e
({'»que¡.show_mism©ched_·¿ms': 
show_mism©ched_·¿ms
})

412 
£lf
.
g‘Page
(
uri
, 
m‘hod
='POST', 
body
=body)

413 
£lf
.
	$as£¹Stus
(400)

414 
show_mism©ched_·¿ms
:

415 
£lf
.
	$as£¹InBody
(
msg
)

417 
£lf
.
	`as£¹InBody
("400 Bad")

420 #ev’ 
body
 
·¿m‘”s
 
¬e
 
wrÚg
, 
we
 
g‘
 
the
 
uri
 wrÚg, 
th’


422 
uri
, 
body
, 
msg
 
	`š
 (

423 ('/·¿m”rÜs/Úe_pos™iÚ®?·¿m2=foo', '·¿m1=foo', 
”rÜ_msgs
[3]),

424 ('/·¿m”rÜs/Úe_pos™iÚ®/foo/b¬', '·¿m2=foo', 
”rÜ_msgs
[1]),

425 ('/·¿m”rÜs/Úe_pos™iÚ®_¬gs/foo/b¬?·¿m2=foo', '·¿m3=foo', 
”rÜ_msgs
[3]),

426 ('/·¿m”rÜs/Úe_pos™iÚ®_kw¬gs/foo/b¬', '·¿m2=b¬&·¿m3=baz', 
”rÜ_msgs
[1]),

427 ('/·¿m”rÜs/no_pos™iÚ®?·¿m1=foo', '·¿m2=foo', 
”rÜ_msgs
[3]),

428 ('/·¿m”rÜs/no_pos™iÚ®_¬gs/boo?·¿m2=foo', '·¿m1=foo', 
”rÜ_msgs
[3]),

429 ('/·¿m”rÜs/ÿÎabË_objeù?·¿m2=b¬', '·¿m1=foo', 
”rÜ_msgs
[3]),

431 
show_mism©ched_·¿ms
 
	$š
 (
True
, 
F®£
):

432 
ch”rypy
.
cÚfig
.
	`upd©e
({'»que¡.show_mism©ched_·¿ms': 
show_mism©ched_·¿ms
})

433 
£lf
.
g‘Page
(
uri
, 
m‘hod
='POST', 
body
=body)

434 
£lf
.
	$as£¹Stus
(404)

435 
show_mism©ched_·¿ms
:

436 
£lf
.
	$as£¹InBody
(
msg
)

438 
£lf
.
	`as£¹InBody
("Not Found")

440 #IÀ
the
 
th©
 
a
 
hªdËr
 
¿i£s
‡ 
Ty³E¼Ü
 
we
 
should


441 #Ëˆ
th©
 
ty³
 
”rÜ
 
through
.

442 
uri
 
	`š
 (

447 
£lf
.
	`g‘Page
(
uri
, 
m‘hod
='GET')

448 
£lf
.
	$as£¹Stus
(500)

449 
£lf
.
	`as£¹True
('Cl›Á E¼Ü', s–f.
body
)

451 
def
 
	$‹¡E¼ÜHªdlšg
(
£lf
):

452 
£lf
.
	`g‘Page
("/error/missing")

453 
£lf
.
	$as£¹Stus
(404)

454 
£lf
.
	`as£¹E¼ÜPage
(404, "The…ath '/error/missing' was‚ot found.")

456 
ignÜe
 = 
h–³r
.
web‹¡
.
ignÜed_exû±iÚs


457 
ignÜe
.
	$­³nd
(
V®ueE¼Ü
)

458 
Œy
:

459 
v®”r
 = '\n„aise ValueError()\nValueError'

460 
£lf
.
	`g‘Page
("/error/page_method")

461 
£lf
.
	$as£¹E¼ÜPage
(500, 
·‰”n
=
v®”r
)

463 
£lf
.
	`g‘Page
("/error/page_yield")

464 
£lf
.
	$as£¹E¼ÜPage
(500, 
·‰”n
=
v®”r
)

466 ià(
ch”rypy
.
£rv”
.
´ÙocŞ_v”siÚ
 =ğ"HTTP/1.0" 
Ü


467 
	`g‘©Œ
(
ch”rypy
.
£rv”
, "usšg_­ache", 
F®£
)):

468 
£lf
.
	`g‘Page
("/error/page_streamed")

469 #Beÿu£ 
this
 
”rÜ
 
is
 
¿i£d
 
aá”
 
the
 
»¥Ú£
 
body
 
has


470 #¡¬‹d, 
the
 
¡©us
 
should
 
nÙ
 
chªge
 
to
 
ª
 
”rÜ
 status.

471 
£lf
.
	$as£¹Stus
(200)

472 
£lf
.
	`as£¹Body
("word up")

474 #Und” 
HTTP
/1.1, 
the
 
chunked
 
Œªsãr
-
codšg
 
is
 
u£d
.

475 #Th
HTTP
 
ş›Á
 
wl
 
choke
 
wh’
 
the
 
ouut
 
is
 
šcom¶‘e
.

476 
£lf
.
	`as£¹Rai£s
((
V®ueE¼Ü
, 
Incom¶‘eR—d
), s–f.
g‘Page
,

479 #NØ
Œaûback
 
should
 
be
 
´e£Á


480 
£lf
.
	`g‘Page
("/error/cause_err_in_finalize")

481 
msg
 = "Illegal„esponse status from server ('ZOO' is‚on-numeric)."

482 
£lf
.
	$as£¹E¼ÜPage
(500, 
msg
, 
NÚe
)

483 
fš®ly
:

484 
ignÜe
.
	$pİ
()

486 #Te¡ 
HTTPE¼Ü
 
w™h
 
a
 
»asÚ
-
ph¿£
 
š
 
the
 
¡©us
 
¬g
.

487 
£lf
.
	`g‘Page
('/error/reason_phrase')

488 
£lf
.
	`as£¹Stus
("410 Gone fishin'")

490 #Te¡ 
cu¡om
 
”rÜ
 
·ge
 
a
 
¥ecific
ƒrror.

491 
£lf
.
	`g‘Page
("/error/custom")

492 
£lf
.
	$as£¹Stus
(404)

493 
£lf
.
	`as£¹Body
("Hello, world\r\n" + (" " * 499))

495 #Te¡ 
cu¡om
 
”rÜ
 
·ge
 
a
 
¥ecific
ƒrror.

496 
£lf
.
	`g‘Page
("/error/custom?err=401")

497 
£lf
.
	$as£¹Stus
(401)

498 
£lf
.
	`as£¹Body
("Error 401 Unauthorized - Well, I'm very sorry but you haven't…aid!")

500 #Te¡  
cu¡om
 
”rÜ
 
·ge
.

501 
£lf
.
	`g‘Page
("/error/custom_default")

502 
£lf
.
	$as£¹Stus
(500)

503 
£lf
.
	`as£¹Body
("E¼Ü 500 IÁ”ÇÈS”v” E¼Ü - W–l, I'm v”y sÜry buˆyou hav’'ˆ·id!".
	$lju¡
(513))

505 #Te¡ 
”rÜ
 
š
 
cu¡om
ƒ¼Ü 
	`·ge
 (
tick‘
 #305).

506 #NÙ
th©
 
the
 
mes§ge
 
is
 
esÿ³d
 
	`HTML
 (
tick‘
 #310).

507 
£lf
.
	`g‘Page
("/error/noexist")

508 
£lf
.
	$as£¹Stus
(404)

509 
msg
 = ("No, &lt;b&gt;really&lt;/b&gt;,‚ot found!<br />"

512 
£lf
.
	$as£¹InBody
(
msg
)

514 
	`g‘©Œ
(
ch”rypy
.
£rv”
, "usšg_­ache", 
F®£
):

515 
·ss


517 #Te¡ 
	`throw_”rÜs
 (
tick‘
 #186).

518 
£lf
.
	`g‘Page
("/error/rethrow")

519 
£lf
.
	`as£¹InBody
("raise ValueError()")

521 
def
 
	$‹¡Ex³ù
(
£lf
):

522 
e
 = ('Expect', '100-continue')

523 
£lf
.
	`g‘Page
("/h—d”–em’ts/g‘_–em’ts?h—d”Çme=Ex³ù", [
e
])

524 
£lf
.
	`as£¹Body
('100-continue')

526 
£lf
.
	`g‘Page
("/ex³ù/ex³ù©iÚ_çed", [
e
])

527 
£lf
.
	$as£¹Stus
(417)

529 
def
 
	$‹¡H—d”EËm’ts
(
£lf
):

530 #Acû±-* 
h—d”
 
–em’ts
 
should
 
be
 
sÜ‹d
, 
w™h
 
mo¡
 
´eã¼ed
 
fœ¡
.

531 
h
 = [('Accept', 'audio/*; q=0.2,‡udio/basic')]

532 
£lf
.
	`g‘Page
("/h—d”–em’ts/g‘_–em’ts?h—d”Çme=Acû±", 
h
)

533 
£lf
.
	$as£¹Stus
(200)

534 
£lf
.
	`as£¹Body
("audio/basic\n"

537 
h
 = [('Accept', 'text/plain; q=0.5,ext/html,ext/x-dvi; q=0.8,ext/x-c')]

538 
£lf
.
	`g‘Page
("/h—d”–em’ts/g‘_–em’ts?h—d”Çme=Acû±", 
h
)

539 
£lf
.
	$as£¹Stus
(200)

540 
£lf
.
	`as£¹Body
("text/x-c\n"

545 #Te¡ 
th©
 
mÜe
 
¥ecific
 
medŸ
 
¿nges
 
g‘
 
´iÜ™y
.

546 
h
 = [('Accept', 'text/*,ext/html,ext/html;level=1, */*')]

547 
£lf
.
	`g‘Page
("/h—d”–em’ts/g‘_–em’ts?h—d”Çme=Acû±", 
h
)

548 
£lf
.
	$as£¹Stus
(200)

549 
£lf
.
	`as£¹Body
("text/html;level=1\n"

554 #Te¡ 
Acû±
-
Ch¬£t


555 
h
 = [('Accept-Charset', 'iso-8859-5, unicode-1-1;q=0.8')]

556 
£lf
.
	`g‘Page
("/h—d”–em’ts/g‘_–em’ts?h—d”Çme=Acû±-Ch¬£t", 
h
)

557 
£lf
.
	`as£¹Stus
("200 OK")

558 
£lf
.
	`as£¹Body
("iso-8859-5\n"

561 #Te¡ 
Acû±
-
Encodšg


562 
h
 = [('Accept-Encoding', 'gzip;q=1.0, identity; q=0.5, *;q=0')]

563 
£lf
.
	`g‘Page
("/h—d”–em’ts/g‘_–em’ts?h—d”Çme=Acû±-Encodšg", 
h
)

564 
£lf
.
	`as£¹Stus
("200 OK")

565 
£lf
.
	`as£¹Body
("gzip;q=1.0\n"

569 #Te¡ 
Acû±
-
Lªguage


570 
h
 = [('Accept-Language', 'da,ƒn-gb;q=0.8,ƒn;q=0.7')]

571 
£lf
.
	`g‘Page
("/h—d”–em’ts/g‘_–em’ts?h—d”Çme=Acû±-Lªguage", 
h
)

572 
£lf
.
	`as£¹Stus
("200 OK")

573 
£lf
.
	`as£¹Body
("da\n"

577 #Te¡ 
m®fÜmed
 
h—d”
 
·rsšg
. 
S“
 
h‰p
:

578 
£lf
.
	`g‘Page
("/headerelements/get_elements?headername=Content-Type",

579 #NÙ
the
 
Ëg®
 
Œašg
 ";"

580 
h—d”s
=[('Content-Type', 'text/html; charset=utf-8;')])

581 
£lf
.
	$as£¹Stus
(200)

582 
£lf
.
	`as£¹Body
("text/html;charset=utf-8")

584 
def
 
	$‹¡_»³©ed_h—d”s
(
£lf
):

585 #Te¡ 
th©
 
two
 
»que¡
 
h—d”s
 
¬e
 
cŞÏp£d
 
što
 
Úe
.

586 #S“ 
h‰p
:

587 
£lf
.
	`g‘Page
("/headers/Accept-Charset",

588 
h—d”s
=[("Accept-Charset", "iso-8859-5"),

590 
£lf
.
	`as£¹Body
("iso-8859-5, unicode-1-1;q=0.8")

592 #Te¡ 
th©
 
—ch
 
h—d”
 
Úly
 
­³¬s
 
Úû
, 
»g¬dËss
 
of
 .

593 
£lf
.
	`g‘Page
("/headers/doubledheaders")

594 
£lf
.
	`as£¹Body
("double headerest")

595 
hÇmes
 = [
Çme
.
	$t™Ë
(è
Çme
, 
v®
 
š
 
£lf
.
h—d”s
]

596 
key
 
š
 ['Content-Length', 'Content-Type', 'Date',

598 
£lf
.
	`as£¹Equ®
(
hÇmes
.
	`couÁ
(
key
), 1, s–f.
h—d”s
)

600 
def
 
	$‹¡_’coded_h—d”s
(
£lf
):

601 #Fœ¡, 
make
 
su»
 
the
 
šÇrds
 
wÜk
 
like
 
ex³ùed
.

602 
£lf
.
	`as£¹Equ®
(
h‰put
.
	`decode_TEXT
(
	`Áou
("=?utf-8?q?f=C3=BCr?=")),‚tou("f\xfcr"))

604 
ch”rypy
.
£rv”
.
´ÙocŞ_v”siÚ
 == "HTTP/1.1":

605 #Te¡ 
RFC
-2047-
’coded
 
»que¡
 
ªd
 
»¥Ú£
 
h—d”
 
v®ues


606 
u
 = 
	`Áou
('\u212bngstr\xf6m', 'escape')

607 
c
 = 
	`Áou
("=E2=84=ABngstr=C3=B6m")

608 
£lf
.
	`g‘Page
("/h—d”s/ifm©ch", [('If-M©ch', 
	`Áou
('=?utf-8?q?%s?='è% 
c
)])

609 #Th
body
 
should
 
be
 
utf
-8 
’coded
.

610 
£lf
.
	`as£¹Body
(
	`Áob
("\xe2\x84\xabngstr\xc3\xb6m"))

611 #Buˆ
the
 
Eg
 
h—d”
 
should
 
be
 
RFC
-2047 
	`’coded
 (
bš¬y
)

612 
£lf
.
	`as£¹H—d”
("ETag", 
	`Áou
('=?utf-8?b?4oSrbmdzdHLDtm0=?='))

614 #Te¡ 
a
 *
LONG
* 
RFC
-2047-
’coded
 
»que¡
 
ªd
 
»¥Ú£
 
h—d”
 
v®ue


615 
£lf
.
	`g‘Page
("/headers/ifmatch",

616 [('If-M©ch', 
	`Áou
('=?utf-8?q?%s?='è% (
c
 * 10))])

617 
£lf
.
	`as£¹Body
(
	`Áob
("\xe2\x84\xabngstr\xc3\xb6m") * 10)

618 #NÙe: 
this
 
is
 
difã»Á
 
ouut
 
PythÚ3
, 
but
 
™
 
decodes
 
fše
.

619 
‘ag
 = 
£lf
.
	`as£¹H—d”
("ETag",

624 
£lf
.
	`as£¹Equ®
(
h‰put
.
	`decode_TEXT
(
‘ag
), 
u
 * 10)

626 
def
 
	$‹¡_h—d”_´e£nû
(
£lf
):

627 #Ià
we
 
dÚ
't…ass‡ Content-Type header, it should‚ot be…resent

628 #š 
ch”rypy
.
»que¡
.
h—d”s


629 
£lf
.
	`g‘Page
("/headers/Content-Type",

630 
h—d”s
=[])

631 
£lf
.
	$as£¹Stus
(500)

633 #Ià
CÚ‹Á
-
Ty³
 
is
 
´e£Á
 
š
 
the
 
»que¡
, 
™
 
should
 
be
…resent in

634 #ch”rypy.
»que¡
.
h—d”s


635 
£lf
.
	`g‘Page
("/headers/Content-Type",

636 
h—d”s
=[("Content-type", "application/json")])

637 
£lf
.
	`as£¹Body
("application/json")

639 
def
 
	$‹¡_basic_HTTPM‘hods
(
£lf
):

640 
h–³r
.
web‹¡
.
m‘hods_w™h_bod›s
 = ("POST", "PUT", "PROPFIND")

642 #Te¡ 
th©
 
®l
 
defšed
 
HTTP
 
m‘hods
 
wÜk
.

643 
m
 
š
 
defšed_h‰p_m‘hods
:

644 
£lf
.
	`g‘Page
("/m‘hod/", 
m‘hod
=
m
)

646 #HEAD 
»que¡s
 
should
 
nÙ
  
ªy
 
body
.

647 
m
 == "HEAD":

648 
£lf
.
	`as£¹Body
("")

649 
–if
 
m
 == "TRACE":

650 #Som
HTTP
 
	`£rv”s
 (
like
 
modpy
è
have
 
theœ
 
own
 
TRACE
 
suµÜt


651 
£lf
.
	`as£¹Equ®
(£lf.
body
[:5], 
	`Áob
("TRACE"))

653 
£lf
.
	$as£¹Body
(
m
)

655 #Reque¡ 
a
 
PUT
 
m‘hod
 
w™h
‡ 
fÜm
-
u¾’coded
 
body


656 
£lf
.
	`g‘Page
("/m‘hod/·¿m‘”ized", 
m‘hod
="PUT",

657 
body
="data=on+top+of+other+things")

658 
£lf
.
	`as£¹Body
("onop of otherhings")

660 #Reque¡ 
a
 
PUT
 
m‘hod
 
w™h
‡ 
fe
 
body


661 
b
 = "onehing onop of‡nother"

662 
h
 = [("Content-Type", "text/plain"),

663 ("CÚ‹Á-L’gth", 
	`¡r
(
	`Ën
(
b
)))]

664 
£lf
.
	`g‘Page
("/m‘hod/»que¡_body", 
h—d”s
=
h
, 
m‘hod
="PUT", 
body
=
b
)

665 
£lf
.
	$as£¹Stus
(200)

666 
£lf
.
	$as£¹Body
(
b
)

668 #Reque¡ 
a
 
PUT
 
m‘hod
 
w™h
‡ 
fe
 
body
 
but
 
no
 
CÚ‹Á
-
Ty³
.

669 #S“ 
h‰p
:

670 
b
 = 
	`Áob
("onehing onop of‡nother")

671 
£lf
.
³rsi¡’t
 = 
True


672 
Œy
:

673 
cÚn
 = 
£lf
.
HTTP_CONN


674 
cÚn
.
	`puŒeque¡
("PUT", "/m‘hod/»que¡_body", 
sk_ho¡
=
True
)

675 
cÚn
.
	`puth—d”
("Ho¡", 
£lf
.
HOST
)

676 
cÚn
.
	`puth—d”
('CÚ‹Á-L’gth', 
	`¡r
(
	$Ën
(
b
)))

677 
cÚn
.
	$’dh—d”s
()

678 
cÚn
.
	$£nd
(
b
)

679 
»¥Ú£
 = 
cÚn
.
	`»¥Ú£_şass
(cÚn.
sock
, 
m‘hod
="PUT")

680 
»¥Ú£
.
	$begš
()

681 
£lf
.
	$as£¹Equ®
(
»¥Ú£
.
¡©us
, 200)

682 
£lf
.
body
 = 
»¥Ú£
.
	$»ad
()

683 
£lf
.
	$as£¹Body
(
b
)

684 
fš®ly
:

685 
£lf
.
³rsi¡’t
 = 
F®£


687 #Reque¡ 
a
 
PUT
 
m‘hod
 
w™h
 
no
 
body
 
	`wh©sÛv”
 (
nÙ
 
ª
 
em±y
 
Úe
).

688 #S“ 
h‰p
:

689 #Provid
a
 
C
-
T
 
Ü
 
web‹¡
 
wl
 
´ovide
 
	`Úe
 (
ªd
‡ C-
L
è
us
.

690 
h
 = [("Content-Type", "text/plain")]

691 
£lf
.
	`g‘Page
("/m‘hod/»achabË", 
h—d”s
=
h
, 
m‘hod
="PUT")

692 
£lf
.
	$as£¹Stus
(411)

694 #Reque¡ 
a
 
cu¡om
 
m‘hod
 
w™h
‡ 
»que¡
 
body


695 
b
 = ('<?xml version="1.0"ƒncoding="utf-8" ?>\n\n'

698 
h
 = [('Content-Type', 'text/xml'),

699 ('CÚ‹Á-L’gth', 
	`¡r
(
	`Ën
(
b
)))]

700 
£lf
.
	`g‘Page
("/m‘hod/»que¡_body", 
h—d”s
=
h
, 
m‘hod
="PROPFIND", 
body
=
b
)

701 
£lf
.
	$as£¹Stus
(200)

702 
£lf
.
	$as£¹Body
(
b
)

704 #Reque¡ 
a
 
di§Îowed
 
m‘hod


705 
£lf
.
	`g‘Page
("/m‘hod/", 
m‘hod
="LINK")

706 
£lf
.
	$as£¹Stus
(405)

708 #Reque¡ 
ª
 
unknown
 
m‘hod


709 
£lf
.
	`g‘Page
("/m‘hod/", 
m‘hod
="SEARCH")

710 
£lf
.
	$as£¹Stus
(501)

712 #FÜ 
m‘hod
 
di¥©ch”s
: 
make
 
su»
 
th©
 
ª
 
HTTP
 m‘hod 
dÛ¢
't

713 #cŞlid
w™h
 
a
 
vœtu®
 
·th
 
©om
. 
If
 
you
 
bud
 
HTTP
-
m‘hod


714 #di¥©chšg 
što
 
the
 
cÜe
, 
»wr™e
 
the£
 
hªdËrs
 
to
 
u£


715 #you¸
di¥©ch
 
idioms
.

716 
£lf
.
	`g‘Page
("/divorce/get?ID=13")

717 
£lf
.
	`as£¹Body
('Divorce document 13:ƒmpty')

718 
£lf
.
	$as£¹Stus
(200)

719 
£lf
.
	`g‘Page
("/divÜû/", 
m‘hod
="GET")

720 
£lf
.
	`as£¹Body
('<h1>Choose your document</h1>\n<ul>\n</ul>')

721 
£lf
.
	$as£¹Stus
(200)

723 
def
 
	$‹¡_CONNECT_m‘hod
(
£lf
):

724 
	`g‘©Œ
(
ch”rypy
.
£rv”
, "usšg_­ache", 
F®£
):

725  
£lf
.
	`sk
("skipped dueo known Apache differences... ")

727 
£lf
.
	`g‘Page
("/m‘hod/", 
m‘hod
="CONNECT")

728 
£lf
.
	`as£¹Body
("CONNECT")

730 
def
 
	$‹¡Em±yTh»adloÿls
(
£lf
):

731 
»suÉs
 = []

732 
x
 
š
 
	$¿nge
(20):

733 
£lf
.
	`g‘Page
("/threadlocal/")

734 
»suÉs
.
	$­³nd
(
£lf
.
body
)

735 
£lf
.
	`as£¹Equ®
(
»suÉs
, [
	`Áob
("None")] * 20)

	@trunk/objs/CherryPy-3.2.4/cherrypy/test/test_routes.py

1 
impÜt
 
os


2 
	gcurdœ
 = 
os
.
·th
.
još
(os.
g‘cwd
(), os.·th.
	$dœÇme
(
__fe__
))

4 
impÜt
 
ch”rypy


6 
äom
 
ch”rypy
.
‹¡
 
impÜt
 
h–³r


7 
impÜt
 
no£


9 
şass
 
	$Rou‹sDi¥©chTe¡
(
h–³r
.
CPWebCa£
):

11 
def
 
	$£tup_£rv”
():

13 
Œy
:

14 
impÜt
 
rou‹s


15 
exû±
 
ImpÜtE¼Ü
:

16 
¿i£
 
no£
.
	`SkTe¡
('Install„outesoest RoutesDispatcher code')

18 
şass
 
Dummy
:

19 
def
 
	$šdex
(
£lf
):

22 
şass
 
C™y
:

24 
def
 
	$__š™__
(
£lf
, 
Çme
):

25 
£lf
.
Çme
 =‚ame

26 
£lf
.
pİuÏtiÚ
 = 10000

28 
def
 
	$šdex
(
£lf
, **
kw¬gs
):

29  "W–comtØ%s,…İ. %s" % (
£lf
.
Çme
, s–f.
pİuÏtiÚ
)

30 
šdex
.
_ı_cÚfig
 = {'toŞs.»¥Ú£_h—d”s.Ú': 
True
,

31 'toŞs.»¥Ú£_h—d”s.h—d”s': [('CÚ‹Á-Lªguage', '’-GB')]
	}
}

33 
def
 
	$upd©e
(
£lf
, **
kw¬gs
):

34 
£lf
.
pİuÏtiÚ
 = 
kw¬gs
['pop']

37 
d
 = 
ch”rypy
.
di¥©ch
.
	$Rou‹sDi¥©ch”
()

38 
d
.
	`cÚÃù
(
aùiÚ
='šdex', 
Çme
='houn¦ow', 
rou‹
='/hounslow',

39 
cÚŒŞËr
=
	`C™y
('Hounslow'))

40 
d
.
	`cÚÃù
(
Çme
='surb™Ú', 
rou‹
='/surb™Ú', 
cÚŒŞËr
=
	`C™y
('Surbiton'),

41 
aùiÚ
='šdex', 
cÚd™iÚs
=
	`diù
(
m‘hod
=['GET']))

42 
d
.
m­³r
.
	`cÚÃù
('/surb™Ú', 
cÚŒŞËr
='surbiton',

43 
aùiÚ
='upd©e', 
cÚd™iÚs
=
	`diù
(
m‘hod
=['POST']))

44 
d
.
	`cÚÃù
('maš', ':aùiÚ', 
cÚŒŞËr
=
	$Dummy
())

46 
cÚf
 = {'/': {'»que¡.di¥©ch': 
d
}
	}
}

47 
ch”rypy
.
Œ“
.
	$mouÁ
(
roÙ
=
NÚe
, 
cÚfig
=
cÚf
)

48 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

50 
def
 
	$‹¡_Rou‹s_Di¥©ch
(
£lf
):

51 
£lf
.
	`g‘Page
("/hounslow")

52 
£lf
.
	`as£¹Stus
("200 OK")

53 
£lf
.
	`as£¹Body
("Welcomeo Hounslow,…op. 10000")

55 
£lf
.
	`g‘Page
("/foo")

56 
£lf
.
	`as£¹Stus
("404 Not Found")

58 
£lf
.
	`g‘Page
("/surbiton")

59 
£lf
.
	`as£¹Stus
("200 OK")

60 
£lf
.
	`as£¹Body
("Welcomeo Surbiton,…op. 10000")

62 
£lf
.
	`g‘Page
("/surb™Ú", 
m‘hod
="POST", 
body
="pop=1327")

63 
£lf
.
	`as£¹Stus
("200 OK")

64 
£lf
.
	`as£¹Body
("OK")

65 
£lf
.
	`g‘Page
("/surbiton")

66 
£lf
.
	`as£¹Stus
("200 OK")

67 
£lf
.
	`as£¹H—d”
("Content-Language", "en-GB")

68 
£lf
.
	`as£¹Body
("Welcomeo Surbiton,…op. 1327")

	@trunk/objs/CherryPy-3.2.4/cherrypy/test/test_session.py

1 
impÜt
 
os


2 
	gloÿlDœ
 = 
os
.
·th
.
	$dœÇme
(
__fe__
)

3 
impÜt
 
sys


4 
impÜt
 
th»adšg


5 
impÜt
 
time


7 
impÜt
 
ch”rypy


8 
äom
 
ch”rypy
.
_ıcom·t
 
impÜt
 
cİykeys
, 
HTTPCÚÃùiÚ
, 
HTTPSCÚÃùiÚ


9 
äom
 
ch”rypy
.
lib
 
impÜt
 
£ssiÚs


10 
äom
 
ch”rypy
.
lib
.
h‰put
 
impÜt
 
»¥Ú£_codes


12 
def
 
	`h‰p_m‘hods_®lowed
(
m‘hods
=['GET', 'HEAD']):

13 
m‘hod
 = 
ch”rypy
.
»que¡
.m‘hod.
	$uµ”
()

14 
m‘hod
 
nÙ
 
š
 
m‘hods
:

15 
ch”rypy
.
»¥Ú£
.
h—d”s
['AÎow'] = ", ".
	$još
(
m‘hods
)

16 
¿i£
 
ch”rypy
.
	$HTTPE¼Ü
(405)

18 
ch”rypy
.
toŞs
.
®low
 = ch”rypy.
	`ToŞ
('Ú_¡¬t_»sourû', 
h‰p_m‘hods_®lowed
)

21 
def
 
	$£tup_£rv”
():

23 
şass
 
RoÙ
:

25 
_ı_cÚfig
 = {'toŞs.£ssiÚs.Ú': 
True
,

27 'toŞs.£ssiÚs.¡Üage_·th' : 
loÿlDœ
,

30 
	}
}

32 
def
 
	$ş—r
(
£lf
):

33 
ch”rypy
.
£ssiÚ
.
ÿche
.
	$ş—r
()

34 
ş—r
.
expo£d
 = 
True


36 
def
 
	$d©a
(
£lf
):

37 
ch”rypy
.
£ssiÚ
['aha'] = 'foo'

38  
	$»´
(
ch”rypy
.
£ssiÚ
.
_d©a
)

39 
d©a
.
expo£d
 = 
True


41 
def
 
	$‹¡G’
(
£lf
):

42 
couÁ”
 = 
ch”rypy
.
£ssiÚ
.
	`g‘
('counter', 0) + 1

43 
ch”rypy
.
£ssiÚ
['couÁ”'] = 
couÁ”


44 
y›ld
 
	$¡r
(
couÁ”
)

45 
‹¡G’
.
expo£d
 = 
True


47 
def
 
	$‹¡SŒ
(
£lf
):

48 
couÁ”
 = 
ch”rypy
.
£ssiÚ
.
	`g‘
('counter', 0) + 1

49 
ch”rypy
.
£ssiÚ
['couÁ”'] = 
couÁ”


50  
	$¡r
(
couÁ”
)

51 
‹¡SŒ
.
expo£d
 = 
True


53 
def
 
	$£t£ssiÚty³
(
£lf
, 
Ãwty³
):

54 
£lf
.
__şass__
.
_ı_cÚfig
.
	`upd©e
({'toŞs.£ssiÚs.¡Üage_ty³': 
Ãwty³
})

55 
ha§‰r
(
ch”rypy
, "session"):

56 
d–
 
ch”rypy
.
£ssiÚ


57 
şs
 = 
g‘©Œ
(
£ssiÚs
, 
Ãwty³
.
t™Ë
() + 'Session')

58 
	gşs
.
	gş—n_th»ad
:

59 
şs
.
ş—n_th»ad
.
	$¡İ
()

60 
şs
.
ş—n_th»ad
.
	$unsubsüibe
()

61 
d–
 
şs
.
ş—n_th»ad


62 
£t£ssiÚty³
.
expo£d
 = 
True


63 
£t£ssiÚty³
.
_ı_cÚfig
 = {'toŞs.£ssiÚs.Ú': 
F®£
}

65 
def
 
	$šdex
(
£lf
):

66 
£ss
 = 
ch”rypy
.
£ssiÚ


67 
c
 = 
£ss
.
	`g‘
('counter', 0) + 1

68 
time
.
	$¦“p
(0.01)

69 
£ss
['couÁ”'] = 
c


70  
	$¡r
(
c
)

71 
šdex
.
expo£d
 = 
True


73 
def
 
	$keyš
(
£lf
, 
key
):

74  
	$¡r
(
key
 
š
 
ch”rypy
.
£ssiÚ
)

75 
keyš
.
expo£d
 = 
True


77 
def
 
	$d–‘e
(
£lf
):

78 
ch”rypy
.
£ssiÚ
.
	$d–‘e
()

79 
£ssiÚs
.
	$expœe
()

81 
d–‘e
.
expo£d
 = 
True


83 
def
 
	$d–key
(
£lf
, 
key
):

84 
d–
 
ch”rypy
.
£ssiÚ
[
key
]

86 
d–key
.
expo£d
 = 
True


88 
def
 
	$bÏh
(
£lf
):

89  
£lf
.
_ı_cÚfig
['tools.sessions.storage_type']

90 
bÏh
.
expo£d
 = 
True


92 
def
 
	$œedœ
(
£lf
):

93 
¿i£
 
ch”rypy
.
	`IÁ”ÇlRedœeù
('/blah')

94 
œedœ
.
expo£d
 = 
True


96 
def
 
	$»¡riùed
(
£lf
):

97  
ch”rypy
.
»que¡
.
m‘hod


98 
»¡riùed
.
expo£d
 = 
True


99 
»¡riùed
.
_ı_cÚfig
 = {'toŞs.®low.Ú': 
True
,

100 'toŞs.®low.m‘hods': ['GET']
	}
}

102 
def
 
	$»g’
(
£lf
):

103 
ch”rypy
.
toŞs
.
£ssiÚs
.
	$»g’”©e
()

105 
»g’
.
expo£d
 = 
True


107 
def
 
	$Ëngth
(
£lf
):

108  
	`¡r
(
	$Ën
(
ch”rypy
.
£ssiÚ
))

109 
Ëngth
.
expo£d
 = 
True


111 
def
 
	$£ssiÚ_cook›
(
£lf
):

112 #Mu¡ 
	`lßd
(è
to
 
¡¬t
 
the
 
ş—n
 
th»ad
.

113 
ch”rypy
.
£ssiÚ
.
	$lßd
()

114  
ch”rypy
.
£ssiÚ
.
id


115 
£ssiÚ_cook›
.
expo£d
 = 
True


116 
£ssiÚ_cook›
.
_ı_cÚfig
 = {

119 'toŞs.£ssiÚs.³rsi¡’t': 
F®£
}

121 
ch”rypy
.
Œ“
.
mouÁ
(
	$RoÙ
())

124 
äom
 
ch”rypy
.
‹¡
 
impÜt
 
h–³r


126 
şass
 
	$SessiÚTe¡
(
h–³r
.
CPWebCa£
):

127 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

129 
def
 
	$‹¬Down
(
£lf
):

130 #CËª 
up
 
£ssiÚs
.

131 
âame
 
š
 
os
.
	$li¡dœ
(
loÿlDœ
):

132 
âame
.
	$¡¬tsw™h
(
£ssiÚs
.
FeSessiÚ
.
SESSION_PREFIX
):

133 
os
.
	`uÆšk
(os.
·th
.
	$još
(
loÿlDœ
, 
âame
))

135 
def
 
	$‹¡_0_SessiÚ
(
£lf
):

136 
£lf
.
	`g‘Page
('/setsessiontype/ram')

137 
£lf
.
	`g‘Page
('/clear')

139 #Te¡ 
th©
 
a
 
nÜm®
 
»que¡
 
g‘s
 
the
 
§me
 
id
 
š
h
cook›s
.

140 #NÙe: 
this
 
wouldn
'ˆwÜk ià/d©¨didn'
t
 
lßd
 
the
 
£ssiÚ
.

141 
£lf
.
	`g‘Page
('/data')

142 
£lf
.
	`as£¹Body
("{'aha': 'foo'}")

143 
c
 = 
£lf
.
cook›s
[0]

144 
£lf
.
	`g‘Page
('/d©a', s–f.
cook›s
)

145 
£lf
.
	$as£¹Equ®
(
£lf
.
cook›s
[0], 
c
)

147 
£lf
.
	`g‘Page
('/testStr')

148 
£lf
.
	`as£¹Body
('1')

149 
cook›_·¹s
 = 
	`diù
([
p
.
	`¡r
().
	`¥l™
('=')

150 
p
 
š
 
£lf
.
cook›s
[0][1].
	`¥l™
(";")])

151 #As£¹ 
th”e
 
is
 
ª
 'expœes' 
·¿m


152 
£lf
.
	`as£¹Equ®
(
	`£t
(
cook›_·¹s
.
	`keys
()),

153 
	`£t
(['session_id', 'expires', 'Path']))

154 
£lf
.
	`g‘Page
('/‹¡G’', s–f.
cook›s
)

155 
£lf
.
	`as£¹Body
('2')

156 
£lf
.
	`g‘Page
('/‹¡SŒ', s–f.
cook›s
)

157 
£lf
.
	`as£¹Body
('3')

158 
£lf
.
	`g‘Page
('/d©a', s–f.
cook›s
)

159 
£lf
.
	`as£¹Body
("{'aha': 'foo', 'counter': 3}")

160 
£lf
.
	`g‘Page
('/Ëngth', s–f.
cook›s
)

161 
£lf
.
	`as£¹Body
('2')

162 
£lf
.
	`g‘Page
('/d–key?key=couÁ”', s–f.
cook›s
)

163 
£lf
.
	$as£¹Stus
(200)

165 
£lf
.
	`g‘Page
('/setsessiontype/file')

166 
£lf
.
	`g‘Page
('/testStr')

167 
£lf
.
	`as£¹Body
('1')

168 
£lf
.
	`g‘Page
('/‹¡G’', s–f.
cook›s
)

169 
£lf
.
	`as£¹Body
('2')

170 
£lf
.
	`g‘Page
('/‹¡SŒ', s–f.
cook›s
)

171 
£lf
.
	`as£¹Body
('3')

172 
£lf
.
	`g‘Page
('/d–key?key=couÁ”', s–f.
cook›s
)

173 
£lf
.
	$as£¹Stus
(200)

175 #Wa™ 
the
 
£ssiÚ
.
	`timeout
 (1 
£cÚd
)

176 
time
.
	$¦“p
(2)

177 
£lf
.
	`g‘Page
('/')

178 
£lf
.
	`as£¹Body
('1')

179 
£lf
.
	`g‘Page
('/Ëngth', s–f.
cook›s
)

180 
£lf
.
	`as£¹Body
('1')

182 #Te¡ 
£ssiÚ
 
__cÚšs__


183 
£lf
.
	`g‘Page
('/keyš?key=couÁ”', s–f.
cook›s
)

184 
£lf
.
	`as£¹Body
("True")

185 
cook›£t1
 = 
£lf
.
cook›s


187 #Mak
a
 
Ãw
 
£ssiÚ
 
ªd
 
‹¡
 
__Ën__
 
agaš


188 
£lf
.
	`g‘Page
('/')

189 
£lf
.
	`g‘Page
('/Ëngth', s–f.
cook›s
)

190 
£lf
.
	`as£¹Body
('2')

192 #Te¡ 
£ssiÚ
 
d–‘e


193 
£lf
.
	`g‘Page
('/d–‘e', s–f.
cook›s
)

194 
£lf
.
	`as£¹Body
("done")

195 
£lf
.
	`g‘Page
('/d–‘e', 
cook›£t1
)

196 
£lf
.
	`as£¹Body
("done")

197 
f
 = 
Ïmbda
: [
x
 x 
š
 
os
.
	$li¡dœ
(
loÿlDœ
è
x
.
	`¡¬tsw™h
('session-')]

198 
£lf
.
	`as£¹Equ®
(
	`f
(), [])

200 #Wa™ 
the
 
ş—nup
 
th»ad
 
to
 
d–‘e
 
»maššg
 
£ssiÚ
 
fes


201 
£lf
.
	`g‘Page
('/')

202 
f
 = 
Ïmbda
: [
x
 x 
š
 
os
.
	$li¡dœ
(
loÿlDœ
è
x
.
	`¡¬tsw™h
('session-')]

203 
£lf
.
	`as£¹NÙEqu®
(
	`f
(), [])

204 
time
.
	$¦“p
(2)

205 
£lf
.
	`as£¹Equ®
(
	`f
(), [])

207 
def
 
	$‹¡_1_Ram_CÚcu¼’cy
(
£lf
):

208 
£lf
.
	`g‘Page
('/setsessiontype/ram')

209 
£lf
.
	$_‹¡_CÚcu¼’cy
()

211 
def
 
	$‹¡_2_Fe_CÚcu¼’cy
(
£lf
):

212 
£lf
.
	`g‘Page
('/setsessiontype/file')

213 
£lf
.
	$_‹¡_CÚcu¼’cy
()

215 
def
 
	$_‹¡_CÚcu¼’cy
(
£lf
):

216 
ş›Á_th»ad_couÁ
 = 5

217 
»que¡_couÁ
 = 30

219 #G‘ 
š™Ÿl
 
cook›


220 
£lf
.
	`g‘Page
("/")

221 
£lf
.
	`as£¹Body
("1")

222 
cook›s
 = 
£lf
.cookies

224 
d©a_diù
 = {
	}
}

225 
”rÜs
 = []

227 
def
 
	$»que¡
(
šdex
):

228 
£lf
.
scheme
 == 'https':

229 
c
 = 
	`HTTPSCÚÃùiÚ
('%s:%s' % (
£lf
.
	`š‹rçû
(), s–f.
PORT
))

231 
c
 = 
	`HTTPCÚÃùiÚ
('%s:%s' % (
£lf
.
	`š‹rçû
(), s–f.
PORT
))

232 
i
 
š
 
	$¿nge
(
»que¡_couÁ
):

233 
c
.
	`puŒeque¡
('GET', '/')

234 
k
, 
v
 
š
 
cook›s
:

235 
c
.
	$puth—d”
(
k
, 
v
)

236 
c
.
	$’dh—d”s
()

237 
»¥Ú£
 = 
c
.
	$g‘»¥Ú£
()

238 
body
 = 
»¥Ú£
.
	$»ad
()

239 
»¥Ú£
.
¡©us
 !ğ200 
Ü
 
nÙ
 
body
.
	$isdig™
():

240 
”rÜs
.
	`­³nd
((
»¥Ú£
.
¡©us
, 
body
))

242 
d©a_diù
[
šdex
] = 
	`max
(d©a_diù[šdex], (
body
))

243 #Uncomm’ˆ
the
 
fŞlowšg
 
lše
 
to
 
´ove
 
th»ads
 
ov”Ïp
.

244 ## 
sys
.
¡dout
.
	`wr™e
("%d " % 
šdex
)

246 #S¹ <
»que¡_couÁ
> 
»que¡s
 
äom
 
—ch
 
of


247 #<
ş›Á_th»ad_couÁ
> 
cÚcu¼’t
 
ş›Ás


248 
ts
 = []

249 
c
 
š
 
	$¿nge
(
ş›Á_th»ad_couÁ
):

250 
d©a_diù
[
c
] = 0

251 
t
 = 
th»adšg
.
	`Th»ad
(
rg‘
=
»que¡
, 
¬gs
=(
c
,))

252 
ts
.
	$­³nd
(
t
)

253 
t
.
	$¡¬t
()

255 
t
 
š
 
ts
:

256 
t
.
	$još
()

258 
h™couÁ
 = 
	`max
(
d©a_diù
.
	$v®ues
())

259 
ex³ùed
 = 1 + (
ş›Á_th»ad_couÁ
 * 
»que¡_couÁ
)

261 
e
 
š
 
”rÜs
:

262 
	$´št
(
e
)

263 
£lf
.
	$as£¹Equ®
(
h™couÁ
, 
ex³ùed
)

265 
def
 
	$‹¡_3_Redœeù
(
£lf
):

266 #S¹ 
a
 
Ãw
 
£ssiÚ


267 
£lf
.
	`g‘Page
('/testStr')

268 
£lf
.
	`g‘Page
('/œedœ', s–f.
cook›s
)

269 
£lf
.
	`as£¹Body
("file")

271 
def
 
	$‹¡_4_Fe_d–‘iÚ
(
£lf
):

272 #S¹ 
a
 
Ãw
 
£ssiÚ


273 
£lf
.
	`g‘Page
('/testStr')

274 #D–‘
the
 
£ssiÚ
 
fe
 
mªu®ly
 
ªd
 
»Œy
.

275 
id
 = 
£lf
.
cook›s
[0][1].
	`¥l™
(";", 1)[0].split("=", 1)[1]

276 
·th
 = 
os
.·th.
	`još
(
loÿlDœ
, "£ssiÚ-" + 
id
)

277 
os
.
	$uÆšk
(
·th
)

278 
£lf
.
	`g‘Page
('/‹¡SŒ', s–f.
cook›s
)

280 
def
 
	$‹¡_5_E¼Ü_·ths
(
£lf
):

281 
£lf
.
	`g‘Page
('/unknown/page')

282 
£lf
.
	`as£¹E¼ÜPage
(404, "The…ath '/unknown/page' was‚ot found.")

284 #NÙe: 
this
 
·th
 
is
 *
nÙ
* 
the
 
§me
 
as
 
above
. 
The
‡bove

285 #ke 
a
 
nÜm®
 
rou‹
 
through
 
the
 
£ssiÚ
 
code
; 
this
 
Úe


286 #sk 
the
 
£ssiÚ
 
code
's before_handler‡nd only calls

287 #befÜe_fš®iz(
§ve
è
ªd
 
	`Ú_’d
 (
şo£
). 
So
 
the
 
£ssiÚ


288 #cod
has
 
to
 
survive
 
ÿÎšg
 
§ve
/
şo£
 
w™hout
 
š™
.

289 
£lf
.
	`g‘Page
('/»¡riùed', s–f.
cook›s
, 
m‘hod
='POST')

290 
£lf
.
	$as£¹E¼ÜPage
(405, 
»¥Ú£_codes
[405][1])

292 
def
 
	$‹¡_6_»g’”©e
(
£lf
):

293 
£lf
.
	`g‘Page
('/testStr')

294 #g¿b 
the
 
cook›
 
ID


295 
id1
 = 
£lf
.
cook›s
[0][1].
	`¥l™
(";", 1)[0].split("=", 1)[1]

296 
£lf
.
	`g‘Page
('/regen')

297 
£lf
.
	`as£¹Body
('logged in')

298 
id2
 = 
£lf
.
cook›s
[0][1].
	`¥l™
(";", 1)[0].split("=", 1)[1]

299 
£lf
.
	$as£¹NÙEqu®
(
id1
, 
id2
)

301 
£lf
.
	`g‘Page
('/testStr')

302 #g¿b 
the
 
cook›
 
ID


303 
id1
 = 
£lf
.
cook›s
[0][1].
	`¥l™
(";", 1)[0].split("=", 1)[1]

304 
£lf
.
	`g‘Page
('/testStr',

305 
h—d”s
=[('Cookie',

308 
id2
 = 
£lf
.
cook›s
[0][1].
	`¥l™
(";", 1)[0].split("=", 1)[1]

309 
£lf
.
	$as£¹NÙEqu®
(
id1
, 
id2
)

310 
£lf
.
	`as£¹NÙEqu®
(
id2
, 'maliciousid')

312 
def
 
	$‹¡_7_£ssiÚ_cook›s
(
£lf
):

313 
£lf
.
	`g‘Page
('/setsessiontype/ram')

314 
£lf
.
	`g‘Page
('/clear')

315 
£lf
.
	`g‘Page
('/session_cookie')

316 #g¿b 
the
 
cook›
 
ID


317 
cook›_·¹s
 = 
	`diù
([
p
.
	`¡r
().
	`¥l™
('='è°
š
 
£lf
.
cook›s
[0][1].split(";")])

318 #As£¹ 
th”e
 
is
 
no
 'expœes' 
·¿m


319 
£lf
.
	`as£¹Equ®
(
	`£t
(
cook›_·¹s
.
	`keys
()), set(['temp', 'Path']))

320 
id1
 = 
cook›_·¹s
['temp']

321 
£lf
.
	`as£¹Equ®
(
	`cİykeys
(
£ssiÚs
.
RamSessiÚ
.
ÿche
), [
id1
])

323 #S’d 
ªÙh”
 
»que¡
 
š
 
the
 
§me
 "browser session".

324 
£lf
.
	`g‘Page
('/£ssiÚ_cook›', s–f.
cook›s
)

325 
cook›_·¹s
 = 
	`diù
([
p
.
	`¡r
().
	`¥l™
('='è°
š
 
£lf
.
cook›s
[0][1].split(";")])

326 #As£¹ 
th”e
 
is
 
no
 'expœes' 
·¿m


327 
£lf
.
	`as£¹Equ®
(
	`£t
(
cook›_·¹s
.
	`keys
()), set(['temp', 'Path']))

328 
£lf
.
	$as£¹Body
(
id1
)

329 
£lf
.
	`as£¹Equ®
(
	`cİykeys
(
£ssiÚs
.
RamSessiÚ
.
ÿche
), [
id1
])

331 #SimuÏ‹ 
a
 
brow£r
 
şo£
 
by
 
ju¡
 
nÙ
 
£ndšg
 
the
 
cook›s


332 
£lf
.
	`g‘Page
('/session_cookie')

333 #g¿b 
the
 
cook›
 
ID


334 
cook›_·¹s
 = 
	`diù
([
p
.
	`¡r
().
	`¥l™
('='è°
š
 
£lf
.
cook›s
[0][1].split(";")])

335 #As£¹ 
th”e
 
is
 
no
 'expœes' 
·¿m


336 
£lf
.
	`as£¹Equ®
(
	`£t
(
cook›_·¹s
.
	`keys
()), set(['temp', 'Path']))

337 #As£¹ 
a
 
Ãw
 
id
 
has
 
b“n
 
g’”©ed
...

338 
id2
 = 
cook›_·¹s
['temp']

339 
£lf
.
	$as£¹NÙEqu®
(
id1
, 
id2
)

340 
£lf
.
	`as£¹Equ®
(
	`£t
(
£ssiÚs
.
RamSessiÚ
.
ÿche
.
	`keys
()), 
	$£t
([
id1
, 
id2
]))

342 #Wa™ 
the
 
£ssiÚ
.
timeout
 
Ú
 
bÙh
 
£ssiÚs


343 
time
.
	$¦“p
(2.5)

344 
ÿche
 = 
	$cİykeys
(
£ssiÚs
.
RamSessiÚ
.
ÿche
)

345 
ÿche
:

346 
ÿche
 =ğ[
id2
]:

347 
£lf
.
	`ç
("The second session did‚otime out.")

349 
£lf
.
	`ç
("UnknowÀ£ssiÚ id iÀÿche: %r", 
ÿche
)

352 
impÜt
 
sock‘


353 
Œy
:

354 
impÜt
 
memÿche


356 
ho¡
, 
pÜt
 = '127.0.0.1', 11211

357 
»s
 
š
 
sock‘
.
	$g‘addršfo
(
ho¡
, 
pÜt
, 
sock‘
.
AF_UNSPEC
,

358 
sock‘
.
SOCK_STREAM
):

359 
af
, 
sockty³
, 
´Ùo
, 
ÿnÚÇme
, 
§
 = 
»s


360 
s
 = 
NÚe


361 
Œy
:

362 
s
 = 
sock‘
.
	$sock‘
(
af
, 
sockty³
, 
´Ùo
)

363 #S“ 
h‰p
:

364 #brow£_äm/
th»ad
/
bbã5eb39c904ã0


365 
s
.
	$£‰imeout
(1.0)

366 
s
.
	`cÚÃù
((
ho¡
, 
pÜt
))

367 
s
.
	$şo£
()

368 
exû±
 
sock‘
.
”rÜ
:

369 
s
:

370 
s
.
	$şo£
()

371 
¿i£


373 
	$exû±
 (
ImpÜtE¼Ü
, 
sock‘
.
”rÜ
):

374 
şass
 
	$MemÿchedSessiÚTe¡
(
h–³r
.
CPWebCa£
):

375 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

377 
def
 
	$‹¡
(
£lf
):

378  
£lf
.
	`sk
("memcached‚ot„eachable ")

380 
şass
 
	$MemÿchedSessiÚTe¡
(
h–³r
.
CPWebCa£
):

381 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

383 
def
 
	$‹¡_0_SessiÚ
(
£lf
):

384 
£lf
.
	`g‘Page
('/setsessiontype/memcached')

386 
£lf
.
	`g‘Page
('/testStr')

387 
£lf
.
	`as£¹Body
('1')

388 
£lf
.
	`g‘Page
('/‹¡G’', s–f.
cook›s
)

389 
£lf
.
	`as£¹Body
('2')

390 
£lf
.
	`g‘Page
('/‹¡SŒ', s–f.
cook›s
)

391 
£lf
.
	`as£¹Body
('3')

392 
£lf
.
	`g‘Page
('/Ëngth', s–f.
cook›s
)

393 
£lf
.
	$as£¹E¼ÜPage
(500)

394 
£lf
.
	`as£¹InBody
("NotImplementedError")

395 
£lf
.
	`g‘Page
('/d–key?key=couÁ”', s–f.
cook›s
)

396 
£lf
.
	$as£¹Stus
(200)

398 #Wa™ 
the
 
£ssiÚ
.
	`timeout
 (1 
£cÚd
)

399 
time
.
	$¦“p
(1.25)

400 
£lf
.
	`g‘Page
('/')

401 
£lf
.
	`as£¹Body
('1')

403 #Te¡ 
£ssiÚ
 
__cÚšs__


404 
£lf
.
	`g‘Page
('/keyš?key=couÁ”', s–f.
cook›s
)

405 
£lf
.
	`as£¹Body
("True")

407 #Te¡ 
£ssiÚ
 
d–‘e


408 
£lf
.
	`g‘Page
('/d–‘e', s–f.
cook›s
)

409 
£lf
.
	`as£¹Body
("done")

411 
def
 
	$‹¡_1_CÚcu¼’cy
(
£lf
):

412 
ş›Á_th»ad_couÁ
 = 5

413 
»que¡_couÁ
 = 30

415 #G‘ 
š™Ÿl
 
cook›


416 
£lf
.
	`g‘Page
("/")

417 
£lf
.
	`as£¹Body
("1")

418 
cook›s
 = 
£lf
.cookies

420 
d©a_diù
 = {
	}
}

422 
def
 
	$»que¡
(
šdex
):

423 
i
 
š
 
	$¿nge
(
»que¡_couÁ
):

424 
£lf
.
	`g‘Page
("/", 
cook›s
)

425 #Uncomm’ˆ
the
 
fŞlowšg
 
lše
 
to
 
´ove
 
th»ads
 
ov”Ïp
.

426 ## 
sys
.
¡dout
.
	`wr™e
("%d " % 
šdex
)

427 
nÙ
 
£lf
.
body
.
	$isdig™
():

428 
£lf
.
	$ç
(
£lf
.
body
)

429 
d©a_diù
[
šdex
] = 
v
 = (
£lf
.
body
)

431 #S¹ <
»que¡_couÁ
> 
cÚcu¼’t
 
»que¡s
 
äom


432 #—ch 
of
 <
ş›Á_th»ad_couÁ
> 
ş›Ás


433 
ts
 = []

434 
c
 
š
 
	$¿nge
(
ş›Á_th»ad_couÁ
):

435 
d©a_diù
[
c
] = 0

436 
t
 = 
th»adšg
.
	`Th»ad
(
rg‘
=
»que¡
, 
¬gs
=(
c
,))

437 
ts
.
	$­³nd
(
t
)

438 
t
.
	$¡¬t
()

440 
t
 
š
 
ts
:

441 
t
.
	$još
()

443 
h™couÁ
 = 
	`max
(
d©a_diù
.
	$v®ues
())

444 
ex³ùed
 = 1 + (
ş›Á_th»ad_couÁ
 * 
»que¡_couÁ
)

445 
£lf
.
	$as£¹Equ®
(
h™couÁ
, 
ex³ùed
)

447 
def
 
	$‹¡_3_Redœeù
(
£lf
):

448 #S¹ 
a
 
Ãw
 
£ssiÚ


449 
£lf
.
	`g‘Page
('/testStr')

450 
£lf
.
	`g‘Page
('/œedœ', s–f.
cook›s
)

451 
£lf
.
	`as£¹Body
("memcached")

453 
def
 
	$‹¡_5_E¼Ü_·ths
(
£lf
):

454 
£lf
.
	`g‘Page
('/unknown/page')

455 
£lf
.
	`as£¹E¼ÜPage
(404, "The…ath '/unknown/page' was‚ot found.")

457 #NÙe: 
this
 
·th
 
is
 *
nÙ
* 
the
 
§me
 
as
 
above
. 
The
‡bove

458 #ke 
a
 
nÜm®
 
rou‹
 
through
 
the
 
£ssiÚ
 
code
; 
this
 
Úe


459 #sk 
the
 
£ssiÚ
 
code
's before_handler‡nd only calls

460 #befÜe_fš®iz(
§ve
è
ªd
 
	`Ú_’d
 (
şo£
). 
So
 
the
 
£ssiÚ


461 #cod
has
 
to
 
survive
 
ÿÎšg
 
§ve
/
şo£
 
w™hout
 
š™
.

462 
£lf
.
	`g‘Page
('/»¡riùed', s–f.
cook›s
, 
m‘hod
='POST')

463 
£lf
.
	`as£¹E¼ÜPage
(405, 
»¥Ú£_codes
[405][1])

	@trunk/objs/CherryPy-3.2.4/cherrypy/test/test_sessionauthenticate.py

1 
impÜt
 
ch”rypy


2 
äom
 
	gch”rypy
.
‹¡
 
impÜt
 
h–³r


5 
şass
 
	$SessiÚAuth’tiÿ‹Te¡
(
h–³r
.
CPWebCa£
):

7 
def
 
	$£tup_£rv”
():

9 
def
 
	$check
(
u£ºame
, 
·sswÜd
):

10 #Dummy 
check_u£ºame_ªd_·sswÜd
 
funùiÚ


11 
u£ºame
 !ğ'‹¡' 
Ü
 
·sswÜd
 != 'password':

14 
def
 
	$augm’t_·¿ms
():

15 #A 
sim¶e
 
toŞ
 
to
 
add
 
some
 
thšgs
Ø
»que¡
.
·¿ms


16 #Thi 
is
 
to
 
check
Ø
make
 
su»
 
th©
 
£ssiÚ_auth
 
ÿn
 
hªdË
 
»que¡


17 #·¿m (
tick‘
 #780)

18 
ch”rypy
.
»que¡
.
·¿ms
["test"] = "test"

20 
ch”rypy
.
toŞs
.
augm’t_·¿ms
 = ch”rypy.
	`ToŞ
('before_handler',

21 
augm’t_·¿ms
, 
NÚe
, 
´iÜ™y
=30)

23 
şass
 
Te¡
:

25 
_ı_cÚfig
 = {'toŞs.£ssiÚs.Ú': 
True
,

26 'toŞs.£ssiÚ_auth.Ú': 
True
,

27 'toŞs.£ssiÚ_auth.check_u£ºame_ªd_·sswÜd': 
check
,

28 'toŞs.augm’t_·¿ms.Ú': 
True
,

29 
	}
}

31 
def
 
	$šdex
(
£lf
, **
kw¬gs
):

32  "H˜%s, you‡»†ogged in" % 
ch”rypy
.
»que¡
.
logš


33 
šdex
.
expo£d
 = 
True


35 
ch”rypy
.
Œ“
.
	`mouÁ
(
	$Te¡
())

36 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

39 
def
 
	$‹¡SessiÚAuth’tiÿ‹
(
£lf
):

40 #»que¡ 
a
 
·ge
 
ªd
 
check
 
logš
 
fÜm


41 
£lf
.
	`g‘Page
('/')

42 
£lf
.
	`as£¹InBody
('<form method="post"‡ction="do_login">')

44 #£tu°
üed’tŸls


45 
logš_body
 = 'username=test&password=password&from_page=/'

47 #©‹m± 
a
 
logš


48 
£lf
.
	`g‘Page
('/do_logš', 
m‘hod
='POST', 
body
=
logš_body
)

49 
£lf
.
	`as£¹Stus
((302, 303))

51 #g‘ 
the
 
·ge
 
now
 
th©
 
we
 
¬e
 
logged
 
š


52 
£lf
.
	`g‘Page
('/', s–f.
cook›s
)

53 
£lf
.
	`as£¹Body
('Hiest, you‡re†ogged in')

55 #dØ
a
 
logout


56 
£lf
.
	`g‘Page
('/do_logout', s–f.
cook›s
, 
m‘hod
='POST')

57 
£lf
.
	`as£¹Stus
((302, 303))

59 #v”ify 
we
 
¬e
 
logged
 
out


60 
£lf
.
	`g‘Page
('/', s–f.
cook›s
)

61 
£lf
.
	`as£¹InBody
('<form method="post"‡ction="do_login">')

	@trunk/objs/CherryPy-3.2.4/cherrypy/test/test_states.py

1 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
	gBadStusLše
, 
Áob


2 
impÜt
 
os


3 
impÜt
 
sys


4 
impÜt
 
time


5 
impÜt
 
sigÇl


6 
impÜt
 
un™‹¡


7 
impÜt
 
sock‘


9 
impÜt
 
ch”rypy


10 
impÜt
 
	gch”rypy
.
	g´oûss
.
£rv”s


11 
äom
 
	gch”rypy
.
‹¡
 
impÜt
 
h–³r


13 
	g’gše
 = 
ch”rypy
.
’gše


14 
thisdœ
 = 
os
.
·th
.
još
(os.
g‘cwd
(), os.·th.
	$dœÇme
(
__fe__
))

17 
şass
 
D•’d’cy
:

19 
def
 
	$__š™__
(
£lf
, 
bus
):

20 
£lf
.
bus
 = bus

21 
£lf
.
ruÂšg
 = 
F®£


22 
£lf
.
¡¬tcouÁ
 = 0

23 
£lf
.
g¿ûcouÁ
 = 0

24 
£lf
.
th»ads
 = {
	}
}

26 
def
 
	$subsüibe
(
£lf
):

27 
£lf
.
bus
.
	`subsüibe
('¡¬t', s–f.
¡¬t
)

28 
£lf
.
bus
.
	`subsüibe
('¡İ', s–f.
¡İ
)

29 
£lf
.
bus
.
	`subsüibe
('g¿ûful', s–f.
g¿ûful
)

30 
£lf
.
bus
.
	`subsüibe
('¡¬t_th»ad', s–f.
¡¬‰h»ad
)

31 
£lf
.
bus
.
	`subsüibe
('¡İ_th»ad', s–f.
¡İth»ad
)

33 
def
 
	$¡¬t
(
£lf
):

34 
£lf
.
ruÂšg
 = 
True


35 
£lf
.
¡¬tcouÁ
 += 1

37 
def
 
	$¡İ
(
£lf
):

38 
£lf
.
ruÂšg
 = 
F®£


40 
def
 
	$g¿ûful
(
£lf
):

41 
£lf
.
g¿ûcouÁ
 += 1

43 
def
 
	$¡¬‰h»ad
(
£lf
, 
th»ad_id
):

44 
£lf
.
th»ads
[
th»ad_id
] = 
NÚe


46 
def
 
	$¡İth»ad
(
£lf
, 
th»ad_id
):

47 
d–
 
£lf
.
th»ads
[
th»ad_id
]

49 
db_cÚÃùiÚ
 = 
	$D•’d’cy
(
’gše
)

51 
def
 
	$£tup_£rv”
():

52 
şass
 
RoÙ
:

53 
def
 
	$šdex
(
£lf
):

55 
šdex
.
expo£d
 = 
True


57 
def
 
	$ù¾c
(
£lf
):

58 
¿i£
 
	$KeybßrdIÁ”ru±
()

59 
ù¾c
.
expo£d
 = 
True


61 
def
 
	$g¿ûful
(
£lf
):

62 
’gše
.
	$g¿ûful
()

64 
g¿ûful
.
expo£d
 = 
True


66 
def
 
	$block_ex¶ic™
(
£lf
):

67 
True
:

68 
ch”rypy
.
»¥Ú£
.
timed_out
:

69 
ch”rypy
.
»¥Ú£
.
timed_out
 = 
F®£


71 
time
.
	$¦“p
(0.01)

72 
block_ex¶ic™
.
expo£d
 = 
True


74 
def
 
	$block_im¶ic™
(
£lf
):

75 
time
.
	$¦“p
(0.5)

76  "»¥Ú£.timeouˆğ%s" % 
ch”rypy
.
»¥Ú£
.
timeout


77 
block_im¶ic™
.
expo£d
 = 
True


79 
ch”rypy
.
Œ“
.
	`mouÁ
(
	$RoÙ
())

80 
ch”rypy
.
cÚfig
.
	`upd©e
({

83 
	}
})

85 
db_cÚÃùiÚ
.
	$subsüibe
()

87 #------------ 
Enough
 
h–³rs
. 
Time
 
»®
 
live
 
‹¡
 
ÿ£s
. ------------ #


88 
şass
 
	$S”v”S‹Te¡s
(
h–³r
.
CPWebCa£
):

89 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

91 
def
 
	$£tUp
(
£lf
):

92 
ch”rypy
.
£rv”
.
sock‘_timeout
 = 0.1

93 
£lf
.
do_gc_‹¡
 = 
F®£


95 
def
 
	$‹¡_0_NÜm®S‹Flow
(
£lf
):

96 
’gše
.
	$¡İ
()

97 #Ou¸
db_cÚÃùiÚ
 
should
 
nÙ
 
be
 
ruÂšg


98 
£lf
.
	$as£¹Equ®
(
db_cÚÃùiÚ
.
ruÂšg
, 
F®£
)

99 
£lf
.
	$as£¹Equ®
(
db_cÚÃùiÚ
.
¡¬tcouÁ
, 1)

100 
£lf
.
	`as£¹Equ®
(
	`Ën
(
db_cÚÃùiÚ
.
th»ads
), 0)

102 #Te¡ 
£rv”
 
¡¬t


103 
’gše
.
	$¡¬t
()

104 
£lf
.
	$as£¹Equ®
(
’gše
.
¡©e
,ƒngše.
¡©es
.
STARTED
)

106 
ho¡
 = 
ch”rypy
.
£rv”
.
sock‘_ho¡


107 
pÜt
 = 
ch”rypy
.
£rv”
.
sock‘_pÜt


108 
£lf
.
	$as£¹Rai£s
(
IOE¼Ü
, 
ch”rypy
.
_ı£rv”
.
check_pÜt
, 
ho¡
, 
pÜt
)

110 #Th
db_cÚÃùiÚ
 
should
 
be
 
ruÂšg
 
now


111 
£lf
.
	$as£¹Equ®
(
db_cÚÃùiÚ
.
ruÂšg
, 
True
)

112 
£lf
.
	$as£¹Equ®
(
db_cÚÃùiÚ
.
¡¬tcouÁ
, 2)

113 
£lf
.
	`as£¹Equ®
(
	`Ën
(
db_cÚÃùiÚ
.
th»ads
), 0)

115 
£lf
.
	`g‘Page
("/")

116 
£lf
.
	`as£¹Body
("Hello World")

117 
£lf
.
	`as£¹Equ®
(
	`Ën
(
db_cÚÃùiÚ
.
th»ads
), 1)

119 #Te¡ 
’gše
 
¡İ
. 
This
 
wl
 
®so
 stİ 
the
 
HTTP
 
£rv”
.

120 
’gše
.
	$¡İ
()

121 
£lf
.
	$as£¹Equ®
(
’gše
.
¡©e
,ƒngše.
¡©es
.
STOPPED
)

123 #V”ify 
th©
 
our
 
cu¡om
 
¡İ
 
funùiÚ
 
was
 
ÿÎed


124 
£lf
.
	$as£¹Equ®
(
db_cÚÃùiÚ
.
ruÂšg
, 
F®£
)

125 
£lf
.
	`as£¹Equ®
(
	`Ën
(
db_cÚÃùiÚ
.
th»ads
), 0)

127 #Block 
the
 
maš
 
th»ad
 
now
 
ªd
 
v”ify
 
th©
 
	`ex™
(è
wÜks
.

128 
def
 
	$ex™‹¡
():

129 
£lf
.
	`g‘Page
("/")

130 
£lf
.
	`as£¹Body
("Hello World")

131 
’gše
.
	$ex™
()

132 
ch”rypy
.
£rv”
.
	$¡¬t
()

133 
’gše
.
	$¡¬t_w™h_ÿÎback
(
ex™‹¡
)

134 
’gše
.
	$block
()

135 
£lf
.
	$as£¹Equ®
(
’gše
.
¡©e
,ƒngše.
¡©es
.
EXITING
)

137 
def
 
	$‹¡_1_Re¡¬t
(
£lf
):

138 
ch”rypy
.
£rv”
.
	$¡¬t
()

139 
’gše
.
	$¡¬t
()

141 #Th
db_cÚÃùiÚ
 
should
 
be
 
ruÂšg
 
now


142 
£lf
.
	$as£¹Equ®
(
db_cÚÃùiÚ
.
ruÂšg
, 
True
)

143 
g¿û
 = 
db_cÚÃùiÚ
.
g¿ûcouÁ


145 
£lf
.
	`g‘Page
("/")

146 
£lf
.
	`as£¹Body
("Hello World")

147 
£lf
.
	`as£¹Equ®
(
	`Ën
(
db_cÚÃùiÚ
.
th»ads
), 1)

149 #Te¡ 
£rv”
 
»¡¬t
 
äom
 
this
 
th»ad


150 
’gše
.
	$g¿ûful
()

151 
£lf
.
	$as£¹Equ®
(
’gše
.
¡©e
,ƒngše.
¡©es
.
STARTED
)

152 
£lf
.
	`g‘Page
("/")

153 
£lf
.
	`as£¹Body
("Hello World")

154 
£lf
.
	$as£¹Equ®
(
db_cÚÃùiÚ
.
ruÂšg
, 
True
)

155 
£lf
.
	`as£¹Equ®
(
db_cÚÃùiÚ
.
g¿ûcouÁ
, 
g¿û
 + 1)

156 
£lf
.
	`as£¹Equ®
(
	`Ën
(
db_cÚÃùiÚ
.
th»ads
), 1)

158 #Te¡ 
£rv”
 
»¡¬t
 
äom
 
šside
 
a
 
·ge
 
hªdËr


159 
£lf
.
	`g‘Page
("/graceful")

160 
£lf
.
	$as£¹Equ®
(
’gše
.
¡©e
,ƒngše.
¡©es
.
STARTED
)

161 
£lf
.
	`as£¹Body
("app was (gracefully)„estarted succesfully")

162 
£lf
.
	$as£¹Equ®
(
db_cÚÃùiÚ
.
ruÂšg
, 
True
)

163 
£lf
.
	`as£¹Equ®
(
db_cÚÃùiÚ
.
g¿ûcouÁ
, 
g¿û
 + 2)

164 #Sšû 
we
 
¬e
 
»que¡šg
 
synchrÚou¦y
, 
is
 
Úly
 
Úe
 
th»ad
 
u£d
?

165 #NÙ
th©
 
the
 "/g¿ûful" 
»que¡
 
has
 
b“n
 
æushed
.

166 
£lf
.
	`as£¹Equ®
(
	`Ën
(
db_cÚÃùiÚ
.
th»ads
), 0)

168 
’gše
.
	$¡İ
()

169 
£lf
.
	$as£¹Equ®
(
’gše
.
¡©e
,ƒngše.
¡©es
.
STOPPED
)

170 
£lf
.
	$as£¹Equ®
(
db_cÚÃùiÚ
.
ruÂšg
, 
F®£
)

171 
£lf
.
	`as£¹Equ®
(
	`Ën
(
db_cÚÃùiÚ
.
th»ads
), 0)

173 
def
 
	$‹¡_2_KeybßrdIÁ”ru±
(
£lf
):

174 #Rai£ 
a
 
keybßrd
 
š‹¼u±
 
š
 
the
 
HTTP
 
£rv”
's mainhread.

175 #W
mu¡
 
¡¬t
 
the
 
£rv”
 
š
 
this
,h
maš
 
th»ad


176 
’gše
.
	$¡¬t
()

177 
ch”rypy
.
£rv”
.
	$¡¬t
()

179 
£lf
.
³rsi¡’t
 = 
True


180 
Œy
:

181 #Mak
the
 
fœ¡
 
»que¡
 
ªd
 
as£¹
 
th”e
's‚o "Connection: close".

182 
£lf
.
	`g‘Page
("/")

183 
£lf
.
	`as£¹Stus
('200 OK')

184 
£lf
.
	`as£¹Body
("Hello World")

185 
£lf
.
	`as£¹NoH—d”
("Connection")

187 
ch”rypy
.
£rv”
.
h‰p£rv”
.
š‹¼u±
 = 
KeybßrdIÁ”ru±


188 
’gše
.
	$block
()

190 
£lf
.
	$as£¹Equ®
(
db_cÚÃùiÚ
.
ruÂšg
, 
F®£
)

191 
£lf
.
	`as£¹Equ®
(
	`Ën
(
db_cÚÃùiÚ
.
th»ads
), 0)

192 
£lf
.
	$as£¹Equ®
(
’gše
.
¡©e
,ƒngše.
¡©es
.
EXITING
)

193 
fš®ly
:

194 
£lf
.
³rsi¡’t
 = 
F®£


196 #Rai£ 
a
 
keybßrd
 
š‹¼u±
 
š
‡ 
·ge
 
hªdËr
; 
Ú
 
muÉ™h»aded


197 #£rv”s, 
this
 
should
 
occur
 
š
 
Úe
 
of
 
the
 
wÜk”
 
th»ads
.

198 #Thi 
should
 
¿i£
 
a
 
BadStusLše
 
”rÜ
, 
sšû
 
the
 
wÜk”


199 #th»ad 
wl
 
ju¡
 
d›
 
w™hout
 
wr™šg
 
a
 
»¥Ú£
.

200 
’gše
.
	$¡¬t
()

201 
ch”rypy
.
£rv”
.
	$¡¬t
()

203 
Œy
:

204 
£lf
.
	`g‘Page
("/ctrlc")

205 
exû±
 
BadStusLše
:

206 
·ss


208 
	$´št
(
£lf
.
body
)

209 
£lf
.
	`ç
("AssertionError: BadStatusLine‚ot„aised")

211 
’gše
.
	$block
()

212 
£lf
.
	$as£¹Equ®
(
db_cÚÃùiÚ
.
ruÂšg
, 
F®£
)

213 
£lf
.
	`as£¹Equ®
(
	`Ën
(
db_cÚÃùiÚ
.
th»ads
), 0)

215 
def
 
	$‹¡_3_D—dlocks
(
£lf
):

216 
ch”rypy
.
cÚfig
.
	`upd©e
({'»¥Ú£.timeout': 0.2
	}
})

218 
’gše
.
	$¡¬t
()

219 
ch”rypy
.
£rv”
.
	$¡¬t
()

220 
Œy
:

221 
£lf
.
	$as£¹NÙEqu®
(
’gše
.
timeout_mÚ™Ü
.
th»ad
, 
NÚe
)

223 #Reque¡ 
a
 "nÜm®" 
·ge
.

224 
£lf
.
	$as£¹Equ®
(
’gše
.
timeout_mÚ™Ü
.
£rvšgs
, [])

225 
£lf
.
	`g‘Page
("/")

226 
£lf
.
	`as£¹Body
("Hello World")

227 #»que¡.
şo£
 
is
 
ÿÎed
 
async
.

228 
’gše
.
timeout_mÚ™Ü
.
£rvšgs
:

229 
sys
.
¡dout
.
	`wr™e
(".")

230 
time
.
	$¦“p
(0.01)

232 #Reque¡ 
a
 
·ge
 
th©
 
ex¶ic™ly
 
checks
 
™£lf
 
d—dlock
.

233 #Th
d—dlock_timeout
 
should
 
be
 2 
£cs
.

234 
£lf
.
	`g‘Page
("/block_explicit")

235 
£lf
.
	`as£¹Body
("broken!")

237 #Reque¡ 
a
 
·ge
 
th©
 
im¶ic™ly
 
b»aks
 
d—dlock
.

238 #Ià
we
 
d—dlock
, w
wªt
 
to
 
touch
 
as
 
l™e
 
code
‡ 
possibË
,

239 #sØ
we
 
wÚ
'tƒven call handle_error, just bail ASAP.

240 
£lf
.
	`g‘Page
("/block_implicit")

241 
£lf
.
	$as£¹Stus
(500)

242 
£lf
.
	`as£¹InBody
("raise cherrypy.TimeoutError()")

243 
fš®ly
:

244 
’gše
.
	$ex™
()

246 
def
 
	$‹¡_4_AutÜ–ßd
(
£lf
):

247 #S¹ 
the
 
demo
 
süt
 
š
 
a
 
Ãw
 
´oûss


248 
p
 = 
h–³r
.
	`CPProûss
(
s¦
=(
£lf
.
scheme
.
	`low”
()=='https'))

249 
p
.
	`wr™e_cÚf
(
exŒa
='test_case_name: "test_4_Autoreload"')

250 
p
.
	`¡¬t
(
impÜts
='cherrypy.test._test_states_demo')

251 
Œy
:

252 
£lf
.
	`g‘Page
("/start")

253 
¡¬t
 = (
£lf
.
body
)

255 #Giv
the
 
autÜ–ßd”
 
time
 
to
 
ÿche
h
fe
ime.

256 
time
.
	$¦“p
(2)

258 #Touch 
the
 
fe


259 
os
.
	`utime
(os.
·th
.
	`još
(
thisdœ
, "_‹¡_¡©es_demo.py"), 
NÚe
)

261 #Giv
the
 
autÜ–ßd”
 
time
 
to
 
»
-
exec
h
´oûss


262 
time
.
	$¦“p
(2)

263 
ho¡
 = 
ch”rypy
.
£rv”
.
sock‘_ho¡


264 
pÜt
 = 
ch”rypy
.
£rv”
.
sock‘_pÜt


265 
ch”rypy
.
_ı£rv”
.
	$wa™_fÜ_occup›d_pÜt
(
ho¡
, 
pÜt
)

267 
£lf
.
	`g‘Page
("/start")

268 
	`nÙ
 ((
£lf
.
body
è> 
¡¬t
):

269 
¿i£
 
	`As£¹iÚE¼Ü
("startime %s‚ot greaterhan %s" %

270 ((
£lf
.
body
), 
¡¬t
))

271 
fš®ly
:

272 #Shuˆ
down
 
the
 
¥awÃd
 
´oûss


273 
£lf
.
	`g‘Page
("/exit")

274 
p
.
	$još
()

276 
def
 
	$‹¡_5_S¹_E¼Ü
(
£lf
):

277 #Ià
a
 
´oûss
 
”rÜs
 
duršg
 
¡¬t
, 
™
 
should
 
¡İ
 
the
 
’gše


278 #ªd 
ex™
 
w™h
 
a
 
nÚ
-
z”o
ƒx™ 
code
.

279 
p
 = 
h–³r
.
	`CPProûss
(
s¦
=(
£lf
.
scheme
.
	`low”
()=='https'),

280 
wa™
=
True
)

281 
p
.
	`wr™e_cÚf
(

282 
exŒa
="""starterror: True

283 
‹¡_ÿ£_Çme
: "test_5_Start_Error"

286 
p
.
	`¡¬t
(
impÜts
='cherrypy.test._test_states_demo')

287 
p
.
ex™_code
 == 0:

288 
£lf
.
	`ç
("Process failedo„eturn‚onzeroƒxit code.")

291 
şass
 
	$PlugšTe¡s
(
h–³r
.
CPWebCa£
):

292 
def
 
	$‹¡_d«mÚize
(
£lf
):

293 
os
.
Çme
 
nÙ
 
š
 ['posix']:

294  
£lf
.
	`sk
("skipped (not on…osix) ")

295 
£lf
.
HOST
 = '127.0.0.1'

296 
£lf
.
PORT
 = 8081

297 #S·wÀ
the
 
´oûss
 
ªd
 
wa™
, 
wh’
 
this
 
»tuºs
,h
Üigš®
…rocess

298 #i 
fšished
. 
If
 
™
 
d«mÚized
 
´İ”ly
, 
we
 
should
 
¡l
 
be
 
abË


299 #tØ
acûss
 
·ges
.

300 
p
 = 
h–³r
.
	`CPProûss
(
s¦
=(
£lf
.
scheme
.
	`low”
()=='https'),

301 
wa™
=
True
, 
d«mÚize
=True,

302 
sock‘_ho¡
='127.0.0.1',

303 
sock‘_pÜt
=8081)

304 
p
.
	`wr™e_cÚf
(

305 
exŒa
='test_case_name: "test_daemonize"')

306 
p
.
	`¡¬t
(
impÜts
='cherrypy.test._test_states_demo')

307 
Œy
:

308 #Ju¡ 
g‘
 
the
 
pid
 
of
h
d«mÚiz©iÚ
 
´oûss
.

309 
£lf
.
	`g‘Page
("/pid")

310 
£lf
.
	$as£¹Stus
(200)

311 
·ge_pid
 = (
£lf
.
body
)

312 
£lf
.
	`as£¹Equ®
(
·ge_pid
, 
p
.
	$g‘_pid
())

313 
fš®ly
:

314 #Shuˆ
down
 
the
 
¥awÃd
 
´oûss


315 
£lf
.
	`g‘Page
("/exit")

316 
p
.
	$još
()

318 #Wa™ 
uÁ
 
h”e
 
to
 
‹¡
 
the
 
ex™
 
code
 
beÿu£
 
we
 
wªt
Ø
’su»


319 #th© 
we
 
wa™
 
the
 
d«mÚ
 
to
 
fšish
 
ruÂšg
 
befÜe
 w
ç
.

320 
p
.
ex™_code
 != 0:

321 
£lf
.
	`ç
("Daemonized…arent…rocess failedoƒxit cleanly.")

324 
şass
 
	$SigÇlHªdlšgTe¡s
(
h–³r
.
CPWebCa£
):

325 
def
 
	$‹¡_SIGHUP_‰y
(
£lf
):

326 #Wh’ 
nÙ
 
d«mÚized
, 
SIGHUP
 
should
 
shut
 
down
 
the
 
£rv”
.

327 
Œy
:

328 
äom
 
sigÇl
 
impÜt
 
SIGHUP


329 
exû±
 
ImpÜtE¼Ü
:

330  
£lf
.
	`sk
("skipped (no SIGHUP) ")

332 #S·wÀ
the
 
´oûss
.

333 
p
 = 
h–³r
.
	`CPProûss
(
s¦
=(
£lf
.
scheme
.
	`low”
()=='https'))

334 
p
.
	`wr™e_cÚf
(

335 
exŒa
='test_case_name: "test_SIGHUP_tty"')

336 
p
.
	`¡¬t
(
impÜts
='cherrypy.test._test_states_demo')

337 #S’d 
a
 
SIGHUP


338 
os
.
	`kl
(
p
.
	`g‘_pid
(), 
SIGHUP
)

339 #Thi 
might
 
hªg
 
thšgs
 
¬’
't working„ight, but meh.

340 
p
.
	$još
()

342 
def
 
	$‹¡_SIGHUP_d«mÚized
(
£lf
):

343 #Wh’ 
d«mÚized
, 
SIGHUP
 
should
 
»¡¬t
 
the
 
£rv”
.

344 
Œy
:

345 
äom
 
sigÇl
 
impÜt
 
SIGHUP


346 
exû±
 
ImpÜtE¼Ü
:

347  
£lf
.
	`sk
("skipped (no SIGHUP) ")

349 
os
.
Çme
 
nÙ
 
š
 ['posix']:

350  
£lf
.
	`sk
("skipped (not on…osix) ")

352 #S·wÀ
the
 
´oûss
 
ªd
 
wa™
, 
wh’
 
this
 
»tuºs
,h
Üigš®
…rocess

353 #i 
fšished
. 
If
 
™
 
d«mÚized
 
´İ”ly
, 
we
 
should
 
¡l
 
be
 
abË


354 #tØ
acûss
 
·ges
.

355 
p
 = 
h–³r
.
	`CPProûss
(
s¦
=(
£lf
.
scheme
.
	`low”
()=='https'),

356 
wa™
=
True
, 
d«mÚize
=True)

357 
p
.
	`wr™e_cÚf
(

358 
exŒa
='test_case_name: "test_SIGHUP_daemonized"')

359 
p
.
	`¡¬t
(
impÜts
='cherrypy.test._test_states_demo')

361 
pid
 = 
p
.
	$g‘_pid
()

362 
Œy
:

363 #S’d 
a
 
SIGHUP


364 
os
.
	$kl
(
pid
, 
SIGHUP
)

365 #Giv
the
 
£rv”
 
some
 
time
 
to
 
»¡¬t


366 
time
.
	$¦“p
(2)

367 
£lf
.
	`g‘Page
("/pid")

368 
£lf
.
	$as£¹Stus
(200)

369 
Ãw_pid
 = (
£lf
.
body
)

370 
£lf
.
	$as£¹NÙEqu®
(
Ãw_pid
, 
pid
)

371 
fš®ly
:

372 #Shuˆ
down
 
the
 
¥awÃd
 
´oûss


373 
£lf
.
	`g‘Page
("/exit")

374 
p
.
	$još
()

376 
def
 
	$_»quœe_sigÇl_ªd_kl
(
£lf
, 
sigÇl_Çme
):

377 
nÙ
 
	$ha§‰r
(
sigÇl
, 
sigÇl_Çme
):

378 
£lf
.
	`sk
("sk³d (nØ%(sigÇl_Çme)s)" % 
	$v¬s
())

380 
nÙ
 
	`ha§‰r
(
os
, 'kill'):

381 
£lf
.
	`sk
("skipped (no os.kill)")

383 
def
 
	$‹¡_SIGTERM
(
£lf
):

385 
£lf
.
	`_»quœe_sigÇl_ªd_kl
('SIGTERM')

387 #S·wÀ
a
 
nÜm®
, 
und«mÚized
 
´oûss
.

388 
p
 = 
h–³r
.
	`CPProûss
(
s¦
=(
£lf
.
scheme
.
	`low”
()=='https'))

389 
p
.
	`wr™e_cÚf
(

390 
exŒa
='test_case_name: "test_SIGTERM"')

391 
p
.
	`¡¬t
(
impÜts
='cherrypy.test._test_states_demo')

392 #S’d 
a
 
SIGTERM


393 
os
.
	`kl
(
p
.
	`g‘_pid
(), 
sigÇl
.
SIGTERM
)

394 #Thi 
might
 
hªg
 
thšgs
 
¬’
't working„ight, but meh.

395 
p
.
	$još
()

397 
os
.
Çme
 
š
 ['posix']:

398 #S·wÀ
a
 
d«mÚized
 
´oûss
 
ªd
 
‹¡
 
agaš
.

399 
p
 = 
h–³r
.
	`CPProûss
(
s¦
=(
£lf
.
scheme
.
	`low”
()=='https'),

400 
wa™
=
True
, 
d«mÚize
=True)

401 
p
.
	`wr™e_cÚf
(

402 
exŒa
='test_case_name: "test_SIGTERM_2"')

403 
p
.
	`¡¬t
(
impÜts
='cherrypy.test._test_states_demo')

404 #S’d 
a
 
SIGTERM


405 
os
.
	`kl
(
p
.
	`g‘_pid
(), 
sigÇl
.
SIGTERM
)

406 #Thi 
might
 
hªg
 
thšgs
 
¬’
't working„ight, but meh.

407 
p
.
	$još
()

409 
def
 
	$‹¡_sigÇl_hªdËr_unsubsüibe
(
£lf
):

410 
£lf
.
	`_»quœe_sigÇl_ªd_kl
('SIGTERM')

412 #AÉhough 
Wšdows
 
has
 `
os
.
kl
` 
ªd
 
SIGTERM
 
is
 
defšed
, 
the


413 #¶©fÜm 
dÛs
 
nÙ
 
im¶em’t
 
sigÇls
 
ªd
 
£ndšg
 
SIGTERM


414 #wÈ
»suÉ
 
š
 
a
 
fÜûd
 
‹rmš©iÚ
 
of
 
the
 
´oûss
.

415 #Th”efÜe, 
this
 
‹¡
 
is
 
nÙ
 
su™abË
 
Wšdows
.

416 
os
.
Çme
 == 'nt':

417 
£lf
.
	`sk
("SIGTERM‚ot‡vailable")

419 #S·wÀ
a
 
nÜm®
, 
und«mÚized
 
´oûss
.

420 
p
 = 
h–³r
.
	`CPProûss
(
s¦
=(
£lf
.
scheme
.
	`low”
()=='https'))

421 
p
.
	`wr™e_cÚf
(

422 
exŒa
="""unsubsig: True

423 
‹¡_ÿ£_Çme
: "test_signal_handler_unsubscribe"

425 
p
.
	`¡¬t
(
impÜts
='cherrypy.test._test_states_demo')

426 #Ask 
the
 
´oûss
 
to
 
qu™


427 
os
.
	`kl
(
p
.
	`g‘_pid
(), 
sigÇl
.
SIGTERM
)

428 #Thi 
might
 
hªg
 
thšgs
 
¬’
't working„ight, but meh.

429 
p
.
	$još
()

431 #As£¹ 
the
 
Şd
 
hªdËr
 
¿n
.

432 
rg‘_lše
 = 
	`İ’
(
p
.
”rÜ_log
, 'rb').
	`»adlšes
()[-10]

433 
nÙ
 
	`Áob
("I‡m‡ÀŞd SIGTERM hªdËr."è
š
 
rg‘_lše
:

434 
£lf
.
	`ç
("Old SIGTERM hªdË¸did‚Ù„un.\n%r" % 
rg‘_lše
)

436 
şass
 
	$Wa™Te¡s
(
un™‹¡
.
Te¡Ca£
):

437 
def
 
	$‹¡_wa™_fÜ_occup›d_pÜt_INADDR_ANY
(
£lf
):

439 
Wa™
 
Ú
 
INADDR_ANY
 
should
 
nÙ
 
¿i£
 
IOE¼Ü


441 
In
 
ÿ£s
 
wh”e
 
the
 
loİback
 
š‹rçû
 
dÛs
 
nÙ
 
exi¡
, 
Ch”ryPy
 
ÿÂÙ


442 
efãùiv–y
 
d‘”mše
 
a
 
pÜt
 
bšdšg
 
to
 
INADDR_ANY
 
was
 
efãùed
.

443 
In
 
this
 
s™u©iÚ
, 
Ch”ryPy
 
should
 
assume
 
th©
 
™
 
çed
 
to
 
d‘eù


444 
the
 
	$bšdšg
 (
nÙ
 
th©
 
the
 
bšdšg
 
çed
è
ªd
 
Úly
 
w¬n
h© 
™
 
could


445 
nÙ
 
v”ify
 
™
.

447 #Aˆ
such
 
a
 
time
 
th©
 
Ch”ryPy
 
ÿn
 
»lŸbly
 
d‘”mše
 
Úe
 
Ü
 
mÜe


448 #vŸbË 
IP
 
add»s£s
 
of
 
the
 
ho¡
, 
this
 
‹¡
 
may
 
be
 
»moved
.

450 #SimuÏ‹ 
the
 
behaviÜ
 
we
 
ob£rve
 
wh’
 
no
 
loİback
 
š‹rçû
 
is


451 #´e£Á 
by
: 
fšdšg
 
a
 
pÜt
 
th©
's‚ot occupied,hen wait on it.

453 
ä“_pÜt
 = 
£lf
.
	$fšd_ä“_pÜt
()

455 
£rv”s
 = 
ch”rypy
.
´oûss
.servers

457 
def
 
	$w™h_shÜ‹r_timeouts
(
func
):

459 
A
 
cÚ‹xt
 
wh”e
 
occup›d_pÜt_timeout
 
is
 
much
 
sm®Ër
 
to
 
¥“d


460 
‹¡
 
runs
.

462 #Wh’ 
we
 
have
 
PythÚ
 2.5, 
sim¶ify
 
usšg
 
the
 
w™h_¡©em’t
.

463 
Üig_timeout
 = 
£rv”s
.
occup›d_pÜt_timeout


464 
£rv”s
.
occup›d_pÜt_timeout
 = .07

465 
Œy
:

466 
	$func
()

467 
fš®ly
:

468 
£rv”s
.
occup›d_pÜt_timeout
 = 
Üig_timeout


470 
def
 
	$do_wa™šg
():

471 #Wa™ 
Ú
 
the
 
ä“
 
pÜt
 
th©
's unbound

472 
£rv”s
.
	`wa™_fÜ_occup›d_pÜt
('0.0.0.0', 
ä“_pÜt
)

473 #Th
wa™
 
should
 
¡l
 
¿i£
 
ª
 
IO
 
”rÜ
 
INADDR_ANY
 
was


474 #nÙ 
suµl›d
.

475 
£lf
.
	`as£¹Rai£s
(
IOE¼Ü
, 
£rv”s
.
wa™_fÜ_occup›d_pÜt
,

476 '127.0.0.1', 
ä“_pÜt
)

478 
	$w™h_shÜ‹r_timeouts
(
do_wa™šg
)

480 
def
 
	$fšd_ä“_pÜt
(
£lf
):

482 
sock
 = 
sock‘
.
	$sock‘
(
sock‘
.
AF_INET
, sock‘.
SOCK_STREAM
)

483 
sock
.
	`bšd
(('', 0))

484 
ä“_pÜt
 = 
sock
.
	`g‘sockÇme
()[1]

485 
sock
.
	$şo£
()

486  
ä“_pÜt


	@trunk/objs/CherryPy-3.2.4/cherrypy/test/test_static.py

1 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
	gHTTPCÚÃùiÚ
, 
	gHTTPSCÚÃùiÚ
, 
Áob


2 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
By‹sIO


4 
impÜt
 
os


5 
	gcurdœ
 = 
os
.
·th
.
još
(os.
g‘cwd
(), os.·th.
	$dœÇme
(
__fe__
))

6 
has_¥aû_f•©h
 = 
os
.
·th
.
	`još
(
curdœ
, 'static', 'has space.html')

7 
bigfe_f•©h
 = 
os
.
·th
.
	`još
(
curdœ
, "static", "bigfile.log")

8 
BIGFILE_SIZE
 = 1024 * 1024

10 
impÜt
 
ch”rypy


11 
äom
 
ch”rypy
.
lib
 
impÜt
 

12 
äom
 
ch”rypy
.
‹¡
 
impÜt
 
h–³r


15 
şass
 
	$SticTe¡
(
h–³r
.
CPWebCa£
):

17 
def
 
	$£tup_£rv”
():

18 
nÙ
 
os
.
·th
.
	$exi¡s
(
has_¥aû_f•©h
):

19 
	`İ’
(
has_¥aû_f•©h
, 'wb').
	`wr™e
(
	`Áob
('Hello, world\r\n'))

20 
nÙ
 
os
.
·th
.
	$exi¡s
(
bigfe_f•©h
):

21 
	`İ’
(
bigfe_f•©h
, 'wb').
	`wr™e
(
	`Áob
("x" * 
BIGFILE_SIZE
))

23 
şass
 
RoÙ
:

25 
def
 
	$bigfe
(
£lf
):

26 
äom
 
ch”rypy
.
lib
 
impÜt
 

27 
£lf
.
f
 = .
	$£rve_fe
(
bigfe_f•©h
)

28  
£lf
.
f


29 
bigfe
.
expo£d
 = 
True


30 
bigfe
.
_ı_cÚfig
 = {'»¥Ú£.¡»am': 
True
}

32 
def
 
	$‹Î
(
£lf
):

33 
£lf
.
f
.
šput
.
şo£d
:

35  
	`»´
(
£lf
.
f
.
šput
.
	`‹Î
()).
	`r¡r
('L')

36 
‹Î
.
expo£d
 = 
True


38 
def
 
	$feobj
(
£lf
):

39 
f
 = 
	`İ’
(
os
.
·th
.
	`još
(
curdœ
, 'style.css'), 'rb')

40  .
	`£rve_feobj
(
f
, 
cÚ‹Á_ty³
='text/css')

41 
feobj
.
expo£d
 = 
True


43 
def
 
	$by‹sio
(
£lf
):

44 
f
 = 
	`By‹sIO
(
	`Áob
('Fee\nfie\nfo\nfum'))

45  .
	`£rve_feobj
(
f
, 
cÚ‹Á_ty³
='text/plain')

46 
by‹sio
.
expo£d
 = 
True


48 
şass
 
Stic
:

50 
def
 
	$šdex
(
£lf
):

52 
šdex
.
expo£d
 = 
True


54 
def
 
	$dyÇmic
(
£lf
):

56 
dyÇmic
.
expo£d
 = 
True


59 
roÙ
 = 
	$RoÙ
()

60 
roÙ
.ğ
	$Stic
()

62 
roÙcÚf
 = {

64 'toŞs.¡©icdœ.Ú': 
True
,

66 'toŞs.¡©icdœ.roÙ': 
curdœ
,

69 'toŞs.¡©icfe.Ú': 
True
,

70 'toŞs.¡©icfe.f’ame': 
os
.
·th
.
	`još
(
curdœ
, 'style.css'),

73 'toŞs.¡©icdœ.Ú': 
True
,

74 'toŞs.¡©icdœ.roÙ': 
curdœ
,

79 'toŞs.¡©icdœ.Ú': 
True
,

80 '»que¡.show_Œaûbacks': 
True
,

82 
	}
}

83 
roÙAµ
 = 
ch”rypy
.
	$AµliÿtiÚ
(
roÙ
)

84 
roÙAµ
.
	$m”ge
(
roÙcÚf
)

86 
‹¡_­p_cÚf
 = {

89 'toŞs.¡©icdœ.Ú': 
True
,

90 'toŞs.¡©icdœ.roÙ': 
curdœ
,

93 
	}
}

94 
‹¡Aµ
 = 
ch”rypy
.
AµliÿtiÚ
(
	$Stic
())

95 
‹¡Aµ
.
	$m”ge
(
‹¡_­p_cÚf
)

97 
vho¡
 = 
ch”rypy
.
_ıwsgi
.
	`Vœtu®Ho¡
(
roÙAµ
, {'vœt.Ãt': 
‹¡Aµ
})

98 
ch”rypy
.
Œ“
.
	$g¿á
(
vho¡
)

99 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

102 
def
 
	$‹¬down_£rv”
():

103 
f
 
	$š
 (
has_¥aû_f•©h
, 
bigfe_f•©h
):

104 
os
.
·th
.
	$exi¡s
(
f
):

105 
Œy
:

106 
os
.
	$uÆšk
(
f
)

107 
exû±
:

108 
·ss


109 
‹¬down_£rv”
 = 
	$¡©icm‘hod
(
‹¬down_£rv”
)

112 
def
 
	$‹¡Stic
(
£lf
):

113 
£lf
.
	`g‘Page
("/static/index.html")

114 
£lf
.
	`as£¹Stus
('200 OK')

115 
£lf
.
	`as£¹H—d”
('Content-Type', 'text/html')

116 
£lf
.
	`as£¹Body
('Hello, world\r\n')

118 #Usšg 
a
 
¡©icdœ
.
roÙ
 
v®ue
 
š
‡ 
subdœ
...

119 
£lf
.
	`g‘Page
("/docroot/index.html")

120 
£lf
.
	`as£¹Stus
('200 OK')

121 
£lf
.
	`as£¹H—d”
('Content-Type', 'text/html')

122 
£lf
.
	`as£¹Body
('Hello, world\r\n')

124 #Check 
a
 
f’ame
 
w™h
 
¥aûs
 
š
 
™


125 
£lf
.
	`g‘Page
("/static/has%20space.html")

126 
£lf
.
	`as£¹Stus
('200 OK')

127 
£lf
.
	`as£¹H—d”
('Content-Type', 'text/html')

128 
£lf
.
	`as£¹Body
('Hello, world\r\n')

130 
£lf
.
	`g‘Page
("/style.css")

131 
£lf
.
	`as£¹Stus
('200 OK')

132 
£lf
.
	`as£¹H—d”
('Content-Type', 'text/css')

133 #NÙe: 
The
 
body
 
should
 
be
 
exaùly
 'Dummy styËsh“t\n', 
but


134 #unfÜtuÇ‹ly 
some
 
toŞs
 
such
 
as
 
WšZ
 
som‘imes
 
tuº
 \
n


135 #štØ\
r
\
n
 
Ú
 
Wšdows
 
wh’
 
exŒaùšg
 
the
 
Ch”ryPy
 
rb®l
 
so


136 #w
ju¡
 
check
 
the
 
cÚ‹Á


137 
£lf
.
	`as£¹M©chesBody
('^Dummy stylesheet')

139 
def
 
	$‹¡_çÎthrough
(
£lf
):

140 #Te¡ 
th©
 
NÙFound
 
wl
 
th’
 
Œy
 
dyÇmic
 
	`hªdËrs
 (
£e
 [878]).

141 
£lf
.
	`g‘Page
("/static/dynamic")

142 
£lf
.
	`as£¹Body
("This is‡ DYNAMIC…age")

144 #Check 
a
 
dœeùÜy
 
vŸ
 
çÎ
-
through
 
to
 
dyÇmic
 
hªdËr
.

145 
£lf
.
	`g‘Page
("/static/")

146 
£lf
.
	`as£¹Stus
('200 OK')

147 
£lf
.
	`as£¹H—d”
('Content-Type', 'text/html;charset=utf-8')

148 
£lf
.
	`as£¹Body
('You wanthe Baron? You can havehe Baron!')

150 
def
 
	$‹¡_šdex
(
£lf
):

151 #Check 
a
 
dœeùÜy
 
vŸ
 "staticdir.index".

152 
£lf
.
	`g‘Page
("/docroot/")

153 
£lf
.
	`as£¹Stus
('200 OK')

154 
£lf
.
	`as£¹H—d”
('Content-Type', 'text/html')

155 
£lf
.
	`as£¹Body
('Hello, world\r\n')

156 #Th
§me
 
·ge
 
should
 
be
 
»tuºed
 
ev’
 
»dœeùed
.

157 
£lf
.
	`g‘Page
("/docroot")

158 
£lf
.
	$as£¹Stus
(301)

159 
£lf
.
	`as£¹H—d”
('LoÿtiÚ', '%s/doüoÙ/' % s–f.
	$ba£
())

160 
£lf
.
	`as£¹M©chesBody
("This„esource .* <a href='%s/docroot/'>"

161 "%s/doüoÙ/</a>." % (
£lf
.
	`ba£
(), s–f.
	$ba£
()))

163 
def
 
	$‹¡_cÚfig_”rÜs
(
£lf
):

164 #Check 
th©
 
we
 
g‘
 
ª
 
”rÜ
 
no
 .
fe
 
Ü
 .
dœ


165 
£lf
.
	`g‘Page
("/error/thing.html")

166 
£lf
.
	$as£¹E¼ÜPage
(500)

167 
£lf
.
	`as£¹M©chesBody
(
	`Áob
("TypeError: staticdir\(\)akes‡t†east 2 "

170 
def
 
	$‹¡_£cur™y
(
£lf
):

171 #Te¡ 
up
-
Ëv–
 
£cur™y


172 
£lf
.
	`g‘Page
("/static/../../test/style.css")

173 
£lf
.
	`as£¹Stus
((400, 403))

175 
def
 
	$‹¡_modif
(
£lf
):

176 #Te¡ 
modif›d
-
sšû
 
Ú
 
a
 
»asÚably
-
Ïrge
 
fe


177 
£lf
.
	`g‘Page
("/static/dirback.jpg")

178 
£lf
.
	`as£¹Stus
("200 OK")

179 
Ï¡mod
 = ""

180 
k
, 
v
 
š
 
£lf
.
h—d”s
:

181 
k
 == 'Last-Modified':

182 
Ï¡mod
 = 
v


183 
ims
 = ("If-Modif›d-Sšû", 
Ï¡mod
)

184 
£lf
.
	`g‘Page
("/¡©ic/dœback.jpg", 
h—d”s
=[
ims
])

185 
£lf
.
	$as£¹Stus
(304)

186 
£lf
.
	`as£¹NoH—d”
("Content-Type")

187 
£lf
.
	`as£¹NoH—d”
("Content-Length")

188 
£lf
.
	`as£¹NoH—d”
("Content-Disposition")

189 
£lf
.
	`as£¹Body
("")

191 
def
 
	$‹¡_755_vho¡
(
£lf
):

192 
£lf
.
	`g‘Page
("/test/", [('Host', 'virt.net')])

193 
£lf
.
	$as£¹Stus
(200)

194 
£lf
.
	`g‘Page
("/test", [('Host', 'virt.net')])

195 
£lf
.
	$as£¹Stus
(301)

196 
£lf
.
	`as£¹H—d”
('LoÿtiÚ', s–f.
scheme
 + '://virt.net/test/')

198 
def
 
	$‹¡_£rve_feobj
(
£lf
):

199 
£lf
.
	`g‘Page
("/fileobj")

200 
£lf
.
	`as£¹Stus
('200 OK')

201 
£lf
.
	`as£¹H—d”
('Content-Type', 'text/css;charset=utf-8')

202 
£lf
.
	`as£¹M©chesBody
('^Dummy stylesheet')

204 
def
 
	$‹¡_£rve_by‹sio
(
£lf
):

205 
£lf
.
	`g‘Page
("/bytesio")

206 
£lf
.
	`as£¹Stus
('200 OK')

207 
£lf
.
	`as£¹H—d”
('Content-Type', 'text/plain;charset=utf-8')

208 
£lf
.
	`as£¹H—d”
('Content-Length', 14)

209 
£lf
.
	`as£¹M©chesBody
('Fee\nfie\nfo\nfum')

211 
def
 
	$‹¡_fe_¡»am
(
£lf
):

212 
ch”rypy
.
£rv”
.
´ÙocŞ_v”siÚ
 != "HTTP/1.1":

213  
£lf
.
	$sk
()

215 
£lf
.
PROTOCOL
 = "HTTP/1.1"

217 #Mak
ª
 
š™Ÿl
 
»que¡


218 
£lf
.
³rsi¡’t
 = 
True


219 
cÚn
 = 
£lf
.
HTTP_CONN


220 
cÚn
.
	`puŒeque¡
("GET", "/bigfe", 
sk_ho¡
=
True
)

221 
cÚn
.
	`puth—d”
("Ho¡", 
£lf
.
HOST
)

222 
cÚn
.
	$’dh—d”s
()

223 
»¥Ú£
 = 
cÚn
.
	`»¥Ú£_şass
(cÚn.
sock
, 
m‘hod
="GET")

224 
»¥Ú£
.
	$begš
()

225 
£lf
.
	$as£¹Equ®
(
»¥Ú£
.
¡©us
, 200)

227 
body
 = 
	`Áob
('')

228 
»maššg
 = 
BIGFILE_SIZE


229 
»maššg
 > 0:

230 
d©a
 = 
»¥Ú£
.
å
.
	$»ad
(65536)

231 
nÙ
 
d©a
:

233 
body
 +ğ
d©a


234 
»maššg
 -ğ
	$Ën
(
d©a
)

236 
£lf
.
scheme
 == "https":

237 
ÃwcÚn
 = 
HTTPSCÚÃùiÚ


239 
ÃwcÚn
 = 
HTTPCÚÃùiÚ


240 
s
, 
h
, 
b
 = 
h–³r
.
web‹¡
.
	`İ’URL
(

241 
	`Áob
("/‹Î"), 
h—d”s
=[], 
ho¡
=
£lf
.
HOST
, 
pÜt
=£lf.
PORT
,

242 
h‰p_cÚn
=
ÃwcÚn
)

243 
nÙ
 
b
:

244 #Th
fe
 
was
 
şo£d
 
Ú
 
the
 
£rv”
.

245 
‹Î_pos™iÚ
 = 
BIGFILE_SIZE


247 
‹Î_pos™iÚ
 = (
b
)

249 
ex³ùed
 = 
	$Ën
(
body
)

250 
‹Î_pos™iÚ
 >ğ
BIGFILE_SIZE
:

251 #W
ÿn
'tƒxactly control how much contenthe server‡sks for.

252 #Fudg
™
 
by
 
Úly
 
checkšg
 
the
 
fœ¡
 
h®f
 
of
h
»ads
.

253 
ex³ùed
 < (
BIGFILE_SIZE
 / 2):

254 
£lf
.
	`ç
(

258 
ex³ùed
)

259 
–if
 
‹Î_pos™iÚ
 < 
ex³ùed
:

260 
£lf
.
	`ç
(

264 (
ex³ùed
, 
‹Î_pos™iÚ
))

266 
body
 !ğ
	`Áob
("x" * 
BIGFILE_SIZE
):

267 
£lf
.
	`ç
("Body != 'x' * %d. Got %r instead (%d bytes)." %

268 (
BIGFILE_SIZE
, 
body
[:50], 
	$Ën
(
body
)))

269 
cÚn
.
	$şo£
()

271 
def
 
	$‹¡_fe_¡»am_d—dlock
(
£lf
):

272 
ch”rypy
.
£rv”
.
´ÙocŞ_v”siÚ
 != "HTTP/1.1":

273  
£lf
.
	$sk
()

275 
£lf
.
PROTOCOL
 = "HTTP/1.1"

277 #Mak
ª
 
š™Ÿl
 
»que¡
 
but
 
abÜt
 
—¾y
.

278 
£lf
.
³rsi¡’t
 = 
True


279 
cÚn
 = 
£lf
.
HTTP_CONN


280 
cÚn
.
	`puŒeque¡
("GET", "/bigfe", 
sk_ho¡
=
True
)

281 
cÚn
.
	`puth—d”
("Ho¡", 
£lf
.
HOST
)

282 
cÚn
.
	$’dh—d”s
()

283 
»¥Ú£
 = 
cÚn
.
	`»¥Ú£_şass
(cÚn.
sock
, 
m‘hod
="GET")

284 
»¥Ú£
.
	$begš
()

285 
£lf
.
	$as£¹Equ®
(
»¥Ú£
.
¡©us
, 200)

286 
body
 = 
»¥Ú£
.
å
.
	$»ad
(65536)

287 
body
 !ğ
	`Áob
("x" * 
	$Ën
(
body
)):

288 
£lf
.
	`ç
("Body != 'x' * %d. Got %r instead (%d bytes)." %

289 (65536, 
body
[:50], 
	$Ën
(
body
)))

290 
»¥Ú£
.
	$şo£
()

291 
cÚn
.
	$şo£
()

293 #Mak
a
 
£cÚd
 
»que¡
, 
which
 
should
 
ãtch
 
the
 
whŞe
 
fe
.

294 
£lf
.
³rsi¡’t
 = 
F®£


295 
£lf
.
	`g‘Page
("/bigfile")

296 
£lf
.
body
 !ğ
	`Áob
("x" * 
BIGFILE_SIZE
):

297 
£lf
.
	`ç
("Body != 'x' * %d. Got %r instead (%d bytes)." %

298 (
BIGFILE_SIZE
, 
£lf
.
body
[:50], 
	`Ën
(body)))

	@trunk/objs/CherryPy-3.2.4/cherrypy/test/test_tools.py

3 
impÜt
 
gz


4 
impÜt
 
sys


5 
impÜt
 
un™‹¡


6 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
	gBy‹sIO
, 
	gcİy™ems
, 
™”v®ues


7 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
	gIncom¶‘eR—d
, 
	gÁob
, 
	gÁou
, 
	gpy3k
, 
x¿nge


8 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
	gby‹¡r
, 
unicode¡r


9 
impÜt
 
time


10 
	gtimeout
 = 0.2

11 
impÜt
 
ty³s


13 
impÜt
 
ch”rypy


14 
äom
 
ch”rypy
 
impÜt
 
toŞs


17 
eurİoundUnicode
 = 
Áou
('\x80\xa3')

20 #Cl›Á-
side
 
code
 #


21 
äom
 
ch”rypy
.
‹¡
 
impÜt
 
h–³r


24 
şass
 
	$ToŞTe¡s
(
h–³r
.
CPWebCa£
):

25 
def
 
	$£tup_£rv”
():

27 #Puˆ
check_acûss
 
š
 
a
 
cu¡om
 
toŞbox
 
w™h
 
™s
 
own
 
Çme¥aû


28 
myauthtoŞs
 = 
ch”rypy
.
_ıtoŞs
.
	`ToŞbox
("myauth")

30 
def
 
	$check_acûss
(=
F®£
):

31 
nÙ
 
	`g‘©Œ
(
ch”rypy
.
»que¡
, "userid", ):

32 
¿i£
 
ch”rypy
.
	$HTTPE¼Ü
(401)

33 
myauthtoŞs
.
check_acûss
 = 
ch”rypy
.
	`ToŞ
('before_request_body', check_access)

35 
def
 
	$num”ify
():

36 
def
 
	$numb”_™
(
body
):

37 
chunk
 
š
 
body
:

38 
k
, 
v
 
š
 
ch”rypy
.
»que¡
.
num”ify_m­
:

39 
chunk
 = chunk.
	$»¶aû
(
k
, 
v
)

40 
y›ld
 
chunk


41 
ch”rypy
.
»¥Ú£
.
body
 = 
	$numb”_™
(
ch”rypy
.
»¥Ú£
.
body
)

43 
şass
 
	$NumToŞ
(
ch”rypy
.
ToŞ
):

44 
def
 
	$_£tup
(
£lf
):

45 
def
 
	$makem­
():

46 
m
 = 
£lf
.
	`_m”ged_¬gs
().
	`g‘
("m­", {
	}
})

47 
	gch”rypy
.
	g»que¡
.
	gnum”ify_m­
 = 
	$cİy™ems
(
m
)

48 
ch”rypy
.
»que¡
.
hooks
.
	`©ch
('Ú_¡¬t_»sourû', 
makem­
)

50 
def
 
	$ü™iÿl
():

51 
ch”rypy
.
»que¡
.
”rÜ_»¥Ú£
 = ch”rypy.
	`HTTPE¼Ü
(502).
£t_»¥Ú£


52 
ü™iÿl
.
ç§ã
 = 
True


54 
ch”rypy
.
»que¡
.
hooks
.
	`©ch
('Ú_¡¬t_»sourû', 
ü™iÿl
)

55 
ch”rypy
.
»que¡
.
hooks
.
	$©ch
(
£lf
.
_pošt
, s–f.
ÿÎabË
)

57 
toŞs
.
num”ify
 = 
	`NumToŞ
('before_finalize',‚umerify)

60 
şass
 
Nad§tToŞ
:

62 
def
 
	$__š™__
(
£lf
):

63 
£lf
.
’ded
 = {
	}
}

64 
£lf
.
_Çme
 = "nadsat"

66 
def
 
	$Çd§t
(
£lf
):

67 
def
 
	$Çd§t_™_up
(
body
):

68 
chunk
 
š
 
body
:

69 
chunk
 = chunk.
	`»¶aû
(
	`Áob
("good"),‚tob("horrorshow"))

70 
chunk
 = chunk.
	`»¶aû
(
	`Áob
("piece"),‚tob("lomtick"))

71 
y›ld
 
chunk


72 
ch”rypy
.
»¥Ú£
.
body
 = 
	$Çd§t_™_up
(
ch”rypy
.
»¥Ú£
.
body
)

73 
Çd§t
.
´iÜ™y
 = 0

75 
def
 
	$ş—nup
(
£lf
):

76 #Thi 
runs
 
aá”
 
the
 
»que¡
 
has
 
b“n
 
com¶‘–y
 
wr™‹n
 
out
.

77 
ch”rypy
.
»¥Ú£
.
body
 = [
	`Áob
("razdrez")]

78 
id
 = 
ch”rypy
.
»que¡
.
·¿ms
.
	`g‘
("id")

79 
id
:

80 
£lf
.
’ded
[
id
] = 
True


81 
ş—nup
.
ç§ã
 = 
True


83 
def
 
	$_£tup
(
£lf
):

84 
ch”rypy
.
»que¡
.
hooks
.
	`©ch
('befÜe_fš®ize', 
£lf
.
Çd§t
)

85 
ch”rypy
.
»que¡
.
hooks
.
	`©ch
('Ú_’d_»que¡', 
£lf
.
ş—nup
)

86 
toŞs
.
Çd§t
 = 
	$Nad§tToŞ
()

88 
def
 
	$pe_body
():

89 
ch”rypy
.
»que¡
.
´oûss_»que¡_body
 = 
F®£


90 
ş’
 = (
ch”rypy
.
»que¡
.
h—d”s
['Content-Length'])

91 
ch”rypy
.
»que¡
.
body
 = ch”rypy.»que¡.
rfe
.
	$»ad
(
ş’
)

93 #As£¹ 
th©
 
we
 
ÿn
 
u£
 
a
 
ÿÎabË
 
objeù
 
š¡—d
 
of
‡ 
funùiÚ
.

94 
şass
 
	$RÙ©Ü
(
objeù
):

95 
def
 
	$__ÿÎ__
(
£lf
, 
sÿË
):

96 
r
 = 
ch”rypy
.
»¥Ú£


97 
r
.
	$cŞÏp£_body
()

98 
py3k
:

99 
r
.
body
 = [
	`by‹s
([(
x
 + 
sÿË
è% 256 x 
š
„.body[0]])]

101 
r
.
body
 = [
	`chr
((
	`Üd
(
x
è+ 
sÿË
è% 256èx 
š
„.body[0]]

102 
ch”rypy
.
toŞs
.
rÙ©Ü
 = ch”rypy.
	`ToŞ
('befÜe_fš®ize', 
	$RÙ©Ü
())

104 
def
 
	$¡»am_hªdËr
(
Ãxt_hªdËr
, *
¬gs
, **
kw¬gs
):

105 
ch”rypy
.
»¥Ú£
.
ouut
 = 
o
 = 
	$By‹sIO
()

106 
Œy
:

107 
»¥Ú£
 = 
	$Ãxt_hªdËr
(*
¬gs
, **
kw¬gs
)

108 #IgnÜ
the
 
»¥Ú£
 
ªd
  
our
 
accumuÏ‹d
 
ouut
 
š¡—d
.

109  
o
.
	$g‘v®ue
()

110 
fš®ly
:

111 
o
.
	$şo£
()

112 
ch”rypy
.
toŞs
.
¡»am”
 = ch”rypy.
_ıtoŞs
.
	$HªdËrW¿µ”ToŞ
(
¡»am_hªdËr
)

114 
şass
 
RoÙ
:

115 
def
 
	$šdex
(
£lf
):

117 
šdex
.
expo£d
 = 
True


119 
def
 
	$rfe
(
£lf
):

120 
ch”rypy
.
»¥Ú£
.
ouut
.
	`wr™e
(
	`Áob
('I‡m '))

121 
ch”rypy
.
»¥Ú£
.
ouut
.
	`wr™e
(
	`Áob
('aarfile'))

122 
rfe
.
expo£d
 = 
True


123 
rfe
.
_ı_cÚfig
 = {'toŞs.¡»am”.Ú': 
True
}

125 
def
 
	$euro
(
£lf
):

126 
hooks
 = 
	`li¡
(
ch”rypy
.
»que¡
.hooks['before_finalize'])

127 
hooks
.
	$sÜt
()

128 
cbÇmes
 = [
x
.
ÿÎback
.
__Çme__
 x 
š
 
hooks
]

129 
as£¹
 
cbÇmes
 == ['gzip'], cbnames

130 
´iÜ™›s
 = [
x
.
´iÜ™y
 x 
š
 
hooks
]

131 
as£¹
 
´iÜ™›s
 == [80],…riorities

132 
y›ld
 
	`Áou
("Hello,")

133 
y›ld
 
	`Áou
("world")

134 
y›ld
 
eurİoundUnicode


135 
euro
.
expo£d
 = 
True


137 #B¬
hooks


138 
def
 
	$pe
(
£lf
):

139  
ch”rypy
.
»que¡
.
body


140 
pe
.
expo£d
 = 
True


141 
pe
.
_ı_cÚfig
 = {'hooks.befÜe_»que¡_body': 
pe_body
}

143 #MuÉË 
decÜ©Üs
; 
šşude
 
kw¬gs
 
ju¡
 
fun
.

144 #NÙ
th©
 
rÙ©Ü
 
mu¡
 
run
 
befÜe
 
gz
.

145 
def
 
	$decÜ©ed_euro
(
£lf
, *
v·th
):

146 
y›ld
 
	`Áou
("Hello,")

147 
y›ld
 
	`Áou
("world")

148 
y›ld
 
eurİoundUnicode


149 
decÜ©ed_euro
.
expo£d
 = 
True


150 
decÜ©ed_euro
 = 
toŞs
.
	$gz
(
com´ess_Ëv–
=6)(
decÜ©ed_euro
)

151 
decÜ©ed_euro
 = 
toŞs
.
	$rÙ©Ü
(
sÿË
=3)(
decÜ©ed_euro
)

153 
roÙ
 = 
	$RoÙ
()

155 
şass
 
	$Te¡Ty³
(
ty³
):

157 
ªd
 
adds
 
ª
 
š¡ªû
 
of
 
the
 
subşass
 
as
‡À
©Œibu‹
 oà
roÙ
.

159 
def
 
	$__š™__
(
şs
, 
Çme
, 
ba£s
, 
dù
):

160 
ty³
.
	$__š™__
(
şs
, 
Çme
, 
ba£s
, 
dù
)

161 
v®ue
 
š
 
	$™”v®ues
(
dù
):

162 
	$isš¡ªû
(
v®ue
, 
ty³s
.
FunùiÚTy³
):

163 
v®ue
.
expo£d
 = 
True


164 
	`£‰r
(
roÙ
, 
Çme
.
	`low”
(), 
	$şs
())

165 
Te¡
 = 
	`Te¡Ty³
('Te¡', (
objeù
,), {
	}
})

167 #METHOD 
ONE
:

168 #Deş¬
ToŞs
 
š
 
_ı_cÚfig


169 
şass
 
	$Demo
(
Te¡
):

171 
_ı_cÚfig
 = {"toŞs.Çd§t.Ú": 
True
}

173 
def
 
	$šdex
(
£lf
, 
id
=
NÚe
):

176 
def
 
	$’ded
(
£lf
, 
id
):

177  
	$»´
(
toŞs
.
Çd§t
.
’ded
[
id
])

179 
def
 
	$”r
(
£lf
, 
id
=
NÚe
):

180 
¿i£
 
	$V®ueE¼Ü
()

182 
def
 
	$”rš¡»am
(
£lf
, 
id
=
NÚe
):

183 
y›ld
 "nonconfidential"

184 
¿i£
 
	$V®ueE¼Ü
()

185 
y›ld
 "confidential"

187 #METHOD 
TWO
: 
decÜ©Ü
 
usšg
 
	`ToŞ
()

188 #W
suµÜt
 
PythÚ
 2.3, 
but
 
the
 @-
deco
 
syÁax
 
would
 
look
 
like
 
this
:

189 #@
toŞs
.
	`check_acûss
()

190 
def
 
	$»¡riùed
(
£lf
):

192 
»¡riùed
 = 
myauthtoŞs
.
	$check_acûss
()(
»¡riùed
)

193 
u£rid
 = 
»¡riùed


195 
def
 
	$”r_š_Ú¡¬t
(
£lf
):

198 
def
 
	$¡»am
(
£lf
, 
id
=
NÚe
):

199 
x
 
š
 
	$x¿nge
(100000000):

200 
y›ld
 
	$¡r
(
x
)

201 
¡»am
.
_ı_cÚfig
 = {'»¥Ú£.¡»am': 
True
}

204 
cÚf
 = {

205 #METHOD 
THREE
:

206 #Deş¬
ToŞs
 
š
 
d‘ached
 
cÚfig


208 'toŞs.num”ify.Ú': 
True
,

209 'toŞs.num”ify.m­': {
Áob
("pie"):‚tob("3.14159")},

212 '»que¡.show_Œaûbacks': 
F®£
,

215 '»que¡.show_Œaûbacks': 
F®£
,

216 'myauth.check_acûss.deçuÉ': 
True
,

219 '»¥Ú£.¡»am': 
True
,

222 #Beÿu£ 
this
 
i¢
't‡ dict, on_start_resource willƒrror.

225 #Combšed 
toŞs


227 'toŞs.gz.Ú': 
True
,

228 'toŞs.’code.Ú': 
True
,

230 #PriÜ™y 
¥ecif›d
 
š
 
cÚfig


234 #HªdË¸
w¿µ”s


235 '/rfe': {'toŞs.¡»am”.Ú': 
True
}

237 
­p
 = 
ch”rypy
.
Œ“
.
	$mouÁ
(
roÙ
, 
cÚfig
=
cÚf
)

238 
­p
.
»que¡_şass
.
Çme¥aûs
['myauth'] = 
myauthtoŞs


240 
sys
.
v”siÚ_šfo
 >= (2, 5):

241 
äom
 
ch”rypy
.
‹¡
 
impÜt
 
_‹¡_decÜ©Üs


242 
roÙ
.
toŞdecs
 = 
_‹¡_decÜ©Üs
.
	$ToŞExam¶es
()

243 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

245 
def
 
	$‹¡HookE¼Üs
(
£lf
):

246 
£lf
.
	`g‘Page
("/demo/?id=1")

247 #Ià
body
 
is
 "¿zd»z", 
th’
 
Ú_’d_»que¡
 i 
bešg
 
ÿÎed
 
too
 
—¾y
.

248 
£lf
.
	`as£¹Body
("A horrorshow†omtick of cherry 3.14159")

249 #Ià
this
 
çs
, 
th’
 
Ú_’d_»que¡
 
i¢
't being called‡t‡ll.

250 
time
.
	$¦“p
(0.1)

251 
£lf
.
	`g‘Page
("/demo/ended/1")

252 
£lf
.
	`as£¹Body
("True")

254 
v®”r
 = '\n„aise ValueError()\nValueError'

255 
£lf
.
	`g‘Page
("/demo/err?id=3")

256 #Ià
body
 
is
 "¿zd»z", 
th’
 
Ú_’d_»que¡
 i 
bešg
 
ÿÎed
 
too
 
—¾y
.

257 
£lf
.
	$as£¹E¼ÜPage
(502, 
·‰”n
=
v®”r
)

258 #Ià
this
 
çs
, 
th’
 
Ú_’d_»que¡
 
i¢
't being called‡t‡ll.

259 
time
.
	$¦“p
(0.1)

260 
£lf
.
	`g‘Page
("/demo/ended/3")

261 
£lf
.
	`as£¹Body
("True")

263 #Ià
body
 
is
 "¿zd»z", 
th’
 
Ú_’d_»que¡
 i 
bešg
 
ÿÎed
 
too
 
—¾y
.

264 ià(
ch”rypy
.
£rv”
.
´ÙocŞ_v”siÚ
 =ğ"HTTP/1.0" 
Ü


265 
	`g‘©Œ
(
ch”rypy
.
£rv”
, "usšg_­ache", 
F®£
)):

266 
£lf
.
	`g‘Page
("/demo/errinstream?id=5")

267 #Beÿu£ 
this
 
”rÜ
 
is
 
¿i£d
 
aá”
 
the
 
»¥Ú£
 
body
 
has


268 #¡¬‹d, 
the
 
¡©us
 
should
 
nÙ
 
chªge
 
to
 
ª
 
”rÜ
 status.

269 
£lf
.
	`as£¹Stus
("200 OK")

270 
£lf
.
	`as£¹Body
("nonconfidential")

272 #Beÿu£ 
this
 
”rÜ
 
is
 
¿i£d
 
aá”
 
the
 
»¥Ú£
 
body
 
has


273 #¡¬‹d, 
ªd
 
beÿu£
 
™
's chunked output,‡nƒrror is„aised by

274 #th
HTTP
 
ş›Á
 
wh’
 
™
 
’couÁ”s
 
šcom¶‘e
 
ouut
.

275 
£lf
.
	`as£¹Rai£s
((
V®ueE¼Ü
, 
Incom¶‘eR—d
), s–f.
g‘Page
,

277 #Ià
this
 
çs
, 
th’
 
Ú_’d_»que¡
 
i¢
't being called‡t‡ll.

278 
time
.
	$¦“p
(0.1)

279 
£lf
.
	`g‘Page
("/demo/ended/5")

280 
£lf
.
	`as£¹Body
("True")

282 #Te¡ 
the
 "__ÿÎ__" 
	`‹chnique
 (
compe
-
time
 
decÜ©Ü
).

283 
£lf
.
	`g‘Page
("/demo/restricted")

284 
£lf
.
	$as£¹E¼ÜPage
(401)

286 #Te¡ 
compe
-
time
 
decÜ©Ü
 
w™h
 
kw¬gs
 
äom
 
cÚfig
.

287 
£lf
.
	`g‘Page
("/demo/userid")

288 
£lf
.
	`as£¹Body
("Welcome!")

290 
def
 
	$‹¡EndReque¡OnDrİ
(
£lf
):

291 
Şd_timeout
 = 
NÚe


292 
Œy
:

293 
h‰p£rv”
 = 
ch”rypy
.
£rv”
.httpserver

294 
Şd_timeout
 = 
h‰p£rv”
.
timeout


295 
	$exû±
 (
A‰ribu‹E¼Ü
, 
IndexE¼Ü
):

296  
£lf
.
	$sk
()

298 
Œy
:

299 
h‰p£rv”
.
timeout
 =imeout

301 #Te¡ 
th©
 
Ú_’d_»que¡
 
is
 
ÿÎed
 
ev’
 
the
 
ş›Á
 
drİs
.

302 
£lf
.
³rsi¡’t
 = 
True


303 
Œy
:

304 
cÚn
 = 
£lf
.
HTTP_CONN


305 
cÚn
.
	`puŒeque¡
("GET", "/demo/¡»am?id=9", 
sk_ho¡
=
True
)

306 
cÚn
.
	`puth—d”
("Ho¡", 
£lf
.
HOST
)

307 
cÚn
.
	$’dh—d”s
()

308 #Sk 
the
 
»¡
 
of
h
»que¡
 
ªd
 
şo£
h
cÚn
. 
This
 
wl


309 #ÿu£ 
the
 
£rv”
's‡ctive socketoƒrror, which *should*

310 #»suÉ 
š
 
the
 
»que¡
 
bešg
 
abÜ‹d
, 
ªd
„eque¡.
şo£
 being

311 #ÿÎed 
®l
 
the
 
way
 
up
h
	`¡ack
 (
šşudšg
 
WSGI
 
middËw¬e
),

312 #ev’tu®ly 
ÿÎšg
 
our
 
Ú_’d_»que¡
 
hook
.

313 
fš®ly
:

314 
£lf
.
³rsi¡’t
 = 
F®£


315 
time
.
	$¦“p
(
timeout
 * 2)

316 #Te¡ 
th©
 
the
 
Ú_’d_»que¡
 
hook
 
was
 
ÿÎed
.

317 
£lf
.
	`g‘Page
("/demo/ended/9")

318 
£lf
.
	`as£¹Body
("True")

319 
fš®ly
:

320 
Şd_timeout
 
is
 
nÙ
 
NÚe
:

321 
h‰p£rv”
.
timeout
 = 
Şd_timeout


323 
def
 
	$‹¡Gu¬ª‹edHooks
(
£lf
):

324 #Th'ü™iÿl' 
Ú_¡¬t_»sourû
 
hook
 
is
 'ç§ã' (
gu¬ª‹ed


325 #tØ
run
 
ev’
 
th”e
 
¬e
 
çu»s
 
š
 
Ùh”
 
Ú_¡¬t
 
m‘hods
).

326 #Thi 
is
 
NOT
 
Œue
 
of
 
the
 
Ùh”
 
hooks
.

327 #H”e, 
we
 
have
 
£t
 
up
 
a
 
çu»
 
š
 
Num”ifyToŞ
.
num”ify_m­
,

328 #buˆ
our
 'ü™iÿl' 
hook
 
should
 
run
 
ªd
 
£t
 
the
 
”rÜ
 
to
 502.

329 
£lf
.
	`g‘Page
("/demo/err_in_onstart")

330 
£lf
.
	$as£¹E¼ÜPage
(502)

331 
£lf
.
	`as£¹InBody
("AttributeError: 'str' object has‚o‡ttribute 'items'")

333 
def
 
	$‹¡CombšedToŞs
(
£lf
):

334 
ex³ùedResuÉ
 = (
	`Áou
("H–lo,wÜld"è+ 
eurİoundUnicode
).
	`’code
('utf-8')

335 
zbuf
 = 
	$By‹sIO
()

336 
zfe
 = 
gz
.
	`GzFe
(
mode
='wb', 
feobj
=
zbuf
, 
com´es¦ev–
=9)

337 
zfe
.
	$wr™e
(
ex³ùedResuÉ
)

338 
zfe
.
	$şo£
()

340 
£lf
.
	`g‘Page
("/euro", 
h—d”s
=[("Accept-Encoding", "gzip"),

342 
£lf
.
	`as£¹InBody
(
zbuf
.
	`g‘v®ue
()[:3])

344 
zbuf
 = 
	$By‹sIO
()

345 
zfe
 = 
gz
.
	`GzFe
(
mode
='wb', 
feobj
=
zbuf
, 
com´es¦ev–
=6)

346 
zfe
.
	$wr™e
(
ex³ùedResuÉ
)

347 
zfe
.
	$şo£
()

349 
£lf
.
	`g‘Page
("/decÜ©ed_euro", 
h—d”s
=[("Accept-Encoding", "gzip")])

350 
£lf
.
	`as£¹InBody
(
zbuf
.
	`g‘v®ue
()[:3])

352 #Thi 
»tuºs
 
a
 
difã»Á
 
v®ue
 
beÿu£
 
gz
's…riority was

353 #low”ed 
š
 
cÚf
, 
®lowšg
 
the
 
rÙ©Ü
 
to
 
run
 
aá”
 
gz
.

354 #Oà
cour£
, 
we
 
dÚ
't want breakage in…roduction‡pps,

355 #buˆ
™
 
´oves
 
the
 
´iÜ™y
 
was
 
chªged
.

356 
£lf
.
	`g‘Page
("/decorated_euro/subpath",

357 
h—d”s
=[("Accept-Encoding", "gzip")])

358 
py3k
:

359 
£lf
.
	`as£¹InBody
(
	`by‹s
([(
x
 + 3è% 256 x 
š
 
zbuf
.
	`g‘v®ue
()]))

361 
£lf
.
	`as£¹InBody
(''.
	`još
([
	`chr
((
	`Üd
(
x
è+ 3è% 256èx 
š
 
zbuf
.
	`g‘v®ue
()]))

363 
def
 
	$‹¡B¬eHooks
(
£lf
):

364 
cÚ‹Á
 = "bit of‡…ain in me gulliver"

365 
£lf
.
	`g‘Page
("/pipe",

366 
h—d”s
=[("CÚ‹Á-L’gth", 
	`¡r
(
	`Ën
(
cÚ‹Á
))),

368 
m‘hod
="POST", 
body
=
cÚ‹Á
)

369 
£lf
.
	$as£¹Body
(
cÚ‹Á
)

371 
def
 
	$‹¡HªdËrW¿µ”ToŞ
(
£lf
):

372 
£lf
.
	`g‘Page
("/tarfile")

373 
£lf
.
	`as£¹Body
("I‡m‡arfile")

375 
def
 
	$‹¡ToŞW™hCÚfig
(
£lf
):

376 
nÙ
 
sys
.
v”siÚ_šfo
 >= (2, 5):

377  
£lf
.
	`sk
("skipped (Python 2.5+ only)")

379 
£lf
.
	`g‘Page
('/tooldecs/blah')

380 
£lf
.
	`as£¹H—d”
('Content-Type', 'application/data')

382 
def
 
	$‹¡W¬nToŞOn
(
£lf
):

384 
Œy
:

385 
ch”rypy
.
toŞs
.
num”ify
.
Ú


386 
exû±
 
A‰ribu‹E¼Ü
:

387 
·ss


389 
¿i£
 
	`As£¹iÚE¼Ü
("Tool.on did‚otƒrror‡s it should have.")

392 
Œy
:

393 
ch”rypy
.
toŞs
.
num”ify
.
Ú
 = 
True


394 
exû±
 
A‰ribu‹E¼Ü
:

395 
·ss


397 
¿i£
 
	`As£¹iÚE¼Ü
("Tool.on did‚otƒrror‡s it should have.")

399 
şass
 
	$SessiÚAuthTe¡
(
un™‹¡
.
Te¡Ca£
):

400 
def
 
	$‹¡_logš_sü“n_»tuºs_by‹s
(
£lf
):

402 
logš_sü“n
 
mu¡
  
by‹s
 
ev’
 
unicode
 
·¿m‘”s
 
¬e
 
·s£d
.

403 
Issue
 1132 
»v—Ëd
 
th©
 
logš_sü“n
 
would
  
unicode
 
the


404 
u£ºame
 
ªd
 
·sswÜd
 
w”e
 
unicode
.

406 
§
 = 
ch”rypy
.
lib
.
ıtoŞs
.
	$SessiÚAuth
()

407 
»s
 = 
§
.
	`logš_sü“n
(
NÚe
, 
u£ºame
=
	`unicode¡r
('nobody'),

408 
·sswÜd
=
	`unicode¡r
('anypass'))

409 
£lf
.
	`as£¹IsIn¡ªû
(
»s
, 
by‹¡r
)

	@trunk/objs/CherryPy-3.2.4/cherrypy/test/test_tutorials.py

1 
impÜt
 
sys


3 
impÜt
 
ch”rypy


4 
äom
 
	gch”rypy
.
‹¡
 
impÜt
 
h–³r


7 
şass
 
	$TutÜŸlTe¡
(
h–³r
.
CPWebCa£
):

9 
def
 
	$£tup_£rv”
(
şs
):

11 
cÚf
 = 
ch”rypy
.
cÚfig
.
	$cİy
()

13 
def
 
	$lßd_tut_moduË
(
Çme
):

15 
ch”rypy
.
cÚfig
.
	$»£t
()

16 
ch”rypy
.
cÚfig
.
	$upd©e
(
cÚf
)

18 
rg‘
 = "ch”rypy.tutÜŸl." + 
Çme


19 
rg‘
 
š
 
sys
.
moduËs
:

20 
moduË
 = 
	$»lßd
(
sys
.
moduËs
[
rg‘
])

22 
moduË
 = 
	`__impÜt__
(
rg‘
, 
	`glob®s
(), 
	`loÿls
(), [''])

23 #Th
above
 
impÜt
 
wl
 
´obably
 
mouÁ
 
a
 
Ãw
 
­p
 
©
 "".

24 
­p
 = 
ch”rypy
.
Œ“
.
­ps
[""]

26 
­p
.
roÙ
.
lßd_tut_moduË
 =†oad_tut_module

27 
­p
.
roÙ
.
£ssiÚs
 = sessions

28 
­p
.
roÙ
.
Œaûback_£‰šg
 =raceback_setting

30 
şs
.
su³rvisÜ
.
	$sync_­ps
()

31 
lßd_tut_moduË
.
expo£d
 = 
True


33 
def
 
	$£ssiÚs
():

34 
ch”rypy
.
cÚfig
.
	`upd©e
({"toŞs.£ssiÚs.Ú": 
True
})

35 
£ssiÚs
.
expo£d
 = 
True


37 
def
 
	$Œaûback_£‰šg
():

38  
	$»´
(
ch”rypy
.
»que¡
.
show_Œaûbacks
)

39 
Œaûback_£‰šg
.
expo£d
 = 
True


41 
şass
 
Dummy
:

42 
·ss


43 
roÙ
 = 
	$Dummy
()

44 
roÙ
.
lßd_tut_moduË
 =†oad_tut_module

45 
ch”rypy
.
Œ“
.
	$mouÁ
(
roÙ
)

46 
£tup_£rv”
 = 
	$şassm‘hod
(
£tup_£rv”
)

49 
def
 
	$‹¡01H–loWÜld
(
£lf
):

50 
£lf
.
	`g‘Page
("/load_tut_module/tut01_helloworld")

51 
£lf
.
	`g‘Page
("/")

52 
£lf
.
	`as£¹Body
('Hello world!')

54 
def
 
	$‹¡02Expo£M‘hods
(
£lf
):

55 
£lf
.
	`g‘Page
("/load_tut_module/tut02_expose_methods")

56 
£lf
.
	`g‘Page
("/showMessage")

57 
£lf
.
	`as£¹Body
('Hello world!')

59 
def
 
	$‹¡03G‘AndPo¡
(
£lf
):

60 
£lf
.
	`g‘Page
("/load_tut_module/tut03_get_and_post")

62 #Try 
difã»Á
 
GET
 
qu”›s


63 
£lf
.
	`g‘Page
("/greetUser?name=Bob")

64 
£lf
.
	`as£¹Body
("Hey Bob, what's up?")

66 
£lf
.
	`g‘Page
("/greetUser")

67 
£lf
.
	`as£¹Body
('Pleaseƒnter your‚ame <a href="./">here</a>.')

69 
£lf
.
	`g‘Page
("/greetUser?name=")

70 
£lf
.
	`as£¹Body
('No,„eally,ƒnter your‚ame <a href="./">here</a>.')

72 #Try 
the
 
§me
 
w™h
 
POST


73 
£lf
.
	`g‘Page
("/g»‘U£r", 
m‘hod
="POST", 
body
="name=Bob")

74 
£lf
.
	`as£¹Body
("Hey Bob, what's up?")

76 
£lf
.
	`g‘Page
("/g»‘U£r", 
m‘hod
="POST", 
body
="name=")

77 
£lf
.
	`as£¹Body
('No,„eally,ƒnter your‚ame <a href="./">here</a>.')

79 
def
 
	$‹¡04Com¶exS™e
(
£lf
):

80 
£lf
.
	`g‘Page
("/load_tut_module/tut04_complex_site")

81 
msg
 = '''

82 <
p
>
H”e
 
¬e
 
some
 
exŒa
 
u£ful
 
lšks
:</p>

84 <
ul
>

85 <
li
><
a
 
h»f
="h‰p://d–.icio.us">
d–
.
icio
.
us
</a></li>

86 <
li
><
a
 
h»f
="h‰p://www.mÜnog¿phy.de">
H’drik
's weblog</a></li>

87 </
ul
>

89 <
p
>[<
a
 
h»f
="../">
R‘uº
 
to
 
lšks
 
·ge
</a>]</p>'''

90 
£lf
.
	`g‘Page
("/links/extra/")

91 
£lf
.
	$as£¹Body
(
msg
)

93 
def
 
	$‹¡05D”ivedObjeùs
(
£lf
):

94 
£lf
.
	`g‘Page
("/load_tut_module/tut05_derived_objects")

95 
msg
 = '''

96 <
html
>

97 <
h—d
>

98 <
t™Ë
>
AnÙh”
 
Page
</title>

99 <
h—d
>

100 <
body
>

101 <
h2
>
AnÙh”
 
Page
</h2>

103 <
p
>

104 
And
 
this
 
is
 
the
 
amazšg
 
£cÚd
 
·ge
!

105 </
p
>

107 </
body
>

108 </
html
>

110 #th
tutÜŸl
 
has
 
some
 
ªnoyšg
 
¥aûs
 
š
 
Ùh”wi£
 
bÏnk
 
lšes


111 
msg
 = msg.
	`»¶aû
('</h2>\n\n', '</h2>\n \n')

112 
msg
 = msg.
	`»¶aû
('</p>\n\n', '</p>\n \n')

113 
£lf
.
	`g‘Page
("/another/")

114 
£lf
.
	$as£¹Body
(
msg
)

116 
def
 
	$‹¡06DeçuÉM‘hod
(
£lf
):

117 
£lf
.
	`g‘Page
("/load_tut_module/tut06_default_method")

118 
£lf
.
	`g‘Page
('/hendrik')

119 
£lf
.
	`as£¹Body
('Hendrik Mans, CherryPy co-developer & crazy German '

122 
def
 
	$‹¡07SessiÚs
(
£lf
):

123 
£lf
.
	`g‘Page
("/load_tut_module/tut07_sessions")

124 
£lf
.
	`g‘Page
("/sessions")

126 
£lf
.
	`g‘Page
('/')

127 
£lf
.
	`as£¹Body
("\n During your current session, you've viewedhis"

131 
£lf
.
	`g‘Page
('/', s–f.
cook›s
)

132 
£lf
.
	`as£¹Body
("\n During your current session, you've viewedhis"

136 
def
 
	$‹¡08G’”©ÜsAndY›ld
(
£lf
):

137 
£lf
.
	`g‘Page
("/load_tut_module/tut08_generators_and_yield")

138 
£lf
.
	`g‘Page
('/')

139 
£lf
.
	`as£¹Body
('<html><body><h2>Generators„ule!</h2>'

144 
def
 
	$‹¡09Fes
(
£lf
):

145 
£lf
.
	`g‘Page
("/load_tut_module/tut09_files")

147 #Te¡ 
u¶ßd


148 
fesize
 = 5

149 
h
 = [("Content-type", "multipart/form-data; boundary=x"),

150 ("CÚ‹Á-L’gth", 
	`¡r
(105 + 
fesize
))]

151 
b
 = '--x\n' + \

155 'a' * 
fesize
 + '\n' + \

157 
£lf
.
	`g‘Page
('/u¶ßd', 
h
, "POST", 
b
)

158 
£lf
.
	`as£¹Body
('''<html>

159 <
body
>

160 
myFe
 
Ëngth
: %
d
<
br
 />

161 
myFe
 
f’ame
: 
h–lo
.
txt
<
br
 />

162 
myFe
 
mime
-
ty³
: 
‹xt
/
¶aš


163 </
body
>

164 </
html
>''' % filesize)

166 #Te¡ 
dowÆßd


167 
£lf
.
	`g‘Page
('/download')

168 
£lf
.
	`as£¹Stus
("200 OK")

169 
£lf
.
	`as£¹H—d”
("Content-Type", "application/x-download")

170 
£lf
.
	`as£¹H—d”
("Content-Disposition",

171 #Mak
su»
 
the
 
f’ame
 
is
 
quÙed
.

173 
£lf
.
	`as£¹Equ®
(
	`Ën
(£lf.
body
), 85698)

175 
def
 
	$‹¡10HTTPE¼Üs
(
£lf
):

176 
£lf
.
	`g‘Page
("/load_tut_module/tut10_http_errors")

178 
£lf
.
	`g‘Page
("/")

179 
£lf
.
	`as£¹InBody
("""<¨h»f="
toggËT¿ûbacks
">""")

180 
£lf
.
	`as£¹InBody
("""<¨h»f="/
dÛsNÙExi¡
">""")

181 
£lf
.
	`as£¹InBody
("""<¨h»f="/
”rÜ
?
code
=403">""")

182 
£lf
.
	`as£¹InBody
("""<¨h»f="/
”rÜ
?
code
=500">""")

183 
£lf
.
	`as£¹InBody
("""<¨h»f="/
mes§geArg
">""")

185 
£lf
.
	`g‘Page
("/traceback_setting")

186 
£‰šg
 = 
£lf
.
body


187 
£lf
.
	`g‘Page
("/toggleTracebacks")

188 
£lf
.
	`as£¹Stus
((302, 303))

189 
£lf
.
	`g‘Page
("/traceback_setting")

190 
£lf
.
	`as£¹Body
(
	`¡r
(
nÙ
 
	$ev®
(
£‰šg
)))

192 
£lf
.
	`g‘Page
("/error?code=500")

193 
£lf
.
	$as£¹Stus
(500)

194 
£lf
.
	`as£¹InBody
("The serverƒncountered‡n unexpected condition "

197 
£lf
.
	`g‘Page
("/error?code=403")

198 
£lf
.
	$as£¹Stus
(403)

199 
£lf
.
	`as£¹InBody
("<h2>You can't dohat!</h2>")

201 
£lf
.
	`g‘Page
("/messageArg")

202 
£lf
.
	$as£¹Stus
(500)

203 
£lf
.
	`as£¹InBody
("If you construct‡n HTTPError with‡ 'message'")

	@trunk/objs/CherryPy-3.2.4/cherrypy/test/test_virtualhost.py

1 
impÜt
 
os


2 
	gcurdœ
 = 
os
.
·th
.
još
(os.
g‘cwd
(), os.·th.
	$dœÇme
(
__fe__
))

4 
impÜt
 
ch”rypy


5 
äom
 
ch”rypy
.
‹¡
 
impÜt
 
h–³r


8 
şass
 
	$Vœtu®Ho¡Te¡
(
h–³r
.
CPWebCa£
):

10 
def
 
	$£tup_£rv”
():

11 
şass
 
RoÙ
:

12 
def
 
	$šdex
(
£lf
):

14 
šdex
.
expo£d
 = 
True


16 
def
 
	$dom4
(
£lf
):

18 
dom4
.
expo£d
 = 
True


20 
def
 
	$m‘hod
(
£lf
, 
v®ue
):

21  "You s’ˆ%s" % 
v®ue


22 
m‘hod
.
expo£d
 = 
True


24 
şass
 
VHo¡
:

25 
def
 
	$__š™__
(
£lf
, 
s™’ame
):

26 
£lf
.
s™’ame
 = sitename

28 
def
 
	$šdex
(
£lf
):

29  "W–comtØ%s" % 
£lf
.
s™’ame


30 
šdex
.
expo£d
 = 
True


32 
def
 
	$vm‘hod
(
£lf
, 
v®ue
):

33  "You s’ˆ%s" % 
v®ue


34 
vm‘hod
.
expo£d
 = 
True


36 
def
 
	$u¾
(
£lf
):

37  
ch”rypy
.
	`u¾
("nextpage")

38 
u¾
.
expo£d
 = 
True


40 #Te¡ 
as
 
a
 
	`hªdËr
 (
£ùiÚ
 
mu¡
 
NOT
 
šşude
 
vho¡
 
´efix
)

41 ğ
ch”rypy
.
toŞs
.
¡©icdœ
.
	`hªdËr
(
£ùiÚ
='/¡©ic', 
dœ
=
curdœ
)

43 
roÙ
 = 
	$RoÙ
()

44 
roÙ
.
mydom2
 = 
	`VHo¡
("Domain 2")

45 
roÙ
.
mydom3
 = 
	`VHo¡
("Domain 3")

46 
ho¡m­
 = {'www.mydom2.com': '/mydom2',

49 
	}
}

50 
ch”rypy
.
Œ“
.
mouÁ
(
roÙ
, 
cÚfig
={

51 '/': {'»que¡.di¥©ch': 
ch”rypy
.
di¥©ch
.
Vœtu®Ho¡
(**
ho¡m­
)},

52 #Te¡ 
š
 
cÚfig
 (
£ùiÚ
 
mu¡
 
šşude
 
vho¡
 
´efix
)

53 '/mydom2/¡©ic2': {'toŞs.¡©icdœ.Ú': 
True
,

54 'toŞs.¡©icdœ.roÙ': 
curdœ
,

59 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

61 
def
 
	$‹¡Vœtu®Ho¡
(
£lf
):

62 
£lf
.
	`g‘Page
("/", [('Host', 'www.mydom1.com')])

63 
£lf
.
	`as£¹Body
('Hello, world')

64 
£lf
.
	`g‘Page
("/mydom2/", [('Host', 'www.mydom1.com')])

65 
£lf
.
	`as£¹Body
('Welcomeo Domain 2')

67 
£lf
.
	`g‘Page
("/", [('Host', 'www.mydom2.com')])

68 
£lf
.
	`as£¹Body
('Welcomeo Domain 2')

69 
£lf
.
	`g‘Page
("/", [('Host', 'www.mydom3.com')])

70 
£lf
.
	`as£¹Body
('Welcomeo Domain 3')

71 
£lf
.
	`g‘Page
("/", [('Host', 'www.mydom4.com')])

72 
£lf
.
	`as£¹Body
('Under construction')

74 #Te¡ 
GET
, 
POST
, 
ªd
 
pos™iÚ®
 
·¿ms


75 
£lf
.
	`g‘Page
("/method?value=root")

76 
£lf
.
	`as£¹Body
("You sent„oot")

77 
£lf
.
	`g‘Page
("/vmethod?value=dom2+GET", [('Host', 'www.mydom2.com')])

78 
£lf
.
	`as£¹Body
("You sent dom2 GET")

79 
£lf
.
	`g‘Page
("/vm‘hod", [('Ho¡', 'www.mydom3.com')], 
m‘hod
="POST",

80 
body
="value=dom3+POST")

81 
£lf
.
	`as£¹Body
("You sent dom3 POST")

82 
£lf
.
	`g‘Page
("/vmethod/pos", [('Host', 'www.mydom3.com')])

83 
£lf
.
	`as£¹Body
("You sent…os")

85 #Te¡ 
th©
 
ch”rypy
.
u¾
 
u£s
 
the
 
brow£r
 u¾, 
nÙ
h
vœtu®
 url

86 
£lf
.
	`g‘Page
("/url", [('Host', 'www.mydom2.com')])

87 
£lf
.
	`as£¹Body
("%s://www.mydom2.com/Ãxage" % s–f.
scheme
)

89 
def
 
	$‹¡_VHo¡_¶us_Stic
(
£lf
):

90 #Te¡ 
as
 
a
 
hªdËr


91 
£lf
.
	`g‘Page
("/static/style.css", [('Host', 'www.mydom2.com')])

92 
£lf
.
	`as£¹Stus
('200 OK')

93 
£lf
.
	`as£¹H—d”
('Content-Type', 'text/css;charset=utf-8')

95 #Te¡ 
š
 
cÚfig


96 
£lf
.
	`g‘Page
("/static2/dirback.jpg", [('Host', 'www.mydom2.com')])

97 
£lf
.
	`as£¹Stus
('200 OK')

98 
£lf
.
	`as£¹H—d”In
('Content-Type', ['image/jpeg', 'image/pjpeg'])

100 #Te¡ 
cÚfig
 
w™h
 "šdex" 
¬g


101 
£lf
.
	`g‘Page
("/static2/", [('Host', 'www.mydom2.com')])

102 
£lf
.
	`as£¹Stus
('200 OK')

103 
£lf
.
	`as£¹Body
('Hello, world\r\n')

104 #Sšû 
toŞs
.
Œašg_¦ash
 
is
 
Ú
 
by
 , 
this
 
should
 
»dœeù


105 
£lf
.
	`g‘Page
("/static2", [('Host', 'www.mydom2.com')])

106 
£lf
.
	`as£¹Stus
(301)

	@trunk/objs/CherryPy-3.2.4/cherrypy/test/test_wsgi_ns.py

1 
impÜt
 
ch”rypy


2 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
Áob


3 
äom
 
	gch”rypy
.
‹¡
 
impÜt
 
h–³r


6 
şass
 
	$WSGI_Name¥aû_Te¡
(
h–³r
.
CPWebCa£
):

8 
def
 
	$£tup_£rv”
():

10 
şass
 
	$WSGIRe¥Ú£
(
objeù
):

12 
def
 
	$__š™__
(
£lf
, 
­´esuÉs
):

13 
£lf
.
­´esuÉs
 =‡ppresults

14 
£lf
.
™”
 = 
	$™”
(
­´esuÉs
)

16 
def
 
	$__™”__
(
£lf
):

17  
£lf


19 
def
 
	$Ãxt
(
£lf
):

20  
£lf
.
™”
.
	$Ãxt
()

21 
def
 
	$__Ãxt__
(
£lf
):

22  
	$Ãxt
(
£lf
.
™”
)

24 
def
 
	$şo£
(
£lf
):

25 
	`ha§‰r
(
£lf
.
­´esuÉs
, "close"):

26 
£lf
.
­´esuÉs
.
	$şo£
()

29 
şass
 
	$ChªgeCa£
(
objeù
):

31 
def
 
	$__š™__
(
£lf
, 
­p
, 
to
=
NÚe
):

32 
£lf
.
­p
 =‡pp

33 
£lf
.
to
 =o

35 
def
 
	$__ÿÎ__
(
£lf
, 
’vœÚ
, 
¡¬t_»¥Ú£
):

36 
»s
 = 
£lf
.
	$­p
(
’vœÚ
, 
¡¬t_»¥Ú£
)

37 
şass
 
	$Ca£ResuÉs
(
WSGIRe¥Ú£
):

38 
def
 
	$Ãxt
(
this
):

39  
	`g‘©Œ
(
this
.
™”
.
	`Ãxt
(), 
£lf
.
to
)()

40 
def
 
	$__Ãxt__
(
this
):

41  
	`g‘©Œ
(
	`Ãxt
(
this
.
™”
), 
£lf
.
to
)()

42  
	$Ca£ResuÉs
(
»s
)

44 
şass
 
	$R•Ïûr
(
objeù
):

46 
def
 
	`__š™__
(
£lf
, 
­p
, 
m­
={
	}
}):

47 
£lf
.
­p
 =‡pp

48 
£lf
.
m­
 = map

50 
def
 
	$__ÿÎ__
(
£lf
, 
’vœÚ
, 
¡¬t_»¥Ú£
):

51 
»s
 = 
£lf
.
	$­p
(
’vœÚ
, 
¡¬t_»¥Ú£
)

52 
şass
 
	$R•ÏûResuÉs
(
WSGIRe¥Ú£
):

53 
def
 
	$Ãxt
(
this
):

54 
lše
 = 
this
.
™”
.
	$Ãxt
()

55 
k
, 
v
 
š
 
£lf
.
m­
.
	$™”™ems
():

56 
lše
 =†še.
	$»¶aû
(
k
, 
v
)

57  
lše


58 
def
 
	$__Ãxt__
(
this
):

59 
lše
 = 
	$Ãxt
(
this
.
™”
)

60 
k
, 
v
 
š
 
£lf
.
m­
.
	$™ems
():

61 
lše
 =†še.
	$»¶aû
(
k
, 
v
)

62  
lše


63  
	$R•ÏûResuÉs
(
»s
)

65 
şass
 
	$RoÙ
(
objeù
):

67 
def
 
	$šdex
(
£lf
):

69 
šdex
.
expo£d
 = 
True


72 
roÙ_cÚf
 = {'wsgi.p–še': [('»¶aû', 
R•Ïûr
)],

73 'wsgi.»¶aû.m­': {
	`Áob
('L'):‚tob('X'),

74 
	`Áob
('l'):‚tob('r')},

75 
	}
}

77 
­p
 = 
ch”rypy
.
AµliÿtiÚ
(
	$RoÙ
())

78 
­p
.
wsgŸµ
.
p–še
.
	`­³nd
(('chªgeÿ£', 
ChªgeCa£
))

79 
­p
.
wsgŸµ
.
cÚfig
['chªgeÿ£'] = {'to': 'uµ”'
	}
}

80 
ch”rypy
.
Œ“
.
mouÁ
(
­p
, 
cÚfig
={'/': 
roÙ_cÚf
})

81 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

84 
def
 
	$‹¡_p–še
(
£lf
):

85 
nÙ
 
ch”rypy
.
£rv”
.
h‰p£rv”
:

86  
£lf
.
	$sk
()

88 
£lf
.
	`g‘Page
("/")

89 #Ià
body
 
is
 "HEXXO WORXD!", 
the
 
middËw¬e
 
was
 
­¶›d
 
out
 
of
 
Üd”
.

90 
£lf
.
	`as£¹Body
("HERRO WORRD!")

	@trunk/objs/CherryPy-3.2.4/cherrypy/test/test_wsgi_vhost.py

1 
impÜt
 
ch”rypy


2 
äom
 
	gch”rypy
.
‹¡
 
impÜt
 
h–³r


5 
şass
 
	$WSGI_Vœtu®Ho¡_Te¡
(
h–³r
.
CPWebCa£
):

7 
def
 
	$£tup_£rv”
():

9 
şass
 
	$CÏssOfRoÙ
(
objeù
):

11 
def
 
	$__š™__
(
£lf
, 
Çme
):

12 
£lf
.
Çme
 =‚ame

14 
def
 
	$šdex
(
£lf
):

15  "W–comtØth% webs™e!" % 
£lf
.
Çme


16 
šdex
.
expo£d
 = 
True


19  = 
ch”rypy
.
	$AµliÿtiÚ
(
NÚe
)

21 
domašs
 = {
	}
}

22 
y—r
 
š
 
	$¿nge
(1997, 2008):

23 
­p
 = 
ch”rypy
.
	`AµliÿtiÚ
(
	`CÏssOfRoÙ
('CÏs oà%s' % 
y—r
))

24 
domašs
['www.şassof%s.exam¶e' % 
y—r
] = 
­p


26 
ch”rypy
.
Œ“
.
	`g¿á
(ch”rypy.
_ıwsgi
.
	$Vœtu®Ho¡
(, 
domašs
))

27 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

29 
def
 
	$‹¡_w–come
(
£lf
):

30 
nÙ
 
ch”rypy
.
£rv”
.
usšg_wsgi
:

31  
£lf
.
	`sk
("skipped (not using WSGI)... ")

33 
y—r
 
š
 
	$¿nge
(1997, 2008):

34 
£lf
.
	`g‘Page
("/", 
h—d”s
=[('Ho¡', 'www.şassof%s.exam¶e' % 
y—r
)])

35 
£lf
.
	`as£¹Body
("W–comtØthCÏs oà% webs™e!" % 
y—r
)

	@trunk/objs/CherryPy-3.2.4/cherrypy/test/test_wsgiapps.py

1 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
Áob


2 
äom
 
	gch”rypy
.
‹¡
 
impÜt
 
h–³r


5 
şass
 
	$WSGIG¿áTe¡s
(
h–³r
.
CPWebCa£
):

7 
def
 
	$£tup_£rv”
():

8 
impÜt
 
os


9 
curdœ
 = 
os
.
·th
.
	`još
(os.
	`g‘cwd
(), os.·th.
	$dœÇme
(
__fe__
))

11 
impÜt
 
ch”rypy


13 
def
 
	$‹¡_­p
(
’vœÚ
, 
¡¬t_»¥Ú£
):

14 
¡©us
 = '200 OK'

15 
»¥Ú£_h—d”s
 = [('Content-type', 'text/plain')]

16 
	$¡¬t_»¥Ú£
(
¡©us
, 
»¥Ú£_h—d”s
)

17 
ouut
 = ['Hello, world!\n',

19 
keys
 = 
	`li¡
(
’vœÚ
.
	$keys
())

20 
keys
.
	$sÜt
()

21 
k
 
š
 
keys
:

22 
ouut
.
	`­³nd
('%s: %s\n' % (
k
,
’vœÚ
[k]))

23  [
	`Áob
(
x
, 'utf-8'èx 
š
 
ouut
]

25 
def
 
	$‹¡_em±y_¡ršg_­p
(
’vœÚ
, 
¡¬t_»¥Ú£
):

26 
¡©us
 = '200 OK'

27 
»¥Ú£_h—d”s
 = [('Content-type', 'text/plain')]

28 
	$¡¬t_»¥Ú£
(
¡©us
, 
»¥Ú£_h—d”s
)

29  [
	`Áob
('Hello'),‚tob(''),‚tob(' '),‚tob(''),‚tob('world')]

32 
şass
 
	$WSGIRe¥Ú£
(
objeù
):

34 
def
 
	$__š™__
(
£lf
, 
­´esuÉs
):

35 
£lf
.
­´esuÉs
 =‡ppresults

36 
£lf
.
™”
 = 
	$™”
(
­´esuÉs
)

38 
def
 
	$__™”__
(
£lf
):

39  
£lf


41 
def
 
	$Ãxt
(
£lf
):

42  
£lf
.
™”
.
	$Ãxt
()

43 
def
 
	$__Ãxt__
(
£lf
):

44  
	$Ãxt
(
£lf
.
™”
)

46 
def
 
	$şo£
(
£lf
):

47 
	`ha§‰r
(
£lf
.
­´esuÉs
, "close"):

48 
£lf
.
­´esuÉs
.
	$şo£
()

51 
şass
 
	$Rev”sšgMiddËw¬e
(
objeù
):

53 
def
 
	$__š™__
(
£lf
, 
­p
):

54 
£lf
.
­p
 =‡pp

56 
def
 
	$__ÿÎ__
(
£lf
, 
’vœÚ
, 
¡¬t_»¥Ú£
):

57 
»suÉs
 = 
	$­p
(
’vœÚ
, 
¡¬t_»¥Ú£
)

58 
şass
 
	$Rev”£r
(
WSGIRe¥Ú£
):

59 
def
 
	$Ãxt
(
this
):

60 
lše
 = 
	`li¡
(
this
.
™”
.
	$Ãxt
())

61 
lše
.
	$»v”£
()

62  "".
	$još
(
lše
)

63 
def
 
	$__Ãxt__
(
this
):

64 
lše
 = 
	`li¡
(
	$Ãxt
(
this
.
™”
))

65 
lše
.
	$»v”£
()

66  
	$by‹s
(
lše
)

67  
	$Rev”£r
(
»suÉs
)

69 
şass
 
RoÙ
:

70 
def
 
	$šdex
(
£lf
):

71  
	`Áob
("I'm‡„egular CherryPy…age handler!")

72 
šdex
.
expo£d
 = 
True


75 
ch”rypy
.
Œ“
.
	`mouÁ
(
	$RoÙ
())

77 
ch”rypy
.
Œ“
.
	`g¿á
(
‹¡_­p
, '/hosted/app1')

78 
ch”rypy
.
Œ“
.
	`g¿á
(
‹¡_em±y_¡ršg_­p
, '/hosted/app3')

80 #S‘ 
süt_Çme
 
ex¶ic™ly
 
to
 
NÚe
Ø
sigÇl
 
CP
 
th©
 
™
 
should


81 #b
puÎed
 
äom
 
the
 
WSGI
 
’vœÚ
 
—ch
 
time
.

82 
­p
 = 
ch”rypy
.
	`AµliÿtiÚ
(
	`RoÙ
(), 
süt_Çme
=
NÚe
)

83 
ch”rypy
.
Œ“
.
	`g¿á
(
	`Rev”sšgMiddËw¬e
(
­p
), '/hosted/app2')

84 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

86 
wsgi_ouut
 = '''Hello, world!

87 
This
 
is
 
a
 
wsgi
 
­p
 
ruÂšg
 
w™hš
 
Ch”ryPy
!'''

89 
def
 
	$‹¡_01_¡ªd¬d_­p
(
£lf
):

90 
£lf
.
	`g‘Page
("/")

91 
£lf
.
	`as£¹Body
("I'm‡„egular CherryPy…age handler!")

93 
def
 
	$‹¡_04_pu»_wsgi
(
£lf
):

94 
impÜt
 
ch”rypy


95 
nÙ
 
ch”rypy
.
£rv”
.
usšg_wsgi
:

96  
£lf
.
	`sk
("skipped (not using WSGI)... ")

97 
£lf
.
	`g‘Page
("/hosted/app1")

98 
£lf
.
	`as£¹H—d”
("Content-Type", "text/plain")

99 
£lf
.
	$as£¹InBody
(
£lf
.
wsgi_ouut
)

101 
def
 
	$‹¡_05_w¿µed_ı_­p
(
£lf
):

102 
impÜt
 
ch”rypy


103 
nÙ
 
ch”rypy
.
£rv”
.
usšg_wsgi
:

104  
£lf
.
	`sk
("skipped (not using WSGI)... ")

105 
£lf
.
	`g‘Page
("/hosted/app2/")

106 
body
 = 
	`li¡
("I'm‡„egular CherryPy…age handler!")

107 
body
.
	$»v”£
()

108 
body
 = "".
	$još
(
body
)

109 
£lf
.
	$as£¹InBody
(
body
)

111 
def
 
	$‹¡_06_em±y_¡ršg_­p
(
£lf
):

112 
impÜt
 
ch”rypy


113 
nÙ
 
ch”rypy
.
£rv”
.
usšg_wsgi
:

114  
£lf
.
	`sk
("skipped (not using WSGI)... ")

115 
£lf
.
	`g‘Page
("/hosted/app3")

116 
£lf
.
	`as£¹H—d”
("Content-Type", "text/plain")

117 
£lf
.
	`as£¹InBody
('Hello world')

	@trunk/objs/CherryPy-3.2.4/cherrypy/test/test_xmlrpc.py

1 
impÜt
 
sys


2 
äom
 
	gch”rypy
.
_ıcom·t
 
impÜt
 
py3k


4 
	gŒy
:

5 
äom
 
xmÌpşib
 
impÜt
 
D©eTime
, 
	gFauÉ
, 
	gPrÙocŞE¼Ü
, 
	gS”v”Proxy
, 
SaãT¿n¥Üt


6 
exû±
 
	gImpÜtE¼Ü
:

7 
äom
 
xmÌpc
.
ş›Á
 
impÜt
 
D©eTime
, 
	gFauÉ
, 
	gPrÙocŞE¼Ü
, 
	gS”v”Proxy
, 
SaãT¿n¥Üt


9 
	gpy3k
:

10 
HTTPST¿n¥Üt
 = 
SaãT¿n¥Üt


13 
impÜt
 
sock‘


14 
nÙ
 
ha§‰r
(
sock‘
, "ssl"):

15 
sock‘
.
s¦
 = 
True


17 
şass
 
	$HTTPST¿n¥Üt
(
SaãT¿n¥Üt
):

20 
def
 
	$»que¡
(
£lf
, 
ho¡
, 
hªdËr
, 
»que¡_body
, 
v”bo£
=0):

21 #issu
XML
-
RPC
 
»que¡


22 
h
 = 
£lf
.
	$make_cÚÃùiÚ
(
ho¡
)

23 
v”bo£
:

24 
h
.
	$£t_debugËv–
(1)

26 
£lf
.
	$£nd_»que¡
(
h
, 
hªdËr
, 
»que¡_body
)

27 
£lf
.
	$£nd_ho¡
(
h
, 
ho¡
)

28 
£lf
.
	$£nd_u£r_ag’t
(
h
)

29 
£lf
.
	$£nd_cÚ‹Á
(
h
, 
»que¡_body
)

31 
”rcode
, 
”rmsg
, 
h—d”s
 = 
h
.
	$g‘»¶y
()

32 
”rcode
 != 200:

33 
¿i£
 
	`PrÙocŞE¼Ü
(
ho¡
 + 
hªdËr
, 
”rcode
, 
”rmsg
, 
h—d”s
)

35 
£lf
.
v”bo£
 = verbose

39 #sock = 
h
.
_cÚn
.
sock


40 #exû± 
A‰ribu‹E¼Ü
:

41 #sock = 
NÚe


42 #»tuº 
£lf
.
	`_·r£_»¥Ú£
(
h
.
	`g‘fe
(), 
sock
)

44  
£lf
.
	`·r£_»¥Ú£
(
h
.
	$g‘fe
())

46 
impÜt
 
ch”rypy


49 
def
 
	$£tup_£rv”
():

50 
äom
 
ch”rypy
 
impÜt
 
_ıtoŞs


52 
şass
 
RoÙ
:

53 
def
 
	$šdex
(
£lf
):

55 
šdex
.
expo£d
 = 
True


58 
şass
 
	$XmlRpc
(
_ıtoŞs
.
XMLRPCCÚŒŞËr
):

60 
def
 
	$foo
(
£lf
):

62 
foo
.
expo£d
 = 
True


64 
def
 
	$»tuº_sšgË_™em_li¡
(
£lf
):

66 
»tuº_sšgË_™em_li¡
.
expo£d
 = 
True


68 
def
 
	$»tuº_¡ršg
(
£lf
):

70 
»tuº_¡ršg
.
expo£d
 = 
True


72 
def
 
	$»tuº_tu¶e
(
£lf
):

74 
»tuº_tu¶e
.
expo£d
 = 
True


76 
def
 
	$»tuº_diù
(
£lf
):

77  
	$diù
(
a
=1, 
b
=2, 
c
=3)

78 
»tuº_diù
.
expo£d
 = 
True


80 
def
 
	$»tuº_compos™e
(
£lf
):

81  
	`diù
(
a
=1,
z
=26), 'hi', ['welcome', 'friend']

82 
»tuº_compos™e
.
expo£d
 = 
True


84 
def
 
	$»tuº_št
(
£lf
):

86 
»tuº_št
.
expo£d
 = 
True


88 
def
 
	$»tuº_æßt
(
£lf
):

90 
»tuº_æßt
.
expo£d
 = 
True


92 
def
 
	$»tuº_d©‘ime
(
£lf
):

93  
	`D©eTime
((2003, 10, 7, 8, 1, 0, 1, 280, -1))

94 
»tuº_d©‘ime
.
expo£d
 = 
True


96 
def
 
	$»tuº_boŞ—n
(
£lf
):

97  
True


98 
»tuº_boŞ—n
.
expo£d
 = 
True


100 
def
 
	$‹¡_¬gum’t_·ssšg
(
£lf
, 
num
):

101  
num
 * 2

102 
‹¡_¬gum’t_·ssšg
.
expo£d
 = 
True


104 
def
 
	$‹¡_»tuºšg_FauÉ
(
£lf
):

105  
	`FauÉ
(1, "custom Fault„esponse")

106 
‹¡_»tuºšg_FauÉ
.
expo£d
 = 
True


108 
roÙ
 = 
	$RoÙ
()

109 
roÙ
.
xmÌpc
 = 
	$XmlRpc
()

110 
ch”rypy
.
Œ“
.
	`mouÁ
(
roÙ
, 
cÚfig
={'/': {

111 '»que¡.di¥©ch': 
ch”rypy
.
di¥©ch
.
	`XMLRPCDi¥©ch”
(),

113 }
	}
})

116 
äom
 
ch”rypy
.
‹¡
 
impÜt
 
h–³r


118 
şass
 
	$XmlRpcTe¡
(
h–³r
.
CPWebCa£
):

119 
£tup_£rv”
 = 
	$¡©icm‘hod
(
£tup_£rv”
)

120 
def
 
	$‹¡XmlRpc
(
£lf
):

122 
scheme
 = 
£lf
.scheme

123 
scheme
 == "https":

124 
u¾
 = 'h‰ps://%s:%s/xmÌpc/' % (
£lf
.
	`š‹rçû
(), s–f.
PORT
)

125 
´oxy
 = 
	`S”v”Proxy
(
u¾
, 
Œª¥Üt
=
	$HTTPST¿n¥Üt
())

127 
u¾
 = 'h‰p://%s:%s/xmÌpc/' % (
£lf
.
	`š‹rçû
(), s–f.
PORT
)

128 
´oxy
 = 
	$S”v”Proxy
(
u¾
)

130 #begš 
the
 
‹¡s
 ...

131 
£lf
.
	`g‘Page
("/xmlrpc/foo")

132 
£lf
.
	`as£¹Body
("Hello world!")

134 
£lf
.
	`as£¹Equ®
(
´oxy
.
	`»tuº_sšgË_™em_li¡
(), [42])

135 
£lf
.
	`as£¹NÙEqu®
(
´oxy
.
	`»tuº_sšgË_™em_li¡
(), 'one bazillion')

136 
£lf
.
	`as£¹Equ®
(
´oxy
.
	`»tuº_¡ršg
(), "here is‡ string")

137 
£lf
.
	`as£¹Equ®
(
´oxy
.
	`»tuº_tu¶e
(), 
	`li¡
(('here', 'is', 1, 'tuple')))

138 
£lf
.
	`as£¹Equ®
(
´oxy
.
	`»tuº_diù
(), {'a': 1, 'c': 3, 'b': 2
	}
})

139 
£lf
.
as£¹Equ®
(
´oxy
.
»tuº_compos™e
(),

141 
	g£lf
.
as£¹Equ®
(
´oxy
.
»tuº_št
(), 42)

142 
	g£lf
.
as£¹Equ®
(
´oxy
.
»tuº_æßt
(), 3.14)

143 
	g£lf
.
as£¹Equ®
(
´oxy
.
»tuº_d©‘ime
(),

144 
D©eTime
((2003, 10, 7, 8, 1, 0, 1, 280, -1)))

145 
	g£lf
.
as£¹Equ®
(
´oxy
.
»tuº_boŞ—n
(), 
True
)

146 
	g£lf
.
as£¹Equ®
(
´oxy
.
‹¡_¬gum’t_·ssšg
(22), 22 * 2)

148 #Te¡ 
ª
 
”rÜ
 
š
 
the
 
·ge
 
hªdËr
 (
should
 
¿i£
‡À
xmÌpşib
.
FauÉ
)

149 
	gŒy
:

150 
´oxy
.
‹¡_¬gum’t_·ssšg
({})

151 
exû±
 
Exû±iÚ
:

152 
x
 = 
sys
.
exc_šfo
()[1]

153 
£lf
.
	$as£¹Equ®
(
x
.
__şass__
, 
FauÉ
)

154 
£lf
.
	`as£¹Equ®
(
x
.
çuÉSŒšg
, ("unsupported operandype(s) "

157 
£lf
.
	`ç
("Expected xmlrpclib.Fault")

160 #ià
a
 
m‘hod
 
is
 
nÙ
 
found
, 
ª
 
xmÌpşib
.
FauÉ
 
should
 
be
 
¿i£d


161 
Œy
:

162 
´oxy
.
	$nÚ_m‘hod
()

163 
exû±
 
Exû±iÚ
:

164 
x
 = 
sys
.
	`exc_šfo
()[1]

165 
£lf
.
	$as£¹Equ®
(
x
.
__şass__
, 
FauÉ
)

166 
£lf
.
	`as£¹Equ®
(
x
.
çuÉSŒšg
, 'method "non_method" is‚ot supported')

168 
£lf
.
	`ç
("Expected xmlrpclib.Fault")

170 #Te¡ 
»tuºšg
 
a
 
FauÉ
 
äom
 
the
 
·ge
 
hªdËr
.

171 
Œy
:

172 
´oxy
.
	$‹¡_»tuºšg_FauÉ
()

173 
exû±
 
Exû±iÚ
:

174 
x
 = 
sys
.
	`exc_šfo
()[1]

175 
£lf
.
	$as£¹Equ®
(
x
.
__şass__
, 
FauÉ
)

176 
£lf
.
	`as£¹Equ®
(
x
.
çuÉSŒšg
, ("custom Fault„esponse"))

178 
£lf
.
	`ç
("Expected xmlrpclib.Fault")

	@trunk/objs/CherryPy-3.2.4/cherrypy/test/webtest.py

3 
U£
 
the
 
	gWebCa£
.
g‘Page
 
m‘hod
 
to
 
»que¡
 
a
 
·ge
 
äom
 
your
 
HTTP
 
	g£rv”
.

5 
F¿mewÜk
 
	gIÁeg¿tiÚ


8 
If
 
you
 
have
 
cÚŒŞ
 
ov”
 
your
 
£rv”
 
´oûss
, you 
ÿn
 
hªdË
 
”rÜs


9 
š
 
the
 
	g£rv”
-
side
 
of
h
HTTP
 
cÚv”§tiÚ
 
a
 
b™
 
	gb‘‹r
. 
You
 
mu¡
 
run


10 
bÙh
 
the
 
	$ş›Á
 (
your
 
WebCa£
 
‹¡s
è
ªd
 
the
 
£rv”
 
š
h
§me
 
´oûss


11 (
but
 
š
 
£·¿‹
 
th»ads
, 
obviou¦y
).

13 
Wh’
 
ª
 
”rÜ
 
occurs
 
š
 
the
 
äamewÜk
, 
ÿÎ
 
£rv”_”rÜ
. 
It
 
wl
 
´št


14 
the
 
Œaûback
 
to
 
¡dout
, 
ªd
 
k“p
 
ªy
 
as£¹iÚs
 
you
 
have
 
äom
 
ruÂšg


15 (
the
 
assum±iÚ
 
is
 
th©
, th
£rv”
 
”rÜs
,h
·ge
 
ouut
 
wl
 
nÙ


16 
be
 
of
 
fu¹h”
 
signifiÿnû
 
to
 
your
 
‹¡s
).

19 
impÜt
 
µršt


20 
impÜt
 
»


21 
impÜt
 
sock‘


22 
impÜt
 
sys


23 
impÜt
 
time


24 
impÜt
 
Œaûback


25 
impÜt
 
ty³s


27 
äom
 
un™‹¡
 
impÜt
 *

28 
äom
 
un™‹¡
 
impÜt
 
_TextTe¡ResuÉ


30 
äom
 
ch”rypy
.
_ıcom·t
 
impÜt
 
ba£¡ršg
, 
Áob
, 
py3k
, 
HTTPCÚÃùiÚ
, 
HTTPSCÚÃùiÚ
, 
unicode¡r


33 
def
 
	$š‹rçû
(
ho¡
):

36 
If
 
the
 
£rv”
 
is
 
li¡’šg
 
Ú
 '0.0.0.0' (
INADDR_ANY
)

37 
Ü
 '::' (
IN6ADDR_ANY
), 
this
 
wl
  
the
 
´İ”
 
loÿlho¡
."""

38 
ho¡
 == '0.0.0.0':

39 #INADDR_ANY, 
which
 
should
 
»¥Úd
 
Ú
 
loÿlho¡
.

41 
ho¡
 == '::':

42 #IN6ADDR_ANY, 
which
 
should
 
»¥Úd
 
Ú
 
loÿlho¡
.

44  
ho¡


47 
şass
 
	$T”£Te¡ResuÉ
(
_TextTe¡ResuÉ
):

49 
def
 
	$´štE¼Üs
(
£lf
):

50 #Ov”ridd’ 
to
 
avoid
 
uÂeûs§ry
 
em±y
 
lše


51 
£lf
.
”rÜs
 
Ü
 s–f.
çu»s
:

52 
£lf
.
dÙs
 
Ü
 s–f.
showAÎ
:

53 
£lf
.
¡»am
.
	$wr™–n
()

54 
£lf
.
	`´štE¼ÜLi¡
('ERROR', s–f.
”rÜs
)

55 
£lf
.
	`´štE¼ÜLi¡
('FAIL', s–f.
çu»s
)

58 
şass
 
	$T”£Te¡RuÂ”
(
TextTe¡RuÂ”
):

61 
def
 
	$_makeResuÉ
(
£lf
):

62  
	$T”£Te¡ResuÉ
(
£lf
.
¡»am
, s–f.
desütiÚs
, s–f.
v”bos™y
)

64 
def
 
	$run
(
£lf
, 
‹¡
):

66 #Ov”ridd’ 
to
 
»move
 
uÂeûs§ry
 
em±y
 
lšes
 
ªd
 
£·¿tÜs


67 
»suÉ
 = 
£lf
.
	$_makeResuÉ
()

68 
	$‹¡
(
»suÉ
)

69 
»suÉ
.
	$´štE¼Üs
()

70 
nÙ
 
»suÉ
.
	$wasSucûssful
():

71 
£lf
.
¡»am
.
	`wr™e
("FAILED (")

72 
çed
, 
”rÜed
 = 
	`li¡
(
	`m­
(
Ën
, (
»suÉ
.
çu»s
,„esuÉ.
”rÜs
)))

73 
çed
:

74 
£lf
.
¡»am
.
	`wr™e
("çu»s=%d" % 
çed
)

75 
”rÜed
:

76 
çed
: 
£lf
.
¡»am
.
	`wr™e
(", ")

77 
£lf
.
¡»am
.
	`wr™e
("”rÜs=%d" % 
”rÜed
)

78 
£lf
.
¡»am
.
	`wr™–n
(")")

79  
»suÉ


82 
şass
 
	$R–ßdšgTe¡Lßd”
(
Te¡Lßd”
):

84 
def
 
	$lßdTe¡sFromName
(
£lf
, 
Çme
, 
moduË
=
NÚe
):

87 
The
 
Çme
 
may
 
»sŞve
 
e™h”
 
to
 
a
 
moduË
,‡ 
‹¡
 
şass
,‡

88 
‹¡
 
m‘hod
 
w™hš
 
a
e¡ 
şass
, 
Ü
‡ 
ÿÎabË
 
objeù
 
which


89 
»tuºs
 
a
 
Te¡Ca£
 
Ü
 
Te¡Su™e
 
š¡ªû
.

91 
The
 
m‘hod
 
İtiÚ®ly
 
»sŞves
 
the
 
Çmes
 
»Ïtive
 
to
 
a
 
giv’
 
moduË
.

93 
·¹s
 = 
Çme
.
	`¥l™
('.')

94 
unu£d_·¹s
 = []

95 
moduË
 
is
 
NÚe
:

96 
nÙ
 
·¹s
:

97 
¿i£
 
	`V®ueE¼Ü
("šcom¶‘‹¡‚ame: %s" % 
Çme
)

99 
·¹s_cİy
 = 
·¹s
[:]

100 
·¹s_cİy
:

101 
rg‘
 = ".".
	$još
(
·¹s_cİy
)

102 
rg‘
 
š
 
sys
.
moduËs
:

103 
moduË
 = 
	$»lßd
(
sys
.
moduËs
[
rg‘
])

104 
·¹s
 = 
unu£d_·¹s


107 
Œy
:

108 
moduË
 = 
	$__impÜt__
(
rg‘
)

109 
·¹s
 = 
unu£d_·¹s


111 
exû±
 
ImpÜtE¼Ü
:

112 
unu£d_·¹s
.
	`š£¹
(0,
·¹s_cİy
[-1])

113 
d–
 
·¹s_cİy
[-1]

114 
nÙ
 
·¹s_cİy
:

115 
¿i£


116 
·¹s
 =…arts[1:]

117 
obj
 = 
moduË


118 
·¹
 
š
 
·¹s
:

119 
obj
 = 
	$g‘©Œ
(
obj
, 
·¹
)

121 
	`ty³
(
obj
è=ğ
ty³s
.
ModuËTy³
:

122  
£lf
.
	$lßdTe¡sFromModuË
(
obj
)

123 
	`–if
 (((
py3k
 
ªd
 
	$isš¡ªû
(
obj
, 
ty³
))

124 
Ü
 
	`isš¡ªû
(
obj
, (
ty³
, 
ty³s
.
CÏssTy³
)))

125 
ªd
 
	$issubşass
(
obj
, 
Te¡Ca£
)):

126  
£lf
.
	$lßdTe¡sFromTe¡Ca£
(
obj
)

127 
–if
 
	`ty³
(
obj
è=ğ
ty³s
.
UnboundM‘hodTy³
:

128 
py3k
:

129  
obj
.
__£lf__
.
	$__şass__
(
obj
.
__Çme__
)

131  
obj
.
	$im_şass
(
obj
.
__Çme__
)

132 
–if
 
	`ha§‰r
(
obj
, '__call__'):

133 
‹¡
 = 
	$obj
()

134 
nÙ
 
	$isš¡ªû
(
‹¡
, 
Te¡Ca£
è
ªd
 \

135 
nÙ
 
	$isš¡ªû
(
‹¡
, 
Te¡Su™e
):

136 
¿i£
 
	`V®ueE¼Ü
("calling %s„eturned %s, "

137 "nÙ‡e¡" % (
obj
,
‹¡
))

138  
‹¡


140 
¿i£
 
	`V®ueE¼Ü
("dØnÙ know howØmak‹¡ from: %s" % 
obj
)

143 
Œy
:

144 #JythÚ 
suµÜt


145 
sys
.
¶©fÜm
[:4] == 'java':

146 
def
 
	$g‘ch¬
():

147 #HİefuÎy 
this
 
is
 
’ough


148  
sys
.
¡dš
.
	$»ad
(1)

150 #OÀ
Wšdows
, 
msvüt
.
g‘ch
 
»ads
 
a
 
sšgË
 
w™hout
 
ouut
.

151 
impÜt
 
msvüt


152 
def
 
	$g‘ch¬
():

153  
msvüt
.
	$g‘ch
()

154 
exû±
 
ImpÜtE¼Ü
:

155 #Unix 
g‘chr


156 
impÜt
 
‰y
, 
‹rmios


157 
def
 
	$g‘ch¬
():

158 
fd
 = 
sys
.
¡dš
.
	$f’o
()

159 
Şd_£‰šgs
 = 
‹rmios
.
	$tcg‘©Œ
(
fd
)

160 
Œy
:

161 
‰y
.
	`£Œaw
(
sys
.
¡dš
.
	$f’o
())

162 
ch
 = 
sys
.
¡dš
.
	$»ad
(1)

163 
fš®ly
:

164 
‹rmios
.
	$tc£‰r
(
fd
, 
‹rmios
.
TCSADRAIN
, 
Şd_£‰šgs
)

165  
ch


168 
şass
 
	$WebCa£
(
Te¡Ca£
):

169 
HOST
 = "127.0.0.1"

170 
PORT
 = 8000

171 
HTTP_CONN
 = 
HTTPCÚÃùiÚ


172 
PROTOCOL
 = "HTTP/1.1"

174 
scheme
 = "http"

175 
u¾
 = 
NÚe


177 
¡©us
 = 
NÚe


178 
h—d”s
 = 
NÚe


179 
body
 = 
NÚe


181 
’codšg
 = 'utf-8'

183 
time
 = 
NÚe


185 
def
 
	$g‘_cÚn
(
£lf
, 
auto_İ’
=
F®£
):

187 
£lf
.
scheme
 == "https":

188 
şs
 = 
HTTPSCÚÃùiÚ


190 
şs
 = 
HTTPCÚÃùiÚ


191 
cÚn
 = 
	`şs
(
£lf
.
	`š‹rçû
(), s–f.
PORT
)

192 #Autom©iÿÎy 
»
-
cÚÃù
?

193 
cÚn
.
auto_İ’
 =‡uto_open

194 
cÚn
.
	$cÚÃù
()

195  
cÚn


197 
def
 
	$£t_³rsi¡’t
(
£lf
, 
Ú
=
True
, 
auto_İ’
=
F®£
):

200 
If
 
the
 'Ú' 
¬gum’t
 
is
 
	`True
 (th), 
th’
 
£lf
.
HTTP_CONN


201 
wl
 
be
 
£t
 
to
 
ª
 
š¡ªû
 
of
 
	`HTTPCÚÃùiÚ
 (
Ü
 
HTTPS


202 
£lf
.
scheme
 
is
 "h‰ps"). 
This
 
wl
 
th’
 
³rsi¡
 
aüoss
 
»que¡s
.

204 
We
 
Úly
 
®low
 
a
 
sšgË
 
İ’
 
cÚÃùiÚ
, 
so
 
you
 
ÿÎ
 
this


205 
ªd
 
we
 
cu¼’y
 
have
 
ª
 
İ’
 
cÚÃùiÚ
, 
™
 
wl
 
be
 
şo£d
.

207 
Œy
:

208 
£lf
.
HTTP_CONN
.
	$şo£
()

209 
	$exû±
 (
Ty³E¼Ü
, 
A‰ribu‹E¼Ü
):

210 
·ss


212 
Ú
:

213 
£lf
.
HTTP_CONN
 = s–f.
	$g‘_cÚn
(
auto_İ’
=auto_open)

215 
£lf
.
scheme
 == "https":

216 
£lf
.
HTTP_CONN
 = 
HTTPSCÚÃùiÚ


218 
£lf
.
HTTP_CONN
 = 
HTTPCÚÃùiÚ


220 
def
 
	$_g‘_³rsi¡’t
(
£lf
):

221  
	`ha§‰r
(
£lf
.
HTTP_CONN
, "__class__")

222 
def
 
	$_£t_³rsi¡’t
(
£lf
, 
Ú
):

223 
£lf
.
	$£t_³rsi¡’t
(
Ú
)

224 
³rsi¡’t
 = 
	$´İ”ty
(
_g‘_³rsi¡’t
, 
_£t_³rsi¡’t
)

226 
def
 
	$š‹rçû
(
£lf
):

229 
If
 
the
 
£rv”
 
is
 
li¡’šg
 
Ú
 '0.0.0.0' (
INADDR_ANY
)

230 
Ü
 '::' (
IN6ADDR_ANY
), 
this
 
wl
  
the
 
´İ”
 
loÿlho¡
."""

231  
	$š‹rçû
(
£lf
.
HOST
)

233 
def
 
	`g‘Page
(
£lf
, 
u¾
, 
h—d”s
=
NÚe
, 
m‘hod
="GET", 
body
=NÚe, 
´ÙocŞ
=None):

235 
S”v”E¼Ü
.
Ú
 = 
F®£


237 
	$isš¡ªû
(
u¾
, 
unicode¡r
):

238 
u¾
 = u¾.
	`’code
('utf-8')

239 
	$isš¡ªû
(
body
, 
unicode¡r
):

240 
body
 = body.
	`’code
('utf-8')

242 
£lf
.
u¾
 = url

243 
£lf
.
time
 = 
NÚe


244 
¡¬t
 = 
time
.
	$time
()

245 
»suÉ
 = 
	$İ’URL
(
u¾
, 
h—d”s
, 
m‘hod
, 
body
, 
£lf
.
HOST
, s–f.
PORT
,

246 
£lf
.
HTTP_CONN
, 
´ÙocŞ
 
Ü
 s–f.
PROTOCOL
)

247 
£lf
.
time
 =ime.
	`time
(è- 
¡¬t


248 
£lf
.
¡©us
, s–f.
h—d”s
, s–f.
body
 = 
»suÉ


250 #Bud 
a
 
li¡
 
of
 
»que¡
 
cook›s
 
äom
 
the
 
´evious
 
»¥Ú£
 cookies.

251 
£lf
.
cook›s
 = [('Cook›', 
v
è
k
, v 
š
 s–f.
h—d”s


252 
k
.
	`low”
() == 'set-cookie']

254 
S”v”E¼Ü
.
Ú
:

255 
¿i£
 
	$S”v”E¼Ü
()

256  
»suÉ


258 
š‹¿ùive
 = 
True


259 
cÚsŞe_height
 = 30

261 
def
 
	$_hªdËwebE¼Ü
(
£lf
, 
msg
):

262 
	`´št
("")

263 
	`´št
(" ERROR: %s" % 
msg
)

265 
nÙ
 
£lf
.
š‹¿ùive
:

266 
¿i£
 
£lf
.
	$çu»Exû±iÚ
(
msg
)

268 
p
 = " Show: [B]ody [H]eaders [S]tatus [U]RL; [I]gnore, [R]aise, or sys.e[X]it >> "

269 
sys
.
¡dout
.
	$wr™e
(
p
)

270 
sys
.
¡dout
.
	$æush
()

271 
True
:

272 
i
 = 
	`g‘ch¬
().
	$uµ”
()

273 
nÙ
 
	`isš¡ªû
(
i
, 
	`ty³
("")):

274 
i
 = i.
	`decode
('ascii')

275 
i
 
nÙ
 
š
 "BHSUIRX":

277 
	`´št
(
i
.
	$uµ”
()è#AlsØ
´šts
 
Ãw
 
lše


278 
i
 == "B":

279 
x
, 
lše
 
š
 
	`’um”©e
(
£lf
.
body
.
	$¥l™lšes
()):

280 ià(
x
 + 1è% 
£lf
.
cÚsŞe_height
 == 0:

281 #Th\
r
 
ªd
 
comma
 
should
 
make
 
the
 
Ãxt
 
lše
 
ov”wr™e


282 
sys
.
¡dout
.
	`wr™e
("<-- More -->\r")

283 
m
 = 
	`g‘ch¬
().
	$low”
()

284 #E¿£ 
our
 "MÜe" 
´om±


285 
sys
.
¡dout
.
	`wr™e
(" \r")

286 
m
 == "q":

288 
	$´št
(
lše
)

289 
–if
 
i
 == "H":

290 
µršt
.
	$µršt
(
£lf
.
h—d”s
)

291 
–if
 
i
 == "S":

292 
	$´št
(
£lf
.
¡©us
)

293 
–if
 
i
 == "U":

294 
	$´št
(
£lf
.
u¾
)

295 
–if
 
i
 == "I":

296 #»tuº 
w™hout
 
¿isšg
 
the
 
nÜm®
 
exû±iÚ


298 
–if
 
i
 == "R":

299 
¿i£
 
£lf
.
	$çu»Exû±iÚ
(
msg
)

300 
–if
 
i
 == "X":

301 
£lf
.
	$ex™
()

302 
sys
.
¡dout
.
	$wr™e
(
p
)

303 
sys
.
¡dout
.
	$æush
()

305 
def
 
	$ex™
(
£lf
):

306 
sys
.
	$ex™
()

308 
def
 
	$as£¹Stus
(
£lf
, 
¡©us
, 
msg
=
NÚe
):

310 
	$isš¡ªû
(
¡©us
, 
ba£¡ršg
):

311 
nÙ
 
£lf
.
¡©us
 == status:

312 
msg
 
is
 
NÚe
:

313 
msg
 = 'Stu (%rè!ğ%r' % (
£lf
.
¡©us
, status)

314 
£lf
.
	$_hªdËwebE¼Ü
(
msg
)

315 
–if
 
	$isš¡ªû
(
¡©us
, ):

316 
code
 = (
£lf
.
¡©us
[:3])

317 
code
 !ğ
¡©us
:

318 
msg
 
is
 
NÚe
:

319 
msg
 = 'Stu (%rè!ğ%r' % (
£lf
.
¡©us
, status)

320 
£lf
.
	$_hªdËwebE¼Ü
(
msg
)

322 #¡©u 
is
 
a
 
tu¶e
 
Ü
 
li¡
.

323 
m©ch
 = 
F®£


324 
s
 
š
 
¡©us
:

325 
	$isš¡ªû
(
s
, 
ba£¡ršg
):

326 
£lf
.
¡©us
 =ğ
s
:

327 
m©ch
 = 
True


329 
–if
 (
£lf
.
¡©us
[:3]è=ğ
s
:

330 
m©ch
 = 
True


332 
nÙ
 
m©ch
:

333 
msg
 
is
 
NÚe
:

334 
msg
 = 'Stu (%rènÙ iÀ%r' % (
£lf
.
¡©us
, status)

335 
£lf
.
	$_hªdËwebE¼Ü
(
msg
)

337 
def
 
	$as£¹H—d”
(
£lf
, 
key
, 
v®ue
=
NÚe
, 
msg
=None):

339 
lowkey
 = 
key
.
	$low”
()

340 
k
, 
v
 
š
 
£lf
.
h—d”s
:

341 
k
.
	`low”
(è=ğ
lowkey
:

342 
v®ue
 
is
 
NÚe
 
Ü
 
	`¡r
(v®ueè=ğ
v
:

343  
v


345 
msg
 
is
 
NÚe
:

346 
v®ue
 
is
 
NÚe
:

347 
msg
 = '%¸nÙ iÀh—d”s' % 
key


349 
msg
 = '%r:%¸nÙ iÀh—d”s' % (
key
, 
v®ue
)

350 
£lf
.
	$_hªdËwebE¼Ü
(
msg
)

352 
def
 
	$as£¹H—d”In
(
£lf
, 
key
, 
v®ues
, 
msg
=
NÚe
):

354 
lowkey
 = 
key
.
	$low”
()

355 
k
, 
v
 
š
 
£lf
.
h—d”s
:

356 
k
.
	`low”
(è=ğ
lowkey
:

357 
m©ches
 = [
v®ue
 v®u
š
 
v®ues
 
	`¡r
(v®ueè=ğ
v
]

358 
m©ches
:

359  
m©ches


361 
msg
 
is
 
NÚe
:

362 
msg
 = '%(keyì‚Ù iÀ%(v®uesì' % 
	$v¬s
()

363 
£lf
.
	$_hªdËwebE¼Ü
(
msg
)

365 
def
 
	$as£¹H—d”I‹mV®ue
(
£lf
, 
key
, 
v®ue
, 
msg
=
NÚe
):

367 
aùu®_v®ue
 = 
£lf
.
	$as£¹H—d”
(
key
, 
msg
=msg)

368 
h—d”_v®ues
 = 
	`m­
(
¡r
.
¡r
, 
aùu®_v®ue
.
	`¥l™
(','))

369 
v®ue
 
š
 
h—d”_v®ues
:

370  
v®ue


372 
msg
 
is
 
NÚe
:

373 
msg
 = "%¸nÙ iÀ%r" % (
v®ue
, 
h—d”_v®ues
)

374 
£lf
.
	$_hªdËwebE¼Ü
(
msg
)

376 
def
 
	$as£¹NoH—d”
(
£lf
, 
key
, 
msg
=
NÚe
):

378 
lowkey
 = 
key
.
	$low”
()

379 
m©ches
 = [
k
 k, 
v
 
š
 
£lf
.
h—d”s
 k.
	`low”
(è=ğ
lowkey
]

380 
m©ches
:

381 
msg
 
is
 
NÚe
:

382 
msg
 = '%¸š h—d”s' % 
key


383 
£lf
.
	$_hªdËwebE¼Ü
(
msg
)

385 
def
 
	$as£¹Body
(
£lf
, 
v®ue
, 
msg
=
NÚe
):

387 
	$isš¡ªû
(
v®ue
, 
unicode¡r
):

388 
v®ue
 = v®ue.
	$’code
(
£lf
.
’codšg
)

389 
v®ue
 !ğ
£lf
.
body
:

390 
msg
 
is
 
NÚe
:

391 
msg
 = 'ex³ùed body:\n%r\n\Çùu® body:\n%r' % (
v®ue
, 
£lf
.
body
)

392 
£lf
.
	$_hªdËwebE¼Ü
(
msg
)

394 
def
 
	$as£¹InBody
(
£lf
, 
v®ue
, 
msg
=
NÚe
):

396 
	$isš¡ªû
(
v®ue
, 
unicode¡r
):

397 
v®ue
 = v®ue.
	$’code
(
£lf
.
’codšg
)

398 
v®ue
 
nÙ
 
š
 
£lf
.
body
:

399 
msg
 
is
 
NÚe
:

400 
msg
 = '%¸nÙ iÀbody: %s' % (
v®ue
, 
£lf
.
body
)

401 
£lf
.
	$_hªdËwebE¼Ü
(
msg
)

403 
def
 
	$as£¹NÙInBody
(
£lf
, 
v®ue
, 
msg
=
NÚe
):

405 
	$isš¡ªû
(
v®ue
, 
unicode¡r
):

406 
v®ue
 = v®ue.
	$’code
(
£lf
.
’codšg
)

407 
v®ue
 
š
 
£lf
.
body
:

408 
msg
 
is
 
NÚe
:

409 
msg
 = '%¸found iÀbody' % 
v®ue


410 
£lf
.
	$_hªdËwebE¼Ü
(
msg
)

412 
def
 
	$as£¹M©chesBody
(
£lf
, 
·‰”n
, 
msg
=
NÚe
, 
æags
=0):

414 
	$isš¡ªû
(
·‰”n
, 
unicode¡r
):

415 
·‰”n
 =…©‹º.
	$’code
(
£lf
.
’codšg
)

416 
»
.
	$£¬ch
(
·‰”n
, 
£lf
.
body
, 
æags
è
is
 
NÚe
:

417 
msg
 
is
 
NÚe
:

418 
msg
 = 'NØm©ch fÜ %¸š body' % 
·‰”n


419 
£lf
.
	$_hªdËwebE¼Ü
(
msg
)

422 
m‘hods_w™h_bod›s
 = ("POST", "PUT")

424 
def
 
	$ş—nH—d”s
(
h—d”s
, 
m‘hod
, 
body
, 
ho¡
, 
pÜt
):

426 
h—d”s
 
is
 
NÚe
:

427 
h—d”s
 = []

429 #Add 
the
 
»quœed
 
Ho¡
 
»que¡
 
h—d”
 
nÙ
 
´e£Á
.

430 #[
This
 
¥ecif›s
 
the
 
ho¡
:
pÜt
 
of
h
£rv”
, 
nÙ
h
ş›Á
.]

431 
found
 = 
F®£


432 
k
, 
v
 
š
 
h—d”s
:

433 
k
.
	`low”
() == 'host':

434 
found
 = 
True


436 
nÙ
 
found
:

437 
pÜt
 == 80:

438 
h—d”s
.
	`­³nd
(("Ho¡", 
ho¡
))

440 
h—d”s
.
	`­³nd
(("Ho¡", "%s:%s" % (
ho¡
, 
pÜt
)))

442 
m‘hod
 
š
 
m‘hods_w™h_bod›s
:

443 #Stick 
š
  
ty³
 
ªd
 
Ëngth
 
h—d”s
 
nÙ
 
´e£Á


444 
found
 = 
F®£


445 
k
, 
v
 
š
 
h—d”s
:

446 
k
.
	`low”
() == 'content-type':

447 
found
 = 
True


449 
nÙ
 
found
:

450 
h—d”s
.
	`­³nd
(("Content-Type", "application/x-www-form-urlencoded"))

451 
h—d”s
.
	`­³nd
(("CÚ‹Á-L’gth", 
	`¡r
(
	`Ën
(
body
 
Ü
 ""))))

453  
h—d”s


456 
def
 
	$shb
(
»¥Ú£
):

458 
py3k
:

459 
h
 = 
»¥Ú£
.
	$g‘h—d”s
()

461 
h
 = []

462 
key
, 
v®ue
 = 
NÚe
, None

463 
lše
 
š
 
»¥Ú£
.
msg
.
h—d”s
:

464 
lše
:

465 
lše
[0] 
š
 " \t":

466 
v®ue
 +ğ
lše
.
	$¡r
()

468 
key
 
ªd
 
v®ue
:

469 
h
.
	`­³nd
((
key
, 
v®ue
))

470 
key
, 
v®ue
 = 
lše
.
	`¥l™
(":", 1)

471 
key
 = key.
	$¡r
()

472 
v®ue
 = v®ue.
	$¡r
()

473 
key
 
ªd
 
v®ue
:

474 
h
.
	`­³nd
((
key
, 
v®ue
))

476  "% %s" % (
»¥Ú£
.
¡©us
,„e¥Ú£.
»asÚ
), 
h
,„e¥Ú£.
	$»ad
()

479 
def
 
	`İ’URL
(
u¾
, 
h—d”s
=
NÚe
, 
m‘hod
="GET", 
body
=None,

480 
ho¡
="127.0.0.1", 
pÜt
=8000, 
h‰p_cÚn
=
HTTPCÚÃùiÚ
,

481 
´ÙocŞ
="HTTP/1.1"):

484 
h—d”s
 = 
	$ş—nH—d”s
(
h—d”s
, 
m‘hod
, 
body
, 
ho¡
, 
pÜt
)

486 #Tryšg 10 
times
 
is
 
sim¶y
 
š
 
of
 
sock‘
 
”rÜs
.

487 #NÜm® --
™
 
should
 
run
 
Úû
.

488 
ŒŸl
 
š
 
	$¿nge
(10):

489 
Œy
:

490 #AÎow 
h‰p_cÚn
 
to
 
be
 
a
 
şass
 
Ü
 
ª
 
š¡ªû


491 
	`ha§‰r
(
h‰p_cÚn
, "host"):

492 
cÚn
 = 
h‰p_cÚn


494 
cÚn
 = 
	`h‰p_cÚn
(
	`š‹rçû
(
ho¡
), 
pÜt
)

496 
cÚn
.
_h‰p_v¢_¡r
 = 
´ÙocŞ


497 
cÚn
.
_h‰p_v¢
 = ("".
	`još
([
x
 x 
š
 
´ÙocŞ
 x.
	`isdig™
()]))

499 #sk_acû±_’codšg 
¬gum’t
 
added
 
š
 
pythÚ
 
v”siÚ
 2.4

500 
sys
.
v”siÚ_šfo
 < (2, 4):

501 
def
 
	$puth—d”
(
£lf
, 
h—d”
, 
v®ue
):

502 
h—d”
 =ğ'Acû±-Encodšg' 
ªd
 
v®ue
 == 'identity':

504 
£lf
.
__şass__
.
	$puth—d”
(
£lf
, 
h—d”
, 
v®ue
)

505 
impÜt
 
Ãw


506 
cÚn
.
puth—d”
 = 
Ãw
.
	$š¡ªûm‘hod
(
puth—d”
, 
cÚn
, cÚn.
__şass__
)

507 
cÚn
.
	`puŒeque¡
(
m‘hod
.
	`uµ”
(), 
u¾
, 
sk_ho¡
=
True
)

508 
–if
 
nÙ
 
py3k
:

509 
cÚn
.
	`puŒeque¡
(
m‘hod
.
	`uµ”
(), 
u¾
, 
sk_ho¡
=
True
,

510 
sk_acû±_’codšg
=
True
)

512 
impÜt
 
h‰p
.
ş›Á


513 #R•Ïû 
the
 
¡dlib
 
m‘hod
, 
which
 
Úly
 
acû±s
 
ASCII
 
u¾
's

514 
def
 
	$puŒeque¡
(
£lf
, 
m‘hod
, 
u¾
):

515 
£lf
.
_HTTPCÚÃùiÚ__»¥Ú£
 
ªd
 s–f._HTTPCÚÃùiÚ__»¥Ú£.
	$isşo£d
():

516 
£lf
.
_HTTPCÚÃùiÚ__»¥Ú£
 = 
NÚe


518 
£lf
.
_HTTPCÚÃùiÚ__¡©e
 =ğ
h‰p
.
ş›Á
.
_CS_IDLE
:

519 
£lf
.
_HTTPCÚÃùiÚ__¡©e
 = 
h‰p
.
ş›Á
.
_CS_REQ_STARTED


521 
¿i£
 
h‰p
.
ş›Á
.
	$CªnÙS’dReque¡
()

523 
£lf
.
_m‘hod
 = 
m‘hod


524 
nÙ
 
u¾
:

525 
u¾
 = 
	`Áob
('/')

526 
»que¡
 = 
	`Áob
(' ').
	`još
((
m‘hod
.
	`’code
("ASCII"), 
u¾
,

527 
£lf
.
_h‰p_v¢_¡r
.
	`’code
("ASCII")))

528 
£lf
.
	$_ouut
(
»que¡
)

529 
impÜt
 
ty³s


530 
cÚn
.
puŒeque¡
 = 
ty³s
.
	$M‘hodTy³
(
puŒeque¡
, 
cÚn
)

532 
cÚn
.
	`puŒeque¡
(
m‘hod
.
	`uµ”
(), 
u¾
)

534 
key
, 
v®ue
 
š
 
h—d”s
:

535 
cÚn
.
	`puth—d”
(
key
, 
v®ue
.
	`’code
("Latin-1"))

536 
cÚn
.
	$’dh—d”s
()

538 
body
 
is
 
nÙ
 
NÚe
:

539 
cÚn
.
	$£nd
(
body
)

541 #HªdË 
»¥Ú£


542 
»¥Ú£
 = 
cÚn
.
	$g‘»¥Ú£
()

544 
s
, 
h
, 
b
 = 
	$shb
(
»¥Ú£
)

546 
nÙ
 
	`ha§‰r
(
h‰p_cÚn
, "host"):

547 #W
made
 
our
 
own
 
cÚn
 
š¡ªû
. 
Clo£
 
™
.

548 
cÚn
.
	$şo£
()

550  
s
, 
h
, 
b


551 
exû±
 
sock‘
.
”rÜ
:

552 
time
.
	$¦“p
(0.5)

553 
ŒŸl
 == 9:

554 
¿i£


557 #Add 
ªy
 
exû±iÚs
 
which
 
your
 
web
 
äamewÜk
 
hªdËs


558 #nÜm®ly (
th©
 
you
 
dÚ
't want server_errororap).

559 
ignÜed_exû±iÚs
 = []

561 #You'Î wªˆ£ˆthi tØTruwh’ you cª'
t
 
gu¬ª‹e


562 #th© 
—ch
 
»¥Ú£
 
wl
 
immedŸ‹ly
 
fŞlow
ƒach 
»que¡
;

563 #fÜ 
exam¶e
, 
wh’
 
hªdlšg
 
»que¡s
 
vŸ
 
muÉË
 
th»ads
.

564 
ignÜe_®l
 = 
F®£


566 
şass
 
	$S”v”E¼Ü
(
Exû±iÚ
):

567 
Ú
 = 
F®£


570 
def
 
	$£rv”_”rÜ
(
exc
=
NÚe
):

573 
You
 
´obably
 
wªt
 
to
 
w¿p
 
this
, 
so
 
you
 
ÿn
 
¡l
 
hªdË
 
ª
 
”rÜ
 
usšg


574 
your
 
äamewÜk
 
wh’
 
™
's ignored.

576 
exc
 
is
 
NÚe
:

577 
exc
 = 
sys
.
	$exc_šfo
()

579 
ignÜe_®l
 
Ü
 
exc
[0] 
š
 
ignÜed_exû±iÚs
:

580  
F®£


582 
S”v”E¼Ü
.
Ú
 = 
True


583 
	`´št
("")

584 
	`´št
("".
	`još
(
Œaûback
.
	$fÜm©_exû±iÚ
(*
exc
)))

585  
True


	@trunk/objs/CherryPy-3.2.4/cherrypy/tutorial/__init__.py

2 #Thi 
is
 
u£d
 
š
 
‹¡_cÚfig
 
to
 
‹¡
 
uÄ•r
 
of
 "from A import B"

3 
	gthšg2
 = 
objeù
()

	@trunk/objs/CherryPy-3.2.4/cherrypy/tutorial/bonus-sqlobject.py

2 
BÚus
 
	gTutÜŸl
: 
Usšg
 
SQLObjeù


4 
This
 
is
 
a
 
sly
 
l™e
 
cÚùs
 
mªag”
 
­¶iÿtiÚ
 
š‹nded
 
to


5 
demÚ¡¿‹
 
how
 
to
 
u£
 
SQLObjeù
 
äom
 
w™hš
 
a
 
Ch”ryPy2
 
´ojeù
. 
It


6 
®so
 
shows
 
how
 
to
 
u£
 
šlše
 
Ch“h
 
‹m¶©es
.

8 
SQLObjeù
 
is
 
ª
 
Objeù
/
R–©iÚ®
 
M­³r
 
th©
 
®lows
 
you
 
to
 
acûss


9 
d©a
 
¡Üed
 
š
 
ª
 
RDBMS
 iÀ
a
 
pythÚic
 
çshiÚ
. 
You
 
ü—‹
 d©¨
objeùs


10 
as
 
PythÚ
 
şas£s
 
ªd
 
Ët
 
SQLObjeù
 
ke
 
ÿ»
 
of
 
®l
 
the
 
Ç¡y
 
d‘as
.

12 
This
 
code
 
d•’ds
 
Ú
 
the
 
Ï‹¡
 
dev–İm’t
 
v”siÚ
 (0.6+è
of
 
SQLObjeù
.

13 
You
 
ÿn
 
g‘
 
™
 
äom
 
the
 
SQLObjeù
 
Subv”siÚ
 
£rv”
. You cª 
fšd
 
®l


14 
Ãûs§ry
 
šfÜm©iÚ
 
©
 <
h‰p
:

15 
wÜk
 
w™h
 
the
 0.5.x 
v”siÚ
 
adv”ti£d
 
Ú
 
theœ
 
webs™e
!

17 
This
 
code
 
®so
 
d•’ds
 
Ú
 
a
 
»ûÁ
 
v”siÚ
 
of
 
Ch“h
. 
You
 
ÿn
 
fšd


18 
Ch“h
 
©
 <
h‰p
:

20 
Aá”
 
¡¬tšg
 
this
 
­¶iÿtiÚ
 
the
 
fœ¡
 
time
, 
you
 
wl
 
Ãed
 
to


21 
acûss
 
	gthe
 /
»£t
 
URI
 
š
 
Üd”
 
to
 
ü—‹
 
the
 
d©aba£
 
bË
 
ªd
 
some


22 
§m¶e
 
	gd©a
. 
	gAcûssšg
 /
»£t
 
agaš
 
wl
 
drİ
 
ªd
 
	g»
-
ü—‹
 
the
 
	gbË
,

23 
so
 
you
 
may
 
wªt
 
to
 
be
 
	gÿ»ful
. :-)

25 
This
 
­¶iÿtiÚ
 
i¢
'ˆsuµo£dØbfoŞ-´oof, it'
s
 
nÙ
 
ev’
 
suµo£d


26 
to
 
be
 
v”y
 
GOOD
. 
PÏy
 
¬ound
 
w™h
 
™
 
some
, 
brow£
 
the
 
sourû
 
	gcode
, 
	gsme
.

30 -- 
H’drik
 
Mªs
 <
h’drik
@
mªs
.
de
>

33 
impÜt
 
ch”rypy


34 
äom
 
Ch“h
.
Tem¶©e
 
impÜt
 Template

35 
äom
 
sqlobjeù
 
impÜt
 *

37 #cÚfigu» 
your
 
d©aba£
 
cÚÃùiÚ
 
h”e


38 
__cÚÃùiÚ__
 = 'mysql://root:@localhost/test'

40 #thi 
is
 
our
 (
Úly
è
d©a
 
şass
.

41 
şass
 
	$CÚù
(
SQLObjeù
):

42 
Ï¡Name
 = 
	$SŒšgCŞ
(
Ëngth
 = 50, 
nÙNÚe
 = 
True
)

43 
fœ¡Name
 = 
	$SŒšgCŞ
(
Ëngth
 = 50, 
nÙNÚe
 = 
True
)

44 
phÚe
 = 
	`SŒšgCŞ
(
Ëngth
 = 30, 
nÙNÚe
 = 
True
,  = '')

45 
ema
 = 
	`SŒšgCŞ
(
Ëngth
 = 30, 
nÙNÚe
 = 
True
,  = '')

46 
u¾
 = 
	`SŒšgCŞ
(
Ëngth
 = 100, 
nÙNÚe
 = 
True
,  = '')

49 
şass
 
CÚùMªag”
:

50 
def
 
	$šdex
(
£lf
):

52 
cÚùs
 = 
CÚù
.
	$£Ëù
()

54 
‹m¶©e
 = 
	`Tem¶©e
('''

55 <
h2
>
AÎ
 
CÚùs
</h2>

57 #fÜ 
$cÚù
 
š
 
$cÚùs


58 <
a
 
h»f
="mato:$cÚù.ema">
$cÚù
.
Ï¡Name
, $cÚù.
fœ¡Name
</a>

59 [<
a
 
h»f
="./ed™?id=$cÚù.id">
Ed™
</a>]

60 [<
a
 
h»f
="./d–‘e?id=$cÚù.id">
D–‘e
</a>]

61 <
br
/>

64 <
p
>[<
a
 
h»f
="./ed™">
Add
 
Ãw
 
cÚù
</a>]</p>

67  
‹m¶©e
.
	$»¥Úd
()

69 
šdex
.
expo£d
 = 
True


72 
def
 
	$ed™
(
£lf
, 
id
 = 0):

73 #w
»®ly
 
wªt
 
id
 
as
 
ª
 
š‹g”
. 
Sšû
 
GET
/
POST
 
·¿m‘”s


74 #¬
®ways
 
·s£d
 
as
 
¡ršgs
, 
Ët
's convert it.

75 
id
 = (id)

77 
id
 > 0:

78 #ià
ª
 
id
 
is
 
¥ecif›d
, 
we
'reƒditing‡nƒxisting contact.

79 
cÚù
 = 
CÚù
.
	$g‘
(
id
)

80 
t™Ë
 = "Edit Contact"

82 #ià
no
 
id
 
is
 
¥ecif›d
, 
we
'reƒntering‡‚ew contact.

83 
cÚù
 = 
NÚe


84 
t™Ë
 = "New Contact"

87 #IÀ
the
 
fŞlowšg
 
‹m¶©e
 
code
, 
¶—£
 
nÙe
 
th©
 
we
 
u£


89 #tØdØ
this
 
beÿu£
 
cÚù
 
may
 
be
 
£t
 
to
 
	`NÚe
 (
£e
 
above
).

90 
‹m¶©e
 = 
	`Tem¶©e
('''

91 <
h2
>
$t™Ë
</h2>

93 <
fÜm
 
aùiÚ
="./¡Üe" 
m‘hod
="POST">

94 <
šput
 
ty³
="hidd’" 
Çme
="id" 
v®ue
="$id" />

95 
La¡
 
Name
: <
šput
 
Çme
="Ï¡Name" 
v®ue
="$g‘V¬('cÚù.Ï¡Name', '')" /><
br
/>

96 
Fœ¡
 
Name
: <
šput
 
Çme
="fœ¡Name" 
v®ue
="$g‘V¬('cÚù.fœ¡Name', '')" /><
br
/>

97 
PhÚe
: <
šput
 
Çme
="phÚe" 
v®ue
="$g‘V¬('cÚù.phÚe', '')" /><
br
/>

98 
Ema
: <
šput
 
Çme
="ema" 
v®ue
="$g‘V¬('cÚù.ema', '')" /><
br
/>

99 
URL
: <
šput
 
Çme
="u¾" 
v®ue
="$g‘V¬('cÚù.u¾', '')" /><
br
/>

100 <
šput
 
ty³
="subm™" 
v®ue
="Store" />

101 </
fÜm
>

104  
‹m¶©e
.
	$»¥Úd
()

106 
ed™
.
expo£d
 = 
True


109 
def
 
	$d–‘e
(
£lf
, 
id
):

110 #D–‘
the
 
¥ecif›d
 
cÚù


111 
cÚù
 = 
CÚù
.
	`g‘
((
id
))

112 
cÚù
.
	$de¡royS–f
()

115 
d–‘e
.
expo£d
 = 
True


118 
def
 
	$¡Üe
(
£lf
, 
Ï¡Name
, 
fœ¡Name
, 
phÚe
, 
ema
, 
u¾
, 
id
 = 
NÚe
):

119 
id
 
ªd
 (id) > 0:

120 #Ià
ª
 
id
 
was
 
¥ecif›d
, 
upd©e
‡À
exi¡šg
 
cÚù
.

121 
cÚù
 = 
CÚù
.
	`g‘
((
id
))

123 #W
could
 
£t
 
Úe
 
f›ld
 
aá”
 
ªÙh”
, 
but
 
th©
 
would


124 #ÿu£ 
muÉË
 
UPDATE
 
şau£s
. 
So
 
we
'll just do it‡ll

125 #š 
a
 
sšgË
 
·ss
 
through
 
the
 
	`£t
(è
m‘hod
.

126 
cÚù
.
	$£t
(

127 
Ï¡Name
 =†astName,

128 
fœ¡Name
 = firstName,

129 
phÚe
 =…hone,

130 
ema
 =ƒmail,

131 
u¾
 = url)

133 #Oth”wi£, 
add
 
a
 
Ãw
 
cÚù
.

134 
cÚù
 = 
	$CÚù
(

135 
Ï¡Name
 =†astName,

136 
fœ¡Name
 = firstName,

137 
phÚe
 =…hone,

138 
ema
 =ƒmail,

139 
u¾
 = url)

143 
¡Üe
.
expo£d
 = 
True


146 
def
 
	$»£t
(
£lf
):

147 #Drİ 
exi¡šg
 
bË


148 
CÚù
.
	$drİTabË
(
True
)

150 #C»©
Ãw
 
bË


151 
CÚù
.
	$ü—‹TabË
()

153 #C»©
some
 
§m¶e
 
d©a


154 
	`CÚù
(

155 
fœ¡Name
 = 'Hendrik',

156 
Ï¡Name
 = 'Mans',

157 
ema
 = 'hendrik@mans.de',

158 
phÚe
 = '++49 89 12345678',

159 
u¾
 = 'http://www.mornography.de')

163 
»£t
.
expo£d
 = 
True


166 
	`´št
("If you're„unninghis‡pplication forhe firstime,…lease goo http://localhost:8080/reset once in ordero createhe database!")

168 
ch”rypy
.
	`quick¡¬t
(
	`CÚùMªag”
())

	@trunk/objs/CherryPy-3.2.4/cherrypy/tutorial/custom_error.html

1 <?
xml
 
	gv”siÚ
="1.0" 
’codšg
="UTF-8"?>

2 <!
DOCTYPE
 
html
 
PUBLIC
 "-//W3C//DTD XHTML 1.0 Strict//EN"

4 <
html
>

5 <
h—d
>

6 <
t™Ë
>403 
UÇuthÜized
</title>

7 </
h—d
>

8 <
body
>

9 <
h2
>
You
 
ÿn
't dohat!</h2>

10 <
p
>%(
mes§ge
)
s
</p>

11 <
p
>
This
 
is
 
a
 
cu¡om
 
”rÜ
 
·ge
 
th©
 i 
»ad
 
äom
‡ 
fe
.<p>

12 <
´e
>%(
Œaûback
)
s
</pre>

13 </
body
>

14 </
html
>

	@trunk/objs/CherryPy-3.2.4/cherrypy/tutorial/tut01_helloworld.py

2 
	gTutÜŸl
 - 
H–lo
 
WÜld


4 
The
 
mo¡
 
	$basic
 (
wÜkšg
è
Ch”ryPy
 
­¶iÿtiÚ
 
possibË
.

7 #ImpÜˆ
Ch”ryPy
 
glob®
 
Çme¥aû


8 
impÜt
 
ch”rypy


10 
şass
 
H–loWÜld
:

13 
def
 
	$šdex
(
£lf
):

14 #Ch”ryPy 
wl
 
ÿÎ
 
this
 
m‘hod
 
the
 
roÙ
 
	`URI
 ("/"è
ªd
 
£nd


15 #™  
v®ue
 
to
 
the
 
ş›Á
. 
Beÿu£
 
this
 
is
 
tutÜŸl


16 #ËssÚ 
numb”
 01, 
we
'll just send something„eally simple.

17 #How 
about
...

20 #Expo£ 
the
 
šdex
 
m‘hod
 
through
h
web
. 
Ch”ryPy
 
wl
 
Ãv”


21 #publish 
m‘hods
 
th©
 
dÚ
't haveheƒxposed‡ttribute seto True.

22 
šdex
.
expo£d
 = 
True


25 
impÜt
 
os
.
·th


26 
tutcÚf
 = 
os
.
·th
.
	`još
(os.·th.
	`dœÇme
(
__fe__
), 'tutorial.conf')

28 
__Çme__
 == '__main__':

29 #Ch”ryPy 
®ways
 
¡¬ts
 
w™h
 
­p
.
roÙ
 
wh’
 
Œyšg
 
to
 
m­
 
»que¡
 
URIs


30 #tØ
objeùs
, 
so
 
we
 
Ãed
 
to
 
mouÁ
 
a
 
»que¡
 
hªdËr
 
roÙ
. 
A
„equest

31 #tØ'/' 
wl
 
be
 
m­³d
 
to
 
	`H–loWÜld
().
	`šdex
().

32 
ch”rypy
.
	`quick¡¬t
(
	`H–loWÜld
(), 
cÚfig
=
tutcÚf
)

34 #Thi 
b¿nch
 
is
 
the
 
‹¡
 
su™e
; 
you
 
ÿn
 
ignÜe
 
™
.

35 
ch”rypy
.
Œ“
.
	`mouÁ
(
	`H–loWÜld
(), 
cÚfig
=
tutcÚf
)

	@trunk/objs/CherryPy-3.2.4/cherrypy/tutorial/tut02_expose_methods.py

2 
	gTutÜŸl
 - 
MuÉË
 
m‘hods


4 
This
 
tutÜŸl
 
shows
 
you
 
how
 
to
 
lšk
Ø
Ùh”
 
m‘hods
 
of
 
your
 
»que¡


5 
	ghªdËr
.

8 
impÜt
 
ch”rypy


10 
şass
 
	gH–loWÜld
:

12 
def
 
	$šdex
(
£lf
):

15 
šdex
.
expo£d
 = 
True


17 
def
 
	$showMes§ge
(
£lf
):

20 
showMes§ge
.
expo£d
 = 
True


22 
impÜt
 
os
.
·th


23 
tutcÚf
 = 
os
.
·th
.
	`još
(os.·th.
	`dœÇme
(
__fe__
), 'tutorial.conf')

25 
__Çme__
 == '__main__':

26 #Ch”ryPy 
®ways
 
¡¬ts
 
w™h
 
­p
.
roÙ
 
wh’
 
Œyšg
 
to
 
m­
 
»que¡
 
URIs


27 #tØ
objeùs
, 
so
 
we
 
Ãed
 
to
 
mouÁ
 
a
 
»que¡
 
hªdËr
 
roÙ
. 
A
„equest

28 #tØ'/' 
wl
 
be
 
m­³d
 
to
 
	`H–loWÜld
().
	`šdex
().

29 
ch”rypy
.
	`quick¡¬t
(
	`H–loWÜld
(), 
cÚfig
=
tutcÚf
)

31 #Thi 
b¿nch
 
is
 
the
 
‹¡
 
su™e
; 
you
 
ÿn
 
ignÜe
 
™
.

32 
ch”rypy
.
Œ“
.
	`mouÁ
(
	`H–loWÜld
(), 
cÚfig
=
tutcÚf
)

	@trunk/objs/CherryPy-3.2.4/cherrypy/tutorial/tut03_get_and_post.py

2 
	gTutÜŸl
 - 
Passšg
 
v¬ŸbËs


4 
This
 
tutÜŸl
 
shows
 
you
 
how
 
to
 
·ss
 
	gGET
/
POST
 
v¬ŸbËs
Ø
	gm‘hods
.

7 
impÜt
 
ch”rypy


10 
şass
 
	gW–comePage
:

12 
def
 
	$šdex
(
£lf
):

13 #Ask 
the
 
u£r
's‚ame.

15 <
fÜm
 
aùiÚ
="g»‘U£r" 
m‘hod
="GET">

16 
Wh©
 
is
 
your
 
Çme
?

17 <
šput
 
ty³
="‹xt" 
Çme
="name" />

18 <
šput
 
ty³
="submit" />

19 </
fÜm
>'''

20 
šdex
.
expo£d
 = 
True


22 
def
 
	$g»‘U£r
(
£lf
, 
Çme
 = 
NÚe
):

23 #Ch”ryPy 
·s£s
 
®l
 
GET
 
ªd
 
POST
 
v¬ŸbËs
 
as
 
m‘hod
 
·¿m‘”s
.

24 #Iˆ
dÛ¢
't make‡ difference wherehe variables come from, how

25 #Ïrg
theœ
 
cÚ‹Ás
 
¬e
, 
ªd
 
so
 
Ú
.

26 #
#You 
ÿn
 
defše
  
·¿m‘”
 
v®ues
 
as
 
usu®
. 
In
 
this


27 #exam¶e, 
the
 "Çme" 
·¿m‘”
 
deçuÉs
 
to
 
NÚe
 
so
 
we
 
ÿn
 
check


28 #ià
a
 
Çme
 
was
 
aùu®ly
 
¥ecif›d
.

30 
Çme
:

31 #G»‘ 
the
 
u£r
!

32  "Hey %s, wh©' up?" % 
Çme


34 
Çme
 
is
 
NÚe
:

35 #NØ
Çme
 
was
 
¥ecif›d


39 
g»‘U£r
.
expo£d
 = 
True


42 
impÜt
 
os
.
·th


43 
tutcÚf
 = 
os
.
·th
.
	`još
(os.·th.
	`dœÇme
(
__fe__
), 'tutorial.conf')

45 
__Çme__
 == '__main__':

46 #Ch”ryPy 
®ways
 
¡¬ts
 
w™h
 
­p
.
roÙ
 
wh’
 
Œyšg
 
to
 
m­
 
»que¡
 
URIs


47 #tØ
objeùs
, 
so
 
we
 
Ãed
 
to
 
mouÁ
 
a
 
»que¡
 
hªdËr
 
roÙ
. 
A
„equest

48 #tØ'/' 
wl
 
be
 
m­³d
 
to
 
	`H–loWÜld
().
	`šdex
().

49 
ch”rypy
.
	`quick¡¬t
(
	`W–comePage
(), 
cÚfig
=
tutcÚf
)

51 #Thi 
b¿nch
 
is
 
the
 
‹¡
 
su™e
; 
you
 
ÿn
 
ignÜe
 
™
.

52 
ch”rypy
.
Œ“
.
	`mouÁ
(
	`W–comePage
(), 
cÚfig
=
tutcÚf
)

	@trunk/objs/CherryPy-3.2.4/cherrypy/tutorial/tut04_complex_site.py

2 
	gTutÜŸl
 - 
MuÉË
 
objeùs


4 
This
 
tutÜŸl
 
shows
 
you
 
how
 
to
 
ü—‹
 
a
 
s™e
 
¡ruùu»
 
through
 
muÉË


5 
possibly
 
Ã¡ed
 
»que¡
 
hªdËr
 
	gobjeùs
.

8 
impÜt
 
ch”rypy


11 
şass
 
	gHomePage
:

12 
def
 
	$šdex
(
£lf
):

14 <
p
>
Hi
, 
this
 
is
 
the
 
home
 
·ge
! 
Check
 
out
h
Ùh”


15 
fun
 
¡uff
 
Ú
 
this
 
s™e
:</
p
>

17 <
ul
>

18 <
li
><
a
 
h»f
="/joke/">
A
 
sly
 
joke
</a></li>

19 <
li
><
a
 
h»f
="/lšks/">
U£ful
 
lšks
</a></li>

20 </
ul
>'''

21 
šdex
.
expo£d
 = 
True


24 
şass
 
JokePage
:

25 
def
 
	$šdex
(
£lf
):

27 <
p
>"In Python, how do you create‡ string of„andom

28 
ch¬aù”s
?" -- "
R—d
 
a
 
P”l
 
fe
!"</p>

29 <
p
>[<
a
 
h»f
="../">
R‘uº
</a>]</p>'''

30 
šdex
.
expo£d
 = 
True


33 
şass
 
LšksPage
:

34 
def
 
	$__š™__
(
£lf
):

35 #Reque¡ 
hªdËr
 
objeùs
 
ÿn
 
ü—‹
 
theœ
 
own
 
Ã¡ed
 
»que¡


36 #hªdË¸
objeùs
. 
Sim¶y
 
ü—‹
 
them
 
šside
 
theœ
 
__š™__


38 
£lf
.
exŒa
 = 
	$ExŒaLšksPage
()

40 
def
 
	$šdex
(
£lf
):

41 #NÙ
the
 
way
 
we
 
lšk
 
to
h
exŒa
 
lšks
 
	`·ge
 (
ªd
 
back
).

42 #A 
you
 
ÿn
 
£e
, 
this
 
objeù
 
dÛ¢
't„eally care‡bout its

43 #absŞu‹ 
pos™iÚ
 
š
 
the
 
s™e
 
Œ“
, 
sšû
 
we
 
u£
 
»Ïtive


44 #lšk 
exşusiv–y
.

46 <
p
>
H”e
 
¬e
 
some
 
u£ful
 
lšks
:</p>

48 <
ul
>

49 <
li
><
a
 
h»f
="h‰p://www.ch”rypy.Üg">
The
 
Ch”ryPy
 
Hom•age
</a></li>

50 <
li
><
a
 
h»f
="h‰p://www.pythÚ.Üg">
The
 
PythÚ
 
Hom•age
</a></li>

51 </
ul
>

53 <
p
>
You
 
ÿn
 
check
 
out
 
some
 
exŒa
 
u£ful


54 
lšks
 <
a
 
h»f
="./exŒa/">
h”e
</a>.</
p
>

56 <
p
>[<
a
 
h»f
="../">
R‘uº
</a>]</p>

58 
šdex
.
expo£d
 = 
True


61 
şass
 
ExŒaLšksPage
:

62 
def
 
	$šdex
(
£lf
):

63 #NÙ
the
 
»Ïtive
 
lšk
 
back
 
to
h
Lšks
 
·ge
!

65 <
p
>
H”e
 
¬e
 
some
 
exŒa
 
u£ful
 
lšks
:</p>

67 <
ul
>

68 <
li
><
a
 
h»f
="h‰p://d–.icio.us">
d–
.
icio
.
us
</a></li>

69 <
li
><
a
 
h»f
="h‰p://www.mÜnog¿phy.de">
H’drik
's weblog</a></li>

70 </
ul
>

72 <
p
>[<
a
 
h»f
="../">
R‘uº
 
to
 
lšks
 
·ge
</a>]</p>'''

73 
šdex
.
expo£d
 = 
True


76 #Oà
cour£
 
we
 
ÿn
 
®so
 
mouÁ
 
»que¡
 
hªdËr
 
objeùs
 
right
 
h”e
!

77 
roÙ
 = 
	$HomePage
()

78 
roÙ
.
joke
 = 
	$JokePage
()

79 
roÙ
.
lšks
 = 
	$LšksPage
()

81 #Rememb”, 
we
 
dÚ
't‚eedo mount ExtraLinksPage here, because

82 #LšksPag
dÛs
 
th©
 
™£lf
 
Ú
 
š™Ÿliz©iÚ
. 
In
 
çù
, 
th”e
 
is


83 #nØ
»asÚ
 
why
 
you
 
shouldn
't†et your„oot objectake care of

84 #ü—tšg 
®l
 
cÚšed
 
»que¡
 
hªdËr
 
objeùs
.

87 
impÜt
 
os
.
·th


88 
tutcÚf
 = 
os
.
·th
.
	`još
(os.·th.
	`dœÇme
(
__fe__
), 'tutorial.conf')

90 
__Çme__
 == '__main__':

91 #Ch”ryPy 
®ways
 
¡¬ts
 
w™h
 
­p
.
roÙ
 
wh’
 
Œyšg
 
to
 
m­
 
»que¡
 
URIs


92 #tØ
objeùs
, 
so
 
we
 
Ãed
 
to
 
mouÁ
 
a
 
»que¡
 
hªdËr
 
roÙ
. 
A
„equest

93 #tØ'/' 
wl
 
be
 
m­³d
 
to
 
	`H–loWÜld
().
	`šdex
().

94 
ch”rypy
.
	$quick¡¬t
(
roÙ
, 
cÚfig
=
tutcÚf
)

96 #Thi 
b¿nch
 
is
 
the
 
‹¡
 
su™e
; 
you
 
ÿn
 
ignÜe
 
™
.

97 
ch”rypy
.
Œ“
.
	`mouÁ
(
roÙ
, 
cÚfig
=
tutcÚf
)

	@trunk/objs/CherryPy-3.2.4/cherrypy/tutorial/tut05_derived_objects.py

2 
	gTutÜŸl
 - 
Objeù
 
šh”™ªû


4 
You
 
¬e
 
ä“
 
to
 
d”ive
 
your
 
»que¡
 
hªdËr
 
şas£s
 
äom
 
ªy
 
ba£


5 
şass
 
you
 
	gwish
. 
In
 
mo¡
 
	g»®
-
wÜld
 
	g­¶iÿtiÚs
, you 
wl
 
´obably


6 
wªt
 
to
 
ü—‹
 
a
 
ûÁ¿l
 
ba£
 
şass
 
u£d
 
®l
 
your
 
	g·ges
, 
which
 
kes


7 
ÿ»
 
of
 
thšgs
 
like
 
´štšg
 
a
 
commÚ
 
·ge
 
h—d”
 
ªd
 
	gfoÙ”
.

10 
impÜt
 
ch”rypy


13 
şass
 
	gPage
:

14 #StÜ
the
 
·ge
 
t™Ë
 
š
 
a
 
şass
 
©Œibu‹


15 
t™Ë
 = 'Untitled Page'

17 
def
 
	$h—d”
(
£lf
):

19 <
html
>

20 <
h—d
>

21 <
t™Ë
>%
s
</title>

22 <
h—d
>

23 <
body
>

24 <
h2
>%
s
</h2>

27 
def
 
	$foÙ”
(
£lf
):

29 </
body
>

30 </
html
>

33 #NÙ
th©
 
h—d”
 
ªd
 
foÙ”
 
dÚ
't getheirƒxposed‡ttributes

34 #£ˆ
to
 
True
. 
This
 
i¢
'ˆÃûs§ry sšûhu£¸i¢'
t
 
suµo£d


35 #tØ
ÿÎ
 
h—d”
 
Ü
 
foÙ”
 
dœeùly
; 
š¡—d
, 
we
'll callhem from

36 #w™hš 
the
 
aùu®ly
 
expo£d
 
hªdËr
 
m‘hods
 
defšed
 
š
 
this


40 
şass
 
	$HomePage
(
Page
):

41 #Difã»Á 
t™Ë
 
this
 
·ge


42 
t™Ë
 = 'Tutorial 5'

44 
def
 
	$__š™__
(
£lf
):

45 #ü—‹ 
a
 
sub·ge


46 
£lf
.
ªÙh”
 = 
	$AnÙh”Page
()

48 
def
 
	$šdex
(
£lf
):

49 #NÙ
th©
 
we
 
ÿÎ
 
the
 
h—d”
 
ªd
 
foÙ”
 
m‘hods
 
šh”™ed


50 #äom 
the
 
Page
 
şass
!

51  
£lf
.
	`h—d”
() + '''

52 <
p
>

53 
I¢
'ˆthi exc™šg? Th”e'
s


54 <
a
 
h»f
="./ªÙh”/">
ªÙh”
 
·ge
</a>, 
too
!

55 </
p
>

57 
šdex
.
expo£d
 = 
True


60 
şass
 
	$AnÙh”Page
(
Page
):

61 
t™Ë
 = 'Another Page'

63 
def
 
	$šdex
(
£lf
):

64  
£lf
.
	`h—d”
() + '''

65 <
p
>

66 
And
 
this
 
is
 
the
 
amazšg
 
£cÚd
 
·ge
!

67 </
p
>

69 
šdex
.
expo£d
 = 
True


72 
impÜt
 
os
.
·th


73 
tutcÚf
 = 
os
.
·th
.
	`još
(os.·th.
	`dœÇme
(
__fe__
), 'tutorial.conf')

75 
__Çme__
 == '__main__':

76 #Ch”ryPy 
®ways
 
¡¬ts
 
w™h
 
­p
.
roÙ
 
wh’
 
Œyšg
 
to
 
m­
 
»que¡
 
URIs


77 #tØ
objeùs
, 
so
 
we
 
Ãed
 
to
 
mouÁ
 
a
 
»que¡
 
hªdËr
 
roÙ
. 
A
„equest

78 #tØ'/' 
wl
 
be
 
m­³d
 
to
 
	`H–loWÜld
().
	`šdex
().

79 
ch”rypy
.
	`quick¡¬t
(
	`HomePage
(), 
cÚfig
=
tutcÚf
)

81 #Thi 
b¿nch
 
is
 
the
 
‹¡
 
su™e
; 
you
 
ÿn
 
ignÜe
 
™
.

82 
ch”rypy
.
Œ“
.
	`mouÁ
(
	`HomePage
(), 
cÚfig
=
tutcÚf
)

	@trunk/objs/CherryPy-3.2.4/cherrypy/tutorial/tut06_default_method.py

2 
	gTutÜŸl
 - 
The
  
m‘hod


4 
Reque¡
 
hªdËr
 
objeùs
 
ÿn
 
im¶em’t
 
a
 
m‘hod
 
	gÿÎed
 "deçuÉ" 
th©


5 
is
 
ÿÎed
 
wh’
 
no
 
Ùh”
 
su™abË
 
	gm‘hod
/
objeù
 
could
 
be
 
	gfound
.

6 
	gEs£ÁŸÎy
, 
Ch”ryPy2
 
	gÿn
't find‡ matching„equest handler object

7 
the
 
giv’
 
»que¡
 
	gURI
, 
™
 
wl
 
u£
h 
m‘hod
 
of
h
objeù


8 
loÿ‹d
 
d“³¡
 
Ú
 
the
 
URI
 
	g·th
.

10 
Usšg
 
this
 
mechªism
 
you
 
ÿn
 
—sy
 
simuÏ‹
 
vœtu®
 
URI
 
¡ruùu»s


11 
by
 
·rsšg
 
the
 
exŒa
 
URI
 
	g¡ršg
, 
which
 
you
 
ÿn
 
acûss
 
through


12 
	gch”rypy
.
	g»que¡
.
	gvœtu®P©h
.

14 
The
 
­¶iÿtiÚ
 
š
 
this
 
tutÜŸl
 
simuÏ‹s
 
ª
 
URI
 
¡ruùu»
 
lookšg


15 
	glike
 /
	gu£rs
/<
	gu£ºame
>. 
Sšû
 
	gthe
 <u£ºame> 
b™
 
wl
 
nÙ
 
be
 
found
 (
as


16 
th”e
 
¬e
 
no
 
m©chšg
 
m‘hods
), 
™
 
is
 
hªdËd
 
by
 
the
  
	gm‘hod
.

19 
impÜt
 
ch”rypy


22 
şass
 
	gU£rsPage
:

24 
def
 
	$šdex
(
£lf
):

25 #Sšû 
this
 
is
 
ju¡
 
a
 
¡upid
 
l™e
 
exam¶e
, 
we
'll simply

26 #di¥Ïy 
a
 
li¡
 
of
 
lšks
 
to
 
¿ndom
, 
made
-
up
 
u£rs
. 
In
‡ 
»®


27 #­¶iÿtiÚ, 
this
 
could
 
be
 
g’”©ed
 
äom
 
a
 
d©aba£
 
»suÉ
 
£t
.

29 <
a
 
h»f
="./»mi">
Remi
 
D–Ú
</a><
br
/>

30 <
a
 
h»f
="./h’drik">
H’drik
 
Mªs
</a><
br
/>

31 <
a
 
h»f
="./lÜ’zo">
LÜ’zo
 
Lamas
</a><
br
/>

33 
šdex
.
expo£d
 = 
True


35 
def
 (
£lf
, 
u£r
):

36 #H”
we
 
»aù
 
d•’dšg
 
Ú
 
the
 
vœtu®P©h
 --h
·¹
 
of
he

37 #·th 
th©
 
could
 
nÙ
 
be
 
m­³d
 
to
 
ª
 
objeù
 
m‘hod
. 
In
 
a
 
»®


38 #­¶iÿtiÚ, 
we
 
would
 
´obably
 dØ
some
 
d©aba£
 
lookups
 
h”e


39 #š¡—d 
of
 
the
 
sly
 /
–if
/
cÚ¡ruù
.

40 
u£r
 == 'remi':

41 
out
 = "Remi Delon, CherryPy†ead developer"

42 
–if
 
u£r
 == 'hendrik':

43 
out
 = "Hendrik Mans, CherryPy co-developer & crazy German"

44 
–if
 
u£r
 == 'lorenzo':

45 
out
 = "Lorenzo Lamas, famous‡ctor‡nd singer!"

47 
out
 = "Unknown user. :-("

49  '% (<¨h»f="./">back</a>)' % 
out


50 .
expo£d
 = 
True


53 
impÜt
 
os
.
·th


54 
tutcÚf
 = 
os
.
·th
.
	`još
(os.·th.
	`dœÇme
(
__fe__
), 'tutorial.conf')

56 
__Çme__
 == '__main__':

57 #Ch”ryPy 
®ways
 
¡¬ts
 
w™h
 
­p
.
roÙ
 
wh’
 
Œyšg
 
to
 
m­
 
»que¡
 
URIs


58 #tØ
objeùs
, 
so
 
we
 
Ãed
 
to
 
mouÁ
 
a
 
»que¡
 
hªdËr
 
roÙ
. 
A
„equest

59 #tØ'/' 
wl
 
be
 
m­³d
 
to
 
	`H–loWÜld
().
	`šdex
().

60 
ch”rypy
.
	`quick¡¬t
(
	`U£rsPage
(), 
cÚfig
=
tutcÚf
)

62 #Thi 
b¿nch
 
is
 
the
 
‹¡
 
su™e
; 
you
 
ÿn
 
ignÜe
 
™
.

63 
ch”rypy
.
Œ“
.
	`mouÁ
(
	`U£rsPage
(), 
cÚfig
=
tutcÚf
)

	@trunk/objs/CherryPy-3.2.4/cherrypy/tutorial/tut07_sessions.py

2 
	gTutÜŸl
 - 
SessiÚs


4 
StÜšg
 
£ssiÚ
 
d©a
 
š
 
Ch”ryPy
 
­¶iÿtiÚs
 
is
 
v”y
 
	g—sy
: 
ch”rypy


5 
´ovides
 
a
 
diùiÚ¬y
 
ÿÎed
 "£ssiÚ" 
th©
 
»´e£Ás
 
the
 
£ssiÚ


6 
d©a
 
the
 
cu¼’t
 
u£r
. 
If
 
you
 
u£
 
RAM
 
ba£d
 
£ssiÚs
, you 
ÿn
 
¡Üe


7 
ªy
 
kšd
 
of
 
objeù
 
što
 
th©
 
	gdiùiÚ¬y
; 
	gÙh”wi£
, 
you
 
¬e
 
lim™ed
 
to


8 
objeùs
 
th©
 
ÿn
 
be
 
	gpickËd
.

11 
impÜt
 
ch”rypy


14 
şass
 
	gH™CouÁ”
:

16 
_ı_cÚfig
 = {'toŞs.£ssiÚs.Ú': 
True
}

18 
def
 
	$šdex
(
£lf
):

19 #Inü—£ 
the
 
sly
 
h™
 
couÁ”


20 
couÁ
 = 
ch”rypy
.
£ssiÚ
.
	`g‘
('count', 0) + 1

22 #StÜ
the
 
Ãw
 
v®ue
 
š
h
£ssiÚ
 
diùiÚ¬y


23 
ch”rypy
.
£ssiÚ
['couÁ'] = 
couÁ


25 #And 
di¥Ïy
 
a
 
sly
 
h™
 
couÁ
 
mes§ge
!

27 
Duršg
 
your
 
cu¼’t
 
£ssiÚ
, 
you
've viewedhis

28 
·ge
 %
s
 
times
! 
Your
 
liã
 
is
 
a
 
·tio
 
of
 
fun
!

30 
šdex
.
expo£d
 = 
True


33 
impÜt
 
os
.
·th


34 
tutcÚf
 = 
os
.
·th
.
	`još
(os.·th.
	`dœÇme
(
__fe__
), 'tutorial.conf')

36 
__Çme__
 == '__main__':

37 #Ch”ryPy 
®ways
 
¡¬ts
 
w™h
 
­p
.
roÙ
 
wh’
 
Œyšg
 
to
 
m­
 
»que¡
 
URIs


38 #tØ
objeùs
, 
so
 
we
 
Ãed
 
to
 
mouÁ
 
a
 
»que¡
 
hªdËr
 
roÙ
. 
A
„equest

39 #tØ'/' 
wl
 
be
 
m­³d
 
to
 
	`H–loWÜld
().
	`šdex
().

40 
ch”rypy
.
	`quick¡¬t
(
	`H™CouÁ”
(), 
cÚfig
=
tutcÚf
)

42 #Thi 
b¿nch
 
is
 
the
 
‹¡
 
su™e
; 
you
 
ÿn
 
ignÜe
 
™
.

43 
ch”rypy
.
Œ“
.
	`mouÁ
(
	`H™CouÁ”
(), 
cÚfig
=
tutcÚf
)

	@trunk/objs/CherryPy-3.2.4/cherrypy/tutorial/tut08_generators_and_yield.py

2 
BÚus
 
	gTutÜŸl
: 
Usšg
 
g’”©Üs
 
to
  
»suÉ
 
bod›s


4 
In¡—d
 
of
 
»tuºšg
 
a
 
com¶‘e
 
»suÉ
 
¡ršg
, 
you
 
ÿn
 
u£
 
the
 
y›ld


5 
¡©em’t
 
to
  
Úe
 
»suÉ
 
·¹
 
aá”
 
	gªÙh”
. 
This
 
may
 
be
 
cÚv’›Á


6 
š
 
s™u©iÚs
 
wh”e
 
usšg
 
a
 
‹m¶©e
 
·ckage
 
like
 
Ch”ryPy
 
Ü
 
Ch“h


7 
would
 
be
 
	gov”kl
, 
ªd
 
messy
 
¡ršg
 
cÚÿ‹ÇtiÚ
 
too
 
	guncoŞ
. ;-)

10 
impÜt
 
ch”rypy


13 
şass
 
	gG’”©ÜDemo
:

15 
def
 
	$h—d”
(
£lf
):

18 
def
 
	$foÙ”
(
£lf
):

21 
def
 
	$šdex
(
£lf
):

23 
u£rs
 = ['Remi', 'Carlos', 'Hendrik', 'Lorenzo Lamas']

25 #Ev”y 
y›ld
 
lše
 
adds
 
Úe
 
·¹
 
to
 
the
 
tÙ®
 
»suÉ
 
body
.

26 
y›ld
 
£lf
.
	$h—d”
()

27 
y›ld
 "<h3>List of users:</h3>"

29 
u£r
 
š
 
u£rs
:

30 
y›ld
 "%s<br/>" % 
u£r


32 
y›ld
 
£lf
.
	$foÙ”
()

33 
šdex
.
expo£d
 = 
True


36 
impÜt
 
os
.
·th


37 
tutcÚf
 = 
os
.
·th
.
	`još
(os.·th.
	`dœÇme
(
__fe__
), 'tutorial.conf')

39 
__Çme__
 == '__main__':

40 #Ch”ryPy 
®ways
 
¡¬ts
 
w™h
 
­p
.
roÙ
 
wh’
 
Œyšg
 
to
 
m­
 
»que¡
 
URIs


41 #tØ
objeùs
, 
so
 
we
 
Ãed
 
to
 
mouÁ
 
a
 
»que¡
 
hªdËr
 
roÙ
. 
A
„equest

42 #tØ'/' 
wl
 
be
 
m­³d
 
to
 
	`H–loWÜld
().
	`šdex
().

43 
ch”rypy
.
	`quick¡¬t
(
	`G’”©ÜDemo
(), 
cÚfig
=
tutcÚf
)

45 #Thi 
b¿nch
 
is
 
the
 
‹¡
 
su™e
; 
you
 
ÿn
 
ignÜe
 
™
.

46 
ch”rypy
.
Œ“
.
	`mouÁ
(
	`G’”©ÜDemo
(), 
cÚfig
=
tutcÚf
)

	@trunk/objs/CherryPy-3.2.4/cherrypy/tutorial/tut09_files.py

3 
	gTutÜŸl
: 
Fe
 
u¶ßd
 
ªd
 
dowÆßd


5 
U¶ßds


8 
Wh’
 
a
 
ş›Á
 
u¶ßds
‡ 
fe
 
to
‡ 
Ch”ryPy
 
­¶iÿtiÚ
, 
	g™
's…laced

9 
Ú
 
disk
 
	gimmedŸ‹ly
. 
Ch”ryPy
 
wl
 
·ss
 
™
 
to
 
your
 
expo£d
 
m‘hod


10 
as
 
ª
 
¬gum’t
 (
£e
 "myFe" 
b–ow
); 
th©
 
¬g
 
wl
 
have
 
	ga
 "file"

11 
	g©Œibu‹
, 
which
 
is
 
a
 
hªdË
 
to
 
the
 
‹mpÜ¬y
 
u¶ßded
 
	gfe
.

12 
If
 
you
 
wish
 
to
 
³rmª’y
 
§ve
 
the
 
	gfe
, you 
Ãed
Ø
	$»ad
()

13 
äom
 
myFe
.
fe
 
ªd
 
	$wr™e
(è
somewh”e
 .

15 
NÙe
 
the
 
u£
 
of
 '’ùy³="muÉ¬t/fÜm-d©a"' 
ªd
 'inputype="file"'

16 
š
 
the
 
HTML
 
which
h
ş›Á
 
u£s
 
to
 
u¶ßd
h
fe
.

19 
DowÆßds


22 
If
 
you
 
wish
 
to
 
£nd
 
a
 
fe
Ø
the
 
ş›Á
, you 
have
 
two
 
İtiÚs
:

23 
Fœ¡
, 
you
 
ÿn
 
sim¶y
  
a
 
fe
-
like
 
objeù
 
äom
 
your
 
·ge
 
hªdËr
.

24 
Ch”ryPy
 
wl
 
»ad
 
the
 
fe
 
ªd
 
£rve
 
™
 
as
h
	$cÚ‹Á
 (
HTTP
 
body
)

25 
of
 
the
 
»¥Ú£
. 
Howev”
, 
th©
 
dÛ¢
'tellhe clienthat

26 
the
 
»¥Ú£
 
is
 
a
 
fe
 
to
 
be
 
§ved
, 
¿th”
 
thª
 
di¥Ïyed
.

27 
U£
 
ch”rypy
.
lib
..
£rve_fe
 
th©
; 
™
 
kes
 
four


28 
¬gum’ts
:

30 
	$£rve_fe
(
·th
, 
cÚ‹Á_ty³
=
NÚe
, 
di¥os™iÚ
=NÚe, 
Çme
=None)

32 
S‘
 "Çme" 
to
 
the
 
f’ame
 
th©
 
you
 
ex³ù
 
ş›Ás
Ø
u£
 
wh’
 
they
 
§ve


33 
your
 
fe
. 
NÙe
 
th©
 
the
 "Çme" 
¬gum’t
 
is
 
ignÜed
 
you
 
dÚ
't‡lso

34 
´ovide
 
a
 "di¥os™iÚ" (
usu®ly
 "©chem’t"). 
You
 
ÿn
 
mªu®ly
 
£t


35 "cÚ‹Á_ty³", 
but
 
be
 
aw¬e
 
th©
 
you
 
®so
 
u£
 
the
 
’codšg
 
toŞ
, 
™


36 
may
 
choke
 
the
 
fe
 
ex‹nsiÚ
 
is
 
nÙ
 
»cognized
 
as
 
b–Úgšg
 
to
 
a
 
known


37 
CÚ‹Á
-
Ty³
. 
S‘tšg
 
the
 
cÚ‹Á_ty³
 
to
 "­¶iÿtiÚ/x-dowÆßd" 
wÜks


38 
š
 
mo¡
 
ÿ£s
, 
ªd
 
should
 
´om±
 
the
 
u£r
 
w™h
 
ª
 
O³n
/
Save
 
dŸlog
 in

39 
pİuÏr
 
brow£rs
.

43 
impÜt
 
os


44 
loÿlDœ
 = 
os
.
·th
.
	$dœÇme
(
__fe__
)

45 
absDœ
 = 
os
.
·th
.
	`još
(os.
	`g‘cwd
(), 
loÿlDœ
)

47 
impÜt
 
ch”rypy


48 
äom
 
ch”rypy
.
lib
 
impÜt
 

51 
şass
 
	$FeDemo
(
objeù
):

53 
def
 
	$šdex
(
£lf
):

55 <
html
><
body
>

56 <
h2
>
U¶ßd
 
a
 
fe
</h2>

57 <
fÜm
 
aùiÚ
="u¶ßd" 
m‘hod
="po¡" 
’ùy³
="multipart/form-data">

58 
f’ame
: <
šput
 
ty³
="fe" 
Çme
="myFe" /><
br
 />

59 <
šput
 
ty³
="submit" />

60 </
fÜm
>

61 <
h2
>
DowÆßd
 
a
 
fe
</h2>

62 <
a
 
h»f
='dowÆßd'>
This
 
Úe
</a>

63 </
body
></
html
>

65 
šdex
.
expo£d
 = 
True


67 
def
 
	$u¶ßd
(
£lf
, 
myFe
):

68 
out
 = """<html>

69 <
body
>

70 
myFe
 
Ëngth
: %
s
<
br
 />

71 
myFe
 
f’ame
: %
s
<
br
 />

72 
myFe
 
mime
-
ty³
: %
s


73 </
body
>

74 </
html
>"""

76 #AÉhough 
this
 
ju¡
 
couÁs
 
the
 
fe
 
Ëngth
, 
™
 
demÚ¡¿‹s


77 #how 
to
 
»ad
 
Ïrge
 
fes
 
š
 
chunks
 
š¡—d
 
of
 
®l
 
©
 
Úû
.

78 #Ch”ryPy 
»ads
 
the
 
u¶ßded
 
fe
 
što
 
a
 
‹mpÜ¬y
 file;

79 #myFe.
fe
.
»ad
 
»ads
 
äom
 
th©
.

80 
size
 = 0

81 
True
:

82 
d©a
 = 
myFe
.
fe
.
	$»ad
(8192)

83 
nÙ
 
d©a
:

85 
size
 +ğ
	$Ën
(
d©a
)

87  
out
 % (
size
, 
myFe
.
f’ame
, myFe.
cÚ‹Á_ty³
)

88 
u¶ßd
.
expo£d
 = 
True


90 
def
 
	$dowÆßd
(
£lf
):

91 
·th
 = 
os
.·th.
	`još
(
absDœ
, "pdf_file.pdf")

92  .
	`£rve_fe
(
·th
, "application/x-download",

93 "©chm’t", 
os
.
·th
.
	$ba£Çme
(
·th
))

94 
dowÆßd
.
expo£d
 = 
True


97 
impÜt
 
os
.
·th


98 
tutcÚf
 = 
os
.
·th
.
	`još
(os.·th.
	`dœÇme
(
__fe__
), 'tutorial.conf')

100 
__Çme__
 == '__main__':

101 #Ch”ryPy 
®ways
 
¡¬ts
 
w™h
 
­p
.
roÙ
 
wh’
 
Œyšg
 
to
 
m­
 
»que¡
 
URIs


102 #tØ
objeùs
, 
so
 
we
 
Ãed
 
to
 
mouÁ
 
a
 
»que¡
 
hªdËr
 
roÙ
. 
A
„equest

103 #tØ'/' 
wl
 
be
 
m­³d
 
to
 
	`H–loWÜld
().
	`šdex
().

104 
ch”rypy
.
	`quick¡¬t
(
	`FeDemo
(), 
cÚfig
=
tutcÚf
)

106 #Thi 
b¿nch
 
is
 
the
 
‹¡
 
su™e
; 
you
 
ÿn
 
ignÜe
 
™
.

107 
ch”rypy
.
Œ“
.
	`mouÁ
(
	`FeDemo
(), 
cÚfig
=
tutcÚf
)

	@trunk/objs/CherryPy-3.2.4/cherrypy/tutorial/tut10_http_errors.py

3 
	gTutÜŸl
: 
HTTP
 
”rÜs


5 
HTTPE¼Ü
 
is
 
u£d
 
to
  
ª
 
”rÜ
 
»¥Ú£
Ø
the
 
ş›Á
.

6 
Ch”ryPy
 
has
 
lÙs
 
of
 
İtiÚs
 
»g¬dšg
 
how
 
such
 
”rÜs
 
¬e


7 
logged
, 
	gdi¥Ïyed
, 
ªd
 
	gfÜm©‹d
.

11 
impÜt
 
os


12 
	gloÿlDœ
 = 
os
.
·th
.
	$dœÇme
(
__fe__
)

13 
cu½©h
 = 
os
.
·th
.
	`nÜm·th
(os.·th.
	`još
(os.
	`g‘cwd
(), 
loÿlDœ
))

15 
impÜt
 
ch”rypy


18 
şass
 
	$HTTPE¼ÜDemo
(
objeù
):

20 #S‘ 
a
 
cu¡om
 
»¥Ú£
 403 
”rÜs
.

21 
_ı_cÚfig
 = {'”rÜ_·ge.403' : 
os
.
·th
.
	`još
(
cu½©h
, "cu¡om_”rÜ.html")
	}
}

23 
def
 
	$šdex
(
£lf
):

24 #di¥Ïy 
some
 
lšks
 
th©
 
wl
 
»suÉ
 
š
 
”rÜs


25 
Œaûbacks
 = 
ch”rypy
.
»que¡
.
show_Œaûbacks


26 
Œaûbacks
:

27 
Œaû
 = 'off'

29 
Œaû
 = 'on'

32 <
html
><
body
>

33 <
p
>
ToggË
 
Œaûbacks
 <
a
 
h»f
="toggËT¿ûbacks">%
s
</a></p>

34 <
p
><
a
 
h»f
="/dÛsNÙExi¡">
Click
 
me
; 
I
'm‡ broken†ink!</a></p>

35 <
p
><
a
 
h»f
="/”rÜ?code=403">
U£
‡ 
cu¡om
 
”rÜ
 
·ge
 
äom
‡ 
fe
.</a></p>

36 <
p
>
The£
 
”rÜs
 
¬e
 
ex¶ic™ly
 
¿i£d
 
by
 
the
 
­¶iÿtiÚ
:</p>

37 <
ul
>

38 <
li
><
a
 
h»f
="/error?code=400">400</a></li>

39 <
li
><
a
 
h»f
="/error?code=401">401</a></li>

40 <
li
><
a
 
h»f
="/error?code=402">402</a></li>

41 <
li
><
a
 
h»f
="/error?code=500">500</a></li>

42 </
ul
>

43 <
p
><
a
 
h»f
="/mes§geArg">
You
 
ÿn
 
®so
 
£t
 
the
 
»¥Ú£
 
body


44 
wh’
 
you
 
¿i£
 
ª
 
”rÜ
.</
a
></
p
>

45 </
body
></
html
>

47 
šdex
.
expo£d
 = 
True


49 
def
 
	$toggËT¿ûbacks
(
£lf
):

50 #sim¶
funùiÚ
 
to
 
toggË
 
Œaûbacks
 
Ú
 
ªd
 
off


51 
Œaûbacks
 = 
ch”rypy
.
»que¡
.
show_Œaûbacks


52 
ch”rypy
.
cÚfig
.
	`upd©e
({'»que¡.show_Œaûbacks': 
nÙ
 
Œaûbacks
})

54 #»dœeù 
back
 
to
 
the
 
šdex


55 
¿i£
 
ch”rypy
.
HTTPRedœeù
('/')

56 
toggËT¿ûbacks
.
expo£d
 = 
True


58 
def
 
	$”rÜ
(
£lf
, 
code
):

59 #¿i£ 
ª
 
”rÜ
 
ba£d
 
Ú
 
the
 
g‘
 
qu”y


60 
¿i£
 
ch”rypy
.
	$HTTPE¼Ü
(
¡©us
 = 
code
)

61 
”rÜ
.
expo£d
 = 
True


63 
def
 
	$mes§geArg
(
£lf
):

64 
mes§ge
 = ("If you construct‡n HTTPError with‡ 'message' "

67 
¿i£
 
ch”rypy
.
	$HTTPE¼Ü
(500, 
mes§ge
=message)

68 
mes§geArg
.
expo£d
 = 
True


71 
impÜt
 
os
.
·th


72 
tutcÚf
 = 
os
.
·th
.
	`još
(os.·th.
	`dœÇme
(
__fe__
), 'tutorial.conf')

74 
__Çme__
 == '__main__':

75 #Ch”ryPy 
®ways
 
¡¬ts
 
w™h
 
­p
.
roÙ
 
wh’
 
Œyšg
 
to
 
m­
 
»que¡
 
URIs


76 #tØ
objeùs
, 
so
 
we
 
Ãed
 
to
 
mouÁ
 
a
 
»que¡
 
hªdËr
 
roÙ
. 
A
„equest

77 #tØ'/' 
wl
 
be
 
m­³d
 
to
 
	`H–loWÜld
().
	`šdex
().

78 
ch”rypy
.
	`quick¡¬t
(
	`HTTPE¼ÜDemo
(), 
cÚfig
=
tutcÚf
)

80 #Thi 
b¿nch
 
is
 
the
 
‹¡
 
su™e
; 
you
 
ÿn
 
ignÜe
 
™
.

81 
ch”rypy
.
Œ“
.
	`mouÁ
(
	`HTTPE¼ÜDemo
(), 
cÚfig
=
tutcÚf
)

	@trunk/objs/CherryPy-3.2.4/cherrypy/tutorial/tutorial.conf

1 [
glob®
]

2 
	g£rv”
.
	gsock‘_ho¡
 = "127.0.0.1"

3 
£rv”
.
sock‘_pÜt
 = 8080

4 
£rv”
.
th»ad_poŞ
 = 10

	@trunk/objs/CherryPy-3.2.4/cherrypy/wsgiserver/__init__.py

1 
	g__®l__
 = ['HTTPRequest', 'HTTPConnection', 'HTTPServer',

9 
impÜt
 
sys


10 
	gsys
.
	gv”siÚ_šfo
 < (3, 0):

11 
äom
 
wsgi£rv”2
 
impÜt
 *

13 #L
sigh
. 
Boo
 
backw¬d
-
šcom·tibË
 
syÁax
.

14 
exec
('from .wsgiserver3 import *')

	@trunk/objs/CherryPy-3.2.4/cherrypy/wsgiserver/ssl_builtin.py

3 
The
 
s¦
 
moduË
 
mu¡
 
be
 
impÜbË
 
SSL
 
	gfunùiÚ®™y
.

5 
To
 
u£
 
this
 
	gmoduË
, 
	g£t
 ``
	gCh”ryPyWSGIS”v”
.
	gs¦_ad­‹r
`` 
to
 
ª
 
š¡ªû
 
	gof


6 ``
	gButšSSLAd­‹r
``.

9 
	gŒy
:

10 
impÜt
 
s¦


11 
exû±
 
ImpÜtE¼Ü
:

12 
s¦
 = 
NÚe


14 
Œy
:

15 
äom
 
_pyio
 
impÜt
 
DEFAULT_BUFFER_SIZE


16 
exû±
 
ImpÜtE¼Ü
:

17 
Œy
:

18 
äom
 
io
 
impÜt
 
DEFAULT_BUFFER_SIZE


19 
exû±
 
ImpÜtE¼Ü
:

20 
DEFAULT_BUFFER_SIZE
 = -1

22 
impÜt
 
sys


24 
äom
 
ch”rypy
 
impÜt
 
wsgi£rv”


27 
şass
 
	$ButšSSLAd­‹r
(
wsgi£rv”
.
SSLAd­‹r
):

30 
û¹ifiÿ‹
 = 
NÚe


33 
´iv©e_key
 = 
NÚe


36 
def
 
	$__š™__
(
£lf
, 
û¹ifiÿ‹
, 
´iv©e_key
, 
û¹ifiÿ‹_chaš
=
NÚe
):

37 
s¦
 
is
 
NÚe
:

38 
¿i£
 
	`ImpÜtE¼Ü
("You must installhe ssl moduleo use HTTPS.")

39 
£lf
.
û¹ifiÿ‹
 = certificate

40 
£lf
.
´iv©e_key
 =…rivate_key

41 
£lf
.
û¹ifiÿ‹_chaš
 = certificate_chain

43 
def
 
	$bšd
(
£lf
, 
sock
):

45  
sock


47 
def
 
	$w¿p
(
£lf
, 
sock
):

49 
Œy
:

50 
s
 = 
s¦
.
	$w¿p_sock‘
(
sock
, 
do_hªdshake_Ú_cÚÃù
=
True
,

51 
£rv”_side
=
True
, 
û¹fe
=
£lf
.
û¹ifiÿ‹
,

52 
keyfe
=
£lf
.
´iv©e_key
, 
s¦_v”siÚ
=
s¦
.
PROTOCOL_SSLv23
)

53 
exû±
 
s¦
.
SSLE¼Ü
:

54 
e
 = 
sys
.
	`exc_šfo
()[1]

55 
e
.
”ºo
 =ğ
s¦
.
SSL_ERROR_EOF
:

56 #Thi 
is
 
®mo¡
 
û¹ašly
 
due
 
to
 
the
 
ch”rypy
 
’gše


57 #'
pšgšg
'hsock‘Øas£¹ it'
s
 
cÚÃùabË
;

58 #th'pšg' 
i¢
't SSL.

59  
NÚe
, {
	}
}

60 
–if
 
	ge
.
	g”ºo
 =ğ
s¦
.
SSL_ERROR_SSL
:

61 
e
.
¬gs
[1].
’dsw™h
('http„equest'):

62 #Th
ş›Á
 
is
 
¥—kšg
 
HTTP
 
to
 
ª
 
HTTPS
 
£rv”
.

63 
¿i£
 
wsgi£rv”
.
NoSSLE¼Ü


64 
–if
 
e
.
¬gs
[1].
’dsw™h
('unknown…rotocol'):

65 #Th
ş›Á
 
is
 
¥—kšg
 
some
 
nÚ
-
HTTP
 
´ÙocŞ
.

66 #Drİ 
the
 
cÚn
.

67  
NÚe
, {}

68 
¿i£


69  
	gs
, 
	g£lf
.
	$g‘_’vœÚ
(
s
)

71 #TODO: 
fl
 
this
 
out
 
mÜe
 
w™h
 
mod
 
s¦
 
’v


72 
def
 
	$g‘_’vœÚ
(
£lf
, 
sock
):

74 
ch”
 = 
sock
.
	$ch”
()

75 
s¦_’vœÚ
 = {

78 'SSL_PROTOCOL': 
ch”
[1],

79 'SSL_CIPHER': 
ch”
[0]

80 ## 
SSL_VERSION_INTERFACE
 
¡ršg
 
The
 
mod_s¦
 
´og¿m
 
v”siÚ


81 ## 
SSL_VERSION_LIBRARY
 
¡ršg
 
The
 
O³nSSL
 
´og¿m
 
v”siÚ


82 
	}
}

83  
s¦_’vœÚ


85 
sys
.
v”siÚ_šfo
 >= (3, 0):

86 
def
 
makefe
(
£lf
, 
sock
, 
mode
='r', 
bufsize
=
DEFAULT_BUFFER_SIZE
):

87  
wsgi£rv”
.
	$CP_makefe
(
sock
, 
mode
, 
bufsize
)

89 
def
 
	`makefe
(
£lf
, 
sock
, 
mode
='r', 
bufsize
=
DEFAULT_BUFFER_SIZE
):

90  
wsgi£rv”
.
	`CP_feobjeù
(
sock
, 
mode
, 
bufsize
)

	@trunk/objs/CherryPy-3.2.4/cherrypy/wsgiserver/ssl_pyopenssl.py

3 
The
 
O³nSSL
 
moduË
 
mu¡
 
be
 
impÜbË
 
SSL
 
	gfunùiÚ®™y
.

4 
You
 
ÿn
 
obš
 
™
 
äom
 
	gh‰p
:

6 
To
 
u£
 
this
 
moduË
, 
£t
 
	gCh”ryPyWSGIS”v”
.
s¦_ad­‹r
 
to
 
ª
 
š¡ªû
 
of


7 
	gSSLAd­‹r
. 
Th”e
 
¬e
 
two
 
ways
 
to
 
u£
 
	gSSL
:

9 
M‘hod
 
OÃ


12 * ``
s¦_ad­‹r
.
cÚ‹xt
``: 
ª
 
š¡ªû
 
of
 
SSL
.
CÚ‹xt
.

14 
If
 
this
 
is
 
nÙ
 
NÚe
, 
™
 i 
assumed
 
to
 
be
 
ª
 
	gSSL
.
CÚ‹xt
 
	gš¡ªû
,

15 
ªd
 
wl
 
be
 
·s£d
 
to
 
	gSSL
.
CÚÃùiÚ
 
Ú
 
bšd
(). 
The
 
dev–İ”
 
is


16 
»¥ÚsibË
 
fÜmšg
 
a
 
v®id
 
CÚ‹xt
 
	gobjeù
. 
This
 
­´ßch
 
is


17 
to
 
be
 
´eã¼ed
 
mÜe
 
	gæexib™y
, 
	ge
.
	gg
. 
the
 
û¹
 
ªd
 
key
 
¬e


18 
¡»ams
 
š¡—d
 
of
 
	gfes
, 
Ü
 
Ãed
 
	gdeüy±iÚ
, o¸
	gSSL
.
SSLv3_METHOD


19 
is
 
desœed
 
š¡—d
 
of
 
the
  
	gSSL
.
	gSSLv23_METHOD
, 
	g‘c
. 
CÚsuÉ


20 
the
 
pyO³nSSL
 
docum’tiÚ
 
com¶‘e
 
	gİtiÚs
.

22 
M‘hod
 
Two
 (
shÜtcut
)

25 * ``
	gs¦_ad­‹r
.
	gû¹ifiÿ‹
``: 
the
 
f’ame
 
of
h
£rv”
 
SSL
 
û¹ifiÿ‹
.

26 * ``
s¦_ad­‹r
.
´iv©e_key
``: 
the
 
f’ame
 
of
h
£rv”
's…rivate key file.

28 
BÙh
 
¬e
 
NÚe
 
by
 . 
If
 
s¦_ad­‹r
.
cÚ‹xt
 
is
 NÚe, 
	gbut
 .
´iv©e_key


29 
	gªd
 .
û¹ifiÿ‹
 
¬e
 
bÙh
 
giv’
 
ªd
 
	gv®id
, 
they
 
wl
 
be
 
	g»ad
,‡nd 
the


30 
cÚ‹xt
 
wl
 
be
 
autom©iÿÎy
 
ü—‹d
 
äom
 
	gthem
.

33 
impÜt
 
sock‘


34 
impÜt
 
th»adšg


35 
impÜt
 
time


37 
äom
 
ch”rypy
 
impÜt
 
wsgi£rv”


39 
	gŒy
:

40 
äom
 
O³nSSL
 
impÜt
 
SSL


41 
äom
 
O³nSSL
 
impÜt
 
üy±o


42 
exû±
 
ImpÜtE¼Ü
:

43 
SSL
 = 
NÚe


46 
şass
 
	$SSL_feobjeù
(
wsgi£rv”
.
CP_feobjeù
):

49 
s¦_timeout
 = 3

50 
s¦_»Œy
 = .01

52 
def
 
	$_§ã_ÿÎ
(
£lf
, 
is_»ad”
, 
ÿÎ
, *
¬gs
, **
kw¬gs
):

55 
is_»ad”
: 
F®£
 
EOF
 
”rÜs
 
wl
 
be
 
¿i£d
. 
If
 
True
, EOFƒrrors

56 
wl
  "" (
to
 
emuÏ‹
 
nÜm®
 
sock‘s
).

58 
¡¬t
 = 
time
.
	$time
()

59 
True
:

60 
Œy
:

61  
	$ÿÎ
(*
¬gs
, **
kw¬gs
)

62 
exû±
 
SSL
.
WªtR—dE¼Ü
:

63 #SË• 
ªd
 
Œy
 
agaš
. 
This
 
is
 
dªg”ous
, 
beÿu£
 
™
 
m—ns


64 #th
»¡
 
of
 
the
 
¡ack
 
has
 
no
 
way
 oà
difã»ÁŸtšg


65 #b‘w“À
a
 "Ãw hªdshake" 
”rÜ
 
ªd
 "client dropped".

66 #NÙ
this
 
i¢
'ˆªƒndËs loİ:h”e'
s
 
a
 
timeout
 
b–ow
.

67 
time
.
	$¦“p
(
£lf
.
s¦_»Œy
)

68 
exû±
 
SSL
.
WªtWr™eE¼Ü
:

69 
time
.
	$¦“p
(
£lf
.
s¦_»Œy
)

70 
exû±
 
SSL
.
SysC®lE¼Ü
, 
e
:

71 
is_»ad”
 
ªd
 
e
.
¬gs
 == (-1, 'Unexpected EOF'):

74 
”ºum
 = 
e
.
¬gs
[0]

75 
is_»ad”
 
ªd
 
”ºum
 
š
 
wsgi£rv”
.
sock‘_”rÜs_to_ignÜe
:

77 
¿i£
 
sock‘
.
	$”rÜ
(
”ºum
)

78 
exû±
 
SSL
.
E¼Ü
, 
e
:

79 
is_»ad”
 
ªd
 
e
.
¬gs
 == (-1, 'Unexpected EOF'):

82 
thœd¬g
 = 
NÚe


83 
Œy
:

84 
thœd¬g
 = 
e
.
¬gs
[0][0][2]

85 
exû±
 
IndexE¼Ü
:

86 
·ss


88 
thœd¬g
 == 'http„equest':

89 #Th
ş›Á
 
is
 
lkšg
 
HTTP
 
to
 
ª
 
HTTPS
 
£rv”
.

90 
¿i£
 
wsgi£rv”
.
	$NoSSLE¼Ü
()

92 
¿i£
 
wsgi£rv”
.
	$F©®SSLAË¹
(*
e
.
¬gs
)

93 
exû±
:

94 
¿i£


96 
time
.
	`time
(è- 
¡¬t
 > 
£lf
.
s¦_timeout
:

97 
¿i£
 
sock‘
.
	`timeout
("timed out")

99 
def
 
	$»cv
(
£lf
, *
¬gs
, **
kw¬gs
):

100 
buf
 = []

101 
r
 = 
	`su³r
(
SSL_feobjeù
, 
£lf
).
»cv


102 
True
:

103 
d©a
 = 
£lf
.
	$_§ã_ÿÎ
(
True
, 
r
, *
¬gs
, **
kw¬gs
)

104 
buf
.
	$­³nd
(
d©a
)

105 
p
 = 
£lf
.
_sock
.
	$³ndšg
()

106 
nÙ
 
p
:

107  "".
	$još
(
buf
)

109 
def
 
	$£nd®l
(
£lf
, *
¬gs
, **
kw¬gs
):

110  
£lf
.
	`_§ã_ÿÎ
(
F®£
, 
	`su³r
(
SSL_feobjeù
, s–f).
£nd®l
,

111 *
¬gs
, **
kw¬gs
)

113 
def
 
	$£nd
(
£lf
, *
¬gs
, **
kw¬gs
):

114  
£lf
.
	`_§ã_ÿÎ
(
F®£
, 
	`su³r
(
SSL_feobjeù
, s–f).
£nd
,

115 *
¬gs
, **
kw¬gs
)

118 
şass
 
SSLCÚÃùiÚ
:

121 ``*
¬gs
``: 
the
 
¬gum’ts
 
to
 
ü—‹
h
w¿µed
 ``
SSL
.
	`CÚÃùiÚ
(*args)``.

124 
def
 
	$__š™__
(
£lf
, *
¬gs
):

125 
£lf
.
_s¦_cÚn
 = 
SSL
.
	$CÚÃùiÚ
(*
¬gs
)

126 
£lf
.
_lock
 = 
th»adšg
.
	$RLock
()

128 
f
 
	`š
 ('get_context', 'pending', 'send', 'write', 'recv', 'read',

136 
	`exec
("""def %s(self, *args):

137 
£lf
.
_lock
.
	$acquœe
()

138 
Œy
:

139  
£lf
.
_s¦_cÚn
.%
	$s
(*
¬gs
)

140 
fš®ly
:

141 
£lf
.
_lock
.
	`»Ëa£
()

144 
def
 
	$shutdown
(
£lf
, *
¬gs
):

145 
£lf
.
_lock
.
	$acquœe
()

146 
Œy
:

147 #pyO³nSSL.
sock‘
.
shutdown
 
kes
 
no
 
¬gs


148  
£lf
.
_s¦_cÚn
.
	$shutdown
()

149 
fš®ly
:

150 
£lf
.
_lock
.
	$»Ëa£
()

153 
şass
 
	$pyO³nSSLAd­‹r
(
wsgi£rv”
.
SSLAd­‹r
):

156 
cÚ‹xt
 = 
NÚe


159 
û¹ifiÿ‹
 = 
NÚe


162 
´iv©e_key
 = 
NÚe


165 
û¹ifiÿ‹_chaš
 = 
NÚe


168 
This
 
is
 
Ãeded
 
ch—³r
 "chašed„oÙ" 
SSL
 
û¹ifiÿ‹s
, 
ªd
 
should
 
be


169 
Ëá
 
as
 
NÚe
 
nÙ
 
»quœed
."""

171 
def
 
	$__š™__
(
£lf
, 
û¹ifiÿ‹
, 
´iv©e_key
, 
û¹ifiÿ‹_chaš
=
NÚe
):

172 
SSL
 
is
 
NÚe
:

173 
¿i£
 
	`ImpÜtE¼Ü
("You must install…yOpenSSLo use HTTPS.")

175 
£lf
.
cÚ‹xt
 = 
NÚe


176 
£lf
.
û¹ifiÿ‹
 = certificate

177 
£lf
.
´iv©e_key
 =…rivate_key

178 
£lf
.
û¹ifiÿ‹_chaš
 = certificate_chain

179 
£lf
.
_’vœÚ
 = 
NÚe


181 
def
 
	$bšd
(
£lf
, 
sock
):

183 
£lf
.
cÚ‹xt
 
is
 
NÚe
:

184 
£lf
.
cÚ‹xt
 = s–f.
	$g‘_cÚ‹xt
()

185 
cÚn
 = 
	$SSLCÚÃùiÚ
(
£lf
.
cÚ‹xt
, 
sock
)

186 
£lf
.
_’vœÚ
 = s–f.
	$g‘_’vœÚ
()

187  
cÚn


189 
def
 
	$w¿p
(
£lf
, 
sock
):

191  
sock
, 
£lf
.
_’vœÚ
.
	$cİy
()

193 
def
 
	$g‘_cÚ‹xt
(
£lf
):

195 #S“ 
h‰p
:

196 
c
 = 
SSL
.
	$CÚ‹xt
(
SSL
.
SSLv23_METHOD
)

197 
c
.
	$u£_´iv©ekey_fe
(
£lf
.
´iv©e_key
)

198 
£lf
.
û¹ifiÿ‹_chaš
:

199 
c
.
	$lßd_v”ify_loÿtiÚs
(
£lf
.
û¹ifiÿ‹_chaš
)

200 
c
.
	$u£_û¹ifiÿ‹_fe
(
£lf
.
û¹ifiÿ‹
)

201  
c


203 
def
 
	$g‘_’vœÚ
(
£lf
):

205 
s¦_’vœÚ
 = {

207 #pyO³nSSL 
dÛ¢
't…rovide‡ccesso‡ny ofhese AFAICT

209 ## 
SSL_CIPHER
 
¡ršg
 
The
 
ch”
 
¥ecifiÿtiÚ
 
Çme


210 ## 
SSL_VERSION_INTERFACE
 
¡ršg
 
The
 
mod_s¦
 
´og¿m
 
v”siÚ


211 ## 
SSL_VERSION_LIBRARY
 
¡ršg
 
The
 
O³nSSL
 
´og¿m
 
v”siÚ


212 
	}
}

214 
£lf
.
û¹ifiÿ‹
:

215 #S”v” 
û¹ifiÿ‹
 
©Œibu‹s


216 
û¹
 = 
İ’
(
£lf
.
û¹ifiÿ‹
, 'rb').
	$»ad
()

217 
û¹
 = 
üy±o
.
	$lßd_û¹ifiÿ‹
(
üy±o
.
FILETYPE_PEM
, 
û¹
)

218 
s¦_’vœÚ
.
	`upd©e
({

219 'SSL_SERVER_M_VERSION': 
û¹
.
	`g‘_v”siÚ
(),

220 'SSL_SERVER_M_SERIAL': 
û¹
.
	`g‘_£rŸl_numb”
(),

221 ## 'SSL_SERVER_V_START': 
V®id™y
 
of
 
£rv”
's certificate (startime),

222 ## 'SSL_SERVER_V_END': 
V®id™y
 
of
 
£rv”
's certificate (endime),

223 
	}
})

225 
	g´efix
, 
dn
 
	gš
 [("I", 
û¹
.
g‘_issu”
()),

226 ("S", 
û¹
.
g‘_subjeù
())]:

227 #X509Nam
objeùs
 
dÚ
't seemo have‡ wayo gethe

228 #com¶‘
DN
 
¡ršg
. 
U£
 
¡r
(è
ªd
 
¦iû
 
™
 
š¡—d
,

229 #beÿu£ 
¡r
(
dn
) == "<X509Name object '/C=US/ST=...'>"

230 
	gdn¡r
 = 
¡r
(
dn
)[18:-2]

232 
wsgikey
 = 'SSL_SERVER_%s_DN' % 
´efix


233 
s¦_’vœÚ
[
wsgikey
] = 
dn¡r


235 #Th
DN
 
should
 
be
 
of
 
the
 
fÜm
: /
k1
=
v1
/
k2
=
v2
, 
but
 
we
 
mu¡
 
®low


236 #fÜ 
ªy
 
v®ue
 
to
 
cÚš
 
¦ashes
 
™£lf
 (
š
 
a
 
URL
).

237 
	gdn¡r
:

238 
pos
 = 
dn¡r
.
rfšd
("=")

239 
dn¡r
, 
	gv®ue
 = dn¡r[:
pos
], 
	gdn¡r
[pos + 1:]

240 
pos
 = 
dn¡r
.
rfšd
("/")

241 
dn¡r
, 
	gkey
 = dn¡r[:
pos
], 
	gdn¡r
[pos + 1:]

242 
key
 
ªd
 
v®ue
:

243 
wsgikey
 = 'SSL_SERVER_%s_DN_%s' % (
´efix
, 
	gkey
)

244 
	gs¦_’vœÚ
[
wsgikey
] = 
v®ue


246  
s¦_’vœÚ


248 
def
 
makefe
(
£lf
, 
sock
, 
mode
='r', 
bufsize
=-1):

249 
SSL
 
ªd
 
	$isš¡ªû
(
sock
, 
SSL
.
CÚÃùiÚTy³
):

250 
timeout
 = 
sock
.
	$g‘timeout
()

251 
f
 = 
	$SSL_feobjeù
(
sock
, 
mode
, 
bufsize
)

252 
f
.
s¦_timeout
 = 
timeout


253  
f


255  
wsgi£rv”
.
	`CP_feobjeù
(
sock
, 
mode
, 
bufsize
)

	@trunk/objs/CherryPy-3.2.4/cherrypy/wsgiserver/wsgiserver2.py

3 
Sim¶e¡
 
exam¶e
 
Ú
 
how
 
to
 
u£
 
this
 
moduË
 
	gdœeùly


4 (
w™hout
 
usšg
 
	gCh”ryPy
's‡pplication machinery)::

6 
äom
 
ch”rypy
 
impÜt
 
wsgi£rv”


8 
def
 
	$my_üazy_­p
(
’vœÚ
, 
¡¬t_»¥Ú£
):

9 
¡©us
 = '200 OK'

10 
»¥Ú£_h—d”s
 = [('Content-type','text/plain')]

11 
	$¡¬t_»¥Ú£
(
¡©us
, 
»¥Ú£_h—d”s
)

14 
£rv”
 = 
wsgi£rv”
.
	`Ch”ryPyWSGIS”v”
(

15 ('0.0.0.0', 8070), 
my_üazy_­p
,

16 
£rv”_Çme
='www.cherrypy.example')

17 
£rv”
.
	$¡¬t
()

19 
The
 
Ch”ryPy
 
WSGI
 
£rv”
 
ÿn
 
£rve
 
as
 
mªy
 WSGI 
­¶iÿtiÚs


20 
as
 
you
 
wªt
 
š
 
Úe
 
š¡ªû
 
by
 
usšg
 
a
 
WSGIP©hInfoDi¥©ch”
::

22 
d
 = 
	`WSGIP©hInfoDi¥©ch”
({'/': 
my_üazy_­p
, '/blog': 
my_blog_­p
})

23 
£rv”
 = 
wsgi£rv”
.
Ch”ryPyWSGIS”v”
(('0.0.0.0', 80), 
d
)

25 
Wªt
 
SSL
 
	gsuµÜt
? 
Ju¡
 
£t
 
	g£rv”
.
s¦_ad­‹r
 
to
 
ª
 
SSLAd­‹r
 
	gš¡ªû
.

27 
This
 
	gwÚ
't callhe CherryPyƒngine (application side)‡t‡ll, onlyhe

28 
HTTP
 
	g£rv”
, 
which
 
is
 
šd•’d’t
 
äom
 
the
 
»¡
 
of
 
	gCh”ryPy
. 
	gDÚ
't

29 
Ët
 
the
 
	gÇme
 "Ch”ryPyWSGIS”v”" 
throw
 
	gyou
;h
Çme
 
m”–y
 
»æeùs


30 
™s
 
	gÜigš
, 
nÙ
 it 
	gcou¶šg
.

32 
FÜ
 
tho£
 
of
 
you
 
wªtšg
 
to
 
und”¡ªd
 
š‹º®s
 oà
this
 
	gmoduË
, 
	gh”e
'she

33 
basic
 
ÿÎ
 
	gæow
. 
The
 
	g£rv”
's†isteninghread„uns‡ veryight†oop,

34 
¡ickšg
 
šcomšg
 
cÚÃùiÚs
 
Úto
 
a
 
	gQueue
::

36 
£rv”
 = 
	$Ch”ryPyWSGIS”v”
(...)

37 
£rv”
.
	$¡¬t
()

38 
True
:

39 
	$tick
()

40 #Thi 
blocks
 
uÁ
 
a
 
»que¡
 
comes
 
š
:

41 
chd
 = 
sock‘
.
	$acû±
()

42 
cÚn
 = 
	$HTTPCÚÃùiÚ
(
chd
, ...)

43 
£rv”
.
»que¡s
.
	$put
(
cÚn
)

45 
WÜk”
 
th»ads
 
¬e
 
k•t
 
š
 
a
 
poŞ
 
ªd
 
pŞl
 
the
 
Queue
, 
pİpšg
 
off
‡nd 
th’


46 
hªdlšg
 
—ch
 
cÚÃùiÚ
 
š
 
tuº
. 
Each
 cÚÃùiÚ 
ÿn
 
cÚsi¡
 
of
 
ª
 
¬b™¿ry


47 
numb”
 
of
 
»que¡s
 
ªd
 
theœ
 
»¥Ú£s
, 
so
 
we
 
run
 
a
 
Ã¡ed
 
loİ
::

49 
True
:

50 
cÚn
 = 
£rv”
.
»que¡s
.
	$g‘
()

51 
cÚn
.
	`communiÿ‹
()

52 -> 
True
:

53 
»q
 = 
	$HTTPReque¡
(...)

54 
»q
.
	`·r£_»que¡
()

55 -> #R—d 
the
 
Reque¡
-
Lše
, 
e
.
g
. "GET /page HTTP/1.1"

56 
»q
.
rfe
.
	$»adlše
()

57 
	$»ad_h—d”s
(
»q
.
rfe
,„eq.
šh—d”s
)

58 
»q
.
	`»¥Úd
()

59 -> 
»¥Ú£
 = 
	$­p
(...)

60 
Œy
:

61 
chunk
 
š
 
»¥Ú£
:

62 
chunk
:

63 
»q
.
	$wr™e
(
chunk
)

64 
fš®ly
:

65 
	`ha§‰r
(
»¥Ú£
, "close"):

66 
»¥Ú£
.
	$şo£
()

67 
»q
.
şo£_cÚÃùiÚ
:

71 
__®l__
 = ['HTTPRequest', 'HTTPConnection', 'HTTPServer',

80 
impÜt
 
os


81 
Œy
:

82 
impÜt
 
queue


83 
exû±
:

84 
impÜt
 
Queue
 
as
 
queue


85 
impÜt
 
»


86 
impÜt
 
rfc822


87 
impÜt
 
sock‘


88 
impÜt
 
sys


89 'wš' 
š
 
sys
.
¶©fÜm
 
ªd
 
nÙ
 
	`ha§‰r
(
sock‘
, 'IPPROTO_IPV6'):

90 
sock‘
.
IPPROTO_IPV6
 = 41

91 
Œy
:

92 
impÜt
 
cSŒšgIO
 
as
 
SŒšgIO


93 
exû±
 
ImpÜtE¼Ü
:

94 
impÜt
 
SŒšgIO


95 
DEFAULT_BUFFER_SIZE
 = -1

97 
_feobjeù_u£s_¡r_ty³
 = 
	`isš¡ªû
(
sock‘
.
	`_feobjeù
(
NÚe
).
_rbuf
, 
ba£¡ršg
)

99 
impÜt
 
th»adšg


100 
impÜt
 
time


101 
impÜt
 
Œaûback


102 
def
 
	$fÜm©_exc
(
lim™
=
NÚe
):

104 
Œy
:

105 
‘y³
, 
v®ue
, 
tb
 = 
sys
.
	$exc_šfo
()

106  ''.
	`još
(
Œaûback
.
	$fÜm©_exû±iÚ
(
‘y³
, 
v®ue
, 
tb
, 
lim™
))

107 
fš®ly
:

108 
‘y³
 = 
v®ue
 = 
tb
 = 
NÚe


110 
impÜt
 
İ”©Ü


112 
äom
 
u¾lib
 
impÜt
 
unquÙe


113 
impÜt
 
w¬nšgs


115 
sys
.
v”siÚ_šfo
 >= (3, 0):

116 
by‹¡r
 = 
by‹s


117 
unicode¡r
 = 
¡r


118 
ba£¡ršg
 = (
by‹s
, 
¡r
)

119 
def
 
	`Áob
(
n
, 
’codšg
='ISO-8859-1'):

121 #IÀ
PythÚ
 3, 
the
 
Çtive
 
¡ršg
 
ty³
 
is
 
unicode


122  
n
.
	$’code
(
’codšg
)

124 
by‹¡r
 = 
¡r


125 
unicode¡r
 = 
unicode


126 
ba£¡ršg
 = basestring

127 
def
 
	`Áob
(
n
, 
’codšg
='ISO-8859-1'):

129 #IÀ
PythÚ
 2, 
the
 
Çtive
 
¡ršg
 
ty³
 
is
 
by‹s
. 
Assume
 
™
's‡lready

130 #š 
the
 
giv’
 
’codšg
, 
which
 
ISO
-8859-1 
is
 
®mo¡
 
®ways
 
wh©


131 #wa 
š‹nded
.

132  
n


134 
LF
 = 
	`Áob
('\n')

135 
CRLF
 = 
	`Áob
('\r\n')

136 
TAB
 = 
	`Áob
('\t')

137 
SPACE
 = 
	`Áob
(' ')

138 
COLON
 = 
	`Áob
(':')

139 
SEMICOLON
 = 
	`Áob
(';')

140 
EMPTY
 = 
	`Áob
('')

141 
NUMBER_SIGN
 = 
	`Áob
('#')

142 
QUESTION_MARK
 = 
	`Áob
('?')

143 
ASTERISK
 = 
	`Áob
('*')

144 
FORWARD_SLASH
 = 
	`Áob
('/')

145 
quÙed_¦ash
 = 
»
.
	`compe
(
	`Áob
("(?i)%2F"))

147 
impÜt
 
”ºo


149 
def
 
	$¶©_¥ecific_”rÜs
(*
”ºames
):

152 
The
 '”ºo' 
moduË
 
cÚšs
 
difã»Á
 
glob®
 
cÚ¡ªts
 
d•’dšg
 
Ú


153 
the
 
¥ecific
 
	`¶©fÜm
 (
OS
). 
This
 
funùiÚ
 
wl
 h
li¡
 
of


154 
num”ic
 
v®ues
 
a
 
giv’
 
li¡
 
of
 
pÙ’tŸl
 
Çmes
.

156 
”ºo_Çmes
 = 
	$dœ
(
”ºo
)

157 
nums
 = [
	$g‘©Œ
(
”ºo
, 
k
èk 
š
 
”ºames
 k iÀ
”ºo_Çmes
]

158 #de-
du³
 
the
 
li¡


159  
	`li¡
(
diù
.
	`äomkeys
(
nums
).
	$keys
())

161 
sock‘_”rÜ_ešŒ
 = 
	`¶©_¥ecific_”rÜs
("EINTR", "WSAEINTR")

163 
sock‘_”rÜs_to_ignÜe
 = 
	`¶©_¥ecific_”rÜs
(

174 
sock‘_”rÜs_to_ignÜe
.
	`­³nd
("timed out")

175 
sock‘_”rÜs_to_ignÜe
.
	`­³nd
("The„ead operationimed out")

177 
sock‘_”rÜs_nÚblockšg
 = 
	`¶©_¥ecific_”rÜs
(

180 
comma_£·¿‹d_h—d”s
 = [
	$Áob
(
h
èh 
š


189 
impÜt
 
loggšg


190 
nÙ
 
	`ha§‰r
(
loggšg
, '¡©i¡ics'):†oggšg.
¡©i¡ics
 = {
	}
}

193 
def
 
	$»ad_h—d”s
(
rfe
, 
hdiù
=
NÚe
):

196 
If
 
hdiù
 
is
 
NÚe
, 
a
 
Ãw
 
h—d”
 
diù
 i 
ü—‹d
. 
R‘uºs
 
the
 
pİuÏ‹d


197 
h—d”
 
diù
.

199 
H—d”s
 
which
 
¬e
 
»³©ed
‡» 
fŞded
 
tog‘h”
 
usšg
 
a
 
comma
 
theœ


200 
¥ecifiÿtiÚ
 
so
 
diù©es
.

202 
This
 
funùiÚ
 
¿i£s
 
V®ueE¼Ü
 
wh’
 
the
 
»ad
 
by‹s
 
viŞ©e
h
HTTP
 
¥ec
.

203 
You
 
should
 
´obably
  "400 Bad Reque¡" 
this
 
h­³ns
.

205 
hdiù
 
is
 
NÚe
:

206 
hdiù
 = {
	}
}

208 
True
:

209 
lše
 = 
rfe
.
	$»adlše
()

210 
nÙ
 
lše
:

211 #NØ
mÜe
 
d©a
--
Ëg®
 
’d
 
of
 
h—d”s


212 
¿i£
 
	`V®ueE¼Ü
("Illegalƒnd of headers.")

214 
lše
 =ğ
CRLF
:

215 #NÜm® 
’d
 
of
 
h—d”s


217 
nÙ
 
lše
.
	$’dsw™h
(
CRLF
):

218 
¿i£
 
	`V®ueE¼Ü
("HTTP„equires CRLFerminators")

220 
lše
[0] 
	$š
 (
SPACE
, 
TAB
):

222 
v
 = 
lše
.
	$¡r
()

224 
Œy
:

225 
k
, 
v
 = 
lše
.
	$¥l™
(
COLON
, 1)

226 
exû±
 
V®ueE¼Ü
:

227 
¿i£
 
	`V®ueE¼Ü
("Illegal header†ine.")

228 #TODO: 
wh©
 
about
 
TE
 
ªd
 
WWW
-
Auth’tiÿ‹
?

229 
k
 = k.
	`¡r
().
	$t™Ë
()

230 
v
 = v.
	$¡r
()

231 
hÇme
 = 
k


233 
k
 
š
 
comma_£·¿‹d_h—d”s
:

234 
exi¡šg
 = 
hdiù
.
	$g‘
(
hÇme
)

235 
exi¡šg
:

236 
v
 = ", ".
	`još
((
exi¡šg
, v))

237 
hdiù
[
hÇme
] = 
v


239  
hdiù


242 
şass
 
	$MaxSizeExûeded
(
Exû±iÚ
):

243 
·ss


245 
şass
 
	$SizeCheckW¿µ”
(
objeù
):

248 
def
 
	$__š™__
(
£lf
, 
rfe
, 
maxËn
):

249 
£lf
.
rfe
 =„file

250 
£lf
.
maxËn
 = maxlen

251 
£lf
.
by‹s_»ad
 = 0

253 
def
 
	$_check_Ëngth
(
£lf
):

254 
£lf
.
maxËn
 
ªd
 s–f.
by‹s_»ad
 > self.maxlen:

255 
¿i£
 
	$MaxSizeExûeded
()

257 
def
 
	$»ad
(
£lf
, 
size
=
NÚe
):

258 
d©a
 = 
£lf
.
rfe
.
	$»ad
(
size
)

259 
£lf
.
by‹s_»ad
 +ğ
	$Ën
(
d©a
)

260 
£lf
.
	$_check_Ëngth
()

261  
d©a


263 
def
 
	$»adlše
(
£lf
, 
size
=
NÚe
):

264 
size
 
is
 
nÙ
 
NÚe
:

265 
d©a
 = 
£lf
.
rfe
.
	$»adlše
(
size
)

266 
£lf
.
by‹s_»ad
 +ğ
	$Ën
(
d©a
)

267 
£lf
.
	$_check_Ëngth
()

268  
d©a


270 #U£¸
didn
't specify‡ size ...

271 #W
»ad
 
the
 
lše
 
š
 
chunks
 
to
 
make
 
su»
 
™
's‚ot‡ 100MB†ine !

272 
»s
 = []

273 
True
:

274 
d©a
 = 
£lf
.
rfe
.
	$»adlše
(256)

275 
£lf
.
by‹s_»ad
 +ğ
	$Ën
(
d©a
)

276 
£lf
.
	$_check_Ëngth
()

277 
»s
.
	$­³nd
(
d©a
)

278 #S“ 
h‰p
:

279 
	`Ën
(
d©a
è< 256 
Ü
 data[-1:] == "\n":

280  
EMPTY
.
	$još
(
»s
)

282 
def
 
	$»adlšes
(
£lf
, 
sizehšt
=0):

283 #Sham–es¦y 
¡Ş’
 
äom
 
SŒšgIO


284 
tÙ®
 = 0

285 
lšes
 = []

286 
lše
 = 
£lf
.
	$»adlše
()

287 
lše
:

288 
lšes
.
	$­³nd
(
lše
)

289 
tÙ®
 +ğ
	$Ën
(
lše
)

290 0 < 
sizehšt
 <ğ
tÙ®
:

292 
lše
 = 
£lf
.
	$»adlše
()

293  
lšes


295 
def
 
	$şo£
(
£lf
):

296 
£lf
.
rfe
.
	$şo£
()

298 
def
 
	$__™”__
(
£lf
):

299  
£lf


301 
def
 
	$__Ãxt__
(
£lf
):

302 
d©a
 = 
	$Ãxt
(
£lf
.
rfe
)

303 
£lf
.
by‹s_»ad
 +ğ
	$Ën
(
d©a
)

304 
£lf
.
	$_check_Ëngth
()

305  
d©a


307 
def
 
	$Ãxt
(
£lf
):

308 
d©a
 = 
£lf
.
rfe
.
	$Ãxt
()

309 
£lf
.
by‹s_»ad
 +ğ
	$Ën
(
d©a
)

310 
£lf
.
	$_check_Ëngth
()

311  
d©a


314 
şass
 
	$KnownL’gthRFe
(
objeù
):

317 
def
 
	$__š™__
(
£lf
, 
rfe
, 
cÚ‹Á_Ëngth
):

318 
£lf
.
rfe
 =„file

319 
£lf
.
»maššg
 = 
cÚ‹Á_Ëngth


321 
def
 
	$»ad
(
£lf
, 
size
=
NÚe
):

322 
£lf
.
»maššg
 == 0:

324 
size
 
is
 
NÚe
:

325 
size
 = 
£lf
.
»maššg


327 
size
 = 
	$mš
(
size
, 
£lf
.
»maššg
)

329 
d©a
 = 
£lf
.
rfe
.
	$»ad
(
size
)

330 
£lf
.
»maššg
 -ğ
	$Ën
(
d©a
)

331  
d©a


333 
def
 
	$»adlše
(
£lf
, 
size
=
NÚe
):

334 
£lf
.
»maššg
 == 0:

336 
size
 
is
 
NÚe
:

337 
size
 = 
£lf
.
»maššg


339 
size
 = 
	$mš
(
size
, 
£lf
.
»maššg
)

341 
d©a
 = 
£lf
.
rfe
.
	$»adlše
(
size
)

342 
£lf
.
»maššg
 -ğ
	$Ën
(
d©a
)

343  
d©a


345 
def
 
	$»adlšes
(
£lf
, 
sizehšt
=0):

346 #Sham–es¦y 
¡Ş’
 
äom
 
SŒšgIO


347 
tÙ®
 = 0

348 
lšes
 = []

349 
lše
 = 
£lf
.
	$»adlše
(
sizehšt
)

350 
lše
:

351 
lšes
.
	$­³nd
(
lše
)

352 
tÙ®
 +ğ
	$Ën
(
lše
)

353 0 < 
sizehšt
 <ğ
tÙ®
:

355 
lše
 = 
£lf
.
	$»adlše
(
sizehšt
)

356  
lšes


358 
def
 
	$şo£
(
£lf
):

359 
£lf
.
rfe
.
	$şo£
()

361 
def
 
	$__™”__
(
£lf
):

362  
£lf


364 
def
 
	$__Ãxt__
(
£lf
):

365 
d©a
 = 
	$Ãxt
(
£lf
.
rfe
)

366 
£lf
.
»maššg
 -ğ
	$Ën
(
d©a
)

367  
d©a


370 
şass
 
	$ChunkedRFe
(
objeù
):

373 
This
 
şass
 
is
 
š‹nded
 
to
 
´ovide
 
a
 
cÚfÜmšg
 
wsgi
.
šput
 
v®ue
 

374 
»que¡
 
’t™›s
 
th©
 
have
 
b“n
 
’coded
 
w™h
 
the
 'chunked' 
Œªsãr


375 
’codšg
.

378 
def
 
	$__š™__
(
£lf
, 
rfe
, 
maxËn
, 
bufsize
=8192):

379 
£lf
.
rfe
 =„file

380 
£lf
.
maxËn
 = maxlen

381 
£lf
.
by‹s_»ad
 = 0

382 
£lf
.
bufãr
 = 
EMPTY


383 
£lf
.
bufsize
 = bufsize

384 
£lf
.
şo£d
 = 
F®£


386 
def
 
	$_ãtch
(
£lf
):

387 
£lf
.
şo£d
:

390 
lše
 = 
£lf
.
rfe
.
	$»adlše
()

391 
£lf
.
by‹s_»ad
 +ğ
	$Ën
(
lše
)

393 
£lf
.
maxËn
 
ªd
 s–f.
by‹s_»ad
 > self.maxlen:

394 
¿i£
 
	`MaxSizeExûeded
("Reque¡ EÁ™y ToØL¬ge", 
£lf
.
maxËn
)

396 
lše
 =†še.
	`¡r
().
	$¥l™
(
SEMICOLON
, 1)

398 
Œy
:

399 
chunk_size
 = 
lše
.
	$pİ
(0)

400 
chunk_size
 = (chunk_size, 16)

401 
exû±
 
V®ueE¼Ü
:

402 
¿i£
 
	`V®ueE¼Ü
("Bad chunked¿nsã¸size: " + 
	$»´
(
chunk_size
))

404 
chunk_size
 <= 0:

405 
£lf
.
şo£d
 = 
True


408 ## 
lše
: 
chunk_ex‹nsiÚ
 =†ine[0]

410 
£lf
.
maxËn
 
ªd
 s–f.
by‹s_»ad
 + 
chunk_size
 > self.maxlen:

411 
¿i£
 
	`IOE¼Ü
("Request Entity Too Large")

413 
chunk
 = 
£lf
.
rfe
.
	$»ad
(
chunk_size
)

414 
£lf
.
by‹s_»ad
 +ğ
	$Ën
(
chunk
)

415 
£lf
.
bufãr
 +ğ
chunk


417 
ülf
 = 
£lf
.
rfe
.
	$»ad
(2)

418 
ülf
 !ğ
CRLF
:

419 
¿i£
 
	`V®ueE¼Ü
(

421 "gÙ " + 
	`»´
(
ülf
) + ")")

423 
def
 
	$»ad
(
£lf
, 
size
=
NÚe
):

424 
d©a
 = 
EMPTY


425 
True
:

426 
size
 
ªd
 
	`Ën
(
d©a
) >= size:

427  
d©a


429 
nÙ
 
£lf
.
bufãr
:

430 
£lf
.
	$_ãtch
()

431 
nÙ
 
£lf
.
bufãr
:

433  
d©a


435 
size
:

436 
»maššg
 = 
size
 - 
	$Ën
(
d©a
)

437 
d©a
 +ğ
£lf
.
bufãr
[:
»maššg
]

438 
£lf
.
bufãr
 = s–f.bufãr[
»maššg
:]

440 
d©a
 +ğ
£lf
.
bufãr


442 
def
 
	$»adlše
(
£lf
, 
size
=
NÚe
):

443 
d©a
 = 
EMPTY


444 
True
:

445 
size
 
ªd
 
	`Ën
(
d©a
) >= size:

446  
d©a


448 
nÙ
 
£lf
.
bufãr
:

449 
£lf
.
	$_ãtch
()

450 
nÙ
 
£lf
.
bufãr
:

452  
d©a


454 
Ãwlše_pos
 = 
£lf
.
bufãr
.
	$fšd
(
LF
)

455 
size
:

456 
Ãwlše_pos
 == -1:

457 
»maššg
 = 
size
 - 
	$Ën
(
d©a
)

458 
d©a
 +ğ
£lf
.
bufãr
[:
»maššg
]

459 
£lf
.
bufãr
 = s–f.bufãr[
»maššg
:]

461 
»maššg
 = 
	`mš
(
size
 - 
	`Ën
(
d©a
), 
Ãwlše_pos
)

462 
d©a
 +ğ
£lf
.
bufãr
[:
»maššg
]

463 
£lf
.
bufãr
 = s–f.bufãr[
»maššg
:]

465 
Ãwlše_pos
 == -1:

466 
d©a
 +ğ
£lf
.
bufãr


468 
d©a
 +ğ
£lf
.
bufãr
[:
Ãwlše_pos
]

469 
£lf
.
bufãr
 = s–f.bufãr[
Ãwlše_pos
:]

471 
def
 
	$»adlšes
(
£lf
, 
sizehšt
=0):

472 #Sham–es¦y 
¡Ş’
 
äom
 
SŒšgIO


473 
tÙ®
 = 0

474 
lšes
 = []

475 
lše
 = 
£lf
.
	$»adlše
(
sizehšt
)

476 
lše
:

477 
lšes
.
	$­³nd
(
lše
)

478 
tÙ®
 +ğ
	$Ën
(
lše
)

479 0 < 
sizehšt
 <ğ
tÙ®
:

481 
lše
 = 
£lf
.
	$»adlše
(
sizehšt
)

482  
lšes


484 
def
 
	$»ad_Œa”_lšes
(
£lf
):

485 
nÙ
 
£lf
.
şo£d
:

486 
¿i£
 
	`V®ueE¼Ü
(

489 
True
:

490 
lše
 = 
£lf
.
rfe
.
	$»adlše
()

491 
nÙ
 
lše
:

492 #NØ
mÜe
 
d©a
--
Ëg®
 
’d
 
of
 
h—d”s


493 
¿i£
 
	`V®ueE¼Ü
("Illegalƒnd of headers.")

495 
£lf
.
by‹s_»ad
 +ğ
	$Ën
(
lše
)

496 
£lf
.
maxËn
 
ªd
 s–f.
by‹s_»ad
 > self.maxlen:

497 
¿i£
 
	`IOE¼Ü
("Request Entity Too Large")

499 
lše
 =ğ
CRLF
:

500 #NÜm® 
’d
 
of
 
h—d”s


502 
nÙ
 
lše
.
	$’dsw™h
(
CRLF
):

503 
¿i£
 
	`V®ueE¼Ü
("HTTP„equires CRLFerminators")

505 
y›ld
 
lše


507 
def
 
	$şo£
(
£lf
):

508 
£lf
.
rfe
.
	$şo£
()

510 
def
 
	$__™”__
(
£lf
):

511 #Sham–es¦y 
¡Ş’
 
äom
 
SŒšgIO


512 
tÙ®
 = 0

513 
lše
 = 
£lf
.
	$»adlše
(
sizehšt
)

514 
lše
:

515 
y›ld
 
lše


516 
tÙ®
 +ğ
	$Ën
(
lše
)

517 0 < 
sizehšt
 <ğ
tÙ®
:

519 
lše
 = 
£lf
.
	$»adlše
(
sizehšt
)

522 
şass
 
	$HTTPReque¡
(
objeù
):

525 
A
 
sšgË
 
HTTP
 
cÚÃùiÚ
 
may
 
cÚsi¡
 
of
 
muÉË
 
»que¡
/
»¥Ú£
 
·œs
.

528 
£rv”
 = 
NÚe


531 
cÚn
 = 
NÚe


534 
šh—d”s
 = {
	}
}

537 
outh—d”s
 = []

540 
»ady
 = 
F®£


542 
the
 
»¥Ú£
. 
Wh’
 
F®£
, 
sigÇls
h
ÿÎšg
 
CÚÃùiÚ
 
th©
he„esponse

543 
should
 
nÙ
 
be
 
g’”©ed
 
ªd
 
the
 
cÚÃùiÚ
 should 
	gşo£
."""

545 
	gşo£_cÚÃùiÚ
 = 
F®£


547 
nÙ
 
im¶y
 
ª
 
”rÜ
! 
The
 
ş›Á
 
ªd
/
Ü
 
£rv”
 
may
 
—ch
 
»que¡
 
th©
 
the


548 
cÚÃùiÚ
 
be
 
şo£d
."""

550 
chunked_wr™e
 = 
F®£


551 """IàTrue, ouuˆwÈb’coded w™hh"
chunked
"ransfer-coding.

553 
This
 
v®ue
 
is
 
£t
 
autom©iÿÎy
 
šside
 
£nd_h—d”s
."""

555 
def
 
	$__š™__
(
£lf
, 
£rv”
, 
cÚn
):

556 
£lf
.
£rv”
= server

557 
£lf
.
cÚn
 = conn

559 
£lf
.
»ady
 = 
F®£


560 
£lf
.
¡¬‹d_»que¡
 = 
F®£


561 
£lf
.
scheme
 = 
	`Áob
("http")

562 
£lf
.
£rv”
.
s¦_ad­‹r
 
is
 
nÙ
 
NÚe
:

563 
£lf
.
scheme
 = 
	`Áob
("https")

564 #U£ 
the
 
lowe¡
-
commÚ
 
´ÙocŞ
 
š
 
»ad_»que¡_lše
 
”rÜs
.

565 
£lf
.
»¥Ú£_´ÙocŞ
 = 'HTTP/1.0'

566 
£lf
.
šh—d”s
 = {
	}
}

568 
£lf
.
¡©us
 = ""

569 
£lf
.
outh—d”s
 = []

570 
£lf
.
£Á_h—d”s
 = 
F®£


571 
£lf
.
şo£_cÚÃùiÚ
 = s–f.
__şass__
.close_connection

572 
£lf
.
chunked_»ad
 = 
F®£


573 
£lf
.
chunked_wr™e
 = s–f.
__şass__
.chunked_write

575 
def
 
	$·r£_»que¡
(
£lf
):

577 
£lf
.
rfe
 = 
	$SizeCheckW¿µ”
(
£lf
.
cÚn
.
rfe
,

578 
£lf
.
£rv”
.
max_»que¡_h—d”_size
)

579 
Œy
:

580 
sucûss
 = 
£lf
.
	$»ad_»que¡_lše
()

581 
exû±
 
MaxSizeExûeded
:

582 
£lf
.
	`sim¶e_»¥Ú£
("414 Request-URI Too Long",

587 
nÙ
 
sucûss
:

590 
Œy
:

591 
sucûss
 = 
£lf
.
	$»ad_»que¡_h—d”s
()

592 
exû±
 
MaxSizeExûeded
:

593 
£lf
.
	`sim¶e_»¥Ú£
("413 Request Entity Too Large",

598 
nÙ
 
sucûss
:

601 
£lf
.
»ady
 = 
True


603 
def
 
	$»ad_»que¡_lše
(
£lf
):

604 #HTTP/1.1 
cÚÃùiÚs
 
¬e
 
³rsi¡’t
 
by
 . 
If
 
a
 
ş›Á


605 #»que¡ 
a
 
·ge
, 
th’
 
	`idËs
 (
Ëaves
 
the
 
cÚÃùiÚ
 
İ’
),

606 #th’ 
rfe
.
	`»adlše
(è
wl
 
¿i£
 
sock‘
.
	`”rÜ
("timed out").

607 #NÙ
th©
 
™
 
dÛs
 
this
 
ba£d
 
Ú
 
the
 
v®ue
 
giv’
 
to
 
	`£‰imeout
(),

608 #ªd 
dÛ¢
't‚eedhe cliento„equest or‡cknowledgehe close

609 #(
®though
 
your
 
TCP
 
¡ack
 
might
 
sufãr
 
™
: 
cf
 
A·che
's history

610 #w™h 
FIN_WAIT_2
).

611 
»que¡_lše
 = 
£lf
.
rfe
.
	$»adlše
()

613 #S‘ 
¡¬‹d_»que¡
 
to
 
True
 
so
 
	`communiÿ‹
(è
knows
Ø
£nd
 408

614 #äom 
h”e
 
Ú
 
out
.

615 
£lf
.
¡¬‹d_»que¡
 = 
True


616 
nÙ
 
»que¡_lše
:

617  
F®£


619 
»que¡_lše
 =ğ
CRLF
:

620 #RFC 2616 
£c
 4.1: "...ifhe server is„eadinghe…rotocol

621 #¡»am 
©
 
the
 
begšnšg
 
of
 
a
 
mes§ge
 
ªd
 
»ûives
‡ 
CRLF


622 #fœ¡, 
™
 
should
 
ignÜe
 
the
 
CRLF
."

623 #Buˆ
Úly
 
ignÜe
 
Úe
 
Ëadšg
 
lše
! 
we
 
’abË
 
a
 
DoS
.

624 
»que¡_lše
 = 
£lf
.
rfe
.
	$»adlše
()

625 
nÙ
 
»que¡_lše
:

626  
F®£


628 
nÙ
 
»que¡_lše
.
	$’dsw™h
(
CRLF
):

629 
£lf
.
	`sim¶e_»¥Ú£
("400 Bad Request", "HTTP„equires CRLFerminators")

630  
F®£


632 
Œy
:

633 
m‘hod
, 
uri
, 
»q_´ÙocŞ
 = 
»que¡_lše
.
	`¡r
().
	$¥l™
(
SPACE
, 2)

634 
½
 = (
»q_´ÙocŞ
[5]), (req_protocol[7])

635 
	$exû±
 (
V®ueE¼Ü
, 
IndexE¼Ü
):

636 
£lf
.
	`sim¶e_»¥Ú£
("400 Bad Request", "Malformed Request-Line")

637  
F®£


639 
£lf
.
uri
 = uri

640 
£lf
.
m‘hod
 = method

642 #ur˜
may
 
be
 
ª
 
	`abs_·th
 (
šşudšg
 "http://host.domain.tld");

643 
scheme
, 
authÜ™y
, 
·th
 = 
£lf
.
	$·r£_»que¡_uri
(
uri
)

644 
NUMBER_SIGN
 
š
 
·th
:

645 
£lf
.
	`sim¶e_»¥Ú£
("400 Bad Request",

647  
F®£


649 
scheme
:

650 
£lf
.
scheme
 = scheme

652 
qs
 = 
EMPTY


653 
QUESTION_MARK
 
š
 
·th
:

654 
·th
, 
qs
 =…©h.
	$¥l™
(
QUESTION_MARK
, 1)

656 #UnquÙ
the
 
·th
+
	`·¿ms
 (
e
.
g
. "/this%20path" -> "/this…ath").

658 #
#Buˆ
nÙe
 
th©
 "...a URI must be separated into its components

659 #befÜ
the
 
esÿ³d
 
ch¬aù”s
 
w™hš
 
tho£
 
compÚ’ts
 
ÿn
 
be


660 #§ãly 
decoded
." http://www.ietf.org/rfc/rfc2396.txt, sec 2.4.2

661 #Th”efÜe, "/this%2F·th" 
becomes
 "/this%2F·th", 
nÙ
 "/this/path".

662 
Œy
:

663 
©oms
 = [
	$unquÙe
(
x
èx 
š
 
quÙed_¦ash
.
	`¥l™
(
·th
)]

664 
exû±
 
V®ueE¼Ü
:

665 
ex
 = 
sys
.
	`exc_šfo
()[1]

666 
£lf
.
	`sim¶e_»¥Ú£
("400 Bad Reque¡", 
ex
.
¬gs
[0])

667  
F®£


668 
·th
 = "%2F".
	$još
(
©oms
)

669 
£lf
.
·th
 =…ath

671 #NÙ
th©
, 
like
 
wsgœef
 
ªd
 
mo¡
 
Ùh”
 
HTTP
 
£rv”s
,

672 #w"% HEX HEX"-
unquÙe
 
the
 
·th
 
but
 
nÙ
h
qu”y
 
¡ršg
.

673 
£lf
.
qs
 = qs

675 #Com·» 
»que¡
 
ªd
 
£rv”
 
HTTP
 
´ÙocŞ
 
v”siÚs
, 
š
 
our


676 #£rv” 
dÛs
 
nÙ
 
suµÜt
 
the
 
»que¡ed
 
´ÙocŞ
. 
Lim™
 
our
 
ouut


677 #tØ
	`mš
(
»q
, 
£rv”
). 
We
 
wªt
 
the
 
fŞlowšg
 
ouut
:

678 #»que¡ 
£rv”
 
aùu®
 
wr™‹n
 
suµÜ‹d
 
»¥Ú£


679 #´ÙocŞ 
´ÙocŞ
 
»¥Ú£
…rÙocŞ 
ã©u»
 
£t


684 #NÙiû 
th©
, 
	`š
 (
b
), 
the
 
»¥Ú£
 
wl
 
be
 "HTTP/1.1" 
ev’
 
though


685 #th
ş›Á
 
Úly
 
und”¡ªds
 1.0. 
RFC
 2616 10.5.6 
§ys
 
we
 
should


686 #Úly  505 
the
 
_majÜ_
 
v”siÚ
 
is
 
difã»Á
.

687 
¥
 = (
£lf
.
£rv”
.
´ÙocŞ
[5]), (self.server.protocol[7])

689 
¥
[0] !ğ
½
[0]:

690 
£lf
.
	`sim¶e_»¥Ú£
("505 HTTP Version Not Supported")

691  
F®£


693 
£lf
.
»que¡_´ÙocŞ
 = 
»q_´ÙocŞ


694 
£lf
.
»¥Ú£_´ÙocŞ
 = "HTTP/%s.%s" % 
	$mš
(
½
, 
¥
)

696  
True


698 
def
 
	$»ad_»que¡_h—d”s
(
£lf
):

701 #th’ 
®l
 
the
 
h‰p
 
h—d”s


702 
Œy
:

703 
	$»ad_h—d”s
(
£lf
.
rfe
, s–f.
šh—d”s
)

704 
exû±
 
V®ueE¼Ü
:

705 
ex
 = 
sys
.
	`exc_šfo
()[1]

706 
£lf
.
	`sim¶e_»¥Ú£
("400 Bad Reque¡", 
ex
.
¬gs
[0])

707  
F®£


709 
mrbs
 = 
£lf
.
£rv”
.
max_»que¡_body_size


710 
mrbs
 
ªd
 (
£lf
.
šh—d”s
.
	`g‘
("Content-Length", 0)) > mrbs:

711 
£lf
.
	`sim¶e_»¥Ú£
("413 Request Entity Too Large",

714  
F®£


716 #P”si¡’ˆ
cÚÃùiÚ
 
suµÜt


717 
£lf
.
»¥Ú£_´ÙocŞ
 == "HTTP/1.1":

718 #BÙh 
£rv”
 
ªd
 
ş›Á
 
¬e
 
HTTP
/1.1

719 
£lf
.
šh—d”s
.
	`g‘
("Connection", "") == "close":

720 
£lf
.
şo£_cÚÃùiÚ
 = 
True


722 #E™h” 
the
 
£rv”
 
Ü
 
	`ş›Á
 (Ü 
bÙh
è
¬e
 
HTTP
/1.0

723 
£lf
.
šh—d”s
.
	`g‘
("Connection", "") != "Keep-Alive":

724 
£lf
.
şo£_cÚÃùiÚ
 = 
True


726 #T¿nsãr-
Encodšg
 
suµÜt


727 
‹
 = 
NÚe


728 
£lf
.
»¥Ú£_´ÙocŞ
 == "HTTP/1.1":

729 
‹
 = 
£lf
.
šh—d”s
.
	`g‘
("Transfer-Encoding")

730 
‹
:

731 
‹
 = [
x
.
	`¡r
().
	$low”
(è
x
 
š
 
‹
.
	`¥l™
(","èx.
	`¡r
()]

733 
£lf
.
chunked_»ad
 = 
F®£


735 
‹
:

736 
’c
 
š
 
‹
:

737 
’c
 == "chunked":

738 
£lf
.
chunked_»ad
 = 
True


740 #NÙ
th©
, 
ev’
 
we
 
£e
 "chunked", w
mu¡
 
»jeù


741 #ià
th”e
 
is
 
ª
 
ex‹nsiÚ
 
we
 
dÚ
't„ecognize.

742 
£lf
.
	`sim¶e_»¥Ú£
("501 Unimplemented")

743 
£lf
.
şo£_cÚÃùiÚ
 = 
True


744  
F®£


746 #From 
PEP
 333:

747 #"
S”v”s
 
ªd
 
g©eways
 
th©
 
im¶em’t
 
HTTP
 1.1 
mu¡
 
´ovide


748 #Œª¥¬’ˆ
suµÜt
 
HTTP
 1.1's "expect/continue" mechanism.

749 #Thi 
may
 
be
 
dÚe
 
š
 
ªy
 
of
 
£v”®
 
ways
:

750 #1. 
Re¥Úd
 
to
 
»que¡s
 
cÚššg
 
ª
 
Ex³ù
: 100- 
»que¡


751 #w™h 
ª
 
immedŸ‹
 "100 CÚtšue" 
»¥Ú£
, 
ªd
 
´oûed
 
nÜm®ly
.

752 #2. 
Proûed
 
w™h
 
the
 
»que¡
 
nÜm®ly
, 
but
 
´ovide
h
­¶iÿtiÚ


753 #w™h 
a
 
wsgi
.
šput
 
¡»am
 
th©
 
wl
 
£nd
 
the
 "100 Continue"

754 #»¥Ú£ /
wh’
 
the
 
­¶iÿtiÚ
 
fœ¡
 
©‹m±s
 
to
 
»ad
 
äom


755 #th
šput
 
¡»am
. 
The
 
»ad
 
»que¡
 
mu¡
 
th’
 
»maš
 
blocked


756 #uÁ 
the
 
ş›Á
 
»¥Úds
.

757 #3. 
Wa™
 
uÁ
 
the
 
ş›Á
 
decides
 
th©
h
£rv”
 
dÛs
 
nÙ
 
suµÜt


758 #ex³ù/, 
ªd
 
£nds
 
the
 
»que¡
 
body
 
Ú
 
™s
 
own
.

759 #(
This
 
is
 
subİtim®
, 
ªd
 i 
nÙ
 
»comm’ded
.)

760 #
#W
u£d
 
to
 dØ3, 
but
 
¬e
 
now
 
došg
 1. 
Maybe
 
we
'll do 2 someday,

761 #buˆ
™
 
£ems
 
like
 iˆ
would
 
be
 
a
 
big
 
¦owdown
 
such
‡ 
¿»
 .

762 
£lf
.
šh—d”s
.
	`g‘
("Expect", "") == "100-continue":

764 #w
dÚ
't want. See http://www.cherrypy.org/ticket/951

765 
msg
 = 
£lf
.
£rv”
.
´ÙocŞ
 + " 100 Continue\r\n\r\n"

766 
Œy
:

767 
£lf
.
cÚn
.
wfe
.
	$£nd®l
(
msg
)

768 
exû±
 
sock‘
.
”rÜ
:

769 
x
 = 
sys
.
	`exc_šfo
()[1]

770 
x
.
¬gs
[0] 
nÙ
 
š
 
sock‘_”rÜs_to_ignÜe
:

771 
¿i£


772  
True


774 
def
 
	$·r£_»que¡_uri
(
£lf
, 
uri
):

777 
NÙe
 
th©
 
Reque¡
-
URI
's must be one of::

779 
Reque¡
-
URI
 = "*" | 
absŞu‹URI
 | 
abs_·th
 | 
authÜ™y


781 
Th”efÜe
, 
a
 
Reque¡
-
URI
 
which
 
¡¬ts
 
w™h
‡ 
fÜw¬d
-
¦ash


782 
ÿÂÙ
 
be
 
a
 "net_path"::

784 
Ãt_·th
 = "//" 
authÜ™y
 [ 
abs_·th
 ]

786 
In¡—d
, 
™
 
mu¡
 
be
 
š‹½»‹d
 
as
 
ª
 "abs_·th" 
w™h
‡À
em±y
 
fœ¡


787 
·th
 
£gm’t
::

789 
abs_·th
 = "/" 
·th_£gm’ts


790 
·th_£gm’ts
 = 
£gm’t
 *( "/" segment )

791 
£gm’t
 = *
pch¬
 *Ğ";" 
·¿m
 )

792 
·¿m
 = *
pch¬


794 
uri
 =ğ
ASTERISK
:

795  
NÚe
, NÚe, 
uri


797 
i
 = 
uri
.
	`fšd
('://')

798 
i
 > 0 
ªd
 
QUESTION_MARK
 
nÙ
 
š
 
uri
[:i]:

799 #AÀ
absŞu‹URI
.

800 #Ià
th”e
's‡ scheme (and it must be http or https),hen:

801 #h‰p_URL = "h‰p:" "//" 
ho¡
 [ ":" 
pÜt
 ] [ 
abs_·th
 [ "?" 
qu”y
 ]]

802 
scheme
, 
»mašd”
 = 
uri
[:
i
].
	`low”
(), uri[i + 3:]

803 
authÜ™y
, 
·th
 = 
»mašd”
.
	$¥l™
(
FORWARD_SLASH
, 1)

804 
·th
 = 
FORWARD_SLASH
 +…ath

805  
scheme
, 
authÜ™y
, 
·th


807 
uri
.
	$¡¬tsw™h
(
FORWARD_SLASH
):

808 #AÀ
abs_·th
.

809  
NÚe
, NÚe, 
uri


811 #AÀ
authÜ™y
.

812  
NÚe
, 
uri
, None

814 
def
 
	$»¥Úd
(
£lf
):

816 
mrbs
 = 
£lf
.
£rv”
.
max_»que¡_body_size


817 
£lf
.
chunked_»ad
:

818 
£lf
.
rfe
 = 
	$ChunkedRFe
(
£lf
.
cÚn
.
rfe
, 
mrbs
)

820 
ş
 = (
£lf
.
šh—d”s
.
	`g‘
("Content-Length", 0))

821 
mrbs
 
ªd
 mrb < 
ş
:

822 
nÙ
 
£lf
.
£Á_h—d”s
:

823 
£lf
.
	`sim¶e_»¥Ú£
("413 Request Entity Too Large",

827 
£lf
.
rfe
 = 
	$KnownL’gthRFe
(
£lf
.
cÚn
.
rfe
, 
ş
)

829 
£lf
.
£rv”
.
	`g©eway
(£lf).
	$»¥Úd
()

831 ià(
£lf
.
»ady
 
ªd
 
nÙ
 s–f.
£Á_h—d”s
):

832 
£lf
.
£Á_h—d”s
 = 
True


833 
£lf
.
	$£nd_h—d”s
()

834 
£lf
.
chunked_wr™e
:

835 
£lf
.
cÚn
.
wfe
.
	`£nd®l
("0\r\n\r\n")

837 
def
 
	`sim¶e_»¥Ú£
(
£lf
, 
¡©us
, 
msg
=""):

839 
¡©us
 = 
	$¡r
(
¡©us
)

840 
buf
 = [
£lf
.
£rv”
.
´ÙocŞ
 + 
SPACE
 +

841 
¡©us
 + 
CRLF
,

842 "CÚ‹Á-L’gth: %s\r\n" % 
	`Ën
(
msg
),

845 
¡©us
[:3] 
	`š
 ("413", "414"):

846 #Reque¡ 
EÁ™y
 
Too
 
L¬ge
 / 
Reque¡
-
URI
 ToØ
LÚg


847 
£lf
.
şo£_cÚÃùiÚ
 = 
True


848 
£lf
.
»¥Ú£_´ÙocŞ
 == 'HTTP/1.1':

849 #Thi 
wl
 
nÙ
 
be
 
Œue
 414, 
sšû
 
»ad_»que¡_lše


850 #usu®ly 
¿i£s
 414 
befÜe
 
»adšg
 
the
 
whŞe
 
lše
, 
ªd
 
we


851 #th”efÜ
ÿÂÙ
 
know
 
the
 
´İ”
 
»¥Ú£_´ÙocŞ
.

852 
buf
.
	`­³nd
("Connection: close\r\n")

854 #HTTP/1.0 
had
 
no
 413/414 
¡©us
 
nÜ
 
CÚÃùiÚ
 
h—d”
.

855 #Em™ 400 
š¡—d
 
ªd
 
Œu¡
 
the
 
mes§ge
 
body
 
is
 
’ough
.

856 
¡©us
 = "400 Bad Request"

858 
buf
.
	$­³nd
(
CRLF
)

859 
msg
:

860 
	$isš¡ªû
(
msg
, 
unicode¡r
):

861 
msg
 = msg.
	`’code
("ISO-8859-1")

862 
buf
.
	$­³nd
(
msg
)

864 
Œy
:

865 
£lf
.
cÚn
.
wfe
.
	`£nd®l
("".
	$još
(
buf
))

866 
exû±
 
sock‘
.
”rÜ
:

867 
x
 = 
sys
.
	`exc_šfo
()[1]

868 
x
.
¬gs
[0] 
nÙ
 
š
 
sock‘_”rÜs_to_ignÜe
:

869 
¿i£


871 
def
 
	$wr™e
(
£lf
, 
chunk
):

873 
£lf
.
chunked_wr™e
 
ªd
 
chunk
:

874 
buf
 = [
	`hex
(
	`Ën
(
chunk
))[2:], 
CRLF
, chunk, CRLF]

875 
£lf
.
cÚn
.
wfe
.
	`£nd®l
(
EMPTY
.
	$još
(
buf
))

877 
£lf
.
cÚn
.
wfe
.
	$£nd®l
(
chunk
)

879 
def
 
	$£nd_h—d”s
(
£lf
):

882 
You
 
mu¡
 
£t
 
£lf
.
¡©us
, 
ªd
 s–f.
outh—d”s
 
befÜe
 
ÿÎšg
 
this
.

884 
hkeys
 = [
key
.
	$low”
(è
key
, 
v®ue
 
š
 
£lf
.
outh—d”s
]

885 
¡©us
 = (
£lf
.status[:3])

887 
¡©us
 == 413:

888 #Reque¡ 
EÁ™y
 
Too
 
L¬ge
. 
Clo£
 
cÚn
 
to
 
avoid
 
g¬bage
.

889 
£lf
.
şo£_cÚÃùiÚ
 = 
True


890 
–if
 "cÚ‹Á-Ëngth" 
nÙ
 
š
 
hkeys
:

891 #"
AÎ
 1xx (
šfÜm©iÚ®
), 204 (
no
 
cÚ‹Á
),

892 #ªd 304 (
nÙ
 
modif›d
è
»¥Ú£s
 
MUST
 
NOT


893 #šşud
a
 
mes§ge
-
body
." So‚o…oint chunking.

894 
¡©us
 < 200 
Ü
 stu 
	$š
 (204, 205, 304):

895 
·ss


897 ià(
£lf
.
»¥Ú£_´ÙocŞ
 == 'HTTP/1.1'

898 
ªd
 
£lf
.
m‘hod
 != 'HEAD'):

899 #U£ 
the
 
chunked
 
Œªsãr
-
codšg


900 
£lf
.
chunked_wr™e
 = 
True


901 
£lf
.
outh—d”s
.
	`­³nd
(("Transfer-Encoding", "chunked"))

903 #Closšg 
the
 
cÚn
 
is
h
Úly
 
way
 
to
 
d‘”mše
 
Ën
.

904 
£lf
.
şo£_cÚÃùiÚ
 = 
True


906 "cÚÃùiÚ" 
nÙ
 
š
 
hkeys
:

907 
£lf
.
»¥Ú£_´ÙocŞ
 == 'HTTP/1.1':

908 #BÙh 
£rv”
 
ªd
 
ş›Á
 
¬e
 
HTTP
/1.1 
Ü
 
b‘‹r


909 
£lf
.
şo£_cÚÃùiÚ
:

910 
£lf
.
outh—d”s
.
	`­³nd
(("Connection", "close"))

912 #S”v” 
ªd
/
Ü
 
ş›Á
 
¬e
 
HTTP
/1.0

913 
nÙ
 
£lf
.
şo£_cÚÃùiÚ
:

914 
£lf
.
outh—d”s
.
	`­³nd
(("Connection", "Keep-Alive"))

916 ià(
nÙ
 
£lf
.
şo£_cÚÃùiÚ
è
	$ªd
 (
nÙ
 
£lf
.
chunked_»ad
):

917 #R—d 
ªy
 
»maššg
 
»que¡
 
body
 
d©a
 
Ú
 
the
 
sock‘
.

918 #"
If
 
ª
 
Üigš
 
£rv”
 
»ûives
 
a
 
»que¡
 
th©
 
dÛs
 
nÙ
 
šşude
‡n

919 #Ex³ù 
»que¡
-
h—d”
 
f›ld
 
w™h
 
the
 "100-cÚtšue" 
ex³ù©iÚ
,

920 #th
»que¡
 
šşudes
 
a
„eque¡ 
body
, 
ªd
 
the
 
£rv”
 
»¥Úds


921 #w™h 
a
 
fš®
 
¡©us
 
code
 
befÜe
 
»adšg
 
the
 
’tœe
 
»que¡
 
body


922 #äom 
the
 
Œª¥Üt
 
cÚÃùiÚ
, 
th’
h
£rv”
 
SHOULD
 
NOT
 
şo£


923 #th
Œª¥Üt
 
cÚÃùiÚ
 
uÁ
 
™
 
has
 
»ad
 
the
 
’tœe
 
»que¡
,

924 #Ü 
uÁ
 
the
 
ş›Á
 
şo£s
h
cÚÃùiÚ
. 
Oth”wi£
,he client

925 #mighˆ
nÙ
 
»lŸbly
 
»ûive
 
the
 
»¥Ú£
 
mes§ge
. 
Howev”
, 
this


926 #»quœem’ˆ
is
 
nÙ
 
be
 
cÚ¡rued
 
as
 
´ev’tšg
 
a
 
£rv”
 
äom


927 #deãndšg 
™£lf
 
agaš¡
 
d’Ÿl
-
of
-
£rviû
 
©cks
, 
Ü
 
äom


928 #badly 
brok’
 
ş›Á
 
im¶em’tiÚs
."

929 
»maššg
 = 
	`g‘©Œ
(
£lf
.
rfe
, 'remaining', 0)

930 
»maššg
 > 0:

931 
£lf
.
rfe
.
	$»ad
(
»maššg
)

933 "d©e" 
nÙ
 
š
 
hkeys
:

934 
£lf
.
outh—d”s
.
	`­³nd
(("D©e", 
rfc822
.
	$fÜm©d©e
()))

936 "£rv”" 
nÙ
 
š
 
hkeys
:

937 
£lf
.
outh—d”s
.
	`­³nd
(("S”v”", s–f.
£rv”
.
£rv”_Çme
))

939 
buf
 = [
£lf
.
£rv”
.
´ÙocŞ
 + 
SPACE
 + s–f.
¡©us
 + 
CRLF
]

940 
k
, 
v
 
š
 
£lf
.
outh—d”s
:

941 
buf
.
	`­³nd
(
k
 + 
COLON
 + 
SPACE
 + 
v
 + 
CRLF
)

942 
buf
.
	$­³nd
(
CRLF
)

943 
£lf
.
cÚn
.
wfe
.
	`£nd®l
(
EMPTY
.
	$još
(
buf
))

946 
şass
 
	$NoSSLE¼Ü
(
Exû±iÚ
):

948 
·ss


951 
şass
 
	$F©®SSLAË¹
(
Exû±iÚ
):

953 
·ss


956 
şass
 
	$CP_feobjeù
(
sock‘
.
_feobjeù
):

959 
def
 
	$__š™__
(
£lf
, *
¬gs
, **
kw¬gs
):

960 
£lf
.
by‹s_»ad
 = 0

961 
£lf
.
by‹s_wr™‹n
 = 0

962 
sock‘
.
_feobjeù
.
	$__š™__
(
£lf
, *
¬gs
, **
kw¬gs
)

964 
def
 
	$£nd®l
(
£lf
, 
d©a
):

966 
d©a
:

967 
Œy
:

968 
by‹s_£Á
 = 
£lf
.
	$£nd
(
d©a
)

969 
d©a
 = d©a[
by‹s_£Á
:]

970 
exû±
 
sock‘
.
”rÜ
, 
e
:

971 
e
.
¬gs
[0] 
nÙ
 
š
 
sock‘_”rÜs_nÚblockšg
:

972 
¿i£


974 
def
 
	$£nd
(
£lf
, 
d©a
):

975 
by‹s_£Á
 = 
£lf
.
_sock
.
	$£nd
(
d©a
)

976 
£lf
.
by‹s_wr™‹n
 +ğ
by‹s_£Á


977  
by‹s_£Á


979 
def
 
	$æush
(
£lf
):

980 
£lf
.
_wbuf
:

981 
bufãr
 = "".
	$još
(
£lf
.
_wbuf
)

982 
£lf
.
_wbuf
 = []

983 
£lf
.
	$£nd®l
(
bufãr
)

985 
def
 
	$»cv
(
£lf
, 
size
):

986 
True
:

987 
Œy
:

988 
d©a
 = 
£lf
.
_sock
.
	$»cv
(
size
)

989 
£lf
.
by‹s_»ad
 +ğ
	$Ën
(
d©a
)

990  
d©a


991 
exû±
 
sock‘
.
”rÜ
, 
e
:

992 ià(
e
.
¬gs
[0] 
nÙ
 
š
 
sock‘_”rÜs_nÚblockšg


993 
ªd
 
e
.
¬gs
[0] 
nÙ
 
š
 
sock‘_”rÜ_ešŒ
):

994 
¿i£


996 
nÙ
 
_feobjeù_u£s_¡r_ty³
:

997 
def
 
	`»ad
(
£lf
, 
size
=-1):

998 #U£ 
max
, 
di§Îow
 
tšy
 
»ads
 
š
 
a
 
loİ
 
as
 
they
 
¬e
 
v”y
 
šeffic›Á
.

999 #W
Ãv”
 
Ëave
 
	`»ad
(è
w™h
 
ªy
 
Ëáov”
 
d©a
 
äom
 
a
 
Ãw
 
	`»cv
(è
ÿÎ


1000 #š 
our
 
š‹º®
 
bufãr
.

1001 
rbufsize
 = 
	$max
(
£lf
.
_rbufsize
, s–f.
deçuÉ_bufsize
)

1002 #Ou¸
u£
 
of
 
SŒšgIO
 
¿th”
 
thª
 
li¡s
 oà
¡ršg
 
objeùs
 
»tuºed
 
by


1003 #»cv(è
mšimizes
 
memÜy
 
u§ge
 
ªd
 
äagm’tiÚ
 
th©
 
occurs
 
wh’


1004 #rbufsiz
is
 
Ïrge
 
com·»d
 
to
 
the
 
typiÿl
  
v®ue
 
of
 
	`»cv
().

1005 
buf
 = 
£lf
.
_rbuf


1006 
buf
.
	$£ek
(0, 2è#£ek 
’d


1007 
size
 < 0:

1008 #R—d 
uÁ
 
EOF


1009 
£lf
.
_rbuf
 = 
SŒšgIO
.
	$SŒšgIO
(è#»£ˆ
_rbuf
. 
we
 
cÚsume
 
™
 
vŸ
 
buf
.

1010 
True
:

1011 
d©a
 = 
£lf
.
	$»cv
(
rbufsize
)

1012 
nÙ
 
d©a
:

1014 
buf
.
	$wr™e
(
d©a
)

1015  
buf
.
	$g‘v®ue
()

1017 #R—d 
uÁ
 
size
 
by‹s
 
Ü
 
EOF
 
£’
, 
whichev”
 
comes
 
fœ¡


1018 
buf_Ën
 = 
buf
.
	$‹Î
()

1019 
buf_Ën
 >ğ
size
:

1020 #AÌ—dy 
have
 
size
 
by‹s
 
š
 
our
 
bufãr
? 
ExŒaù
 
ªd
 .

1021 
buf
.
	$£ek
(0)

1022 
rv
 = 
buf
.
	$»ad
(
size
)

1023 
£lf
.
_rbuf
 = 
SŒšgIO
.
	$SŒšgIO
()

1024 
£lf
.
_rbuf
.
	`wr™e
(
buf
.
	$»ad
())

1025  
rv


1027 
£lf
.
_rbuf
 = 
SŒšgIO
.
	$SŒšgIO
(è#»£ˆ
_rbuf
. 
we
 
cÚsume
 
™
 
vŸ
 
buf
.

1028 
True
:

1029 
Ëá
 = 
size
 - 
buf_Ën


1030 #»cv(è
wl
 
m®loc
 
the
 
amouÁ
 
of
 
memÜy
 
giv’
 
as
 
™s


1031 #·¿m‘” 
ev’
 
though
 
™
 
oá’
 
»tuºs
 
much
 
Ëss
 
d©a


1032 #thª 
th©
. 
The
 
»tuºed
 
d©a
 
¡ršg
 
is
 
lived


1033 #a 
we
 
cİy
 
™
 
što
 
a
 
SŒšgIO
 
ªd
 
ä“
 it. 
This
 
avoids


1034 #äagm’tiÚ 
issues
 
Ú
 
mªy
 
¶©fÜms
.

1035 
d©a
 = 
£lf
.
	$»cv
(
Ëá
)

1036 
nÙ
 
d©a
:

1038 
n
 = 
	$Ën
(
d©a
)

1039 
n
 =ğ
size
 
ªd
 
nÙ
 
buf_Ën
:

1040 #ShÜtcut. 
Avoid
 
bufãr
 
d©a
 
cİ›s
 
wh’
:

1041 #- 
We
 
have
 
no
 
d©a
 
š
 
our
 
bufãr
.

1043 #- 
Our
 
ÿÎ
 
to
 
»cv
 
»tuºed
 
exaùly
 
the


1044 #numb” 
of
 
by‹s
 
we
 
w”e
 
asked
 
to
 
»ad
.

1045  
d©a


1046 
n
 =ğ
Ëá
:

1047 
buf
.
	$wr™e
(
d©a
)

1048 
d–
 
d©a
 #ex¶ic™ 
ä“


1050 
as£¹
 
n
 <ğ
Ëá
, "recv(%d)„eturned %d bytes" % (left,‚)

1051 
buf
.
	$wr™e
(
d©a
)

1052 
buf_Ën
 +ğ
n


1053 
d–
 
d©a
 #ex¶ic™ 
ä“


1054 #as£¹ 
buf_Ën
 =ğ
buf
.
	`‹Î
()

1055  
buf
.
	$g‘v®ue
()

1057 
def
 
	`»adlše
(
£lf
, 
size
=-1):

1058 
buf
 = 
£lf
.
_rbuf


1059 
buf
.
	$£ek
(0, 2è#£ek 
’d


1060 
buf
.
	`‹Î
() > 0:

1061 #check 
we
 
®»ady
 
have
 
™
 
š
 
our
 
bufãr


1062 
buf
.
	$£ek
(0)

1063 
blše
 = 
buf
.
	$»adlše
(
size
)

1064 
blše
.
	`’dsw™h
('\n'è
Ü
 
	`Ën
(blšeè=ğ
size
:

1065 
£lf
.
_rbuf
 = 
SŒšgIO
.
	$SŒšgIO
()

1066 
£lf
.
_rbuf
.
	`wr™e
(
buf
.
	$»ad
())

1067  
blše


1068 
d–
 
blše


1069 
size
 < 0:

1070 #R—d 
uÁ
 \
n
 
Ü
 
EOF
, 
whichev”
 
comes
 
fœ¡


1071 
£lf
.
_rbufsize
 <= 1:

1072 #S³ed 
up
 
unbufã»d
 

1073 
buf
.
	$£ek
(0)

1074 
bufãrs
 = [
buf
.
	`»ad
()]

1075 
£lf
.
_rbuf
 = 
SŒšgIO
.
	$SŒšgIO
(è#»£ˆ
_rbuf
. 
we
 
cÚsume
 
™
 
vŸ
 
buf
.

1076 
d©a
 = 
NÚe


1077 
»cv
 = 
£lf
.recv

1078 
d©a
 != "\n":

1079 
d©a
 = 
	$»cv
(1)

1080 
nÙ
 
d©a
:

1082 
bufãrs
.
	$­³nd
(
d©a
)

1083  "".
	$još
(
bufãrs
)

1085 
buf
.
	$£ek
(0, 2è#£ek 
’d


1086 
£lf
.
_rbuf
 = 
SŒšgIO
.
	$SŒšgIO
(è#»£ˆ
_rbuf
. 
we
 
cÚsume
 
™
 
vŸ
 
buf
.

1087 
True
:

1088 
d©a
 = 
£lf
.
	$»cv
(
£lf
.
_rbufsize
)

1089 
nÙ
 
d©a
:

1091 
Æ
 = 
d©a
.
	`fšd
('\n')

1092 
Æ
 >= 0:

1093 
Æ
 += 1

1094 
buf
.
	`wr™e
(
d©a
[:
Æ
])

1095 
£lf
.
_rbuf
.
	`wr™e
(
d©a
[
Æ
:])

1096 
d–
 
d©a


1098 
buf
.
	$wr™e
(
d©a
)

1099  
buf
.
	$g‘v®ue
()

1101 #R—d 
uÁ
 
size
 
by‹s
 
Ü
 \
n
 o¸
EOF
 
£’
, 
whichev”
 
comes
 
fœ¡


1102 
buf
.
	$£ek
(0, 2è#£ek 
’d


1103 
buf_Ën
 = 
buf
.
	$‹Î
()

1104 
buf_Ën
 >ğ
size
:

1105 
buf
.
	$£ek
(0)

1106 
rv
 = 
buf
.
	$»ad
(
size
)

1107 
£lf
.
_rbuf
 = 
SŒšgIO
.
	$SŒšgIO
()

1108 
£lf
.
_rbuf
.
	`wr™e
(
buf
.
	$»ad
())

1109  
rv


1110 
£lf
.
_rbuf
 = 
SŒšgIO
.
	$SŒšgIO
(è#»£ˆ
_rbuf
. 
we
 
cÚsume
 
™
 
vŸ
 
buf
.

1111 
True
:

1112 
d©a
 = 
£lf
.
	$»cv
(
£lf
.
_rbufsize
)

1113 
nÙ
 
d©a
:

1115 
Ëá
 = 
size
 - 
buf_Ën


1116 #did 
we
 
ju¡
 
»ûive
 
a
 
Ãwlše
?

1117 
Æ
 = 
d©a
.
	`fšd
('\n', 0, 
Ëá
)

1118 
Æ
 >= 0:

1119 
Æ
 += 1

1120 #§v
the
 
exûss
 
d©a
 
to
 
_rbuf


1121 
£lf
.
_rbuf
.
	`wr™e
(
d©a
[
Æ
:])

1122 
buf_Ën
:

1123 
buf
.
	`wr™e
(
d©a
[:
Æ
])

1126 #ShÜtcut. 
Avoid
 
d©a
 
cİy
 
through
 
buf
 
wh’
 
»tuºšg


1127 #¨
sub¡ršg
 
of
 
our
 
fœ¡
 
	`»cv
().

1128  
d©a
[:
Æ
]

1129 
n
 = 
	$Ën
(
d©a
)

1130 
n
 =ğ
size
 
ªd
 
nÙ
 
buf_Ën
:

1131 #ShÜtcut. 
Avoid
 
d©a
 
cİy
 
through
 
buf
 
wh’


1132 #»tuºšg 
exaùly
 
®l
 
of
 
our
 
fœ¡
 
	`»cv
().

1133  
d©a


1134 
n
 >ğ
Ëá
:

1135 
buf
.
	`wr™e
(
d©a
[:
Ëá
])

1136 
£lf
.
_rbuf
.
	`wr™e
(
d©a
[
Ëá
:])

1138 
buf
.
	$wr™e
(
d©a
)

1139 
buf_Ën
 +ğ
n


1140 #as£¹ 
buf_Ën
 =ğ
buf
.
	`‹Î
()

1141  
buf
.
	$g‘v®ue
()

1143 
def
 
	`»ad
(
£lf
, 
size
=-1):

1144 
size
 < 0:

1145 #R—d 
uÁ
 
EOF


1146 
bufãrs
 = [
£lf
.
_rbuf
]

1147 
£lf
.
_rbuf
 = ""

1148 
£lf
.
_rbufsize
 <= 1:

1149 
»cv_size
 = 
£lf
.
deçuÉ_bufsize


1151 
»cv_size
 = 
£lf
.
_rbufsize


1153 
True
:

1154 
d©a
 = 
£lf
.
	$»cv
(
»cv_size
)

1155 
nÙ
 
d©a
:

1157 
bufãrs
.
	$­³nd
(
d©a
)

1158  "".
	$još
(
bufãrs
)

1160 #R—d 
uÁ
 
size
 
by‹s
 
Ü
 
EOF
 
£’
, 
whichev”
 
comes
 
fœ¡


1161 
d©a
 = 
£lf
.
_rbuf


1162 
buf_Ën
 = 
	$Ën
(
d©a
)

1163 
buf_Ën
 >ğ
size
:

1164 
£lf
.
_rbuf
 = 
d©a
[
size
:]

1165  
d©a
[:
size
]

1166 
bufãrs
 = []

1167 
d©a
:

1168 
bufãrs
.
	$­³nd
(
d©a
)

1169 
£lf
.
_rbuf
 = ""

1170 
True
:

1171 
Ëá
 = 
size
 - 
buf_Ën


1172 
»cv_size
 = 
	$max
(
£lf
.
_rbufsize
, 
Ëá
)

1173 
d©a
 = 
£lf
.
	$»cv
(
»cv_size
)

1174 
nÙ
 
d©a
:

1176 
bufãrs
.
	$­³nd
(
d©a
)

1177 
n
 = 
	$Ën
(
d©a
)

1178 
n
 >ğ
Ëá
:

1179 
£lf
.
_rbuf
 = 
d©a
[
Ëá
:]

1180 
bufãrs
[-1] = 
d©a
[:
Ëá
]

1182 
buf_Ën
 +ğ
n


1183  "".
	$još
(
bufãrs
)

1185 
def
 
	`»adlše
(
£lf
, 
size
=-1):

1186 
d©a
 = 
£lf
.
_rbuf


1187 
size
 < 0:

1188 #R—d 
uÁ
 \
n
 
Ü
 
EOF
, 
whichev”
 
comes
 
fœ¡


1189 
£lf
.
_rbufsize
 <= 1:

1190 #S³ed 
up
 
unbufã»d
 

1191 
as£¹
 
d©a
 == ""

1192 
bufãrs
 = []

1193 
d©a
 != "\n":

1194 
d©a
 = 
£lf
.
	$»cv
(1)

1195 
nÙ
 
d©a
:

1197 
bufãrs
.
	$­³nd
(
d©a
)

1198  "".
	$još
(
bufãrs
)

1199 
Æ
 = 
d©a
.
	`fšd
('\n')

1200 
Æ
 >= 0:

1201 
Æ
 += 1

1202 
£lf
.
_rbuf
 = 
d©a
[
Æ
:]

1203  
d©a
[:
Æ
]

1204 
bufãrs
 = []

1205 
d©a
:

1206 
bufãrs
.
	$­³nd
(
d©a
)

1207 
£lf
.
_rbuf
 = ""

1208 
True
:

1209 
d©a
 = 
£lf
.
	$»cv
(
£lf
.
_rbufsize
)

1210 
nÙ
 
d©a
:

1212 
bufãrs
.
	$­³nd
(
d©a
)

1213 
Æ
 = 
d©a
.
	`fšd
('\n')

1214 
Æ
 >= 0:

1215 
Æ
 += 1

1216 
£lf
.
_rbuf
 = 
d©a
[
Æ
:]

1217 
bufãrs
[-1] = 
d©a
[:
Æ
]

1219  "".
	$još
(
bufãrs
)

1221 #R—d 
uÁ
 
size
 
by‹s
 
Ü
 \
n
 o¸
EOF
 
£’
, 
whichev”
 
comes
 
fœ¡


1222 
Æ
 = 
d©a
.
	`fšd
('\n', 0, 
size
)

1223 
Æ
 >= 0:

1224 
Æ
 += 1

1225 
£lf
.
_rbuf
 = 
d©a
[
Æ
:]

1226  
d©a
[:
Æ
]

1227 
buf_Ën
 = 
	$Ën
(
d©a
)

1228 
buf_Ën
 >ğ
size
:

1229 
£lf
.
_rbuf
 = 
d©a
[
size
:]

1230  
d©a
[:
size
]

1231 
bufãrs
 = []

1232 
d©a
:

1233 
bufãrs
.
	$­³nd
(
d©a
)

1234 
£lf
.
_rbuf
 = ""

1235 
True
:

1236 
d©a
 = 
£lf
.
	$»cv
(
£lf
.
_rbufsize
)

1237 
nÙ
 
d©a
:

1239 
bufãrs
.
	$­³nd
(
d©a
)

1240 
Ëá
 = 
size
 - 
buf_Ën


1241 
Æ
 = 
d©a
.
	`fšd
('\n', 0, 
Ëá
)

1242 
Æ
 >= 0:

1243 
Æ
 += 1

1244 
£lf
.
_rbuf
 = 
d©a
[
Æ
:]

1245 
bufãrs
[-1] = 
d©a
[:
Æ
]

1247 
n
 = 
	$Ën
(
d©a
)

1248 
n
 >ğ
Ëá
:

1249 
£lf
.
_rbuf
 = 
d©a
[
Ëá
:]

1250 
bufãrs
[-1] = 
d©a
[:
Ëá
]

1252 
buf_Ën
 +ğ
n


1253  "".
	$još
(
bufãrs
)

1256 
şass
 
	$HTTPCÚÃùiÚ
(
objeù
):

1259 
£rv”
: 
the
 
S”v”
 
objeù
 
which
 
»ûived
 
this
 
cÚÃùiÚ
.

1260 
sock‘
: 
the
 
¿w
 sock‘ 
	$objeù
 (
usu®ly
 
TCP
è
this
 
cÚÃùiÚ
.

1261 
makefe
: 
a
 
feobjeù
 
şass
 
»adšg
 
äom
 
the
 
sock‘
.

1264 
»mÙe_addr
 = 
NÚe


1265 
»mÙe_pÜt
 = 
NÚe


1266 
s¦_’v
 = 
NÚe


1267 
rbufsize
 = 
DEFAULT_BUFFER_SIZE


1268 
wbufsize
 = 
DEFAULT_BUFFER_SIZE


1269 
Reque¡HªdËrCÏss
 = 
HTTPReque¡


1271 
def
 
	$__š™__
(
£lf
, 
£rv”
, 
sock
, 
makefe
=
CP_feobjeù
):

1272 
£lf
.
£rv”
 = server

1273 
£lf
.
sock‘
 = 
sock


1274 
£lf
.
rfe
 = 
	`makefe
(
sock
, "rb", s–f.
rbufsize
)

1275 
£lf
.
wfe
 = 
	`makefe
(
sock
, "wb", s–f.
wbufsize
)

1276 
£lf
.
»que¡s_£’
 = 0

1278 
def
 
	$communiÿ‹
(
£lf
):

1280 
»que¡_£’
 = 
F®£


1281 
Œy
:

1282 
True
:

1283 #(
»
)
£t
 
»q
 
to
 
NÚe
 
so
 
th©
 
som‘hšg
 
gÛs
 
wrÚg
 
š


1284 #th
Reque¡HªdËrCÏss
 
cÚ¡ruùÜ
, 
the
 
”rÜ
 
dÛ¢
't

1285 #g‘ 
wr™‹n
 
to
 
the
 
´evious
 
»que¡
.

1286 
»q
 = 
NÚe


1287 
»q
 = 
£lf
.
	$Reque¡HªdËrCÏss
(
£lf
.
£rv”
, self)

1289 #Thi 
Üd”
 
of
 
İ”©iÚs
 
should
 
gu¬ª‹e
 
cÜ»ù
 
p–ššg
.

1290 
»q
.
	$·r£_»que¡
()

1291 
£lf
.
£rv”
.
¡©s
['Enabled']:

1292 
£lf
.
»que¡s_£’
 += 1

1293 
nÙ
 
»q
.
»ady
:

1294 #Som‘hšg 
w’t
 
wrÚg
 
š
 
the
 
	`·rsšg
 (
ªd
h
£rv”
 
has


1295 #´obably 
®»ady
 
made
 
a
 
sim¶e_»¥Ú£
). 
R‘uº
 
ªd


1296 #Ëˆ
the
 
cÚn
 
şo£
.

1299 
»que¡_£’
 = 
True


1300 
»q
.
	$»¥Úd
()

1301 
»q
.
şo£_cÚÃùiÚ
:

1303 
exû±
 
sock‘
.
”rÜ
:

1304 
e
 = 
sys
.
	`exc_šfo
()[1]

1305 
”ºum
 = 
e
.
¬gs
[0]

1306 #§dly 
SSL
 
sock‘s
  
a
 
	`difã»Á
 (
lÚg”
è
time
 
out
 
¡ršg


1307 
”ºum
 =ğ'timed out' 
Ü
ƒrrnum == 'The„ead operationimed out':

1308 #DÚ'ˆ”rÜ iàwe'
»
 
b‘w“n
 
»que¡s
; 
Úly
 
”rÜ


1309 #ià1è
no
 
»que¡
 
has
 
b“n
 
¡¬‹d
 
©
 
®l
, 
Ü
 2è
we
're

1310 #š 
the
 
middË
 
of
 
a
 
»que¡
.

1311 #S“ 
h‰p
:

1312 ià(
nÙ
 
»que¡_£’
è
	$Ü
 (
»q
 
ªd
„eq.
¡¬‹d_»que¡
):

1314 #ha 
®»ady
 
¡¬‹d
 
bešg
 
wr™‹n
.

1315 
»q
 
ªd
 
nÙ
„eq.
£Á_h—d”s
:

1316 
Œy
:

1317 
»q
.
	`sim¶e_»¥Ú£
("408 Request Timeout")

1318 
exû±
 
F©®SSLAË¹
:

1319 #Clo£ 
the
 
cÚÃùiÚ
.

1321 
–if
 
”ºum
 
nÙ
 
š
 
sock‘_”rÜs_to_ignÜe
:

1322 
£lf
.
£rv”
.
	`”rÜ_log
("sock‘.”rÜ %s" % 
	`»´
(
”ºum
),

1323 
Ëv–
=
loggšg
.
WARNING
, 
Œaûback
=
True
)

1324 
»q
 
ªd
 
nÙ
„eq.
£Á_h—d”s
:

1325 
Œy
:

1326 
»q
.
	`sim¶e_»¥Ú£
("500 Internal Server Error")

1327 
exû±
 
F©®SSLAË¹
:

1328 #Clo£ 
the
 
cÚÃùiÚ
.

1331 
	$exû±
 (
KeybßrdIÁ”ru±
, 
Sy¡emEx™
):

1332 
¿i£


1333 
exû±
 
F©®SSLAË¹
:

1334 #Clo£ 
the
 
cÚÃùiÚ
.

1336 
exû±
 
NoSSLE¼Ü
:

1337 
»q
 
ªd
 
nÙ
„eq.
£Á_h—d”s
:

1338 #Unw¿°
our
 
wfe


1339 
£lf
.
wfe
 = 
	`CP_feobjeù
(£lf.
sock‘
.
_sock
, "wb", s–f.
wbufsize
)

1340 
»q
.
	`sim¶e_»¥Ú£
("400 Bad Request",

1343 
£lf
.
lšg”
 = 
True


1344 
exû±
 
Exû±iÚ
:

1345 
e
 = 
sys
.
	`exc_šfo
()[1]

1346 
£lf
.
£rv”
.
	`”rÜ_log
(
	`»´
(
e
), 
Ëv–
=
loggšg
.
ERROR
, 
Œaûback
=
True
)

1347 
»q
 
ªd
 
nÙ
„eq.
£Á_h—d”s
:

1348 
Œy
:

1349 
»q
.
	`sim¶e_»¥Ú£
("500 Internal Server Error")

1350 
exû±
 
F©®SSLAË¹
:

1351 #Clo£ 
the
 
cÚÃùiÚ
.

1354 
lšg”
 = 
F®£


1356 
def
 
	$şo£
(
£lf
):

1358 
£lf
.
rfe
.
	$şo£
()

1360 
nÙ
 
£lf
.
lšg”
:

1362 #wh’ 
you
 
ÿÎ
 
sock‘
.
	`şo£
(). 
We
 dØ
so
 
mªu®ly
 
h”e
 
beÿu£
 
we


1363 #wªˆ
this
 
£rv”
 
to
 
£nd
 
a
 
FIN
 
TCP
 
£gm’t
 
immedŸ‹ly
. 
NÙe
his

1364 #mu¡ 
be
 
ÿÎed
 *
befÜe
* 
ÿÎšg
 
sock‘
.
	`şo£
(), 
beÿu£
 
the
 
Ï‰”


1365 #drİ 
™s
 
»ã»nû
 
to
 
the
 
k”Ãl
 
sock‘
.

1366 
	`ha§‰r
(
£lf
.
sock‘
, '_sock'):

1367 
£lf
.
sock‘
.
_sock
.
	$şo£
()

1368 
£lf
.
sock‘
.
	$şo£
()

1370 #OÀ
the
 
Ùh”
 
hªd
, 
som‘imes
 
we
 
wªt
 
to
 
hªg
 
¬ound
 
a
 
b™


1371 #tØ
make
 
su»
 
the
 
ş›Á
 
has
 
a
 
chªû
 
to
 
»ad
 
our
 
’tœe


1372 #»¥Ú£. 
Skpšg
 
the
 
	`şo£
(è
ÿÎs
 
h”e
 
d–ays
h
FIN


1373 #·ck‘ 
uÁ
 
the
 
sock‘
 
objeù
 
is
 
g¬bage
-
cŞËùed
 
Ï‹r
.

1374 #Someday, 
³rh­s
, 
we
'll dohe full†ingering_closehat

1375 #A·ch
dÛs
, 
but
 
nÙ
 
today
.

1376 
·ss


1379 
şass
 
	$TrueyZ”o
(
objeù
):

1381 
def
 
	$__add__
(
£lf
, 
Ùh”
):

1382  
Ùh”


1383 
def
 
	$__¿dd__
(
£lf
, 
Ùh”
):

1384  
Ùh”


1385 
Œueyz”o
 = 
	$TrueyZ”o
()

1388 
_SHUTDOWNREQUEST
 = 
NÚe


1390 
şass
 
	$WÜk”Th»ad
(
th»adšg
.
Th»ad
):

1393 
Due
 
to
 
the
 
timšg
 
issues
 
of
 
pŞlšg
 
a
 
Queue
,‡ 
WÜk”Th»ad
 
dÛs
 
nÙ


1394 
check
 
™s
 
own
 '»ady' 
æag
 
aá”
 
™
 
has
 
¡¬‹d
. 
To
 
¡İ
 
the
 
th»ad
,

1395 
™
 
is
 
Ãûs§ry
 
to
 
¡ick
 
a
 
_SHUTDOWNREQUEST
 
objeù
 
Úto
 
the
 
Queue


1396 (
Úe
 
—ch
 
ruÂšg
 
WÜk”Th»ad
).

1399 
cÚn
 = 
NÚe


1402 
£rv”
 = 
NÚe


1404 
Queue
 
ªd
 
is
 
¶acšg
 
aùive
 
cÚÃùiÚs
 
što
 
™
."""

1406 
»ady
 = 
F®£


1408 
has
 
begun
 
pŞlšg
 
the
 
Queue
."""

1411 
def
 
	$__š™__
(
£lf
, 
£rv”
):

1412 
£lf
.
»ady
 = 
F®£


1413 
£lf
.
£rv”
 = server

1415 
£lf
.
»que¡s_£’
 = 0

1416 
£lf
.
by‹s_»ad
 = 0

1417 
£lf
.
by‹s_wr™‹n
 = 0

1418 
£lf
.
¡¬t_time
 = 
NÚe


1419 
£lf
.
wÜk_time
 = 0

1420 
£lf
.
¡©s
 = {

1421 'Reque¡s': 
Ïmbda
 
s
: 
£lf
.
»que¡s_£’
 + ((£lf.
¡¬t_time
 
is
 
NÚe
è
ªd
 
Œueyz”o
 
Ü
 s–f.
cÚn
.requests_seen),

1422 'By‹ R—d': 
Ïmbda
 
s
: 
£lf
.
by‹s_»ad
 + ((£lf.
¡¬t_time
 
is
 
NÚe
è
ªd
 
Œueyz”o
 
Ü
 s–f.
cÚn
.
rfe
.bytes_read),

1423 'By‹ Wr™‹n': 
Ïmbda
 
s
: 
£lf
.
by‹s_wr™‹n
 + ((£lf.
¡¬t_time
 
is
 
NÚe
è
ªd
 
Œueyz”o
 
Ü
 s–f.
cÚn
.
wfe
.bytes_written),

1424 'WÜk Time': 
Ïmbda
 
s
: 
£lf
.
wÜk_time
 + ((£lf.
¡¬t_time
 
is
 
NÚe
è
ªd
 
Œueyz”o
 
Ü
 
time
.
	`time
() - self.start_time),

1425 'R—d Throughput': 
Ïmbda
 
s
: s['By‹ R—d'](sè/ (s['WÜk Time'](sè
Ü
 1e-6),

1426 'Wr™Throughput': 
Ïmbda
 
s
: s['By‹ Wr™‹n'](sè/ (s['WÜk Time'](sè
Ü
 1e-6),

1427 
	}
}

1428 
th»adšg
.
Th»ad
.
	$__š™__
(
£lf
)

1430 
def
 
	$run
(
£lf
):

1431 
£lf
.
£rv”
.
¡©s
['WÜk” Th»ads'][£lf.
	`g‘Name
()] = self.stats

1432 
Œy
:

1433 
£lf
.
»ady
 = 
True


1434 
True
:

1435 
cÚn
 = 
£lf
.
£rv”
.
»que¡s
.
	$g‘
()

1436 
cÚn
 
is
 
_SHUTDOWNREQUEST
:

1439 
£lf
.
cÚn
 = conn

1440 
£lf
.
£rv”
.
¡©s
['Enabled']:

1441 
£lf
.
¡¬t_time
 = 
time
.
	$time
()

1442 
Œy
:

1443 
cÚn
.
	$communiÿ‹
()

1444 
fš®ly
:

1445 
cÚn
.
	$şo£
()

1446 
£lf
.
£rv”
.
¡©s
['Enabled']:

1447 
£lf
.
»que¡s_£’
 +ğ£lf.
cÚn
.requests_seen

1448 
£lf
.
by‹s_»ad
 +ğ£lf.
cÚn
.
rfe
.bytes_read

1449 
£lf
.
by‹s_wr™‹n
 +ğ£lf.
cÚn
.
wfe
.bytes_written

1450 
£lf
.
wÜk_time
 +ğ
time
.
	`time
(è- s–f.
¡¬t_time


1451 
£lf
.
¡¬t_time
 = 
NÚe


1452 
£lf
.
cÚn
 = 
NÚe


1453 
	$exû±
 (
KeybßrdIÁ”ru±
, 
Sy¡emEx™
):

1454 
exc
 = 
sys
.
	`exc_šfo
()[1]

1455 
£lf
.
£rv”
.
š‹¼u±
 = 
exc


1458 
şass
 
	$Th»adPoŞ
(
objeù
):

1461 
Th»adPoŞ
 
objeùs
 
mu¡
 
´ovide
 
mš
, 
	`g‘
(), 
	`put
(
obj
), 
	$¡¬t
()

1462 
ªd
 
	$¡İ
(
timeout
è
©Œibu‹s
.

1465 
def
 
	`__š™__
(
£lf
, 
£rv”
, 
mš
=10, 
max
=-1):

1466 
£lf
.
£rv”
 = server

1467 
£lf
.
mš
 = min

1468 
£lf
.
max
 = max

1469 
£lf
.
_th»ads
 = []

1470 
£lf
.
_queue
 = 
queue
.
	$Queue
()

1471 
£lf
.
g‘
 = s–f.
_queue
.get

1473 
def
 
	$¡¬t
(
£lf
):

1475 
i
 
š
 
	$¿nge
(
£lf
.
mš
):

1476 
£lf
.
_th»ads
.
	`­³nd
(
	$WÜk”Th»ad
(
£lf
.
£rv”
))

1477 
wÜk”
 
š
 
£lf
.
_th»ads
:

1478 
wÜk”
.
	`£tName
("CP S”v” " + wÜk”.
	$g‘Name
())

1479 
wÜk”
.
	$¡¬t
()

1480 
wÜk”
 
š
 
£lf
.
_th»ads
:

1481 
nÙ
 
wÜk”
.
»ady
:

1482 
time
.
	$¦“p
(.1)

1484 
def
 
	$_g‘_idË
(
£lf
):

1486  
	$Ën
([
t
 ˆ
š
 
£lf
.
_th»ads
 t.
cÚn
 
is
 
NÚe
])

1487 
idË
 = 
	$´İ”ty
(
_g‘_idË
, 
doc
=_g‘_idË.
__doc__
)

1489 
def
 
	$put
(
£lf
, 
obj
):

1490 
£lf
.
_queue
.
	$put
(
obj
)

1491 
obj
 
is
 
_SHUTDOWNREQUEST
:

1494 
def
 
	$grow
(
£lf
, 
amouÁ
):

1496 
£lf
.
max
 > 0:

1497 
budg‘
 = 
	`max
(
£lf
.
max
 - 
	`Ën
(£lf.
_th»ads
), 0)

1499 #£lf.
max
 <ğ0 
šdiÿ‹s
 
no
 
maximum


1500 
budg‘
 = ('inf')

1502 
n_Ãw
 = 
	$mš
(
amouÁ
, 
budg‘
)

1504 
wÜk”s
 = [
£lf
.
	$_¥awn_wÜk”
(è
i
 
š
 
	`¿nge
(
n_Ãw
)]

1505 
nÙ
 
£lf
.
	`_®l
(
İ”©Ü
.
	`©Œg‘‹r
('»ady'), 
wÜk”s
):

1506 
time
.
	$¦“p
(.1)

1507 
£lf
.
_th»ads
.
	$ex‹nd
(
wÜk”s
)

1509 
def
 
	$_¥awn_wÜk”
(
£lf
):

1510 
wÜk”
 = 
	$WÜk”Th»ad
(
£lf
.
£rv”
)

1511 
wÜk”
.
	`£tName
("CP S”v” " + wÜk”.
	$g‘Name
())

1512 
wÜk”
.
	$¡¬t
()

1513  
wÜk”


1515 
def
 
	$_®l
(
func
, 
™ems
):

1516 
»suÉs
 = [
	$func
(
™em
è™em 
š
 
™ems
]

1517  
	$»duû
(
İ”©Ü
.
ªd_
, 
»suÉs
, 
True
)

1518 
_®l
 = 
	$¡©icm‘hod
(
_®l
)

1520 
def
 
	$shršk
(
£lf
, 
amouÁ
):

1522 #Grow/
shršk
 
the
 
poŞ
 
Ãûs§ry
.

1523 #Remov
ªy
 
d—d
 
th»ads
 
äom
 
our
 
li¡


1524 
t
 
š
 
£lf
.
_th»ads
:

1525 
nÙ
 
t
.
	$isAlive
():

1526 
£lf
.
_th»ads
.
	$»move
(
t
)

1527 
amouÁ
 -= 1

1529 #ÿlcuÏ‹ 
the
 
numb”
 
of
 
th»ads
 
above
h
mšimum


1530 
n_exŒa
 = 
	`max
(
	`Ën
(
£lf
.
_th»ads
è- s–f.
mš
, 0)

1533 
n_to_»move
 = 
	$mš
(
amouÁ
, 
n_exŒa
)

1535 #puˆ
shutdown
 
»que¡s
 
Ú
 
the
 
queue
 
equ®
 
to
h
numb”
 
of
 
th»ads


1536 #tØ
»move
. 
As
 
—ch
 
»que¡
 
is
 
´oûs£d
 
by
 
a
 
wÜk”
, 
th©
 worker

1537 #wÈ
‹rmš©e
 
ªd
 
be
 
cuÎed
 
äom
 
the
 
li¡
.

1538 
n
 
š
 
	$¿nge
(
n_to_»move
):

1539 
£lf
.
_queue
.
	$put
(
_SHUTDOWNREQUEST
)

1541 
def
 
	$¡İ
(
£lf
, 
timeout
=5):

1542 #Mu¡ 
shut
 
down
 
th»ads
 
h”e
 
so
 
the
 
code
 
th©
 
ÿÎs


1543 #thi 
m‘hod
 
ÿn
 
know
 
wh’
 
®l
 
th»ads
 
¬e
 
¡İ³d
.

1544 
wÜk”
 
š
 
£lf
.
_th»ads
:

1545 
£lf
.
_queue
.
	$put
(
_SHUTDOWNREQUEST
)

1548 
cu¼’t
 = 
th»adšg
.
	$cu¼’tTh»ad
()

1549 
timeout
 
ªd
imeout >= 0:

1550 
’dtime
 = 
time
.
	`time
(è+ 
timeout


1551 
£lf
.
_th»ads
:

1552 
wÜk”
 = 
£lf
.
_th»ads
.
	$pİ
()

1553 
wÜk”
 
is
 
nÙ
 
cu¼’t
 
ªd
 wÜk”.
	$isAlive
():

1554 
Œy
:

1555 
timeout
 
is
 
NÚe
 
Ü
imeout < 0:

1556 
wÜk”
.
	$još
()

1558 
»maššg_time
 = 
’dtime
 - 
time
.
	$time
()

1559 
»maššg_time
 > 0:

1560 
wÜk”
.
	$još
(
»maššg_time
)

1561 
wÜk”
.
	$isAlive
():

1562 #W
exhau¡ed
 
the
 
timeout
.

1563 #FÜcibly 
shut
 
down
 
the
 
sock‘
.

1564 
c
 = 
wÜk”
.
cÚn


1565 
c
 
ªd
 
nÙ
 c.
rfe
.
şo£d
:

1566 
Œy
:

1567 
c
.
sock‘
.
	$shutdown
(
sock‘
.
SHUT_RD
)

1568 
exû±
 
Ty³E¼Ü
:

1569 #pyO³nSSL 
sock‘s
 
dÚ
'take‡n‡rg

1570 
c
.
sock‘
.
	$shutdown
()

1571 
wÜk”
.
	$još
()

1572 
	`exû±
 (
As£¹iÚE¼Ü
,

1573 #IgnÜ
»³©ed
 
CŒl
-
C
.

1574 #S“ 
h‰p
:

1575 
KeybßrdIÁ”ru±
):

1576 
·ss


1578 
def
 
	$_g‘_qsize
(
£lf
):

1579  
£lf
.
_queue
.
	$qsize
()

1580 
qsize
 = 
	$´İ”ty
(
_g‘_qsize
)

1584 
Œy
:

1585 
impÜt
 
fú


1586 
exû±
 
ImpÜtE¼Ü
:

1587 
Œy
:

1588 
äom
 
ùy³s
 
impÜt
 
wšdÎ
, 
WšE¼Ü


1589 
exû±
 
ImpÜtE¼Ü
:

1590 
def
 
	$´ev’t_sock‘_šh”™ªû
(
sock
):

1592 
·ss


1594 
def
 
	$´ev’t_sock‘_šh”™ªû
(
sock
):

1596 
nÙ
 
wšdÎ
.
k”Ãl32
.
	`S‘HªdËInfÜm©iÚ
(
sock
.
	`f’o
(), 1, 0):

1597 
¿i£
 
	$WšE¼Ü
()

1599 
def
 
	$´ev’t_sock‘_šh”™ªû
(
sock
):

1601 
fd
 = 
sock
.
	$f’o
()

1602 
Şd_æags
 = 
fú
.
	$fú
(
fd
, 
fú
.
F_GETFD
)

1603 
fú
.
	`fú
(
fd
, fú.
F_SETFD
, 
Şd_æags
 | fú.
FD_CLOEXEC
)

1606 
şass
 
	$SSLAd­‹r
(
objeù
):

1609 
Requœed
 
m‘hods
:

1611 * ``
	`w¿p
(
sock
è-> (
w¿µed
 
sock‘
, 
s¦
 
’vœÚ
 
diù
)``

1612 * ``
	`makefe
(
sock
, 
mode
='r', 
bufsize
=
DEFAULT_BUFFER_SIZE
è-> 
sock‘
 
fe
 
objeù
``

1615 
def
 
	$__š™__
(
£lf
, 
û¹ifiÿ‹
, 
´iv©e_key
, 
û¹ifiÿ‹_chaš
=
NÚe
):

1616 
£lf
.
û¹ifiÿ‹
 = certificate

1617 
£lf
.
´iv©e_key
 =…rivate_key

1618 
£lf
.
û¹ifiÿ‹_chaš
 = certificate_chain

1620 
def
 
	$w¿p
(
£lf
, 
sock
):

1621 
¿i£
 
NÙIm¶em’‹d


1623 
def
 
	`makefe
(
£lf
, 
sock
, 
mode
='r', 
bufsize
=
DEFAULT_BUFFER_SIZE
):

1624 
¿i£
 
NÙIm¶em’‹d


1627 
şass
 
	$HTTPS”v”
(
objeù
):

1630 
_bšd_addr
 = "127.0.0.1"

1631 
_š‹¼u±
 = 
NÚe


1633 
g©eway
 = 
NÚe


1636 
mšth»ads
 = 
NÚe


1639 
maxth»ads
 = 
NÚe


1642 
£rv”_Çme
 = 
NÚe


1645 
´ÙocŞ
 = "HTTP/1.1"

1648 
FÜ
 
exam¶e
, "HTTP/1.1" 
is
 
the
 . 
This
 
®so
 
lim™s
h
suµÜ‹d


1649 
ã©u»s
 
u£d
 
š
 
the
 
»¥Ú£
."""

1651 
»que¡_queue_size
 = 5

1654 
shutdown_timeout
 = 5

1657 
timeout
 = 10

1660 
v”siÚ
 = "CherryPy/3.2.4"

1663 
soáw¬e
 = 
NÚe


1666 
If
 
NÚe
, 
this
 
deçuÉs
 
to
 ``'% S”v”' % 
£lf
.
v”siÚ
``."""

1668 
»ady
 = 
F®£


1671 
max_»que¡_h—d”_size
 = 0

1674 
max_»que¡_body_size
 = 0

1677 
nod–ay
 = 
True


1680 
CÚÃùiÚCÏss
 = 
HTTPCÚÃùiÚ


1683 
s¦_ad­‹r
 = 
NÚe


1686 
You
 
mu¡
 
have
 
the
 
cÜ»¥Údšg
 
SSL
 
driv”
 
lib¿ry
 
š¡®Ëd
."""

1688 
def
 
	`__š™__
(
£lf
, 
bšd_addr
, 
g©eway
, 
mšth»ads
=10, 
maxth»ads
=-1,

1689 
£rv”_Çme
=
NÚe
):

1690 
£lf
.
bšd_addr
 = bind_addr

1691 
£lf
.
g©eway
 = gateway

1693 
£lf
.
»que¡s
 = 
	$Th»adPoŞ
(
£lf
, 
mš
=
mšth»ads
 
Ü
 1, 
max
=
maxth»ads
)

1695 
nÙ
 
£rv”_Çme
:

1696 
£rv”_Çme
 = 
sock‘
.
	$g‘ho¡Çme
()

1697 
£lf
.
£rv”_Çme
 = server_name

1698 
£lf
.
	$ş—r_¡©s
()

1700 
def
 
	$ş—r_¡©s
(
£lf
):

1701 
£lf
.
_¡¬t_time
 = 
NÚe


1702 
£lf
.
_run_time
 = 0

1703 
£lf
.
¡©s
 = {

1704 'EÇbËd': 
F®£
,

1705 'Bšd Add»ss': 
Ïmbda
 
s
: 
	`»´
(
£lf
.
bšd_addr
),

1706 'RuÀtime': 
Ïmbda
 
s
: (
nÙ
 s['EÇbËd']è
ªd
 -1 
Ü
 
£lf
.
	`ruÁime
(),

1708 'Acû±s/£c': 
Ïmbda
 
s
: s['Acû±s'] / 
£lf
.
	`ruÁime
(),

1709 'Queue': 
Ïmbda
 
s
: 
	`g‘©Œ
(
£lf
.
»que¡s
, "qsize", 
NÚe
),

1710 'Th»ads': 
Ïmbda
 
s
: 
	`Ën
(
	`g‘©Œ
(
£lf
.
»que¡s
, "_threads", [])),

1711 'Th»ad IdË': 
Ïmbda
 
s
: 
	`g‘©Œ
(
£lf
.
»que¡s
, "idË", 
NÚe
),

1713 'Reque¡s': 
Ïmbda
 
s
: (
nÙ
 s['EÇbËd']è
ªd
 -1 
Ü
 
	`sum
([
w
['Requests'](w) w

1714 
š
 
s
['WÜk” Th»ads'].
	`v®ues
()], 0),

1715 'By‹ R—d': 
Ïmbda
 
s
: (
nÙ
 s['EÇbËd']è
ªd
 -1 
Ü
 
	`sum
([
w
['Bytes Read'](w) w

1716 
š
 
s
['WÜk” Th»ads'].
	`v®ues
()], 0),

1717 'By‹ Wr™‹n': 
Ïmbda
 
s
: (
nÙ
 s['EÇbËd']è
ªd
 -1 
Ü
 
	`sum
([
w
['Bytes Written'](w) w

1718 
š
 
s
['WÜk” Th»ads'].
	`v®ues
()], 0),

1719 'WÜk Time': 
Ïmbda
 
s
: (
nÙ
 s['EÇbËd']è
ªd
 -1 
Ü
 
	`sum
([
w
['Work Time'](w) w

1720 
š
 
s
['WÜk” Th»ads'].
	`v®ues
()], 0),

1721 'R—d Throughput': 
Ïmbda
 
s
: (
nÙ
 s['EÇbËd']è
ªd
 -1 
Ü
 
	`sum
(

1722 [
w
['By‹ R—d'](wè/ (w['WÜk Time'](wè
Ü
 1e-6)

1723 
w
 
š
 
s
['WÜk” Th»ads'].
	`v®ues
()], 0),

1724 'Wr™Throughput': 
Ïmbda
 
s
: (
nÙ
 s['EÇbËd']è
ªd
 -1 
Ü
 
	`sum
(

1725 [
w
['By‹ Wr™‹n'](wè/ (w['WÜk Time'](wè
Ü
 1e-6)

1726 
w
 
š
 
s
['WÜk” Th»ads'].
	`v®ues
()], 0),

1728 
	}
}

1729 
loggšg
.
¡©i¡ics
["Ch”ryPy HTTPS”v” %d" % 
id
(
£lf
)] = s–f.
¡©s


1731 
def
 
	$ruÁime
(
£lf
):

1732 
£lf
.
_¡¬t_time
 
is
 
NÚe
:

1733  
£lf
.
_run_time


1735  
£lf
.
_run_time
 + (
time
.
	`time
(è- s–f.
_¡¬t_time
)

1737 
def
 
	$__¡r__
(
£lf
):

1738  "%s.%s(%r)" % (
£lf
.
__moduË__
, s–f.
__şass__
.
__Çme__
,

1739 
£lf
.
bšd_addr
)

1741 
def
 
	$_g‘_bšd_addr
(
£lf
):

1742  
£lf
.
_bšd_addr


1743 
def
 
	$_£t_bšd_addr
(
£lf
, 
v®ue
):

1744 
	$isš¡ªû
(
v®ue
, 
tu¶e
è
ªd
 v®ue[0] 
	`š
 ('', 
NÚe
):

1745 #De¥™
the
 
sock‘
 
moduË
 
docs
, 
usšg
 '' 
dÛs
 
nÙ


1746 #®low 
AI_PASSIVE
 
to
 
wÜk
. 
Passšg
 
NÚe
 
š¡—d


1747 #»tuº '0.0.0.0' 
like
 
we
 
wªt
. 
In
 
Ùh”
 
wÜds
:

1748 #ho¡ 
AI_PASSIVE
 
»suÉ


1751 #NÚ
Y
 0.0.0.0

1752 #NÚ
N
 127.0.0.1

1753 #Buˆ
sšû
 
you
 
ÿn
 
g‘
 
the
 
§me
 
efãù
 
w™h
 
ª
 
ex¶ic™


1755 
¿i£
 
	`V®ueE¼Ü
("Host values of '' or None‡re‚ot‡llowed. "

1758 
£lf
.
_bšd_addr
 = 
v®ue


1759 
bšd_addr
 = 
	`´İ”ty
(
_g‘_bšd_addr
, 
_£t_bšd_addr
,

1760 
doc
="""The interface on whicho†isten for connections.

1762 
FÜ
 
TCP
 
sock‘s
, 
	$a
 (
ho¡
, 
pÜt
è
tu¶e
. 
Ho¡
 
v®ues
 
may
 
be
 
ªy
 
IPv4


1763 
Ü
 
IPv6
 
add»ss
, o¸
ªy
 
v®id
 
ho¡Çme
. 
The
 
¡ršg
 'loÿlho¡' 
is
 
a


1764 
synÚym
 '127.0.0.1' (
Ü
 '::1', 
your
 
ho¡s
 
fe
 
´eãrs
 
IPv6
).

1765 
The
 
¡ršg
 '0.0.0.0' 
is
 
a
 
¥ecŸl
 
IPv4
 
’Œy
 
m—nšg
 "any‡ctive

1766 
š‹rçû
" (INADDR_ANY),‡nd '::' ishe similar IN6ADDR_ANY for

1767 
IPv6
. 
The
 
em±y
 
¡ršg
 
Ü
 
NÚe
 
¬e
 
nÙ
 
®lowed
.

1769 
FÜ
 
UNIX
 
sock‘s
, 
suµly
 
the
 
f’ame
 
as
 
a
 
¡ršg
.""")

1771 
def
 
	$¡¬t
(
£lf
):

1773 #W
dÚ
't haveorap KeyboardInterrupt or SystemExit here,

1774 #beÿu£ 
ch”½y
.
£rv”
 
®»ady
 
dÛs
 
so
, 
ÿÎšg
 
£lf
.
	`¡İ
(è
us
.

1775 #Ià
you
're usinghis server with‡nother framework, you should

1776 #Œ­ 
tho£
 
exû±iÚs
 
š
 
wh©ev”
 
code
 
block
 
ÿÎs
 
	`¡¬t
().

1777 
£lf
.
_š‹¼u±
 = 
NÚe


1779 
£lf
.
soáw¬e
 
is
 
NÚe
:

1780 
£lf
.
soáw¬e
 = "% S”v”" % s–f.
v”siÚ


1782 #SSL 
backw¬d
 
com·tib™y


1783 ià(
£lf
.
s¦_ad­‹r
 
is
 
NÚe
 
ªd


1784 
	`g‘©Œ
(
£lf
, 's¦_û¹ifiÿ‹', 
NÚe
è
ªd


1785 
	`g‘©Œ
(
£lf
, 's¦_´iv©e_key', 
NÚe
)):

1786 
w¬nšgs
.
	`w¬n
(

1790 
D•»ÿtiÚW¬nšg


1792 
Œy
:

1793 
äom
 
ch”rypy
.
wsgi£rv”
.
s¦_pyİ’s¦
 
impÜt
 
pyO³nSSLAd­‹r


1794 
exû±
 
ImpÜtE¼Ü
:

1795 
·ss


1797 
£lf
.
s¦_ad­‹r
 = 
	`pyO³nSSLAd­‹r
(

1798 
£lf
.
s¦_û¹ifiÿ‹
, s–f.
s¦_´iv©e_key
,

1799 
	`g‘©Œ
(
£lf
, 's¦_û¹ifiÿ‹_chaš', 
NÚe
))

1801 #S–eù 
the
 
­´İrŸ‹
 
sock‘


1802 
	$isš¡ªû
(
£lf
.
bšd_addr
, 
ba£¡ršg
):

1803 #AF_UNIX 
sock‘


1805 #SØ
we
 
ÿn
 
»u£
 
the
 
sock‘
...

1806 
Œy
: 
os
.
	$uÆšk
(
£lf
.
bšd_addr
)

1807 
exû±
: 
·ss


1809 #SØ
ev”yÚe
 
ÿn
 
acûss
 
the
 
sock‘
...

1810 
Œy
: 
os
.
	$chmod
(
£lf
.
bšd_addr
, 511) #0777

1811 
exû±
: 
·ss


1813 
šfo
 = [(
sock‘
.
AF_UNIX
, sock‘.
SOCK_STREAM
, 0, "", 
£lf
.
bšd_addr
)]

1815 #AF_INET 
Ü
 
AF_INET6
 
sock‘


1816 #G‘ 
the
 
cÜ»ù
 
add»ss
 
çmy
 
our
 
	`ho¡
 (
®lows
 
IPv6
 
add»s£s
)

1817 
ho¡
, 
pÜt
 = 
£lf
.
bšd_addr


1818 
Œy
:

1819 
šfo
 = 
sock‘
.
	$g‘addršfo
(
ho¡
, 
pÜt
, 
sock‘
.
AF_UNSPEC
,

1820 
sock‘
.
SOCK_STREAM
, 0, sock‘.
AI_PASSIVE
)

1821 
exû±
 
sock‘
.
ga›¼Ü
:

1822 ':' 
š
 
£lf
.
bšd_addr
[0]:

1823 
šfo
 = [(
sock‘
.
AF_INET6
, sock‘.
SOCK_STREAM
,

1824 0, "", 
£lf
.
bšd_addr
 + (0, 0))]

1826 
šfo
 = [(
sock‘
.
AF_INET
, sock‘.
SOCK_STREAM
,

1827 0, "", 
£lf
.
bšd_addr
)]

1829 
£lf
.
sock‘
 = 
NÚe


1830 
msg
 = "No socket could be created"

1831 
»s
 
š
 
šfo
:

1832 
af
, 
sockty³
, 
´Ùo
, 
ÿnÚÇme
, 
§
 = 
»s


1833 
Œy
:

1834 
£lf
.
	$bšd
(
af
, 
sockty³
, 
´Ùo
)

1835 
exû±
 
sock‘
.
”rÜ
:

1836 
£lf
.
sock‘
:

1837 
£lf
.
sock‘
.
	$şo£
()

1838 
£lf
.
sock‘
 = 
NÚe


1841 
nÙ
 
£lf
.
sock‘
:

1842 
¿i£
 
sock‘
.
	$”rÜ
(
msg
)

1844 #Timeouˆ
so
 
KeybßrdIÁ”ru±
 
ÿn
 
be
 
ÿught
 
Ú
 
Wš32


1845 
£lf
.
sock‘
.
	$£‰imeout
(1)

1846 
£lf
.
sock‘
.
	$li¡’
(
£lf
.
»que¡_queue_size
)

1848 #C»©
wÜk”
 
th»ads


1849 
£lf
.
»que¡s
.
	$¡¬t
()

1851 
£lf
.
»ady
 = 
True


1852 
£lf
.
_¡¬t_time
 = 
time
.
	$time
()

1853 
£lf
.
»ady
:

1854 
Œy
:

1855 
£lf
.
	$tick
()

1856 
	$exû±
 (
KeybßrdIÁ”ru±
, 
Sy¡emEx™
):

1857 
¿i£


1858 
exû±
:

1859 
£lf
.
	`”rÜ_log
("E¼Ü iÀHTTPS”v”.tick", 
Ëv–
=
loggšg
.
ERROR
,

1860 
Œaûback
=
True
)

1862 
£lf
.
š‹¼u±
:

1863 
£lf
.
š‹¼u±
 
is
 
True
:

1864 #Wa™ 
£lf
.
	`¡İ
(è
to
 
com¶‘e
. 
S“
 
_£t_š‹¼u±
.

1865 
time
.
	$¦“p
(0.1)

1866 
£lf
.
š‹¼u±
:

1867 
¿i£
 
£lf
.
š‹¼u±


1869 
def
 
	`”rÜ_log
(
£lf
, 
msg
="", 
Ëv–
=20, 
Œaûback
=
F®£
):

1870 #Ov”rid
this
 
š
 
subşas£s
 
as
 
desœed


1871 
sys
.
¡d”r
.
	`wr™e
(
msg
 + '\n')

1872 
sys
.
¡d”r
.
	$æush
()

1873 
Œaûback
:

1874 
tblšes
 = 
	$fÜm©_exc
()

1875 
sys
.
¡d”r
.
	$wr™e
(
tblšes
)

1876 
sys
.
¡d”r
.
	$æush
()

1878 
def
 
	$bšd
(
£lf
, 
çmy
, 
ty³
, 
´Ùo
=0):

1880 
£lf
.
sock‘
 = sock‘.
	$sock‘
(
çmy
, 
ty³
, 
´Ùo
)

1881 
	$´ev’t_sock‘_šh”™ªû
(
£lf
.
sock‘
)

1882 
£lf
.
sock‘
.
	$£tsockİt
(
sock‘
.
SOL_SOCKET
, sock‘.
SO_REUSEADDR
, 1)

1883 
£lf
.
nod–ay
 
ªd
 
nÙ
 
	$isš¡ªû
(
£lf
.
bšd_addr
, 
¡r
):

1884 
£lf
.
sock‘
.
	$£tsockİt
(
sock‘
.
IPPROTO_TCP
, sock‘.
TCP_NODELAY
, 1)

1886 
£lf
.
s¦_ad­‹r
 
is
 
nÙ
 
NÚe
:

1887 
£lf
.
sock‘
 = s–f.
s¦_ad­‹r
.
	$bšd
(
£lf
.
sock‘
)

1889 #Ià
li¡’šg
 
Ú
 
the
 
IPV6
 
ªy
 
	`add»ss
 ('::' = 
IN6ADDR_ANY
),

1890 #aùiv©
du®
-
¡ack
. 
S“
 
h‰p
:

1891 ià(
	`ha§‰r
(
sock‘
, 'AF_INET6'è
ªd
 
çmy
 =ğsock‘.
AF_INET6


1892 
ªd
 
£lf
.
bšd_addr
[0] 
	`š
 ('::', '::0', '::0.0.0.0')):

1893 
Œy
:

1894 
£lf
.
sock‘
.
	$£tsockİt
(
sock‘
.
IPPROTO_IPV6
, sock‘.
IPV6_V6ONLY
, 0)

1895 
	$exû±
 (
A‰ribu‹E¼Ü
, 
sock‘
.
”rÜ
):

1896 #Aµ¬’y, 
the
 
sock‘
 
İtiÚ
 
is
 
nÙ
 
avaabË
 
š


1897 #thi 
machše
's TCP stack

1898 
·ss


1900 
£lf
.
sock‘
.
	$bšd
(
£lf
.
bšd_addr
)

1902 
def
 
	$tick
(
£lf
):

1904 
Œy
:

1905 
s
, 
addr
 = 
£lf
.
sock‘
.
	$acû±
()

1906 
£lf
.
¡©s
['Enabled']:

1907 
£lf
.
¡©s
['Accepts'] += 1

1908 
nÙ
 
£lf
.
»ady
:

1911 
	$´ev’t_sock‘_šh”™ªû
(
s
)

1912 
	`ha§‰r
(
s
, 'settimeout'):

1913 
s
.
	$£‰imeout
(
£lf
.
timeout
)

1915 
makefe
 = 
CP_feobjeù


1916 
s¦_’v
 = {
	}
}

1917 #ià
s¦
 
û¹
 
ªd
 
key
 
¬e
 
£t
, 
we
 
Œy
 
to
 
be
 
a
 
£cu»
 
HTTP
 
£rv”


1918 
	g£lf
.
s¦_ad­‹r
 
is
 
nÙ
 
	gNÚe
:

1919 
Œy
:

1920 
s
, 
	gs¦_’v
 = 
£lf
.
s¦_ad­‹r
.
	$w¿p
(
s
)

1921 
exû±
 
NoSSLE¼Ü
:

1922 
msg
 = ("The client sent‡…lain HTTP„equest, but "

1924 
buf
 = ["% 400 Bad Reque¡\r\n" % 
£lf
.
´ÙocŞ
,

1925 "CÚ‹Á-L’gth: %s\r\n" % 
	`Ën
(
msg
),

1927 
msg
]

1929 
wfe
 = 
	`makefe
(
s
, "wb", 
DEFAULT_BUFFER_SIZE
)

1930 
Œy
:

1931 
wfe
.
	`£nd®l
("".
	$još
(
buf
))

1932 
exû±
 
sock‘
.
”rÜ
:

1933 
x
 = 
sys
.
	`exc_šfo
()[1]

1934 
x
.
¬gs
[0] 
nÙ
 
š
 
sock‘_”rÜs_to_ignÜe
:

1935 
¿i£


1937 
nÙ
 
s
:

1939 
makefe
 = 
£lf
.
s¦_ad­‹r
.makefile

1940 #Re-
­¶y
 
our
 
timeout
 
sšû
 
we
 
may
 
have
 
a
 
Ãw
 
sock‘
 
objeù


1941 
	`ha§‰r
(
s
, 'settimeout'):

1942 
s
.
	$£‰imeout
(
£lf
.
timeout
)

1944 
cÚn
 = 
£lf
.
	$CÚÃùiÚCÏss
(
£lf
, 
s
, 
makefe
)

1946 
nÙ
 
	$isš¡ªû
(
£lf
.
bšd_addr
, 
ba£¡ršg
):

1947 #İtiÚ® 
v®ues


1948 #UÁ 
we
 dØ
DNS
 
lookups
, 
om™
 
REMOTE_HOST


1949 
addr
 
is
 
NÚe
: #som‘ime 
this
 
ÿn
 
h­³n


1950 #figu» 
out
 
AF_INET
 
Ü
 
AF_INET6
.

1951 
	`Ën
(
s
.
	`g‘sockÇme
()) == 2:

1953 
addr
 = ('0.0.0.0', 0)

1956 
addr
 = ('::', 0)

1957 
cÚn
.
»mÙe_addr
 = 
addr
[0]

1958 
cÚn
.
»mÙe_pÜt
 = 
addr
[1]

1960 
cÚn
.
s¦_’v
 = ssl_env

1962 
£lf
.
»que¡s
.
	$put
(
cÚn
)

1963 
exû±
 
sock‘
.
timeout
:

1964 #Th
Úly
 
»asÚ
 
the
 
timeout
 
š
 
	`¡¬t
(è
is
 
so
 
we
 
ÿn


1965 #nÙiû 
keybßrd
 
š‹¼u±s
 
Ú
 
Wš32
, 
which
 
dÚ
't interrupt

1966 #acû±(è
by
 

1968 
exû±
 
sock‘
.
”rÜ
:

1969 
x
 = 
sys
.
	`exc_šfo
()[1]

1970 
£lf
.
¡©s
['Enabled']:

1971 
£lf
.
¡©s
['Socket Errors'] += 1

1972 
x
.
¬gs
[0] 
š
 
sock‘_”rÜ_ešŒ
:

1973 #I *
thšk
* 
this
 
is
 
right
. 
EINTR
 
should
 
occur
 
wh’
 
a
 
sigÇl


1974 #i 
»ûived
 
duršg
 
the
 
	`acû±
(è
ÿÎ
; 
®l
 
docs
 
§y
 
»Œy


1975 #th
ÿÎ
, 
ªd
 
I
 *
thšk
* I'm„eading it„ighthat Python

1976 #wÈ
th’
 
go
 
ah—d
 
ªd
 
pŞl
 ªd 
hªdË
 
the
 
sigÇl


1977 #–£wh”e. 
S“
 
h‰p
:

1979 
x
.
¬gs
[0] 
š
 
sock‘_”rÜs_nÚblockšg
:

1980 #Ju¡ 
Œy
 
agaš
. 
S“
 
h‰p
:

1982 
x
.
¬gs
[0] 
š
 
sock‘_”rÜs_to_ignÜe
:

1983 #Ou¸
sock‘
 
was
 
şo£d
.

1984 #S“ 
h‰p
:

1986 
¿i£


1988 
def
 
	$_g‘_š‹¼u±
(
£lf
):

1989  
£lf
.
_š‹¼u±


1990 
def
 
	$_£t_š‹¼u±
(
£lf
, 
š‹¼u±
):

1991 
£lf
.
_š‹¼u±
 = 
True


1992 
£lf
.
	$¡İ
()

1993 
£lf
.
_š‹¼u±
 = 
š‹¼u±


1994 
š‹¼u±
 = 
	`´İ”ty
(
_g‘_š‹¼u±
, 
_£t_š‹¼u±
,

1995 
doc
="Sethiso‡n Exception instanceo "

1998 
def
 
	$¡İ
(
£lf
):

2000 
£lf
.
»ady
 = 
F®£


2001 
£lf
.
_¡¬t_time
 
is
 
nÙ
 
NÚe
:

2002 
£lf
.
_run_time
 +ğ(
time
.
	`time
(è- s–f.
_¡¬t_time
)

2003 
£lf
.
_¡¬t_time
 = 
NÚe


2005 
sock
 = 
	`g‘©Œ
(
£lf
, "sock‘", 
NÚe
)

2006 
sock
:

2007 
nÙ
 
	$isš¡ªû
(
£lf
.
bšd_addr
, 
ba£¡ršg
):

2008 #Touch 
our
 
own
 
sock‘
 
to
 
make
 
	`acû±
(è 
immedŸ‹ly
.

2009 
Œy
:

2010 
ho¡
, 
pÜt
 = 
sock
.
	`g‘sockÇme
()[:2]

2011 
exû±
 
sock‘
.
”rÜ
:

2012 
x
 = 
sys
.
	`exc_šfo
()[1]

2013 
x
.
¬gs
[0] 
nÙ
 
š
 
sock‘_”rÜs_to_ignÜe
:

2014 #Chªged 
to
 
u£
 
”rÜ
 
code
 
ªd
 
nÙ
 
mes§ge


2015 #S“ 
h‰p
:

2016 
¿i£


2018 #NÙ
th©
 
we
'reƒxplicitly NOT using AI_PASSIVE,

2019 #h”e, 
beÿu£
 
we
 
wªt
 
ª
 
aùu®
 
IP
 
to
 
touch
.

2020 #loÿlho¡ 
wÚ
'ˆwÜk iàwe'
ve
 
bound
 
to
 
a
 
public
 
IP
,

2021 #buˆ
™
 
wl
 
we
 
bound
 
to
 '0.0.0.0' (
INADDR_ANY
).

2022 
»s
 
š
 
sock‘
.
	$g‘addršfo
(
ho¡
, 
pÜt
, 
sock‘
.
AF_UNSPEC
,

2023 
sock‘
.
SOCK_STREAM
):

2024 
af
, 
sockty³
, 
´Ùo
, 
ÿnÚÇme
, 
§
 = 
»s


2025 
s
 = 
NÚe


2026 
Œy
:

2027 
s
 = 
sock‘
.
	$sock‘
(
af
, 
sockty³
, 
´Ùo
)

2028 #S“ 
h‰p
:

2029 #brow£_äm/
th»ad
/
bbã5eb39c904ã0


2030 
s
.
	$£‰imeout
(1.0)

2031 
s
.
	`cÚÃù
((
ho¡
, 
pÜt
))

2032 
s
.
	$şo£
()

2033 
exû±
 
sock‘
.
”rÜ
:

2034 
s
:

2035 
s
.
	$şo£
()

2036 
	`ha§‰r
(
sock
, "close"):

2037 
sock
.
	$şo£
()

2038 
£lf
.
sock‘
 = 
NÚe


2040 
£lf
.
»que¡s
.
	$¡İ
(
£lf
.
shutdown_timeout
)

2043 
şass
 
	$G©eway
(
objeù
):

2046 
def
 
	$__š™__
(
£lf
, 
»q
):

2047 
£lf
.
»q
 =„eq

2049 
def
 
	$»¥Úd
(
£lf
):

2051 
¿i£
 
NÙIm¶em’‹d


2054 #The£ 
may
 
e™h”
 
be
 
wsgi£rv”
.
SSLAd­‹r
 
subşas£s
 
Ü
 
the
 
¡ršg
 
Çmes


2055 #oà
such
 
	`şas£s
 (
š
 
which
 
they
 
wl
 
be
 
Ïzy
 
lßded
).

2056 
s¦_ad­‹rs
 = {

2059 
	}
}

2061 
def
 
g‘_s¦_ad­‹r_şass
(
Çme
='pyopenssl'):

2063 
ad­‹r
 = 
s¦_ad­‹rs
[
Çme
.
low”
()]

2064 
	$isš¡ªû
(
ad­‹r
, 
ba£¡ršg
):

2065 
Ï¡_dÙ
 = 
ad­‹r
.
	`rfšd
(".")

2066 
©Œ_Çme
 = 
ad­‹r
[
Ï¡_dÙ
 + 1:]

2067 
mod_·th
 = 
ad­‹r
[:
Ï¡_dÙ
]

2069 
Œy
:

2070 
mod
 = 
sys
.
moduËs
[
mod_·th
]

2071 
mod
 
is
 
NÚe
:

2072 
¿i£
 
	$KeyE¼Ü
()

2073 
exû±
 
KeyE¼Ü
:

2074 #Th
Ï¡
 [''] 
is
 
impÜÁ
.

2075 
mod
 = 
	`__impÜt__
(
mod_·th
, 
	`glob®s
(), 
	`loÿls
(), [''])

2077 #L‘ 
ª
 
A‰ribu‹E¼Ü
 
´İag©e
 
outw¬d
.

2078 
Œy
:

2079 
ad­‹r
 = 
	$g‘©Œ
(
mod
, 
©Œ_Çme
)

2080 
exû±
 
A‰ribu‹E¼Ü
:

2081 
¿i£
 
	`A‰ribu‹E¼Ü
("'%s' object has‚o‡ttribute '%s'"

2082 % (
mod_·th
, 
©Œ_Çme
))

2084  
ad­‹r


2086 #-------------------------------- 
WSGI
 
Stuff
 -------------------------------- #


2088 
şass
 
	$Ch”ryPyWSGIS”v”
(
HTTPS”v”
):

2091 
wsgi_v”siÚ
 = (1, 0)

2094 
def
 
	`__š™__
(
£lf
, 
bšd_addr
, 
wsgi_­p
, 
numth»ads
=10, 
£rv”_Çme
=
NÚe
,

2095 
max
=-1, 
»que¡_queue_size
=5, 
timeout
=10, 
shutdown_timeout
=5):

2096 
£lf
.
»que¡s
 = 
	$Th»adPoŞ
(
£lf
, 
mš
=
numth»ads
 
Ü
 1, 
max
=max)

2097 
£lf
.
wsgi_­p
 = wsgi_app

2098 
£lf
.
g©eway
 = 
wsgi_g©eways
[£lf.
wsgi_v”siÚ
]

2100 
£lf
.
bšd_addr
 = bind_addr

2101 
nÙ
 
£rv”_Çme
:

2102 
£rv”_Çme
 = 
sock‘
.
	$g‘ho¡Çme
()

2103 
£lf
.
£rv”_Çme
 = server_name

2104 
£lf
.
»que¡_queue_size
 =„equest_queue_size

2106 
£lf
.
timeout
 =imeout

2107 
£lf
.
shutdown_timeout
 = shutdown_timeout

2108 
£lf
.
	$ş—r_¡©s
()

2110 
def
 
	$_g‘_numth»ads
(
£lf
):

2111  
£lf
.
»que¡s
.
mš


2112 
def
 
	$_£t_numth»ads
(
£lf
, 
v®ue
):

2113 
£lf
.
»que¡s
.
mš
 = 
v®ue


2114 
numth»ads
 = 
	$´İ”ty
(
_g‘_numth»ads
, 
_£t_numth»ads
)

2117 
şass
 
	$WSGIG©eway
(
G©eway
):

2120 
def
 
	$__š™__
(
£lf
, 
»q
):

2121 
£lf
.
»q
 =„eq

2122 
£lf
.
¡¬‹d_»¥Ú£
 = 
F®£


2123 
£lf
.
’v
 = s–f.
	$g‘_’vœÚ
()

2124 
£lf
.
»maššg_by‹s_out
 = 
NÚe


2126 
def
 
	$g‘_’vœÚ
(
£lf
):

2128 
¿i£
 
NÙIm¶em’‹d


2130 
def
 
	$»¥Úd
(
£lf
):

2132 
»¥Ú£
 = 
£lf
.
»q
.
£rv”
.
	$wsgi_­p
(
£lf
.
’v
, s–f.
¡¬t_»¥Ú£
)

2133 
Œy
:

2134 
chunk
 
š
 
»¥Ú£
:

2135 #"
The
 
¡¬t_»¥Ú£
 
ÿÎabË
 
mu¡
 
nÙ
 
aùu®ly
 
Œªsm™


2136 #th
»¥Ú£
 
h—d”s
. 
In¡—d
, 
™
 
mu¡
 
¡Üe
 
them
 
the


2137 #£rv” 
Ü
 
g©eway
 
to
 
Œªsm™
 
Úly
 
aá”
 
the
 
fœ¡


2138 #™”©iÚ 
of
 
the
 
­¶iÿtiÚ
  
v®ue
 
th©
 
y›lds


2139 #¨
NON
-
EMPTY
 
¡ršg
, 
Ü
 
upÚ
 
the
 
­¶iÿtiÚ
's first

2140 #švoÿtiÚ 
of
 
the
 
	`wr™e
(è
ÿÎabË
." (PEP 333)

2141 
chunk
:

2142 
	$isš¡ªû
(
chunk
, 
unicode¡r
):

2143 
chunk
 = chunk.
	`’code
('ISO-8859-1')

2144 
£lf
.
	$wr™e
(
chunk
)

2145 
fš®ly
:

2146 
	`ha§‰r
(
»¥Ú£
, "close"):

2147 
»¥Ú£
.
	$şo£
()

2149 
def
 
	$¡¬t_»¥Ú£
(
£lf
, 
¡©us
, 
h—d”s
, 
exc_šfo
 = 
NÚe
):

2151 #"
The
 
­¶iÿtiÚ
 
may
 
ÿÎ
 
¡¬t_»¥Ú£
 
mÜe
 
thª
 
Úû
,

2152 #ià
ªd
 
Úly
 
the
 
exc_šfo
 
¬gum’t
 
is
 
´ovided
."

2153 
£lf
.
¡¬‹d_»¥Ú£
 
ªd
 
nÙ
 
exc_šfo
:

2154 
¿i£
 
	`As£¹iÚE¼Ü
("WSGI start_response called‡ second "

2156 
£lf
.
¡¬‹d_»¥Ú£
 = 
True


2158 #"
exc_šfo
 
is
 
´ovided
, 
ªd
 
the
 
HTTP
 
h—d”s
 
have
 
®»ady
 
b“n


2159 #£Á, 
¡¬t_»¥Ú£
 
mu¡
 
¿i£
 
ª
 
”rÜ
, 
ªd
 
should
„ai£ 
the


2160 #exc_šfØ
tu¶e
."

2161 
£lf
.
»q
.
£Á_h—d”s
:

2162 
Œy
:

2163 
¿i£
 
exc_šfo
[0],ƒxc_info[1],ƒxc_info[2]

2164 
fš®ly
:

2165 
exc_šfo
 = 
NÚe


2167 
£lf
.
»q
.
¡©us
 = status

2168 
k
, 
v
 
š
 
h—d”s
:

2169 
nÙ
 
	$isš¡ªû
(
k
, 
¡r
):

2170 
¿i£
 
	`Ty³E¼Ü
("WSGI„e¥Ú£ h—d” key %¸i nÙ oàty³ sŒ." % 
k
)

2171 
nÙ
 
	$isš¡ªû
(
v
, 
¡r
):

2172 
¿i£
 
	`Ty³E¼Ü
("WSGI„e¥Ú£ h—d” v®u%¸i nÙ oàty³ sŒ." % 
v
)

2173 
k
.
	`low”
() == 'content-length':

2174 
£lf
.
»maššg_by‹s_out
 = (
v
)

2175 
£lf
.
»q
.
outh—d”s
.
	$ex‹nd
(
h—d”s
)

2177  
£lf
.
wr™e


2179 
def
 
	$wr™e
(
£lf
, 
chunk
):

2182 
This
 
m‘hod
 
is
 
®so
 
u£d
 
š‹º®ly
 
by
 
	`¡¬t_»¥Ú£
 (
to
 
wr™e


2183 
d©a
 
äom
 
the
 
™”abË
 
»tuºed
 
by
h
WSGI
 
­¶iÿtiÚ
).

2185 
nÙ
 
£lf
.
¡¬‹d_»¥Ú£
:

2186 
¿i£
 
	`As£¹iÚE¼Ü
("WSGI write called before start_response.")

2188 
chunkËn
 = 
	$Ën
(
chunk
)

2189 
rbo
 = 
£lf
.
»maššg_by‹s_out


2190 
rbo
 
is
 
nÙ
 
NÚe
 
ªd
 
chunkËn
 >„bo:

2191 
nÙ
 
£lf
.
»q
.
£Á_h—d”s
:

2192 #Whew. 
We
 
ÿn
 
£nd
 
a
 500 
to
 
the
 
ş›Á
.

2193 
£lf
.
»q
.
	`sim¶e_»¥Ú£
("500 Internal Server Error",

2197 #Dªg. 
We
 
have
 
´obably
 
®»ady
 
£Á
 
d©a
. 
Trunÿ‹
 
the
 
chunk


2198 #tØ
	`f™
 (
so
 
the
 
ş›Á
 
dÛ¢
't hang)‡nd„aise‡nƒrror†ater.

2199 
chunk
 = chunk[:
rbo
]

2201 
nÙ
 
£lf
.
»q
.
£Á_h—d”s
:

2202 
£lf
.
»q
.
£Á_h—d”s
 = 
True


2203 
£lf
.
»q
.
	$£nd_h—d”s
()

2205 
£lf
.
»q
.
	$wr™e
(
chunk
)

2207 
rbo
 
is
 
nÙ
 
NÚe
:

2208 
rbo
 -ğ
chunkËn


2209 
rbo
 < 0:

2210 
¿i£
 
	`V®ueE¼Ü
(

2214 
şass
 
	$WSGIG©eway_10
(
WSGIG©eway
):

2217 
def
 
	$g‘_’vœÚ
(
£lf
):

2219 
»q
 = 
£lf
.req

2220 
’v
 = {

2221 #£ˆ
a
 
nÚ
-
¡ªd¬d
 
’vœÚ
 
’Œy
 
so
 
the
 
WSGI
 
­p
 
ÿn
 
know
 
wh©


2222 #th*
»®
* 
£rv”
 
´ÙocŞ
 
	`is
 (
ªd
 
wh©
 
ã©u»s
 
to
 
suµÜt
).

2223 #S“ 
h‰p
:

2224 'ACTUAL_SERVER_PROTOCOL': 
»q
.
£rv”
.
´ÙocŞ
,

2225 'PATH_INFO': 
»q
.
·th
,

2226 'QUERY_STRING': 
»q
.
qs
,

2227 'REMOTE_ADDR': 
»q
.
cÚn
.
»mÙe_addr
 
Ü
 '',

2228 'REMOTE_PORT': 
	`¡r
(
»q
.
cÚn
.
»mÙe_pÜt
 
Ü
 ''),

2229 'REQUEST_METHOD': 
»q
.
m‘hod
,

2230 'REQUEST_URI': 
»q
.
uri
,

2232 'SERVER_NAME': 
»q
.
£rv”
.
£rv”_Çme
,

2233 #Bah. "SERVER_PROTOCOL" 
is
 
aùu®ly
 
the
 
REQUEST
 
´ÙocŞ
.

2234 'SERVER_PROTOCOL': 
»q
.
»que¡_´ÙocŞ
,

2235 'SERVER_SOFTWARE': 
»q
.
£rv”
.
soáw¬e
,

2236 'wsgi.”rÜs': 
sys
.
¡d”r
,

2237 'wsgi.šput': 
»q
.
rfe
,

2238 'wsgi.muÉroûss': 
F®£
,

2239 'wsgi.muÉ™h»ad': 
True
,

2240 'wsgi.run_Úû': 
F®£
,

2241 'wsgi.u¾_scheme': 
»q
.
scheme
,

2243 
	}
}

2245 
	$isš¡ªû
(
»q
.
£rv”
.
bšd_addr
, 
ba£¡ršg
):

2246 #AF_UNIX. 
This
 
i¢
'ˆ»®ly‡Îowed by WSGI, which dÛ¢'
t


2247 #add»s 
unix
 
domaš
 
sock‘s
. 
But
 
™
's betterhan‚othing.

2248 
’v
["SERVER_PORT"] = ""

2250 
’v
["SERVER_PORT"] = 
	$¡r
(
»q
.
£rv”
.
bšd_addr
[1])

2252 #Reque¡ 
h—d”s


2253 
k
, 
v
 
š
 
»q
.
šh—d”s
.
	$™”™ems
():

2254 
’v
["HTTP_" + 
k
.
	`uµ”
().
	`»¶aû
("-", "_")] = 
v


2256 #CONTENT_TYPE/
CONTENT_LENGTH


2257 
ù
 = 
’v
.
	`pİ
("HTTP_CONTENT_TYPE", 
NÚe
)

2258 
ù
 
is
 
nÙ
 
NÚe
:

2259 
’v
["CONTENT_TYPE"] = 
ù


2260 
ş
 = 
’v
.
	`pİ
("HTTP_CONTENT_LENGTH", 
NÚe
)

2261 
ş
 
is
 
nÙ
 
NÚe
:

2262 
’v
["CONTENT_LENGTH"] = 
ş


2264 
»q
.
cÚn
.
s¦_’v
:

2265 
’v
.
	$upd©e
(
»q
.
cÚn
.
s¦_’v
)

2267  
’v


2270 
şass
 
	$WSGIG©eway_u0
(
WSGIG©eway_10
):

2273 
WSGI
 
u
.0 
is
 
ª
 
ex³rim’l
 
´ÙocŞ
, 
which
 
u£s
 
unicode
 
keys
 
ªd
 
v®ues


2274 
š
 
bÙh
 
PythÚ
 2 
ªd
 Python 3.

2277 
def
 
	$g‘_’vœÚ
(
£lf
):

2279 
»q
 = 
£lf
.req

2280 
’v_10
 = 
WSGIG©eway_10
.
	$g‘_’vœÚ
(
£lf
)

2281 
’v
 = 
	`diù
([(
k
.
	`decode
('ISO-8859-1'), 
v
èk, v 
š
 
’v_10
.
	`™”™ems
()])

2282 
’v
[
u
'wsgi.version'] = ('u', 0)

2284 #Reque¡-
URI


2285 
’v
.
	`£tdeçuÉ
(
u
'wsgi.url_encoding', u'utf-8')

2286 
Œy
:

2287 
key
 
š
 [
u
"PATH_INFO", u"SCRIPT_NAME", u"QUERY_STRING"]:

2288 
’v
[
key
] = 
’v_10
[
	`¡r
(key)].
	`decode
Ónv[
u
'wsgi.url_encoding'])

2289 
exû±
 
UnicodeDecodeE¼Ü
:

2290 #F®È
back
 
to
 
Ïtš
 1 
so
 
­ps
 
ÿn
 
Œªscode
 
Ãeded
.

2291 
’v
[
u
'wsgi.url_encoding'] = u'ISO-8859-1'

2292 
key
 
š
 [
u
"PATH_INFO", u"SCRIPT_NAME", u"QUERY_STRING"]:

2293 
’v
[
key
] = 
’v_10
[
	`¡r
(key)].
	`decode
Ónv[
u
'wsgi.url_encoding'])

2295 
k
, 
v
 
š
 
	`sÜ‹d
(
’v
.
	$™ems
()):

2296 
	$isš¡ªû
(
v
, 
¡r
è
ªd
 
k
 
nÙ
 
	`š
 ('REQUEST_URI', 'wsgi.input'):

2297 
’v
[
k
] = 
v
.
	`decode
('ISO-8859-1')

2299  
’v


2301 
wsgi_g©eways
 = {

2302 (1, 0): 
WSGIG©eway_10
,

2303 ('u', 0): 
WSGIG©eway_u0
,

2304 
	}
}

2306 
şass
 
	$WSGIP©hInfoDi¥©ch”
(
objeù
):

2309 
­ps
: 
a
 
diù
 
Ü
 
li¡
 
	$of
 (
·th_´efix
, 
­p
è
·œs
.

2312 
def
 
	$__š™__
(
£lf
, 
­ps
):

2313 
Œy
:

2314 
­ps
 = 
	`li¡
×µs.
	$™ems
())

2315 
exû±
 
A‰ribu‹E¼Ü
:

2316 
·ss


2318 #SÜˆ
the
 
­ps
 
by
 
	`Ën
(
·th
), 
desûndšg


2319 
­ps
.
	`sÜt
(
cmp
=
Ïmbda
 
x
,
y
: 
	`cmp
(
	`Ën
(x[0]), 
	$Ën
(
y
[0])))

2320 
­ps
.
	$»v”£
()

2322 #Th
·th_´efix
 
¡ršgs
 
mu¡
 
¡¬t
, 
but
 
nÙ
 
’d
, 
w™h
 
a
 
¦ash
.

2323 #U£ "" 
š¡—d
 
of
 "/".

2324 
£lf
.
­ps
 = [(
p
.
	`r¡r
("/"), 
a
èp,‡ 
š
‡pps]

2326 
def
 
	$__ÿÎ__
(
£lf
, 
’vœÚ
, 
¡¬t_»¥Ú£
):

2327 
·th
 = 
’vœÚ
["PATH_INFO"] 
Ü
 "/"

2328 
p
, 
­p
 
š
 
£lf
.
­ps
:

2329 #Th
­ps
 
li¡
 
should
 
be
 
sÜ‹d
 
by
 
Ëngth
, 
desûndšg
.

2330 
·th
.
	`¡¬tsw™h
(
p
 + "/"è
Ü
…ath ==…:

2331 
’vœÚ
 =ƒnvœÚ.
	$cİy
()

2332 
’vœÚ
["SCRIPT_NAME"] =ƒnvœÚ["SCRIPT_NAME"] + 
p


2333 
’vœÚ
["PATH_INFO"] = 
·th
[
	$Ën
(
p
):]

2334  
	$­p
(
’vœÚ
, 
¡¬t_»¥Ú£
)

2336 
	`¡¬t_»¥Ú£
('404 Not Found', [('Content-Type', 'text/plain'),

	@trunk/objs/CherryPy-3.2.4/cherrypy/wsgiserver/wsgiserver3.py

3 
Sim¶e¡
 
exam¶e
 
Ú
 
how
 
to
 
u£
 
this
 
moduË
 
	gdœeùly


4 (
w™hout
 
usšg
 
	gCh”ryPy
's‡pplication machinery)::

6 
äom
 
ch”rypy
 
impÜt
 
wsgi£rv”


8 
def
 
	$my_üazy_­p
(
’vœÚ
, 
¡¬t_»¥Ú£
):

9 
¡©us
 = '200 OK'

10 
»¥Ú£_h—d”s
 = [('Content-type','text/plain')]

11 
	$¡¬t_»¥Ú£
(
¡©us
, 
»¥Ú£_h—d”s
)

14 
£rv”
 = 
wsgi£rv”
.
	`Ch”ryPyWSGIS”v”
(

15 ('0.0.0.0', 8070), 
my_üazy_­p
,

16 
£rv”_Çme
='www.cherrypy.example')

17 
£rv”
.
	$¡¬t
()

19 
The
 
Ch”ryPy
 
WSGI
 
£rv”
 
ÿn
 
£rve
 
as
 
mªy
 WSGI 
­¶iÿtiÚs


20 
as
 
you
 
wªt
 
š
 
Úe
 
š¡ªû
 
by
 
usšg
 
a
 
WSGIP©hInfoDi¥©ch”
::

22 
d
 = 
	`WSGIP©hInfoDi¥©ch”
({'/': 
my_üazy_­p
, '/blog': 
my_blog_­p
})

23 
£rv”
 = 
wsgi£rv”
.
Ch”ryPyWSGIS”v”
(('0.0.0.0', 80), 
d
)

25 
Wªt
 
SSL
 
	gsuµÜt
? 
Ju¡
 
£t
 
	g£rv”
.
s¦_ad­‹r
 
to
 
ª
 
SSLAd­‹r
 
	gš¡ªû
.

27 
This
 
	gwÚ
't callhe CherryPyƒngine (application side)‡t‡ll, onlyhe

28 
HTTP
 
	g£rv”
, 
which
 
is
 
šd•’d’t
 
äom
 
the
 
»¡
 
of
 
	gCh”ryPy
. 
	gDÚ
't

29 
Ët
 
the
 
	gÇme
 "Ch”ryPyWSGIS”v”" 
throw
 
	gyou
;h
Çme
 
m”–y
 
»æeùs


30 
™s
 
	gÜigš
, 
nÙ
 it 
	gcou¶šg
.

32 
FÜ
 
tho£
 
of
 
you
 
wªtšg
 
to
 
und”¡ªd
 
š‹º®s
 oà
this
 
	gmoduË
, 
	gh”e
'she

33 
basic
 
ÿÎ
 
	gæow
. 
The
 
	g£rv”
's†isteninghread„uns‡ veryight†oop,

34 
¡ickšg
 
šcomšg
 
cÚÃùiÚs
 
Úto
 
a
 
	gQueue
::

36 
£rv”
 = 
	$Ch”ryPyWSGIS”v”
(...)

37 
£rv”
.
	$¡¬t
()

38 
True
:

39 
	$tick
()

40 #Thi 
blocks
 
uÁ
 
a
 
»que¡
 
comes
 
š
:

41 
chd
 = 
sock‘
.
	$acû±
()

42 
cÚn
 = 
	$HTTPCÚÃùiÚ
(
chd
, ...)

43 
£rv”
.
»que¡s
.
	$put
(
cÚn
)

45 
WÜk”
 
th»ads
 
¬e
 
k•t
 
š
 
a
 
poŞ
 
ªd
 
pŞl
 
the
 
Queue
, 
pİpšg
 
off
‡nd 
th’


46 
hªdlšg
 
—ch
 
cÚÃùiÚ
 
š
 
tuº
. 
Each
 cÚÃùiÚ 
ÿn
 
cÚsi¡
 
of
 
ª
 
¬b™¿ry


47 
numb”
 
of
 
»que¡s
 
ªd
 
theœ
 
»¥Ú£s
, 
so
 
we
 
run
 
a
 
Ã¡ed
 
loİ
::

49 
True
:

50 
cÚn
 = 
£rv”
.
»que¡s
.
	$g‘
()

51 
cÚn
.
	`communiÿ‹
()

52 -> 
True
:

53 
»q
 = 
	$HTTPReque¡
(...)

54 
»q
.
	`·r£_»que¡
()

55 -> #R—d 
the
 
Reque¡
-
Lše
, 
e
.
g
. "GET /page HTTP/1.1"

56 
»q
.
rfe
.
	$»adlše
()

57 
	$»ad_h—d”s
(
»q
.
rfe
,„eq.
šh—d”s
)

58 
»q
.
	`»¥Úd
()

59 -> 
»¥Ú£
 = 
	$­p
(...)

60 
Œy
:

61 
chunk
 
š
 
»¥Ú£
:

62 
chunk
:

63 
»q
.
	$wr™e
(
chunk
)

64 
fš®ly
:

65 
	`ha§‰r
(
»¥Ú£
, "close"):

66 
»¥Ú£
.
	$şo£
()

67 
»q
.
şo£_cÚÃùiÚ
:

71 
__®l__
 = ['HTTPRequest', 'HTTPConnection', 'HTTPServer',

80 
impÜt
 
os


81 
Œy
:

82 
impÜt
 
queue


83 
exû±
:

84 
impÜt
 
Queue
 
as
 
queue


85 
impÜt
 
»


86 
impÜt
 
ema
.
uts


87 
impÜt
 
sock‘


88 
impÜt
 
sys


89 'wš' 
š
 
sys
.
¶©fÜm
 
ªd
 
nÙ
 
	`ha§‰r
(
sock‘
, 'IPPROTO_IPV6'):

90 
sock‘
.
IPPROTO_IPV6
 = 41

91 
sys
.
v”siÚ_šfo
 < (3,1):

92 
impÜt
 
io


94 
impÜt
 
_pyio
 
as
 
io


95 
DEFAULT_BUFFER_SIZE
 = 
io
.DEFAULT_BUFFER_SIZE

97 
impÜt
 
th»adšg


98 
impÜt
 
time


99 
äom
 
Œaûback
 
impÜt
 
fÜm©_exc


101 
sys
.
v”siÚ_šfo
 >= (3, 0):

102 
by‹¡r
 = 
by‹s


103 
unicode¡r
 = 
¡r


104 
ba£¡ršg
 = (
by‹s
, 
¡r
)

105 
def
 
	`Áob
(
n
, 
’codšg
='ISO-8859-1'):

107 #IÀ
PythÚ
 3, 
the
 
Çtive
 
¡ršg
 
ty³
 
is
 
unicode


108  
n
.
	$’code
(
’codšg
)

110 
by‹¡r
 = 
¡r


111 
unicode¡r
 = 
unicode


112 
ba£¡ršg
 = basestring

113 
def
 
	`Áob
(
n
, 
’codšg
='ISO-8859-1'):

115 #IÀ
PythÚ
 2, 
the
 
Çtive
 
¡ršg
 
ty³
 
is
 
by‹s
. 
Assume
 
™
's‡lready

116 #š 
the
 
giv’
 
’codšg
, 
which
 
ISO
-8859-1 
is
 
®mo¡
 
®ways
 
wh©


117 #wa 
š‹nded
.

118  
n


120 
LF
 = 
	`Áob
('\n')

121 
CRLF
 = 
	`Áob
('\r\n')

122 
TAB
 = 
	`Áob
('\t')

123 
SPACE
 = 
	`Áob
(' ')

124 
COLON
 = 
	`Áob
(':')

125 
SEMICOLON
 = 
	`Áob
(';')

126 
EMPTY
 = 
	`Áob
('')

127 
NUMBER_SIGN
 = 
	`Áob
('#')

128 
QUESTION_MARK
 = 
	`Áob
('?')

129 
ASTERISK
 = 
	`Áob
('*')

130 
FORWARD_SLASH
 = 
	`Áob
('/')

131 
quÙed_¦ash
 = 
»
.
	`compe
(
	`Áob
("(?i)%2F"))

133 
impÜt
 
”ºo


135 
def
 
	$¶©_¥ecific_”rÜs
(*
”ºames
):

138 
The
 '”ºo' 
moduË
 
cÚšs
 
difã»Á
 
glob®
 
cÚ¡ªts
 
d•’dšg
 
Ú


139 
the
 
¥ecific
 
	`¶©fÜm
 (
OS
). 
This
 
funùiÚ
 
wl
 h
li¡
 
of


140 
num”ic
 
v®ues
 
a
 
giv’
 
li¡
 
of
 
pÙ’tŸl
 
Çmes
.

142 
”ºo_Çmes
 = 
	$dœ
(
”ºo
)

143 
nums
 = [
	$g‘©Œ
(
”ºo
, 
k
èk 
š
 
”ºames
 k iÀ
”ºo_Çmes
]

144 #de-
du³
 
the
 
li¡


145  
	`li¡
(
diù
.
	`äomkeys
(
nums
).
	$keys
())

147 
sock‘_”rÜ_ešŒ
 = 
	`¶©_¥ecific_”rÜs
("EINTR", "WSAEINTR")

149 
sock‘_”rÜs_to_ignÜe
 = 
	`¶©_¥ecific_”rÜs
(

160 
sock‘_”rÜs_to_ignÜe
.
	`­³nd
("timed out")

161 
sock‘_”rÜs_to_ignÜe
.
	`­³nd
("The„ead operationimed out")

163 
sock‘_”rÜs_nÚblockšg
 = 
	`¶©_¥ecific_”rÜs
(

166 
comma_£·¿‹d_h—d”s
 = [
	$Áob
(
h
èh 
š


175 
impÜt
 
loggšg


176 
nÙ
 
	`ha§‰r
(
loggšg
, '¡©i¡ics'):†oggšg.
¡©i¡ics
 = {
	}
}

179 
def
 
	$»ad_h—d”s
(
rfe
, 
hdiù
=
NÚe
):

182 
If
 
hdiù
 
is
 
NÚe
, 
a
 
Ãw
 
h—d”
 
diù
 i 
ü—‹d
. 
R‘uºs
 
the
 
pİuÏ‹d


183 
h—d”
 
diù
.

185 
H—d”s
 
which
 
¬e
 
»³©ed
‡» 
fŞded
 
tog‘h”
 
usšg
 
a
 
comma
 
theœ


186 
¥ecifiÿtiÚ
 
so
 
diù©es
.

188 
This
 
funùiÚ
 
¿i£s
 
V®ueE¼Ü
 
wh’
 
the
 
»ad
 
by‹s
 
viŞ©e
h
HTTP
 
¥ec
.

189 
You
 
should
 
´obably
  "400 Bad Reque¡" 
this
 
h­³ns
.

191 
hdiù
 
is
 
NÚe
:

192 
hdiù
 = {
	}
}

194 
True
:

195 
lše
 = 
rfe
.
	$»adlše
()

196 
nÙ
 
lše
:

197 #NØ
mÜe
 
d©a
--
Ëg®
 
’d
 
of
 
h—d”s


198 
¿i£
 
	`V®ueE¼Ü
("Illegalƒnd of headers.")

200 
lše
 =ğ
CRLF
:

201 #NÜm® 
’d
 
of
 
h—d”s


203 
nÙ
 
lše
.
	$’dsw™h
(
CRLF
):

204 
¿i£
 
	`V®ueE¼Ü
("HTTP„equires CRLFerminators")

206 
lše
[0] 
	$š
 (
SPACE
, 
TAB
):

208 
v
 = 
lše
.
	$¡r
()

210 
Œy
:

211 
k
, 
v
 = 
lše
.
	$¥l™
(
COLON
, 1)

212 
exû±
 
V®ueE¼Ü
:

213 
¿i£
 
	`V®ueE¼Ü
("Illegal header†ine.")

214 #TODO: 
wh©
 
about
 
TE
 
ªd
 
WWW
-
Auth’tiÿ‹
?

215 
k
 = k.
	`¡r
().
	$t™Ë
()

216 
v
 = v.
	$¡r
()

217 
hÇme
 = 
k


219 
k
 
š
 
comma_£·¿‹d_h—d”s
:

220 
exi¡šg
 = 
hdiù
.
	$g‘
(
hÇme
)

221 
exi¡šg
:

222 
v
 = 
b
", ".
	`još
((
exi¡šg
, v))

223 
hdiù
[
hÇme
] = 
v


225  
hdiù


228 
şass
 
	$MaxSizeExûeded
(
Exû±iÚ
):

229 
·ss


231 
şass
 
	$SizeCheckW¿µ”
(
objeù
):

234 
def
 
	$__š™__
(
£lf
, 
rfe
, 
maxËn
):

235 
£lf
.
rfe
 =„file

236 
£lf
.
maxËn
 = maxlen

237 
£lf
.
by‹s_»ad
 = 0

239 
def
 
	$_check_Ëngth
(
£lf
):

240 
£lf
.
maxËn
 
ªd
 s–f.
by‹s_»ad
 > self.maxlen:

241 
¿i£
 
	$MaxSizeExûeded
()

243 
def
 
	$»ad
(
£lf
, 
size
=
NÚe
):

244 
d©a
 = 
£lf
.
rfe
.
	$»ad
(
size
)

245 
£lf
.
by‹s_»ad
 +ğ
	$Ën
(
d©a
)

246 
£lf
.
	$_check_Ëngth
()

247  
d©a


249 
def
 
	$»adlše
(
£lf
, 
size
=
NÚe
):

250 
size
 
is
 
nÙ
 
NÚe
:

251 
d©a
 = 
£lf
.
rfe
.
	$»adlše
(
size
)

252 
£lf
.
by‹s_»ad
 +ğ
	$Ën
(
d©a
)

253 
£lf
.
	$_check_Ëngth
()

254  
d©a


256 #U£¸
didn
't specify‡ size ...

257 #W
»ad
 
the
 
lše
 
š
 
chunks
 
to
 
make
 
su»
 
™
's‚ot‡ 100MB†ine !

258 
»s
 = []

259 
True
:

260 
d©a
 = 
£lf
.
rfe
.
	$»adlše
(256)

261 
£lf
.
by‹s_»ad
 +ğ
	$Ën
(
d©a
)

262 
£lf
.
	$_check_Ëngth
()

263 
»s
.
	$­³nd
(
d©a
)

264 #S“ 
h‰p
:

265 
	`Ën
(
d©a
è< 256 
Ü
 d©a[-1:].
	`decode
() == "\n":

266  
EMPTY
.
	$još
(
»s
)

268 
def
 
	$»adlšes
(
£lf
, 
sizehšt
=0):

269 #Sham–es¦y 
¡Ş’
 
äom
 
SŒšgIO


270 
tÙ®
 = 0

271 
lšes
 = []

272 
lše
 = 
£lf
.
	$»adlše
()

273 
lše
:

274 
lšes
.
	$­³nd
(
lše
)

275 
tÙ®
 +ğ
	$Ën
(
lše
)

276 0 < 
sizehšt
 <ğ
tÙ®
:

278 
lše
 = 
£lf
.
	$»adlše
()

279  
lšes


281 
def
 
	$şo£
(
£lf
):

282 
£lf
.
rfe
.
	$şo£
()

284 
def
 
	$__™”__
(
£lf
):

285  
£lf


287 
def
 
	$__Ãxt__
(
£lf
):

288 
d©a
 = 
	$Ãxt
(
£lf
.
rfe
)

289 
£lf
.
by‹s_»ad
 +ğ
	$Ën
(
d©a
)

290 
£lf
.
	$_check_Ëngth
()

291  
d©a


293 
def
 
	$Ãxt
(
£lf
):

294 
d©a
 = 
£lf
.
rfe
.
	$Ãxt
()

295 
£lf
.
by‹s_»ad
 +ğ
	$Ën
(
d©a
)

296 
£lf
.
	$_check_Ëngth
()

297  
d©a


300 
şass
 
	$KnownL’gthRFe
(
objeù
):

303 
def
 
	$__š™__
(
£lf
, 
rfe
, 
cÚ‹Á_Ëngth
):

304 
£lf
.
rfe
 =„file

305 
£lf
.
»maššg
 = 
cÚ‹Á_Ëngth


307 
def
 
	$»ad
(
£lf
, 
size
=
NÚe
):

308 
£lf
.
»maššg
 == 0:

309  
b
''

310 
size
 
is
 
NÚe
:

311 
size
 = 
£lf
.
»maššg


313 
size
 = 
	$mš
(
size
, 
£lf
.
»maššg
)

315 
d©a
 = 
£lf
.
rfe
.
	$»ad
(
size
)

316 
£lf
.
»maššg
 -ğ
	$Ën
(
d©a
)

317  
d©a


319 
def
 
	$»adlše
(
£lf
, 
size
=
NÚe
):

320 
£lf
.
»maššg
 == 0:

321  
b
''

322 
size
 
is
 
NÚe
:

323 
size
 = 
£lf
.
»maššg


325 
size
 = 
	$mš
(
size
, 
£lf
.
»maššg
)

327 
d©a
 = 
£lf
.
rfe
.
	$»adlše
(
size
)

328 
£lf
.
»maššg
 -ğ
	$Ën
(
d©a
)

329  
d©a


331 
def
 
	$»adlšes
(
£lf
, 
sizehšt
=0):

332 #Sham–es¦y 
¡Ş’
 
äom
 
SŒšgIO


333 
tÙ®
 = 0

334 
lšes
 = []

335 
lše
 = 
£lf
.
	$»adlše
(
sizehšt
)

336 
lše
:

337 
lšes
.
	$­³nd
(
lše
)

338 
tÙ®
 +ğ
	$Ën
(
lše
)

339 0 < 
sizehšt
 <ğ
tÙ®
:

341 
lše
 = 
£lf
.
	$»adlše
(
sizehšt
)

342  
lšes


344 
def
 
	$şo£
(
£lf
):

345 
£lf
.
rfe
.
	$şo£
()

347 
def
 
	$__™”__
(
£lf
):

348  
£lf


350 
def
 
	$__Ãxt__
(
£lf
):

351 
d©a
 = 
	$Ãxt
(
£lf
.
rfe
)

352 
£lf
.
»maššg
 -ğ
	$Ën
(
d©a
)

353  
d©a


356 
şass
 
	$ChunkedRFe
(
objeù
):

359 
This
 
şass
 
is
 
š‹nded
 
to
 
´ovide
 
a
 
cÚfÜmšg
 
wsgi
.
šput
 
v®ue
 

360 
»que¡
 
’t™›s
 
th©
 
have
 
b“n
 
’coded
 
w™h
 
the
 'chunked' 
Œªsãr


361 
’codšg
.

364 
def
 
	$__š™__
(
£lf
, 
rfe
, 
maxËn
, 
bufsize
=8192):

365 
£lf
.
rfe
 =„file

366 
£lf
.
maxËn
 = maxlen

367 
£lf
.
by‹s_»ad
 = 0

368 
£lf
.
bufãr
 = 
EMPTY


369 
£lf
.
bufsize
 = bufsize

370 
£lf
.
şo£d
 = 
F®£


372 
def
 
	$_ãtch
(
£lf
):

373 
£lf
.
şo£d
:

376 
lše
 = 
£lf
.
rfe
.
	$»adlše
()

377 
£lf
.
by‹s_»ad
 +ğ
	$Ën
(
lše
)

379 
£lf
.
maxËn
 
ªd
 s–f.
by‹s_»ad
 > self.maxlen:

380 
¿i£
 
	`MaxSizeExûeded
("Reque¡ EÁ™y ToØL¬ge", 
£lf
.
maxËn
)

382 
lše
 =†še.
	`¡r
().
	$¥l™
(
SEMICOLON
, 1)

384 
Œy
:

385 
chunk_size
 = 
lše
.
	$pİ
(0)

386 
chunk_size
 = (chunk_size, 16)

387 
exû±
 
V®ueE¼Ü
:

388 
¿i£
 
	`V®ueE¼Ü
("Bad chunked¿nsã¸size: " + 
	$»´
(
chunk_size
))

390 
chunk_size
 <= 0:

391 
£lf
.
şo£d
 = 
True


394 ## 
lše
: 
chunk_ex‹nsiÚ
 =†ine[0]

396 
£lf
.
maxËn
 
ªd
 s–f.
by‹s_»ad
 + 
chunk_size
 > self.maxlen:

397 
¿i£
 
	`IOE¼Ü
("Request Entity Too Large")

399 
chunk
 = 
£lf
.
rfe
.
	$»ad
(
chunk_size
)

400 
£lf
.
by‹s_»ad
 +ğ
	$Ën
(
chunk
)

401 
£lf
.
bufãr
 +ğ
chunk


403 
ülf
 = 
£lf
.
rfe
.
	$»ad
(2)

404 
ülf
 !ğ
CRLF
:

405 
¿i£
 
	`V®ueE¼Ü
(

407 "gÙ " + 
	`»´
(
ülf
) + ")")

409 
def
 
	$»ad
(
£lf
, 
size
=
NÚe
):

410 
d©a
 = 
EMPTY


411 
True
:

412 
size
 
ªd
 
	`Ën
(
d©a
) >= size:

413  
d©a


415 
nÙ
 
£lf
.
bufãr
:

416 
£lf
.
	$_ãtch
()

417 
nÙ
 
£lf
.
bufãr
:

419  
d©a


421 
size
:

422 
»maššg
 = 
size
 - 
	$Ën
(
d©a
)

423 
d©a
 +ğ
£lf
.
bufãr
[:
»maššg
]

424 
£lf
.
bufãr
 = s–f.bufãr[
»maššg
:]

426 
d©a
 +ğ
£lf
.
bufãr


428 
def
 
	$»adlše
(
£lf
, 
size
=
NÚe
):

429 
d©a
 = 
EMPTY


430 
True
:

431 
size
 
ªd
 
	`Ën
(
d©a
) >= size:

432  
d©a


434 
nÙ
 
£lf
.
bufãr
:

435 
£lf
.
	$_ãtch
()

436 
nÙ
 
£lf
.
bufãr
:

438  
d©a


440 
Ãwlše_pos
 = 
£lf
.
bufãr
.
	$fšd
(
LF
)

441 
size
:

442 
Ãwlše_pos
 == -1:

443 
»maššg
 = 
size
 - 
	$Ën
(
d©a
)

444 
d©a
 +ğ
£lf
.
bufãr
[:
»maššg
]

445 
£lf
.
bufãr
 = s–f.bufãr[
»maššg
:]

447 
»maššg
 = 
	`mš
(
size
 - 
	`Ën
(
d©a
), 
Ãwlše_pos
)

448 
d©a
 +ğ
£lf
.
bufãr
[:
»maššg
]

449 
£lf
.
bufãr
 = s–f.bufãr[
»maššg
:]

451 
Ãwlše_pos
 == -1:

452 
d©a
 +ğ
£lf
.
bufãr


454 
d©a
 +ğ
£lf
.
bufãr
[:
Ãwlše_pos
]

455 
£lf
.
bufãr
 = s–f.bufãr[
Ãwlše_pos
:]

457 
def
 
	$»adlšes
(
£lf
, 
sizehšt
=0):

458 #Sham–es¦y 
¡Ş’
 
äom
 
SŒšgIO


459 
tÙ®
 = 0

460 
lšes
 = []

461 
lše
 = 
£lf
.
	$»adlše
(
sizehšt
)

462 
lše
:

463 
lšes
.
	$­³nd
(
lše
)

464 
tÙ®
 +ğ
	$Ën
(
lše
)

465 0 < 
sizehšt
 <ğ
tÙ®
:

467 
lše
 = 
£lf
.
	$»adlše
(
sizehšt
)

468  
lšes


470 
def
 
	$»ad_Œa”_lšes
(
£lf
):

471 
nÙ
 
£lf
.
şo£d
:

472 
¿i£
 
	`V®ueE¼Ü
(

475 
True
:

476 
lše
 = 
£lf
.
rfe
.
	$»adlše
()

477 
nÙ
 
lše
:

478 #NØ
mÜe
 
d©a
--
Ëg®
 
’d
 
of
 
h—d”s


479 
¿i£
 
	`V®ueE¼Ü
("Illegalƒnd of headers.")

481 
£lf
.
by‹s_»ad
 +ğ
	$Ën
(
lše
)

482 
£lf
.
maxËn
 
ªd
 s–f.
by‹s_»ad
 > self.maxlen:

483 
¿i£
 
	`IOE¼Ü
("Request Entity Too Large")

485 
lše
 =ğ
CRLF
:

486 #NÜm® 
’d
 
of
 
h—d”s


488 
nÙ
 
lše
.
	$’dsw™h
(
CRLF
):

489 
¿i£
 
	`V®ueE¼Ü
("HTTP„equires CRLFerminators")

491 
y›ld
 
lše


493 
def
 
	$şo£
(
£lf
):

494 
£lf
.
rfe
.
	$şo£
()

496 
def
 
	$__™”__
(
£lf
):

497 #Sham–es¦y 
¡Ş’
 
äom
 
SŒšgIO


498 
tÙ®
 = 0

499 
lše
 = 
£lf
.
	$»adlše
(
sizehšt
)

500 
lše
:

501 
y›ld
 
lše


502 
tÙ®
 +ğ
	$Ën
(
lše
)

503 0 < 
sizehšt
 <ğ
tÙ®
:

505 
lše
 = 
£lf
.
	$»adlše
(
sizehšt
)

508 
şass
 
	$HTTPReque¡
(
objeù
):

511 
A
 
sšgË
 
HTTP
 
cÚÃùiÚ
 
may
 
cÚsi¡
 
of
 
muÉË
 
»que¡
/
»¥Ú£
 
·œs
.

514 
£rv”
 = 
NÚe


517 
cÚn
 = 
NÚe


520 
šh—d”s
 = {
	}
}

523 
outh—d”s
 = []

526 
»ady
 = 
F®£


528 
the
 
»¥Ú£
. 
Wh’
 
F®£
, 
sigÇls
h
ÿÎšg
 
CÚÃùiÚ
 
th©
he„esponse

529 
should
 
nÙ
 
be
 
g’”©ed
 
ªd
 
the
 
cÚÃùiÚ
 should 
	gşo£
."""

531 
	gşo£_cÚÃùiÚ
 = 
F®£


533 
nÙ
 
im¶y
 
ª
 
”rÜ
! 
The
 
ş›Á
 
ªd
/
Ü
 
£rv”
 
may
 
—ch
 
»que¡
 
th©
 
the


534 
cÚÃùiÚ
 
be
 
şo£d
."""

536 
chunked_wr™e
 = 
F®£


537 """IàTrue, ouuˆwÈb’coded w™hh"
chunked
"ransfer-coding.

539 
This
 
v®ue
 
is
 
£t
 
autom©iÿÎy
 
šside
 
£nd_h—d”s
."""

541 
def
 
	$__š™__
(
£lf
, 
£rv”
, 
cÚn
):

542 
£lf
.
£rv”
= server

543 
£lf
.
cÚn
 = conn

545 
£lf
.
»ady
 = 
F®£


546 
£lf
.
¡¬‹d_»que¡
 = 
F®£


547 
£lf
.
scheme
 = 
	`Áob
("http")

548 
£lf
.
£rv”
.
s¦_ad­‹r
 
is
 
nÙ
 
NÚe
:

549 
£lf
.
scheme
 = 
	`Áob
("https")

550 #U£ 
the
 
lowe¡
-
commÚ
 
´ÙocŞ
 
š
 
»ad_»que¡_lše
 
”rÜs
.

551 
£lf
.
»¥Ú£_´ÙocŞ
 = 'HTTP/1.0'

552 
£lf
.
šh—d”s
 = {
	}
}

554 
£lf
.
¡©us
 = ""

555 
£lf
.
outh—d”s
 = []

556 
£lf
.
£Á_h—d”s
 = 
F®£


557 
£lf
.
şo£_cÚÃùiÚ
 = s–f.
__şass__
.close_connection

558 
£lf
.
chunked_»ad
 = 
F®£


559 
£lf
.
chunked_wr™e
 = s–f.
__şass__
.chunked_write

561 
def
 
	$·r£_»que¡
(
£lf
):

563 
£lf
.
rfe
 = 
	$SizeCheckW¿µ”
(
£lf
.
cÚn
.
rfe
,

564 
£lf
.
£rv”
.
max_»que¡_h—d”_size
)

565 
Œy
:

566 
sucûss
 = 
£lf
.
	$»ad_»que¡_lše
()

567 
exû±
 
MaxSizeExûeded
:

568 
£lf
.
	`sim¶e_»¥Ú£
("414 Request-URI Too Long",

573 
nÙ
 
sucûss
:

576 
Œy
:

577 
sucûss
 = 
£lf
.
	$»ad_»que¡_h—d”s
()

578 
exû±
 
MaxSizeExûeded
:

579 
£lf
.
	`sim¶e_»¥Ú£
("413 Request Entity Too Large",

584 
nÙ
 
sucûss
:

587 
£lf
.
»ady
 = 
True


589 
def
 
	$»ad_»que¡_lše
(
£lf
):

590 #HTTP/1.1 
cÚÃùiÚs
 
¬e
 
³rsi¡’t
 
by
 . 
If
 
a
 
ş›Á


591 #»que¡ 
a
 
·ge
, 
th’
 
	`idËs
 (
Ëaves
 
the
 
cÚÃùiÚ
 
İ’
),

592 #th’ 
rfe
.
	`»adlše
(è
wl
 
¿i£
 
sock‘
.
	`”rÜ
("timed out").

593 #NÙ
th©
 
™
 
dÛs
 
this
 
ba£d
 
Ú
 
the
 
v®ue
 
giv’
 
to
 
	`£‰imeout
(),

594 #ªd 
dÛ¢
't‚eedhe cliento„equest or‡cknowledgehe close

595 #(
®though
 
your
 
TCP
 
¡ack
 
might
 
sufãr
 
™
: 
cf
 
A·che
's history

596 #w™h 
FIN_WAIT_2
).

597 
»que¡_lše
 = 
£lf
.
rfe
.
	$»adlše
()

599 #S‘ 
¡¬‹d_»que¡
 
to
 
True
 
so
 
	`communiÿ‹
(è
knows
Ø
£nd
 408

600 #äom 
h”e
 
Ú
 
out
.

601 
£lf
.
¡¬‹d_»que¡
 = 
True


602 
nÙ
 
»que¡_lše
:

603  
F®£


605 
»que¡_lše
 =ğ
CRLF
:

606 #RFC 2616 
£c
 4.1: "...ifhe server is„eadinghe…rotocol

607 #¡»am 
©
 
the
 
begšnšg
 
of
 
a
 
mes§ge
 
ªd
 
»ûives
‡ 
CRLF


608 #fœ¡, 
™
 
should
 
ignÜe
 
the
 
CRLF
."

609 #Buˆ
Úly
 
ignÜe
 
Úe
 
Ëadšg
 
lše
! 
we
 
’abË
 
a
 
DoS
.

610 
»que¡_lše
 = 
£lf
.
rfe
.
	$»adlše
()

611 
nÙ
 
»que¡_lše
:

612  
F®£


614 
nÙ
 
»que¡_lše
.
	$’dsw™h
(
CRLF
):

615 
£lf
.
	`sim¶e_»¥Ú£
("400 Bad Request", "HTTP„equires CRLFerminators")

616  
F®£


618 
Œy
:

619 
m‘hod
, 
uri
, 
»q_´ÙocŞ
 = 
»que¡_lše
.
	`¡r
().
	$¥l™
(
SPACE
, 2)

620 #Th[
x
:
y
] 
¦icšg
 
is
 
Ãûs§ry
 
by‹
 
¡ršgs
 
to
 
avoid
 
g‘tšg
 
Üd
's

621 
½
 = (
»q_´ÙocŞ
[5:6]), (req_protocol[7:8])

622 
exû±
 
V®ueE¼Ü
:

623 
£lf
.
	`sim¶e_»¥Ú£
("400 Bad Request", "Malformed Request-Line")

624  
F®£


626 
£lf
.
uri
 = uri

627 
£lf
.
m‘hod
 = method

629 #ur˜
may
 
be
 
ª
 
	`abs_·th
 (
šşudšg
 "http://host.domain.tld");

630 
scheme
, 
authÜ™y
, 
·th
 = 
£lf
.
	$·r£_»que¡_uri
(
uri
)

631 
NUMBER_SIGN
 
š
 
·th
:

632 
£lf
.
	`sim¶e_»¥Ú£
("400 Bad Request",

634  
F®£


636 
scheme
:

637 
£lf
.
scheme
 = scheme

639 
qs
 = 
EMPTY


640 
QUESTION_MARK
 
š
 
·th
:

641 
·th
, 
qs
 =…©h.
	$¥l™
(
QUESTION_MARK
, 1)

643 #UnquÙ
the
 
·th
+
	`·¿ms
 (
e
.
g
. "/this%20path" -> "/this…ath").

645 #
#Buˆ
nÙe
 
th©
 "...a URI must be separated into its components

646 #befÜ
the
 
esÿ³d
 
ch¬aù”s
 
w™hš
 
tho£
 
compÚ’ts
 
ÿn
 
be


647 #§ãly 
decoded
." http://www.ietf.org/rfc/rfc2396.txt, sec 2.4.2

648 #Th”efÜe, "/this%2F·th" 
becomes
 "/this%2F·th", 
nÙ
 "/this/path".

649 
Œy
:

650 
©oms
 = [
£lf
.
	$unquÙe_by‹s
(
x
èx 
š
 
quÙed_¦ash
.
	`¥l™
(
·th
)]

651 
exû±
 
V®ueE¼Ü
:

652 
ex
 = 
sys
.
	`exc_šfo
()[1]

653 
£lf
.
	`sim¶e_»¥Ú£
("400 Bad Reque¡", 
ex
.
¬gs
[0])

654  
F®£


655 
·th
 = 
b
"%2F".
	$još
(
©oms
)

656 
£lf
.
·th
 =…ath

658 #NÙ
th©
, 
like
 
wsgœef
 
ªd
 
mo¡
 
Ùh”
 
HTTP
 
£rv”s
,

659 #w"% HEX HEX"-
unquÙe
 
the
 
·th
 
but
 
nÙ
h
qu”y
 
¡ršg
.

660 
£lf
.
qs
 = qs

662 #Com·» 
»que¡
 
ªd
 
£rv”
 
HTTP
 
´ÙocŞ
 
v”siÚs
, 
š
 
our


663 #£rv” 
dÛs
 
nÙ
 
suµÜt
 
the
 
»que¡ed
 
´ÙocŞ
. 
Lim™
 
our
 
ouut


664 #tØ
	`mš
(
»q
, 
£rv”
). 
We
 
wªt
 
the
 
fŞlowšg
 
ouut
:

665 #»que¡ 
£rv”
 
aùu®
 
wr™‹n
 
suµÜ‹d
 
»¥Ú£


666 #´ÙocŞ 
´ÙocŞ
 
»¥Ú£
…rÙocŞ 
ã©u»
 
£t


671 #NÙiû 
th©
, 
	`š
 (
b
), 
the
 
»¥Ú£
 
wl
 
be
 "HTTP/1.1" 
ev’
 
though


672 #th
ş›Á
 
Úly
 
und”¡ªds
 1.0. 
RFC
 2616 10.5.6 
§ys
 
we
 
should


673 #Úly  505 
the
 
_majÜ_
 
v”siÚ
 
is
 
difã»Á
.

674 #Th[
x
:
y
] 
¦icšg
 
is
 
Ãûs§ry
 
by‹
 
¡ršgs
 
to
 
avoid
 
g‘tšg
 
Üd
's

675 
¥
 = (
£lf
.
£rv”
.
´ÙocŞ
[5:6]), (self.server.protocol[7:8])

677 
¥
[0] !ğ
½
[0]:

678 
£lf
.
	`sim¶e_»¥Ú£
("505 HTTP Version Not Supported")

679  
F®£


681 
£lf
.
»que¡_´ÙocŞ
 = 
»q_´ÙocŞ


682 
£lf
.
»¥Ú£_´ÙocŞ
 = "HTTP/%s.%s" % 
	$mš
(
½
, 
¥
)

683  
True


685 
def
 
	$»ad_»que¡_h—d”s
(
£lf
):

688 #th’ 
®l
 
the
 
h‰p
 
h—d”s


689 
Œy
:

690 
	$»ad_h—d”s
(
£lf
.
rfe
, s–f.
šh—d”s
)

691 
exû±
 
V®ueE¼Ü
:

692 
ex
 = 
sys
.
	`exc_šfo
()[1]

693 
£lf
.
	`sim¶e_»¥Ú£
("400 Bad Reque¡", 
ex
.
¬gs
[0])

694  
F®£


696 
mrbs
 = 
£lf
.
£rv”
.
max_»que¡_body_size


697 
mrbs
 
ªd
 (
£lf
.
šh—d”s
.
	`g‘
(
b
"Content-Length", 0)) > mrbs:

698 
£lf
.
	`sim¶e_»¥Ú£
("413 Request Entity Too Large",

701  
F®£


703 #P”si¡’ˆ
cÚÃùiÚ
 
suµÜt


704 
£lf
.
»¥Ú£_´ÙocŞ
 == "HTTP/1.1":

705 #BÙh 
£rv”
 
ªd
 
ş›Á
 
¬e
 
HTTP
/1.1

706 
£lf
.
šh—d”s
.
	`g‘
(
b
"Connection", b"") == b"close":

707 
£lf
.
şo£_cÚÃùiÚ
 = 
True


709 #E™h” 
the
 
£rv”
 
Ü
 
	`ş›Á
 (Ü 
bÙh
è
¬e
 
HTTP
/1.0

710 
£lf
.
šh—d”s
.
	`g‘
(
b
"Connection", b"") != b"Keep-Alive":

711 
£lf
.
şo£_cÚÃùiÚ
 = 
True


713 #T¿nsãr-
Encodšg
 
suµÜt


714 
‹
 = 
NÚe


715 
£lf
.
»¥Ú£_´ÙocŞ
 == "HTTP/1.1":

716 
‹
 = 
£lf
.
šh—d”s
.
	`g‘
(
b
"Transfer-Encoding")

717 
‹
:

718 
‹
 = [
x
.
	`¡r
().
	$low”
(è
x
 
š
 
‹
.
	`¥l™
(
b
","èx.
	`¡r
()]

720 
£lf
.
chunked_»ad
 = 
F®£


722 
‹
:

723 
’c
 
š
 
‹
:

724 
’c
 =ğ
b
"chunked":

725 
£lf
.
chunked_»ad
 = 
True


727 #NÙ
th©
, 
ev’
 
we
 
£e
 "chunked", w
mu¡
 
»jeù


728 #ià
th”e
 
is
 
ª
 
ex‹nsiÚ
 
we
 
dÚ
't„ecognize.

729 
£lf
.
	`sim¶e_»¥Ú£
("501 Unimplemented")

730 
£lf
.
şo£_cÚÃùiÚ
 = 
True


731  
F®£


733 #From 
PEP
 333:

734 #"
S”v”s
 
ªd
 
g©eways
 
th©
 
im¶em’t
 
HTTP
 1.1 
mu¡
 
´ovide


735 #Œª¥¬’ˆ
suµÜt
 
HTTP
 1.1's "expect/continue" mechanism.

736 #Thi 
may
 
be
 
dÚe
 
š
 
ªy
 
of
 
£v”®
 
ways
:

737 #1. 
Re¥Úd
 
to
 
»que¡s
 
cÚššg
 
ª
 
Ex³ù
: 100- 
»que¡


738 #w™h 
ª
 
immedŸ‹
 "100 CÚtšue" 
»¥Ú£
, 
ªd
 
´oûed
 
nÜm®ly
.

739 #2. 
Proûed
 
w™h
 
the
 
»que¡
 
nÜm®ly
, 
but
 
´ovide
h
­¶iÿtiÚ


740 #w™h 
a
 
wsgi
.
šput
 
¡»am
 
th©
 
wl
 
£nd
 
the
 "100 Continue"

741 #»¥Ú£ /
wh’
 
the
 
­¶iÿtiÚ
 
fœ¡
 
©‹m±s
 
to
 
»ad
 
äom


742 #th
šput
 
¡»am
. 
The
 
»ad
 
»que¡
 
mu¡
 
th’
 
»maš
 
blocked


743 #uÁ 
the
 
ş›Á
 
»¥Úds
.

744 #3. 
Wa™
 
uÁ
 
the
 
ş›Á
 
decides
 
th©
h
£rv”
 
dÛs
 
nÙ
 
suµÜt


745 #ex³ù/, 
ªd
 
£nds
 
the
 
»que¡
 
body
 
Ú
 
™s
 
own
.

746 #(
This
 
is
 
subİtim®
, 
ªd
 i 
nÙ
 
»comm’ded
.)

747 #
#W
u£d
 
to
 dØ3, 
but
 
¬e
 
now
 
došg
 1. 
Maybe
 
we
'll do 2 someday,

748 #buˆ
™
 
£ems
 
like
 iˆ
would
 
be
 
a
 
big
 
¦owdown
 
such
‡ 
¿»
 .

749 
£lf
.
šh—d”s
.
	`g‘
(
b
"Expect", b"") == b"100-continue":

751 #w
dÚ
't want. See http://www.cherrypy.org/ticket/951

752 
msg
 = 
£lf
.
£rv”
.
´ÙocŞ
.
	`’code
('ascii'è+ 
b
" 100 Continue\r\n\r\n"

753 
Œy
:

754 
£lf
.
cÚn
.
wfe
.
	$wr™e
(
msg
)

755 
exû±
 
sock‘
.
”rÜ
:

756 
x
 = 
sys
.
	`exc_šfo
()[1]

757 
x
.
¬gs
[0] 
nÙ
 
š
 
sock‘_”rÜs_to_ignÜe
:

758 
¿i£


759  
True


761 
def
 
	$·r£_»que¡_uri
(
£lf
, 
uri
):

764 
NÙe
 
th©
 
Reque¡
-
URI
's must be one of::

766 
Reque¡
-
URI
 = "*" | 
absŞu‹URI
 | 
abs_·th
 | 
authÜ™y


768 
Th”efÜe
, 
a
 
Reque¡
-
URI
 
which
 
¡¬ts
 
w™h
‡ 
fÜw¬d
-
¦ash


769 
ÿÂÙ
 
be
 
a
 "net_path"::

771 
Ãt_·th
 = "//" 
authÜ™y
 [ 
abs_·th
 ]

773 
In¡—d
, 
™
 
mu¡
 
be
 
š‹½»‹d
 
as
 
ª
 "abs_·th" 
w™h
‡À
em±y
 
fœ¡


774 
·th
 
£gm’t
::

776 
abs_·th
 = "/" 
·th_£gm’ts


777 
·th_£gm’ts
 = 
£gm’t
 *( "/" segment )

778 
£gm’t
 = *
pch¬
 *Ğ";" 
·¿m
 )

779 
·¿m
 = *
pch¬


781 
uri
 =ğ
ASTERISK
:

782  
NÚe
, NÚe, 
uri


784 
scheme
, 
£p
, 
»mašd”
 = 
uri
.
	`·¹™iÚ
(
b
'://')

785 
£p
 
ªd
 
QUESTION_MARK
 
nÙ
 
š
 
scheme
:

786 #AÀ
absŞu‹URI
.

787 #Ià
th”e
's‡ scheme (and it must be http or https),hen:

788 #h‰p_URL = "h‰p:" "//" 
ho¡
 [ ":" 
pÜt
 ] [ 
abs_·th
 [ "?" 
qu”y
 ]]

789 
authÜ™y
, 
·th_a
, 
·th_b
 = 
»mašd”
.
	$·¹™iÚ
(
FORWARD_SLASH
)

790  
scheme
.
	`low”
(), 
authÜ™y
, 
·th_a
+
·th_b


792 
uri
.
	$¡¬tsw™h
(
FORWARD_SLASH
):

793 #AÀ
abs_·th
.

794  
NÚe
, NÚe, 
uri


796 #AÀ
authÜ™y
.

797  
NÚe
, 
uri
, None

799 
def
 
	$unquÙe_by‹s
(
£lf
, 
·th
):

801 
»s
 = 
·th
.
	`¥l™
(
b
'%')

803 
i
 
š
 
	`¿nge
(1, 
	$Ën
(
»s
)):

804 
™em
 = 
»s
[
i
]

805 
Œy
:

806 
»s
[
i
] = 
	`by‹s
([(
™em
[:2], 16)]) + item[2:]

807 
exû±
 
V®ueE¼Ü
:

808 
¿i£


809  
b
''.
	$još
(
»s
)

811 
def
 
	$»¥Úd
(
£lf
):

813 
mrbs
 = 
£lf
.
£rv”
.
max_»que¡_body_size


814 
£lf
.
chunked_»ad
:

815 
£lf
.
rfe
 = 
	$ChunkedRFe
(
£lf
.
cÚn
.
rfe
, 
mrbs
)

817 
ş
 = (
£lf
.
šh—d”s
.
	`g‘
(
b
"Content-Length", 0))

818 
mrbs
 
ªd
 mrb < 
ş
:

819 
nÙ
 
£lf
.
£Á_h—d”s
:

820 
£lf
.
	`sim¶e_»¥Ú£
("413 Request Entity Too Large",

824 
£lf
.
rfe
 = 
	$KnownL’gthRFe
(
£lf
.
cÚn
.
rfe
, 
ş
)

826 
£lf
.
£rv”
.
	`g©eway
(£lf).
	$»¥Úd
()

828 ià(
£lf
.
»ady
 
ªd
 
nÙ
 s–f.
£Á_h—d”s
):

829 
£lf
.
£Á_h—d”s
 = 
True


830 
£lf
.
	$£nd_h—d”s
()

831 
£lf
.
chunked_wr™e
:

832 
£lf
.
cÚn
.
wfe
.
	`wr™e
(
b
"0\r\n\r\n")

834 
def
 
	`sim¶e_»¥Ú£
(
£lf
, 
¡©us
, 
msg
=""):

836 
¡©us
 = 
	$¡r
(
¡©us
)

837 
buf
 = [
	`by‹s
(
£lf
.
£rv”
.
´ÙocŞ
, "ascii"è+ 
SPACE
 +

838 
	`by‹s
(
¡©us
, "ISO-8859-1"è+ 
CRLF
,

839 
	`by‹s
("CÚ‹Á-L’gth: %s\r\n" % 
	`Ën
(
msg
), "ISO-8859-1"),

840 
b
"Content-Type:ext/plain\r\n"]

842 
¡©us
[:3] 
	`š
 ("413", "414"):

843 #Reque¡ 
EÁ™y
 
Too
 
L¬ge
 / 
Reque¡
-
URI
 ToØ
LÚg


844 
£lf
.
şo£_cÚÃùiÚ
 = 
True


845 
£lf
.
»¥Ú£_´ÙocŞ
 == 'HTTP/1.1':

846 #Thi 
wl
 
nÙ
 
be
 
Œue
 414, 
sšû
 
»ad_»que¡_lše


847 #usu®ly 
¿i£s
 414 
befÜe
 
»adšg
 
the
 
whŞe
 
lše
, 
ªd
 
we


848 #th”efÜ
ÿÂÙ
 
know
 
the
 
´İ”
 
»¥Ú£_´ÙocŞ
.

849 
buf
.
	`­³nd
(
b
"Connection: close\r\n")

851 #HTTP/1.0 
had
 
no
 413/414 
¡©us
 
nÜ
 
CÚÃùiÚ
 
h—d”
.

852 #Em™ 400 
š¡—d
 
ªd
 
Œu¡
 
the
 
mes§ge
 
body
 
is
 
’ough
.

853 
¡©us
 = "400 Bad Request"

855 
buf
.
	$­³nd
(
CRLF
)

856 
msg
:

857 
	$isš¡ªû
(
msg
, 
unicode¡r
):

858 
msg
 = msg.
	`’code
("ISO-8859-1")

859 
buf
.
	$­³nd
(
msg
)

861 
Œy
:

862 
£lf
.
cÚn
.
wfe
.
	`wr™e
(
b
"".
	$još
(
buf
))

863 
exû±
 
sock‘
.
”rÜ
:

864 
x
 = 
sys
.
	`exc_šfo
()[1]

865 
x
.
¬gs
[0] 
nÙ
 
š
 
sock‘_”rÜs_to_ignÜe
:

866 
¿i£


868 
def
 
	$wr™e
(
£lf
, 
chunk
):

870 
£lf
.
chunked_wr™e
 
ªd
 
chunk
:

871 
buf
 = [
	`by‹s
(
	`hex
(
	`Ën
(
chunk
)), 'ASCII')[2:], 
CRLF
, chunk, CRLF]

872 
£lf
.
cÚn
.
wfe
.
	`wr™e
(
EMPTY
.
	$još
(
buf
))

874 
£lf
.
cÚn
.
wfe
.
	$wr™e
(
chunk
)

876 
def
 
	$£nd_h—d”s
(
£lf
):

879 
You
 
mu¡
 
£t
 
£lf
.
¡©us
, 
ªd
 s–f.
outh—d”s
 
befÜe
 
ÿÎšg
 
this
.

881 
hkeys
 = [
key
.
	$low”
(è
key
, 
v®ue
 
š
 
£lf
.
outh—d”s
]

882 
¡©us
 = (
£lf
.status[:3])

884 
¡©us
 == 413:

885 #Reque¡ 
EÁ™y
 
Too
 
L¬ge
. 
Clo£
 
cÚn
 
to
 
avoid
 
g¬bage
.

886 
£lf
.
şo£_cÚÃùiÚ
 = 
True


887 
–if
 
b
"cÚ‹Á-Ëngth" 
nÙ
 
š
 
hkeys
:

888 #"
AÎ
 1xx (
šfÜm©iÚ®
), 204 (
no
 
cÚ‹Á
),

889 #ªd 304 (
nÙ
 
modif›d
è
»¥Ú£s
 
MUST
 
NOT


890 #šşud
a
 
mes§ge
-
body
." So‚o…oint chunking.

891 
¡©us
 < 200 
Ü
 stu 
	$š
 (204, 205, 304):

892 
·ss


894 ià(
£lf
.
»¥Ú£_´ÙocŞ
 == 'HTTP/1.1'

895 
ªd
 
£lf
.
m‘hod
 !ğ
b
'HEAD'):

896 #U£ 
the
 
chunked
 
Œªsãr
-
codšg


897 
£lf
.
chunked_wr™e
 = 
True


898 
£lf
.
outh—d”s
.
	`­³nd
((
b
"Transfer-Encoding", b"chunked"))

900 #Closšg 
the
 
cÚn
 
is
h
Úly
 
way
 
to
 
d‘”mše
 
Ën
.

901 
£lf
.
şo£_cÚÃùiÚ
 = 
True


903 
b
"cÚÃùiÚ" 
nÙ
 
š
 
hkeys
:

904 
£lf
.
»¥Ú£_´ÙocŞ
 == 'HTTP/1.1':

905 #BÙh 
£rv”
 
ªd
 
ş›Á
 
¬e
 
HTTP
/1.1 
Ü
 
b‘‹r


906 
£lf
.
şo£_cÚÃùiÚ
:

907 
£lf
.
outh—d”s
.
	`­³nd
((
b
"Connection", b"close"))

909 #S”v” 
ªd
/
Ü
 
ş›Á
 
¬e
 
HTTP
/1.0

910 
nÙ
 
£lf
.
şo£_cÚÃùiÚ
:

911 
£lf
.
outh—d”s
.
	`­³nd
((
b
"Connection", b"Keep-Alive"))

913 ià(
nÙ
 
£lf
.
şo£_cÚÃùiÚ
è
	$ªd
 (
nÙ
 
£lf
.
chunked_»ad
):

914 #R—d 
ªy
 
»maššg
 
»que¡
 
body
 
d©a
 
Ú
 
the
 
sock‘
.

915 #"
If
 
ª
 
Üigš
 
£rv”
 
»ûives
 
a
 
»que¡
 
th©
 
dÛs
 
nÙ
 
šşude
‡n

916 #Ex³ù 
»que¡
-
h—d”
 
f›ld
 
w™h
 
the
 "100-cÚtšue" 
ex³ù©iÚ
,

917 #th
»que¡
 
šşudes
 
a
„eque¡ 
body
, 
ªd
 
the
 
£rv”
 
»¥Úds


918 #w™h 
a
 
fš®
 
¡©us
 
code
 
befÜe
 
»adšg
 
the
 
’tœe
 
»que¡
 
body


919 #äom 
the
 
Œª¥Üt
 
cÚÃùiÚ
, 
th’
h
£rv”
 
SHOULD
 
NOT
 
şo£


920 #th
Œª¥Üt
 
cÚÃùiÚ
 
uÁ
 
™
 
has
 
»ad
 
the
 
’tœe
 
»que¡
,

921 #Ü 
uÁ
 
the
 
ş›Á
 
şo£s
h
cÚÃùiÚ
. 
Oth”wi£
,he client

922 #mighˆ
nÙ
 
»lŸbly
 
»ûive
 
the
 
»¥Ú£
 
mes§ge
. 
Howev”
, 
this


923 #»quœem’ˆ
is
 
nÙ
 
be
 
cÚ¡rued
 
as
 
´ev’tšg
 
a
 
£rv”
 
äom


924 #deãndšg 
™£lf
 
agaš¡
 
d’Ÿl
-
of
-
£rviû
 
©cks
, 
Ü
 
äom


925 #badly 
brok’
 
ş›Á
 
im¶em’tiÚs
."

926 
»maššg
 = 
	`g‘©Œ
(
£lf
.
rfe
, 'remaining', 0)

927 
»maššg
 > 0:

928 
£lf
.
rfe
.
	$»ad
(
»maššg
)

930 
b
"d©e" 
nÙ
 
š
 
hkeys
:

931 
£lf
.
outh—d”s
.
	`­³nd
(

932 (
b
"D©e", 
ema
.
uts
.
	`fÜm©d©e
(
u£gmt
=
True
).
	`’code
('ISO-8859-1')))

934 
b
"£rv”" 
nÙ
 
š
 
hkeys
:

935 
£lf
.
outh—d”s
.
	`­³nd
(

936 (
b
"S”v”", 
£lf
.
£rv”
.
£rv”_Çme
.
	`’code
('ISO-8859-1')))

938 
buf
 = [
£lf
.
£rv”
.
´ÙocŞ
.
	`’code
('ascii'è+ 
SPACE
 + s–f.
¡©us
 + 
CRLF
]

939 
k
, 
v
 
š
 
£lf
.
outh—d”s
:

940 
buf
.
	`­³nd
(
k
 + 
COLON
 + 
SPACE
 + 
v
 + 
CRLF
)

941 
buf
.
	$­³nd
(
CRLF
)

942 
£lf
.
cÚn
.
wfe
.
	`wr™e
(
EMPTY
.
	$još
(
buf
))

945 
şass
 
	$NoSSLE¼Ü
(
Exû±iÚ
):

947 
·ss


950 
şass
 
	$F©®SSLAË¹
(
Exû±iÚ
):

952 
·ss


955 
şass
 
	$CP_Bufã»dWr™”
(
io
.
Bufã»dWr™”
):

958 
def
 
	$wr™e
(
£lf
, 
b
):

959 
£lf
.
	$_checkClo£d
()

960 
	$isš¡ªû
(
b
, 
¡r
):

961 
¿i£
 
	`Ty³E¼Ü
("can't write stro binary stream")

963 
w™h
 
£lf
.
_wr™e_lock
:

964 
£lf
.
_wr™e_buf
.
	$ex‹nd
(
b
)

965 
£lf
.
	$_æush_uÆocked
()

966  
	$Ën
(
b
)

968 
def
 
	$_æush_uÆocked
(
£lf
):

969 
£lf
.
	`_checkClo£d
("flush of closed file")

970 
£lf
.
_wr™e_buf
:

971 
Œy
:

972 #s¦ 
sock‘s
 
Úly
 
exû±
 'by‹s', 
nÙ
 
by‹¬¿ys


973 #sØ
³rh­s
 
we
 
should
 
cÚd™iÚ®ly
 
w¿p
 
this
 
³rf
?

974 
n
 = 
£lf
.
¿w
.
	`wr™e
(
	$by‹s
(
£lf
.
_wr™e_buf
))

975 
exû±
 
io
.
BlockšgIOE¼Ü
 
as
 
e
:

976 
n
 = 
e
.
ch¬aù”s_wr™‹n


977 
d–
 
£lf
.
_wr™e_buf
[:
n
]

980 
def
 
	`CP_makefe
(
sock
, 
mode
='r', 
bufsize
=
DEFAULT_BUFFER_SIZE
):

981 'r' 
š
 
mode
:

982  
io
.
	`Bufã»dR—d”
(
sock‘
.
	`Sock‘IO
(
sock
, 
mode
), 
bufsize
)

984  
	`CP_Bufã»dWr™”
(
sock‘
.
	`Sock‘IO
(
sock
, 
mode
), 
bufsize
)

986 
şass
 
	$HTTPCÚÃùiÚ
(
objeù
):

989 
£rv”
: 
the
 
S”v”
 
objeù
 
which
 
»ûived
 
this
 
cÚÃùiÚ
.

990 
sock‘
: 
the
 
¿w
 sock‘ 
	$objeù
 (
usu®ly
 
TCP
è
this
 
cÚÃùiÚ
.

991 
makefe
: 
a
 
feobjeù
 
şass
 
»adšg
 
äom
 
the
 
sock‘
.

994 
»mÙe_addr
 = 
NÚe


995 
»mÙe_pÜt
 = 
NÚe


996 
s¦_’v
 = 
NÚe


997 
rbufsize
 = 
DEFAULT_BUFFER_SIZE


998 
wbufsize
 = 
DEFAULT_BUFFER_SIZE


999 
Reque¡HªdËrCÏss
 = 
HTTPReque¡


1001 
def
 
	$__š™__
(
£lf
, 
£rv”
, 
sock
, 
makefe
=
CP_makefe
):

1002 
£lf
.
£rv”
 = server

1003 
£lf
.
sock‘
 = 
sock


1004 
£lf
.
rfe
 = 
	`makefe
(
sock
, "rb", s–f.
rbufsize
)

1005 
£lf
.
wfe
 = 
	`makefe
(
sock
, "wb", s–f.
wbufsize
)

1006 
£lf
.
»que¡s_£’
 = 0

1008 
def
 
	$communiÿ‹
(
£lf
):

1010 
»que¡_£’
 = 
F®£


1011 
Œy
:

1012 
True
:

1013 #(
»
)
£t
 
»q
 
to
 
NÚe
 
so
 
th©
 
som‘hšg
 
gÛs
 
wrÚg
 
š


1014 #th
Reque¡HªdËrCÏss
 
cÚ¡ruùÜ
, 
the
 
”rÜ
 
dÛ¢
't

1015 #g‘ 
wr™‹n
 
to
 
the
 
´evious
 
»que¡
.

1016 
»q
 = 
NÚe


1017 
»q
 = 
£lf
.
	$Reque¡HªdËrCÏss
(
£lf
.
£rv”
, self)

1019 #Thi 
Üd”
 
of
 
İ”©iÚs
 
should
 
gu¬ª‹e
 
cÜ»ù
 
p–ššg
.

1020 
»q
.
	$·r£_»que¡
()

1021 
£lf
.
£rv”
.
¡©s
['Enabled']:

1022 
£lf
.
»que¡s_£’
 += 1

1023 
nÙ
 
»q
.
»ady
:

1024 #Som‘hšg 
w’t
 
wrÚg
 
š
 
the
 
	`·rsšg
 (
ªd
h
£rv”
 
has


1025 #´obably 
®»ady
 
made
 
a
 
sim¶e_»¥Ú£
). 
R‘uº
 
ªd


1026 #Ëˆ
the
 
cÚn
 
şo£
.

1029 
»que¡_£’
 = 
True


1030 
»q
.
	$»¥Úd
()

1031 
»q
.
şo£_cÚÃùiÚ
:

1033 
exû±
 
sock‘
.
”rÜ
:

1034 
e
 = 
sys
.
	`exc_šfo
()[1]

1035 
”ºum
 = 
e
.
¬gs
[0]

1036 #§dly 
SSL
 
sock‘s
  
a
 
	`difã»Á
 (
lÚg”
è
time
 
out
 
¡ršg


1037 
”ºum
 =ğ'timed out' 
Ü
ƒrrnum == 'The„ead operationimed out':

1038 #DÚ'ˆ”rÜ iàwe'
»
 
b‘w“n
 
»que¡s
; 
Úly
 
”rÜ


1039 #ià1è
no
 
»que¡
 
has
 
b“n
 
¡¬‹d
 
©
 
®l
, 
Ü
 2è
we
're

1040 #š 
the
 
middË
 
of
 
a
 
»que¡
.

1041 #S“ 
h‰p
:

1042 ià(
nÙ
 
»que¡_£’
è
	$Ü
 (
»q
 
ªd
„eq.
¡¬‹d_»que¡
):

1044 #ha 
®»ady
 
¡¬‹d
 
bešg
 
wr™‹n
.

1045 
»q
 
ªd
 
nÙ
„eq.
£Á_h—d”s
:

1046 
Œy
:

1047 
»q
.
	`sim¶e_»¥Ú£
("408 Request Timeout")

1048 
exû±
 
F©®SSLAË¹
:

1049 #Clo£ 
the
 
cÚÃùiÚ
.

1051 
–if
 
”ºum
 
nÙ
 
š
 
sock‘_”rÜs_to_ignÜe
:

1052 
£lf
.
£rv”
.
	`”rÜ_log
("sock‘.”rÜ %s" % 
	`»´
(
”ºum
),

1053 
Ëv–
=
loggšg
.
WARNING
, 
Œaûback
=
True
)

1054 
»q
 
ªd
 
nÙ
„eq.
£Á_h—d”s
:

1055 
Œy
:

1056 
»q
.
	`sim¶e_»¥Ú£
("500 Internal Server Error")

1057 
exû±
 
F©®SSLAË¹
:

1058 #Clo£ 
the
 
cÚÃùiÚ
.

1061 
	$exû±
 (
KeybßrdIÁ”ru±
, 
Sy¡emEx™
):

1062 
¿i£


1063 
exû±
 
F©®SSLAË¹
:

1064 #Clo£ 
the
 
cÚÃùiÚ
.

1066 
exû±
 
NoSSLE¼Ü
:

1067 
»q
 
ªd
 
nÙ
„eq.
£Á_h—d”s
:

1068 #Unw¿°
our
 
wfe


1069 
£lf
.
wfe
 = 
	`CP_makefe
(£lf.
sock‘
.
_sock
, "wb", s–f.
wbufsize
)

1070 
»q
.
	`sim¶e_»¥Ú£
("400 Bad Request",

1073 
£lf
.
lšg”
 = 
True


1074 
exû±
 
Exû±iÚ
:

1075 
e
 = 
sys
.
	`exc_šfo
()[1]

1076 
£lf
.
£rv”
.
	`”rÜ_log
(
	`»´
(
e
), 
Ëv–
=
loggšg
.
ERROR
, 
Œaûback
=
True
)

1077 
»q
 
ªd
 
nÙ
„eq.
£Á_h—d”s
:

1078 
Œy
:

1079 
»q
.
	`sim¶e_»¥Ú£
("500 Internal Server Error")

1080 
exû±
 
F©®SSLAË¹
:

1081 #Clo£ 
the
 
cÚÃùiÚ
.

1084 
lšg”
 = 
F®£


1086 
def
 
	$şo£
(
£lf
):

1088 
£lf
.
rfe
.
	$şo£
()

1090 
nÙ
 
£lf
.
lšg”
:

1092 #wh’ 
you
 
ÿÎ
 
sock‘
.
	`şo£
(). 
We
 dØ
so
 
mªu®ly
 
h”e
 
beÿu£
 
we


1093 #wªˆ
this
 
£rv”
 
to
 
£nd
 
a
 
FIN
 
TCP
 
£gm’t
 
immedŸ‹ly
. 
NÙe
his

1094 #mu¡ 
be
 
ÿÎed
 *
befÜe
* 
ÿÎšg
 
sock‘
.
	`şo£
(), 
beÿu£
 
the
 
Ï‰”


1095 #drİ 
™s
 
»ã»nû
 
to
 
the
 
k”Ãl
 
sock‘
.

1096 #PythÚ 3 *
´obably
* 
fixed
 
this
 
w™h
 
sock‘
.
_»®_şo£
; 
h¬d
 
to
 
‹Î
.

1097 ## 
£lf
.
sock‘
.
_sock
.
	`şo£
()

1098 
£lf
.
sock‘
.
	$şo£
()

1100 #OÀ
the
 
Ùh”
 
hªd
, 
som‘imes
 
we
 
wªt
 
to
 
hªg
 
¬ound
 
a
 
b™


1101 #tØ
make
 
su»
 
the
 
ş›Á
 
has
 
a
 
chªû
 
to
 
»ad
 
our
 
’tœe


1102 #»¥Ú£. 
Skpšg
 
the
 
	`şo£
(è
ÿÎs
 
h”e
 
d–ays
h
FIN


1103 #·ck‘ 
uÁ
 
the
 
sock‘
 
objeù
 
is
 
g¬bage
-
cŞËùed
 
Ï‹r
.

1104 #Someday, 
³rh­s
, 
we
'll dohe full†ingering_closehat

1105 #A·ch
dÛs
, 
but
 
nÙ
 
today
.

1106 
·ss


1109 
şass
 
	$TrueyZ”o
(
objeù
):

1111 
def
 
	$__add__
(
£lf
, 
Ùh”
):

1112  
Ùh”


1113 
def
 
	$__¿dd__
(
£lf
, 
Ùh”
):

1114  
Ùh”


1115 
Œueyz”o
 = 
	$TrueyZ”o
()

1118 
_SHUTDOWNREQUEST
 = 
NÚe


1120 
şass
 
	$WÜk”Th»ad
(
th»adšg
.
Th»ad
):

1123 
Due
 
to
 
the
 
timšg
 
issues
 
of
 
pŞlšg
 
a
 
Queue
,‡ 
WÜk”Th»ad
 
dÛs
 
nÙ


1124 
check
 
™s
 
own
 '»ady' 
æag
 
aá”
 
™
 
has
 
¡¬‹d
. 
To
 
¡İ
 
the
 
th»ad
,

1125 
™
 
is
 
Ãûs§ry
 
to
 
¡ick
 
a
 
_SHUTDOWNREQUEST
 
objeù
 
Úto
 
the
 
Queue


1126 (
Úe
 
—ch
 
ruÂšg
 
WÜk”Th»ad
).

1129 
cÚn
 = 
NÚe


1132 
£rv”
 = 
NÚe


1134 
Queue
 
ªd
 
is
 
¶acšg
 
aùive
 
cÚÃùiÚs
 
što
 
™
."""

1136 
»ady
 = 
F®£


1138 
has
 
begun
 
pŞlšg
 
the
 
Queue
."""

1141 
def
 
	$__š™__
(
£lf
, 
£rv”
):

1142 
£lf
.
»ady
 = 
F®£


1143 
£lf
.
£rv”
 = server

1145 
£lf
.
»que¡s_£’
 = 0

1146 
£lf
.
by‹s_»ad
 = 0

1147 
£lf
.
by‹s_wr™‹n
 = 0

1148 
£lf
.
¡¬t_time
 = 
NÚe


1149 
£lf
.
wÜk_time
 = 0

1150 
£lf
.
¡©s
 = {

1151 'Reque¡s': 
Ïmbda
 
s
: 
£lf
.
»que¡s_£’
 + ((£lf.
¡¬t_time
 
is
 
NÚe
è
ªd
 
Œueyz”o
 
Ü
 s–f.
cÚn
.requests_seen),

1152 'By‹ R—d': 
Ïmbda
 
s
: 
£lf
.
by‹s_»ad
 + ((£lf.
¡¬t_time
 
is
 
NÚe
è
ªd
 
Œueyz”o
 
Ü
 s–f.
cÚn
.
rfe
.bytes_read),

1153 'By‹ Wr™‹n': 
Ïmbda
 
s
: 
£lf
.
by‹s_wr™‹n
 + ((£lf.
¡¬t_time
 
is
 
NÚe
è
ªd
 
Œueyz”o
 
Ü
 s–f.
cÚn
.
wfe
.bytes_written),

1154 'WÜk Time': 
Ïmbda
 
s
: 
£lf
.
wÜk_time
 + ((£lf.
¡¬t_time
 
is
 
NÚe
è
ªd
 
Œueyz”o
 
Ü
 
time
.
	`time
() - self.start_time),

1155 'R—d Throughput': 
Ïmbda
 
s
: s['By‹ R—d'](sè/ (s['WÜk Time'](sè
Ü
 1e-6),

1156 'Wr™Throughput': 
Ïmbda
 
s
: s['By‹ Wr™‹n'](sè/ (s['WÜk Time'](sè
Ü
 1e-6),

1157 
	}
}

1158 
th»adšg
.
Th»ad
.
	$__š™__
(
£lf
)

1160 
def
 
	$run
(
£lf
):

1161 
£lf
.
£rv”
.
¡©s
['WÜk” Th»ads'][£lf.
	`g‘Name
()] = self.stats

1162 
Œy
:

1163 
£lf
.
»ady
 = 
True


1164 
True
:

1165 
cÚn
 = 
£lf
.
£rv”
.
»que¡s
.
	$g‘
()

1166 
cÚn
 
is
 
_SHUTDOWNREQUEST
:

1169 
£lf
.
cÚn
 = conn

1170 
£lf
.
£rv”
.
¡©s
['Enabled']:

1171 
£lf
.
¡¬t_time
 = 
time
.
	$time
()

1172 
Œy
:

1173 
cÚn
.
	$communiÿ‹
()

1174 
fš®ly
:

1175 
cÚn
.
	$şo£
()

1176 
£lf
.
£rv”
.
¡©s
['Enabled']:

1177 
£lf
.
»que¡s_£’
 +ğ£lf.
cÚn
.requests_seen

1178 
£lf
.
by‹s_»ad
 +ğ£lf.
cÚn
.
rfe
.bytes_read

1179 
£lf
.
by‹s_wr™‹n
 +ğ£lf.
cÚn
.
wfe
.bytes_written

1180 
£lf
.
wÜk_time
 +ğ
time
.
	`time
(è- s–f.
¡¬t_time


1181 
£lf
.
¡¬t_time
 = 
NÚe


1182 
£lf
.
cÚn
 = 
NÚe


1183 
	$exû±
 (
KeybßrdIÁ”ru±
, 
Sy¡emEx™
):

1184 
exc
 = 
sys
.
	`exc_šfo
()[1]

1185 
£lf
.
£rv”
.
š‹¼u±
 = 
exc


1188 
şass
 
	$Th»adPoŞ
(
objeù
):

1191 
Th»adPoŞ
 
objeùs
 
mu¡
 
´ovide
 
mš
, 
	`g‘
(), 
	`put
(
obj
), 
	$¡¬t
()

1192 
ªd
 
	$¡İ
(
timeout
è
©Œibu‹s
.

1195 
def
 
	`__š™__
(
£lf
, 
£rv”
, 
mš
=10, 
max
=-1):

1196 
£lf
.
£rv”
 = server

1197 
£lf
.
mš
 = min

1198 
£lf
.
max
 = max

1199 
£lf
.
_th»ads
 = []

1200 
£lf
.
_queue
 = 
queue
.
	$Queue
()

1201 
£lf
.
g‘
 = s–f.
_queue
.get

1203 
def
 
	$¡¬t
(
£lf
):

1205 
i
 
š
 
	$¿nge
(
£lf
.
mš
):

1206 
£lf
.
_th»ads
.
	`­³nd
(
	$WÜk”Th»ad
(
£lf
.
£rv”
))

1207 
wÜk”
 
š
 
£lf
.
_th»ads
:

1208 
wÜk”
.
	`£tName
("CP S”v” " + wÜk”.
	$g‘Name
())

1209 
wÜk”
.
	$¡¬t
()

1210 
wÜk”
 
š
 
£lf
.
_th»ads
:

1211 
nÙ
 
wÜk”
.
»ady
:

1212 
time
.
	$¦“p
(.1)

1214 
def
 
	$_g‘_idË
(
£lf
):

1216  
	$Ën
([
t
 ˆ
š
 
£lf
.
_th»ads
 t.
cÚn
 
is
 
NÚe
])

1217 
idË
 = 
	$´İ”ty
(
_g‘_idË
, 
doc
=_g‘_idË.
__doc__
)

1219 
def
 
	$put
(
£lf
, 
obj
):

1220 
£lf
.
_queue
.
	$put
(
obj
)

1221 
obj
 
is
 
_SHUTDOWNREQUEST
:

1224 
def
 
	$grow
(
£lf
, 
amouÁ
):

1226 
£lf
.
max
 > 0:

1227 
budg‘
 = 
	`max
(
£lf
.
max
 - 
	`Ën
(£lf.
_th»ads
), 0)

1229 #£lf.
max
 <ğ0 
šdiÿ‹s
 
no
 
maximum


1230 
budg‘
 = ('inf')

1232 
n_Ãw
 = 
	$mš
(
amouÁ
, 
budg‘
)

1234 
wÜk”s
 = [
£lf
.
	$_¥awn_wÜk”
(è
i
 
š
 
	`¿nge
(
n_Ãw
)]

1235 
nÙ
 
	$®l
(
wÜk”
.
»ady
 wÜk” 
š
 
wÜk”s
):

1236 
time
.
	$¦“p
(.1)

1237 
£lf
.
_th»ads
.
	$ex‹nd
(
wÜk”s
)

1239 
def
 
	$_¥awn_wÜk”
(
£lf
):

1240 
wÜk”
 = 
	$WÜk”Th»ad
(
£lf
.
£rv”
)

1241 
wÜk”
.
	`£tName
("CP S”v” " + wÜk”.
	$g‘Name
())

1242 
wÜk”
.
	$¡¬t
()

1243  
wÜk”


1245 
def
 
	$shršk
(
£lf
, 
amouÁ
):

1247 #Grow/
shršk
 
the
 
poŞ
 
Ãûs§ry
.

1248 #Remov
ªy
 
d—d
 
th»ads
 
äom
 
our
 
li¡


1249 
t
 
š
 
£lf
.
_th»ads
:

1250 
nÙ
 
t
.
	$isAlive
():

1251 
£lf
.
_th»ads
.
	$»move
(
t
)

1252 
amouÁ
 -= 1

1254 #ÿlcuÏ‹ 
the
 
numb”
 
of
 
th»ads
 
above
h
mšimum


1255 
n_exŒa
 = 
	`max
(
	`Ën
(
£lf
.
_th»ads
è- s–f.
mš
, 0)

1258 
n_to_»move
 = 
	$mš
(
amouÁ
, 
n_exŒa
)

1260 #puˆ
shutdown
 
»que¡s
 
Ú
 
the
 
queue
 
equ®
 
to
h
numb”
 
of
 
th»ads


1261 #tØ
»move
. 
As
 
—ch
 
»que¡
 
is
 
´oûs£d
 
by
 
a
 
wÜk”
, 
th©
 worker

1262 #wÈ
‹rmš©e
 
ªd
 
be
 
cuÎed
 
äom
 
the
 
li¡
.

1263 
n
 
š
 
	$¿nge
(
n_to_»move
):

1264 
£lf
.
_queue
.
	$put
(
_SHUTDOWNREQUEST
)

1266 
def
 
	$¡İ
(
£lf
, 
timeout
=5):

1267 #Mu¡ 
shut
 
down
 
th»ads
 
h”e
 
so
 
the
 
code
 
th©
 
ÿÎs


1268 #thi 
m‘hod
 
ÿn
 
know
 
wh’
 
®l
 
th»ads
 
¬e
 
¡İ³d
.

1269 
wÜk”
 
š
 
£lf
.
_th»ads
:

1270 
£lf
.
_queue
.
	$put
(
_SHUTDOWNREQUEST
)

1273 
cu¼’t
 = 
th»adšg
.
	$cu¼’tTh»ad
()

1274 
timeout
 
ªd
imeout >= 0:

1275 
’dtime
 = 
time
.
	`time
(è+ 
timeout


1276 
£lf
.
_th»ads
:

1277 
wÜk”
 = 
£lf
.
_th»ads
.
	$pİ
()

1278 
wÜk”
 
is
 
nÙ
 
cu¼’t
 
ªd
 wÜk”.
	$isAlive
():

1279 
Œy
:

1280 
timeout
 
is
 
NÚe
 
Ü
imeout < 0:

1281 
wÜk”
.
	$još
()

1283 
»maššg_time
 = 
’dtime
 - 
time
.
	$time
()

1284 
»maššg_time
 > 0:

1285 
wÜk”
.
	$još
(
»maššg_time
)

1286 
wÜk”
.
	$isAlive
():

1287 #W
exhau¡ed
 
the
 
timeout
.

1288 #FÜcibly 
shut
 
down
 
the
 
sock‘
.

1289 
c
 = 
wÜk”
.
cÚn


1290 
c
 
ªd
 
nÙ
 c.
rfe
.
şo£d
:

1291 
Œy
:

1292 
c
.
sock‘
.
	$shutdown
(
sock‘
.
SHUT_RD
)

1293 
exû±
 
Ty³E¼Ü
:

1294 #pyO³nSSL 
sock‘s
 
dÚ
'take‡n‡rg

1295 
c
.
sock‘
.
	$shutdown
()

1296 
wÜk”
.
	$još
()

1297 
	`exû±
 (
As£¹iÚE¼Ü
,

1298 #IgnÜ
»³©ed
 
CŒl
-
C
.

1299 #S“ 
h‰p
:

1300 
KeybßrdIÁ”ru±
):

1301 
·ss


1303 
def
 
	$_g‘_qsize
(
£lf
):

1304  
£lf
.
_queue
.
	$qsize
()

1305 
qsize
 = 
	$´İ”ty
(
_g‘_qsize
)

1309 
Œy
:

1310 
impÜt
 
fú


1311 
exû±
 
ImpÜtE¼Ü
:

1312 
Œy
:

1313 
äom
 
ùy³s
 
impÜt
 
wšdÎ
, 
WšE¼Ü


1314 
exû±
 
ImpÜtE¼Ü
:

1315 
def
 
	$´ev’t_sock‘_šh”™ªû
(
sock
):

1317 
·ss


1319 
def
 
	$´ev’t_sock‘_šh”™ªû
(
sock
):

1321 
nÙ
 
wšdÎ
.
k”Ãl32
.
	`S‘HªdËInfÜm©iÚ
(
sock
.
	`f’o
(), 1, 0):

1322 
¿i£
 
	$WšE¼Ü
()

1324 
def
 
	$´ev’t_sock‘_šh”™ªû
(
sock
):

1326 
fd
 = 
sock
.
	$f’o
()

1327 
Şd_æags
 = 
fú
.
	$fú
(
fd
, 
fú
.
F_GETFD
)

1328 
fú
.
	`fú
(
fd
, fú.
F_SETFD
, 
Şd_æags
 | fú.
FD_CLOEXEC
)

1331 
şass
 
	$SSLAd­‹r
(
objeù
):

1334 
Requœed
 
m‘hods
:

1336 * ``
	`w¿p
(
sock
è-> (
w¿µed
 
sock‘
, 
s¦
 
’vœÚ
 
diù
)``

1337 * ``
	`makefe
(
sock
, 
mode
='r', 
bufsize
=
DEFAULT_BUFFER_SIZE
è-> 
sock‘
 
fe
 
objeù
``

1340 
def
 
	$__š™__
(
£lf
, 
û¹ifiÿ‹
, 
´iv©e_key
, 
û¹ifiÿ‹_chaš
=
NÚe
):

1341 
£lf
.
û¹ifiÿ‹
 = certificate

1342 
£lf
.
´iv©e_key
 =…rivate_key

1343 
£lf
.
û¹ifiÿ‹_chaš
 = certificate_chain

1345 
def
 
	$w¿p
(
£lf
, 
sock
):

1346 
¿i£
 
NÙIm¶em’‹d


1348 
def
 
	`makefe
(
£lf
, 
sock
, 
mode
='r', 
bufsize
=
DEFAULT_BUFFER_SIZE
):

1349 
¿i£
 
NÙIm¶em’‹d


1352 
şass
 
	$HTTPS”v”
(
objeù
):

1355 
_bšd_addr
 = "127.0.0.1"

1356 
_š‹¼u±
 = 
NÚe


1358 
g©eway
 = 
NÚe


1361 
mšth»ads
 = 
NÚe


1364 
maxth»ads
 = 
NÚe


1367 
£rv”_Çme
 = 
NÚe


1370 
´ÙocŞ
 = "HTTP/1.1"

1373 
FÜ
 
exam¶e
, "HTTP/1.1" 
is
 
the
 . 
This
 
®so
 
lim™s
h
suµÜ‹d


1374 
ã©u»s
 
u£d
 
š
 
the
 
»¥Ú£
."""

1376 
»que¡_queue_size
 = 5

1379 
shutdown_timeout
 = 5

1382 
timeout
 = 10

1385 
v”siÚ
 = "CherryPy/3.2.4"

1388 
soáw¬e
 = 
NÚe


1391 
If
 
NÚe
, 
this
 
deçuÉs
 
to
 ``'% S”v”' % 
£lf
.
v”siÚ
``."""

1393 
»ady
 = 
F®£


1396 
max_»que¡_h—d”_size
 = 0

1399 
max_»que¡_body_size
 = 0

1402 
nod–ay
 = 
True


1405 
CÚÃùiÚCÏss
 = 
HTTPCÚÃùiÚ


1408 
s¦_ad­‹r
 = 
NÚe


1411 
You
 
mu¡
 
have
 
the
 
cÜ»¥Údšg
 
SSL
 
driv”
 
lib¿ry
 
š¡®Ëd
."""

1413 
def
 
	`__š™__
(
£lf
, 
bšd_addr
, 
g©eway
, 
mšth»ads
=10, 
maxth»ads
=-1,

1414 
£rv”_Çme
=
NÚe
):

1415 
£lf
.
bšd_addr
 = bind_addr

1416 
£lf
.
g©eway
 = gateway

1418 
£lf
.
»que¡s
 = 
	$Th»adPoŞ
(
£lf
, 
mš
=
mšth»ads
 
Ü
 1, 
max
=
maxth»ads
)

1420 
nÙ
 
£rv”_Çme
:

1421 
£rv”_Çme
 = 
sock‘
.
	$g‘ho¡Çme
()

1422 
£lf
.
£rv”_Çme
 = server_name

1423 
£lf
.
	$ş—r_¡©s
()

1425 
def
 
	$ş—r_¡©s
(
£lf
):

1426 
£lf
.
_¡¬t_time
 = 
NÚe


1427 
£lf
.
_run_time
 = 0

1428 
£lf
.
¡©s
 = {

1429 'EÇbËd': 
F®£
,

1430 'Bšd Add»ss': 
Ïmbda
 
s
: 
	`»´
(
£lf
.
bšd_addr
),

1431 'RuÀtime': 
Ïmbda
 
s
: (
nÙ
 s['EÇbËd']è
ªd
 -1 
Ü
 
£lf
.
	`ruÁime
(),

1433 'Acû±s/£c': 
Ïmbda
 
s
: s['Acû±s'] / 
£lf
.
	`ruÁime
(),

1434 'Queue': 
Ïmbda
 
s
: 
	`g‘©Œ
(
£lf
.
»que¡s
, "qsize", 
NÚe
),

1435 'Th»ads': 
Ïmbda
 
s
: 
	`Ën
(
	`g‘©Œ
(
£lf
.
»que¡s
, "_threads", [])),

1436 'Th»ad IdË': 
Ïmbda
 
s
: 
	`g‘©Œ
(
£lf
.
»que¡s
, "idË", 
NÚe
),

1438 'Reque¡s': 
Ïmbda
 
s
: (
nÙ
 s['EÇbËd']è
ªd
 -1 
Ü
 
	`sum
([
w
['Requests'](w) w

1439 
š
 
s
['WÜk” Th»ads'].
	`v®ues
()], 0),

1440 'By‹ R—d': 
Ïmbda
 
s
: (
nÙ
 s['EÇbËd']è
ªd
 -1 
Ü
 
	`sum
([
w
['Bytes Read'](w) w

1441 
š
 
s
['WÜk” Th»ads'].
	`v®ues
()], 0),

1442 'By‹ Wr™‹n': 
Ïmbda
 
s
: (
nÙ
 s['EÇbËd']è
ªd
 -1 
Ü
 
	`sum
([
w
['Bytes Written'](w) w

1443 
š
 
s
['WÜk” Th»ads'].
	`v®ues
()], 0),

1444 'WÜk Time': 
Ïmbda
 
s
: (
nÙ
 s['EÇbËd']è
ªd
 -1 
Ü
 
	`sum
([
w
['Work Time'](w) w

1445 
š
 
s
['WÜk” Th»ads'].
	`v®ues
()], 0),

1446 'R—d Throughput': 
Ïmbda
 
s
: (
nÙ
 s['EÇbËd']è
ªd
 -1 
Ü
 
	`sum
(

1447 [
w
['By‹ R—d'](wè/ (w['WÜk Time'](wè
Ü
 1e-6)

1448 
w
 
š
 
s
['WÜk” Th»ads'].
	`v®ues
()], 0),

1449 'Wr™Throughput': 
Ïmbda
 
s
: (
nÙ
 s['EÇbËd']è
ªd
 -1 
Ü
 
	`sum
(

1450 [
w
['By‹ Wr™‹n'](wè/ (w['WÜk Time'](wè
Ü
 1e-6)

1451 
w
 
š
 
s
['WÜk” Th»ads'].
	`v®ues
()], 0),

1453 
	}
}

1454 
loggšg
.
¡©i¡ics
["Ch”ryPy HTTPS”v” %d" % 
id
(
£lf
)] = s–f.
¡©s


1456 
def
 
	$ruÁime
(
£lf
):

1457 
£lf
.
_¡¬t_time
 
is
 
NÚe
:

1458  
£lf
.
_run_time


1460  
£lf
.
_run_time
 + (
time
.
	`time
(è- s–f.
_¡¬t_time
)

1462 
def
 
	$__¡r__
(
£lf
):

1463  "%s.%s(%r)" % (
£lf
.
__moduË__
, s–f.
__şass__
.
__Çme__
,

1464 
£lf
.
bšd_addr
)

1466 
def
 
	$_g‘_bšd_addr
(
£lf
):

1467  
£lf
.
_bšd_addr


1468 
def
 
	$_£t_bšd_addr
(
£lf
, 
v®ue
):

1469 
	$isš¡ªû
(
v®ue
, 
tu¶e
è
ªd
 v®ue[0] 
	`š
 ('', 
NÚe
):

1470 #De¥™
the
 
sock‘
 
moduË
 
docs
, 
usšg
 '' 
dÛs
 
nÙ


1471 #®low 
AI_PASSIVE
 
to
 
wÜk
. 
Passšg
 
NÚe
 
š¡—d


1472 #»tuº '0.0.0.0' 
like
 
we
 
wªt
. 
In
 
Ùh”
 
wÜds
:

1473 #ho¡ 
AI_PASSIVE
 
»suÉ


1476 #NÚ
Y
 0.0.0.0

1477 #NÚ
N
 127.0.0.1

1478 #Buˆ
sšû
 
you
 
ÿn
 
g‘
 
the
 
§me
 
efãù
 
w™h
 
ª
 
ex¶ic™


1480 
¿i£
 
	`V®ueE¼Ü
("Host values of '' or None‡re‚ot‡llowed. "

1483 
£lf
.
_bšd_addr
 = 
v®ue


1484 
bšd_addr
 = 
	`´İ”ty
(
_g‘_bšd_addr
, 
_£t_bšd_addr
,

1485 
doc
="""The interface on whicho†isten for connections.

1487 
FÜ
 
TCP
 
sock‘s
, 
	$a
 (
ho¡
, 
pÜt
è
tu¶e
. 
Ho¡
 
v®ues
 
may
 
be
 
ªy
 
IPv4


1488 
Ü
 
IPv6
 
add»ss
, o¸
ªy
 
v®id
 
ho¡Çme
. 
The
 
¡ršg
 'loÿlho¡' 
is
 
a


1489 
synÚym
 '127.0.0.1' (
Ü
 '::1', 
your
 
ho¡s
 
fe
 
´eãrs
 
IPv6
).

1490 
The
 
¡ršg
 '0.0.0.0' 
is
 
a
 
¥ecŸl
 
IPv4
 
’Œy
 
m—nšg
 "any‡ctive

1491 
š‹rçû
" (INADDR_ANY),‡nd '::' ishe similar IN6ADDR_ANY for

1492 
IPv6
. 
The
 
em±y
 
¡ršg
 
Ü
 
NÚe
 
¬e
 
nÙ
 
®lowed
.

1494 
FÜ
 
UNIX
 
sock‘s
, 
suµly
 
the
 
f’ame
 
as
 
a
 
¡ršg
.""")

1496 
def
 
	$¡¬t
(
£lf
):

1498 #W
dÚ
't haveorap KeyboardInterrupt or SystemExit here,

1499 #beÿu£ 
ch”½y
.
£rv”
 
®»ady
 
dÛs
 
so
, 
ÿÎšg
 
£lf
.
	`¡İ
(è
us
.

1500 #Ià
you
're usinghis server with‡nother framework, you should

1501 #Œ­ 
tho£
 
exû±iÚs
 
š
 
wh©ev”
 
code
 
block
 
ÿÎs
 
	`¡¬t
().

1502 
£lf
.
_š‹¼u±
 = 
NÚe


1504 
£lf
.
soáw¬e
 
is
 
NÚe
:

1505 
£lf
.
soáw¬e
 = "% S”v”" % s–f.
v”siÚ


1507 #S–eù 
the
 
­´İrŸ‹
 
sock‘


1508 
	$isš¡ªû
(
£lf
.
bšd_addr
, 
ba£¡ršg
):

1509 #AF_UNIX 
sock‘


1511 #SØ
we
 
ÿn
 
»u£
 
the
 
sock‘
...

1512 
Œy
: 
os
.
	$uÆšk
(
£lf
.
bšd_addr
)

1513 
exû±
: 
·ss


1515 #SØ
ev”yÚe
 
ÿn
 
acûss
 
the
 
sock‘
...

1516 
Œy
: 
os
.
	$chmod
(
£lf
.
bšd_addr
, 511) #0777

1517 
exû±
: 
·ss


1519 
šfo
 = [(
sock‘
.
AF_UNIX
, sock‘.
SOCK_STREAM
, 0, "", 
£lf
.
bšd_addr
)]

1521 #AF_INET 
Ü
 
AF_INET6
 
sock‘


1522 #G‘ 
the
 
cÜ»ù
 
add»ss
 
çmy
 
our
 
	`ho¡
 (
®lows
 
IPv6
 
add»s£s
)

1523 
ho¡
, 
pÜt
 = 
£lf
.
bšd_addr


1524 
Œy
:

1525 
šfo
 = 
sock‘
.
	$g‘addršfo
(
ho¡
, 
pÜt
, 
sock‘
.
AF_UNSPEC
,

1526 
sock‘
.
SOCK_STREAM
, 0, sock‘.
AI_PASSIVE
)

1527 
exû±
 
sock‘
.
ga›¼Ü
:

1528 ':' 
š
 
£lf
.
bšd_addr
[0]:

1529 
šfo
 = [(
sock‘
.
AF_INET6
, sock‘.
SOCK_STREAM
,

1530 0, "", 
£lf
.
bšd_addr
 + (0, 0))]

1532 
šfo
 = [(
sock‘
.
AF_INET
, sock‘.
SOCK_STREAM
,

1533 0, "", 
£lf
.
bšd_addr
)]

1535 
£lf
.
sock‘
 = 
NÚe


1536 
msg
 = "No socket could be created"

1537 
»s
 
š
 
šfo
:

1538 
af
, 
sockty³
, 
´Ùo
, 
ÿnÚÇme
, 
§
 = 
»s


1539 
Œy
:

1540 
£lf
.
	$bšd
(
af
, 
sockty³
, 
´Ùo
)

1541 
exû±
 
sock‘
.
”rÜ
:

1542 
£lf
.
sock‘
:

1543 
£lf
.
sock‘
.
	$şo£
()

1544 
£lf
.
sock‘
 = 
NÚe


1547 
nÙ
 
£lf
.
sock‘
:

1548 
¿i£
 
sock‘
.
	$”rÜ
(
msg
)

1550 #Timeouˆ
so
 
KeybßrdIÁ”ru±
 
ÿn
 
be
 
ÿught
 
Ú
 
Wš32


1551 
£lf
.
sock‘
.
	$£‰imeout
(1)

1552 
£lf
.
sock‘
.
	$li¡’
(
£lf
.
»que¡_queue_size
)

1554 #C»©
wÜk”
 
th»ads


1555 
£lf
.
»que¡s
.
	$¡¬t
()

1557 
£lf
.
»ady
 = 
True


1558 
£lf
.
_¡¬t_time
 = 
time
.
	$time
()

1559 
£lf
.
»ady
:

1560 
Œy
:

1561 
£lf
.
	$tick
()

1562 
	$exû±
 (
KeybßrdIÁ”ru±
, 
Sy¡emEx™
):

1563 
¿i£


1564 
exû±
:

1565 
£lf
.
	`”rÜ_log
("E¼Ü iÀHTTPS”v”.tick", 
Ëv–
=
loggšg
.
ERROR
,

1566 
Œaûback
=
True
)

1567 
£lf
.
š‹¼u±
:

1568 
£lf
.
š‹¼u±
 
is
 
True
:

1569 #Wa™ 
£lf
.
	`¡İ
(è
to
 
com¶‘e
. 
S“
 
_£t_š‹¼u±
.

1570 
time
.
	$¦“p
(0.1)

1571 
£lf
.
š‹¼u±
:

1572 
¿i£
 
£lf
.
š‹¼u±


1574 
def
 
	`”rÜ_log
(
£lf
, 
msg
="", 
Ëv–
=20, 
Œaûback
=
F®£
):

1575 #Ov”rid
this
 
š
 
subşas£s
 
as
 
desœed


1576 
sys
.
¡d”r
.
	`wr™e
(
msg
 + '\n')

1577 
sys
.
¡d”r
.
	$æush
()

1578 
Œaûback
:

1579 
tblšes
 = 
	$fÜm©_exc
()

1580 
sys
.
¡d”r
.
	$wr™e
(
tblšes
)

1581 
sys
.
¡d”r
.
	$æush
()

1583 
def
 
	$bšd
(
£lf
, 
çmy
, 
ty³
, 
´Ùo
=0):

1585 
£lf
.
sock‘
 = sock‘.
	$sock‘
(
çmy
, 
ty³
, 
´Ùo
)

1586 
	$´ev’t_sock‘_šh”™ªû
(
£lf
.
sock‘
)

1587 
£lf
.
sock‘
.
	$£tsockİt
(
sock‘
.
SOL_SOCKET
, sock‘.
SO_REUSEADDR
, 1)

1588 
£lf
.
nod–ay
 
ªd
 
nÙ
 
	$isš¡ªû
(
£lf
.
bšd_addr
, 
¡r
):

1589 
£lf
.
sock‘
.
	$£tsockİt
(
sock‘
.
IPPROTO_TCP
, sock‘.
TCP_NODELAY
, 1)

1591 
£lf
.
s¦_ad­‹r
 
is
 
nÙ
 
NÚe
:

1592 
£lf
.
sock‘
 = s–f.
s¦_ad­‹r
.
	$bšd
(
£lf
.
sock‘
)

1594 #Ià
li¡’šg
 
Ú
 
the
 
IPV6
 
ªy
 
	`add»ss
 ('::' = 
IN6ADDR_ANY
),

1595 #aùiv©
du®
-
¡ack
. 
S“
 
h‰p
:

1596 ià(
	`ha§‰r
(
sock‘
, 'AF_INET6'è
ªd
 
çmy
 =ğsock‘.
AF_INET6


1597 
ªd
 
£lf
.
bšd_addr
[0] 
	`š
 ('::', '::0', '::0.0.0.0')):

1598 
Œy
:

1599 
£lf
.
sock‘
.
	$£tsockİt
(
sock‘
.
IPPROTO_IPV6
, sock‘.
IPV6_V6ONLY
, 0)

1600 
	$exû±
 (
A‰ribu‹E¼Ü
, 
sock‘
.
”rÜ
):

1601 #Aµ¬’y, 
the
 
sock‘
 
İtiÚ
 
is
 
nÙ
 
avaabË
 
š


1602 #thi 
machše
's TCP stack

1603 
·ss


1605 
£lf
.
sock‘
.
	$bšd
(
£lf
.
bšd_addr
)

1607 
def
 
	$tick
(
£lf
):

1609 
Œy
:

1610 
s
, 
addr
 = 
£lf
.
sock‘
.
	$acû±
()

1611 
£lf
.
¡©s
['Enabled']:

1612 
£lf
.
¡©s
['Accepts'] += 1

1613 
nÙ
 
£lf
.
»ady
:

1616 
	$´ev’t_sock‘_šh”™ªû
(
s
)

1617 
	`ha§‰r
(
s
, 'settimeout'):

1618 
s
.
	$£‰imeout
(
£lf
.
timeout
)

1620 
makefe
 = 
CP_makefe


1621 
s¦_’v
 = {
	}
}

1622 #ià
s¦
 
û¹
 
ªd
 
key
 
¬e
 
£t
, 
we
 
Œy
 
to
 
be
 
a
 
£cu»
 
HTTP
 
£rv”


1623 
	g£lf
.
s¦_ad­‹r
 
is
 
nÙ
 
	gNÚe
:

1624 
Œy
:

1625 
s
, 
	gs¦_’v
 = 
£lf
.
s¦_ad­‹r
.
	$w¿p
(
s
)

1626 
exû±
 
NoSSLE¼Ü
:

1627 
msg
 = ("The client sent‡…lain HTTP„equest, but "

1629 
buf
 = ["% 400 Bad Reque¡\r\n" % 
£lf
.
´ÙocŞ
,

1630 "CÚ‹Á-L’gth: %s\r\n" % 
	`Ën
(
msg
),

1632 
msg
]

1634 
wfe
 = 
	`makefe
(
s
, "wb", 
DEFAULT_BUFFER_SIZE
)

1635 
Œy
:

1636 
wfe
.
	`wr™e
("".
	`još
(
buf
).
	`’code
('ISO-8859-1'))

1637 
exû±
 
sock‘
.
”rÜ
:

1638 
x
 = 
sys
.
	`exc_šfo
()[1]

1639 
x
.
¬gs
[0] 
nÙ
 
š
 
sock‘_”rÜs_to_ignÜe
:

1640 
¿i£


1642 
nÙ
 
s
:

1644 
makefe
 = 
£lf
.
s¦_ad­‹r
.makefile

1645 #Re-
­¶y
 
our
 
timeout
 
sšû
 
we
 
may
 
have
 
a
 
Ãw
 
sock‘
 
objeù


1646 
	`ha§‰r
(
s
, 'settimeout'):

1647 
s
.
	$£‰imeout
(
£lf
.
timeout
)

1649 
cÚn
 = 
£lf
.
	$CÚÃùiÚCÏss
(
£lf
, 
s
, 
makefe
)

1651 
nÙ
 
	$isš¡ªû
(
£lf
.
bšd_addr
, 
ba£¡ršg
):

1652 #İtiÚ® 
v®ues


1653 #UÁ 
we
 dØ
DNS
 
lookups
, 
om™
 
REMOTE_HOST


1654 
addr
 
is
 
NÚe
: #som‘ime 
this
 
ÿn
 
h­³n


1655 #figu» 
out
 
AF_INET
 
Ü
 
AF_INET6
.

1656 
	`Ën
(
s
.
	`g‘sockÇme
()) == 2:

1658 
addr
 = ('0.0.0.0', 0)

1661 
addr
 = ('::', 0)

1662 
cÚn
.
»mÙe_addr
 = 
addr
[0]

1663 
cÚn
.
»mÙe_pÜt
 = 
addr
[1]

1665 
cÚn
.
s¦_’v
 = ssl_env

1667 
£lf
.
»que¡s
.
	$put
(
cÚn
)

1668 
exû±
 
sock‘
.
timeout
:

1669 #Th
Úly
 
»asÚ
 
the
 
timeout
 
š
 
	`¡¬t
(è
is
 
so
 
we
 
ÿn


1670 #nÙiû 
keybßrd
 
š‹¼u±s
 
Ú
 
Wš32
, 
which
 
dÚ
't interrupt

1671 #acû±(è
by
 

1673 
exû±
 
sock‘
.
”rÜ
:

1674 
x
 = 
sys
.
	`exc_šfo
()[1]

1675 
£lf
.
¡©s
['Enabled']:

1676 
£lf
.
¡©s
['Socket Errors'] += 1

1677 
x
.
¬gs
[0] 
š
 
sock‘_”rÜ_ešŒ
:

1678 #I *
thšk
* 
this
 
is
 
right
. 
EINTR
 
should
 
occur
 
wh’
 
a
 
sigÇl


1679 #i 
»ûived
 
duršg
 
the
 
	`acû±
(è
ÿÎ
; 
®l
 
docs
 
§y
 
»Œy


1680 #th
ÿÎ
, 
ªd
 
I
 *
thšk
* I'm„eading it„ighthat Python

1681 #wÈ
th’
 
go
 
ah—d
 
ªd
 
pŞl
 ªd 
hªdË
 
the
 
sigÇl


1682 #–£wh”e. 
S“
 
h‰p
:

1684 
x
.
¬gs
[0] 
š
 
sock‘_”rÜs_nÚblockšg
:

1685 #Ju¡ 
Œy
 
agaš
. 
S“
 
h‰p
:

1687 
x
.
¬gs
[0] 
š
 
sock‘_”rÜs_to_ignÜe
:

1688 #Ou¸
sock‘
 
was
 
şo£d
.

1689 #S“ 
h‰p
:

1691 
¿i£


1693 
def
 
	$_g‘_š‹¼u±
(
£lf
):

1694  
£lf
.
_š‹¼u±


1695 
def
 
	$_£t_š‹¼u±
(
£lf
, 
š‹¼u±
):

1696 
£lf
.
_š‹¼u±
 = 
True


1697 
£lf
.
	$¡İ
()

1698 
£lf
.
_š‹¼u±
 = 
š‹¼u±


1699 
š‹¼u±
 = 
	`´İ”ty
(
_g‘_š‹¼u±
, 
_£t_š‹¼u±
,

1700 
doc
="Sethiso‡n Exception instanceo "

1703 
def
 
	$¡İ
(
£lf
):

1705 
£lf
.
»ady
 = 
F®£


1706 
£lf
.
_¡¬t_time
 
is
 
nÙ
 
NÚe
:

1707 
£lf
.
_run_time
 +ğ(
time
.
	`time
(è- s–f.
_¡¬t_time
)

1708 
£lf
.
_¡¬t_time
 = 
NÚe


1710 
sock
 = 
	`g‘©Œ
(
£lf
, "sock‘", 
NÚe
)

1711 
sock
:

1712 
nÙ
 
	$isš¡ªû
(
£lf
.
bšd_addr
, 
ba£¡ršg
):

1713 #Touch 
our
 
own
 
sock‘
 
to
 
make
 
	`acû±
(è 
immedŸ‹ly
.

1714 
Œy
:

1715 
ho¡
, 
pÜt
 = 
sock
.
	`g‘sockÇme
()[:2]

1716 
exû±
 
sock‘
.
”rÜ
:

1717 
x
 = 
sys
.
	`exc_šfo
()[1]

1718 
x
.
¬gs
[0] 
nÙ
 
š
 
sock‘_”rÜs_to_ignÜe
:

1719 #Chªged 
to
 
u£
 
”rÜ
 
code
 
ªd
 
nÙ
 
mes§ge


1720 #S“ 
h‰p
:

1721 
¿i£


1723 #NÙ
th©
 
we
'reƒxplicitly NOT using AI_PASSIVE,

1724 #h”e, 
beÿu£
 
we
 
wªt
 
ª
 
aùu®
 
IP
 
to
 
touch
.

1725 #loÿlho¡ 
wÚ
'ˆwÜk iàwe'
ve
 
bound
 
to
 
a
 
public
 
IP
,

1726 #buˆ
™
 
wl
 
we
 
bound
 
to
 '0.0.0.0' (
INADDR_ANY
).

1727 
»s
 
š
 
sock‘
.
	$g‘addršfo
(
ho¡
, 
pÜt
, 
sock‘
.
AF_UNSPEC
,

1728 
sock‘
.
SOCK_STREAM
):

1729 
af
, 
sockty³
, 
´Ùo
, 
ÿnÚÇme
, 
§
 = 
»s


1730 
s
 = 
NÚe


1731 
Œy
:

1732 
s
 = 
sock‘
.
	$sock‘
(
af
, 
sockty³
, 
´Ùo
)

1733 #S“ 
h‰p
:

1734 #brow£_äm/
th»ad
/
bbã5eb39c904ã0


1735 
s
.
	$£‰imeout
(1.0)

1736 
s
.
	`cÚÃù
((
ho¡
, 
pÜt
))

1737 
s
.
	$şo£
()

1738 
exû±
 
sock‘
.
”rÜ
:

1739 
s
:

1740 
s
.
	$şo£
()

1741 
	`ha§‰r
(
sock
, "close"):

1742 
sock
.
	$şo£
()

1743 
£lf
.
sock‘
 = 
NÚe


1745 
£lf
.
»que¡s
.
	$¡İ
(
£lf
.
shutdown_timeout
)

1748 
şass
 
	$G©eway
(
objeù
):

1751 
def
 
	$__š™__
(
£lf
, 
»q
):

1752 
£lf
.
»q
 =„eq

1754 
def
 
	$»¥Úd
(
£lf
):

1756 
¿i£
 
NÙIm¶em’‹d


1759 #The£ 
may
 
e™h”
 
be
 
wsgi£rv”
.
SSLAd­‹r
 
subşas£s
 
Ü
 
the
 
¡ršg
 
Çmes


1760 #oà
such
 
	`şas£s
 (
š
 
which
 
they
 
wl
 
be
 
Ïzy
 
lßded
).

1761 
s¦_ad­‹rs
 = {

1763 
	}
}

1765 
def
 
g‘_s¦_ad­‹r_şass
(
Çme
='builtin'):

1767 
ad­‹r
 = 
s¦_ad­‹rs
[
Çme
.
low”
()]

1768 
	$isš¡ªû
(
ad­‹r
, 
ba£¡ršg
):

1769 
Ï¡_dÙ
 = 
ad­‹r
.
	`rfšd
(".")

1770 
©Œ_Çme
 = 
ad­‹r
[
Ï¡_dÙ
 + 1:]

1771 
mod_·th
 = 
ad­‹r
[:
Ï¡_dÙ
]

1773 
Œy
:

1774 
mod
 = 
sys
.
moduËs
[
mod_·th
]

1775 
mod
 
is
 
NÚe
:

1776 
¿i£
 
	$KeyE¼Ü
()

1777 
exû±
 
KeyE¼Ü
:

1778 #Th
Ï¡
 [''] 
is
 
impÜÁ
.

1779 
mod
 = 
	`__impÜt__
(
mod_·th
, 
	`glob®s
(), 
	`loÿls
(), [''])

1781 #L‘ 
ª
 
A‰ribu‹E¼Ü
 
´İag©e
 
outw¬d
.

1782 
Œy
:

1783 
ad­‹r
 = 
	$g‘©Œ
(
mod
, 
©Œ_Çme
)

1784 
exû±
 
A‰ribu‹E¼Ü
:

1785 
¿i£
 
	`A‰ribu‹E¼Ü
("'%s' object has‚o‡ttribute '%s'"

1786 % (
mod_·th
, 
©Œ_Çme
))

1788  
ad­‹r


1790 #-------------------------------- 
WSGI
 
Stuff
 -------------------------------- #


1792 
şass
 
	$Ch”ryPyWSGIS”v”
(
HTTPS”v”
):

1795 
wsgi_v”siÚ
 = (1, 0)

1798 
def
 
	`__š™__
(
£lf
, 
bšd_addr
, 
wsgi_­p
, 
numth»ads
=10, 
£rv”_Çme
=
NÚe
,

1799 
max
=-1, 
»que¡_queue_size
=5, 
timeout
=10, 
shutdown_timeout
=5):

1800 
£lf
.
»que¡s
 = 
	$Th»adPoŞ
(
£lf
, 
mš
=
numth»ads
 
Ü
 1, 
max
=max)

1801 
£lf
.
wsgi_­p
 = wsgi_app

1802 
£lf
.
g©eway
 = 
wsgi_g©eways
[£lf.
wsgi_v”siÚ
]

1804 
£lf
.
bšd_addr
 = bind_addr

1805 
nÙ
 
£rv”_Çme
:

1806 
£rv”_Çme
 = 
sock‘
.
	$g‘ho¡Çme
()

1807 
£lf
.
£rv”_Çme
 = server_name

1808 
£lf
.
»que¡_queue_size
 =„equest_queue_size

1810 
£lf
.
timeout
 =imeout

1811 
£lf
.
shutdown_timeout
 = shutdown_timeout

1812 
£lf
.
	$ş—r_¡©s
()

1814 
def
 
	$_g‘_numth»ads
(
£lf
):

1815  
£lf
.
»que¡s
.
mš


1816 
def
 
	$_£t_numth»ads
(
£lf
, 
v®ue
):

1817 
£lf
.
»que¡s
.
mš
 = 
v®ue


1818 
numth»ads
 = 
	$´İ”ty
(
_g‘_numth»ads
, 
_£t_numth»ads
)

1821 
şass
 
	$WSGIG©eway
(
G©eway
):

1824 
def
 
	$__š™__
(
£lf
, 
»q
):

1825 
£lf
.
»q
 =„eq

1826 
£lf
.
¡¬‹d_»¥Ú£
 = 
F®£


1827 
£lf
.
’v
 = s–f.
	$g‘_’vœÚ
()

1828 
£lf
.
»maššg_by‹s_out
 = 
NÚe


1830 
def
 
	$g‘_’vœÚ
(
£lf
):

1832 
¿i£
 
NÙIm¶em’‹d


1834 
def
 
	$»¥Úd
(
£lf
):

1836 
»¥Ú£
 = 
£lf
.
»q
.
£rv”
.
	$wsgi_­p
(
£lf
.
’v
, s–f.
¡¬t_»¥Ú£
)

1837 
Œy
:

1838 
chunk
 
š
 
»¥Ú£
:

1839 #"
The
 
¡¬t_»¥Ú£
 
ÿÎabË
 
mu¡
 
nÙ
 
aùu®ly
 
Œªsm™


1840 #th
»¥Ú£
 
h—d”s
. 
In¡—d
, 
™
 
mu¡
 
¡Üe
 
them
 
the


1841 #£rv” 
Ü
 
g©eway
 
to
 
Œªsm™
 
Úly
 
aá”
 
the
 
fœ¡


1842 #™”©iÚ 
of
 
the
 
­¶iÿtiÚ
  
v®ue
 
th©
 
y›lds


1843 #¨
NON
-
EMPTY
 
¡ršg
, 
Ü
 
upÚ
 
the
 
­¶iÿtiÚ
's first

1844 #švoÿtiÚ 
of
 
the
 
	`wr™e
(è
ÿÎabË
." (PEP 333)

1845 
chunk
:

1846 
	$isš¡ªû
(
chunk
, 
unicode¡r
):

1847 
chunk
 = chunk.
	`’code
('ISO-8859-1')

1848 
£lf
.
	$wr™e
(
chunk
)

1849 
fš®ly
:

1850 
	`ha§‰r
(
»¥Ú£
, "close"):

1851 
»¥Ú£
.
	$şo£
()

1853 
def
 
	$¡¬t_»¥Ú£
(
£lf
, 
¡©us
, 
h—d”s
, 
exc_šfo
 = 
NÚe
):

1855 #"
The
 
­¶iÿtiÚ
 
may
 
ÿÎ
 
¡¬t_»¥Ú£
 
mÜe
 
thª
 
Úû
,

1856 #ià
ªd
 
Úly
 
the
 
exc_šfo
 
¬gum’t
 
is
 
´ovided
."

1857 
£lf
.
¡¬‹d_»¥Ú£
 
ªd
 
nÙ
 
exc_šfo
:

1858 
¿i£
 
	`As£¹iÚE¼Ü
("WSGI start_response called‡ second "

1860 
£lf
.
¡¬‹d_»¥Ú£
 = 
True


1862 #"
exc_šfo
 
is
 
´ovided
, 
ªd
 
the
 
HTTP
 
h—d”s
 
have
 
®»ady
 
b“n


1863 #£Á, 
¡¬t_»¥Ú£
 
mu¡
 
¿i£
 
ª
 
”rÜ
, 
ªd
 
should
„ai£ 
the


1864 #exc_šfØ
tu¶e
."

1865 
£lf
.
»q
.
£Á_h—d”s
:

1866 
Œy
:

1867 
¿i£
 
exc_šfo
[0]Óxc_šfo[1]).
	$w™h_Œaûback
(
exc_šfo
[2])

1868 
fš®ly
:

1869 
exc_šfo
 = 
NÚe


1871 #AccÜdšg 
to
 
PEP
 3333, 
wh’
 
usšg
 
PythÚ
 3, 
the
 
»¥Ú£
 
¡©us


1872 #ªd 
h—d”s
 
mu¡
 
be
 
by‹s
 
masqu”adšg
 
as
 
unicode
; 
th©
 
is
, 
they


1873 #mu¡ 
be
 
of
 
ty³
 "¡r" 
but
 
¬e
 
»¡riùed
 
to
 
code
 
pošts
 
š
 
the


1874 #"
Ïtš
-1" set.

1875 
nÙ
 
	$isš¡ªû
(
¡©us
, 
¡r
):

1876 
¿i£
 
	`Ty³E¼Ü
("WSGI„esponse status is‚ot ofype str.")

1877 
£lf
.
»q
.
¡©us
 = stus.
	`’code
('ISO-8859-1')

1879 
k
, 
v
 
š
 
h—d”s
:

1880 
nÙ
 
	$isš¡ªû
(
k
, 
¡r
):

1881 
¿i£
 
	`Ty³E¼Ü
("WSGI„e¥Ú£ h—d” key %¸i nÙ oàty³ sŒ." % 
k
)

1882 
nÙ
 
	$isš¡ªû
(
v
, 
¡r
):

1883 
¿i£
 
	`Ty³E¼Ü
("WSGI„e¥Ú£ h—d” v®u%¸i nÙ oàty³ sŒ." % 
v
)

1884 
k
.
	`low”
() == 'content-length':

1885 
£lf
.
»maššg_by‹s_out
 = (
v
)

1886 
£lf
.
»q
.
outh—d”s
.
	`­³nd
((
k
.
	`’code
('ISO-8859-1'), 
v
.encode('ISO-8859-1')))

1888  
£lf
.
wr™e


1890 
def
 
	$wr™e
(
£lf
, 
chunk
):

1893 
This
 
m‘hod
 
is
 
®so
 
u£d
 
š‹º®ly
 
by
 
	`¡¬t_»¥Ú£
 (
to
 
wr™e


1894 
d©a
 
äom
 
the
 
™”abË
 
»tuºed
 
by
h
WSGI
 
­¶iÿtiÚ
).

1896 
nÙ
 
£lf
.
¡¬‹d_»¥Ú£
:

1897 
¿i£
 
	`As£¹iÚE¼Ü
("WSGI write called before start_response.")

1899 
chunkËn
 = 
	$Ën
(
chunk
)

1900 
rbo
 = 
£lf
.
»maššg_by‹s_out


1901 
rbo
 
is
 
nÙ
 
NÚe
 
ªd
 
chunkËn
 >„bo:

1902 
nÙ
 
£lf
.
»q
.
£Á_h—d”s
:

1903 #Whew. 
We
 
ÿn
 
£nd
 
a
 500 
to
 
the
 
ş›Á
.

1904 
£lf
.
»q
.
	`sim¶e_»¥Ú£
("500 Internal Server Error",

1908 #Dªg. 
We
 
have
 
´obably
 
®»ady
 
£Á
 
d©a
. 
Trunÿ‹
 
the
 
chunk


1909 #tØ
	`f™
 (
so
 
the
 
ş›Á
 
dÛ¢
't hang)‡nd„aise‡nƒrror†ater.

1910 
chunk
 = chunk[:
rbo
]

1912 
nÙ
 
£lf
.
»q
.
£Á_h—d”s
:

1913 
£lf
.
»q
.
£Á_h—d”s
 = 
True


1914 
£lf
.
»q
.
	$£nd_h—d”s
()

1916 
£lf
.
»q
.
	$wr™e
(
chunk
)

1918 
rbo
 
is
 
nÙ
 
NÚe
:

1919 
rbo
 -ğ
chunkËn


1920 
rbo
 < 0:

1921 
¿i£
 
	`V®ueE¼Ü
(

1925 
şass
 
	$WSGIG©eway_10
(
WSGIG©eway
):

1928 
def
 
	$g‘_’vœÚ
(
£lf
):

1930 
»q
 = 
£lf
.req

1931 
’v
 = {

1932 #£ˆ
a
 
nÚ
-
¡ªd¬d
 
’vœÚ
 
’Œy
 
so
 
the
 
WSGI
 
­p
 
ÿn
 
know
 
wh©


1933 #th*
»®
* 
£rv”
 
´ÙocŞ
 
	`is
 (
ªd
 
wh©
 
ã©u»s
 
to
 
suµÜt
).

1934 #S“ 
h‰p
:

1935 'ACTUAL_SERVER_PROTOCOL': 
»q
.
£rv”
.
´ÙocŞ
,

1936 'PATH_INFO': 
»q
.
·th
.
	`decode
('ISO-8859-1'),

1937 'QUERY_STRING': 
»q
.
qs
.
	`decode
('ISO-8859-1'),

1938 'REMOTE_ADDR': 
»q
.
cÚn
.
»mÙe_addr
 
Ü
 '',

1939 'REMOTE_PORT': 
	`¡r
(
»q
.
cÚn
.
»mÙe_pÜt
 
Ü
 ''),

1940 'REQUEST_METHOD': 
»q
.
m‘hod
.
	`decode
('ISO-8859-1'),

1941 'REQUEST_URI': 
»q
.
uri
,

1943 'SERVER_NAME': 
»q
.
£rv”
.
£rv”_Çme
,

1944 #Bah. "SERVER_PROTOCOL" 
is
 
aùu®ly
 
the
 
REQUEST
 
´ÙocŞ
.

1945 'SERVER_PROTOCOL': 
»q
.
»que¡_´ÙocŞ
.
	`decode
('ISO-8859-1'),

1946 'SERVER_SOFTWARE': 
»q
.
£rv”
.
soáw¬e
,

1947 'wsgi.”rÜs': 
sys
.
¡d”r
,

1948 'wsgi.šput': 
»q
.
rfe
,

1949 'wsgi.muÉroûss': 
F®£
,

1950 'wsgi.muÉ™h»ad': 
True
,

1951 'wsgi.run_Úû': 
F®£
,

1952 'wsgi.u¾_scheme': 
»q
.
scheme
.
	`decode
('ISO-8859-1'),

1954 
	}
}

1956 
	$isš¡ªû
(
»q
.
£rv”
.
bšd_addr
, 
ba£¡ršg
):

1957 #AF_UNIX. 
This
 
i¢
'ˆ»®ly‡Îowed by WSGI, which dÛ¢'
t


1958 #add»s 
unix
 
domaš
 
sock‘s
. 
But
 
™
's betterhan‚othing.

1959 
’v
["SERVER_PORT"] = ""

1961 
’v
["SERVER_PORT"] = 
	$¡r
(
»q
.
£rv”
.
bšd_addr
[1])

1963 #Reque¡ 
h—d”s


1964 
k
, 
v
 
š
 
»q
.
šh—d”s
.
	$™ems
():

1965 
k
 = k.
	`decode
('ISO-8859-1').
	`uµ”
().
	`»¶aû
("-", "_")

1966 
’v
["HTTP_" + 
k
] = 
v
.
	`decode
('ISO-8859-1')

1968 #CONTENT_TYPE/
CONTENT_LENGTH


1969 
ù
 = 
’v
.
	`pİ
("HTTP_CONTENT_TYPE", 
NÚe
)

1970 
ù
 
is
 
nÙ
 
NÚe
:

1971 
’v
["CONTENT_TYPE"] = 
ù


1972 
ş
 = 
’v
.
	`pİ
("HTTP_CONTENT_LENGTH", 
NÚe
)

1973 
ş
 
is
 
nÙ
 
NÚe
:

1974 
’v
["CONTENT_LENGTH"] = 
ş


1976 
»q
.
cÚn
.
s¦_’v
:

1977 
’v
.
	$upd©e
(
»q
.
cÚn
.
s¦_’v
)

1979  
’v


1982 
şass
 
	$WSGIG©eway_u0
(
WSGIG©eway_10
):

1985 
WSGI
 
u
.0 
is
 
ª
 
ex³rim’l
 
´ÙocŞ
, 
which
 
u£s
 
unicode
 
keys
 
ªd
 
v®ues


1986 
š
 
bÙh
 
PythÚ
 2 
ªd
 Python 3.

1989 
def
 
	$g‘_’vœÚ
(
£lf
):

1991 
»q
 = 
£lf
.req

1992 
’v_10
 = 
WSGIG©eway_10
.
	$g‘_’vœÚ
(
£lf
)

1993 
’v
 = 
’v_10
.
	$cİy
()

1994 
’v
['wsgi.version'] = ('u', 0)

1996 #Reque¡-
URI


1997 
’v
.
	`£tdeçuÉ
('wsgi.url_encoding', 'utf-8')

1998 
Œy
:

1999 #SCRIPT_NAME 
is
 
the
 
em±y
 
¡ršg
, 
who
 
ÿ»s
 
wh©
 
’codšg
 
™
 is?

2000 
’v
["PATH_INFO"] = 
»q
.
·th
.
	`decode
(env['wsgi.url_encoding'])

2001 
’v
["QUERY_STRING"] = 
»q
.
qs
.
	`decode
(env['wsgi.url_encoding'])

2002 
exû±
 
UnicodeDecodeE¼Ü
:

2003 #F®È
back
 
to
 
Ïtš
 1 
so
 
­ps
 
ÿn
 
Œªscode
 
Ãeded
.

2004 
’v
['wsgi.url_encoding'] = 'ISO-8859-1'

2005 
’v
["PATH_INFO"] = 
’v_10
["PATH_INFO"]

2006 
’v
["QUERY_STRING"] = 
’v_10
["QUERY_STRING"]

2008  
’v


2010 
wsgi_g©eways
 = {

2011 (1, 0): 
WSGIG©eway_10
,

2012 ('u', 0): 
WSGIG©eway_u0
,

2013 
	}
}

2015 
şass
 
	$WSGIP©hInfoDi¥©ch”
(
objeù
):

2018 
­ps
: 
a
 
diù
 
Ü
 
li¡
 
	$of
 (
·th_´efix
, 
­p
è
·œs
.

2021 
def
 
	$__š™__
(
£lf
, 
­ps
):

2022 
Œy
:

2023 
­ps
 = 
	`li¡
×µs.
	$™ems
())

2024 
exû±
 
A‰ribu‹E¼Ü
:

2025 
·ss


2027 #SÜˆ
the
 
­ps
 
by
 
	`Ën
(
·th
), 
desûndšg


2028 
­ps
.
	$sÜt
()

2029 
­ps
.
	$»v”£
()

2031 #Th
·th_´efix
 
¡ršgs
 
mu¡
 
¡¬t
, 
but
 
nÙ
 
’d
, 
w™h
 
a
 
¦ash
.

2032 #U£ "" 
š¡—d
 
of
 "/".

2033 
£lf
.
­ps
 = [(
p
.
	`r¡r
("/"), 
a
èp,‡ 
š
‡pps]

2035 
def
 
	$__ÿÎ__
(
£lf
, 
’vœÚ
, 
¡¬t_»¥Ú£
):

2036 
·th
 = 
’vœÚ
["PATH_INFO"] 
Ü
 "/"

2037 
p
, 
­p
 
š
 
£lf
.
­ps
:

2038 #Th
­ps
 
li¡
 
should
 
be
 
sÜ‹d
 
by
 
Ëngth
, 
desûndšg
.

2039 
·th
.
	`¡¬tsw™h
(
p
 + "/"è
Ü
…ath ==…:

2040 
’vœÚ
 =ƒnvœÚ.
	$cİy
()

2041 
’vœÚ
["SCRIPT_NAME"] =ƒnvœÚ["SCRIPT_NAME"] + 
p


2042 
’vœÚ
["PATH_INFO"] = 
·th
[
	$Ën
(
p
):]

2043  
	$­p
(
’vœÚ
, 
¡¬t_»¥Ú£
)

2045 
	`¡¬t_»¥Ú£
('404 Not Found', [('Content-Type', 'text/plain'),

	@trunk/objs/CherryPy-3.2.4/setup.py

3 
	gRun
:

4 
pythÚ
 
£tup
.
py
 
š¡®l


6 
to
 
š¡®l
 
this
 
·ckage
.

9 
Œy
:

10 
äom
 
£tu±oŞs
 
impÜt
 
£tup


11 
exû±
 
ImpÜtE¼Ü
:

12 
äom
 
di¡uts
.
cÜe
 
impÜt
 
£tup


14 
äom
 
di¡uts
.
commªd
.
š¡®l
 
impÜt
 
INSTALL_SCHEMES


15 
äom
 
di¡uts
.
commªd
.
bud_py
 
impÜt
 build_py

16 
impÜt
 
sys


17 
impÜt
 
»


19 
şass
 
	$ch”rypy_bud_py
(
bud_py
):

21 
def
 
	$bud_moduË
(
£lf
, 
moduË
, 
moduË_fe
, 
·ckage
):

22 
pythÚ3
 = 
sys
.
v”siÚ_šfo
 >= (3,)

23 
pythÚ3
:

24 
exşude_·‰”n
 = 
»
.
	`compe
('wsgiserver2|ssl_pyopenssl|'

27 
exşude_·‰”n
 = 
»
.
	`compe
('wsgiserver3')

28 
exşude_·‰”n
.
	$m©ch
(
moduË
):

29  #sk 
™


30  
bud_py
.
	$bud_moduË
(
£lf
, 
moduË
, 
moduË_fe
, 
·ckage
)

33 ###############################################################################
#¬gum’t 
the
 
£tup
 
commªd


34 ###############################################################################
 = "Ch”ryPy"

35 
v”siÚ
 = "3.2.4"

36 
desc
 = "Object-Oriented HTTP framework"

37 
lÚg_desc
 = "CherryPy is‡…ythonic, object-oriented HTTP framework"

38 
şassif›rs
=[

60 
authÜ
="CherryPy Team"

61 
authÜ_ema
="team@cherrypy.org"

62 
u¾
="http://www.cherrypy.org"

63 
ı_liûn£
="BSD"

64 
·ckages
=[

71 
d©a_fes
=[

96 
süts
 = ["cherrypy/cherryd"]

98 
cmd_şass
 = 
	$diù
(

99 
bud_py
 = 
ch”rypy_bud_py
,

102 
sys
.
v”siÚ_šfo
 >= (3, 0):

103 
»quœed_pythÚ_v”siÚ
 = '3.0'

105 
»quœed_pythÚ_v”siÚ
 = '2.3'

107 ###############################################################################
#’d 
¬gum’ts
 
£tup


109 #wšš¡ 
may
 
š¡®l
 
d©a_fes
 
š
 
PythÚ
/
x
.
y
 
š¡—d
 
of
 
the
 
ch”rypy
 
·ckage
.

111 #S“ 
®so
 
h‰p
:

112 'bdi¡_wšš¡' 
š
 
sys
.
¬gv
 
Ü
 '--format=wininst' in sys.argv:

113 
d©a_fes
 = [(
r
'\PURELIB\%s' % 
·th
, 
fes
è·th, fe 
š
 data_files]

115 
def
 
	$maš
():

116 
sys
.
v”siÚ
 < 
»quœed_pythÚ_v”siÚ
:

117 
s
 = "I'm sorry, but %s %s„equires Python %s or†ater."

118 
	`´št
(
s
 % (
Çme
, 
v”siÚ
, 
»quœed_pythÚ_v”siÚ
))

119 
sys
.
	$ex™
(1)

120 #£ˆ 
loÿtiÚ
 "d©a_fes" 
to


121 #¶©fÜm 
¥ecific
 "s™e-·ckages" 
loÿtiÚ


122 
scheme
 
š
 
	`li¡
(
INSTALL_SCHEMES
.
	$v®ues
()):

123 
scheme
['data'] = scheme['purelib']

125 
	$£tup
(

126 
Çme
=name,

127 
v”siÚ
=version,

128 
desütiÚ
=
desc
,

129 
lÚg_desütiÚ
=
lÚg_desc
,

130 
şassif›rs
=classifiers,

131 
authÜ
=author,

132 
authÜ_ema
=author_email,

133 
u¾
=url,

134 
liûn£
=
ı_liûn£
,

135 
·ckages
=packages,

136 
d©a_fes
=data_files,

137 
süts
=scripts,

138 
cmdşass
=
cmd_şass
,

142 
__Çme__
 == "__main__":

143 
	`maš
()

	@trunk/objs/_srs_build_summary.sh

1 #!/
bš
/
bash


3 #####################################################################################
#lšux 
sh–l
 
cŞÜ
 
suµÜt
.

4 
	gRED
="\\033[31m"

5 
GREEN
="\\033[32m"

6 
YELLOW
="\\033[33m"

7 
BLACK
="\\033[0m"

9 
echo
 -
e
 "${GREEN}build summary:${BLACK}"

10 
echo
 -
e
 " ${BLACK}+------------------------------------------------------------------------------------${BLACK}"

11 
echo
 -
e
 " |${GREEN}{disabled} gperf @see: https://github.com/ossrs/srs/wiki/v1_CN_GPERF${BLACK}"

12 
echo
 -
e
 " | ${GREEN}{disabled} gmc @see: http://google-perftools.googlecode.com/svn/trunk/doc/heap_checker.html${BLACK}"

13 
echo
 -
e
 " | ${GREEN}{disabled} gmc: gperf memory check, or memory†eak detect${BLACK}"

14 
echo
 -
e
 " | ${GREEN}{disabled}ƒnv PPROF_PATH=./objs/pprof HEAPCHECK=normal ./objs/srs -c conf/console.conf 2>gmc.log # start gmc${BLACK}"

15 
echo
 -
e
 " | ${GREEN}{disabled} killall -2 srs # or CTRL+Co stop gmc${BLACK}"

16 
echo
 -
e
 " | ${GREEN}{disabled} cat gmc.log #o‡nalysis memory†eak${BLACK}"

17 
echo
 -
e
 " | ${GREEN}{disabled} gmp @see: http://google-perftools.googlecode.com/svn/trunk/doc/heapprofile.html${BLACK}"

18 
echo
 -
e
 " | ${GREEN}{disabled} gmp: gperf memory…rofile, similaro gcp${BLACK}"

19 
echo
 -
e
 " | ${GREEN}{disabled}„m -f gperf.srs.gmp*; ./objs/srs -c conf/console.conf # start gmp${BLACK}"

20 
echo
 -
e
 " | ${GREEN}{disabled} killall -2 srs # or CTRL+Co stop gmp${BLACK}"

21 
echo
 -
e
 " | ${GREEN}{disabled} ./objs/pprof --text objs/srs gperf.srs.gmp* #o‡nalysis memory…rofile${BLACK}"

22 
echo
 -
e
 " | ${GREEN}{disabled} gcp @see: http://google-perftools.googlecode.com/svn/trunk/doc/cpuprofile.html${BLACK}"

23 
echo
 -
e
 " | ${GREEN}{disabled} gcp: gperf cpu…rofile${BLACK}"

24 
echo
 -
e
 " | ${GREEN}{disabled}„m -f gperf.srs.gcp*; ./objs/srs -c conf/console.conf # start gcp${BLACK}"

25 
echo
 -
e
 " | ${GREEN}{disabled} killall -2 srs # or CTRL+Co stop gcp${BLACK}"

26 
echo
 -
e
 " | ${GREEN}{disabled} ./objs/pprof --text objs/srs gperf.srs.gcp* #o‡nalysis cpu…rofile${BLACK}"

27 
echo
 -
e
 " ${BLACK}+------------------------------------------------------------------------------------${BLACK}"

28 
echo
 -
e
 " |${GREEN}{disabled} gprof @see: https://github.com/ossrs/srs/wiki/v1_CN_GPROF${BLACK}"

29 
echo
 -
e
 " |${GREEN}{disabled} gprof: GNU…rofileool, @see: http://www.cs.utah.edu/dept/old/texinfo/as/gprof.html${BLACK}"

30 
echo
 -
e
 " | ${GREEN}{disabled}„m -f gmon.out; ./objs/srs -c conf/console.conf # start gprof${BLACK}"

31 
echo
 -
e
 " | ${GREEN}{disabled} killall -2 srs # or CTRL+Co stop gprof${BLACK}"

32 
echo
 -
e
 " | ${GREEN}{disabled} gprof -b ./objs/srs gmon.out > gprof.srs.log &&„m -f gmon.out # gprof„eporto gprof.srs.log${BLACK}"

33 
echo
 -
e
 " ${BLACK}+------------------------------------------------------------------------------------${BLACK}"

34 
echo
 -
e
 " |${GREEN}utest: ./objs/srs_utest,he utest for srs${BLACK}"

35 
echo
 -
e
 " ${BLACK}+------------------------------------------------------------------------------------${BLACK}"

36 
echo
 -
e
 " |${GREEN}librtmp @see: https://github.com/ossrs/srs/wiki/v1_CN_SrsLibrtmp${BLACK}"

37 
echo
 -
e
 " |${GREEN}librtmp: ./objs/include, ./objs/lib,he srs-librtmp†ibrary${BLACK}"

38 
echo
 -
e
 " | ${GREEN}simple handshake:…ublish/play stream with simple handshakeo server${BLACK}"

39 
echo
 -
e
 " | ${GREEN}complex handshake: it's‚ot„equired for client,„ecommend disable it${BLACK}"

40 
echo
 -
e
 " | ${GREEN}librtmp-sample: ./research/librtmp,he srs-librtmp client sample${BLACK}"

41 
echo
 -
e
 " | ${GREEN}librtmp-sample: ./research/librtmp/objs/srs_ingest_flv${BLACK}"

42 
echo
 -
e
 " | ${GREEN}librtmp-sample: ./research/librtmp/objs/srs_ingest_rtmp${BLACK}"

43 
echo
 -
e
 " | ${GREEN}librtmp-sample: ./research/librtmp/objs/srs_detect_rtmp${BLACK}"

44 
echo
 -
e
 " | ${GREEN}librtmp-sample: ./research/librtmp/objs/srs_bandwidth_check${BLACK}"

45 
echo
 -
e
 " ${BLACK}+------------------------------------------------------------------------------------${BLACK}"

46 
echo
 -
e
 " |${GREEN}{disabled}„esearch: ./objs/research,‡pi server,…layers,s info,†ibrtmp.${BLACK}"

47 
echo
 -
e
 " | ${GREEN}{disabled} @see https://github.com/ossrs/srs/wiki/v2_CN_SrsLibrtmp#srs-librtmp-examples${BLACK}"

48 
echo
 -
e
 " ${BLACK}+------------------------------------------------------------------------------------${BLACK}"

49 
echo
 -
e
 " |${GREEN}tools: importantool, others @see https://github.com/ossrs/srs/wiki/v2_CN_SrsLibrtmp#srs-librtmp-examples${BLACK}"

50 
echo
 -
e
 " | ${GREEN}./objs/srs_ingest_hls -i http://ossrs.net/live/livestream.m3u8 -y„tmp://127.0.0.1/live/livestream${BLACK}"

51 
echo
 -
e
 " ${BLACK}+------------------------------------------------------------------------------------${BLACK}"

52 
echo
 -
e
 " |${GREEN}server: ./objs/srs -c conf/srs.conf, starthe srs server${BLACK}"

53 
echo
 -
e
 " | ${GREEN}hls @see: https://github.com/ossrs/srs/wiki/v2_CN_DeliveryHLS${BLACK}"

54 
echo
 -
e
 " | ${GREEN}hls: generate m3u8‡nds from„tmp stream${BLACK}"

55 
echo
 -
e
 " | ${GREEN}dvr @see: https://github.com/ossrs/srs/wiki/v2_CN_DVR${BLACK}"

56 
echo
 -
e
 " | ${GREEN}dvr:„ecord RTMP streamo flv files.${BLACK}"

57 
echo
 -
e
 " | ${GREEN}{disabled}‚ginx @see: https://github.com/ossrs/srs/wiki/v2_CN_DeliveryHLS${BLACK}"

58 
echo
 -
e
 " | ${GREEN}{disabled}‚ginx: delivery HLS stream by‚ginx${BLACK}"

59 
echo
 -
e
 " | ${GREEN}{disabled}‚ginx: sudo ./objs/nginx/sbin/nginx${BLACK}"

60 
echo
 -
e
 " | ${GREEN}ssl @see: https://github.com/ossrs/srs/wiki/v1_CN_RTMPHandshake${BLACK}"

61 
echo
 -
e
 " | ${GREEN}ssl: support RTMP complex handshake for client„equired, for instance, flash${BLACK}"

62 
echo
 -
e
 " | ${YELLOW}{disabled} ffmpeg @see: https://github.com/ossrs/srs/wiki/v1_CN_FFMPEG${BLACK}"

63 
echo
 -
e
 " | ${YELLOW}{disabled} ffmpeg:ranscode, mux, ingestool${BLACK}"

64 
echo
 -
e
 " | ${YELLOW}{disabled} ffmpeg: ./objs/ffmpeg/bin/ffmpeg${BLACK}"

65 
echo
 -
e
 " | ${GREEN}transcode @see: https://github.com/ossrs/srs/wiki/v1_CN_FFMPEG${BLACK}"

66 
echo
 -
e
 " | ${GREEN}transcode: supportranscoding RTMP stream${BLACK}"

67 
echo
 -
e
 " | ${GREEN}ingest @see: https://github.com/ossrs/srs/wiki/v1_CN_Ingest${BLACK}"

68 
echo
 -
e
 " | ${GREEN}ingest: support ingest file/stream/devicehen…usho SRS by RTMP stream${BLACK}"

69 
echo
 -
e
 " | ${GREEN}http-callback @see: https://github.com/ossrs/srs/wiki/v2_CN_HTTPCallback${BLACK}"

70 
echo
 -
e
 " | ${GREEN}http-callback: support http callback for‡uthentication‡ndƒvent injection${BLACK}"

71 
echo
 -
e
 " | ${GREEN}http-server @see: https://github.com/ossrs/srs/wiki/v2_CN_HTTPServer${BLACK}"

72 
echo
 -
e
 " | ${GREEN}http-server: support http servero delivery http stream${BLACK}"

73 
echo
 -
e
 " | ${GREEN}http-api @see: https://github.com/ossrs/srs/wiki/v2_CN_HTTPApi${BLACK}"

74 
echo
 -
e
 " | ${GREEN}http-api: support http‡pio manage server${BLACK}"

75 
echo
 -
e
 " | ${YELLOW}{disabled} stream-caster @see: https://github.com/ossrs/srs/wiki/v2_CN_Streamer${BLACK}"

76 
echo
 -
e
 " | ${YELLOW}{disabled} stream-caster: start servero cast stream over other…rotocols.${BLACK}"

77 
echo
 -
e
 " ${BLACK}+------------------------------------------------------------------------------------${BLACK}"

78 
echo
 -
e
 "${GREEN}binaries @see: https://github.com/ossrs/srs/wiki/v2_CN_Build${BLACK}"

80 
echo
 "You can:"

81 
echo
 " ./objs/srs -c conf/srs.conf"

82 
echo
 "o starthe srs server, with config conf/srs.conf."

	@trunk/objs/gtest-1.6.0/build-aux/ltmain.sh

1 #G’”©ed 
äom
 
Émaš
.
m4sh
.

3 #Émaš.
sh
 (
GNU
 
libtoŞ
) 2.2.6b

4 #Wr™‹À
by
 
GÜdÚ
 
M©zigke™
 <
gÜd
@
gnu
.
ai
.
m™
.
edu
>, 1996

6 #Cİyrighˆ(
C
è1996, 1997, 1998, 1999, 2000, 2001, 2003, 2004, 2005, 2006, 2007 2008 
F»e
 
Soáw¬e
 
Found©iÚ
, 
Inc
.

7 #Thi 
is
 
ä“
 
soáw¬e
; 
£e
 
the
 
sourû
 
cİyšg
 
cÚd™iÚs
. 
Th”e
 i 
NO


8 #w¬¿Áy; 
nÙ
 
ev’
 
MERCHANTABILITY
 
Ü
 
FITNESS
 
FOR
 
A
 
PARTICULAR
 
PURPOSE
.

10 #GNU 
LibtoŞ
 
is
 
ä“
 
soáw¬e
; 
you
 
ÿn
 
»di¡ribu‹
 
™
 
ªd
/
Ü
 
modify


11 #™ 
und”
 
the
 
‹rms
 
of
h
GNU
 
G’”®
 
Public
 
Liûn£
 
as
 
published
 
by


12 #th
F»e
 
Soáw¬e
 
Found©iÚ
; 
e™h”
 
v”siÚ
 2 
of
 
the
 
Liûn£
, 
Ü


13 #(
©
 
your
 
İtiÚ
è
ªy
 
Ï‹r
 
v”siÚ
.

14 #
#A 
a
 
¥ecŸl
 
exû±iÚ
 
to
 
the
 
GNU
 
G’”®
 
Public
 
Liûn£
,

15 #ià
you
 
di¡ribu‹
 
this
 
fe
 
as
 
·¹
 
of
 
a
 
´og¿m
 
Ü
 
lib¿ry
 
th©


16 #i 
but
 
usšg
 
GNU
 
LibtoŞ
, 
you
 
may
 
šşude
 
this
 
fe
 
und”
 
the


17 #§m
di¡ributiÚ
 
‹rms
 
th©
 
you
 
u£
 
the
 
»¡
 
of
h© 
´og¿m
.

18 #
#GNU 
LibtoŞ
 
is
 
di¡ribu‹d
 
š
 
the
 
hİe
 
th©
 
™
 
wl
 
be
 
u£ful
, 
but


19 #WITHOUT 
ANY
 
WARRANTY
; 
w™hout
 
ev’
 
the
 
im¶›d
 
w¬¿Áy
 
of


20 #MERCHANTABILITY 
Ü
 
FITNESS
 
FOR
 
A
 
PARTICULAR
 
PURPOSE
. 
S“
 
the
 
GNU


21 #G’”® 
Public
 
Liûn£
 
mÜe
 
d‘as
.

22 #
#You 
should
 
have
 
»ûived
 
a
 
cİy
 
of
 
the
 
GNU
 
G’”®
 
Public
 
Liûn£


23 #®Úg 
w™h
 
GNU
 
LibtoŞ
; 
£e
 
the
 
fe
 
COPYING
. 
If
 
nÙ
, 
a
 
cİy


24 #ÿÀ
be
 
dowÆßded
 
äom
 
h‰p
:

25 #Ü 
obšed
 
by
 
wr™šg
 
to
 
the
 
F»e
 
Soáw¬e
 
Found©iÚ
, 
Inc
.,

26 #51 
F¿nklš
 
SŒ“t
, 
Fiáh
 
FloÜ
, 
Bo¡Ú
, 
MA
 02110-1301, 
USA
.

28 #U§ge: 
$´ogÇme
 [
OPTION
]... [
MODE
-
ARG
]...

29 #
#Provid
g’”®ized
 
lib¿ry
-
budšg
 
suµÜt
 
£rviûs
.

30 #
#--
cÚfig
 
show
 
®l
 
cÚfigu¿tiÚ
 
v¬ŸbËs


31 #--
debug
 
’abË
 
v”bo£
 
sh–l
 
Œacšg


32 #-
n
, --
dry
-
run
 
di¥Ïy
 
commªds
 
w™hout
 
modifyšg
 
ªy
 
fes


33 #--
ã©u»s
 
di¥Ïy
 
basic
 
cÚfigu¿tiÚ
 
šfÜm©iÚ
 
ªd
 
ex™


34 #--
mode
=
MODE
 
u£
 
İ”©iÚ
 mode MODE

35 #--
´e£rve
-
dup
-
d•s
 
dÚ
't„emove duplicate dependency†ibraries

36 #--
qu›t
, --
s’t
 
dÚ
't…rint informational messages

37 #--
g
=
TAG
 
u£
 
cÚfigu¿tiÚ
 
v¬ŸbËs
 
äom
ag TAG

38 #-
v
, --
v”bo£
 
´št
 
šfÜm©iÚ®
 
mes§ges
 ()

39 #--
v”siÚ
 
´št
 v”siÚ 
šfÜm©iÚ


40 #-
h
, --
h–p
 
´št
 
Ü
 h–°
mes§ge


41 #
#MODE 
mu¡
 
be
 
Úe
 
of
 
the
 
fŞlowšg
:

42 #
#ş—À
»move
 
fes
 
äom
 
the
 
bud
 
dœeùÜy


43 #comp
compe
 
a
 
sourû
 
fe
 
što
‡ 
libtoŞ
 
objeù


44 #execu‹ 
autom©iÿÎy
 
£t
 
lib¿ry
 
·th
, 
th’
 
run
 
a
 
´og¿m


45 #fšish 
com¶‘e
 
the
 
š¡®ÏtiÚ
 
of
 
libtoŞ
 
lib¿r›s


46 #š¡®È
š¡®l
 
lib¿r›s
 
Ü
 
execubËs


47 #lšk 
ü—‹
 
a
 
lib¿ry
 
Ü
 
ª
 
execubË


48 #unš¡®È
»move
 
lib¿r›s
 
äom
 
ª
 
š¡®Ëd
 
dœeùÜy


49 #
#MODE-
ARGS
 
v¬y
 
d•’dšg
 
Ú
 
the
 
MODE
.

50 #Try `
$´ogÇme
 --
h–p
 --
mode
=
MODE
' for‡ more detailed description of MODE.

51 #
#Wh’ 
»pÜtšg
 
a
 
bug
, 
¶—£
 
desüibe
‡ 
‹¡
 
to
 
»´oduû
 
™
 
ªd


52 #šşud
the
 
fŞlowšg
 
šfÜm©iÚ
:

53 #
#ho¡-
ŒËt
: 
$ho¡


54 #sh–l: 
$SHELL


55 #comp”: 
$LTCC


56 #comp” 
æags
: 
$LTCFLAGS


57 #lšk”: 
$LD
 (
gnu
? 
$w™h_gnu_ld
)

58 #$´ogÇme: (
GNU
 
libtoŞ
è2.2.6b 
DebŸn
-2.2.6b-2ubu
Áu1


59 #automake: 
$automake_v”siÚ


60 #autocÚf: 
$autocÚf_v”siÚ


61 #
#R•Üˆ
bugs
 
to
 <
bug
-
libtoŞ
@
gnu
.
Üg
>.

63 
	gPROGRAM
=
Émaš
.
sh


64 
PACKAGE
=
libtoŞ


65 
VERSION
="2.2.6b Debian-2.2.6b-2ubuntu1"

66 
TIMESTAMP
=""

67 
·ckage_»visiÚ
=1.3017

69 #B
Bouºe
 
com·tibË


70 
‹¡
 -
n
 "${ZSH_VERSION+£t}" && (
emuÏ‹
 
sh
è>/
dev
/
nuÎ
 2>&1; 
th’


71 
emuÏ‹
 
sh


72 
	gNULLCMD
=:

73 #Zsh 3.x 
ªd
 4.x 
³rfÜms
 
wÜd
 
¥l™tšg
 
Ú
 
$
{1+"$@"}, 
which


74 #i 
cÚŒ¬y
 
to
 
our
 
u§ge
. 
Di§bË
 
this
 
ã©u»
.

75 
	g®Ÿs
 -
	gg
 '${1+"$@"}'='"$@"'

76 
£tİt
 
NO_GLOB_SUBST


78 `(
£t
 -
o
è2>/
dev
/
nuÎ
` 
š
 *
posix
*è£ˆ-Øposix;; 
e§c


79 
fi


80 
	gBIN_SH
=
xpg4
; 
expÜt
 BIN_SH #fÜ 
Tru64


81 
	gDUALCASE
=1; 
expÜt
 DUALCASE #fÜ 
MKS
 
	gsh


83 #NLS 
nui§nûs
: 
We
 
§ve
 
the
 
Şd
 
v®ues
 
to
 
»¡Üe
 
duršg
 
execu‹
 
mode
.

84 #OÆy 
£t
 
LANG
 
ªd
 
LC_ALL
 
to
 
C
 
®»ady
 set.

85 #The£ 
mu¡
 
nÙ
 
be
 
£t
 
uncÚd™iÚ®ly
 
beÿu£
‚Ù 
®l
 
sy¡ems
 
und”¡ªd


86 #e.
g
. 
LANG
=
C
 (
nÙably
 
SCO
).

87 
	gÉ_u£r_loÿË
=

88 
É_§ã_loÿË
=

89 
É_v¬
 
š
 
LANG
 
LANGUAGE
 
LC_ALL
 
LC_CTYPE
 
LC_COLLATE
 
LC_MESSAGES


91 
ev®
 "ifest \"\${$lt_var+set}\" = set;hen

92 
§ve_$É_v¬
=\
$$É_v¬


93 
$É_v¬
=
C


94 
expÜt
 
$É_v¬


95 
É_u£r_loÿË
=\"$lt_var=\\\$save_\$lt_var; \$lt_user_locale\"

96 
É_§ã_loÿË
=\"$lt_var=C; \$lt_safe_locale\"

97 
fi
"

98 
dÚe


100 
$É_un£t
 
CDPATH


106 : 
$
{
CP
="cp -f"}

107 : 
$
{
ECHO
="echo"}

108 : 
$
{
EGREP
="/bin/grep -E"}

109 : 
$
{
FGREP
="/bin/grep -F"}

110 : 
$
{
GREP
="/bin/grep"}

111 : 
$
{
LN_S
="ln -s"}

112 : 
$
{
MAKE
="make"}

113 : 
$
{
MKDIR
="mkdir"}

114 : 
$
{
MV
="mv -f"}

115 : 
$
{
RM
="rm -f"}

116 : 
$
{
SED
="/bin/sed"}

117 : 
$
{
SHELL
="${CONFIG_SHELL-/bin/sh}"}

118 : 
$
{
X£d
="$SED -e 1s/^X//"}

120 #Glob® 
v¬ŸbËs
:

121 
EXIT_SUCCESS
=0

122 
EXIT_FAILURE
=1

123 
EXIT_MISMATCH
=63 #$? = 63 
is
 
u£d
 
to
 
šdiÿ‹
 
v”siÚ
 
mism©ch
Ø
missšg
.

124 
EXIT_SKIP
=77 #$? = 77 
is
 
u£d
 
to
 
šdiÿ‹
 
a
 
sk³d
 
‹¡
Ø
automake
.

126 
ex™_¡©us
=
$EXIT_SUCCESS


128 #Mak
su»
 
IFS
 
has
 
a
 
£nsibË
 

129 
É_Æ
='

131 
IFS
=" $lt_nl"

133 
dœÇme
="s,/[^/]*$,,"

134 
ba£Çme
="s,^.*/,,"

136 #func_dœÇme_ªd_ba£Çm
fe
 
­³nd
 
nÚdœ_»¶aûm’t


137 #³rfÜm 
func_ba£Çme
 
ªd
 
func_dœÇme
 
š
 
a
 
sšgË
 
funùiÚ


139 #dœÇme: 
Compu‹
 
the
 
dœÇme
 
of
 
FILE
. 
If
 
nÚem±y
,

140 #add 
APPEND
 
to
 
the
 
»suÉ
, 
Ùh”wi£
 
£t
„esult

141 #tØ
NONDIR_REPLACEMENT
.

142 #v®u
»tuºed
 
š
 "$func_dirname_result"

143 #ba£Çme: 
Compu‹
 
f’ame
 
of
 
FILE
.

144 #v®u
»tuÃd
 
š
 "$func_basename_result"

145 #Im¶em’tiÚ 
mu¡
 
be
 
k•t
 
synchrÚized
 
w™h
 
func_dœÇme


146 #ªd 
func_ba£Çme
. 
FÜ
 
effic›ncy
, 
we
 dØ
nÙ
 
d–eg©e
 
to


147 #tho£ 
funùiÚs
 
but
 
š¡—d
 
du¶iÿ‹
 
the
 
funùiÚ®™y
 
h”e
.

148 
	$func_dœÇme_ªd_ba£Çme
 ()

150 #ExŒaù 
subdœeùÜy
 
äom
 
the
 
¬gum’t
.

151 
func_dœÇme_»suÉ
=`
$ECHO
 "X${1}" | 
$X£d
 -
e
 "$dirname"`

152 
‹¡
 "X$func_dœÇme_»suÉ" = "X${1}"; 
th’


153 
func_dœÇme_»suÉ
="${3}"

155 
func_dœÇme_»suÉ
="$func_dirname_result${2}"

156 
fi


157 
func_ba£Çme_»suÉ
=`
$ECHO
 "X${1}" | 
$X£d
 -
e
 "$basename"`

158 
	}
}

160 #G’”©ed 
sh–l
 
funùiÚs
 
š£¹ed
 
h”e
.

162 #WÜk 
¬ound
 
backw¬d
 
com·tib™y
 
issue
 
Ú
 
IRIX
 6.5. 
On
 IRIX 6.4+, 
sh


163 #i 
ksh
 
but
 
wh’
 
the
 
sh–l
 
is
 
švoked
 
as
 "sh" 
ªd
h
cu¼’t
 
v®ue
 
of


164 #th
_XPG
 
’vœÚm’t
 
v¬ŸbË
 
is
 
nÙ
 
equ®
 
to
 1 (
Úe
), 
the
 
¥ecŸl


165 #pos™iÚ® 
·¿m‘”
 
$0
, 
w™hš
 
a
 
funùiÚ
 
ÿÎ
, 
is
 
the
 
Çme
 
of
he

167 
	g´og·th
="$0"

169 #Th
Çme
 
of
 
this
 
´og¿m
:

170 #IÀ
the
 
uÆik–y
 
ev’t
 
$´ogÇme
 
begª
 
w™h
 
a
 '-', 
™
 
would
 
¶ay
 
havoc
 with

171 #func_echØ(
imagše
 
´ogÇme
=-
n
), 
so
 
we
 
´•’d
 ./ 
š
 
th©
 :

172 
	gfunc_dœÇme_ªd_ba£Çme
 "$progpath"

173 
	g´ogÇme
=
$func_ba£Çme_»suÉ


174 
$´ogÇme
 
š


175 -*è
´ogÇme
=./
$´ogÇme
 ;;

176 
	ge§c


178 #Mak
su»
 
we
 
have
 
ª
 
absŞu‹
 
·th
 
»executiÚ
:

179 
$´og·th
 
	gš


180 [\\/]*|[
A
-
Za
-
z
]:\\*) ;;

182 
	g´ogdœ
=
$func_dœÇme_»suÉ


183 
´ogdœ
=`
cd
 "$´ogdœ" && 
pwd
`

184 
´og·th
="$progdir/$progname"

187 
	g§ve_IFS
="$IFS"

188 
IFS
=:

189 
´ogdœ
 
š
 
$PATH
; do

190 
	gIFS
="$save_IFS"

191 
‹¡
 -
x
 "$progdir/$progname" && 

192 
dÚe


193 
IFS
="$save_IFS"

194 
‹¡
 -
n
 "$´ogdœ" || 
´ogdœ
=`
pwd
`

195 
´og·th
="$progdir/$progname"

197 
	ge§c


199 #Sed 
sub¡™utiÚ
 
th©
 
h–ps
 
us
 dØ
robu¡
 
quÙšg
. 
It
 
back¦ashif›s


200 #m‘ach¬aù” 
th©
 
¬e
 
¡l
 
aùive
 
w™hš
 -
quÙed
 
¡ršgs
.

201 
	gX£d
="${SED}"' -e 1s/^X//'

202 
£d_quÙe_sub¡
='s/\([`"$\\]\)/\\\1/g'

204 #Sam
as
 
above
, 
but
 dØ
nÙ
 
quÙe
 
v¬ŸbË
 
»ã»nûs
.

205 
	gdoubË_quÙe_sub¡
='s/\(["`\\]\)/\\\1/g'

208 #`\'-ed iÀšpuˆtØth§me. Iàª odd‚umb” oà`\'…»ûded‡ '
$
'

209 #š 
šput
 
to
 
doubË_quÙe_sub¡
, 
th©
 '$' 
was
 
´Ùeùed
 
äom
 
ex·nsiÚ
.

210 #Sšû 
—ch
 
šput
 `\' is‚owwo `\'s,†ook for‡ny‚umber of„uns of

211 #fou¸`\' fŞlowed bywØ`\' ªdh’‡ '
$
'. `\'hat '$'.

212 
	gbs
='\\'

213 
bs2
='\\\\'

214 
bs4
='\\\\\\\\'

215 
dŞÏr
='\$'

216 
£d_doubË_back¦ash
="\
/$bs4/&\\

218 /
g


219 
s
/^
$bs2$dŞÏr
/
$bs
&/

220 
s
/\\([^
$bs
]\\)
$bs2$dŞÏr
/\\1
$bs2$bs$dŞÏr
/
g


221 
s
/\
n


223 #Snd¬d 
İtiÚs
:

224 
İt_dry_run
=
çl£


225 
İt_h–p
=
çl£


226 
İt_qu›t
=
çl£


227 
İt_v”bo£
=
çl£


228 
İt_w¬nšg
=:

230 #func_echØ
¬g
...

231 #EchØ
´og¿m
 
Çme
 
´efixed
 
mes§ge
, 
®Úg
 
w™h
 
the
 
cu¼’t
 
mode


232 #Çm
™
 
has
 
b“n
 
£t
 
y‘
.

233 
	$func_echo
 ()

235 
$ECHO
 "$progname${mode+: }$mode: $*"

236 
	}
}

238 #func_v”bo£ 
¬g
...

239 #EchØ
´og¿m
 
Çme
 
´efixed
 
mes§ge
 
š
 
v”bo£
 
mode
 
Úly
.

240 
	$func_v”bo£
 ()

242 
$İt_v”bo£
 && 
func_echo
 
$
{1+"$@"}

244 #A 
bug
 
š
 
bash
 
h®ts
 
the
 
süt
 th
Ï¡
 
lše
 
of
 
a
 
funùiÚ


245 #ç 
wh’
 
£t
 -
e
 
is
 
š
 
fÜû
, 
so
 
we
 
Ãed
 
ªÙh”
 
commªd
 
to


246 #wÜk 
¬ound
 
th©
:

248 
	}
}

250 #func_”rÜ 
¬g
...

251 #EchØ
´og¿m
 
Çme
 
´efixed
 
mes§ge
 
to
 
¡ªd¬d
 
”rÜ
.

252 
	$func_”rÜ
 ()

254 
$ECHO
 "$´ogÇme${mode+: }$mode: "
$
{1+"$@"} 1>&2

255 
	}
}

257 #func_w¬nšg 
¬g
...

258 #EchØ
´og¿m
 
Çme
 
´efixed
 
w¬nšg
 
mes§ge
 
to
 
¡ªd¬d
 
”rÜ
.

259 
	$func_w¬nšg
 ()

261 
$İt_w¬nšg
 && 
$ECHO
 "$´ogÇme${mode+: }$mode: w¬nšg: "
$
{1+"$@"} 1>&2

263 #bash 
bug
 
agaš
:

265 
	}
}

267 #func_çl_”rÜ 
¬g
...

268 #EchØ
´og¿m
 
Çme
 
´efixed
 
mes§ge
 
to
 
¡ªd¬d
 
”rÜ
, 
ªd
 
ex™
.

269 
	$func_çl_”rÜ
 ()

271 
func_”rÜ
 
$
{1+"$@"}

272 
ex™
 
$EXIT_FAILURE


273 
	}
}

275 #func_çl_h–°
¬g
...

276 #EchØ
´og¿m
 
Çme
 
´efixed
 
mes§ge
 
to
 
¡ªd¬d
 
”rÜ
, 
fŞlowed
 
by


277 #¨
h–p
 
hšt
, 
ªd
 
ex™
.

278 
	$func_çl_h–p
 ()

280 
func_”rÜ
 
$
{1+"$@"}

281 
func_çl_”rÜ
 "$help"

282 
	}
}

283 
	gh–p
="Try \`$progname --help' for more information." ## 

286 #func_g»°
ex´essiÚ
 
f’ame


287 #Check 
wh‘h”
 
EXPRESSION
 
m©ches
 
ªy
 
lše
 
of
 
FILENAME
, 
w™hout
 
ouut
.

288 
	$func_g»p
 ()

290 
$GREP
 "$1" "$2" >/
dev
/
nuÎ
 2>&1

291 
	}
}

294 #func_mkdœ_°
dœeùÜy
-
·th


295 #Mak
su»
 
the
 
’tœe
 
·th
 
to
 
DIRECTORY
-
PATH
 
is
 
avaabË
.

296 
	$func_mkdœ_p
 ()

298 
my_dœeùÜy_·th
="$1"

299 
my_dœ_li¡
=

301 
‹¡
 -
n
 "$my_dœeùÜy_·th" &&e¡ "$İt_dry_run" !ğ":"; 
th’


303 #PrÙeù 
dœeùÜy
 
Çmes
 
¡¬tšg
 
w™h
 `-'

304 
$my_dœeùÜy_·th
 
š


305 -*è
my_dœeùÜy_·th
="./$my_directory_path" ;;

306 
e§c


308 #Wh
some
 
pÜtiÚ
 
of
 
DIR
 
dÛs
 
nÙ
 
y‘
 
exi¡
...

309 
‹¡
 ! -
d
 "$my_directory_path"; do

310 #...
make
 
a
 
li¡
 
š
 
tİmo¡
 
fœ¡
 
Üd”
. 
U£
‡ 
cŞÚ
 
d–im™ed


311 #li¡ 
šÿ£
 
some
 
pÜtiÚ
 
of
 
·th
 
cÚšs
 
wh™e¥aû
.

312 
my_dœ_li¡
="$my_directory_path:$my_dir_list"

314 #Ià
the
 
Ï¡
 
pÜtiÚ
 
added
 
has
 
no
 
¦ash
 
š
 
™
,h
li¡
 
is
 
dÚe


315 
$my_dœeùÜy_·th
 
š
 *

989 
e§c


990 
	}
}

993 #func_šãr_g 
¬g


994 #Inã¸
gged
 
cÚfigu¿tiÚ
 
to
 
u£
 
ªy
 
¬e
 
avaabË
 
ªd


995 #ià
Úe
 
wa¢
't chosen viahe "--tag" command†ine option.

996 #OÆy 
©‹m±
 
this
 
the
 
comp”
 
š
h
ba£
 
compe


997 #commªd 
dÛ¢
't matchhe default compiler.

998 #¬g 
is
 
usu®ly
 
of
 
the
 
fÜm
 'gcc ...'

999 
	$func_šãr_g
 ()

1001 
$İt_debug


1002 
‹¡
 -
n
 "$avaabË_gs" &&e¡ -
z
 "$gÇme"; 
th’


1003 
CC_quÙed
=

1004 
¬g
 
š
 
$CC
; do

1005 
func_quÙe_fÜ_ev®
 "$arg"

1006 
CC_quÙed
="$CC_quoted $func_quote_for_eval_result"

1007 
dÚe


1008 
$
@ 
š


1009 #BÏnk 
š
 
the
 
commªd
 
may
 
have
 
b“n
 
¡r³d
 
by
h
ÿÎšg
 
sh–l
,

1010 #buˆ
nÙ
 
äom
 
the
 
CC
 
’vœÚm’t
 
v¬ŸbË
 
wh’
 
cÚfigu»
 
was
 
run
.

1012 #BÏnk 
©
 
the
 
¡¬t
 
of
 
$ba£_compe
 
wl
 
ÿu£
 
this
 
to
 
ç


1013 #ià
we
 
dÚ
't check forhem‡s well.

1015 
z
 
š
 
$avaabË_gs
; do

1016 
$GREP
 "^# ### BEGIN LIBTOOL TAG CONFIG: $z$" < "$´og·th" > /
dev
/
nuÎ
; 
th’


1017 #Ev®u©
the
 
cÚfigu¿tiÚ
.

1018 
ev®
 "`${SED} -n -e '/^# ### BEGIN LIBTOOL TAG CONFIG: '$z'$/,/^# ### END LIBTOOL TAG CONFIG: '$z'$/p' < $progpath`"

1019 
CC_quÙed
=

1020 
¬g
 
š
 
$CC
; do

1021 #DoubË-
quÙe
 
¬gs
 
cÚššg
 
Ùh”
 
sh–l
 
m‘ach¬aù”s
.

1022 
func_quÙe_fÜ_ev®
 "$arg"

1023 
CC_quÙed
="$CC_quoted $func_quote_for_eval_result"

1024 
dÚe


1025 "$@ " 
š


1027 #Th
comp”
 
š
 
the
 
ba£
 
compe
 
commªd
 
m©ches


1028 #th
Úe
 
š
 
the
 
gged
 
cÚfigu¿tiÚ
.

1029 #Assum
this
 
is
 
the
 
gged
 
cÚfigu¿tiÚ
 
we
 
wªt
.

1030 
gÇme
=
$z


1033 
e§c


1034 
fi


1035 
dÚe


1036 #Ià
$gÇme
 
¡l
 
i¢
't set,hen‚oagged configuration

1037 #wa 
found
 
ªd
 
Ët
 
the
 
u£r
 
know
 
th©
h"--g" 
commªd


1038 #lš
İtiÚ
 
mu¡
 
be
 
u£d
.

1039 
‹¡
 -
z
 "$gÇme"; 
th’


1040 
func_echo
 "unableo inferagged configuration"

1041 
func_çl_”rÜ
 "specify‡ag with \`--tag'"

1044 
fi


1046 
e§c


1047 
fi


1048 
	}
}

1052 #func_wr™e_libtoŞ_objeù 
ouut_Çme
 
pic_Çme
 
nÚpic_Çme


1053 #C»©
a
 
libtoŞ
 
objeù
 
fe
 (
ª®ogous
 
to
‡ ".la" file),

1054 #buˆ
dÚ
'ˆü—‹ iˆiàwe'
»
 
došg
 
a
 
dry
 
run
.

1055 
	$func_wr™e_libtoŞ_objeù
 ()

1057 
wr™e_libobj
=
$
{1}

1058 
‹¡
 "$bud_libtoŞ_libs" = 
yes
; 
th’


1059 
wr™e_lobj
=\'${2}\'

1061 
wr™e_lobj
=
nÚe


1062 
fi


1064 
‹¡
 "$bud_Şd_libs" = 
yes
; 
th’


1065 
wr™e_Şdobj
=\'${3}\'

1067 
wr™e_Şdobj
=
nÚe


1068 
fi


1070 
$İt_dry_run
 || {

1071 
ÿt
 >
$
{
wr™e_libobj
}
T
 <<
EOF


1072 #$wr™e_libobj - 
a
 
libtoŞ
 
objeù
 
fe


1073 #G’”©ed 
by
 
	`$PROGRAM
 (
GNU
 
$PACKAGE$TIMESTAMP
è
$VERSION


1074 #
#PËa£ 
DO
 
NOT
 
d–‘e
 
this
 
fe
!

1075 #Iˆ
is
 
Ãûs§ry
 
lškšg
 
the
 
lib¿ry
.

1077 #Nam
of
 
the
 
PIC
 
objeù
.

1078 
pic_objeù
=
$wr™e_lobj


1080 #Nam
of
 
the
 
nÚ
-
PIC
 
objeù


1081 
nÚ_pic_objeù
=
$wr™e_Şdobj


1083 
EOF


1084 
$MV
 "${write_libobj}T" "${write_libobj}"

1086 
	}
}

1088 #func_mode_comp
¬g
...

1089 
	$func_mode_compe
 ()

1091 
$İt_debug


1092 #G‘ 
the
 
comp©iÚ
 
commªd
 
ªd
h
sourû
 
fe
.

1093 
ba£_compe
=

1094 
¤cfe
="$nÚİt" #®way 
k“p
 
a
 
nÚ
-
em±y
 
v®ue
 
š
 "srcfile"

1095 
suµ»ss_İt
=
yes


1096 
suµ»ss_ouut
=

1097 
¬g_mode
=
nÜm®


1098 
libobj
=

1099 
Ï‹r
=

1100 
p›_æag
=

1102 
¬g


1104 
$¬g_mode
 
š


1105 
¬g
 )

1106 #dØ
nÙ
 "cÚtšue". 
In¡—d
, 
add
 
this
 
to
 
ba£_compe


1107 
Ï¡¬g
="$arg"

1108 
¬g_mode
=
nÜm®


1111 
rg‘
 )

1112 
libobj
="$arg"

1113 
¬g_mode
=
nÜm®


1117 
nÜm®
 )

1118 #Acû± 
ªy
 
commªd
-
lše
 
İtiÚs
.

1119 
$¬g
 
š


1120 -
o
)

1121 
‹¡
 -
n
 "$libobj" && \

1122 
func_çl_”rÜ
 "you cannot specify \`-o' morehan once"

1123 
¬g_mode
=
rg‘


1127 -
p›
 | -
å›
 | -
fPIE
)

1128 
p›_æag
="$pie_flag $arg"

1132 -
sh¬ed
 | -| -
´eãr
-
pic
 | -´eãr-
nÚ
-pic)

1133 
Ï‹r
="$later $arg"

1137 -
no
-
suµ»ss
)

1138 
suµ»ss_İt
=
no


1142 -
Xcomp”
)

1143 
¬g_mode
=
¬g
 #th
Ãxt
 
Úe
 
gÛs
 
što
 
the
 "ba£_compe"‡rg 
li¡


1144  #Th
cu¼’t
 "¤cfe" 
wl
 
e™h”
 
be
 
»šed
 
Ü


1145 ;; #»¶aûd 
Ï‹r
. 
I
 
would
 
guess
 
th©
 would 
be
 
a
 
bug
.

1147 -
Wc
,*)

1148 
func_¡rÇme
 '-Wc,' '' "$arg"

1149 
¬gs
=
$func_¡rÇme_»suÉ


1150 
Ï¡¬g
=

1151 
§ve_ifs
="$IFS"; 
IFS
=','

1152 
¬g
 
š
 
$¬gs
; do

1153 
IFS
="$save_ifs"

1154 
func_quÙe_fÜ_ev®
 "$arg"

1155 
Ï¡¬g
="$lastarg $func_quote_for_eval_result"

1156 
dÚe


1157 
IFS
="$save_ifs"

1158 
func_¡rÇme
 ' ' '' "$lastarg"

1159 
Ï¡¬g
=
$func_¡rÇme_»suÉ


1161 #Add 
the
 
¬gum’ts
 
to
 
ba£_compe
.

1162 
ba£_compe
="$base_compile $lastarg"

1167 #Acû± 
the
 
cu¼’t
 
¬gum’t
 
as
h
sourû
 
fe
.

1168 #Th
´evious
 "¤cfe" 
becomes
 
the
 
cu¼’t
 
¬gum’t
.

1169 #
="$¤cfe"

1170 
¤cfe
="$arg"

1172 
e§c
 #ÿ£ 
$¬g


1174 
e§c
 #ÿ£ 
$¬g_mode


1176 #Ae¡h‘iÿÎy 
quÙe
 
the
 
´evious
 
¬gum’t
.

1177 
func_quÙe_fÜ_ev®
 "$lastarg"

1178 
ba£_compe
="$base_compile $func_quote_for_eval_result"

1179 
dÚe
 #fÜ 
¬g


1181 
$¬g_mode
 
š


1182 
¬g
)

1183 
func_çl_”rÜ
 "you must specify‡n‡rgument for -Xcompile"

1185 
rg‘
)

1186 
func_çl_”rÜ
 "you must specify‡arget with \`-o'"

1189 #G‘ 
the
 
Çme
 
of
h
lib¿ry
 
objeù
.

1190 
‹¡
 -
z
 "$libobj" && {

1191 
func_ba£Çme
 "$srcfile"

1192 
libobj
="$func_basename_result"

1195 
e§c


1197 #Recogniz
£v”®
 
difã»Á
 
fe
 
suffixes
.

1198 #Ià
the
 
u£r
 
¥ecif›s
 -
o
 
fe
.o, 
™
 
is
 
»¶aûd
 
w™h
 fe.
lo


1199 
$libobj
 
š


1200 *.[
cCFSifmso
] | \

1201 *.
ada
 | *.
adb
 | *.
ads
 | *.
asm
 | \

1202 *.
c
++ | *.
cc
 | *.
ii
 | *.
şass
 | *.
ıp
 | *.
cxx
 | \

1203 *.[
fF
][09]? | *.| *.
java
 | *.
obj
 | *.
sx
)

1204 
func_xfÜm
 "$libobj"

1205 
libobj
=
$func_xfÜm_»suÉ


1207 
e§c


1209 
$libobj
 
š


1210 *.
lo
è
func_lo2o
 "$libobj"; 
obj
=
$func_lo2o_»suÉ
 ;;

1212 
func_çl_”rÜ
 "cannot determine‚ame of†ibrary object from \`$libobj'"

1214 
e§c


1216 
func_šãr_g
 
$ba£_compe


1218 
¬g
 
š
 
$Ï‹r
; do

1219 
$¬g
 
š


1220 -
sh¬ed
)

1221 
‹¡
 "$bud_libtoŞ_libs" !ğ
yes
 && \

1222 
func_çl_cÚfigu¿tiÚ
 "can‚ot build‡ shared†ibrary"

1223 
bud_Şd_libs
=
no


1228 
bud_libtoŞ_libs
=
no


1229 
bud_Şd_libs
=
yes


1233 -
´eãr
-
pic
)

1234 
pic_mode
=
yes


1238 -
´eãr
-
nÚ
-
pic
)

1239 
pic_mode
=
no


1242 
e§c


1243 
dÚe


1245 
func_quÙe_fÜ_ev®
 "$libobj"

1246 
‹¡
 "X$libobj" != "X$func_quote_for_eval_result" \

1247 && 
$ECHO
 "X$libobj" | 
$GREP
 '[]~#^*{};<>?"'"'"' &()|`$[]' \

1248 && 
func_w¬nšg
 "libobj‚ame \`$libobj' may‚ot contain shell special characters."

1249 
func_dœÇme_ªd_ba£Çme
 "$obj" "/" ""

1250 
objÇme
="$func_basename_result"

1251 
xdœ
="$func_dirname_result"

1252 
lobj
=
$
{
xdœ
}
$objdœ
/
$objÇme


1254 
‹¡
 -
z
 "$base_compile" && \

1255 
func_çl_h–p
 "you must specify‡ compilation command"

1257 #D–‘
ªy
 
Ëáov”
 
lib¿ry
 
objeùs
.

1258 
‹¡
 "$bud_Şd_libs" = 
yes
; 
th’


1259 
»mov–i¡
="$obj $lobj $libobj ${libobj}T"

1261 
»mov–i¡
="$lobj $libobj ${libobj}T"

1262 
fi


1264 #OÀ
Cygwš
 
th”e
's‚o "real" PIC flag so we must build both objectypes

1265 
$ho¡_os
 
š


1266 
cygwš
* | 
mšgw
* | 
pw32
* | 
os2
* | 
ûgcc
*)

1267 
pic_mode
=

1269 
e§c


1270 
‹¡
 "$pic_mode" = 
no
 &&e¡ "$d•libs_check_m‘hod" !ğ
·ss_®l
; 
th’


1271 #nÚ-
PIC
 
code
 
š
 
sh¬ed
 
lib¿r›s
 
is
 
nÙ
 
suµÜ‹d


1272 
pic_mode
=

1273 
fi


1275 #C®cuÏ‹ 
the
 
f’ame
 
of
h
ouut
 
objeù
 
comp”
 
dÛs


1276 #nÙ 
suµÜt
 -
o
 
w™h
 -
c


1277 
‹¡
 "$comp”_c_o" = 
no
; 
th’


1278 
ouut_obj
=`
$ECHO
 "X$¤cfe" | 
$X£d
 -
e
 's%^.*/%%' -'s%\.[^.]*$%%'`.
$
{
objext
}

1279 
lockfe
="$output_obj.lock"

1281 
ouut_obj
=

1282 
Ãed_locks
=
no


1283 
lockfe
=

1284 
fi


1286 #Lock 
this
 
ü™iÿl
 
£ùiÚ
 
™
 
is
 
Ãeded


1287 #W
u£
 
this
 
süt
 
fe
 
to
 
make
 
the
 
lšk
, 
™
 
avoids
 
ü—tšg
 
a
 
Ãw
 file

1288 
‹¡
 "$Ãed_locks" = 
yes
; 
th’


1289 
uÁ
 
$İt_dry_run
 || 
Ê
 "$´og·th" "$lockfe" 2>/
dev
/
nuÎ
; do

1290 
func_echo
 "Waiting for $lockfileo be„emoved"

1291 
¦“p
 2

1292 
dÚe


1293 
–if
 
‹¡
 "$Ãed_locks" = 
w¬n
; 
th’


1294 
‹¡
 -
f
 "$lockfe"; 
th’


1295 
$ECHO
 "\
*** ERROR, $lockfileƒxists‡nd contains:

1297 `
ÿt
 
$lockfe
 2>/
dev
/
nuÎ
`

1299 
This
 
šdiÿ‹s
 
th©
 
ªÙh”
 
´oûss
 
is
 
Œyšg
 
to
 
u£
 
the
 
§me


1300 
‹mpÜ¬y
 
objeù
 
fe
, 
ªd
 
libtoŞ
 
could
 
nÙ
 
wÜk
 
¬ound
 
™
 
beÿu£


1301 
your
 
comp”
 
dÛs
 
nÙ
 
suµÜt
 \`-
c
'‡nd \`-o' 
tog‘h”
. 
If
 
you


1302 
»³©
 
this
 
comp©iÚ
, 
™
 
may
 
sucûed
, 
by
 
chªû
, 
but
 
you
 
had
 
b‘‹r


1303 
avoid
 
·¿Î–
 
	`buds
 (
make
 -
j
è
š
 
this
 
¶©fÜm
, 
Ü
 
g‘
 
a
 
b‘‹r


1304 
comp”
."

1306 
$İt_dry_run
 || 
$RM
 
$»mov–i¡


1307 
ex™
 
$EXIT_FAILURE


1308 
fi


1309 
»mov–i¡
="$removelist $output_obj"

1310 
$ECHO
 "$srcfile" > "$lockfile"

1311 
fi


1313 
$İt_dry_run
 || 
$RM
 
$»mov–i¡


1314 
»mov–i¡
="$removelist $lockfile"

1315 
Œ­
 '$opt_dry_run || $RM $removelist;ƒxit $EXIT_FAILURE' 1 2 15

1317 
‹¡
 -
n
 "$fix_¤cfe_·th"; 
th’


1318 
ev®
 
¤cfe
=\"$fix_srcfile_path\"

1319 
fi


1320 
func_quÙe_fÜ_ev®
 "$srcfile"

1321 
q¤cfe
=
$func_quÙe_fÜ_ev®_»suÉ


1323 #OÆy 
bud
 
a
 
PIC
 
objeù
 
we
 
¬e
 
budšg
 
libtoŞ
 
lib¿r›s
.

1324 
‹¡
 "$bud_libtoŞ_libs" = 
yes
; 
th’


1325 #W™houˆ
this
 
assignm’t
, 
ba£_compe
 
g‘s
 
em±›d
.

1326 
fbsd_hideous_sh_bug
=
$ba£_compe


1328 
‹¡
 "$pic_mode" !ğ
no
; 
th’


1329 
commªd
="$base_compile $qsrcfile $pic_flag"

1332 
commªd
="$base_compile $qsrcfile"

1333 
fi


1335 
func_mkdœ_p
 "$xdir$objdir"

1337 
‹¡
 -
z
 "$ouut_obj"; 
th’


1338 #PÏû 
PIC
 
objeùs
 
š
 
$objdœ


1339 
commªd
="$command -o $lobj"

1340 
fi


1342 
func_show_ev®_loÿË
 "$command" \

1345 
‹¡
 "$Ãed_locks" = 
w¬n
 &&

1346 
‹¡
 "X`ÿˆ$lockf2>/dev/nuÎ`" !ğ"X$¤cfe"; 
th’


1347 
$ECHO
 "\
*** ERROR, $lockfile contains:

1349 `
ÿt
 
$lockfe
 2>/
dev
/
nuÎ
`

1351 
but
 
™
 
should
 
cÚš
:

1352 
$¤cfe


1354 
This
 
šdiÿ‹s
 
th©
 
ªÙh”
 
´oûss
 
is
 
Œyšg
 
to
 
u£
 
the
 
§me


1355 
‹mpÜ¬y
 
objeù
 
fe
, 
ªd
 
libtoŞ
 
could
 
nÙ
 
wÜk
 
¬ound
 
™
 
beÿu£


1356 
your
 
comp”
 
dÛs
 
nÙ
 
suµÜt
 \`-
c
'‡nd \`-o' 
tog‘h”
. 
If
 
you


1357 
»³©
 
this
 
comp©iÚ
, 
™
 
may
 
sucûed
, 
by
 
chªû
, 
but
 
you
 
had
 
b‘‹r


1358 
avoid
 
·¿Î–
 
	`buds
 (
make
 -
j
è
š
 
this
 
¶©fÜm
, 
Ü
 
g‘
 
a
 
b‘‹r


1359 
comp”
."

1361 
$İt_dry_run
 || 
$RM
 
$»mov–i¡


1362 
ex™
 
$EXIT_FAILURE


1363 
fi


1365 #Ju¡ 
move
 
the
 
objeù
 
Ãeded
, 
th’
 
go
 
Ú
 
to
 
compe
h
Ãxt
 
Úe


1366 
‹¡
 -
n
 "$ouut_obj" &&e¡ "X$ouut_obj" !ğ"X$lobj"; 
th’


1367 
func_show_ev®
 '$MV "$output_obj" "$lobj"' \

1369 
fi


1371 #AÎow 
”rÜ
 
mes§ges
 
Úly
 
äom
 
the
 
fœ¡
 
comp©iÚ
.

1372 
‹¡
 "$suµ»ss_İt" = 
yes
; 
th’


1373 
suµ»ss_ouut
=' >/dev/null 2>&1'

1374 
fi


1375 
fi


1377 #OÆy 
bud
 
a
 
pos™iÚ
-
d•’d’t
 
objeù
 
we
 bud 
Şd
 
lib¿r›s
.

1378 
‹¡
 "$bud_Şd_libs" = 
yes
; 
th’


1379 
‹¡
 "$pic_mode" !ğ
yes
; 
th’


1381 
commªd
="$base_compile $qsrcfile$pie_flag"

1383 
commªd
="$base_compile $qsrcfile $pic_flag"

1384 
fi


1385 
‹¡
 "$comp”_c_o" = 
yes
; 
th’


1386 
commªd
="$command -o $obj"

1387 
fi


1389 #Suµ»s 
comp”
 
ouut
 
we
 
®»ady
 
did
 
a
 
PIC
 
comp©iÚ
.

1390 
commªd
="$command$suppress_output"

1391 
func_show_ev®_loÿË
 "$command" \

1394 
‹¡
 "$Ãed_locks" = 
w¬n
 &&

1395 
‹¡
 "X`ÿˆ$lockf2>/dev/nuÎ`" !ğ"X$¤cfe"; 
th’


1396 
$ECHO
 "\
*** ERROR, $lockfile contains:

1398 `
ÿt
 
$lockfe
 2>/
dev
/
nuÎ
`

1400 
but
 
™
 
should
 
cÚš
:

1401 
$¤cfe


1403 
This
 
šdiÿ‹s
 
th©
 
ªÙh”
 
´oûss
 
is
 
Œyšg
 
to
 
u£
 
the
 
§me


1404 
‹mpÜ¬y
 
objeù
 
fe
, 
ªd
 
libtoŞ
 
could
 
nÙ
 
wÜk
 
¬ound
 
™
 
beÿu£


1405 
your
 
comp”
 
dÛs
 
nÙ
 
suµÜt
 \`-
c
'‡nd \`-o' 
tog‘h”
. 
If
 
you


1406 
»³©
 
this
 
comp©iÚ
, 
™
 
may
 
sucûed
, 
by
 
chªû
, 
but
 
you
 
had
 
b‘‹r


1407 
avoid
 
·¿Î–
 
	`buds
 (
make
 -
j
è
š
 
this
 
¶©fÜm
, 
Ü
 
g‘
 
a
 
b‘‹r


1408 
comp”
."

1410 
$İt_dry_run
 || 
$RM
 
$»mov–i¡


1411 
ex™
 
$EXIT_FAILURE


1412 
fi


1414 #Ju¡ 
move
 
the
 
objeù
 
Ãeded


1415 
‹¡
 -
n
 "$ouut_obj" &&e¡ "X$ouut_obj" !ğ"X$obj"; 
th’


1416 
func_show_ev®
 '$MV "$output_obj" "$obj"' \

1418 
fi


1419 
fi


1421 
$İt_dry_run
 || {

1422 
func_wr™e_libtoŞ_objeù
 "$libobj" "$objdir/$objname" "$objname"

1424 #UÆock 
the
 
ü™iÿl
 
£ùiÚ
 
™
 
was
 
locked


1425 
‹¡
 "$Ãed_locks" !ğ
no
; 
th’


1426 
»mov–i¡
=
$lockfe


1427 
$RM
 "$lockfile"

1428 
fi


1431 
ex™
 
$EXIT_SUCCESS


1432 
	}
}

1434 
	g$İt_h–p
 || {

1435 
	g‹¡
 "$mode" = 
compe
 && 
func_mode_compe
 
$
{1+"$@"}

1438 
	$func_mode_h–p
 ()

1440 #W
Ãed
 
to
 
di¥Ïy
 
h–p
 
—ch
 
of
 
the
 
modes
.

1441 
$mode
 
š


1443 #G’”iø
h–p
 
is
 
exŒaùed
 
äom
 
the
 
u§ge
 
comm’ts


1444 #© 
the
 
¡¬t
 
of
 
this
 
fe
.

1445 
func_h–p


1448 
ş—n
)

1449 
$ECHO
 \

1452 
Remove
 
fes
 
äom
 
the
 
bud
 
dœeùÜy
.

1454 
RM
 
is
 
the
 
Çme
 
of
h
´og¿m
 
to
 
u£
Ø
d–‘e
 
fes
 
assocŸ‹d
 
w™h
 
—ch
 
FILE


1455 (
typiÿÎy
 \`/
bš
/
rm
'). RM-OPTIONS‡» o±iÚ (such‡ \`-f'è
to
 
be
 
·s£d


1456 
to
 
RM
.

1458 
If
 
FILE
 
is
 
a
 
libtoŞ
 
lib¿ry
, 
objeù
 
Ü
 
´og¿m
, 
®l
 
the
 
fes
 
assocŸ‹d


1459 
w™h
 
™
 
¬e
 
d–‘ed
. 
Oth”wi£
, 
Úly
 
FILE
 
™£lf
 
is
 d–‘ed 
usšg
 
RM
."

1462 
compe
)

1463 
$ECHO
 \

1466 
Compe
 
a
 
sourû
 
fe
 
što
‡ 
libtoŞ
 
lib¿ry
 
objeù
.

1468 
This
 
mode
 
acû±s
 
the
 
fŞlowšg
 
add™iÚ®
 
İtiÚs
:

1470 -
o
 
OUTPUT
-
FILE
 
£t
 
the
 
ouut
 
fe
 
Çme
 
to
 OUTPUT-FILE

1471 -
no
-
suµ»ss
 dØ
nÙ
 suµ»s 
comp”
 
ouut
 
muÉË
 
·s£s


1472 -
´eãr
-
pic
 
Œy
 
to
 
budšg
 
PIC
 
objeùs
 
Úly


1473 -
´eãr
-
nÚ
-
pic
 
Œy
 
to
 
budšg
‚Ú-
PIC
 
objeùs
 
Úly


1474 -
sh¬ed
 dØ
nÙ
 
bud
 
a
 \`.
o
' file suitable for static†inking

1475 -
Úly
 
bud
 
a
 \`.
o
' file suitable for static†inking

1477 
COMPILE
-
COMMAND
 
is
 
a
 
commªd
 
to
 
be
 
u£d
 
š
 
ü—tšg
‡ \`
¡ªd¬d
' object file

1478 
äom
 
the
 
giv’
 
SOURCEFILE
.

1480 
The
 
ouut
 
fe
 
Çme
 
is
 
d‘”mšed
 
by
 
»movšg
 
the
 
dœeùÜy
 
compÚ’t
 
äom


1481 
SOURCEFILE
, 
th’
 
sub¡™utšg
 
the
 
C
 
sourû
 
code
 
suffix
 \`.
c
' withhe

1482 
lib¿ry
 
objeù
 
suffix
, \`.
lo
'."

1485 
execu‹
)

1486 
$ECHO
 \

1489 
Autom©iÿÎy
 
£t
 
lib¿ry
 
·th
, 
th’
 
run
 
a
 
´og¿m
.

1491 
This
 
mode
 
acû±s
 
the
 
fŞlowšg
 
add™iÚ®
 
İtiÚs
:

1493 -
dlİ’
 
FILE
 
add
 
the
 
dœeùÜy
 
cÚššg
 FILE 
to
h
lib¿ry
 
·th


1495 
This
 
mode
 
£ts
 
the
 
lib¿ry
 
·th
 
’vœÚm’t
 
v¬ŸbË
 
accÜdšg
 
to
 \`-
dlİ’
'

1496 
æags
.

1498 
If
 
ªy
 
of
 
the
 
ARGS
 
¬e
 
libtoŞ
 
execubË
 
w¿µ”s
, 
th’
 
they
‡» 
Œª¦©ed


1499 
što
 
theœ
 
cÜ»¥Údšg
 
unš¡®Ëd
 
bš¬y
, 
ªd
 
ªy
 
of
heœ 
»quœed
 
lib¿ry


1500 
dœeùÜ›s
 
¬e
 
added
 
to
 
the
 
lib¿ry
 
·th
.

1502 
Th’
, 
COMMAND
 
is
 
execu‹d
, 
w™h
 
ARGS
 
as
 
¬gum’ts
."

1505 
fšish
)

1506 
$ECHO
 \

1509 
Com¶‘e
 
the
 
š¡®ÏtiÚ
 
of
 
libtoŞ
 
lib¿r›s
.

1511 
Each
 
LIBDIR
 
is
 
a
 
dœeùÜy
 
th©
 
cÚšs
 
libtoŞ
 
lib¿r›s
.

1513 
The
 
commªds
 
th©
 
this
 
mode
 
execu‹s
 
may
 
»quœe
 
su³ru£r
 
´iveges
. 
U£


1514 
the
 \`--
dry
-
run
' option if you just wanto see what would beƒxecuted."

1517 
š¡®l
)

1518 
$ECHO
 \

1521 
In¡®l
 
execubËs
 
Ü
 
lib¿r›s
.

1523 
INSTALL
-
COMMAND
 
is
 
the
 
š¡®ÏtiÚ
 
commªd
. 
The
 
fœ¡
 
compÚ’t
 
should
 
be


1524 
e™h”
 
the
 \`
š¡®l
' o¸\`ı' 
´og¿m
.

1526 
The
 
fŞlowšg
 
compÚ’ts
 
of
 
INSTALL
-
COMMAND
 
¬e
 
Œ—‹d
 
¥ecŸÎy
:

1528 -
š¡
-
´efix
 
PREFIX
-
DIR
 
U£
 PREFIX-DIR 
as
 
a
 
¡agšg
 
¬—
 
š¡®ÏtiÚ


1530 
The
 
»¡
 
of
 
the
 
compÚ’ts
 
¬e
 
š‹½»‹d
 
as
 
¬gum’ts
 
to
 
th©
 
	`commªd
 (
Úly


1531 
BSD
-
com·tibË
 
š¡®l
 
İtiÚs
 
¬e
 
»cognized
)."

1534 
lšk
)

1535 
$ECHO
 \

1538 
Lšk
 
objeù
 
fes
 
Ü
 
lib¿r›s
 
tog‘h”
 
to
 
fÜm
 
ªÙh”
 
lib¿ry
, oro

1539 
ü—‹
 
ª
 
execubË
 
´og¿m
.

1541 
LINK
-
COMMAND
 
is
 
a
 
commªd
 
usšg
 
the
 
C
 
comp”
 
th©
 
you
 
would
 
u£
 
to
 
ü—‹


1542 
a
 
´og¿m
 
äom
 
£v”®
 
objeù
 
fes
.

1544 
The
 
fŞlowšg
 
compÚ’ts
 
of
 
LINK
-
COMMAND
 
¬e
 
Œ—‹d
 
¥ecŸÎy
:

1546 -
®l
-dØ
nÙ
 dØ
ªy
 
dyÇmic
 
lškšg
 
©
‡ll

1547 -
avoid
-
v”siÚ
 dØ
nÙ
 
add
 
a
 v”siÚ 
suffix
 
possibË


1548 -
dlİ’
 
FILE
 \`-
dÍ»İ’
' FILE if it cannot be dlopened‡t„untime

1549 -
dÍ»İ’
 
FILE
 
lšk
 
š
 FILE 
ªd
 
add
 
™s
 
symbŞs
 
to
 
É_´–ßded_symbŞs


1550 -
expÜt
-
dyÇmic
 
®low
 
symbŞs
 
äom
 
OUTPUT
-
FILE
 
to
 
be
 
»sŞved
 
w™h
 
	`dlsym
(3)

1551 -
expÜt
-
symbŞs
 
SYMFILE


1552 
Œy
 
to
 
expÜt
 
Úly
 
the
 
symbŞs
 
li¡ed
 
š
 
SYMFILE


1553 -
expÜt
-
symbŞs
-
»gex
 
REGEX


1554 
Œy
 
to
 
expÜt
 
Úly
 
the
 
symbŞs
 
m©chšg
 
REGEX


1555 -
LLIBDIR
 
£¬ch
 
LIBDIR
 
»quœed
 
š¡®Ëd
 
lib¿r›s


1556 -
lNAME
 
OUTPUT
-
FILE
 
»quœes
 
the
 
š¡®Ëd
 
lib¿ry
 
libNAME


1557 -
moduË
 
bud
 
a
 
lib¿ry
 
th©
 
ÿn
 
dlİ’ed


1558 -
no
-
ç¡
-
š¡®l
 
di§bË
 
the
 fa¡-š¡®È
mode


1559 -
no
-
š¡®l
 
lšk
 
a
 
nÙ
-
š¡®ÏbË
 
execubË


1560 -
no
-
undefšed
 
deş¬e
 
th©
 
a
 
lib¿ry
 
dÛs
 
nÙ
 
»ãr
 
to
 
ex‹º®
 
symbŞs


1561 -
o
 
OUTPUT
-
FILE
 
ü—‹
 OUTPUT-FILE 
äom
 
the
 
¥ecif›d
 
objeùs


1562 -
objeùli¡
 
FILE
 
U£
 
a
 
li¡
 
of
 
objeù
 
fes
 
found
 
š
 FILE 
to
 
¥ecify
 
objeùs


1563 -
´ecious
-
fes
-
»gex
 
REGEX


1564 
dÚ
't„emove output files matching REGEX

1565 -
»Ëa£
 
RELEASE
 
¥ecify
 
·ckage
„–—£ 
šfÜm©iÚ


1566 -
½©h
 
LIBDIR
 
the
 
ü—‹d
 
lib¿ry
 
wl
 
ev’tu®ly
 
be
 
š¡®Ëd
 
š
 LIBDIR

1567 -
R
[ ]
LIBDIR
 
add
 LIBDIR 
to
 
the
 
ruÁime
 
·th
 
of
 
´og¿ms
 
ªd
 
lib¿r›s


1568 -
sh¬ed
 
Úly
 dØ
dyÇmic
 
lškšg
 
of
 
libtoŞ
 
lib¿r›s


1569 -
sh»xt
 
SUFFIX
 
ov”ride
 
the
 
¡ªd¬d
 
sh¬ed
 
lib¿ry
 
fe
 
ex‹nsiÚ


1570 -dØ
nÙ
 dØ
ªy
 
dyÇmic
 
lškšg
 
of
 
unš¡®Ëd
 
libtoŞ
 
lib¿r›s


1571 --
libtoŞ
-
libs


1572 dØ
nÙ
 dØ
ªy
 
dyÇmic
 
lškšg
 
of
 
libtoŞ
 
lib¿r›s


1573 -
v”siÚ
-
šfo
 
CURRENT
[:
REVISION
[:
AGE
]]

1574 
¥ecify
 
lib¿ry
 
v”siÚ
 
šfo
 [
—ch
 
v¬ŸbË
 
deçuÉs
 
to
 0]

1575 -
w—k
 
LIBNAME
 
deş¬e
 
th©
 
the
 
rg‘
 
´ovides
hLIBNAME 
š‹rçû


1577 
AÎ
 
Ùh”
 
	`İtiÚs
 (
¬gum’ts
 
begšnšg
 
w™h
 \`-')‡re ignored.

1579 
Ev”y
 
Ùh”
 
¬gum’t
 
is
 
Œ—‹d
 
as
 
a
 
f’ame
. 
Fes
 
’dšg
 
š
 \`.
Ï
'‡re

1580 
Œ—‹d
 
as
 
unš¡®Ëd
 
libtoŞ
 
lib¿r›s
, 
Ùh”
 
fes
 
¬e
 
¡ªd¬d
 
Ü
 
lib¿ry


1581 
objeù
 
fes
.

1583 
If
 
the
 
OUTPUT
-
FILE
 
’ds
 
š
 \`.
Ï
',hen‡†ibtool†ibrary is created,

1584 
Úly
 
lib¿ry
 
	`objeùs
 (\`.
lo
' fesèmay b¥ecif›d,‡nd \`-½©h' 
is


1585 
»quœed
, 
exû±
 
wh’
 
ü—tšg
 
a
 
cÚv’›nû
 
lib¿ry
.

1587 
If
 
OUTPUT
-
FILE
 
’ds
 
š
 \`.
a
' o¸\`.lib', 
th’
‡ 
¡ªd¬d
 
lib¿ry
 
is
 
ü—‹d


1588 
usšg
 \`
¬
'‡nd \`¿Æib', 
Ü
 
Ú
 
Wšdows
 usšg \`
lib
'.

1590 
If
 
OUTPUT
-
FILE
 
’ds
 
š
 \`.
lo
' o¸\`.${objext}', 
th’
 
a
 
»lßdabË
 
objeù
 
fe


1591 
is
 
ü—‹d
, 
Ùh”wi£
 
ª
 
execubË
 
´og¿m
 is created."

1594 
unš¡®l
)

1595 
$ECHO
 \

1598 
Remove
 
lib¿r›s
 
äom
 
ª
 
š¡®ÏtiÚ
 
dœeùÜy
.

1600 
RM
 
is
 
the
 
Çme
 
of
h
´og¿m
 
to
 
u£
Ø
d–‘e
 
fes
 
assocŸ‹d
 
w™h
 
—ch
 
FILE


1601 (
typiÿÎy
 \`/
bš
/
rm
'). RM-OPTIONS‡» o±iÚ (such‡ \`-f'è
to
 
be
 
·s£d


1602 
to
 
RM
.

1604 
If
 
FILE
 
is
 
a
 
libtoŞ
 
lib¿ry
, 
®l
 
the
 
fes
 
assocŸ‹d
 
w™h
 
™
 
¬e
 
d–‘ed
.

1605 
Oth”wi£
, 
Úly
 
FILE
 
™£lf
 
is
 
d–‘ed
 
usšg
 
RM
."

1609 
func_çl_h–p
 "invalid operation mode \`$mode'"

1611 
e§c


1613 
$ECHO


1614 
$ECHO
 "Try \`$progname --help' for more information‡bout other modes."

1616 
ex™
 
$
?

1617 
	}
}

1619 #Now 
th©
 
we
've collected‡…ossible --mode‡rg, show help if‚ecessary

1620 
	g$İt_h–p
 && 
	gfunc_mode_h–p


1623 #func_mode_execu‹ 
¬g
...

1624 
	$func_mode_execu‹
 ()

1626 
$İt_debug


1627 #Th
fœ¡
 
¬gum’t
 
is
 
the
 
commªd
 
Çme
.

1628 
cmd
="$nonopt"

1629 
‹¡
 -
z
 "$cmd" && \

1630 
func_çl_h–p
 "you must specify‡ COMMAND"

1632 #HªdË -
dlİ’
 
æags
 
immedŸ‹ly
.

1633 
fe
 
š
 
$execu‹_dlfes
; do

1634 
‹¡
 -
f
 "$file" \

1635 || 
func_çl_h–p
 "\`$file' is‚ot‡ file"

1637 
dœ
=

1638 
$fe
 
š


1639 *.
Ï
)

1640 #Check 
to
 
£e
 
th©
 
this
 
»®ly
 
is
 
a
 
libtoŞ
 
¬chive
.

1641 
func_Ïlib_un§ã_p
 "$file" \

1642 || 
func_çl_h–p
 "\`$lib' is‚ot‡ valid†ibtool‡rchive"

1644 #R—d 
the
 
libtoŞ
 
lib¿ry
.

1645 
dÊame
=

1646 
lib¿ry_Çmes
=

1647 
func_sourû
 "$file"

1649 #Sk 
this
 
lib¿ry
 
™
 
ÿÂÙ
 
be
 
dlİ’ed
.

1650 
‹¡
 -
z
 "$dÊame"; 
th’


1651 #W¬À
™
 
was
 
a
 
sh¬ed
 
lib¿ry
.

1652 
‹¡
 -
n
 "$library_names" && \

1653 
func_w¬nšg
 "\`$file' was‚ot†inked with \`-export-dynamic'"

1655 
fi


1657 
func_dœÇme
 "$file" "" "."

1658 
dœ
="$func_dirname_result"

1660 
‹¡
 -
f
 "$dœ/$objdœ/$dÊame"; 
th’


1661 
dœ
="$dir/$objdir"

1663 
‹¡
 ! -
f
 "$dœ/$dÊame"; 
th’


1664 
func_çl_”rÜ
 "cannot find \`$dlname' in \`$dir' or \`$dir/$objdir'"

1665 
fi


1666 
fi


1669 *.
lo
)

1670 #Ju¡ 
add
 
the
 
dœeùÜy
 
cÚššg
h.
lo
 
fe
.

1671 
func_dœÇme
 "$file" "" "."

1672 
dœ
="$func_dirname_result"

1676 
func_w¬nšg
 "\`-dlopen' is ignored for‚on-libtool†ibraries‡nd objects"

1679 
e§c


1681 #G‘ 
the
 
absŞu‹
 
·thÇme
.

1682 
absdœ
=`
cd
 "$dœ" && 
pwd
`

1683 
‹¡
 -
n
 "$absdœ" && 
dœ
="$absdir"

1685 #Now 
add
 
the
 
dœeùÜy
 
to
 
shlib·th_v¬
.

1686 
ev®
 "‹¡ -z \"\$$shlib·th_v¬\""; 
th’


1687 
ev®
 "$shlibpath_var=\"\$dir\""

1689 
ev®
 "$shlibpath_var=\"\$dir:\$$shlibpath_var\""

1690 
fi


1691 
dÚe


1693 #Thi 
v¬ŸbË
 
‹Îs
 
w¿µ”
 
süts
 
ju¡
 
to
 
£t
 
shlib·th_v¬


1694 #¿th” 
thª
 
ruÂšg
 
theœ
 
´og¿ms
.

1695 
libtoŞ_execu‹_magic
="$magic"

1697 #Check 
ªy
 
of
 
the
 
¬gum’ts
 
is
 
a
 
w¿µ”
 
süt
.

1698 
¬gs
=

1699 
fe


1701 
$fe
 
š


1704 #DØ
a
 
‹¡
 
to
 
£e
 
this
 
is
 
»®ly
‡ 
libtoŞ
 
´og¿m
.

1705 
func_Éw¿µ”_süt_p
 "$fe"; 
th’


1706 
func_sourû
 "$file"

1707 #T¿nsfÜm 
¬g
 
to
 
w¿µed
 
Çme
.

1708 
fe
="$progdir/$program"

1709 
–if
 
func_Éw¿µ”_execubË_p
 "$fe"; 
th’


1710 
func_Éw¿µ”_süŠame
 "$file"

1711 
func_sourû
 "$func_ltwrapper_scriptname_result"

1712 #T¿nsfÜm 
¬g
 
to
 
w¿µed
 
Çme
.

1713 
fe
="$progdir/$program"

1714 
fi


1716 
e§c


1717 #QuÙ
	`¬gum’ts
 (
to
 
´e£rve
 
sh–l
 
m‘ach¬aù”s
).

1718 
func_quÙe_fÜ_ev®
 "$file"

1719 
¬gs
="$args $func_quote_for_eval_result"

1720 
dÚe


1722 
‹¡
 "X$İt_dry_run" = 
Xçl£
; 
th’


1723 
‹¡
 -
n
 "$shlib·th_v¬"; 
th’


1724 #ExpÜˆ
the
 
shlib·th_v¬
.

1725 
ev®
 "export $shlibpath_var"

1726 
fi


1728 #Re¡Ü
§ved
 
’vœÚm’t
 
v¬ŸbËs


1729 
É_v¬
 
š
 
LANG
 
LANGUAGE
 
LC_ALL
 
LC_CTYPE
 
LC_COLLATE
 
LC_MESSAGES


1731 
ev®
 "ifest \"\${save_$lt_var+set}\" = set;hen

1732 
$É_v¬
=\
$§ve_$É_v¬
; 
expÜt
 $lt_var

1734 
$É_un£t
 
$É_v¬


1735 
fi
"

1736 
dÚe


1738 #Now 
´•¬e
 
to
 
aùu®ly
 
exec
 
the
 
commªd
.

1739 
exec_cmd
="\$cmd$args"

1741 #Di¥Ïy 
wh©
 
would
 
be
 
dÚe
.

1742 
‹¡
 -
n
 "$shlib·th_v¬"; 
th’


1743 
ev®
 "\$ECHO \"\$shlibpath_var=\$$shlibpath_var\""

1744 
$ECHO
 "export $shlibpath_var"

1745 
fi


1746 
$ECHO
 "$cmd$args"

1747 
ex™
 
$EXIT_SUCCESS


1748 
fi


1749 
	}
}

1751 
	g‹¡
 "$mode" = 
execu‹
 && 
func_mode_execu‹
 
$
{1+"$@"}

1754 #func_mode_fšish 
¬g
...

1755 
	$func_mode_fšish
 ()

1757 
$İt_debug


1758 
libdœs
="$nonopt"

1759 
admšcmds
=

1761 
‹¡
 -
n
 "$fšish_cmds$fšish_ev®" &&e¡ -À"$libdœs"; 
th’


1762 
dœ


1764 
libdœs
="$libdirs $dir"

1765 
dÚe


1767 
libdœ
 
š
 
$libdœs
; do

1768 
‹¡
 -
n
 "$fšish_cmds"; 
th’


1769 #DØ
—ch
 
commªd
 
š
 
the
 
fšish
 
commªds
.

1770 
func_execu‹_cmds
 "$finish_cmds" 'admincmds="$admincmds

1772 
fi


1773 
‹¡
 -
n
 "$fšish_ev®"; 
th’


1774 #DØ
the
 
sšgË
 
fšish_ev®
.

1775 
ev®
 
cmds
=\"$finish_eval\"

1776 
$İt_dry_run
 || 
ev®
 "$cmds" || 
admšcmds
="$admincmds

1777 
$cmds
"

1778 
fi


1779 
dÚe


1780 
fi


1782 #Ex™ 
h”e
 
they
 
wª‹d
 
s’t
 
mode
.

1783 
$İt_s’t
 && 
ex™
 
$EXIT_SUCCESS


1785 
$ECHO
 "X----------------------------------------------------------------------" | 
$X£d


1786 
$ECHO
 "Libraries have been installed in:"

1787 
libdœ
 
š
 
$libdœs
; do

1788 
$ECHO
 " $libdir"

1789 
dÚe


1790 
$ECHO


1791 
$ECHO
 "If youƒver happeno wanto†ink‡gainst installed†ibraries"

1792 
$ECHO
 "in‡ given directory, LIBDIR, you mustƒither use†ibtool,‡nd"

1793 
$ECHO
 "specifyhe full…athname ofhe†ibrary, or usehe \`-LLIBDIR'"

1794 
$ECHO
 "flag during†inking‡nd do‡t†east one ofhe following:"

1795 
‹¡
 -
n
 "$shlib·th_v¬"; 
th’


1796 
$ECHO
 " -‡dd LIBDIRohe \`$shlibpath_var'ƒnvironment variable"

1797 
$ECHO
 " duringƒxecution"

1798 
fi


1799 
‹¡
 -
n
 "$ruÅ©h_v¬"; 
th’


1800 
$ECHO
 " -‡dd LIBDIRohe \`$runpath_var'ƒnvironment variable"

1801 
$ECHO
 " during†inking"

1802 
fi


1803 
‹¡
 -
n
 "$h¬dcode_libdœ_æag_¥ec"; 
th’


1804 
libdœ
=
LIBDIR


1805 
ev®
 
æag
=\"$hardcode_libdir_flag_spec\"

1807 
$ECHO
 " - usehe \`$flag'†inker flag"

1808 
fi


1809 
‹¡
 -
n
 "$admšcmds"; 
th’


1810 
$ECHO
 " - have your system‡dministrator„unhese commands:$admincmds"

1811 
fi


1812 
‹¡
 -
f
 /
‘c
/
ld
.
so
.
cÚf
; 
th’


1813 
$ECHO
 " - have your system‡dministrator‡dd LIBDIRo \`/etc/ld.so.conf'"

1814 
fi


1815 
$ECHO


1817 
$ECHO
 "See‡ny operating system documentation‡bout shared†ibraries for"

1818 
$ho¡
 
š


1819 
sŞ¬is2
.[6789]|solaris2.1[0-9])

1820 
$ECHO
 "more information, such‡she†d(1), crle(1)‡nd†d.so(8) manual"

1821 
$ECHO
 "pages."

1824 
$ECHO
 "more information, such‡she†d(1)‡nd†d.so(8) manual…ages."

1826 
e§c


1827 
$ECHO
 "X----------------------------------------------------------------------" | 
$X£d


1828 
ex™
 
$EXIT_SUCCESS


1829 
	}
}

1831 
	g‹¡
 "$mode" = 
fšish
 && 
func_mode_fšish
 
$
{1+"$@"}

1834 #func_mode_š¡®È
¬g
...

1835 
	$func_mode_š¡®l
 ()

1837 
$İt_debug


1838 #Th”
may
 
be
 
ª
 
İtiÚ®
 
	`sh
(1è
¬gum’t
 
©
 
the
 
begšnšg
 
of


1839 #š¡®l_´og (
e¥ecŸÎy
 
Ú
 
Wšdows
 
NT
).

1840 
‹¡
 "$nÚİt" = "$SHELL" ||e¡ "$nÚİt" = /
bš
/
sh
 ||

1841 #AÎow 
the
 
u£
 
of
 
GNU
 
shtoŞ
's install command.

1842 
$ECHO
 "X$nÚİt" | 
$GREP
 
shtoŞ
 >/
dev
/
nuÎ
; 
th’


1843 #Ae¡h‘iÿÎy 
quÙe
 
™
.

1844 
func_quÙe_fÜ_ev®
 "$nonopt"

1845 
š¡®l_´og
="$func_quote_for_eval_result "

1846 
¬g
=
$1


1847 
shiá


1849 
š¡®l_´og
=

1850 
¬g
=
$nÚİt


1851 
fi


1853 #Th
»®
 
fœ¡
 
¬gum’t
 
should
 
be
 
the
 
Çme
 
of
h
š¡®ÏtiÚ
 
´og¿m
.

1854 #Ae¡h‘iÿÎy 
quÙe
 
™
.

1855 
func_quÙe_fÜ_ev®
 "$arg"

1856 
š¡®l_´og
="$install_prog$func_quote_for_eval_result"

1858 #W
Ãed
 
to
 
acû±
 
©
 
Ëa¡
 
®l
 
the
 
BSD
 
š¡®l
 
æags
.

1859 
de¡
=

1860 
fes
=

1861 
İts
=

1862 
´ev
=

1863 
š¡®l_ty³
=

1864 
isdœ
=
no


1865 
¡rme
=

1866 
¬g


1868 
‹¡
 -
n
 "$de¡"; 
th’


1869 
fes
="$files $dest"

1870 
de¡
=
$¬g


1872 
fi


1874 
$¬g
 
š


1875 -
d
è
isdœ
=
yes
 ;;

1876 -
f
)

1877 " $š¡®l_´og " 
š


1878 *[\\\ /]
ı
\ *) ;;

1879 *è
´ev
=
$¬g
 ;;

1880 
e§c


1882 -
g
 | -
m
 | -
o
)

1883 
´ev
=
$¬g


1885 -
s
)

1886 
¡rme
=" -s"

1892 #Ià
the
 
´evious
 
İtiÚ
 
Ãeded
 
ª
 
¬gum’t
, 
th’
 
sk
 
™
.

1893 
‹¡
 -
n
 "$´ev"; 
th’


1894 
´ev
=

1896 
de¡
=
$¬g


1898 
fi


1900 
e§c


1902 #Ae¡h‘iÿÎy 
quÙe
 
the
 
¬gum’t
.

1903 
func_quÙe_fÜ_ev®
 "$arg"

1904 
š¡®l_´og
="$install_prog $func_quote_for_eval_result"

1905 
dÚe


1907 
‹¡
 -
z
 "$install_prog" && \

1908 
func_çl_h–p
 "you must specify‡n install…rogram"

1910 
‹¡
 -
n
 "$prev" && \

1911 
func_çl_h–p
 "the \`$prev' option„equires‡n‡rgument"

1913 
‹¡
 -
z
 "$fes"; 
th’


1914 
‹¡
 -
z
 "$de¡"; 
th’


1915 
func_çl_h–p
 "no file or destination specified"

1917 
func_çl_h–p
 "you must specify‡ destination"

1918 
fi


1919 
fi


1921 #SŒ 
ªy
 
Œašg
 
¦ash
 
äom
 
the
 
de¡š©iÚ
.

1922 
func_¡rÇme
 '' '/' "$dest"

1923 
de¡
=
$func_¡rÇme_»suÉ


1925 #Check 
to
 
£e
 
th©
 
the
 
de¡š©iÚ
 
is
 
a
 
dœeùÜy
.

1926 
‹¡
 -
d
 "$de¡" && 
isdœ
=
yes


1927 
‹¡
 "$isdœ" = 
yes
; 
th’


1928 
de¡dœ
="$dest"

1929 
de¡Çme
=

1931 
func_dœÇme_ªd_ba£Çme
 "$dest" "" "."

1932 
de¡dœ
="$func_dirname_result"

1933 
de¡Çme
="$func_basename_result"

1935 #NÙ 
a
 
dœeùÜy
, 
so
 
check
 
to
 
£e
 
th©
 
th”e
 
is
 
Úly
 
Úe
 
fe
 
¥ecif›d
.

1936 
£t
 
dummy
 
$fes
; 
shiá


1937 
‹¡
 "$#" -
gt
 1 && \

1938 
func_çl_h–p
 "\`$dest' is‚ot‡ directory"

1939 
fi


1940 
$de¡dœ
 
š


1941 [\\/]* | [
A
-
Za
-
z
]:[\\/]*) ;;

1943 
fe
 
š
 
$fes
; do

1944 
$fe
 
š


1945 *.
lo
) ;;

1947 
func_çl_h–p
 "\`$destdir' must be‡n‡bsolute directory‚ame"

1949 
e§c


1950 
dÚe


1952 
e§c


1954 #Thi 
v¬ŸbË
 
‹Îs
 
w¿µ”
 
süts
 
ju¡
 
to
 
£t
 
v¬ŸbËs
 
¿th”


1955 #thª 
ruÂšg
 
theœ
 
´og¿ms
.

1956 
libtoŞ_š¡®l_magic
="$magic"

1958 
¡©işibs
=

1959 
futu»_libdœs
=

1960 
cu¼’t_libdœs
=

1961 
fe
 
š
 
$fes
; do

1963 #DØ
—ch
 
š¡®ÏtiÚ
.

1964 
$fe
 
š


1965 *.
$libext
)

1966 #DØ
the
 
lib¿r›s
 
Ï‹r
.

1967 
¡©işibs
="$staticlibs $file"

1970 *.
Ï
)

1971 #Check 
to
 
£e
 
th©
 
this
 
»®ly
 
is
 
a
 
libtoŞ
 
¬chive
.

1972 
func_Ïlib_un§ã_p
 "$file" \

1973 || 
func_çl_h–p
 "\`$file' is‚ot‡ valid†ibtool‡rchive"

1975 
lib¿ry_Çmes
=

1976 
Şd_lib¿ry
=

1977 
»lšk_commªd
=

1978 
func_sourû
 "$file"

1980 #Add 
the
 
libdœ
 
to
 
cu¼’t_libdœs
 
™
 
is
h
de¡š©iÚ
.

1981 
‹¡
 "X$de¡dœ" = "X$libdœ"; 
th’


1982 "$cu¼’t_libdœ " 
š


1984 *è
cu¼’t_libdœs
="$current_libdirs $libdir" ;;

1985 
e§c


1987 #NÙ
the
 
libdœ
 
as
 
a
 
futu»
†ibdir.

1988 "$futu»_libdœ " 
š


1990 *è
futu»_libdœs
="$future_libdirs $libdir" ;;

1991 
e§c


1992 
fi


1994 
func_dœÇme
 "$file" "/" ""

1995 
dœ
="$func_dirname_result"

1996 
dœ
="$dir$objdir"

1998 
‹¡
 -
n
 "$»lšk_commªd"; 
th’


1999 #D‘”mš
the
 
´efix
h
u£r
 
has
 
­¶›d
 
to
 
our
 
futu»
 
dœ
.

2000 
š¡_´efix_dœ
=`
$ECHO
 "X$de¡dœ" | 
$X£d
 -
e
 "s%$libdir\$%%"`

2003 #loÿtiÚ 
b
/
c
 
this
 
´ev’ts
 
fšdšg
 
d•’d’t
 
lib¿r›s
 
th©


2004 #¬
š¡®Ëd
 
to
 
the
 
§me
 
´efix
.

2005 #Aˆ
´e£Á
, 
this
 
check
 
dÛ¢
'ˆafãù wšdow .dÎ'
s
 
th©


2006 #¬
š¡®Ëd
 
što
 
$libdœ
/../
	`bš
 (
cu¼’y
, 
th©
 
wÜks
 
fše
)

2007 #buˆ
™
's somethingo keep‡nƒye on.

2008 
‹¡
 "$inst_prefix_dir" = "$destdir" && \

2009 
func_çl_”rÜ
 "error: cannot install \`$file'o‡ directory‚otƒnding in $libdir"

2011 
‹¡
 -
n
 "$š¡_´efix_dœ"; 
th’


2012 #Stick 
the
 
š¡_´efix_dœ
 
d©a
 
što
h
lšk
 
commªd
.

2013 
»lšk_commªd
=`
$ECHO
 "X$»lšk_commªd" | 
$X£d
 -
e
 "s%@inst_prefix_dir@%-inst-prefix-dir $inst_prefix_dir%"`

2015 
»lšk_commªd
=`
$ECHO
 "X$»lšk_commªd" | 
$X£d
 -
e
 "s%@inst_prefix_dir@%%"`

2016 
fi


2018 
func_w¬nšg
 "relinking \`$file'"

2019 
func_show_ev®
 "$relink_command" \

2020 'func_çl_”rÜ "”rÜ:„–šk \`$fe'\'' 
w™h
 
the
 
above
 
commªd
 
befÜe
 
š¡®lšg
 
™
"'

2021 
fi


2023 #S“ 
the
 
Çmes
 
of
h
sh¬ed
 
lib¿ry
.

2024 
£t
 
dummy
 
$lib¿ry_Çmes
; 
shiá


2025 
‹¡
 -
n
 "$1"; 
th’


2026 
»®Çme
="$1"

2027 
shiá


2029 
¤úame
="$realname"

2030 
‹¡
 -
n
 "$»lšk_commªd" && 
¤úame
="$»®Çme"
T


2032 #In¡®È
the
 
sh¬ed
 
lib¿ry
 
ªd
 
bud
h
symlšks
.

2033 
func_show_ev®
 "$install_prog $dir/$srcname $destdir/$realname" \

2035 
t¡rme
="$stripme"

2036 
$ho¡_os
 
š


2037 
cygwš
* | 
mšgw
* | 
pw32
* | 
ûgcc
*)

2038 
$»®Çme
 
š


2039 *.
dÎ
.
a
)

2040 
t¡rme
=""

2042 
e§c


2044 
e§c


2045 
‹¡
 -
n
 "$t¡rme" &&e¡ -À"$¡rlib"; 
th’


2046 
func_show_ev®
 "$striplib $destdir/$realname" 'exit $?'

2047 
fi


2049 
‹¡
 "$#" -
gt
 0; 
th’


2050 #D–‘
the
 
Şd
 
symlšks
, 
ªd
 
ü—‹
 
Ãw
 
Úes
.

2051 #Try `
Ê
 -
sf
' fœ¡, beÿu£h`Ê' 
bš¬y
 
might
 
d•’d
 
Ú


2052 #th
symlšk
 
we
 
»¶aû
! 
SŞ¬is
 /
bš
/
Ê
 
dÛs
 
nÙ
 
und”¡ªd
 -
f
,

2053 #sØ
we
 
®so
 
Ãed
 
to
 
Œy
 
rm
 && 
Ê
 -
s
.

2054 
lškÇme


2056 
‹¡
 "$linkname" != "$realname" \

2057 && 
func_show_ev®
 "(cd $destdir && { $LN_S -f $realname $linkname || { $RM $linkname && $LN_S $realname $linkname; }; })"

2058 
dÚe


2059 
fi


2061 #DØ
—ch
 
commªd
 
š
 
the
 
po¡š¡®l
 
commªds
.

2062 
lib
="$destdir/$realname"

2063 
func_execu‹_cmds
 "$postinstall_cmds" 'exit $?'

2064 
fi


2066 #In¡®È
the
 
p£udo
-
lib¿ry
 
šfÜm©iÚ
 
pu½o£s
.

2067 
func_ba£Çme
 "$file"

2068 
Çme
="$func_basename_result"

2069 
š¡Çme
="$dœ/$Çme"
i


2070 
func_show_ev®
 "$install_prog $instname $destdir/$name" 'exit $?'

2072 #Mayb
š¡®l
 
the
 
lib¿ry
, 
too
.

2073 
‹¡
 -
n
 "$Şd_lib¿ry" && 
¡©işibs
="$staticlibs $dir/$old_library"

2076 *.
lo
)

2077 #In¡®È(
i
.
e
. 
cİy
è
a
 
libtoŞ
 
objeù
.

2079 #Figu» 
out
 
de¡š©iÚ
 
fe
 
Çme
, 
™
 
wa¢
't‡lready specified.

2080 
‹¡
 -
n
 "$de¡Çme"; 
th’


2081 
de¡fe
="$destdir/$destname"

2083 
func_ba£Çme
 "$file"

2084 
de¡fe
="$func_basename_result"

2085 
de¡fe
="$destdir/$destfile"

2086 
fi


2088 #Deduû 
the
 
Çme
 
of
h
de¡š©iÚ
 
Şd
-
¡yË
 
objeù
 
fe
.

2089 
$de¡fe
 
š


2090 *.
lo
)

2091 
func_lo2o
 "$destfile"

2092 
¡©icde¡
=
$func_lo2o_»suÉ


2094 *.
$objext
)

2095 
¡©icde¡
="$destfile"

2096 
de¡fe
=

2099 
func_çl_h–p
 "cannot copy‡†ibtool objecto \`$destfile'"

2101 
e§c


2103 #In¡®È
the
 
libtoŞ
 
objeù
 
»que¡ed
.

2104 
‹¡
 -
n
 "$destfile" && \

2105 
func_show_ev®
 "$install_prog $file $destfile" 'exit $?'

2107 #In¡®È
the
 
Şd
 
objeù
 
’abËd
.

2108 
‹¡
 "$bud_Şd_libs" = 
yes
; 
th’


2109 #Deduû 
the
 
Çme
 
of
h
Şd
-
¡yË
 
objeù
 
fe
.

2110 
func_lo2o
 "$file"

2111 
¡©icobj
=
$func_lo2o_»suÉ


2112 
func_show_ev®
 "$install_prog \$staticobj \$staticdest" 'exit $?'

2113 
fi


2114 
ex™
 
$EXIT_SUCCESS


2118 #Figu» 
out
 
de¡š©iÚ
 
fe
 
Çme
, 
™
 
wa¢
't‡lready specified.

2119 
‹¡
 -
n
 "$de¡Çme"; 
th’


2120 
de¡fe
="$destdir/$destname"

2122 
func_ba£Çme
 "$file"

2123 
de¡fe
="$func_basename_result"

2124 
de¡fe
="$destdir/$destfile"

2125 
fi


2127 #Ià
the
 
fe
 
is
 
missšg
, 
ªd
 
th”e
 i 
a
 .
exe
 
Ú
h
’d
, 
¡r
 
™


2128 #beÿu£ 
™
 
is
 
mo¡
 
lik–y
 
a
 
libtoŞ
 
süt
 
we
 
aùu®ly
 
wªt
 
to


2130 
¡r³d_ext
=""

2131 
$fe
 
š


2132 *.
exe
)

2133 
‹¡
 ! -
f
 "$fe"; 
th’


2134 
func_¡rÇme
 '' '.exe' "$file"

2135 
fe
=
$func_¡rÇme_»suÉ


2136 
¡r³d_ext
=".exe"

2137 
fi


2139 
e§c


2141 #DØ
a
 
‹¡
 
to
 
£e
 
this
 
is
 
»®ly
‡ 
libtoŞ
 
´og¿m
.

2142 
$ho¡
 
š


2143 *
cygwš
* | *
mšgw
*)

2144 
func_Éw¿µ”_execubË_p
 "$fe"; 
th’


2145 
func_Éw¿µ”_süŠame
 "$file"

2146 
w¿µ”
=
$func_Éw¿µ”_süŠame_»suÉ


2148 
func_¡rÇme
 '' '.exe' "$file"

2149 
w¿µ”
=
$func_¡rÇme_»suÉ


2150 
fi


2153 
w¿µ”
=
$fe


2155 
e§c


2156 
func_Éw¿µ”_süt_p
 "$w¿µ”"; 
th’


2157 
nÙš¡_d•libs
=

2158 
»lšk_commªd
=

2160 
func_sourû
 "$wrapper"

2162 #Check 
the
 
v¬ŸbËs
 
th©
 
should
 
have
 
b“n
 
£t
.

2163 
‹¡
 -
z
 "$generated_by_libtool_version" && \

2164 
func_çl_”rÜ
 "invalid†ibtool wrapper script \`$wrapper'"

2166 
fš®ize
=
yes


2167 
lib
 
š
 
$nÙš¡_d•libs
; do

2168 #Check 
to
 
£e
 
th©
 
—ch
 
lib¿ry
 
is
 
š¡®Ëd
.

2169 
libdœ
=

2170 
‹¡
 -
f
 "$lib"; 
th’


2171 
func_sourû
 "$lib"

2172 
fi


2173 
libfe
="$libdœ/"`
$ECHO
 "X$lib" | 
$X£d
 -
e
 's%^.*/%%g'` ###‹¡su™e: 
sk
 
Ã¡ed
 
quÙšg
 
‹¡


2174 
‹¡
 -
n
 "$libdœ" &&e¡ ! -
f
 "$libfe"; 
th’


2175 
func_w¬nšg
 "\`$lib' has‚ot been installed in \`$libdir'"

2176 
fš®ize
=
no


2177 
fi


2178 
dÚe


2180 
»lšk_commªd
=

2181 
func_sourû
 "$wrapper"

2183 
ouuŠame
=

2184 
‹¡
 "$ç¡_š¡®l" = 
no
 &&e¡ -
n
 "$»lšk_commªd"; 
th’


2185 
$İt_dry_run
 || {

2186 
‹¡
 "$fš®ize" = 
yes
; 
th’


2187 
tmpdœ
=`
func_mk‹mpdœ
`

2188 
func_ba£Çme
 "$file$stripped_ext"

2189 
fe
="$func_basename_result"

2190 
ouuŠame
="$tmpdir/$file"

2191 #R•Ïû 
the
 
ouut
 
fe
 
¥ecifiÿtiÚ
.

2192 
»lšk_commªd
=`
$ECHO
 "X$»lšk_commªd" | 
$X£d
 -
e
 's%@OUTPUT@%'"$outputname"'%g'`

2194 
$İt_s’t
 || {

2195 
func_quÙe_fÜ_ex·nd
 "$relink_command"

2196 
ev®
 "func_echo $func_quote_for_expand_result"

2198 
ev®
 "$»lšk_commªd"; 
th’
 :

2200 
func_”rÜ
 "error:„elink \`$file' withhe‡bove command before installing it"

2201 
$İt_dry_run
 || 
$
{
RM
}
r
 "$tmpdir"

2203 
fi


2204 
fe
="$outputname"

2206 
func_w¬nšg
 "cannot„elink \`$file'"

2207 
fi


2210 #In¡®È
the
 
bš¬y
 
th©
 
we
 
comped
 
—¾›r
.

2211 
fe
=`
$ECHO
 "X$fe$¡r³d_ext" | 
$X£d
 -
e
 "s%\([^/]*\)$%$objdir/\1%"`

2212 
fi


2213 
fi


2215 #»mov.
exe
 
sšû
 
cygwš
 /
u¤
/
bš
/
š¡®l
 
wl
 
­³nd
 
ªÙh”


2216 #Ú
ªyway


2217 
$š¡®l_´og
,
$ho¡
 
š


2218 */
u¤
/
bš
/
š¡®l
*,*
cygwš
*)

2219 
$fe
:
$de¡fe
 
š


2220 *.
exe
:*.exe)

2221 #thi 
is
 
ok


2223 *.
exe
:*)

2224 
de¡fe
=
$de¡fe
.
exe


2226 *:*.
exe
)

2227 
func_¡rÇme
 '' '.exe' "$destfile"

2228 
de¡fe
=
$func_¡rÇme_»suÉ


2230 
e§c


2232 
e§c


2233 
func_show_ev®
 "$install_prog\$stripme \$file \$destfile" 'exit $?'

2234 
$İt_dry_run
 || 
‹¡
 -
n
 "$ouuŠame"; 
th’


2235 
$
{
RM
}
r
 "$tmpdir"

2236 
fi


2238 
e§c


2239 
dÚe


2241 
fe
 
š
 
$¡©işibs
; do

2242 
func_ba£Çme
 "$file"

2243 
Çme
="$func_basename_result"

2245 #S‘ 
up
 
the
 
¿Æib
 
·¿m‘”s
.

2246 
Şdlib
="$destdir/$name"

2248 
func_show_ev®
 "$install_prog \$file \$oldlib" 'exit $?'

2250 
‹¡
 -
n
 "$¡rme" &&e¡ -À"$Şd_¡rlib"; 
th’


2251 
func_show_ev®
 "$old_striplib $oldlib" 'exit $?'

2252 
fi


2254 #DØ
—ch
 
commªd
 
š
 
the
 
po¡š¡®l
 
commªds
.

2255 
func_execu‹_cmds
 "$old_postinstall_cmds" 'exit $?'

2256 
dÚe


2258 
‹¡
 -
n
 "$future_libdirs" && \

2259 
func_w¬nšg
 "remembero„un \`$progname --finish$future_libdirs'"

2261 
‹¡
 -
n
 "$cu¼’t_libdœs"; 
th’


2262 #Mayb
ju¡
 dØ
a
 
dry
 
run
.

2263 
$İt_dry_run
 && 
cu¼’t_libdœs
=" -n$current_libdirs"

2264 
exec_cmd
='$SHELL $progpath $preserve_args --finish$current_libdirs'

2266 
ex™
 
$EXIT_SUCCESS


2267 
fi


2268 
	}
}

2270 
	g‹¡
 "$mode" = 
š¡®l
 && 
func_mode_š¡®l
 
$
{1+"$@"}

2273 #func_g’”©e_dlsym 
ouuŠame
 
Üigš©Ü
 
pic_p


2274 #ExŒaù 
symbŞs
 
äom
 
dÍ»fes
 
ªd
 
ü—‹
 
$
{
ouuŠame
}
S
.
o
 
w™h


2275 #¨
dÍ»İ’
 
symbŞ
 
bË
.

2276 
	$func_g’”©e_dlsyms
 ()

2278 
$İt_debug


2279 
my_ouuŠame
="$1"

2280 
my_Üigš©Ü
="$2"

2281 
my_pic_p
="${3-no}"

2282 
my_´efix
=`
$ECHO
 "$my_Üigš©Ü" | 
£d
 's%[^a-zA-Z0-9]%_%g'`

2283 
my_dlsyms
=

2285 
‹¡
 -
n
 "$dlfes$dÍ»fes" ||e¡ "$dl£lf" !ğ
no
; 
th’


2286 
‹¡
 -
n
 "$NM" &&e¡ -À"$glob®_symbŞ_pe"; 
th’


2287 
my_dlsyms
="${my_outputname}S.c"

2289 
func_”rÜ
 "not configuredoƒxtract global symbols from dlpreopened files"

2290 
fi


2291 
fi


2293 
‹¡
 -
n
 "$my_dlsyms"; 
th’


2294 
$my_dlsyms
 
š


2296 *.
c
)

2297 #Discov” 
the
 
Æi¡
 
of
 
—ch
 oàth
dlfes
.

2298 
Æi¡
="$output_objdir/${my_outputname}.nm"

2300 
func_show_ev®
 "$RM $nlist ${nlist}S ${nlist}T"

2302 #P¬£ 
the
 
Çme
 
li¡
 
što
 
a
 
sourû
 
fe
.

2303 
func_v”bo£
 "creating $output_objdir/$my_dlsyms"

2305 
$İt_dry_run
 || 
$ECHO
 > "$output_objdir/$my_dlsyms" "\
/* $my_dlsyms - symbol„esolutionable for \`$my_outputname' dlsymƒmulation. */

2309 #ifdeà
__ılu¥lus


2316 
‹¡
 "$dl£lf" = 
yes
; 
th’


2317 
func_v”bo£
 "generating symbol†ist for \`$output'"

2319 
$İt_dry_run
 || 
echo
 ': @PROGRAM@ ' > "$nlist"

2321 #Add 
our
 
own
 
´og¿m
 
objeùs
 
to
 
the
 
symbŞ
 
li¡
.

2322 
´ogfes
=`
$ECHO
 "X$objs$Şd_d•libs" | 
$SP2NL
 | 
$X£d
 -
e
 "$lo2o" | 
$NL2SP
`

2323 
´ogfe
 
š
 
$´ogfes
; do

2324 
func_v”bo£
 "extracting global C symbols from \`$progfile'"

2325 
$İt_dry_run
 || 
ev®
 "$NM $progfile | $global_symbol_pipe >> '$nlist'"

2326 
dÚe


2328 
‹¡
 -
n
 "$exşude_expsyms"; 
th’


2329 
$İt_dry_run
 || {

2330 
ev®
 '$EGREP -v " ($exclude_expsyms)$" "$nlist" > "$nlist"T'

2331 
ev®
 '$MV "$nlist"T "$nlist"'

2333 
fi


2335 
‹¡
 -
n
 "$expÜt_symbŞs_»gex"; 
th’


2336 
$İt_dry_run
 || {

2337 
ev®
 '$EGREP -e "$export_symbols_regex" "$nlist" > "$nlist"T'

2338 
ev®
 '$MV "$nlist"T "$nlist"'

2340 
fi


2342 #P»·» 
the
 
li¡
 
of
 
expÜ‹d
 
symbŞs


2343 
‹¡
 -
z
 "$expÜt_symbŞs"; 
th’


2344 
expÜt_symbŞs
="$output_objdir/$outputname.exp"

2345 
$İt_dry_run
 || {

2346 
$RM
 
$expÜt_symbŞs


2347 
ev®
 "${SED} -n -e '/^: @PROGRAM@ $/d' -e 's/^.* \(.*\)$/\1/p' "'< "$nlist" > "$export_symbols"'

2348 
$ho¡
 
š


2349 *
cygwš
* | *
mšgw
* | *
ûgcc
* )

2350 
ev®
 "echo EXPORTS "'> "$output_objdir/$outputname.def"'

2351 
ev®
 'cat "$export_symbols" >> "$output_objdir/$outputname.def"'

2353 
e§c


2356 
$İt_dry_run
 || {

2357 
ev®
 "${SED} -e 's/\([].[*^$]\)/\\\\\1/g' -e 's/^/ /' -e 's/$/$/'"' < "$export_symbols" > "$output_objdir/$outputname.exp"'

2358 
ev®
 '$GREP -f "$output_objdir/$outputname.exp" < "$nlist" > "$nlist"T'

2359 
ev®
 '$MV "$nlist"T "$nlist"'

2360 
$ho¡
 
š


2361 *
cygwš
 | *
mšgw
* | *
ûgcc
* )

2362 
ev®
 "echo EXPORTS "'> "$output_objdir/$outputname.def"'

2363 
ev®
 'cat "$nlist" >> "$output_objdir/$outputname.def"'

2365 
e§c


2367 
fi


2368 
fi


2370 
dÍ»fe
 
š
 
$dÍ»fes
; do

2371 
func_v”bo£
 "extracting global C symbols from \`$dlprefile'"

2372 
func_ba£Çme
 "$dlprefile"

2373 
Çme
="$func_basename_result"

2374 
$İt_dry_run
 || {

2375 
ev®
 '$ECHO ": $name " >> "$nlist"'

2376 
ev®
 "$NM $dlprefile 2>/dev/null | $global_symbol_pipe >> '$nlist'"

2378 
dÚe


2380 
$İt_dry_run
 || {

2381 #Mak
su»
 
we
 
have
 
©
 
Ëa¡
 
ª
 
em±y
 
fe
.

2382 
‹¡
 -
f
 "$nlist" || : > "$nlist"

2384 
‹¡
 -
n
 "$exşude_expsyms"; 
th’


2385 
$EGREP
 -
v
 " ($exşude_expsyms)$" "$Æi¡" > "$Æi¡"
T


2386 
$MV
 "$Æi¡"
T
 "$nlist"

2387 
fi


2389 #Try 
sÜtšg
 
ªd
 
uniquifyšg
 
the
 
ouut
.

2390 
$GREP
 -
v
 "^: " < "$nlist" |

2391 
sÜt
 -
k
 3 </
dev
/
nuÎ
 >/dev/nuÎ 2>&1; 
th’


2392 
sÜt
 -
k
 3

2394 
sÜt
 +2

2395 
fi
 |

2396 
uniq
 > "$Æi¡"
S
; 
th’


2399 
$GREP
 -
v
 "^: " < "$Æi¡" > "$Æi¡"
S


2400 
fi


2402 
‹¡
 -
f
 "$Æi¡"
S
; 
th’


2403 
ev®
 "$global_symbol_to_cdecl"' < "$nlist"S >> "$output_objdir/$my_dlsyms"'

2405 
$ECHO
 '/* NONE */' >> "$output_objdir/$my_dlsyms"

2406 
fi


2408 
$ECHO
 >> "$output_objdir/$my_dlsyms" "\


2412 cÚ¡ *
Çme
;

2413 *
add»ss
;

2414 } 
	tÉ_dlsymli¡
;

2416 
$ho¡
 
š


2417 *
cygwš
* | *
mšgw
* | *
ûgcc
* )

2418 
$ECHO
 >> "$output_objdir/$my_dlsyms" "\
/* DATA imports from DLLs on WIN32 con't be const, because

2420 
ruÁime
 
»loÿtiÚs
 
¬e
 
³rfÜmed
 -- 
£e
 
ld
's documentation

2421 
Ú
 
p£udo
-
»locs
. */"

2422 
É_dlsym_cÚ¡
= ;;

2423 *
osf5
*)

2424 
echo
 >> "$output_objdir/$my_dlsyms" "\
/* This system does‚ot cope well with„elocations in const data */"

2426 
É_dlsym_cÚ¡
= ;;

2428 
É_dlsym_cÚ¡
=const ;;

2429 
e§c


2431 
$ECHO
 >> "$output_objdir/$my_dlsyms" "\
 $lt_dlsym_const†t_dlsymlist

2433 
É_$
{
my_´efix
}
_LTX_´–ßded_symbŞs
[];

2434 
$É_dlsym_cÚ¡
 
É_dlsymli¡


2435 
É_$
{
my_´efix
}
_LTX_´–ßded_symbŞs
[] =

2439 
$Ãed_lib_´efix
 
š


2440 
no
)

2441 
ev®
 "$global_symbol_to_c_name_address" < "$nlist" >> "$output_objdir/$my_dlsyms"

2444 
ev®
 "$global_symbol_to_c_name_address_lib_prefix" < "$nlist" >> "$output_objdir/$my_dlsyms"

2446 
e§c


2447 
$ECHO
 >> "$output_objdir/$my_dlsyms" "\
{0, (void *) 0}

2452 #ifdeà
FREEBSD_WORKAROUND


2453 cÚ¡ *
	`É_´–ßded_£tup
() {

2454  
É_$
{
my_´efix
}
_LTX_´–ßded_symbŞs
;

2458 #ifdeà
__ılu¥lus


2462 } #!
$İt_dry_run


2464 
pic_æag_fÜ_symbË
=

2465 "$compe_commªd " 
š


2468 
$ho¡
 
š


2469 #compšg 
the
 
symbŞ
 
bË
 
fe
 
w™h
 
pic_æag
 
wÜks
 
¬ound


2470 #¨
F»eBSD
 
bug
 
th©
 
ÿu£s
 
´og¿ms
 
to
 
üash
 
wh’
 -
lm
 
is


2471 #lšked 
befÜe
 
ªy
 
Ùh”
 
PIC
 
objeù
. 
But
 
we
 
mu¡
 
nÙ
 
u£


2472 #pic_æag 
wh’
 
lškšg
 
w™h
 -. 
The
 
´obËm
 
exi¡s
 
š


2473 #F»eBSD 2.2.6 
ªd
 
is
 
fixed
 
š
 
F»eBSD
 3.1.

2474 *-*-
ä“bsd2
*|*-*-
ä“bsd3
.0*|*-*-
ä“bsd–f3
.0*)

2475 
pic_æag_fÜ_symbË
=" $pic_flag -DFREEBSD_WORKAROUND" ;;

2476 *-*-
hpux
*)

2477 
pic_æag_fÜ_symbË
=" $pic_flag" ;;

2479 
‹¡
 "X$my_pic_p" !ğ
Xno
; 
th’


2480 
pic_æag_fÜ_symbË
=" $pic_flag"

2481 
fi


2483 
e§c


2485 
e§c


2486 
symb_cæags
=

2487 
¬g
 
š
 
$LTCFLAGS
; do

2488 
$¬g
 
š


2489 -
p›
 | -
å›
 | -
fPIE
) ;;

2490 *è
symb_cæags
="$symtab_cflags $arg" ;;

2491 
e§c


2492 
dÚe


2494 #Now 
compe
 
the
 
dyÇmic
 
symbŞ
 
fe
.

2495 
func_show_ev®
 '(cd $output_objdir && $LTCC$symtab_cflags -c$no_builtin_flag$pic_flag_for_symtable "$my_dlsyms")' 'exit $?'

2497 #CËª 
up
 
the
 
g’”©ed
 
fes
.

2498 
func_show_ev®
 '$RM "$output_objdir/$my_dlsyms" "$nlist" "${nlist}S" "${nlist}T"'

2500 #T¿nsfÜm 
the
 
symbŞ
 
fe
 
što
h
cÜ»ù
 
Çme
.

2501 
symfeobj
="$output_objdir/${my_outputname}S.$objext"

2502 
$ho¡
 
š


2503 *
cygwš
* | *
mšgw
* | *
ûgcc
* )

2504 
‹¡
 -
f
 "$ouut_objdœ/$my_ouuŠame.def"; 
th’


2505 
compe_commªd
=`
$ECHO
 "X$compe_commªd" | 
$X£d
 -
e
 "s%@SYMFILE@%$output_objdir/$my_outputname.def $symfileobj%"`

2506 
fš®ize_commªd
=`
$ECHO
 "X$fš®ize_commªd" | 
$X£d
 -
e
 "s%@SYMFILE@%$output_objdir/$my_outputname.def $symfileobj%"`

2508 
compe_commªd
=`
$ECHO
 "X$compe_commªd" | 
$X£d
 -
e
 "s%@SYMFILE@%$symfileobj%"`

2509 
fš®ize_commªd
=`
$ECHO
 "X$fš®ize_commªd" | 
$X£d
 -
e
 "s%@SYMFILE@%$symfileobj%"`

2510 
fi


2513 
compe_commªd
=`
$ECHO
 "X$compe_commªd" | 
$X£d
 -
e
 "s%@SYMFILE@%$symfileobj%"`

2514 
fš®ize_commªd
=`
$ECHO
 "X$fš®ize_commªd" | 
$X£d
 -
e
 "s%@SYMFILE@%$symfileobj%"`

2516 
e§c


2519 
func_çl_”rÜ
 "unknown suffix for \`$my_dlsyms'"

2521 
e§c


2523 #W
k“p
 
gošg
 
ju¡
 
š
 
the
 
u£r
 
didn
't„efero

2524 #É_´–ßded_symbŞs. 
The
 
lšk”
 
wl
 
ç
 
glob®_symbŞ_pe


2525 #»®ly 
was
 
»quœed
.

2527 #NuÎify 
the
 
symbŞ
 
fe
.

2528 
compe_commªd
=`
$ECHO
 "X$compe_commªd" | 
$X£d
 -
e
 "s% @SYMFILE@%%"`

2529 
fš®ize_commªd
=`
$ECHO
 "X$fš®ize_commªd" | 
$X£d
 -
e
 "s% @SYMFILE@%%"`

2530 
fi


2533 #func_wš32_libid 
¬g


2534 #»tuº 
the
 
lib¿ry
 
ty³
 
of
 
fe
 'arg'

2535 #
#N“d 
a
 
lÙ
 
of
 
goo
 
to
 
hªdË
 *
bÙh
* 
DLLs
 
ªd
 
impÜt
 
libs


2536 #Ha 
to
 
be
 
a
 
sh–l
 
funùiÚ
 
š
 
Üd”
Ø'—t' 
the
 
¬gum’t


2537 #th© 
is
 
suµl›d
 
wh’
 
$fe_magic_commªd
 i 
ÿÎed
.

2538 
	`func_wš32_libid
 ()

2540 
$İt_debug


2541 
wš32_libid_ty³
="unknown"

2542 
wš32_f”es
=`
fe
 -
L
 
$1
 2>/
dev
/
nuÎ
`

2543 
$wš32_f”es
 
š


2544 *
¬
\ 
¬chive
\ 
impÜt
\ 
lib¿ry
*) #definitely import

2545 
wš32_libid_ty³
="x86‡rchive import"

2547 *
¬
\ 
¬chive
*è#could 
be
 
ª
 
impÜt
, 
Ü
 

2548 
ev®
 
$OBJDUMP
 -
f
 
$1
 | 
$SED
 -
e
 '10q' 2>/
dev
/
nuÎ
 |

2549 
$EGREP
 'ffÜm©…e-i386(.*¬ch™eùu»: i386)?' >/
dev
/
nuÎ
 ; 
th’


2550 
wš32_nm»s
=`
ev®
 
$NM
 -
f
 
posix
 -
A
 
$1
 |

2551 
$SED
 -
n
 -
e
 '

2553 / 
I
 /{

2554 
s
,.*,
impÜt
,

2555 
p


2556 
q


2559 
$wš32_nm»s
 
š


2560 
impÜt
*è
wš32_libid_ty³
="x86‡rchive import";;

2561 *è
wš32_libid_ty³
="x86‡rchive static";;

2562 
e§c


2563 
fi


2565 *
DLL
*)

2566 
wš32_libid_ty³
="x86 DLL"

2568 *
execubË
*è#buˆ
sh–l
 
süts
 
¬e
 "execubË" 
too
...

2569 
$wš32_f”es
 
š


2570 *
MS
\ 
Wšdows
\ 
PE
\ 
IÁ–
*)

2571 
wš32_libid_ty³
="x86 DLL"

2573 
e§c


2575 
e§c


2576 
$ECHO
 "$win32_libid_type"

2581 #func_exŒaù_ª_¬chiv
dœ
 
Şdlib


2582 
	`func_exŒaù_ª_¬chive
 ()

2584 
$İt_debug


2585 
f_ex_ª_¬_dœ
="$1"; 
shiá


2586 
f_ex_ª_¬_Şdlib
="$1"

2587 
func_show_ev®
 "(cd \$f_ex_an_ar_dir && $AR x \"\$f_ex_an_ar_oldlib\")" 'exit $?'

2588 ià(
$AR
 
t
 "$f_ex_ª_¬_Şdlib" | 
sÜt
 | sÜˆ-
uc
 >/
dev
/
nuÎ
 2>&1); 
th’


2591 
func_çl_”rÜ
 "object‚ame conflicts in‡rchive: $f_ex_an_ar_dir/$f_ex_an_ar_oldlib"

2592 
fi


2596 #func_exŒaù_¬chive 
g’tİ
 
Şdlib
 ...

2597 
	`func_exŒaù_¬chives
 ()

2599 
$İt_debug


2600 
my_g’tİ
="$1"; 
shiá


2601 
my_Şdlibs
=
$
{1+"$@"}

2602 
my_Şdobjs
=""

2603 
my_xlib
=""

2604 
my_xabs
=""

2605 
my_xdœ
=""

2607 
my_xlib
 
š
 
$my_Şdlibs
; do

2608 #ExŒaù 
the
 
objeùs
.

2609 
$my_xlib
 
š


2610 [\\/]* | [
A
-
Za
-
z
]:[\\/]*è
my_xabs
="$my_xlib" ;;

2611 *è
my_xabs
=`
pwd
`"/$my_xlib" ;;

2612 
e§c


2613 
func_ba£Çme
 "$my_xlib"

2614 
my_xlib
="$func_basename_result"

2615 
my_xlib_u
=
$my_xlib


2617 " $exŒaùed_¬chive " 
š


2619 
func_¬™h
 
$exŒaùed_£rŸl
 + 1

2620 
exŒaùed_£rŸl
=
$func_¬™h_»suÉ


2621 
my_xlib_u
=
É$exŒaùed_£rŸl
-
$my_xlib
 ;;

2623 
e§c


2624 
dÚe


2625 
exŒaùed_¬chives
="$extracted_archives $my_xlib_u"

2626 
my_xdœ
="$my_gentop/$my_xlib_u"

2628 
func_mkdœ_p
 "$my_xdir"

2630 
$ho¡
 
š


2631 *-
d¬wš
*)

2632 
func_v”bo£
 "Extracting $my_xabs"

2633 #DØ
nÙ
 
bÙh”
 
došg
 
ªythšg
 
ju¡
 
a
 
dry
 
run


2634 
$İt_dry_run
 || {

2635 
d¬wš_Üig_dœ
=`
pwd
`

2636 
cd
 
$my_xdœ
 || 
ex™
 
$
?

2637 
d¬wš_¬chive
=
$my_xabs


2638 
d¬wš_curdœ
=`
pwd
`

2639 
d¬wš_ba£_¬chive
=`
ba£Çme
 "$darwin_archive"`

2640 
d¬wš_¬ches
=`
$LIPO
 -
šfo
 "$d¬wš_¬chive" 2>/
dev
/
nuÎ
 | 
$GREP
 
Arch™eùu»s
 2>/dev/nuÎ || 
Œue
`

2641 
‹¡
 -
n
 "$d¬wš_¬ches"; 
th’


2642 
d¬wš_¬ches
=`
$ECHO
 "$d¬wš_¬ches" | 
$SED
 -
e
 's/.*are://'`

2643 
d¬wš_¬ch
=

2644 
func_v”bo£
 "$darwin_base_archive has multiple‡rchitectures $darwin_arches"

2645 
d¬wš_¬ch
 
š
 
$d¬wš_¬ches
 ; do

2646 
func_mkdœ_p
 "unfat-$$/${darwin_base_archive}-${darwin_arch}"

2647 
$LIPO
 -
thš
 
$d¬wš_¬ch
 -
ouut
 "unfat-$$/${darwin_base_archive}-${darwin_arch}/${darwin_base_archive}" "${darwin_archive}"

2648 
cd
 "unfat-$$/${darwin_base_archive}-${darwin_arch}"

2649 
func_exŒaù_ª_¬chive
 "`pwd`" "${darwin_base_archive}"

2650 
cd
 "$darwin_curdir"

2651 
$RM
 "unfat-$$/${darwin_base_archive}-${darwin_arch}/${darwin_base_archive}"

2652 
dÚe
 #$darwin_arches

2653 ## 
Okay
 
now
 
we
've‡ bunch ofhin objects, gotta fattenhem up :)

2654 
d¬wš_f–i¡
=`
fšd
 
unçt
-
$$
 -
ty³
 
f
 -
Çme
 \*.
o
 -
´št
 -Ø-Çm\*.
lo
 -´šˆ| 
$SED
 -
e
 "$ba£Çme" | 
sÜt
 -
u
`

2655 
d¬wš_fe
=

2656 
d¬wš_fes
=

2657 
d¬wš_fe
 
š
 
$d¬wš_f–i¡
; do

2658 
d¬wš_fes
=`
fšd
 
unçt
-
$$
 -
Çme
 
$d¬wš_fe
 -
´št
 | 
$NL2SP
`

2659 
$LIPO
 -
ü—‹
 -
ouut
 "$d¬wš_fe" 
$d¬wš_fes


2660 
dÚe
 #$darwin_filelist

2661 
$RM
 -
rf
 
unçt
-
$$


2662 
cd
 "$darwin_orig_dir"

2664 
cd
 
$d¬wš_Üig_dœ


2665 
func_exŒaù_ª_¬chive
 "$my_xdir" "$my_xabs"

2666 
fi
 #$darwin_arches

2667 } #!
$İt_dry_run


2670 
func_exŒaù_ª_¬chive
 "$my_xdir" "$my_xabs"

2672 
e§c


2673 
my_Şdobjs
="$my_Şdobj "`
fšd
 
$my_xdœ
 -
Çme
 \*.
$objext
 -
´št
 -
o
 -Çm\*.
lo
 -´šˆ| 
$NL2SP
`

2674 
dÚe


2676 
func_exŒaù_¬chives_»suÉ
="$my_oldobjs"

2681 #func_em™_w¿µ”_·¹1 [
¬g
=
no
]

2682 #
#Em™ 
the
 
fœ¡
 
·¹
 
of
 
a
 
libtoŞ
 
w¿µ”
 
süt
 
Ú
 
¡dout
.

2683 #FÜ 
mÜe
 
šfÜm©iÚ
, 
£e
 
the
 
desütiÚ
 
assocŸ‹d
 
w™h


2684 #func_em™_w¿µ”(), 
b–ow
.

2685 
	`func_em™_w¿µ”_·¹1
 ()

2687 
func_em™_w¿µ”_·¹1_¬g1
=
no


2688 
‹¡
 -
n
 "$1" ; 
th’


2689 
func_em™_w¿µ”_·¹1_¬g1
=
$1


2690 
fi


2692 
$ECHO
 "\
#! $SHELL

2695 #$ouuˆ- 
‹mpÜ¬y
 
w¿µ”
 
süt
 
$objdœ
/
$ouuŠame


2696 #G’”©ed 
by
 
	`$PROGRAM
 (
GNU
 
$PACKAGE$TIMESTAMP
è
$VERSION


2697 #
#Th
$ouut
 
´og¿m
 
ÿÂÙ
 
be
 
dœeùly
 
execu‹d
 
uÁ
 
®l
 
the
 
libtoŞ


2698 #lib¿r› 
th©
 
™
 
d•’ds
 
Ú
 
¬e
 
š¡®Ëd
.

2699 #
#Thi 
w¿µ”
 
süt
 
should
 
Ãv”
 
be
 
moved
 
out
 
of
 
the
 
bud
 
dœeùÜy
.

2700 #Ià
™
 
is
, iˆ
wl
 
nÙ
 
İ”©e
 
cÜ»ùly
.

2702 #Sed 
sub¡™utiÚ
 
th©
 
h–ps
 
us
 dØ
robu¡
 
quÙšg
. 
It
 
back¦ashif›s


2703 #m‘ach¬aù” 
th©
 
¬e
 
¡l
 
aùive
 
w™hš
 -
quÙed
 
¡ršgs
.

2704 
X£d
='${SED} -e 1s/^X//'

2705 
£d_quÙe_sub¡
='$sed_quote_subst'

2707 #B
Bouºe
 
com·tibË


2708 
‹¡
 -
n
 \"\${ZSH_VERSION+set}\" && (emulate sh) >/dev/null 2>&1;hen

2709 
emuÏ‹
 
sh


2710 
NULLCMD
=:

2711 #Zsh 3.x 
ªd
 4.x 
³rfÜms
 
wÜd
 
¥l™tšg
 
Ú
 \
$
{1+\"\$@\"}, which

2712 #i 
cÚŒ¬y
 
to
 
our
 
u§ge
. 
Di§bË
 
this
 
ã©u»
.

2713 
®Ÿs
 -
g
 '\${1+\"\$@\"}'='\"\$@\"'

2714 
£tİt
 
NO_GLOB_SUBST


2716 \`(
£t
 -
o
è2>/
dev
/
nuÎ
\` 
š
 *
posix
*è£ˆ-Øposix;; 
e§c


2717 
fi


2718 
BIN_SH
=
xpg4
; 
expÜt
 BIN_SH #fÜ 
Tru64


2719 
DUALCASE
=1; 
expÜt
 DUALCASE #fÜ 
MKS
 
sh


2721 #Th
HP
-
UX
 
ksh
 
ªd
 
POSIX
 
sh–l
 
´št
 
the
 
rg‘
 
dœeùÜy
 
to
 
¡dout


2722 #ià
CDPATH
 
is
 
£t
.

2723 (
un£t
 
CDPATH
è>/
dev
/
nuÎ
 2>&1 && unset CDPATH

2725 
»lšk_commªd
=\"$relink_command\"

2727 #Thi 
’vœÚm’t
 
v¬ŸbË
 
d‘”mšes
 
our
 
İ”©iÚ
 
mode
.

2728 
‹¡
 \"\$libtool_install_magic\" = \"$magic\";hen

2729 #š¡®È
mode
 
Ãeds
 
the
 
fŞlowšg
 
v¬ŸbËs
:

2730 
g’”©ed_by_libtoŞ_v”siÚ
='$macro_version'

2731 
nÙš¡_d•libs
='$notinst_deplibs'

2733 #Wh’ 
we
 
¬e
 
sourûd
 
š
 
execu‹
 
mode
, \
$fe
 
ªd
 \
$ECHO
‡» 
®»ady
 
£t
.

2734 
‹¡
 \"\$libtool_execute_magic\" != \"$magic\";hen

2735 
ECHO
=\"$qecho\"

2736 
fe
=\"\$0\"

2737 #Mak
su»
 
echo
 
wÜks
.

2738 
‹¡
 \"X\$1\" = X--no-reexec;hen

2739 #Disÿrd 
the
 --
no
-
»exec
 
æag
, 
ªd
 .

2740 
shiá


2741 
–if
 
‹¡
 \"X\`{ \$ECHO '\t'; } 2>/dev/null\`\" = 'X\t';hen

2742 #Y³e, \
$ECHO
 
wÜks
!

2745 #Re¡¬ˆ
und”
 
the
 
cÜ»ù
 
sh–l
, 
ªd
 
th’
 
maybe
 \
$ECHO
 
wl
 
wÜk
.

2746 
exec
 
$SHELL
 \"\$0\" --no-reexec \${1+\"\$@\"}

2747 
fi


2748 
fi
\

2750 
$ECHO
 "\


2752 #Fšd 
the
 
dœeùÜy
 
th©
 
this
 
süt
 
lives
 
š
.

2753 
thisdœ
=\`\
$ECHO
 \"X\$file\" | \$Xsed -e 's%/[^/]*$%%'\`

2754 
‹¡
 \"x\$thisdir\" = \"x\$file\" &&hisdir=.

2756 #FŞlow 
symbŞic
 
lšks
 
uÁ
 
we
 
g‘
 
to
 
the
 
»®
 
thisdœ
.

2757 
fe
=\`
ls
 -
ld
 \"\$file\" | ${SED} -n 's/.*-> //p'\`

2758 
‹¡
 -
n
 \"\$file\"; do

2759 
de¡dœ
=\`\
$ECHO
 \"X\$file\" | \$Xsed -e 's%/[^/]*\$%%'\`

2761 #Ià
th”e
 
was
 
a
 
dœeùÜy
 
compÚ’t
, 
th’
 
chªge
 
thisdœ
.

2762 
‹¡
 \"x\$destdir\" != \"x\$file\";hen

2764 [\\\\/]* | [
A
-
Za
-
z
]:[\\\\/]*è
thisdœ
=\"\$destdir\" ;;

2765 *è
thisdœ
=\"\$thisdir/\$destdir\" ;;

2766 
e§c


2767 
fi


2769 
fe
=\`\
$ECHO
 \"X\$file\" | \$Xsed -e 's%^.*/%%'\`

2770 
fe
=\`
ls
 -
ld
 \"\$thisdir/\$file\" | ${SED} -n 's/.*-> //p'\`

2771 
dÚe


2774 #’d: 
func_em™_w¿µ”_·¹1


2776 #func_em™_w¿µ”_·¹2 [
¬g
=
no
]

2777 #
#Em™ 
the
 
£cÚd
 
·¹
 
of
 
a
 
libtoŞ
 
w¿µ”
 
süt
 
Ú
 
¡dout
.

2778 #FÜ 
mÜe
 
šfÜm©iÚ
, 
£e
 
the
 
desütiÚ
 
assocŸ‹d
 
w™h


2779 #func_em™_w¿µ”(), 
b–ow
.

2780 
	`func_em™_w¿µ”_·¹2
 ()

2782 
func_em™_w¿µ”_·¹2_¬g1
=
no


2783 
‹¡
 -
n
 "$1" ; 
th’


2784 
func_em™_w¿µ”_·¹2_¬g1
=
$1


2785 
fi


2787 
$ECHO
 "\


2789 #Usu®ly 'no', 
exû±
 
Ú
 
cygwš
/
mšgw
 
wh’
 
embedded
 
što


2790 #th
cw¿µ”
.

2791 
WRAPPER_SCRIPT_BELONGS_IN_OBJDIR
=
$func_em™_w¿µ”_·¹2_¬g1


2792 
‹¡
 \"\$WRAPPER_SCRIPT_BELONGS_IN_OBJDIR\" = \"yes\";hen

2794 
‹¡
 \"\$thisdir\" = \".\";hen

2795 
thisdœ
=\`
pwd
\`

2796 
fi


2797 #»mov.
libs
 
äom
 
thisdœ


2799 *[\\\\/]
$objdœ
 ) 
thisdœ
=\`\
$ECHO
 \"X\$thisdir\" | \$Xsed -e 's%[\\\\/][^\\\\/]*$%%'\` ;;

2800 
$objdœ
 ) 
thisdœ
=. ;;

2801 
e§c


2802 
fi


2804 #Try 
to
 
g‘
 
the
 
absŞu‹
 
dœeùÜy
 
Çme
.

2805 
absdœ
=\`
cd
 \"\$thisdir\" &&…wd\`

2806 
‹¡
 -
n
 \"\$absdir\" &&hisdir=\"\$absdir\"

2809 
‹¡
 "$ç¡_š¡®l" = 
yes
; 
th’


2810 
$ECHO
 "\
=lt-'$outputname'$exeext

2812 
´ogdœ
=\"\$thisdir/$objdir\"

2814 
‹¡
 ! -
f
 \"\$progdir/\$program\" ||

2815 { 
fe
=\`
ls
 -1d
t
 \"\$progdir/\$program\" \"\$progdir/../\$program\" 2>/dev/null | ${SED} 1q\`; \\

2816 
‹¡
 \"X\$file\" != \"X\$progdir/\$program\"; };hen

2818 
fe
=\"\$\$-\$program\"

2820 
‹¡
 ! -
d
 \"\$progdir\";hen

2821 
$MKDIR
 \"\$progdir\"

2823 
$RM
 \"\$progdir/\$file\"

2824 
fi
"

2826 
$ECHO
 "\


2828 #»lšk 
execubË
 
Ãûs§ry


2829 
‹¡
 -
n
 \"\$relink_command\";hen

2830 
»lšk_commªd_ouut
=\`
ev®
 \
$»lšk_commªd
 2>&1\`; 
th’
 :

2832 
$ECHO
 \"\$relink_command_output\" >&2

2833 
$RM
 \"\$progdir/\$file\"

2834 
ex™
 1

2835 
fi


2836 
fi


2838 
$MV
 \"\$progdir/\$file\" \"\$progdir/\$program\" 2>/dev/null ||

2839 { 
$RM
 \"\$progdir/\$program\";

2840 
$MV
 \"\$progdir/\$file\" \"\$progdir/\$program\"; }

2841 
$RM
 \"\$progdir/\$file\"

2842 
fi
"

2844 
$ECHO
 "\
='$outputname'

2846 
´ogdœ
=\"\$thisdir/$objdir\"

2848 
fi


2850 
$ECHO
 "\


2852 
‹¡
 -
f
 \"\$progdir/\$program\";hen"

2854 #ExpÜˆ
our
 
shlib·th_v¬
 
we
 
have
 
Úe
.

2855 
‹¡
 "$shlib·th_ov”rides_ruÅ©h" = 
yes
 &&e¡ -
n
 "$shlib·th_v¬" &&e¡ -À"$‹mp_½©h"; 
th’


2856 
$ECHO
 "\
# Add our own†ibrary…atho $shlibpath_var

2858 
$shlib·th_v¬
=\"$temp_rpath\$$shlibpath_var\"

2860 #Som
sy¡ems
 
ÿÂÙ
 
cİe
 
w™h
 
cŞÚ
-
‹rmš©ed
 
$shlib·th_v¬


2861 #Th
£cÚd
 
cŞÚ
 
is
 
a
 
wÜk¬ound
 ¨
bug
 
š
 
BeOS
 
R4
 
£d


2862 
$shlib·th_v¬
=\`\
$ECHO
 \"X\$$shlibpath_var\" | \$Xsed -e 's/::*\$//'\`

2864 
expÜt
 
$shlib·th_v¬


2866 
fi


2868 #fixu°
the
 
dÎ
 
£¬ch·th
 
we
 
Ãed
 
to
.

2869 
‹¡
 -
n
 "$dÎ£¬ch·th"; 
th’


2870 
$ECHO
 "\
# Addhe dll search…ath componentsoheƒxecutable PATH

2872 
PATH
=
$dÎ£¬ch·th
:\
$PATH


2874 
fi


2876 
$ECHO
 "\
est \"\$libtool_execute_magic\" != \"$magic\";hen

2878 #RuÀ
the
 
aùu®
 
´og¿m
 
w™h
 
our
 
¬gum’ts
.

2880 
$ho¡
 
š


2881 #Back¦ashe 
£·¿‹
 
dœeùÜ›s
 
Ú
 
¶aš
 
wšdows


2882 *-*-
mšgw
 | *-*-
os2
* | *-
ûgcc
*)

2883 
$ECHO
 "\
 \"\$progdir\\\\\$program\" \${1+\"\$@\"}

2889 
$ECHO
 "\
 \"\$progdir/\$program\" \${1+\"\$@\"}

2893 
e§c


2894 
$ECHO
 "\
\$ECHO \"\$0: cannotƒxec \$program \$*\" 1>&2

2896 
ex™
 1

2897 
fi


2899 #Th
´og¿m
 
dÛ¢
'tƒxist.

2900 \
$ECHO
 \"\$0:ƒrror: \\\`\$progdir/\$program' does‚otƒxist\" 1>&2

2901 \
$ECHO
 \"This script is just‡ wrapper for \$program.\" 1>&2

2902 
$ECHO
 \"Seehe $PACKAGE documentation for more information.\" 1>&2

2903 
ex™
 1

2904 
fi


2905 
fi
\

2908 #’d: 
func_em™_w¿µ”_·¹2


2911 #func_em™_w¿µ” [
¬g
=
no
]

2912 #
#Em™ 
a
 
libtoŞ
 
w¿µ”
 
süt
 
Ú
 
¡dout
.

2914 #šcÜpÜ©
the
 
süt
 
cÚ‹Ás
 
w™hš
 
a
 
cygwš
/
mšgw


2915 #w¿µ” 
execubË
. 
Mu¡
 
ONLY
 
be
 
ÿÎed
 
äom
 
w™hš


2916 #func_mode_lšk 
beÿu£
 
™
 
d•’ds
 
Ú
 
a
 
numb”
 
of
 
v¬ŸbËs


2917 #£ˆ
th”eš
.

2918 #
#ARG 
is
 
the
 
v®ue
 
th©
h
WRAPPER_SCRIPT_BELONGS_IN_OBJDIR


2919 #v¬ŸbË 
wl
 
ke
. 
If
 'yes', 
th’
 
the
 
em™‹d
 
süt


2920 #wÈ
assume
 
th©
 
the
 
dœeùÜy
 
š
 
which
 
™
 
is
 
¡Üed
 is

2921 #th
$objdœ
 
dœeùÜy
. 
This
 
is
 
a
 
cygwš
/
mšgw
-
¥ecific


2923 
	`func_em™_w¿µ”
 ()

2925 
func_em™_w¿µ”_¬g1
=
no


2926 
‹¡
 -
n
 "$1" ; 
th’


2927 
func_em™_w¿µ”_¬g1
=
$1


2928 
fi


2930 #¥l™ 
this
 
up
 
so
 
th©
 
func_em™_cw¿µ”exe_¤c


2931 #ÿÀ
ÿÎ
 
—ch
 
·¹
 
šd•’d’y
.

2932 
func_em™_w¿µ”_·¹1
 "${func_emit_wrapper_arg1}"

2933 
func_em™_w¿µ”_·¹2
 "${func_emit_wrapper_arg1}"

2937 #func_to_ho¡_·th 
¬g


2938 #
#CÚv”ˆ
·ths
 
to
 
ho¡
 
fÜm©
 
wh’
 
u£d
 
w™h
 
bud
 
toŞs
.

2939 #IÁ’ded 
u£
 
w™h
 "Çtive" 
	`mšgw
 (
wh”e
 
libtoŞ
 
™£lf


2940 #i 
ruÂšg
 
und”
 
the
 
msys
 
sh–l
), 
Ü
 
š
h
fŞlowšg
 
üoss
-

2941 #bud 
’vœÚm’ts
:

2942 #$bud 
$ho¡


2943 #mšgw (
msys
è
mšgw
 [
e
.
g
. 
Çtive
]

2944 #cygwš 
mšgw


2945 #*
nix
 + 
wše
 
mšgw


2946 #wh”
wše
 
is
 
equ³d
 
w™h
 
the
 `
wš•©h
'ƒxecutable.

2947 #IÀ
the
 
Çtive
 
mšgw
 , 
	`the
 (
msys
è
sh–l
 
autom©iÿÎy


2948 #cÚv”t 
·ths
 
ªy
 
nÚ
-
msys
 
­¶iÿtiÚs
 
™
 
Ïunches
,

2949 #buˆ
th©
 
çc™y
 
i¢
't‡vailable from insidehe cwrapper.

2950 #Sim¬ 
accommod©iÚs
 
¬e
 
Ãûs§ry
 
$ho¡
 
mšgw
 
ªd


2951 #$bud 
cygwš
. 
C®lšg
 
this
 
funùiÚ
 
dÛs
 
no
 
h¬m
 
Ùh”


2952 #$ho¡/
$bud
 
combš©iÚs
 
nÙ
 
li¡ed
 
above
.

2953 #
#ARG 
is
 
the
 
	`·th
 (
Ú
 
$bud
è
th©
 
should
 
be
 
cÚv”‹d
 
to


2954 #th
´İ”
 
»´e£Á©iÚ
 
$ho¡
. 
The
 
»suÉ
 
is
 
¡Üed


2955 #š 
$func_to_ho¡_·th_»suÉ
.

2956 
	`func_to_ho¡_·th
 ()

2958 
func_to_ho¡_·th_»suÉ
="$1"

2959 
‹¡
 -
n
 "$1" ; 
th’


2960 
$ho¡
 
š


2961 *
mšgw
* )

2962 
É_£d_Çive_back¦ashify
='s|\\\\*|\\|g;s|/|\\|g;s|\\|\\\\|g'

2963 
$bud
 
š


2964 *
mšgw
* ) #aùu®ly, 
msys


2965 #awkw¬d: 
cmd
 
­³nds
 
¥aûs
 
to
 
»suÉ


2966 
É_£d_¡r_Œašg_¥aûs
="s/[ ]*\$//"

2967 
func_to_ho¡_·th_tmp1
=`Ğ
cmd


2968 
$SED
 -
e
 "$É_£d_¡r_Œašg_¥aûs" ) 2>/
dev
/
nuÎ
 || 
echo
 ""`

2969 
func_to_ho¡_·th_»suÉ
=`
echo
 "$func_to_host_path_tmp1" |\

2970 
$SED
 -
e
 "$lt_sed_naive_backslashify"`

2972 *
cygwš
* )

2973 
func_to_ho¡_·th_tmp1
=`
cyg·th
 -
w
 "$1"`

2974 
func_to_ho¡_·th_»suÉ
=`
echo
 "$func_to_host_path_tmp1" |\

2975 
$SED
 -
e
 "$lt_sed_naive_backslashify"`

2978 #UnfÜtuÇ‹ly, 
wš•©h
 
dÛs
 
nÙ
 
ex™
 
w™h
 
a
 
nÚ
-
z”o


2979 #”rÜ 
code
, 
so
 
we
 
¬e
 
fÜûd
 
to
 
check
 
the
 
cÚ‹Ás
 
of


2980 #¡dout. 
On
 
the
 
Ùh”
 
hªd
, th
commªd
 
is
 
nÙ


2981 #found, 
the
 
sh–l
 
wl
 
£t
 
ª
 
ex™
 
code
 
of
 127 
ªd
 
´št


2982 #*
ª
 
”rÜ
 
mes§ge
* 
to
 
¡dout
. 
So
 
we
 
mu¡
 
check
 
bÙh


2983 #”rÜ 
code
 
of
 
z”o
 
AND
 
nÚ
-
em±y
 
¡dout
, 
which
 
ex¶ašs


2984 #th
odd
 
cÚ¡ruùiÚ
:

2985 
func_to_ho¡_·th_tmp1
=`
wš•©h
 -
w
 "$1" 2>/
dev
/
nuÎ
`

2986 
‹¡
 "$?" -
eq
 0 &&e¡ -
n
 "${func_to_ho¡_·th_tmp1}"; 
th’


2987 
func_to_ho¡_·th_»suÉ
=`
echo
 "$func_to_host_path_tmp1" |\

2988 
$SED
 -
e
 "$lt_sed_naive_backslashify"`

2990 #AÎow 
w¬nšg
 
b–ow
.

2991 
func_to_ho¡_·th_»suÉ
=""

2992 
fi


2994 
e§c


2995 
‹¡
 -
z
 "$func_to_ho¡_·th_»suÉ" ; 
th’


2996 
func_”rÜ
 "Could‚ot determine host…ath correspondingo"

2997 
func_”rÜ
 " '$1'"

2998 
func_”rÜ
 "Continuing, but uninstalledƒxecutables may‚ot work."

3000 
func_to_ho¡_·th_»suÉ
="$1"

3001 
fi


3003 
e§c


3004 
fi


3006 #’d: 
func_to_ho¡_·th


3008 #func_to_ho¡_·thli¡ 
¬g


3009 #
#CÚv”ˆ
·thli¡s
 
to
 
ho¡
 
fÜm©
 
wh’
 
u£d
 
w™h
 
bud
 
toŞs
.

3010 #S“ 
	`func_to_ho¡_·th
(), 
above
. 
This
 
funùiÚ
 
suµÜts
 
the


3011 #fŞlowšg 
$bud
/
$ho¡
 
	`combš©iÚs
 (
but
 
dÛs
 
no
 
h¬m
 

3012 #combš©iÚ 
nÙ
 
li¡ed
 
h”e
):

3013 #$bud 
$ho¡


3014 #mšgw (
msys
è
mšgw
 [
e
.
g
. 
Çtive
]

3015 #cygwš 
mšgw


3016 #*
nix
 + 
wše
 
mšgw


3017 #
#P©h 
£·¿tÜs
 
¬e
 
®so
 
cÚv”‹d
 
äom
 
$bud
 
fÜm©
 
to


3018 #$ho¡ 
fÜm©
. 
If
 
ARG
 
begšs
 
Ü
 
’ds
 
w™h
 
a
 
·th
 
£·¿tÜ


3019 #ch¬aù”, 
™
 
is
 
	`´e£rved
 (
but
 
cÚv”‹d
 
to
 
$ho¡
 
fÜm©
)

3020 #Ú 
ouut
.

3021 #
#ARG 
is
 
a
 
	`·thli¡
 (
Ú
 
$bud
è
th©
 
should
 
be
 
cÚv”‹d
 
to


3022 #th
´İ”
 
»´e£Á©iÚ
 
Ú
 
$ho¡
. 
The
 
»suÉ
 
is
 
¡Üed


3023 #š 
$func_to_ho¡_·thli¡_»suÉ
.

3024 
	`func_to_ho¡_·thli¡
 ()

3026 
func_to_ho¡_·thli¡_»suÉ
="$1"

3027 
‹¡
 -
n
 "$1" ; 
th’


3028 
$ho¡
 
š


3029 *
mšgw
* )

3030 
É_£d_Çive_back¦ashify
='s|\\\\*|\\|g;s|/|\\|g;s|\\|\\\\|g'

3031 #Remov
Ëadšg
 
ªd
 
Œašg
 
·th
 
£·¿tÜ
 
ch¬aù”s
 
äom


3032 #ARG. 
msys
 
behaviÜ
 
is
 
šcÚsi¡’t
 
h”e
, 
cyg·th
 
tuºs
 
them


3033 #štØ'.;' 
ªd
 ';.',‡nd 
wš•©h
 
ignÜes
 
them
 
com¶‘–y
.

3034 
func_to_ho¡_·thli¡_tmp2
="$1"

3035 #Onû 
£t
 
this
 
ÿÎ
,hi 
v¬ŸbË
 
should
 
nÙ
 
be


3036 #»assigÃd. 
It
 
is
 
u£d
 
š
 
tha
 
çÎback
 .

3037 
func_to_ho¡_·thli¡_tmp1
=`
echo
 "$func_to_host_pathlist_tmp2" |\

3038 
$SED
 -
e
 's|^:*||' -e 's|:*$||'`

3039 
$bud
 
š


3040 *
mšgw
* ) #Aùu®ly, 
msys
.

3041 #Awkw¬d: 
cmd
 
­³nds
 
¥aûs
 
to
 
»suÉ
.

3042 
É_£d_¡r_Œašg_¥aûs
="s/[ ]*\$//"

3043 
func_to_ho¡_·thli¡_tmp2
=`Ğ
cmd


3044 
$SED
 -
e
 "$É_£d_¡r_Œašg_¥aûs" ) 2>/
dev
/
nuÎ
 || 
echo
 ""`

3045 
func_to_ho¡_·thli¡_»suÉ
=`
echo
 "$func_to_host_pathlist_tmp2" |\

3046 
$SED
 -
e
 "$lt_sed_naive_backslashify"`

3048 *
cygwš
* )

3049 
func_to_ho¡_·thli¡_tmp2
=`
cyg·th
 -
w
 -
p
 "$func_to_host_pathlist_tmp1"`

3050 
func_to_ho¡_·thli¡_»suÉ
=`
echo
 "$func_to_host_pathlist_tmp2" |\

3051 
$SED
 -
e
 "$lt_sed_naive_backslashify"`

3054 #unfÜtuÇ‹ly, 
wš•©h
 
dÛ¢
't convert…athlists

3055 
func_to_ho¡_·thli¡_»suÉ
=""

3056 
func_to_ho¡_·thli¡_ŞdIFS
=
$IFS


3057 
IFS
=:

3058 
func_to_ho¡_·thli¡_f
 
š
 
$func_to_ho¡_·thli¡_tmp1
 ; do

3059 
IFS
=
$func_to_ho¡_·thli¡_ŞdIFS


3060 
‹¡
 -
n
 "$func_to_ho¡_·thli¡_f" ; 
th’


3061 
func_to_ho¡_·th
 "$func_to_host_pathlist_f"

3062 
‹¡
 -
n
 "$func_to_ho¡_·th_»suÉ" ; 
th’


3063 
‹¡
 -
z
 "$func_to_ho¡_·thli¡_»suÉ" ; 
th’


3064 
func_to_ho¡_·thli¡_»suÉ
="$func_to_host_path_result"

3066 
func_to_ho¡_·thli¡_»suÉ
="$func_to_host_pathlist_result;$func_to_host_path_result"

3067 
fi


3068 
fi


3069 
fi


3070 
IFS
=:

3071 
dÚe


3072 
IFS
=
$func_to_ho¡_·thli¡_ŞdIFS


3074 
e§c


3075 
‹¡
 -
z
 "$func_to_ho¡_·thli¡_»suÉ" ; 
th’


3076 
func_”rÜ
 "Could‚ot determinehe host…ath(s) correspondingo"

3077 
func_”rÜ
 " '$1'"

3078 
func_”rÜ
 "Continuing, but uninstalledƒxecutables may‚ot work."

3079 #F®lback. 
This
 
may
  
$1
 
cÚšs
 
DOS
-
¡yË
 
drive


3080 #¥ecifiÿtiÚs. 
The
 
fix
 
is
 
nÙ
 
to
 
com¶iÿ‹
 
the
 
ex´essiÚ


3081 #b–ow, 
but
 
the
 
u£r
 
to
 
´ovide
 
a
 
wÜkšg
 
wše
 
š¡®ÏtiÚ


3082 #w™h 
wš•©h
 
so
 
th©
 
·th
 
Œª¦©iÚ
 
š
 
the
 
üoss
-
to
-
mšgw


3083 #ÿ£ 
wÜks
 
´İ”ly
.

3084 
É_»¶aû_·th£p_nix_to_dos
="s|:|;|g"

3085 
func_to_ho¡_·thli¡_»suÉ
=`
echo
 "$func_to_host_pathlist_tmp1" |\

3086 
$SED
 -
e
 "$lt_replace_pathsep_nix_to_dos"`

3087 
fi


3088 #Now, 
add
 
the
 
Ëadšg
 
ªd
 
Œašg
 
·th
 
£·¿tÜs
 
back


3089 "$1" 
š


3090 :* ) 
func_to_ho¡_·thli¡_»suÉ
=";$func_to_host_pathlist_result"

3092 
e§c


3093 "$1" 
š


3094 *: ) 
func_to_ho¡_·thli¡_»suÉ
="$func_to_host_pathlist_result;"

3096 
e§c


3098 
e§c


3099 
fi


3101 #’d: 
func_to_ho¡_·thli¡


3104 #em™ 
the
 
sourû
 
code
 
a
 
w¿µ”
 
execubË
 
Ú
 
¡dout


3105 #Mu¡ 
ONLY
 
be
 
ÿÎed
 
äom
 
w™hš
 
func_mode_lšk
 
beÿu£


3106 #™ 
d•’ds
 
Ú
 
a
 
numb”
 
of
 
v¬ŸbË
 
£t
 
th”eš
.

3107 
	`func_em™_cw¿µ”exe_¤c
 ()

3109 
ÿt
 <<
EOF


3124 
EOF


3125 
ÿt
 <<"EOF"

3126 
	~<¡dio.h
>

3127 
	~<¡dlib.h
>

3128 #ifdeà
_MSC_VER


3129 
	~<dœeù.h
>

3130 
	~<´oûss.h
>

3131 
	~<io.h
>

3132 
	#£tmode
 
_£tmode


	)

3134 
	~<uni¡d.h
>

3135 
	~<¡dšt.h
>

3136 #ifdeà
__CYGWIN__


3137 
	~<io.h
>

3138 
	#HAVE_SETENV


	)

3139 #ifdeà
__STRICT_ANSI__


3140 *
	`»®·th
 (const *, *);

3141 
	`pu‹nv
 (*);

3142 
	`£‹nv
 (const *, const *, );

3146 
	~<m®loc.h
>

3147 
	~<¡d¬g.h
>

3148 
	~<as£¹.h
>

3149 
	~<¡ršg.h
>

3150 
	~<ùy³.h
>

3151 
	~<”ºo.h
>

3152 
	~<fú.h
>

3153 
	~<sys/¡©.h
>

3155 #ià
	`defšed
(
PATH_MAX
)

3156 
	#LT_PATHMAX
 
PATH_MAX


	)

3157 #–ià
	`defšed
(
MAXPATHLEN
)

3158 
	#LT_PATHMAX
 
MAXPATHLEN


	)

3160 
	#LT_PATHMAX
 1024

	)

3163 #iâdeà
S_IXOTH


3164 
	#S_IXOTH
 0

	)

3166 #iâdeà
S_IXGRP


3167 
	#S_IXGRP
 0

	)

3170 #ifdeà
_MSC_VER


3171 
	#S_IXUSR
 
_S_IEXEC


	)

3172 
	#¡©
 
_¡©


	)

3173 #iâdeà
_INTPTR_T_DEFINED


3174 
	#šŒ_t
 

	)

3178 #iâdeà
DIR_SEPARATOR


3179 
	#DIR_SEPARATOR
 '/'

	)

3180 
	#PATH_SEPARATOR
 ':'

	)

3183 #ià
	`defšed
 (
_WIN32
è|| defšed (
__MSDOS__
è|| defšed (
__DJGPP__
) || \

3184 
	`defšed
 (
__OS2__
)

3185 
	#HAVE_DOS_BASED_FILE_SYSTEM


	)

3186 
	#FOPEN_WB
 "wb"

	)

3187 #iâdeà
DIR_SEPARATOR_2


3188 
	#DIR_SEPARATOR_2
 '\\'

	)

3190 #iâdeà
PATH_SEPARATOR_2


3191 
	#PATH_SEPARATOR_2
 ';'

	)

3195 #iâdeà
DIR_SEPARATOR_2


3196 
	#IS_DIR_SEPARATOR
(
ch
è((chè=ğ
DIR_SEPARATOR
)

	)

3198 
	#IS_DIR_SEPARATOR
(
ch
) \

3199 (((
ch
è=ğ
DIR_SEPARATOR
è|| ((chè=ğ
DIR_SEPARATOR_2
))

	)

3202 #iâdeà
PATH_SEPARATOR_2


3203 
	#IS_PATH_SEPARATOR
(
ch
è((chè=ğ
PATH_SEPARATOR
)

	)

3205 
	#IS_PATH_SEPARATOR
(
ch
è((chè=ğ
PATH_SEPARATOR_2
)

	)

3208 #ifdeà
__CYGWIN__


3209 
	#FOPEN_WB
 "wb"

	)

3212 #iâdeà
FOPEN_WB


3213 
	#FOPEN_WB
 "w"

	)

3215 #iâdeà
_O_BINARY


3216 
	#_O_BINARY
 0

	)

3219 
	#XMALLOC
(
ty³
, 
num
è(Ñy³ *è
	`xm®loc
 (Òumè* Ñy³)))

	)

3220 
	#XFREE
(
¡®e
) do { \

3221 ià(
¡®e
è{ 
	`ä“
 ((*) stale); stale = 0; } \

3222 } 0)

	)

3224 #undeà
LTWRAPPER_DEBUGPRINTF


3225 #ià
defšed
 
DEBUGWRAPPER


3226 
	#LTWRAPPER_DEBUGPRINTF
(
¬gs
è
Éw¿µ”_debug´štf
 
	)
args

3228 
	`Éw¿µ”_debug´štf
 (cÚ¡ *
fmt
, ...)

3230 
va_li¡
 
¬gs
;

3231 
	`va_¡¬t
 (
¬gs
, 
fmt
);

3232 (è
	`vårštf
 (
¡d”r
, 
fmt
, 
¬gs
);

3233 
	`va_’d
 (
¬gs
);

3236 
	#LTWRAPPER_DEBUGPRINTF
(
¬gs
)

	)

3239 cÚ¡ *
´og¿m_Çme
 = 
NULL
;

3241 *
	`xm®loc
 (
size_t
 
num
);

3242 *
	`x¡rdup
 (cÚ¡ *
¡ršg
);

3243 cÚ¡ *
	`ba£_Çme
 (cÚ¡ *
Çme
);

3244 *
	`fšd_execubË
 (cÚ¡ *
w¿µ”
);

3245 *
	`cha£_symlšks
 (cÚ¡ *
·th¥ec
);

3246 
	`make_execubË
 (cÚ¡ *
·th
);

3247 
	`check_execubË
 (cÚ¡ *
·th
);

3248 *
	`¡»ndz­
 (*
¡r
, cÚ¡ *
·t
);

3249 
	`É_çl
 (cÚ¡ *
mes§ge
, ...);

3250 
	`É_£‹nv
 (cÚ¡ *
Çme
, cÚ¡ *
v®ue
);

3251 *
	`É_ex‹nd_¡r
 (cÚ¡ *
Üig_v®ue
, cÚ¡ *
add
, 
to_’d
);

3252 
	`É_İt_´oûss_’v_£t
 (cÚ¡ *
¬g
);

3253 
	`É_İt_´oûss_’v_´•’d
 (cÚ¡ *
¬g
);

3254 
	`É_İt_´oûss_’v_­³nd
 (cÚ¡ *
¬g
);

3255 
	`É_¥l™_Çme_v®ue
 (cÚ¡ *
¬g
, ** 
Çme
, ** 
v®ue
);

3256 
	`É_upd©e_exe_·th
 (cÚ¡ *
Çme
, cÚ¡ *
v®ue
);

3257 
	`É_upd©e_lib_·th
 (cÚ¡ *
Çme
, cÚ¡ *
v®ue
);

3259 cÚ¡ *
süt_‹xt_·¹1
 =

3260 
EOF


3262 
func_em™_w¿µ”_·¹1
 
yes
 |

3263 
$SED
 -
e
 's/\([\\"]\)/\\\1/g' \

3264 -
e
 's/^/ "/' -e 's/$/\\n"/'

3265 
echo
 ";"

3266 
ÿt
 <<
EOF


3268 cÚ¡ *
süt_‹xt_·¹2
 =

3269 
EOF


3270 
func_em™_w¿µ”_·¹2
 
yes
 |

3271 
$SED
 -
e
 's/\([\\"]\)/\\\1/g' \

3272 -
e
 's/^/ "/' -e 's/$/\\n"/'

3273 
echo
 ";"

3275 
ÿt
 <<
EOF


3276 cÚ¡ * 
MAGIC_EXE
 = "$magic_exe";

3277 cÚ¡ * 
LIB_PATH_VARNAME
 = "$shlibpath_var";

3278 
EOF


3280 
‹¡
 "$shlib·th_ov”rides_ruÅ©h" = 
yes
 &&e¡ -
n
 "$shlib·th_v¬" &&e¡ -À"$‹mp_½©h"; 
th’


3281 
func_to_ho¡_·thli¡
 "$temp_rpath"

3282 
ÿt
 <<
EOF


3283 cÚ¡ * 
LIB_PATH_VALUE
 = "$func_to_host_pathlist_result";

3284 
EOF


3286 
ÿt
 <<"EOF"

3287 cÚ¡ * 
LIB_PATH_VALUE
 = "";

3288 
EOF


3289 
fi


3291 
‹¡
 -
n
 "$dÎ£¬ch·th"; 
th’


3292 
func_to_ho¡_·thli¡
 "$dllsearchpath:"

3293 
ÿt
 <<
EOF


3294 cÚ¡ * 
EXE_PATH_VARNAME
 = "PATH";

3295 cÚ¡ * 
EXE_PATH_VALUE
 = "$func_to_host_pathlist_result";

3296 
EOF


3298 
ÿt
 <<"EOF"

3299 cÚ¡ * 
EXE_PATH_VARNAME
 = "";

3300 cÚ¡ * 
EXE_PATH_VALUE
 = "";

3301 
EOF


3302 
fi


3304 
‹¡
 "$ç¡_š¡®l" = 
yes
; 
th’


3305 
ÿt
 <<
EOF


3306 cÚ¡ * 
TARGET_PROGRAM_NAME
 = "lt-$outputname";

3307 
EOF


3309 
ÿt
 <<
EOF


3310 cÚ¡ * 
TARGET_PROGRAM_NAME
 = "$outputname";

3311 
EOF


3312 
fi


3315 
ÿt
 <<"EOF"

3317 
	#LTWRAPPER_OPTION_PREFIX
 "--É-"

	)

3318 
	#LTWRAPPER_OPTION_PREFIX_LENGTH
 5

	)

3320 cÚ¡ 
size_t
 
İt_´efix_Ën
 = 
LTWRAPPER_OPTION_PREFIX_LENGTH
;

3321 cÚ¡ *
Éw¿µ”_İtiÚ_´efix
 = 
LTWRAPPER_OPTION_PREFIX
;

3323 cÚ¡ *
dumpsüt_İt
 = 
LTWRAPPER_OPTION_PREFIX
 "dump-script";

3325 cÚ¡ 
size_t
 
’v_£t_İt_Ën
 = 
LTWRAPPER_OPTION_PREFIX_LENGTH
 + 7;

3326 cÚ¡ *
’v_£t_İt
 = 
LTWRAPPER_OPTION_PREFIX
 "env-set";

3329 cÚ¡ 
size_t
 
’v_´•’d_İt_Ën
 = 
LTWRAPPER_OPTION_PREFIX_LENGTH
 + 11;

3330 cÚ¡ *
’v_´•’d_İt
 = 
LTWRAPPER_OPTION_PREFIX
 "env-prepend";

3333 cÚ¡ 
size_t
 
’v_­³nd_İt_Ën
 = 
LTWRAPPER_OPTION_PREFIX_LENGTH
 + 10;

3334 cÚ¡ *
’v_­³nd_İt
 = 
LTWRAPPER_OPTION_PREFIX
 "env-append";

3338 
	`maš
 (
¬gc
, *
¬gv
[])

3340 **
Ãw¬gz
;

3341 
Ãw¬gc
;

3342 *
tmp_·th¥ec
;

3343 *
aùu®_cw¿µ”_·th
;

3344 *
aùu®_cw¿µ”_Çme
;

3345 *
rg‘_Çme
;

3346 *
É_¬gv_z”o
;

3347 
šŒ_t
 
rv®
 = 127;

3349 
i
;

3351 
´og¿m_Çme
 = (*è
	`x¡rdup
 (
	`ba£_Çme
 (
¬gv
[0]));

3352 
	`LTWRAPPER_DEBUGPRINTF
 (("(mašè¬gv[0] : %s\n", 
¬gv
[0]));

3353 
	`LTWRAPPER_DEBUGPRINTF
 (("(mašè´og¿m_Çm: %s\n", 
´og¿m_Çme
));

3356 
i
 = 1; i < 
¬gc
; i++)

3358 ià(
	`¡rcmp
 (
¬gv
[
i
], 
dumpsüt_İt
) == 0)

3360 
EOF


3361 "$ho¡" 
š


3362 *
mšgw
* | *
cygwš
* )

3363 #mak
¡dout
 
u£
 "unix" 
lše
 
’dšgs


3364 
echo
 " setmode(1,_O_BINARY);"

3366 
e§c


3368 
ÿt
 <<"EOF"

3369 
	`´štf
 ("%s", 
süt_‹xt_·¹1
);

3370 
	`´štf
 ("%s", 
süt_‹xt_·¹2
);

3375 
Ãw¬gz
 = 
	`XMALLOC
 (*, 
¬gc
 + 1);

3376 
tmp_·th¥ec
 = 
	`fšd_execubË
 (
¬gv
[0]);

3377 ià(
tmp_·th¥ec
 =ğ
NULL
)

3378 
	`É_çl
 ("Couldn'ˆfšd %s", 
¬gv
[0]);

3379 
	`LTWRAPPER_DEBUGPRINTF
 (("(main) foundƒxe (before symlink chase)‡t : %s\n",

3380 
tmp_·th¥ec
));

3382 
aùu®_cw¿µ”_·th
 = 
	`cha£_symlšks
 (
tmp_·th¥ec
);

3383 
	`LTWRAPPER_DEBUGPRINTF
 (("(main) foundƒxe (after symlink chase)‡t : %s\n",

3384 
aùu®_cw¿µ”_·th
));

3385 
	`XFREE
 (
tmp_·th¥ec
);

3387 
aùu®_cw¿µ”_Çme
 = 
	`x¡rdup
Ğ
	`ba£_Çme
 (
aùu®_cw¿µ”_·th
));

3388 
	`¡»ndz­
 (
aùu®_cw¿µ”_·th
, 
aùu®_cw¿µ”_Çme
);

3391 
	`¡»ndz­
 (
aùu®_cw¿µ”_Çme
, ".exe");

3392 
tmp_·th¥ec
 = 
	`É_ex‹nd_¡r
 (
aùu®_cw¿µ”_Çme
, ".exe", 1);

3393 
	`XFREE
 (
aùu®_cw¿µ”_Çme
);

3394 
aùu®_cw¿µ”_Çme
 = 
tmp_·th¥ec
;

3395 
tmp_·th¥ec
 = 0;

3398 
rg‘_Çme
 = 
	`x¡rdup
 (
	`ba£_Çme
 (
TARGET_PROGRAM_NAME
));

3399 
	`¡»ndz­
 (
rg‘_Çme
, ".exe");

3400 
tmp_·th¥ec
 = 
	`É_ex‹nd_¡r
 (
rg‘_Çme
, ".exe", 1);

3401 
	`XFREE
 (
rg‘_Çme
);

3402 
rg‘_Çme
 = 
tmp_·th¥ec
;

3403 
tmp_·th¥ec
 = 0;

3405 
	`LTWRAPPER_DEBUGPRINTF
 (("(main)†ibtoolarget‚ame: %s\n",

3406 
rg‘_Çme
));

3407 
EOF


3409 
ÿt
 <<
EOF


3410 
Ãw¬gz
[0] =

3411 
	`XMALLOC
 (, (
	`¡¾’
 (
aùu®_cw¿µ”_·th
) +

3412 
	`¡¾’
 ("$objdœ"è+ 1 + sŒËÀ(
aùu®_cw¿µ”_Çme
) + 1));

3413 
	`¡rıy
 (
Ãw¬gz
[0], 
aùu®_cw¿µ”_·th
);

3414 
	`¡rÿt
 (
Ãw¬gz
[0], "$objdir");

3415 
	`¡rÿt
 (
Ãw¬gz
[0], "/");

3416 
EOF


3418 
ÿt
 <<"EOF"

3420 
tmp_·th¥ec
 = 
	`x¡rdup
 (
Ãw¬gz
[0]);

3423 
	`¡rÿt
 (
Ãw¬gz
[0], 
aùu®_cw¿µ”_Çme
);

3426 
É_¬gv_z”o
 = 
	`É_ex‹nd_¡r
 (
tmp_·th¥ec
, 
rg‘_Çme
, 1);

3427 
	`XFREE
 (
tmp_·th¥ec
);

3428 
tmp_·th¥ec
 = 
NULL
;

3429 
EOF


3431 
$ho¡_os
 
š


3432 
mšgw
*)

3433 
ÿt
 <<"EOF"

3435 * 
p
;

3436 (
p
 = 
	`¡rchr
 (
Ãw¬gz
[0], '\\')è!ğ
NULL
)

3438 *
p
 = '/';

3440 (
p
 = 
	`¡rchr
 (
É_¬gv_z”o
, '\\')è!ğ
NULL
)

3442 *
p
 = '/';

3445 
EOF


3447 
e§c


3449 
ÿt
 <<"EOF"

3450 
	`XFREE
 (
rg‘_Çme
);

3451 
	`XFREE
 (
aùu®_cw¿µ”_·th
);

3452 
	`XFREE
 (
aùu®_cw¿µ”_Çme
);

3454 
	`É_£‹nv
 ("BIN_SH", "xpg4");

3455 
	`É_£‹nv
 ("DUALCASE", "1");

3456 
	`É_upd©e_lib_·th
 (
LIB_PATH_VARNAME
, 
LIB_PATH_VALUE
);

3457 
	`É_upd©e_exe_·th
 (
EXE_PATH_VARNAME
, 
EXE_PATH_VALUE
);

3459 
Ãw¬gc
=0;

3460 
i
 = 1; i < 
¬gc
; i++)

3462 ià(
	`¡ºcmp
 (
¬gv
[
i
], 
’v_£t_İt
, 
’v_£t_İt_Ën
) == 0)

3464 ià(
¬gv
[
i
][
’v_£t_İt_Ën
] == '=')

3466 cÚ¡ *
p
 = 
¬gv
[
i
] + 
’v_£t_İt_Ën
 + 1;

3467 
	`É_İt_´oûss_’v_£t
 (
p
);

3469 ià(
¬gv
[
i
][
’v_£t_İt_Ën
] =ğ'\0' && i + 1 < 
¬gc
)

3471 
	`É_İt_´oûss_’v_£t
 (
¬gv
[++
i
]);

3474 
	`É_çl
 ("% missšg„equœed‡rgum’t", 
’v_£t_İt
);

3477 ià(
	`¡ºcmp
 (
¬gv
[
i
], 
’v_´•’d_İt
, 
’v_´•’d_İt_Ën
) == 0)

3479 ià(
¬gv
[
i
][
’v_´•’d_İt_Ën
] == '=')

3481 cÚ¡ *
p
 = 
¬gv
[
i
] + 
’v_´•’d_İt_Ën
 + 1;

3482 
	`É_İt_´oûss_’v_´•’d
 (
p
);

3484 ià(
¬gv
[
i
][
’v_´•’d_İt_Ën
] =ğ'\0' && i + 1 < 
¬gc
)

3486 
	`É_İt_´oûss_’v_´•’d
 (
¬gv
[++
i
]);

3489 
	`É_çl
 ("% missšg„equœed‡rgum’t", 
’v_´•’d_İt
);

3492 ià(
	`¡ºcmp
 (
¬gv
[
i
], 
’v_­³nd_İt
, 
’v_­³nd_İt_Ën
) == 0)

3494 ià(
¬gv
[
i
][
’v_­³nd_İt_Ën
] == '=')

3496 cÚ¡ *
p
 = 
¬gv
[
i
] + 
’v_­³nd_İt_Ën
 + 1;

3497 
	`É_İt_´oûss_’v_­³nd
 (
p
);

3499 ià(
¬gv
[
i
][
’v_­³nd_İt_Ën
] =ğ'\0' && i + 1 < 
¬gc
)

3501 
	`É_İt_´oûss_’v_­³nd
 (
¬gv
[++
i
]);

3504 
	`É_çl
 ("% missšg„equœed‡rgum’t", 
’v_­³nd_İt
);

3507 ià(
	`¡ºcmp
 (
¬gv
[
i
], 
Éw¿µ”_İtiÚ_´efix
, 
İt_´efix_Ën
) == 0)

3518 
	`É_çl
 ("Unrecognized option in %s‚amespace: '%s'",

3519 
Éw¿µ”_İtiÚ_´efix
, 
¬gv
[
i
]);

3522 
Ãw¬gz
[++
Ãw¬gc
] = 
	`x¡rdup
 (
¬gv
[
i
]);

3524 
Ãw¬gz
[++
Ãw¬gc
] = 
NULL
;

3526 
	`LTWRAPPER_DEBUGPRINTF
 (("(mašèÉ_¬gv_z”Ø: %s\n", (
É_¬gv_z”o
 ?†t_argv_zero : "<NULL>")));

3527 
i
 = 0; i < 
Ãw¬gc
; i++)

3529 
	`LTWRAPPER_DEBUGPRINTF
 (("(mašèÃw¬gz[%d] : %s\n", 
i
, (
Ãw¬gz
[i] ?‚ewargz[i] : "<NULL>")));

3532 
EOF


3534 
$ho¡_os
 
š


3535 
mšgw
*)

3536 
ÿt
 <<"EOF"

3538 
rv®
 = 
	`_¥awnv
 (
_P_WAIT
, 
É_¬gv_z”o
, (cÚ¡ * cÚ¡ *è
Ãw¬gz
);

3539 ià(
rv®
 == -1)

3542 
	`LTWRAPPER_DEBUGPRINTF
 (("(mašèçedØÏunch¬g‘ \"%s\":ƒ¼nØğ%d\n", 
É_¬gv_z”o
, 
”ºo
));

3545  
rv®
;

3546 
EOF


3549 
ÿt
 <<"EOF"

3550 
	`execv
 (
É_¬gv_z”o
, 
Ãw¬gz
);

3551  
rv®
;

3552 
EOF


3554 
e§c


3556 
ÿt
 <<"EOF"

3560 
	`xm®loc
 (
size_t
 
num
)

3562 *
p
 = (*è
	`m®loc
 (
num
);

3563 ià(!
p
)

3564 
	`É_çl
 ("Memoryƒxhausted");

3566  
p
;

3570 
	`x¡rdup
 (cÚ¡ *
¡ršg
)

3572  
¡ršg
 ? 
	`¡rıy
 ((*è
	`xm®loc
 (
	`¡¾’
 (string) + 1),

3573 
¡ršg
è: 
NULL
;

3577 
	`ba£_Çme
 (cÚ¡ *
Çme
)

3579 cÚ¡ *
ba£
;

3581 #ià
	`defšed
 (
HAVE_DOS_BASED_FILE_SYSTEM
)

3583 ià(
	`i§Íha
 ((è
Çme
[0]) &&‚ame[1] == ':')

3584 
Çme
 += 2;

3587 
ba£
 = 
Çme
; *name;‚ame++)

3588 ià(
	`IS_DIR_SEPARATOR
 (*
Çme
))

3589 
ba£
 = 
Çme
 + 1;

3590  
ba£
;

3594 
	`check_execubË
 (cÚ¡ *
·th
)

3596 
¡©
 
¡
;

3598 
	`LTWRAPPER_DEBUGPRINTF
 (("(check_executable) : %s\n",

3599 
·th
 ? (*path ?…ath : "EMPTY!") : "NULL!"));

3600 ià((!
·th
) || (!*path))

3603 ià((
	`¡©
 (
·th
, &
¡
) >= 0)

3604 && (
¡
.
¡_mode
 & (
S_IXUSR
 | 
S_IXGRP
 | 
S_IXOTH
)))

3611 
	`make_execubË
 (cÚ¡ *
·th
)

3613 
rv®
 = 0;

3614 
¡©
 
¡
;

3616 
	`LTWRAPPER_DEBUGPRINTF
 (("(make_executable) : %s\n",

3617 
·th
 ? (*path ?…ath : "EMPTY!") : "NULL!"));

3618 ià((!
·th
) || (!*path))

3621 ià(
	`¡©
 (
·th
, &
¡
) >= 0)

3623 
rv®
 = 
	`chmod
 (
·th
, 
¡
.
¡_mode
 | 
S_IXOTH
 | 
S_IXGRP
 | 
S_IXUSR
);

3625  
rv®
;

3633 
	`fšd_execubË
 (cÚ¡ *
w¿µ”
)

3635 
has_¦ash
 = 0;

3636 cÚ¡ *
p
;

3637 cÚ¡ *
p_Ãxt
;

3639 
tmp
[
LT_PATHMAX
 + 1];

3640 
tmp_Ën
;

3641 *
cÚÿt_Çme
;

3643 
	`LTWRAPPER_DEBUGPRINTF
 (("(find_executable) : %s\n",

3644 
w¿µ”
 ? (*wrapper ? wrapper : "EMPTY!") : "NULL!"));

3646 ià((
w¿µ”
 =ğ
NULL
) || (*wrapper == '\0'))

3647  
NULL
;

3650 #ià
	`defšed
 (
HAVE_DOS_BASED_FILE_SYSTEM
)

3651 ià(
	`i§Íha
 ((è
w¿µ”
[0]) && wrapper[1] == ':')

3653 
cÚÿt_Çme
 = 
	`x¡rdup
 (
w¿µ”
);

3654 ià(
	`check_execubË
 (
cÚÿt_Çme
))

3655  
cÚÿt_Çme
;

3656 
	`XFREE
 (
cÚÿt_Çme
);

3661 ià(
	`IS_DIR_SEPARATOR
 (
w¿µ”
[0]))

3663 
cÚÿt_Çme
 = 
	`x¡rdup
 (
w¿µ”
);

3664 ià(
	`check_execubË
 (
cÚÿt_Çme
))

3665  
cÚÿt_Çme
;

3666 
	`XFREE
 (
cÚÿt_Çme
);

3668 #ià
	`defšed
 (
HAVE_DOS_BASED_FILE_SYSTEM
)

3672 
p
 = 
w¿µ”
; *p;…++)

3673 ià(*
p
 == '/')

3675 
has_¦ash
 = 1;

3678 ià(!
has_¦ash
)

3681 cÚ¡ *
·th
 = 
	`g‘’v
 ("PATH");

3682 ià(
·th
 !ğ
NULL
)

3684 
p
 = 
·th
; *p;… = 
p_Ãxt
)

3686 cÚ¡ *
q
;

3687 
size_t
 
p_Ën
;

3688 
q
 = 
p
; *q; q++)

3689 ià(
	`IS_PATH_SEPARATOR
 (*
q
))

3691 
p_Ën
 = 
q
 - 
p
;

3692 
p_Ãxt
 = (*
q
 == '\0' ? q : q + 1);

3693 ià(
p_Ën
 == 0)

3696 ià(
	`g‘cwd
 (
tmp
, 
LT_PATHMAX
è=ğ
NULL
)

3697 
	`É_çl
 ("getcwd failed");

3698 
tmp_Ën
 = 
	`¡¾’
 (
tmp
);

3699 
cÚÿt_Çme
 =

3700 
	`XMALLOC
 (, 
tmp_Ën
 + 1 + 
	`¡¾’
 (
w¿µ”
) + 1);

3701 
	`memıy
 (
cÚÿt_Çme
, 
tmp
, 
tmp_Ën
);

3702 
cÚÿt_Çme
[
tmp_Ën
] = '/';

3703 
	`¡rıy
 (
cÚÿt_Çme
 + 
tmp_Ën
 + 1, 
w¿µ”
);

3707 
cÚÿt_Çme
 =

3708 
	`XMALLOC
 (, 
p_Ën
 + 1 + 
	`¡¾’
 (
w¿µ”
) + 1);

3709 
	`memıy
 (
cÚÿt_Çme
, 
p
, 
p_Ën
);

3710 
cÚÿt_Çme
[
p_Ën
] = '/';

3711 
	`¡rıy
 (
cÚÿt_Çme
 + 
p_Ën
 + 1, 
w¿µ”
);

3713 ià(
	`check_execubË
 (
cÚÿt_Çme
))

3714  
cÚÿt_Çme
;

3715 
	`XFREE
 (
cÚÿt_Çme
);

3721 ià(
	`g‘cwd
 (
tmp
, 
LT_PATHMAX
è=ğ
NULL
)

3722 
	`É_çl
 ("getcwd failed");

3723 
tmp_Ën
 = 
	`¡¾’
 (
tmp
);

3724 
cÚÿt_Çme
 = 
	`XMALLOC
 (, 
tmp_Ën
 + 1 + 
	`¡¾’
 (
w¿µ”
) + 1);

3725 
	`memıy
 (
cÚÿt_Çme
, 
tmp
, 
tmp_Ën
);

3726 
cÚÿt_Çme
[
tmp_Ën
] = '/';

3727 
	`¡rıy
 (
cÚÿt_Çme
 + 
tmp_Ën
 + 1, 
w¿µ”
);

3729 ià(
	`check_execubË
 (
cÚÿt_Çme
))

3730  
cÚÿt_Çme
;

3731 
	`XFREE
 (
cÚÿt_Çme
);

3732  
NULL
;

3736 
	`cha£_symlšks
 (cÚ¡ *
·th¥ec
)

3738 #iâdeà
S_ISLNK


3739  
	`x¡rdup
 (
·th¥ec
);

3741 
buf
[
LT_PATHMAX
];

3742 
¡©
 
s
;

3743 *
tmp_·th¥ec
 = 
	`x¡rdup
 (
·th¥ec
);

3744 *
p
;

3745 
has_symlšks
 = 0;

3746 
	`¡¾’
 (
tmp_·th¥ec
è&& !
has_symlšks
)

3748 
	`LTWRAPPER_DEBUGPRINTF
 (("checking…ath component for symlinks: %s\n",

3749 
tmp_·th¥ec
));

3750 ià(
	`l¡©
 (
tmp_·th¥ec
, &
s
) == 0)

3752 ià(
	`S_ISLNK
 (
s
.
¡_mode
) != 0)

3754 
has_symlšks
 = 1;

3759 
p
 = 
tmp_·th¥ec
 + 
	`¡¾’
 (tmp_pathspec) - 1;

3760 (
p
 > 
tmp_·th¥ec
è&& (!
	`IS_DIR_SEPARATOR
 (*p)))

3761 
p
--;

3762 ià((
p
 =ğ
tmp_·th¥ec
è&& (!
	`IS_DIR_SEPARATOR
 (*p)))

3767 *
p
 = '\0';

3771 *
”r¡r
 = 
	`¡»¼Ü
 (
”ºo
);

3772 
	`É_çl
 ("E¼Ü‡cûssšg f% (%s)", 
tmp_·th¥ec
, 
”r¡r
);

3775 
	`XFREE
 (
tmp_·th¥ec
);

3777 ià(!
has_symlšks
)

3779  
	`x¡rdup
 (
·th¥ec
);

3782 
tmp_·th¥ec
 = 
	`»®·th
 (
·th¥ec
, 
buf
);

3783 ià(
tmp_·th¥ec
 == 0)

3785 
	`É_çl
 ("Could‚Ù fŞlow symlšk fÜ %s", 
·th¥ec
);

3787  
	`x¡rdup
 (
tmp_·th¥ec
);

3792 
	`¡»ndz­
 (*
¡r
, cÚ¡ *
·t
)

3794 
size_t
 
Ën
, 
·’
;

3796 
	`as£¹
 (
¡r
 !ğ
NULL
);

3797 
	`as£¹
 (
·t
 !ğ
NULL
);

3799 
Ën
 = 
	`¡¾’
 (
¡r
);

3800 
·’
 = 
	`¡¾’
 (
·t
);

3802 ià(
·’
 <ğ
Ën
)

3804 
¡r
 +ğ
Ën
 - 
·’
;

3805 ià(
	`¡rcmp
 (
¡r
, 
·t
) == 0)

3806 *
¡r
 = '\0';

3808  
¡r
;

3812 
	`É_”rÜ_cÜe
 (
ex™_¡©us
, cÚ¡ *
mode
,

3813 cÚ¡ *
mes§ge
, 
va_li¡
 
­
)

3815 
	`årštf
 (
¡d”r
, "%s: %s: ", 
´og¿m_Çme
, 
mode
);

3816 
	`vårštf
 (
¡d”r
, 
mes§ge
, 
­
);

3817 
	`årštf
 (
¡d”r
, ".\n");

3819 ià(
ex™_¡©us
 >= 0)

3820 
	`ex™
 (
ex™_¡©us
);

3824 
	`É_çl
 (cÚ¡ *
mes§ge
, ...)

3826 
va_li¡
 
­
;

3827 
	`va_¡¬t
 (
­
, 
mes§ge
);

3828 
	`É_”rÜ_cÜe
 (
EXIT_FAILURE
, "FATAL", 
mes§ge
, 
­
);

3829 
	`va_’d
 (
­
);

3833 
	`É_£‹nv
 (cÚ¡ *
Çme
, cÚ¡ *
v®ue
)

3835 
	`LTWRAPPER_DEBUGPRINTF
 (("(lt_setenv) setting '%s'o '%s'\n",

3836 (
Çme
 ?‚ame : "<NULL>"),

3837 (
v®ue
 ? value : "<NULL>")));

3839 #ifdeà
HAVE_SETENV


3841 *
¡r
 = 
	`x¡rdup
 (
v®ue
);

3842 
	`£‹nv
 (
Çme
, 
¡r
, 1);

3844 
Ën
 = 
	`¡¾’
 (
Çme
è+ 1 + sŒËÀ(
v®ue
) + 1;

3845 *
¡r
 = 
	`XMALLOC
 (, 
Ën
);

3846 
	`¥rštf
 (
¡r
, "%s=%s", 
Çme
, 
v®ue
);

3847 ià(
	`pu‹nv
 (
¡r
è!ğ
EXIT_SUCCESS
)

3849 
	`XFREE
 (
¡r
);

3856 
	`É_ex‹nd_¡r
 (cÚ¡ *
Üig_v®ue
, cÚ¡ *
add
, 
to_’d
)

3858 *
Ãw_v®ue
;

3859 ià(
Üig_v®ue
 && *orig_value)

3861 
Üig_v®ue_Ën
 = 
	`¡¾’
 (
Üig_v®ue
);

3862 
add_Ën
 = 
	`¡¾’
 (
add
);

3863 
Ãw_v®ue
 = 
	`XMALLOC
 (, 
add_Ën
 + 
Üig_v®ue_Ën
 + 1);

3864 ià(
to_’d
)

3866 
	`¡rıy
 (
Ãw_v®ue
, 
Üig_v®ue
);

3867 
	`¡rıy
 (
Ãw_v®ue
 + 
Üig_v®ue_Ën
, 
add
);

3871 
	`¡rıy
 (
Ãw_v®ue
, 
add
);

3872 
	`¡rıy
 (
Ãw_v®ue
 + 
add_Ën
, 
Üig_v®ue
);

3877 
Ãw_v®ue
 = 
	`x¡rdup
 (
add
);

3879  
Ãw_v®ue
;

3883 
	`É_¥l™_Çme_v®ue
 (cÚ¡ *
¬g
, ** 
Çme
, ** 
v®ue
)

3885 cÚ¡ *
p
;

3886 
Ën
;

3887 ià(!
¬g
 || !*arg)

3890 
p
 = 
	`¡rchr
 (
¬g
, ()'=');

3892 ià(!
p
)

3895 *
v®ue
 = 
	`x¡rdup
 (++
p
);

3897 
Ën
 = 
	`¡¾’
 (
¬g
è- sŒËÀ(*
v®ue
);

3898 *
Çme
 = 
	`XMALLOC
 (, 
Ën
);

3899 
	`¡ºıy
 (*
Çme
, 
¬g
, 
Ën
-1);

3900 (*
Çme
)[
Ën
 - 1] = '\0';

3906 
	`É_İt_´oûss_’v_£t
 (cÚ¡ *
¬g
)

3908 *
Çme
 = 
NULL
;

3909 *
v®ue
 = 
NULL
;

3911 ià(
	`É_¥l™_Çme_v®ue
 (
¬g
, &
Çme
, &
v®ue
) != 0)

3913 
	`XFREE
 (
Çme
);

3914 
	`XFREE
 (
v®ue
);

3915 
	`É_çl
 ("bad‡rgum’ˆfÜ %s: '%s'", 
’v_£t_İt
, 
¬g
);

3918 
	`É_£‹nv
 (
Çme
, 
v®ue
);

3919 
	`XFREE
 (
Çme
);

3920 
	`XFREE
 (
v®ue
);

3924 
	`É_İt_´oûss_’v_´•’d
 (cÚ¡ *
¬g
)

3926 *
Çme
 = 
NULL
;

3927 *
v®ue
 = 
NULL
;

3928 *
Ãw_v®ue
 = 
NULL
;

3930 ià(
	`É_¥l™_Çme_v®ue
 (
¬g
, &
Çme
, &
v®ue
) != 0)

3932 
	`XFREE
 (
Çme
);

3933 
	`XFREE
 (
v®ue
);

3934 
	`É_çl
 ("bad‡rgum’ˆfÜ %s: '%s'", 
’v_´•’d_İt
, 
¬g
);

3937 
Ãw_v®ue
 = 
	`É_ex‹nd_¡r
 (
	`g‘’v
 (
Çme
), 
v®ue
, 0);

3938 
	`É_£‹nv
 (
Çme
, 
Ãw_v®ue
);

3939 
	`XFREE
 (
Ãw_v®ue
);

3940 
	`XFREE
 (
Çme
);

3941 
	`XFREE
 (
v®ue
);

3945 
	`É_İt_´oûss_’v_­³nd
 (cÚ¡ *
¬g
)

3947 *
Çme
 = 
NULL
;

3948 *
v®ue
 = 
NULL
;

3949 *
Ãw_v®ue
 = 
NULL
;

3951 ià(
	`É_¥l™_Çme_v®ue
 (
¬g
, &
Çme
, &
v®ue
) != 0)

3953 
	`XFREE
 (
Çme
);

3954 
	`XFREE
 (
v®ue
);

3955 
	`É_çl
 ("bad‡rgum’ˆfÜ %s: '%s'", 
’v_­³nd_İt
, 
¬g
);

3958 
Ãw_v®ue
 = 
	`É_ex‹nd_¡r
 (
	`g‘’v
 (
Çme
), 
v®ue
, 1);

3959 
	`É_£‹nv
 (
Çme
, 
Ãw_v®ue
);

3960 
	`XFREE
 (
Ãw_v®ue
);

3961 
	`XFREE
 (
Çme
);

3962 
	`XFREE
 (
v®ue
);

3966 
	`É_upd©e_exe_·th
 (cÚ¡ *
Çme
, cÚ¡ *
v®ue
)

3968 
	`LTWRAPPER_DEBUGPRINTF
 (("(lt_update_exe_path) modifying '%s' by…repending '%s'\n",

3969 (
Çme
 ?‚ame : "<NULL>"),

3970 (
v®ue
 ? value : "<NULL>")));

3972 ià(
Çme
 && *Çm&& 
v®ue
 && *value)

3974 *
Ãw_v®ue
 = 
	`É_ex‹nd_¡r
 (
	`g‘’v
 (
Çme
), 
v®ue
, 0);

3976 
Ën
 = 
	`¡¾’
 (
Ãw_v®ue
);

3977 ((
Ën
 = 
	`¡¾’
 (
Ãw_v®ue
)è> 0è&& 
	`IS_PATH_SEPARATOR
 (new_value[len-1]))

3979 
Ãw_v®ue
[
Ën
-1] = '\0';

3981 
	`É_£‹nv
 (
Çme
, 
Ãw_v®ue
);

3982 
	`XFREE
 (
Ãw_v®ue
);

3987 
	`É_upd©e_lib_·th
 (cÚ¡ *
Çme
, cÚ¡ *
v®ue
)

3989 
	`LTWRAPPER_DEBUGPRINTF
 (("(lt_update_lib_path) modifying '%s' by…repending '%s'\n",

3990 (
Çme
 ?‚ame : "<NULL>"),

3991 (
v®ue
 ? value : "<NULL>")));

3993 ià(
Çme
 && *Çm&& 
v®ue
 && *value)

3995 *
Ãw_v®ue
 = 
	`É_ex‹nd_¡r
 (
	`g‘’v
 (
Çme
), 
v®ue
, 0);

3996 
	`É_£‹nv
 (
Çme
, 
Ãw_v®ue
);

3997 
	`XFREE
 (
Ãw_v®ue
);

4002 
EOF


4004 #’d: 
func_em™_cw¿µ”exe_¤c


4006 #func_mode_lšk 
¬g
...

4007 
	`func_mode_lšk
 ()

4009 
$İt_debug


4010 
$ho¡
 
š


4011 *-*-
cygwš
* | *-*-
mšgw
* | *-*-
pw32
* | *-*-
os2
* | *-
ûgcc
*)

4012 #Iˆ
is
 
impossibË
 
to
 
lšk
 
a
 
dÎ
 
w™hout
 
this
 
£‰šg
, 
ªd


4013 #w
shouldn
't forcehe makefile maintainero figure out

4014 #which 
sy¡em
 
we
 
¬e
 
compšg
 
š
 
Üd”
 
to
 
·ss
 
ª
 
exŒa


4015 #æag 
ev”y
 
libtoŞ
 
švoÿtiÚ
.

4016 #®low_undefšed=
no


4018 #FIXME: 
UnfÜtuÇ‹ly
, 
th”e
 
¬e
 
´obËms
 
w™h
 
the
 
above
 
wh’
 
Œyšg


4019 #tØ
make
 
a
 
dÎ
 
which
 
has
 
undefšed
 
symbŞs
, 
š
 which 
nÙ


4020 #ev’ 
a
 
lib¿ry
 
is
 
but
. 
FÜ
 
now
, 
we
 
Ãed
 
to
 
¥ecify


4021 #-
no
-
undefšed
 
Ú
 
the
 
libtoŞ
 
lšk
 
lše
 
wh’
 
we
 
ÿn
 
be
 
û¹aš


4022 #th© 
®l
 
symbŞs
 
¬e
 
§tisf›d
, 
Ùh”wi£
 
we
 
g‘
 
a
 
lib¿ry
.

4023 
®low_undefšed
=
yes


4026 
®low_undefšed
=
yes


4028 
e§c


4029 
libtoŞ_¬gs
=
$nÚİt


4030 
ba£_compe
="$nonopt $@"

4031 
compe_commªd
=
$nÚİt


4032 
fš®ize_commªd
=
$nÚİt


4034 
compe_½©h
=

4035 
fš®ize_½©h
=

4036 
compe_shlib·th
=

4037 
fš®ize_shlib·th
=

4038 
cÚv’›nû
=

4039 
Şd_cÚv’›nû
=

4040 
d•libs
=

4041 
Şd_d•libs
=

4042 
comp”_æags
=

4043 
lšk”_æags
=

4044 
dÎ£¬ch·th
=

4045 
lib_£¬ch_·th
=`
pwd
`

4046 
š¡_´efix_dœ
=

4047 
Ãw_šh”™ed_lšk”_æags
=

4049 
avoid_v”siÚ
=
no


4050 
dlfes
=

4051 
dÍ»fes
=

4052 
dl£lf
=
no


4053 
expÜt_dyÇmic
=
no


4054 
expÜt_symbŞs
=

4055 
expÜt_symbŞs_»gex
=

4056 
g’”©ed
=

4057 
libobjs
=

4058 
Élibs
=

4059 
moduË
=
no


4060 
no_š¡®l
=
no


4061 
objs
=

4062 
nÚ_pic_objeùs
=

4063 
´ecious_fes_»gex
=

4064 
´eãr_¡©ic_libs
=
no


4065 
´–ßd
=
no


4066 
´ev
=

4067 
´ev¬g
=

4068 
»Ëa£
=

4069 
½©h
=

4070 
x½©h
=

4071 
³rm_½©h
=

4072 
‹mp_½©h
=

4073 
th»ad_§ã
=
no


4074 
všfo
=

4075 
všfo_numb”
=
no


4076 
w—k_libs
=

4077 
sšgË_moduË
="${wl}-single_module"

4078 
func_šãr_g
 
$ba£_compe


4080 #W
Ãed
 
to
 
know
 -,Ø
g‘
 
the
 
right
 
ouut
 
f’ames
.

4081 
¬g


4083 
$¬g
 
š


4084 -
sh¬ed
)

4085 
‹¡
 "$bud_libtoŞ_libs" !ğ
yes
 && \

4086 
func_çl_cÚfigu¿tiÚ
 "can‚ot build‡ shared†ibrary"

4087 
bud_Şd_libs
=
no


4090 -
®l
-| -| --
libtoŞ
-
libs
)

4091 
$¬g
 
š


4092 -
®l
-)

4093 
‹¡
 "$bud_libtoŞ_libs" = 
yes
 &&e¡ -
z
 "$lšk_¡©ic_æag"; 
th’


4094 
func_w¬nšg
 "complete static†inking is impossible inhis configuration"

4095 
fi


4096 
‹¡
 -
n
 "$lšk_¡©ic_æag"; 
th’


4097 
dlİ’_£lf
=
$dlİ’_£lf_¡©ic


4098 
fi


4099 
´eãr_¡©ic_libs
=
yes


4102 
‹¡
 -
z
 "$pic_æag" &&e¡ -
n
 "$lšk_¡©ic_æag"; 
th’


4103 
dlİ’_£lf
=
$dlİ’_£lf_¡©ic


4104 
fi


4105 
´eãr_¡©ic_libs
=
but


4107 --
libtoŞ
-
libs
)

4108 
‹¡
 -
z
 "$pic_æag" &&e¡ -
n
 "$lšk_¡©ic_æag"; 
th’


4109 
dlİ’_£lf
=
$dlİ’_£lf_¡©ic


4110 
fi


4111 
´eãr_¡©ic_libs
=
yes


4113 
e§c


4114 
bud_libtoŞ_libs
=
no


4115 
bud_Şd_libs
=
yes


4118 
e§c


4119 
dÚe


4121 #S“ 
our
 
sh¬ed
 
¬chives
 
d•’d
 
Ú
 archives.

4122 
‹¡
 -
n
 "$Şd_¬chive_äom_Ãw_cmds" && 
bud_Şd_libs
=
yes


4124 #GØ
through
 
the
 
¬gum’ts
, 
ŒªsfÜmšg
 
them
 
Ú
h
way
.

4125 
‹¡
 "$#" -
gt
 0; do

4126 
¬g
="$1"

4127 
shiá


4128 
func_quÙe_fÜ_ev®
 "$arg"

4129 
q¬g
=
$func_quÙe_fÜ_ev®_unquÙed_»suÉ


4130 
func_­³nd
 
libtoŞ_¬gs
 " $func_quote_for_eval_result"

4132 #Ià
the
 
´evious
 
İtiÚ
 
Ãeds
 
ª
 
¬gum’t
, 
assign
 
™
.

4133 
‹¡
 -
n
 "$´ev"; 
th’


4134 
$´ev
 
š


4135 
ouut
)

4136 
func_­³nd
 
compe_commªd
 " @OUTPUT@"

4137 
func_­³nd
 
fš®ize_commªd
 " @OUTPUT@"

4139 
e§c


4141 
$´ev
 
š


4142 
dlfes
|
dÍ»fes
)

4143 
‹¡
 "$´–ßd" = 
no
; 
th’


4144 #Add 
the
 
symbŞ
 
objeù
 
što
h
lškšg
 
commªds
.

4145 
func_­³nd
 
compe_commªd
 " @SYMFILE@"

4146 
func_­³nd
 
fš®ize_commªd
 " @SYMFILE@"

4147 
´–ßd
=
yes


4148 
fi


4149 
$¬g
 
š


4150 *.
Ï
 | *.
lo
è;; #W
hªdË
 
the£
 
ÿ£s
 
b–ow
.

4151 
fÜû
)

4152 
‹¡
 "$dl£lf" = 
no
; 
th’


4153 
dl£lf
=
ÃedËss


4154 
expÜt_dyÇmic
=
yes


4155 
fi


4156 
´ev
=

4159 
£lf
)

4160 
‹¡
 "$´ev" = 
dÍ»fes
; 
th’


4161 
dl£lf
=
yes


4162 
–if
 
‹¡
 "$´ev" = 
dlfes
 &&e¡ "$dlİ’_£lf" !ğ
yes
; 
th’


4163 
dl£lf
=
yes


4165 
dl£lf
=
ÃedËss


4166 
expÜt_dyÇmic
=
yes


4167 
fi


4168 
´ev
=

4172 
‹¡
 "$´ev" = 
dlfes
; 
th’


4173 
dlfes
="$dlfiles $arg"

4175 
dÍ»fes
="$dlprefiles $arg"

4176 
fi


4177 
´ev
=

4180 
e§c


4182 
expsyms
)

4183 
expÜt_symbŞs
="$arg"

4184 
‹¡
 -
f
 "$arg" \

4185 || 
func_çl_”rÜ
 "symbol file \`$arg' does‚otƒxist"

4186 
´ev
=

4189 
expsyms_»gex
)

4190 
expÜt_symbŞs_»gex
="$arg"

4191 
´ev
=

4194 
äamewÜk
)

4195 
$ho¡
 
š


4196 *-*-
d¬wš
*)

4197 "$d•lib " 
š


4199 *è
d•libs
="$d•lib $q¬g.ÉäamewÜk" #thi 
is
 
fixed
 
Ï‹r


4201 
e§c


4203 
e§c


4204 
´ev
=

4207 
š¡_´efix
)

4208 
š¡_´efix_dœ
="$arg"

4209 
´ev
=

4212 
objeùli¡
)

4213 
‹¡
 -
f
 "$¬g"; 
th’


4214 
§ve_¬g
=
$¬g


4215 
mÜ—rgs
=

4216 
f
 
š
 `
ÿt
 "$save_arg"`

4219 
¬g
=
$f


4220 #A 
libtoŞ
-
cÚŒŞËd
 
objeù
.

4222 #Check 
to
 
£e
 
th©
 
this
 
»®ly
 
is
 
a
 
libtoŞ
 
objeù
.

4223 
func_Ïlib_un§ã_p
 "$¬g"; 
th’


4224 
pic_objeù
=

4225 
nÚ_pic_objeù
=

4227 #R—d 
the
 .
lo
 
fe


4228 
func_sourû
 "$arg"

4230 
‹¡
 -
z
 "$pic_object" ||

4231 
‹¡
 -
z
 "$non_pic_object" ||

4232 
‹¡
 "$pic_objeù" = 
nÚe
 &&

4233 
‹¡
 "$nÚ_pic_objeù" = 
nÚe
; 
th’


4234 
func_çl_”rÜ
 "cannot find‚ame of object for \`$arg'"

4235 
fi


4237 #ExŒaù 
subdœeùÜy
 
äom
 
the
 
¬gum’t
.

4238 
func_dœÇme
 "$arg" "/" ""

4239 
xdœ
="$func_dirname_result"

4241 
‹¡
 "$pic_objeù" !ğ
nÚe
; 
th’


4242 #P»³nd 
the
 
subdœeùÜy
h
objeù
 
is
 
found
 
š
.

4243 
pic_objeù
="$xdir$pic_object"

4245 
‹¡
 "$´ev" = 
dlfes
; 
th’


4246 
‹¡
 "$bud_libtoŞ_libs" = 
yes
 &&e¡ "$dlİ’_suµÜt" = yes; 
th’


4247 
dlfes
="$dlfiles $pic_object"

4248 
´ev
=

4251 #Ià
libtoŞ
 
objeùs
 
¬e
 
unsuµÜ‹d
, 
th’
 
we
 
Ãed
 
to
 
´–ßd
.

4252 
´ev
=
dÍ»fes


4253 
fi


4254 
fi


4256 #CHECK 
ME
: 
I
 
thšk
 I 
bu¡ed
 
this
. -
Os§ma


4257 
‹¡
 "$´ev" = 
dÍ»fes
; 
th’


4258 #P»lßd 
the
 
Şd
-
¡yË
 
objeù
.

4259 
dÍ»fes
="$dlprefiles $pic_object"

4260 
´ev
=

4261 
fi


4263 #A 
PIC
 
objeù
.

4264 
func_­³nd
 
libobjs
 " $pic_object"

4265 
¬g
="$pic_object"

4266 
fi


4268 #NÚ-
PIC
 
objeù
.

4269 
‹¡
 "$nÚ_pic_objeù" !ğ
nÚe
; 
th’


4270 #P»³nd 
the
 
subdœeùÜy
h
objeù
 
is
 
found
 
š
.

4271 
nÚ_pic_objeù
="$xdir$non_pic_object"

4273 #A 
¡ªd¬d
 
nÚ
-
PIC
 
objeù


4274 
func_­³nd
 
nÚ_pic_objeùs
 " $non_pic_object"

4275 
‹¡
 -
z
 "$pic_objeù" ||e¡ "$pic_objeù" = 
nÚe
 ; 
th’


4276 
¬g
="$non_pic_object"

4277 
fi


4279 #Ià
the
 
PIC
 
objeù
 
exi¡s
, 
u£
 
™
 
š¡—d
.

4280 #$xdœ 
was
 
´•’ded
 
to
 
$pic_objeù
 
above
.

4281 
nÚ_pic_objeù
="$pic_object"

4282 
func_­³nd
 
nÚ_pic_objeùs
 " $non_pic_object"

4283 
fi


4285 #OÆy 
ª
 
”rÜ
 
nÙ
 
došg
 
a
 
dry
-
run
.

4286 
$İt_dry_run
; 
th’


4287 #ExŒaù 
subdœeùÜy
 
äom
 
the
 
¬gum’t
.

4288 
func_dœÇme
 "$arg" "/" ""

4289 
xdœ
="$func_dirname_result"

4291 
func_lo2o
 "$arg"

4292 
pic_objeù
=
$xdœ$objdœ
/
$func_lo2o_»suÉ


4293 
nÚ_pic_objeù
=
$xdœ$func_lo2o_»suÉ


4294 
func_­³nd
 
libobjs
 " $pic_object"

4295 
func_­³nd
 
nÚ_pic_objeùs
 " $non_pic_object"

4297 
func_çl_”rÜ
 "\`$arg' is‚ot‡ valid†ibtool object"

4298 
fi


4299 
fi


4300 
dÚe


4302 
func_çl_”rÜ
 "link input file \`$arg' does‚otƒxist"

4303 
fi


4304 
¬g
=
$§ve_¬g


4305 
´ev
=

4308 
´ecious_»gex
)

4309 
´ecious_fes_»gex
="$arg"

4310 
´ev
=

4313 
»Ëa£
)

4314 
»Ëa£
="-$arg"

4315 
´ev
=

4318 
½©h
 | 
x½©h
)

4319 #W
Ãed
 
ª
 
absŞu‹
 
·th
.

4320 
$¬g
 
š


4321 [\\/]* | [
A
-
Za
-
z
]:[\\/]*) ;;

4323 
func_çl_”rÜ
 "only‡bsolute„un-paths‡re‡llowed"

4325 
e§c


4326 
‹¡
 "$´ev" = 
½©h
; 
th’


4327 "$½©h " 
š


4329 *è
½©h
="$rpath $arg" ;;

4330 
e§c


4332 "$x½©h " 
š


4334 *è
x½©h
="$xrpath $arg" ;;

4335 
e§c


4336 
fi


4337 
´ev
=

4340 
sh»xt
)

4341 
sh»xt_cmds
="$arg"

4342 
´ev
=

4345 
w—k
)

4346 
w—k_libs
="$weak_libs $arg"

4347 
´ev
=

4350 
xcşšk”
)

4351 
lšk”_æags
="$linker_flags $qarg"

4352 
comp”_æags
="$compiler_flags $qarg"

4353 
´ev
=

4354 
func_­³nd
 
compe_commªd
 " $qarg"

4355 
func_­³nd
 
fš®ize_commªd
 " $qarg"

4358 
xcomp”
)

4359 
comp”_æags
="$compiler_flags $qarg"

4360 
´ev
=

4361 
func_­³nd
 
compe_commªd
 " $qarg"

4362 
func_­³nd
 
fš®ize_commªd
 " $qarg"

4365 
xlšk”
)

4366 
lšk”_æags
="$linker_flags $qarg"

4367 
comp”_æags
="$compiler_flags $wl$qarg"

4368 
´ev
=

4369 
func_­³nd
 
compe_commªd
 " $wl$qarg"

4370 
func_­³nd
 
fš®ize_commªd
 " $wl$qarg"

4374 
ev®
 "$prev=\"\$arg\""

4375 
´ev
=

4378 
e§c


4379 
fi
 #‹¡ -
n
 "$prev"

4381 
´ev¬g
="$arg"

4383 
$¬g
 
š


4384 -
®l
-)

4385 
‹¡
 -
n
 "$lšk_¡©ic_æag"; 
th’


4386 #S“ 
comm’t
 -
æag
 
b–ow
, 
mÜe
 
d‘as
.

4387 
func_­³nd
 
compe_commªd
 " $link_static_flag"

4388 
func_­³nd
 
fš®ize_commªd
 " $link_static_flag"

4389 
fi


4393 -
®low
-
undefšed
)

4394 #FIXME: 
»move
 
this
 
æag
 
som‘ime
 
š
 
the
 
futu»
.

4395 
func_çl_”rÜ
 "\`-allow-undefined' must‚ot be used because it ishe default"

4398 -
avoid
-
v”siÚ
)

4399 
avoid_v”siÚ
=
yes


4403 -
dlİ’
)

4404 
´ev
=
dlfes


4408 -
dÍ»İ’
)

4409 
´ev
=
dÍ»fes


4413 -
expÜt
-
dyÇmic
)

4414 
expÜt_dyÇmic
=
yes


4418 -
expÜt
-
symbŞs
 | -expÜt-symbŞs-
»gex
)

4419 
‹¡
 -
n
 "$expÜt_symbŞs" ||e¡ -À"$expÜt_symbŞs_»gex"; 
th’


4420 
func_çl_”rÜ
 "morehan one -exported-symbols‡rgument is‚ot‡llowed"

4421 
fi


4422 
‹¡
 "X$¬g" = "X-expÜt-symbŞs"; 
th’


4423 
´ev
=
expsyms


4425 
´ev
=
expsyms_»gex


4426 
fi


4430 -
äamewÜk
)

4431 
´ev
=
äamewÜk


4435 -
š¡
-
´efix
-
dœ
)

4436 
´ev
=
š¡_´efix


4440 #Th
Çtive
 
IRIX
 
lšk”
 
und”¡ªds
 -
LANG
:*, -
LIST
:* 
ªd
 -
LNO
:*

4441 #so, 
we
 
£e
 
the£
 
æags
 
be
 
ÿ»ful
 
nÙ
 
to
 
Œ—t
 
them
 
like
 -
L


4442 -
L
[
A
-
Z
][A-Z]*:*)

4443 
$w™h_gcc
/
$ho¡
 
š


4444 
no


4481  
lib$
*/
bš
*'`

4482 :
$dÎ£¬ch·th
: 
š


4484 ::è
dÎ£¬ch·th
=
$dœ
;;

4485 *è
dÎ£¬ch·th
="$dllsearchpath:$dir";;

4486 
e§c


4487 :
$dÎ£¬ch·th
: 
š


4489 ::è
dÎ£¬ch·th
=
$‹¡bšdœ
;;

4490 *è
dÎ£¬ch·th
="$dllsearchpath:$testbindir";;

4491 
e§c


4493 
e§c


4497 -
l
*)

4498 
‹¡
 "X$¬g" = "X-lc" ||e¡ "X$¬g" = "X-lm"; 
th’


4499 
$ho¡
 
š


4500 *-*-
cygwš
* | *-*-
mšgw
* | *-*-
pw32
* | *-*-
beos
* | *-
ûgcc
*)

4501 #The£ 
sy¡ems
 
dÚ
't‡ctually have‡ C or math†ibrary (as such)

4504 *-*-
os2
*)

4505 #The£ 
sy¡ems
 
dÚ
't‡ctually have‡ C†ibrary (as such)

4506 
‹¡
 "X$arg" = "X-lc" && 

4508 *-*-
İ’bsd
* | *-*-
ä“bsd
* | *-*-
d¿gÚæy
*)

4509 #DØ
nÙ
 
šşude
 
libc
 
due
 
to
 
us
 
havšg
†ibc/
libc_r
.

4510 
‹¡
 "X$arg" = "X-lc" && 

4512 *-*-
rh­sody
* | *-*-
d¬wš1
.[012])

4513 #Rh­sody 
C
 
ªd
 
m©h
 
lib¿r›s
 
¬e
 
š
 
the
 
Sy¡em
 
äamewÜk


4514 
d•libs
="$deplibs System.ltframework"

4517 *-*-
sco3
.2
v5
* | *-*-
sco5v6
*)

4518 #Cau£ 
´obËms
 
w™h
 
__ùy³


4519 
‹¡
 "X$arg" = "X-lc" && 

4521 *-*-
sysv4
.2u
w2
* | *-*-
sysv5
* | *-*-
unixw¬e
* | *-*-
O³nUNIX
*)

4522 #Comp” 
š£¹s
 
libc
 
š
 
the
 
cÜ»ù
 
¶aû
 
th»ads
 
to
 
wÜk


4523 
‹¡
 "X$arg" = "X-lc" && 

4525 
e§c


4526 
–if
 
‹¡
 "X$¬g" = "X-lc_r"; 
th’


4527 
$ho¡
 
š


4528 *-*-
İ’bsd
* | *-*-
ä“bsd
* | *-*-
d¿gÚæy
*)

4529 #DØ
nÙ
 
šşude
 
libc_r
 
dœeùly
, 
u£
 -
±h»ad
 
æag
.

4532 
e§c


4533 
fi


4534 
d•libs
="$deplibs $arg"

4538 -
moduË
)

4539 
moduË
=
yes


4543 #Tru64 
UNIX
 
u£s
 -
mod–
 [
¬g
] 
to
 
d‘”mše
 
the
 
Ïyout
 
of
 
C
++

4544 #şas£s, 
Çme
 
mªglšg
, 
ªd
 
exû±iÚ
 
hªdlšg
.

4545 #D¬wš 
u£s
 
the
 -
¬ch
 
æag
 
to
 
d‘”mše
 
ouut
 
¬ch™eùu»
.

4546 -
mod–
|-
¬ch
|-
isy¤oÙ
)

4547 
comp”_æags
="$compiler_flags $arg"

4548 
func_­³nd
 
compe_commªd
 " $arg"

4549 
func_­³nd
 
fš®ize_commªd
 " $arg"

4550 
´ev
=
xcomp”


4554 -
mt
|-
mth»ads
|-
kth»ad
|-
Kth»ad
|-
±h»ad
|-
±h»ads
|--
th»ad
-
§ã
|-
th»ads
)

4555 
comp”_æags
="$compiler_flags $arg"

4556 
func_­³nd
 
compe_commªd
 " $arg"

4557 
func_­³nd
 
fš®ize_commªd
 " $arg"

4558 "$Ãw_šh”™ed_lšk”_æag " 
š


4560 * ) 
Ãw_šh”™ed_lšk”_æags
="$new_inherited_linker_flags $arg" ;;

4561 
e§c


4565 -
muÉi_moduË
)

4566 
sšgË_moduË
="${wl}-multi_module"

4570 -
no
-
ç¡
-
š¡®l
)

4571 
ç¡_š¡®l
=
no


4575 -
no
-
š¡®l
)

4576 
$ho¡
 
š


4577 *-*-
cygwš
* | *-*-
mšgw
* | *-*-
pw32
* | *-*-
os2
* | *-*-
d¬wš
* | *-
ûgcc
*)

4578 #Th
PATH
 
hack”y
 
š
 
w¿µ”
 
süts
 
is
 
»quœed
 
Ú
 
Wšdows


4579 #ªd 
D¬wš
 
š
 
Üd”
 
the
 
lßd”
 
to
 
fšd
 
ªy
 
dÎs
 
™
 
Ãeds
.

4580 
func_w¬nšg
 "\`-no-install' is ignored for $host"

4581 
func_w¬nšg
 "assuming \`-no-fast-install' instead"

4582 
ç¡_š¡®l
=
no


4584 *è
no_š¡®l
=
yes
 ;;

4585 
e§c


4589 -
no
-
undefšed
)

4590 
®low_undefšed
=
no


4594 -
objeùli¡
)

4595 
´ev
=
objeùli¡


4599 -
o
è
´ev
=
ouut
 ;;

4601 -
´ecious
-
fes
-
»gex
)

4602 
´ev
=
´ecious_»gex


4606 -
»Ëa£
)

4607 
´ev
=
»Ëa£


4611 -
½©h
)

4612 
´ev
=
½©h


4616 -
R
)

4617 
´ev
=
x½©h


4621 -
R
*)

4622 
func_¡rÇme
 '-R' '' "$arg"

4623 
dœ
=
$func_¡rÇme_»suÉ


4624 #W
Ãed
 
ª
 
absŞu‹
 
·th
.

4625 
$dœ
 
š


4626 [\\/]* | [
A
-
Za
-
z
]:[\\/]*) ;;

4628 
func_çl_”rÜ
 "only‡bsolute„un-paths‡re‡llowed"

4630 
e§c


4631 "$x½©h " 
š


4633 *è
x½©h
="$xrpath $dir" ;;

4634 
e§c


4638 -
sh¬ed
)

4639 #Th
efãùs
 
of
 -
sh¬ed
 
¬e
 
defšed
 
š
 
a
 
´evious
 
loİ
.

4643 -
sh»xt
)

4644 
´ev
=
sh»xt


4648 -| --
libtoŞ
-
libs
)

4649 #Th
efãùs
 
of
 -
¬e
 
defšed
 
š
 
a
 
´evious
 
loİ
.

4650 #W
u£d
 
to
 dØ
the
 
§me
 
as
 -
®l
-
Ú
 
¶©fÜms
 
th©


4652 #would 
be
 
equiv®’t
 
was
 
wrÚg
. 
It
 
would
  
Ú
 
©
 
Ëa¡


4653 #Dig™® 
Unix
 
ªd
 
AIX
.

4657 -
th»ad
-
§ã
)

4658 
th»ad_§ã
=
yes


4662 -
v”siÚ
-
šfo
)

4663 
´ev
=
všfo


4667 -
v”siÚ
-
numb”
)

4668 
´ev
=
všfo


4669 
všfo_numb”
=
yes


4673 -
w—k
)

4674 
´ev
=
w—k


4678 -
Wc
,*)

4679 
func_¡rÇme
 '-Wc,' '' "$arg"

4680 
¬gs
=
$func_¡rÇme_»suÉ


4681 
¬g
=

4682 
§ve_ifs
="$IFS"; 
IFS
=','

4683 
æag
 
š
 
$¬gs
; do

4684 
IFS
="$save_ifs"

4685 
func_quÙe_fÜ_ev®
 "$flag"

4686 
¬g
="$arg $wl$func_quote_for_eval_result"

4687 
comp”_æags
="$compiler_flags $func_quote_for_eval_result"

4688 
dÚe


4689 
IFS
="$save_ifs"

4690 
func_¡rÇme
 ' ' '' "$arg"

4691 
¬g
=
$func_¡rÇme_»suÉ


4694 -
Wl
,*)

4695 
func_¡rÇme
 '-Wl,' '' "$arg"

4696 
¬gs
=
$func_¡rÇme_»suÉ


4697 
¬g
=

4698 
§ve_ifs
="$IFS"; 
IFS
=','

4699 
æag
 
š
 
$¬gs
; do

4700 
IFS
="$save_ifs"

4701 
func_quÙe_fÜ_ev®
 "$flag"

4702 
¬g
="$arg $wl$func_quote_for_eval_result"

4703 
comp”_æags
="$compiler_flags $wl$func_quote_for_eval_result"

4704 
lšk”_æags
="$linker_flags $func_quote_for_eval_result"

4705 
dÚe


4706 
IFS
="$save_ifs"

4707 
func_¡rÇme
 ' ' '' "$arg"

4708 
¬g
=
$func_¡rÇme_»suÉ


4711 -
Xcomp”
)

4712 
´ev
=
xcomp”


4716 -
Xlšk”
)

4717 
´ev
=
xlšk”


4721 -
XCClšk”
)

4722 
´ev
=
xcşšk”


4726 #-
msg_
* 
osf
 
cc


4727 -
msg_
*)

4728 
func_quÙe_fÜ_ev®
 "$arg"

4729 
¬g
="$func_quote_for_eval_result"

4732 #-64, -
ms
[0-9] 
’abË
 64-
b™
 
mode
 
Ú
 
the
 
SGI
 
comp”


4733 #-
r
[0-9][0-9]* 
¥ecif›s
 
the
 
´oûssÜ
 
Ú
h
SGI
 
comp”


4734 #-
x¬ch
=*, -
xrg‘
=* 
’abË
 64-
b™
 
mode
 
Ú
 
the
 
Sun
 
comp”


4735 #+
DA
*, +
DD
* 
’abË
 64-
b™
 
mode
 
Ú
 
the
 
HP
 
comp”


4736 #-
q
* 
·ss
 
through
 
comp”
 
¬gs
 
the
 
IBM
 compiler

4737 #-
m
*, -
t
[45]*, -
txsÿË
* 
·ss
 
through
 
¬ch™eùu»
-
¥ecific


4738 #comp” 
¬gs
 
GCC


4739 #-
F
/
·th
 
gives
…©h 
to
 
unš¡®Ëd
 
äamewÜks
, 
gcc
 
Ú
 
d¬wš


4740 #-
p
, -
pg
, --
cov”age
, -
årofe
-* 
·ss
 
through
 
´ofšg
 
æag
 
GCC


4741 #@
fe
 
GCC
 
»¥Ú£
 
fes


4742 -64|-
ms
[0-9]|-
r
[0-9][0-9]*|-
x¬ch
=*|-
xrg‘
=*|+
DA
*|+
DD
*|-
q
*|-
m
*| \

4743 -
t
[45]*|-
txsÿË
*|-
p
|-
pg
|--
cov”age
|-
årofe
-*|-
F
*|@*)

4744 
func_quÙe_fÜ_ev®
 "$arg"

4745 
¬g
="$func_quote_for_eval_result"

4746 
func_­³nd
 
compe_commªd
 " $arg"

4747 
func_­³nd
 
fš®ize_commªd
 " $arg"

4748 
comp”_æags
="$compiler_flags $arg"

4752 #Som
Ùh”
 
comp”
 
æag
.

4754 
func_quÙe_fÜ_ev®
 "$arg"

4755 
¬g
="$func_quote_for_eval_result"

4758 *.
$objext
)

4759 #A 
¡ªd¬d
 
objeù
.

4760 
objs
="$objs $arg"

4763 *.
lo
)

4764 #A 
libtoŞ
-
cÚŒŞËd
 
objeù
.

4766 #Check 
to
 
£e
 
th©
 
this
 
»®ly
 
is
 
a
 
libtoŞ
 
objeù
.

4767 
func_Ïlib_un§ã_p
 "$¬g"; 
th’


4768 
pic_objeù
=

4769 
nÚ_pic_objeù
=

4771 #R—d 
the
 .
lo
 
fe


4772 
func_sourû
 "$arg"

4774 
‹¡
 -
z
 "$pic_object" ||

4775 
‹¡
 -
z
 "$non_pic_object" ||

4776 
‹¡
 "$pic_objeù" = 
nÚe
 &&

4777 
‹¡
 "$nÚ_pic_objeù" = 
nÚe
; 
th’


4778 
func_çl_”rÜ
 "cannot find‚ame of object for \`$arg'"

4779 
fi


4781 #ExŒaù 
subdœeùÜy
 
äom
 
the
 
¬gum’t
.

4782 
func_dœÇme
 "$arg" "/" ""

4783 
xdœ
="$func_dirname_result"

4785 
‹¡
 "$pic_objeù" !ğ
nÚe
; 
th’


4786 #P»³nd 
the
 
subdœeùÜy
h
objeù
 
is
 
found
 
š
.

4787 
pic_objeù
="$xdir$pic_object"

4789 
‹¡
 "$´ev" = 
dlfes
; 
th’


4790 
‹¡
 "$bud_libtoŞ_libs" = 
yes
 &&e¡ "$dlİ’_suµÜt" = yes; 
th’


4791 
dlfes
="$dlfiles $pic_object"

4792 
´ev
=

4795 #Ià
libtoŞ
 
objeùs
 
¬e
 
unsuµÜ‹d
, 
th’
 
we
 
Ãed
 
to
 
´–ßd
.

4796 
´ev
=
dÍ»fes


4797 
fi


4798 
fi


4800 #CHECK 
ME
: 
I
 
thšk
 I 
bu¡ed
 
this
. -
Os§ma


4801 
‹¡
 "$´ev" = 
dÍ»fes
; 
th’


4802 #P»lßd 
the
 
Şd
-
¡yË
 
objeù
.

4803 
dÍ»fes
="$dlprefiles $pic_object"

4804 
´ev
=

4805 
fi


4807 #A 
PIC
 
objeù
.

4808 
func_­³nd
 
libobjs
 " $pic_object"

4809 
¬g
="$pic_object"

4810 
fi


4812 #NÚ-
PIC
 
objeù
.

4813 
‹¡
 "$nÚ_pic_objeù" !ğ
nÚe
; 
th’


4814 #P»³nd 
the
 
subdœeùÜy
h
objeù
 
is
 
found
 
š
.

4815 
nÚ_pic_objeù
="$xdir$non_pic_object"

4817 #A 
¡ªd¬d
 
nÚ
-
PIC
 
objeù


4818 
func_­³nd
 
nÚ_pic_objeùs
 " $non_pic_object"

4819 
‹¡
 -
z
 "$pic_objeù" ||e¡ "$pic_objeù" = 
nÚe
 ; 
th’


4820 
¬g
="$non_pic_object"

4821 
fi


4823 #Ià
the
 
PIC
 
objeù
 
exi¡s
, 
u£
 
™
 
š¡—d
.

4824 #$xdœ 
was
 
´•’ded
 
to
 
$pic_objeù
 
above
.

4825 
nÚ_pic_objeù
="$pic_object"

4826 
func_­³nd
 
nÚ_pic_objeùs
 " $non_pic_object"

4827 
fi


4829 #OÆy 
ª
 
”rÜ
 
nÙ
 
došg
 
a
 
dry
-
run
.

4830 
$İt_dry_run
; 
th’


4831 #ExŒaù 
subdœeùÜy
 
äom
 
the
 
¬gum’t
.

4832 
func_dœÇme
 "$arg" "/" ""

4833 
xdœ
="$func_dirname_result"

4835 
func_lo2o
 "$arg"

4836 
pic_objeù
=
$xdœ$objdœ
/
$func_lo2o_»suÉ


4837 
nÚ_pic_objeù
=
$xdœ$func_lo2o_»suÉ


4838 
func_­³nd
 
libobjs
 " $pic_object"

4839 
func_­³nd
 
nÚ_pic_objeùs
 " $non_pic_object"

4841 
func_çl_”rÜ
 "\`$arg' is‚ot‡ valid†ibtool object"

4842 
fi


4843 
fi


4846 *.
$libext
)

4847 #AÀ
¬chive
.

4848 
d•libs
="$deplibs $arg"

4849 
Şd_d•libs
="$old_deplibs $arg"

4853 *.
Ï
)

4854 #A 
libtoŞ
-
cÚŒŞËd
 
lib¿ry
.

4856 
‹¡
 "$´ev" = 
dlfes
; 
th’


4857 #Thi 
lib¿ry
 
was
 
¥ecif›d
 
w™h
 -
dlİ’
.

4858 
dlfes
="$dlfiles $arg"

4859 
´ev
=

4860 
–if
 
‹¡
 "$´ev" = 
dÍ»fes
; 
th’


4861 #Th
lib¿ry
 
was
 
¥ecif›d
 
w™h
 -
dÍ»İ’
.

4862 
dÍ»fes
="$dlprefiles $arg"

4863 
´ev
=

4865 
d•libs
="$deplibs $arg"

4866 
fi


4870 #Som
Ùh”
 
comp”
 
¬gum’t
.

4872 #UnknowÀ
¬gum’ts
 
š
 
bÙh
 
fš®ize_commªd
 
ªd
 
compe_commªd
 
Ãed


4873 #tØ
be
 
«¡h‘iÿÎy
 
quÙed
 
beÿu£
 
they
 
¬e
 
ev®ed
 
Ï‹r
.

4874 
func_quÙe_fÜ_ev®
 "$arg"

4875 
¬g
="$func_quote_for_eval_result"

4877 
e§c
 #arg

4879 #Now 
aùu®ly
 
sub¡™u‹
 
the
 
¬gum’t
 
što
h
commªds
.

4880 
‹¡
 -
n
 "$¬g"; 
th’


4881 
func_­³nd
 
compe_commªd
 " $arg"

4882 
func_­³nd
 
fš®ize_commªd
 " $arg"

4883 
fi


4884 
dÚe
 #¬gum’ˆ
·rsšg
 
loİ


4886 
‹¡
 -
n
 "$prev" && \

4887 
func_çl_h–p
 "the \`$prevarg' option„equires‡n‡rgument"

4889 
‹¡
 "$expÜt_dyÇmic" = 
yes
 &&e¡ -
n
 "$expÜt_dyÇmic_æag_¥ec"; 
th’


4890 
ev®
 
¬g
=\"$export_dynamic_flag_spec\"

4891 
func_­³nd
 
compe_commªd
 " $arg"

4892 
func_­³nd
 
fš®ize_commªd
 " $arg"

4893 
fi


4895 
Şdlibs
=

4896 #ÿlcuÏ‹ 
the
 
Çme
 
of
h
fe
, 
w™hout
 
™s
 
dœeùÜy


4897 
func_ba£Çme
 "$output"

4898 
ouuŠame
="$func_basename_result"

4899 
libobjs_§ve
="$libobjs"

4901 
‹¡
 -
n
 "$shlib·th_v¬"; 
th’


4902 #g‘ 
the
 
dœeùÜ›s
 
li¡ed
 
š
 
$shlib·th_v¬


4903 
ev®
 
shlib_£¬ch_·th
=\`\
$ECHO
 \"X\${$shlibpath_var}\" \| \$Xsed -e \'s/:/ /g\'\`

4905 
shlib_£¬ch_·th
=

4906 
fi


4907 
ev®
 
sys_lib_£¬ch_·th
=\"$sys_lib_search_path_spec\"

4908 
ev®
 
sys_lib_dl£¬ch_·th
=\"$sys_lib_dlsearch_path_spec\"

4910 
func_dœÇme
 "$output" "/" ""

4911 
ouut_objdœ
="$func_dirname_result$objdir"

4912 #C»©
the
 
objeù
 
dœeùÜy
.

4913 
func_mkdœ_p
 "$output_objdir"

4915 #D‘”mš
the
 
ty³
 
of
 
ouut


4916 
$ouut
 
š


4918 
func_çl_h–p
 "you must specify‡n output file"

4920 *.
$libext
è
lškmode
=
Şdlib
 ;;

4921 *.
lo
 | *.
$objext
è
lškmode
=
obj
 ;;

4922 *.
Ï
è
lškmode
=
lib
 ;;

4923 *è
lškmode
=
´og
 ;; #Anythšg 
should
 
be
 
a
 
´og¿m
.

4924 
e§c


4926 
¥ecŸld•libs
=

4928 
libs
=

4929 #Fšd 
®l
 
š‹rd•’d’t
 
d•libs
 
by
 
£¬chšg
 
lib¿r›s


4930 #th© 
¬e
 
lšked
 
mÜe
 
thª
 
	`Úû
 (
e
.
g
. -
Ï
 -
lb
 -la)

4931 
d•lib
 
š
 
$d•libs
; do

4932 
$İt_du¶iÿ‹_d•s
 ; 
th’


4933 "$lib " 
š


4934 *" $d•lib "*è
¥ecŸld•libs
="$specialdeplibs $deplib" ;;

4935 
e§c


4936 
fi


4937 
libs
="$libs $deplib"

4938 
dÚe


4940 
‹¡
 "$lškmode" = 
lib
; 
th’


4941 
libs
="$predeps $libs $compiler_lib_search_path $postdeps"

4943 #Compu‹ 
lib¿r›s
 
th©
 
¬e
 
li¡ed
 
mÜe
 
thª
 
Úû
 
š
 
$´ed•s


4944 #$po¡d• 
ªd
 
m¬k
 
them
 
as
 
	`¥ecŸl
 (
i
.
e
., 
who£
 
du¶iÿ‹s
 
¬e


4945 #nÙ 
to
 
be
 
–imš©ed
).

4946 
´e_po¡_d•s
=

4947 
$İt_du¶iÿ‹_comp”_g’”©ed_d•s
; 
th’


4948 
´e_po¡_d•
 
š
 
$´ed•s
 
$po¡d•s
; do

4949 "$´e_po¡_d• " 
š


4950 *" $´e_po¡_d• "*è
¥ecŸld•libs
="$specialdeplibs $pre_post_deps" ;;

4951 
e§c


4952 
´e_po¡_d•s
="$pre_post_deps $pre_post_dep"

4953 
dÚe


4954 
fi


4955 
´e_po¡_d•s
=

4956 
fi


4958 
d•libs
=

4959 
Ãwd•’d’cy_libs
=

4960 
Ãwlib_£¬ch_·th
=

4961 
Ãed_»lšk
=
no
 #wh‘h” 
we
're†inking‡ny uninstalled†ibtool†ibraries

4962 
nÙš¡_d•libs
ğ#nÙ-
š¡®Ëd
 
libtoŞ
 
lib¿r›s


4963 
nÙš¡_·th
ğ#·th 
th©
 
cÚš
 
nÙ
-
š¡®Ëd
 
libtoŞ
 
lib¿r›s


4965 
$lškmode
 
š


4966 
lib
)

4967 
·s£s
="conv dlpreopen†ink"

4968 
fe
 
š
 
$dlfes
 
$dÍ»fes
; do

4969 
$fe
 
š


4970 *.
Ï
) ;;

4972 
func_çl_h–p
 "libraries can \`-dlopen' only†ibtool†ibraries: $file"

4974 
e§c


4975 
dÚe


4977 
´og
)

4978 
compe_d•libs
=

4979 
fš®ize_d•libs
=

4980 
®ld•libs
=
no


4981 
Ãwdlfes
=

4982 
ÃwdÍ»fes
=

4983 
·s£s
="conv scan dlopen dlpreopen†ink"

4985 *è
·s£s
="conv"

4987 
e§c


4989 
·ss
 
š
 
$·s£s
; do

4990 #Th
´eİ’
 
·ss
 
š
 
lib
 
mode
 
»v”£s
 
$d•libs
; 
put
 
™
 
back
 
h”e


4991 #sØ
th©
 -
L
 
comes
 
befÜe
 
libs
h© 
Ãed
 
™
 
š¡ªû
...

4992 
‹¡
 "$lškmode,$·ss" = "lib,lšk"; 
th’


4993 ## 
FIXME
: 
Fšd
 
the
 
¶aû
 
wh”e
h
li¡
 
is
 
»but
 
š
h
wrÚg


4994 ## 
Üd”
, 
ªd
 
fix
 
™
 
th”e
 
´İ”ly


4995 
tmp_d•libs
=

4996 
d•lib
 
š
 
$d•libs
; do

4997 
tmp_d•libs
="$deplib $tmp_deplibs"

4998 
dÚe


4999 
d•libs
="$tmp_deplibs"

5000 
fi


5002 
‹¡
 "$linkmode,$pass" = "lib,link" ||

5003 
‹¡
 "$lškmode,$·ss" = "´og,sÿn"; 
th’


5004 
libs
="$deplibs"

5005 
d•libs
=

5006 
fi


5007 
‹¡
 "$lškmode" = 
´og
; 
th’


5008 
$·ss
 
š


5009 
dlİ’
è
libs
="$dlfiles" ;;

5010 
dÍ»İ’
è
libs
="$dlprefiles" ;;

5011 
lšk
)

5012 
libs
="$deplibs %DEPLIBS%"

5013 
‹¡
 "X$lšk_®l_d•libs" !ğ
Xno
 && 
libs
="$libs $dependency_libs"

5015 
e§c


5016 
fi


5017 
‹¡
 "$lškmode,$·ss" = "lib,dÍ»İ’"; 
th’


5018 #CŞËù 
ªd
 
fÜw¬d
 
d•libs
 
of
 
´eİ’ed
 
libtoŞ
 
libs


5019 
lib
 
š
 
$dÍ»fes
; do

5020 #IgnÜ
nÚ
-
libtoŞ
-
libs


5021 
d•’d’cy_libs
=

5022 
$lib
 
š


5023 *.
Ï
è
func_sourû
 "$lib" ;;

5024 
e§c


5026 #CŞËù 
´eİ’ed
 
libtoŞ
 
d•libs
, 
exû±
 
ªy
 
this
 
lib¿ry


5027 #ha 
deş¬ed
 
as
 
w—k
 
libs


5028 
d•lib
 
š
 
$d•’d’cy_libs
; do

5029 
d•lib_ba£
=`
$ECHO
 "X$d•lib" | 
$X£d
 -
e
 "$basename"`

5030 " $w—k_lib " 
š


5032 *è
d•libs
="$deplibs $deplib" ;;

5033 
e§c


5034 
dÚe


5035 
dÚe


5036 
libs
="$dlprefiles"

5037 
fi


5038 
‹¡
 "$·ss" = 
dlİ’
; 
th’


5039 #CŞËù 
dÍ»İ’ed
 
lib¿r›s


5040 
§ve_d•libs
="$deplibs"

5041 
d•libs
=

5042 
fi


5044 
d•lib
 
š
 
$libs
; do

5045 
lib
=

5046 
found
=
no


5047 
$d•lib
 
š


5048 -
mt
|-
mth»ads
|-
kth»ad
|-
Kth»ad
|-
±h»ad
|-
±h»ads
|--
th»ad
-
§ã
|-
th»ads
)

5049 
‹¡
 "$lškmode,$·ss" = "´og,lšk"; 
th’


5050 
compe_d•libs
="$deplib $compile_deplibs"

5051 
fš®ize_d•libs
="$deplib $finalize_deplibs"

5053 
comp”_æags
="$compiler_flags $deplib"

5054 
‹¡
 "$lškmode" = 
lib
 ; 
th’


5055 "$Ãw_šh”™ed_lšk”_æag " 
š


5057 * ) 
Ãw_šh”™ed_lšk”_æags
="$new_inherited_linker_flags $deplib" ;;

5058 
e§c


5059 
fi


5060 
fi


5063 -
l
*)

5064 
‹¡
 "$lškmode" !ğ
lib
 &&e¡ "$lškmode" !ğ
´og
; 
th’


5065 
func_w¬nšg
 "\`-l' is ignored for‡rchives/objects"

5067 
fi


5068 
func_¡rÇme
 '-l' '' "$deplib"

5069 
Çme
=
$func_¡rÇme_»suÉ


5070 
‹¡
 "$lškmode" = 
lib
; 
th’


5071 
£¬chdœs
="$newlib_search_path $lib_search_path $compiler_lib_search_dirs $sys_lib_search_path $shlib_search_path"

5073 
£¬chdœs
="$newlib_search_path $lib_search_path $sys_lib_search_path $shlib_search_path"

5074 
fi


5075 
£¬chdœ
 
š
 
$£¬chdœs
; do

5076 
£¬ch_ext
 
š
 .
Ï
 
$¡d_sh»xt
 .
so
 .
a
; do

5077 #S—rch 
the
 
libtoŞ
 
lib¿ry


5078 
lib
="$searchdir/lib${name}${search_ext}"

5079 
‹¡
 -
f
 "$lib"; 
th’


5080 
‹¡
 "$£¬ch_ext" = ".Ï"; 
th’


5081 
found
=
yes


5083 
found
=
no


5084 
fi


5086 
fi


5087 
dÚe


5088 
dÚe


5089 
‹¡
 "$found" !ğ
yes
; 
th’


5090 #d•lib 
dÛ¢
't seemo be‡†ibtool†ibrary

5091 
‹¡
 "$lškmode,$·ss" = "´og,lšk"; 
th’


5092 
compe_d•libs
="$deplib $compile_deplibs"

5093 
fš®ize_d•libs
="$deplib $finalize_deplibs"

5095 
d•libs
="$deplib $deplibs"

5096 
‹¡
 "$lškmode" = 
lib
 && 
Ãwd•’d’cy_libs
="$deplib $newdependency_libs"

5097 
fi


5099 #d•lib 
is
 
a
 
libtoŞ
 
lib¿ry


5100 #Ià
$®low_libtoŞ_libs_w™h_¡©ic_ruÁimes
 && 
$d•lib
 
is
 
a
 
¡dlib
,

5101 #W
Ãed
 
to
 dØ
some
 
¥ecŸl
 
thšgs
 
h”e
, 
ªd
 
nÙ
 
Ï‹r
.

5102 
‹¡
 "X$®low_libtoŞ_libs_w™h_¡©ic_ruÁimes" = "Xyes" ; 
th’


5103 " $´ed• $po¡d• " 
š


5105 
func_Ïlib_p
 "$lib"; 
th’


5106 
lib¿ry_Çmes
=

5107 
Şd_lib¿ry
=

5108 
func_sourû
 "$lib"

5109 
l
 
š
 
$Şd_lib¿ry
 
$lib¿ry_Çmes
; do

5110 
Î
="$l"

5111 
dÚe


5112 
‹¡
 "X$Î" = "X$Şd_lib¿ry" ; 
th’
 #Úly 
v”siÚ
 
avaabË


5113 
found
=
no


5114 
func_dœÇme
 "$lib" "" "."

5115 
Ïdœ
="$func_dirname_result"

5116 
lib
=
$Ïdœ
/
$Şd_lib¿ry


5117 
‹¡
 "$lškmode,$·ss" = "´og,lšk"; 
th’


5118 
compe_d•libs
="$deplib $compile_deplibs"

5119 
fš®ize_d•libs
="$deplib $finalize_deplibs"

5121 
d•libs
="$deplib $deplibs"

5122 
‹¡
 "$lškmode" = 
lib
 && 
Ãwd•’d’cy_libs
="$deplib $newdependency_libs"

5123 
fi


5125 
fi


5126 
fi


5129 
e§c


5130 
fi


5131 
fi


5132 ;; #-
l


5133 *.
ÉäamewÜk
)

5134 
‹¡
 "$lškmode,$·ss" = "´og,lšk"; 
th’


5135 
compe_d•libs
="$deplib $compile_deplibs"

5136 
fš®ize_d•libs
="$deplib $finalize_deplibs"

5138 
d•libs
="$deplib $deplibs"

5139 
‹¡
 "$lškmode" = 
lib
 ; 
th’


5140 "$Ãw_šh”™ed_lšk”_æag " 
š


5142 * ) 
Ãw_šh”™ed_lšk”_æags
="$new_inherited_linker_flags $deplib" ;;

5143 
e§c


5144 
fi


5145 
fi


5148 -
L
*)

5149 
$lškmode
 
š


5150 
lib
)

5151 
d•libs
="$deplib $deplibs"

5152 
‹¡
 "$·ss" = 
cÚv
 && 

5153 
Ãwd•’d’cy_libs
="$deplib $newdependency_libs"

5154 
func_¡rÇme
 '-L' '' "$deplib"

5155 
Ãwlib_£¬ch_·th
="$newlib_search_path $func_stripname_result"

5157 
´og
)

5158 
‹¡
 "$·ss" = 
cÚv
; 
th’


5159 
d•libs
="$deplib $deplibs"

5161 
fi


5162 
‹¡
 "$·ss" = 
sÿn
; 
th’


5163 
d•libs
="$deplib $deplibs"

5165 
compe_d•libs
="$deplib $compile_deplibs"

5166 
fš®ize_d•libs
="$deplib $finalize_deplibs"

5167 
fi


5168 
func_¡rÇme
 '-L' '' "$deplib"

5169 
Ãwlib_£¬ch_·th
="$newlib_search_path $func_stripname_result"

5172 
func_w¬nšg
 "\`-L' is ignored for‡rchives/objects"

5174 
e§c
 #linkmode

5176 ;; #-
L


5177 -
R
*)

5178 
‹¡
 "$·ss" = 
lšk
; 
th’


5179 
func_¡rÇme
 '-R' '' "$deplib"

5180 
dœ
=
$func_¡rÇme_»suÉ


5181 #Mak
su»
 
the
 
x½©h
 
cÚšs
 
Úly
 
unique
 
dœeùÜ›s
.

5182 "$x½©h " 
š


5184 *è
x½©h
="$xrpath $dir" ;;

5185 
e§c


5186 
fi


5187 
d•libs
="$deplib $deplibs"

5190 *.
Ï
è
lib
="$deplib" ;;

5191 *.
$libext
)

5192 
‹¡
 "$·ss" = 
cÚv
; 
th’


5193 
d•libs
="$deplib $deplibs"

5195 
fi


5196 
$lškmode
 
š


5197 
lib
)

5198 #Lškšg 
cÚv’›nû
 
moduËs
 
što
 
sh¬ed
 
lib¿r›s
 
is
 
®lowed
,

5199 #buˆ
lškšg
 
Ùh”
 
lib¿r›s
 
is
 
nÚ
-
pÜbË
.

5200 " $dÍ»cÚv’›nûlib " 
š


5203 
v®id_a_lib
=
no


5204 
$d•libs_check_m‘hod
 
š


5205 
m©ch_·‰”n
*)

5206 
£t
 
dummy
 
$d•libs_check_m‘hod
; 
shiá


5207 
m©ch_·‰”n_»gex
=`
ex´
 "$deplibs_check_method" : "$1 \(.*\)"`

5208 
ev®
 "\$ECHO \"X$d•lib\"" 2>/
dev
/
nuÎ
 | 
$X£d
 -
e
 10
q
 \

5209 | 
$EGREP
 "$m©ch_·‰”n_»gex" > /
dev
/
nuÎ
; 
th’


5210 
v®id_a_lib
=
yes


5211 
fi


5213 
·ss_®l
)

5214 
v®id_a_lib
=
yes


5216 
e§c


5217 
‹¡
 "$v®id_a_lib" !ğ
yes
; 
th’


5218 
$ECHO


5219 
$ECHO
 "*** Warning: Tryingo†ink with static†ib‡rchive $deplib."

5220 
$ECHO
 "*** I havehe capabilityo makehat†ibrary‡utomatically†ink in when"

5221 
$ECHO
 "*** you†inkohis†ibrary. But I can only dohis if you have‡"

5222 
$ECHO
 "*** shared version ofhe†ibrary, which you do‚ot‡ppearo have"

5223 
$ECHO
 "*** becausehe fileƒxtensions .$libext ofhis‡rgument makes me believe"

5224 
$ECHO
 "***hat it is just‡ static‡rchivehat I should‚ot use here."

5226 
$ECHO


5227 
$ECHO
 "*** Warning: Linkinghe shared†ibrary $output‡gainsthe"

5228 
$ECHO
 "*** static†ibrary $deplib is‚ot…ortable!"

5229 
d•libs
="$deplib $deplibs"

5230 
fi


5232 
e§c


5235 
´og
)

5236 
‹¡
 "$·ss" !ğ
lšk
; 
th’


5237 
d•libs
="$deplib $deplibs"

5239 
compe_d•libs
="$deplib $compile_deplibs"

5240 
fš®ize_d•libs
="$deplib $finalize_deplibs"

5241 
fi


5244 
e§c
 #linkmode

5245 ;; #*.
$libext


5246 *.
lo
 | *.
$objext
)

5247 
‹¡
 "$·ss" = 
cÚv
; 
th’


5248 
d•libs
="$deplib $deplibs"

5249 
–if
 
‹¡
 "$lškmode" = 
´og
; 
th’


5250 
‹¡
 "$·ss" = 
dÍ»İ’
 ||e¡ "$dlİ’_suµÜt" !ğ
yes
 ||e¡ "$bud_libtoŞ_libs" = 
no
; 
th’


5251 #Ià
th”e
 
is
 
no
 
dlİ’
 
suµÜt
 
Ü
 
we
're†inking statically,

5252 #w
Ãed
 
to
 
´–ßd
.

5253 
ÃwdÍ»fes
="$newdlprefiles $deplib"

5254 
compe_d•libs
="$deplib $compile_deplibs"

5255 
fš®ize_d•libs
="$deplib $finalize_deplibs"

5257 
Ãwdlfes
="$newdlfiles $deplib"

5258 
fi


5259 
fi


5262 %
DEPLIBS
%)

5263 
®ld•libs
=
yes


5266 
e§c
 #ÿ£ 
$d•lib


5268 
‹¡
 "$found" = 
yes
 ||e¡ -
f
 "$lib"; 
th’
 :

5270 
func_çl_”rÜ
 "cannot findhe†ibrary \`$lib' or unhandled‡rgument \`$deplib'"

5271 
fi


5273 #Check 
to
 
£e
 
th©
 
this
 
»®ly
 
is
 
a
 
libtoŞ
 
¬chive
.

5274 
func_Ïlib_un§ã_p
 "$lib" \

5275 || 
func_çl_”rÜ
 "\`$lib' is‚ot‡ valid†ibtool‡rchive"

5277 
func_dœÇme
 "$lib" "" "."

5278 
Ïdœ
="$func_dirname_result"

5280 
dÊame
=

5281 
dlİ’
=

5282 
dÍ»İ’
=

5283 
libdœ
=

5284 
lib¿ry_Çmes
=

5285 
Şd_lib¿ry
=

5286 
šh”™ed_lšk”_æags
=

5287 #Ià
the
 
lib¿ry
 
was
 
š¡®Ëd
 
w™h
 
ª
 
Şd
 
»Ëa£
 
of
 
libtoŞ
,

5288 #™ 
wl
 
nÙ
 
»defše
 
v¬ŸbËs
 
š¡®Ëd
, 
Ü
 
shouldnÙlšk


5289 
š¡®Ëd
=
yes


5290 
shouldnÙlšk
=
no


5291 
avoid‹m´·th
=

5294 #R—d 
the
 .
Ï
 
fe


5295 
func_sourû
 "$lib"

5297 #CÚv”ˆ"-äamewÜk foo" 
to
 "foo.ltframework"

5298 
‹¡
 -
n
 "$šh”™ed_lšk”_æags"; 
th’


5299 
tmp_šh”™ed_lšk”_æags
=`
$ECHO
 "X$šh”™ed_lšk”_æags" | 
$X£d
 -
e
 's/-framework \([^ $]*\)/\1.ltframework/g'`

5300 
tmp_šh”™ed_lšk”_æag
 
š
 
$tmp_šh”™ed_lšk”_æags
; do

5301 " $Ãw_šh”™ed_lšk”_æag " 
š


5303 *è
Ãw_šh”™ed_lšk”_æags
="$new_inherited_linker_flags $tmp_inherited_linker_flag";;

5304 
e§c


5305 
dÚe


5306 
fi


5307 
d•’d’cy_libs
=`
$ECHO
 "X $d•’d’cy_libs" | 
$X£d
 -
e
 's% \([^ $]*\).ltframework% -framework \1%g'`

5308 
‹¡
 "$linkmode,$pass" = "lib,link" ||

5309 
‹¡
 "$linkmode,$pass" = "prog,scan" ||

5310 { 
‹¡
 "$lškmode" !ğ
´og
 &&e¡ "$lškmode" !ğ
lib
; }; 
th’


5311 
‹¡
 -
n
 "$dlİ’" && 
dlfes
="$dlfiles $dlopen"

5312 
‹¡
 -
n
 "$dÍ»İ’" && 
dÍ»fes
="$dlprefiles $dlpreopen"

5313 
fi


5315 
‹¡
 "$·ss" = 
cÚv
; 
th’


5316 #OÆy 
check
 
cÚv’›nû
 
lib¿r›s


5317 
d•libs
="$lib $deplibs"

5318 
‹¡
 -
z
 "$libdœ"; 
th’


5319 
‹¡
 -
z
 "$Şd_lib¿ry"; 
th’


5320 
func_çl_”rÜ
 "cannot find‚ame of†ink†ibrary for \`$lib'"

5321 
fi


5322 #Iˆ
is
 
a
 
libtoŞ
 
cÚv’›nû
 
lib¿ry
, 
so
 
add
 
š
 
™s
 
objeùs
.

5323 
cÚv’›nû
="$convenience $ladir/$objdir/$old_library"

5324 
Şd_cÚv’›nû
="$old_convenience $ladir/$objdir/$old_library"

5325 
tmp_libs
=

5326 
d•lib
 
š
 
$d•’d’cy_libs
; do

5327 
d•libs
="$deplib $deplibs"

5328 
$İt_du¶iÿ‹_d•s
 ; 
th’


5329 "$tmp_lib " 
š


5330 *" $d•lib "*è
¥ecŸld•libs
="$specialdeplibs $deplib" ;;

5331 
e§c


5332 
fi


5333 
tmp_libs
="$tmp_libs $deplib"

5334 
dÚe


5335 
–if
 
‹¡
 "$lškmode" !ğ
´og
 &&e¡ "$lškmode" !ğ
lib
; 
th’


5336 
func_çl_”rÜ
 "\`$lib' is‚ot‡ convenience†ibrary"

5337 
fi


5339 
fi
 #$·s ğ
cÚv


5342 #G‘ 
the
 
Çme
 
of
h
lib¿ry
 
we
 
lšk
 
agaš¡
.

5343 
lšklib
=

5344 
l
 
š
 
$Şd_lib¿ry
 
$lib¿ry_Çmes
; do

5345 
lšklib
="$l"

5346 
dÚe


5347 
‹¡
 -
z
 "$lšklib"; 
th’


5348 
func_çl_”rÜ
 "cannot find‚ame of†ink†ibrary for \`$lib'"

5349 
fi


5351 #Thi 
lib¿ry
 
was
 
¥ecif›d
 
w™h
 -
dlİ’
.

5352 
‹¡
 "$·ss" = 
dlİ’
; 
th’


5353 
‹¡
 -
z
 "$libdœ"; 
th’


5354 
func_çl_”rÜ
 "cannot -dlopen‡ convenience†ibrary: \`$lib'"

5355 
fi


5356 
‹¡
 -
z
 "$dlname" ||

5357 
‹¡
 "$dlİ’_suµÜt" !ğ
yes
 ||

5358 
‹¡
 "$bud_libtoŞ_libs" = 
no
; 
th’


5359 #Ià
th”e
 
is
 
no
 
dÊame
,‚Ø
dlİ’
 
suµÜt
 
Ü
 
we
're†inking

5360 #¡©iÿÎy, 
we
 
Ãed
 
to
 
´–ßd
. 
We
 
®so
‚“dØ´–ßd 
ªy


5361 #d•’d’ˆ
lib¿r›s
 
so
 
libÉdl
' d•lib…»lßd” dÛ¢'
t


5362 #bomb 
out
 
š
 
the
 
lßd
 
d•libs
 
pha£
.

5363 
dÍ»fes
="$dlprefiles $lib $dependency_libs"

5365 
Ãwdlfes
="$newdlfiles $lib"

5366 
fi


5368 
fi
 #$·s ğ
dlİ’


5370 #W
Ãed
 
ª
 
absŞu‹
 
·th
.

5371 
$Ïdœ
 
š


5372 [\\/]* | [
A
-
Za
-
z
]:[\\/]*è
abs_Ïdœ
="$ladir" ;;

5374 
abs_Ïdœ
=`
cd
 "$Ïdœ" && 
pwd
`

5375 
‹¡
 -
z
 "$abs_Ïdœ"; 
th’


5376 
func_w¬nšg
 "cannot determine‡bsolute directory‚ame of \`$ladir'"

5377 
func_w¬nšg
 "passing it†iterallyohe†inker,‡lthough it might fail"

5378 
abs_Ïdœ
="$ladir"

5379 
fi


5381 
e§c


5382 
func_ba£Çme
 "$lib"

5383 
ÏÇme
="$func_basename_result"

5385 #Fšd 
the
 
»Ëvªt
 
objeù
 
dœeùÜy
 
ªd
 
lib¿ry
 
Çme
.

5386 
‹¡
 "X$š¡®Ëd" = 
Xyes
; 
th’


5387 
‹¡
 ! -
f
 "$libdœ/$lšklib" &&e¡ -à"$abs_Ïdœ/$lšklib"; 
th’


5388 
func_w¬nšg
 "library \`$lib' was moved."

5389 
dœ
="$ladir"

5390 
absdœ
="$abs_ladir"

5391 
libdœ
="$abs_ladir"

5393 
dœ
="$libdir"

5394 
absdœ
="$libdir"

5395 
fi


5396 
‹¡
 "X$h¬dcode_autom©ic" = 
Xyes
 && 
avoid‹m´·th
=
yes


5398 
‹¡
 ! -
f
 "$Ïdœ/$objdœ/$lšklib" &&e¡ -à"$abs_Ïdœ/$lšklib"; 
th’


5399 
dœ
="$ladir"

5400 
absdœ
="$abs_ladir"

5401 #Remov
this
 
£¬ch
 
·th
 
Ï‹r


5402 
nÙš¡_·th
="$notinst_path $abs_ladir"

5404 
dœ
="$ladir/$objdir"

5405 
absdœ
="$abs_ladir/$objdir"

5406 #Remov
this
 
£¬ch
 
·th
 
Ï‹r


5407 
nÙš¡_·th
="$notinst_path $abs_ladir"

5408 
fi


5409 
fi
 #$š¡®Ëd = 
yes


5410 
func_¡rÇme
 'lib' '.la' "$laname"

5411 
Çme
=
$func_¡rÇme_»suÉ


5413 #Thi 
lib¿ry
 
was
 
¥ecif›d
 
w™h
 -
dÍ»İ’
.

5414 
‹¡
 "$·ss" = 
dÍ»İ’
; 
th’


5415 
‹¡
 -
z
 "$libdœ" &&e¡ "$lškmode" = 
´og
; 
th’


5416 
func_çl_”rÜ
 "only†ibraries may -dlpreopen‡ convenience†ibrary: \`$lib'"

5417 
fi


5418 #P»ã¸
usšg
 
a
 
	`lib¿ry
 (
so
 
th©
 
no
 
sly
 
_DYNAMIC
 
symbŞs


5419 #¬
»quœed
 
to
 
lšk
).

5420 
‹¡
 -
n
 "$Şd_lib¿ry"; 
th’


5421 
ÃwdÍ»fes
="$newdlprefiles $dir/$old_library"

5422 #K“°
a
 
li¡
 
of
 
´eİ’ed
 
cÚv’›nû
 
lib¿r›s
 
to
 
check


5423 #th© 
they
 
¬e
 
bešg
 
u£d
 
cÜ»ùly
 
š
 
the
 
lšk
 
·ss
.

5424 
‹¡
 -
z
 "$libdir" && \

5425 
dÍ»cÚv’›nûlibs
="$dlpreconveniencelibs $dir/$old_library"

5426 #Oth”wi£, 
u£
 
the
 
dÊame
, 
so
 
th©
 
É_dlİ’
 
fšds
 
™
.

5427 
–if
 
‹¡
 -
n
 "$dÊame"; 
th’


5428 
ÃwdÍ»fes
="$newdlprefiles $dir/$dlname"

5430 
ÃwdÍ»fes
="$newdlprefiles $dir/$linklib"

5431 
fi


5432 
fi
 #$·s ğ
dÍ»İ’


5434 
‹¡
 -
z
 "$libdœ"; 
th’


5435 #Lšk 
the
 
cÚv’›nû
 
lib¿ry


5436 
‹¡
 "$lškmode" = 
lib
; 
th’


5437 
d•libs
="$dir/$old_library $deplibs"

5438 
–if
 
‹¡
 "$lškmode,$·ss" = "´og,lšk"; 
th’


5439 
compe_d•libs
="$dir/$old_library $compile_deplibs"

5440 
fš®ize_d•libs
="$dir/$old_library $finalize_deplibs"

5442 
d•libs
="$lib $d•libs" #u£d 
´og
,
sÿn
 
·ss


5443 
fi


5445 
fi


5448 
‹¡
 "$lškmode" = 
´og
 &&e¡ "$·ss" !ğ
lšk
; 
th’


5449 
Ãwlib_£¬ch_·th
="$newlib_search_path $ladir"

5450 
d•libs
="$lib $deplibs"

5452 
lšk®ld•libs
=
no


5453 
‹¡
 "$lšk_®l_d•libs" !ğ
no
 ||e¡ -
z
 "$library_names" ||

5454 
‹¡
 "$bud_libtoŞ_libs" = 
no
; 
th’


5455 
lšk®ld•libs
=
yes


5456 
fi


5458 
tmp_libs
=

5459 
d•lib
 
š
 
$d•’d’cy_libs
; do

5460 
$d•lib
 
š


5461 -
L
*è
func_¡rÇme
 '-L' '' "$deplib"

5462 
Ãwlib_£¬ch_·th
="$newlib_search_path $func_stripname_result"

5464 
e§c


5465 #N“d 
to
 
lšk
 
agaš¡
 
®l
 
d•’d’cy_libs
?

5466 
‹¡
 "$lšk®ld•libs" = 
yes
; 
th’


5467 
d•libs
="$deplib $deplibs"

5469 #N“d 
to
 
h¬dcode
 
sh¬ed
 
lib¿ry
 
·ths


5470 #Ü/
ªd
 
lšk
 
agaš¡
 
lib¿r›s


5471 
Ãwd•’d’cy_libs
="$deplib $newdependency_libs"

5472 
fi


5473 
$İt_du¶iÿ‹_d•s
 ; 
th’


5474 "$tmp_lib " 
š


5475 *" $d•lib "*è
¥ecŸld•libs
="$specialdeplibs $deplib" ;;

5476 
e§c


5477 
fi


5478 
tmp_libs
="$tmp_libs $deplib"

5479 
dÚe
 #fÜ 
d•lib


5481 
fi
 #$lškmodğ
´og
...

5483 
‹¡
 "$lškmode,$·ss" = "´og,lšk"; 
th’


5484 
‹¡
 -
n
 "$library_names" &&

5485 { { 
‹¡
 "$´eãr_¡©ic_libs" = 
no
 ||

5486 
‹¡
 "$prefer_static_libs,$installed" = "built,yes"; } ||

5487 
‹¡
 -
z
 "$Şd_lib¿ry"; }; 
th’


5488 #W
Ãed
 
to
 
h¬dcode
 
the
 
lib¿ry
 
·th


5489 
‹¡
 -
n
 "$shlib·th_v¬" &&e¡ -
z
 "$avoid‹m´·th" ; 
th’


5490 #Mak
su»
 
the
 
½©h
 
cÚšs
 
Úly
 
unique
 
dœeùÜ›s
.

5491 "$‹mp_½©h:" 
š


5493 *è
‹mp_½©h
="$temp_rpath$absdir:" ;;

5494 
e§c


5495 
fi


5497 #H¬dcod
the
 
lib¿ry
 
·th
.

5498 #Sk 
dœeùÜ›s
 
th©
 
¬e
 
š
 
the
 
sy¡em
  
run
-
time


5499 #£¬ch 
·th
.

5500 " $sys_lib_dl£¬ch_·th " 
š


5503 "$compe_½©h " 
š


5505 *è
compe_½©h
="$compile_rpath $absdir"

5506 
e§c


5508 
e§c


5509 " $sys_lib_dl£¬ch_·th " 
š


5512 "$fš®ize_½©h " 
š


5514 *è
fš®ize_½©h
="$finalize_rpath $libdir"

5515 
e§c


5517 
e§c


5518 
fi
 #$lškmode,
$·ss
 = 
´og
,
lšk
...

5520 
‹¡
 "$®ld•libs" = 
yes
 &&

5521 { 
‹¡
 "$d•libs_check_m‘hod" = 
·ss_®l
 ||

5522 { 
‹¡
 "$bud_libtoŞ_libs" = 
yes
 &&

5523 
‹¡
 -
n
 "$lib¿ry_Çmes"; }; }; 
th’


5524 #W
Úly
 
Ãed
 
to
 
£¬ch
 
lib¿r›s


5526 
fi


5527 
fi


5529 
lšk_¡©ic
=
no
 #Wh‘h” 
the
 
d•lib
 
wl
 
be
 
lšked
 
¡©iÿÎy


5530 
u£_¡©ic_libs
=
$´eãr_¡©ic_libs


5531 
‹¡
 "$u£_¡©ic_libs" = 
but
 &&e¡ "$š¡®Ëd" = 
yes
; 
th’


5532 
u£_¡©ic_libs
=
no


5533 
fi


5534 
‹¡
 -
n
 "$library_names" &&

5535 { 
‹¡
 "$u£_¡©ic_libs" = 
no
 ||e¡ -
z
 "$Şd_lib¿ry"; }; 
th’


5536 
$ho¡
 
š


5537 *
cygwš
* | *
mšgw
* | *
ûgcc
*)

5538 #NØ
pošt
 
š
 
»lškšg
 
DLLs
 
beÿu£
 
·ths
 
¬e
 
nÙ
 
’coded


5539 
nÙš¡_d•libs
="$notinst_deplibs $lib"

5540 
Ãed_»lšk
=
no


5543 
‹¡
 "$š¡®Ëd" = 
no
; 
th’


5544 
nÙš¡_d•libs
="$notinst_deplibs $lib"

5545 
Ãed_»lšk
=
yes


5546 
fi


5548 
e§c


5549 #Thi 
is
 
a
 
sh¬ed
 
lib¿ry


5551 #W¬À
about
 
pÜb™y
, 
ÿn
'ˆlšk‡gaš¡ -moduË'
s
 
Ú
 
some


5552 #sy¡em (
d¬wš
). 
DÚ
't bleat‡bout dlopened moduleshough!

5553 
dlİ’moduË
=""

5554 
dÍ»moduË‹¡
 
š
 
$dÍ»fes
; do

5555 
‹¡
 "X$dÍ»moduË‹¡" = "X$lib"; 
th’


5556 
dlİ’moduË
="$dlpremoduletest"

5558 
fi


5559 
dÚe


5560 
‹¡
 -
z
 "$dlİ’moduË" &&e¡ "$shouldnÙlšk" = 
yes
 &&e¡ "$·ss" = 
lšk
; 
th’


5561 
$ECHO


5562 
‹¡
 "$lškmode" = 
´og
; 
th’


5563 
$ECHO
 "*** Warning: Linkingheƒxecutable $output‡gainsthe†oadable module"

5565 
$ECHO
 "*** Warning: Linkinghe shared†ibrary $output‡gainsthe†oadable module"

5566 
fi


5567 
$ECHO
 "*** $linklib is‚ot…ortable!"

5568 
fi


5569 
‹¡
 "$lškmode" = 
lib
 &&

5570 
‹¡
 "$h¬dcode_što_libs" = 
yes
; 
th’


5571 #H¬dcod
the
 
lib¿ry
 
·th
.

5572 #Sk 
dœeùÜ›s
 
th©
 
¬e
 
š
 
the
 
sy¡em
  
run
-
time


5573 #£¬ch 
·th
.

5574 " $sys_lib_dl£¬ch_·th " 
š


5577 "$compe_½©h " 
š


5579 *è
compe_½©h
="$compile_rpath $absdir"

5580 
e§c


5582 
e§c


5583 " $sys_lib_dl£¬ch_·th " 
š


5586 "$fš®ize_½©h " 
š


5588 *è
fš®ize_½©h
="$finalize_rpath $libdir"

5589 
e§c


5591 
e§c


5592 
fi


5594 
‹¡
 -
n
 "$Şd_¬chive_äom_expsyms_cmds"; 
th’


5595 #figu» 
out
 
the
 
sÚame


5596 
£t
 
dummy
 
$lib¿ry_Çmes


5597 
shiá


5598 
»®Çme
="$1"

5599 
shiá


5600 
libÇme
=`
ev®
 "\\$ECHO \"$libname_spec\""`

5601 #u£ 
dÊame
 
we
 
gÙ
 
™
. it's…erfectly good,‚o?

5602 
‹¡
 -
n
 "$dÊame"; 
th’


5603 
sÚame
="$dlname"

5604 
–if
 
‹¡
 -
n
 "$sÚame_¥ec"; 
th’


5605 #bËh 
wšdows


5606 
$ho¡
 
š


5607 *
cygwš
* | 
mšgw
* | *
ûgcc
*)

5608 
func_¬™h
 
$cu¼’t
 - 
$age


5609 
majÜ
=
$func_¬™h_»suÉ


5610 
v”suffix
="-$major"

5612 
e§c


5613 
ev®
 
sÚame
=\"$soname_spec\"

5615 
sÚame
="$realname"

5616 
fi


5618 #Mak
a
 
Ãw
 
Çme
 
the
 
exŒaù_expsyms_cmds
 
to
 
u£


5619 
sÜoÙ
="$soname"

5620 
func_ba£Çme
 "$soroot"

5621 
sÚame
="$func_basename_result"

5622 
func_¡rÇme
 'lib' '.dll' "$soname"

5623 
Ãwlib
=
libimp
-
$func_¡rÇme_»suÉ
.
a


5625 #Ià
the
 
lib¿ry
 
has
 
no
 
expÜt
 
li¡
, 
th’
 
ü—‹
 
Úe
 
now


5626 
‹¡
 -
f
 "$ouut_objdœ/$sÚame-def"; 
th’
 :

5628 
func_v”bo£
 "extractingƒxported symbol†ist from \`$soname'"

5629 
func_execu‹_cmds
 "$extract_expsyms_cmds" 'exit $?'

5630 
fi


5632 #C»©
$Ãwlib


5633 
‹¡
 -
f
 "$ouut_objdœ/$Ãwlib"; 
th’
 :; 

5634 
func_v”bo£
 "generating import†ibrary for \`$soname'"

5635 
func_execu‹_cmds
 "$old_archive_from_expsyms_cmds" 'exit $?'

5636 
fi


5637 #mak
su»
 
the
 
lib¿ry
 
v¬ŸbËs
 
¬e
 
poštšg
 
to
h
Ãw
†ibrary

5638 
dœ
=
$ouut_objdœ


5639 
lšklib
=
$Ãwlib


5640 
fi
 #‹¡ -
n
 "$old_archive_from_expsyms_cmds"

5642 
‹¡
 "$lškmode" = 
´og
 ||e¡ "$mode" !ğ
»lšk
; 
th’


5643 
add_shlib·th
=

5644 
add_dœ
=

5645 
add
=

5646 
lib_lšked
=
yes


5647 
$h¬dcode_aùiÚ
 
š


5648 
immedŸ‹
 | 
unsuµÜ‹d
)

5649 
‹¡
 "$h¬dcode_dœeù" = 
no
; 
th’


5650 
add
="$dir/$linklib"

5651 
$ho¡
 
š


5652 *-*-
sco3
.2
v5
.0.[024]*è
add_dœ
="-L$dir" ;;

5653 *-*-
sysv4
*
uw2
*è
add_dœ
="-L$dir" ;;

5654 *-*-
sysv5O³nUNIX
* | *-*-
sysv5UnixW¬e7
.[01].[10]* | \

5655 *-*-
unixw¬e7
*è
add_dœ
="-L$dir" ;;

5656 *-*-
d¬wš
* )

5657 #ià
the
 
lib
 
is
 
	`a
 (
nÚ
-
dlİ’ed
è
moduË
 
th’
 
we
 
ÿn
 
nÙ


5658 #lšk 
agaš¡
 
™
, 
someÚe
 
is
 
ignÜšg
 
the
 
—¾›r
 
w¬nšgs


5659 /
u¤
/
bš
/
fe
 -
L
 
$add
 2> /
dev
/
nuÎ
 |

5660 
$GREP
 ": [^:]* bundË" >/
dev
/
nuÎ
 ; 
th’


5661 
‹¡
 "X$dlİ’moduË" !ğ"X$lib"; 
th’


5662 
$ECHO
 "*** Warning:†ib $linklib is‡ module,‚ot‡ shared†ibrary"

5663 
‹¡
 -
z
 "$Şd_lib¿ry" ; 
th’


5664 
$ECHO


5665 
$ECHO
 "*** Andhere doesn't seemo be‡ static‡rchive‡vailable"

5666 
$ECHO
 "*** The†ink will…robably fail, sorry"

5668 
add
="$dir/$old_library"

5669 
fi


5670 
–if
 
‹¡
 -
n
 "$Şd_lib¿ry"; 
th’


5671 
add
="$dir/$old_library"

5672 
fi


5673 
fi


5674 
e§c


5675 
–if
 
‹¡
 "$h¬dcode_mšus_L" = 
no
; 
th’


5676 
$ho¡
 
š


5677 *-*-
sunos
*è
add_shlib·th
="$dir" ;;

5678 
e§c


5679 
add_dœ
="-L$dir"

5680 
add
="-l$name"

5681 
–if
 
‹¡
 "$h¬dcode_shlib·th_v¬" = 
no
; 
th’


5682 
add_shlib·th
="$dir"

5683 
add
="-l$name"

5685 
lib_lšked
=
no


5686 
fi


5688 
»lšk
)

5689 
‹¡
 "$h¬dcode_dœeù" = 
yes
 &&

5690 
‹¡
 "$h¬dcode_dœeù_absŞu‹" = 
no
; 
th’


5691 
add
="$dir/$linklib"

5692 
–if
 
‹¡
 "$h¬dcode_mšus_L" = 
yes
; 
th’


5693 
add_dœ
="-L$dir"

5694 #Try 
lookšg
 
fœ¡
 
š
 
the
 
loÿtiÚ
 
we
're being installedo.

5695 
‹¡
 -
n
 "$š¡_´efix_dœ"; 
th’


5696 
$libdœ
 
š


5698 
add_dœ
="$add_dir -L$inst_prefix_dir$libdir"

5700 
e§c


5701 
fi


5702 
add
="-l$name"

5703 
–if
 
‹¡
 "$h¬dcode_shlib·th_v¬" = 
yes
; 
th’


5704 
add_shlib·th
="$dir"

5705 
add
="-l$name"

5707 
lib_lšked
=
no


5708 
fi


5710 *è
lib_lšked
=
no
 ;;

5711 
e§c


5713 
‹¡
 "$lib_lšked" !ğ
yes
; 
th’


5714 
func_çl_cÚfigu¿tiÚ
 "unsupported hardcode…roperties"

5715 
fi


5717 
‹¡
 -
n
 "$add_shlib·th"; 
th’


5718 :
$compe_shlib·th
: 
š


5720 *è
compe_shlib·th
="$compile_shlibpath$add_shlibpath:" ;;

5721 
e§c


5722 
fi


5723 
‹¡
 "$lškmode" = 
´og
; 
th’


5724 
‹¡
 -
n
 "$add_dœ" && 
compe_d•libs
="$add_dir $compile_deplibs"

5725 
‹¡
 -
n
 "$add" && 
compe_d•libs
="$add $compile_deplibs"

5727 
‹¡
 -
n
 "$add_dœ" && 
d•libs
="$add_dir $deplibs"

5728 
‹¡
 -
n
 "$add" && 
d•libs
="$add $deplibs"

5729 
‹¡
 "$h¬dcode_dœeù" !ğ
yes
 &&

5730 
‹¡
 "$h¬dcode_mšus_L" !ğ
yes
 &&

5731 
‹¡
 "$h¬dcode_shlib·th_v¬" = 
yes
; 
th’


5732 :
$fš®ize_shlib·th
: 
š


5734 *è
fš®ize_shlib·th
="$finalize_shlibpath$libdir:" ;;

5735 
e§c


5736 
fi


5737 
fi


5738 
fi


5740 
‹¡
 "$lškmode" = 
´og
 ||e¡ "$mode" = 
»lšk
; 
th’


5741 
add_shlib·th
=

5742 
add_dœ
=

5743 
add
=

5744 #Fš®iz
commªd
 
bÙh
 
is
 
sim¶e
: 
ju¡
 
h¬dcode
 
™
.

5745 
‹¡
 "$h¬dcode_dœeù" = 
yes
 &&

5746 
‹¡
 "$h¬dcode_dœeù_absŞu‹" = 
no
; 
th’


5747 
add
="$libdir/$linklib"

5748 
–if
 
‹¡
 "$h¬dcode_mšus_L" = 
yes
; 
th’


5749 
add_dœ
="-L$libdir"

5750 
add
="-l$name"

5751 
–if
 
‹¡
 "$h¬dcode_shlib·th_v¬" = 
yes
; 
th’


5752 :
$fš®ize_shlib·th
: 
š


5754 *è
fš®ize_shlib·th
="$finalize_shlibpath$libdir:" ;;

5755 
e§c


5756 
add
="-l$name"

5757 
–if
 
‹¡
 "$h¬dcode_autom©ic" = 
yes
; 
th’


5758 
‹¡
 -
n
 "$inst_prefix_dir" &&

5759 
‹¡
 -
f
 "$š¡_´efix_dœ$libdœ/$lšklib" ; 
th’


5760 
add
="$inst_prefix_dir$libdir/$linklib"

5762 
add
="$libdir/$linklib"

5763 
fi


5765 #W
ÿÂÙ
 
£em
 
to
 
h¬dcode
 
™
, 
guess
 
we
'll fake it.

5766 
add_dœ
="-L$libdir"

5767 #Try 
lookšg
 
fœ¡
 
š
 
the
 
loÿtiÚ
 
we
're being installedo.

5768 
‹¡
 -
n
 "$š¡_´efix_dœ"; 
th’


5769 
$libdœ
 
š


5771 
add_dœ
="$add_dir -L$inst_prefix_dir$libdir"

5773 
e§c


5774 
fi


5775 
add
="-l$name"

5776 
fi


5778 
‹¡
 "$lškmode" = 
´og
; 
th’


5779 
‹¡
 -
n
 "$add_dœ" && 
fš®ize_d•libs
="$add_dir $finalize_deplibs"

5780 
‹¡
 -
n
 "$add" && 
fš®ize_d•libs
="$add $finalize_deplibs"

5782 
‹¡
 -
n
 "$add_dœ" && 
d•libs
="$add_dir $deplibs"

5783 
‹¡
 -
n
 "$add" && 
d•libs
="$add $deplibs"

5784 
fi


5785 
fi


5786 
–if
 
‹¡
 "$lškmode" = 
´og
; 
th’


5787 #H”
we
 
assume
 
th©
 
Úe
 
of
 
h¬dcode_dœeù
 
Ü
 
h¬dcode_mšus_L


5788 #i 
nÙ
 
unsuµÜ‹d
. 
This
 
is
 
v®id
 
Ú
 
®l
 
known
 
ªd


5789 #sh¬ed 
¶©fÜms
.

5790 
‹¡
 "$h¬dcode_dœeù" !ğ
unsuµÜ‹d
; 
th’


5791 
‹¡
 -
n
 "$Şd_lib¿ry" && 
lšklib
="$old_library"

5792 
compe_d•libs
="$dir/$linklib $compile_deplibs"

5793 
fš®ize_d•libs
="$dir/$linklib $finalize_deplibs"

5795 
compe_d•libs
="-l$name -L$dir $compile_deplibs"

5796 
fš®ize_d•libs
="-l$name -L$dir $finalize_deplibs"

5797 
fi


5798 
–if
 
‹¡
 "$bud_libtoŞ_libs" = 
yes
; 
th’


5799 #NÙ 
a
 
sh¬ed
 
lib¿ry


5800 
‹¡
 "$d•libs_check_m‘hod" !ğ
·ss_®l
; 
th’


5802 #buˆ
the
 
sy¡em
 
dÛ¢
't support it.

5804 #Ju¡ 
´št
 
a
 
w¬nšg
 
ªd
 
add
 
the
 
lib¿ry
 
to
 
d•’d’cy_libs
 
so


5805 #th© 
the
 
´og¿m
 
ÿn
 
be
 
lšked
 
agaš¡
h
lib¿ry
.

5806 
$ECHO


5807 
$ECHO
 "*** Warning: This system can‚ot†inko static†ib‡rchive $lib."

5808 
$ECHO
 "*** I havehe capabilityo makehat†ibrary‡utomatically†ink in when"

5809 
$ECHO
 "*** you†inkohis†ibrary. But I can only dohis if you have‡"

5810 
$ECHO
 "*** shared version ofhe†ibrary, which you do‚ot‡ppearo have."

5811 
‹¡
 "$moduË" = 
yes
; 
th’


5812 
$ECHO
 "*** But‡s youryo build‡ module†ibrary,†ibtool will still create "

5813 
$ECHO
 "***‡ static module,hat should work‡s†ong‡she dlopening‡pplication"

5814 
$ECHO
 "*** is†inked withhe -dlopen flago„esolve symbols‡t„untime."

5815 
‹¡
 -
z
 "$glob®_symbŞ_pe"; 
th’


5816 
$ECHO


5817 
$ECHO
 "*** However,his would only work if†ibtool was‡bleoƒxtract symbol"

5818 
$ECHO
 "***†ists from‡…rogram, using \`nm' orƒquivalent, but†ibtool could"

5819 
$ECHO
 "***‚ot find such‡…rogram. So,his module is…robably useless."

5820 
$ECHO
 "*** \`nm' from GNU binutils‡nd‡ full„ebuild may help."

5821 
fi


5822 
‹¡
 "$bud_Şd_libs" = 
no
; 
th’


5823 
bud_libtoŞ_libs
=
moduË


5824 
bud_Şd_libs
=
yes


5826 
bud_libtoŞ_libs
=
no


5827 
fi


5828 
fi


5830 
d•libs
="$dir/$old_library $deplibs"

5831 
lšk_¡©ic
=
yes


5832 
fi


5833 
fi
 #lšk 
sh¬ed
/
lib¿ry
?

5835 
‹¡
 "$lškmode" = 
lib
; 
th’


5836 
‹¡
 -
n
 "$dependency_libs" &&

5837 { 
‹¡
 "$h¬dcode_što_libs" !ğ
yes
 ||

5838 
‹¡
 "$bud_Şd_libs" = 
yes
 ||

5839 
‹¡
 "$lšk_¡©ic" = 
yes
; }; 
th’


5840 #ExŒaù -
R
 
äom
 
d•’d’cy_libs


5841 
‹mp_d•libs
=

5842 
libdœ
 
š
 
$d•’d’cy_libs
; do

5843 
$libdœ
 
š


5844 -
R
*è
func_¡rÇme
 '-R' '' "$libdir"

5845 
‹mp_x½©h
=
$func_¡rÇme_»suÉ


5846 " $x½©h " 
š


5848 *è
x½©h
="$xrpath $temp_xrpath";;

5849 
e§c
;;

5850 *è
‹mp_d•libs
="$temp_deplibs $libdir";;

5851 
e§c


5852 
dÚe


5853 
d•’d’cy_libs
="$temp_deplibs"

5854 
fi


5856 
Ãwlib_£¬ch_·th
="$newlib_search_path $absdir"

5857 #Lšk 
agaš¡
 
this
 
lib¿ry


5858 
‹¡
 "$lšk_¡©ic" = 
no
 && 
Ãwd•’d’cy_libs
="$abs_ladir/$laname $newdependency_libs"

5859 #... 
ªd
 
™s
 
d•’d’cy_libs


5860 
tmp_libs
=

5861 
d•lib
 
š
 
$d•’d’cy_libs
; do

5862 
Ãwd•’d’cy_libs
="$deplib $newdependency_libs"

5863 
$İt_du¶iÿ‹_d•s
 ; 
th’


5864 "$tmp_lib " 
š


5865 *" $d•lib "*è
¥ecŸld•libs
="$specialdeplibs $deplib" ;;

5866 
e§c


5867 
fi


5868 
tmp_libs
="$tmp_libs $deplib"

5869 
dÚe


5871 
‹¡
 "$lšk_®l_d•libs" !ğ
no
; 
th’


5872 #Add 
the
 
£¬ch
 
·ths
 
of
 
®l
 
d•’d’cy
 
lib¿r›s


5873 
d•lib
 
š
 
$d•’d’cy_libs
; do

5874 
·th
=

5875 
$d•lib
 
š


5876 -
L
*è
·th
="$deplib" ;;

5877 *.
Ï
)

5878 
func_dœÇme
 "$deplib" "" "."

5879 
dœ
="$func_dirname_result"

5880 #W
Ãed
 
ª
 
absŞu‹
 
·th
.

5881 
$dœ
 
š


5882 [\\/]* | [
A
-
Za
-
z
]:[\\/]*è
absdœ
="$dir" ;;

5884 
absdœ
=`
cd
 "$dœ" && 
pwd
`

5885 
‹¡
 -
z
 "$absdœ"; 
th’


5886 
func_w¬nšg
 "cannot determine‡bsolute directory‚ame of \`$dir'"

5887 
absdœ
="$dir"

5888 
fi


5890 
e§c


5891 
$GREP
 "^š¡®Ëdòo" 
$d•lib
 > /
dev
/
nuÎ
; 
th’


5892 
$ho¡
 
š


5893 *-*-
d¬wš
*)

5894 
d•d•l
=

5895 
ev®
 
d•lib¿ry_Çmes
=`
$
{
SED
} -
n
 -
e
 's/^lib¿ry_Çmes=\(.*\)$/\1/p' 
$d•lib
`

5896 
‹¡
 -
n
 "$d•lib¿ry_Çmes" ; 
th’


5897 
tmp
 
š
 
$d•lib¿ry_Çmes
 ; do

5898 
d•d•l
=
$tmp


5899 
dÚe


5900 
‹¡
 -
f
 "$absdœ/$objdœ/$d•d•l" ; 
th’


5901 
d•d•l
="$absdir/$objdir/$depdepl"

5902 
d¬wš_š¡®l_Çme
=`
$
{
OTOOL
} -
L
 
$d•d•l
 | 
awk
 '{if (NR == 2) {print $1;exit}}'`

5903 
‹¡
 -
z
 "$d¬wš_š¡®l_Çme"; 
th’


5904 
d¬wš_š¡®l_Çme
=`
$
{
OTOOL64
} -
L
 
$d•d•l
 | 
awk
 '{if (NR == 2) {print $1;exit}}'`

5905 
fi


5906 
comp”_æags
="$compiler_flags ${wl}-dylib_file ${wl}${darwin_install_name}:${depdepl}"

5907 
lšk”_æags
="$linker_flags -dylib_file ${darwin_install_name}:${depdepl}"

5908 
·th
=

5909 
fi


5910 
fi


5913 
·th
="-L$absdir/$objdir"

5915 
e§c


5917 
ev®
 
libdœ
=`
$
{
SED
} -
n
 -
e
 's/^libdœ=\(.*\)$/\1/p' 
$d•lib
`

5918 
‹¡
 -
z
 "$libdir" && \

5919 
func_çl_”rÜ
 "\`$deplib' is‚ot‡ valid†ibtool‡rchive"

5920 
‹¡
 "$absdir" != "$libdir" && \

5921 
func_w¬nšg
 "\`$deplib' seemso be moved"

5923 
·th
="-L$absdir"

5924 
fi


5926 
e§c


5927 " $d•lib " 
š


5929 *è
d•libs
="$path $deplibs" ;;

5930 
e§c


5931 
dÚe


5932 
fi
 #lšk_®l_d•lib !ğ
no


5933 
fi
 #lškmodğ
lib


5934 
dÚe
 #fÜ 
d•lib
 
š
 
$libs


5935 
‹¡
 "$·ss" = 
lšk
; 
th’


5936 
‹¡
 "$lškmode" = "´og"; 
th’


5937 
compe_d•libs
="$new_inherited_linker_flags $compile_deplibs"

5938 
fš®ize_d•libs
="$new_inherited_linker_flags $finalize_deplibs"

5940 
comp”_æags
="$comp”_æag "`
$ECHO
 "X $Ãw_šh”™ed_lšk”_æags" | 
$X£d
 -
e
 's% \([^ $]*\).ltframework% -framework \1%g'`

5941 
fi


5942 
fi


5943 
d•’d’cy_libs
="$newdependency_libs"

5944 
‹¡
 "$·ss" = 
dÍ»İ’
; 
th’


5945 #Lšk 
the
 
dÍ»İ’ed
 
lib¿r›s
 
befÜe
 
Ùh”
†ibraries

5946 
d•lib
 
š
 
$§ve_d•libs
; do

5947 
d•libs
="$deplib $deplibs"

5948 
dÚe


5949 
fi


5950 
‹¡
 "$·ss" !ğ
dlİ’
; 
th’


5951 
‹¡
 "$·ss" !ğ
cÚv
; 
th’


5952 #Mak
su»
 
lib_£¬ch_·th
 
cÚšs
 
Úly
 
unique
 
dœeùÜ›s
.

5953 
lib_£¬ch_·th
=

5954 
dœ
 
š
 
$Ãwlib_£¬ch_·th
; do

5955 "$lib_£¬ch_·th " 
š


5957 *è
lib_£¬ch_·th
="$lib_search_path $dir" ;;

5958 
e§c


5959 
dÚe


5960 
Ãwlib_£¬ch_·th
=

5961 
fi


5963 
‹¡
 "$lškmode,$·ss" !ğ"´og,lšk"; 
th’


5964 
v¬s
="deplibs"

5966 
v¬s
="compile_deplibs finalize_deplibs"

5967 
fi


5968 
v¬
 
š
 
$v¬s
 
d•’d’cy_libs
; do

5969 #Add 
lib¿r›s
 
to
 
$v¬
 
š
 
»v”£
 
Üd”


5970 
ev®
 
tmp_libs
=\"\$$var\"

5971 
Ãw_libs
=

5972 
d•lib
 
š
 
$tmp_libs
; do

5973 #FIXME: 
PedªtiÿÎy
, 
this
 
is
 
the
 
right
 
thšg
 
to
 do, 
so


5974 #th© 
some
 
Ç¡y
 
d•’d’cy
 
loİ
 
i¢
't‡ccidentally

5977 #P¿gm©iÿÎy, 
this
 
£ems
 
to
 
ÿu£
 
v”y
 
ãw
 
´obËms
 
š


5979 
$d•lib
 
š


5980 -
L
*è
Ãw_libs
="$deplib $new_libs" ;;

5981 -
R
*) ;;

5983 #And 
h”e
 
is
 
the
 
»asÚ
: 
wh’
 
a
 
lib¿ry
 
­³¬s
 
mÜe


5984 #thª 
Úû
 
as
 
ª
 
ex¶ic™
 
d•’d’û
 
of
 
a
 
lib¿ry
, 
Ü


5985 #i 
im¶ic™ly
 
lšked
 
š
 
mÜe
 
thª
 
Úû
 
by
 
the


5986 #comp”, 
™
 
is
 
cÚsid”ed
 
¥ecŸl
, 
ªd
 
muÉË


5987 #occu¼’û 
th”eof
 
¬e
 
nÙ
 
»moved
. 
Com·»
 
this


5988 #w™h 
havšg
 
the
 
§me
 
lib¿ry
 
bešg
 
li¡ed
 
as
 
a


5989 #d•’d’cy 
of
 
muÉË
 
Ùh”
 
lib¿r›s
: 
š
 
this
 ,

5990 #w
	`know
 (
³dªtiÿÎy
, 
we
 
assume
è
the
 
lib¿ry
 
dÛs
 
nÙ


5991 #Ãed 
to
 
be
 
li¡ed
 
mÜe
 
thª
 
Úû
, 
so
 
we
 
k“p
 
Úly
 
the


5992 #Ï¡ 
cİy
. 
This
 
is
 
nÙ
 
®ways
 
right
, 
but
 
™
 i 
¿»


5993 #’ough 
th©
 
we
 
»quœe
 
u£rs
h© 
»®ly
 
m—n
 
to
 
¶ay


5994 #such 
uÅÜbË
 
lškšg
 
Œicks
 
to
 
lšk
 
the
 
lib¿ry


5995 #usšg -
Wl
,-
Êame
, 
so
 
th©
 
libtoŞ
 
dÛs
 
nÙ
 
cÚsid”
 
™


5996 #fÜ 
du¶iÿ‹
 
»mov®
.

5997 " $¥ecŸld•lib " 
š


5998 *" $d•lib "*è
Ãw_libs
="$deplib $new_libs" ;;

6000 " $Ãw_lib " 
š


6002 *è
Ãw_libs
="$deplib $new_libs" ;;

6003 
e§c


6005 
e§c


6007 
e§c


6008 
dÚe


6009 
tmp_libs
=

6010 
d•lib
 
š
 
$Ãw_libs
; do

6011 
$d•lib
 
š


6012 -
L
*)

6013 " $tmp_lib " 
š


6015 *è
tmp_libs
="$tmp_libs $deplib" ;;

6016 
e§c


6018 *è
tmp_libs
="$tmp_libs $deplib" ;;

6019 
e§c


6020 
dÚe


6021 
ev®
 
$v¬
=\"$tmp_libs\"

6022 
dÚe
 #fÜ 
v¬


6023 
fi


6024 #La¡ 
¡•
: 
»move
 
ruÁime
 
libs
 
äom
 
d•’d’cy_libs


6025 #(
they
 
¡ay
 
š
 
d•libs
)

6026 
tmp_libs
=

6027 
i
 
š
 
$d•’d’cy_libs
 ; do

6028 " $´ed• $po¡d• $comp”_lib_£¬ch_·th " 
š


6030 
i
=""

6032 
e§c


6033 
‹¡
 -
n
 "$i" ; 
th’


6034 
tmp_libs
="$tmp_libs $i"

6035 
fi


6036 
dÚe


6037 
d•’d’cy_libs
=
$tmp_libs


6038 
dÚe
 #fÜ 
·ss


6039 
‹¡
 "$lškmode" = 
´og
; 
th’


6040 
dlfes
="$newdlfiles"

6041 
fi


6042 
‹¡
 "$lškmode" = 
´og
 ||e¡ "$lškmode" = 
lib
; 
th’


6043 
dÍ»fes
="$newdlprefiles"

6044 
fi


6046 
$lškmode
 
š


6047 
Şdlib
)

6048 
‹¡
 -
n
 "$dlfes$dÍ»fes" ||e¡ "$dl£lf" !ğ
no
; 
th’


6049 
func_w¬nšg
 "\`-dlopen' is ignored for‡rchives"

6050 
fi


6052 " $d•libs" 
š


6053 *\ -
l
* | *\ -
L
*)

6054 
func_w¬nšg
 "\`-l'‡nd \`-L'‡re ignored for‡rchives" ;;

6055 
e§c


6057 
‹¡
 -
n
 "$rpath" && \

6058 
func_w¬nšg
 "\`-rpath' is ignored for‡rchives"

6060 
‹¡
 -
n
 "$xrpath" && \

6061 
func_w¬nšg
 "\`-R' is ignored for‡rchives"

6063 
‹¡
 -
n
 "$vinfo" && \

6064 
func_w¬nšg
 "\`-version-info/-version-number' is ignored for‡rchives"

6066 
‹¡
 -
n
 "$release" && \

6067 
func_w¬nšg
 "\`-release' is ignored for‡rchives"

6069 
‹¡
 -
n
 "$export_symbols$export_symbols_regex" && \

6070 
func_w¬nšg
 "\`-export-symbols' is ignored for‡rchives"

6072 #Now 
£t
 
the
 
v¬ŸbËs
 
budšg
 
Şd
 
lib¿r›s
.

6073 
bud_libtoŞ_libs
=
no


6074 
Şdlibs
="$output"

6075 
objs
="$objs$old_deplibs"

6078 
lib
)

6079 #Mak
su»
 
we
 
Úly
 
g’”©e
 
lib¿r›s
 
of
 
the
 
fÜm
 `
libNAME
.
Ï
'.

6080 
$ouuŠame
 
š


6081 
lib
*)

6082 
func_¡rÇme
 'lib' '.la' "$outputname"

6083 
Çme
=
$func_¡rÇme_»suÉ


6084 
ev®
 
sh¬ed_ext
=\"$shrext_cmds\"

6085 
ev®
 
libÇme
=\"$libname_spec\"

6088 
‹¡
 "$moduË" = 
no
 && \

6089 
func_çl_h–p
 "libtool†ibrary \`$output' must begin with \`lib'"

6091 
‹¡
 "$Ãed_lib_´efix" !ğ
no
; 
th’


6092 #Add 
the
 "lib" 
´efix
 
moduËs
 
»quœed


6093 
func_¡rÇme
 '' '.la' "$outputname"

6094 
Çme
=
$func_¡rÇme_»suÉ


6095 
ev®
 
sh¬ed_ext
=\"$shrext_cmds\"

6096 
ev®
 
libÇme
=\"$libname_spec\"

6098 
func_¡rÇme
 '' '.la' "$outputname"

6099 
libÇme
=
$func_¡rÇme_»suÉ


6100 
fi


6102 
e§c


6104 
‹¡
 -
n
 "$objs"; 
th’


6105 
‹¡
 "$d•libs_check_m‘hod" !ğ
·ss_®l
; 
th’


6106 
func_çl_”rÜ
 "cannot build†ibtool†ibrary \`$output' from‚on-libtool objects onhis host:$objs"

6108 
$ECHO


6109 
$ECHO
 "*** Warning: Linkinghe shared†ibrary $output‡gainsthe‚on-libtool"

6110 
$ECHO
 "*** objects $objs is‚ot…ortable!"

6111 
libobjs
="$libobjs $objs"

6112 
fi


6113 
fi


6115 
‹¡
 "$dl£lf" !ğ
no
 && \

6116 
func_w¬nšg
 "\`-dlopen self' is ignored for†ibtool†ibraries"

6118 
£t
 
dummy
 
$½©h


6119 
shiá


6120 
‹¡
 "$#" -
gt
 1 && \

6121 
func_w¬nšg
 "ignoring multiple \`-rpath's for‡†ibtool†ibrary"

6123 
š¡®l_libdœ
="$1"

6125 
Şdlibs
=

6126 
‹¡
 -
z
 "$½©h"; 
th’


6127 
‹¡
 "$bud_libtoŞ_libs" = 
yes
; 
th’


6128 #Budšg 
a
 
libtoŞ
 
cÚv’›nû
 
lib¿ry
.

6129 #Som
comp”s
 
have
 
´obËms
 
w™h
 
a
 `.
®
'ƒxtension so

6130 #cÚv’›nû 
lib¿r›s
 
should
 
have
 
the
 
§me
 
ex‹nsiÚ
 
ª


6131 #¬chiv
nÜm®ly
 
would
.

6132 
Şdlibs
="$output_objdir/$libname.$libext $oldlibs"

6133 
bud_libtoŞ_libs
=
cÚv’›nû


6134 
bud_Şd_libs
=
yes


6135 
fi


6137 
‹¡
 -
n
 "$vinfo" && \

6138 
func_w¬nšg
 "\`-version-info/-version-number' is ignored for convenience†ibraries"

6140 
‹¡
 -
n
 "$release" && \

6141 
func_w¬nšg
 "\`-release' is ignored for convenience†ibraries"

6144 #P¬£ 
the
 
v”siÚ
 
šfÜm©iÚ
 
¬gum’t
.

6145 
§ve_ifs
="$IFS"; 
IFS
=':'

6146 
£t
 
dummy
 
$všfo
 0 0 0

6147 
shiá


6148 
IFS
="$save_ifs"

6150 
‹¡
 -
n
 "$7" && \

6151 
func_çl_h–p
 "too many…arameterso \`-version-info'"

6153 #cÚv”ˆ
absŞu‹
 
v”siÚ
 
numb”s
 
to
 
libtoŞ
 
ages


6154 #thi 
»šs
 
com·tib™y
 
w™h
 .
Ï
 
fes
 
ªd
 
©‹m±s


6155 #tØ
make
 
the
 
code
 
b–ow
 
a
 
b™
 
mÜe
 
com´eh’sibË


6157 
$všfo_numb”
 
š


6158 
yes
)

6159 
numb”_majÜ
="$1"

6160 
numb”_mšÜ
="$2"

6161 
numb”_»visiÚ
="$3"

6162 #
#Th”
¬e
 
»®ly
 
Úly
 
two
 
kšds
 -- 
tho£
 
th©


6163 #u£ 
the
 
cu¼’t
 
»visiÚ
 
as
h
majÜ
 
v”siÚ


6164 #ªd 
tho£
 
th©
 
subŒaù
 
age
 
ªd
 
u£
‡g
as


6165 #¨
mšÜ
 
v”siÚ
. 
But
, 
th’
 
th”e
 
is
 
œix


6166 #which 
has
 
ª
 
exŒa
 1 
added
 
ju¡
 
fun


6167 #

$v”siÚ_ty³
 
š


6168 
d¬wš
|
lšux
|
osf
|
wšdows
|
nÚe
)

6169 
func_¬™h
 
$numb”_majÜ
 + 
$numb”_mšÜ


6170 
cu¼’t
=
$func_¬™h_»suÉ


6171 
age
="$number_minor"

6172 
»visiÚ
="$number_revision"

6174 
ä“bsd
-
aout
|ä“bsd-
–f
|
sunos
)

6175 
cu¼’t
="$number_major"

6176 
»visiÚ
="$number_minor"

6177 
age
="0"

6179 
œix
|
nÚ¡İux
)

6180 
func_¬™h
 
$numb”_majÜ
 + 
$numb”_mšÜ


6181 
cu¼’t
=
$func_¬™h_»suÉ


6182 
age
="$number_minor"

6183 
»visiÚ
="$number_minor"

6184 
É_œix_šüem’t
=
no


6187 
func_çl_cÚfigu¿tiÚ
 "$modename: unknown†ibrary versionype \`$version_type'"

6189 
e§c


6191 
no
)

6192 
cu¼’t
="$1"

6193 
»visiÚ
="$2"

6194 
age
="$3"

6196 
e§c


6198 #Check 
th©
 
—ch
 
of
 
the
 
thšgs
 
¬e
 
v®id
 
numb”s
.

6199 
$cu¼’t
 
š


6202 
func_”rÜ
 "CURRENT \`$current' must be‡‚onnegative integer"

6203 
func_çl_”rÜ
 "\`$vinfo' is‚ot valid version information"

6205 
e§c


6207 
$»visiÚ
 
š


6210 
func_”rÜ
 "REVISION \`$revision' must be‡‚onnegative integer"

6211 
func_çl_”rÜ
 "\`$vinfo' is‚ot valid version information"

6213 
e§c


6215 
$age
 
š


6218 
func_”rÜ
 "AGE \`$age' must be‡‚onnegative integer"

6219 
func_çl_”rÜ
 "\`$vinfo' is‚ot valid version information"

6221 
e§c


6223 
‹¡
 "$age" -
gt
 "$cu¼’t"; 
th’


6224 
func_”rÜ
 "AGE \`$age' is greaterhanhe current interface‚umber \`$current'"

6225 
func_çl_”rÜ
 "\`$vinfo' is‚ot valid version information"

6226 
fi


6228 #C®cuÏ‹ 
the
 
v”siÚ
 
v¬ŸbËs
.

6229 
majÜ
=

6230 
v”suffix
=

6231 
v”¡ršg
=

6232 
$v”siÚ_ty³
 
š


6233 
nÚe
) ;;

6235 
d¬wš
)

6236 #Lik
Lšux
, 
but
 
w™h
 
the
 
cu¼’t
 
v”siÚ
 
avaabË
 
š


6237 #v”¡ršg 
codšg
 
™
 
što
 
the
 
lib¿ry
 
h—d”


6238 
func_¬™h
 
$cu¼’t
 - 
$age


6239 
majÜ
=.
$func_¬™h_»suÉ


6240 
v”suffix
="$major.$age.$revision"

6241 #D¬wš 
ld
 
dÛ¢
't†ike 0 forhese options...

6242 
func_¬™h
 
$cu¼’t
 + 1

6243 
mšÜ_cu¼’t
=
$func_¬™h_»suÉ


6244 
xlcv”¡ršg
="${wl}-compatibility_version ${wl}$minor_current ${wl}-current_version ${wl}$minor_current.$revision"

6245 
v”¡ršg
="-compatibility_version $minor_current -current_version $minor_current.$revision"

6248 
ä“bsd
-
aout
)

6249 
majÜ
=".$current"

6250 
v”suffix
=".$current.$revision";

6253 
ä“bsd
-
–f
)

6254 
majÜ
=".$current"

6255 
v”suffix
=".$current"

6258 
œix
 | 
nÚ¡İux
)

6259 
‹¡
 "X$É_œix_šüem’t" = "Xno"; 
th’


6260 
func_¬™h
 
$cu¼’t
 - 
$age


6262 
func_¬™h
 
$cu¼’t
 - 
$age
 + 1

6263 
fi


6264 
majÜ
=
$func_¬™h_»suÉ


6266 
$v”siÚ_ty³
 
š


6267 
nÚ¡İux
è
v”¡ršg_´efix
=nonstopux ;;

6268 *è
v”¡ršg_´efix
=
sgi
 ;;

6269 
e§c


6270 
v”¡ršg
="$verstring_prefix$major.$revision"

6272 #Add 
š
 
®l
 
the
 
š‹rçûs
 
th©
 
we
 
¬e
 
com·tibË
 
w™h
.

6273 
loİ
=
$»visiÚ


6274 
‹¡
 "$loİ" -
Ã
 0; do

6275 
func_¬™h
 
$»visiÚ
 - 
$loİ


6276 
içû
=
$func_¬™h_»suÉ


6277 
func_¬™h
 
$loİ
 - 1

6278 
loİ
=
$func_¬™h_»suÉ


6279 
v”¡ršg
="$verstring_prefix$major.$iface:$verstring"

6280 
dÚe


6282 #BefÜ
this
 
pošt
, 
$majÜ
 
mu¡
 
nÙ
 
cÚš
 `.'.

6283 
majÜ
=.
$majÜ


6284 
v”suffix
="$major.$revision"

6287 
lšux
)

6288 
func_¬™h
 
$cu¼’t
 - 
$age


6289 
majÜ
=.
$func_¬™h_»suÉ


6290 
v”suffix
="$major.$age.$revision"

6293 
osf
)

6294 
func_¬™h
 
$cu¼’t
 - 
$age


6295 
majÜ
=.
$func_¬™h_»suÉ


6296 
v”suffix
=".$current.$age.$revision"

6297 
v”¡ršg
="$current.$age.$revision"

6299 #Add 
š
 
®l
 
the
 
š‹rçûs
 
th©
 
we
 
¬e
 
com·tibË
 
w™h
.

6300 
loİ
=
$age


6301 
‹¡
 "$loİ" -
Ã
 0; do

6302 
func_¬™h
 
$cu¼’t
 - 
$loİ


6303 
içû
=
$func_¬™h_»suÉ


6304 
func_¬™h
 
$loİ
 - 1

6305 
loİ
=
$func_¬™h_»suÉ


6306 
v”¡ršg
="$verstring:${iface}.0"

6307 
dÚe


6309 #Mak
execubËs
 
d•’d
 
Ú
 
our
 
cu¼’t
 
v”siÚ
.

6310 
v”¡ršg
="$verstring:${current}.0"

6313 
qnx
)

6314 
majÜ
=".$current"

6315 
v”suffix
=".$current"

6318 
sunos
)

6319 
majÜ
=".$current"

6320 
v”suffix
=".$current.$revision"

6323 
wšdows
)

6324 #U£ '-' 
¿th”
 
thª
 '.', 
sšû
 
we
 
Úly
 
wªt
 
Úe


6325 #ex‹nsiÚ 
Ú
 
DOS
 8.3 
fesy¡ems
.

6326 
func_¬™h
 
$cu¼’t
 - 
$age


6327 
majÜ
=
$func_¬™h_»suÉ


6328 
v”suffix
="-$major"

6332 
func_çl_cÚfigu¿tiÚ
 "unknown†ibrary versionype \`$version_type'"

6334 
e§c


6336 #CË¬ 
the
 
v”siÚ
 
šfo
 
we
 
deçuÉed
, 
ªd
 
they
 
¥ecif›d
 
a
 
»Ëa£
.

6337 
‹¡
 -
z
 "$všfo" &&e¡ -
n
 "$»Ëa£"; 
th’


6338 
majÜ
=

6339 
$v”siÚ_ty³
 
š


6340 
d¬wš
)

6341 #w
ÿn
't check for "0.0" in‡rchive_cmds dueo quoting

6342 #´obËms, 
so
 
we
 
»£t
 
™
 
com¶‘–y


6343 
v”¡ršg
=

6346 
v”¡ršg
="0.0"

6348 
e§c


6349 
‹¡
 "$Ãed_v”siÚ" = 
no
; 
th’


6350 
v”suffix
=

6352 
v”suffix
=".0.0"

6353 
fi


6354 
fi


6356 #Remov
v”siÚ
 
šfo
 
äom
 
Çme
 
v”siÚšg
 
should
 
be
 
avoided


6357 
‹¡
 "$avoid_v”siÚ" = 
yes
 &&e¡ "$Ãed_v”siÚ" = 
no
; 
th’


6358 
majÜ
=

6359 
v”suffix
=

6360 
v”¡ršg
=""

6361 
fi


6363 #Check 
to
 
£e
 
the
 
¬chive
 
wl
 
have
 
undefšed
 
symbŞs
.

6364 
‹¡
 "$®low_undefšed" = 
yes
; 
th’


6365 
‹¡
 "$®low_undefšed_æag" = 
unsuµÜ‹d
; 
th’


6366 
func_w¬nšg
 "undefined symbols‚ot‡llowed in $host shared†ibraries"

6367 
bud_libtoŞ_libs
=
no


6368 
bud_Şd_libs
=
yes


6369 
fi


6372 
®low_undefšed_æag
="$no_undefined_flag"

6373 
fi


6375 
fi


6377 
func_g’”©e_dlsyms
 "$libname" "$libname" "yes"

6378 
libobjs
="$libobjs $symfileobj"

6379 
‹¡
 "X$libobjs" = "X " && 
libobjs
=

6381 
‹¡
 "$mode" !ğ
»lšk
; 
th’


6382 #Remov
our
 
ouuts
, 
but
 
dÚ
't„emove object files sincehey

6383 #may 
have
 
b“n
 
ü—‹d
 
wh’
 
compšg
 
PIC
 
objeùs
.

6384 
»mov–i¡
=

6385 
‹m´emov–i¡
=`
$ECHO
 "$output_objdir/*"`

6386 
p
 
š
 
$‹m´emov–i¡
; do

6387 
$p
 
š


6388 *.
$objext
 | *.
gúo
)

6390 
$ouut_objdœ
/
$ouuŠame
 | $ouut_objdœ/
$libÇme
.* | $ouut_objdœ/
$
{
libÇme
}${
»Ëa£
}.*)

6391 
‹¡
 "X$´ecious_fes_»gex" !ğ"X"; 
th’


6392 
$ECHO
 "$p" | 
$EGREP
 -
e
 "$´ecious_fes_»gex" >/
dev
/
nuÎ
 2>&1

6393 
th’


6395 
fi


6396 
fi


6397 
»mov–i¡
="$removelist $p"

6400 
e§c


6401 
dÚe


6402 
‹¡
 -
n
 "$removelist" && \

6403 
func_show_ev®
 "${RM}r \$removelist"

6404 
fi


6406 #Now 
£t
 
the
 
v¬ŸbËs
 
budšg
 
Şd
 
lib¿r›s
.

6407 
‹¡
 "$bud_Şd_libs" = 
yes
 &&e¡ "$bud_libtoŞ_libs" !ğ
cÚv’›nû
 ; 
th’


6408 
Şdlibs
="$oldlibs $output_objdir/$libname.$libext"

6410 #T¿nsfÜm .
lo
 
fes
 
to
 .
o
 files.

6411 
Şdobjs
="$obj "`
$ECHO
 "X$libobjs" | 
$SP2NL
 | 
$X£d
 -
e
 '/\.'
$
{
libext
}'$/d' -"$lo2o" | 
$NL2SP
`

6412 
fi


6414 #Elimš©
®l
 
‹mpÜ¬y
 
dœeùÜ›s
.

6415 #fÜ 
·th
 
š
 
$nÙš¡_·th
; do

6416 #lib_£¬ch_·th=`
$ECHO
 "X$lib_£¬ch_·th " | 
$X£d
 -
e
 "s% $path % %g"`

6417 #d•libs=`
$ECHO
 "X$d•lib " | 
$X£d
 -
e
 "s% -L$path % %g"`

6418 #d•’d’cy_libs=`
$ECHO
 "X$d•’d’cy_lib " | 
$X£d
 -
e
 "s% -L$path % %g"`

6421 
‹¡
 -
n
 "$x½©h"; 
th’


6422 #Ià
the
 
u£r
 
¥ecif›d
 
ªy
 
½©h
 
æags
, 
th’
 
add
 
them
.

6423 
‹mp_x½©h
=

6424 
libdœ
 
š
 
$x½©h
; do

6425 
‹mp_x½©h
="$temp_xrpath -R$libdir"

6426 "$fš®ize_½©h " 
š


6428 *è
fš®ize_½©h
="$finalize_rpath $libdir" ;;

6429 
e§c


6430 
dÚe


6431 
‹¡
 "$h¬dcode_što_libs" !ğ
yes
 ||e¡ "$bud_Şd_libs" = yes; 
th’


6432 
d•’d’cy_libs
="$temp_xrpath $dependency_libs"

6433 
fi


6434 
fi


6436 #Mak
su»
 
dlfes
 
cÚšs
 
Úly
 
unique
 
fes
 
th©
 
wÚ
't be dlpreopened

6437 
Şd_dlfes
="$dlfiles"

6438 
dlfes
=

6439 
lib
 
š
 
$Şd_dlfes
; do

6440 " $dÍ»fe $dlfe " 
š


6442 *è
dlfes
="$dlfiles $lib" ;;

6443 
e§c


6444 
dÚe


6446 #Mak
su»
 
dÍ»fes
 
cÚšs
 
Úly
 
unique
 
fes


6447 
Şd_dÍ»fes
="$dlprefiles"

6448 
dÍ»fes
=

6449 
lib
 
š
 
$Şd_dÍ»fes
; do

6450 "$dÍ»fe " 
š


6452 *è
dÍ»fes
="$dlprefiles $lib" ;;

6453 
e§c


6454 
dÚe


6456 
‹¡
 "$bud_libtoŞ_libs" = 
yes
; 
th’


6457 
‹¡
 -
n
 "$½©h"; 
th’


6458 
$ho¡
 
š


6459 *-*-
cygwš
* | *-*-
mšgw
* | *-*-
pw32
* | *-*-
os2
* | *-*-
beos
* | *-
ûgcc
*)

6460 #the£ 
sy¡ems
 
dÚ
't‡ctually have‡ c†ibrary (as such)!

6462 *-*-
rh­sody
* | *-*-
d¬wš1
.[012])

6463 #Rh­sody 
C
 
lib¿ry
 
is
 
š
 
the
 
Sy¡em
 
äamewÜk


6464 
d•libs
="$deplibs System.ltframework"

6466 *-*-
Ãtbsd
*)

6469 *-*-
İ’bsd
* | *-*-
ä“bsd
* | *-*-
d¿gÚæy
*)

6470 #DØ
nÙ
 
šşude
 
libc
 
due
 
to
 
us
 
havšg
†ibc/
libc_r
.

6472 *-*-
sco3
.2
v5
* | *-*-
sco5v6
*)

6473 #Cau£ 
´obËms
 
w™h
 
__ùy³


6475 *-*-
sysv4
.2u
w2
* | *-*-
sysv5
* | *-*-
unixw¬e
* | *-*-
O³nUNIX
*)

6476 #Comp” 
š£¹s
 
libc
 
š
 
the
 
cÜ»ù
 
¶aû
 
th»ads
 
to
 
wÜk


6479 #Add 
libc
 
to
 
d•libs
 
Ú
 
®l
 
Ùh”
 
sy¡ems
 
Ãûs§ry
.

6480 
‹¡
 "$bud_libtoŞ_Ãed_lc" = "yes"; 
th’


6481 
d•libs
="$deplibs -lc"

6482 
fi


6484 
e§c


6485 
fi


6487 #T¿nsfÜm 
d•libs
 
što
 
Úly
 d•lib 
th©
 
ÿn
 
be
 
lšked
 
š
 
sh¬ed
.

6488 
Çme_§ve
=
$Çme


6489 
libÇme_§ve
=
$libÇme


6490 
»Ëa£_§ve
=
$»Ëa£


6491 
v”suffix_§ve
=
$v”suffix


6492 
majÜ_§ve
=
$majÜ


6493 #I'm‚Ù su» iàI'
m
 
Œ—tšg
 
the
 
»Ëa£
 
cÜ»ùly
. 
I
 
thšk


6494 #»Ëa£ 
should
 
show
 
up
 
š
 
the
 -
	`l
 (
›
 -
lgmp5
è
so
 
we
 
dÚ
't wanto

6495 #add 
™
 
š
 
twiû
. 
Is
 
th©
 
cÜ»ù
?

6496 
»Ëa£
=""

6497 
v”suffix
=""

6498 
majÜ
=""

6499 
Ãwd•libs
=

6500 
drİ³dd•s
=
no


6501 
$d•libs_check_m‘hod
 
š


6502 
·ss_®l
)

6504 #Thi 
might
 
be
 
a
 
l™e
 
Çive
. 
We
 mighˆ
wªt
 
to
 
check


6505 #wh‘h” 
the
 
lib¿ry
 
exi¡s
 
Ü
 
nÙ
. 
But
 
this
 
is
 
Ú


6506 #osf3 & 
osf4
 
ªd
 
I
'm‚ot„eally sure... Just

6507 #im¶em’tšg 
wh©
 
was
 
®»ady
 
the
 
behaviÜ
.

6508 
Ãwd•libs
=
$d•libs


6510 
‹¡_compe
)

6511 #Thi 
code
 
¡»s£s
 
the
 "lib¿r› ¬´og¿ms" 
·¿digm
 
to
 
™s


6512 #lim™s. 
Maybe
 
ev’
 
b»aks
 
™
. 
We
 
compe
 
a
 
´og¿m
, 
lškšg
 it

6513 #agaš¡ 
the
 
d•libs
 
as
 
a
 
´oxy
 th
lib¿ry
. 
Th’
 
we
 
ÿn
 
check


6514 #wh‘h” 
they
 
lšked
 
š
 
¡©iÿÎy
 
Ü
 
dyÇmiÿÎy
 
w™h
 
ldd
.

6515 
$İt_dry_run
 || 
$RM
 
cÚáe¡
.
c


6516 
ÿt
 > 
cÚáe¡
.
c
 <<
EOF


6517 
	`maš
() {  0; }

6518 
EOF


6519 
$İt_dry_run
 || 
$RM
 
cÚáe¡


6520 
$LTCC
 
$LTCFLAGS
 -
o
 
cÚáe¡
 cÚáe¡.
c
 
$d•libs
; 
th’


6521 
ldd_ouut
=`
ldd
 
cÚáe¡
`

6522 
i
 
š
 
$d•libs
; do

6523 
$i
 
š


6524 -
l
*)

6525 
func_¡rÇme
 -
l
 '' "$i"

6526 
Çme
=
$func_¡rÇme_»suÉ


6527 
‹¡
 "X$®low_libtoŞ_libs_w™h_¡©ic_ruÁimes" = "Xyes" ; 
th’


6528 " $´ed• $po¡d• " 
š


6530 
Ãwd•libs
="$newdeplibs $i"

6531 
i
=""

6533 
e§c


6534 
fi


6535 
‹¡
 -
n
 "$i" ; 
th’


6536 
libÇme
=`
ev®
 "\\$ECHO \"$libname_spec\""`

6537 
d•lib_m©ches
=`
ev®
 "\\$ECHO \"$library_names_spec\""`

6538 
£t
 
dummy
 
$d•lib_m©ches
; 
shiá


6539 
d•lib_m©ch
=
$1


6540 
‹¡
 `
ex´
 "$ldd_ouut" : ".*$d•lib_m©ch"` -
Ã
 0 ; 
th’


6541 
Ãwd•libs
="$newdeplibs $i"

6543 
drİ³dd•s
=
yes


6544 
$ECHO


6545 
$ECHO
 "*** Warning: dynamic†inker does‚ot‡ccept‚eeded†ibrary $i."

6546 
$ECHO
 "*** I havehe capabilityo makehat†ibrary‡utomatically†ink in when"

6547 
$ECHO
 "*** you†inkohis†ibrary. But I can only dohis if you have‡"

6548 
$ECHO
 "*** shared version ofhe†ibrary, which I believe you do‚ot have"

6549 
$ECHO
 "*** because‡est_compile did„evealhathe†inker did‚ot use it for"

6550 
$ECHO
 "*** its dynamic dependency†isthat…rograms get„esolved with‡t„untime."

6551 
fi


6552 
fi


6555 
Ãwd•libs
="$newdeplibs $i"

6557 
e§c


6558 
dÚe


6560 #E¼Ü 
occu¼ed
 
š
 
the
 
fœ¡
 
compe
. 
L‘
'sryo salvage

6561 #th
s™u©iÚ
: 
Compe
 
a
 
£·¿‹
 
´og¿m
 
—ch
 
lib¿ry
.

6562 
i
 
š
 
$d•libs
; do

6563 
$i
 
š


6564 -
l
*)

6565 
func_¡rÇme
 -
l
 '' "$i"

6566 
Çme
=
$func_¡rÇme_»suÉ


6567 
$İt_dry_run
 || 
$RM
 
cÚáe¡


6568 
$LTCC
 
$LTCFLAGS
 -
o
 
cÚáe¡
 cÚáe¡.
c
 
$i
; 
th’


6569 
ldd_ouut
=`
ldd
 
cÚáe¡
`

6570 
‹¡
 "X$®low_libtoŞ_libs_w™h_¡©ic_ruÁimes" = "Xyes" ; 
th’


6571 " $´ed• $po¡d• " 
š


6573 
Ãwd•libs
="$newdeplibs $i"

6574 
i
=""

6576 
e§c


6577 
fi


6578 
‹¡
 -
n
 "$i" ; 
th’


6579 
libÇme
=`
ev®
 "\\$ECHO \"$libname_spec\""`

6580 
d•lib_m©ches
=`
ev®
 "\\$ECHO \"$library_names_spec\""`

6581 
£t
 
dummy
 
$d•lib_m©ches
; 
shiá


6582 
d•lib_m©ch
=
$1


6583 
‹¡
 `
ex´
 "$ldd_ouut" : ".*$d•lib_m©ch"` -
Ã
 0 ; 
th’


6584 
Ãwd•libs
="$newdeplibs $i"

6586 
drİ³dd•s
=
yes


6587 
$ECHO


6588 
$ECHO
 "*** Warning: dynamic†inker does‚ot‡ccept‚eeded†ibrary $i."

6589 
$ECHO
 "*** I havehe capabilityo makehat†ibrary‡utomatically†ink in when"

6590 
$ECHO
 "*** you†inkohis†ibrary. But I can only dohis if you have‡"

6591 
$ECHO
 "*** shared version ofhe†ibrary, which you do‚ot‡ppearo have"

6592 
$ECHO
 "*** because‡est_compile did„evealhathe†inker did‚ot usehis one"

6593 
$ECHO
 "***‡s‡ dynamic dependencyhat…rograms can get„esolved with‡t„untime."

6594 
fi


6595 
fi


6597 
drİ³dd•s
=
yes


6598 
$ECHO


6599 
$ECHO
 "*** Warning! Library $i is‚eeded byhis†ibrary but I was‚ot‡bleo"

6600 
$ECHO
 "*** make it†ink in! You will…robably‚eedo install it or some"

6601 
$ECHO
 "***†ibraryhat it depends on beforehis†ibrary will be fully"

6602 
$ECHO
 "*** functional. Installing it before continuing would beƒven better."

6603 
fi


6606 
Ãwd•libs
="$newdeplibs $i"

6608 
e§c


6609 
dÚe


6610 
fi


6612 
fe_magic
*)

6613 
£t
 
dummy
 
$d•libs_check_m‘hod
; 
shiá


6614 
fe_magic_»gex
=`
ex´
 "$deplibs_check_method" : "$1 \(.*\)"`

6615 
a_d•lib
 
š
 
$d•libs
; do

6616 
$a_d•lib
 
š


6617 -
l
*)

6618 
func_¡rÇme
 -
l
 '' "$a_deplib"

6619 
Çme
=
$func_¡rÇme_»suÉ


6620 
‹¡
 "X$®low_libtoŞ_libs_w™h_¡©ic_ruÁimes" = "Xyes" ; 
th’


6621 " $´ed• $po¡d• " 
š


6623 
Ãwd•libs
="$newdeplibs $a_deplib"

6624 
a_d•lib
=""

6626 
e§c


6627 
fi


6628 
‹¡
 -
n
 "$a_d•lib" ; 
th’


6629 
libÇme
=`
ev®
 "\\$ECHO \"$libname_spec\""`

6630 
i
 
š
 
$lib_£¬ch_·th
 
$sys_lib_£¬ch_·th
 
$shlib_£¬ch_·th
; do

6631 
pÙ’tŸl_libs
=`
ls
 
$i
/
$libÇme
[.-]* 2>/
dev
/
nuÎ
`

6632 
pÙ’t_lib
 
š
 
$pÙ’tŸl_libs
; do

6633 #FŞlow 
soá
 
lšks
.

6634 
ls
 -
lLd
 "$pÙ’t_lib" 2>/
dev
/
nuÎ
 |

6635 
$GREP
 " -> " >/
dev
/
nuÎ
; 
th’


6637 
fi


6638 #Th
¡©em’t
 
above
 
Œ›s
 
to
 
avoid
 
’‹ršg
 
ª


6639 #’dËs 
loİ
 
b–ow
, 
š
 
of
 
cyşic
 
lšks
.

6640 #W
might
 
¡l
 
’‹r
 
ª
 
’dËss
 
loİ
, 
sšû
 
a
 
lšk


6641 #loİ 
ÿn
 
be
 
şo£d
 
we
 
fŞlow
 
lšks
,

6642 #buˆ
so
 
wh©
?

6643 
pÙlib
="$potent_lib"

6644 
‹¡
 -
h
 "$pÙlib" 2>/
dev
/
nuÎ
; do

6645 
pÙliblšk
=`
ls
 -
ld
 
$pÙlib
 | 
$
{
SED
} 's/.* -> //'`

6646 
$pÙliblšk
 
š


6647 [\\/]* | [
A
-
Za
-
z
]:[\\/]*è
pÙlib
="$potliblink";;

6648 *è
pÙlib
=`
$ECHO
 "X$pÙlib" | 
$X£d
 -
e
 's,[^/]*$,,'`"$potliblink";;

6649 
e§c


6650 
dÚe


6651 
ev®
 
$fe_magic_cmd
 \"\$potlib\" 2>/dev/null |

6652 
$SED
 -
e
 10
q
 |

6653 
$EGREP
 "$fe_magic_»gex" > /
dev
/
nuÎ
; 
th’


6654 
Ãwd•libs
="$newdeplibs $a_deplib"

6655 
a_d•lib
=""

6657 
fi


6658 
dÚe


6659 
dÚe


6660 
fi


6661 
‹¡
 -
n
 "$a_d•lib" ; 
th’


6662 
drİ³dd•s
=
yes


6663 
$ECHO


6664 
$ECHO
 "*** Warning:†inker…ath does‚ot have„eal file for†ibrary $a_deplib."

6665 
$ECHO
 "*** I havehe capabilityo makehat†ibrary‡utomatically†ink in when"

6666 
$ECHO
 "*** you†inkohis†ibrary. But I can only dohis if you have‡"

6667 
$ECHO
 "*** shared version ofhe†ibrary, which you do‚ot‡ppearo have"

6668 
$ECHO
 "*** because I did checkhe†inker…ath†ooking for‡ file starting"

6669 
‹¡
 -
z
 "$pÙlib" ; 
th’


6670 
$ECHO
 "*** with $libname but‚o candidates were found. (...for file magicest)"

6672 
$ECHO
 "*** with $libname‡nd‚one ofhe candidates…assed‡ file formatest"

6673 
$ECHO
 "*** using‡ file magic. Last file checked: $potlib"

6674 
fi


6675 
fi


6678 #Add 
a
 -
L
 
¬gum’t
.

6679 
Ãwd•libs
="$newdeplibs $a_deplib"

6681 
e§c


6682 
dÚe
 #GÚ
through
 
®l
 
d•libs
.

6684 
m©ch_·‰”n
*)

6685 
£t
 
dummy
 
$d•libs_check_m‘hod
; 
shiá


6686 
m©ch_·‰”n_»gex
=`
ex´
 "$deplibs_check_method" : "$1 \(.*\)"`

6687 
a_d•lib
 
š
 
$d•libs
; do

6688 
$a_d•lib
 
š


6689 -
l
*)

6690 
func_¡rÇme
 -
l
 '' "$a_deplib"

6691 
Çme
=
$func_¡rÇme_»suÉ


6692 
‹¡
 "X$®low_libtoŞ_libs_w™h_¡©ic_ruÁimes" = "Xyes" ; 
th’


6693 " $´ed• $po¡d• " 
š


6695 
Ãwd•libs
="$newdeplibs $a_deplib"

6696 
a_d•lib
=""

6698 
e§c


6699 
fi


6700 
‹¡
 -
n
 "$a_d•lib" ; 
th’


6701 
libÇme
=`
ev®
 "\\$ECHO \"$libname_spec\""`

6702 
i
 
š
 
$lib_£¬ch_·th
 
$sys_lib_£¬ch_·th
 
$shlib_£¬ch_·th
; do

6703 
pÙ’tŸl_libs
=`
ls
 
$i
/
$libÇme
[.-]* 2>/
dev
/
nuÎ
`

6704 
pÙ’t_lib
 
š
 
$pÙ’tŸl_libs
; do

6705 
pÙlib
="$pÙ’t_lib" #£
symlšk
-
check
 
above
 
š
 
fe_magic
 
‹¡


6706 
ev®
 "\$ECHO \"X$pÙ’t_lib\"" 2>/
dev
/
nuÎ
 | 
$X£d
 -
e
 10
q
 | \

6707 
$EGREP
 "$m©ch_·‰”n_»gex" > /
dev
/
nuÎ
; 
th’


6708 
Ãwd•libs
="$newdeplibs $a_deplib"

6709 
a_d•lib
=""

6711 
fi


6712 
dÚe


6713 
dÚe


6714 
fi


6715 
‹¡
 -
n
 "$a_d•lib" ; 
th’


6716 
drİ³dd•s
=
yes


6717 
$ECHO


6718 
$ECHO
 "*** Warning:†inker…ath does‚ot have„eal file for†ibrary $a_deplib."

6719 
$ECHO
 "*** I havehe capabilityo makehat†ibrary‡utomatically†ink in when"

6720 
$ECHO
 "*** you†inkohis†ibrary. But I can only dohis if you have‡"

6721 
$ECHO
 "*** shared version ofhe†ibrary, which you do‚ot‡ppearo have"

6722 
$ECHO
 "*** because I did checkhe†inker…ath†ooking for‡ file starting"

6723 
‹¡
 -
z
 "$pÙlib" ; 
th’


6724 
$ECHO
 "*** with $libname but‚o candidates were found. (...for„egex…atternest)"

6726 
$ECHO
 "*** with $libname‡nd‚one ofhe candidates…assed‡ file formatest"

6727 
$ECHO
 "*** using‡„egex…attern. Last file checked: $potlib"

6728 
fi


6729 
fi


6732 #Add 
a
 -
L
 
¬gum’t
.

6733 
Ãwd•libs
="$newdeplibs $a_deplib"

6735 
e§c


6736 
dÚe
 #GÚ
through
 
®l
 
d•libs
.

6738 
nÚe
 | 
unknown
 | *)

6739 
Ãwd•libs
=""

6740 
tmp_d•libs
=`
$ECHO
 "X $d•libs" | 
$X£d
 \

6741 -
e
 's/ -lc$//' -e 's/ -[LR][^ ]*//g'`

6742 
‹¡
 "X$®low_libtoŞ_libs_w™h_¡©ic_ruÁimes" = "Xyes" ; 
th’


6743 
i
 
š
 
$´ed•s
 
$po¡d•s
 ; do

6745 
tmp_d•libs
=`
$ECHO
 "X $tmp_d•libs" | 
$X£d
 -
e
 "s,$i,,"`

6746 
dÚe


6747 
fi


6748 
$ECHO
 "X $tmp_d•libs" | 
$X£d
 -
e
 's/[ ]//g' |

6749 
$GREP
 . >/
dev
/
nuÎ
; 
th’


6750 
$ECHO


6751 
‹¡
 "X$d•libs_check_m‘hod" = "XnÚe"; 
th’


6752 
$ECHO
 "*** Warning: inter-library dependencies‡re‚ot supported inhis…latform."

6754 
$ECHO
 "*** Warning: inter-library dependencies‡re‚ot knowno be supported."

6755 
fi


6756 
$ECHO
 "*** All declared inter-library dependencies‡re being dropped."

6757 
drİ³dd•s
=
yes


6758 
fi


6760 
e§c


6761 
v”suffix
=
$v”suffix_§ve


6762 
majÜ
=
$majÜ_§ve


6763 
»Ëa£
=
$»Ëa£_§ve


6764 
libÇme
=
$libÇme_§ve


6765 
Çme
=
$Çme_§ve


6767 
$ho¡
 
š


6768 *-*-
rh­sody
* | *-*-
d¬wš1
.[012])

6769 #OÀ
Rh­sody
 
»¶aû
 
the
 
C
 
lib¿ry
 
w™h
h
Sy¡em
 
äamewÜk


6770 
Ãwd•libs
=`
$ECHO
 "X $Ãwd•libs" | 
$X£d
 -
e
 's/ -lc / System.ltframework /'`

6772 
e§c


6774 
‹¡
 "$drİ³dd•s" = 
yes
; 
th’


6775 
‹¡
 "$moduË" = 
yes
; 
th’


6776 
$ECHO


6777 
$ECHO
 "*** Warning:†ibtool could‚ot satisfy‡ll declared inter-library"

6778 
$ECHO
 "*** dependencies of module $libname. Therefore,†ibtool will create"

6779 
$ECHO
 "***‡ static module,hat should work‡s†ong‡she dlopening"

6780 
$ECHO
 "***‡pplication is†inked withhe -dlopen flag."

6781 
‹¡
 -
z
 "$glob®_symbŞ_pe"; 
th’


6782 
$ECHO


6783 
$ECHO
 "*** However,his would only work if†ibtool was‡bleoƒxtract symbol"

6784 
$ECHO
 "***†ists from‡…rogram, using \`nm' orƒquivalent, but†ibtool could"

6785 
$ECHO
 "***‚ot find such‡…rogram. So,his module is…robably useless."

6786 
$ECHO
 "*** \`nm' from GNU binutils‡nd‡ full„ebuild may help."

6787 
fi


6788 
‹¡
 "$bud_Şd_libs" = 
no
; 
th’


6789 
Şdlibs
="$output_objdir/$libname.$libext"

6790 
bud_libtoŞ_libs
=
moduË


6791 
bud_Şd_libs
=
yes


6793 
bud_libtoŞ_libs
=
no


6794 
fi


6796 
$ECHO
 "*** The inter-library dependencieshat have been dropped here will be"

6797 
$ECHO
 "***‡utomatically‡dded whenever‡…rogram is†inked withhis†ibrary"

6798 
$ECHO
 "*** or is declaredo -dlopen it."

6800 
‹¡
 "$®low_undefšed" = 
no
; 
th’


6801 
$ECHO


6802 
$ECHO
 "*** Sincehis†ibrary must‚ot contain undefined symbols,"

6803 
$ECHO
 "*** becauseƒitherhe…latform does‚ot supporthem or"

6804 
$ECHO
 "*** it wasƒxplicitly„equested with -no-undefined,"

6805 
$ECHO
 "***†ibtool will only create‡ static version of it."

6806 
‹¡
 "$bud_Şd_libs" = 
no
; 
th’


6807 
Şdlibs
="$output_objdir/$libname.$libext"

6808 
bud_libtoŞ_libs
=
moduË


6809 
bud_Şd_libs
=
yes


6811 
bud_libtoŞ_libs
=
no


6812 
fi


6813 
fi


6814 
fi


6815 
fi


6816 #DÚ
checkšg
 
d•libs
!

6817 
d•libs
=
$Ãwd•libs


6818 
fi


6819 #Tim
to
 
chªge
 
®l
 
our
 "foo.ÉäamewÜk" 
¡uff
 
back
o "-framework foo"

6820 
$ho¡
 
š


6821 *-*-
d¬wš
*)

6822 
Ãwd•libs
=`
$ECHO
 "X $Ãwd•libs" | 
$X£d
 -
e
 's% \([^ $]*\).ltframework% -framework \1%g'`

6823 
Ãw_šh”™ed_lšk”_æags
=`
$ECHO
 "X $Ãw_šh”™ed_lšk”_æags" | 
$X£d
 -
e
 's% \([^ $]*\).ltframework% -framework \1%g'`

6824 
d•libs
=`
$ECHO
 "X $d•libs" | 
$X£d
 -
e
 's% \([^ $]*\).ltframework% -framework \1%g'`

6826 
e§c


6828 #mov
lib¿ry
 
£¬ch
 
·ths
 
th©
 
cošcide
 
w™h
…©h 
to
 
nÙ
 
y‘


6829 #š¡®Ëd 
lib¿r›s
 
to
 
the
 
begšnšg
 
of
h
lib¿ry
 
£¬ch
 
li¡


6830 
Ãw_libs
=

6831 
·th
 
š
 
$nÙš¡_·th
; do

6832 " $Ãw_lib " 
š


6835 " $d•lib " 
š


6837 
Ãw_libs
="$new_libs -L$path/$objdir" ;;

6838 
e§c


6840 
e§c


6841 
dÚe


6842 
d•lib
 
š
 
$d•libs
; do

6843 
$d•lib
 
š


6844 -
L
*)

6845 " $Ãw_lib " 
š


6847 *è
Ãw_libs
="$new_libs $deplib" ;;

6848 
e§c


6850 *è
Ãw_libs
="$new_libs $deplib" ;;

6851 
e§c


6852 
dÚe


6853 
d•libs
="$new_libs"

6855 #AÎ 
the
 
lib¿ry
-
¥ecific
 
	`v¬ŸbËs
 (
š¡®l_libdœ
 
is
 
£t
 
above
).

6856 
lib¿ry_Çmes
=

6857 
Şd_lib¿ry
=

6858 
dÊame
=

6860 #Te¡ 
agaš
, 
we
 
may
 
have
 
decided
 
nÙ
 
to
 
bud
 
™
 
ªy
 
mÜe


6861 
‹¡
 "$bud_libtoŞ_libs" = 
yes
; 
th’


6862 
‹¡
 "$h¬dcode_što_libs" = 
yes
; 
th’


6863 #H¬dcod
the
 
lib¿ry
 
·ths


6864 
h¬dcode_libdœs
=

6865 
d•_½©h
=

6866 
½©h
="$finalize_rpath"

6867 
‹¡
 "$mode" !ğ
»lšk
 && 
½©h
="$compile_rpath$rpath"

6868 
libdœ
 
š
 
$½©h
; do

6869 
‹¡
 -
n
 "$h¬dcode_libdœ_æag_¥ec"; 
th’


6870 
‹¡
 -
n
 "$h¬dcode_libdœ_£·¿tÜ"; 
th’


6871 
‹¡
 -
z
 "$h¬dcode_libdœs"; 
th’


6872 
h¬dcode_libdœs
="$libdir"

6874 #Ju¡ 
accumuÏ‹
 
the
 
unique
 
libdœs
.

6875 
$h¬dcode_libdœ_£·¿tÜ$h¬dcode_libdœs$h¬dcode_libdœ_£·¿tÜ
 
š


6879 
h¬dcode_libdœs
="$hardcode_libdirs$hardcode_libdir_separator$libdir"

6881 
e§c


6882 
fi


6884 
ev®
 
æag
=\"$hardcode_libdir_flag_spec\"

6885 
d•_½©h
="$dep_rpath $flag"

6886 
fi


6887 
–if
 
‹¡
 -
n
 "$ruÅ©h_v¬"; 
th’


6888 "$³rm_½©h " 
š


6890 *è
³rm_½©h
="$perm_rpath $libdir" ;;

6891 
e§c


6892 
fi


6893 
dÚe


6894 #Sub¡™u‹ 
the
 
h¬dcoded
 
libdœs
 
što
h
½©h
.

6895 
‹¡
 -
n
 "$hardcode_libdir_separator" &&

6896 
‹¡
 -
n
 "$h¬dcode_libdœs"; 
th’


6897 
libdœ
="$hardcode_libdirs"

6898 
‹¡
 -
n
 "$h¬dcode_libdœ_æag_¥ec_ld"; 
th’


6899 
ev®
 
d•_½©h
=\"$hardcode_libdir_flag_spec_ld\"

6901 
ev®
 
d•_½©h
=\"$hardcode_libdir_flag_spec\"

6902 
fi


6903 
fi


6904 
‹¡
 -
n
 "$ruÅ©h_v¬" &&e¡ -À"$³rm_½©h"; 
th’


6905 #W
should
 
£t
 
the
 
ruÅ©h_v¬
.

6906 
½©h
=

6907 
dœ
 
š
 
$³rm_½©h
; do

6908 
½©h
="$rpath$dir:"

6909 
dÚe


6910 
ev®
 "$runpath_var='$rpath\$$runpath_var';ƒxport $runpath_var"

6911 
fi


6912 
‹¡
 -
n
 "$d•_½©h" && 
d•libs
="$dep_rpath $deplibs"

6913 
fi


6915 
shlib·th
="$finalize_shlibpath"

6916 
‹¡
 "$mode" !ğ
»lšk
 && 
shlib·th
="$compile_shlibpath$shlibpath"

6917 
‹¡
 -
n
 "$shlib·th"; 
th’


6918 
ev®
 "$shlibpath_var='$shlibpath\$$shlibpath_var';ƒxport $shlibpath_var"

6919 
fi


6921 #G‘ 
the
 
»®
 
ªd
 
lšk
 
Çmes
 
of
h
lib¿ry
.

6922 
ev®
 
sh¬ed_ext
=\"$shrext_cmds\"

6923 
ev®
 
lib¿ry_Çmes
=\"$library_names_spec\"

6924 
£t
 
dummy
 
$lib¿ry_Çmes


6925 
shiá


6926 
»®Çme
="$1"

6927 
shiá


6929 
‹¡
 -
n
 "$sÚame_¥ec"; 
th’


6930 
ev®
 
sÚame
=\"$soname_spec\"

6932 
sÚame
="$realname"

6933 
fi


6934 
‹¡
 -
z
 "$dÊame"; 
th’


6935 
dÊame
=
$sÚame


6936 
fi


6938 
lib
="$output_objdir/$realname"

6939 
lškÇmes
=

6940 
lšk


6942 
lškÇmes
="$linknames $link"

6943 
dÚe


6945 #U£ 
¡ªd¬d
 
objeùs
 
they
 
¬e
 
pic


6946 
‹¡
 -
z
 "$pic_æag" && 
libobjs
=`
$ECHO
 "X$libobjs" | 
$SP2NL
 | 
$X£d
 -
e
 "$lo2o" | 
$NL2SP
`

6947 
‹¡
 "X$libobjs" = "X " && 
libobjs
=

6949 
d–fes
=

6950 
‹¡
 -
n
 "$expÜt_symbŞs" &&e¡ -À"$šşude_expsyms"; 
th’


6951 
$İt_dry_run
 || 
ı
 "$export_symbols" "$output_objdir/$libname.uexp"

6952 
expÜt_symbŞs
="$output_objdir/$libname.uexp"

6953 
d–fes
="$delfiles $export_symbols"

6954 
fi


6956 
Üig_expÜt_symbŞs
=

6957 
$ho¡_os
 
š


6958 
cygwš
* | 
mšgw
* | 
ûgcc
*)

6959 
‹¡
 -
n
 "$expÜt_symbŞs" &&e¡ -
z
 "$expÜt_symbŞs_»gex"; 
th’


6960 #expÜtšg 
usšg
 
u£r
 
suµl›d
 
symfe


6961 
‹¡
 "x`$SED 1q $expÜt_symbŞs`" !ğ
xEXPORTS
; 
th’


6962 #ªd 
™
's NOT‡lready‡ .def file. Must figure out

6963 #which 
of
 
the
 
giv’
 
symbŞs
 
¬e
 
d©a
 symbŞ 
ªd
 
g


6964 #them 
as
 
such
. 
So
, 
Œigg”
 
u£
 
of
 
expÜt_symbŞs_cmds
.

6965 #expÜt_symbŞ 
g‘s
 
»assigÃd
 
šside
 
the
 "prepare

6966 #th
li¡
 
of
 
expÜ‹d
 
symbŞs
" if statement, sohe

6967 #šşude_expsym 
logic
 
¡l
 
wÜks
.

6968 
Üig_expÜt_symbŞs
="$export_symbols"

6969 
expÜt_symbŞs
=

6970 
®ways_expÜt_symbŞs
=
yes


6971 
fi


6972 
fi


6974 
e§c


6976 #P»·» 
the
 
li¡
 
of
 
expÜ‹d
 
symbŞs


6977 
‹¡
 -
z
 "$expÜt_symbŞs"; 
th’


6978 
‹¡
 "$®ways_expÜt_symbŞs" = 
yes
 ||e¡ -
n
 "$expÜt_symbŞs_»gex"; 
th’


6979 
func_v”bo£
 "generating symbol†ist for \`$libname.la'"

6980 
expÜt_symbŞs
="$output_objdir/$libname.exp"

6981 
$İt_dry_run
 || 
$RM
 
$expÜt_symbŞs


6982 
cmds
=
$expÜt_symbŞs_cmds


6983 
§ve_ifs
="$IFS"; 
IFS
='~'

6984 
cmd
 
š
 
$cmds
; do

6985 
IFS
="$save_ifs"

6986 
ev®
 
cmd
=\"$cmd\"

6987 
func_Ën
 " $cmd"

6988 
Ën
=
$func_Ën_»suÉ


6989 
‹¡
 "$Ën" -
É
 "$max_cmd_Ën" ||e¡ "$max_cmd_Ën" -
Ë
 -1; 
th’


6990 
func_show_ev®
 "$cmd" 'exit $?'

6991 
sk³d_expÜt
=
çl£


6993 #Th
commªd
 
lše
 
is
 
too
 
to
 
execu‹
 
š
 
Úe
 
¡•
.

6994 
func_v”bo£
 "using„eloadable object file forƒxport†ist..."

6995 
sk³d_expÜt
=:

6996 #B»ak 
out
 
—¾y
, 
Ùh”wi£
 
sk³d_expÜt
 
may
 
be


6997 #£ˆ
to
 
çl£
 
by
 
a
 
Ï‹r
 
but
 
shÜ‹r
 
cmd
.

6999 
fi


7000 
dÚe


7001 
IFS
="$save_ifs"

7002 
‹¡
 -
n
 "$expÜt_symbŞs_»gex" &&e¡ "X$sk³d_expÜt" !ğ"X:"; 
th’


7003 
func_show_ev®
 '$EGREP -e "$export_symbols_regex" "$export_symbols" > "${export_symbols}T"'

7004 
func_show_ev®
 '$MV "${export_symbols}T" "$export_symbols"'

7005 
fi


7006 
fi


7007 
fi


7009 
‹¡
 -
n
 "$expÜt_symbŞs" &&e¡ -À"$šşude_expsyms"; 
th’


7010 
tmp_expÜt_symbŞs
="$export_symbols"

7011 
‹¡
 -
n
 "$Üig_expÜt_symbŞs" && 
tmp_expÜt_symbŞs
="$orig_export_symbols"

7012 
$İt_dry_run
 || 
ev®
 '$ECHO "X$include_expsyms" | $Xsed | $SP2NL >> "$tmp_export_symbols"'

7013 
fi


7015 
‹¡
 "X$sk³d_expÜt" !ğ"X:" &&e¡ -
n
 "$Üig_expÜt_symbŞs"; 
th’


7016 #Th
giv’
 
expÜts_symbŞs
 
fe
 
has
 
to
 
be
 
f‹»d
, 
so
 
f‹r
 
™
.

7017 
func_v”bo£
 "filter symbol†ist for \`$libname.la'oag DATAƒxports"

7018 #FIXME: 
$ouut_objdœ
/
$libÇme
.
f‹r
 
pÙ’tŸÎy
 
cÚšs
 
lÙs
 
of


7019 #'
s
' commands which‚ot‡ll seds can handle. GNU sed should be fine

7020 #though. 
Also
, 
the
 
f‹r
 
sÿËs
 
su³¾š—¾y
 
w™h
h
numb”
 
of


7021 #glob® 
v¬ŸbËs
. 
	`još
(1è
would
 
be
 
niû
 
h”e
, 
but
 
unfÜtuÇ‹ly


7023 
$İt_dry_run
 || 
$SED
 -
e
 '/[ ,]DATA/!d;s,\(.*\)\([ \,].*\),s|^\1$|\1\2|,' < 
$expÜt_symbŞs
 > 
$ouut_objdœ
/
$libÇme
.
f‹r


7024 
d–fes
="$delfiles $export_symbols $output_objdir/$libname.filter"

7025 
expÜt_symbŞs
=
$ouut_objdœ
/
$libÇme
.
def


7026 
$İt_dry_run
 || 
$SED
 -
f
 
$ouut_objdœ
/
$libÇme
.
f‹r
 < 
$Üig_expÜt_symbŞs
 > 
$expÜt_symbŞs


7027 
fi


7029 
tmp_d•libs
=

7030 
‹¡_d•lib
 
š
 
$d•libs
; do

7031 " $cÚv’›nû " 
š


7034 
tmp_d•libs
="$tmp_deplibs $test_deplib"

7036 
e§c


7037 
dÚe


7038 
d•libs
="$tmp_deplibs"

7040 
‹¡
 -
n
 "$cÚv’›nû"; 
th’


7041 
‹¡
 -
n
 "$whole_archive_flag_spec" &&

7042 
‹¡
 "$comp”_Ãeds_objeù" = 
yes
 &&

7043 
‹¡
 -
z
 "$libobjs"; 
th’


7044 #exŒaù 
the
 
¬chives
, 
so
 
we
 
have
 
objeùs
 
to
 
li¡
.

7045 #TODO: 
could
 
İtimize
 
this
 
to
 
ju¡
 
exŒaù
 
Úe
 
¬chive
.

7046 
whŞe_¬chive_æag_¥ec
=

7047 
fi


7048 
‹¡
 -
n
 "$whŞe_¬chive_æag_¥ec"; 
th’


7049 
§ve_libobjs
=
$libobjs


7050 
ev®
 
libobjs
=\"\$libobjs $whole_archive_flag_spec\"

7051 
‹¡
 "X$libobjs" = "X " && 
libobjs
=

7053 
g’tİ
="$output_objdir/${outputname}x"

7054 
g’”©ed
="$generated $gentop"

7056 
func_exŒaù_¬chives
 
$g’tİ
 
$cÚv’›nû


7057 
libobjs
="$libobjs $func_extract_archives_result"

7058 
‹¡
 "X$libobjs" = "X " && 
libobjs
=

7059 
fi


7060 
fi


7062 
‹¡
 "$th»ad_§ã" = 
yes
 &&e¡ -
n
 "$th»ad_§ã_æag_¥ec"; 
th’


7063 
ev®
 
æag
=\"$thread_safe_flag_spec\"

7064 
lšk”_æags
="$linker_flags $flag"

7065 
fi


7067 #Mak
a
 
backup
 
of
 
the
 
unš¡®Ëd
 
lib¿ry
 
wh’
 
»lškšg


7068 
‹¡
 "$mode" = 
»lšk
; 
th’


7069 
$İt_dry_run
 || 
ev®
 '(cd $ouut_objdœ && $RM ${»®Çme}U && $MV $»®Çm${»®Çme}U)' || 
ex™
 
$
?

7070 
fi


7072 #DØ
—ch
 
of
 
the
 
¬chive
 
commªds
.

7073 
‹¡
 "$moduË" = 
yes
 &&e¡ -
n
 "$moduË_cmds" ; 
th’


7074 
‹¡
 -
n
 "$expÜt_symbŞs" &&e¡ -À"$moduË_expsym_cmds"; 
th’


7075 
ev®
 
‹¡_cmds
=\"$module_expsym_cmds\"

7076 
cmds
=
$moduË_expsym_cmds


7078 
ev®
 
‹¡_cmds
=\"$module_cmds\"

7079 
cmds
=
$moduË_cmds


7080 
fi


7082 
‹¡
 -
n
 "$expÜt_symbŞs" &&e¡ -À"$¬chive_expsym_cmds"; 
th’


7083 
ev®
 
‹¡_cmds
=\"$archive_expsym_cmds\"

7084 
cmds
=
$¬chive_expsym_cmds


7086 
ev®
 
‹¡_cmds
=\"$archive_cmds\"

7087 
cmds
=
$¬chive_cmds


7088 
fi


7089 
fi


7091 
‹¡
 "X$skipped_export" != "X:" &&

7092 
func_Ën
 " $test_cmds" &&

7093 
Ën
=
$func_Ën_»suÉ
 &&

7094 
‹¡
 "$Ën" -
É
 "$max_cmd_Ën" ||e¡ "$max_cmd_Ën" -
Ë
 -1; 
th’


7097 #Th
commªd
 
lše
 
is
 
too
 
to
 
lšk
 
š
 
Úe
 
¡•
,†šk 
p›ûwi£


7098 #Ü, 
usšg
 
GNU
 
ld
 
ªd
 
sk³d_expÜt
 
is
 
nÙ
 :, 
u£
 
a
 
lšk”


7101 #Sav
the
 
v®ue
 
of
 
$ouut
 
ªd
 
$libobjs
 
beÿu£
 
we
 
wªt
 
to


7102 #u£ 
them
 
Ï‹r
. 
If
 
we
 
have
 
whŞe_¬chive_æag_¥ec
, we

7103 #wªˆ
to
 
u£
 
§ve_libobjs
 
as
 
™
 
was
 
befÜe


7104 #whŞe_¬chive_æag_¥eø
was
 
ex·nded
, 
beÿu£
 
we
 
ÿn
't

7105 #assum
the
 
lšk”
 
und”¡ªds
 
whŞe_¬chive_æag_¥ec
.

7106 #Thi 
may
 
have
 
to
 
be
 
»vis™ed
, 
š
 
too
 
mªy


7107 #cÚv’›nû 
lib¿r›s
 
g‘
 
lšked
 
š
 
ªd
 
’d
 
up
 
exûedšg


7108 #th
¥ec
.

7109 
‹¡
 -
z
 "$cÚv’›nû" ||e¡ -z "$whŞe_¬chive_æag_¥ec"; 
th’


7110 
§ve_libobjs
=
$libobjs


7111 
fi


7112 
§ve_ouut
=
$ouut


7113 
ouut_Ï
=`
$ECHO
 "X$ouut" | 
$X£d
 -
e
 "$basename"`

7115 #CË¬ 
the
 
»lßdabË
 
objeù
 
ü—tiÚ
 
commªd
 
queue
 
ªd


7116 #š™Ÿliz
k
 
to
 
Úe
.

7117 
‹¡_cmds
=

7118 
cÚÿt_cmds
=

7119 
objli¡
=

7120 
Ï¡_robj
=

7121 
k
=1

7123 
‹¡
 -
n
 "$§ve_libobjs" &&e¡ "X$sk³d_expÜt" !ğ"X:" &&e¡ "$w™h_gnu_ld" = 
yes
; 
th’


7124 
ouut
=
$
{
ouut_objdœ
}/${
ouut_Ï
}.
Êksüt


7125 
func_v”bo£
 "creating GNU†d script: $output"

7126 
$ECHO
 'INPUT (' > 
$ouut


7127 
obj
 
š
 
$§ve_libobjs


7129 
$ECHO
 "$obj" >> 
$ouut


7130 
dÚe


7131 
$ECHO
 ')' >> 
$ouut


7132 
d–fes
="$delfiles $output"

7133 
–if
 
‹¡
 -
n
 "$§ve_libobjs" &&e¡ "X$sk³d_expÜt" !ğ"X:" &&e¡ "X$fe_li¡_¥ec" !ğ
X
; 
th’


7134 
ouut
=
$
{
ouut_objdœ
}/${
ouut_Ï
}.
Êk


7135 
func_v”bo£
 "creating†inker input file†ist: $output"

7136 : > 
$ouut


7137 
£t
 
x
 
$§ve_libobjs


7138 
shiá


7139 
fœ¡obj
=

7140 
‹¡
 "$comp”_Ãeds_objeù" = 
yes
; 
th’


7141 
fœ¡obj
="$1 "

7142 
shiá


7143 
fi


7144 
obj


7146 
$ECHO
 "$obj" >> 
$ouut


7147 
dÚe


7148 
d–fes
="$delfiles $output"

7149 
ouut
=
$fœ¡obj
\"$file_list_spec$output\"

7151 
‹¡
 -
n
 "$§ve_libobjs"; 
th’


7152 
func_v”bo£
 "creating„eloadable object files..."

7153 
ouut
=
$ouut_objdœ
/
$ouut_Ï
-
$
{
k
}.
$objext


7154 
ev®
 
‹¡_cmds
=\"$reload_cmds\"

7155 
func_Ën
 " $test_cmds"

7156 
Ën0
=
$func_Ën_»suÉ


7157 
Ën
=
$Ën0


7159 #Loİ 
ov”
 
the
 
li¡
 
of
 
objeùs
 
to
 
be
 
lšked
.

7160 
obj
 
š
 
$§ve_libobjs


7162 
func_Ën
 " $obj"

7163 
func_¬™h
 
$Ën
 + 
$func_Ën_»suÉ


7164 
Ën
=
$func_¬™h_»suÉ


7165 
‹¡
 "X$objli¡" = 
X
 ||

7166 
‹¡
 "$Ën" -
É
 "$max_cmd_Ën"; 
th’


7167 
func_­³nd
 
objli¡
 " $obj"

7169 #Th
commªd
 
$‹¡_cmds
 
is
 
®mo¡
 
too
 , 
add
 
a


7170 #commªd 
to
 
the
 
queue
.

7171 
‹¡
 "$k" -
eq
 1 ; 
th’


7172 #Th
fœ¡
 
fe
 
dÛ¢
't have‡…revious commando‡dd.

7173 
ev®
 
cÚÿt_cmds
=\"$reload_cmds $objlist $last_robj\"

7175 #AÎ 
sub£qu’t
 
»lßdabË
 
objeù
 
fes
 
wl
 
lšk
 
š


7176 #th
Ï¡
 
Úe
 
ü—‹d
.

7177 
ev®
 
cÚÿt_cmds
=\"\$concat_cmds~$reload_cmds $objlist $last_robj~\$RM $last_robj\"

7178 
fi


7179 
Ï¡_robj
=
$ouut_objdœ
/
$ouut_Ï
-
$
{
k
}.
$objext


7180 
func_¬™h
 
$k
 + 1

7181 
k
=
$func_¬™h_»suÉ


7182 
ouut
=
$ouut_objdœ
/
$ouut_Ï
-
$
{
k
}.
$objext


7183 
objli¡
=
$obj


7184 
func_Ën
 " $last_robj"

7185 
func_¬™h
 
$Ën0
 + 
$func_Ën_»suÉ


7186 
Ën
=
$func_¬™h_»suÉ


7187 
fi


7188 
dÚe


7189 #HªdË 
the
 
»maššg
 
objeùs
 
by
 
ü—tšg
 
Úe
 
Ï¡


7190 #»lßdabË 
objeù
 
fe
. 
AÎ
 
sub£qu’t
 
»lßdabË
 object

7191 #fe 
wl
 
lšk
 
š
 
the
 
Ï¡
 
Úe
 
ü—‹d
.

7192 
‹¡
 -
z
 "$cÚÿt_cmds" || 
cÚÿt_cmds
=
$cÚÿt_cmds
~

7193 
ev®
 
cÚÿt_cmds
=\"\${concat_cmds}$reload_cmds $objlist $last_robj\"

7194 
‹¡
 -
n
 "$Ï¡_robj"; 
th’


7195 
ev®
 
cÚÿt_cmds
=\"\${concat_cmds}~\$RM $last_robj\"

7196 
fi


7197 
d–fes
="$delfiles $output"

7200 
ouut
=

7201 
fi


7203 
$
{
sk³d_expÜt
-
çl£
}; 
th’


7204 
func_v”bo£
 "generating symbol†ist for \`$libname.la'"

7205 
expÜt_symbŞs
="$output_objdir/$libname.exp"

7206 
$İt_dry_run
 || 
$RM
 
$expÜt_symbŞs


7207 
libobjs
=
$ouut


7208 #Aµ’d 
the
 
commªd
 
to
 
ü—‹
h
expÜt
 
fe
.

7209 
‹¡
 -
z
 "$cÚÿt_cmds" || 
cÚÿt_cmds
=
$cÚÿt_cmds
~

7210 
ev®
 
cÚÿt_cmds
=\"\$concat_cmds$export_symbols_cmds\"

7211 
‹¡
 -
n
 "$Ï¡_robj"; 
th’


7212 
ev®
 
cÚÿt_cmds
=\"\$concat_cmds~\$RM $last_robj\"

7213 
fi


7214 
fi


7216 
‹¡
 -
n
 "$save_libobjs" &&

7217 
func_v”bo£
 "creating‡emporary„eloadable object file: $output"

7219 #Loİ 
through
 
the
 
commªds
 
g’”©ed
 
above
 
ªd
 
execu‹
 
them
.

7220 
§ve_ifs
="$IFS"; 
IFS
='~'

7221 
cmd
 
š
 
$cÚÿt_cmds
; do

7222 
IFS
="$save_ifs"

7223 
$İt_s’t
 || {

7224 
func_quÙe_fÜ_ex·nd
 "$cmd"

7225 
ev®
 "func_echo $func_quote_for_expand_result"

7227 
$İt_dry_run
 || 
ev®
 "$cmd" || {

7228 
É_ex™
=
$
?

7230 #Re¡Ü
the
 
unš¡®Ëd
 
lib¿ry
 
ªd
 
ex™


7231 
‹¡
 "$mode" = 
»lšk
; 
th’


7232 Ğ
cd
 "$output_objdir" && \

7233 
$RM
 "${realname}T" && \

7234 
$MV
 "${realname}U" "$realname" )

7235 
fi


7237 
ex™
 
$É_ex™


7239 
dÚe


7240 
IFS
="$save_ifs"

7242 
‹¡
 -
n
 "$expÜt_symbŞs_»gex" && 
$
{
sk³d_expÜt
-
çl£
}; 
th’


7243 
func_show_ev®
 '$EGREP -e "$export_symbols_regex" "$export_symbols" > "${export_symbols}T"'

7244 
func_show_ev®
 '$MV "${export_symbols}T" "$export_symbols"'

7245 
fi


7246 
fi


7248 
$
{
sk³d_expÜt
-
çl£
}; 
th’


7249 
‹¡
 -
n
 "$expÜt_symbŞs" &&e¡ -À"$šşude_expsyms"; 
th’


7250 
tmp_expÜt_symbŞs
="$export_symbols"

7251 
‹¡
 -
n
 "$Üig_expÜt_symbŞs" && 
tmp_expÜt_symbŞs
="$orig_export_symbols"

7252 
$İt_dry_run
 || 
ev®
 '$ECHO "X$include_expsyms" | $Xsed | $SP2NL >> "$tmp_export_symbols"'

7253 
fi


7255 
‹¡
 -
n
 "$Üig_expÜt_symbŞs"; 
th’


7256 #Th
giv’
 
expÜts_symbŞs
 
fe
 
has
 
to
 
be
 
f‹»d
, 
so
 
f‹r
 
™
.

7257 
func_v”bo£
 "filter symbol†ist for \`$libname.la'oag DATAƒxports"

7258 #FIXME: 
$ouut_objdœ
/
$libÇme
.
f‹r
 
pÙ’tŸÎy
 
cÚšs
 
lÙs
 
of


7259 #'
s
' commands which‚ot‡ll seds can handle. GNU sed should be fine

7260 #though. 
Also
, 
the
 
f‹r
 
sÿËs
 
su³¾š—¾y
 
w™h
h
numb”
 
of


7261 #glob® 
v¬ŸbËs
. 
	`još
(1è
would
 
be
 
niû
 
h”e
, 
but
 
unfÜtuÇ‹ly


7263 
$İt_dry_run
 || 
$SED
 -
e
 '/[ ,]DATA/!d;s,\(.*\)\([ \,].*\),s|^\1$|\1\2|,' < 
$expÜt_symbŞs
 > 
$ouut_objdœ
/
$libÇme
.
f‹r


7264 
d–fes
="$delfiles $export_symbols $output_objdir/$libname.filter"

7265 
expÜt_symbŞs
=
$ouut_objdœ
/
$libÇme
.
def


7266 
$İt_dry_run
 || 
$SED
 -
f
 
$ouut_objdœ
/
$libÇme
.
f‹r
 < 
$Üig_expÜt_symbŞs
 > 
$expÜt_symbŞs


7267 
fi


7268 
fi


7270 
libobjs
=
$ouut


7271 #Re¡Ü
the
 
v®ue
 
of
 
ouut
.

7272 
ouut
=
$§ve_ouut


7274 
‹¡
 -
n
 "$cÚv’›nû" &&e¡ -À"$whŞe_¬chive_æag_¥ec"; 
th’


7275 
ev®
 
libobjs
=\"\$libobjs $whole_archive_flag_spec\"

7276 
‹¡
 "X$libobjs" = "X " && 
libobjs
=

7277 
fi


7278 #Ex·nd 
the
 
lib¿ry
 
lškšg
 
commªds
 
agaš
 
to
 
»£t
he

7279 #v®u
of
 
$libobjs
 
p›ûwi£
 
lškšg
.

7281 #DØ
—ch
 
of
 
the
 
¬chive
 
commªds
.

7282 
‹¡
 "$moduË" = 
yes
 &&e¡ -
n
 "$moduË_cmds" ; 
th’


7283 
‹¡
 -
n
 "$expÜt_symbŞs" &&e¡ -À"$moduË_expsym_cmds"; 
th’


7284 
cmds
=
$moduË_expsym_cmds


7286 
cmds
=
$moduË_cmds


7287 
fi


7289 
‹¡
 -
n
 "$expÜt_symbŞs" &&e¡ -À"$¬chive_expsym_cmds"; 
th’


7290 
cmds
=
$¬chive_expsym_cmds


7292 
cmds
=
$¬chive_cmds


7293 
fi


7294 
fi


7295 
fi


7297 
‹¡
 -
n
 "$d–fes"; 
th’


7298 #Aµ’d 
the
 
commªd
 
to
 
»move
 
‹mpÜ¬y
 
fes
Ø
$cmds
.

7299 
ev®
 
cmds
=\"\$cmds~\$RM $delfiles\"

7300 
fi


7302 #Add 
ªy
 
objeùs
 
äom
 
´–ßded
 
cÚv’›nû
 
lib¿r›s


7303 
‹¡
 -
n
 "$dÍ»fes"; 
th’


7304 
g’tİ
="$output_objdir/${outputname}x"

7305 
g’”©ed
="$generated $gentop"

7307 
func_exŒaù_¬chives
 
$g’tİ
 
$dÍ»fes


7308 
libobjs
="$libobjs $func_extract_archives_result"

7309 
‹¡
 "X$libobjs" = "X " && 
libobjs
=

7310 
fi


7312 
§ve_ifs
="$IFS"; 
IFS
='~'

7313 
cmd
 
š
 
$cmds
; do

7314 
IFS
="$save_ifs"

7315 
ev®
 
cmd
=\"$cmd\"

7316 
$İt_s’t
 || {

7317 
func_quÙe_fÜ_ex·nd
 "$cmd"

7318 
ev®
 "func_echo $func_quote_for_expand_result"

7320 
$İt_dry_run
 || 
ev®
 "$cmd" || {

7321 
É_ex™
=
$
?

7323 #Re¡Ü
the
 
unš¡®Ëd
 
lib¿ry
 
ªd
 
ex™


7324 
‹¡
 "$mode" = 
»lšk
; 
th’


7325 Ğ
cd
 "$output_objdir" && \

7326 
$RM
 "${realname}T" && \

7327 
$MV
 "${realname}U" "$realname" )

7328 
fi


7330 
ex™
 
$É_ex™


7332 
dÚe


7333 
IFS
="$save_ifs"

7335 #Re¡Ü
the
 
unš¡®Ëd
 
lib¿ry
 
ªd
 
ex™


7336 
‹¡
 "$mode" = 
»lšk
; 
th’


7337 
$İt_dry_run
 || 
ev®
 '(cd $ouut_objdœ && $RM ${»®Çme}T && $MV $»®Çm${»®Çme}T && $MV ${»®Çme}U $»®Çme)' || 
ex™
 
$
?

7339 
‹¡
 -
n
 "$cÚv’›nû"; 
th’


7340 
‹¡
 -
z
 "$whŞe_¬chive_æag_¥ec"; 
th’


7341 
func_show_ev®
 '${RM}r "$gentop"'

7342 
fi


7343 
fi


7345 
ex™
 
$EXIT_SUCCESS


7346 
fi


7348 #C»©
lšks
 
to
 
the
 
»®
 
lib¿ry
.

7349 
lškÇme
 
š
 
$lškÇmes
; do

7350 
‹¡
 "$»®Çme" !ğ"$lškÇme"; 
th’


7351 
func_show_ev®
 '(cd "$output_objdir" && $RM "$linkname" && $LN_S "$realname" "$linkname")' 'exit $?'

7352 
fi


7353 
dÚe


7355 #Ià-
moduË
 
Ü
 -
expÜt
-
dyÇmic
 
was
 
¥ecif›d
, 
£t
 
the
 
dÊame
.

7356 
‹¡
 "$moduË" = 
yes
 ||e¡ "$expÜt_dyÇmic" = yes; 
th’


7357 #OÀ
®l
 
known
 
İ”©šg
 
sy¡ems
, 
the£
 
¬e
 
id’tiÿl
.

7358 
dÊame
="$soname"

7359 
fi


7360 
fi


7363 
obj
)

7364 
‹¡
 -
n
 "$dlfes$dÍ»fes" ||e¡ "$dl£lf" !ğ
no
; 
th’


7365 
func_w¬nšg
 "\`-dlopen' is ignored for objects"

7366 
fi


7368 " $d•libs" 
š


7369 *\ -
l
* | *\ -
L
*)

7370 
func_w¬nšg
 "\`-l'‡nd \`-L'‡re ignored for objects" ;;

7371 
e§c


7373 
‹¡
 -
n
 "$rpath" && \

7374 
func_w¬nšg
 "\`-rpath' is ignored for objects"

7376 
‹¡
 -
n
 "$xrpath" && \

7377 
func_w¬nšg
 "\`-R' is ignored for objects"

7379 
‹¡
 -
n
 "$vinfo" && \

7380 
func_w¬nšg
 "\`-version-info' is ignored for objects"

7382 
‹¡
 -
n
 "$release" && \

7383 
func_w¬nšg
 "\`-release' is ignored for objects"

7385 
$ouut
 
š


7386 *.
lo
)

7387 
‹¡
 -
n
 "$objs$old_deplibs" && \

7388 
func_çl_”rÜ
 "cannot build†ibrary object \`$output' from‚on-libtool objects"

7390 
libobj
=
$ouut


7391 
func_lo2o
 "$libobj"

7392 
obj
=
$func_lo2o_»suÉ


7395 
libobj
=

7396 
obj
="$output"

7398 
e§c


7400 #D–‘
the
 
Şd
 
objeùs
.

7401 
$İt_dry_run
 || 
$RM
 
$obj
 
$libobj


7403 #Objeù 
äom
 
cÚv’›nû
 
lib¿r›s
. 
This
 
assumes


7404 #sšgË-
v”siÚ
 
cÚv’›nû
 
lib¿r›s
. 
Wh’ev”
 
we
 
ü—‹


7405 #difã»Á 
Úes
 
PIC
/
nÚ
-PIC, 
this
 
we
'll haveo duplicate

7406 #th
exŒaùiÚ
.

7407 
»lßd_cÚv_objs
=

7408 
g’tİ
=

7409 #»lßd_cmd 
runs
 
$LD
 
dœeùly
, 
so
 
Ët
 
us
 
g‘
 
rid
 
of


7410 #-
Wl
 
äom
 
whŞe_¬chive_æag_¥ec
 
ªd
 
hİe
 
we
 
ÿn
 
g‘
 
by
 
w™h


7411 #tuºšg 
comma
 
što
 
¥aû
..

7412 
wl
=

7414 
‹¡
 -
n
 "$cÚv’›nû"; 
th’


7415 
‹¡
 -
n
 "$whŞe_¬chive_æag_¥ec"; 
th’


7416 
ev®
 
tmp_whŞe_¬chive_æags
=\"$whole_archive_flag_spec\"

7417 
»lßd_cÚv_objs
=
$»lßd_objs
\ `
$ECHO
 "X$tmp_whŞe_¬chive_æags" | 
$X£d
 -
e
 's|,| |g'`

7419 
g’tİ
="$output_objdir/${obj}x"

7420 
g’”©ed
="$generated $gentop"

7422 
func_exŒaù_¬chives
 
$g’tİ
 
$cÚv’›nû


7423 
»lßd_cÚv_objs
="$reload_objs $func_extract_archives_result"

7424 
fi


7425 
fi


7427 #C»©
the
 
Şd
-
¡yË
 
objeù
.

7428 
»lßd_objs
="$objs$Şd_d•lib "`
$ECHO
 "X$libobjs" | 
$SP2NL
 | 
$X£d
 -
e
 '/\.'
$
{
libext
}$'/d' -'/\.lib$/d' -"$lo2o" | 
$NL2SP
`" $»lßd_cÚv_objs" ###‹¡su™e: 
sk
 
Ã¡ed
 
quÙšg
 
‹¡


7430 
ouut
="$obj"

7431 
func_execu‹_cmds
 "$reload_cmds" 'exit $?'

7433 #Ex™ 
we
 
¬’
't doing‡†ibrary object file.

7434 
‹¡
 -
z
 "$libobj"; 
th’


7435 
‹¡
 -
n
 "$g’tİ"; 
th’


7436 
func_show_ev®
 '${RM}r "$gentop"'

7437 
fi


7439 
ex™
 
$EXIT_SUCCESS


7440 
fi


7442 
‹¡
 "$bud_libtoŞ_libs" !ğ
yes
; 
th’


7443 
‹¡
 -
n
 "$g’tİ"; 
th’


7444 
func_show_ev®
 '${RM}r "$gentop"'

7445 
fi


7447 #C»©
ª
 
šv®id
 
libtoŞ
 
objeù
 
no
 
PIC
, 
so
 
th©
 
we
 
dÚ
't

7448 #accid’Îy 
lšk
 
™
 
što
 
a
 
´og¿m
.

7450 #$İt_dry_ruÀ|| 
ev®
 "echØtime¡am°> $libobj" || 
ex™
 
$
?

7451 
ex™
 
$EXIT_SUCCESS


7452 
fi


7454 
‹¡
 -
n
 "$pic_æag" ||e¡ "$pic_mode" !ğ; 
th’


7455 #OÆy dØ
commªds
 
we
 
»®ly
 
have
 
difã»Á
 
PIC
 
objeùs
.

7456 
»lßd_objs
="$libobjs $reload_conv_objs"

7457 
ouut
="$libobj"

7458 
func_execu‹_cmds
 "$reload_cmds" 'exit $?'

7459 
fi


7461 
‹¡
 -
n
 "$g’tİ"; 
th’


7462 
func_show_ev®
 '${RM}r "$gentop"'

7463 
fi


7465 
ex™
 
$EXIT_SUCCESS


7468 
´og
)

7469 
$ho¡
 
š


7470 *
cygwš
*è
func_¡rÇme
 '' '.exe' "$output"

7471 
ouut
=
$func_¡rÇme_»suÉ
.
exe
;;

7472 
e§c


7473 
‹¡
 -
n
 "$vinfo" && \

7474 
func_w¬nšg
 "\`-version-info' is ignored for…rograms"

7476 
‹¡
 -
n
 "$release" && \

7477 
func_w¬nšg
 "\`-release' is ignored for…rograms"

7479 
‹¡
 "$´–ßd" = 
yes
 \

7480 && 
‹¡
 "$dlİ’_suµÜt" = 
unknown
 \

7481 && 
‹¡
 "$dlİ’_£lf" = 
unknown
 \

7482 && 
‹¡
 "$dlİ’_£lf_¡©ic" = 
unknown
 && \

7483 
func_w¬nšg
 "\`LT_INIT([dlopen])'‚ot used. Assuming‚o dlopen support."

7485 
$ho¡
 
š


7486 *-*-
rh­sody
* | *-*-
d¬wš1
.[012])

7487 #OÀ
Rh­sody
 
»¶aû
 
the
 
C
 
lib¿ry
 
is
h
Sy¡em
 
äamewÜk


7488 
compe_d•libs
=`
$ECHO
 "X $compe_d•libs" | 
$X£d
 -
e
 's/ -lc / System.ltframework /'`

7489 
fš®ize_d•libs
=`
$ECHO
 "X $fš®ize_d•libs" | 
$X£d
 -
e
 's/ -lc / System.ltframework /'`

7491 
e§c


7493 
$ho¡
 
š


7494 *-*-
d¬wš
*)

7496 #Buˆ
is
 
suµo£dly
 
fixed
 
Ú
 10.4 
Ü
 
	`Ï‹r
 (
yay
!).

7497 
‹¡
 "$gÇme" = 
CXX
 ; 
th’


7498 
$
{
MACOSX_DEPLOYMENT_TARGET
-10.0} 
š


7500 
compe_commªd
="$compile_command ${wl}-bind_at_load"

7501 
fš®ize_commªd
="$finalize_command ${wl}-bind_at_load"

7503 
e§c


7504 
fi


7505 #Tim
to
 
chªge
 
®l
 
our
 "foo.ÉäamewÜk" 
¡uff
 
back
o "-framework foo"

7506 
compe_d•libs
=`
$ECHO
 "X $compe_d•libs" | 
$X£d
 -
e
 's% \([^ $]*\).ltframework% -framework \1%g'`

7507 
fš®ize_d•libs
=`
$ECHO
 "X $fš®ize_d•libs" | 
$X£d
 -
e
 's% \([^ $]*\).ltframework% -framework \1%g'`

7509 
e§c


7512 #mov
lib¿ry
 
£¬ch
 
·ths
 
th©
 
cošcide
 
w™h
…©h 
to
 
nÙ
 
y‘


7513 #š¡®Ëd 
lib¿r›s
 
to
 
the
 
begšnšg
 
of
h
lib¿ry
 
£¬ch
 
li¡


7514 
Ãw_libs
=

7515 
·th
 
š
 
$nÙš¡_·th
; do

7516 " $Ãw_lib " 
š


7519 " $compe_d•lib " 
š


7521 
Ãw_libs
="$new_libs -L$path/$objdir" ;;

7522 
e§c


7524 
e§c


7525 
dÚe


7526 
d•lib
 
š
 
$compe_d•libs
; do

7527 
$d•lib
 
š


7528 -
L
*)

7529 " $Ãw_lib " 
š


7531 *è
Ãw_libs
="$new_libs $deplib" ;;

7532 
e§c


7534 *è
Ãw_libs
="$new_libs $deplib" ;;

7535 
e§c


7536 
dÚe


7537 
compe_d•libs
="$new_libs"

7540 
compe_commªd
="$compile_command $compile_deplibs"

7541 
fš®ize_commªd
="$finalize_command $finalize_deplibs"

7543 
‹¡
 -
n
 "$½©h$x½©h"; 
th’


7544 #Ià
the
 
u£r
 
¥ecif›d
 
ªy
 
½©h
 
æags
, 
th’
 
add
 
them
.

7545 
libdœ
 
š
 
$½©h
 
$x½©h
; do

7546 #Thi 
is
 
the
 
magic
 
to
 
u£
 -
½©h
.

7547 "$fš®ize_½©h " 
š


7549 *è
fš®ize_½©h
="$finalize_rpath $libdir" ;;

7550 
e§c


7551 
dÚe


7552 
fi


7554 #Now 
h¬dcode
 
the
 
lib¿ry
 
·ths


7555 
½©h
=

7556 
h¬dcode_libdœs
=

7557 
libdœ
 
š
 
$compe_½©h
 
$fš®ize_½©h
; do

7558 
‹¡
 -
n
 "$h¬dcode_libdœ_æag_¥ec"; 
th’


7559 
‹¡
 -
n
 "$h¬dcode_libdœ_£·¿tÜ"; 
th’


7560 
‹¡
 -
z
 "$h¬dcode_libdœs"; 
th’


7561 
h¬dcode_libdœs
="$libdir"

7563 #Ju¡ 
accumuÏ‹
 
the
 
unique
 
libdœs
.

7564 
$h¬dcode_libdœ_£·¿tÜ$h¬dcode_libdœs$h¬dcode_libdœ_£·¿tÜ
 
š


7568 
h¬dcode_libdœs
="$hardcode_libdirs$hardcode_libdir_separator$libdir"

7570 
e§c


7571 
fi


7573 
ev®
 
æag
=\"$hardcode_libdir_flag_spec\"

7574 
½©h
="$rpath $flag"

7575 
fi


7576 
–if
 
‹¡
 -
n
 "$ruÅ©h_v¬"; 
th’


7577 "$³rm_½©h " 
š


7579 *è
³rm_½©h
="$perm_rpath $libdir" ;;

7580 
e§c


7581 
fi


7582 
$ho¡
 
š


7583 *-*-
cygwš
* | *-*-
mšgw
* | *-*-
pw32
* | *-*-
os2
* | *-
ûgcc
*)

7584 
‹¡bšdœ
=`
$
{
ECHO
} "$libdœ" | ${
SED
} -
e
 's*/lib$*/bin*'`

7585 :
$dÎ£¬ch·th
: 
š


7587 ::è
dÎ£¬ch·th
=
$libdœ
;;

7588 *è
dÎ£¬ch·th
="$dllsearchpath:$libdir";;

7589 
e§c


7590 :
$dÎ£¬ch·th
: 
š


7592 ::è
dÎ£¬ch·th
=
$‹¡bšdœ
;;

7593 *è
dÎ£¬ch·th
="$dllsearchpath:$testbindir";;

7594 
e§c


7596 
e§c


7597 
dÚe


7598 #Sub¡™u‹ 
the
 
h¬dcoded
 
libdœs
 
što
h
½©h
.

7599 
‹¡
 -
n
 "$hardcode_libdir_separator" &&

7600 
‹¡
 -
n
 "$h¬dcode_libdœs"; 
th’


7601 
libdœ
="$hardcode_libdirs"

7602 
ev®
 
½©h
=\" $hardcode_libdir_flag_spec\"

7603 
fi


7604 
compe_½©h
="$rpath"

7606 
½©h
=

7607 
h¬dcode_libdœs
=

7608 
libdœ
 
š
 
$fš®ize_½©h
; do

7609 
‹¡
 -
n
 "$h¬dcode_libdœ_æag_¥ec"; 
th’


7610 
‹¡
 -
n
 "$h¬dcode_libdœ_£·¿tÜ"; 
th’


7611 
‹¡
 -
z
 "$h¬dcode_libdœs"; 
th’


7612 
h¬dcode_libdœs
="$libdir"

7614 #Ju¡ 
accumuÏ‹
 
the
 
unique
 
libdœs
.

7615 
$h¬dcode_libdœ_£·¿tÜ$h¬dcode_libdœs$h¬dcode_libdœ_£·¿tÜ
 
š


7619 
h¬dcode_libdœs
="$hardcode_libdirs$hardcode_libdir_separator$libdir"

7621 
e§c


7622 
fi


7624 
ev®
 
æag
=\"$hardcode_libdir_flag_spec\"

7625 
½©h
="$rpath $flag"

7626 
fi


7627 
–if
 
‹¡
 -
n
 "$ruÅ©h_v¬"; 
th’


7628 "$fš®ize_³rm_½©h " 
š


7630 *è
fš®ize_³rm_½©h
="$finalize_perm_rpath $libdir" ;;

7631 
e§c


7632 
fi


7633 
dÚe


7634 #Sub¡™u‹ 
the
 
h¬dcoded
 
libdœs
 
što
h
½©h
.

7635 
‹¡
 -
n
 "$hardcode_libdir_separator" &&

7636 
‹¡
 -
n
 "$h¬dcode_libdœs"; 
th’


7637 
libdœ
="$hardcode_libdirs"

7638 
ev®
 
½©h
=\" $hardcode_libdir_flag_spec\"

7639 
fi


7640 
fš®ize_½©h
="$rpath"

7642 
‹¡
 -
n
 "$libobjs" &&e¡ "$bud_Şd_libs" = 
yes
; 
th’


7643 #T¿nsfÜm 
®l
 
the
 
lib¿ry
 
objeùs
 
što
 
¡ªd¬d
 objects.

7644 
compe_commªd
=`
$ECHO
 "X$compe_commªd" | 
$SP2NL
 | 
$X£d
 -
e
 "$lo2o" | 
$NL2SP
`

7645 
fš®ize_commªd
=`
$ECHO
 "X$fš®ize_commªd" | 
$SP2NL
 | 
$X£d
 -
e
 "$lo2o" | 
$NL2SP
`

7646 
fi


7648 
func_g’”©e_dlsyms
 "$outputname" "@PROGRAM@" "no"

7650 #‹m¶©
´–škšg
 
¡•


7651 
‹¡
 -
n
 "$´–šk_cmds"; 
th’


7652 
func_execu‹_cmds
 "$prelink_cmds" 'exit $?'

7653 
fi


7655 
w¿µ”s_»quœed
=
yes


7656 
$ho¡
 
š


7657 *
cygwš
* | *
mšgw
* )

7658 
‹¡
 "$bud_libtoŞ_libs" !ğ
yes
; 
th’


7659 
w¿µ”s_»quœed
=
no


7660 
fi


7662 *
ûgcc
)

7663 #Di§bË 
w¿µ”s
 
ûgcc
, 
we
 
¬e
 
üoss
 
compšg
 
ªyway
.

7664 
w¿µ”s_»quœed
=
no


7667 
‹¡
 "$Ãed_»lšk" = 
no
 ||e¡ "$bud_libtoŞ_libs" !ğ
yes
; 
th’


7668 
w¿µ”s_»quœed
=
no


7669 
fi


7671 
e§c


7672 
‹¡
 "$w¿µ”s_»quœed" = 
no
; 
th’


7673 #R•Ïû 
the
 
ouut
 
fe
 
¥ecifiÿtiÚ
.

7674 
compe_commªd
=`
$ECHO
 "X$compe_commªd" | 
$X£d
 -
e
 's%@OUTPUT@%'"$output"'%g'`

7675 
lšk_commªd
="$compile_command$compile_rpath"

7677 #W
have
 
no
 
unš¡®Ëd
 
lib¿ry
 
d•’d’c›s
, 
so
 
fš®ize
 
right
 
now
.

7678 
ex™_¡©us
=0

7679 
func_show_ev®
 "$link_command" 'exit_status=$?'

7681 #D–‘
the
 
g’”©ed
 
fes
.

7682 
‹¡
 -
f
 "$ouut_objdœ/${ouuŠame}S.${objext}"; 
th’


7683 
func_show_ev®
 '$RM "$output_objdir/${outputname}S.${objext}"'

7684 
fi


7686 
ex™
 
$ex™_¡©us


7687 
fi


7689 
‹¡
 -
n
 "$compe_shlib·th$fš®ize_shlib·th"; 
th’


7690 
compe_commªd
="$shlibpath_var=\"$compile_shlibpath$finalize_shlibpath\$$shlibpath_var\" $compile_command"

7691 
fi


7692 
‹¡
 -
n
 "$fš®ize_shlib·th"; 
th’


7693 
fš®ize_commªd
="$shlibpath_var=\"$finalize_shlibpath\$$shlibpath_var\" $finalize_command"

7694 
fi


7696 
compe_v¬
=

7697 
fš®ize_v¬
=

7698 
‹¡
 -
n
 "$ruÅ©h_v¬"; 
th’


7699 
‹¡
 -
n
 "$³rm_½©h"; 
th’


7700 #W
should
 
£t
 
the
 
ruÅ©h_v¬
.

7701 
½©h
=

7702 
dœ
 
š
 
$³rm_½©h
; do

7703 
½©h
="$rpath$dir:"

7704 
dÚe


7705 
compe_v¬
="$runpath_var=\"$rpath\$$runpath_var\" "

7706 
fi


7707 
‹¡
 -
n
 "$fš®ize_³rm_½©h"; 
th’


7708 #W
should
 
£t
 
the
 
ruÅ©h_v¬
.

7709 
½©h
=

7710 
dœ
 
š
 
$fš®ize_³rm_½©h
; do

7711 
½©h
="$rpath$dir:"

7712 
dÚe


7713 
fš®ize_v¬
="$runpath_var=\"$rpath\$$runpath_var\" "

7714 
fi


7715 
fi


7717 
‹¡
 "$no_š¡®l" = 
yes
; 
th’


7718 #W
dÚ
't‚eedo create‡ wrapper script.

7719 
lšk_commªd
="$compile_var$compile_command$compile_rpath"

7720 #R•Ïû 
the
 
ouut
 
fe
 
¥ecifiÿtiÚ
.

7721 
lšk_commªd
=`
$ECHO
 "X$lšk_commªd" | 
$X£d
 -
e
 's%@OUTPUT@%'"$output"'%g'`

7722 #D–‘
the
 
Şd
 
ouut
 
fe
.

7723 
$İt_dry_run
 || 
$RM
 
$ouut


7724 #Lšk 
the
 
execubË
 
ªd
 
ex™


7725 
func_show_ev®
 "$link_command" 'exit $?'

7726 
ex™
 
$EXIT_SUCCESS


7727 
fi


7729 
‹¡
 "$h¬dcode_aùiÚ" = 
»lšk
; 
th’


7730 #Fa¡ 
š¡®ÏtiÚ
 
is
 
nÙ
 
suµÜ‹d


7731 
lšk_commªd
="$compile_var$compile_command$compile_rpath"

7732 
»lšk_commªd
="$finalize_var$finalize_command$finalize_rpath"

7734 
func_w¬nšg
 "this…latform does‚ot†ike uninstalled shared†ibraries"

7735 
func_w¬nšg
 "\`$output' will be„elinked during installation"

7737 
‹¡
 "$ç¡_š¡®l" !ğ
no
; 
th’


7738 
lšk_commªd
="$finalize_var$compile_command$finalize_rpath"

7739 
‹¡
 "$ç¡_š¡®l" = 
yes
; 
th’


7740 
»lšk_commªd
=`
$ECHO
 "X$compe_v¬$compe_commªd$compe_½©h" | 
$X£d
 -
e
 's%@OUTPUT@%\$progdir/\$file%g'`

7742 #ç¡_š¡®È
is
 
£t
 
to
 
ÃedËss


7743 
»lšk_commªd
=

7744 
fi


7746 
lšk_commªd
="$compile_var$compile_command$compile_rpath"

7747 
»lšk_commªd
="$finalize_var$finalize_command$finalize_rpath"

7748 
fi


7749 
fi


7751 #R•Ïû 
the
 
ouut
 
fe
 
¥ecifiÿtiÚ
.

7752 
lšk_commªd
=`
$ECHO
 "X$lšk_commªd" | 
$X£d
 -
e
 's%@OUTPUT@%'"$output_objdir/$outputname"'%g'`

7754 #D–‘
the
 
Şd
 
ouut
 
fes
.

7755 
$İt_dry_run
 || 
$RM
 
$ouut
 
$ouut_objdœ
/
$ouuŠame
 $ouut_objdœ/
É
-$outputname

7757 
func_show_ev®
 "$link_command" 'exit $?'

7759 #Now 
ü—‹
 
the
 
w¿µ”
 
süt
.

7760 
func_v”bo£
 "creating $output"

7762 #QuÙ
the
 
»lšk
 
commªd
 
shpšg
.

7763 
‹¡
 -
n
 "$»lšk_commªd"; 
th’


7764 #P»£rv
ªy
 
v¬ŸbËs
 
th©
 
may
 
afãù
 
comp”
 
behaviÜ


7765 
v¬
 
š
 
$v¬ŸbËs_§ved_fÜ_»lšk
; do

7766 
ev®
 
‹¡
 -
z
 \"\${$var+set}\";hen

7767 
»lšk_commªd
="{est -z \"\${$var+set}\" || $lt_unset $var || { $var=;ƒxport $var; }; }; $relink_command"

7768 
–if
 
ev®
 
v¬_v®ue
=\
$$v¬
; 
‹¡
 -
z
 "$v¬_v®ue"; 
th’


7769 
»lšk_commªd
="$var=;ƒxport $var; $relink_command"

7771 
func_quÙe_fÜ_ev®
 "$var_value"

7772 
»lšk_commªd
="$var=$func_quote_for_eval_result;ƒxport $var; $relink_command"

7773 
fi


7774 
dÚe


7775 
»lšk_commªd
="(cd `pwd`; $relink_command)"

7776 
»lšk_commªd
=`
$ECHO
 "X$»lšk_commªd" | 
$X£d
 -
e
 "$sed_quote_subst"`

7777 
fi


7779 #QuÙ
$ECHO
 
shpšg
.

7780 
‹¡
 "X$ECHO" = "X$SHELL $´og·th --çÎback-echo"; 
th’


7781 
$´og·th
 
š


7782 [\\/]* | [
A
-
Za
-
z
]:[\\/]*è
qecho
="$SHELL $progpath --fallback-echo";;

7783 *è
qecho
="$SHELL `pwd`/$progpath --fallback-echo";;

7784 
e§c


7785 
qecho
=`
$ECHO
 "X$qecho" | 
$X£d
 -
e
 "$sed_quote_subst"`

7787 
qecho
=`
$ECHO
 "X$ECHO" | 
$X£d
 -
e
 "$sed_quote_subst"`

7788 
fi


7790 #OÆy 
aùu®ly
 dØ
thšgs
 
nÙ
 
š
 
dry
 
run
 
mode
.

7791 
$İt_dry_run
 || {

7792 #wš32 
wl
 
thšk
 
the
 
süt
 
is
 
a
 
bš¬y
 
™
 
has


7793 #¨.
exe
 
suffix
, 
so
 
we
 
¡r
 
™
 
off
 
h”e
.

7794 
$ouut
 
š


7795 *.
exe
è
func_¡rÇme
 '' '.exe' "$output"

7796 
ouut
=
$func_¡rÇme_»suÉ
 ;;

7797 
e§c


7798 #‹¡ 
cygwš
 
beÿu£
 
mv
 
çs
 
w
/
o
 .
exe
 
ex‹nsiÚs


7799 
$ho¡
 
š


7800 *
cygwš
*)

7801 
ex“xt
=.
exe


7802 
func_¡rÇme
 '' '.exe' "$outputname"

7803 
ouuŠame
=
$func_¡rÇme_»suÉ
 ;;

7804 *è
ex“xt
= ;;

7805 
e§c


7806 
$ho¡
 
š


7807 *
cygwš
* | *
mšgw
* )

7808 
func_dœÇme_ªd_ba£Çme
 "$output" "" "."

7809 
ouut_Çme
=
$func_ba£Çme_»suÉ


7810 
ouut_·th
=
$func_dœÇme_»suÉ


7811 
cw¿µ”sourû
="$output_path/$objdir/lt-$output_name.c"

7812 
cw¿µ”
="$output_path/$output_name.exe"

7813 
$RM
 
$cw¿µ”sourû
 
$cw¿µ”


7814 
Œ­
 "$RM $cwrappersource $cwrapper;ƒxit $EXIT_FAILURE" 1 2 15

7816 
func_em™_cw¿µ”exe_¤c
 > 
$cw¿µ”sourû


7818 #Th
w¿µ”
 
execubË
 
is
 
but
 
usšg
 
the
 
$ho¡
 
comp”
,

7819 #beÿu£ 
™
 
cÚšs
 
$ho¡
 
·ths
 
ªd
 
fes
. 
If
 
üoss
-

7820 #compšg, 
™
, 
like
 
the
 
rg‘
 
execubË
, 
mu¡
 
be


7821 #execu‹d 
Ú
 
the
 
$ho¡
 
Ü
 
und”
 
ª
 
emuÏtiÚ
 
’vœÚm’t
.

7822 
$İt_dry_run
 || {

7823 
$LTCC
 
$LTCFLAGS
 -
o
 
$cw¿µ”
 
$cw¿µ”sourû


7824 
$STRIP
 
$cw¿µ”


7827 #Now, 
ü—‹
 
the
 
w¿µ”
 
süt
 
func_sourû
 
u£
:

7828 
func_Éw¿µ”_süŠame
 
$cw¿µ”


7829 
$RM
 
$func_Éw¿µ”_süŠame_»suÉ


7830 
Œ­
 "$RM $func_ltwrapper_scriptname_result;ƒxit $EXIT_FAILURE" 1 2 15

7831 
$İt_dry_run
 || {

7832 #nÙe: 
this
 
süt
 
wl
 
nÙ
 
be
 
execu‹d
, 
so
 dØnÙ 
chmod
.

7833 
‹¡
 "x$bud" = "x$ho¡" ; 
th’


7834 
$cw¿µ”
 --
É
-
dump
-
süt
 > 
$func_Éw¿µ”_süŠame_»suÉ


7836 
func_em™_w¿µ”
 
no
 > 
$func_Éw¿µ”_süŠame_»suÉ


7837 
fi


7841 
$RM
 
$ouut


7842 
Œ­
 "$RM $output;ƒxit $EXIT_FAILURE" 1 2 15

7844 
func_em™_w¿µ”
 
no
 > 
$ouut


7845 
chmod
 +
x
 
$ouut


7847 
e§c


7849 
ex™
 
$EXIT_SUCCESS


7851 
e§c


7853 #S“ 
we
 
Ãed
 
to
 
bud
 
ª
 
Şd
-
çshiÚed
 
¬chive
.

7854 
Şdlib
 
š
 
$Şdlibs
; do

7856 
‹¡
 "$bud_libtoŞ_libs" = 
cÚv’›nû
; 
th’


7857 
Şdobjs
="$libobjs_save $symfileobj"

7858 
addlibs
="$convenience"

7859 
bud_libtoŞ_libs
=
no


7861 
‹¡
 "$bud_libtoŞ_libs" = 
moduË
; 
th’


7862 
Şdobjs
="$libobjs_save"

7863 
bud_libtoŞ_libs
=
no


7865 
Şdobjs
="$old_deplibs $non_pic_objects"

7866 
‹¡
 "$´–ßd" = 
yes
 &&e¡ -
f
 "$symfeobj"; 
th’


7867 
Şdobjs
="$oldobjs $symfileobj"

7868 
fi


7869 
fi


7870 
addlibs
="$old_convenience"

7871 
fi


7873 
‹¡
 -
n
 "$addlibs"; 
th’


7874 
g’tİ
="$output_objdir/${outputname}x"

7875 
g’”©ed
="$generated $gentop"

7877 
func_exŒaù_¬chives
 
$g’tİ
 
$addlibs


7878 
Şdobjs
="$oldobjs $func_extract_archives_result"

7879 
fi


7881 #DØ
—ch
 
commªd
 
š
 
the
 
¬chive
 
commªds
.

7882 
‹¡
 -
n
 "$Şd_¬chive_äom_Ãw_cmds" &&e¡ "$bud_libtoŞ_libs" = 
yes
; 
th’


7883 
cmds
=
$Şd_¬chive_äom_Ãw_cmds


7886 #Add 
ªy
 
objeùs
 
äom
 
´–ßded
 
cÚv’›nû
 
lib¿r›s


7887 
‹¡
 -
n
 "$dÍ»fes"; 
th’


7888 
g’tİ
="$output_objdir/${outputname}x"

7889 
g’”©ed
="$generated $gentop"

7891 
func_exŒaù_¬chives
 
$g’tİ
 
$dÍ»fes


7892 
Şdobjs
="$oldobjs $func_extract_archives_result"

7893 
fi


7895 #POSIX 
demªds
 
no
 
·ths
 
to
 
be
 
’coded
 
š
 
¬chives
. 
We
 
have


7896 #tØ
avoid
 
ü—tšg
 
¬chives
 
w™h
 
du¶iÿ‹
 
ba£Çmes
 
we


7897 #mighˆ
have
 
to
 
exŒaù
 
them
 
aá”w¬ds
, 
e
.
g
., 
wh’
 
ü—tšg
 
a


7898 #¡©iø
¬chive
 
out
 
of
 
a
 
cÚv’›nû
 
lib¿ry
, 
Ü
 
wh’
 
lškšg


7899 #th
’tœ‘y
 
of
 
a
 
libtoŞ
 
¬chive
 
što
 
	`ªÙh”
 (
cu¼’y


7900 #nÙ 
suµÜ‹d
 
by
 
libtoŞ
).

7901 ià(
obj
 
š
 
$Şdobjs


7903 
func_ba£Çme
 "$obj"

7904 
$ECHO
 "$func_basename_result"

7905 
dÚe
 | 
sÜt
 | sÜˆ-
uc
 >/
dev
/
nuÎ
 2>&1); 
th’


7908 
$ECHO
 "copying selected object fileso‡void basename conflicts..."

7909 
g’tİ
="$output_objdir/${outputname}x"

7910 
g’”©ed
="$generated $gentop"

7911 
func_mkdœ_p
 "$gentop"

7912 
§ve_Şdobjs
=
$Şdobjs


7913 
Şdobjs
=

7914 
couÁ”
=1

7915 
obj
 
š
 
$§ve_Şdobjs


7917 
func_ba£Çme
 "$obj"

7918 
objba£
="$func_basename_result"

7919 " $Şdobj " 
š


7920 " "è
Şdobjs
=
$obj
 ;;

7923 #Mak
su»
 
we
 
dÚ
't…ick‡n‡lternate‚amehat‡lso

7925 
Ãwobj
=
É$couÁ”
-
$objba£


7926 
func_¬™h
 
$couÁ”
 + 1

7927 
couÁ”
=
$func_¬™h_»suÉ


7928 " $Şdobj " 
š


7930 *è
‹¡
 ! -
f
 "$g’tİ/$Ãwobj"; 
th’
 ; 
fi
 ;;

7931 
e§c


7932 
dÚe


7933 
func_show_ev®
 "ln $obj $gentop/$newobj || cp $obj $gentop/$newobj"

7934 
Şdobjs
="$oldobjs $gentop/$newobj"

7936 *è
Şdobjs
="$oldobjs $obj" ;;

7937 
e§c


7938 
dÚe


7939 
fi


7940 
ev®
 
cmds
=\"$old_archive_cmds\"

7942 
func_Ën
 " $cmds"

7943 
Ën
=
$func_Ën_»suÉ


7944 
‹¡
 "$Ën" -
É
 "$max_cmd_Ën" ||e¡ "$max_cmd_Ën" -
Ë
 -1; 
th’


7945 
cmds
=
$Şd_¬chive_cmds


7947 #th
commªd
 
lše
 
is
 
too
 
to
 
lšk
 
š
 
Úe
 
¡•
,†šk iÀ
·¹s


7948 
func_v”bo£
 "using…iecewise‡rchive†inking..."

7949 
§ve_RANLIB
=
$RANLIB


7950 
RANLIB
=:

7951 
objli¡
=

7952 
cÚÿt_cmds
=

7953 
§ve_Şdobjs
=
$Şdobjs


7954 
Şdobjs
=

7955 #I 
th”e
 
a
 
b‘‹r
 
way
 
of
 
fšdšg
 
the
 
Ï¡
 
objeù
 
š
h
li¡
?

7956 
obj
 
š
 
$§ve_Şdobjs


7958 
Ï¡_Şdobj
=
$obj


7959 
dÚe


7960 
ev®
 
‹¡_cmds
=\"$old_archive_cmds\"

7961 
func_Ën
 " $test_cmds"

7962 
Ën0
=
$func_Ën_»suÉ


7963 
Ën
=
$Ën0


7964 
obj
 
š
 
$§ve_Şdobjs


7966 
func_Ën
 " $obj"

7967 
func_¬™h
 
$Ën
 + 
$func_Ën_»suÉ


7968 
Ën
=
$func_¬™h_»suÉ


7969 
func_­³nd
 
objli¡
 " $obj"

7970 
‹¡
 "$Ën" -
É
 "$max_cmd_Ën"; 
th’


7973 #th
above
 
commªd
 
should
 
be
 
u£d
 
befÜe
 
™
 
g‘s
 
too
 

7974 
Şdobjs
=
$objli¡


7975 
‹¡
 "$obj" = "$Ï¡_Şdobj" ; 
th’


7976 
RANLIB
=
$§ve_RANLIB


7977 
fi


7978 
‹¡
 -
z
 "$cÚÿt_cmds" || 
cÚÿt_cmds
=
$cÚÿt_cmds
~

7979 
ev®
 
cÚÿt_cmds
=\"\${concat_cmds}$old_archive_cmds\"

7980 
objli¡
=

7981 
Ën
=
$Ën0


7982 
fi


7983 
dÚe


7984 
RANLIB
=
$§ve_RANLIB


7985 
Şdobjs
=
$objli¡


7986 
‹¡
 "X$Şdobjs" = "X" ; 
th’


7987 
ev®
 
cmds
=\"\$concat_cmds\"

7989 
ev®
 
cmds
=\"\$concat_cmds~\$old_archive_cmds\"

7990 
fi


7991 
fi


7992 
fi


7993 
func_execu‹_cmds
 "$cmds" 'exit $?'

7994 
dÚe


7996 
‹¡
 -
n
 "$generated" && \

7997 
func_show_ev®
 "${RM}r$generated"

7999 #Now 
ü—‹
 
the
 
libtoŞ
 
¬chive
.

8000 
$ouut
 
š


8001 *.
Ï
)

8002 
Şd_lib¿ry
=

8003 
‹¡
 "$bud_Şd_libs" = 
yes
 && 
Şd_lib¿ry
="$libname.$libext"

8004 
func_v”bo£
 "creating $output"

8006 #P»£rv
ªy
 
v¬ŸbËs
 
th©
 
may
 
afãù
 
comp”
 
behaviÜ


8007 
v¬
 
š
 
$v¬ŸbËs_§ved_fÜ_»lšk
; do

8008 
ev®
 
‹¡
 -
z
 \"\${$var+set}\";hen

8009 
»lšk_commªd
="{est -z \"\${$var+set}\" || $lt_unset $var || { $var=;ƒxport $var; }; }; $relink_command"

8010 
–if
 
ev®
 
v¬_v®ue
=\
$$v¬
; 
‹¡
 -
z
 "$v¬_v®ue"; 
th’


8011 
»lšk_commªd
="$var=;ƒxport $var; $relink_command"

8013 
func_quÙe_fÜ_ev®
 "$var_value"

8014 
»lšk_commªd
="$var=$func_quote_for_eval_result;ƒxport $var; $relink_command"

8015 
fi


8016 
dÚe


8017 #QuÙ
the
 
lšk
 
commªd
 
shpšg
.

8018 
»lšk_commªd
="(cd `pwd`; $SHELL $progpath $preserve_args --mode=relink $libtool_args @inst_prefix_dir@)"

8019 
»lšk_commªd
=`
$ECHO
 "X$»lšk_commªd" | 
$X£d
 -
e
 "$sed_quote_subst"`

8020 
‹¡
 "$h¬dcode_autom©ic" = 
yes
 ; 
th’


8021 
»lšk_commªd
=

8022 
fi


8024 #OÆy 
ü—‹
 
the
 
ouut
 
nÙ
 
a
 
dry
 
run
.

8025 
$İt_dry_run
 || {

8026 
š¡®Ëd
 
š
 
no
 
yes
; do

8027 
‹¡
 "$š¡®Ëd" = 
yes
; 
th’


8028 
‹¡
 -
z
 "$š¡®l_libdœ"; 
th’


8030 
fi


8031 
ouut
="$ouut_objdœ/$ouuŠame"
i


8032 #R•Ïû 
®l
 
unš¡®Ëd
 
libtoŞ
 
lib¿r›s
 
w™h
 
the
 
š¡®Ëd
 
Úes


8033 
Ãwd•’d’cy_libs
=

8034 
d•lib
 
š
 
$d•’d’cy_libs
; do

8035 
$d•lib
 
š


8036 *.
Ï
)

8037 
func_ba£Çme
 "$deplib"

8038 
Çme
="$func_basename_result"

8039 
ev®
 
libdœ
=`
$
{
SED
} -
n
 -
e
 's/^libdœ=\(.*\)$/\1/p' 
$d•lib
`

8040 
‹¡
 -
z
 "$libdir" && \

8041 
func_çl_”rÜ
 "\`$deplib' is‚ot‡ valid†ibtool‡rchive"

8042 
Ãwd•’d’cy_libs
="$newdependency_libs $libdir/$name"

8044 *è
Ãwd•’d’cy_libs
="$newdependency_libs $deplib" ;;

8045 
e§c


8046 
dÚe


8047 
d•’d’cy_libs
="$newdependency_libs"

8048 
Ãwdlfes
=

8050 
lib
 
š
 
$dlfes
; do

8051 
$lib
 
š


8052 *.
Ï
)

8053 
func_ba£Çme
 "$lib"

8054 
Çme
="$func_basename_result"

8055 
ev®
 
libdœ
=`
$
{
SED
} -
n
 -
e
 's/^libdœ=\(.*\)$/\1/p' 
$lib
`

8056 
‹¡
 -
z
 "$libdir" && \

8057 
func_çl_”rÜ
 "\`$lib' is‚ot‡ valid†ibtool‡rchive"

8058 
Ãwdlfes
="$newdlfiles $libdir/$name"

8060 *è
Ãwdlfes
="$newdlfiles $lib" ;;

8061 
e§c


8062 
dÚe


8063 
dlfes
="$newdlfiles"

8064 
ÃwdÍ»fes
=

8065 
lib
 
š
 
$dÍ»fes
; do

8066 
$lib
 
š


8067 *.
Ï
)

8068 #OÆy 
·ss
 
´eİ’ed
 
fes
 
to
 
the
 
p£udo
-
	`¬chive
 (

8069 #ev’tu® 
lškšg
 
w™h
 
the
 
­p
. 
th©
 
lšks
 
™
è
we


8071 #th
lib¿ry
:

8072 
func_ba£Çme
 "$lib"

8073 
Çme
="$func_basename_result"

8074 
ev®
 
libdœ
=`
$
{
SED
} -
n
 -
e
 's/^libdœ=\(.*\)$/\1/p' 
$lib
`

8075 
‹¡
 -
z
 "$libdir" && \

8076 
func_çl_”rÜ
 "\`$lib' is‚ot‡ valid†ibtool‡rchive"

8077 
ÃwdÍ»fes
="$newdlprefiles $libdir/$name"

8079 
e§c


8080 
dÚe


8081 
dÍ»fes
="$newdlprefiles"

8083 
Ãwdlfes
=

8084 
lib
 
š
 
$dlfes
; do

8085 
$lib
 
š


8086 [\\/]* | [
A
-
Za
-
z
]:[\\/]*è
abs
="$lib" ;;

8087 *è
abs
=`
pwd
`"/$lib" ;;

8088 
e§c


8089 
Ãwdlfes
="$newdlfiles $abs"

8090 
dÚe


8091 
dlfes
="$newdlfiles"

8092 
ÃwdÍ»fes
=

8093 
lib
 
š
 
$dÍ»fes
; do

8094 
$lib
 
š


8095 [\\/]* | [
A
-
Za
-
z
]:[\\/]*è
abs
="$lib" ;;

8096 *è
abs
=`
pwd
`"/$lib" ;;

8097 
e§c


8098 
ÃwdÍ»fes
="$newdlprefiles $abs"

8099 
dÚe


8100 
dÍ»fes
="$newdlprefiles"

8101 
fi


8102 
$RM
 
$ouut


8103 #¶aû 
dÊame
 
š
 
cÜ»ù
 
pos™iÚ
 
cygwš


8104 
tdÊame
=
$dÊame


8105 
$ho¡
,
$ouut
,
$š¡®Ëd
,
$moduË
,
$dÊame
 
š


8106 *
cygwš
*,*
Ïi
,
yes
,
no
,*.
dÎ
 | *
mšgw
*,*Ïi,yes,no,*.dÎ | *
ûgcc
*,*Ïi,yes,no,*.dÎè
tdÊame
=../
bš
/
$dÊame
 ;;

8107 
e§c


8108 
$ECHO
 > 
$ouut
 "\
# $outputname -‡†ibtool†ibrary file

8110 #G’”©ed 
by
 
	`$PROGRAM
 (
GNU
 
$PACKAGE$TIMESTAMP
è
$VERSION


8111 #
#PËa£ 
DO
 
NOT
 
d–‘e
 
this
 
fe
!

8112 #Iˆ
is
 
Ãûs§ry
 
lškšg
 
the
 
lib¿ry
.

8114 #Th
Çme
 
th©
 
we
 
ÿn
 
	`dlİ’
(3).

8115 
dÊame
='$tdlname'

8117 #Name 
of
 
this
 
lib¿ry
.

8118 
lib¿ry_Çmes
='$library_names'

8120 #Th
Çme
 
of
 
the
 
¬chive
.

8121 
Şd_lib¿ry
='$old_library'

8123 #Lšk” 
æags
 
th©
 
ÿn
 
nÙ
 
go
 
š
 
d•’d’cy_libs
.

8124 
šh”™ed_lšk”_æags
='$new_inherited_linker_flags'

8126 #Lib¿r› 
th©
 
this
 
Úe
 
d•’ds
 
upÚ
.

8127 
d•’d’cy_libs
='$dependency_libs'

8129 #Name 
of
 
add™iÚ®
 
w—k
 
lib¿r›s
 
´ovided
 
by
 
this
 
lib¿ry


8130 
w—k_lib¿ry_Çmes
='$weak_libs'

8132 #V”siÚ 
šfÜm©iÚ
 
$libÇme
.

8133 
cu¼’t
=
$cu¼’t


8134 
age
=
$age


8135 
»visiÚ
=
$»visiÚ


8137 #I 
this
 
ª
 
®»ady
 
š¡®Ëd
 
lib¿ry
?

8138 
š¡®Ëd
=
$š¡®Ëd


8140 #Should 
we
 
w¬n
 
about
 
pÜb™y
 
wh’
 
lškšg
 
agaš¡
 -
moduËs
?

8141 
shouldnÙlšk
=
$moduË


8143 #Fe 
to
 
dlİ’
/
dÍ»İ’


8144 
dlİ’
='$dlfiles'

8145 
dÍ»İ’
='$dlprefiles'

8147 #DœeùÜy 
th©
 
this
 
lib¿ry
 
Ãeds
 
to
 
be
 
š¡®Ëd
 
š
:

8148 
libdœ
='$install_libdir'"

8149 
‹¡
 "$š¡®Ëd" = 
no
 &&e¡ "$Ãed_»lšk" = 
yes
; 
th’


8150 
$ECHO
 >> 
$ouut
 "\
_command=\"$relink_command\""

8152 
fi


8153 
dÚe


8156 #DØ
a
 
symbŞic
 
lšk
 
so
 
th©
 
the
 
libtoŞ
 
¬chive
 
ÿn
 
be
 
found
 
š


8157 #LD_LIBRARY_PATH 
befÜe
 
the
 
´og¿m
 
is
 
š¡®Ëd
.

8158 
func_show_ev®
 '( cd "$output_objdir" && $RM "$outputname" && $LN_S "../$outputname" "$outputname" )' 'exit $?'

8160 
e§c


8161 
ex™
 
$EXIT_SUCCESS


8164 { 
‹¡
 "$mode" = 
lšk
 ||e¡ "$mode" = 
»lšk
; } &&

8165 
func_mode_lšk
 
$
{1+"$@"}

8168 #func_mode_unš¡®È
¬g
...

8169 
	`func_mode_unš¡®l
 ()

8171 
$İt_debug


8172 
RM
="$nonopt"

8173 
fes
=

8174 
rmfÜû
=

8175 
ex™_¡©us
=0

8177 #Thi 
v¬ŸbË
 
‹Îs
 
w¿µ”
 
süts
 
ju¡
 
to
 
£t
 
v¬ŸbËs
 
¿th”


8178 #thª 
ruÂšg
 
theœ
 
´og¿ms
.

8179 
libtoŞ_š¡®l_magic
="$magic"

8181 
¬g


8183 
$¬g
 
š


8184 -
f
è
RM
="$RM $¬g"; 
rmfÜû
=
yes
 ;;

8185 -*è
RM
="$RM $arg" ;;

8186 *è
fes
="$files $arg" ;;

8187 
e§c


8188 
dÚe


8190 
‹¡
 -
z
 "$RM" && \

8191 
func_çl_h–p
 "you must specify‡n RM…rogram"

8193 
rmdœs
=

8195 
Üigobjdœ
="$objdir"

8196 
fe
 
š
 
$fes
; do

8197 
func_dœÇme
 "$file" "" "."

8198 
dœ
="$func_dirname_result"

8199 
‹¡
 "X$dœ" = 
X
.; 
th’


8200 
objdœ
="$origobjdir"

8202 
objdœ
="$dir/$origobjdir"

8203 
fi


8204 
func_ba£Çme
 "$file"

8205 
Çme
="$func_basename_result"

8206 
‹¡
 "$mode" = 
unš¡®l
 && 
objdœ
="$dir"

8208 #Rememb” 
objdœ
 
»mov®
 
Ï‹r
, 
bešg
 
ÿ»ful
 
to
 
avoid
 
du¶iÿ‹s


8209 
‹¡
 "$mode" = 
ş—n
; 
th’


8210 " $rmdœ " 
š


8212 *è
rmdœs
="$rmdirs $objdir" ;;

8213 
e§c


8214 
fi


8216 #DÚ'ˆ”rÜ iàthfdÛ¢'
t
 
exi¡
 
ªd
 
rm
 -
f
 
was
 
u£d
.

8217 { 
‹¡
 -
L
 "$fe"; } >/
dev
/
nuÎ
 2>&1 ||

8218 { 
‹¡
 -
h
 "$fe"; } >/
dev
/
nuÎ
 2>&1 ||

8219 
‹¡
 -
f
 "$fe"; 
th’


8221 
–if
 
‹¡
 -
d
 "$fe"; 
th’


8222 
ex™_¡©us
=1

8224 
–if
 
‹¡
 "$rmfÜû" = 
yes
; 
th’


8226 
fi


8228 
rmfes
="$file"

8230 
$Çme
 
š


8231 *.
Ï
)

8232 #Possibly 
a
 
libtoŞ
 
¬chive
, 
so
 
v”ify
 
™
.

8233 
func_Ïlib_p
 "$fe"; 
th’


8234 
func_sourû
 
$dœ
/
$Çme


8236 #D–‘
the
 
libtoŞ
 
lib¿r›s
 
ªd
 
symlšks
.

8237 
n
 
š
 
$lib¿ry_Çmes
; do

8238 
rmfes
="$rmfiles $objdir/$n"

8239 
dÚe


8240 
‹¡
 -
n
 "$Şd_lib¿ry" && 
rmfes
="$rmfiles $objdir/$old_library"

8242 "$mode" 
š


8243 
ş—n
)

8244 " $lib¿ry_Çme " 
š


8247 *è
rmfes
="$rmfiles $objdir/$dlname" ;;

8248 
e§c


8249 
‹¡
 -
n
 "$libdœ" && 
rmfes
="$rmfiles $objdir/$name $objdir/${name}i"

8251 
unš¡®l
)

8252 
‹¡
 -
n
 "$lib¿ry_Çmes"; 
th’


8253 #DØ
—ch
 
commªd
 
š
 
the
 
po¡unš¡®l
 
commªds
.

8254 
func_execu‹_cmds
 "$postuninstall_cmds" 'test "$rmforce" = yes ||ƒxit_status=1'

8255 
fi


8257 
‹¡
 -
n
 "$Şd_lib¿ry"; 
th’


8258 #DØ
—ch
 
commªd
 
š
 
the
 
Şd_po¡unš¡®l
 
commªds
.

8259 
func_execu‹_cmds
 "$old_postuninstall_cmds" 'test "$rmforce" = yes ||ƒxit_status=1'

8260 
fi


8261 #FIXME: 
should
 
»š¡®l
 
the
 
be¡
 
»maššg
 
sh¬ed
 
lib¿ry
.

8263 
e§c


8264 
fi


8267 *.
lo
)

8268 #Possibly 
a
 
libtoŞ
 
objeù
, 
so
 
v”ify
 
™
.

8269 
func_Ïlib_p
 "$fe"; 
th’


8271 #R—d 
the
 .
lo
 
fe


8272 
func_sourû
 
$dœ
/
$Çme


8274 #Add 
PIC
 
objeù
 
to
 
the
 
li¡
 
of
 
fes
Ø
»move
.

8275 
‹¡
 -
n
 "$pic_object" &&

8276 
‹¡
 "$pic_objeù" !ğ
nÚe
; 
th’


8277 
rmfes
="$rmfiles $dir/$pic_object"

8278 
fi


8280 #Add 
nÚ
-
PIC
 
objeù
 
to
 
the
 
li¡
 
of
 
fes
Ø
»move
.

8281 
‹¡
 -
n
 "$non_pic_object" &&

8282 
‹¡
 "$nÚ_pic_objeù" !ğ
nÚe
; 
th’


8283 
rmfes
="$rmfiles $dir/$non_pic_object"

8284 
fi


8285 
fi


8289 
‹¡
 "$mode" = 
ş—n
 ; 
th’


8290 
nÛx’ame
=
$Çme


8291 
$fe
 
š


8292 *.
exe
)

8293 
func_¡rÇme
 '' '.exe' "$file"

8294 
fe
=
$func_¡rÇme_»suÉ


8295 
func_¡rÇme
 '' '.exe' "$name"

8296 
nÛx’ame
=
$func_¡rÇme_»suÉ


8297 #$f
w™h
 .
exe
 
has
 
®»ady
 
b“n
 
added
 
to
 
rmfes
,

8298 #add 
$fe
 
w™hout
 .
exe


8299 
rmfes
="$rmfiles $file"

8301 
e§c


8302 #DØ
a
 
‹¡
 
to
 
£e
 
this
 
is
‡ 
libtoŞ
 
´og¿m
.

8303 
func_Éw¿µ”_p
 "$fe"; 
th’


8304 
func_Éw¿µ”_execubË_p
 "$fe"; 
th’


8305 
func_Éw¿µ”_süŠame
 "$file"

8306 
»lšk_commªd
=

8307 
func_sourû
 
$func_Éw¿µ”_süŠame_»suÉ


8308 
rmfes
="$rmfiles $func_ltwrapper_scriptname_result"

8310 
»lšk_commªd
=

8311 
func_sourû
 
$dœ
/
$nÛx’ame


8312 
fi


8314 #nÙ
$Çme
 
¡l
 
cÚšs
 .
exe
 
™
 
was
 
š
 
$fe
 
Üigš®ly


8315 #a 
dÛs
 
the
 
v”siÚ
 
of
 
$fe
 
th©
 
was
 
added
 
što
 
$rmfes


8316 
rmfes
="$rmfiles $objdir/$name $objdir/${name}S.${objext}"

8317 
‹¡
 "$ç¡_š¡®l" = 
yes
 &&e¡ -
n
 "$»lšk_commªd"; 
th’


8318 
rmfes
="$rmfiles $objdir/lt-$name"

8319 
fi


8320 
‹¡
 "X$nÛx’ame" !ğ"X$Çme" ; 
th’


8321 
rmfes
="$rmfiles $objdir/lt-${noexename}.c"

8322 
fi


8323 
fi


8324 
fi


8326 
e§c


8327 
func_show_ev®
 "$RM $rmfiles" 'exit_status=1'

8328 
dÚe


8329 
objdœ
="$origobjdir"

8331 #Try 
to
 
»move
 
the
 
$
{
objdœ
}
s
 
š
h
dœeùÜ›s
 
wh”e
 
we
 
d–‘ed
 
fes


8332 
dœ
 
š
 
$rmdœs
; do

8333 
‹¡
 -
d
 "$dœ"; 
th’


8334 
func_show_ev®
 "rmdir $dir >/dev/null 2>&1"

8335 
fi


8336 
dÚe


8338 
ex™
 
$ex™_¡©us


8341 { 
‹¡
 "$mode" = 
unš¡®l
 ||e¡ "$mode" = 
ş—n
; } &&

8342 
func_mode_unš¡®l
 
$
{1+"$@"}

8344 
‹¡
 -
z
 "$mode" && {

8345 
h–p
="$generic_help"

8346 
func_çl_h–p
 "you must specify‡ MODE"

8349 
‹¡
 -
z
 "$exec_cmd" && \

8350 
func_çl_h–p
 "invalid operation mode \`$mode'"

8352 
‹¡
 -
n
 "$exec_cmd"; 
th’


8353 
ev®
 
exec
 "$exec_cmd"

8354 
ex™
 
$EXIT_FAILURE


8355 
fi


8357 
ex™
 
$ex™_¡©us


8360 #Th
TAGs
 
b–ow
 
¬e
 
defšed
 
such
 
th©
 
we
 
Ãv”
 
g‘
 
što
 
a
 
s™u©iÚ


8361 #š 
which
 
we
 
di§bË
 
bÙh
 
kšds
 
of
 
lib¿r›s
. 
Giv’
 
cÚæiùšg


8362 #choiûs, 
we
 
go
 
a
 
lib¿ry
, 
th©
 
is
 
the
 
mo¡
 
pÜbË
,

8363 #sšû 
we
 
ÿn
'tell whether shared†ibraries were disabled because

8364 #th
u£r
 
asked
 
th©
 
Ü
 
beÿu£
 
the
 
¶©fÜm
 
dÛ¢
't support

8365 #them. 
This
 
is
 
·¹icuÏ¾y
 
impÜÁ
 
Ú
 
AIX
, 
beÿu£
 
we
 
dÚ
't

8366 #suµÜˆ
havšg
 
bÙh
 
ªd
 
sh¬ed
 
lib¿r›s
 
’abËd
 
©
 
the
 
§me


8367 #tim
Ú
 
th©
 
¶©fÜm
, 
so
 
we
  
to
 
a
 
sh¬ed
-
Úly
 
cÚfigu¿tiÚ
.

8368 #Ià
a
 
di§bË
-
sh¬ed
 
g
 
is
 
giv’
, 
we
'll fallbacko‡ static-only

8369 #cÚfigu¿tiÚ. 
But
 
we
'll‚ever go from static-onlyo shared-only.

8371 #### 
BEGIN
 
LIBTOOL
 
TAG
 
CONFIG
: 
di§bË
-
sh¬ed


8372 
bud_libtoŞ_libs
=
no


8373 
bud_Şd_libs
=
yes


8374 #### 
END
 
LIBTOOL
 
TAG
 
CONFIG
: 
di§bË
-
sh¬ed


8376 #### 
BEGIN
 
LIBTOOL
 
TAG
 
CONFIG
: 
di§bË
-

8377 
bud_Şd_libs
=`
$bud_libtoŞ_libs
 
š
 
yes
è
echo
 
no
;; *èechØyes;; 
e§c
`

8378 #### 
END
 
LIBTOOL
 
TAG
 
CONFIG
: 
di§bË
-

8380 #LoÿÈ
V¬ŸbËs
:

8381 #mode:
sh–l
-
süt


8382 #sh-
šd’tiÚ
:2

8384 #vi:
sw
=2

	@trunk/objs/gtest-1.6.0/scripts/fuse_gtest_files.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


2 #
#Cİyrighˆ2009, 
GoogË
 
Inc
.

3 #AÎ 
rights
 
»£rved
.

4 #
#Redi¡ributiÚ 
ªd
 
u£
 
š
 
sourû
‡nd 
bš¬y
 
fÜms
, 
w™h
 
Ü
 
w™hout


5 #modifiÿtiÚ, 
¬e
 
³rm™‹d
 
´ovided
 
th©
 
the
 
fŞlowšg
 
cÚd™iÚs
‡re

7 #
#* 
Redi¡ributiÚs
 
of
 
sourû
 
code
 
mu¡
 
»š
 
the
 
above
 
cİyright


8 #nÙiû, 
this
 
li¡
 
of
 
cÚd™iÚs
 
ªd
 
the
 
fŞlowšg
 
disşaim”
.

9 #* 
Redi¡ributiÚs
 
š
 
bš¬y
 
fÜm
 
mu¡
 
»´oduû
 
the
 
above


10 #cİyrighˆ
nÙiû
, 
this
 
li¡
 
of
 
cÚd™iÚs
 
ªd
 
the
 
fŞlowšg
 
disşaim”


11 #š 
the
 
docum’tiÚ
 
ªd
/
Ü
 
Ùh”
 
m©”Ÿls
 
´ovided
 
w™h
he

13 #* 
Ne™h”
 
the
 
Çme
 
of
 
GoogË
 
Inc
. 
nÜ
h
Çmes
 oà
™s


14 #cÚŒibutÜ 
may
 
be
 
u£d
 
to
 
’dÜ£
 
Ü
 
´omÙe
 
´oduùs
 
d”ived
 
äom


15 #thi 
soáw¬e
 
w™hout
 
¥ecific
 
´iÜ
 
wr™‹n
 
³rmissiÚ
.

16 #
#THIS 
SOFTWARE
 
IS
 
PROVIDED
 
BY
 
THE
 
COPYRIGHT
 
HOLDERS
 
AND
 
CONTRIBUTORS


17 #"
AS
 
IS
" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT

18 #LIMITED 
TO
, 
THE
 
IMPLIED
 
WARRANTIES
 
OF
 
MERCHANTABILITY
 
AND
 
FITNESS
 
FOR


19 #A 
PARTICULAR
 
PURPOSE
 
ARE
 
DISCLAIMED
. 
IN
 
NO
 
EVENT
 
SHALL
 
THE
 
COPYRIGHT


20 #OWNER 
OR
 
CONTRIBUTORS
 
BE
 
LIABLE
 
FOR
 
ANY
 
DIRECT
, 
INDIRECT
, 
INCIDENTAL
,

21 #SPECIAL, 
EXEMPLARY
, 
OR
 
CONSEQUENTIAL
 
DAMAGES
 (
INCLUDING
, 
BUT
 
NOT


22 #LIMITED 
TO
, 
PROCUREMENT
 
OF
 
SUBSTITUTE
 
GOODS
 
OR
 
SERVICES
; 
LOSS
 OF 
USE
,

23 #DATA, 
OR
 
PROFITS
; OR 
BUSINESS
 
INTERRUPTION
è
HOWEVER
 
CAUSED
 
AND
 
ON
 
ANY


24 #THEORY 
OF
 
LIABILITY
, 
WHETHER
 
IN
 
CONTRACT
, 
STRICT
 LIABILITY, 
OR
 
TORT


25 #(
INCLUDING
 
NEGLIGENCE
 
OR
 
OTHERWISE
è
ARISING
 
IN
 
ANY
 
WAY
 
OUT
 
OF
 
THE
 
USE


26 #OF 
THIS
 
SOFTWARE
, 
EVEN
 
IF
 
ADVISED
 
OF
 
THE
 
POSSIBILITY
 OF 
SUCH
 
DAMAGE
.

29 
Fu£s
 
GoogË
 
Te¡
 
sourû
 
code
 
što
 
	ga
 .
h
 
fe
 
ªd
‡ .
cc
 
	gfe
.

31 
SYNOPSIS


32 
	gfu£_g‹¡_fes
.
	gpy
 [
GTEST_ROOT_DIR
] 
OUTPUT_DIR


34 
Sÿns
 
GTEST_ROOT_DIR
 
GoogË
 
Te¡
 
sourû
 
	gcode
, 
ªd
 
g’”©es


35 
two
 
	gfes
: 
OUTPUT_DIR
/
g‹¡
/g‹¡.
h
 
ªd
 OUTPUT_DIR/g‹¡/g‹¡-
®l
.
cc
.

36 
Th’
 
you
 
ÿn
 
bud
 
your
 
‹¡s
 
by
 
addšg
 
OUTPUT_DIR
 
to
 
the
 
šşude


37 
£¬ch
 
·th
 
ªd
 
lškšg
 
w™h
 
OUTPUT_DIR
/
g‹¡
/g‹¡-
®l
.
cc
. 
The£


38 
two
 
fes
 
cÚš
 
ev”ythšg
 
you
 
Ãed
 
to
 
u£
 
GoogË
 
Te¡
. 
H’û


39 
you
 
ÿn
 "š¡®l" 
GoogË
 
Te¡
 
by
 
cİyšg
 
them
 
to
 
wh”ev”
 you 
wªt
.

41 
GTEST_ROOT_DIR
 
ÿn
 
be
 
om™‹d
 
ªd
 
deçuÉs
 
to
 
the
 
·»Á


42 
dœeùÜy
 
of
 
the
 dœeùÜy 
hŞdšg
 
this
 
süt
.

44 
EXAMPLES


45 ./
fu£_g‹¡_fes
.
py
 
fu£d_g‹¡


46 ./
fu£_g‹¡_fes
.
py
 
·th
/
to
/
uÅacked
/
g‹¡
 
fu£d_g‹¡


48 
This
 
toŞ
 
is
 
ex³rim’l
. 
In
 
·¹icuÏr
, 
™
 
assumes
 
th©
 
th”e
 i 
no


49 
cÚd™iÚ®
 
šşusiÚ
 
of
 
GoogË
 
Te¡
 
	gh—d”s
. 
PËa£
 
»pÜt
 
ªy


50 
´obËms
 
to
 
	ggoogË‹¡äamewÜk
@
	ggoogËgroups
.
	gcom
. 
You
 
ÿn
 
»ad


51 
	gh‰p
:

52 
mÜe
 
šfÜm©iÚ
.

55 
__authÜ__
 = 'wan@google.com (Zhanyong Wan)'

57 
impÜt
 
os


58 
impÜt
 
»


59 
impÜt
 
£ts


60 
impÜt
 
sys


62 #W
assume
 
th©
 
this
 
fe
 
is
 
š
 
the
 
süts
/ 
dœeùÜy
 iÀth
GoogË


63 #Te¡ 
roÙ
 
dœeùÜy
.

64 
DEFAULT_GTEST_ROOT_DIR
 = 
os
.
·th
.
još
(os.·th.
dœÇme
(
__fe__
), '..')

66 #Regex 
m©chšg
 '#include "gtest/..."'.

67 
	gINCLUDE_GTEST_FILE_REGEX
 = 
»
.
compe
(
r
'^\s*#\s*include\s*"(gtest/.+)"')

69 #Regex 
m©chšg
 '#include "src/..."'.

70 
INCLUDE_SRC_FILE_REGEX
 = 
»
.
compe
(
r
'^\s*#\s*include\s*"(src/.+)"')

72 #Wh”
to
 
fšd
 
the
 
sourû
 
£ed
 
fes
.

73 
GTEST_H_SEED
 = 'include/gtest/gtest.h'

74 
GTEST_SPI_H_SEED
 = 'include/gtest/gtest-spi.h'

75 
GTEST_ALL_CC_SEED
 = 'src/gtest-all.cc'

77 #Wh”
to
 
put
 
the
 
g’”©ed
 
fes
.

78 
GTEST_H_OUTPUT
 = 'gtest/gtest.h'

79 
GTEST_ALL_CC_OUTPUT
 = 'gtest/gtest-all.cc'

82 
def
 
	$V”ifyFeExi¡s
(
dœeùÜy
, 
»Ïtive_·th
):

85 
»Ïtive_·th
 
is
 
the
 
fe
 
·th
 
»Ïtive
 
to
h
giv’
 
dœeùÜy
.

88 
nÙ
 
os
.
·th
.
	`isfe
(os.·th.
	$još
(
dœeùÜy
, 
»Ïtive_·th
)):

89 
´št
 'ERROR: CªnÙ fšd % š dœeùÜy %s.' % (
»Ïtive_·th
,

90 
dœeùÜy
)

91 
	`´št
 ('Pleaseƒither specify‡ valid…roject„oot directory '

93 
sys
.
	$ex™
(1)

96 
def
 
	$V®id©eGTe¡RoÙDœ
(
g‹¡_roÙ
):

99 
The
 
funùiÚ
 
abÜts
 
the
 
´og¿m
 
Ú
 
çu»
.

102 
	$V”ifyFeExi¡s
(
g‹¡_roÙ
, 
GTEST_H_SEED
)

103 
	$V”ifyFeExi¡s
(
g‹¡_roÙ
, 
GTEST_ALL_CC_SEED
)

106 
def
 
	$V”ifyOuutFe
(
ouut_dœ
, 
»Ïtive_·th
):

109 
»Ïtive_·th
 
is
 
»Ïtive
 
to
 
the
 
ouut_dœ
 
dœeùÜy
.

112 #Make 
su»
 
the
 
ouut
 
fe
 
e™h”
 
dÛ¢
'tƒxist or can be overwritten.

113 
ouut_fe
 = 
os
.
·th
.
	$još
(
ouut_dœ
, 
»Ïtive_·th
)

114 
os
.
·th
.
	$exi¡s
(
ouut_fe
):

115 #TODO(
wª
@
googË
.
com
): 
The
 
fŞlowšg
 
u£r
-
š‹¿ùiÚ
 
dÛ¢
't

116 #wÜk 
w™h
 
autom©ed
 
´oûs£s
. 
We
 
should
 
´ovide
 
a
 
way
 
the


117 #Makef
to
 
fÜû
 
ov”wr™šg
 
the
 
fes
.

118 
	`´št
 ('%s‡lreadyƒxists in directory %s - overwrite it? (y/N) ' %

119 (
»Ïtive_·th
, 
ouut_dœ
))

120 
ªsw”
 = 
sys
.
¡dš
.
	`»adlše
().
	$¡r
()

121 
ªsw”
 
nÙ
 
š
 ['y', 'Y']:

122 
´št
 'ABORTED.'

123 
sys
.
	$ex™
(1)

125 #Make 
su»
 
the
 
dœeùÜy
 
hŞdšg
h
ouut
 
fe
 
exi¡s
; 
ü—‹s


126 #™ 
ªd
 
®l
 
™s
 
ªû¡Üs
 
Ãûs§ry
.

127 
·»Á_dœeùÜy
 = 
os
.
·th
.
	$dœÇme
(
ouut_fe
)

128 
nÙ
 
os
.
·th
.
	$isdœ
(
·»Á_dœeùÜy
):

129 
os
.
	$makedœs
(
·»Á_dœeùÜy
)

132 
def
 
	$V®id©eOuutDœ
(
ouut_dœ
):

135 
The
 
funùiÚ
 
abÜts
 
the
 
´og¿m
 
Ú
 
çu»
.

138 
	$V”ifyOuutFe
(
ouut_dœ
, 
GTEST_H_OUTPUT
)

139 
	$V”ifyOuutFe
(
ouut_dœ
, 
GTEST_ALL_CC_OUTPUT
)

142 
def
 
	$Fu£GTe¡H
(
g‹¡_roÙ
, 
ouut_dœ
):

145 
ouut_fe
 = 
	`fe
(
os
.
·th
.
	`još
(
ouut_dœ
, 
GTEST_H_OUTPUT
), 'w')

146 
´oûs£d_fes
 = 
£ts
.
	$S‘
(è#HŞd 
®l
 
g‹¡
 
h—d”s
 
we
've…rocessed.

148 
def
 
	$ProûssFe
(
g‹¡_h—d”_·th
):

151 #W
dÚ
't…rocesshe same headerwice.

152 
g‹¡_h—d”_·th
 
š
 
´oûs£d_fes
:

155 
´oûs£d_fes
.
	$add
(
g‹¡_h—d”_·th
)

157 #R—d 
—ch
 
lše
 
š
 
the
 
giv’
 
g‹¡
 
h—d”
.

158 
lše
 
š
 
	`fe
(
os
.
·th
.
	`još
(
g‹¡_roÙ
, 
g‹¡_h—d”_·th
), 'r'):

159 
m
 = 
INCLUDE_GTEST_FILE_REGEX
.
	$m©ch
(
lše
)

160 
m
:

161 ' '#šşud
	~"g‹¡/...
"' -†‘'
s
 
´oûss
 
™
 
»cursiv–y
.

162 
	`ProûssFe
('šşude/' + 
m
.
	$group
(1))

164 #Oth”wi£ 
we
 
cİy
 
the
 
lše
 
unchªged
 
to
h
ouut
 
fe
.

165 
ouut_fe
.
	$wr™e
(
lše
)

167 
	$ProûssFe
(
GTEST_H_SEED
)

168 
ouut_fe
.
	$şo£
()

171 
def
 
	$Fu£GTe¡AÎCcToFe
(
g‹¡_roÙ
, 
ouut_fe
):

174 
´oûs£d_fes
 = 
£ts
.
	$S‘
()

176 
def
 
	$ProûssFe
(
g‹¡_sourû_fe
):

179 #W
dÚ
't…rocesshe same #included filewice.

180 
g‹¡_sourû_fe
 
š
 
´oûs£d_fes
:

183 
´oûs£d_fes
.
	$add
(
g‹¡_sourû_fe
)

185 #R—d 
—ch
 
lše
 
š
 
the
 
giv’
 
g‹¡
 
sourû
 
fe
.

186 
lše
 
š
 
	`fe
(
os
.
·th
.
	`još
(
g‹¡_roÙ
, 
g‹¡_sourû_fe
), 'r'):

187 
m
 = 
INCLUDE_GTEST_FILE_REGEX
.
	$m©ch
(
lše
)

188 
m
:

189 'šşude/' + 
m
.
	`group
(1è=ğ
GTEST_SPI_H_SEED
:

190 ' '#šşud
	~"g‹¡/g‹¡-¥i.h
"'. This file is‚ot

191 ##
šşuded
 
by
 "g‹¡/g‹¡.h", 
so
 
we
 
Ãed
 
to
 
´oûss
 
™
.

192 
	$ProûssFe
(
GTEST_SPI_H_SEED
)

194 ' '#šşud
	~"g‹¡/foo.h
"' where foo is‚ot gtest-spi.

195 #W
Œ—t
 
™
 
as
 '#šşud"g‹¡/g‹¡.h"',‡ 
®l
 
Ùh”


196 #g‹¡ 
h—d”s
 
¬e
 
bešg
 
fu£d
 
što
 
g‹¡
.
h
 
ªd
 
ÿÂÙ
 
be


197 ##
šşuded
 
dœeùly
.

199 
is
 
no
 
Ãed
 
to
 #šşud
	~"g‹¡/g‹¡.h
" 
mÜe
 
thª
 
Úû
.

200 
nÙ
 
GTEST_H_SEED
 
š
 
´oûs£d_fes
:

201 
´oûs£d_fes
.
	$add
(
GTEST_H_SEED
)

202 
ouut_fe
.
	`wr™e
('#šşud"%s"\n' % (
GTEST_H_OUTPUT
,))

204 
m
 = 
INCLUDE_SRC_FILE_REGEX
.
	$m©ch
(
lše
)

205 
m
:

206 ' '#šşud
	~"¤c/foo
"' -†‘'
s
 
´oûss
 
™
 
»cursiv–y
.

207 
	`ProûssFe
(
m
.
	$group
(1))

209 
ouut_fe
.
	$wr™e
(
lše
)

211 
	$ProûssFe
(
GTEST_ALL_CC_SEED
)

214 
def
 
	$Fu£GTe¡AÎCc
(
g‹¡_roÙ
, 
ouut_dœ
):

217 
ouut_fe
 = 
	`fe
(
os
.
·th
.
	`još
(
ouut_dœ
, 
GTEST_ALL_CC_OUTPUT
), 'w')

218 
	$Fu£GTe¡AÎCcToFe
(
g‹¡_roÙ
, 
ouut_fe
)

219 
ouut_fe
.
	$şo£
()

222 
def
 
	$Fu£GTe¡
(
g‹¡_roÙ
, 
ouut_dœ
):

225 
	$V®id©eGTe¡RoÙDœ
(
g‹¡_roÙ
)

226 
	$V®id©eOuutDœ
(
ouut_dœ
)

228 
	$Fu£GTe¡H
(
g‹¡_roÙ
, 
ouut_dœ
)

229 
	$Fu£GTe¡AÎCc
(
g‹¡_roÙ
, 
ouut_dœ
)

232 
def
 
	$maš
():

233 
¬gc
 = 
	$Ën
(
sys
.
¬gv
)

234 
¬gc
 == 2:

235 #fu£_g‹¡_fes.
py
 
OUTPUT_DIR


236 
	$Fu£GTe¡
(
DEFAULT_GTEST_ROOT_DIR
, 
sys
.
¬gv
[1])

237 
–if
 
¬gc
 == 3:

238 #fu£_g‹¡_fes.
py
 
GTEST_ROOT_DIR
 
OUTPUT_DIR


239 
	$Fu£GTe¡
(
sys
.
¬gv
[1], sys.argv[2])

241 
´št
 
__doc__


242 
sys
.
	$ex™
(1)

245 
__Çme__
 == '__main__':

246 
	`maš
()

	@trunk/objs/gtest-1.6.0/scripts/gen_gtest_pred_impl.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


2 #
#Cİyrighˆ2006, 
GoogË
 
Inc
.

3 #AÎ 
rights
 
»£rved
.

4 #
#Redi¡ributiÚ 
ªd
 
u£
 
š
 
sourû
‡nd 
bš¬y
 
fÜms
, 
w™h
 
Ü
 
w™hout


5 #modifiÿtiÚ, 
¬e
 
³rm™‹d
 
´ovided
 
th©
 
the
 
fŞlowšg
 
cÚd™iÚs
‡re

7 #
#* 
Redi¡ributiÚs
 
of
 
sourû
 
code
 
mu¡
 
»š
 
the
 
above
 
cİyright


8 #nÙiû, 
this
 
li¡
 
of
 
cÚd™iÚs
 
ªd
 
the
 
fŞlowšg
 
disşaim”
.

9 #* 
Redi¡ributiÚs
 
š
 
bš¬y
 
fÜm
 
mu¡
 
»´oduû
 
the
 
above


10 #cİyrighˆ
nÙiû
, 
this
 
li¡
 
of
 
cÚd™iÚs
 
ªd
 
the
 
fŞlowšg
 
disşaim”


11 #š 
the
 
docum’tiÚ
 
ªd
/
Ü
 
Ùh”
 
m©”Ÿls
 
´ovided
 
w™h
he

13 #* 
Ne™h”
 
the
 
Çme
 
of
 
GoogË
 
Inc
. 
nÜ
h
Çmes
 oà
™s


14 #cÚŒibutÜ 
may
 
be
 
u£d
 
to
 
’dÜ£
 
Ü
 
´omÙe
 
´oduùs
 
d”ived
 
äom


15 #thi 
soáw¬e
 
w™hout
 
¥ecific
 
´iÜ
 
wr™‹n
 
³rmissiÚ
.

16 #
#THIS 
SOFTWARE
 
IS
 
PROVIDED
 
BY
 
THE
 
COPYRIGHT
 
HOLDERS
 
AND
 
CONTRIBUTORS


17 #"
AS
 
IS
" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT

18 #LIMITED 
TO
, 
THE
 
IMPLIED
 
WARRANTIES
 
OF
 
MERCHANTABILITY
 
AND
 
FITNESS
 
FOR


19 #A 
PARTICULAR
 
PURPOSE
 
ARE
 
DISCLAIMED
. 
IN
 
NO
 
EVENT
 
SHALL
 
THE
 
COPYRIGHT


20 #OWNER 
OR
 
CONTRIBUTORS
 
BE
 
LIABLE
 
FOR
 
ANY
 
DIRECT
, 
INDIRECT
, 
INCIDENTAL
,

21 #SPECIAL, 
EXEMPLARY
, 
OR
 
CONSEQUENTIAL
 
DAMAGES
 (
INCLUDING
, 
BUT
 
NOT


22 #LIMITED 
TO
, 
PROCUREMENT
 
OF
 
SUBSTITUTE
 
GOODS
 
OR
 
SERVICES
; 
LOSS
 OF 
USE
,

23 #DATA, 
OR
 
PROFITS
; OR 
BUSINESS
 
INTERRUPTION
è
HOWEVER
 
CAUSED
 
AND
 
ON
 
ANY


24 #THEORY 
OF
 
LIABILITY
, 
WHETHER
 
IN
 
CONTRACT
, 
STRICT
 LIABILITY, 
OR
 
TORT


25 #(
INCLUDING
 
NEGLIGENCE
 
OR
 
OTHERWISE
è
ARISING
 
IN
 
ANY
 
WAY
 
OUT
 
OF
 
THE
 
USE


26 #OF 
THIS
 
SOFTWARE
, 
EVEN
 
IF
 
ADVISED
 
OF
 
THE
 
POSSIBILITY
 OF 
SUCH
 
DAMAGE
.

30 
G’”©es
 
the
 
im¶em’tiÚ
 
of
 
GoogË
 
Te¡
 
´ediÿ‹
 
as£¹iÚs
 
ªd


31 
accom·nyšg
 
	g‹¡s
.

33 
	gU§ge
:

35 
g’_g‹¡_´ed_im¶
.
py
 
MAX_ARITY


37 
wh”e
 
MAX_ARITY
 
is
 
a
 
pos™ive
 
š‹g”
.

39 
The
 
commªd
 
g’”©es
 
the
 
im¶em’tiÚ
 
of
 
up
-
to
 
MAX_ARITY
-
¬y


40 
´ediÿ‹
 
as£¹iÚs
, 
ªd
 
wr™es
 
™
 
to
 
fe
 
	gg‹¡_´ed_im¶
.
h
 
š
 
the


41 
dœeùÜy
 
wh”e
 
the
 
süt
 
	gis
. 
It
 
®so
 
g’”©es
h
accom·nyšg


42 
un™
 
‹¡
 
š
 
fe
 
	gg‹¡_´ed_im¶_un™‹¡
.
	gcc
.

45 
	g__authÜ__
 = 'wan@google.com (Zhanyong Wan)'

47 
impÜt
 
os


48 
impÜt
 
sys


49 
impÜt
 
time


51 #Wh”
this
 
süt
 
is
.

52 
SCRIPT_DIR
 = 
os
.
·th
.
	$dœÇme
(
sys
.
¬gv
[0])

54 #Wh”
to
 
¡Üe
 
the
 
g’”©ed
 
h—d”
.

55 
HEADER
 = 
os
.
·th
.
	`još
(
SCRIPT_DIR
, '../include/gtest/gtest_pred_impl.h')

57 #Wh”
to
 
¡Üe
 
the
 
g’”©ed
 
un™
 
‹¡
.

58 
UNIT_TEST
 = 
os
.
·th
.
	`još
(
SCRIPT_DIR
, '../test/gtest_pred_impl_unittest.cc')

61 
def
 
	$H—d”P»ambË
(
n
):

64 
Args
:

65 
n
: 
the
 
maximum
 
¬™y
 
of
h
´ediÿ‹
 
maüos
 
to
 
be
 
g’”©ed
.

68 #A 
m­
 
th©
 
defšes
 
the
 
v®ues
 
u£d
 
š
h
´—mbË
 
‹m¶©e
.

69 
DEFS
 = {

70 'today' : 
time
.
	`¡ráime
('%m/%d/%Y'),

71 'y—r' : 
time
.
	`¡ráime
('%Y'),

72 'commªd' : '% %s' % (
os
.
·th
.
	`ba£Çme
(
sys
.
¬gv
[0]), 
n
),

73 'n' : 
n


74 
	}
}

111 #iâdeà
GTEST_INCLUDE_GTEST_GTEST_PRED_IMPL_H_


112 
	#GTEST_INCLUDE_GTEST_GTEST_PRED_IMPL_H_


	)

115 #iâdeà
GTEST_INCLUDE_GTEST_GTEST_H_


116 #”rÜ 
Do
 
nÙ
 
šşude
 
g‹¡_´ed_im¶
.
h
 
dœeùly
. 
Inşude
 
g‹¡
.h 
š¡—d
.

151 
	#GTEST_ASSERT_
(
ex´essiÚ
, 
Ú_çu»
) \\

152 
GTEST_AMBIGUOUS_ELSE_BLOCKER_
 \\

153 ià(cÚ¡ ::
‹¡šg
::
As£¹iÚResuÉ
 
g‹¡_¬
 = (
ex´essiÚ
)) \\

156 
	`Ú_çu»
(
g‹¡_¬
.
	`çu»_mes§ge
())

	)

160 
def
 
	$Ar™y
(
n
):

163 
n
 < 0:

164  
NÚe


165 
–if
 
n
 <= 3:

166  ['nuÎ¬y', 'uÇry', 'bš¬y', '‹º¬y'][
n
]

168  '%s-¬y' % 
n


171 
def
 
	$T™Ë
(
wÜd
):

173 
this
 
ªd
 
¡ršg
' t™Ë(èm‘hod i th© T™Ë('4-
¬y
') is '4-ary'

174 '4-¬y'.
	$t™Ë
(è
is
 '4-Ary'."""

176  
wÜd
[0].
	`uµ”
() + word[1:]

179 
def
 
	$OÃTo
(
n
):

182  
	`¿nge
(1, 
n
 + 1)

185 
def
 
	`I‹r
(
n
, 
fÜm©
, 
£p
=''):

187 
mÜe
 '%s' 
fÜm©
 
¥ecs
, 
ªd
 
İtiÚ®ly
 
a
 
£·¿tÜ
 
¡ršg
, 
»tuºs


188 
the
 
još
 
of
 
n
 
¡ršgs
, 
—ch
 
fÜm©‹d
 
w™h
h
fÜm©
 
¡ršg
 
Ú
 
ª


189 
™”©Ü
 
¿nged
 
äom
 1 
to
 
n
.

191 
Exam¶e
:

193 
	`I‹r
(3, 'v%s', 
£p
=', 'è
»tuºs
 'v1, v2, v3'.

196 #How 
mªy
 '%s' 
¥ecs
 
¬e
 
š
 
fÜm©
?

197 
¥ec_couÁ
 = 
	`Ën
(
fÜm©
.
	`¥l™
('%s')) - 1

198  
£p
.
	`još
([
fÜm©
 % (
¥ec_couÁ
 * (
i
,)è˜
š
 
	`OÃTo
(
n
)])

201 
def
 
	$Im¶em’tiÚFÜAr™y
(
n
):

204 #A 
m­
 
the
 
defšes
h
v®ues
 
u£d
 
š
h
im¶em’tiÚ
 
‹m¶©e
.

205 
DEFS
 = {

206 'n' : 
	`¡r
(
n
),

207 'vs' : 
	`I‹r
(
n
, 'v%s', 
£p
=', '),

208 'vts' : 
	`I‹r
(
n
, '#v%s', 
£p
=', '),

209 '¬™y' : 
	`Ar™y
(
n
),

210 'Ar™y' : 
	`T™Ë
(
	`Ar™y
(
n
))

211 
	}
}

213 
im¶
 = """

217 
‹m¶©e
 <
ty³Çme
 
P»d
""" % DEFS

219 
im¶
 +ğ
I‹r
(
n
, """,

220 
ty³Çme
 
T
%
s
""")

222 
im¶
 += """>

223 
As£¹iÚResuÉ
 
As£¹P»d
%(
n
)
sH–³r
(cÚ¡ * 
´ed_‹xt
""" % DEFS

225 
im¶
 +ğ
I‹r
(
n
, """,

226 cÚ¡ * 
e
%
s
""")

228 
im¶
 += """,

229 
P»d
 
´ed
"""

231 
im¶
 +ğ
I‹r
(
n
, """,

232 cÚ¡ 
T
%
s
& 
v
%s""")

234 
im¶
 += """) {

235 ià(
´ed
(%(
vs
)
s
)è 
As£¹iÚSucûss
();

239 
im¶
 += '„eturn AssertionFailure() <<…red_text << "("'

241 
im¶
 +ğ
I‹r
(
n
, """

242 << 
e
%
s
""", sep=' << ", "')

244 
im¶
 += ' << ")ƒvaluateso false, where"'

246 
im¶
 +ğ
I‹r
(
n
, """

247 << "\\n" << 
e
%
s
 << "ƒv®u©e tØ" << 
v
%s""")

249 
im¶
 += """;

254 
	#GTEST_PRED_FORMAT
%(
n
)
	`s_
(
´ed_fÜm©
, %(
vs
)
s
, 
Ú_çu»
)\\

255 
	`GTEST_ASSERT_
(
	`´ed_fÜm©
(%(
vts
)
s
, %(
vs
)s),\\

256 
Ú_çu»
)

	)

260 
	#GTEST_PRED
%(
n
)
	`s_
(
´ed
, %(
vs
)
s
, 
Ú_çu»
)\\

261 
	`GTEST_ASSERT_
(::
‹¡šg
::
As£¹P»d
%(
n
)
	`sH–³r
(#pred""" % DEFS

262 

	)

263 
im¶
 +ğ
I‹r
(
n
, """, \\

264 #v%
s
""")

266 
im¶
 += """, \\

267 
´ed
"""

269 
im¶
 +ğ
I‹r
(
n
, """, \\

270 
v
%
s
""")

272 
im¶
 += """), on_failure)

275 
	#EXPECT_PRED_FORMAT
%(
n
)
	`s
(
´ed_fÜm©
, %(
vs
)
s
) \\

276 
GTEST_PRED_FORMAT
%(
n
)
	`s_
(
´ed_fÜm©
, %(
vs
)
s
, 
GTEST_NONFATAL_FAILURE_
)

	)

277 
	#EXPECT_PRED
%(
n
)
	`s
(
´ed
, %(
vs
)
s
) \\

278 
GTEST_PRED
%(
n
)
	`s_
(
´ed
, %(
vs
)
s
, 
GTEST_NONFATAL_FAILURE_
)

	)

279 
	#ASSERT_PRED_FORMAT
%(
n
)
	`s
(
´ed_fÜm©
, %(
vs
)
s
) \\

280 
GTEST_PRED_FORMAT
%(
n
)
	`s_
(
´ed_fÜm©
, %(
vs
)
s
, 
GTEST_FATAL_FAILURE_
)

	)

281 
	#ASSERT_PRED
%(
n
)
	`s
(
´ed
, %(
vs
)
s
) \\

282 
GTEST_PRED
%(
n
)
	`s_
(
´ed
, %(
vs
)
s
, 
GTEST_FATAL_FAILURE_
)

	)

286  
im¶


289 
def
 
	$H—d”Po¡ambË
():

298 
def
 
	$G’”©eFe
(
·th
, 
cÚ‹Á
):

300 
giv’
 
cÚ‹Á
."""

302 
´št
 'Upd©šg f% . . .' % 
·th


304 
f
 = 
	`fe
(
·th
, 'w+')

305 
´št
 >>
f
, 
cÚ‹Á
,

306 
f
.
	$şo£
()

308 
´št
 'F% ha b“Àupd©ed.' % 
·th


311 
def
 
	$G’”©eH—d”
(
n
):

313 
the
 
´ediÿ‹
 
as£¹iÚs
."""

315 
	`G’”©eFe
(
HEADER
,

316 
	`H—d”P»ambË
(
n
)

317 + ''.
	`još
([
	$Im¶em’tiÚFÜAr™y
(
i
è˜
š
 
	`OÃTo
(
n
)])

318 + 
	$H—d”Po¡ambË
())

321 
def
 
	$Un™Te¡P»ambË
():

324 #A 
m­
 
th©
 
defšes
 
the
 
v®ues
 
u£d
 
š
h
´—mbË
 
‹m¶©e
.

325 
DEFS
 = {

326 'today' : 
time
.
	`¡ráime
('%m/%d/%Y'),

327 'y—r' : 
time
.
	`¡ráime
('%Y'),

328 'commªd' : '% %s' % (
os
.
·th
.
	`ba£Çme
(
sys
.
¬gv
[0]), sys.argv[1]),

329 
	}
}

381 
	~<io¡»am
>

383 
	~"g‹¡/g‹¡.h
"

384 
	~"g‹¡/g‹¡-¥i.h
"

387 
	sBoŞ
 {

388 
ex¶ic™
 
BoŞ
(
v®
è: 
v®ue
(val != 0) {}

390 
boŞ
 
İ”©Ü
>(
n
ècÚ¡ {  
v®ue
 > 
BoŞ
(n).value; }

392 
BoŞ
 
İ”©Ü
+(cÚ¡ BoŞ& 
rhs
ècÚ¡ {  BoŞ(
v®ue
 +„hs.value); }

394 
boŞ
 
İ”©Ü
==(cÚ¡ 
BoŞ
& 
rhs
ècÚ¡ {  
v®ue
 ==„hs.value; }

396 
boŞ
 
v®ue
;

400 
¡d
::
o¡»am
& 
İ”©Ü
<<(¡d::o¡»am& 
os
, cÚ¡ 
BoŞ
& 
x
) {

401  
os
 << (
x
.
v®ue
 ? "true" : "false");

407 
def
 
	$Te¡sFÜAr™y
(
n
):

410 #A 
m­
 
th©
 
defšes
 
the
 
v®ues
 
u£d
 
š
h
‹m¶©e
 th
‹¡s
.

411 
DEFS
 = {

412 'n' : 
n
,

413 'es' : 
	`I‹r
(
n
, 'e%s', 
£p
=', '),

414 'vs' : 
	`I‹r
(
n
, 'v%s', 
£p
=', '),

415 'vts' : 
	`I‹r
(
n
, '#v%s', 
£p
=', '),

416 'tvs' : 
	`I‹r
(
n
, 'T% v%s', 
£p
=', '),

417 'št_vs' : 
	`I‹r
(
n
, 'šˆv%s', 
£p
=', '),

418 'BoŞ_vs' : 
	`I‹r
(
n
, 'BoŞ v%s', 
£p
=', '),

419 'ty³s' : 
	`I‹r
(
n
, 'ty³ÇmT%s', 
£p
=', '),

420 'v_sum' : 
	`I‹r
(
n
, 'v%s', 
£p
=' + '),

421 '¬™y' : 
	`Ar™y
(
n
),

422 'Ar™y' : 
	`T™Ë
(
	`Ar™y
(
n
)),

423 
	}
}

425 
‹¡s
 = (

429 
‹m¶©e
 <%(
ty³s
)
s
>

430 
boŞ
 
P»dFunùiÚ
%(
n
)
s
(%(
tvs
)s) {

431  %(
v_sum
)
s
 > 0;

437 
boŞ
 
P»dFunùiÚ
%(
n
)
sIÁ
(%(
št_vs
)
s
) {

438  %(
v_sum
)
s
 > 0;

440 
boŞ
 
P»dFunùiÚ
%(
n
)
sBoŞ
(%(
BoŞ_vs
)
s
) {

441  %(
v_sum
)
s
 > 0;

445 
‹¡s
 += """

447 
P»dFunùÜ
%(
n
)
s
 {

448 
‹m¶©e
 <%(
ty³s
)
s
>

449 
boŞ
 
İ”©Ü
()(""" % DEFS

451 
‹¡s
 +ğ
I‹r
(
n
, 'cÚ¡ T%s& v%s', 
£p
=""",

454 
‹¡s
 += """) {

455  %(
v_sum
)
s
 > 0;

460 
‹¡s
 += """

462 
‹m¶©e
 <%(
ty³s
)
s
>

463 
‹¡šg
::
As£¹iÚResuÉ
 
P»dFÜm©FunùiÚ
%(
n
)
s
(""" % DEFS

465 
‹¡s
 +ğ
I‹r
(
n
, 'cÚ¡ ch¬*ƒ%s', 
£p
=""",

468 
‹¡s
 +ğ
I‹r
(
n
, """,

469 cÚ¡ 
T
%
s
& 
v
%s""")

471 
‹¡s
 += """) {

472 ià(
P»dFunùiÚ
%(
n
)
s
(%(
vs
)s))

473  
‹¡šg
::
As£¹iÚSucûss
();

475  
‹¡šg
::
As£¹iÚFau»
()

478 
‹¡s
 +ğ
I‹r
(
n
, 'e%s', 
£p
=' << " + " << ')

480 
‹¡s
 += """

482 << %(
v_sum
)
s
 << ".";

486 
‹¡s
 += """

488 
P»dFÜm©FunùÜ
%(
n
)
s
 {

489 
‹m¶©e
 <%(
ty³s
)
s
>

490 
‹¡šg
::
As£¹iÚResuÉ
 
İ”©Ü
()(""" % DEFS

492 
‹¡s
 +ğ
I‹r
(
n
, 'cÚ¡ ch¬*ƒ%s', 
£p
=""",

495 
‹¡s
 +ğ
I‹r
(
n
, """,

496 cÚ¡ 
T
%
s
& 
v
%s""")

498 
‹¡s
 += """) const {

499  
P»dFÜm©FunùiÚ
%(
n
)
s
(%(
es
)s, %(
vs
)s);

504 
‹¡s
 += """

507 
şass
 
P»diÿ‹
%(
n
)
sTe¡
 : 
public
 
‹¡šg
::
Te¡
 {

508 
´Ùeùed
:

509 
vœtu®
 
S‘Up
() {

510 
ex³ùed_to_fšish_
 = 
Œue
;

511 
fšished_
 = 
çl£
;""" % DEFS

513 
‹¡s
 += """

518 
‹¡s
 += """

519 
vœtu®
 
T—rDown
() {

523 
‹¡s
 +ğ''.
još
(["""

524 
EXPECT_EQ
(1, 
n
%
s_
) <<

528 
‹¡s
 += """

531 ià(
ex³ùed_to_fšish_
 && !
fšished_
) {

532 
FAIL
() << "The…redicate‡ssertion unexpactedly‡bortedheest.";

533 } ià(!
ex³ùed_to_fšish_
 && 
fšished_
) {

534 
FAIL
() << "The failed…redicate‡ssertion didn't‡bortheest "

540 
boŞ
 
ex³ùed_to_fšish_
;

543 
boŞ
 
fšished_
;

546 
‹¡s
 +ğ
I‹r
(
n
, """

547 
n
%
s_
;""")

549 
‹¡s
 += """

552 
boŞ
 
P»diÿ‹
%(
n
)
sTe¡
::
ex³ùed_to_fšish_
;

553 
boŞ
 
P»diÿ‹
%(
n
)
sTe¡
::
fšished_
;

556 
‹¡s
 +ğ
I‹r
(
n
, """int Predicate%%(n)sTest::n%s_;

559 
‹¡s
 += """

560 
P»diÿ‹
%(
n
)
sTe¡
 
EXPECT_PRED_FORMAT
%(n)sTest;

561 
P»diÿ‹
%(
n
)
sTe¡
 
ASSERT_PRED_FORMAT
%(n)sTest;

562 
P»diÿ‹
%(
n
)
sTe¡
 
EXPECT_PRED
%(n)sTest;

563 
P»diÿ‹
%(
n
)
sTe¡
 
ASSERT_PRED
%(n)sTest;

566 
def
 
	$G’Te¡
(
u£_fÜm©
, 
u£_as£¹
, 
ex³ù_çu»
,

567 
u£_funùÜ
, 
u£_u£r_ty³
):

570 
Args
:

571 
u£_fÜm©
: 
Œue
 
iff
 
the
 
as£¹iÚ
 
is
 
a
 *
_PRED_FORMAT
*.

572 
u£_as£¹
: 
Œue
 
iff
 
the
 
as£¹iÚ
 
is
 
a
 
ASSERT_
*.

573 
ex³ù_çu»
: 
Œue
 
iff
 
the
 
as£¹iÚ
 
is
 
ex³ùed
 
to
 
ç
.

574 
u£_funùÜ
: 
Œue
 
iff
 
the
 
fœ¡
 
¬gum’t
 
of
h
as£¹iÚ
 
is


575 
a
 
	$funùÜ
 (
as
 
İpo£d
 
to
 
a
 
funùiÚ
)

576 
u£_u£r_ty³
: 
Œue
 
iff
 
the
 
´ediÿ‹
 
funùÜ
/
funùiÚ
 
kes


577 
	$¬gum’t
(
s
è
of
 
a
 
u£r
-
defšed
 
ty³
.

579 
Exam¶e
:

581 
	$G’Te¡
(1, 0, 0, 1, 0è
»tuºs
 
a
 
‹¡
 
th©
 
‹¡s
 
the
 
behaviÜ


582 
of
 
a
 
sucûssful
 
	$EXPECT_PRED_FORMATn
(è
th©
 
kes
 
a
 
funùÜ


583 
who£
 
¬gum’ts
 
have
 
but
-
š
 
ty³s
."""

585 
u£_as£¹
:

586 
as¤t
 = 'ASSERT' #'
as£¹
' is„eserved, so we cannot use

587 #th© 
id’tif›r
 
h”e
.

589 
as¤t
 = 'EXPECT'

591 
as£¹iÚ
 = 
as¤t
 + '_PRED'

593 
u£_fÜm©
:

594 
´ed_fÜm©
 = 'PredFormat'

595 
as£¹iÚ
 += '_FORMAT'

597 
´ed_fÜm©
 = 'Pred'

599 
as£¹iÚ
 +ğ'%Ò)s' % 
DEFS


601 
u£_funùÜ
:

602 
´ed_fÜm©_ty³
 = 'functor'

603 
´ed_fÜm©
 += 'Functor%(n)s()'

605 
´ed_fÜm©_ty³
 = 'function'

606 
´ed_fÜm©
 += 'Function%(n)s'

607 
nÙ
 
u£_fÜm©
:

608 
u£_u£r_ty³
:

609 
´ed_fÜm©
 += 'Bool'

611 
´ed_fÜm©
 += 'Int'

613 
‹¡_Çme
 = 
´ed_fÜm©_ty³
.
	$t™Ë
()

615 
u£_u£r_ty³
:

616 
¬g_ty³
 = 'user-definedype (Bool)'

617 
‹¡_Çme
 += 'OnUserType'

618 
ex³ù_çu»
:

619 
¬g
 = 'Bool(n%s_++)'

621 
¬g
 = 'Bool(++n%s_)'

623 
¬g_ty³
 = 'built-inype (int)'

624 
‹¡_Çme
 += 'OnBuiltInType'

625 
ex³ù_çu»
:

626 
¬g
 = 'n%s_++'

628 
¬g
 = '++n%s_'

630 
ex³ù_çu»
:

631 
sucûssful_Ü_çed
 = 'failed'

632 
ex³ùed_Ü_nÙ
 = 'expected.'

633 
‹¡_Çme
 += 'Failure'

635 
sucûssful_Ü_çed
 = 'successful'

636 
ex³ùed_Ü_nÙ
 = 'UNEXPECTED!'

637 
‹¡_Çme
 += 'Success'

639 #A 
m­
 
th©
 
defšes
 
the
 
v®ues
 
u£d
 
š
h
‹¡
 
‹m¶©e
.

640 
defs
 = 
DEFS
.
	$cİy
()

641 
defs
.
	`upd©e
({

642 'as£¹' : 
as¤t
,

643 'as£¹iÚ' : 
as£¹iÚ
,

644 '‹¡_Çme' : 
‹¡_Çme
,

645 'pf_ty³' : 
´ed_fÜm©_ty³
,

646 'pf' : 
´ed_fÜm©
,

647 '¬g_ty³' : 
¬g_ty³
,

648 '¬g' : 
¬g
,

649 'sucûssful' : 
sucûssful_Ü_çed
,

650 'ex³ùed' : 
ex³ùed_Ü_nÙ
,

651 
	}
})

653 
‹¡
 = """

656 
TEST_F
(%(
as£¹iÚ
)
sTe¡
, %(
‹¡_Çme
)
s
) {""" % defs

658 
šd’t
 = (
Ën
(
as£¹iÚ
) + 3)*' '

659 
exŒa_šd’t
 = ''

661 
ex³ù_çu»
:

662 
exŒa_šd’t
 = ' '

663 
u£_as£¹
:

664 
‹¡
 += """

665 
ex³ùed_to_fšish_
 = 
çl£
;

666 
EXPECT_FATAL_FAILURE
({

668 
‹¡
 += """

669 
EXPECT_NONFATAL_FAILURE
({

671 
‹¡
 +ğ'\n' + 
exŒa_šd’t
 + """ %×s£¹iÚ)s(%Õf)s""" % 
defs


673 
‹¡
 =e¡ % 
defs


674 
‹¡
 +ğ
I‹r
(
n
, ',\n' + 
šd’t
 + 
exŒa_šd’t
 + '%×rg)s' % 
defs
)

675 
‹¡
 +ğ');\n' + 
exŒa_šd’t
 + ' finished_ =rue;\n'

677 
ex³ù_çu»
:

678 
‹¡
 += ' }, "");\n'

680 
‹¡
 += '}\n'

681  
‹¡


683 #G’”©e 
‹¡s
 
®l
 2**6 = 64 
combš©iÚs
.

684 
‹¡s
 +ğ''.
još
([
G’Te¡
(
u£_fÜm©
, 
u£_as£¹
, 
ex³ù_çu»
,

685 
u£_funùÜ
, 
u£_u£r_ty³
)

686 
u£_fÜm©
 
š
 [0, 1]

687 
u£_as£¹
 
š
 [0, 1]

688 
ex³ù_çu»
 
š
 [0, 1]

689 
u£_funùÜ
 
š
 [0, 1]

690 
u£_u£r_ty³
 
š
 [0, 1]

693  
‹¡s


696 
def
 
Un™Te¡Po¡ambË
():

702 
def
 
G’”©eUn™Te¡
(
n
):

705 
G’”©eFe
(
UNIT_TEST
,

706 
Un™Te¡P»ambË
()

707 + ''.
još
([
Te¡sFÜAr™y
(
i
è˜
š
 
OÃTo
(
n
)])

708 + 
Un™Te¡Po¡ambË
())

711 
def
 
_Maš
():

713 
un™
 
‹¡
."""

715 
Ën
(
sys
.
¬gv
) != 2:

716 
´št
 
__doc__


717 
´št
 'AuthÜ: ' + 
__authÜ__


718 
sys
.
ex™
(1)

720 
n
 = (
sys
.
¬gv
[1])

721 
G’”©eH—d”
(
n
)

722 
G’”©eUn™Te¡
(
n
)

725 
__Çme__
 == '__main__':

726 
_Maš
()

	@trunk/objs/gtest-1.6.0/scripts/pump.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


2 #
#Cİyrighˆ2008, 
GoogË
 
Inc
.

3 #AÎ 
rights
 
»£rved
.

4 #
#Redi¡ributiÚ 
ªd
 
u£
 
š
 
sourû
‡nd 
bš¬y
 
fÜms
, 
w™h
 
Ü
 
w™hout


5 #modifiÿtiÚ, 
¬e
 
³rm™‹d
 
´ovided
 
th©
 
the
 
fŞlowšg
 
cÚd™iÚs
‡re

7 #
#* 
Redi¡ributiÚs
 
of
 
sourû
 
code
 
mu¡
 
»š
 
the
 
above
 
cİyright


8 #nÙiû, 
this
 
li¡
 
of
 
cÚd™iÚs
 
ªd
 
the
 
fŞlowšg
 
disşaim”
.

9 #* 
Redi¡ributiÚs
 
š
 
bš¬y
 
fÜm
 
mu¡
 
»´oduû
 
the
 
above


10 #cİyrighˆ
nÙiû
, 
this
 
li¡
 
of
 
cÚd™iÚs
 
ªd
 
the
 
fŞlowšg
 
disşaim”


11 #š 
the
 
docum’tiÚ
 
ªd
/
Ü
 
Ùh”
 
m©”Ÿls
 
´ovided
 
w™h
he

13 #* 
Ne™h”
 
the
 
Çme
 
of
 
GoogË
 
Inc
. 
nÜ
h
Çmes
 oà
™s


14 #cÚŒibutÜ 
may
 
be
 
u£d
 
to
 
’dÜ£
 
Ü
 
´omÙe
 
´oduùs
 
d”ived
 
äom


15 #thi 
soáw¬e
 
w™hout
 
¥ecific
 
´iÜ
 
wr™‹n
 
³rmissiÚ
.

16 #
#THIS 
SOFTWARE
 
IS
 
PROVIDED
 
BY
 
THE
 
COPYRIGHT
 
HOLDERS
 
AND
 
CONTRIBUTORS


17 #"
AS
 
IS
" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT

18 #LIMITED 
TO
, 
THE
 
IMPLIED
 
WARRANTIES
 
OF
 
MERCHANTABILITY
 
AND
 
FITNESS
 
FOR


19 #A 
PARTICULAR
 
PURPOSE
 
ARE
 
DISCLAIMED
. 
IN
 
NO
 
EVENT
 
SHALL
 
THE
 
COPYRIGHT


20 #OWNER 
OR
 
CONTRIBUTORS
 
BE
 
LIABLE
 
FOR
 
ANY
 
DIRECT
, 
INDIRECT
, 
INCIDENTAL
,

21 #SPECIAL, 
EXEMPLARY
, 
OR
 
CONSEQUENTIAL
 
DAMAGES
 (
INCLUDING
, 
BUT
 
NOT


22 #LIMITED 
TO
, 
PROCUREMENT
 
OF
 
SUBSTITUTE
 
GOODS
 
OR
 
SERVICES
; 
LOSS
 OF 
USE
,

23 #DATA, 
OR
 
PROFITS
; OR 
BUSINESS
 
INTERRUPTION
è
HOWEVER
 
CAUSED
 
AND
 
ON
 
ANY


24 #THEORY 
OF
 
LIABILITY
, 
WHETHER
 
IN
 
CONTRACT
, 
STRICT
 LIABILITY, 
OR
 
TORT


25 #(
INCLUDING
 
NEGLIGENCE
 
OR
 
OTHERWISE
è
ARISING
 
IN
 
ANY
 
WAY
 
OUT
 
OF
 
THE
 
USE


26 #OF 
THIS
 
SOFTWARE
, 
EVEN
 
IF
 
ADVISED
 
OF
 
THE
 
POSSIBILITY
 OF 
SUCH
 
DAMAGE
.

30 
A
 
toŞ
 
´•roûssÜ
 
m‘a
 
	g´og¿mmšg
. 
U£ful
 
g’”©šg


31 
»³t™ive
 
bo”¶©e
 
	gcode
. 
E¥ecŸÎy
 
u£ful
 
wr™šg
 
	gC
++

32 
	gşas£s
, 
	gfunùiÚs
, 
	gmaüos
, 
ªd
 
‹m¶©es
 
th©
 
Ãed
 
to
 
wÜk
 
w™h


33 
v¬ious
 
numb”
 
of
 
	g¬gum’ts
.

35 
	gUSAGE
:

36 
pump
.
py
 
SOURCE_FILE


38 
EXAMPLES
:

39 
pump
.
py
 
foo
.
cc
.pump

40 
CÚv”ts
 
foo
.
cc
.
pump
 
to
 foo.cc.

42 
GRAMMAR
:

43 
CODE
 ::ğ
ATOMIC_CODE
*

44 
ATOMIC_CODE
 ::ğ
$v¬
 
ID
 = 
EXPRESSION


45 | 
$v¬
 
ID
 = [[ 
CODE
 ]]

46 | 
$¿nge
 
ID
 
EXPRESSION
..EXPRESSION

47 | 
$fÜ
 
ID
 
SEPARATOR
 [[ 
CODE
 ]]

48 | 
$
($)

49 | 
$ID


50 | 
$
(
EXPRESSION
)

51 | 
$if
 
EXPRESSION
 [[ 
CODE
 ]] 
ELSE_BRANCH


52 | [[ 
CODE
 ]]

53 | 
RAW_CODE


54 
SEPARATOR
 ::ğ
RAW_CODE
 | 
EMPTY


55 
ELSE_BRANCH
 ::ğ
$–£
 [[ 
CODE
 ]]

56 | 
$–if
 
EXPRESSION
 [[ 
CODE
 ]] 
ELSE_BRANCH


57 | 
EMPTY


58 
EXPRESSION
 
has
 
PythÚ
 
syÁax
.

61 
__authÜ__
 = 'wan@google.com (Zhanyong Wan)'

63 
impÜt
 
os


64 
impÜt
 
»


65 
impÜt
 
sys


68 
TOKEN_TABLE
 = [

69 (
»
.
compe
(
r
'\$var\s+'), '$var'),

70 (
»
.
compe
(
r
'\$elif\s+'), '$elif'),

71 (
»
.
compe
(
r
'\$else\s+'), '$else'),

72 (
»
.
compe
(
r
'\$for\s+'), '$for'),

73 (
»
.
compe
(
r
'\$if\s+'), '$if'),

74 (
»
.
compe
(
r
'\$range\s+'), '$range'),

75 (
»
.
compe
(
r
'\$[_A-Za-z]\w*'), '$id'),

76 (
»
.
compe
(
r
'\$\(\$\)'), '$($)'),

77 (
»
.
compe
(
r
'\$'), '$'),

78 (
»
.
compe
(
r
'\[\[\n?'), '[['),

79 (
»
.
compe
(
r
'\]\]\n?'), ']]'),

83 
şass
 
	gCursÜ
:

86 
def
 
__š™__
(
£lf
, 
lše
=-1, 
cŞumn
=-1):

87 
£lf
.
lše
 =†ine

88 
£lf
.
cŞumn
 = column

90 
def
 
	$__eq__
(
£lf
, 
rhs
):

91  
£lf
.
lše
 =ğ
rhs
.lš
ªd
 s–f.
cŞumn
 ==„hs.column

93 
def
 
	$__Ã__
(
£lf
, 
rhs
):

94  
nÙ
 
£lf
 =ğ
rhs


96 
def
 
	$__É__
(
£lf
, 
rhs
):

97  
£lf
.
lše
 < 
rhs
.lš
	`Ü
 (

98 
£lf
.
lše
 =ğ
rhs
.lš
ªd
 s–f.
cŞumn
 <„hs.column)

100 
def
 
	$__Ë__
(
£lf
, 
rhs
):

101  
£lf
 < 
rhs
 
Ü
 self ==„hs

103 
def
 
	$__gt__
(
£lf
, 
rhs
):

104  
rhs
 < 
£lf


106 
def
 
	$__ge__
(
£lf
, 
rhs
):

107  
rhs
 <ğ
£lf


109 
def
 
	$__¡r__
(
£lf
):

110 
£lf
 =ğ
	$Eof
():

113  '%s(%s)' % (
£lf
.
lše
 + 1, s–f.
cŞumn
)

115 
def
 
	$__add__
(
£lf
, 
off£t
):

116  
	`CursÜ
(
£lf
.
lše
, s–f.
cŞumn
 + 
off£t
)

118 
def
 
	$__sub__
(
£lf
, 
off£t
):

119  
	`CursÜ
(
£lf
.
lše
, s–f.
cŞumn
 - 
off£t
)

121 
def
 
	$ClÚe
(
£lf
):

124  
	$CursÜ
(
£lf
.
lše
, s–f.
cŞumn
)

127 #S³cŸÈ
cursÜ
 
to
 
šdiÿ‹
 
the
 
’d
-
of
-
fe
.

128 
def
 
	$Eof
():

130  
	`CursÜ
(-1, -1)

133 
şass
 
Tok’
:

136 
def
 
	$__š™__
(
£lf
, 
¡¬t
=
NÚe
, 
’d
=NÚe, 
v®ue
=NÚe, 
tok’_ty³
=None):

137 
¡¬t
 
is
 
NÚe
:

138 
£lf
.
¡¬t
 = 
	$Eof
()

140 
£lf
.
¡¬t
 = start

141 
’d
 
is
 
NÚe
:

142 
£lf
.
’d
 = 
	$Eof
()

144 
£lf
.
’d
 =ƒnd

145 
£lf
.
v®ue
 = value

146 
£lf
.
tok’_ty³
 =oken_type

148 
def
 
	$__¡r__
(
£lf
):

150 
£lf
.
¡¬t
, s–f.
v®ue
, s–f.
tok’_ty³
)

152 
def
 
	$ClÚe
(
£lf
):

155  
	`Tok’
(
£lf
.
¡¬t
.
	`ClÚe
(), s–f.
’d
.ClÚe(), s–f.
v®ue
,

156 
£lf
.
tok’_ty³
)

159 
def
 
	$S¹sW™h
(
lšes
, 
pos
, 
¡ršg
):

162  
lšes
[
pos
.
lše
][pos.
cŞumn
:].
	$¡¬tsw™h
(
¡ršg
)

165 
def
 
	$FšdFœ¡InLše
(
lše
, 
tok’_bË
):

166 
be¡_m©ch_¡¬t
 = -1

167 
»gex
, 
tok’_ty³
è
š
 
tok’_bË
:

168 
m
 = 
»gex
.
	$£¬ch
(
lše
)

169 
m
:

170 #W
found
 
»gex
 
š
 
lšes


171 
be¡_m©ch_¡¬t
 < 0 
Ü
 
m
.
	`¡¬t
() < best_match_start:

172 
be¡_m©ch_¡¬t
 = 
m
.
	$¡¬t
()

173 
be¡_m©ch_Ëngth
 = 
m
.
	`’d
(è- m.
	$¡¬t
()

174 
be¡_m©ch_tok’_ty³
 = 
tok’_ty³


176 
be¡_m©ch_¡¬t
 < 0:

177  
NÚe


179  (
be¡_m©ch_¡¬t
, 
be¡_m©ch_Ëngth
, 
be¡_m©ch_tok’_ty³
)

182 
def
 
	$FšdFœ¡
(
lšes
, 
tok’_bË
, 
cursÜ
):

185 
¡¬t
 = 
cursÜ
.
	$ClÚe
()

186 
cur_lše_numb”
 = 
cursÜ
.
lše


187 
lše
 
š
 
lšes
[
¡¬t
.line:]:

188 
cur_lše_numb”
 =ğ
¡¬t
.
lše
:

189 
lše
 =†še[
¡¬t
.
cŞumn
:]

190 
m
 = 
	$FšdFœ¡InLše
(
lše
, 
tok’_bË
)

191 
m
:

192 #W
found
 
a
 
»gex
 
š
 
lše
.

193 (
¡¬t_cŞumn
, 
Ëngth
, 
tok’_ty³
èğ
m


194 
cur_lše_numb”
 =ğ
¡¬t
.
lše
:

195 
¡¬t_cŞumn
 +ğ
¡¬t
.
cŞumn


196 
found_¡¬t
 = 
	$CursÜ
(
cur_lše_numb”
, 
¡¬t_cŞumn
)

197 
found_’d
 = 
found_¡¬t
 + 
Ëngth


198  
	$MakeTok’
(
lšes
, 
found_¡¬t
, 
found_’d
, 
tok’_ty³
)

199 
cur_lše_numb”
 += 1

200 #W
çed
 
to
 
fšd
 
¡r
 
š
 
lšes


201  
NÚe


204 
def
 
	$SubSŒšg
(
lšes
, 
¡¬t
, 
’d
):

207 
’d
 =ğ
	$Eof
():

208 
’d
 = 
	`CursÜ
(
	`Ën
(
lšes
) - 1,†en(lines[-1]))

210 
¡¬t
 >ğ
’d
:

213 
¡¬t
.
lše
 =ğ
’d
.line:

214  
lšes
[
¡¬t
.
lše
][¡¬t.
cŞumn
:
’d
.column]

216 
»suÉ_lšes
 = ([
lšes
[
¡¬t
.
lše
][¡¬t.
cŞumn
:]] +

217 
lšes
[
¡¬t
.
lše
 + 1:
’d
.line] +

218 [
lšes
[
’d
.
lše
][:’d.
cŞumn
]])

219  ''.
	$još
(
»suÉ_lšes
)

222 
def
 
	$SŒM‘aComm’ts
(
¡r
):

225 #Fœ¡, 
com¶‘–y
 
»move
 
lšes
 
cÚššg
 
nÙhšg
 
but
 
a
 
m‘a


226 #comm’t, 
šşudšg
 
the
 
Œašg
 \
n
.

227 
¡r
 = 
»
.
	`sub
(
r
'^\s*\$\$.*\n', '', str)

229 #Th’, 
»move
 
m‘a
 
comm’ts
 
äom
 
cÚ‹Áful
 
lšes
.

230  
»
.
	`sub
(
r
'\s*\$\$.*', '', 
¡r
)

233 
def
 
	$MakeTok’
(
lšes
, 
¡¬t
, 
’d
, 
tok’_ty³
):

236  
	`Tok’
(
¡¬t
, 
’d
, 
	`SubSŒšg
(
lšes
, s¹,ƒnd), 
tok’_ty³
)

239 
def
 
	$P¬£Tok’
(
lšes
, 
pos
, 
»gex
, 
tok’_ty³
):

240 
lše
 = 
lšes
[
pos
.lše][pos.
cŞumn
:]

241 
m
 = 
»gex
.
	$£¬ch
(
lše
)

242 
m
 
ªd
 
nÙ
 m.
	$¡¬t
():

243  
	`MakeTok’
(
lšes
, 
pos
,…o + 
m
.
	`’d
(), 
tok’_ty³
)

245 
´št
 'ERROR: % ex³ùed‡ˆ%s.' % (
tok’_ty³
, 
pos
)

246 
sys
.
	$ex™
(1)

249 
ID_REGEX
 = 
»
.
	`compe
(
r
'[_A-Za-z]\w*')

250 
EQ_REGEX
 = 
»
.
	`compe
(
r
'=')

251 
REST_OF_LINE_REGEX
 = 
»
.
	`compe
(
r
'.*?(?=$|\$\$)')

252 
OPTIONAL_WHITE_SPACES_REGEX
 = 
»
.
	`compe
(
r
'\s*')

253 
WHITE_SPACE_REGEX
 = 
»
.
	`compe
(
r
'\s')

254 
DOT_DOT_REGEX
 = 
»
.
	`compe
(
r
'\.\.')

257 
def
 
	$Sk
(
lšes
, 
pos
, 
»gex
):

258 
lše
 = 
lšes
[
pos
.lše][pos.
cŞumn
:]

259 
m
 = 
»
.
	$£¬ch
(
»gex
, 
lše
)

260 
m
 
ªd
 
nÙ
 m.
	$¡¬t
():

261  
pos
 + 
m
.
	$’d
()

263  
pos


266 
def
 
	$SkUÁ
(
lšes
, 
pos
, 
»gex
, 
tok’_ty³
):

267 
lše
 = 
lšes
[
pos
.lše][pos.
cŞumn
:]

268 
m
 = 
»
.
	$£¬ch
(
»gex
, 
lše
)

269 
m
:

270  
pos
 + 
m
.
	$¡¬t
()

272 
	`´št
 ('ERROR: %sƒxpected on†ine %s‡fter column %s.' %

273 (
tok’_ty³
, 
pos
.
lše
 + 1,…os.
cŞumn
))

274 
sys
.
	$ex™
(1)

277 
def
 
	$P¬£ExpTok’InP¬’s
(
lšes
, 
pos
):

278 
def
 
	$P¬£InP¬’s
(
pos
):

279 
pos
 = 
	$Sk
(
lšes
, 
pos
, 
OPTIONAL_WHITE_SPACES_REGEX
)

280 
pos
 = 
	`Sk
(
lšes
,…os, 
r
'\(')

281 
pos
 = 
	$P¬£
(
pos
)

282 
pos
 = 
	`Sk
(
lšes
,…os, 
r
'\)')

283  
pos


285 
def
 
	$P¬£
(
pos
):

286 
pos
 = 
	`SkUÁ
(
lšes
,…os, 
r
'\(|\)', ')')

287 
	`SubSŒšg
(
lšes
, 
pos
,…os + 1) == '(':

288 
pos
 = 
	`P¬£
(pos + 1)

289 
pos
 = 
	`Sk
(
lšes
,…os, 
r
'\)')

290  
	$P¬£
(
pos
)

292  
pos


294 
¡¬t
 = 
pos
.
	$ClÚe
()

295 
pos
 = 
	$P¬£InP¬’s
(
pos
)

296  
	`MakeTok’
(
lšes
, 
¡¬t
, 
pos
, 'exp')

299 
def
 
	$RSŒNewLšeFromTok’
(
tok’
):

300 
tok’
.
v®ue
.
	`’dsw™h
('\n'):

301  
	`Tok’
(
tok’
.
¡¬t
,ok’.
’d
,ok’.
v®ue
[:-1],ok’.
tok’_ty³
)

303  
tok’


306 
def
 
	$Tok’izeLšes
(
lšes
, 
pos
):

307 
True
:

308 
found
 = 
	$FšdFœ¡
(
lšes
, 
TOKEN_TABLE
, 
pos
)

309 
nÙ
 
found
:

310 
y›ld
 
	`MakeTok’
(
lšes
, 
pos
, 
	`Eof
(), 'code')

313 
found
.
¡¬t
 =ğ
pos
:

314 
´ev_tok’
 = 
NÚe


315 
´ev_tok’_r¡r³d
 = 
NÚe


317 
´ev_tok’
 = 
	`MakeTok’
(
lšes
, 
pos
, 
found
.
¡¬t
, 'code')

318 
´ev_tok’_r¡r³d
 = 
	$RSŒNewLšeFromTok’
(
´ev_tok’
)

320 
found
.
tok’_ty³
 == '$var':

321 
´ev_tok’_r¡r³d
:

322 
y›ld
 
´ev_tok’_r¡r³d


323 
y›ld
 
found


324 
id_tok’
 = 
	`P¬£Tok’
(
lšes
, 
found
.
’d
, 
ID_REGEX
, 'id')

325 
y›ld
 
id_tok’


326 
pos
 = 
	$Sk
(
lšes
, 
id_tok’
.
’d
, 
OPTIONAL_WHITE_SPACES_REGEX
)

328 
eq_tok’
 = 
	`P¬£Tok’
(
lšes
, 
pos
, 
EQ_REGEX
, '=')

329 
y›ld
 
eq_tok’


330 
pos
 = 
	`Sk
(
lšes
, 
eq_tok’
.
’d
, 
r
'\s*')

332 
	`SubSŒšg
(
lšes
, 
pos
,…os + 2) != '[[':

333 
exp_tok’
 = 
	`P¬£Tok’
(
lšes
, 
pos
, 
REST_OF_LINE_REGEX
, 'exp')

334 
y›ld
 
exp_tok’


335 
pos
 = 
	`CursÜ
(
exp_tok’
.
’d
.
lše
 + 1, 0)

336 
–if
 
found
.
tok’_ty³
 == '$for':

337 
´ev_tok’_r¡r³d
:

338 
y›ld
 
´ev_tok’_r¡r³d


339 
y›ld
 
found


340 
id_tok’
 = 
	`P¬£Tok’
(
lšes
, 
found
.
’d
, 
ID_REGEX
, 'id')

341 
y›ld
 
id_tok’


342 
pos
 = 
	$Sk
(
lšes
, 
id_tok’
.
’d
, 
WHITE_SPACE_REGEX
)

343 
–if
 
found
.
tok’_ty³
 == '$range':

344 
´ev_tok’_r¡r³d
:

345 
y›ld
 
´ev_tok’_r¡r³d


346 
y›ld
 
found


347 
id_tok’
 = 
	`P¬£Tok’
(
lšes
, 
found
.
’d
, 
ID_REGEX
, 'id')

348 
y›ld
 
id_tok’


349 
pos
 = 
	$Sk
(
lšes
, 
id_tok’
.
’d
, 
OPTIONAL_WHITE_SPACES_REGEX
)

351 
dÙs_pos
 = 
	`SkUÁ
(
lšes
, 
pos
, 
DOT_DOT_REGEX
, '..')

352 
y›ld
 
	`MakeTok’
(
lšes
, 
pos
, 
dÙs_pos
, 'exp')

353 
y›ld
 
	`MakeTok’
(
lšes
, 
dÙs_pos
, dots_pos + 2, '..')

354 
pos
 = 
dÙs_pos
 + 2

355 
Ãw_pos
 = 
	`CursÜ
(
pos
.
lše
 + 1, 0)

356 
y›ld
 
	`MakeTok’
(
lšes
, 
pos
, 
Ãw_pos
, 'exp')

357 
pos
 = 
Ãw_pos


358 
–if
 
found
.
tok’_ty³
 == '$':

359 
´ev_tok’
:

360 
y›ld
 
´ev_tok’


361 
y›ld
 
found


362 
exp_tok’
 = 
	$P¬£ExpTok’InP¬’s
(
lšes
, 
found
.
’d
)

363 
y›ld
 
exp_tok’


364 
pos
 = 
exp_tok’
.
’d


365 
	`–if
 (
found
.
tok’_ty³
 =ğ']]' 
Ü
 found.token_type == '$if' or

366 
found
.
tok’_ty³
 =ğ'$–if' 
Ü
 found.token_type == '$else'):

367 
´ev_tok’_r¡r³d
:

368 
y›ld
 
´ev_tok’_r¡r³d


369 
y›ld
 
found


370 
pos
 = 
found
.
’d


372 
´ev_tok’
:

373 
y›ld
 
´ev_tok’


374 
y›ld
 
found


375 
pos
 = 
found
.
’d


378 
def
 
	$Tok’ize
(
s
):

380 
s
 != '':

381 
lšes
 = 
s
.
	$¥l™lšes
(
True
)

382 
tok’
 
š
 
	`Tok’izeLšes
(
lšes
, 
	$CursÜ
(0, 0)):

383 
y›ld
 
tok’


386 
şass
 
CodeNode
:

387 
def
 
	$__š™__
(
£lf
, 
©omic_code_li¡
=
NÚe
):

388 
£lf
.
©omic_code
 = 
©omic_code_li¡


391 
şass
 
V¬Node
:

392 
def
 
	$__š™__
(
£lf
, 
id’tif›r
=
NÚe
, 
©omic_code
=None):

393 
£lf
.
id’tif›r
 = identifier

394 
£lf
.
©omic_code
 =‡tomic_code

397 
şass
 
RªgeNode
:

398 
def
 
	$__š™__
(
£lf
, 
id’tif›r
=
NÚe
, 
exp1
=NÚe, 
exp2
=None):

399 
£lf
.
id’tif›r
 = identifier

400 
£lf
.
exp1
 =ƒxp1

401 
£lf
.
exp2
 =ƒxp2

404 
şass
 
FÜNode
:

405 
def
 
	$__š™__
(
£lf
, 
id’tif›r
=
NÚe
, 
£p
=NÚe, 
code
=None):

406 
£lf
.
id’tif›r
 = identifier

407 
£lf
.
£p
 = sep

408 
£lf
.
code
 = code

411 
şass
 
El£Node
:

412 
def
 
	$__š™__
(
£lf
, 
–£_b¿nch
=
NÚe
):

413 
£lf
.
–£_b¿nch
 =ƒlse_branch

416 
şass
 
IfNode
:

417 
def
 
	$__š™__
(
£lf
, 
exp
=
NÚe
, 
th’_b¿nch
=NÚe, 
–£_b¿nch
=None):

418 
£lf
.
exp
 =ƒxp

419 
£lf
.
th’_b¿nch
 =hen_branch

420 
£lf
.
–£_b¿nch
 =ƒlse_branch

423 
şass
 
RawCodeNode
:

424 
def
 
	$__š™__
(
£lf
, 
tok’
=
NÚe
):

425 
£lf
.
¿w_code
 = 
tok’


428 
şass
 
L™”®DŞÏrNode
:

429 
def
 
	$__š™__
(
£lf
, 
tok’
):

430 
£lf
.
tok’
 =oken

433 
şass
 
ExpNode
:

434 
def
 
	$__š™__
(
£lf
, 
tok’
, 
pythÚ_exp
):

435 
£lf
.
tok’
 =oken

436 
£lf
.
pythÚ_exp
 =…ython_exp

439 
def
 
	$PİFrÚt
(
a_li¡
):

440 
h—d
 = 
a_li¡
[0]

441 
a_li¡
[:1] = []

442  
h—d


445 
def
 
	$PushFrÚt
(
a_li¡
, 
–em
):

446 
a_li¡
[:0] = [
–em
]

449 
def
 
	$PİTok’
(
a_li¡
, 
tok’_ty³
=
NÚe
):

450 
tok’
 = 
	$PİFrÚt
(
a_li¡
)

451 
tok’_ty³
 
is
 
nÙ
 
NÚe
 
ªd
 
tok’
.token_type !=oken_type:

452 
´št
 'ERROR: % ex³ùed‡ˆ%s' % (
tok’_ty³
, 
tok’
.
¡¬t
)

453 
´št
 'ERROR: % found in¡—d' % (
tok’
,)

454 
sys
.
	$ex™
(1)

456  
tok’


459 
def
 
	$P“kTok’
(
a_li¡
):

460 
nÙ
 
a_li¡
:

461  
NÚe


463  
a_li¡
[0]

466 
def
 
	$P¬£ExpNode
(
tok’
):

467 
pythÚ_exp
 = 
»
.
	`sub
(
r
'([_A-Za-z]\w*)',„'£lf.G‘V®ue("\1")', 
tok’
.
v®ue
)

468  
	$ExpNode
(
tok’
, 
pythÚ_exp
)

471 
def
 
	$P¬£El£Node
(
tok’s
):

472 
def
 
	$Pİ
(
tok’_ty³
=
NÚe
):

473  
	$PİTok’
(
tok’s
, 
tok’_ty³
)

475 
Ãxt
 = 
	$P“kTok’
(
tok’s
)

476 
nÙ
 
Ãxt
:

477  
NÚe


478 
Ãxt
.
tok’_ty³
 == '$else':

479 
	`Pİ
('$else')

480 
	`Pİ
('[[')

481 
code_node
 = 
	$P¬£CodeNode
(
tok’s
)

482 
	`Pİ
(']]')

483  
code_node


484 
–if
 
Ãxt
.
tok’_ty³
 == '$elif':

485 
	`Pİ
('$elif')

486 
exp
 = 
	`Pİ
('code')

487 
	`Pİ
('[[')

488 
code_node
 = 
	$P¬£CodeNode
(
tok’s
)

489 
	`Pİ
(']]')

490 
šÃr_–£_node
 = 
	$P¬£El£Node
(
tok’s
)

491  
	`CodeNode
([
	`IfNode
(
	`P¬£ExpNode
(
exp
), 
code_node
, 
šÃr_–£_node
)])

492 
–if
 
nÙ
 
Ãxt
.
v®ue
.
	$¡r
():

493 
	`Pİ
('code')

494  
	$P¬£El£Node
(
tok’s
)

496  
NÚe


499 
def
 
	$P¬£AtomicCodeNode
(
tok’s
):

500 
def
 
	$Pİ
(
tok’_ty³
=
NÚe
):

501  
	$PİTok’
(
tok’s
, 
tok’_ty³
)

503 
h—d
 = 
	$PİFrÚt
(
tok’s
)

504 
t
 = 
h—d
.
tok’_ty³


505 
t
 == 'code':

506  
	$RawCodeNode
(
h—d
)

507 
–if
 
t
 == '$var':

508 
id_tok’
 = 
	`Pİ
('id')

509 
	`Pİ
('=')

510 
Ãxt
 = 
	$P“kTok’
(
tok’s
)

511 
Ãxt
.
tok’_ty³
 == 'exp':

512 
exp_tok’
 = 
	$Pİ
()

513  
	`V¬Node
(
id_tok’
, 
	$P¬£ExpNode
(
exp_tok’
))

514 
	`Pİ
('[[')

515 
code_node
 = 
	$P¬£CodeNode
(
tok’s
)

516 
	`Pİ
(']]')

517  
	$V¬Node
(
id_tok’
, 
code_node
)

518 
–if
 
t
 == '$for':

519 
id_tok’
 = 
	`Pİ
('id')

520 
Ãxt_tok’
 = 
	$P“kTok’
(
tok’s
)

521 
Ãxt_tok’
.
tok’_ty³
 == 'code':

522 
£p_tok’
 = 
Ãxt_tok’


523 
	`Pİ
('code')

525 
£p_tok’
 = 
NÚe


526 
	`Pİ
('[[')

527 
code_node
 = 
	$P¬£CodeNode
(
tok’s
)

528 
	`Pİ
(']]')

529  
	$FÜNode
(
id_tok’
, 
£p_tok’
, 
code_node
)

530 
–if
 
t
 == '$if':

531 
exp_tok’
 = 
	`Pİ
('code')

532 
	`Pİ
('[[')

533 
code_node
 = 
	$P¬£CodeNode
(
tok’s
)

534 
	`Pİ
(']]')

535 
–£_node
 = 
	$P¬£El£Node
(
tok’s
)

536  
	`IfNode
(
	`P¬£ExpNode
(
exp_tok’
), 
code_node
, 
–£_node
)

537 
–if
 
t
 == '$range':

538 
id_tok’
 = 
	`Pİ
('id')

539 
exp1_tok’
 = 
	`Pİ
('exp')

540 
	`Pİ
('..')

541 
exp2_tok’
 = 
	`Pİ
('exp')

542  
	`RªgeNode
(
id_tok’
, 
	`P¬£ExpNode
(
exp1_tok’
),

543 
	$P¬£ExpNode
(
exp2_tok’
))

544 
–if
 
t
 == '$id':

545  
	`P¬£ExpNode
(
	`Tok’
(
h—d
.
¡¬t
 + 1, h—d.
’d
, h—d.
v®ue
[1:], 'id'))

546 
–if
 
t
 == '$($)':

547  
	$L™”®DŞÏrNode
(
h—d
)

548 
–if
 
t
 == '$':

549 
exp_tok’
 = 
	`Pİ
('exp')

550  
	$P¬£ExpNode
(
exp_tok’
)

551 
–if
 
t
 == '[[':

552 
code_node
 = 
	$P¬£CodeNode
(
tok’s
)

553 
	`Pİ
(']]')

554  
code_node


556 
	$PushFrÚt
(
tok’s
, 
h—d
)

557  
NÚe


560 
def
 
	$P¬£CodeNode
(
tok’s
):

561 
©omic_code_li¡
 = []

562 
True
:

563 
nÙ
 
tok’s
:

565 
©omic_code_node
 = 
	$P¬£AtomicCodeNode
(
tok’s
)

566 
©omic_code_node
:

567 
©omic_code_li¡
.
	$­³nd
(
©omic_code_node
)

570  
	$CodeNode
(
©omic_code_li¡
)

573 
def
 
	$P¬£ToAST
(
pump_¤c_‹xt
):

575 
tok’s
 = 
	`li¡
(
	$Tok’ize
(
pump_¤c_‹xt
))

576 
code_node
 = 
	$P¬£CodeNode
(
tok’s
)

577  
code_node


580 
şass
 
Env
:

581 
def
 
	$__š™__
(
£lf
):

582 
£lf
.
v¬ŸbËs
 = []

583 
£lf
.
¿nges
 = []

585 
def
 
	$ClÚe
(
£lf
):

586 
şÚe
 = 
	$Env
()

587 
şÚe
.
v¬ŸbËs
 = 
£lf
.variables[:]

588 
şÚe
.
¿nges
 = 
£lf
.ranges[:]

589  
şÚe


591 
def
 
	$PushV¬ŸbË
(
£lf
, 
v¬
, 
v®ue
):

592 #Ià
v®ue
 
looks
 
like
 
ª
 , 
¡Üe
 
™
 
as
‡n .

593 
Œy
:

594 
št_v®ue
 = (
v®ue
)

595 ià('%s' % 
št_v®ue
è=ğ
v®ue
:

596 
v®ue
 = 
št_v®ue


597 
exû±
 
Exû±iÚ
:

598 
·ss


599 
£lf
.
v¬ŸbËs
[:0] = [(
v¬
, 
v®ue
)]

601 
def
 
	$PİV¬ŸbË
(
£lf
):

602 
£lf
.
v¬ŸbËs
[:1] = []

604 
def
 
	$PushRªge
(
£lf
, 
v¬
, 
low”
, 
uµ”
):

605 
£lf
.
¿nges
[:0] = [(
v¬
, 
low”
, 
uµ”
)]

607 
def
 
	$PİRªge
(
£lf
):

608 
£lf
.
¿nges
[:1] = []

610 
def
 
	$G‘V®ue
(
£lf
, 
id’tif›r
):

611 
v¬
, 
v®ue
è
š
 
£lf
.
v¬ŸbËs
:

612 
id’tif›r
 =ğ
v¬
:

613  
v®ue


615 
´št
 'ERROR: m‘¨v¬ŸbË % i undefšed.' % (
id’tif›r
,)

616 
sys
.
	$ex™
(1)

618 
def
 
	$Ev®Exp
(
£lf
, 
exp
):

619 
Œy
:

620 
»suÉ
 = 
	$ev®
(
exp
.
pythÚ_exp
)

621 
exû±
 
Exû±iÚ
, 
e
:

622 
´št
 'ERROR: caughˆexû±iÚ %s: %s' % (
e
.
__şass__
.
__Çme__
,ƒ)

623 
	`´št
 ('ERROR: failedoƒvaluate metaƒxpression %s‡t %s' %

624 (
exp
.
pythÚ_exp
,ƒxp.
tok’
.
¡¬t
))

625 
sys
.
	$ex™
(1)

626  
»suÉ


628 
def
 
	$G‘Rªge
(
£lf
, 
id’tif›r
):

629 
v¬
, 
low”
, 
uµ”
è
š
 
£lf
.
¿nges
:

630 
id’tif›r
 =ğ
v¬
:

631  (
low”
, 
uµ”
)

633 
´št
 'ERROR:„ªg% i undefšed.' % (
id’tif›r
,)

634 
sys
.
	$ex™
(1)

637 
şass
 
Ouut
:

638 
def
 
	$__š™__
(
£lf
):

639 
£lf
.
¡ršg
 = ''

641 
def
 
	$G‘La¡Lše
(
£lf
):

642 
šdex
 = 
£lf
.
¡ršg
.
	`rfšd
('\n')

643 
šdex
 < 0:

646  
£lf
.
¡ršg
[
šdex
 + 1:]

648 
def
 
	$Aµ’d
(
£lf
, 
s
):

649 
£lf
.
¡ršg
 +ğ
s


652 
def
 
	$RunAtomicCode
(
’v
, 
node
, 
ouut
):

653 
	$isš¡ªû
(
node
, 
V¬Node
):

654 
id’tif›r
 = 
node
.id’tif›r.
v®ue
.
	$¡r
()

655 
»suÉ
 = 
	$Ouut
()

656 
	`RunAtomicCode
(
’v
.
	`ClÚe
(), 
node
.
©omic_code
, 
»suÉ
)

657 
v®ue
 = 
»suÉ
.
¡ršg


658 
’v
.
	$PushV¬ŸbË
(
id’tif›r
, 
v®ue
)

659 
–if
 
	$isš¡ªû
(
node
, 
RªgeNode
):

660 
id’tif›r
 = 
node
.id’tif›r.
v®ue
.
	$¡r
()

661 
low”
 = (
’v
.
	$Ev®Exp
(
node
.
exp1
))

662 
uµ”
 = (
’v
.
	$Ev®Exp
(
node
.
exp2
))

663 
’v
.
	$PushRªge
(
id’tif›r
, 
low”
, 
uµ”
)

664 
–if
 
	$isš¡ªû
(
node
, 
FÜNode
):

665 
id’tif›r
 = 
node
.id’tif›r.
v®ue
.
	$¡r
()

666 
node
.
£p
 
is
 
NÚe
:

667 
£p
 = ''

669 
£p
 = 
node
.£p.
v®ue


670 (
low”
, 
uµ”
èğ
’v
.
	$G‘Rªge
(
id’tif›r
)

671 
i
 
š
 
	`¿nge
(
low”
, 
uµ”
 + 1):

672 
Ãw_’v
 = 
’v
.
	$ClÚe
()

673 
Ãw_’v
.
	$PushV¬ŸbË
(
id’tif›r
, 
i
)

674 
	$RunCode
(
Ãw_’v
, 
node
.
code
, 
ouut
)

675 
i
 !ğ
uµ”
:

676 
ouut
.
	$Aµ’d
(
£p
)

677 
–if
 
	$isš¡ªû
(
node
, 
RawCodeNode
):

678 
ouut
.
	$Aµ’d
(
node
.
¿w_code
.
v®ue
)

679 
–if
 
	$isš¡ªû
(
node
, 
IfNode
):

680 
cÚd
 = 
’v
.
	$Ev®Exp
(
node
.
exp
)

681 
cÚd
:

682 
	`RunCode
(
’v
.
	`ClÚe
(), 
node
.
th’_b¿nch
, 
ouut
)

683 
–if
 
node
.
–£_b¿nch
 
is
 
nÙ
 
NÚe
:

684 
	`RunCode
(
’v
.
	`ClÚe
(), 
node
.
–£_b¿nch
, 
ouut
)

685 
–if
 
	$isš¡ªû
(
node
, 
ExpNode
):

686 
v®ue
 = 
’v
.
	$Ev®Exp
(
node
)

687 
ouut
.
	`Aµ’d
('%s' % (
v®ue
,))

688 
–if
 
	$isš¡ªû
(
node
, 
L™”®DŞÏrNode
):

689 
ouut
.
	`Aµ’d
('$')

690 
–if
 
	$isš¡ªû
(
node
, 
CodeNode
):

691 
	`RunCode
(
’v
.
	`ClÚe
(), 
node
, 
ouut
)

693 
´št
 'BAD'

694 
´št
 
node


695 
sys
.
	$ex™
(1)

698 
def
 
	$RunCode
(
’v
, 
code_node
, 
ouut
):

699 
©omic_code
 
š
 
code_node
.atomic_code:

700 
	$RunAtomicCode
(
’v
, 
©omic_code
, 
ouut
)

703 
def
 
	$IsComm’t
(
cur_lše
):

704  '//' 
š
 
cur_lše


707 
def
 
	$IsInP»´oûssÜDœev©ive
(
´ev_lšes
, 
cur_lše
):

708 
cur_lše
.
	`l¡r
().
	`¡¬tsw™h
('#'):

709  
True


710  
´ev_lšes
 !ğ[] 
ªd
…»v_lšes[-1].
	`’dsw™h
('\\')

713 
def
 
	$W¿pComm’t
(
lše
, 
ouut
):

714 
loc
 = 
lše
.
	`fšd
('//')

715 
befÜe_comm’t
 = 
lše
[:
loc
].
	$r¡r
()

716 
befÜe_comm’t
 == '':

717 
šd’t
 = 
loc


719 
ouut
.
	$­³nd
(
befÜe_comm’t
)

720 
šd’t
 = 
	`Ën
(
befÜe_comm’t
è-†’(befÜe_comm’t.
	$l¡r
())

721 
´efix
 = 
šd’t
*' ' + '// '

722 
max_Ën
 = 80 - 
	$Ën
(
´efix
)

723 
comm’t
 = 
lše
[
loc
 + 2:].
	$¡r
()

724 
£gs
 = [
£g
 £g 
š
 
»
.
	`¥l™
(
r
'(\w+\W*)', 
comm’t
) seg != '']

725 
cur_lše
 = ''

726 
£g
 
š
 
£gs
:

727 
	`Ën
((
cur_lše
 + 
£g
).
	`r¡r
()è< 
max_Ën
:

728 
cur_lše
 +ğ
£g


730 
cur_lše
.
	`¡r
() != '':

731 
ouut
.
	`­³nd
(
´efix
 + 
cur_lše
.
	$r¡r
())

732 
cur_lše
 = 
£g
.
	$l¡r
()

733 
cur_lše
.
	`¡r
() != '':

734 
ouut
.
	`­³nd
(
´efix
 + 
cur_lše
.
	$¡r
())

737 
def
 
	$W¿pCode
(
lše
, 
lše_cÚÿt
, 
ouut
):

738 
šd’t
 = 
	`Ën
(
lše
è-†’Öše.
	$l¡r
())

739 
´efix
 = 
šd’t
*' ' #P»fix 
of
 
the
 
cu¼’t
 
lše


740 
max_Ën
 = 80 - 
šd’t
 - 
	$Ën
(
lše_cÚÿt
è#Maximum 
Ëngth
 
of
 
the
 
cu¼’t
 
lše


741 
Ãw_´efix
 = 
´efix
 + 4*' ' #P»fix 
of
 
a
 
cÚtšu©iÚ
 
lše


742 
Ãw_max_Ën
 = 
max_Ën
 - 4 #Maximum 
Ëngth
 
of
 
a
 
cÚtšu©iÚ
 
lše


743 #P»ãr 
to
 
w¿p
 
a
 
lše
 
aá”
‡ ',' 
Ü
 ';'.

744 
£gs
 = [
£g
 £g 
š
 
»
.
	`¥l™
(
r
'([^,;]+[,;]?)', 
lše
.
	$¡r
()è
£g
 != '']

745 
cur_lše
 = '' #Th
cu¼’t
 
lše
 
w™hout
 
Ëadšg
 
¥aûs
.

746 
£g
 
š
 
£gs
:

747 #Ià
the
 
lše
 
is
 
¡l
 
too
 , 
w¿p
 
©
 
a
 
¥aû
.

748 
cur_lše
 =ğ'' 
ªd
 
	`Ën
(
£g
.
	`¡r
()è> 
max_Ën
:

749 
£g
 = seg.
	$l¡r
()

750 
¥l™_©
 = 
£g
.
	`rfšd
(' ', 0, 
max_Ën
)

751 
ouut
.
	`­³nd
(
´efix
 + 
£g
[:
¥l™_©
].
	`¡r
(è+ 
lše_cÚÿt
)

752 
£g
 = seg[
¥l™_©
 + 1:]

753 
´efix
 = 
Ãw_´efix


754 
max_Ën
 = 
Ãw_max_Ën


756 
	`Ën
((
cur_lše
 + 
£g
).
	`r¡r
()è< 
max_Ën
:

757 
cur_lše
 = (cur_lš+ 
£g
).
	$l¡r
()

759 
ouut
.
	`­³nd
(
´efix
 + 
cur_lše
.
	`r¡r
(è+ 
lše_cÚÿt
)

760 
´efix
 = 
Ãw_´efix


761 
max_Ën
 = 
Ãw_max_Ën


762 
cur_lše
 = 
£g
.
	$l¡r
()

763 
cur_lše
.
	`¡r
() != '':

764 
ouut
.
	`­³nd
(
´efix
 + 
cur_lše
.
	$¡r
())

767 
def
 
	$W¿pP»´oûssÜDœev©ive
(
lše
, 
ouut
):

768 
	`W¿pCode
(
lše
, ' \\', 
ouut
)

771 
def
 
	$W¿pPÏšCode
(
lše
, 
ouut
):

772 
	`W¿pCode
(
lše
, '', 
ouut
)

775 
def
 
	$IsH—d”Gu¬dOrInşude
(
lše
):

776  (
»
.
	`m©ch
(
r
'^#(iâdef|defše|’dif\s*//)\s*[\w_]+\s*$', 
lše
è
Ü


777 
»
.
	`m©ch
(
r
'^#šşude\s', 
lše
))

780 
def
 
	$W¿pLÚgLše
(
lše
, 
ouut
):

781 
lše
 =†še.
	$r¡r
()

782 
	`Ën
(
lše
) <= 80:

783 
ouut
.
	$­³nd
(
lše
)

784 
–if
 
	$IsComm’t
(
lše
):

785 
	$IsH—d”Gu¬dOrInşude
(
lše
):

786 #Th
¡yË
 
guide
 
made
 
ª
 
exû±iÚ
 
to
 
®low
 
h—d”
 
gu¬d
 
lšes


787 #ªd 
šşudes
.

788 
ouut
.
	$­³nd
(
lše
)

790 
	$W¿pComm’t
(
lše
, 
ouut
)

791 
–if
 
	$IsInP»´oûssÜDœev©ive
(
ouut
, 
lše
):

792 
	$IsH—d”Gu¬dOrInşude
(
lše
):

793 #Th
¡yË
 
guide
 
made
 
ª
 
exû±iÚ
 
to
 
®low
 
h—d”
 
gu¬d
 
lšes


794 #ªd 
šşudes
.

795 
ouut
.
	$­³nd
(
lše
)

797 
	$W¿pP»´oûssÜDœev©ive
(
lše
, 
ouut
)

799 
	$W¿pPÏšCode
(
lše
, 
ouut
)

802 
def
 
	$B—utifyCode
(
¡ršg
):

803 
lšes
 = 
¡ršg
.
	$¥l™lšes
()

804 
ouut
 = []

805 
lše
 
š
 
lšes
:

806 
	$W¿pLÚgLše
(
lše
, 
ouut
)

807 
ouut2
 = [
lše
.
	$r¡r
(è
lše
 
š
 
ouut
]

808  '\n'.
	`još
(
ouut2
) + '\n'

811 
def
 
	$CÚv”tFromPumpSourû
(
¤c_‹xt
):

813 
a¡
 = 
	`P¬£ToAST
(
	$SŒM‘aComm’ts
(
¤c_‹xt
))

814 
ouut
 = 
	$Ouut
()

815 
	`RunCode
(
	`Env
(), 
a¡
, 
ouut
)

816  
	$B—utifyCode
(
ouut
.
¡ršg
)

819 
def
 
	$maš
(
¬gv
):

820 
	`Ën
(
¬gv
) == 1:

821 
´št
 
__doc__


822 
sys
.
	$ex™
(1)

824 
fe_·th
 = 
¬gv
[-1]

825 
ouut_¡r
 = 
	`CÚv”tFromPumpSourû
(
	`fe
(
fe_·th
, 'r').
	$»ad
())

826 
fe_·th
.
	`’dsw™h
('.pump'):

827 
ouut_fe_·th
 = 
fe_·th
[:-5]

829 
ouut_fe_·th
 = '-'

830 
ouut_fe_·th
 == '-':

831 
´št
 
ouut_¡r
,

833 
ouut_fe
 = 
	`fe
(
ouut_fe_·th
, 'w')

834 
ouut_fe
.
	`wr™e
('// This file was GENERATED by command:\n')

835 
ouut_fe
.
	`wr™e
('// %s %s\n' %

836 (
os
.
·th
.
	`ba£Çme
(
__fe__
), os.·th.
	$ba£Çme
(
fe_·th
)))

837 
ouut_fe
.
	`wr™e
('// DO NOT EDIT BY HAND!!!\n\n')

838 
ouut_fe
.
	$wr™e
(
ouut_¡r
)

839 
ouut_fe
.
	$şo£
()

842 
__Çme__
 == '__main__':

843 
	`maš
(
sys
.
¬gv
)

	@trunk/objs/gtest-1.6.0/test/gtest_break_on_failure_unittest.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


2 #
#Cİyrighˆ2006, 
GoogË
 
Inc
.

3 #AÎ 
rights
 
»£rved
.

4 #
#Redi¡ributiÚ 
ªd
 
u£
 
š
 
sourû
‡nd 
bš¬y
 
fÜms
, 
w™h
 
Ü
 
w™hout


5 #modifiÿtiÚ, 
¬e
 
³rm™‹d
 
´ovided
 
th©
 
the
 
fŞlowšg
 
cÚd™iÚs
‡re

7 #
#* 
Redi¡ributiÚs
 
of
 
sourû
 
code
 
mu¡
 
»š
 
the
 
above
 
cİyright


8 #nÙiû, 
this
 
li¡
 
of
 
cÚd™iÚs
 
ªd
 
the
 
fŞlowšg
 
disşaim”
.

9 #* 
Redi¡ributiÚs
 
š
 
bš¬y
 
fÜm
 
mu¡
 
»´oduû
 
the
 
above


10 #cİyrighˆ
nÙiû
, 
this
 
li¡
 
of
 
cÚd™iÚs
 
ªd
 
the
 
fŞlowšg
 
disşaim”


11 #š 
the
 
docum’tiÚ
 
ªd
/
Ü
 
Ùh”
 
m©”Ÿls
 
´ovided
 
w™h
he

13 #* 
Ne™h”
 
the
 
Çme
 
of
 
GoogË
 
Inc
. 
nÜ
h
Çmes
 oà
™s


14 #cÚŒibutÜ 
may
 
be
 
u£d
 
to
 
’dÜ£
 
Ü
 
´omÙe
 
´oduùs
 
d”ived
 
äom


15 #thi 
soáw¬e
 
w™hout
 
¥ecific
 
´iÜ
 
wr™‹n
 
³rmissiÚ
.

16 #
#THIS 
SOFTWARE
 
IS
 
PROVIDED
 
BY
 
THE
 
COPYRIGHT
 
HOLDERS
 
AND
 
CONTRIBUTORS


17 #"
AS
 
IS
" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT

18 #LIMITED 
TO
, 
THE
 
IMPLIED
 
WARRANTIES
 
OF
 
MERCHANTABILITY
 
AND
 
FITNESS
 
FOR


19 #A 
PARTICULAR
 
PURPOSE
 
ARE
 
DISCLAIMED
. 
IN
 
NO
 
EVENT
 
SHALL
 
THE
 
COPYRIGHT


20 #OWNER 
OR
 
CONTRIBUTORS
 
BE
 
LIABLE
 
FOR
 
ANY
 
DIRECT
, 
INDIRECT
, 
INCIDENTAL
,

21 #SPECIAL, 
EXEMPLARY
, 
OR
 
CONSEQUENTIAL
 
DAMAGES
 (
INCLUDING
, 
BUT
 
NOT


22 #LIMITED 
TO
, 
PROCUREMENT
 
OF
 
SUBSTITUTE
 
GOODS
 
OR
 
SERVICES
; 
LOSS
 OF 
USE
,

23 #DATA, 
OR
 
PROFITS
; OR 
BUSINESS
 
INTERRUPTION
è
HOWEVER
 
CAUSED
 
AND
 
ON
 
ANY


24 #THEORY 
OF
 
LIABILITY
, 
WHETHER
 
IN
 
CONTRACT
, 
STRICT
 LIABILITY, 
OR
 
TORT


25 #(
INCLUDING
 
NEGLIGENCE
 
OR
 
OTHERWISE
è
ARISING
 
IN
 
ANY
 
WAY
 
OUT
 
OF
 
THE
 
USE


26 #OF 
THIS
 
SOFTWARE
, 
EVEN
 
IF
 
ADVISED
 
OF
 
THE
 
POSSIBILITY
 OF 
SUCH
 
DAMAGE
.

30 
A
 
u£r
 
ÿn
 
ask
 
GoogË
 
Te¡
 
to
 
	g£g
-
çuÉ
 
wh’
 
ª
 
as£¹iÚ
 
	gçs
, 
usšg


31 
e™h”
 
the
 
GTEST_BREAK_ON_FAILURE
 
’vœÚm’t
 
v¬ŸbË
 
Ü
 
	gthe


32 --
g‹¡_b»ak_Ú_çu»
 
	gæag
. 
This
 
süt
 
‹¡s
 
such
 
funùiÚ®™y


33 
by
 
švokšg
 
	$g‹¡_b»ak_Ú_çu»_un™‹¡_
 (
a
 
´og¿m
 
wr™‹n
 
w™h


34 
GoogË
 
Te¡
è
w™h
 
difã»Á
 
’vœÚm’ts
 
ªd
 
commªd
 
lše
 
æags
.

37 
__authÜ__
 = 'wan@google.com (Zhanyong Wan)'

39 
impÜt
 
g‹¡_‹¡_uts


40 
impÜt
 
os


41 
impÜt
 
sys


46 
IS_WINDOWS
 = 
os
.
Çme
 == 'nt'

48 #Th
’vœÚm’t
 
v¬ŸbË
 
’ablšg
/
di§blšg
 
the
 -
Ú
-
çu»
 
mode
.

49 
BREAK_ON_FAILURE_ENV_VAR
 = 'GTEST_BREAK_ON_FAILURE'

51 #Th
commªd
 
lše
 
æag
 
’ablšg
/
di§blšg
 
the
 -
Ú
-
çu»
 
mode
.

52 
BREAK_ON_FAILURE_FLAG
 = 'gtest_break_on_failure'

54 #Th
’vœÚm’t
 
v¬ŸbË
 
’ablšg
/
di§blšg
 
the
 
throw
-
Ú
-
çu»
 
mode
.

55 
THROW_ON_FAILURE_ENV_VAR
 = 'GTEST_THROW_ON_FAILURE'

57 #Th
’vœÚm’t
 
v¬ŸbË
 
’ablšg
/
di§blšg
 
the
 
ÿtch
-
exû±iÚs
 
mode
.

58 
CATCH_EXCEPTIONS_ENV_VAR
 = 'GTEST_CATCH_EXCEPTIONS'

60 #P©h 
to
 
the
 
g‹¡_b»ak_Ú_çu»_un™‹¡_
 
´og¿m
.

61 
EXE_PATH
 = 
g‹¡_‹¡_uts
.
	`G‘Te¡ExecubËP©h
(

68 
’vœÚ
 = 
os
.’vœÚ.
	$cİy
()

71 
def
 
	$S‘EnvV¬
(
’v_v¬
, 
v®ue
):

73 
giv’
 
v®ue
 
is
 
NÚe
.

76 
v®ue
 
is
 
nÙ
 
NÚe
:

77 
’vœÚ
[
’v_v¬
] = 
v®ue


78 
–if
 
’v_v¬
 
š
 
’vœÚ
:

79 
d–
 
’vœÚ
[
’v_v¬
]

82 
def
 
	$Run
(
commªd
):

85 
p
 = 
g‹¡_‹¡_uts
.
	$Sub´oûss
(
commªd
, 
’v
=
’vœÚ
)

86 
p
.
‹rmš©ed_by_sigÇl
:

92 #Th
‹¡s
.

95 
şass
 
	$GTe¡B»akOnFau»Un™Te¡
(
g‹¡_‹¡_uts
.
Te¡Ca£
):

97 
the
 --
g‹¡_b»ak_Ú_çu»
 
æag
 
to
 
tuº
 
as£¹iÚ
 
çu»s
 
što


98 
£gm’tiÚ
 
çuÉs
.

101 
def
 
	$RunAndV”ify
(
£lf
, 
’v_v¬_v®ue
, 
æag_v®ue
, 
ex³ù_£g_çuÉ
):

103 (
Ü
 
dÛs
 
nÙ
è
have
 
a
 
£g
-
çuÉ
.

105 
Args
:

106 
’v_v¬_v®ue
: 
v®ue
 
of
 
the
 
GTEST_BREAK_ON_FAILURE
 
’vœÚm’t


107 
v¬ŸbË
; 
NÚe
 
the
 v¬ŸbË 
should
 
be
 
un£t
.

108 
æag_v®ue
: 
v®ue
 
of
 
the
 --
g‹¡_b»ak_Ú_çu»
 
æag
;

109 
NÚe
 
the
 
æag
 
should
 
nÙ
 
be
 
´e£Á
.

110 
ex³ù_£g_çuÉ
: 1 
the
 
´og¿m
 
is
 
ex³ùed
 
to
 
g’”©e
 
a
 
£g
-
çuÉ
;

111 0 
Ùh”wi£
.

114 
	$S‘EnvV¬
(
BREAK_ON_FAILURE_ENV_VAR
, 
’v_v¬_v®ue
)

116 
’v_v¬_v®ue
 
is
 
NÚe
:

117 
’v_v¬_v®ue_msg
 = ' is‚ot set'

119 
’v_v¬_v®ue_msg
 = '=' + 
’v_v¬_v®ue


121 
æag_v®ue
 
is
 
NÚe
:

122 
æag
 = ''

123 
–if
 
æag_v®ue
 == '0':

124 
æag
 = '--%s=0' % 
BREAK_ON_FAILURE_FLAG


126 
æag
 = '--%s' % 
BREAK_ON_FAILURE_FLAG


128 
commªd
 = [
EXE_PATH
]

129 
æag
:

130 
commªd
.
	$­³nd
(
æag
)

132 
ex³ù_£g_çuÉ
:

133 
should_Ü_nÙ
 = 'should'

135 
should_Ü_nÙ
 = 'should‚ot'

137 
has_£g_çuÉ
 = 
	$Run
(
commªd
)

139 
	$S‘EnvV¬
(
BREAK_ON_FAILURE_ENV_VAR
, 
NÚe
)

141 
msg
 = ('when %s%s,‡n‡ssertion failure in "%s" %s cause‡ seg-fault.' %

142 (
BREAK_ON_FAILURE_ENV_VAR
, 
’v_v¬_v®ue_msg
, ' '.
	`još
(
commªd
),

143 
should_Ü_nÙ
))

144 
£lf
.
	$as£¹_
(
has_£g_çuÉ
 =ğ
ex³ù_£g_çuÉ
, 
msg
)

146 
def
 
	$‹¡DeçuÉBehaviÜ
(
£lf
):

149 
£lf
.
	$RunAndV”ify
(
’v_v¬_v®ue
=
NÚe
,

150 
æag_v®ue
=
NÚe
,

151 
ex³ù_£g_çuÉ
=0)

153 
def
 
	$‹¡EnvV¬
(
£lf
):

156 
£lf
.
	`RunAndV”ify
(
’v_v¬_v®ue
='0',

157 
æag_v®ue
=
NÚe
,

158 
ex³ù_£g_çuÉ
=0)

159 
£lf
.
	`RunAndV”ify
(
’v_v¬_v®ue
='1',

160 
æag_v®ue
=
NÚe
,

161 
ex³ù_£g_çuÉ
=1)

163 
def
 
	$‹¡FÏg
(
£lf
):

166 
£lf
.
	`RunAndV”ify
(
’v_v¬_v®ue
=
NÚe
,

167 
æag_v®ue
='0',

168 
ex³ù_£g_çuÉ
=0)

169 
£lf
.
	`RunAndV”ify
(
’v_v¬_v®ue
=
NÚe
,

170 
æag_v®ue
='1',

171 
ex³ù_£g_çuÉ
=1)

173 
def
 
	$‹¡FÏgOv”ridesEnvV¬
(
£lf
):

176 
£lf
.
	`RunAndV”ify
(
’v_v¬_v®ue
='0',

177 
æag_v®ue
='0',

178 
ex³ù_£g_çuÉ
=0)

179 
£lf
.
	`RunAndV”ify
(
’v_v¬_v®ue
='0',

180 
æag_v®ue
='1',

181 
ex³ù_£g_çuÉ
=1)

182 
£lf
.
	`RunAndV”ify
(
’v_v¬_v®ue
='1',

183 
æag_v®ue
='0',

184 
ex³ù_£g_çuÉ
=0)

185 
£lf
.
	`RunAndV”ify
(
’v_v¬_v®ue
='1',

186 
æag_v®ue
='1',

187 
ex³ù_£g_çuÉ
=1)

189 
def
 
	$‹¡B»akOnFau»Ov”ridesThrowOnFau»
(
£lf
):

192 
	`S‘EnvV¬
(
THROW_ON_FAILURE_ENV_VAR
, '1')

193 
Œy
:

194 
£lf
.
	`RunAndV”ify
(
’v_v¬_v®ue
=
NÚe
,

195 
æag_v®ue
='1',

196 
ex³ù_£g_çuÉ
=1)

197 
fš®ly
:

198 
	$S‘EnvV¬
(
THROW_ON_FAILURE_ENV_VAR
, 
NÚe
)

200 
IS_WINDOWS
:

201 
def
 
	$‹¡C©chExû±iÚsDÛsNÙIÁ”ã»
(
£lf
):

204 
	`S‘EnvV¬
(
CATCH_EXCEPTIONS_ENV_VAR
, '1')

205 
Œy
:

206 
£lf
.
	`RunAndV”ify
(
’v_v¬_v®ue
='1',

207 
æag_v®ue
='1',

208 
ex³ù_£g_çuÉ
=1)

209 
fš®ly
:

210 
	$S‘EnvV¬
(
CATCH_EXCEPTIONS_ENV_VAR
, 
NÚe
)

213 
__Çme__
 == '__main__':

214 
g‹¡_‹¡_uts
.
	`Maš
()

	@trunk/objs/gtest-1.6.0/test/gtest_catch_exceptions_test.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


2 #
#Cİyrighˆ2010 
GoogË
 
Inc
. 
AÎ
 
Rights
 
Re£rved
.

3 #
#Redi¡ributiÚ 
ªd
 
u£
 
š
 
sourû
‡nd 
bš¬y
 
fÜms
, 
w™h
 
Ü
 
w™hout


4 #modifiÿtiÚ, 
¬e
 
³rm™‹d
 
´ovided
 
th©
 
the
 
fŞlowšg
 
cÚd™iÚs
‡re

6 #
#* 
Redi¡ributiÚs
 
of
 
sourû
 
code
 
mu¡
 
»š
 
the
 
above
 
cİyright


7 #nÙiû, 
this
 
li¡
 
of
 
cÚd™iÚs
 
ªd
 
the
 
fŞlowšg
 
disşaim”
.

8 #* 
Redi¡ributiÚs
 
š
 
bš¬y
 
fÜm
 
mu¡
 
»´oduû
 
the
 
above


9 #cİyrighˆ
nÙiû
, 
this
 
li¡
 
of
 
cÚd™iÚs
 
ªd
 
the
 
fŞlowšg
 
disşaim”


10 #š 
the
 
docum’tiÚ
 
ªd
/
Ü
 
Ùh”
 
m©”Ÿls
 
´ovided
 
w™h
he

12 #* 
Ne™h”
 
the
 
Çme
 
of
 
GoogË
 
Inc
. 
nÜ
h
Çmes
 oà
™s


13 #cÚŒibutÜ 
may
 
be
 
u£d
 
to
 
’dÜ£
 
Ü
 
´omÙe
 
´oduùs
 
d”ived
 
äom


14 #thi 
soáw¬e
 
w™hout
 
¥ecific
 
´iÜ
 
wr™‹n
 
³rmissiÚ
.

15 #
#THIS 
SOFTWARE
 
IS
 
PROVIDED
 
BY
 
THE
 
COPYRIGHT
 
HOLDERS
 
AND
 
CONTRIBUTORS


16 #"
AS
 
IS
" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT

17 #LIMITED 
TO
, 
THE
 
IMPLIED
 
WARRANTIES
 
OF
 
MERCHANTABILITY
 
AND
 
FITNESS
 
FOR


18 #A 
PARTICULAR
 
PURPOSE
 
ARE
 
DISCLAIMED
. 
IN
 
NO
 
EVENT
 
SHALL
 
THE
 
COPYRIGHT


19 #OWNER 
OR
 
CONTRIBUTORS
 
BE
 
LIABLE
 
FOR
 
ANY
 
DIRECT
, 
INDIRECT
, 
INCIDENTAL
,

20 #SPECIAL, 
EXEMPLARY
, 
OR
 
CONSEQUENTIAL
 
DAMAGES
 (
INCLUDING
, 
BUT
 
NOT


21 #LIMITED 
TO
, 
PROCUREMENT
 
OF
 
SUBSTITUTE
 
GOODS
 
OR
 
SERVICES
; 
LOSS
 OF 
USE
,

22 #DATA, 
OR
 
PROFITS
; OR 
BUSINESS
 
INTERRUPTION
è
HOWEVER
 
CAUSED
 
AND
 
ON
 
ANY


23 #THEORY 
OF
 
LIABILITY
, 
WHETHER
 
IN
 
CONTRACT
, 
STRICT
 LIABILITY, 
OR
 
TORT


24 #(
INCLUDING
 
NEGLIGENCE
 
OR
 
OTHERWISE
è
ARISING
 
IN
 
ANY
 
WAY
 
OUT
 
OF
 
THE
 
USE


25 #OF 
THIS
 
SOFTWARE
, 
EVEN
 
IF
 
ADVISED
 
OF
 
THE
 
POSSIBILITY
 OF 
SUCH
 
DAMAGE
.

29 
This
 
süt
 
švokes
 
g‹¡_ÿtch_exû±iÚs_‹¡_
 
ªd


30 
	$g‹¡_ÿtch_exû±iÚs_ex_‹¡_
 (
´og¿ms
 
wr™‹n
 
w™h


31 
GoogË
 
Te¡
è
ªd
 
v”if›s
 
theœ
 
ouut
.

34 
__authÜ__
 = 'vladl@google.com (Vlad Losev)'

36 
impÜt
 
os


38 
impÜt
 
g‹¡_‹¡_uts


41 
FLAG_PREFIX
 = '--gtest_'

42 
LIST_TESTS_FLAG
 = 
FLAG_PREFIX
 + 'list_tests'

43 
NO_CATCH_EXCEPTIONS_FLAG
 = 
FLAG_PREFIX
 + 'catch_exceptions=0'

44 
FILTER_FLAG
 = 
FLAG_PREFIX
 + 'filter'

46 #P©h 
to
 
the
 
g‹¡_ÿtch_exû±iÚs_ex_‹¡_
 
bš¬y
, 
comped
 
w™h


47 #exû±iÚ 
’abËd
.

48 
EX_EXE_PATH
 = 
g‹¡_‹¡_uts
.
	`G‘Te¡ExecubËP©h
(

51 #P©h 
to
 
the
 
g‹¡_ÿtch_exû±iÚs_‹¡_
 
bš¬y
, 
comped
 
w™h


52 #exû±iÚ 
di§bËd
.

53 
EXE_PATH
 = 
g‹¡_‹¡_uts
.
	`G‘Te¡ExecubËP©h
(

56 
TEST_LIST
 = 
g‹¡_‹¡_uts
.
	`Sub´oûss
([
EXE_PATH
, 
LIST_TESTS_FLAG
]).
ouut


58 
SUPPORTS_SEH_EXCEPTIONS
 = 'ThrowsSehExû±iÚ' 
š
 
TEST_LIST


60 
SUPPORTS_SEH_EXCEPTIONS
:

61 
BINARY_OUTPUT
 = 
g‹¡_‹¡_uts
.
	`Sub´oûss
([
EXE_PATH
]).
ouut


63 
EX_BINARY_OUTPUT
 = 
g‹¡_‹¡_uts
.
	`Sub´oûss
([
EX_EXE_PATH
]).
ouut


65 #Th
‹¡s
.

66 
SUPPORTS_SEH_EXCEPTIONS
:

67 #pylšt:
di§bË
-
msg
=
C6302


68 
şass
 
	$C©chSehExû±iÚsTe¡
(
g‹¡_‹¡_uts
.
Te¡Ca£
):

72 
def
 
	$Te¡SehExû±iÚs
(
£lf
, 
‹¡_ouut
):

73 
£lf
.
	`as£¹_
('SEHƒxception with code 0x2ahrown '

75 
š
 
‹¡_ouut
)

76 
£lf
.
	`as£¹_
('SEHƒxception with code 0x2ahrown '

78 
š
 
‹¡_ouut
)

79 
£lf
.
	`as£¹_
('SEHƒxception with code 0x2ahrown in SetUpTestCase()'

80 
š
 
‹¡_ouut
)

81 
£lf
.
	`as£¹_
('SEHƒxception with code 0x2ahrown in TearDownTestCase()'

82 
š
 
‹¡_ouut
)

83 
£lf
.
	`as£¹_
('SEHƒxception with code 0x2ahrown in SetUp()'

84 
š
 
‹¡_ouut
)

85 
£lf
.
	`as£¹_
('SEHƒxception with code 0x2ahrown in TearDown()'

86 
š
 
‹¡_ouut
)

87 
£lf
.
	`as£¹_
('SEHƒxception with code 0x2ahrown inheest body'

88 
š
 
‹¡_ouut
)

90 
def
 
	$‹¡C©chesSehExû±iÚsW™hCxxExû±iÚsEÇbËd
(
£lf
):

91 
£lf
.
	$Te¡SehExû±iÚs
(
EX_BINARY_OUTPUT
)

93 
def
 
	$‹¡C©chesSehExû±iÚsW™hCxxExû±iÚsDi§bËd
(
£lf
):

94 
£lf
.
	$Te¡SehExû±iÚs
(
BINARY_OUTPUT
)

97 
şass
 
	$C©chCxxExû±iÚsTe¡
(
g‹¡_‹¡_uts
.
Te¡Ca£
):

100 
Te¡s
 
š
 
this
 
‹¡
 
v”ify
 
th©
:

101 * 
C
++ 
exû±iÚs
 
¬e
 
ÿught
 
ªd
 
logged
 
as
 C++ (
nÙ
 
SEH
)ƒxceptions

102 * 
Exû±iÚ
 
thrown
 
afãù
 
the
 
»mašd”
 
of
h
‹¡
 
wÜk
 
æow
 
š
he

103 
ex³ùed
 
mªÃr
.

106 
def
 
	$‹¡C©chesCxxExû±iÚsInFixtu»CÚ¡ruùÜ
(
£lf
):

107 
£lf
.
	`as£¹_
('C++ƒxception with description '

110 
š
 
EX_BINARY_OUTPUT
)

111 
£lf
.
	`as£¹_
('uÃx³ùed' 
nÙ
 
š
 
EX_BINARY_OUTPUT
,

116 
def
 
	$‹¡C©chesCxxExû±iÚsInFixtu»De¡ruùÜ
(
£lf
):

117 
£lf
.
	`as£¹_
('C++ƒxception with description '

120 
š
 
EX_BINARY_OUTPUT
)

121 
£lf
.
	`as£¹_
('CxxExceptionInDestructorTest::TearDownTestCase() '

123 
š
 
EX_BINARY_OUTPUT
)

125 
def
 
	$‹¡C©chesCxxExû±iÚsInS‘UpTe¡Ca£
(
£lf
):

126 
£lf
.
	`as£¹_
('C++ƒxception with description "Standard C++ƒxception"'

128 
š
 
EX_BINARY_OUTPUT
)

129 
£lf
.
	`as£¹_
('CxxExceptionInConstructorTest::TearDownTestCase() '

131 
š
 
EX_BINARY_OUTPUT
)

132 
£lf
.
	`as£¹_
('CxxExceptionInSetUpTestCaseTest constructor '

134 
š
 
EX_BINARY_OUTPUT
)

135 
£lf
.
	`as£¹_
('CxxExceptionInSetUpTestCaseTest destructor '

137 
š
 
EX_BINARY_OUTPUT
)

138 
£lf
.
	`as£¹_
('CxxExceptionInSetUpTestCaseTest::SetUp() '

140 
š
 
EX_BINARY_OUTPUT
)

141 
£lf
.
	`as£¹_
('CxxExceptionInSetUpTestCaseTest::TearDown() '

143 
š
 
EX_BINARY_OUTPUT
)

144 
£lf
.
	`as£¹_
('CxxExceptionInSetUpTestCaseTestest body '

146 
š
 
EX_BINARY_OUTPUT
)

148 
def
 
	$‹¡C©chesCxxExû±iÚsInT—rDownTe¡Ca£
(
£lf
):

149 
£lf
.
	`as£¹_
('C++ƒxception with description "Standard C++ƒxception"'

151 
š
 
EX_BINARY_OUTPUT
)

153 
def
 
	$‹¡C©chesCxxExû±iÚsInS‘Up
(
£lf
):

154 
£lf
.
	`as£¹_
('C++ƒxception with description "Standard C++ƒxception"'

156 
š
 
EX_BINARY_OUTPUT
)

157 
£lf
.
	`as£¹_
('CxxExceptionInSetUpTest::TearDownTestCase() '

159 
š
 
EX_BINARY_OUTPUT
)

160 
£lf
.
	`as£¹_
('CxxExceptionInSetUpTest destructor '

162 
š
 
EX_BINARY_OUTPUT
)

163 
£lf
.
	`as£¹_
('CxxExceptionInSetUpTest::TearDown() '

165 
š
 
EX_BINARY_OUTPUT
)

166 
£lf
.
	`as£¹_
('uÃx³ùed' 
nÙ
 
š
 
EX_BINARY_OUTPUT
,

171 
def
 
	$‹¡C©chesCxxExû±iÚsInT—rDown
(
£lf
):

172 
£lf
.
	`as£¹_
('C++ƒxception with description "Standard C++ƒxception"'

174 
š
 
EX_BINARY_OUTPUT
)

175 
£lf
.
	`as£¹_
('CxxExceptionInTearDownTest::TearDownTestCase() '

177 
š
 
EX_BINARY_OUTPUT
)

178 
£lf
.
	`as£¹_
('CxxExceptionInTearDownTest destructor '

180 
š
 
EX_BINARY_OUTPUT
)

182 
def
 
	$‹¡C©chesCxxExû±iÚsInTe¡Body
(
£lf
):

183 
£lf
.
	`as£¹_
('C++ƒxception with description "Standard C++ƒxception"'

185 
š
 
EX_BINARY_OUTPUT
)

186 
£lf
.
	`as£¹_
('CxxExceptionInTestBodyTest::TearDownTestCase() '

188 
š
 
EX_BINARY_OUTPUT
)

189 
£lf
.
	`as£¹_
('CxxExceptionInTestBodyTest destructor '

191 
š
 
EX_BINARY_OUTPUT
)

192 
£lf
.
	`as£¹_
('CxxExceptionInTestBodyTest::TearDown() '

194 
š
 
EX_BINARY_OUTPUT
)

196 
def
 
	$‹¡C©chesNÚStdCxxExû±iÚs
(
£lf
):

197 
£lf
.
	`as£¹_
('Unknown C++ƒxceptionhrown inheest body'

198 
š
 
EX_BINARY_OUTPUT
)

200 
def
 
	$‹¡UnhªdËdCxxExû±iÚsAbÜtTheProg¿m
(
£lf
):

201 #F‹r 
out
 
SEH
 
exû±iÚ
 
‹¡s
 
Ú
 
Wšdows
. 
UnhªdËd
 SEH 
exû±iÚs


202 #ÿu£ 
‹¡s
 
to
 
show
 
pİ
-
up
 
wšdows
 
th”e
.

203 
FITLER_OUT_SEH_TESTS_FLAG
 = 
FILTER_FLAG
 + '=-*Seh*'

204 #By , 
GoogË
 
Te¡
 
dÛ¢
't catchheƒxceptions.

205 
unÿught_exû±iÚs_ex_bš¬y_ouut
 = 
g‹¡_‹¡_uts
.
	`Sub´oûss
(

206 [
EX_EXE_PATH
,

207 
NO_CATCH_EXCEPTIONS_FLAG
,

208 
FITLER_OUT_SEH_TESTS_FLAG
]).
ouut


210 
£lf
.
	`as£¹_
('Unhandled C++ƒxceptionerminatinghe…rogram'

211 
š
 
unÿught_exû±iÚs_ex_bš¬y_ouut
)

212 
£lf
.
	`as£¹_
('uÃx³ùed' 
nÙ
 
š
 
unÿught_exû±iÚs_ex_bš¬y_ouut
)

215 
__Çme__
 == '__main__':

216 
g‹¡_‹¡_uts
.
	`Maš
()

	@trunk/objs/gtest-1.6.0/test/gtest_color_test.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


2 #
#Cİyrighˆ2008, 
GoogË
 
Inc
.

3 #AÎ 
rights
 
»£rved
.

4 #
#Redi¡ributiÚ 
ªd
 
u£
 
š
 
sourû
‡nd 
bš¬y
 
fÜms
, 
w™h
 
Ü
 
w™hout


5 #modifiÿtiÚ, 
¬e
 
³rm™‹d
 
´ovided
 
th©
 
the
 
fŞlowšg
 
cÚd™iÚs
‡re

7 #
#* 
Redi¡ributiÚs
 
of
 
sourû
 
code
 
mu¡
 
»š
 
the
 
above
 
cİyright


8 #nÙiû, 
this
 
li¡
 
of
 
cÚd™iÚs
 
ªd
 
the
 
fŞlowšg
 
disşaim”
.

9 #* 
Redi¡ributiÚs
 
š
 
bš¬y
 
fÜm
 
mu¡
 
»´oduû
 
the
 
above


10 #cİyrighˆ
nÙiû
, 
this
 
li¡
 
of
 
cÚd™iÚs
 
ªd
 
the
 
fŞlowšg
 
disşaim”


11 #š 
the
 
docum’tiÚ
 
ªd
/
Ü
 
Ùh”
 
m©”Ÿls
 
´ovided
 
w™h
he

13 #* 
Ne™h”
 
the
 
Çme
 
of
 
GoogË
 
Inc
. 
nÜ
h
Çmes
 oà
™s


14 #cÚŒibutÜ 
may
 
be
 
u£d
 
to
 
’dÜ£
 
Ü
 
´omÙe
 
´oduùs
 
d”ived
 
äom


15 #thi 
soáw¬e
 
w™hout
 
¥ecific
 
´iÜ
 
wr™‹n
 
³rmissiÚ
.

16 #
#THIS 
SOFTWARE
 
IS
 
PROVIDED
 
BY
 
THE
 
COPYRIGHT
 
HOLDERS
 
AND
 
CONTRIBUTORS


17 #"
AS
 
IS
" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT

18 #LIMITED 
TO
, 
THE
 
IMPLIED
 
WARRANTIES
 
OF
 
MERCHANTABILITY
 
AND
 
FITNESS
 
FOR


19 #A 
PARTICULAR
 
PURPOSE
 
ARE
 
DISCLAIMED
. 
IN
 
NO
 
EVENT
 
SHALL
 
THE
 
COPYRIGHT


20 #OWNER 
OR
 
CONTRIBUTORS
 
BE
 
LIABLE
 
FOR
 
ANY
 
DIRECT
, 
INDIRECT
, 
INCIDENTAL
,

21 #SPECIAL, 
EXEMPLARY
, 
OR
 
CONSEQUENTIAL
 
DAMAGES
 (
INCLUDING
, 
BUT
 
NOT


22 #LIMITED 
TO
, 
PROCUREMENT
 
OF
 
SUBSTITUTE
 
GOODS
 
OR
 
SERVICES
; 
LOSS
 OF 
USE
,

23 #DATA, 
OR
 
PROFITS
; OR 
BUSINESS
 
INTERRUPTION
è
HOWEVER
 
CAUSED
 
AND
 
ON
 
ANY


24 #THEORY 
OF
 
LIABILITY
, 
WHETHER
 
IN
 
CONTRACT
, 
STRICT
 LIABILITY, 
OR
 
TORT


25 #(
INCLUDING
 
NEGLIGENCE
 
OR
 
OTHERWISE
è
ARISING
 
IN
 
ANY
 
WAY
 
OUT
 
OF
 
THE
 
USE


26 #OF 
THIS
 
SOFTWARE
, 
EVEN
 
IF
 
ADVISED
 
OF
 
THE
 
POSSIBILITY
 OF 
SUCH
 
DAMAGE
.

30 
	g__authÜ__
 = 'wan@google.com (Zhanyong Wan)'

32 
impÜt
 
os


33 
impÜt
 
g‹¡_‹¡_uts


36 
IS_WINDOWS
 = 
os
.
Çme
 = 'nt'

38 
COLOR_ENV_VAR
 = 'GTEST_COLOR'

39 
COLOR_FLAG
 = 'gtest_color'

40 
COMMAND
 = 
g‹¡_‹¡_uts
.
G‘Te¡ExecubËP©h
('gtest_color_test_')

43 
def
 
	$S‘EnvV¬
(
’v_v¬
, 
v®ue
):

46 
v®ue
 
is
 
nÙ
 
NÚe
:

47 
os
.
’vœÚ
[
’v_v¬
] = 
v®ue


48 
–if
 
’v_v¬
 
š
 
os
.
’vœÚ
:

49 
d–
 
os
.
’vœÚ
[
’v_v¬
]

52 
def
 
	$U£sCŞÜ
(
‹rm
, 
cŞÜ_’v_v¬
, 
cŞÜ_æag
):

55 
	`S‘EnvV¬
('TERM', 
‹rm
)

56 
	$S‘EnvV¬
(
COLOR_ENV_VAR
, 
cŞÜ_’v_v¬
)

58 
cŞÜ_æag
 
is
 
NÚe
:

59 
¬gs
 = []

61 
¬gs
 = ['--%s=%s' % (
COLOR_FLAG
, 
cŞÜ_æag
)]

62 
p
 = 
g‹¡_‹¡_uts
.
	`Sub´oûss
([
COMMAND
] + 
¬gs
)

63  
nÙ
 
p
.
ex™ed
 
Ü
….
ex™_code


66 
şass
 
	$GTe¡CŞÜTe¡
(
g‹¡_‹¡_uts
.
Te¡Ca£
):

67 
def
 
	$‹¡NoEnvV¬NoFÏg
(
£lf
):

70 
nÙ
 
IS_WINDOWS
:

71 
£lf
.
	`as£¹_
(
nÙ
 
	`U£sCŞÜ
('dumb', 
NÚe
, None))

72 
£lf
.
	`as£¹_
(
nÙ
 
	`U£sCŞÜ
('emacs', 
NÚe
, None))

73 
£lf
.
	`as£¹_
(
nÙ
 
	`U£sCŞÜ
('x‹rm-mÚo', 
NÚe
, None))

74 
£lf
.
	`as£¹_
(
nÙ
 
	`U£sCŞÜ
('unknown', 
NÚe
, None))

75 
£lf
.
	`as£¹_
(
nÙ
 
	$U£sCŞÜ
(
NÚe
, None, None))

76 
£lf
.
	`as£¹_
(
	`U£sCŞÜ
('lšux', 
NÚe
, None))

77 
£lf
.
	`as£¹_
(
	`U£sCŞÜ
('cygwš', 
NÚe
, None))

78 
£lf
.
	`as£¹_
(
	`U£sCŞÜ
('x‹rm', 
NÚe
, None))

79 
£lf
.
	`as£¹_
(
	`U£sCŞÜ
('x‹rm-cŞÜ', 
NÚe
, None))

80 
£lf
.
	`as£¹_
(
	`U£sCŞÜ
('x‹rm-256cŞÜ', 
NÚe
, None))

82 
def
 
	$‹¡FÏgOÆy
(
£lf
):

85 
£lf
.
	`as£¹_
(
nÙ
 
	`U£sCŞÜ
('dumb', 
NÚe
, 'no'))

86 
£lf
.
	`as£¹_
(
nÙ
 
	`U£sCŞÜ
('x‹rm-cŞÜ', 
NÚe
, 'no'))

87 
nÙ
 
IS_WINDOWS
:

88 
£lf
.
	`as£¹_
(
nÙ
 
	`U£sCŞÜ
('emacs', 
NÚe
, 'auto'))

89 
£lf
.
	`as£¹_
(
	`U£sCŞÜ
('x‹rm', 
NÚe
, 'auto'))

90 
£lf
.
	`as£¹_
(
	`U£sCŞÜ
('dumb', 
NÚe
, 'yes'))

91 
£lf
.
	`as£¹_
(
	`U£sCŞÜ
('x‹rm', 
NÚe
, 'yes'))

93 
def
 
	$‹¡EnvV¬OÆy
(
£lf
):

96 
£lf
.
	`as£¹_
(
nÙ
 
	`U£sCŞÜ
('dumb', 'no', 
NÚe
))

97 
£lf
.
	`as£¹_
(
nÙ
 
	`U£sCŞÜ
('x‹rm-cŞÜ', 'no', 
NÚe
))

98 
nÙ
 
IS_WINDOWS
:

99 
£lf
.
	`as£¹_
(
nÙ
 
	`U£sCŞÜ
('dumb', 'auto', 
NÚe
))

100 
£lf
.
	`as£¹_
(
	`U£sCŞÜ
('x‹rm-cŞÜ', 'auto', 
NÚe
))

101 
£lf
.
	`as£¹_
(
	`U£sCŞÜ
('dumb', 'yes', 
NÚe
))

102 
£lf
.
	`as£¹_
(
	`U£sCŞÜ
('x‹rm-cŞÜ', 'yes', 
NÚe
))

104 
def
 
	$‹¡EnvV¬AndFÏg
(
£lf
):

107 
£lf
.
	`as£¹_
(
nÙ
 
	`U£sCŞÜ
('xterm-color', 'no', 'no'))

108 
£lf
.
	`as£¹_
(
	`U£sCŞÜ
('dumb', 'no', 'yes'))

109 
£lf
.
	`as£¹_
(
	`U£sCŞÜ
('xterm-color', 'no', 'auto'))

111 
def
 
	$‹¡AlŸ£sOfYesAndNo
(
£lf
):

114 
£lf
.
	`as£¹_
(
	`U£sCŞÜ
('dumb', 
NÚe
, 'true'))

115 
£lf
.
	`as£¹_
(
	`U£sCŞÜ
('dumb', 
NÚe
, 'YES'))

116 
£lf
.
	`as£¹_
(
	`U£sCŞÜ
('dumb', 
NÚe
, 'T'))

117 
£lf
.
	`as£¹_
(
	`U£sCŞÜ
('dumb', 
NÚe
, '1'))

119 
£lf
.
	`as£¹_
(
nÙ
 
	`U£sCŞÜ
('x‹rm', 
NÚe
, 'f'))

120 
£lf
.
	`as£¹_
(
nÙ
 
	`U£sCŞÜ
('x‹rm', 
NÚe
, 'false'))

121 
£lf
.
	`as£¹_
(
nÙ
 
	`U£sCŞÜ
('x‹rm', 
NÚe
, '0'))

122 
£lf
.
	`as£¹_
(
nÙ
 
	`U£sCŞÜ
('x‹rm', 
NÚe
, 'unknown'))

125 
__Çme__
 == '__main__':

126 
g‹¡_‹¡_uts
.
	`Maš
()

	@trunk/objs/gtest-1.6.0/test/gtest_env_var_test.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


2 #
#Cİyrighˆ2008, 
GoogË
 
Inc
.

3 #AÎ 
rights
 
»£rved
.

4 #
#Redi¡ributiÚ 
ªd
 
u£
 
š
 
sourû
‡nd 
bš¬y
 
fÜms
, 
w™h
 
Ü
 
w™hout


5 #modifiÿtiÚ, 
¬e
 
³rm™‹d
 
´ovided
 
th©
 
the
 
fŞlowšg
 
cÚd™iÚs
‡re

7 #
#* 
Redi¡ributiÚs
 
of
 
sourû
 
code
 
mu¡
 
»š
 
the
 
above
 
cİyright


8 #nÙiû, 
this
 
li¡
 
of
 
cÚd™iÚs
 
ªd
 
the
 
fŞlowšg
 
disşaim”
.

9 #* 
Redi¡ributiÚs
 
š
 
bš¬y
 
fÜm
 
mu¡
 
»´oduû
 
the
 
above


10 #cİyrighˆ
nÙiû
, 
this
 
li¡
 
of
 
cÚd™iÚs
 
ªd
 
the
 
fŞlowšg
 
disşaim”


11 #š 
the
 
docum’tiÚ
 
ªd
/
Ü
 
Ùh”
 
m©”Ÿls
 
´ovided
 
w™h
he

13 #* 
Ne™h”
 
the
 
Çme
 
of
 
GoogË
 
Inc
. 
nÜ
h
Çmes
 oà
™s


14 #cÚŒibutÜ 
may
 
be
 
u£d
 
to
 
’dÜ£
 
Ü
 
´omÙe
 
´oduùs
 
d”ived
 
äom


15 #thi 
soáw¬e
 
w™hout
 
¥ecific
 
´iÜ
 
wr™‹n
 
³rmissiÚ
.

16 #
#THIS 
SOFTWARE
 
IS
 
PROVIDED
 
BY
 
THE
 
COPYRIGHT
 
HOLDERS
 
AND
 
CONTRIBUTORS


17 #"
AS
 
IS
" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT

18 #LIMITED 
TO
, 
THE
 
IMPLIED
 
WARRANTIES
 
OF
 
MERCHANTABILITY
 
AND
 
FITNESS
 
FOR


19 #A 
PARTICULAR
 
PURPOSE
 
ARE
 
DISCLAIMED
. 
IN
 
NO
 
EVENT
 
SHALL
 
THE
 
COPYRIGHT


20 #OWNER 
OR
 
CONTRIBUTORS
 
BE
 
LIABLE
 
FOR
 
ANY
 
DIRECT
, 
INDIRECT
, 
INCIDENTAL
,

21 #SPECIAL, 
EXEMPLARY
, 
OR
 
CONSEQUENTIAL
 
DAMAGES
 (
INCLUDING
, 
BUT
 
NOT


22 #LIMITED 
TO
, 
PROCUREMENT
 
OF
 
SUBSTITUTE
 
GOODS
 
OR
 
SERVICES
; 
LOSS
 OF 
USE
,

23 #DATA, 
OR
 
PROFITS
; OR 
BUSINESS
 
INTERRUPTION
è
HOWEVER
 
CAUSED
 
AND
 
ON
 
ANY


24 #THEORY 
OF
 
LIABILITY
, 
WHETHER
 
IN
 
CONTRACT
, 
STRICT
 LIABILITY, 
OR
 
TORT


25 #(
INCLUDING
 
NEGLIGENCE
 
OR
 
OTHERWISE
è
ARISING
 
IN
 
ANY
 
WAY
 
OUT
 
OF
 
THE
 
USE


26 #OF 
THIS
 
SOFTWARE
, 
EVEN
 
IF
 
ADVISED
 
OF
 
THE
 
POSSIBILITY
 OF 
SUCH
 
DAMAGE
.

30 
	g__authÜ__
 = 'wan@google.com (Zhanyong Wan)'

32 
impÜt
 
os


33 
impÜt
 
g‹¡_‹¡_uts


36 
IS_WINDOWS
 = 
os
.
Çme
 == 'nt'

37 
IS_LINUX
 = 
os
.
Çme
 =ğ'posix' 
ªd
 os.
uÇme
()[0] == 'Linux'

39 
COMMAND
 = 
g‹¡_‹¡_uts
.
G‘Te¡ExecubËP©h
('gtest_env_var_test_')

41 
’vœÚ
 = 
os
.’vœÚ.
	$cİy
()

44 
def
 
	$As£¹Eq
(
ex³ùed
, 
aùu®
):

45 
ex³ùed
 !ğ
aùu®
:

46 
´št
 'Ex³ùed: %s' % (
ex³ùed
,)

47 
´št
 ' Aùu®: %s' % (
aùu®
,)

48 
¿i£
 
As£¹iÚE¼Ü


51 
def
 
	$S‘EnvV¬
(
’v_v¬
, 
v®ue
):

54 
v®ue
 
is
 
nÙ
 
NÚe
:

55 
’vœÚ
[
’v_v¬
] = 
v®ue


56 
–if
 
’v_v¬
 
š
 
’vœÚ
:

57 
d–
 
’vœÚ
[
’v_v¬
]

60 
def
 
	$G‘FÏg
(
æag
):

63 
¬gs
 = [
COMMAND
]

64 
æag
 
is
 
nÙ
 
NÚe
:

65 
¬gs
 +ğ[
æag
]

66  
g‹¡_‹¡_uts
.
	`Sub´oûss
(
¬gs
, 
’v
=
’vœÚ
).
ouut


69 
def
 
	$Te¡FÏg
(
æag
, 
‹¡_v®
, 
deçuÉ_v®
):

72 
’v_v¬
 = 'GTEST_' + 
æag
.
	$uµ”
()

73 
	$S‘EnvV¬
(
’v_v¬
, 
‹¡_v®
)

74 
	`As£¹Eq
(
‹¡_v®
, 
	$G‘FÏg
(
æag
))

75 
	$S‘EnvV¬
(
’v_v¬
, 
NÚe
)

76 
	`As£¹Eq
(
deçuÉ_v®
, 
	$G‘FÏg
(
æag
))

79 
şass
 
	$GTe¡EnvV¬Te¡
(
g‹¡_‹¡_uts
.
Te¡Ca£
):

80 
def
 
	$‹¡EnvV¬AfãùsFÏg
(
£lf
):

83 
	`Te¡FÏg
('break_on_failure', '1', '0')

84 
	`Te¡FÏg
('color', 'yes', 'auto')

85 
	`Te¡FÏg
('filter', 'FooTest.Bar', '*')

86 
	`Te¡FÏg
('output', 'xml:tmp/foo.xml', '')

87 
	`Te¡FÏg
('print_time', '0', '1')

88 
	`Te¡FÏg
('repeat', '999', '1')

89 
	`Te¡FÏg
('throw_on_failure', '1', '0')

90 
	`Te¡FÏg
('death_test_style', 'threadsafe', 'fast')

91 
	`Te¡FÏg
('catch_exceptions', '0', '1')

93 
IS_LINUX
:

94 
	`Te¡FÏg
('death_test_use_fork', '1', '0')

95 
	`Te¡FÏg
('stack_trace_depth', '0', '100')

98 
__Çme__
 == '__main__':

99 
g‹¡_‹¡_uts
.
	`Maš
()

	@trunk/objs/gtest-1.6.0/test/gtest_filter_unittest.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


2 #
#Cİyrighˆ2005 
GoogË
 
Inc
. 
AÎ
 
Rights
 
Re£rved
.

3 #
#Redi¡ributiÚ 
ªd
 
u£
 
š
 
sourû
‡nd 
bš¬y
 
fÜms
, 
w™h
 
Ü
 
w™hout


4 #modifiÿtiÚ, 
¬e
 
³rm™‹d
 
´ovided
 
th©
 
the
 
fŞlowšg
 
cÚd™iÚs
‡re

6 #
#* 
Redi¡ributiÚs
 
of
 
sourû
 
code
 
mu¡
 
»š
 
the
 
above
 
cİyright


7 #nÙiû, 
this
 
li¡
 
of
 
cÚd™iÚs
 
ªd
 
the
 
fŞlowšg
 
disşaim”
.

8 #* 
Redi¡ributiÚs
 
š
 
bš¬y
 
fÜm
 
mu¡
 
»´oduû
 
the
 
above


9 #cİyrighˆ
nÙiû
, 
this
 
li¡
 
of
 
cÚd™iÚs
 
ªd
 
the
 
fŞlowšg
 
disşaim”


10 #š 
the
 
docum’tiÚ
 
ªd
/
Ü
 
Ùh”
 
m©”Ÿls
 
´ovided
 
w™h
he

12 #* 
Ne™h”
 
the
 
Çme
 
of
 
GoogË
 
Inc
. 
nÜ
h
Çmes
 oà
™s


13 #cÚŒibutÜ 
may
 
be
 
u£d
 
to
 
’dÜ£
 
Ü
 
´omÙe
 
´oduùs
 
d”ived
 
äom


14 #thi 
soáw¬e
 
w™hout
 
¥ecific
 
´iÜ
 
wr™‹n
 
³rmissiÚ
.

15 #
#THIS 
SOFTWARE
 
IS
 
PROVIDED
 
BY
 
THE
 
COPYRIGHT
 
HOLDERS
 
AND
 
CONTRIBUTORS


16 #"
AS
 
IS
" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT

17 #LIMITED 
TO
, 
THE
 
IMPLIED
 
WARRANTIES
 
OF
 
MERCHANTABILITY
 
AND
 
FITNESS
 
FOR


18 #A 
PARTICULAR
 
PURPOSE
 
ARE
 
DISCLAIMED
. 
IN
 
NO
 
EVENT
 
SHALL
 
THE
 
COPYRIGHT


19 #OWNER 
OR
 
CONTRIBUTORS
 
BE
 
LIABLE
 
FOR
 
ANY
 
DIRECT
, 
INDIRECT
, 
INCIDENTAL
,

20 #SPECIAL, 
EXEMPLARY
, 
OR
 
CONSEQUENTIAL
 
DAMAGES
 (
INCLUDING
, 
BUT
 
NOT


21 #LIMITED 
TO
, 
PROCUREMENT
 
OF
 
SUBSTITUTE
 
GOODS
 
OR
 
SERVICES
; 
LOSS
 OF 
USE
,

22 #DATA, 
OR
 
PROFITS
; OR 
BUSINESS
 
INTERRUPTION
è
HOWEVER
 
CAUSED
 
AND
 
ON
 
ANY


23 #THEORY 
OF
 
LIABILITY
, 
WHETHER
 
IN
 
CONTRACT
, 
STRICT
 LIABILITY, 
OR
 
TORT


24 #(
INCLUDING
 
NEGLIGENCE
 
OR
 
OTHERWISE
è
ARISING
 
IN
 
ANY
 
WAY
 
OUT
 
OF
 
THE
 
USE


25 #OF 
THIS
 
SOFTWARE
, 
EVEN
 
IF
 
ADVISED
 
OF
 
THE
 
POSSIBILITY
 OF 
SUCH
 
DAMAGE
.

29 
A
 
u£r
 
ÿn
 
¥ecify
 
which
 
	$‹¡
(
s
è
š
 
a
 
GoogË
 
Te¡
 
´og¿m
 
to
 
run
 
vŸ
 
e™h”


30 
the
 
GTEST_FILTER
 
’vœÚm’t
 
v¬ŸbË
 
Ü
h--
g‹¡_f‹r
 
æag
.

31 
This
 
süt
 
‹¡s
 
such
 
funùiÚ®™y
 
by
 
švokšg


32 
	$g‹¡_f‹r_un™‹¡_
 (
a
 
´og¿m
 
wr™‹n
 
w™h
 
GoogË
 
Te¡
èw™h 
difã»Á


33 
’vœÚm’ts
 
ªd
 
commªd
 
lše
 
æags
.

35 
NÙe
 
th©
 
‹¡
 
sh¬dšg
 
may
 
®so
 
šæu’û
 
which
 
‹¡s
 
¬e
 
f‹»d
. 
Th”efÜe
,

36 
we
 
‹¡
 
th©
 
h”e
 
®so
.

39 
__authÜ__
 = 'wan@google.com (Zhanyong Wan)'

41 
impÜt
 
os


42 
impÜt
 
»


43 
impÜt
 
£ts


44 
impÜt
 
sys


46 
impÜt
 
g‹¡_‹¡_uts


50 #Check 
this
 
¶©fÜm
 
ÿn
 
·ss
 
em±y
 
’vœÚm’t
 
v¬ŸbËs
 
to
 
chd


51 #´oûs£s. 
We
 
£t
 
ª
 
’v
 
v¬ŸbË
 
to
‡À
em±y
 
¡ršg
 
ªd
 
švoke
 
a
 
pythÚ


52 #süˆ
š
 
a
 
sub´oûss
 
to
 
´št
 
wh‘h”
 
the
 
v¬ŸbË
 
is
 
STILL
 in

53 #os.
’vœÚ
. 
We
 
th’
 
u£
 'ev®' 
to
 
·r£
 
the
 
chd
's output sohat‡n

54 #exû±iÚ 
is
 
thrown
 
the
 
šput
 i 
ªythšg
 
Ùh”
 
thª
 'True' 
nÜ
 'False'.

55 
os
.
’vœÚ
['EMPTY_VAR'] = ''

56 
chd
 = 
g‹¡_‹¡_uts
.
	`Sub´oûss
(

57 [
sys
.
execubË
, '-c', 'import os;…rint \'EMPTY_VAR\' in os.environ'])

58 
CAN_PASS_EMPTY_ENV
 = 
	$ev®
(
chd
.
ouut
)

61 #Check 
this
 
¶©fÜm
 
ÿn
 
un£t
 
’vœÚm’t
 
v¬ŸbËs
 
š
 
chd
 
´oûs£s
.

62 #W
£t
 
ª
 
’v
 
v¬ŸbË
 
to
 
a
 
nÚ
-
em±y
 
¡ršg
, 
un£t
 
™
, 
ªd
 
švoke


63 #¨
pythÚ
 
süt
 
š
 
a
 
sub´oûss
 
to
 
´št
 
wh‘h”
 
the
 
v¬ŸbË


64 #i 
NO
 
LONGER
 
š
 
os
.
’vœÚ
.

65 #W
u£
 'ev®' 
to
 
·r£
 
the
 
chd
's output sohat‡nƒxception

66 #i 
thrown
 
the
 
šput
 
is
 
Ã™h”
 'True' 
nÜ
 'False'.

67 
os
.
’vœÚ
['UNSET_VAR'] = 'X'

68 
d–
 
os
.
’vœÚ
['UNSET_VAR']

69 
chd
 = 
g‹¡_‹¡_uts
.
	`Sub´oûss
(

70 [
sys
.
execubË
, '-c', 'import os;…rint \'UNSET_VAR\'‚ot in os.environ'])

71 
CAN_UNSET_ENV
 = 
	$ev®
(
chd
.
ouut
)

74 #Check 
we
 
should
 
‹¡
 
w™h
 
ª
 
em±y
 
f‹r
. 
This
 
dÛ¢
't

75 #mak
£n£
 
Ú
 
¶©fÜms
 
th©
 
ÿÂÙ
 
·ss
 
em±y
 
’v
 
	`v¬ŸbËs
 (
Wš32
)

76 #ªd 
Ú
 
¶©fÜms
 
th©
 
ÿÂÙ
 
un£t
 
	`v¬ŸbËs
 (
sšû
 
we
 cªnÙ 
‹Î


77 #th
difã»nû
 
b‘w“n
 "" 
ªd
 
NULL
 -- 
BÜÏnd
‡nd 
SŞ¬is
 < 5.10)

78 
CAN_TEST_EMPTY_FILTER
 = (
CAN_PASS_EMPTY_ENV
 
ªd
 
CAN_UNSET_ENV
)

81 #Th
’vœÚm’t
 
v¬ŸbË
 
¥ecifyšg
 
the
 
‹¡
 
f‹rs
.

82 
FILTER_ENV_VAR
 = 'GTEST_FILTER'

84 #Th
’vœÚm’t
 
v¬ŸbËs
 
‹¡
 
sh¬dšg
.

85 
TOTAL_SHARDS_ENV_VAR
 = 'GTEST_TOTAL_SHARDS'

86 
SHARD_INDEX_ENV_VAR
 = 'GTEST_SHARD_INDEX'

87 
SHARD_STATUS_FILE_ENV_VAR
 = 'GTEST_SHARD_STATUS_FILE'

89 #Th
commªd
 
lše
 
æag
 
¥ecifyšg
 
the
 
‹¡
 
f‹rs
.

90 
FILTER_FLAG
 = 'gtest_filter'

92 #Th
commªd
 
lše
 
æag
 
šşudšg
 
di§bËd
 
‹¡s
.

93 
ALSO_RUN_DISABED_TESTS_FLAG
 = 'gtest_also_run_disabled_tests'

95 #Commªd 
to
 
run
 
the
 
g‹¡_f‹r_un™‹¡_
 
´og¿m
.

96 
COMMAND
 = 
g‹¡_‹¡_uts
.
	`G‘Te¡ExecubËP©h
('gtest_filter_unittest_')

98 #Regex 
d‘”mššg
 
wh‘h”
 
·¿m‘”ized
 
‹¡s
 
¬e
 
’abËd
 
š
 
the
 
bš¬y
.

99 
PARAM_TEST_REGEX
 = 
»
.
	`compe
(
r
'/ParamTest')

101 #Regex 
·rsšg
 
‹¡
 
Çmes
 
äom
 
GoogË
 
Te¡
's output.

102 
TEST_CASE_REGEX
 = 
»
.
	`compe
(
r
'^\[\-+\] \d+ests? from (\w+(/\w+)?)')

104 #Regex 
·rsšg
 
‹¡
 
Çmes
 
äom
 
GoogË
 
Te¡
's output.

105 
TEST_REGEX
 = 
»
.
	`compe
(
r
'^\[\s*RUN\s*\].*\.(\w+(/\w+)?)')

107 #Th
commªd
 
lše
 
æag
 
to
 
‹Î
 
GoogË
 
Te¡
Ø
ouut
 
the
 
li¡
 
of
 
‹¡s
 
™


108 #wÈ
run
.

109 
LIST_TESTS_FLAG
 = '--gtest_list_tests'

111 #Indiÿ‹ 
wh‘h”
 
GoogË
 
Te¡
 
suµÜts
 
d—th
 
‹¡s
.

112 
SUPPORTS_DEATH_TESTS
 = 'HasD—thTe¡' 
š
 
g‹¡_‹¡_uts
.
	`Sub´oûss
(

113 [
COMMAND
, 
LIST_TESTS_FLAG
]).
ouut


115 #FuÎ 
Çmes
 
of
 
®l
 
‹¡s
 
š
 
g‹¡_f‹r_un™‹¡s_
.

116 
PARAM_TESTS
 = [

127 
DISABLED_TESTS
 = [

136 
SUPPORTS_DEATH_TESTS
:

137 
DEATH_TESTS
 = [

142 
DEATH_TESTS
 = []

144 #AÎ 
the
 
nÚ
-
di§bËd
 
‹¡s
.

145 
ACTIVE_TESTS
 = [

156 ] + 
DEATH_TESTS
 + 
PARAM_TESTS


158 
·¿m_‹¡s_´e£Á
 = 
NÚe


162 
’vœÚ
 = 
os
.’vœÚ.
	$cİy
()

165 
def
 
	$S‘EnvV¬
(
’v_v¬
, 
v®ue
):

168 
v®ue
 
is
 
nÙ
 
NÚe
:

169 
’vœÚ
[
’v_v¬
] = 
v®ue


170 
–if
 
’v_v¬
 
š
 
’vœÚ
:

171 
d–
 
’vœÚ
[
’v_v¬
]

174 
def
 
	$RunAndR‘uºOuut
(
¬gs
 = 
NÚe
):

177  
g‹¡_‹¡_uts
.
	`Sub´oûss
([
COMMAND
] + (
¬gs
 
Ü
 []),

178 
’v
=
’vœÚ
).
ouut


181 
def
 
	$RunAndExŒaùTe¡Li¡
(
¬gs
 = 
NÚe
):

184 
p
 = 
g‹¡_‹¡_uts
.
	`Sub´oûss
([
COMMAND
] + (
¬gs
 
Ü
 []), 
’v
=
’vœÚ
)

185 
‹¡s_run
 = []

186 
‹¡_ÿ£
 = ''

187 
‹¡
 = ''

188 
lše
 
š
 
p
.
ouut
.
	`¥l™
('\n'):

189 
m©ch
 = 
TEST_CASE_REGEX
.
	$m©ch
(
lše
)

190 
m©ch
 
is
 
nÙ
 
NÚe
:

191 
‹¡_ÿ£
 = 
m©ch
.
	$group
(1)

193 
m©ch
 = 
TEST_REGEX
.
	$m©ch
(
lše
)

194 
m©ch
 
is
 
nÙ
 
NÚe
:

195 
‹¡
 = 
m©ch
.
	$group
(1)

196 
‹¡s_run
.
	`­³nd
(
‹¡_ÿ£
 + '.' + 
‹¡
)

197  (
‹¡s_run
, 
p
.
ex™_code
)

200 
def
 
	$InvokeW™hModif›dEnv
(
exŒa_’v
, 
funùiÚ
, *
¬gs
, **
kw¬gs
):

202 
Œy
:

203 
Üigš®_’v
 = 
’vœÚ
.
	$cİy
()

204 
’vœÚ
.
	$upd©e
(
exŒa_’v
)

205  
	$funùiÚ
(*
¬gs
, **
kw¬gs
)

206 
fš®ly
:

207 
’vœÚ
.
	$ş—r
()

208 
’vœÚ
.
	$upd©e
(
Üigš®_’v
)

211 
def
 
	$RunW™hSh¬dšg
(
tÙ®_sh¬ds
, 
sh¬d_šdex
, 
commªd
):

214 
exŒa_’v
 = {
SHARD_INDEX_ENV_VAR
: 
	`¡r
(
sh¬d_šdex
),

215 
TOTAL_SHARDS_ENV_VAR
: 
	`¡r
(
tÙ®_sh¬ds
)
	}
}

216  
	$InvokeW™hModif›dEnv
(
exŒa_’v
, 
RunAndExŒaùTe¡Li¡
, 
commªd
)

218 #Th
un™
 
‹¡
.

221 
şass
 
	$GTe¡F‹rUn™Te¡
(
g‹¡_‹¡_uts
.
Te¡Ca£
):

226 
def
 
	$As£¹S‘Equ®
(
£lf
, 
lhs
, 
rhs
):

229 
–em
 
š
 
lhs
:

230 
£lf
.
	`as£¹_
(
–em
 
š
 
rhs
, '%s in %s' % (elem,„hs))

232 
–em
 
š
 
rhs
:

233 
£lf
.
	`as£¹_
(
–em
 
š
 
lhs
, '%s in %s' % (elem,†hs))

235 
def
 
	$As£¹P¬t™iÚIsV®id
(
£lf
, 
£t_v¬
, 
li¡_of_£ts
):

238 
fuÎ_·¹™iÚ
 = []

239 
¦iû_v¬
 
š
 
li¡_of_£ts
:

240 
fuÎ_·¹™iÚ
.
	$ex‹nd
(
¦iû_v¬
)

241 
£lf
.
	`as£¹Equ®
(
	`Ën
(
£t_v¬
), 
	$Ën
(
fuÎ_·¹™iÚ
))

242 
£lf
.
	`as£¹Equ®
(
£ts
.
	`S‘
(
£t_v¬
), s‘s.
	$S‘
(
fuÎ_·¹™iÚ
))

244 
def
 
	$Adju¡FÜP¬am‘”izedTe¡s
(
£lf
, 
‹¡s_to_run
):

247 
glob®
 
·¿m_‹¡s_´e£Á


248 
nÙ
 
·¿m_‹¡s_´e£Á
:

249  
	`li¡
(
£ts
.
	`S‘
(
‹¡s_to_run
è- s‘s.
	$S‘
(
PARAM_TESTS
))

251  
‹¡s_to_run


253 
def
 
	$RunAndV”ify
(
£lf
, 
g‹¡_f‹r
, 
‹¡s_to_run
):

256 
‹¡s_to_run
 = 
£lf
.
	$Adju¡FÜP¬am‘”izedTe¡s
(
‹¡s_to_run
)

258 #Fœ¡, 
‹¡s
 
usšg
 
the
 
’vœÚm’t
 
v¬ŸbË
.

260 #Wšdow 
»moves
 
em±y
 
v¬ŸbËs
 
äom
 
the
 
’vœÚm’t
 
wh’
 
·ssšg
 
™


261 #tØ
a
 
Ãw
 
´oûss
. 
This
 
m—ns
 
™
 
is
 
impossibË
 
to
 
·ss
 
ª
 
em±y
 
f‹r


262 #štØ
a
 
´oûss
 
usšg
 
the
 
’vœÚm’t
 
v¬ŸbË
. 
Howev”
, 
we
 
ÿn
 
¡l


263 #‹¡ 
the
 
wh’
h
v¬ŸbË
 
is
 
nÙ
 
	`suµl›d
 (
i
.
e
., 
g‹¡_f‹r
 is

265 #pylšt: 
di§bË
-
msg
=
C6403


266 
CAN_TEST_EMPTY_FILTER
 
Ü
 
g‹¡_f‹r
 != '':

267 
	$S‘EnvV¬
(
FILTER_ENV_VAR
, 
g‹¡_f‹r
)

268 
‹¡s_run
 = 
	`RunAndExŒaùTe¡Li¡
()[0]

269 
	$S‘EnvV¬
(
FILTER_ENV_VAR
, 
NÚe
)

270 
£lf
.
	$As£¹S‘Equ®
(
‹¡s_run
, 
‹¡s_to_run
)

271 #pylšt: 
’abË
-
msg
=
C6403


273 #Next, 
‹¡s
 
usšg
 
the
 
commªd
 
lše
 
æag
.

275 
g‹¡_f‹r
 
is
 
NÚe
:

276 
¬gs
 = []

278 
¬gs
 = ['--%s=%s' % (
FILTER_FLAG
, 
g‹¡_f‹r
)]

280 
‹¡s_run
 = 
	`RunAndExŒaùTe¡Li¡
(
¬gs
)[0]

281 
£lf
.
	$As£¹S‘Equ®
(
‹¡s_run
, 
‹¡s_to_run
)

283 
def
 
	$RunAndV”ifyW™hSh¬dšg
(
£lf
, 
g‹¡_f‹r
, 
tÙ®_sh¬ds
, 
‹¡s_to_run
,

284 
¬gs
=
NÚe
, 
check_ex™_0
=
F®£
):

287 
Runs
 
®l
 
sh¬ds
 
of
 
g‹¡_f‹r_un™‹¡_
 
w™h
 
the
 
giv’
 
f‹r
, 
ªd


288 
v”if›s
 
th©
 
the
 
right
 
£t
 
of
 
‹¡s
 
w”e
 
run
. 
The
 ofests„un

289 
Ú
 
—ch
 
sh¬d
 
should
 
be
 
id’tiÿl
 
to
 
‹¡s_to_run
, 
w™hout
 
du¶iÿ‹s
.

291 
Args
:

292 
g‹¡_f‹r
: 
A
 
f‹r
 
to
 
­¶y
Ø
the
 
‹¡s
.

293 
tÙ®_sh¬ds
: 
A
 
tÙ®
 
numb”
 
of
 
sh¬ds
 
to
 
¥l™
 
‹¡
 
run
 
što
.

294 
‹¡s_to_run
: 
A
 
£t
 
of
 
‹¡s
 
ex³ùed
 
to
 
run
.

295 
¬gs
 : 
Argum’ts
 
to
 
·ss
Ø
the
Øth
‹¡
 
bš¬y
.

296 
check_ex™_0
: 
Wh’
 
£t
 
to
 
a
 
Œue
 
v®ue
, 
make
 
su»
 
th©
 
®l
 
sh¬ds


300 
‹¡s_to_run
 = 
£lf
.
	$Adju¡FÜP¬am‘”izedTe¡s
(
‹¡s_to_run
)

302 #Wšdow 
»moves
 
em±y
 
v¬ŸbËs
 
äom
 
the
 
’vœÚm’t
 
wh’
 
·ssšg
 
™


303 #tØ
a
 
Ãw
 
´oûss
. 
This
 
m—ns
 
™
 
is
 
impossibË
 
to
 
·ss
 
ª
 
em±y
 
f‹r


304 #štØ
a
 
´oûss
 
usšg
 
the
 
’vœÚm’t
 
v¬ŸbË
. 
Howev”
, 
we
 
ÿn
 
¡l


305 #‹¡ 
the
 
wh’
h
v¬ŸbË
 
is
 
nÙ
 
	`suµl›d
 (
i
.
e
., 
g‹¡_f‹r
 is

307 #pylšt: 
di§bË
-
msg
=
C6403


308 
CAN_TEST_EMPTY_FILTER
 
Ü
 
g‹¡_f‹r
 != '':

309 
	$S‘EnvV¬
(
FILTER_ENV_VAR
, 
g‹¡_f‹r
)

310 
·¹™iÚ
 = []

311 
i
 
š
 
	$¿nge
(0, 
tÙ®_sh¬ds
):

312 (
‹¡s_run
, 
ex™_code
èğ
	$RunW™hSh¬dšg
(
tÙ®_sh¬ds
, 
i
, 
¬gs
)

313 
check_ex™_0
:

314 
£lf
.
	$as£¹Equ®
(0, 
ex™_code
)

315 
·¹™iÚ
.
	$­³nd
(
‹¡s_run
)

317 
£lf
.
	$As£¹P¬t™iÚIsV®id
(
‹¡s_to_run
, 
·¹™iÚ
)

318 
	$S‘EnvV¬
(
FILTER_ENV_VAR
, 
NÚe
)

319 #pylšt: 
’abË
-
msg
=
C6403


321 
def
 
	$RunAndV”ifyAÎowšgDi§bËd
(
£lf
, 
g‹¡_f‹r
, 
‹¡s_to_run
):

324 
Runs
 
g‹¡_f‹r_un™‹¡_
 
w™h
 
the
 
giv’
 
f‹r
, 
ªd
 
’abËs


325 
di§bËd
 
‹¡s
. 
V”if›s
 
th©
 
the
 
right
 
£t
 
of
e¡ 
w”e
 
run
.

327 
Args
:

328 
g‹¡_f‹r
: 
A
 
f‹r
 
to
 
­¶y
Ø
the
 
‹¡s
.

329 
‹¡s_to_run
: 
A
 
£t
 
of
 
‹¡s
 
ex³ùed
 
to
 
run
.

332 
‹¡s_to_run
 = 
£lf
.
	$Adju¡FÜP¬am‘”izedTe¡s
(
‹¡s_to_run
)

334 #CÚ¡ruù 
the
 
commªd
 
lše
.

335 
¬gs
 = ['--%s' % 
ALSO_RUN_DISABED_TESTS_FLAG
]

336 
g‹¡_f‹r
 
is
 
nÙ
 
NÚe
:

337 
¬gs
.
	`­³nd
('--%s=%s' % (
FILTER_FLAG
, 
g‹¡_f‹r
))

339 
‹¡s_run
 = 
	`RunAndExŒaùTe¡Li¡
(
¬gs
)[0]

340 
£lf
.
	$As£¹S‘Equ®
(
‹¡s_run
, 
‹¡s_to_run
)

342 
def
 
	$£tUp
(
£lf
):

345 
D‘”mšes
 
wh‘h”
 
v®ue
-
·¿m‘”ized
 
‹¡s
 
¬e
 
’abËd
 
š
 
the
 
bš¬y
 
ªd


346 
£ts
 
the
 
æags
 
accÜdšgly
.

349 
glob®
 
·¿m_‹¡s_´e£Á


350 
·¿m_‹¡s_´e£Á
 
is
 
NÚe
:

351 
·¿m_‹¡s_´e£Á
 = 
PARAM_TEST_REGEX
.
	`£¬ch
(

352 
	$RunAndR‘uºOuut
()è
is
 
nÙ
 
NÚe


354 
def
 
	$‹¡DeçuÉBehaviÜ
(
£lf
):

357 
£lf
.
	$RunAndV”ify
(
NÚe
, 
ACTIVE_TESTS
)

359 
def
 
	$‹¡DeçuÉBehaviÜW™hSh¬ds
(
£lf
):

362 
£lf
.
	$RunAndV”ifyW™hSh¬dšg
(
NÚe
, 1, 
ACTIVE_TESTS
)

363 
£lf
.
	$RunAndV”ifyW™hSh¬dšg
(
NÚe
, 2, 
ACTIVE_TESTS
)

364 
£lf
.
	`RunAndV”ifyW™hSh¬dšg
(
NÚe
, 
	`Ën
(
ACTIVE_TESTS
) - 1, ACTIVE_TESTS)

365 
£lf
.
	`RunAndV”ifyW™hSh¬dšg
(
NÚe
, 
	`Ën
(
ACTIVE_TESTS
), ACTIVE_TESTS)

366 
£lf
.
	`RunAndV”ifyW™hSh¬dšg
(
NÚe
, 
	`Ën
(
ACTIVE_TESTS
) + 1, ACTIVE_TESTS)

368 
def
 
	$‹¡Em±yF‹r
(
£lf
):

371 
£lf
.
	`RunAndV”ify
('', [])

372 
£lf
.
	`RunAndV”ifyW™hSh¬dšg
('', 1, [])

373 
£lf
.
	`RunAndV”ifyW™hSh¬dšg
('', 2, [])

375 
def
 
	$‹¡BadF‹r
(
£lf
):

378 
£lf
.
	`RunAndV”ify
('BadFilter', [])

379 
£lf
.
	`RunAndV”ifyAÎowšgDi§bËd
('BadFilter', [])

381 
def
 
	$‹¡FuÎName
(
£lf
):

384 
£lf
.
	`RunAndV”ify
('FooTest.Xyz', ['FooTest.Xyz'])

385 
£lf
.
	`RunAndV”ifyAÎowšgDi§bËd
('FooTest.Xyz', ['FooTest.Xyz'])

386 
£lf
.
	`RunAndV”ifyW™hSh¬dšg
('FooTest.Xyz', 5, ['FooTest.Xyz'])

388 
def
 
	$‹¡Univ”§lF‹rs
(
£lf
):

391 
£lf
.
	`RunAndV”ify
('*', 
ACTIVE_TESTS
)

392 
£lf
.
	`RunAndV”ify
('*.*', 
ACTIVE_TESTS
)

393 
£lf
.
	`RunAndV”ifyW™hSh¬dšg
('*.*', 
	`Ën
(
ACTIVE_TESTS
) - 3, ACTIVE_TESTS)

394 
£lf
.
	`RunAndV”ifyAÎowšgDi§bËd
('*', 
ACTIVE_TESTS
 + 
DISABLED_TESTS
)

395 
£lf
.
	`RunAndV”ifyAÎowšgDi§bËd
('*.*', 
ACTIVE_TESTS
 + 
DISABLED_TESTS
)

397 
def
 
	$‹¡F‹rByTe¡Ca£
(
£lf
):

400 
£lf
.
	`RunAndV”ify
('FooTest.*', ['FooTest.Abc', 'FooTest.Xyz'])

402 
BAZ_TESTS
 = ['BazTest.TestOne', 'BazTest.TestA', 'BazTest.TestB']

403 
£lf
.
	`RunAndV”ify
('BazTe¡.*', 
BAZ_TESTS
)

404 
£lf
.
	`RunAndV”ifyAÎowšgDi§bËd
('BazTest.*',

405 
BAZ_TESTS
 + ['BazTest.DISABLED_TestC'])

407 
def
 
	$‹¡F‹rByTe¡
(
£lf
):

410 
£lf
.
	`RunAndV”ify
('*.TestOne', ['BarTest.TestOne', 'BazTest.TestOne'])

412 
def
 
	$‹¡F‹rDi§bËdTe¡s
(
£lf
):

415 
£lf
.
	`RunAndV”ify
('DISABLED_FoobarTest.Test1', [])

416 
£lf
.
	`RunAndV”ifyAÎowšgDi§bËd
('DISABLED_FoobarTest.Test1',

419 
£lf
.
	`RunAndV”ify
('*DISABLED_*', [])

420 
£lf
.
	`RunAndV”ifyAÎowšgDi§bËd
('*DISABLED_*', 
DISABLED_TESTS
)

422 
£lf
.
	`RunAndV”ify
('*.DISABLED_*', [])

423 
£lf
.
	`RunAndV”ifyAÎowšgDi§bËd
('*.DISABLED_*', [

430 
£lf
.
	`RunAndV”ify
('DISABLED_*', [])

431 
£lf
.
	`RunAndV”ifyAÎowšgDi§bËd
('DISABLED_*', [

437 
def
 
	$‹¡WdÿrdInTe¡Ca£Name
(
£lf
):

440 
£lf
.
	`RunAndV”ify
('*a*.*', [

447 'BazTe¡.Te¡B', ] + 
DEATH_TESTS
 + 
PARAM_TESTS
)

449 
def
 
	$‹¡WdÿrdInTe¡Name
(
£lf
):

452 
£lf
.
	`RunAndV”ify
('*.*A*', ['FooTest.Abc', 'BazTest.TestA'])

454 
def
 
	$‹¡F‹rW™houtDÙ
(
£lf
):

457 
£lf
.
	`RunAndV”ify
('*z*', [

465 
def
 
	$‹¡TwoP©‹ºs
(
£lf
):

468 
£lf
.
	`RunAndV”ify
('Foo*.*:*A*', [

475 #AÀ
em±y
 
·‰”n
 + 
a
 
nÚ
-em±y 
Úe


476 
£lf
.
	`RunAndV”ify
(':*A*', ['FooTest.Abc', 'BazTest.TestA'])

478 
def
 
	$‹¡Th»eP©‹ºs
(
£lf
):

481 
£lf
.
	`RunAndV”ify
('*oo*:*A*:*One', [

491 #Th2
nd
 
·‰”n
 
is
 
em±y
.

492 
£lf
.
	`RunAndV”ify
('*oo*::*One', [

501 #Th
Ï¡
 2 
·‰”ns
 
¬e
 
em±y
.

502 
£lf
.
	`RunAndV”ify
('*oo*::', [

507 
def
 
	$‹¡Neg©iveF‹rs
(
£lf
):

508 
£lf
.
	`RunAndV”ify
('*-BazTest.TestOne', [

518 ] + 
DEATH_TESTS
 + 
PARAM_TESTS
)

520 
£lf
.
	`RunAndV”ify
('*-FooTest.Abc:BazTest.*', [

526 ] + 
DEATH_TESTS
 + 
PARAM_TESTS
)

528 
£lf
.
	`RunAndV”ify
('BarTest.*-BarTest.TestOne', [

533 #Te¡ 
w™hout
 
Ëadšg
 '*'.

534 
£lf
.
	`RunAndV”ify
('-FooTest.Abc:FooTest.Xyz:BazTest.*', [

538 ] + 
DEATH_TESTS
 + 
PARAM_TESTS
)

540 #V®u
·¿m‘”ized
 
‹¡s
.

541 
£lf
.
	`RunAndV”ify
('*/*', 
PARAM_TESTS
)

543 #V®u
·¿m‘”ized
 
‹¡s
 
f‹ršg
 
by
 
the
 
£qu’û
 
Çme
.

544 
£lf
.
	`RunAndV”ify
('SeqP/*', [

551 #V®u
·¿m‘”ized
 
‹¡s
 
f‹ršg
 
by
 
the
 
‹¡
 
Çme
.

552 
£lf
.
	`RunAndV”ify
('*/0', [

559 
def
 
	$‹¡FÏgOv”ridesEnvV¬
(
£lf
):

562 
	`S‘EnvV¬
(
FILTER_ENV_VAR
, 'Foo*')

563 
¬gs
 = ['--%s=%s' % (
FILTER_FLAG
, '*One')]

564 
‹¡s_run
 = 
	`RunAndExŒaùTe¡Li¡
(
¬gs
)[0]

565 
	$S‘EnvV¬
(
FILTER_ENV_VAR
, 
NÚe
)

567 
£lf
.
	`As£¹S‘Equ®
(
‹¡s_run
, ['BarTest.TestOne', 'BazTest.TestOne'])

569 
def
 
	$‹¡Sh¬dStusFeIsC»©ed
(
£lf
):

572 
sh¬d_¡©us_fe
 = 
os
.
·th
.
	`još
(
g‹¡_‹¡_uts
.
	`G‘TempDœ
(),

574 
£lf
.
	`as£¹_
(
nÙ
 
os
.
·th
.
	$exi¡s
(
sh¬d_¡©us_fe
))

576 
exŒa_’v
 = {
SHARD_STATUS_FILE_ENV_VAR
: 
sh¬d_¡©us_fe
}

577 
Œy
:

578 
	$InvokeW™hModif›dEnv
(
exŒa_’v
, 
RunAndR‘uºOuut
)

579 
fš®ly
:

580 
£lf
.
	`as£¹_
(
os
.
·th
.
	$exi¡s
(
sh¬d_¡©us_fe
))

581 
os
.
	$»move
(
sh¬d_¡©us_fe
)

583 
def
 
	$‹¡Sh¬dStusFeIsC»©edW™hLi¡Te¡s
(
£lf
):

584 """Te¡ th©hsh¬d fi ü—‹d w™hh"
li¡_‹¡s
" flag."""

586 
sh¬d_¡©us_fe
 = 
os
.
·th
.
	`još
(
g‹¡_‹¡_uts
.
	`G‘TempDœ
(),

588 
£lf
.
	`as£¹_
(
nÙ
 
os
.
·th
.
	$exi¡s
(
sh¬d_¡©us_fe
))

590 
exŒa_’v
 = {
SHARD_STATUS_FILE_ENV_VAR
: 
sh¬d_¡©us_fe
}

591 
Œy
:

592 
ouut
 = 
	$InvokeW™hModif›dEnv
(
exŒa_’v
,

593 
RunAndR‘uºOuut
,

594 [
LIST_TESTS_FLAG
])

595 
fš®ly
:

596 #Thi 
as£¹iÚ
 
’su»s
 
th©
 
GoogË
 
Te¡
 
’um”©ed
 
the
 
‹¡s
 
as


597 #İpo£d 
to
 
ruÂšg
 
them
.

598 
£lf
.
	`as£¹_
('[==========]' 
nÙ
 
š
 
ouut
,

603 
£lf
.
	`as£¹_
(
os
.
·th
.
	$exi¡s
(
sh¬d_¡©us_fe
))

604 
os
.
	$»move
(
sh¬d_¡©us_fe
)

606 
SUPPORTS_DEATH_TESTS
:

607 
def
 
	$‹¡Sh¬dšgWÜksW™hD—thTe¡s
(
£lf
):

610 
g‹¡_f‹r
 = 'HasDeathTest.*:SeqP/*'

611 
ex³ùed_‹¡s
 = [

621 
æag
 
š
 ['--gtest_death_test_style=threadsafe',

623 
£lf
.
	$RunAndV”ifyW™hSh¬dšg
(
g‹¡_f‹r
, 3, 
ex³ùed_‹¡s
,

624 
check_ex™_0
=
True
, 
¬gs
=[
æag
])

625 
£lf
.
	$RunAndV”ifyW™hSh¬dšg
(
g‹¡_f‹r
, 5, 
ex³ùed_‹¡s
,

626 
check_ex™_0
=
True
, 
¬gs
=[
æag
])

628 
__Çme__
 == '__main__':

629 
g‹¡_‹¡_uts
.
	`Maš
()

	@trunk/objs/gtest-1.6.0/test/gtest_help_test.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


2 #
#Cİyrighˆ2009, 
GoogË
 
Inc
.

3 #AÎ 
rights
 
»£rved
.

4 #
#Redi¡ributiÚ 
ªd
 
u£
 
š
 
sourû
‡nd 
bš¬y
 
fÜms
, 
w™h
 
Ü
 
w™hout


5 #modifiÿtiÚ, 
¬e
 
³rm™‹d
 
´ovided
 
th©
 
the
 
fŞlowšg
 
cÚd™iÚs
‡re

7 #
#* 
Redi¡ributiÚs
 
of
 
sourû
 
code
 
mu¡
 
»š
 
the
 
above
 
cİyright


8 #nÙiû, 
this
 
li¡
 
of
 
cÚd™iÚs
 
ªd
 
the
 
fŞlowšg
 
disşaim”
.

9 #* 
Redi¡ributiÚs
 
š
 
bš¬y
 
fÜm
 
mu¡
 
»´oduû
 
the
 
above


10 #cİyrighˆ
nÙiû
, 
this
 
li¡
 
of
 
cÚd™iÚs
 
ªd
 
the
 
fŞlowšg
 
disşaim”


11 #š 
the
 
docum’tiÚ
 
ªd
/
Ü
 
Ùh”
 
m©”Ÿls
 
´ovided
 
w™h
he

13 #* 
Ne™h”
 
the
 
Çme
 
of
 
GoogË
 
Inc
. 
nÜ
h
Çmes
 oà
™s


14 #cÚŒibutÜ 
may
 
be
 
u£d
 
to
 
’dÜ£
 
Ü
 
´omÙe
 
´oduùs
 
d”ived
 
äom


15 #thi 
soáw¬e
 
w™hout
 
¥ecific
 
´iÜ
 
wr™‹n
 
³rmissiÚ
.

16 #
#THIS 
SOFTWARE
 
IS
 
PROVIDED
 
BY
 
THE
 
COPYRIGHT
 
HOLDERS
 
AND
 
CONTRIBUTORS


17 #"
AS
 
IS
" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT

18 #LIMITED 
TO
, 
THE
 
IMPLIED
 
WARRANTIES
 
OF
 
MERCHANTABILITY
 
AND
 
FITNESS
 
FOR


19 #A 
PARTICULAR
 
PURPOSE
 
ARE
 
DISCLAIMED
. 
IN
 
NO
 
EVENT
 
SHALL
 
THE
 
COPYRIGHT


20 #OWNER 
OR
 
CONTRIBUTORS
 
BE
 
LIABLE
 
FOR
 
ANY
 
DIRECT
, 
INDIRECT
, 
INCIDENTAL
,

21 #SPECIAL, 
EXEMPLARY
, 
OR
 
CONSEQUENTIAL
 
DAMAGES
 (
INCLUDING
, 
BUT
 
NOT


22 #LIMITED 
TO
, 
PROCUREMENT
 
OF
 
SUBSTITUTE
 
GOODS
 
OR
 
SERVICES
; 
LOSS
 OF 
USE
,

23 #DATA, 
OR
 
PROFITS
; OR 
BUSINESS
 
INTERRUPTION
è
HOWEVER
 
CAUSED
 
AND
 
ON
 
ANY


24 #THEORY 
OF
 
LIABILITY
, 
WHETHER
 
IN
 
CONTRACT
, 
STRICT
 LIABILITY, 
OR
 
TORT


25 #(
INCLUDING
 
NEGLIGENCE
 
OR
 
OTHERWISE
è
ARISING
 
IN
 
ANY
 
WAY
 
OUT
 
OF
 
THE
 
USE


26 #OF 
THIS
 
SOFTWARE
, 
EVEN
 
IF
 
ADVISED
 
OF
 
THE
 
POSSIBILITY
 OF 
SUCH
 
DAMAGE
.

30 
SYNOPSIS


31 
	gg‹¡_h–p_‹¡
.
	gpy
 --
	gbud_dœ
=
BUILD
/
DIR


32 #wh”
BUILD
/
DIR
 
cÚšs
 
the
 
but
 
g‹¡_h–p_‹¡_
 
fe
.

33 
g‹¡_h–p_‹¡
.
py


36 
__authÜ__
 = 'wan@google.com (Zhanyong Wan)'

38 
impÜt
 
os


39 
impÜt
 
»


40 
impÜt
 
g‹¡_‹¡_uts


43 
IS_LINUX
 = 
os
.
Çme
 =ğ'posix' 
ªd
 os.
uÇme
()[0] == 'Linux'

44 
IS_WINDOWS
 = 
os
.
Çme
 == 'nt'

46 
PROGRAM_PATH
 = 
g‹¡_‹¡_uts
.
G‘Te¡ExecubËP©h
('gtest_help_test_')

47 
FLAG_PREFIX
 = '--gtest_'

48 
DEATH_TEST_STYLE_FLAG
 = 
FLAG_PREFIX
 + 'death_test_style'

49 
STREAM_RESULT_TO_FLAG
 = 
FLAG_PREFIX
 + 'stream_result_to'

50 
UNKNOWN_FLAG
 = 
FLAG_PREFIX
 + 'unknown_flag_for_testing'

51 
LIST_TESTS_FLAG
 = 
FLAG_PREFIX
 + 'list_tests'

52 
INCORRECT_FLAG_VARIANTS
 = [
»
.
sub
('^--', '-', 
LIST_TESTS_FLAG
),

53 
»
.
sub
('^--', '/', 
LIST_TESTS_FLAG
),

54 
»
.
sub
('_', '-', 
LIST_TESTS_FLAG
)]

55 
	gINTERNAL_FLAG_FOR_TESTING
 = 
FLAG_PREFIX
 + 'internal_flag_for_testing'

57 
SUPPORTS_DEATH_TESTS
 = "D—thTe¡" 
š
 
g‹¡_‹¡_uts
.
Sub´oûss
(

58 [
PROGRAM_PATH
, 
LIST_TESTS_FLAG
]).
	gouut


60 #Th
h–p
 
mes§ge
 
mu¡
 
m©ch
 
this
 
»gex
.

61 
	gHELP_REGEX
 = 
»
.
compe
(

62 
FLAG_PREFIX
 + 
r
'list_tests.*' +

63 
FLAG_PREFIX
 + 
r
'filter=.*' +

64 
FLAG_PREFIX
 + 
r
'also_run_disabled_tests.*' +

65 
FLAG_PREFIX
 + 
r
'repeat=.*' +

66 
FLAG_PREFIX
 + 
r
'shuffle.*' +

67 
FLAG_PREFIX
 + 
r
'random_seed=.*' +

68 
FLAG_PREFIX
 + 
r
'color=.*' +

69 
FLAG_PREFIX
 + 
r
'print_time.*' +

70 
FLAG_PREFIX
 + 
r
'output=.*' +

71 
FLAG_PREFIX
 + 
r
'break_on_failure.*' +

72 
FLAG_PREFIX
 + 
r
'throw_on_failure.*' +

73 
FLAG_PREFIX
 + 
r
'catch_exceptions=0.*',

74 
»
.
DOTALL
)

77 
def
 
	$RunW™hFÏg
(
æag
):

80 
R‘uºs
:

81 
the
 
ex™
 
code
 
ªd
h
‹xt
 
ouut
 
as
 
a
 
tu¶e
.

82 
Args
:

83 
æag
: 
the
 
commªd
-
lše
 fÏg 
to
 
·ss
Ø
g‹¡_h–p_‹¡_
, 
Ü
 
NÚe
.

86 
æag
 
is
 
NÚe
:

87 
commªd
 = [
PROGRAM_PATH
]

89 
commªd
 = [
PROGRAM_PATH
, 
æag
]

90 
chd
 = 
g‹¡_‹¡_uts
.
	$Sub´oûss
(
commªd
)

91  
chd
.
ex™_code
, chd.
ouut


94 
şass
 
	$GTe¡H–pTe¡
(
g‹¡_‹¡_uts
.
Te¡Ca£
):

97 
def
 
	$Te¡H–pFÏg
(
£lf
, 
æag
):

100 
The
 
right
 
mes§ge
 
mu¡
 
be
 
´š‹d
 
ªd
 
the
 
‹¡s
 must

101 
sk³d
 
wh’
 
the
 
giv’
 
æag
 
is
 
¥ecif›d
.

103 
Args
:

104 
æag
: 
A
 fÏg 
to
 
·ss
Ø
the
 
bš¬y
 
Ü
 
NÚe
.

107 
ex™_code
, 
ouut
 = 
	$RunW™hFÏg
(
æag
)

108 
£lf
.
	$as£¹Equ®s
(0, 
ex™_code
)

109 
£lf
.
	`as£¹_
(
HELP_REGEX
.
	`£¬ch
(
ouut
), output)

111 
IS_LINUX
:

112 
£lf
.
	$as£¹_
(
STREAM_RESULT_TO_FLAG
 
š
 
ouut
, output)

114 
£lf
.
	$as£¹_
(
STREAM_RESULT_TO_FLAG
 
nÙ
 
š
 
ouut
, output)

116 
SUPPORTS_DEATH_TESTS
 
ªd
 
nÙ
 
IS_WINDOWS
:

117 
£lf
.
	$as£¹_
(
DEATH_TEST_STYLE_FLAG
 
š
 
ouut
, output)

119 
£lf
.
	$as£¹_
(
DEATH_TEST_STYLE_FLAG
 
nÙ
 
š
 
ouut
, output)

121 
def
 
	$Te¡NÚH–pFÏg
(
£lf
, 
æag
):

124 
V”if›s
 
th©
 
wh’
 
no
 
h–p
 
æag
 
is
 
¥ecif›d
, 
the
 
‹¡s
 
¬e
 
run


125 
ªd
 
the
 
h–p
 
mes§ge
 
is
 
nÙ
 
´š‹d
.

127 
Args
:

128 
æag
: 
A
 fÏg 
to
 
·ss
Ø
the
 
bš¬y
 
Ü
 
NÚe
.

131 
ex™_code
, 
ouut
 = 
	$RunW™hFÏg
(
æag
)

132 
£lf
.
	`as£¹_
(
ex™_code
 != 0)

133 
£lf
.
	`as£¹_
(
nÙ
 
HELP_REGEX
.
	`£¬ch
(
ouut
), output)

135 
def
 
	$‹¡PrštsH–pW™hFuÎFÏg
(
£lf
):

136 
£lf
.
	`Te¡H–pFÏg
('--help')

138 
def
 
	$‹¡PrštsH–pW™hShÜtFÏg
(
£lf
):

139 
£lf
.
	`Te¡H–pFÏg
('-h')

141 
def
 
	$‹¡PrštsH–pW™hQue¡iÚFÏg
(
£lf
):

142 
£lf
.
	`Te¡H–pFÏg
('-?')

144 
def
 
	$‹¡PrštsH–pW™hWšdowsStyËQue¡iÚFÏg
(
£lf
):

145 
£lf
.
	`Te¡H–pFÏg
('/?')

147 
def
 
	$‹¡PrštsH–pW™hUÄecognizedGoogËTe¡FÏg
(
£lf
):

148 
£lf
.
	$Te¡H–pFÏg
(
UNKNOWN_FLAG
)

150 
def
 
	$‹¡PrštsH–pW™hIncÜ»ùFÏgStyË
(
£lf
):

151 
šcÜ»ù_æag
 
š
 
INCORRECT_FLAG_VARIANTS
:

152 
£lf
.
	$Te¡H–pFÏg
(
šcÜ»ù_æag
)

154 
def
 
	$‹¡RunsTe¡sW™houtH–pFÏg
(
£lf
):

156 
ªd
 
the
 
h–p
 
mes§ge
 
is
 
nÙ
 
´š‹d
."""

158 
£lf
.
	$Te¡NÚH–pFÏg
(
NÚe
)

160 
def
 
	$‹¡RunsTe¡sW™hG‹¡IÁ”ÇlFÏg
(
£lf
):

162 
a
 
æag
 
¡¬tšg
 
w™h
 
GoogË
 
Te¡
 
´efix
 
ªd
 'š‹º®_' 
is
 
suµl›d
."""

164 
£lf
.
	$Te¡NÚH–pFÏg
(
INTERNAL_FLAG_FOR_TESTING
)

167 
__Çme__
 == '__main__':

168 
g‹¡_‹¡_uts
.
	`Maš
()

	@trunk/objs/gtest-1.6.0/test/gtest_list_tests_unittest.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


2 #
#Cİyrighˆ2006, 
GoogË
 
Inc
.

3 #AÎ 
rights
 
»£rved
.

4 #
#Redi¡ributiÚ 
ªd
 
u£
 
š
 
sourû
‡nd 
bš¬y
 
fÜms
, 
w™h
 
Ü
 
w™hout


5 #modifiÿtiÚ, 
¬e
 
³rm™‹d
 
´ovided
 
th©
 
the
 
fŞlowšg
 
cÚd™iÚs
‡re

7 #
#* 
Redi¡ributiÚs
 
of
 
sourû
 
code
 
mu¡
 
»š
 
the
 
above
 
cİyright


8 #nÙiû, 
this
 
li¡
 
of
 
cÚd™iÚs
 
ªd
 
the
 
fŞlowšg
 
disşaim”
.

9 #* 
Redi¡ributiÚs
 
š
 
bš¬y
 
fÜm
 
mu¡
 
»´oduû
 
the
 
above


10 #cİyrighˆ
nÙiû
, 
this
 
li¡
 
of
 
cÚd™iÚs
 
ªd
 
the
 
fŞlowšg
 
disşaim”


11 #š 
the
 
docum’tiÚ
 
ªd
/
Ü
 
Ùh”
 
m©”Ÿls
 
´ovided
 
w™h
he

13 #* 
Ne™h”
 
the
 
Çme
 
of
 
GoogË
 
Inc
. 
nÜ
h
Çmes
 oà
™s


14 #cÚŒibutÜ 
may
 
be
 
u£d
 
to
 
’dÜ£
 
Ü
 
´omÙe
 
´oduùs
 
d”ived
 
äom


15 #thi 
soáw¬e
 
w™hout
 
¥ecific
 
´iÜ
 
wr™‹n
 
³rmissiÚ
.

16 #
#THIS 
SOFTWARE
 
IS
 
PROVIDED
 
BY
 
THE
 
COPYRIGHT
 
HOLDERS
 
AND
 
CONTRIBUTORS


17 #"
AS
 
IS
" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT

18 #LIMITED 
TO
, 
THE
 
IMPLIED
 
WARRANTIES
 
OF
 
MERCHANTABILITY
 
AND
 
FITNESS
 
FOR


19 #A 
PARTICULAR
 
PURPOSE
 
ARE
 
DISCLAIMED
. 
IN
 
NO
 
EVENT
 
SHALL
 
THE
 
COPYRIGHT


20 #OWNER 
OR
 
CONTRIBUTORS
 
BE
 
LIABLE
 
FOR
 
ANY
 
DIRECT
, 
INDIRECT
, 
INCIDENTAL
,

21 #SPECIAL, 
EXEMPLARY
, 
OR
 
CONSEQUENTIAL
 
DAMAGES
 (
INCLUDING
, 
BUT
 
NOT


22 #LIMITED 
TO
, 
PROCUREMENT
 
OF
 
SUBSTITUTE
 
GOODS
 
OR
 
SERVICES
; 
LOSS
 OF 
USE
,

23 #DATA, 
OR
 
PROFITS
; OR 
BUSINESS
 
INTERRUPTION
è
HOWEVER
 
CAUSED
 
AND
 
ON
 
ANY


24 #THEORY 
OF
 
LIABILITY
, 
WHETHER
 
IN
 
CONTRACT
, 
STRICT
 LIABILITY, 
OR
 
TORT


25 #(
INCLUDING
 
NEGLIGENCE
 
OR
 
OTHERWISE
è
ARISING
 
IN
 
ANY
 
WAY
 
OUT
 
OF
 
THE
 
USE


26 #OF 
THIS
 
SOFTWARE
, 
EVEN
 
IF
 
ADVISED
 
OF
 
THE
 
POSSIBILITY
 OF 
SUCH
 
DAMAGE
.

30 
A
 
u£r
 
ÿn
 
ask
 
GoogË
 
Te¡
 
to
 
li¡
 
®l
 
‹¡s
 
by
 
¥ecifyšg
 
	gthe


31 --
g‹¡_li¡_‹¡s
 
	gæag
. 
This
 
süt
 
‹¡s
 
such
 
funùiÚ®™y


32 
by
 
švokšg
 
	$g‹¡_li¡_‹¡s_un™‹¡_
 (
a
 
´og¿m
 
wr™‹n
 
w™h


33 
GoogË
 
Te¡
è
the
 
commªd
 
lše
 
æags
.

36 
__authÜ__
 = 'phanna@google.com (Patrick Hanna)'

38 
impÜt
 
g‹¡_‹¡_uts


43 #Th
commªd
 
lše
 
æag
 
’ablšg
/
di§blšg
 
li¡šg
 
®l
 
‹¡s
.

44 
LIST_TESTS_FLAG
 = 'gtest_list_tests'

46 #P©h 
to
 
the
 
g‹¡_li¡_‹¡s_un™‹¡_
 
´og¿m
.

47 
EXE_PATH
 = 
g‹¡_‹¡_uts
.
	`G‘Te¡ExecubËP©h
('gtest_list_tests_unittest_')

49 #Th
ex³ùed
 
ouut
 
wh’
 
ruÂšg
 
g‹¡_li¡_‹¡s_un™‹¡_
 
w™h


50 #--
g‹¡_li¡_‹¡s


51 
EXPECTED_OUTPUT_NO_FILTER
 = """FooDeathTest.

52 
Te¡1


53 
Foo
.

54 
B¬1


55 
B¬2


56 
DISABLED_B¬3


57 
Abc
.

58 
Xyz


59 
Def


60 
FooB¬
.

61 
Baz


62 
FooTe¡
.

63 
Te¡1


64 
DISABLED_Te¡2


65 
Te¡3


68 #Th
ex³ùed
 
ouut
 
wh’
 
ruÂšg
 
g‹¡_li¡_‹¡s_un™‹¡_
 
w™h


69 #--
g‹¡_li¡_‹¡s
 
ªd
 --
g‹¡_f‹r
=
Foo
*.

70 
EXPECTED_OUTPUT_FILTER_FOO
 = """FooDeathTest.

71 
Te¡1


72 
Foo
.

73 
B¬1


74 
B¬2


75 
DISABLED_B¬3


76 
FooB¬
.

77 
Baz


78 
FooTe¡
.

79 
Te¡1


80 
DISABLED_Te¡2


81 
Te¡3


87 
def
 
	$Run
(
¬gs
):

90  
g‹¡_‹¡_uts
.
	`Sub´oûss
([
EXE_PATH
] + 
¬gs
,

91 
ÿ±u»_¡d”r
=
F®£
).
ouut


94 #Th
un™
 
‹¡
.

96 
şass
 
	$GTe¡Li¡Te¡sUn™Te¡
(
g‹¡_‹¡_uts
.
Te¡Ca£
):

99 
def
 
	$RunAndV”ify
(
£lf
, 
æag_v®ue
, 
ex³ùed_ouut
, 
Ùh”_æag
):

101 
the
 
cÜ»ù
 
‹¡s
.

103 
Args
:

104 
æag_v®ue
: 
v®ue
 
of
 
the
 --
g‹¡_li¡_‹¡s
 
æag
;

105 
NÚe
 
the
 
æag
 
should
 
nÙ
 
be
 
´e£Á
.

107 
ex³ùed_ouut
: 
the
 
ex³ùed
 
ouut
 
aá”
 
ruÂšg
 
commªd
;

109 
Ùh”_æag
: 
a
 
difã»Á
 
æag
 
to
 
be
 
·s£d
Ø
commªd


110 
®Úg
 
w™h
 
g‹¡_li¡_‹¡s
;

111 
NÚe
 
the
 
æag
 
should
 
nÙ
 
be
 
´e£Á
.

114 
æag_v®ue
 
is
 
NÚe
:

115 
æag
 = ''

116 
æag_ex´essiÚ
 = 'not set'

117 
–if
 
æag_v®ue
 == '0':

118 
æag
 = '--%s=0' % 
LIST_TESTS_FLAG


119 
æag_ex´essiÚ
 = '0'

121 
æag
 = '--%s' % 
LIST_TESTS_FLAG


122 
æag_ex´essiÚ
 = '1'

124 
¬gs
 = [
æag
]

126 
Ùh”_æag
 
is
 
nÙ
 
NÚe
:

127 
¬gs
 +ğ[
Ùh”_æag
]

129 
ouut
 = 
	$Run
(
¬gs
)

131 
msg
 = ('when %s is %s,he output of "%s" is "%s".' %

132 (
LIST_TESTS_FLAG
, 
æag_ex´essiÚ
, ' '.
	`još
(
¬gs
), 
ouut
))

134 
ex³ùed_ouut
 
is
 
nÙ
 
NÚe
:

135 
£lf
.
	$as£¹_
(
ouut
 =ğ
ex³ùed_ouut
, 
msg
)

137 
£lf
.
	`as£¹_
(
ouut
 !ğ
EXPECTED_OUTPUT_NO_FILTER
, 
msg
)

139 
def
 
	$‹¡DeçuÉBehaviÜ
(
£lf
):

142 
£lf
.
	$RunAndV”ify
(
æag_v®ue
=
NÚe
,

143 
ex³ùed_ouut
=
NÚe
,

144 
Ùh”_æag
=
NÚe
)

146 
def
 
	$‹¡FÏg
(
£lf
):

149 
£lf
.
	`RunAndV”ify
(
æag_v®ue
='0',

150 
ex³ùed_ouut
=
NÚe
,

151 
Ùh”_æag
=
NÚe
)

152 
£lf
.
	`RunAndV”ify
(
æag_v®ue
='1',

153 
ex³ùed_ouut
=
EXPECTED_OUTPUT_NO_FILTER
,

154 
Ùh”_æag
=
NÚe
)

156 
def
 
	$‹¡Ov”rideNÚF‹rFÏgs
(
£lf
):

159 
£lf
.
	`RunAndV”ify
(
æag_v®ue
='1',

160 
ex³ùed_ouut
=
EXPECTED_OUTPUT_NO_FILTER
,

161 
Ùh”_æag
='--gtest_break_on_failure')

163 
def
 
	$‹¡W™hF‹rFÏgs
(
£lf
):

165 --
g‹¡_f‹r
 
æag
."""

167 
£lf
.
	`RunAndV”ify
(
æag_v®ue
='1',

168 
ex³ùed_ouut
=
EXPECTED_OUTPUT_FILTER_FOO
,

169 
Ùh”_æag
='--gtest_filter=Foo*')

172 
__Çme__
 == '__main__':

173 
g‹¡_‹¡_uts
.
	`Maš
()

	@trunk/objs/gtest-1.6.0/test/gtest_output_test.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


2 #
#Cİyrighˆ2008, 
GoogË
 
Inc
.

3 #AÎ 
rights
 
»£rved
.

4 #
#Redi¡ributiÚ 
ªd
 
u£
 
š
 
sourû
‡nd 
bš¬y
 
fÜms
, 
w™h
 
Ü
 
w™hout


5 #modifiÿtiÚ, 
¬e
 
³rm™‹d
 
´ovided
 
th©
 
the
 
fŞlowšg
 
cÚd™iÚs
‡re

7 #
#* 
Redi¡ributiÚs
 
of
 
sourû
 
code
 
mu¡
 
»š
 
the
 
above
 
cİyright


8 #nÙiû, 
this
 
li¡
 
of
 
cÚd™iÚs
 
ªd
 
the
 
fŞlowšg
 
disşaim”
.

9 #* 
Redi¡ributiÚs
 
š
 
bš¬y
 
fÜm
 
mu¡
 
»´oduû
 
the
 
above


10 #cİyrighˆ
nÙiû
, 
this
 
li¡
 
of
 
cÚd™iÚs
 
ªd
 
the
 
fŞlowšg
 
disşaim”


11 #š 
the
 
docum’tiÚ
 
ªd
/
Ü
 
Ùh”
 
m©”Ÿls
 
´ovided
 
w™h
he

13 #* 
Ne™h”
 
the
 
Çme
 
of
 
GoogË
 
Inc
. 
nÜ
h
Çmes
 oà
™s


14 #cÚŒibutÜ 
may
 
be
 
u£d
 
to
 
’dÜ£
 
Ü
 
´omÙe
 
´oduùs
 
d”ived
 
äom


15 #thi 
soáw¬e
 
w™hout
 
¥ecific
 
´iÜ
 
wr™‹n
 
³rmissiÚ
.

16 #
#THIS 
SOFTWARE
 
IS
 
PROVIDED
 
BY
 
THE
 
COPYRIGHT
 
HOLDERS
 
AND
 
CONTRIBUTORS


17 #"
AS
 
IS
" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT

18 #LIMITED 
TO
, 
THE
 
IMPLIED
 
WARRANTIES
 
OF
 
MERCHANTABILITY
 
AND
 
FITNESS
 
FOR


19 #A 
PARTICULAR
 
PURPOSE
 
ARE
 
DISCLAIMED
. 
IN
 
NO
 
EVENT
 
SHALL
 
THE
 
COPYRIGHT


20 #OWNER 
OR
 
CONTRIBUTORS
 
BE
 
LIABLE
 
FOR
 
ANY
 
DIRECT
, 
INDIRECT
, 
INCIDENTAL
,

21 #SPECIAL, 
EXEMPLARY
, 
OR
 
CONSEQUENTIAL
 
DAMAGES
 (
INCLUDING
, 
BUT
 
NOT


22 #LIMITED 
TO
, 
PROCUREMENT
 
OF
 
SUBSTITUTE
 
GOODS
 
OR
 
SERVICES
; 
LOSS
 OF 
USE
,

23 #DATA, 
OR
 
PROFITS
; OR 
BUSINESS
 
INTERRUPTION
è
HOWEVER
 
CAUSED
 
AND
 
ON
 
ANY


24 #THEORY 
OF
 
LIABILITY
, 
WHETHER
 
IN
 
CONTRACT
, 
STRICT
 LIABILITY, 
OR
 
TORT


25 #(
INCLUDING
 
NEGLIGENCE
 
OR
 
OTHERWISE
è
ARISING
 
IN
 
ANY
 
WAY
 
OUT
 
OF
 
THE
 
USE


26 #OF 
THIS
 
SOFTWARE
, 
EVEN
 
IF
 
ADVISED
 
OF
 
THE
 
POSSIBILITY
 OF 
SUCH
 
DAMAGE
.

30 
SYNOPSIS


31 
	gg‹¡_ouut_‹¡
.
	gpy
 --
	gbud_dœ
=
BUILD
/
DIR
 --
g’gŞd’


32 #wh”
BUILD
/
DIR
 
cÚšs
 
the
 
but
 
g‹¡_ouut_‹¡_
 
fe
.

33 
g‹¡_ouut_‹¡
.
py
 --
g’gŞd’


34 
g‹¡_ouut_‹¡
.
py


37 
__authÜ__
 = 'wan@google.com (Zhanyong Wan)'

39 
impÜt
 
os


40 
impÜt
 
»


41 
impÜt
 
sys


42 
impÜt
 
g‹¡_‹¡_uts


45 #Th
æag
 
g’”©šg
 
the
 
gŞd’
 
fe


46 
GENGOLDEN_FLAG
 = '--gengolden'

47 
CATCH_EXCEPTIONS_ENV_VAR_NAME
 = 'GTEST_CATCH_EXCEPTIONS'

49 
IS_WINDOWS
 = 
os
.
Çme
 == 'nt'

51 #TODO(
vÏdl
@
googË
.
com
): 
»move
 
the
 
_lš
 
suffix
.

52 
GOLDEN_NAME
 = 'gtest_output_test_golden_lin.txt'

54 
PROGRAM_PATH
 = 
g‹¡_‹¡_uts
.
G‘Te¡ExecubËP©h
('gtest_output_test_')

56 #Aˆ
Ëa¡
 
Úe
 
commªd
 
we
 
ex”ci£
 
mu¡
 
nÙ
 
have
 
the


57 #--
g‹¡_š‹º®_sk_’vœÚm’t_ªd_ad_hoc_‹¡s
 
æag
.

58 
COMMAND_LIST_TESTS
 = ({}, [
PROGRAM_PATH
, '--gtest_list_tests'])

59 
	gCOMMAND_WITH_COLOR
 = ({}, [
PROGRAM_PATH
, '--gtest_color=yes'])

60 
	gCOMMAND_WITH_TIME
 = ({}, [
PROGRAM_PATH
,

64 
	gCOMMAND_WITH_DISABLED
 = (

65 {}, [
PROGRAM_PATH
,

69 
	gCOMMAND_WITH_SHARDING
 = (

71 [
PROGRAM_PATH
,

75 
	gGOLDEN_PATH
 = 
os
.
·th
.
još
(
g‹¡_‹¡_uts
.
G‘SourûDœ
(), 
GOLDEN_NAME
)

78 
def
 
	$ToUnixLšeEndšg
(
s
):

81  
s
.
	`»¶aû
('\r\n', '\n').replace('\r', '\n')

84 
def
 
	$RemoveLoÿtiÚs
(
‹¡_ouut
):

87 
Args
:

88 
‹¡_ouut
: 
the
 
ouut
 
of
 
a
 
GoogË
 
Te¡
 
´og¿m
.

90 
R‘uºs
:

91 
ouut
 
w™h
 
®l
 
fe
 
loÿtiÚ
 
	`šfo
 (
š
 
the
 
fÜm
 
of


92 'DIRECTORY/FILE_NAME:LINE_NUMBER: '
Ü


93 'DIRECTORY\\FILE_NAME(LINE_NUMBER): 'è
»¶aûd
 
by


97  
»
.
	`sub
(
r
'.*[/\\](.+)(\:\d+|\(\d+\))\: ',„'\1:#: ', 
‹¡_ouut
)

100 
def
 
	$RemoveSckT¿ûD‘as
(
ouut
):

103 #*? 
m—ns
 "findhe shortest stringhat matches".

104  
»
.
	`sub
(
r
'Stackrace:(.|\n)*?\n\n',

105 'Sck¿û: (om™‹d)\n\n', 
ouut
)

108 
def
 
	$RemoveSckT¿ûs
(
ouut
):

111 #*? 
m—ns
 "findhe shortest stringhat matches".

112  
»
.
	`sub
(
r
'Sck¿û:(.|\n)*?\n\n', '', 
ouut
)

115 
def
 
	$RemoveTime
(
ouut
):

118  
»
.
	`sub
(
r
'\(\d+ ms', '(? ms', 
ouut
)

121 
def
 
	$RemoveTy³InfoD‘as
(
‹¡_ouut
):

124 
Args
:

125 
‹¡_ouut
: 
the
 
ouut
 
of
 
a
 
GoogË
 
Te¡
 
´og¿m
.

127 
R‘uºs
:

128 
ouut
 
w™h
 
ty³
 
šfÜm©iÚ
 
nÜm®ized
 
to
 
ÿnÚiÿl
 
fÜm
.

131 #som
comp”s
 
ouut
 
the
 
Çme
 
of
 
ty³
 'unsigÃd iÁ' 
as
 'unsigned'

132  
»
.
	`sub
(
r
'unsigÃd iÁ', 'unsigÃd', 
‹¡_ouut
)

135 
def
 
	$NÜm®izeToCu¼’tPÏtfÜm
(
‹¡_ouut
):

138 
IS_WINDOWS
:

139 #Remove 
the
 
cŞÜ
 
šfÜm©iÚ
 
th©
 
is
 
nÙ
 
´e£Á
 
Ú
 
Wšdows
.

140 
‹¡_ouut
 = 
»
.
	`sub
('\x1b\\[(0;3\d)?m', '',est_output)

141 #Chªge 
çu»
 
mes§ge
 
h—d”s
 
što
 
the
 
Wšdows
 
fÜm©
.

142 
‹¡_ouut
 = 
»
.
	`sub
(
r
': Failure\n',„':ƒrror: ',est_output)

143 #Chªge 
	`fe
(
lše_numb”
è
to
 
fe
:line_number.

144 
‹¡_ouut
 = 
»
.
	`sub
(
r
'((\w|\.)+)\((\d+)\):',„'\1:\3:',est_output)

146  
‹¡_ouut


149 
def
 
	$RemoveTe¡CouÁs
(
ouut
):

152 
ouut
 = 
»
.
	`sub
(
r
'\d+ests?,†isted below',

153 '?e¡s,†i¡ed b–ow', 
ouut
)

154 
ouut
 = 
»
.
	`sub
(
r
'\d+ FAILED TESTS',

155 '? FAILED TESTS', 
ouut
)

156 
ouut
 = 
»
.
	`sub
(
r
'\d+ests? from \d+est cases?',

157 '?e¡ äom ?e¡ ca£s', 
ouut
)

158 
ouut
 = 
»
.
	`sub
(
r
'\d+ests? from ([a-zA-Z_])',

159 
r
'?e¡ äom \1', 
ouut
)

160  
»
.
	`sub
(
r
'\d+e¡s?\.', '?e¡s.', 
ouut
)

163 
def
 
	$RemoveM©chšgTe¡s
(
‹¡_ouut
, 
·‰”n
):

166 
This
 
funùiÚ
 
¡rs
 
nÙ
 
Úly
 
the
 
begšnšg
 
ªd
h
’d
 
of
 
a
 
‹¡
 
but
 
®so


167 
®l
 
ouut
 
š
 
b‘w“n
.

169 
Args
:

170 
‹¡_ouut
: 
A
 
¡ršg
 
cÚššg
 
the
 
‹¡
 
ouut
.

171 
·‰”n
: 
A
 
»gex
 
¡ršg
 
th©
 
m©ches
 
Çmes
 
of
 
‹¡
 
ÿ£s
 
Ü


172 
‹¡s
 
to
 
»move
.

174 
R‘uºs
:

175 
CÚ‹Ás
 
of
 
‹¡_ouut
 
w™h
 
‹¡s
 
who£
 
Çmes
 
m©ch
 
·‰”n
 
»moved
.

178 
‹¡_ouut
 = 
»
.
	`sub
(

179 
r
'.*\[ RUN \] .*%s(.|\n)*?\[( FAILED | OK )\] .*%s.*\n' % (

180 
·‰”n
,…attern),

182 
‹¡_ouut
)

183  
»
.
	`sub
(
r
'.*%s.*\n' % 
·‰”n
, '', 
‹¡_ouut
)

186 
def
 
	$NÜm®izeOuut
(
ouut
):

189 
ouut
 = 
	$ToUnixLšeEndšg
(
ouut
)

190 
ouut
 = 
	$RemoveLoÿtiÚs
(
ouut
)

191 
ouut
 = 
	$RemoveSckT¿ûD‘as
(
ouut
)

192 
ouut
 = 
	$RemoveTime
(
ouut
)

193  
ouut


196 
def
 
	$G‘Sh–lCommªdOuut
(
’v_cmd
):

199 
Args
:

200 
’v_cmd
: 
The
 
sh–l
 
commªd
. 
A
 2-
tu¶e
 
wh”e
 
–em’t
 0 
is
 
a
 
diù
 
of
 
exŒa


201 
’vœÚm’t
 
v¬ŸbËs
 
to
 
£t
, 
ªd
 
–em’t
 1 
is
 
a
 
¡ršg
 
w™h


202 
the
 
commªd
 
ªd
 
ªy
 
æags
.

204 
R‘uºs
:

205 
A
 
¡ršg
 
w™h
 
the
 
commªd
's combined standard‡nd diagnostic output.

208 #S·wn 
cmd
 
š
 
a
 
sub
-
´oûss
, 
ªd
 
g‘s
 
™s
 
¡ªd¬d
 
I
/
O
 
fe
 
objeùs
.

209 #S‘ 
ªd
 
§ve
 
the
 
’vœÚm’t
 
´İ”ly
.

210 
’vœÚ
 = 
os
.’vœÚ.
	$cİy
()

211 
’vœÚ
.
	$upd©e
(
’v_cmd
[0])

212 
p
 = 
g‹¡_‹¡_uts
.
	$Sub´oûss
(
’v_cmd
[1], 
’v
=
’vœÚ
)

214  
p
.
ouut


217 
def
 
	$G‘CommªdOuut
(
’v_cmd
):

219 
šfo
 
¡r³d
 
off
.

221 
Args
:

222 
’v_cmd
: 
The
 
sh–l
 
commªd
. 
A
 2-
tu¶e
 
wh”e
 
–em’t
 0 
is
 
a
 
diù
 
of
 
exŒa


223 
’vœÚm’t
 
v¬ŸbËs
 
to
 
£t
, 
ªd
 
–em’t
 1 
is
 
a
 
¡ršg
 
w™h


224 
the
 
commªd
 
ªd
 
ªy
 
æags
.

227 #Di§bË 
exû±iÚ
 
pİ
-
ups
 
Ú
 
Wšdows
.

228 
’vœÚ
, 
cmdlše
 = 
’v_cmd


229 
’vœÚ
 = 
	$diù
(
’vœÚ
è#Ensu» 
we
 
¬e
 
modifyšg
 
a
 
cİy
.

230 
’vœÚ
[
CATCH_EXCEPTIONS_ENV_VAR_NAME
] = '1'

231  
	`NÜm®izeOuut
(
	`G‘Sh–lCommªdOuut
((
’vœÚ
, 
cmdlše
)))

234 
def
 
	$G‘OuutOfAÎCommªds
():

237  (
	`G‘CommªdOuut
(
COMMAND_WITH_COLOR
) +

238 
	`G‘CommªdOuut
(
COMMAND_WITH_TIME
) +

239 
	`G‘CommªdOuut
(
COMMAND_WITH_DISABLED
) +

240 
	$G‘CommªdOuut
(
COMMAND_WITH_SHARDING
))

243 
‹¡_li¡
 = 
	$G‘Sh–lCommªdOuut
(
COMMAND_LIST_TESTS
)

244 
SUPPORTS_DEATH_TESTS
 = 'D—thTe¡' 
š
 
‹¡_li¡


245 
SUPPORTS_TYPED_TESTS
 = 'Ty³dTe¡' 
š
 
‹¡_li¡


246 
SUPPORTS_THREADS
 = 'Ex³ùFau»W™hTh»adsTe¡' 
š
 
‹¡_li¡


247 
SUPPORTS_STACK_TRACES
 = 
F®£


249 
CAN_GENERATE_GOLDEN_FILE
 = (
SUPPORTS_DEATH_TESTS
 
ªd


250 
SUPPORTS_TYPED_TESTS
 
ªd


251 
SUPPORTS_THREADS
)

254 
şass
 
	$GTe¡OuutTe¡
(
g‹¡_‹¡_uts
.
Te¡Ca£
):

255 
def
 
	$RemoveUnsuµÜ‹dTe¡s
(
£lf
, 
‹¡_ouut
):

256 
nÙ
 
SUPPORTS_DEATH_TESTS
:

257 
‹¡_ouut
 = 
	`RemoveM©chšgTe¡s
(test_output, 'DeathTest')

258 
nÙ
 
SUPPORTS_TYPED_TESTS
:

259 
‹¡_ouut
 = 
	`RemoveM©chšgTe¡s
(test_output, 'TypedTest')

260 
‹¡_ouut
 = 
	`RemoveM©chšgTe¡s
(test_output, 'TypedDeathTest')

261 
‹¡_ouut
 = 
	`RemoveM©chšgTe¡s
(test_output, 'TypeParamDeathTest')

262 
nÙ
 
SUPPORTS_THREADS
:

263 
‹¡_ouut
 = 
	`RemoveM©chšgTe¡s
(test_output,

265 
‹¡_ouut
 = 
	`RemoveM©chšgTe¡s
(test_output,

267 
‹¡_ouut
 = 
	`RemoveM©chšgTe¡s
(test_output,

269 
nÙ
 
SUPPORTS_STACK_TRACES
:

270 
‹¡_ouut
 = 
	$RemoveSckT¿ûs
(
‹¡_ouut
)

272  
‹¡_ouut


274 
def
 
	$‹¡Ouut
(
£lf
):

275 
ouut
 = 
	$G‘OuutOfAÎCommªds
()

277 
gŞd’_fe
 = 
	`İ’
(
GOLDEN_PATH
, 'rb')

278 #A 
mis
-
cÚfigu»d
 
sourû
 
cÚŒŞ
 
sy¡em
 
ÿn
 
ÿu£
 \
r
 
­³¬
 
š
 
EOL


279 #£qu’û 
wh’
 
we
 
»ad
 
the
 
gŞd’
 
fe
 
œ»¥eùive
 
of
 
ª
 
İ”©šg


280 #sy¡em 
u£d
. 
Th”efÜe
, 
we
 
Ãed
 
to
 
¡r
 
tho£
 \
r
's from‚ewlines

282 
gŞd’
 = 
	`ToUnixLšeEndšg
(
gŞd’_fe
.
	$»ad
())

283 
gŞd’_fe
.
	$şo£
()

285 #W
wªt
 
the
 
‹¡
 
to
 
·ss
 
»g¬dËss
 
of
 
û¹aš
 
ã©u»s
 
bešg


286 #suµÜ‹d 
Ü
 
nÙ
.

288 #W
¡l
 
have
 
to
 
»move
 
ty³
 
Çme
 
¥ecifics
 
š
 
®l
 
ÿ£s
.

289 
nÜm®ized_aùu®
 = 
	$RemoveTy³InfoD‘as
(
ouut
)

290 
nÜm®ized_gŞd’
 = 
	$RemoveTy³InfoD‘as
(
gŞd’
)

292 
CAN_GENERATE_GOLDEN_FILE
:

293 
£lf
.
	$as£¹Equ®
(
nÜm®ized_gŞd’
, 
nÜm®ized_aùu®
)

295 
nÜm®ized_aùu®
 = 
	`NÜm®izeToCu¼’tPÏtfÜm
(

296 
	$RemoveTe¡CouÁs
(
nÜm®ized_aùu®
))

297 
nÜm®ized_gŞd’
 = 
	`NÜm®izeToCu¼’tPÏtfÜm
(

298 
	`RemoveTe¡CouÁs
(
£lf
.
	$RemoveUnsuµÜ‹dTe¡s
(
nÜm®ized_gŞd’
)))

300 #Thi 
code
 
is
 
v”y
 
hªdy
 
wh’
 
debuggšg
 
gŞd’
 
fe
 
difã»nûs
:

301 
os
.
	`g‘’v
('DEBUG_GTEST_OUTPUT_TEST'):

302 
	`İ’
(
os
.
·th
.
	`još
(

303 
g‹¡_‹¡_uts
.
	`G‘SourûDœ
(),

304 '_g‹¡_ouut_‹¡_nÜm®ized_aùu®.txt'), 'wb').
	$wr™e
(

305 
nÜm®ized_aùu®
)

306 
	`İ’
(
os
.
·th
.
	`još
(

307 
g‹¡_‹¡_uts
.
	`G‘SourûDœ
(),

308 '_g‹¡_ouut_‹¡_nÜm®ized_gŞd’.txt'), 'wb').
	$wr™e
(

309 
nÜm®ized_gŞd’
)

311 
£lf
.
	$as£¹Equ®
(
nÜm®ized_gŞd’
, 
nÜm®ized_aùu®
)

314 
__Çme__
 == '__main__':

315 
sys
.
¬gv
[1:] =ğ[
GENGOLDEN_FLAG
]:

316 
CAN_GENERATE_GOLDEN_FILE
:

317 
ouut
 = 
	$G‘OuutOfAÎCommªds
()

318 
gŞd’_fe
 = 
	`İ’
(
GOLDEN_PATH
, 'wb')

319 
gŞd’_fe
.
	$wr™e
(
ouut
)

320 
gŞd’_fe
.
	$şo£
()

322 
mes§ge
 = (

324 
th©
 
dÛs
 
nÙ
 
suµÜt
 
®l
 
the
 
»quœed
 
	`ã©u»s
 (
d—th
 
‹¡s
, 
ty³d
ests,

325 
ªd
 
muÉË
 
th»ads
). 
PËa£
 
g’”©e
 
the
 
gŞd’
 
fe
 
usšg
 
a
 
bš¬y
 
but


326 
w™h
 
tho£
 
ã©u»s
 
’abËd
.""")

328 
sys
.
¡d”r
.
	$wr™e
(
mes§ge
)

329 
sys
.
	$ex™
(1)

331 
g‹¡_‹¡_uts
.
	`Maš
()

	@trunk/objs/gtest-1.6.0/test/gtest_shuffle_test.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


2 #
#Cİyrighˆ2009 
GoogË
 
Inc
. 
AÎ
 
Rights
 
Re£rved
.

3 #
#Redi¡ributiÚ 
ªd
 
u£
 
š
 
sourû
‡nd 
bš¬y
 
fÜms
, 
w™h
 
Ü
 
w™hout


4 #modifiÿtiÚ, 
¬e
 
³rm™‹d
 
´ovided
 
th©
 
the
 
fŞlowšg
 
cÚd™iÚs
‡re

6 #
#* 
Redi¡ributiÚs
 
of
 
sourû
 
code
 
mu¡
 
»š
 
the
 
above
 
cİyright


7 #nÙiû, 
this
 
li¡
 
of
 
cÚd™iÚs
 
ªd
 
the
 
fŞlowšg
 
disşaim”
.

8 #* 
Redi¡ributiÚs
 
š
 
bš¬y
 
fÜm
 
mu¡
 
»´oduû
 
the
 
above


9 #cİyrighˆ
nÙiû
, 
this
 
li¡
 
of
 
cÚd™iÚs
 
ªd
 
the
 
fŞlowšg
 
disşaim”


10 #š 
the
 
docum’tiÚ
 
ªd
/
Ü
 
Ùh”
 
m©”Ÿls
 
´ovided
 
w™h
he

12 #* 
Ne™h”
 
the
 
Çme
 
of
 
GoogË
 
Inc
. 
nÜ
h
Çmes
 oà
™s


13 #cÚŒibutÜ 
may
 
be
 
u£d
 
to
 
’dÜ£
 
Ü
 
´omÙe
 
´oduùs
 
d”ived
 
äom


14 #thi 
soáw¬e
 
w™hout
 
¥ecific
 
´iÜ
 
wr™‹n
 
³rmissiÚ
.

15 #
#THIS 
SOFTWARE
 
IS
 
PROVIDED
 
BY
 
THE
 
COPYRIGHT
 
HOLDERS
 
AND
 
CONTRIBUTORS


16 #"
AS
 
IS
" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT

17 #LIMITED 
TO
, 
THE
 
IMPLIED
 
WARRANTIES
 
OF
 
MERCHANTABILITY
 
AND
 
FITNESS
 
FOR


18 #A 
PARTICULAR
 
PURPOSE
 
ARE
 
DISCLAIMED
. 
IN
 
NO
 
EVENT
 
SHALL
 
THE
 
COPYRIGHT


19 #OWNER 
OR
 
CONTRIBUTORS
 
BE
 
LIABLE
 
FOR
 
ANY
 
DIRECT
, 
INDIRECT
, 
INCIDENTAL
,

20 #SPECIAL, 
EXEMPLARY
, 
OR
 
CONSEQUENTIAL
 
DAMAGES
 (
INCLUDING
, 
BUT
 
NOT


21 #LIMITED 
TO
, 
PROCUREMENT
 
OF
 
SUBSTITUTE
 
GOODS
 
OR
 
SERVICES
; 
LOSS
 OF 
USE
,

22 #DATA, 
OR
 
PROFITS
; OR 
BUSINESS
 
INTERRUPTION
è
HOWEVER
 
CAUSED
 
AND
 
ON
 
ANY


23 #THEORY 
OF
 
LIABILITY
, 
WHETHER
 
IN
 
CONTRACT
, 
STRICT
 LIABILITY, 
OR
 
TORT


24 #(
INCLUDING
 
NEGLIGENCE
 
OR
 
OTHERWISE
è
ARISING
 
IN
 
ANY
 
WAY
 
OUT
 
OF
 
THE
 
USE


25 #OF 
THIS
 
SOFTWARE
, 
EVEN
 
IF
 
ADVISED
 
OF
 
THE
 
POSSIBILITY
 OF 
SUCH
 
DAMAGE
.

29 
	g__authÜ__
 = 'wan@google.com (Zhanyong Wan)'

31 
impÜt
 
os


32 
impÜt
 
g‹¡_‹¡_uts


34 #Commªd 
to
 
run
 
the
 
g‹¡_shufæe_‹¡_
 
´og¿m
.

35 
COMMAND
 = 
g‹¡_‹¡_uts
.
G‘Te¡ExecubËP©h
('gtest_shuffle_test_')

37 #Th
’vœÚm’t
 
v¬ŸbËs
 
‹¡
 
sh¬dšg
.

38 
TOTAL_SHARDS_ENV_VAR
 = 'GTEST_TOTAL_SHARDS'

39 
SHARD_INDEX_ENV_VAR
 = 'GTEST_SHARD_INDEX'

41 
TEST_FILTER
 = 'A*.A:A*.B:C*'

43 
ALL_TESTS
 = []

44 
ACTIVE_TESTS
 = []

45 
FILTERED_TESTS
 = []

46 
SHARDED_TESTS
 = []

48 
SHUFFLED_ALL_TESTS
 = []

49 
SHUFFLED_ACTIVE_TESTS
 = []

50 
SHUFFLED_FILTERED_TESTS
 = []

51 
SHUFFLED_SHARDED_TESTS
 = []

54 
def
 
	$AlsoRunDi§bËdTe¡sFÏg
():

58 
def
 
	$F‹rFÏg
(
‹¡_f‹r
):

59  '--g‹¡_f‹r=%s' % (
‹¡_f‹r
,)

62 
def
 
	$R•—tFÏg
(
n
):

63  '--g‹¡_»³©=%s' % (
n
,)

66 
def
 
	$ShufæeFÏg
():

70 
def
 
	$RªdomS“dFÏg
(
n
):

71  '--g‹¡_¿ndom_£ed=%s' % (
n
,)

74 
def
 
	$RunAndR‘uºOuut
(
exŒa_’v
, 
¬gs
):

77 
’vœÚ_cİy
 = 
os
.
’vœÚ
.
	$cİy
()

78 
’vœÚ_cİy
.
	$upd©e
(
exŒa_’v
)

80  
g‹¡_‹¡_uts
.
	`Sub´oûss
([
COMMAND
] + 
¬gs
, 
’v
=
’vœÚ_cİy
).
ouut


83 
def
 
	$G‘Te¡sFÜAÎI‹¿tiÚs
(
exŒa_’v
, 
¬gs
):

86 
Args
:

87 
exŒa_’v
: 
a
 
m­
 
äom
 
’vœÚm’t
 
v¬ŸbËs
 
to
 
theœ
 
v®ues


88 
¬gs
: 
commªd
 
lše
 
æags
 
to
 
·ss
Ø
g‹¡_shufæe_‹¡_


90 
R‘uºs
:

91 
A
 
li¡
 
wh”e
 
the
 
i
-
th
 
–em’t
 
is
hli¡ 
of
 
‹¡s
 
run
 
š
he i-th

92 
‹¡
 
™”©iÚ
.

95 
‹¡_™”©iÚs
 = []

96 
lše
 
š
 
	`RunAndR‘uºOuut
(
exŒa_’v
, 
¬gs
).
	`¥l™
('\n'):

97 
lše
.
	`¡¬tsw™h
('----'):

98 
‹¡s
 = []

99 
‹¡_™”©iÚs
.
	$­³nd
(
‹¡s
)

100 
–if
 
lše
.
	$¡r
():

101 
‹¡s
.
	`­³nd
(
lše
.
	$¡r
()è#'
Te¡Ca£Name
.
Te¡Name
'

103  
‹¡_™”©iÚs


106 
def
 
	$G‘Te¡Ca£s
(
‹¡s
):

109 
Args
:

110 
‹¡s
: 
a
 
li¡
 
of
 
fuÎ
 
‹¡
 
Çmes


112 
R‘uºs
:

113 
A
 
li¡
 
of
 
‹¡
 
ÿ£s
 
äom
 '‹¡s', 
š
 
theœ
 
Üigš®
 
Üd”
.

114 
CÚ£cutive
 
du¶iÿ‹s
 
¬e
 
»moved
.

117 
‹¡_ÿ£s
 = []

118 
‹¡
 
š
 
‹¡s
:

119 
‹¡_ÿ£
 = 
‹¡
.
	`¥l™
('.')[0]

120 
nÙ
 
‹¡_ÿ£
 
š
 
‹¡_ÿ£s
:

121 
‹¡_ÿ£s
.
	$­³nd
(
‹¡_ÿ£
)

123  
‹¡_ÿ£s


126 
def
 
	$C®cuÏ‹Te¡Li¡s
():

129 
nÙ
 
ALL_TESTS
:

130 
ALL_TESTS
.
	`ex‹nd
(

131 
	`G‘Te¡sFÜAÎI‹¿tiÚs
({
	}
}, [
AlsoRunDi§bËdTe¡sFÏg
()])[0])

133 
nÙ
 
	gACTIVE_TESTS
:

134 
ACTIVE_TESTS
.
ex‹nd
(
G‘Te¡sFÜAÎI‹¿tiÚs
({}, [])[0])

136 
nÙ
 
	gFILTERED_TESTS
:

137 
FILTERED_TESTS
.
ex‹nd
(

138 
G‘Te¡sFÜAÎI‹¿tiÚs
({}, [
F‹rFÏg
(
TEST_FILTER
)])[0])

140 
nÙ
 
	gSHARDED_TESTS
:

141 
SHARDED_TESTS
.
ex‹nd
(

142 
G‘Te¡sFÜAÎI‹¿tiÚs
({
TOTAL_SHARDS_ENV_VAR
: '3',

143 
SHARD_INDEX_ENV_VAR
: '1'},

146 
nÙ
 
	gSHUFFLED_ALL_TESTS
:

147 
SHUFFLED_ALL_TESTS
.
ex‹nd
(
G‘Te¡sFÜAÎI‹¿tiÚs
(

148 {}, [
AlsoRunDi§bËdTe¡sFÏg
(), 
ShufæeFÏg
(), 
RªdomS“dFÏg
(1)])[0])

150 
nÙ
 
	gSHUFFLED_ACTIVE_TESTS
:

151 
SHUFFLED_ACTIVE_TESTS
.
ex‹nd
(
G‘Te¡sFÜAÎI‹¿tiÚs
(

152 {}, [
ShufæeFÏg
(), 
RªdomS“dFÏg
(1)])[0])

154 
nÙ
 
	gSHUFFLED_FILTERED_TESTS
:

155 
SHUFFLED_FILTERED_TESTS
.
ex‹nd
(
G‘Te¡sFÜAÎI‹¿tiÚs
(

156 {}, [
ShufæeFÏg
(), 
RªdomS“dFÏg
(1), 
F‹rFÏg
(
TEST_FILTER
)])[0])

158 
nÙ
 
	gSHUFFLED_SHARDED_TESTS
:

159 
SHUFFLED_SHARDED_TESTS
.
ex‹nd
(

160 
G‘Te¡sFÜAÎI‹¿tiÚs
({
TOTAL_SHARDS_ENV_VAR
: '3',

161 
SHARD_INDEX_ENV_VAR
: '1'},

162 [
ShufæeFÏg
(), 
RªdomS“dFÏg
(1)])[0])

165 
şass
 
	$GTe¡ShufæeUn™Te¡
(
g‹¡_‹¡_uts
.
Te¡Ca£
):

168 
def
 
	$£tUp
(
£lf
):

169 
	$C®cuÏ‹Te¡Li¡s
()

171 
def
 
	$‹¡ShufæeP»£rvesNumb”OfTe¡s
(
£lf
):

172 
£lf
.
	`as£¹Equ®
(
	`Ën
(
ALL_TESTS
), 
	$Ën
(
SHUFFLED_ALL_TESTS
))

173 
£lf
.
	`as£¹Equ®
(
	`Ën
(
ACTIVE_TESTS
), 
	$Ën
(
SHUFFLED_ACTIVE_TESTS
))

174 
£lf
.
	`as£¹Equ®
(
	`Ën
(
FILTERED_TESTS
), 
	$Ën
(
SHUFFLED_FILTERED_TESTS
))

175 
£lf
.
	`as£¹Equ®
(
	`Ën
(
SHARDED_TESTS
), 
	$Ën
(
SHUFFLED_SHARDED_TESTS
))

177 
def
 
	$‹¡ShufæeChªgesTe¡Ord”
(
£lf
):

178 
£lf
.
	`as£¹_
(
SHUFFLED_ALL_TESTS
 !ğ
ALL_TESTS
, SHUFFLED_ALL_TESTS)

179 
£lf
.
	`as£¹_
(
SHUFFLED_ACTIVE_TESTS
 !ğ
ACTIVE_TESTS
, SHUFFLED_ACTIVE_TESTS)

180 
£lf
.
	`as£¹_
(
SHUFFLED_FILTERED_TESTS
 !ğ
FILTERED_TESTS
,

181 
SHUFFLED_FILTERED_TESTS
)

182 
£lf
.
	`as£¹_
(
SHUFFLED_SHARDED_TESTS
 !ğ
SHARDED_TESTS
,

183 
SHUFFLED_SHARDED_TESTS
)

185 
def
 
	$‹¡ShufæeChªgesTe¡Ca£Ord”
(
£lf
):

186 
£lf
.
	`as£¹_
(
	`G‘Te¡Ca£s
(
SHUFFLED_ALL_TESTS
è!ğG‘Te¡Ca£s(
ALL_TESTS
),

187 
	$G‘Te¡Ca£s
(
SHUFFLED_ALL_TESTS
))

188 
£lf
.
	`as£¹_
(

189 
	`G‘Te¡Ca£s
(
SHUFFLED_ACTIVE_TESTS
è!ğG‘Te¡Ca£s(
ACTIVE_TESTS
),

190 
	$G‘Te¡Ca£s
(
SHUFFLED_ACTIVE_TESTS
))

191 
£lf
.
	`as£¹_
(

192 
	`G‘Te¡Ca£s
(
SHUFFLED_FILTERED_TESTS
è!ğG‘Te¡Ca£s(
FILTERED_TESTS
),

193 
	$G‘Te¡Ca£s
(
SHUFFLED_FILTERED_TESTS
))

194 
£lf
.
	`as£¹_
(

195 
	`G‘Te¡Ca£s
(
SHUFFLED_SHARDED_TESTS
è!ğG‘Te¡Ca£s(
SHARDED_TESTS
),

196 
	$G‘Te¡Ca£s
(
SHUFFLED_SHARDED_TESTS
))

198 
def
 
	$‹¡ShufæeDÛsNÙR•—tTe¡
(
£lf
):

199 
‹¡
 
š
 
SHUFFLED_ALL_TESTS
:

200 
£lf
.
	`as£¹Equ®
(1, 
SHUFFLED_ALL_TESTS
.
	`couÁ
(
‹¡
),

201 '% ­³¬ mÜthª onû' % (
‹¡
,))

202 
‹¡
 
š
 
SHUFFLED_ACTIVE_TESTS
:

203 
£lf
.
	`as£¹Equ®
(1, 
SHUFFLED_ACTIVE_TESTS
.
	`couÁ
(
‹¡
),

204 '% ­³¬ mÜthª onû' % (
‹¡
,))

205 
‹¡
 
š
 
SHUFFLED_FILTERED_TESTS
:

206 
£lf
.
	`as£¹Equ®
(1, 
SHUFFLED_FILTERED_TESTS
.
	`couÁ
(
‹¡
),

207 '% ­³¬ mÜthª onû' % (
‹¡
,))

208 
‹¡
 
š
 
SHUFFLED_SHARDED_TESTS
:

209 
£lf
.
	`as£¹Equ®
(1, 
SHUFFLED_SHARDED_TESTS
.
	`couÁ
(
‹¡
),

210 '% ­³¬ mÜthª onû' % (
‹¡
,))

212 
def
 
	$‹¡ShufæeDÛsNÙC»©eNewTe¡
(
£lf
):

213 
‹¡
 
š
 
SHUFFLED_ALL_TESTS
:

214 
£lf
.
	`as£¹_
(
‹¡
 
š
 
ALL_TESTS
, '%s is‡n invalidest' % (test,))

215 
‹¡
 
š
 
SHUFFLED_ACTIVE_TESTS
:

216 
£lf
.
	`as£¹_
(
‹¡
 
š
 
ACTIVE_TESTS
, '%s is‡n invalidest' % (test,))

217 
‹¡
 
š
 
SHUFFLED_FILTERED_TESTS
:

218 
£lf
.
	`as£¹_
(
‹¡
 
š
 
FILTERED_TESTS
, '%s is‡n invalidest' % (test,))

219 
‹¡
 
š
 
SHUFFLED_SHARDED_TESTS
:

220 
£lf
.
	`as£¹_
(
‹¡
 
š
 
SHARDED_TESTS
, '%s is‡n invalidest' % (test,))

222 
def
 
	$‹¡ShufæeInşudesAÎTe¡s
(
£lf
):

223 
‹¡
 
š
 
ALL_TESTS
:

224 
£lf
.
	`as£¹_
(
‹¡
 
š
 
SHUFFLED_ALL_TESTS
, '%s is missing' % (test,))

225 
‹¡
 
š
 
ACTIVE_TESTS
:

226 
£lf
.
	`as£¹_
(
‹¡
 
š
 
SHUFFLED_ACTIVE_TESTS
, '%s is missing' % (test,))

227 
‹¡
 
š
 
FILTERED_TESTS
:

228 
£lf
.
	`as£¹_
(
‹¡
 
š
 
SHUFFLED_FILTERED_TESTS
, '%s is missing' % (test,))

229 
‹¡
 
š
 
SHARDED_TESTS
:

230 
£lf
.
	`as£¹_
(
‹¡
 
š
 
SHUFFLED_SHARDED_TESTS
, '%s is missing' % (test,))

232 
def
 
	$‹¡ShufæeL—vesD—thTe¡sAtFrÚt
(
£lf
):

233 
nÚ_d—th_‹¡_found
 = 
F®£


234 
‹¡
 
š
 
SHUFFLED_ACTIVE_TESTS
:

235 'D—thTe¡.' 
š
 
‹¡
:

236 
£lf
.
	`as£¹_
(
nÙ
 
nÚ_d—th_‹¡_found
,

237 '% ­³¬ aá”‡‚Ú-d—the¡' % (
‹¡
,))

239 
nÚ_d—th_‹¡_found
 = 
True


241 
def
 
	$_V”ifyTe¡Ca£sDoNÙIÁ”Ëave
(
£lf
, 
‹¡s
):

242 
‹¡_ÿ£s
 = []

243 
‹¡
 
š
 
‹¡s
:

244 [
‹¡_ÿ£
, 
_
] = 
‹¡
.
	`¥l™
('.')

245 
‹¡_ÿ£s
 
ªd
e¡_ÿ£s[-1] !ğ
‹¡_ÿ£
:

246 
‹¡_ÿ£s
.
	$­³nd
(
‹¡_ÿ£
)

247 
£lf
.
	`as£¹Equ®
(1, 
‹¡_ÿ£s
.
	`couÁ
(
‹¡_ÿ£
),

249 (
‹¡_ÿ£
, 
‹¡s
))

251 
def
 
	$‹¡ShufæeDÛsNÙIÁ”ËaveTe¡Ca£s
(
£lf
):

252 
£lf
.
	$_V”ifyTe¡Ca£sDoNÙIÁ”Ëave
(
SHUFFLED_ALL_TESTS
)

253 
£lf
.
	$_V”ifyTe¡Ca£sDoNÙIÁ”Ëave
(
SHUFFLED_ACTIVE_TESTS
)

254 
£lf
.
	$_V”ifyTe¡Ca£sDoNÙIÁ”Ëave
(
SHUFFLED_FILTERED_TESTS
)

255 
£lf
.
	$_V”ifyTe¡Ca£sDoNÙIÁ”Ëave
(
SHUFFLED_SHARDED_TESTS
)

257 
def
 
	$‹¡ShufæeRe¡ÜesOrd”Aá”EachI‹¿tiÚ
(
£lf
):

258 #G‘ 
the
 
‹¡
 
li¡s
 
š
 
®l
 3 
™”©iÚs
, 
usšg
 
¿ndom
 
£ed
 1, 2,

259 #ªd 3 
»¥eùiv–y
. 
GoogË
 
Te¡
 
picks
 
a
 
difã»Á
 
£ed
 
š
 
—ch


260 #™”©iÚ, 
ªd
 
this
 
‹¡
 
d•’ds
 
Ú
 
the
 
cu¼’t
 
im¶em’tiÚ


261 #pickšg 
sucûssive
 
numb”s
. 
This
 
d•’d’cy
 
is
 
nÙ
 
id—l
, 
but


262 #make 
the
 
‹¡
 
much
 
—s›r
 
to
 
wr™e
.

263 [
‹¡s_š_™”©iÚ1
, 
‹¡s_š_™”©iÚ2
, 
‹¡s_š_™”©iÚ3
] = (

264 
	`G‘Te¡sFÜAÎI‹¿tiÚs
(

265 {
	}
}, [
ShufæeFÏg
(), 
RªdomS“dFÏg
(1), 
R•—tFÏg
(3)]))

267 #Mak
su»
 
ruÂšg
 
the
 
‹¡s
 
w™h
 
¿ndom
 
£ed
 1 
g‘s
h
§me


268 #Üd” 
as
 
š
 
™”©iÚ
 1 
above
.

269 [
‹¡s_w™h_£ed1
] = 
G‘Te¡sFÜAÎI‹¿tiÚs
(

270 {}, [
ShufæeFÏg
(), 
RªdomS“dFÏg
(1)])

271 
	g£lf
.
	$as£¹Equ®
(
‹¡s_š_™”©iÚ1
, 
‹¡s_w™h_£ed1
)

273 #Mak
su»
 
ruÂšg
 
the
 
‹¡s
 
w™h
 
¿ndom
 
£ed
 2 
g‘s
h
§me


274 #Üd” 
as
 
š
 
™”©iÚ
 2 
above
. 
Sucûss
 
m—ns
 
th©
 
GoogË
 
Te¡


275 #cÜ»ùly 
»¡Ües
 
the
 
‹¡
 
Üd”
 
befÜe
 
»
-
shufæšg
 
©
he

276 #begšnšg 
of
 
™”©iÚ
 2.

277 [
‹¡s_w™h_£ed2
] = 
	`G‘Te¡sFÜAÎI‹¿tiÚs
(

278 {
	}
}, [
ShufæeFÏg
(), 
RªdomS“dFÏg
(2)])

279 
	g£lf
.
	$as£¹Equ®
(
‹¡s_š_™”©iÚ2
, 
‹¡s_w™h_£ed2
)

281 #Mak
su»
 
ruÂšg
 
the
 
‹¡s
 
w™h
 
¿ndom
 
£ed
 3 
g‘s
h
§me


282 #Üd” 
as
 
š
 
™”©iÚ
 3 
above
. 
Sucûss
 
m—ns
 
th©
 
GoogË
 
Te¡


283 #cÜ»ùly 
»¡Ües
 
the
 
‹¡
 
Üd”
 
befÜe
 
»
-
shufæšg
 
©
he

284 #begšnšg 
of
 
™”©iÚ
 3.

285 [
‹¡s_w™h_£ed3
] = 
	`G‘Te¡sFÜAÎI‹¿tiÚs
(

286 {
	}
}, [
ShufæeFÏg
(), 
RªdomS“dFÏg
(3)])

287 
	g£lf
.
	$as£¹Equ®
(
‹¡s_š_™”©iÚ3
, 
‹¡s_w™h_£ed3
)

289 
def
 
	$‹¡ShufæeG’”©esNewOrd”InEachI‹¿tiÚ
(
£lf
):

290 [
‹¡s_š_™”©iÚ1
, 
‹¡s_š_™”©iÚ2
, 
‹¡s_š_™”©iÚ3
] = (

291 
	`G‘Te¡sFÜAÎI‹¿tiÚs
(

292 {
	}
}, [
ShufæeFÏg
(), 
RªdomS“dFÏg
(1), 
R•—tFÏg
(3)]))

294 
	g£lf
.
as£¹_
(
‹¡s_š_™”©iÚ1
 !ğ
‹¡s_š_™”©iÚ2
,

295 
‹¡s_š_™”©iÚ1
)

296 
	g£lf
.
as£¹_
(
‹¡s_š_™”©iÚ1
 !ğ
‹¡s_š_™”©iÚ3
,

297 
‹¡s_š_™”©iÚ1
)

298 
	g£lf
.
as£¹_
(
‹¡s_š_™”©iÚ2
 !ğ
‹¡s_š_™”©iÚ3
,

299 
‹¡s_š_™”©iÚ2
)

301 
def
 
	$‹¡ShufæeSh¬dedTe¡sP»£rvesP¬t™iÚ
(
£lf
):

302 #Ià
we
 
run
 
M
 
‹¡s
 
Ú
 
N
 
sh¬ds
, 
the
 
§me
 Me¡ 
should
 
be
„uÀ
š


303 #tÙ®, 
»g¬dËss
 
of
 
the
 
¿ndom
 
£eds
 
u£d
 
by
h
sh¬ds
.

304 [
‹¡s1
] = 
	`G‘Te¡sFÜAÎI‹¿tiÚs
({
TOTAL_SHARDS_ENV_VAR
: '3',

305 
SHARD_INDEX_ENV_VAR
: '0'
	}
},

306 [
ShufæeFÏg
(), 
RªdomS“dFÏg
(1)])

307 [
‹¡s2
] = 
G‘Te¡sFÜAÎI‹¿tiÚs
({
TOTAL_SHARDS_ENV_VAR
: '3',

308 
SHARD_INDEX_ENV_VAR
: '1'},

309 [
ShufæeFÏg
(), 
RªdomS“dFÏg
(20)])

310 [
‹¡s3
] = 
G‘Te¡sFÜAÎI‹¿tiÚs
({
TOTAL_SHARDS_ENV_VAR
: '3',

311 
SHARD_INDEX_ENV_VAR
: '2'},

312 [
ShufæeFÏg
(), 
RªdomS“dFÏg
(25)])

313 
	gsÜ‹d_sh¬ded_‹¡s
 = 
‹¡s1
 + 
‹¡s2
 + 
‹¡s3


314 
sÜ‹d_sh¬ded_‹¡s
.
	$sÜt
()

315 
sÜ‹d_aùive_‹¡s
 = []

316 
sÜ‹d_aùive_‹¡s
.
	$ex‹nd
(
ACTIVE_TESTS
)

317 
sÜ‹d_aùive_‹¡s
.
	$sÜt
()

318 
£lf
.
	$as£¹Equ®
(
sÜ‹d_aùive_‹¡s
, 
sÜ‹d_sh¬ded_‹¡s
)

320 
__Çme__
 == '__main__':

321 
g‹¡_‹¡_uts
.
	`Maš
()

	@trunk/objs/gtest-1.6.0/test/gtest_test_utils.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


2 #
#Cİyrighˆ2006, 
GoogË
 
Inc
.

3 #AÎ 
rights
 
»£rved
.

4 #
#Redi¡ributiÚ 
ªd
 
u£
 
š
 
sourû
‡nd 
bš¬y
 
fÜms
, 
w™h
 
Ü
 
w™hout


5 #modifiÿtiÚ, 
¬e
 
³rm™‹d
 
´ovided
 
th©
 
the
 
fŞlowšg
 
cÚd™iÚs
‡re

7 #
#* 
Redi¡ributiÚs
 
of
 
sourû
 
code
 
mu¡
 
»š
 
the
 
above
 
cİyright


8 #nÙiû, 
this
 
li¡
 
of
 
cÚd™iÚs
 
ªd
 
the
 
fŞlowšg
 
disşaim”
.

9 #* 
Redi¡ributiÚs
 
š
 
bš¬y
 
fÜm
 
mu¡
 
»´oduû
 
the
 
above


10 #cİyrighˆ
nÙiû
, 
this
 
li¡
 
of
 
cÚd™iÚs
 
ªd
 
the
 
fŞlowšg
 
disşaim”


11 #š 
the
 
docum’tiÚ
 
ªd
/
Ü
 
Ùh”
 
m©”Ÿls
 
´ovided
 
w™h
he

13 #* 
Ne™h”
 
the
 
Çme
 
of
 
GoogË
 
Inc
. 
nÜ
h
Çmes
 oà
™s


14 #cÚŒibutÜ 
may
 
be
 
u£d
 
to
 
’dÜ£
 
Ü
 
´omÙe
 
´oduùs
 
d”ived
 
äom


15 #thi 
soáw¬e
 
w™hout
 
¥ecific
 
´iÜ
 
wr™‹n
 
³rmissiÚ
.

16 #
#THIS 
SOFTWARE
 
IS
 
PROVIDED
 
BY
 
THE
 
COPYRIGHT
 
HOLDERS
 
AND
 
CONTRIBUTORS


17 #"
AS
 
IS
" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT

18 #LIMITED 
TO
, 
THE
 
IMPLIED
 
WARRANTIES
 
OF
 
MERCHANTABILITY
 
AND
 
FITNESS
 
FOR


19 #A 
PARTICULAR
 
PURPOSE
 
ARE
 
DISCLAIMED
. 
IN
 
NO
 
EVENT
 
SHALL
 
THE
 
COPYRIGHT


20 #OWNER 
OR
 
CONTRIBUTORS
 
BE
 
LIABLE
 
FOR
 
ANY
 
DIRECT
, 
INDIRECT
, 
INCIDENTAL
,

21 #SPECIAL, 
EXEMPLARY
, 
OR
 
CONSEQUENTIAL
 
DAMAGES
 (
INCLUDING
, 
BUT
 
NOT


22 #LIMITED 
TO
, 
PROCUREMENT
 
OF
 
SUBSTITUTE
 
GOODS
 
OR
 
SERVICES
; 
LOSS
 OF 
USE
,

23 #DATA, 
OR
 
PROFITS
; OR 
BUSINESS
 
INTERRUPTION
è
HOWEVER
 
CAUSED
 
AND
 
ON
 
ANY


24 #THEORY 
OF
 
LIABILITY
, 
WHETHER
 
IN
 
CONTRACT
, 
STRICT
 LIABILITY, 
OR
 
TORT


25 #(
INCLUDING
 
NEGLIGENCE
 
OR
 
OTHERWISE
è
ARISING
 
IN
 
ANY
 
WAY
 
OUT
 
OF
 
THE
 
USE


26 #OF 
THIS
 
SOFTWARE
, 
EVEN
 
IF
 
ADVISED
 
OF
 
THE
 
POSSIBILITY
 OF 
SUCH
 
DAMAGE
.

30 
	g__authÜ__
 = 'wan@google.com (Zhanyong Wan)'

32 
impÜt
 
©ex™


33 
impÜt
 
os


34 
impÜt
 
shut


35 
impÜt
 
sys


36 
impÜt
 
‹mpfe


37 
impÜt
 
un™‹¡


38 
_‹¡_moduË
 = 
un™‹¡


40 #Suµ»s£ 
the
 'ImpÜˆnÙ‡ˆthtİ oàthfe' 
lšt
 
com¶ašt
.

41 #pylšt: 
di§bË
-
msg
=
C6204


42 
Œy
:

43 
impÜt
 
sub´oûss


44 
_SUBPROCESS_MODULE_AVAILABLE
 = 
True


45 
exû±
:

46 
impÜt
 
pİ’2


47 
_SUBPROCESS_MODULE_AVAILABLE
 = 
F®£


48 #pylšt: 
’abË
-
msg
=
C6204


50 
GTEST_OUTPUT_VAR_NAME
 = 'GTEST_OUTPUT'

52 
IS_WINDOWS
 = 
os
.
Çme
 == 'nt'

53 
IS_CYGWIN
 = 
os
.
Çme
 =ğ'posix' 
ªd
 'CYGWIN' 
š
 os.
uÇme
()[0]

55 #H”
we
 
expo£
 
a
 
şass
 
äom
‡ 
·¹icuÏr
 
moduË
, 
d•’dšg
 
Ú
 
the


56 #’vœÚm’t. 
The
 
comm’t
 
suµ»s£s
 
the
 'Inv®id v¬ŸbË‚ame' 
lšt


58 
	gTe¡Ca£
 = 
_‹¡_moduË
.
Te¡Ca£
 #pylšt: 
di§bË
-
msg
=
C6409


60 #In™ŸÎy 
m­s
 
a
 
æag
 
to
 
™s
  
v®ue
. 
Aá”


61 #_P¬£AndSŒGTe¡FÏgs(è
is
 
ÿÎed
, 
m­s
 
a
 
æag
 
to
 
™s
 
aùu®
 
v®ue
.

62 
	g_æag_m­
 = {'sourû_dœ': 
os
.
·th
.
dœÇme
(
sys
.
¬gv
[0]),

63 'bud_dœ': 
os
.
·th
.
dœÇme
(
sys
.
¬gv
[0])}

64 
_g‹¡_æags_¬e_·r£d
 = 
F®£


67 
def
 
	$_P¬£AndSŒGTe¡FÏgs
(
¬gv
):

70 #Suµ»s£ 
the
 
lšt
 
com¶ašt
 
about
 
a
 
glob®
 
v¬ŸbË
 
sšû
 
we
 
Ãed
 
™


71 #h”
to
 
mašš
 
moduË
-
wide
 
¡©e
.

72 
glob®
 
_g‹¡_æags_¬e_·r£d
 #pylšt: 
di§bË
-
msg
=
W0603


73 
_g‹¡_æags_¬e_·r£d
:

76 
_g‹¡_æags_¬e_·r£d
 = 
True


77 
æag
 
š
 
_æag_m­
:

78 #Th
’vœÚm’t
 
v¬ŸbË
 
ov”rides
 
the
  
v®ue
.

79 
æag
.
	$uµ”
(è
š
 
os
.
’vœÚ
:

80 
_æag_m­
[
æag
] = 
os
.
’vœÚ
[æag.
	`uµ”
()]

82 #Th
commªd
 
lše
 
æag
 
ov”rides
 
the
 
’vœÚm’t
 
v¬ŸbË
.

83 
i
 = 1 #Sk 
the
 
´og¿m
 
Çme
.

84 
i
 < 
	$Ën
(
¬gv
):

85 
´efix
 = '--' + 
æag
 + '='

86 
¬gv
[
i
].
	$¡¬tsw™h
(
´efix
):

87 
_æag_m­
[
æag
] = 
¬gv
[
i
][
	$Ën
(
´efix
):]

88 
d–
 
¬gv
[
i
]

91 #W
dÚ
't increment i in case we just found‡ --gtest_* flag

92 #ªd 
»moved
 
™
 
äom
 
¬gv
.

93 
i
 += 1

96 
def
 
	$G‘FÏg
(
æag
):

99 #IÀ
	`G‘FÏg
(è
is
 
ÿÎed
 
befÜe
 
	`Maš
(), 
we
 
®ways
 
ÿÎ


100 #_P¬£AndSŒGTe¡FÏgs(è
h”e
 
to
 
make
 
su»
 
the
 --
g‹¡_
* 
æags


101 #¬
·r£d
.

102 
	$_P¬£AndSŒGTe¡FÏgs
(
sys
.
¬gv
)

104  
_æag_m­
[
æag
]

107 
def
 
	$G‘SourûDœ
():

110  
os
.
·th
.
	`ab¥©h
(
	`G‘FÏg
('source_dir'))

113 
def
 
	$G‘BudDœ
():

116  
os
.
·th
.
	`ab¥©h
(
	`G‘FÏg
('build_dir'))

119 
_‹mp_dœ
 = 
NÚe


121 
def
 
	$_RemoveTempDœ
():

122 
_‹mp_dœ
:

123 
shut
.
	$rmŒ“
(
_‹mp_dœ
, 
ignÜe_”rÜs
=
True
)

125 
©ex™
.(
_RemoveTempDœ
)

128 
def
 
	$G‘TempDœ
():

131 
glob®
 
_‹mp_dœ


132 
nÙ
 
_‹mp_dœ
:

133 
_‹mp_dœ
 = 
‹mpfe
.
	$mkd‹mp
()

134  
_‹mp_dœ


137 
def
 
	$G‘Te¡ExecubËP©h
(
execubË_Çme
, 
bud_dœ
=
NÚe
):

140 
The
 
funùiÚ
 
wl
 
´št
 
a
 
mes§ge
 
ªd
 
abÜt
 
the
 
´og¿m
 th
»suÉšg
 
fe


141 
dÛ¢
'tƒxist.

143 
Args
:

144 
execubË_Çme
: 
Çme
 
of
 
the
 
‹¡
 
bš¬y
 
th©
h‹¡ 
süt
 
runs
.

145 
bud_dœ
: 
dœeùÜy
 
wh”e
 
to
 
look
 
execubËs
, 
by
 

146 
the
 
»suÉ
 
of
 
	`G‘BudDœ
().

148 
R‘uºs
:

149 
The
 
absŞu‹
 
·th
 
of
 
the
 
‹¡
 
bš¬y
.

152 
·th
 = 
os
.·th.
	`ab¥©h
(os.·th.
	`još
(
bud_dœ
 
Ü
 
	`G‘BudDœ
(),

153 
execubË_Çme
))

154 ià(
IS_WINDOWS
 
Ü
 
IS_CYGWIN
è
ªd
 
nÙ
 
·th
.
	`’dsw™h
('.exe'):

155 
·th
 += '.exe'

157 
nÙ
 
os
.
·th
.
	$exi¡s
(
·th
):

158 
mes§ge
 = (

162 
´št
 >> 
sys
.
¡d”r
, 
mes§ge


163 
sys
.
	$ex™
(1)

165  
·th


168 
def
 
	$G‘Ex™Stus
(
ex™_code
):

171 
Args
:

172 
ex™_code
: 
the
 
»suÉ
 
v®ue
 
of
 
os
.
	`sy¡em
(
commªd
).

175 
os
.
Çme
 == 'nt':

176 #OÀ
Wšdows
, 
os
.
	`WEXITSTATUS
(è
dÛ¢
't work‡nd os.system()„eturns

177 #th
¬gum’t
 
to
 
	`ex™
(è
dœeùly
.

178  
ex™_code


180 #OÀ
Unix
, 
os
.
	`WEXITSTATUS
(è
mu¡
 
be
 
u£d
 
to
 
exŒaù
 
the
 
ex™
 
¡©us


181 #äom 
the
 
»suÉ
 
of
 
os
.
	`sy¡em
().

182 
os
.
	$WIFEXITED
(
ex™_code
):

183  
os
.
	$WEXITSTATUS
(
ex™_code
)

188 
şass
 
Sub´oûss
:

189 
def
 
	$__š™__
(
£lf
, 
commªd
, 
wÜkšg_dœ
=
NÚe
, 
ÿ±u»_¡d”r
=
True
, 
’v
=None):

192 
Re¡Ües
 
the
 
Şd
 
dœeùÜy
 
aá”w¬ds
.

194 
Args
:

195 
commªd
: 
The
 commªd 
to
 
run
, 
š
 
the
 
fÜm
 
of
 
sys
.
¬gv
.

196 
wÜkšg_dœ
: 
The
 
dœeùÜy
 
to
 
chªge
 
što
.

197 
ÿ±u»_¡d”r
: 
D‘”mšes
 
wh‘h”
 
to
 
ÿ±u»
 
¡d”r
 
š
 
the
 
ouut
 
memb”


198 
Ü
 
to
 
disÿrd
 
™
.

199 
’v
: 
DiùiÚ¬y
 
w™h
 
’vœÚm’t
 
to
 
·ss
Ø
the
 
sub´oûss
.

201 
R‘uºs
:

202 
An
 
objeù
 
th©
 
»´e£Ás
 
outcome
 
of
 
the
 
execu‹d
 
´oûss
. 
It
 
has
he

203 
fŞlowšg
 
©Œibu‹s
:

204 
‹rmš©ed_by_sigÇl
 
True
 
iff
 
the
 
chd
 
´oûss
 
has
 
b“n
 
‹rmš©ed


205 
by
 
a
 
sigÇl
.

206 
sigÇl
 
SygÇl
 
th©
 
‹rmš©ed
 
the
 
chd
 
´oûss
.

207 
ex™ed
 
True
 
iff
 
the
 
chd
 
´oûss
ƒx™ed 
nÜm®ly
.

208 
ex™_code
 
The
 
code
 
w™h
 
which
 
the
 
chd
 
´oûss
 
ex™ed
.

209 
ouut
 
Chd
 
´oûss
's stdout‡nd stderr output

210 
combšed
 
š
 
a
 
¡ršg
.

213 #Th
sub´oûss
 
moduË
 
is
 
the
 
´eã¼abË
 
way
 
of
 
ruÂšg
 
´og¿ms


214 #sšû 
™
 
is
 
avaabË
 
ªd
 
behaves
 
cÚsi¡’y
 
Ú
 
®l
 
¶©fÜms
,

215 #šşudšg 
Wšdows
. 
But
 
™
 
is
 
Úly
 
avaabË
 
¡¬tšg
 
š
 
pythÚ
 2.4.

216 #IÀ
—¾›r
 
pythÚ
 
v”siÚs
, 
we
 
»v”t
 
to
 
the
 
pİ’2
 
moduË
, 
which
 
is


217 #avaabË 
š
 
pythÚ
 2.0 
ªd
 
Ï‹r
 
but
 
dÛ¢
't…rovide„equired

218 #funùiÚ®™y (
Pİ’4
è
und”
 
Wšdows
. 
This
 
®lows
 
us
 
to
 
suµÜt
 
Mac


219 #OS 
X
 10.4 
Tig”
, 
which
 
has
 
pythÚ
 2.3 
š¡®Ëd
.

220 
_SUBPROCESS_MODULE_AVAILABLE
:

221 
ÿ±u»_¡d”r
:

222 
¡d”r
 = 
sub´oûss
.
STDOUT


224 
¡d”r
 = 
sub´oûss
.
PIPE


226 
p
 = 
sub´oûss
.
	$Pİ’
(
commªd
,

227 
¡dout
=
sub´oûss
.
PIPE
, 
¡d”r
=stderr,

228 
cwd
=
wÜkšg_dœ
, 
univ”§l_Ãwlšes
=
True
, 
’v
=env)

229 #communiÿ‹ 
»tuºs
 
a
 
tu¶e
 
w™h
 
the
 
fe
 
obeù
 th
chd
's

231 
£lf
.
ouut
 = 
p
.
	`communiÿ‹
()[0]

232 
£lf
.
_»tuº_code
 = 
p
.
»tuºcode


234 
Şd_dœ
 = 
os
.
	$g‘cwd
()

236 
def
 
	$_R•ÏûEnvDiù
(
de¡
, 
¤c
):

237 #Chªge 
made
 
by
 
os
.
’vœÚ
.
ş—r
 
¬e
 
nÙ
 
šh”™abË
 by 
chd


238 #´oûs£ 
uÁ
 
PythÚ
 2.6. 
To
 
´oduû
 
šh”™abË
 
chªges
 
we
 
have


239 #tØ
d–‘e
 
’vœÚm’t
 
™ems
 
w™h
 
the
 
d–
 
¡©em’t
.

240 
key
 
š
 
de¡
:

241 
d–
 
de¡
[
key
]

242 
de¡
.
	$upd©e
(
¤c
)

244 #Wh’ '’v' 
is
 
nÙ
 
NÚe
, 
backup
 
the
 
’vœÚm’t
 
v¬ŸbËs
 
ªd
 
»¶aû


245 #them 
w™h
 
the
 
·s£d
 '’v'. 
Wh’
 '’v' 
is
 
NÚe
, 
we
 
sim¶y
 
u£
he

246 #cu¼’ˆ'os.’vœÚ' 
com·tib™y
 
w™h
 
the
 
sub´oûss
.
Pİ’


247 #£mªtic 
u£d
 
above
.

248 
’v
 
is
 
nÙ
 
NÚe
:

249 
Şd_’vœÚ
 = 
os
.
’vœÚ
.
	$cİy
()

250 
	$_R•ÏûEnvDiù
(
os
.
’vœÚ
, 
’v
)

252 
Œy
:

253 
wÜkšg_dœ
 
is
 
nÙ
 
NÚe
:

254 
os
.
	$chdœ
(
wÜkšg_dœ
)

255 
ÿ±u»_¡d”r
:

256 
p
 = 
pİ’2
.
	$Pİ’4
(
commªd
)

258 
p
 = 
pİ’2
.
	$Pİ’3
(
commªd
)

259 
p
.
tochd
.
	$şo£
()

260 
£lf
.
ouut
 = 
p
.
äomchd
.
	$»ad
()

261 
»t_code
 = 
p
.
	$wa™
()

262 
fš®ly
:

263 
os
.
	$chdœ
(
Şd_dœ
)

265 #Re¡Ü
the
 
Şd
 
’vœÚm’t
 
v¬ŸbËs


266 #ià
they
 
w”e
 
»¶aûd
.

267 
’v
 
is
 
nÙ
 
NÚe
:

268 
	$_R•ÏûEnvDiù
(
os
.
’vœÚ
, 
Şd_’vœÚ
)

270 #CÚv”t 
»t_code
 
to
 
m©ch
 
the
 
£mªtics
 
of


271 #sub´oûss.
Pİ’
.
»tuºcode
.

272 
os
.
	$WIFSIGNALED
(
»t_code
):

273 
£lf
.
_»tuº_code
 = -
os
.
	$WTERMSIG
(
»t_code
)

274 : #os.
	$WIFEXITED
(
»t_code
è
should
  
True
 
h”e
.

275 
£lf
.
_»tuº_code
 = 
os
.
	$WEXITSTATUS
(
»t_code
)

277 
£lf
.
_»tuº_code
 < 0:

278 
£lf
.
‹rmš©ed_by_sigÇl
 = 
True


279 
£lf
.
ex™ed
 = 
F®£


280 
£lf
.
sigÇl
 = -£lf.
_»tuº_code


282 
£lf
.
‹rmš©ed_by_sigÇl
 = 
F®£


283 
£lf
.
ex™ed
 = 
True


284 
£lf
.
ex™_code
 = s–f.
_»tuº_code


287 
def
 
	$Maš
():

290 #W
mu¡
 
ÿÎ
 
	`_P¬£AndSŒGTe¡FÏgs
(è
befÜe
 
ÿÎšg


291 #un™‹¡.
	`maš
(). 
Oth”wi£
 
the
 
Ï‰”
 
wl
 
be
 
cÚfu£d
 
by
he

292 #--
g‹¡_
* 
æags
.

293 
	$_P¬£AndSŒGTe¡FÏgs
(
sys
.
¬gv
)

294 #Th
‹¡ed
 
bš¬›s
 
should
 
nÙ
 
be
 
wr™šg
 
XML
 
ouut
 
fes
 
uÆess
 
the


295 #süˆ
ex¶ic™ly
 
š¡ruùs
 
them
 
to
.

296 #TODO(
vÏdl
@
googË
.
com
): 
Move
 
this
 
što
 
Sub´oûss
 
wh’
 
we
 
im¶em’t


297 #·ssšg 
’vœÚm’t
 
što
 
™
 
as
 
a
 
·¿m‘”
.

298 
GTEST_OUTPUT_VAR_NAME
 
š
 
os
.
’vœÚ
:

299 
d–
 
os
.
’vœÚ
[
GTEST_OUTPUT_VAR_NAME
]

301 
_‹¡_moduË
.
	`maš
()

	@trunk/objs/gtest-1.6.0/test/gtest_throw_on_failure_test.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


2 #
#Cİyrighˆ2009, 
GoogË
 
Inc
.

3 #AÎ 
rights
 
»£rved
.

4 #
#Redi¡ributiÚ 
ªd
 
u£
 
š
 
sourû
‡nd 
bš¬y
 
fÜms
, 
w™h
 
Ü
 
w™hout


5 #modifiÿtiÚ, 
¬e
 
³rm™‹d
 
´ovided
 
th©
 
the
 
fŞlowšg
 
cÚd™iÚs
‡re

7 #
#* 
Redi¡ributiÚs
 
of
 
sourû
 
code
 
mu¡
 
»š
 
the
 
above
 
cİyright


8 #nÙiû, 
this
 
li¡
 
of
 
cÚd™iÚs
 
ªd
 
the
 
fŞlowšg
 
disşaim”
.

9 #* 
Redi¡ributiÚs
 
š
 
bš¬y
 
fÜm
 
mu¡
 
»´oduû
 
the
 
above


10 #cİyrighˆ
nÙiû
, 
this
 
li¡
 
of
 
cÚd™iÚs
 
ªd
 
the
 
fŞlowšg
 
disşaim”


11 #š 
the
 
docum’tiÚ
 
ªd
/
Ü
 
Ùh”
 
m©”Ÿls
 
´ovided
 
w™h
he

13 #* 
Ne™h”
 
the
 
Çme
 
of
 
GoogË
 
Inc
. 
nÜ
h
Çmes
 oà
™s


14 #cÚŒibutÜ 
may
 
be
 
u£d
 
to
 
’dÜ£
 
Ü
 
´omÙe
 
´oduùs
 
d”ived
 
äom


15 #thi 
soáw¬e
 
w™hout
 
¥ecific
 
´iÜ
 
wr™‹n
 
³rmissiÚ
.

16 #
#THIS 
SOFTWARE
 
IS
 
PROVIDED
 
BY
 
THE
 
COPYRIGHT
 
HOLDERS
 
AND
 
CONTRIBUTORS


17 #"
AS
 
IS
" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT

18 #LIMITED 
TO
, 
THE
 
IMPLIED
 
WARRANTIES
 
OF
 
MERCHANTABILITY
 
AND
 
FITNESS
 
FOR


19 #A 
PARTICULAR
 
PURPOSE
 
ARE
 
DISCLAIMED
. 
IN
 
NO
 
EVENT
 
SHALL
 
THE
 
COPYRIGHT


20 #OWNER 
OR
 
CONTRIBUTORS
 
BE
 
LIABLE
 
FOR
 
ANY
 
DIRECT
, 
INDIRECT
, 
INCIDENTAL
,

21 #SPECIAL, 
EXEMPLARY
, 
OR
 
CONSEQUENTIAL
 
DAMAGES
 (
INCLUDING
, 
BUT
 
NOT


22 #LIMITED 
TO
, 
PROCUREMENT
 
OF
 
SUBSTITUTE
 
GOODS
 
OR
 
SERVICES
; 
LOSS
 OF 
USE
,

23 #DATA, 
OR
 
PROFITS
; OR 
BUSINESS
 
INTERRUPTION
è
HOWEVER
 
CAUSED
 
AND
 
ON
 
ANY


24 #THEORY 
OF
 
LIABILITY
, 
WHETHER
 
IN
 
CONTRACT
, 
STRICT
 LIABILITY, 
OR
 
TORT


25 #(
INCLUDING
 
NEGLIGENCE
 
OR
 
OTHERWISE
è
ARISING
 
IN
 
ANY
 
WAY
 
OUT
 
OF
 
THE
 
USE


26 #OF 
THIS
 
SOFTWARE
, 
EVEN
 
IF
 
ADVISED
 
OF
 
THE
 
POSSIBILITY
 OF 
SUCH
 
DAMAGE
.

30 
This
 
süt
 
švokes
 
	$g‹¡_throw_Ú_çu»_‹¡_
 (
a
 
´og¿m
 
wr™‹n
 
w™h


31 
GoogË
 
Te¡
è
w™h
 
difã»Á
 
’vœÚm’ts
 
ªd
 
commªd
 
lše
 
æags
.

34 
__authÜ__
 = 'wan@google.com (Zhanyong Wan)'

36 
impÜt
 
os


37 
impÜt
 
g‹¡_‹¡_uts


42 #Th
commªd
 
lše
 
æag
 
’ablšg
/
di§blšg
 
the
 
throw
-
Ú
-
çu»
 
mode
.

43 
THROW_ON_FAILURE
 = 'gtest_throw_on_failure'

45 #P©h 
to
 
the
 
g‹¡_throw_Ú_çu»_‹¡_
 
´og¿m
, 
comped
 
w™h


46 #exû±iÚ 
di§bËd
.

47 
EXE_PATH
 = 
g‹¡_‹¡_uts
.
	`G‘Te¡ExecubËP©h
(

54 
def
 
	$S‘EnvV¬
(
’v_v¬
, 
v®ue
):

56 
giv’
 
v®ue
 
is
 
NÚe
.

59 
’v_v¬
 =ƒnv_v¬.
	$uµ”
()

60 
v®ue
 
is
 
nÙ
 
NÚe
:

61 
os
.
’vœÚ
[
’v_v¬
] = 
v®ue


62 
–if
 
’v_v¬
 
š
 
os
.
’vœÚ
:

63 
d–
 
os
.
’vœÚ
[
’v_v¬
]

66 
def
 
	$Run
(
commªd
):

69 
´št
 'RuÂšg "%s". . .' % ' '.
	$još
(
commªd
)

70 
p
 = 
g‹¡_‹¡_uts
.
	$Sub´oûss
(
commªd
)

71  
p
.
ex™ed
 
ªd
….
ex™_code
 == 0

74 #Th
‹¡s
. 
	`TODO
(
wª
@
googË
.
com
): 
»çùÜ
 
the
 
şass
 
to
 
sh¬e
 
commÚ


75 #logiø
w™h
 
code
 
š
 
g‹¡_b»ak_Ú_çu»_un™‹¡
.
py
.

76 
şass
 
	$ThrowOnFau»Te¡
(
g‹¡_‹¡_uts
.
Te¡Ca£
):

79 
def
 
	$RunAndV”ify
(
£lf
, 
’v_v¬_v®ue
, 
æag_v®ue
, 
should_ç
):

81 (
Ü
 
dÛs
 
nÙ
è
ex™
 
w™h
 
a
 
nÚ
-
z”o
 
code
.

83 
Args
:

84 
’v_v¬_v®ue
: 
v®ue
 
of
 
the
 
GTEST_BREAK_ON_FAILURE
 
’vœÚm’t


85 
v¬ŸbË
; 
NÚe
 
the
 v¬ŸbË 
should
 
be
 
un£t
.

86 
æag_v®ue
: 
v®ue
 
of
 
the
 --
g‹¡_b»ak_Ú_çu»
 
æag
;

87 
NÚe
 
the
 
æag
 
should
 
nÙ
 
be
 
´e£Á
.

88 
should_ç
: 
True
 
iff
 
the
 
´og¿m
 
is
 
ex³ùed
 
to
 
ç
.

91 
	$S‘EnvV¬
(
THROW_ON_FAILURE
, 
’v_v¬_v®ue
)

93 
’v_v¬_v®ue
 
is
 
NÚe
:

94 
’v_v¬_v®ue_msg
 = ' is‚ot set'

96 
’v_v¬_v®ue_msg
 = '=' + 
’v_v¬_v®ue


98 
æag_v®ue
 
is
 
NÚe
:

99 
æag
 = ''

100 
–if
 
æag_v®ue
 == '0':

101 
æag
 = '--%s=0' % 
THROW_ON_FAILURE


103 
æag
 = '--%s' % 
THROW_ON_FAILURE


105 
commªd
 = [
EXE_PATH
]

106 
æag
:

107 
commªd
.
	$­³nd
(
æag
)

109 
should_ç
:

110 
should_Ü_nÙ
 = 'should'

112 
should_Ü_nÙ
 = 'should‚ot'

114 
çed
 = 
nÙ
 
	$Run
(
commªd
)

116 
	$S‘EnvV¬
(
THROW_ON_FAILURE
, 
NÚe
)

118 
msg
 = ('when %s%s,‡n‡ssertion failure in "%s" %s cause‡‚on-zero '

120 (
THROW_ON_FAILURE
, 
’v_v¬_v®ue_msg
, ' '.
	`još
(
commªd
),

121 
should_Ü_nÙ
))

122 
£lf
.
	$as£¹_
(
çed
 =ğ
should_ç
, 
msg
)

124 
def
 
	$‹¡DeçuÉBehaviÜ
(
£lf
):

127 
£lf
.
	$RunAndV”ify
(
’v_v¬_v®ue
=
NÚe
, 
æag_v®ue
=NÚe, 
should_ç
=
F®£
)

129 
def
 
	$‹¡ThrowOnFau»EnvV¬
(
£lf
):

132 
£lf
.
	`RunAndV”ify
(
’v_v¬_v®ue
='0',

133 
æag_v®ue
=
NÚe
,

134 
should_ç
=
F®£
)

135 
£lf
.
	`RunAndV”ify
(
’v_v¬_v®ue
='1',

136 
æag_v®ue
=
NÚe
,

137 
should_ç
=
True
)

139 
def
 
	$‹¡ThrowOnFau»FÏg
(
£lf
):

142 
£lf
.
	`RunAndV”ify
(
’v_v¬_v®ue
=
NÚe
,

143 
æag_v®ue
='0',

144 
should_ç
=
F®£
)

145 
£lf
.
	`RunAndV”ify
(
’v_v¬_v®ue
=
NÚe
,

146 
æag_v®ue
='1',

147 
should_ç
=
True
)

149 
def
 
	$‹¡ThrowOnFau»FÏgOv”ridesEnvV¬
(
£lf
):

152 
£lf
.
	`RunAndV”ify
(
’v_v¬_v®ue
='0',

153 
æag_v®ue
='0',

154 
should_ç
=
F®£
)

155 
£lf
.
	`RunAndV”ify
(
’v_v¬_v®ue
='0',

156 
æag_v®ue
='1',

157 
should_ç
=
True
)

158 
£lf
.
	`RunAndV”ify
(
’v_v¬_v®ue
='1',

159 
æag_v®ue
='0',

160 
should_ç
=
F®£
)

161 
£lf
.
	`RunAndV”ify
(
’v_v¬_v®ue
='1',

162 
æag_v®ue
='1',

163 
should_ç
=
True
)

166 
__Çme__
 == '__main__':

167 
g‹¡_‹¡_uts
.
	`Maš
()

	@trunk/objs/gtest-1.6.0/test/gtest_uninitialized_test.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


2 #
#Cİyrighˆ2008, 
GoogË
 
Inc
.

3 #AÎ 
rights
 
»£rved
.

4 #
#Redi¡ributiÚ 
ªd
 
u£
 
š
 
sourû
‡nd 
bš¬y
 
fÜms
, 
w™h
 
Ü
 
w™hout


5 #modifiÿtiÚ, 
¬e
 
³rm™‹d
 
´ovided
 
th©
 
the
 
fŞlowšg
 
cÚd™iÚs
‡re

7 #
#* 
Redi¡ributiÚs
 
of
 
sourû
 
code
 
mu¡
 
»š
 
the
 
above
 
cİyright


8 #nÙiû, 
this
 
li¡
 
of
 
cÚd™iÚs
 
ªd
 
the
 
fŞlowšg
 
disşaim”
.

9 #* 
Redi¡ributiÚs
 
š
 
bš¬y
 
fÜm
 
mu¡
 
»´oduû
 
the
 
above


10 #cİyrighˆ
nÙiû
, 
this
 
li¡
 
of
 
cÚd™iÚs
 
ªd
 
the
 
fŞlowšg
 
disşaim”


11 #š 
the
 
docum’tiÚ
 
ªd
/
Ü
 
Ùh”
 
m©”Ÿls
 
´ovided
 
w™h
he

13 #* 
Ne™h”
 
the
 
Çme
 
of
 
GoogË
 
Inc
. 
nÜ
h
Çmes
 oà
™s


14 #cÚŒibutÜ 
may
 
be
 
u£d
 
to
 
’dÜ£
 
Ü
 
´omÙe
 
´oduùs
 
d”ived
 
äom


15 #thi 
soáw¬e
 
w™hout
 
¥ecific
 
´iÜ
 
wr™‹n
 
³rmissiÚ
.

16 #
#THIS 
SOFTWARE
 
IS
 
PROVIDED
 
BY
 
THE
 
COPYRIGHT
 
HOLDERS
 
AND
 
CONTRIBUTORS


17 #"
AS
 
IS
" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT

18 #LIMITED 
TO
, 
THE
 
IMPLIED
 
WARRANTIES
 
OF
 
MERCHANTABILITY
 
AND
 
FITNESS
 
FOR


19 #A 
PARTICULAR
 
PURPOSE
 
ARE
 
DISCLAIMED
. 
IN
 
NO
 
EVENT
 
SHALL
 
THE
 
COPYRIGHT


20 #OWNER 
OR
 
CONTRIBUTORS
 
BE
 
LIABLE
 
FOR
 
ANY
 
DIRECT
, 
INDIRECT
, 
INCIDENTAL
,

21 #SPECIAL, 
EXEMPLARY
, 
OR
 
CONSEQUENTIAL
 
DAMAGES
 (
INCLUDING
, 
BUT
 
NOT


22 #LIMITED 
TO
, 
PROCUREMENT
 
OF
 
SUBSTITUTE
 
GOODS
 
OR
 
SERVICES
; 
LOSS
 OF 
USE
,

23 #DATA, 
OR
 
PROFITS
; OR 
BUSINESS
 
INTERRUPTION
è
HOWEVER
 
CAUSED
 
AND
 
ON
 
ANY


24 #THEORY 
OF
 
LIABILITY
, 
WHETHER
 
IN
 
CONTRACT
, 
STRICT
 LIABILITY, 
OR
 
TORT


25 #(
INCLUDING
 
NEGLIGENCE
 
OR
 
OTHERWISE
è
ARISING
 
IN
 
ANY
 
WAY
 
OUT
 
OF
 
THE
 
USE


26 #OF 
THIS
 
SOFTWARE
, 
EVEN
 
IF
 
ADVISED
 
OF
 
THE
 
POSSIBILITY
 OF 
SUCH
 
DAMAGE
.

30 
	g__authÜ__
 = 'wan@google.com (Zhanyong Wan)'

32 
impÜt
 
g‹¡_‹¡_uts


35 
COMMAND
 = 
g‹¡_‹¡_uts
.
G‘Te¡ExecubËP©h
('gtest_uninitialized_test_')

38 
def
 
	$As£¹
(
cÚd™iÚ
):

39 
nÙ
 
cÚd™iÚ
:

40 
¿i£
 
As£¹iÚE¼Ü


43 
def
 
	$As£¹Eq
(
ex³ùed
, 
aùu®
):

44 
ex³ùed
 !ğ
aùu®
:

45 
´št
 'Ex³ùed: %s' % (
ex³ùed
,)

46 
´št
 ' Aùu®: %s' % (
aùu®
,)

47 
¿i£
 
As£¹iÚE¼Ü


50 
def
 
	$Te¡Ex™CodeAndOuut
(
commªd
):

53 #V”if› 
th©
 'commªd' 
ex™s
 
w™h
 
code
 1.

54 
p
 = 
g‹¡_‹¡_uts
.
	$Sub´oûss
(
commªd
)

55 
	$As£¹
(
p
.
ex™ed
)

56 
	$As£¹Eq
(1, 
p
.
ex™_code
)

57 
	`As£¹
('In™GoogËTe¡' 
š
 
p
.
ouut
)

60 
şass
 
	$GTe¡Unš™ŸlizedTe¡
(
g‹¡_‹¡_uts
.
Te¡Ca£
):

61 
def
 
	$‹¡Ex™CodeAndOuut
(
£lf
):

62 
	$Te¡Ex™CodeAndOuut
(
COMMAND
)

65 
__Çme__
 == '__main__':

66 
g‹¡_‹¡_uts
.
	`Maš
()

	@trunk/objs/gtest-1.6.0/test/gtest_xml_outfiles_test.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


2 #
#Cİyrighˆ2008, 
GoogË
 
Inc
.

3 #AÎ 
rights
 
»£rved
.

4 #
#Redi¡ributiÚ 
ªd
 
u£
 
š
 
sourû
‡nd 
bš¬y
 
fÜms
, 
w™h
 
Ü
 
w™hout


5 #modifiÿtiÚ, 
¬e
 
³rm™‹d
 
´ovided
 
th©
 
the
 
fŞlowšg
 
cÚd™iÚs
‡re

7 #
#* 
Redi¡ributiÚs
 
of
 
sourû
 
code
 
mu¡
 
»š
 
the
 
above
 
cİyright


8 #nÙiû, 
this
 
li¡
 
of
 
cÚd™iÚs
 
ªd
 
the
 
fŞlowšg
 
disşaim”
.

9 #* 
Redi¡ributiÚs
 
š
 
bš¬y
 
fÜm
 
mu¡
 
»´oduû
 
the
 
above


10 #cİyrighˆ
nÙiû
, 
this
 
li¡
 
of
 
cÚd™iÚs
 
ªd
 
the
 
fŞlowšg
 
disşaim”


11 #š 
the
 
docum’tiÚ
 
ªd
/
Ü
 
Ùh”
 
m©”Ÿls
 
´ovided
 
w™h
he

13 #* 
Ne™h”
 
the
 
Çme
 
of
 
GoogË
 
Inc
. 
nÜ
h
Çmes
 oà
™s


14 #cÚŒibutÜ 
may
 
be
 
u£d
 
to
 
’dÜ£
 
Ü
 
´omÙe
 
´oduùs
 
d”ived
 
äom


15 #thi 
soáw¬e
 
w™hout
 
¥ecific
 
´iÜ
 
wr™‹n
 
³rmissiÚ
.

16 #
#THIS 
SOFTWARE
 
IS
 
PROVIDED
 
BY
 
THE
 
COPYRIGHT
 
HOLDERS
 
AND
 
CONTRIBUTORS


17 #"
AS
 
IS
" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT

18 #LIMITED 
TO
, 
THE
 
IMPLIED
 
WARRANTIES
 
OF
 
MERCHANTABILITY
 
AND
 
FITNESS
 
FOR


19 #A 
PARTICULAR
 
PURPOSE
 
ARE
 
DISCLAIMED
. 
IN
 
NO
 
EVENT
 
SHALL
 
THE
 
COPYRIGHT


20 #OWNER 
OR
 
CONTRIBUTORS
 
BE
 
LIABLE
 
FOR
 
ANY
 
DIRECT
, 
INDIRECT
, 
INCIDENTAL
,

21 #SPECIAL, 
EXEMPLARY
, 
OR
 
CONSEQUENTIAL
 
DAMAGES
 (
INCLUDING
, 
BUT
 
NOT


22 #LIMITED 
TO
, 
PROCUREMENT
 
OF
 
SUBSTITUTE
 
GOODS
 
OR
 
SERVICES
; 
LOSS
 OF 
USE
,

23 #DATA, 
OR
 
PROFITS
; OR 
BUSINESS
 
INTERRUPTION
è
HOWEVER
 
CAUSED
 
AND
 
ON
 
ANY


24 #THEORY 
OF
 
LIABILITY
, 
WHETHER
 
IN
 
CONTRACT
, 
STRICT
 LIABILITY, 
OR
 
TORT


25 #(
INCLUDING
 
NEGLIGENCE
 
OR
 
OTHERWISE
è
ARISING
 
IN
 
ANY
 
WAY
 
OUT
 
OF
 
THE
 
USE


26 #OF 
THIS
 
SOFTWARE
, 
EVEN
 
IF
 
ADVISED
 
OF
 
THE
 
POSSIBILITY
 OF 
SUCH
 
DAMAGE
.

30 
	g__authÜ__
 = "keith.ray@gmail.com (Keith Ray)"

32 
impÜt
 
os


33 
äom
 
xml
.
dom
 
impÜt
 
mšidom
, 
Node


35 
impÜt
 
g‹¡_‹¡_uts


36 
impÜt
 
g‹¡_xml_‹¡_uts


39 
	gGTEST_OUTPUT_SUBDIR
 = "xml_outfiles"

40 
GTEST_OUTPUT_1_TEST
 = "gtest_xml_outfile1_test_"

41 
GTEST_OUTPUT_2_TEST
 = "gtest_xml_outfile2_test_"

43 
EXPECTED_XML_1
 = """<?xmÈv”siÚ="1.0"ƒncodšg="
UTF
-8"?>

44 <
‹¡su™es
 
‹¡s
="1" 
çu»s
="0" 
di§bËd
="0" 
”rÜs
="0" 
time
="*" 
Çme
="AllTests">

45 <
‹¡su™e
 
Çme
="Prİ”tyOÃ" 
‹¡s
="1" 
çu»s
="0" 
di§bËd
="0" 
”rÜs
="0" 
time
="*">

46 <
‹¡ÿ£
 
Çme
="Te¡SomePrİ”t›s" 
¡©us
="run" 
time
="*" 
şas¢ame
="Prİ”tyOÃ" 
S‘UpPrİ
="1" 
Te¡SomePrİ”ty
="1" 
T—rDownPrİ
="1" />

47 </
‹¡su™e
>

48 </
‹¡su™es
>

51 
EXPECTED_XML_2
 = """<?xmÈv”siÚ="1.0"ƒncodšg="
UTF
-8"?>

52 <
‹¡su™es
 
‹¡s
="1" 
çu»s
="0" 
di§bËd
="0" 
”rÜs
="0" 
time
="*" 
Çme
="AllTests">

53 <
‹¡su™e
 
Çme
="Prİ”tyTwo" 
‹¡s
="1" 
çu»s
="0" 
di§bËd
="0" 
”rÜs
="0" 
time
="*">

54 <
‹¡ÿ£
 
Çme
="Te¡SomePrİ”t›s" 
¡©us
="run" 
time
="*" 
şas¢ame
="Prİ”tyTwo" 
S‘UpPrİ
="2" 
Te¡SomePrİ”ty
="2" 
T—rDownPrİ
="2" />

55 </
‹¡su™e
>

56 </
‹¡su™es
>

60 
şass
 
	$GTe¡XMLOutFesTe¡
(
g‹¡_xml_‹¡_uts
.
GTe¡XMLTe¡Ca£
):

63 
def
 
	$£tUp
(
£lf
):

64 #W
wªt
 
the
 
Œašg
 '/' 
th©
h
Ï¡
 "" 
´ovides
 
š
 
os
.
·th
.
još
, 

65 #‹Îšg 
GoogË
 
Te¡
 
to
 
ü—‹
 
ª
 
ouut
 
dœeùÜy
 
š¡—d
 
of
 
a
 
sšgË
 
fe


66 #fÜ 
xml
 
ouut
.

67 
£lf
.
ouut_dœ_
 = 
os
.
·th
.
	`još
(
g‹¡_‹¡_uts
.
	`G‘TempDœ
(),

68 
GTEST_OUTPUT_SUBDIR
, "")

69 
£lf
.
	$D–‘eFesAndDœ
()

71 
def
 
	$‹¬Down
(
£lf
):

72 
£lf
.
	$D–‘eFesAndDœ
()

74 
def
 
	$D–‘eFesAndDœ
(
£lf
):

75 
Œy
:

76 
os
.
	`»move
(os.
·th
.
	`još
(
£lf
.
ouut_dœ_
, 
GTEST_OUTPUT_1_TEST
 + ".xml"))

77 
exû±
 
os
.
”rÜ
:

78 
·ss


79 
Œy
:

80 
os
.
	`»move
(os.
·th
.
	`još
(
£lf
.
ouut_dœ_
, 
GTEST_OUTPUT_2_TEST
 + ".xml"))

81 
exû±
 
os
.
”rÜ
:

82 
·ss


83 
Œy
:

84 
os
.
	$rmdœ
(
£lf
.
ouut_dœ_
)

85 
exû±
 
os
.
”rÜ
:

86 
·ss


88 
def
 
	$‹¡Outfe1
(
£lf
):

89 
£lf
.
	$_Te¡OutFe
(
GTEST_OUTPUT_1_TEST
, 
EXPECTED_XML_1
)

91 
def
 
	$‹¡Outfe2
(
£lf
):

92 
£lf
.
	$_Te¡OutFe
(
GTEST_OUTPUT_2_TEST
, 
EXPECTED_XML_2
)

94 
def
 
	$_Te¡OutFe
(
£lf
, 
‹¡_Çme
, 
ex³ùed_xml
):

95 
g‹¡_´og_·th
 = 
g‹¡_‹¡_uts
.
	$G‘Te¡ExecubËP©h
(
‹¡_Çme
)

96 
commªd
 = [
g‹¡_´og_·th
, "--g‹¡_ouut=xml:%s" % 
£lf
.
ouut_dœ_
]

97 
p
 = 
g‹¡_‹¡_uts
.
	`Sub´oûss
(
commªd
,

98 
wÜkšg_dœ
=
g‹¡_‹¡_uts
.
	$G‘TempDœ
())

99 
£lf
.
	$as£¹_
(
p
.
ex™ed
)

100 
£lf
.
	$as£¹Equ®s
(0, 
p
.
ex™_code
)

102 #TODO(
wª
@
googË
.
com
): 
libtoŞ
 
ÿu£s
 
the
 
but
 
‹¡
 
bš¬y
 
to
 
be


103 #Çmed 
É
-
g‹¡_xml_outfes_‹¡_
 
š¡—d
 
of


104 #g‹¡_xml_outfes_‹¡_. 
To
 
accouÁ
 
this
 
possibl™y
, 
we


105 #®low 
bÙh
 
Çmes
 
š
 
the
 
fŞlowšg
 
code
. 
We
 
should
 
»move
 
this


106 #hack 
wh’
 
ChªdËr
 
C¬ruth
's†ibtool„eplacementool is„eady.

107 
ouut_fe_Çme1
 = 
‹¡_Çme
 + ".xml"

108 
ouut_fe1
 = 
os
.
·th
.
	$još
(
£lf
.
ouut_dœ_
, 
ouut_fe_Çme1
)

109 
ouut_fe_Çme2
 = 'É-' + 
ouut_fe_Çme1


110 
ouut_fe2
 = 
os
.
·th
.
	$još
(
£lf
.
ouut_dœ_
, 
ouut_fe_Çme2
)

111 
£lf
.
	`as£¹_
(
os
.
·th
.
	$isfe
(
ouut_fe1
è
Ü
 
os
.
·th
.
	`isfe
(
ouut_fe2
),

112 
ouut_fe1
)

114 
ex³ùed
 = 
mšidom
.
	$·r£SŒšg
(
ex³ùed_xml
)

115 
os
.
·th
.
	$isfe
(
ouut_fe1
):

116 
aùu®
 = 
mšidom
.
	$·r£
(
ouut_fe1
)

118 
aùu®
 = 
mšidom
.
	$·r£
(
ouut_fe2
)

119 
£lf
.
	$NÜm®izeXml
(
aùu®
.
docum’tEËm’t
)

120 
£lf
.
	$As£¹Equiv®’tNodes
(
ex³ùed
.
docum’tEËm’t
,

121 
aùu®
.
docum’tEËm’t
)

122 
ex³ùed
.
	$uÆšk
()

123 
aùu®
.
	$uÆšk
()

126 
__Çme__
 == "__main__":

127 
os
.
’vœÚ
["GTEST_STACK_TRACE_DEPTH"] = "0"

128 
g‹¡_‹¡_uts
.
	`Maš
()

	@trunk/objs/gtest-1.6.0/test/gtest_xml_output_unittest.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


2 #
#Cİyrighˆ2006, 
GoogË
 
Inc
.

3 #AÎ 
rights
 
»£rved
.

4 #
#Redi¡ributiÚ 
ªd
 
u£
 
š
 
sourû
‡nd 
bš¬y
 
fÜms
, 
w™h
 
Ü
 
w™hout


5 #modifiÿtiÚ, 
¬e
 
³rm™‹d
 
´ovided
 
th©
 
the
 
fŞlowšg
 
cÚd™iÚs
‡re

7 #
#* 
Redi¡ributiÚs
 
of
 
sourû
 
code
 
mu¡
 
»š
 
the
 
above
 
cİyright


8 #nÙiû, 
this
 
li¡
 
of
 
cÚd™iÚs
 
ªd
 
the
 
fŞlowšg
 
disşaim”
.

9 #* 
Redi¡ributiÚs
 
š
 
bš¬y
 
fÜm
 
mu¡
 
»´oduû
 
the
 
above


10 #cİyrighˆ
nÙiû
, 
this
 
li¡
 
of
 
cÚd™iÚs
 
ªd
 
the
 
fŞlowšg
 
disşaim”


11 #š 
the
 
docum’tiÚ
 
ªd
/
Ü
 
Ùh”
 
m©”Ÿls
 
´ovided
 
w™h
he

13 #* 
Ne™h”
 
the
 
Çme
 
of
 
GoogË
 
Inc
. 
nÜ
h
Çmes
 oà
™s


14 #cÚŒibutÜ 
may
 
be
 
u£d
 
to
 
’dÜ£
 
Ü
 
´omÙe
 
´oduùs
 
d”ived
 
äom


15 #thi 
soáw¬e
 
w™hout
 
¥ecific
 
´iÜ
 
wr™‹n
 
³rmissiÚ
.

16 #
#THIS 
SOFTWARE
 
IS
 
PROVIDED
 
BY
 
THE
 
COPYRIGHT
 
HOLDERS
 
AND
 
CONTRIBUTORS


17 #"
AS
 
IS
" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT

18 #LIMITED 
TO
, 
THE
 
IMPLIED
 
WARRANTIES
 
OF
 
MERCHANTABILITY
 
AND
 
FITNESS
 
FOR


19 #A 
PARTICULAR
 
PURPOSE
 
ARE
 
DISCLAIMED
. 
IN
 
NO
 
EVENT
 
SHALL
 
THE
 
COPYRIGHT


20 #OWNER 
OR
 
CONTRIBUTORS
 
BE
 
LIABLE
 
FOR
 
ANY
 
DIRECT
, 
INDIRECT
, 
INCIDENTAL
,

21 #SPECIAL, 
EXEMPLARY
, 
OR
 
CONSEQUENTIAL
 
DAMAGES
 (
INCLUDING
, 
BUT
 
NOT


22 #LIMITED 
TO
, 
PROCUREMENT
 
OF
 
SUBSTITUTE
 
GOODS
 
OR
 
SERVICES
; 
LOSS
 OF 
USE
,

23 #DATA, 
OR
 
PROFITS
; OR 
BUSINESS
 
INTERRUPTION
è
HOWEVER
 
CAUSED
 
AND
 
ON
 
ANY


24 #THEORY 
OF
 
LIABILITY
, 
WHETHER
 
IN
 
CONTRACT
, 
STRICT
 LIABILITY, 
OR
 
TORT


25 #(
INCLUDING
 
NEGLIGENCE
 
OR
 
OTHERWISE
è
ARISING
 
IN
 
ANY
 
WAY
 
OUT
 
OF
 
THE
 
USE


26 #OF 
THIS
 
SOFTWARE
, 
EVEN
 
IF
 
ADVISED
 
OF
 
THE
 
POSSIBILITY
 OF 
SUCH
 
DAMAGE
.

30 
	g__authÜ__
 = 'eefacm@gmail.com (Sean Mcafee)'

32 
impÜt
 
”ºo


33 
impÜt
 
os


34 
impÜt
 
sys


35 
äom
 
xml
.
dom
 
impÜt
 
mšidom
, 
Node


37 
impÜt
 
g‹¡_‹¡_uts


38 
impÜt
 
g‹¡_xml_‹¡_uts


41 
	gGTEST_OUTPUT_FLAG
 = "--gtest_output"

42 
GTEST_DEFAULT_OUTPUT_FILE
 = "test_detail.xml"

43 
GTEST_PROGRAM_NAME
 = "gtest_xml_output_unittest_"

45 
SUPPORTS_STACK_TRACES
 = 
F®£


47 
SUPPORTS_STACK_TRACES
:

48 
STACK_TRACE_TEMPLATE
 = "\nStackrace:\n*"

50 
STACK_TRACE_TEMPLATE
 = ""

52 
EXPECTED_NON_EMPTY_XML
 = """<?xmÈv”siÚ="1.0"ƒncodšg="
UTF
-8"?>

53 <
‹¡su™es
 
‹¡s
="23" 
çu»s
="4" 
di§bËd
="2" 
”rÜs
="0" 
time
="*" 
Çme
="AllTests">

54 <
‹¡su™e
 
Çme
="SucûssfulTe¡" 
‹¡s
="1" 
çu»s
="0" 
di§bËd
="0" 
”rÜs
="0" 
time
="*">

55 <
‹¡ÿ£
 
Çme
="Sucûeds" 
¡©us
="run" 
time
="*" 
şas¢ame
="SuccessfulTest"/>

56 </
‹¡su™e
>

57 <
‹¡su™e
 
Çme
="FaedTe¡" 
‹¡s
="1" 
çu»s
="1" 
di§bËd
="0" 
”rÜs
="0" 
time
="*">

58 <
‹¡ÿ£
 
Çme
="Fas" 
¡©us
="run" 
time
="*" 
şas¢ame
="FailedTest">

59 <
çu»
 
mes§ge
="V®uof: 2&#x0A;Ex³ùed: 1" 
ty³
=""><![
CDATA
[
g‹¡_xml_ouut_un™‹¡_
.
cc
:*

60 
V®ue
 
of
: 2

61 
Ex³ùed
: 1%(
¡ack
)
s
]]></
çu»
>

62 </
‹¡ÿ£
>

63 </
‹¡su™e
>

64 <
‹¡su™e
 
Çme
="MixedResuÉTe¡" 
‹¡s
="3" 
çu»s
="1" 
di§bËd
="1" 
”rÜs
="0" 
time
="*">

65 <
‹¡ÿ£
 
Çme
="Sucûeds" 
¡©us
="run" 
time
="*" 
şas¢ame
="MixedResultTest"/>

66 <
‹¡ÿ£
 
Çme
="Fas" 
¡©us
="run" 
time
="*" 
şas¢ame
="MixedResultTest">

67 <
çu»
 
mes§ge
="V®uof: 2&#x0A;Ex³ùed: 1" 
ty³
=""><![
CDATA
[
g‹¡_xml_ouut_un™‹¡_
.
cc
:*

68 
V®ue
 
of
: 2

69 
Ex³ùed
: 1%(
¡ack
)
s
]]></
çu»
>

70 <
çu»
 
mes§ge
="V®uof: 3&#x0A;Ex³ùed: 2" 
ty³
=""><![
CDATA
[
g‹¡_xml_ouut_un™‹¡_
.
cc
:*

71 
V®ue
 
of
: 3

72 
Ex³ùed
: 2%(
¡ack
)
s
]]></
çu»
>

73 </
‹¡ÿ£
>

74 <
‹¡ÿ£
 
Çme
="DISABLED_‹¡" 
¡©us
="nÙrun" 
time
="*" 
şas¢ame
="MixedResultTest"/>

75 </
‹¡su™e
>

76 <
‹¡su™e
 
Çme
="XmlQuÙšgTe¡" 
‹¡s
="1" 
çu»s
="1" 
di§bËd
="0" 
”rÜs
="0" 
time
="*">

77 <
‹¡ÿ£
 
Çme
="OuutsCD©a" 
¡©us
="run" 
time
="*" 
şas¢ame
="XmlQuotingTest">

78 <
çu»
 
mes§ge
="Faed&#x0A;XML ouut: &É;?xmÈ’codšg=&quÙ;utf-8&quÙ;&gt;&É;tİ&gt;&É;![CDATA[cd©¨‹xt]]&gt;&É;/tİ&gt;" 
ty³
=""><![
CDATA
[
g‹¡_xml_ouut_un™‹¡_
.
cc
:*

79 
Faed


80 
XML
 
ouut
: <?
xml
 
’codšg
="utf-8"><
tİ
><![
CDATA
[
cd©a
 
‹xt
]]>]]&
gt
;<![CDATA[</tİ>%(
¡ack
)
s
]]></
	gçu»
>

81 </
	g‹¡ÿ£
>

82 </
	g‹¡su™e
>

83 <
‹¡su™e
 
	gÇme
="Inv®idCh¬aù”sTe¡" 
‹¡s
="1" 
çu»s
="1" 
di§bËd
="0" 
”rÜs
="0" 
time
="*">

84 <
‹¡ÿ£
 
Çme
="Inv®idCh¬aù”sInMes§ge" 
¡©us
="run" 
time
="*" 
şas¢ame
="InvalidCharactersTest">

85 <
çu»
 
mes§ge
="Faed&#x0A;Inv®id ch¬aù” š b¿ck‘ []" 
ty³
=""><![
CDATA
[
g‹¡_xml_ouut_un™‹¡_
.
cc
:*

86 
Faed


87 
Inv®id
 
ch¬aù”s
 
š
 
b¿ck‘s
 []%(
¡ack
)
s
]]></
çu»
>

88 </
‹¡ÿ£
>

89 </
‹¡su™e
>

90 <
‹¡su™e
 
Çme
="Di§bËdTe¡" 
‹¡s
="1" 
çu»s
="0" 
di§bËd
="1" 
”rÜs
="0" 
time
="*">

91 <
‹¡ÿ£
 
Çme
="DISABLED_‹¡_nÙ_run" 
¡©us
="nÙrun" 
time
="*" 
şas¢ame
="DisabledTest"/>

92 </
‹¡su™e
>

93 <
‹¡su™e
 
Çme
="Prİ”tyRecÜdšgTe¡" 
‹¡s
="4" 
çu»s
="0" 
di§bËd
="0" 
”rÜs
="0" 
time
="*">

94 <
‹¡ÿ£
 
Çme
="OÃPrİ”ty" 
¡©us
="run" 
time
="*" 
şas¢ame
="Prİ”tyRecÜdšgTe¡" 
key_1
="1"/>

95 <
‹¡ÿ£
 
Çme
="IÁV®uedPrİ”ty" 
¡©us
="run" 
time
="*" 
şas¢ame
="Prİ”tyRecÜdšgTe¡" 
key_št
="1"/>

96 <
‹¡ÿ£
 
Çme
="Th»ePrİ”t›s" 
¡©us
="run" 
time
="*" 
şas¢ame
="Prİ”tyRecÜdšgTe¡" 
key_1
="1" 
key_2
="2" 
key_3
="3"/>

97 <
‹¡ÿ£
 
Çme
="TwoV®uesFÜOÃKeyU£sLa¡V®ue" 
¡©us
="run" 
time
="*" 
şas¢ame
="Prİ”tyRecÜdšgTe¡" 
key_1
="2"/>

98 </
‹¡su™e
>

99 <
‹¡su™e
 
Çme
="NoFixtu»Te¡" 
‹¡s
="3" 
çu»s
="0" 
di§bËd
="0" 
”rÜs
="0" 
time
="*">

100 <
‹¡ÿ£
 
Çme
="RecÜdPrİ”ty" 
¡©us
="run" 
time
="*" 
şas¢ame
="NoFixtu»Te¡" 
key
="1"/>

101 <
‹¡ÿ£
 
Çme
="Ex‹º®Ut™yTh©C®lsRecÜdIÁV®uedPrİ”ty" 
¡©us
="run" 
time
="*" 
şas¢ame
="NoFixtu»Te¡" 
key_fÜ_ut™y_št
="1"/>

102 <
‹¡ÿ£
 
Çme
="Ex‹º®Ut™yTh©C®lsRecÜdSŒšgV®uedPrİ”ty" 
¡©us
="run" 
time
="*" 
şas¢ame
="NoFixtu»Te¡" 
key_fÜ_ut™y_¡ršg
="1"/>

103 </
‹¡su™e
>

104 <
‹¡su™e
 
Çme
="SšgË/V®ueP¬amTe¡" 
‹¡s
="4" 
çu»s
="0" 
di§bËd
="0" 
”rÜs
="0" 
time
="*">

105 <
‹¡ÿ£
 
Çme
="HasV®ueP¬amA‰ribu‹/0" 
v®ue_·¿m
="33" 
¡©us
="run" 
time
="*" 
şas¢ame
="Single/ValueParamTest" />

106 <
‹¡ÿ£
 
Çme
="HasV®ueP¬amA‰ribu‹/1" 
v®ue_·¿m
="42" 
¡©us
="run" 
time
="*" 
şas¢ame
="Single/ValueParamTest" />

107 <
‹¡ÿ£
 
Çme
="AnÙh”Te¡Th©HasV®ueP¬amA‰ribu‹/0" 
v®ue_·¿m
="33" 
¡©us
="run" 
time
="*" 
şas¢ame
="Single/ValueParamTest" />

108 <
‹¡ÿ£
 
Çme
="AnÙh”Te¡Th©HasV®ueP¬amA‰ribu‹/1" 
v®ue_·¿m
="42" 
¡©us
="run" 
time
="*" 
şas¢ame
="Single/ValueParamTest" />

109 </
‹¡su™e
>

110 <
‹¡su™e
 
Çme
="Ty³dTe¡/0" 
‹¡s
="1" 
çu»s
="0" 
di§bËd
="0" 
”rÜs
="0" 
time
="*">

111 <
‹¡ÿ£
 
Çme
="HasTy³P¬amA‰ribu‹" 
ty³_·¿m
="*" 
¡©us
="run" 
time
="*" 
şas¢ame
="TypedTest/0" />

112 </
‹¡su™e
>

113 <
‹¡su™e
 
Çme
="Ty³dTe¡/1" 
‹¡s
="1" 
çu»s
="0" 
di§bËd
="0" 
”rÜs
="0" 
time
="*">

114 <
‹¡ÿ£
 
Çme
="HasTy³P¬amA‰ribu‹" 
ty³_·¿m
="*" 
¡©us
="run" 
time
="*" 
şas¢ame
="TypedTest/1" />

115 </
‹¡su™e
>

116 <
‹¡su™e
 
Çme
="SšgË/Ty³P¬am‘”izedTe¡Ca£/0" 
‹¡s
="1" 
çu»s
="0" 
di§bËd
="0" 
”rÜs
="0" 
time
="*">

117 <
‹¡ÿ£
 
Çme
="HasTy³P¬amA‰ribu‹" 
ty³_·¿m
="*" 
¡©us
="run" 
time
="*" 
şas¢ame
="Single/TypeParameterizedTestCase/0" />

118 </
‹¡su™e
>

119 <
‹¡su™e
 
Çme
="SšgË/Ty³P¬am‘”izedTe¡Ca£/1" 
‹¡s
="1" 
çu»s
="0" 
di§bËd
="0" 
”rÜs
="0" 
time
="*">

120 <
‹¡ÿ£
 
Çme
="HasTy³P¬amA‰ribu‹" 
ty³_·¿m
="*" 
¡©us
="run" 
time
="*" 
şas¢ame
="Single/TypeParameterizedTestCase/1" />

121 </
‹¡su™e
>

122 </
‹¡su™es
>""" % {'stack': STACK_TRACE_TEMPLATE}

125 
EXPECTED_EMPTY_XML
 = """<?xmÈv”siÚ="1.0"ƒncodšg="
UTF
-8"?>

126 <
‹¡su™es
 
‹¡s
="0" 
çu»s
="0" 
di§bËd
="0" 
”rÜs
="0" 
time
="*" 
Çme
="AllTests">

127 </
‹¡su™es
>"""

130 
şass
 
	$GTe¡XMLOuutUn™Te¡
(
g‹¡_xml_‹¡_uts
.
GTe¡XMLTe¡Ca£
):

132 
Un™
 
‹¡
 
GoogË
 
Te¡
's XML output functionality.

135 
def
 
	$‹¡NÚEm±yXmlOuut
(
£lf
):

137 
Runs
 
a
 
‹¡
 
´og¿m
 
th©
 
g’”©es
‡ 
nÚ
-
em±y
 
XML
 
ouut
, 
ªd


138 
‹¡s
 
th©
 
the
 
XML
 
ouut
 
is
 
ex³ùed
.

140 
£lf
.
	$_Te¡XmlOuut
(
GTEST_PROGRAM_NAME
, 
EXPECTED_NON_EMPTY_XML
, 1)

142 
def
 
	$‹¡Em±yXmlOuut
(
£lf
):

144 
Runs
 
a
 
‹¡
 
´og¿m
 
th©
 
g’”©es
 
ª
 
em±y
 
XML
 
ouut
, 
ªd


145 
‹¡s
 
th©
 
the
 
XML
 
ouut
 
is
 
ex³ùed
.

148 
£lf
.
	`_Te¡XmlOuut
("gtest_no_test_unittest",

149 
EXPECTED_EMPTY_XML
, 0)

151 
def
 
	$‹¡DeçuÉOuutFe
(
£lf
):

153 
CÚfœms
 
th©
 
GoogË
 
Te¡
 
´oduûs
 
ª
 
XML
 
ouut
 
fe
 
w™h
 
the
 
ex³ùed


154  
Çme
 
no
‚am
is
 
ex¶ic™ly
 
¥ecif›d
.

156 
ouut_fe
 = 
os
.
·th
.
	`još
(
g‹¡_‹¡_uts
.
	`G‘TempDœ
(),

157 
GTEST_DEFAULT_OUTPUT_FILE
)

158 
g‹¡_´og_·th
 = 
g‹¡_‹¡_uts
.
	`G‘Te¡ExecubËP©h
(

160 
Œy
:

161 
os
.
	$»move
(
ouut_fe
)

162 
exû±
 
OSE¼Ü
, 
e
:

163 
e
.
”ºo
 !ğ”ºo.
ENOENT
:

164 
¿i£


166 
p
 = 
g‹¡_‹¡_uts
.
	`Sub´oûss
(

167 [
g‹¡_´og_·th
, "%s=xml" % 
GTEST_OUTPUT_FLAG
],

168 
wÜkšg_dœ
=
g‹¡_‹¡_uts
.
	$G‘TempDœ
())

169 
£lf
.
	$as£¹_
(
p
.
ex™ed
)

170 
£lf
.
	$as£¹Equ®s
(0, 
p
.
ex™_code
)

171 
£lf
.
	`as£¹_
(
os
.
·th
.
	$isfe
(
ouut_fe
))

173 
def
 
	$‹¡Suµ»s£dXmlOuut
(
£lf
):

175 
Te¡s
 
th©
 
no
 
XML
 
fe
 
is
 
g’”©ed
 
the
  XML 
li¡’”
 is

176 
shut
 
down
 
befÜe
 
RUN_ALL_TESTS
 
is
 
švoked
.

179 
xml_·th
 = 
os
.
·th
.
	`još
(
g‹¡_‹¡_uts
.
	`G‘TempDœ
(),

180 
GTEST_PROGRAM_NAME
 + "out.xml")

181 
os
.
·th
.
	$isfe
(
xml_·th
):

182 
os
.
	$»move
(
xml_·th
)

184 
g‹¡_´og_·th
 = 
g‹¡_‹¡_uts
.
	$G‘Te¡ExecubËP©h
(
GTEST_PROGRAM_NAME
)

186 
commªd
 = [
g‹¡_´og_·th
,

187 "%s=xml:%s" % (
GTEST_OUTPUT_FLAG
, 
xml_·th
),

189 
p
 = 
g‹¡_‹¡_uts
.
	$Sub´oûss
(
commªd
)

190 
p
.
‹rmš©ed_by_sigÇl
:

191 
£lf
.
	`as£¹_
(
F®£
,

192 "% wa kËd by sigÇÈ%d" % (
g‹¡_´og_Çme
, 
p
.
sigÇl
))

194 
£lf
.
	$as£¹_
(
p
.
ex™ed
)

195 
£lf
.
	`as£¹Equ®s
(1, 
p
.
ex™_code
,

198 % (
commªd
, 
p
.
ex™_code
, 1))

200 
£lf
.
	`as£¹_
(
nÙ
 
os
.
·th
.
	$isfe
(
xml_·th
))

203 
def
 
	$_Te¡XmlOuut
(
£lf
, 
g‹¡_´og_Çme
, 
ex³ùed_xml
, 
ex³ùed_ex™_code
):

205 
As£¹s
 
th©
 
the
 
XML
 
docum’t
 
g’”©ed
 
by
 
ruÂšg
h
´og¿m


206 
g‹¡_´og_Çme
 
m©ches
 
ex³ùed_xml
, 
a
 
¡ršg
 
cÚššg
 
ªÙh”


207 
XML
 
docum’t
. 
Fu¹h”mÜe
, 
the
 
´og¿m
'sƒxit code must be

208 
ex³ùed_ex™_code
.

210 
xml_·th
 = 
os
.
·th
.
	`još
(
g‹¡_‹¡_uts
.
	`G‘TempDœ
(),

211 
g‹¡_´og_Çme
 + "out.xml")

212 
g‹¡_´og_·th
 = 
g‹¡_‹¡_uts
.
	$G‘Te¡ExecubËP©h
(
g‹¡_´og_Çme
)

214 
commªd
 = [
g‹¡_´og_·th
, "%s=xml:%s" % (
GTEST_OUTPUT_FLAG
, 
xml_·th
)]

215 
p
 = 
g‹¡_‹¡_uts
.
	$Sub´oûss
(
commªd
)

216 
p
.
‹rmš©ed_by_sigÇl
:

217 
£lf
.
	`as£¹_
(
F®£
,

218 "% wa kËd by sigÇÈ%d" % (
g‹¡_´og_Çme
, 
p
.
sigÇl
))

220 
£lf
.
	$as£¹_
(
p
.
ex™ed
)

221 
£lf
.
	`as£¹Equ®s
(
ex³ùed_ex™_code
, 
p
.
ex™_code
,

224 % (
commªd
, 
p
.
ex™_code
, 
ex³ùed_ex™_code
))

226 
ex³ùed
 = 
mšidom
.
	$·r£SŒšg
(
ex³ùed_xml
)

227 
aùu®
 = 
mšidom
.
	$·r£
(
xml_·th
)

228 
£lf
.
	$NÜm®izeXml
(
aùu®
.
docum’tEËm’t
)

229 
£lf
.
	$As£¹Equiv®’tNodes
(
ex³ùed
.
docum’tEËm’t
,

230 
aùu®
.
docum’tEËm’t
)

231 
ex³ùed
.
	$uÆšk
()

232 
aùu®
 .
	$uÆšk
()

236 
__Çme__
 == '__main__':

237 
os
.
’vœÚ
['GTEST_STACK_TRACE_DEPTH'] = '1'

238 
g‹¡_‹¡_uts
.
	`Maš
()

	@trunk/objs/gtest-1.6.0/test/gtest_xml_test_utils.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


2 #
#Cİyrighˆ2006, 
GoogË
 
Inc
.

3 #AÎ 
rights
 
»£rved
.

4 #
#Redi¡ributiÚ 
ªd
 
u£
 
š
 
sourû
‡nd 
bš¬y
 
fÜms
, 
w™h
 
Ü
 
w™hout


5 #modifiÿtiÚ, 
¬e
 
³rm™‹d
 
´ovided
 
th©
 
the
 
fŞlowšg
 
cÚd™iÚs
‡re

7 #
#* 
Redi¡ributiÚs
 
of
 
sourû
 
code
 
mu¡
 
»š
 
the
 
above
 
cİyright


8 #nÙiû, 
this
 
li¡
 
of
 
cÚd™iÚs
 
ªd
 
the
 
fŞlowšg
 
disşaim”
.

9 #* 
Redi¡ributiÚs
 
š
 
bš¬y
 
fÜm
 
mu¡
 
»´oduû
 
the
 
above


10 #cİyrighˆ
nÙiû
, 
this
 
li¡
 
of
 
cÚd™iÚs
 
ªd
 
the
 
fŞlowšg
 
disşaim”


11 #š 
the
 
docum’tiÚ
 
ªd
/
Ü
 
Ùh”
 
m©”Ÿls
 
´ovided
 
w™h
he

13 #* 
Ne™h”
 
the
 
Çme
 
of
 
GoogË
 
Inc
. 
nÜ
h
Çmes
 oà
™s


14 #cÚŒibutÜ 
may
 
be
 
u£d
 
to
 
’dÜ£
 
Ü
 
´omÙe
 
´oduùs
 
d”ived
 
äom


15 #thi 
soáw¬e
 
w™hout
 
¥ecific
 
´iÜ
 
wr™‹n
 
³rmissiÚ
.

16 #
#THIS 
SOFTWARE
 
IS
 
PROVIDED
 
BY
 
THE
 
COPYRIGHT
 
HOLDERS
 
AND
 
CONTRIBUTORS


17 #"
AS
 
IS
" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT

18 #LIMITED 
TO
, 
THE
 
IMPLIED
 
WARRANTIES
 
OF
 
MERCHANTABILITY
 
AND
 
FITNESS
 
FOR


19 #A 
PARTICULAR
 
PURPOSE
 
ARE
 
DISCLAIMED
. 
IN
 
NO
 
EVENT
 
SHALL
 
THE
 
COPYRIGHT


20 #OWNER 
OR
 
CONTRIBUTORS
 
BE
 
LIABLE
 
FOR
 
ANY
 
DIRECT
, 
INDIRECT
, 
INCIDENTAL
,

21 #SPECIAL, 
EXEMPLARY
, 
OR
 
CONSEQUENTIAL
 
DAMAGES
 (
INCLUDING
, 
BUT
 
NOT


22 #LIMITED 
TO
, 
PROCUREMENT
 
OF
 
SUBSTITUTE
 
GOODS
 
OR
 
SERVICES
; 
LOSS
 OF 
USE
,

23 #DATA, 
OR
 
PROFITS
; OR 
BUSINESS
 
INTERRUPTION
è
HOWEVER
 
CAUSED
 
AND
 
ON
 
ANY


24 #THEORY 
OF
 
LIABILITY
, 
WHETHER
 
IN
 
CONTRACT
, 
STRICT
 LIABILITY, 
OR
 
TORT


25 #(
INCLUDING
 
NEGLIGENCE
 
OR
 
OTHERWISE
è
ARISING
 
IN
 
ANY
 
WAY
 
OUT
 
OF
 
THE
 
USE


26 #OF 
THIS
 
SOFTWARE
, 
EVEN
 
IF
 
ADVISED
 
OF
 
THE
 
POSSIBILITY
 OF 
SUCH
 
DAMAGE
.

30 
	g__authÜ__
 = 'eefacm@gmail.com (Sean Mcafee)'

32 
impÜt
 
»


33 
äom
 
xml
.
dom
 
impÜt
 
mšidom
, 
Node


35 
impÜt
 
g‹¡_‹¡_uts


38 
	gGTEST_OUTPUT_FLAG
 = "--gtest_output"

39 
GTEST_DEFAULT_OUTPUT_FILE
 = "test_detail.xml"

41 
şass
 
	$GTe¡XMLTe¡Ca£
(
g‹¡_‹¡_uts
.
Te¡Ca£
):

43 
Ba£
 
şass
 
‹¡s
 
of
 
GoogË
 
Te¡
's XML output functionality.

47 
def
 
	$As£¹Equiv®’tNodes
(
£lf
, 
ex³ùed_node
, 
aùu®_node
):

49 
As£¹s
 
th©
 
	$aùu®_node
 (
a
 
DOM
 
node
 
objeù
è
is
 
equiv®’t
 
to


50 
	`ex³ùed_node
 (
ªÙh”
 
DOM
 
node
 
objeù
), 
š
 
th©
 
e™h”
 
bÙh
 
of


51 
them
 
¬e
 
CDATA
 
nodes
 
ªd
 
have
 
the
 
§me
 
v®ue
, 
Ü
 
bÙh
‡» 
DOM


52 
–em’ts
 
ªd
 
aùu®_node
 
m“ts
 
®l
 
of
 
the
 
fŞlowšg
 
cÚd™iÚs
:

54 * 
It
 
has
 
the
 
§me
 
g
 
Çme
 
as
 
ex³ùed_node
.

55 * 
It
 
has
 
the
 
§me
 
£t
 
of
 
©Œibu‹s
 
as
 
ex³ùed_node
, 
—ch
 
w™h


56 
the
 
§me
 
v®ue
 
as
h
cÜ»¥Údšg
 
©Œibu‹
 
of
 
ex³ùed_node
.

57 
Exû±iÚs
 
¬e
 
ªy
 
©Œibu‹
 
Çmed
 "time", 
which
 
Ãeds
 
Úly
 
be


58 
cÚv”tibË
 
to
 
a
 
æßtšg
-
pošt
 
numb”
 
ªd
 
ªy
 
©Œibu‹
 
Çmed


59 "ty³_·¿m" 
which
 
Úly
 
has
 
to
 
be
 
nÚ
-
em±y
.

60 * 
It
 
has
 
ª
 
equiv®’t
 
£t
 
of
 
chd
 
	$nodes
 (
šşudšg
 
–em’ts
 
ªd


61 
CDATA
 
£ùiÚs
è
as
 
ex³ùed_node
. 
NÙe
 
th©
 
we
 
ignÜe
 
the


62 
Üd”
 
of
 
the
 
chd»n
 
as
 
they
 
¬e
 
nÙ
 
gu¬ª‹ed
 
to
 
be
 
š
 
ªy


63 
·¹icuÏr
 
Üd”
.

66 
ex³ùed_node
.
nodeTy³
 =ğ
Node
.
CDATA_SECTION_NODE
:

67 
£lf
.
	$as£¹Equ®s
(
Node
.
CDATA_SECTION_NODE
, 
aùu®_node
.
nodeTy³
)

68 
£lf
.
	$as£¹Equ®s
(
ex³ùed_node
.
nodeV®ue
, 
aùu®_node
.nodeValue)

71 
£lf
.
	$as£¹Equ®s
(
Node
.
ELEMENT_NODE
, 
aùu®_node
.
nodeTy³
)

72 
£lf
.
	$as£¹Equ®s
(
Node
.
ELEMENT_NODE
, 
ex³ùed_node
.
nodeTy³
)

73 
£lf
.
	$as£¹Equ®s
(
ex³ùed_node
.
gName
, 
aùu®_node
.tagName)

75 
ex³ùed_©Œibu‹s
 = 
ex³ùed_node
.
©Œibu‹s


76 
aùu®_©Œibu‹s
 = 
aùu®_node
 .
©Œibu‹s


77 
£lf
.
	`as£¹Equ®s
(

78 
ex³ùed_©Œibu‹s
.
Ëngth
, 
aùu®_©Œibu‹s
.length,

79 "©Œibu‹‚umb” difã¸šƒËm’ˆ" + 
aùu®_node
.
gName
)

80 
i
 
š
 
	$¿nge
(
ex³ùed_©Œibu‹s
.
Ëngth
):

81 
ex³ùed_©Œ
 = 
ex³ùed_©Œibu‹s
.
	$™em
(
i
)

82 
aùu®_©Œ
 = 
aùu®_©Œibu‹s
.
	$g‘
(
ex³ùed_©Œ
.
Çme
)

83 
£lf
.
	`as£¹_
(

84 
aùu®_©Œ
 
is
 
nÙ
 
NÚe
,

86 (
ex³ùed_©Œ
.
Çme
, 
aùu®_node
.
gName
))

87 
£lf
.
	`as£¹Equ®s
(
ex³ùed_©Œ
.
v®ue
, 
aùu®_©Œ
.value,

89 (
ex³ùed_©Œ
.
Çme
, 
aùu®_node
.
gName
))

91 
ex³ùed_chd»n
 = 
£lf
.
	$_G‘Chd»n
(
ex³ùed_node
)

92 
aùu®_chd»n
 = 
£lf
.
	$_G‘Chd»n
(
aùu®_node
)

93 
£lf
.
	`as£¹Equ®s
(

94 
	`Ën
(
ex³ùed_chd»n
),†’(
aùu®_chd»n
),

95 "numb” oàchdƒËm’t difã¸šƒËm’ˆ" + 
aùu®_node
.
gName
)

96 
chd_id
, 
chd
 
š
 
ex³ùed_chd»n
.
	$™”™ems
():

97 
£lf
.
	`as£¹_
(
chd_id
 
š
 
aùu®_chd»n
,

99 (
chd_id
, 
aùu®_chd»n
, 
aùu®_node
.
gName
))

100 
£lf
.
	$As£¹Equiv®’tNodes
(
chd
, 
aùu®_chd»n
[
chd_id
])

102 
id’tifyšg_©Œibu‹
 = {

107 
	}
}

109 
def
 
	$_G‘Chd»n
(
£lf
, 
–em’t
):

111 
F‘ches
 
®l
 
of
 
the
 
chd
 
nodes
 oà
–em’t
, 
a
 
DOM
 
EËm’t
 
objeù
.

112 
R‘uºs
 
them
 
as
 
the
 
v®ues
 
of
 
a
 
diùiÚ¬y
 
keyed
 
by
h
IDs
 ofhe

113 
chd»n
. 
FÜ
 <
‹¡su™es
>, <
‹¡su™e
> 
ªd
 <
‹¡ÿ£
> 
–em’ts
, 
the
 
ID


114 
is
 
the
 
v®ue
 
of
 
theœ
 "Çme" 
©Œibu‹
; <
çu»
> 
–em’ts
, 
™
 is

115 
the
 
v®ue
 
of
h"mes§ge" 
©Œibu‹
; 
CDATA
 
£ùiÚs
 
ªd
 
nÚ
-
wh™e¥aû


116 
‹xt
 
nodes
 
¬e
 
cÚÿ‹Ç‹d
 
što
 
a
 
sšgË
 
CDATA
 
£ùiÚ
 
w™h
 
ID


117 "d‘a". 
An
 
exû±iÚ
 
is
 
¿i£d
 
ªy
 
–em’t
 
Ùh”
 
thª
 
the
 
above


118 
four
 
is
 
’couÁ”ed
, 
two
 
chd
 
–em’ts
 
w™h
 
the
 
§me
 
id’tifyšg


119 
©Œibu‹s
 
¬e
 
’couÁ”ed
, 
Ü
 
ªy
 
Ùh”
 
ty³
 
of
 
node
 
is
ƒncountered.

122 
chd»n
 = {
	}
}

123 
chd
 
š
 
–em’t
.
chdNodes
:

124 
chd
.
nodeTy³
 =ğ
Node
.
ELEMENT_NODE
:

125 
£lf
.
as£¹_
(
chd
.
gName
 
š
 s–f.
id’tifyšg_©Œibu‹
,

126 "EncouÁ”ed unknowÀ–em’ˆ<%s>" % 
chd
.
gName
)

127 
	gchdID
 = 
chd
.
	$g‘A‰ribu‹
(
£lf
.
id’tifyšg_©Œibu‹
[
chd
.
gName
])

128 
£lf
.
	$as£¹_
(
chdID
 
nÙ
 
š
 
chd»n
)

129 
chd»n
[
chdID
] = 
chd


130 
–if
 
chd
.
nodeTy³
 
š
 [
Node
.
TEXT_NODE
, Node.
CDATA_SECTION_NODE
]:

131 "d‘a" 
nÙ
 
š
 
chd»n
:

132 ià(
chd
.
nodeTy³
 =ğ
Node
.
CDATA_SECTION_NODE
 
Ü


133 
nÙ
 
chd
.
nodeV®ue
.
	$is¥aû
()):

134 
chd»n
["d‘a"] = 
chd
.
owÃrDocum’t
.
	$ü—‹CDATASeùiÚ
(

135 
chd
.
nodeV®ue
)

137 
chd»n
["d‘a"].
nodeV®ue
 +ğ
chd
.nodeValue

139 
£lf
.
	`ç
("EncouÁ”ed uÃx³ùed‚odty³ %d" % 
chd
.
nodeTy³
)

140  
chd»n


142 
def
 
	$NÜm®izeXml
(
£lf
, 
–em’t
):

144 
NÜm®izes
 
GoogË
 
Te¡
's XML outputoƒliminate„eferencesoransient

145 
šfÜm©iÚ
 
th©
 
may
 
chªge
 
äom
 
run
 
to
„un.

147 * 
The
 "time" 
©Œibu‹
 
of
 <
‹¡su™es
>, <
‹¡su™e
> 
ªd
 <
‹¡ÿ£
>

148 
–em’ts
 
is
 
»¶aûd
 
w™h
 
a
 
sšgË
 
a¡”isk
, 
™
 
cÚšs


149 
Úly
 
dig™
 
ch¬aù”s
.

150 * 
The
 "ty³_·¿m" 
©Œibu‹
 
of
 <
‹¡ÿ£
> 
–em’ts
 
is
 
»¶aûd
 
w™h
 
a


151 
sšgË
 
	`a¡”isk
 (
™
 
¢
 
nÚ
-
em±y
è
as
 iˆ
is
 
the
 
ty³
 
Çme
 
»tuºed


152 
by
 
the
 
comp”
 
ªd
 
is
 
¶©fÜm
 
d•’d’t
.

153 * 
The
 
lše
 
numb”
 
»pÜ‹d
 
š
 
the
 
fœ¡
†š
of
he "message"

154 
©Œibu‹
 
of
 <
çu»
> 
–em’ts
 
is
 
»¶aûd
 
w™h
 
a
 
sšgË
 
a¡”isk
.

155 * 
The
 
dœeùÜy
 
Çmes
 
š
 
fe
 
·ths
 
¬e
 
»moved
.

156 * 
The
 
¡ack
 
Œaûs
 
¬e
 
»moved
.

159 
–em’t
.
gName
 
	`š
 ("testsuites", "testsuite", "testcase"):

160 
time
 = 
–em’t
.
	`g‘A‰ribu‹Node
("time")

161 
time
.
v®ue
 = 
»
.
	`sub
(
r
"^\d+(\.\d+)?$", "*",ime.value)

162 
ty³_·¿m
 = 
–em’t
.
	`g‘A‰ribu‹Node
("type_param")

163 
ty³_·¿m
 
ªd
y³_·¿m.
v®ue
:

164 
ty³_·¿m
.
v®ue
 = "*"

165 
–if
 
–em’t
.
gName
 == "failure":

166 
chd
 
š
 
–em’t
.
chdNodes
:

167 
chd
.
nodeTy³
 =ğ
Node
.
CDATA_SECTION_NODE
:

168 #Remove 
the
 
sourû
 
lše
 
numb”
.

169 
cd©a
 = 
»
.
	`sub
(
r
"^.*[/\\](.*:)\d+\n", "\\1*\n", 
chd
.
nodeV®ue
)

170 #Remove 
the
 
aùu®
 
¡ack
 
Œaû
.

171 
chd
.
nodeV®ue
 = 
»
.
	`sub
(
r
"\nStackrace:\n(.|\n)*",

172 "", 
cd©a
)

173 
chd
 
š
 
–em’t
.
chdNodes
:

174 
chd
.
nodeTy³
 =ğ
Node
.
ELEMENT_NODE
:

175 
£lf
.
	`NÜm®izeXml
(
chd
)

	@trunk/objs/gtest-1.6.0/xcode/Samples/FrameworkSample/runtests.sh

1 #!/
bš
/
bash


2 #
#Cİyrighˆ2008, 
GoogË
 
Inc
.

3 #AÎ 
rights
 
»£rved
.

4 #
#Redi¡ributiÚ 
ªd
 
u£
 
š
 
sourû
‡nd 
bš¬y
 
fÜms
, 
w™h
 
Ü
 
w™hout


5 #modifiÿtiÚ, 
¬e
 
³rm™‹d
 
´ovided
 
th©
 
the
 
fŞlowšg
 
cÚd™iÚs
‡re

7 #
#* 
Redi¡ributiÚs
 
of
 
sourû
 
code
 
mu¡
 
»š
 
the
 
above
 
cİyright


8 #nÙiû, 
this
 
li¡
 
of
 
cÚd™iÚs
 
ªd
 
the
 
fŞlowšg
 
disşaim”
.

9 #* 
Redi¡ributiÚs
 
š
 
bš¬y
 
fÜm
 
mu¡
 
»´oduû
 
the
 
above


10 #cİyrighˆ
nÙiû
, 
this
 
li¡
 
of
 
cÚd™iÚs
 
ªd
 
the
 
fŞlowšg
 
disşaim”


11 #š 
the
 
docum’tiÚ
 
ªd
/
Ü
 
Ùh”
 
m©”Ÿls
 
´ovided
 
w™h
he

13 #* 
Ne™h”
 
the
 
Çme
 
of
 
GoogË
 
Inc
. 
nÜ
h
Çmes
 oà
™s


14 #cÚŒibutÜ 
may
 
be
 
u£d
 
to
 
’dÜ£
 
Ü
 
´omÙe
 
´oduùs
 
d”ived
 
äom


15 #thi 
soáw¬e
 
w™hout
 
¥ecific
 
´iÜ
 
wr™‹n
 
³rmissiÚ
.

16 #
#THIS 
SOFTWARE
 
IS
 
PROVIDED
 
BY
 
THE
 
COPYRIGHT
 
HOLDERS
 
AND
 
CONTRIBUTORS


17 #"
AS
 
IS
" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT

18 #LIMITED 
TO
, 
THE
 
IMPLIED
 
WARRANTIES
 
OF
 
MERCHANTABILITY
 
AND
 
FITNESS
 
FOR


19 #A 
PARTICULAR
 
PURPOSE
 
ARE
 
DISCLAIMED
. 
IN
 
NO
 
EVENT
 
SHALL
 
THE
 
COPYRIGHT


20 #OWNER 
OR
 
CONTRIBUTORS
 
BE
 
LIABLE
 
FOR
 
ANY
 
DIRECT
, 
INDIRECT
, 
INCIDENTAL
,

21 #SPECIAL, 
EXEMPLARY
, 
OR
 
CONSEQUENTIAL
 
DAMAGES
 (
INCLUDING
, 
BUT
 
NOT


22 #LIMITED 
TO
, 
PROCUREMENT
 
OF
 
SUBSTITUTE
 
GOODS
 
OR
 
SERVICES
; 
LOSS
 OF 
USE
,

23 #DATA, 
OR
 
PROFITS
; OR 
BUSINESS
 
INTERRUPTION
è
HOWEVER
 
CAUSED
 
AND
 
ON
 
ANY


24 #THEORY 
OF
 
LIABILITY
, 
WHETHER
 
IN
 
CONTRACT
, 
STRICT
 LIABILITY, 
OR
 
TORT


25 #(
INCLUDING
 
NEGLIGENCE
 
OR
 
OTHERWISE
è
ARISING
 
IN
 
ANY
 
WAY
 
OUT
 
OF
 
THE
 
USE


26 #OF 
THIS
 
SOFTWARE
, 
EVEN
 
IF
 
ADVISED
 
OF
 
THE
 
POSSIBILITY
 OF 
SUCH
 
DAMAGE
.

28 #Execu‹ 
the
 
§m¶es
 
ªd
 
‹¡s
 th
GoogË
 
Te¡
 
F¿mewÜk
.

30 #H–°
the
 
dyÇmic
 
lšk”
 
fšd
h
·th
 
to
h
lib¿r›s
.

31 
expÜt
 
	gDYLD_FRAMEWORK_PATH
=
$BUILT_PRODUCTS_DIR


32 
expÜt
 
DYLD_LIBRARY_PATH
=
$BUILT_PRODUCTS_DIR


34 #C»©
some
 
execubËs
.

35 
‹¡_execubËs
=
$
@

37 #Now 
execu‹
 
—ch
 
Úe
 
š
 
tuº
 
k“pšg
 
Œack
 
of
 
how
 
mªy
 
sucûeded
 
ªd
 
çed
.

38 
sucûeded
=0

39 
çed
=0

40 
çed_li¡
=()

41 
‹¡
 
š
 
$
{
‹¡_execubËs
[*]}; do

43 
	g»suÉ
=
$
?

44 [ 
$»suÉ
 -
eq
 0 ]; 
th’


45 
	gsucûeded
=
$
(Ğ
$sucûeded
 + 1 ))

47 
çed
=
$
(( failed + 1 ))

48 
çed_li¡
="$failed_list $test"

49 
fi


50 
dÚe


52 #R•Üˆ
the
 
sucûs£s
 
ªd
 
çu»s
 
to
h
cÚsŞe
.

53 
echo
 "Tests complete with $succeeded successes‡nd $failed failures."

54 [ 
$çed
 -
Ã
 0 ]; 
th’


55 
	gecho
 "The followingests failed:"

56 
echo
 
$çed_li¡


57 
fi


58 
ex™
 
	g$çed


	@trunk/objs/gtest-1.6.0/xcode/Scripts/runtests.sh

1 #!/
bš
/
bash


2 #
#Cİyrighˆ2008, 
GoogË
 
Inc
.

3 #AÎ 
rights
 
»£rved
.

4 #
#Redi¡ributiÚ 
ªd
 
u£
 
š
 
sourû
‡nd 
bš¬y
 
fÜms
, 
w™h
 
Ü
 
w™hout


5 #modifiÿtiÚ, 
¬e
 
³rm™‹d
 
´ovided
 
th©
 
the
 
fŞlowšg
 
cÚd™iÚs
‡re

7 #
#* 
Redi¡ributiÚs
 
of
 
sourû
 
code
 
mu¡
 
»š
 
the
 
above
 
cİyright


8 #nÙiû, 
this
 
li¡
 
of
 
cÚd™iÚs
 
ªd
 
the
 
fŞlowšg
 
disşaim”
.

9 #* 
Redi¡ributiÚs
 
š
 
bš¬y
 
fÜm
 
mu¡
 
»´oduû
 
the
 
above


10 #cİyrighˆ
nÙiû
, 
this
 
li¡
 
of
 
cÚd™iÚs
 
ªd
 
the
 
fŞlowšg
 
disşaim”


11 #š 
the
 
docum’tiÚ
 
ªd
/
Ü
 
Ùh”
 
m©”Ÿls
 
´ovided
 
w™h
he

13 #* 
Ne™h”
 
the
 
Çme
 
of
 
GoogË
 
Inc
. 
nÜ
h
Çmes
 oà
™s


14 #cÚŒibutÜ 
may
 
be
 
u£d
 
to
 
’dÜ£
 
Ü
 
´omÙe
 
´oduùs
 
d”ived
 
äom


15 #thi 
soáw¬e
 
w™hout
 
¥ecific
 
´iÜ
 
wr™‹n
 
³rmissiÚ
.

16 #
#THIS 
SOFTWARE
 
IS
 
PROVIDED
 
BY
 
THE
 
COPYRIGHT
 
HOLDERS
 
AND
 
CONTRIBUTORS


17 #"
AS
 
IS
" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT

18 #LIMITED 
TO
, 
THE
 
IMPLIED
 
WARRANTIES
 
OF
 
MERCHANTABILITY
 
AND
 
FITNESS
 
FOR


19 #A 
PARTICULAR
 
PURPOSE
 
ARE
 
DISCLAIMED
. 
IN
 
NO
 
EVENT
 
SHALL
 
THE
 
COPYRIGHT


20 #OWNER 
OR
 
CONTRIBUTORS
 
BE
 
LIABLE
 
FOR
 
ANY
 
DIRECT
, 
INDIRECT
, 
INCIDENTAL
,

21 #SPECIAL, 
EXEMPLARY
, 
OR
 
CONSEQUENTIAL
 
DAMAGES
 (
INCLUDING
, 
BUT
 
NOT


22 #LIMITED 
TO
, 
PROCUREMENT
 
OF
 
SUBSTITUTE
 
GOODS
 
OR
 
SERVICES
; 
LOSS
 OF 
USE
,

23 #DATA, 
OR
 
PROFITS
; OR 
BUSINESS
 
INTERRUPTION
è
HOWEVER
 
CAUSED
 
AND
 
ON
 
ANY


24 #THEORY 
OF
 
LIABILITY
, 
WHETHER
 
IN
 
CONTRACT
, 
STRICT
 LIABILITY, 
OR
 
TORT


25 #(
INCLUDING
 
NEGLIGENCE
 
OR
 
OTHERWISE
è
ARISING
 
IN
 
ANY
 
WAY
 
OUT
 
OF
 
THE
 
USE


26 #OF 
THIS
 
SOFTWARE
, 
EVEN
 
IF
 
ADVISED
 
OF
 
THE
 
POSSIBILITY
 OF 
SUCH
 
DAMAGE
.

28 #Execu‹ 
the
 
§m¶es
 
ªd
 
‹¡s
 th
GoogË
 
Te¡
 
F¿mewÜk
.

30 #H–°
the
 
dyÇmic
 
lšk”
 
fšd
h
·th
 
to
h
lib¿r›s
.

31 
expÜt
 
	gDYLD_FRAMEWORK_PATH
=
$BUILT_PRODUCTS_DIR


32 
expÜt
 
DYLD_LIBRARY_PATH
=
$BUILT_PRODUCTS_DIR


34 #C»©
some
 
execubËs
.

35 
‹¡_execubËs
=("$BUILT_PRODUCTS_DIR/gtest_unittest-framework"

40 #Now 
execu‹
 
—ch
 
Úe
 
š
 
tuº
 
k“pšg
 
Œack
 
of
 
how
 
mªy
 
sucûeded
 
ªd
 
çed
.

41 
sucûeded
=0

42 
çed
=0

43 
çed_li¡
=()

44 
‹¡
 
š
 
$
{
‹¡_execubËs
[*]}; do

46 
	g»suÉ
=
$
?

47 [ 
$»suÉ
 -
eq
 0 ]; 
th’


48 
	gsucûeded
=
$
(Ğ
$sucûeded
 + 1 ))

50 
çed
=
$
(( failed + 1 ))

51 
çed_li¡
="$failed_list $test"

52 
fi


53 
dÚe


55 #R•Üˆ
the
 
sucûs£s
 
ªd
 
çu»s
 
to
h
cÚsŞe
.

56 
echo
 "Tests complete with $succeeded successes‡nd $failed failures."

57 [ 
$çed
 -
Ã
 0 ]; 
th’


58 
	gecho
 "The followingests failed:"

59 
echo
 
$çed_li¡


60 
fi


61 
ex™
 
	g$çed


	@trunk/objs/gtest-1.6.0/xcode/Scripts/versiongenerate.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


2 #
#Cİyrighˆ2008, 
GoogË
 
Inc
.

3 #AÎ 
rights
 
»£rved
.

4 #
#Redi¡ributiÚ 
ªd
 
u£
 
š
 
sourû
‡nd 
bš¬y
 
fÜms
, 
w™h
 
Ü
 
w™hout


5 #modifiÿtiÚ, 
¬e
 
³rm™‹d
 
´ovided
 
th©
 
the
 
fŞlowšg
 
cÚd™iÚs
‡re

7 #
#* 
Redi¡ributiÚs
 
of
 
sourû
 
code
 
mu¡
 
»š
 
the
 
above
 
cİyright


8 #nÙiû, 
this
 
li¡
 
of
 
cÚd™iÚs
 
ªd
 
the
 
fŞlowšg
 
disşaim”
.

9 #* 
Redi¡ributiÚs
 
š
 
bš¬y
 
fÜm
 
mu¡
 
»´oduû
 
the
 
above


10 #cİyrighˆ
nÙiû
, 
this
 
li¡
 
of
 
cÚd™iÚs
 
ªd
 
the
 
fŞlowšg
 
disşaim”


11 #š 
the
 
docum’tiÚ
 
ªd
/
Ü
 
Ùh”
 
m©”Ÿls
 
´ovided
 
w™h
he

13 #* 
Ne™h”
 
the
 
Çme
 
of
 
GoogË
 
Inc
. 
nÜ
h
Çmes
 oà
™s


14 #cÚŒibutÜ 
may
 
be
 
u£d
 
to
 
’dÜ£
 
Ü
 
´omÙe
 
´oduùs
 
d”ived
 
äom


15 #thi 
soáw¬e
 
w™hout
 
¥ecific
 
´iÜ
 
wr™‹n
 
³rmissiÚ
.

16 #
#THIS 
SOFTWARE
 
IS
 
PROVIDED
 
BY
 
THE
 
COPYRIGHT
 
HOLDERS
 
AND
 
CONTRIBUTORS


17 #"
AS
 
IS
" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT

18 #LIMITED 
TO
, 
THE
 
IMPLIED
 
WARRANTIES
 
OF
 
MERCHANTABILITY
 
AND
 
FITNESS
 
FOR


19 #A 
PARTICULAR
 
PURPOSE
 
ARE
 
DISCLAIMED
. 
IN
 
NO
 
EVENT
 
SHALL
 
THE
 
COPYRIGHT


20 #OWNER 
OR
 
CONTRIBUTORS
 
BE
 
LIABLE
 
FOR
 
ANY
 
DIRECT
, 
INDIRECT
, 
INCIDENTAL
,

21 #SPECIAL, 
EXEMPLARY
, 
OR
 
CONSEQUENTIAL
 
DAMAGES
 (
INCLUDING
, 
BUT
 
NOT


22 #LIMITED 
TO
, 
PROCUREMENT
 
OF
 
SUBSTITUTE
 
GOODS
 
OR
 
SERVICES
; 
LOSS
 OF 
USE
,

23 #DATA, 
OR
 
PROFITS
; OR 
BUSINESS
 
INTERRUPTION
è
HOWEVER
 
CAUSED
 
AND
 
ON
 
ANY


24 #THEORY 
OF
 
LIABILITY
, 
WHETHER
 
IN
 
CONTRACT
, 
STRICT
 LIABILITY, 
OR
 
TORT


25 #(
INCLUDING
 
NEGLIGENCE
 
OR
 
OTHERWISE
è
ARISING
 
IN
 
ANY
 
WAY
 
OUT
 
OF
 
THE
 
USE


26 #OF 
THIS
 
SOFTWARE
, 
EVEN
 
IF
 
ADVISED
 
OF
 
THE
 
POSSIBILITY
 OF 
SUCH
 
DAMAGE
.

30 
This
 
süt
 
exŒaùs
 
the
 
v”siÚ
 
šfÜm©iÚ
 
äom
h
	gcÚfigu»
.
ac
 
fe
 
ªd


31 
u£s
 
™
 
to
 
g’”©e
 
a
 
h—d”
 
fe
 
cÚššg
 
the
 
§me
 
	gšfÜm©iÚ
. 
	gThe


32 #defše 
š
 
this
 
h—d”
 
fe
 
wl
 
be
 
šşuded
 iÀ
duršg
 
the
 
g’”©iÚ
 
of


33 
the
 
	gInfo
.
¶i¡
 
of
h
	gäamewÜk
, 
givšg
h
cÜ»ù
 
v®ue
 
to
h
v”siÚ


34 
shown
 
š
 
the
 
	gFšd”
.

36 
This
 
süt
 
makes
 
the
 
fŞlowšg
 
	$assum±iÚs
 (
the£
 
¬e
 
çuÉs
 
of
 
the
 
süt
,

37 
nÙ
 
´obËms
 
w™h
 
the
 
AutocÚf
):

38 1. 
The
 
AC_INIT
 
maüo
 
wl
 
be
 
cÚšed
 
w™hš
 
the
 
fœ¡
 1024 
ch¬aù”s


39 
of
 
cÚfigu»
.
ac


40 2. 
The
 
v”siÚ
 
¡ršg
 
wl
 
be
 3 
š‹g”s
 
£·¿‹d
 
by
 
³riods
 
ªd
 will be

41 
su¼ounded
 
by
 
squ»
 
b¿ck‘s
, "[" 
ªd
 "]" (
e
.
g
. [1.0.1]). 
The
 
fœ¡


42 
£gm’t
 
»´e£Ás
 
the
 
majÜ
 
v”siÚ
,h
£cÚd
„•»£Á th
mšÜ


43 
v”siÚ
 
ªd
 
the
 
thœd
 
»´e£Ás
h
fix
 version.

44 3. 
No
 ")" 
ch¬aù”
 
exi¡s
 
b‘w“n
 
the
 
İ’šg
 "(" 
ªd
 
şosšg
 ")" 
of


45 
AC_INIT
, 
šşudšg
 
š
 
comm’ts
 
ªd
 
ch¬aù”
 
¡ršgs
.

48 
impÜt
 
sys


49 
impÜt
 
»


51 #R—d 
the
 
commªd
 
lše
 
	`¬gum’t
 (th
ouut
 
dœeùÜy
 
V”siÚ
.
h
)

52 ià(
	`Ën
(
sys
.
¬gv
) < 3):

53 
´št
 "Usage: versiongenerate.py input_dir output_dir"

54 
sys
.
	$ex™
(1)

56 
šput_dœ
 = 
sys
.
¬gv
[1]

57 
ouut_dœ
 = 
sys
.
¬gv
[2]

59 #R—d 
the
 
fœ¡
 1024 
ch¬aù”s
 
of
h
cÚfigu»
.
ac
 
fe


60 
cÚfig_fe
 = 
	`İ’
("%s/cÚfigu».ac" % 
šput_dœ
, 'r')

61 
bufãr_size
 = 1024

62 
İ’šg_¡ršg
 = 
cÚfig_fe
.
	$»ad
(
bufãr_size
)

63 
cÚfig_fe
.
	$şo£
()

65 #ExŒaù 
the
 
v”siÚ
 
¡ršg
 
äom
h
AC_INIT
 
maüo


66 #Th
fŞlowšg
 
š™_ex´essiÚ
 
m—ns
:

67 #ExŒaù 
th»e
 
š‹g”s
 
£·¿‹d
 
by
 
³riods
 
ªd
 
su¼ounded
 by 
squ»


68 #b¿ck‘s(
e
.
g
. "[1.0.1]"è
b‘w“n
 "AC_INIT(" 
ªd
 ")". 
Do
 
nÙ
 
be
 
g»edy


69 #(*? 
is
 
the
 
nÚ
-
g»edy
 
æag
è
sšû
 
th©
 
would
 
puÎ
 
š
 
ev”ythšg
 
b‘w“n


70 #th
fœ¡
 "(" 
ªd
 
the
 
Ï¡
 ")" 
š
h
fe
.

71 
v”siÚ_ex´essiÚ
 = 
»
.
	`compe
(
r
"AC_INIT\(.*?\[(\d+)\.(\d+)\.(\d+)\].*?\)",

72 
»
.
DOTALL
)

73 
v”siÚ_v®ues
 = 
v”siÚ_ex´essiÚ
.
	$£¬ch
(
İ’šg_¡ršg
)

74 
majÜ_v”siÚ
 = 
v”siÚ_v®ues
.
	$group
(1)

75 
mšÜ_v”siÚ
 = 
v”siÚ_v®ues
.
	$group
(2)

76 
fix_v”siÚ
 = 
v”siÚ_v®ues
.
	$group
(3)

78 #Wr™
the
 
v”siÚ
 
šfÜm©iÚ
 
to
 
a
 
h—d”
 
fe
Ø
be
 
šşuded
 
š
he

79 #Info.
¶i¡
 
fe
.

80 
fe_d©a
 = """//

90 
	#GTEST_VERSIONINFO_SHORT
 %
s
.%
	)
s

91 
	#GTEST_VERSIONINFO_LONG
 %
s
.%s.%
	)
s

94 
v”siÚ_fe
 = 
	`İ’
("%s/V”siÚ.h" % 
ouut_dœ
, 'w')

95 
v”siÚ_fe
.
	$wr™e
(
fe_d©a
)

96 
v”siÚ_fe
.
	`şo£
()

	@trunk/objs/nginx/html/forward/live/livestream.html

1 <
video
 
	gwidth
="640" 
height
="360"

2 
autİÏy
 
cÚŒŞs
 
autobufãr


3 
¤c
="livestream.m3u8"

4 
ty³
="application/vnd.apple.mpegurl">

5 </
video
>

	@trunk/objs/nginx/html/forward/live/livestream_ld.html

1 <
video
 
	gwidth
="640" 
height
="360"

2 
autİÏy
 
cÚŒŞs
 
autobufãr


3 
¤c
="livestream_ld.m3u8"

4 
ty³
="application/vnd.apple.mpegurl">

5 </
video
>

	@trunk/objs/nginx/html/forward/live/livestream_sd.html

1 <
video
 
	gwidth
="640" 
height
="360"

2 
autİÏy
 
cÚŒŞs
 
autobufãr


3 
¤c
="livestream_sd.m3u8"

4 
ty³
="application/vnd.apple.mpegurl">

5 </
video
>

	@trunk/objs/nginx/html/index.html

1 <!
DOCTYPE
 
	ghtml
>

2 <
	ghtml
>

3 <
	gh—d
>

4 <
	gt™Ë
>
	gSRS
</title>

5 <
m‘a
 
	gch¬£t
="utf-8">

6 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="players/js/jquery-1.10.2.min.js"></script>

7 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="players/js/srs.page.js"></script>

8 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="players/js/srs.utility.js"></script>

9 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="players/js/winlin.utility.js"></script>

10 </
h—d
>

11 <
body
>

12 <
süt
 
ty³
="text/javascript">

13 
£tTimeout
(
	$funùiÚ
(){

14 
wšdow
.
loÿtiÚ
.
h»f
 = "¶ay”s/šdex.html" + wšdow.loÿtiÚ.
£¬ch
;

15 
	}
}, 500);

16 </
	gsüt
>

17 </
	gbody
>

	@trunk/objs/nginx/html/live/demo.html

1 <
video
 
	gwidth
="640" 
height
="360"

2 
autİÏy
 
cÚŒŞs
 
autobufãr


3 
¤c
="demo.m3u8"

4 
ty³
="application/vnd.apple.mpegurl">

5 </
video
>

	@trunk/objs/nginx/html/live/livestream.html

1 <
video
 
	gwidth
="640" 
height
="360"

2 
autİÏy
 
cÚŒŞs
 
autobufãr


3 
¤c
="livestream.m3u8"

4 
ty³
="application/vnd.apple.mpegurl">

5 </
video
>

	@trunk/objs/nginx/html/live/livestream_ld.html

1 <
video
 
	gwidth
="640" 
height
="360"

2 
autİÏy
 
cÚŒŞs
 
autobufãr


3 
¤c
="livestream_ld.m3u8"

4 
ty³
="application/vnd.apple.mpegurl">

5 </
video
>

	@trunk/objs/nginx/html/live/livestream_sd.html

1 <
video
 
	gwidth
="640" 
height
="360"

2 
autİÏy
 
cÚŒŞs
 
autobufãr


3 
¤c
="livestream_sd.m3u8"

4 
ty³
="application/vnd.apple.mpegurl">

5 </
video
>

	@trunk/objs/nginx/html/nginx.html

1 
ngšx
 
is
 
	gok


	@trunk/objs/openssl-1.0.1f/_release/ssl/misc/CA.sh

1 #!/
bš
/
sh


2 #
#CA - 
w¿µ”
 
¬ound
 
ÿ
 
to
 
make
 
™
 
—s›r
Ø
u£
 ... 
basiÿÎy
 c¨
»quœes


3 #som
£tup
 
¡uff
 
to
 
be
 
dÚe
 
befÜe
 
you
 
ÿn
 
u£
 
™
 
ªd
 
this
 
makes


4 #thšg 
—s›r
 
b‘w“n
 
now
 
ªd
 
wh’
 
Eric
 
is
 
cÚvšûd
 
to
 
fix
 
™
 :-)

5 #
#CA -
Ãwÿ
 ... 
wl
 
£tup
 
the
 
right
 
¡uff


6 #CA -
Ãw»q
 ... 
wl
 
g’”©e
 
a
 
û¹ifiÿ‹
 
»que¡


7 #CA -
sign
 ... 
wl
 sigÀ
the
 
g’”©ed
 
»que¡
 
ªd
 
ouut


8 #
#Aˆ
the
 
’d
 
of
 
th©
 
g¿b
 
Ãw»q
.
³m
 
ªd
 
Ãwû¹
.³m (
Úe
 
has
h
key


9 #ªd 
the
 
Ùh”
h
û¹ifiÿ‹
è
ªd
 
ÿt
 
them
 
tog‘h”
‡nd 
th©
 
is
 
wh©


10 #you 
wªt
/
Ãed
 ... 
I
'll makeƒvenhis‡†ittle cleaner†ater.

11 #
#
#12-
Jª
-96 
tjh
 
Added
 
mÜe
 
thšgs
 ... 
šşudšg
 
CA
 -
signû¹
 
which


12 #cÚv”t 
a
 
û¹ifiÿ‹
 
to
‡ 
»que¡
 
ªd
 
th’
 
signs
 
™
.

13 #10-
Jª
-96 
—y
 
Fixed
 
a
 
ãw
 
mÜe
 
bugs
 
ªd
 
added
 
the
 
SSLEAY_CONFIG


14 #’vœÚm’ˆ
v¬ŸbË
 
so
 
this
 
ÿn
 
be
 
driv’
 
äom


15 #¨
süt
.

16 #25-
Jul
-96 
—y
 
CËªed
 
up
 
f’ames
 
some
 
mÜe
.

17 #11-
Jun
-96 
—y
 
Fixed
 
a
 
ãw
 
f’ame
 
missm©ches
.

18 #03-
May
-96 
—y
 
Modif›d
 
to
 
u£
 's¦—y cmd' 
š¡—d
 
of
 'cmd'.

19 #18-
A´
-96 
tjh
 
Origš®
 
hackšg


20 #
#Tim 
HudsÚ


21 #tjh@
üy±soá
.
com


23 #deçuÉ 
İ’s¦
.
úf
 
fe
 
has
 
£tup
 
as
 
³r
 
the
 
fŞlowšg


24 #demoCA ... 
wh”e
 
ev”ythšg
 
is
 
¡Üed


25 
	$ı_³m
() {

26 
šfe
=
$1


27 
outfe
=
$2


28 
bound
=
$3


29 
æag
=0

30 
exec
 <
$šfe
;

31 
»ad
 
lše
; do

32 [ 
$æag
 -
eq
 1 ]; 
th’


33 
echo
 
$lše
|
g»p
 "^-----END.*$bound" 2>/
dev
/
nuÎ
 1>/dev/null

34 [ 
$
? -
eq
 0 ] ; 
th’


35 
echo
 
$lše
 >>
$outfe


38 
echo
 
$lše
 >>
$outfe


39 
fi


40 
fi


42 
echo
 
$lše
|
g»p
 "^-----BEGIN.*$bound" 2>/
dev
/
nuÎ
 1>/dev/null

43 [ 
$
? -
eq
 0 ]; 
th’


44 
echo
 
$lše
 >
$outfe


45 
æag
=1

46 
fi


47 
dÚe


48 
	}
}

50 
	$u§ge
() {

51 
echo
 "usage: $0 -newcert|-newreq|-newreq-nodes|-newca|-sign|-verify" >&2

52 
	}
}

54 [ -
z
 "$OPENSSL" ]; 
th’
 
	gOPENSSL
=
İ’s¦
; 
fi


56 [ -
z
 "$DAYS" ] ; 
th’
 
	gDAYS
="-day 365" ; 
	gfi
 #1 
y—r


57 
	gCADAYS
="-day 1095" #3 
y—rs


58 
REQ
="$OPENSSL„eq $SSLEAY_CONFIG"

59 
CA
="$OPENSSL ca $SSLEAY_CONFIG"

60 
VERIFY
="$OPENSSL verify"

61 
X509
="$OPENSSL x509"

62 
PKCS12
="openssl…kcs12"

64 [ -
z
 "$CATOP" ] ; 
th’
 
	gCATOP
=./
demoCA
 ; 
fi


65 
	gCAKEY
=./
ÿkey
.
³m


66 
CAREQ
=./
ÿ»q
.
³m


67 
CACERT
=./
ÿû¹
.
³m


69 
RET
=0

72 
$1
 
	gš


73 -\?|-
	gh
|-
	gh–p
)

74 
u§ge


75 
	gex™
 0

77 -
	gÃwû¹
)

78 #ü—‹ 
a
 
û¹ifiÿ‹


79 
	g$REQ
 -
	gÃw
 -
	gx509
 -
keyout
 
	gÃwkey
.
	g³m
 -
out
 
	gÃwû¹
.
³m
 
$DAYS


80 
	gRET
=
$
?

81 
echo
 "Certificate is in‚ewcert.pem,…rivate key is in‚ewkey.pem"

83 -
	gÃw»q
)

84 #ü—‹ 
a
 
û¹ifiÿ‹
 
»que¡


85 
	g$REQ
 -
	gÃw
 -
keyout
 
	gÃwkey
.
	g³m
 -
out
 
	gÃw»q
.
³m
 
$DAYS


86 
	gRET
=
$
?

87 
echo
 "Request is in‚ewreq.pem,…rivate key is in‚ewkey.pem"

89 -
	gÃw»q
-
	gnodes
)

90 #ü—‹ 
a
 
û¹ifiÿ‹
 
»que¡


91 
	g$REQ
 -
	gÃw
 -
	gnodes
 -
keyout
 
	gÃw»q
.
	g³m
 -
out
‚ew»q.
³m
 
$DAYS


92 
	gRET
=
$
?

93 
echo
 "Request (and…rivate key) is in‚ewreq.pem"

95 -
	gÃwÿ
)

96 #ià
ex¶ic™ly
 
asked
 
Ü
 
™
 
dÛ¢
'tƒxisthen setuphe directory

97 #¡ruùu» 
th©
 
Eric
 
likes
 
to
 
mªage
 
thšgs


98 
	gNEW
="1"

99 [ "$NEW" -
o
 ! -
f
 
$
{
CATOP
}/
£rŸl
 ]; 
	gth’


100 #ü—‹ 
the
 
dœeùÜy
 
h›¿rchy


101 
	gmkdœ
 -
p
 
	g$
{
	gCATOP
}

102 
	gmkdœ
 -
p
 
	g$
{
	gCATOP
}/
û¹s


103 
	gmkdœ
 -
p
 
	g$
{
	gCATOP
}/
ül


104 
	gmkdœ
 -
p
 
	g$
{
	gCATOP
}/
Ãwû¹s


105 
	gmkdœ
 -
p
 
	g$
{
	gCATOP
}/
´iv©e


106 
touch
 
	g$
{
	gCATOP
}/
	gšdex
.
txt


107 
fi


108 [ ! -
f
 
$
{
CATOP
}/
´iv©e
/
$CAKEY
 ]; 
th’


109 
	gecho
 "CA certificate filename (orƒntero create)"

110 
»ad
 
	gFILE


112 #ask 
u£r
 
exi¡šg
 
CA
 
û¹ifiÿ‹


113 [ "$FILE" ]; 
th’


114 
ı_³m
 
$FILE
 
	g$
{
	gCATOP
}/
	g´iv©e
/
$CAKEY
 
PRIVATE


115 
ı_³m
 
$FILE
 
	g$
{
	gCATOP
}/
$CACERT
 
CERTIFICATE


116 
	gRET
=
$
?

117 [ ! -
f
 "${CATOP}/£rŸl" ]; 
th’


118 
	g$X509
 -
š
 
	g$
{
	gCATOP
}/
	g$CACERT
 -
	gnoout
 -
	gÃxt_£rŸl
 \

119 -
out
 
	g$
{
	gCATOP
}/
£rŸl


120 
fi


122 
	gecho
 "Making CA certificate ..."

123 
	g$REQ
 -
	gÃw
 -
keyout
 
	g$
{
	gCATOP
}/
	g´iv©e
/
	g$CAKEY
 \

124 -
out
 
	g$
{
	gCATOP
}/
$CAREQ


125 
	g$CA
 -
	gü—‹_£rŸl
 -
out
 
	g$
{
	gCATOP
}/
$CACERT
 
	g$CADAYS
 -
	gb©ch
 \

126 -
keyfe
 
	g$
{
	gCATOP
}/
	g´iv©e
/
	g$CAKEY
 -
	g£lfsign
 \

127 -
ex‹nsiÚs
 
	gv3_ÿ
 \

128 -
šfes
 
	g$
{
	gCATOP
}/
$CAREQ


129 
	gRET
=
$
?

130 
fi


131 
fi


133 -
	gxsign
)

134 
	g$CA
 -
pŞicy
 
	gpŞicy_ªythšg
 -
šfes
 
	gÃw»q
.
³m


135 
	gRET
=
$
?

137 -
	gpkcs12
)

138 [ -
z
 "$2" ] ; 
th’


139 
	gCNAME
="My Certificate"

141 
CNAME
="$2"

142 
fi


143 
$PKCS12
 -
š
 
Ãwû¹
.
³m
 -
škey
 
Ãw»q
.³m -
û¹fe
 
$
{
CATOP
}/
$CACERT
 \

144 -
out
 
Ãwû¹
.
p12
 -
expÜt
 -
Çme
 "$CNAME"

145 
RET
=
$
?

146 
ex™
 
$RET


148 -
	gsign
|-
	gsigÄeq
)

149 
	g$CA
 -
pŞicy
 
	gpŞicy_ªythšg
 -
out
 
	gÃwû¹
.
	g³m
 -
šfes
 
	gÃw»q
.
³m


150 
	gRET
=
$
?

151 
ÿt
 
Ãwû¹
.
³m


152 
echo
 "Signed certificate is in‚ewcert.pem"

154 -
	gsignCA
)

155 
	g$CA
 -
pŞicy
 
	gpŞicy_ªythšg
 -
out
 
	gÃwû¹
.
	g³m
 -
ex‹nsiÚs
 
	gv3_ÿ
 -
šfes
 
	gÃw»q
.
³m


156 
	gRET
=
$
?

157 
echo
 "Signed CA certificate is in‚ewcert.pem"

159 -
	gsignû¹
)

160 
	gecho
 "Cert…assphrase will be„equestedwice - bug?"

161 
	g$X509
 -
	gx509tÜeq
 -
š
 
	gÃw»q
.
	g³m
 -
signkey
‚ew»q.³m -
out
 
	gtmp
.
³m


162 
	g$CA
 -
pŞicy
 
	gpŞicy_ªythšg
 -
out
 
	gÃwû¹
.
	g³m
 -
šfes
 
	gtmp
.
³m


163 
	gRET
=
$
?

164 
ÿt
 
Ãwû¹
.
³m


165 
echo
 "Signed certificate is in‚ewcert.pem"

167 -
	gv”ify
)

168 
shiá


169 [ -
z
 "$1" ]; 
th’


170 
	g$VERIFY
 -
CAfe
 
	g$CATOP
/
$CACERT
 
	gÃwû¹
.
³m


171 
	gRET
=
$
?

173 
j


175 
$VERIFY
 -
CAfe
 
$CATOP
/
$CACERT
 
$j


176 [ 
$
? !ğ0 ]; 
th’


177 
	gRET
=
$
?

178 
fi


179 
dÚe


180 
fi


181 
ex™
 
$RET


184 
	gecho
 "Unknown‡rg $i" >&2

185 
u§ge


186 
	gex™
 1

188 
e§c


189 
shiá


190 
dÚe


191 
ex™
 
	g$RET


	@trunk/objs/openssl-1.0.1f/apps/CA.sh

1 #!/
bš
/
sh


2 #
#CA - 
w¿µ”
 
¬ound
 
ÿ
 
to
 
make
 
™
 
—s›r
Ø
u£
 ... 
basiÿÎy
 c¨
»quœes


3 #som
£tup
 
¡uff
 
to
 
be
 
dÚe
 
befÜe
 
you
 
ÿn
 
u£
 
™
 
ªd
 
this
 
makes


4 #thšg 
—s›r
 
b‘w“n
 
now
 
ªd
 
wh’
 
Eric
 
is
 
cÚvšûd
 
to
 
fix
 
™
 :-)

5 #
#CA -
Ãwÿ
 ... 
wl
 
£tup
 
the
 
right
 
¡uff


6 #CA -
Ãw»q
 ... 
wl
 
g’”©e
 
a
 
û¹ifiÿ‹
 
»que¡


7 #CA -
sign
 ... 
wl
 sigÀ
the
 
g’”©ed
 
»que¡
 
ªd
 
ouut


8 #
#Aˆ
the
 
’d
 
of
 
th©
 
g¿b
 
Ãw»q
.
³m
 
ªd
 
Ãwû¹
.³m (
Úe
 
has
h
key


9 #ªd 
the
 
Ùh”
h
û¹ifiÿ‹
è
ªd
 
ÿt
 
them
 
tog‘h”
‡nd 
th©
 
is
 
wh©


10 #you 
wªt
/
Ãed
 ... 
I
'll makeƒvenhis‡†ittle cleaner†ater.

11 #
#
#12-
Jª
-96 
tjh
 
Added
 
mÜe
 
thšgs
 ... 
šşudšg
 
CA
 -
signû¹
 
which


12 #cÚv”t 
a
 
û¹ifiÿ‹
 
to
‡ 
»que¡
 
ªd
 
th’
 
signs
 
™
.

13 #10-
Jª
-96 
—y
 
Fixed
 
a
 
ãw
 
mÜe
 
bugs
 
ªd
 
added
 
the
 
SSLEAY_CONFIG


14 #’vœÚm’ˆ
v¬ŸbË
 
so
 
this
 
ÿn
 
be
 
driv’
 
äom


15 #¨
süt
.

16 #25-
Jul
-96 
—y
 
CËªed
 
up
 
f’ames
 
some
 
mÜe
.

17 #11-
Jun
-96 
—y
 
Fixed
 
a
 
ãw
 
f’ame
 
missm©ches
.

18 #03-
May
-96 
—y
 
Modif›d
 
to
 
u£
 's¦—y cmd' 
š¡—d
 
of
 'cmd'.

19 #18-
A´
-96 
tjh
 
Origš®
 
hackšg


20 #
#Tim 
HudsÚ


21 #tjh@
üy±soá
.
com


23 #deçuÉ 
İ’s¦
.
úf
 
fe
 
has
 
£tup
 
as
 
³r
 
the
 
fŞlowšg


24 #demoCA ... 
wh”e
 
ev”ythšg
 
is
 
¡Üed


25 
	$ı_³m
() {

26 
šfe
=
$1


27 
outfe
=
$2


28 
bound
=
$3


29 
æag
=0

30 
exec
 <
$šfe
;

31 
»ad
 
lše
; do

32 [ 
$æag
 -
eq
 1 ]; 
th’


33 
echo
 
$lše
|
g»p
 "^-----END.*$bound" 2>/
dev
/
nuÎ
 1>/dev/null

34 [ 
$
? -
eq
 0 ] ; 
th’


35 
echo
 
$lše
 >>
$outfe


38 
echo
 
$lše
 >>
$outfe


39 
fi


40 
fi


42 
echo
 
$lše
|
g»p
 "^-----BEGIN.*$bound" 2>/
dev
/
nuÎ
 1>/dev/null

43 [ 
$
? -
eq
 0 ]; 
th’


44 
echo
 
$lše
 >
$outfe


45 
æag
=1

46 
fi


47 
dÚe


48 
	}
}

50 
	$u§ge
() {

51 
echo
 "usage: $0 -newcert|-newreq|-newreq-nodes|-newca|-sign|-verify" >&2

52 
	}
}

54 [ -
z
 "$OPENSSL" ]; 
th’
 
	gOPENSSL
=
İ’s¦
; 
fi


56 [ -
z
 "$DAYS" ] ; 
th’
 
	gDAYS
="-day 365" ; 
	gfi
 #1 
y—r


57 
	gCADAYS
="-day 1095" #3 
y—rs


58 
REQ
="$OPENSSL„eq $SSLEAY_CONFIG"

59 
CA
="$OPENSSL ca $SSLEAY_CONFIG"

60 
VERIFY
="$OPENSSL verify"

61 
X509
="$OPENSSL x509"

62 
PKCS12
="openssl…kcs12"

64 [ -
z
 "$CATOP" ] ; 
th’
 
	gCATOP
=./
demoCA
 ; 
fi


65 
	gCAKEY
=./
ÿkey
.
³m


66 
CAREQ
=./
ÿ»q
.
³m


67 
CACERT
=./
ÿû¹
.
³m


69 
RET
=0

72 
$1
 
	gš


73 -\?|-
	gh
|-
	gh–p
)

74 
u§ge


75 
	gex™
 0

77 -
	gÃwû¹
)

78 #ü—‹ 
a
 
û¹ifiÿ‹


79 
	g$REQ
 -
	gÃw
 -
	gx509
 -
keyout
 
	gÃwkey
.
	g³m
 -
out
 
	gÃwû¹
.
³m
 
$DAYS


80 
	gRET
=
$
?

81 
echo
 "Certificate is in‚ewcert.pem,…rivate key is in‚ewkey.pem"

83 -
	gÃw»q
)

84 #ü—‹ 
a
 
û¹ifiÿ‹
 
»que¡


85 
	g$REQ
 -
	gÃw
 -
keyout
 
	gÃwkey
.
	g³m
 -
out
 
	gÃw»q
.
³m
 
$DAYS


86 
	gRET
=
$
?

87 
echo
 "Request is in‚ewreq.pem,…rivate key is in‚ewkey.pem"

89 -
	gÃw»q
-
	gnodes
)

90 #ü—‹ 
a
 
û¹ifiÿ‹
 
»que¡


91 
	g$REQ
 -
	gÃw
 -
	gnodes
 -
keyout
 
	gÃw»q
.
	g³m
 -
out
‚ew»q.
³m
 
$DAYS


92 
	gRET
=
$
?

93 
echo
 "Request (and…rivate key) is in‚ewreq.pem"

95 -
	gÃwÿ
)

96 #ià
ex¶ic™ly
 
asked
 
Ü
 
™
 
dÛ¢
'tƒxisthen setuphe directory

97 #¡ruùu» 
th©
 
Eric
 
likes
 
to
 
mªage
 
thšgs


98 
	gNEW
="1"

99 [ "$NEW" -
o
 ! -
f
 
$
{
CATOP
}/
£rŸl
 ]; 
	gth’


100 #ü—‹ 
the
 
dœeùÜy
 
h›¿rchy


101 
	gmkdœ
 -
p
 
	g$
{
	gCATOP
}

102 
	gmkdœ
 -
p
 
	g$
{
	gCATOP
}/
û¹s


103 
	gmkdœ
 -
p
 
	g$
{
	gCATOP
}/
ül


104 
	gmkdœ
 -
p
 
	g$
{
	gCATOP
}/
Ãwû¹s


105 
	gmkdœ
 -
p
 
	g$
{
	gCATOP
}/
´iv©e


106 
touch
 
	g$
{
	gCATOP
}/
	gšdex
.
txt


107 
fi


108 [ ! -
f
 
$
{
CATOP
}/
´iv©e
/
$CAKEY
 ]; 
th’


109 
	gecho
 "CA certificate filename (orƒntero create)"

110 
»ad
 
	gFILE


112 #ask 
u£r
 
exi¡šg
 
CA
 
û¹ifiÿ‹


113 [ "$FILE" ]; 
th’


114 
ı_³m
 
$FILE
 
	g$
{
	gCATOP
}/
	g´iv©e
/
$CAKEY
 
PRIVATE


115 
ı_³m
 
$FILE
 
	g$
{
	gCATOP
}/
$CACERT
 
CERTIFICATE


116 
	gRET
=
$
?

117 [ ! -
f
 "${CATOP}/£rŸl" ]; 
th’


118 
	g$X509
 -
š
 
	g$
{
	gCATOP
}/
	g$CACERT
 -
	gnoout
 -
	gÃxt_£rŸl
 \

119 -
out
 
	g$
{
	gCATOP
}/
£rŸl


120 
fi


122 
	gecho
 "Making CA certificate ..."

123 
	g$REQ
 -
	gÃw
 -
keyout
 
	g$
{
	gCATOP
}/
	g´iv©e
/
	g$CAKEY
 \

124 -
out
 
	g$
{
	gCATOP
}/
$CAREQ


125 
	g$CA
 -
	gü—‹_£rŸl
 -
out
 
	g$
{
	gCATOP
}/
$CACERT
 
	g$CADAYS
 -
	gb©ch
 \

126 -
keyfe
 
	g$
{
	gCATOP
}/
	g´iv©e
/
	g$CAKEY
 -
	g£lfsign
 \

127 -
ex‹nsiÚs
 
	gv3_ÿ
 \

128 -
šfes
 
	g$
{
	gCATOP
}/
$CAREQ


129 
	gRET
=
$
?

130 
fi


131 
fi


133 -
	gxsign
)

134 
	g$CA
 -
pŞicy
 
	gpŞicy_ªythšg
 -
šfes
 
	gÃw»q
.
³m


135 
	gRET
=
$
?

137 -
	gpkcs12
)

138 [ -
z
 "$2" ] ; 
th’


139 
	gCNAME
="My Certificate"

141 
CNAME
="$2"

142 
fi


143 
$PKCS12
 -
š
 
Ãwû¹
.
³m
 -
škey
 
Ãw»q
.³m -
û¹fe
 
$
{
CATOP
}/
$CACERT
 \

144 -
out
 
Ãwû¹
.
p12
 -
expÜt
 -
Çme
 "$CNAME"

145 
RET
=
$
?

146 
ex™
 
$RET


148 -
	gsign
|-
	gsigÄeq
)

149 
	g$CA
 -
pŞicy
 
	gpŞicy_ªythšg
 -
out
 
	gÃwû¹
.
	g³m
 -
šfes
 
	gÃw»q
.
³m


150 
	gRET
=
$
?

151 
ÿt
 
Ãwû¹
.
³m


152 
echo
 "Signed certificate is in‚ewcert.pem"

154 -
	gsignCA
)

155 
	g$CA
 -
pŞicy
 
	gpŞicy_ªythšg
 -
out
 
	gÃwû¹
.
	g³m
 -
ex‹nsiÚs
 
	gv3_ÿ
 -
šfes
 
	gÃw»q
.
³m


156 
	gRET
=
$
?

157 
echo
 "Signed CA certificate is in‚ewcert.pem"

159 -
	gsignû¹
)

160 
	gecho
 "Cert…assphrase will be„equestedwice - bug?"

161 
	g$X509
 -
	gx509tÜeq
 -
š
 
	gÃw»q
.
	g³m
 -
signkey
‚ew»q.³m -
out
 
	gtmp
.
³m


162 
	g$CA
 -
pŞicy
 
	gpŞicy_ªythšg
 -
out
 
	gÃwû¹
.
	g³m
 -
šfes
 
	gtmp
.
³m


163 
	gRET
=
$
?

164 
ÿt
 
Ãwû¹
.
³m


165 
echo
 "Signed certificate is in‚ewcert.pem"

167 -
	gv”ify
)

168 
shiá


169 [ -
z
 "$1" ]; 
th’


170 
	g$VERIFY
 -
CAfe
 
	g$CATOP
/
$CACERT
 
	gÃwû¹
.
³m


171 
	gRET
=
$
?

173 
j


175 
$VERIFY
 -
CAfe
 
$CATOP
/
$CACERT
 
$j


176 [ 
$
? !ğ0 ]; 
th’


177 
	gRET
=
$
?

178 
fi


179 
dÚe


180 
fi


181 
ex™
 
$RET


184 
	gecho
 "Unknown‡rg $i" >&2

185 
u§ge


186 
	gex™
 1

188 
e§c


189 
shiá


190 
dÚe


191 
ex™
 
	g$RET


	@trunk/objs/openssl-1.0.1f/crypto/threads/profile.sh

1 #!/
bš
/
sh


2 /
	gbš
/
	grm
 -
f
 
m‰e¡


3 
	gcc
 -
	gp
 -
	gDSOLARIS
 -
	gI
../../
	gšşude
 -
g
 
	gm‰e¡
.
	gc
 -
o
 m‰e¡ -
	gL
/
	gu¤
/
	glib
/
	glibc
 -
	gldl
 -L../.. -
	gÉh»ad
 -
	gls¦
 -
	glüy±o
 -
	gÊ¦
 -
	glsock‘


	@trunk/objs/openssl-1.0.1f/crypto/threads/pthread.sh

1 #!/
bš
/
sh


2 #
#bud 
usšg
 
±h»ads


4 #
/
bš
/
rm
 -
f
 
m‰e¡


5 
	gpgcc
 -
	gDPTHREADS
 -
	gI
../../
	gšşude
 -
g
 
	gm‰e¡
.
	gc
 -
o
 m‰e¡ -
	gL
../.. -
	gls¦
 -
	glüy±o


	@trunk/objs/openssl-1.0.1f/crypto/threads/pthread2.sh

1 #!/
bš
/
sh


2 #
#bud 
usšg
 
±h»ads
 
wh”e
 
™
's‡lready built intohe system

3 #
/
bš
/
rm
 -
f
 
m‰e¡


4 
	ggcc
 -
	gDPTHREADS
 -
	gI
../../
	gšşude
 -
g
 
	gm‰e¡
.
	gc
 -
o
 m‰e¡ -
	gL
../.. -
	gls¦
 -
	glüy±o
 -
	gÍth»ad


	@trunk/objs/openssl-1.0.1f/crypto/threads/purify.sh

1 #!/
bš
/
sh


2 /
	gbš
/
	grm
 -
f
 
m‰e¡


3 
purify
 
	gcc
 -
	gDSOLARIS
 -
	gI
../../
	gšşude
 -
g
 
	gm‰e¡
.
	gc
 -
o
 m‰e¡ -
	gL
../.. -
	gÉh»ad
 -
	gls¦
 -
	glüy±o
 -
	gÊ¦
 -
	glsock‘


	@trunk/objs/openssl-1.0.1f/crypto/threads/solaris.sh

1 #!/
bš
/
sh


2 /
	gbš
/
	grm
 -
f
 
m‰e¡


3 
	gcc
 -
	gDSOLARIS
 -
	gI
../../
	gšşude
 -
g
 
	gm‰e¡
.
	gc
 -
o
 m‰e¡ -
	gL
../.. -
	gÉh»ad
 -
	gls¦
 -
	glüy±o
 -
	gÊ¦
 -
	glsock‘


	@trunk/objs/openssl-1.0.1f/demos/ssltest-ecc/ECC-RSAcertgen.sh

1 #!/
bš
/
sh


3 #FÜ 
a
 
li¡
 
of
 
suµÜ‹d
 
curves
, 
u£
 "apps/opensslƒcparam -list_curves".

5 #P©h 
to
 
the
 
İ’s¦
 
di¡ributiÚ


6 
	gOPENSSL_DIR
=../..

7 #P©h 
to
 
the
 
İ’s¦
 
´og¿m


8 
OPENSSL_CMD
=
$OPENSSL_DIR
/
­ps
/
İ’s¦


9 #O±iÚ 
to
 
fšd
 
cÚfigu¿tiÚ
 
fe


10 
OPENSSL_CNF
="-config $OPENSSL_DIR/apps/openssl.cnf"

11 #DœeùÜy 
wh”e
 
û¹ifiÿ‹s
 
¬e
 
¡Üed


12 
CERTS_DIR
=./
C”ts


13 #DœeùÜy 
wh”e
 
´iv©e
 
key
 
fes
 
¬e
 
¡Üed


14 
KEYS_DIR
=
$CERTS_DIR


15 #DœeùÜy 
wh”e
 
combo
 
fes
 (
cÚššg
 
a
 
û¹ifiÿ‹
 
ªd
 
cÜ»¥Údšg


16 #´iv©
key
 
tog‘h”
è
¬e
 
¡Üed


17 
COMBO_DIR
=
$CERTS_DIR


18 #ÿˆ
commªd


19 
CAT
=/
bš
/
ÿt


20 #rm 
commªd


21 
RM
=/
bš
/
rm


22 #mkdœ 
commªd


23 
MKDIR
=/
bš
/
mkdœ


24 #Th
û¹ifiÿ‹
 
wl
 
expœe
 
the£
 
mªy
 
days
 
aá”
 
the
 
issue
 
d©e
.

25 
DAYS
=1500

26 
TEST_CA_FILE
=
r§1024Te¡CA


28 
TEST_SERVER_CURVE
=
£ù163r1


29 
TEST_SERVER_FILE
=
£ù163r1
-
r§Te¡S”v”


30 
TEST_SERVER_DN
="/C=US/ST=CA/L=Mountain View/O=Sun Microsystems, Inc./OU=Sun Microsystems Laboratories/CN=Test Server (sect163r1 key signed with RSA)"

32 
TEST_CLIENT_CURVE
=
£ù163r1


33 
TEST_CLIENT_FILE
=
£ù163r1
-
r§Te¡Cl›Á


34 
TEST_CLIENT_DN
="/C=US/ST=CA/L=Mountain View/O=Sun Microsystems, Inc./OU=Sun Microsystems Laboratories/CN=Test Client (sect163r1 key signed with RSA)"

36 #G’”©šg 
ª
 
EC
 
û¹ifiÿ‹
 
švŞves
 
the
 
fŞlowšg
 
maš
 
¡•s


37 #1. 
G’”©šg
 
curve
 
·¿m‘”s
 (
Ãeded
)

38 #2. 
G’”©šg
 
a
 
û¹ifiÿ‹
 
»que¡


39 #3. 
Signšg
 
the
 
û¹ifiÿ‹
 
»que¡


40 #4. [
O±iÚ®
] 
OÃ
 
ÿn
 
combše
 
the
 
û¹
 
ªd
 
´iv©e
 
key
 
što
 
a
 
sšgË


41 #f
ªd
 
®so
 
d–‘e
 
the
 
û¹ifiÿ‹
 
»que¡


43 
$MKDIR
 -
p
 
$CERTS_DIR


44 
$MKDIR
 -
p
 
$KEYS_DIR


45 
$MKDIR
 -
p
 
$COMBO_DIR


47 
echo
 "GENERATING A TEST SERVER CERTIFICATE (ECC key signed with RSA)"

48 
echo
 "=============================================================="

49 
$OPENSSL_CMD
 
eı¬am
 -
Çme
 
$TEST_SERVER_CURVE
 -
out
 $TEST_SERVER_CURVE.
³m


51 
$OPENSSL_CMD
 
»q
 
$OPENSSL_CNF
 -
nodes
 -
subj
 "$TEST_SERVER_DN" \

52 -
keyout
 
$KEYS_DIR
/
$TEST_SERVER_FILE
.
key
.
³m
 \

53 -
Ãwkey
 
ec
:
$TEST_SERVER_CURVE
.
³m
 -
Ãw
 \

54 -
out
 
$CERTS_DIR
/
$TEST_SERVER_FILE
.
»q
.
³m


56 
$OPENSSL_CMD
 
x509
 -
»q
 -
days
 
$DAYS
 \

57 -
š
 
$CERTS_DIR
/
$TEST_SERVER_FILE
.
»q
.
³m
 \

58 -
CA
 
$CERTS_DIR
/
$TEST_CA_FILE
.
û¹
.
³m
 \

59 -
CAkey
 
$KEYS_DIR
/
$TEST_CA_FILE
.
key
.
³m
 \

60 -
out
 
$CERTS_DIR
/
$TEST_SERVER_FILE
.
û¹
.
³m
 -
CAü—‹£rŸl


62 #Di¥Ïy 
the
 
û¹ifiÿ‹


63 
$OPENSSL_CMD
 
x509
 -
š
 
$CERTS_DIR
/
$TEST_SERVER_FILE
.
û¹
.
³m
 -
‹xt


65 #PÏû 
the
 
û¹ifiÿ‹
 
ªd
 
key
 
š
 
a
 
commÚ
 
fe


66 
$OPENSSL_CMD
 
x509
 -
š
 
$CERTS_DIR
/
$TEST_SERVER_FILE
.
û¹
.
³m
 -
issu”
 -
subjeù
 \

67 > 
$COMBO_DIR
/
$TEST_SERVER_FILE
.
³m


68 
$CAT
 
$KEYS_DIR
/
$TEST_SERVER_FILE
.
key
.
³m
 >> 
$COMBO_DIR
/$TEST_SERVER_FILE.pem

70 #Remov
the
 
û¹
 
»que¡
 
fe
 (
no
 
lÚg”
 
Ãeded
)

71 
$RM
 
$CERTS_DIR
/
$TEST_SERVER_FILE
.
»q
.
³m


73 
echo
 "GENERATING A TEST CLIENT CERTIFICATE (ECC key signed with RSA)"

74 
echo
 "=============================================================="

75 
$OPENSSL_CMD
 
eı¬am
 -
Çme
 
$TEST_CLIENT_CURVE
 -
out
 $TEST_CLIENT_CURVE.
³m


77 
$OPENSSL_CMD
 
»q
 
$OPENSSL_CNF
 -
nodes
 -
subj
 "$TEST_CLIENT_DN" \

78 -
keyout
 
$KEYS_DIR
/
$TEST_CLIENT_FILE
.
key
.
³m
 \

79 -
Ãwkey
 
ec
:
$TEST_CLIENT_CURVE
.
³m
 -
Ãw
 \

80 -
out
 
$CERTS_DIR
/
$TEST_CLIENT_FILE
.
»q
.
³m


82 
$OPENSSL_CMD
 
x509
 -
»q
 -
days
 
$DAYS
 \

83 -
š
 
$CERTS_DIR
/
$TEST_CLIENT_FILE
.
»q
.
³m
 \

84 -
CA
 
$CERTS_DIR
/
$TEST_CA_FILE
.
û¹
.
³m
 \

85 -
CAkey
 
$KEYS_DIR
/
$TEST_CA_FILE
.
key
.
³m
 \

86 -
out
 
$CERTS_DIR
/
$TEST_CLIENT_FILE
.
û¹
.
³m
 -
CAü—‹£rŸl


88 #Di¥Ïy 
the
 
û¹ifiÿ‹


89 
$OPENSSL_CMD
 
x509
 -
š
 
$CERTS_DIR
/
$TEST_CLIENT_FILE
.
û¹
.
³m
 -
‹xt


91 #PÏû 
the
 
û¹ifiÿ‹
 
ªd
 
key
 
š
 
a
 
commÚ
 
fe


92 
$OPENSSL_CMD
 
x509
 -
š
 
$CERTS_DIR
/
$TEST_CLIENT_FILE
.
û¹
.
³m
 -
issu”
 -
subjeù
 \

93 > 
$COMBO_DIR
/
$TEST_CLIENT_FILE
.
³m


94 
$CAT
 
$KEYS_DIR
/
$TEST_CLIENT_FILE
.
key
.
³m
 >> 
$COMBO_DIR
/$TEST_CLIENT_FILE.pem

96 #Remov
the
 
û¹
 
»que¡
 
fe
 (
no
 
lÚg”
 
Ãeded
)

97 
$RM
 
$CERTS_DIR
/
$TEST_CLIENT_FILE
.
»q
.
³m


	@trunk/objs/openssl-1.0.1f/demos/ssltest-ecc/ECCcertgen.sh

1 #!/
bš
/
sh


3 #FÜ 
a
 
li¡
 
of
 
suµÜ‹d
 
curves
, 
u£
 "apps/opensslƒcparam -list_curves".

5 #P©h 
to
 
the
 
İ’s¦
 
di¡ributiÚ


6 
	gOPENSSL_DIR
=../..

7 #P©h 
to
 
the
 
İ’s¦
 
´og¿m


8 
OPENSSL_CMD
=
$OPENSSL_DIR
/
­ps
/
İ’s¦


9 #O±iÚ 
to
 
fšd
 
cÚfigu¿tiÚ
 
fe


10 
OPENSSL_CNF
="-config $OPENSSL_DIR/apps/openssl.cnf"

11 #DœeùÜy 
wh”e
 
û¹ifiÿ‹s
 
¬e
 
¡Üed


12 
CERTS_DIR
=./
C”ts


13 #DœeùÜy 
wh”e
 
´iv©e
 
key
 
fes
 
¬e
 
¡Üed


14 
KEYS_DIR
=
$CERTS_DIR


15 #DœeùÜy 
wh”e
 
combo
 
fes
 (
cÚššg
 
a
 
û¹ifiÿ‹
 
ªd
 
cÜ»¥Údšg


16 #´iv©
key
 
tog‘h”
è
¬e
 
¡Üed


17 
COMBO_DIR
=
$CERTS_DIR


18 #ÿˆ
commªd


19 
CAT
=/
bš
/
ÿt


20 #rm 
commªd


21 
RM
=/
bš
/
rm


22 #mkdœ 
commªd


23 
MKDIR
=/
bš
/
mkdœ


24 #Th
û¹ifiÿ‹
 
wl
 
expœe
 
the£
 
mªy
 
days
 
aá”
 
the
 
issue
 
d©e
.

25 
DAYS
=1500

26 
TEST_CA_CURVE
=
£ı160r1


27 
TEST_CA_FILE
=
£ı160r1Te¡CA


28 
TEST_CA_DN
="/C=US/ST=CA/L=Mountain View/O=Sun Microsystems, Inc./OU=Sun Microsystems Laboratories/CN=Test CA (Elliptic curve secp160r1)"

30 
TEST_SERVER_CURVE
=
£ı160r2


31 
TEST_SERVER_FILE
=
£ı160r2Te¡S”v”


32 
TEST_SERVER_DN
="/C=US/ST=CA/L=Mountain View/O=Sun Microsystems, Inc./OU=Sun Microsystems Laboratories/CN=Test Server (Elliptic curve secp160r2)"

34 
TEST_CLIENT_CURVE
=
£ı160r2


35 
TEST_CLIENT_FILE
=
£ı160r2Te¡Cl›Á


36 
TEST_CLIENT_DN
="/C=US/ST=CA/L=Mountain View/O=Sun Microsystems, Inc./OU=Sun Microsystems Laboratories/CN=Test Client (Elliptic curve secp160r2)"

38 #G’”©šg 
ª
 
EC
 
û¹ifiÿ‹
 
švŞves
 
the
 
fŞlowšg
 
maš
 
¡•s


39 #1. 
G’”©šg
 
curve
 
·¿m‘”s
 (
Ãeded
)

40 #2. 
G’”©šg
 
a
 
û¹ifiÿ‹
 
»que¡


41 #3. 
Signšg
 
the
 
û¹ifiÿ‹
 
»que¡


42 #4. [
O±iÚ®
] 
OÃ
 
ÿn
 
combše
 
the
 
û¹
 
ªd
 
´iv©e
 
key
 
što
 
a
 
sšgË


43 #f
ªd
 
®so
 
d–‘e
 
the
 
û¹ifiÿ‹
 
»que¡


45 
$MKDIR
 -
p
 
$CERTS_DIR


46 
$MKDIR
 -
p
 
$KEYS_DIR


47 
$MKDIR
 -
p
 
$COMBO_DIR


49 
echo
 "Generating self-signed CA certificate (on curve $TEST_CA_CURVE)"

50 
echo
 "==============================================================="

51 
$OPENSSL_CMD
 
eı¬am
 -
Çme
 
$TEST_CA_CURVE
 -
out
 $TEST_CA_CURVE.
³m


53 #G’”©
a
 
Ãw
 
û¹ifiÿ‹
 
»que¡
 
š
 
$TEST_CA_FILE
.
»q
.
³m
. 
A


54 #Ãw 
ecd§
 (
aùu®ly
 
ECC
è
key
 
·œ
 
is
 
g’”©ed
 
Ú
 
the
 
·¿m‘”s
 
š


55 #$TEST_CA_CURVE.
³m
 
ªd
 
the
 
´iv©e
 
key
 
is
 
§ved
 
š
 
$TEST_CA_FILE
.key.pem

56 #WARNING: 
By
 
usšg
 
the
 -
nodes
 
İtiÚ
, 
we
 
fÜû
h
´iv©e
 
key
 
to
 
be


57 #¡Üed 
š
 
the
 
ş—r
 (
¿th”
 
thª
 
’üy±ed
 
w™h
 
a
 
·sswÜd
).

58 
$OPENSSL_CMD
 
»q
 
	g$OPENSSL_CNF
 -
	gnodes
 -
	gsubj
 "$TEST_CA_DN" \

59 -
keyout
 
	g$KEYS_DIR
/
	g$TEST_CA_FILE
.
	gkey
.
	g³m
 \

60 -
Ãwkey
 
	gec
:
$TEST_CA_CURVE
.
³m
 -
Ãw
 \

61 -
out
 
$CERTS_DIR
/
$TEST_CA_FILE
.
»q
.
³m


63 #SigÀ
the
 
û¹ifiÿ‹
 
»que¡
 
š
 
$TEST_CA_FILE
.
»q
.
³m
 
usšg
he

64 #´iv©
key
 
š
 
$TEST_CA_FILE
.key.
³m
 
ªd
 
šşude
 
the
 
CA
 
ex‹nsiÚ
.

65 #Mak
the
 
û¹ifiÿ‹
 
v®id
 1500 
days
 
äom
h
time
 
of
 
signšg
.

66 #Th
û¹ifiÿ‹
 
is
 
wr™‹n
 
što
 
$TEST_CA_FILE
.
û¹
.
³m


67 
$OPENSSL_CMD
 
x509
 -
»q
 -
days
 
$DAYS
 \

68 -
š
 
$CERTS_DIR
/
$TEST_CA_FILE
.
»q
.
³m
 \

69 -
extfe
 
$OPENSSL_DIR
/
­ps
/
İ’s¦
.
úf
 \

70 -
ex‹nsiÚs
 
v3_ÿ
 \

71 -
signkey
 
$KEYS_DIR
/
$TEST_CA_FILE
.
key
.
³m
 \

72 -
out
 
$CERTS_DIR
/
$TEST_CA_FILE
.
û¹
.
³m


74 #Di¥Ïy 
the
 
û¹ifiÿ‹


75 
$OPENSSL_CMD
 
x509
 -
š
 
$CERTS_DIR
/
$TEST_CA_FILE
.
û¹
.
³m
 -
‹xt


77 #PÏû 
the
 
û¹ifiÿ‹
 
ªd
 
key
 
š
 
a
 
commÚ
 
fe


78 
$OPENSSL_CMD
 
x509
 -
š
 
$CERTS_DIR
/
$TEST_CA_FILE
.
û¹
.
³m
 -
issu”
 -
subjeù
 \

79 > 
$COMBO_DIR
/
$TEST_CA_FILE
.
³m


80 
$CAT
 
$KEYS_DIR
/
$TEST_CA_FILE
.
key
.
³m
 >> 
$COMBO_DIR
/$TEST_CA_FILE.pem

82 #Remov
the
 
û¹
 
»que¡
 
fe
 (
no
 
lÚg”
 
Ãeded
)

83 
$RM
 
$CERTS_DIR
/
$TEST_CA_FILE
.
»q
.
³m


85 
echo
 "GENERATING A TEST SERVER CERTIFICATE (onƒlliptic curve $TEST_SERVER_CURVE)"

86 
echo
 "=========================================================================="

87 #G’”©
·¿m‘”s
 
curve
 
$TEST_SERVER_CURVE
, 
Ãeded


88 
$OPENSSL_CMD
 
	geı¬am
 -
Çme
 
	g$TEST_SERVER_CURVE
 -
out
 $TEST_SERVER_CURVE.
	g³m


90 #G’”©
a
 
Ãw
 
û¹ifiÿ‹
 
»que¡
 
š
 
$TEST_SERVER_FILE
.
»q
.
³m
. 
A


91 #Ãw 
ecd§
 (
aùu®ly
 
ECC
è
key
 
·œ
 
is
 
g’”©ed
 
Ú
 
the
 
·¿m‘”s
 
š


92 #$TEST_SERVER_CURVE.
³m
 
ªd
 
the
 
´iv©e
 
key
 
is
 
§ved
 
š


93 #$TEST_SERVER_FILE.
key
.
³m


94 #WARNING: 
By
 
usšg
 
the
 -
nodes
 
İtiÚ
, 
we
 
fÜû
h
´iv©e
 
key
 
to
 
be


95 #¡Üed 
š
 
the
 
ş—r
 (
¿th”
 
thª
 
’üy±ed
 
w™h
 
a
 
·sswÜd
).

96 
$OPENSSL_CMD
 
»q
 
	g$OPENSSL_CNF
 -
	gnodes
 -
	gsubj
 "$TEST_SERVER_DN" \

97 -
keyout
 
	g$KEYS_DIR
/
	g$TEST_SERVER_FILE
.
	gkey
.
	g³m
 \

98 -
Ãwkey
 
	gec
:
$TEST_SERVER_CURVE
.
³m
 -
Ãw
 \

99 -
out
 
$CERTS_DIR
/
$TEST_SERVER_FILE
.
»q
.
³m


101 #SigÀ
the
 
û¹ifiÿ‹
 
»que¡
 
š
 
$TEST_SERVER_FILE
.
»q
.
³m
 
usšg
he

102 #CA 
û¹ifiÿ‹
 
š
 
$TEST_CA_FILE
.
û¹
.
³m
 
ªd
 
the
 
CA
 
´iv©e
 
key
 in

103 #$TEST_CA_FILE.
key
.
³m
. 
Sšû
 
we
 dØ
nÙ
 
have
 
ª
 
exi¡šg
 
£rŸl
 
numb”


104 #f
this
 
CA
, 
ü—‹
 
Úe
. 
Make
 
the
 
û¹ifiÿ‹
 
v®id
 
$DAYS
 
days


105 #äom 
the
 
time
 
of
 
signšg
. 
The
 
û¹ifiÿ‹
 
is
 
wr™‹n
 
što


106 #$TEST_SERVER_FILE.
û¹
.
³m


107 
$OPENSSL_CMD
 
	gx509
 -
	g»q
 -
days
 
	g$DAYS
 \

108 -
š
 
	g$CERTS_DIR
/
	g$TEST_SERVER_FILE
.
	g»q
.
	g³m
 \

109 -
CA
 
	g$CERTS_DIR
/
	g$TEST_CA_FILE
.
	gû¹
.
	g³m
 \

110 -
CAkey
 
	g$KEYS_DIR
/
	g$TEST_CA_FILE
.
	gkey
.
	g³m
 \

111 -
out
 
	g$CERTS_DIR
/
	g$TEST_SERVER_FILE
.
	gû¹
.
	g³m
 -
	gCAü—‹£rŸl


113 #Di¥Ïy 
the
 
û¹ifiÿ‹


114 
$OPENSSL_CMD
 
	gx509
 -
š
 
	g$CERTS_DIR
/
	g$TEST_SERVER_FILE
.
	gû¹
.
	g³m
 -
	g‹xt


116 #PÏû 
the
 
û¹ifiÿ‹
 
ªd
 
key
 
š
 
a
 
commÚ
 
fe


117 
$OPENSSL_CMD
 
	gx509
 -
š
 
	g$CERTS_DIR
/
	g$TEST_SERVER_FILE
.
	gû¹
.
	g³m
 -
	gissu”
 -
	gsubjeù
 \

118 > 
	g$COMBO_DIR
/
	g$TEST_SERVER_FILE
.
³m


119 
$CAT
 
	g$KEYS_DIR
/
	g$TEST_SERVER_FILE
.
	gkey
.
	g³m
 >> 
	g$COMBO_DIR
/$TEST_SERVER_FILE.pem

121 #Remov
the
 
û¹
 
»que¡
 
fe
 (
no
 
lÚg”
 
Ãeded
)

122 
$RM
 
	g$CERTS_DIR
/
	g$TEST_SERVER_FILE
.
	g»q
.
³m


124 
	gecho
 "GENERATING A TEST CLIENT CERTIFICATE (onƒlliptic curve $TEST_CLIENT_CURVE)"

125 
	gecho
 "=========================================================================="

126 #G’”©
·¿m‘”s
 
curve
 
$TEST_CLIENT_CURVE
, 
Ãeded


127 
$OPENSSL_CMD
 
	geı¬am
 -
Çme
 
	g$TEST_CLIENT_CURVE
 -
out
 $TEST_CLIENT_CURVE.
	g³m


129 #G’”©
a
 
Ãw
 
û¹ifiÿ‹
 
»que¡
 
š
 
$TEST_CLIENT_FILE
.
»q
.
³m
. 
A


130 #Ãw 
ecd§
 (
aùu®ly
 
ECC
è
key
 
·œ
 
is
 
g’”©ed
 
Ú
 
the
 
·¿m‘”s
 
š


131 #$TEST_CLIENT_CURVE.
³m
 
ªd
 
the
 
´iv©e
 
key
 
is
 
§ved
 
š


132 #$TEST_CLIENT_FILE.
key
.
³m


133 #WARNING: 
By
 
usšg
 
the
 -
nodes
 
İtiÚ
, 
we
 
fÜû
h
´iv©e
 
key
 
to
 
be


134 #¡Üed 
š
 
the
 
ş—r
 (
¿th”
 
thª
 
’üy±ed
 
w™h
 
a
 
·sswÜd
).

135 
$OPENSSL_CMD
 
»q
 
	g$OPENSSL_CNF
 -
	gnodes
 -
	gsubj
 "$TEST_CLIENT_DN" \

136 -
keyout
 
	g$KEYS_DIR
/
	g$TEST_CLIENT_FILE
.
	gkey
.
	g³m
 \

137 -
Ãwkey
 
	gec
:
$TEST_CLIENT_CURVE
.
³m
 -
Ãw
 \

138 -
out
 
$CERTS_DIR
/
$TEST_CLIENT_FILE
.
»q
.
³m


140 #SigÀ
the
 
û¹ifiÿ‹
 
»que¡
 
š
 
$TEST_CLIENT_FILE
.
»q
.
³m
 
usšg
he

141 #CA 
û¹ifiÿ‹
 
š
 
$TEST_CA_FILE
.
û¹
.
³m
 
ªd
 
the
 
CA
 
´iv©e
 
key
 in

142 #$TEST_CA_FILE.
key
.
³m
. 
Sšû
 
we
 dØ
nÙ
 
have
 
ª
 
exi¡šg
 
£rŸl
 
numb”


143 #f
this
 
CA
, 
ü—‹
 
Úe
. 
Make
 
the
 
û¹ifiÿ‹
 
v®id
 
$DAYS
 
days


144 #äom 
the
 
time
 
of
 
signšg
. 
The
 
û¹ifiÿ‹
 
is
 
wr™‹n
 
što


145 #$TEST_CLIENT_FILE.
û¹
.
³m


146 
$OPENSSL_CMD
 
	gx509
 -
	g»q
 -
days
 
	g$DAYS
 \

147 -
š
 
	g$CERTS_DIR
/
	g$TEST_CLIENT_FILE
.
	g»q
.
	g³m
 \

148 -
CA
 
	g$CERTS_DIR
/
	g$TEST_CA_FILE
.
	gû¹
.
	g³m
 \

149 -
CAkey
 
	g$KEYS_DIR
/
	g$TEST_CA_FILE
.
	gkey
.
	g³m
 \

150 -
out
 
	g$CERTS_DIR
/
	g$TEST_CLIENT_FILE
.
	gû¹
.
	g³m
 -
	gCAü—‹£rŸl


152 #Di¥Ïy 
the
 
û¹ifiÿ‹


153 
$OPENSSL_CMD
 
	gx509
 -
š
 
	g$CERTS_DIR
/
	g$TEST_CLIENT_FILE
.
	gû¹
.
	g³m
 -
	g‹xt


155 #PÏû 
the
 
û¹ifiÿ‹
 
ªd
 
key
 
š
 
a
 
commÚ
 
fe


156 
$OPENSSL_CMD
 
	gx509
 -
š
 
	g$CERTS_DIR
/
	g$TEST_CLIENT_FILE
.
	gû¹
.
	g³m
 -
	gissu”
 -
	gsubjeù
 \

157 > 
	g$COMBO_DIR
/
	g$TEST_CLIENT_FILE
.
³m


158 
$CAT
 
	g$KEYS_DIR
/
	g$TEST_CLIENT_FILE
.
	gkey
.
	g³m
 >> 
	g$COMBO_DIR
/$TEST_CLIENT_FILE.pem

160 #Remov
the
 
û¹
 
»que¡
 
fe
 (
no
 
lÚg”
 
Ãeded
)

161 
$RM
 
	g$CERTS_DIR
/
	g$TEST_CLIENT_FILE
.
	g»q
.
	g³m


	@trunk/objs/openssl-1.0.1f/demos/ssltest-ecc/RSAcertgen.sh

1 #!/
bš
/
sh


3 #FÜ 
a
 
li¡
 
of
 
suµÜ‹d
 
curves
, 
u£
 "apps/opensslƒcparam -list_curves".

5 #P©h 
to
 
the
 
İ’s¦
 
di¡ributiÚ


6 
	gOPENSSL_DIR
=../..

7 #P©h 
to
 
the
 
İ’s¦
 
´og¿m


8 
OPENSSL_CMD
=
$OPENSSL_DIR
/
­ps
/
İ’s¦


9 #O±iÚ 
to
 
fšd
 
cÚfigu¿tiÚ
 
fe


10 
OPENSSL_CNF
="-config $OPENSSL_DIR/apps/openssl.cnf"

11 #DœeùÜy 
wh”e
 
û¹ifiÿ‹s
 
¬e
 
¡Üed


12 
CERTS_DIR
=./
C”ts


13 #DœeùÜy 
wh”e
 
´iv©e
 
key
 
fes
 
¬e
 
¡Üed


14 
KEYS_DIR
=
$CERTS_DIR


15 #DœeùÜy 
wh”e
 
combo
 
fes
 (
cÚššg
 
a
 
û¹ifiÿ‹
 
ªd
 
cÜ»¥Údšg


16 #´iv©
key
 
tog‘h”
è
¬e
 
¡Üed


17 
COMBO_DIR
=
$CERTS_DIR


18 #ÿˆ
commªd


19 
CAT
=/
bš
/
ÿt


20 #rm 
commªd


21 
RM
=/
bš
/
rm


22 #mkdœ 
commªd


23 
MKDIR
=/
bš
/
mkdœ


24 #Th
û¹ifiÿ‹
 
wl
 
expœe
 
the£
 
mªy
 
days
 
aá”
 
the
 
issue
 
d©e
.

25 
DAYS
=1500

26 
TEST_CA_FILE
=
r§1024Te¡CA


27 
TEST_CA_DN
="/C=US/ST=CA/L=Mountain View/O=Sun Microsystems, Inc./OU=Sun Microsystems Laboratories/CN=Test CA (1024 bit RSA)"

29 
TEST_SERVER_FILE
=
r§1024Te¡S”v”


30 
TEST_SERVER_DN
="/C=US/ST=CA/L=Mountain View/O=Sun Microsystems, Inc./OU=Sun Microsystems Laboratories/CN=Test Server (1024 bit RSA)"

32 
TEST_CLIENT_FILE
=
r§1024Te¡Cl›Á


33 
TEST_CLIENT_DN
="/C=US/ST=CA/L=Mountain View/O=Sun Microsystems, Inc./OU=Sun Microsystems Laboratories/CN=Test Client (1024 bit RSA)"

35 #G’”©šg 
ª
 
EC
 
û¹ifiÿ‹
 
švŞves
 
the
 
fŞlowšg
 
maš
 
¡•s


36 #1. 
G’”©šg
 
curve
 
·¿m‘”s
 (
Ãeded
)

37 #2. 
G’”©šg
 
a
 
û¹ifiÿ‹
 
»que¡


38 #3. 
Signšg
 
the
 
û¹ifiÿ‹
 
»que¡


39 #4. [
O±iÚ®
] 
OÃ
 
ÿn
 
combše
 
the
 
û¹
 
ªd
 
´iv©e
 
key
 
što
 
a
 
sšgË


40 #f
ªd
 
®so
 
d–‘e
 
the
 
û¹ifiÿ‹
 
»que¡


42 
$MKDIR
 -
p
 
$CERTS_DIR


43 
$MKDIR
 -
p
 
$KEYS_DIR


44 
$MKDIR
 -
p
 
$COMBO_DIR


46 
echo
 "Generating self-signed CA certificate (RSA)"

47 
echo
 "==========================================="

49 
$OPENSSL_CMD
 
»q
 
$OPENSSL_CNF
 -
nodes
 -
subj
 "$TEST_CA_DN" \

50 -
keyout
 
$KEYS_DIR
/
$TEST_CA_FILE
.
key
.
³m
 \

51 -
Ãwkey
 
r§
:1024 -
Ãw
 \

52 -
out
 
$CERTS_DIR
/
$TEST_CA_FILE
.
»q
.
³m


54 
$OPENSSL_CMD
 
x509
 -
»q
 -
days
 
$DAYS
 \

55 -
š
 
$CERTS_DIR
/
$TEST_CA_FILE
.
»q
.
³m
 \

56 -
extfe
 
$OPENSSL_DIR
/
­ps
/
İ’s¦
.
úf
 \

57 -
ex‹nsiÚs
 
v3_ÿ
 \

58 -
signkey
 
$KEYS_DIR
/
$TEST_CA_FILE
.
key
.
³m
 \

59 -
out
 
$CERTS_DIR
/
$TEST_CA_FILE
.
û¹
.
³m


61 #Di¥Ïy 
the
 
û¹ifiÿ‹


62 
$OPENSSL_CMD
 
x509
 -
š
 
$CERTS_DIR
/
$TEST_CA_FILE
.
û¹
.
³m
 -
‹xt


64 #PÏû 
the
 
û¹ifiÿ‹
 
ªd
 
key
 
š
 
a
 
commÚ
 
fe


65 
$OPENSSL_CMD
 
x509
 -
š
 
$CERTS_DIR
/
$TEST_CA_FILE
.
û¹
.
³m
 -
issu”
 -
subjeù
 \

66 > 
$COMBO_DIR
/
$TEST_CA_FILE
.
³m


67 
$CAT
 
$KEYS_DIR
/
$TEST_CA_FILE
.
key
.
³m
 >> 
$COMBO_DIR
/$TEST_CA_FILE.pem

69 #Remov
the
 
û¹
 
»que¡
 
fe
 (
no
 
lÚg”
 
Ãeded
)

70 
$RM
 
$CERTS_DIR
/
$TEST_CA_FILE
.
»q
.
³m


72 
echo
 "GENERATING A TEST SERVER CERTIFICATE (RSA)"

73 
echo
 "=========================================="

75 
$OPENSSL_CMD
 
»q
 
$OPENSSL_CNF
 -
nodes
 -
subj
 "$TEST_SERVER_DN" \

76 -
keyout
 
$KEYS_DIR
/
$TEST_SERVER_FILE
.
key
.
³m
 \

77 -
Ãwkey
 
r§
:1024 -
Ãw
 \

78 -
out
 
$CERTS_DIR
/
$TEST_SERVER_FILE
.
»q
.
³m


80 
$OPENSSL_CMD
 
x509
 -
»q
 -
days
 
$DAYS
 \

81 -
š
 
$CERTS_DIR
/
$TEST_SERVER_FILE
.
»q
.
³m
 \

82 -
CA
 
$CERTS_DIR
/
$TEST_CA_FILE
.
û¹
.
³m
 \

83 -
CAkey
 
$KEYS_DIR
/
$TEST_CA_FILE
.
key
.
³m
 \

84 -
out
 
$CERTS_DIR
/
$TEST_SERVER_FILE
.
û¹
.
³m
 -
CAü—‹£rŸl


86 #Di¥Ïy 
the
 
û¹ifiÿ‹


87 
$OPENSSL_CMD
 
x509
 -
š
 
$CERTS_DIR
/
$TEST_SERVER_FILE
.
û¹
.
³m
 -
‹xt


89 #PÏû 
the
 
û¹ifiÿ‹
 
ªd
 
key
 
š
 
a
 
commÚ
 
fe


90 
$OPENSSL_CMD
 
x509
 -
š
 
$CERTS_DIR
/
$TEST_SERVER_FILE
.
û¹
.
³m
 -
issu”
 -
subjeù
 \

91 > 
$COMBO_DIR
/
$TEST_SERVER_FILE
.
³m


92 
$CAT
 
$KEYS_DIR
/
$TEST_SERVER_FILE
.
key
.
³m
 >> 
$COMBO_DIR
/$TEST_SERVER_FILE.pem

94 #Remov
the
 
û¹
 
»que¡
 
fe
 (
no
 
lÚg”
 
Ãeded
)

95 
$RM
 
$CERTS_DIR
/
$TEST_SERVER_FILE
.
»q
.
³m


97 
echo
 "GENERATING A TEST CLIENT CERTIFICATE (RSA)"

98 
echo
 "=========================================="

100 
$OPENSSL_CMD
 
»q
 
$OPENSSL_CNF
 -
nodes
 -
subj
 "$TEST_CLIENT_DN" \

101 -
keyout
 
$KEYS_DIR
/
$TEST_CLIENT_FILE
.
key
.
³m
 \

102 -
Ãwkey
 
r§
:1024 -
Ãw
 \

103 -
out
 
$CERTS_DIR
/
$TEST_CLIENT_FILE
.
»q
.
³m


105 
$OPENSSL_CMD
 
x509
 -
»q
 -
days
 
$DAYS
 \

106 -
š
 
$CERTS_DIR
/
$TEST_CLIENT_FILE
.
»q
.
³m
 \

107 -
CA
 
$CERTS_DIR
/
$TEST_CA_FILE
.
û¹
.
³m
 \

108 -
CAkey
 
$KEYS_DIR
/
$TEST_CA_FILE
.
key
.
³m
 \

109 -
out
 
$CERTS_DIR
/
$TEST_CLIENT_FILE
.
û¹
.
³m
 -
CAü—‹£rŸl


111 #Di¥Ïy 
the
 
û¹ifiÿ‹


112 
$OPENSSL_CMD
 
x509
 -
š
 
$CERTS_DIR
/
$TEST_CLIENT_FILE
.
û¹
.
³m
 -
‹xt


114 #PÏû 
the
 
û¹ifiÿ‹
 
ªd
 
key
 
š
 
a
 
commÚ
 
fe


115 
$OPENSSL_CMD
 
x509
 -
š
 
$CERTS_DIR
/
$TEST_CLIENT_FILE
.
û¹
.
³m
 -
issu”
 -
subjeù
 \

116 > 
$COMBO_DIR
/
$TEST_CLIENT_FILE
.
³m


117 
$CAT
 
$KEYS_DIR
/
$TEST_CLIENT_FILE
.
key
.
³m
 >> 
$COMBO_DIR
/$TEST_CLIENT_FILE.pem

119 #Remov
the
 
û¹
 
»que¡
 
fe
 (
no
 
lÚg”
 
Ãeded
)

120 
$RM
 
$CERTS_DIR
/
$TEST_CLIENT_FILE
.
»q
.
³m


	@trunk/objs/openssl-1.0.1f/demos/ssltest-ecc/ssltest.sh

1 #! /
bš
/
sh


2 #Te¡ 
ECC
 
ch”
 
su™es
 
usšg
 
s¦‹¡
. 
Requœes
 
Úe
 
¬gum’t
 
which
 
could


3 #b
«cdh
 
Ü
 
ecdh
-
ecd§
 o¸
ecdhe
-ecd§ o¸ecdh-
r§
 orƒcdhe-rsa.

4 #A 
£cÚd
 
İtiÚ®
 
¬gum’t
 
ÿn
 
be
 
Úe
 
of
 
s¦2
 
s¦3
 
Ü
 
s1


6 [ "$1" = "" ]; 
	gth’


7 (
	gecho
 "Usage: $0est […rotocol ]"

8 
	gecho
 " whereest is one of‡ecdh,ƒcdh-ecdsa,ƒcdhe-ecdsa,ƒcdh-rsa,ƒcdhe-rsa"

9 
	gecho
 "‡nd…rotocol (optional) is one of ssl2, ssl3,ls1"

10 
	gecho
 "Run RSAcertgen.sh, ECC-RSAcertgen.sh, ECCcertgen.sh first."

12 
	gex™
 1

13 
fi


16 
	gOPENSSL_DIR
=../..

17 
CERTS_DIR
=./
C”ts


18 
SSLTEST
=
$OPENSSL_DIR
/
‹¡
/
s¦‹¡


19 #SSL 
´ÙocŞ
 
v”siÚ
 
to
 
‹¡
 (
Úe
 
of
 
s¦2
 
s¦3
 
Ü
 
s1
)"

20 
SSLVERSION
=

22 #The£ 
dÚ
't„eally„equire‡ny certificates

23 
AECDH_CIPHER_LIST
="AECDH-AES256-SHA AECDH-AES128-SHA AECDH-DES-CBC3-SHA AECDH-RC4-SHA AECDH-NULL-SHA"

25 #The£ 
»quœe
 
ECC
 
û¹ifiÿ‹s
 sigÃd 
w™h
 
ECDSA


26 #Th
EC
 
public
 
key
 
mu¡
 
be
 
authÜized
 key 
ag»em’t
.

27 
ECDH_ECDSA_CIPHER_LIST
="ECDH-ECDSA-AES256-SHA ECDH-ECDSA-AES128-SHA ECDH-ECDSA-DES-CBC3-SHA ECDH-ECDSA-RC4-SHA ECDH-ECDSA-NULL-SHA"

29 #The£ 
»quœe
 
ECC
 
û¹ifiÿ‹s
.

30 #Th
EC
 
public
 
key
 
mu¡
 
be
 
authÜized
 
dig™®
 
sigÇtu»
.

31 
ECDHE_ECDSA_CIPHER_LIST
="ECDHE-ECDSA-AES256-SHA ECDHE-ECDSA-AES128-SHA ECDHE-ECDSA-DES-CBC3-SHA ECDHE-ECDSA-RC4-SHA ECDHE-ECDSA-NULL-SHA"

33 #The£ 
»quœe
 
ECC
 
û¹ifiÿ‹s
 sigÃd 
w™h
 
RSA
.

34 #Th
EC
 
public
 
key
 
mu¡
 
be
 
authÜized
 key 
ag»em’t
.

35 
ECDH_RSA_CIPHER_LIST
="ECDH-RSA-AES256-SHA ECDH-RSA-AES128-SHA ECDH-RSA-DES-CBC3-SHA ECDH-RSA-RC4-SHA ECDH-RSA-NULL-SHA"

37 #The£ 
»quœe
 
RSA
 
û¹ifiÿ‹s
.

38 #Th
RSA
 
public
 
key
 
mu¡
 
be
 
authÜized
 
dig™®
 
sigÇtu»
.

39 
ECDHE_RSA_CIPHER_LIST
="ECDHE-RSA-AES256-SHA ECDHE-RSA-AES128-SHA ECDHE-RSA-DES-CBC3-SHA ECDHE-RSA-RC4-SHA ECDHE-RSA-NULL-SHA"

41 #Li¡ 
of
 
EÎtic
 
curves
 
ov”
 
which
 
we
 
wish
 
to
 
‹¡
 
g’”©iÚ
 of

42 #•hem”® 
ECDH
 
keys
 
wh’
 
usšg
 
AECDH
 
Ü
 
ECDHE
 
ch”s


43 #NOTE: 
£ı192r1
 = 
´ime192v1
 
ªd
 
£ı256r1
 = 
´ime256v1


45 
ELLIPTIC_CURVE_LIST
="sect163k1 sect163r1 sect163r2 sect193r1 sect193r2 sect233k1 sect233r1 sect239k1 sect283k1 sect283r1 sect409k1 sect409r1 sect571k1 sect571r1 secp160k1 secp160r1 secp160r2 secp192k1…rime192v1 secp224k1 secp224r1 secp256k1…rime256v1 secp384r1 secp521r1"

47 
DEFAULT_CURVE
="sect163r2"

49 [ "$2" = "" ]; 
th’


50 [ "$SSL_VERSION" = "" ]; 
th’


51 
	gSSL_VERSION
=""

53 
SSL_VERSION
="-$SSL_VERSION"

54 
fi


56 
SSL_VERSION
="-$2"

57 
fi


60 #AnÚymou 
ch”
 
su™es
 dØ
nÙ
 
»quœe
 
key
 
Ü
 
û¹ifiÿ‹
 
fes


61 #buˆ
s¦‹¡
 
ex³ùs
 
a
 
û¹
 
fe
 
ªd
 
com¶ašs
 
™
 
ÿn
't

62 #İ’ 
the
  
Úe
.

63 
SERVER_PEM
=
$OPENSSL_DIR
/
­ps
/
£rv”
.
³m


65 [ "$1" = "«cdh" ]; 
th’


66 
ch”
 
š
 
$AECDH_CIPHER_LIST


68 
	gecho
 "Testing $cipher"

69 
$SSLTEST
 
	g$SSL_VERSION
 -
û¹
 
	g$SERVER_PEM
 -
ch”
 
$ch”


70 
	gdÚe


72 
curve
 
š
 
$ELLIPTIC_CURVE_LIST


74 
	gecho
 "Testing AECDH-NULL-SHA (with $curve)"

75 
$SSLTEST
 
	g$SSL_VERSION
 -
û¹
 
	g$SERVER_PEM
 \

76 -
Çmed_curve
 
	g$curve
 -
ch”
 
	gAECDH
-
	gNULL
-
SHA


77 
dÚe


79 
curve
 
š
 
$ELLIPTIC_CURVE_LIST


81 
	gecho
 "Testing AECDH-RC4-SHA (with $curve)"

82 
$SSLTEST
 
	g$SSL_VERSION
 -
û¹
 
	g$SERVER_PEM
 \

83 -
Çmed_curve
 
	g$curve
 -
ch”
 
	gAECDH
-
	gRC4
-
SHA


84 
dÚe


85 
	gfi


88 #BÙh 
ECDH
-
ECDSA
 
ªd
 
ECDHE
-ECDSA 
ch”
 
su™es
 
»quœe


89 #th
£rv”
 
to
 
have
 
ª
 
ECC
 
û¹ifiÿ‹
 sigÃd 
w™h
 
ECDSA
.

90 
	gCA_PEM
=
$CERTS_DIR
/
£ı160r1Te¡CA
.
³m


91 
SERVER_PEM
=
$CERTS_DIR
/
£ı160r2Te¡S”v”
.
³m


92 
CLIENT_PEM
=
$CERTS_DIR
/
£ı160r2Te¡Cl›Á
.
³m


94 [ "$1" = "ecdh-ecd§" ]; 
th’


95 
ch”
 
š
 
$ECDH_ECDSA_CIPHER_LIST


97 
	gecho
 "Testing $cipher (with server‡uthentication)"

98 
$SSLTEST
 
	g$SSL_VERSION
 -
CAfe
 
	g$CA_PEM
 \

99 -
û¹
 
	g$SERVER_PEM
 -
	g£rv”_auth
 \

100 -
ch”
 
$ch”


102 
	gecho
 "Testing $cipher (with server‡nd client‡uthentication)"

103 
$SSLTEST
 
	g$SSL_VERSION
 -
CAfe
 
	g$CA_PEM
 \

104 -
û¹
 
	g$SERVER_PEM
 -
	g£rv”_auth
 \

105 -
c_û¹
 
	g$CLIENT_PEM
 -
	gş›Á_auth
 \

106 -
ch”
 
$ch”


107 
dÚe


108 
	gfi


111 [ "$1" = "ecdhe-ecd§" ]; 
th’


112 
ch”
 
š
 
$ECDHE_ECDSA_CIPHER_LIST


114 
	gecho
 "Testing $cipher (with server‡uthentication)"

115 
$SSLTEST
 
	g$SSL_VERSION
 -
CAfe
 
	g$CA_PEM
 \

116 -
û¹
 
	g$SERVER_PEM
 -
	g£rv”_auth
 \

117 -
ch”
 
	g$ch”
 -
Çmed_curve
 
$DEFAULT_CURVE


119 
	gecho
 "Testing $cipher (with server‡nd client‡uthentication)"

120 
$SSLTEST
 
	g$SSL_VERSION
 -
CAfe
 
	g$CA_PEM
 \

121 -
û¹
 
	g$SERVER_PEM
 -
	g£rv”_auth
 \

122 -
c_û¹
 
	g$CLIENT_PEM
 -
	gş›Á_auth
 \

123 -
ch”
 
	g$ch”
 -
Çmed_curve
 
$DEFAULT_CURVE


124 
	gdÚe


127 
curve
 
š
 
$ELLIPTIC_CURVE_LIST


129 
	gecho
 "Testing ECDHE-ECDSA-AES128-SHA (2-way‡uth with $curve)"

130 
$SSLTEST
 
	g$SSL_VERSION
 -
CAfe
 
	g$CA_PEM
 \

131 -
û¹
 
	g$SERVER_PEM
 -
	g£rv”_auth
 \

132 -
c_û¹
 
	g$CLIENT_PEM
 -
	gş›Á_auth
 \

133 -
ch”
 
	gECDHE
-
	gECDSA
-
	gAES128
-
	gSHA
 -
Çmed_curve
 
$curve


134 
dÚe


135 
	gfi


138 #ECDH-
RSA
 
ch”
 
su™es
 
»quœe
 
the
 
£rv”
 
to
 
have
 
ª
 
ECC


139 #û¹ifiÿ‹ sigÃd 
w™h
 
RSA
.

140 
	gCA_PEM
=
$CERTS_DIR
/
r§1024Te¡CA
.
³m


141 
SERVER_PEM
=
$CERTS_DIR
/
£ù163r1
-
r§Te¡S”v”
.
³m


142 
CLIENT_PEM
=
$CERTS_DIR
/
£ù163r1
-
r§Te¡Cl›Á
.
³m


144 [ "$1" = "ecdh-r§" ]; 
th’


145 
ch”
 
š
 
$ECDH_RSA_CIPHER_LIST


147 
	gecho
 "Testing $cipher (with server‡uthentication)"

148 
$SSLTEST
 
	g$SSL_VERSION
 -
CAfe
 
	g$CA_PEM
 \

149 -
û¹
 
	g$SERVER_PEM
 -
	g£rv”_auth
 \

150 -
ch”
 
$ch”


152 
	gecho
 "Testing $cipher (with server‡nd client‡uthentication)"

153 
$SSLTEST
 
	g$SSL_VERSION
 -
CAfe
 
	g$CA_PEM
 \

154 -
û¹
 
	g$SERVER_PEM
 -
	g£rv”_auth
 \

155 -
c_û¹
 
	g$CLIENT_PEM
 -
	gş›Á_auth
 \

156 -
ch”
 
$ch”


157 
dÚe


158 
	gfi


161 #ECDHE-
RSA
 
ch”
 
su™es
 
»quœe
 
the
 
£rv”
 
to
 
have
 
ª
 RSA 
û¹
.

162 
	gCA_PEM
=
$CERTS_DIR
/
r§1024Te¡CA
.
³m


163 
SERVER_PEM
=
$CERTS_DIR
/
r§1024Te¡S”v”
.
³m


164 
CLIENT_PEM
=
$CERTS_DIR
/
r§1024Te¡Cl›Á
.
³m


166 [ "$1" = "ecdhe-r§" ]; 
th’


167 
ch”
 
š
 
$ECDHE_RSA_CIPHER_LIST


169 
	gecho
 "Testing $cipher (with server‡uthentication)"

170 
echo
 
$SSLTEST
 
	g$SSL_VERSION
 -
CAfe
 
	g$CA_PEM
 \

171 -
û¹
 
	g$SERVER_PEM
 -
	g£rv”_auth
 \

172 -
ch”
 
	g$ch”
 -
Çmed_curve
 
$DEFAULT_CURVE


173 
$SSLTEST
 
	g$SSL_VERSION
 -
CAfe
 
	g$CA_PEM
 \

174 -
û¹
 
	g$SERVER_PEM
 -
	g£rv”_auth
 \

175 -
ch”
 
	g$ch”
 -
Çmed_curve
 
$DEFAULT_CURVE


177 
	gecho
 "Testing $cipher (with server‡nd client‡uthentication)"

178 
$SSLTEST
 
	g$SSL_VERSION
 -
CAfe
 
	g$CA_PEM
 \

179 -
û¹
 
	g$SERVER_PEM
 -
	g£rv”_auth
 \

180 -
c_û¹
 
	g$CLIENT_PEM
 -
	gş›Á_auth
 \

181 -
ch”
 
	g$ch”
 -
Çmed_curve
 
$DEFAULT_CURVE


182 
dÚe


183 
	gfi


	@trunk/objs/openssl-1.0.1f/demos/tunala/autogunk.sh

1 #!/
bš
/
sh


3 #Thi 
süt
 
Œ›s
 
to
 
fŞlow
 
the
 "GNU way" 
w
.
r
.
t
.h
autob™s
.

4 #Thi 
dÛs
 
of
 
cour£
 
g’”©e
 
a
 
numb”
 oà
œr™©šg
 
fes
.

5 #Try 
to
 
g‘
 
ov”
 
™
 (
I
 
am
 
g‘tšg
 
th”e
 
my£lf
).

7 #Thi 
should
 
g’”©e
 
ªy
 
missšg
 
üud
, 
ªd
 
th’
 
run
 
autocÚf
 
which
 should 
tuº


8 #cÚfigu».
š
 
što
 
a
 "./cÚfigu»" 
süt
 
ªd
 "Makefile.am" into‡

9 #"
Makefe
.
š
". Th’„uÂšg "./
cÚfigu»
" shouldurn "Makefile.in" into

10 #"
Makefe
"‡nd should generatehe config.h containing your systems various

11 #£‰šgs. 
I
 
know
 ... 
wh©
 
a
 
has¦e
 ...

13 #Also, 
som‘imes
 
the£
 
autob™s
 
thšgs
 
g’”©e
 
biz¬»
 
ouut
 (
lookšg
 
like


14 #”rÜs). 
So
 
I
 
dœeù
 
ev”ythšg
 "elsewhere" ...

16 (
aşoÿl


17 
autoh—d”


18 
	glibtoŞize
 --
	gcİy
 --
fÜû


19 
	gautomake
 --
	gfÜeign
 --
	gadd
-
	gmissšg
 --
cİy


20 
	gautocÚf
è1> /
	gdev
/
	gnuÎ
 2>&1

22 #Mov
the
 "no-autÙoŞs" 
Makefe
 
out
 
of
h
way


23 
	g‹¡
 ! -
f
 
	gMakefe
.
	g¶aš
; 
th’


24 
mv
 
Makefe
 
	gMakefe
.
¶aš


25 
	gfi


	@trunk/objs/openssl-1.0.1f/demos/tunala/autoungunk.sh

1 #!/
bš
/
sh


3 #Thi 
süt
 
Œ›s
 
to
 
ş—n
 
up
 
as
 
much
‡ 
is
 
possibË
 
äom
 
wh©ev”
 
dŸbŞiÿl


4 #mes 
has
 
b“n
 
Ëá
 
š
 
the
 
dœeùÜy
 
thªks
 
to
 
autocÚf
, 
automake
, 
ªd
 
theœ


7 
	g‹¡
 -
f
 
	gMakefe
.
	g¶aš
; 
th’


8 
	g‹¡
 -
f
 
	gMakefe
; 
th’


9 
make
 
di¡ş—n


10 
fi


11 
mv
 
	gMakefe
.
¶aš
 
Makefe


13 
make
 
ş—n


14 
fi


16 
	grm
 -
f
 
	gaşoÿl
.
m4
 
	gcÚfig
.* 
cÚfigu»
 
	gš¡®l
-
	gsh
 \

17 
missšg
 
mkš¡®ldœs
 
	g¡amp
-
	gh
.* 
	gMakefe
.
	gš
 \

18 
ÉcÚfig
 
	gÉmaš
.
sh
 
d•comp


19 
	grm
 -
rf
 
	gautom4‹
.
	gÿche


	@trunk/objs/openssl-1.0.1f/demos/tunala/test.sh

1 #!/
bš
/
sh


3 
	gHTTP
="localhost:8080"

4 
CLIENT_PORT
="9020"

5 
SERVER_PORT
="9021"

7 
	$sub_‹¡
 ()

9 
echo
 "STARTING - $VER $CIPHER"

10 ./
tuÇÏ
 -
li¡’
 
loÿlho¡
:
$CLIENT_PORT
 -
´oxy
†oÿlho¡:
$SERVER_PORT
 \

11 -
ÿû¹
 
CA
.
³m
 -
û¹
 
A
-
ş›Á
.³m -
£rv”
 0 \

12 -
dh_¥ecŸl
 
¡ªd¬d
 -
v_³”
 -
v_¡riù
 \

13 
$VER
 -
ch”
 
$CIPHER
 1> 
tc1
.
txt
 2> 
tc2
.txt &

14 ./
tuÇÏ
 -
li¡’
 
loÿlho¡
:
$SERVER_PORT
 -
´oxy
 
$HTTP
 \

15 -
ÿû¹
 
CA
.
³m
 -
û¹
 
A
-
£rv”
.pem -server 1 \

16 -
dh_¥ecŸl
 
¡ªd¬d
 -
v_³”
 -
v_¡riù
 \

17 
$VER
 -
ch”
 
$CIPHER
 1> 
ts1
.
txt
 2> 
ts2
.txt &

18 #Wa™ 
the
 
£rv”s
 
to
 
be
 
li¡’šg
 
befÜe
 
¡¬tšg
h
wg‘
 
‹¡


19 
DONE
="no"

21 
L1
=`
Ãt¡©
 -
a
 | 
eg»p
 "LISTEN[\ˆ]*$" | 
g»p
 ":$CLIENT_PORT"`

22 
L2
=`
Ãt¡©
 -
a
 | 
eg»p
 "LISTEN[\ˆ]*$" | 
g»p
 ":$SERVER_PORT"`

23 [ "x$L1" !ğ"x" ]; 
th’


24 
DONE
="yes"

25 
–if
 [ "x$L2" !ğ"x" ]; 
th’


26 
DONE
="yes"

28 
¦“p
 1

29 
fi


30 
dÚe


31 
HTML
=`
wg‘
 -
O
 - -
T
 1 
h‰p
:

32 [ "x$HTML" !ğ"x" ]; 
th’


33 
echo
 "OK - $CIPHER ($VER)"

35 
echo
 "FAIL - $CIPHER ($VER)"

36 
kÏÎ
 
tuÇÏ


37 
ex™
 1

38 
fi


39 
kÏÎ
 
tuÇÏ


40 #Wa™ 
the
 
£rv”s
 
to
 
¡İ
 
befÜe
 
»tuºšg
 - 
Ùh”wi£
h
Ãxt


41 #‹¡ 
my
 
ç
 
to
 
¡¬t
 ... (
fsckšg
 
¿û
 
cÚd™iÚs
)

42 
DONE
="yes"

44 
L1
=`
Ãt¡©
 -
a
 | 
eg»p
 "LISTEN[\ˆ]*$" | 
g»p
 ":$CLIENT_PORT"`

45 
L2
=`
Ãt¡©
 -
a
 | 
eg»p
 "LISTEN[\ˆ]*$" | 
g»p
 ":$SERVER_PORT"`

46 [ "x$L1" !ğ"x" ]; 
th’


47 
DONE
="yes"

48 
–if
 [ "x$L2" !ğ"x" ]; 
th’


49 
DONE
="yes"

51 
DONE
="no"

52 
fi


53 
dÚe


54 
ex™
 0

55 
	}
}

57 
	$run_‹¡
 ()

59 (
sub_‹¡
 1> /
dev
/
nuÎ
è|| 
ex™
 1

60 
	}
}

62 
	$run_s¦_‹¡
 ()

64 
kÏÎ
 
tuÇÏ
 1> /
dev
/
nuÎ
 2> /dev/null

65 
echo
 ""

66 
echo
 "Starting‡ll $PRETTYests"

67 [ "$PRETTY" !ğ"SSLv2" ]; 
th’


68 [ "$PRETTY" !ğ"SSLv3" ]; 
th’


69 
expÜt
 
VER
="-no_ssl2 -no_ssl3"

70 
expÜt
 
OSSL
="-tls1"

72 
expÜt
 
VER
="-no_ssl2 -no_tls1"

73 
expÜt
 
OSSL
="-ssl3"

74 
fi


76 
expÜt
 
VER
="-no_ssl3 -no_tls1"

77 
expÜt
 
OSSL
="-ssl2"

78 
fi


79 
LIST
="`../../apps/openssl ciphers $OSSL | sed -e 's/:/ /g'`"

81 
i
 
š
 
$LIST
; do \

82 
DSS
=`
echo
 "$i" | 
g»p
 "DSS"`

83 [ "x$DSS" !ğ"x" ]; 
th’


84 
echo
 "---- skipping $i (no DSA cert/keys) ----"

86 
expÜt
 
CIPHER
=
$i


87 
run_‹¡


88 
echo
 "SUCCESS: $i"

89 
fi


90 
dÚe
;

91 
	}
}

93 #W–com
the
 
u£r


94 
	gecho
 "Tests will‡ssume‡n http server„unning‡t $HTTP"

96 #TLSv1 
‹¡


97 
expÜt
 
	gPRETTY
="TLSv1"

98 
run_s¦_‹¡


100 #SSLv3 
‹¡


101 
expÜt
 
PRETTY
="SSLv3"

102 
run_s¦_‹¡


104 #SSLv2 
‹¡


105 
expÜt
 
PRETTY
="SSLv2"

106 
run_s¦_‹¡


	@trunk/objs/openssl-1.0.1f/doc/openssl_button.html

2 <!-- 
	gthe
 `
Inşudes
 
O³nSSL
 
Cry±og­hy
 
	gSoáw¬e
' button -->

3 <!-- 
ä“ly
 
u§bË
 
by
 
ªy
 
­¶iÿtiÚ
 
lšked
 
agaš¡
 
	gO³nSSL
 -->

4 <
a
 
	gh»f
="http://www.openssl.org/">

5 <
img
 
¤c
="openssl_button.gif"

6 
width
=102 
height
=47 
bÜd”
=0></
a
>

	@trunk/objs/openssl-1.0.1f/shlib/hpux10-cc.sh

1 #!/
u¤
/
bš
/
sh


2 #
#RuÀ
this
 
süt
 
äom
 
the
 
O³nSSL
 
roÙ
 
dœeùÜy
:

3 #sh 
shlib
/
hpux10
-
cc
.
sh


4 #
#HP-
UX
 (10.20è
sh¬ed
 
lib¿ry
 
š¡®ÏtiÚ
:

5 #Comp
ªd
 
š¡®l
 
O³nSSL
 
w™h
 
be¡
 
possibË
 
İtimiz©iÚ
:

6 #- 
sh¬ed
 
lib¿r›s
 
¬e
 
comped
 
ªd
 
š¡®Ëd
 
w™h
 +
O4
 
İtimiz©iÚ


7 #- 
execubË
(
s
è
¬e
 
comped
 
ªd
 
š¡®Ëd
 
w™h
 +
O4
 
İtimiz©iÚ


8 #- 
lib¿r›s
 
¬e
 
comped
 
ªd
 
š¡®Ëd
 
w™h
 +
O3
 
İtimiz©iÚ
,

9 #tØ
avoid
 
the
 
time
 
cÚsumšg
 +
O4
 
lšk
-tim
İtimiz©iÚ
 
wh’
 
usšg


10 #the£ 
lib¿r›s
. (
The
 
sh¬ed
 
libs
 
¬e
 
®»ady
 
İtimized
 
duršg
 
bud


11 #© +
O4
.)

12 #
#Thi 
süt
 
mu¡
 
be
 
run
 
w™h
 
­´İrŸ‹
 
´iveges
 
to
 
š¡®l
 
što


13 #/
u¤
/
loÿl
/
s¦
. 
HP
-
UX
 
´ev’ts
 
u£d
 
execubËs
 
ªd
 
sh¬ed
 
lib¿r›s


14 #äom 
bešg
 
d–‘ed
 
Ü
 
ov”wr™‹n
. 
Stİ
 
®l
 
´oûs£s
 
usšg
 
®»ady


15 #š¡®Ëd 
™ems
 
of
 
O³nSSL
.

16 #
#WARNING: 
At
 
high
 
İtimiz©iÚ
 
Ëv–s
, 
HP
's ANSI-C compiler can chew up

17 #Ïrg
amouÁs
 
of
 
memÜy
 
ªd
 
CPU
 
time
. 
Make
 
su»
 
to
 
have
 
©
 
Ëa¡


18 #128
MB
 
of
 
RAM
 
avaabË
 
ªd
 
th©
 
your
 
k”Ãl
 
is
 
cÚfigu»d
 
to
 
®low


19 #© 
Ëa¡
 128
MB
 
d©a
 
size
 (
maxdsiz
 
·¿m‘”
 
which
 
ÿn
 
be
 
obšed


20 #by 
muÉlyšg
 'echo maxdsiz/D |‡db -k /stand/vmunix /dev/kmem'

22 #Th
š¡®ÏtiÚ
 
´oûss
 
ÿn
 
ke
 
£v”®
 
hours
, 
ev’
 
Ú
 
ç¡


23 #machšes. +
O4
 
İtimiz©iÚ
 
of
 
the
 
libüy±o
.
¦
 
sh¬ed
 
lib¿ry
 
may


24 #k1 
hour
 
Ú
 
a
 
C200
 (200
MHz
 
PA8200
 
CPU
), +
O3
 
comp©iÚ
 
of


25 #füy±_b.
c
 
ÿn
 
ke
 20 
mšu‹s
 
Ú
 
this
 
machše
. 
Sy
 
·t›Á
.

26 #
#SITEFLAGS: 
s™e
 
¥ecific
 
æags
. 
I
 dØ
u£
 +
DApÜbË
, 
sšû
 I 
have
 
to


27 #suµÜˆ
Şd”
 
PA1
.1-
ty³
 
CPUs
. 
Your
 
m—ge
 
may
 
v¬y
.

28 #+
w1
 
’abËs
 
’hªûd
 
w¬nšgs
, 
u£ful
 
wh’
 
wÜkšg
 
w™h
 
¢­hÙs
.

29 #
="+DApÜbË +w1"

30 #
#S‘ 
the
  
add™iÚs
 
to
 
bud
 
w™h
 
HP
-
UX
.

31 #-
D_REENTRANT
 
mu¡
/
should
 
be
 
defšed
 
Ú
 
HP
-
UX
 
mªu®ly
, 
sšû
 
we
 dØ
ÿÎ


32 #CÚfigu» 
dœeùly
.

33 #+
O®l
 
šü—£s
 
the
 
İtimiz©iÚ
 
dÚe
.

34 #
="-D_REENTRANT +O®È$SITEFLAGS"

36 #CÚfigu» 
pic
 
ªd
 
bud
 
the
 piø
lib¿r›s


37 
³¾5
 
CÚfigu»
 
	gno
-
sh¬ed
 
	ghpux
-
	g·risc
-
	gcc
-
	go4
 +
Z
 
	g$
{
	gMYFLAGS
}

38 
make
 
ş—n


39 
make
 
	gDIRS
="crypto ssl"

40 #R’am
the
 
pic
 
libs
 
ªd
 
bud
 
dyÇmic
 
lib¿r›s
 
äom
 
them


41 #B
´•¬ed
 
to
 
£e
 
a
 
lÙ
 
of
 
w¬nšgs
 
about
 
sh¬ed
 
lib¿r›s
 
bešg
 
but


42 #w™h 
İtimiz©iÚs
 
high”
 
thª
 +
O2
. 
Wh’
 
usšg
 
the£
 
lib¿r›s
, 
™
 
is


43 #nÙ 
possibË
 
to
 
»¶aû
 
š‹º®
 
lib¿ry
 
funùiÚs
 
w™h
 funùiÚ 
äom


44 #th
´og¿m
 
to
 
be
 
lšked
.

45 #
 -àshlib/Makefe.hpux10-cc

47 #Cİy 
the
 
lib¿r›s
 
to
 /
u¤
/
loÿl
/
s¦
/
lib
 (
they
 
have
Ø
be
 
š
 
theœ


48 #fš® 
loÿtiÚ
 
wh’
 
lškšg
 
­¶iÿtiÚs
).

49 #Ià
the
 
dœeùÜ›s
 
¬e
 
¡l
 
th”e
, 
no
 
´obËm
.

50 
	gmkdœ
 /
	gu¤
/
loÿl


51 
	gmkdœ
 /
	gu¤
/
	gloÿl
/
s¦


52 
	gmkdœ
 /
	gu¤
/
	gloÿl
/
	gs¦
/
lib


53 
	gchmod
 444 
lib
*
	g_pic
.
a


54 
	gchmod
 555 
	glib
*.
	g¦
.0.9.8

55 
	gı
 -
p
 
lib
*
	g_pic
.
a
 
	glib
*.
	g¦
.0.9.8 /
	gu¤
/
	gloÿl
/
	gs¦
/lib

56 (
	gcd
 /
	gu¤
/
	gloÿl
/
	gs¦
/
	glib
 ; 
	gÊ
 -
sf
 
	glibüy±o
.
	g¦
.0.9.8†ibüy±o.¦ ;†À-sà
	glibs¦
.sl.0.9.8†ibssl.sl)

58 #RecÚfigu» 
w™hout
 
pic
 
to
 
compe
 
the
 
execubËs
. 
UnfÜtuÇ‹ly
, 

59 #³rfÜmšg 
this
 
sk
 
we
 
have
 
to
 
»compe
 
the
 
lib¿ry
 
compÚ’ts
, 
ev’


60 #though 
we
 
u£
 
the
 
®»ady
 
š¡®Ëd
 
sh¬ed
 
libs
 
ªyway
.

61 #
5 CÚfigu»‚o-sh¬ed hpux-·risc-cc-o4 ${MYFLAGS}

63 
make
 
	gş—n


65 #Hack 
the
 
Makefes
 
to
 
pick
 
up
h
dyÇmic
 
lib¿r›s
 
duršg
 
lškšg


66 #
 's/^PEX_LIBS=.*$/PEX_LIBS=-L\/u¤\/loÿl\/s¦\/lib/' Makefe.s¦ >xxx; mv xxx Makefe.s¦

67 
	g£d
 's/-L\.\.//' 
	g­ps
/
	gMakefe
.
	gs¦
 >
	gxxx
; 
mv
 
xxx
‡µs/Makefe.
s¦


68 
	g£d
 's/-L\.\.//' 
	g‹¡
/
	gMakefe
.
	gs¦
 >
	gxxx
; 
mv
 
xxx
est/Makefile.ssl

69 #Bud 
the
 
libs
 
ªd
h
execubËs
 
š
 
Úe
 
make
.

70 
	gmake


71 #In¡®È
ev”ythšg


72 
make
 
	gš¡®l


74 #Fš®ly 
bud
 
the
 
libs
 
w™h
 +
O3
. 
This
 
time
 
we
 
Úly
 
Ãed
h
lib¿r›s
,

75 #Úû 
ü—‹d
, 
they
 
¬e
 
sim¶y
 
cİ›d
 
što
 
¶aû
.

76 #
5 CÚfigu»‚o-sh¬ed hpux-·risc-cø${MYFLAGS}

77 
make
 
ş—n


78 
make
 
	gDIRS
="crypto ssl"

79 
chmod
 644 
libüy±o
.
a
 
libs¦
.a

80 
ı
 -
p
 
libüy±o
.
a
 
libs¦
.¨/
u¤
/
loÿl
/
s¦
/
lib


	@trunk/objs/openssl-1.0.1f/shlib/irix.sh

1 
	gFLAGS
="-DTERMIOS -O2 -mips2 -DB_ENDIAN -fomit-frame-pointer -Wall -Iinclude"

2 
SHFLAGS
="-DPIC -fpic"

4 
gcc
 -
c
 -
Iüy±o
 
$SHFLAGS
 
$FLAGS
 -
o
 
üy±o
.o crypto/crypto.c

5 
ld
 -
sh¬ed
 -
o
 
libüy±o
.
so
 
üy±o
.o

6 
gcc
 -
c
 -
Is¦
 
$SHFLAGS
 
$FLAGS
 -
o
 
s¦
.o ssl/ssl.c

7 
ld
 -
sh¬ed
 -
o
 
libs¦
.
so
 
s¦
.o

	@trunk/objs/openssl-1.0.1f/shlib/sco5-shared-gcc.sh

1 #!/
bš
/
sh


3 
	gmajÜ
="0"

4 
mšÜ
="9.7b"

6 
¦ib
=
libs¦


7 
sh_¦ib
=
$¦ib
.
so
.
$majÜ
.
$mšÜ


9 
şib
=
libüy±o


10 
sh_şib
=
$şib
.
so
.
$majÜ
.
$mšÜ


12 
FLAGS
="-O3 -fomit-frame-pointer"

13 
SHFLAGS
="-DPIC -fPIC"

15 
touch
 
$sh_şib


16 
touch
 
$sh_¦ib


18 
echo
 
cŞËùšg
 
®l
 
objeù
 
fes
 
$şib
.
so


19 
OBJS
=

20 
fšd
 . -
Çme
 \*.
o
 -
´št
 > 
®lobjs


21 
obj
 
š
 `
¬
 
t
 
libüy±o
.
a
`

23 
OBJS
="$OBJS `grep $obj‡llobjs`"

24 
dÚe


26 
echo
 
lškšg
 
$şib
.
so


27 
gcc
 -
G
 -
o
 
$sh_şib
 -
h
 $sh_şib 
$OBJS
 -
Ê¦
 -
lsock‘


29 
rm
 -
f
 
$şib
.
so


30 
Ê
 -
s
 
$sh_şib
 
$şib
.
so


32 
echo
 
cŞËùšg
 
®l
 
objeù
 
fes
 
$¦ib
.
so


33 
OBJS
=

34 
obj
 
š
 `
¬
 
t
 
libs¦
.
a
`

36 
OBJS
="$OBJS `grep $obj‡llobjs`"

37 
dÚe


39 
echo
 
lškšg
 
$¦ib
.
so


40 
gcc
 -
G
 -
o
 
$sh_¦ib
 -
h
 $sh_¦ib 
$OBJS
 -
L
. -
lüy±o


42 
rm
 -
f
 
$¦ib
.
so


43 
Ê
 -
s
 
$sh_¦ib
 
$¦ib
.
so


45 
mv
 
libRSAglue
.
a
†ibRSAglue.a.
Üig


46 
mv
 
libüy±o
.
a
†ibüy±o.a.
Üig


47 
mv
 
libs¦
.
a
†ibs¦.a.
Üig


	@trunk/objs/openssl-1.0.1f/shlib/sco5-shared.sh

1 #!/
bš
/
sh


3 
	gmajÜ
="0"

4 
mšÜ
="9.7b"

6 
¦ib
=
libs¦


7 
sh_¦ib
=
$¦ib
.
so
.
$majÜ
.
$mšÜ


9 
şib
=
libüy±o


10 
sh_şib
=
$şib
.
so
.
$majÜ
.
$mšÜ


12 
FLAGS
="-O -DFILIO_H -Kalloca"

13 
SHFLAGS
="-Kpic -DPIC"

15 
touch
 
$sh_şib


16 
touch
 
$sh_¦ib


18 
echo
 
cŞËùšg
 
®l
 
objeù
 
fes
 
$şib
.
so


19 
OBJS
=

20 
fšd
 . -
Çme
 \*.
o
 -
´št
 > 
®lobjs


21 
obj
 
š
 `
¬
 
t
 
libüy±o
.
a
`

23 
OBJS
="$OBJS `grep $obj‡llobjs`"

24 
dÚe


26 
echo
 
lškšg
 
$şib
.
so


27 
cc
 -
G
 -
o
 
$sh_şib
 -
h
 $sh_şib 
$OBJS
 -
Ê¦
 -
lsock‘


29 
rm
 -
f
 
$şib
.
so


30 
Ê
 -
s
 
$sh_şib
 
$şib
.
so


32 
echo
 
cŞËùšg
 
®l
 
objeù
 
fes
 
$¦ib
.
so


33 
OBJS
=

34 
obj
 
š
 `
¬
 
t
 
libs¦
.
a
`

36 
OBJS
="$OBJS `grep $obj‡llobjs`"

37 
dÚe


39 
echo
 
lškšg
 
$¦ib
.
so


40 
cc
 -
G
 -
o
 
$sh_¦ib
 -
h
 $sh_¦ib 
$OBJS
 -
L
. -
lüy±o


42 
rm
 -
f
 
$¦ib
.
so


43 
Ê
 -
s
 
$sh_¦ib
 
$¦ib
.
so


45 
mv
 
libRSAglue
.
a
†ibRSAglue.a.
Üig


46 
mv
 
libüy±o
.
a
†ibüy±o.a.
Üig


47 
mv
 
libs¦
.
a
†ibs¦.a.
Üig


	@trunk/objs/openssl-1.0.1f/shlib/solaris-sc4.sh

1 #!/
bš
/
sh


3 
	gmajÜ
="1"

5 
¦ib
=
libs¦


6 
sh_¦ib
=
$¦ib
.
so
.
$majÜ


8 
şib
=
libüy±o


9 
sh_şib
=
$şib
.
so
.
$majÜ


11 
echo
 
cŞËùšg
 
®l
 
objeù
 
fes
 
$şib
.
so


12 
OBJS
=

13 
fšd
 . -
Çme
 \*.
o
 -
´št
 > 
®lobjs


14 
obj
 
š
 `
¬
 
t
 
libüy±o
.
a
`

16 
OBJS
="$OBJS `grep $obj‡llobjs`"

17 
dÚe


19 
echo
 
lškšg
 
$şib
.
so


20 
cc
 -
G
 -
o
 
$sh_şib
 -
h
 $sh_şib 
$OBJS
 -
Ê¦
 -
lsock‘


22 
rm
 -
f
 
$şib
.
so


23 
Ê
 -
s
 
$sh_şib
 
$şib
.
so


25 
echo
 
cŞËùšg
 
®l
 
objeù
 
fes
 
$¦ib
.
so


26 
OBJS
=

27 
obj
 
š
 `
¬
 
t
 
libs¦
.
a
`

29 
OBJS
="$OBJS `grep $obj‡llobjs`"

30 
dÚe


32 
echo
 
lškšg
 
$¦ib
.
so


33 
cc
 -
G
 -
o
 
$sh_¦ib
 -
h
 $sh_¦ib 
$OBJS
 -
L
. -
lüy±o


35 
rm
 -
f
 
$¦ib
.
so


36 
Ê
 -
s
 
$sh_¦ib
 
$¦ib
.
so


38 
rm
 -
f
 
®lobjs


40 
mv
 
libRSAglue
.
a
†ibRSAglue.a.
Üig


41 
mv
 
libüy±o
.
a
†ibüy±o.a.
Üig


42 
mv
 
libs¦
.
a
†ibs¦.a.
Üig


	@trunk/objs/openssl-1.0.1f/shlib/solaris.sh

1 #!/
bš
/
sh


3 
	gecho
 "#defšDATE \"`d©e`\"" >
	güy±o
/
	gd©e
.
h


5 
	gmajÜ
="0"

6 
mšÜ
="8.0"

7 
¦ib
=
libs¦


8 
şib
=
libüy±o


9 
CC
=
gcc


10 
CPP
='gcc -E'

11 
AS
=
as


13 
FLAGS
='-DTERMIO -g2 -ggdb -DL_ENDIAN -Wall -DREF_CHECK -DCRYPTO_MDEBUG'

14 
INCLUDE
='-Iinclude -Icrypto -Issl'

15 
SHFLAGS
='-DPIC -fpic'

17 
CFLAGS
="$FLAGS $INCLUDE $SHFLAGS"

18 
ASM_OBJ
="";

20 
echo
 
compšg
 
bignum
 
as£mb”


21 
	g$AS
 -
o
 
	gbn_asm
.Ø
	güy±o
/
	gbn
/
	gasm
/
	g¥¬c
.
s


22 
	gCFLAGS
="$CFLAGS -DBN_ASM"

23 
ASM_OBJ
="$ASM_OBJ bn_asm.o"

25 
echo
 
compšg
 
$şib


26 
$CC
 -
c
 
$CFLAGS
 -
DCFLAGS
="\"$FLAGS\"" -
o
 
üy±o
.o crypto/crypto.c

28 
echo
 
lškšg
 
$şib
.
so


29 
gcc
 
$CFLAGS
 -
sh¬ed
 -
o
 
$şib
.
so
.
$majÜ
.
$mšÜ
 
üy±o
.Ø
$ASM_OBJ
 -
Ê¦
 -
lsock‘


31 
echo
 
compšg
 
$¦ib
.
so


32 
$CC
 -
c
 
$CFLAGS
 -
o
 
s¦
.o ssl/ssl.c

34 
echo
 
budšg
 
$¦ib
.
so


35 
gcc
 
$CFLAGS
 -
sh¬ed
 -
o
 
$¦ib
.
so
 
s¦
.Ø-
L
. -
lüy±o


	@trunk/objs/openssl-1.0.1f/shlib/sun.sh

1 
	gFLAGS
="-DTERMIO -O3 -DB_ENDIAN -fomit-frame-pointer -mv8 -Wall -Iinclude"

2 
SHFLAGS
="-DPIC -fpic"

4 
gcc
 -
c
 -
Iüy±o
 
$SHFLAGS
 -
åic
 
$FLAGS
 -
o
 
üy±o
.o crypto/crypto.c

5 
ld
 -
G
 -
z
 
‹xt
 -
o
 
libüy±o
.
so
 
üy±o
.o

7 
gcc
 -
c
 -
Is¦
 
$SHFLAGS
 
$FLAGS
 -
o
 
s¦
.o ssl/ssl.c

8 
ld
 -
G
 -
z
 
‹xt
 -
o
 
libs¦
.
so
 
s¦
.o

	@trunk/objs/openssl-1.0.1f/shlib/svr5-shared-gcc.sh

1 #!/
u¤
/
bš
/
sh


3 
	gmajÜ
="0"

4 
mšÜ
="9.7b"

6 
¦ib
=
libs¦


7 
sh_¦ib
=
$¦ib
.
so
.
$majÜ
.
$mšÜ


9 
şib
=
libüy±o


10 
sh_şib
=
$şib
.
so
.
$majÜ
.
$mšÜ


12 
FLAGS
="-O3 -DFILIO_H -fomit-frame-pointer -pthread"

13 
SHFLAGS
="-DPIC -fPIC"

15 
touch
 
$sh_şib


16 
touch
 
$sh_¦ib


18 
echo
 
cŞËùšg
 
®l
 
objeù
 
fes
 
$şib
.
so


19 
OBJS
=

20 
fšd
 . -
Çme
 \*.
o
 -
´št
 > 
®lobjs


21 
obj
 
š
 `
¬
 
t
 
libüy±o
.
a
`

23 
OBJS
="$OBJS `grep $obj‡llobjs`"

24 
dÚe


26 
echo
 
lškšg
 
$şib
.
so


27 
gcc
 -
G
 -
o
 
$sh_şib
 -
h
 $sh_şib 
$OBJS
 -
Ê¦
 -
lsock‘


29 
rm
 -
f
 
$şib
.
so


30 
Ê
 -
s
 
$sh_şib
 
$şib
.
so


32 
echo
 
cŞËùšg
 
®l
 
objeù
 
fes
 
$¦ib
.
so


33 
OBJS
=

34 
obj
 
š
 `
¬
 
t
 
libs¦
.
a
`

36 
OBJS
="$OBJS `grep $obj‡llobjs`"

37 
dÚe


39 
echo
 
lškšg
 
$¦ib
.
so


40 
gcc
 -
G
 -
o
 
$sh_¦ib
 -
h
 $sh_¦ib 
$OBJS
 -
L
. -
lüy±o


42 
rm
 -
f
 
$¦ib
.
so


43 
Ê
 -
s
 
$sh_¦ib
 
$¦ib
.
so


45 
mv
 
libRSAglue
.
a
†ibRSAglue.a.
Üig


46 
mv
 
libüy±o
.
a
†ibüy±o.a.
Üig


47 
mv
 
libs¦
.
a
†ibs¦.a.
Üig


	@trunk/objs/openssl-1.0.1f/shlib/svr5-shared.sh

1 #!/
u¤
/
bš
/
sh


3 
	gmajÜ
="0"

4 
mšÜ
="9.7b"

6 
¦ib
=
libs¦


7 
sh_¦ib
=
$¦ib
.
so
.
$majÜ
.
$mšÜ


9 
şib
=
libüy±o


10 
sh_şib
=
$şib
.
so
.
$majÜ
.
$mšÜ


12 
FLAGS
="-O -DFILIO_H -Kalloca -Kthread"

13 
SHFLAGS
="-Kpic -DPIC"

15 
touch
 
$sh_şib


16 
touch
 
$sh_¦ib


18 
echo
 
cŞËùšg
 
®l
 
objeù
 
fes
 
$şib
.
so


19 
OBJS
=

20 
fšd
 . -
Çme
 \*.
o
 -
´št
 > 
®lobjs


21 
obj
 
š
 `
¬
 
t
 
libüy±o
.
a
`

23 
OBJS
="$OBJS `grep $obj‡llobjs`"

24 
dÚe


26 
echo
 
lškšg
 
$şib
.
so


27 
cc
 -
G
 -
o
 
$sh_şib
 -
h
 $sh_şib 
$OBJS
 -
Ê¦
 -
lsock‘


29 
rm
 -
f
 
$şib
.
so


30 
Ê
 -
s
 
$sh_şib
 
$şib
.
so


32 
echo
 
cŞËùšg
 
®l
 
objeù
 
fes
 
$¦ib
.
so


33 
OBJS
=

34 
obj
 
š
 `
¬
 
t
 
libs¦
.
a
`

36 
OBJS
="$OBJS `grep $obj‡llobjs`"

37 
dÚe


39 
echo
 
lškšg
 
$¦ib
.
so


40 
cc
 -
G
 -
o
 
$sh_¦ib
 -
h
 $sh_¦ib 
$OBJS
 -
L
. -
lüy±o


42 
rm
 -
f
 
$¦ib
.
so


43 
Ê
 -
s
 
$sh_¦ib
 
$¦ib
.
so


45 
mv
 
libRSAglue
.
a
†ibRSAglue.a.
Üig


46 
mv
 
libüy±o
.
a
†ibüy±o.a.
Üig


47 
mv
 
libs¦
.
a
†ibs¦.a.
Üig


	@trunk/objs/openssl-1.0.1f/tools/c89.sh

1 #!/
bš
/
sh
 -
k


2 #
#Re-
Üd”
 
¬gum’ts
 
so
 
th©
 -
L
 
comes
 
fœ¡


3 #
=""

4 
	glİts
=""

6 
¬g
 
š
 
$
* ; do

7 
$¬g
 
	gš


8 -
	gL
*è
	glİts
="$lopts $arg" ;;

9 *è
	gİts
="$opts $arg" ;;

10 
e§c


11 
dÚe


13 
c89
 
$lİts
 
	g$İts


	@trunk/objs/openssl-1.0.1f/util/FreeBSD.sh

1 #!/
bš
/
sh


3 
³¾
 
	gut
/
	g³¾·th
.
	g¶
 /
	gu¤
/
bš


4 
³¾
 
	gut
/
	gs¦dœ
.
	g¶
 /
	gu¤
/
loÿl


5 
³¾
 
	gut
/
	gmk1mf
.
¶
 
	gF»eBSD
 >
	gMakefe
.
F»eBSD


6 
³¾
 
CÚfigu»
 
	gF»eBSD


	@trunk/objs/openssl-1.0.1f/util/bat.sh

1 #!/
u¤
/
loÿl
/
bš
/
³¾


3 
	g$šfe
="/home/eay/ssl/SSLeay/MINFO";

5 
İ’
(
IN
,"<$šfe"è|| 
	gd›
 "unableo open $infile:$!\n";

6 
	g$_
=<
IN
>;

9 
	gchİ
;

11 (
	g$key
,
	g$v®
)=/^([^=]+)=(.*)/;

12 ià(
$key
 
	geq
 "RELATIVE_DIRECTORY")

14 ià(
$lib
 
	gÃ
 "")

16 
	g$uc
=
$lib
;

17 
	g$uc
 =~ 
s
/^
lib
(.*)\.
a
/
$1
/;

18 
	g$uc
 =~ 
Œ
/
a
-
z
/
A
-
Z
/;

19 
	g$lib_Çm
{
	g$uc
}=
$uc
;

20 
	g$lib_obj
{
	g$uc
}.=
$libobj
." ";

22 
Ï¡
 ià(
$v®
 
	geq
 "FINISHED");

23 
	g$lib
="";

24 
	g$libobj
="";

25 
	g$dœ
=
$v®
;

28 ià(
$key
 
	geq
 "TEST")

29 { 
	g$‹¡
.=&
v¬_add
(
$dœ
,
$v®
); }

31 ià((
$key
 
	geq
 "PROGS") || ($keyƒq "E_OBJ"))

32 { 
	g$e_exe
.=&
v¬_add
(
$dœ
,
$v®
); }

34 ià(
$key
 
	geq
 "LIB")

36 
	g$lib
=
$v®
;

37 
	g$lib
 =~ 
s
/^.*\/([^\/]+)
$
/
$1
/;

40 ià(
$key
 
	geq
 "EXHEADER")

41 { 
	g$exh—d”
.=&
v¬_add
(
$dœ
,
$v®
); }

43 ià(
$key
 
	geq
 "HEADER")

44 { 
	g$h—d”
.=&
v¬_add
(
$dœ
,
$v®
); }

46 ià(
$key
 
	geq
 "LIBSRC")

47 { 
	g$lib¤c
.=&
v¬_add
(
$dœ
,
$v®
); }

49 ià(!(
	g$_
=<
IN
>))

50 { 
$_
="RELATIVE_DIRECTORY=FINISHED\n"; }

52 
şo£
(
IN
);

54 @
	ga
=
¥l™
(/\
s
+/,
$lib¤c
);

55 
fÜ—ch
 (@
a
)

57 
	g´št
 "${_}.c\n";

60 
sub
 
	gv¬_add


62 
loÿl
(
$dœ
,
$v®
)=@
_
;

63 
loÿl
(@
a
,
$_
,
$»t
);

65 (""è
	g$no_’gše
 && 
	g$dœ
 =~ /\/
’gše
/;

66 (""è
	g$no_id—
 && 
	g$dœ
 =~ /\/
id—
/;

67 (""è
	g$no_rc2
 && 
	g$dœ
 =~ /\/
rc2
/;

68 (""è
	g$no_rc4
 && 
	g$dœ
 =~ /\/
rc4
/;

69 (""è
	g$no_r§
 && 
	g$dœ
 =~ /\/
r§
/;

70 (""è
	g$no_r§
 && 
	g$dœ
 =~ /^
r§»f
/;

71 (""è
	g$no_d§
 && 
	g$dœ
 =~ /\/
d§
/;

72 (""è
	g$no_dh
 && 
	g$dœ
 =~ /\/
dh
/;

73 ià(
	g$no_des
 && 
	g$dœ
 =~ /\/
des
/)

75 ià(
$v®
 =~ /
»ad_pwd
/)

80 (""è
	g$no_mdc2
 && 
	g$dœ
 =~ /\/
mdc2
/;

81 (""è
	g$no_sock
 && 
	g$dœ
 =~ /\/
´oxy
/;

82 (""è
	g$no_bf
 && 
	g$dœ
 =~ /\/
bf
/;

83 (""è
	g$no_ÿ¡
 && 
	g$dœ
 =~ /\/
ÿ¡
/;

85 
	g$v®
 =~ 
s
/^\s*(.*)\s*
$
/
$1
/;

86 @
	ga
=
¥l™
(/\
s
+/,
$v®
);

87 
g»p
(
s
/\.[
och
]
$


89 @
a
=
g»p
(!/^
e_
.*
_3d$
/,@aè
$no_des
;

90 @
a
=
g»p
(!/^
e_
.*
_d$
/,@aè
$no_des
;

91 @
a
=
g»p
(!/^
e_
.*
_i$
/,@aè
$no_id—
;

92 @
a
=
g»p
(!/^
e_
.*
_r2$
/,@aè
$no_rc2
;

93 @
a
=
g»p
(!/^
e_
.*
_bf$
/,@aè
$no_bf
;

94 @
a
=
g»p
(!/^
e_
.*
_c$
/,@aè
$no_ÿ¡
;

95 @
a
=
g»p
(!/^
e_rc4$
/,@aè
$no_rc4
;

97 @
a
=
g»p
(!/(^
s2_
)|(^
s23_
)/,@aè
$no_s¦2
;

98 @
a
=
g»p
(!/(^
s3_
)|(^
s23_
)/,@aè
$no_s¦3
;

100 @
a
=
g»p
(!/(
_sock$
)|(
_aıt$
)|(
_cÚn$
)|(^
pxy_
)/,@aè
$no_sock
;

102 @
a
=
g»p
(!/(^
md2
)|(
_md2$
)/,@aè
$no_md2
;

103 @
a
=
g»p
(!/(^
md5
)|(
_md5$
)/,@aè
$no_md5
;

105 @
a
=
g»p
(!/(^
d2i_r_
)|(^
i2d_r_
)/,@aè
$no_r§
;

106 @
a
=
g»p
(!/(^
p_İ’$
)|(^
p_£®$
)/,@aè
$no_r§
;

107 @
a
=
g»p
(!/(^
³m_£®$
)/,@aè
$no_r§
;

109 @
a
=
g»p
(!/(
m_dss$
)|(
m_dss1$
)/,@aè
$no_d§
;

110 @
a
=
g»p
(!/(^
d2i_s_
)|(^
i2d_s_
)|(
_d§p$
)/,@aè
$no_d§
;

112 @
a
=
g»p
(!/^
n_pkey$
/,@aè
$no_r§
 || 
$no_rc4
;

114 @
a
=
g»p
(!/
_dhp$
/,@aè
$no_dh
;

116 @
a
=
g»p
(!/(^
sha
[^1])|(
_sha$
)|(
m_dss$
)/,@aè
$no_sha
;

117 @
a
=
g»p
(!/(^
sha1
)|(
_sha1$
)|(
m_dss1$
)/,@aè
$no_sha1
;

118 @
a
=
g»p
(!/
_mdc2$
/,@aè
$no_mdc2
;

120 @
a
=
g»p
(!/^
’gše$
/,@aè
$no_’gše
;

121 @
a
=
g»p
(!/(^
r§$
)|(^
g’r§$
)|(^
»q$
)|(^
ÿ$
)/,@aè
$no_r§
;

122 @
a
=
g»p
(!/(^
d§$
)|(^
g’d§$
)|(^
d§·¿m$
)/,@aè
$no_d§
;

123 @
a
=
g»p
(!/^
g’d§$
/,@aè
$no_sha1
;

124 @
a
=
g»p
(!/(^
dh$
)|(^
g’dh$
)/,@aè
$no_dh
;

126 @
a
=
g»p
(!/(^
dh
)|(
_sha1$
)|(
m_dss1$
)/,@aè
$no_sha1
;

128 
g»p
(
$_
="$dœ/$_",@
a
);

129 @
a
=
g»p
(!/(^|\/)
s_
/,@aè
$no_sock
;

130 @
a
=
g»p
(!/(^|\/)
bio_sock
/,@aè
$no_sock
;

131 
$»t
=
još
(' ',@
a
)." ";

132 (
$»t
);

	@trunk/objs/openssl-1.0.1f/util/cygwin.sh

1 #!/
bš
/
bash


2 #
#Thi 
süt
 
cÚfigu»s
, 
buds
 
ªd
 
·cks
 
the
 
bš¬y
 
·ckage
 

3 #th
Cygwš
 
Ãt
 
di¡ributiÚ
 
v”siÚ
 
of
 
O³nSSL


5 #Uncomm’ˆ
wh’
 
debuggšg


6 #£ˆ-
x


8 
	gCONFIG_OPTIONS
="--prefix=/usr shared zlib‚o-idea‚o-rc5"

9 
INSTALL_PREFIX
=/
tmp
/
š¡®l
/
INSTALL


11 
VERSION
=

12 
SHLIB_VERSION_NUMBER
=

13 
SUBVERSION
=
$1


15 
funùiÚ
 
	$ş—nup
()

17 
rm
 -
rf
 
$
{
INSTALL_PREFIX
}/
‘c


18 
rm
 -
rf
 
$
{
INSTALL_PREFIX
}/
u¤


19 
	}
}

21 
funùiÚ
 
	$g‘_İ’s¦_v”siÚ
()

23 
ev®
 `
g»p
 '^VERSION=' 
Makefe
`

24 [ -
z
 "${VERSION}" ]

25 
th’


26 
echo
 "Error: Couldn't„etrieve OpenSSL version from Makefile."

27 
echo
 " Check value of variable VERSION in Makefile."

28 
ex™
 1

29 
fi


30 
ev®
 `
g»p
 '^SHLIB_VERSION_NUMBER=' 
Makefe
`

31 [ -
z
 "${SHLIB_VERSION_NUMBER}" ]

32 
th’


33 
echo
 "Error: Couldn't„etrieve OpenSSL shared†ib version from Makefile."

34 
echo
 " Check value of variable SHLIB_VERSION_NUMBER in Makefile."

35 
ex™
 1

36 
fi


37 
	}
}

39 
funùiÚ
 
	$ba£_š¡®l
()

41 
mkdœ
 -
p
 
$
{
INSTALL_PREFIX
}

42 
ş—nup


43 
make
 
š¡®l
 
INSTALL_PREFIX
="${INSTALL_PREFIX}"

44 
	}
}

46 
funùiÚ
 
	$doc_š¡®l
()

48 
DOC_DIR
=
$
{
INSTALL_PREFIX
}/
u¤
/
sh¬e
/
doc
/
İ’s¦


50 
mkdœ
 -
p
 
$
{
DOC_DIR
}

51 
ı
 
CHANGES
 CHANGES.
SSL—y
 
INSTALL
 
LICENSE
 
NEWS
 
README
 
$
{
DOC_DIR
}

53 
ü—‹_cygwš_»adme


54 
	}
}

56 
funùiÚ
 
	$û¹s_š¡®l
()

58 
CERTS_DIR
=
$
{
INSTALL_PREFIX
}/
u¤
/
s¦
/
û¹s


60 
mkdœ
 -
p
 
$
{
CERTS_DIR
}

61 
ı
 -
½
 
û¹s


	@trunk/objs/openssl-1.0.1f/util/do_ms.sh

1 #!/
bš
/
sh


2 #
#g’”©
the
 
Miüosoá
 
makefes
 
ªd
 .
def
 
fes


4 
	gPATH
=
ut
:../ut:
$PATH


6 #³¾ 
ut
/
mk1mf
.
¶
 
no
-
sock
 
VC
-
MSDOS
 >
ms
/
msdos
.
mak


7 #³¾ 
ut
/
mk1mf
.
¶
 
VC
-
W31
-32 >
ms
/
w31
.
mak


8 
³¾
 
ut
/
mk1mf
.
¶
 
dÎ
 
VC
-
WIN16
 >
ms
/
w31dÎ
.
mak


9 #³¾ 
ut
/
mk1mf
.
¶
 
VC
-
WIN32
 >
ms
/
Á
.
mak


10 
³¾
 
ut
/
mk1mf
.
¶
 
dÎ
 
VC
-
WIN32
 >
ms
/
ÁdÎ
.
mak


11 
³¾
 
ut
/
mk1mf
.
¶
 
Mšgw32
 >
ms
/
mšgw32
.
mak


12 
³¾
 
ut
/
mk1mf
.
¶
 
Mšgw32
-
fes
 >
ms
/
mšgw32f
.
mak


14 
³¾
 
ut
/
mkdef
.
¶
 16 
lib—y
 > 
ms
/
lib—y16
.
def


15 
³¾
 
ut
/
mkdef
.
¶
 32 
lib—y
 > 
ms
/
lib—y32
.
def


16 
³¾
 
ut
/
mkdef
.
¶
 16 
s¦—y
 > 
ms
/
s¦—y16
.
def


17 
³¾
 
ut
/
mkdef
.
¶
 32 
s¦—y
 > 
ms
/
s¦—y32
.
def


	@trunk/objs/openssl-1.0.1f/util/fixNT.sh

1 #!/
bš
/
sh


2 #
#ş—À
up
 
the
 
mess
 
th©
 
NT
 
makes
 
of
 
my
 
sourû
 
Œ“


4 [ -
f
 
makefe
 -
a
 ! -à
Makefe
 ]; 
	gth’


5 /
	gbš
/
mv
 
makefe
 
Makefe


6 
fi


7 
	gchmod
 +
x
 
CÚfigu»
 
	gut


	@trunk/objs/openssl-1.0.1f/util/install.sh

1 #!/
bš
/
sh


2 #
#š¡®È- 
š¡®l
 
a
 
´og¿m
, 
süt
, 
Ü
 
d©afe


3 #Thi 
comes
 
äom
 
X11R5
; 
™
 
is
 
nÙ
 
·¹
 
of
 
GNU
.

4 #
#$XCÚsÜtium: 
š¡®l
.
sh
,
v
 1.2 89/12/18 14:47:22 
jim
 
Exp
 
$


5 #
#Thi 
süt
 
is
 
com·tibË
 
w™h
 
the
 
BSD
 
š¡®l
 süt, 
but
 
was
 
wr™‹n


6 #äom 
sü©ch
.

9 #£ˆ
DOITPROG
 
to
 
echo
Ø
‹¡
 
this
 
süt


11 
	gdo™
="${DOITPROG:-}"

14 #puˆ
š
 
absŞu‹
 
·ths
 
you
 
dÚ
't havehem in your…ath; or useƒnv. vars.

16 
mv´og
="${MVPROG:-mv}"

17 
ı´og
="${CPPROG:-cp}"

18 
chmod´og
="${CHMODPROG:-chmod}"

19 
chowÅrog
="${CHOWNPROG:-chown}"

20 
chg½´og
="${CHGRPPROG:-chgrp}"

21 
¡r´og
="${STRIPPROG:-strip}"

22 
rm´og
="${RMPROG:-rm}"

24 
š¡cmd
="$mvprog"

25 
chmodcmd
=""

26 
chowncmd
=""

27 
chg½cmd
=""

28 
¡rcmd
=""

29 
rmcmd
="$rmprog -f"

30 
¤c
=""

31 
d¡
=""

33 [ 
x
"$1" != x ]; do

34 
$1
 
	gš


35 -
	gc
è
	gš¡cmd
="$cpprog"

36 
shiá


39 -
	gm
è
	gchmodcmd
="$chmodprog $2"

40 
shiá


41 
shiá


44 -
	go
è
	gchowncmd
="$chownprog $2"

45 
shiá


46 
shiá


49 -
	gg
è
	gchg½cmd
="$chgrpprog $2"

50 
shiá


51 
shiá


54 -
	gs
è
	g¡rcmd
="$stripprog"

55 
shiá


58 *è[ 
x
"$src" = x ]

59 
th’


60 
¤c
=
$1


62 
d¡
=
$1


63 
fi


64 
shiá


66 
e§c


67 
dÚe


69 [ 
x
"$src" = x ]

70 
th’


71 
echo
 "install:‚o input file specified"

72 
ex™
 1

73 
fi


75 [ 
x
"$dst" = x ]

76 
th’


77 
echo
 "install:‚o destination specified"

78 
ex™
 1

79 
fi


82 #ià
de¡š©iÚ
 
is
 
a
 
dœeùÜy
, 
­³nd
 
the
 
šput
 
f’ame
; 
your
 
sy¡em


83 #dÛ 
nÙ
 
like
 
¦ashes
 
š
 
f’ames
, 
you
 
may
 
Ãed
 
to
 
add
 
some
 
logic


85 [ -
d
 
$d¡
 ]

86 
th’


87 
	gd¡
="$d¡"/`
ba£Çme
 
$¤c
`

88 
fi


91 #g‘ 
rid
 
of
 
the
 
Şd
 
Úe
 
ªd
 
mode
h
Ãw
 oÃ 
š


93 
$do™
 
$rmcmd
 
$d¡


94 
$do™
 
$š¡cmd
 
$¤c
 
$d¡


97 #ªd 
£t
 
ªy
 
İtiÚs
; dØ
chmod
 
Ï¡
 
to
 
´e£rve
 
£tuid
 
b™s


99 [ 
x
"$chowncmd" !ğx ]; 
th’
 
$do™
 
$chowncmd
 
	g$d¡
; 
fi


100 [ 
x
"$chg½cmd" !ğx ]; 
th’
 
$do™
 
$chg½cmd
 
	g$d¡
; 
fi


101 [ 
x
"$¡rcmd" !ğx ]; 
th’
 
$do™
 
$¡rcmd
 
	g$d¡
; 
fi


102 [ 
x
"$chmodcmd" !ğx ]; 
th’
 
$do™
 
$chmodcmd
 
	g$d¡
; 
fi


104 
	gex™
 0

	@trunk/objs/openssl-1.0.1f/util/mkcerts.sh

1 #!/
bš
/
sh


3 #Thi 
süt
 
wl
 
»
-
make
 
®l
 
the
 
»quœed
 
û¹s
.

4 #cd 
­ps


5 #sh ../
ut
/
mkû¹s
.
sh


6 #mv 
ÿ
-
û¹
.
³m
 
pÿ
-û¹.³m ../
û¹s


8 #ÿˆ
û¹s


	@trunk/objs/openssl-1.0.1f/util/opensslwrap.sh

1 #!/
bš
/
sh


3 
	gHERE
="`echo $0 | sed -e 's|[^/]*$||'`"

4 
OPENSSL
="${HERE}../apps/openssl"

6 [ -
d
 "${HERE}../’gšes" -
a
 "x$OPENSSL_ENGINES" = "x" ]; 
th’


7 
	gOPENSSL_ENGINES
="${HERE}../’gšes"; 
expÜt
 
OPENSSL_ENGINES


8 
fi


10 [ -
x
 "${OPENSSL}.exe" ]; 
	gth’


11 #Th
Üigš®
 
»asÚ
 
this
 
süt
 
exi¡’û
 
is
 
to
 
wÜk
 
¬ound


12 #û¹aš 
ÿv—ts
 
š
 
run
-
time
 
lšk”
 
behaviour
. 
On
 
Wšdows
 
¶©fÜms


13 #adju¡šg 
$PATH
 
u£d
 
to
 
be
 
suffic›Á
, 
but
 
w™h
 
šŒoduùiÚ
 
of


14 #SaãDÎS—rchMod
š
 
XP
/2003 
the
 
Úly
 
way
 
to
 
g‘
 
™
 
right
 in

15 #*
®l
* 
possibË
 
s™u©iÚs
 
is
 
to
 
cİy
 
Ãwly
 
but
 .
DLLs
Ø
­ps
/

16 #ªd 
‹¡
/, 
which
 
is
 
now
 
dÚe
 
–£wh”e
... 
The
 
$PATH
 i 
adju¡ed


17 #fÜ 
backw¬d
 
com·tib™y
 (
ªd
 
no¡agiÿl
 
»asÚs
:-).

18 [ "$OSTYPE" !ğ
msdosdjgµ
 ]; 
th’


19 
	gPATH
="${HERE}..:$PATH"; 
expÜt
 
PATH


20 
fi


21 
	gexec
 "${OPENSSL}.exe" "$@"

22 
	g–if
 [ -
x
 "${OPENSSL}" -
a
 -x "${HERE}shlib_w¿p.sh" ]; 
th’


23 
	gexec
 "${HERE}shlib_wrap.sh" "${OPENSSL}" "$@"

25 
	gexec
 "${OPENSSL}" "$@" #hİ
the
 
	gbe¡
...

26 
	gfi


	@trunk/objs/openssl-1.0.1f/util/point.sh

1 #!/
bš
/
sh


3 
	grm
 -
	gf
 "$2"

4 
	g‹¡
 "$OSTYPE" = 
msdosdjgµ
 || 
‹¡
 "x$PLATFORM" = 
xmšgw
 ; 
th’


5 
	gı
 "$1" "$2"

7 
	gÊ
 -
	gs
 "$1" "$2"

8 
fi


9 
	gecho
 "$2 => $1"

	@trunk/objs/openssl-1.0.1f/util/shlib_wrap.sh

1 #!/
bš
/
sh


3 [ 
$
#-
Ã
 0 ] || 
	g£t
 -
	gx
 #debug 
mode
 
w™hout
 
	g¬gum’ts
:-)

5 
THERE
="`echo $0 | sed -e 's|[^/]*$||' 2>/dev/null`.."

6 [ -
d
 "${THERE}" ] || 
exec
 "$@" #should 
Ãv”
 
h­³n
...

8 #AÉ”Çtiv
to
 
this
 
is
Ø
·r£
 
$
{
THERE
}/
Makefe
...

9 
LIBCRYPTOSO
="${THERE}/libcrypto.so"

10 [ -
f
 "$LIBCRYPTOSO" ]; 
th’


11 [ -
h
 "$LIBCRYPTOSO" ]; do

12 
	gLIBCRYPTOSO
="${THERE}/`l -È"
$LIBCRYPTOSO
" | sed -e 's|.*\-> ||'`"

13 
dÚe


14 
SOSUFFIX
=`
echo
 
$
{
LIBCRYPTOSO
} | 
£d
 -
e
 's|.*\.so||' 2>/
dev
/
nuÎ
`

15 
LIBSSLSO
="${THERE}/libssl.so${SOSUFFIX}"

16 
fi


18 
SYSNAME
=`(
uÇme
 -
s
è2>/
dev
/
nuÎ
`;

19 "$SYSNAME" 
š


20 
	gSunOS
|
	gIRIX
*)

21 #SunOS 
ªd
 
IRIX
 
run
-
time
 
lšk”s
 
ev®u©e
 
®‹º©ive


22 #v¬ŸbË 
d•’dšg
 
Ú
 
rg‘
 
ABI
...

23 
	g¾d_v¬
=
LD_LIBRARY_PATH


24 "`(/u¤/bš/f"
$LIBCRYPTOSO
"è2>/dev/nuÎ`" 
š


25 *
ELF
\ 64*
SPARC
*|*ELF\ 64*
AMD64
*)

26 [ -
n
 "$LD_LIBRARY_PATH_64" ] && 
¾d_v¬
=
LD_LIBRARY_PATH_64


27 
LD_PRELOAD_64
="$LIBCRYPTOSO $LIBSSLSO"; 
expÜt
 LD_PRELOAD_64

28 
	g´–ßd_v¬
=
LD_PRELOAD_64


30 #Why 
¬e
 
Ãwly
 
but
 .
so
's…reloaded‡nyway? Because„un-time

31 #.
so
 
lookup
 
·th
 
embedded
 
što
 
­¶iÿtiÚ
 
kes
 
´eûd’û


32 #ov” 
LD_LIBRARY_PATH
 
ªd
 
as
 
»suÉ
 
­¶iÿtiÚ
 
’ds
 
up
 
lškšg


33 #tØ
´eviou¦y
 
š¡®Ëd
 .
so
's. On IRIX instead of…reloading

34 #Ãwly 
but
 .
so
's werick„un-time†inkero failo find

35 #th
š¡®Ëd
 .
so
 
by
 
£‰šg
 
_RLD_ROOT
 
v¬ŸbË
.

36 *
	gELF
\ 32*
	gMIPS
*)

37 #_RLD_LIST="$LIBCRYPTOSO:$LIBSSLSO:DEFAULT"; 
expÜt
 
_RLD_LIST


38 
	g_RLD_ROOT
=/
no
/
such
/
dœ
; 
expÜt
 
_RLD_ROOT


39 
ev®
 
	g$¾d_v¬
=\"/usr/lib'${'$rld_var':+:$'$rld_var'}'\"

40 
´–ßd_v¬
=
_RLD_LIST


42 *
	gELF
\ 
N32
*
	gMIPS
*)

43 [ -
n
 "$LD_LIBRARYN32_PATH" ] && 
	g¾d_v¬
=
LD_LIBRARYN32_PATH


44 #_RLDN32_LIST="$LIBCRYPTOSO:$LIBSSLSO:DEFAULT"; 
expÜt
 
_RLDN32_LIST


45 
	g_RLDN32_ROOT
=/
no
/
such
/
dœ
; 
expÜt
 
_RLDN32_ROOT


46 
ev®
 
	g$¾d_v¬
=\"/usr/lib32'${'$rld_var':+:$'$rld_var'}'\"

47 
´–ßd_v¬
=
_RLDN32_LIST


49 *
	gELF
\ 64*
	gMIPS
*)

50 [ -
n
 "$LD_LIBRARY64_PATH" ] && 
	g¾d_v¬
=
LD_LIBRARY64_PATH


51 #_RLD64_LIST="$LIBCRYPTOSO:$LIBSSLSO:DEFAULT"; 
expÜt
 
_RLD64_LIST


52 
	g_RLD64_ROOT
=/
no
/
such
/
dœ
; 
expÜt
 
_RLD64_ROOT


53 
ev®
 
	g$¾d_v¬
=\"/usr/lib64'${'$rld_var':+:$'$rld_var'}'\"

54 
´–ßd_v¬
=
_RLD64_LIST


56 
e§c


57 
ev®
 
	g$¾d_v¬
=\"${THERE}'${'$rld_var':+:$'$rld_var'}'\";ƒxport $rld_var

58 
un£t
 
¾d_v¬


60 *è
	gLD_LIBRARY_PATH
="${THERE}:$LD_LIBRARY_PATH" #Lšux, 
ELF
 
	gHP
-
UX


61 
	gDYLD_LIBRARY_PATH
="${THERE}:$DYLD_LIBRARY_PATH" #MacOS 
X


62 
SHLIB_PATH
="${THERE}:$SHLIB_PATH" #Ëgacy 
HP
-
UX


63 
LIBPATH
="${THERE}:$LIBPATH" #AIX, 
	gOS
/2

64 
expÜt
 
LD_LIBRARY_PATH
 
DYLD_LIBRARY_PATH
 
SHLIB_PATH
 
	gLIBPATH


65 #Ev’ 
though
 
$PATH
 
is
 
adju¡ed
 [
Wšdows
 
§ke
], 
™
 
dÛ¢
't

66 #Ãûs§ry 
dÛs
 
the
 
Œick
. 
TroubË
 
is
 
th©
 
w™h
 
šŒoduùiÚ


67 #oà
SaãDÎS—rchMode
 
š
 
XP
/2003 
™
's more‡ppropriateo copy

68 #.
DLLs
 
š
 
vicš™y
 
of
 
execubË
, 
which
 
is
 
dÚe
 
–£wh”e
...

69 [ "$OSTYPE" !ğ
msdosdjgµ
 ]; 
th’


70 
	gPATH
="${THERE}:$PATH"; 
expÜt
 
PATH


71 
	gfi


73 
e§c


75 [ -
f
 "$LIBCRYPTOSO" -
a
 -
z
 "$´–ßd_v¬" ]; 
	gth’


76 #FŞlowšg 
th»e
 
lšes
 
¬e
 
majÜ
 
excu£
 
isŞ©šg
 
them
 
što


77 #thi 
w¿µ”
 
süt
. 
Origš®
 
»asÚ
 
£‰šg
 
LD_PRELOAD


78 #wa 
to
 
make
 
™
 
possibË
Ø
·ss
 'mak‹¡' 
wh’
 
u£r
 
lšked


79 #w™h -
½©h
 
poštšg
 
to
 
´evious
 
v”siÚ
 
š¡®ÏtiÚ
. 
W¿µšg


80 #™ 
što
 
a
 
süt
 
makes
 
™
 
possibË
 
to
 dØ
so
 
Ú
 
muÉi
-
ABI


82 "$SYSNAME" 
š


83 *
	gBSD
|
	gQNX
è
	gLD_PRELOAD
="$LIBCRYPTOSO:$LIBSSLSO" ;; #*BSD, QNX

84 *è
	gLD_PRELOAD
="$LIBCRYPTOSO $LIBSSLSO" ;; #SunOS, 
	gLšux
, 
ELF
 
	gHP
-
UX


85 
e§c


86 
	g_RLD_LIST
="$LIBCRYPTOSO:$LIBSSLSO:DEFAULT" #Tru64, 
o32
 
IRIX


87 
	gDYLD_INSERT_LIBRARIES
="$LIBCRYPTOSO:$LIBSSLSO" #MacOS 
X


88 
expÜt
 
LD_PRELOAD
 
_RLD_LIST
 
DYLD_INSERT_LIBRARIES


89 
fi


91 
cmd
="$1${EXE_EXT}"

92 
shiá


93 [ 
$
#-
eq
 0 ]; 
th’


94 
	gexec
 "$cmd" #Şd 
	gsh
, 
such
 
as
 
	gTru64
 4.x, 
çs
 
to
 
ex·nd
 
	gem±y
 "$@"

96 
	gexec
 "$cmd" "$@"

97 
	gfi


	@trunk/objs/openssl-1.0.1f/util/speed.sh

1 #!/
bš
/
sh


3 #
#Thi 
is
 
a
 
ugly
 
süt
 
u£
, 
š
 
cÚjuùiÚ
 
w™h
 
ed™šg
 
the
 'b'

4 #cÚfigu¿tiÚ 
š
 
the
 
$
(
TOP
)/
CÚfigu»
 
süt
 
which
 
wl


5 #ouuˆ
wh’
 
fšished
 
a
 
fe
 
ÿÎed
 
¥“d
.
log
 
which
 
is
 
the


6 #timšg 
of
 
SSL—y
 
w™h
 
v¬ious
 
İtiÚs
 
tuºed
 
Ú
 
Ü
 
off
.

7 #
#äom 
the
 
$
(
TOP
è
dœeùÜy


8 #Ed™ 
CÚfigu»
, 
modifyšg
 
thšgs
 
to
 dØ
w™h
 
the
 
b
/
bl
-4c-2ø
‘c


11 
make
 
ş—n


12 
³¾
 
CÚfigu»
 
b


13 
make


14 
	g­ps
/
s¦—y
 
	gv”siÚ
 -
	gv
 -
	gb
 -
	gf
 >
	g¥“d
.1

15 
	g­ps
/
s¦—y
 
	g¥“d
 >speed.1l

17 
³¾
 
CÚfigu»
 
	gbl
-4c-2c

18 /
	gbš
/
	grm
 -
f
 
	güy±o
/
	grc4


	@trunk/objs/openssl-1.0.1f/util/x86asm.sh

1 #!/
bš
/
sh


3 
echo
 
G’”©šg
 
x86
 
as£mb”


4 
echo
 
	gBignum


5 (
cd
 
	güy±o
/
	gbn
/
	gasm
; 
³¾
 
	gx86
.
¶
 
	gıp
 > 
	gbn86unix
.cpp)

6 (
cd
 
	güy±o
/
	gbn
/
	gasm
; 
³¾
 
	gx86
.
¶
 
	gwš32
 > bn-win32.asm)

8 
echo
 
	gDES


9 (
cd
 
	güy±o
/
	gdes
/
	gasm
; 
³¾
 des-586.
¶
 
	gıp
 > 
	gdx86unix
.cpp)

10 (
cd
 
	güy±o
/
	gdes
/
	gasm
; 
³¾
 des-586.
¶
 
	gwš32
 > 
	gd
-win32.asm)

12 
	gecho
 "crypt(3)"

13 (
cd
 
	güy±o
/
	gdes
/
	gasm
; 
³¾
 
	güy±586
.
¶
 
	gıp
 > 
	gyx86unix
.cpp)

14 (
cd
 
	güy±o
/
	gdes
/
	gasm
; 
³¾
 
	güy±586
.
¶
 
	gwš32
 > 
	gy
-win32.asm)

16 
echo
 
	gBlowfish


17 (
cd
 
	güy±o
/
	gbf
/
	gasm
; 
³¾
 bf-586.
¶
 
	gıp
 > 
	gbx86unix
.cpp)

18 (
cd
 
	güy±o
/
	gbf
/
	gasm
; 
³¾
 bf-586.
¶
 
	gwš32
 > 
	gb
-win32.asm)

20 
echo
 
	gCAST5


21 (
cd
 
	güy±o
/
	gÿ¡
/
	gasm
; 
³¾
 ca¡-586.
¶
 
	gıp
 > 
	gcx86unix
.cpp)

22 (
cd
 
	güy±o
/
	gÿ¡
/
	gasm
; 
³¾
 ca¡-586.
¶
 
	gwš32
 > 
	gc
-win32.asm)

24 
echo
 
	gRC4


25 (
cd
 
	güy±o
/
	grc4
/
	gasm
; 
³¾
„c4-586.
¶
 
	gıp
 > 
	grx86unix
.cpp)

26 (
cd
 
	güy±o
/
	grc4
/
	gasm
; 
³¾
„c4-586.
¶
 
	gwš32
 > 
	gr4
-win32.asm)

28 
echo
 
	gMD5


29 (
cd
 
	güy±o
/
	gmd5
/
	gasm
; 
³¾
 md5-586.
¶
 
	gıp
 > 
	gmx86unix
.cpp)

30 (
cd
 
	güy±o
/
	gmd5
/
	gasm
; 
³¾
 md5-586.
¶
 
	gwš32
 > 
	gm5
-win32.asm)

32 
echo
 
	gSHA1


33 (
cd
 
	güy±o
/
	gsha
/
	gasm
; 
³¾
 
	gsha1
-586.
¶
 
	gıp
 > 
	gsx86unix
.cpp)

34 (
cd
 
	güy±o
/
	gsha
/
	gasm
; 
³¾
 
	gsha1
-586.
¶
 
	gwš32
 > 
	gs1
-win32.asm)

36 
echo
 
	gRIPEMD160


37 (
cd
 
	güy±o
/
	gremd
/
	gasm
; 
³¾
 
	grmd
-586.
¶
 
	gıp
 > 
	grm86unix
.cpp)

38 (
cd
 
	güy±o
/
	gremd
/
	gasm
; 
³¾
 
	grmd
-586.
¶
 
	gwš32
 > 
	grm
-win32.asm)

40 
echo
 
	gRC5
/32

41 (
cd
 
	güy±o
/
	grc5
/
	gasm
; 
³¾
„c5-586.
¶
 
	gıp
 > 
	gr586unix
.cpp)

42 (
cd
 
	güy±o
/
	grc5
/
	gasm
; 
³¾
„c5-586.
¶
 
	gwš32
 > 
	gr5
-win32.asm)

	@trunk/objs/st-1.9/docs/notes.html

1 <
	gHTML
>

2 <
	gHEAD
>

3 <
	gTITLE
>
S‹
 
Th»ads
 
Lib¿ry
 
Prog¿mmšg
 
	gNÙes
</TITLE>

4 </
	gHEAD
>

5 <
BODY
 
	gBGCOLOR
=#FFFFFF>

6 <
H2
>
Prog¿mmšg
 
NÙes
</H2>

7 <
P
>

8 <
B
>

9 <
UL
>

10 <
LI
><
A
 
HREF
=#pÜtšg>
PÜtšg
</A></LI>

11 <
LI
><
A
 
HREF
=#sigÇls>
SigÇls
</A></LI>

12 <
LI
><
A
 
HREF
=#šŒa>
IÁ¿
-
Proûss
 
SynchrÚiz©iÚ
</A></LI>

13 <
LI
><
A
 
HREF
=#š‹r>
IÁ”
-
Proûss
 
SynchrÚiz©iÚ
</A></LI>

14 <
LI
><
A
 
HREF
=#nÚÃt>
NÚ
-
N‘wÜk
 
I
/
O
</A></LI>

15 <
LI
><
A
 
HREF
=#timeouts>
Timeouts
</A></LI>

16 </
UL
>

17 </
B
>

18 <
P
>

19 <
HR
>

20 <
P
>

21 <
A
 
NAME
="porting">

22 <
H3
>
PÜtšg
</H3>

23 
The
 
S‹
 
Th»ads
 
lib¿ry
 
u£s
 
OS
 
cÚû±s
 
th©
 
¬e
 
avaabË
 
š
 
some


24 
fÜm
 
Ú
 
mo¡
 
UNIX
 
¶©fÜms
, 
makšg
 
the
 
lib¿ry
 
v”y
 
pÜbË
 
aüoss


25 
mªy
 
æavÜs
 
of
 
	gUNIX
. 
	gHowev”
, 
th”e
 
¬e
 
£v”®
 
·¹s
 oà
the
 
lib¿ry


26 
th©
 
»ly
 
Ú
 
	g¶©fÜm
-
¥ecific
 
	gã©u»s
. 
H”e
 
is
 
the
 
li¡
 
of
 
such
 
	g·¹s
:

27 <
P
>

28 <
UL
>

29 <
LI
><
I
>
Th»ad
 
cÚ‹xt
 
š™Ÿliz©iÚ
</I>: 
Two
 
šg»d›Ás
 
of
 
the


30 <
TT
>
jmp_buf
</TT>

31 
d©a
 
	$¡ruùu»
 (
the
 
´og¿m
 
couÁ”
 
ªd
h
¡ack
 
poš‹r
è
have
 
to
 
be


32 
mªu®ly
 
£t
 
š
 
the
 
th»ad
 
ü—tiÚ
 
routše
. 
The
 <
TT
>
jmp_buf
</TT> 
d©a


33 
¡ruùu»
 
is
 
defšed
 
š
 
the
 <
TT
>
£tjmp
.
h
</TT> 
h—d”
 
fe
 
ªd
 
difãrs
 
äom


34 
¶©fÜm
 
to
…ÏtfÜm. 
Usu®ly
 
the
 
´og¿m
 
couÁ”
 
is
 
a
 
¡ruùu»
 
memb”


35 
w™h
 <
TT
>
PC
</TT> 
š
 
the
 
Çme
 
ªd
h
¡ack
 
poš‹r
 
is
 
a
 
¡ruùu»
 
memb”


36 
w™h
 <
TT
>
SP
</TT> 
š
 
the
 
Çme
. 
OÃ
 
ÿn
 
®so
 
look
 inhe

37 <
A
 
HREF
="h‰p://www.mozÏ.Üg/sourû.html">
N‘sÿ³
's NSPR†ibrary source</A>

38 
which
 
®»ady
 
has
 
this
 
code
 
mªy
 
UNIX
-
like
 
¶©fÜms


39 (<
TT
>
mozÏ
/
n¥½ub
/
´
/
šşude
/
md


123 
sig_pe
[2];

127 
	$sig_ÿtch”
(
signo
)

129 
”r
;

132 
”r
 = 
”ºo
;

134 
	`wr™e
(
sig_pe
[1], &
signo
, ());

135 
”ºo
 = 
”r
;

136 
	}
}

140 *
	$sig_´oûss
(*
¬g
)

142 
¡_Ãtfd_t
 
nfd
;

143 
signo
;

145 
nfd
 = 
	`¡_Ãtfd_İ’
(
sig_pe
[0]);

149 
	`¡_»ad
(
nfd
, &
signo
, (), 
ST_UTIME_NO_TIMEOUT
);

152 
signo
) {

153 
SIGHUP
:

156 
SIGTERM
:

168  
NULL
;

169 
	}
}

171 
	$maš
(
¬gc
, *
¬gv
[])

173 
sigaùiÚ
 
§
;

179 
	`pe
(
sig_pe
);

182 
	`¡_th»ad_ü—‹
(
sig_´oûss
, 
NULL
, 0, 0);

185 
§
.
§_hªdËr
 = 
sig_ÿtch”
;

186 
	`sigem±y£t
(&
§
.
§_mask
);

187 
§
.
§_æags
 = 0;

188 
	`sigaùiÚ
(
SIGHUP
, &
§
, 
NULL
);

190 
§
.
§_hªdËr
 = 
sig_ÿtch”
;

191 
	`sigem±y£t
(&
§
.
§_mask
);

192 
§
.
§_æags
 = 0;

193 
	`sigaùiÚ
(
SIGTERM
, &
§
, 
NULL
);

199 
	}
}

201 </
	gPRE
>

202 <
	gP
>

203 
NÙe
 
th©
 
muÉË
 
´oûs£s
 
¬e
 
u£d
 (
£e
 
b–ow
), 
the
 
sigÇl
 
pe
 
should


204 
be
 
š™Ÿlized
 
aá”
 
	gthe
 <
	gTT
>
fÜk
(2)</TT> 
ÿÎ
 
so
 
th©
 
—ch
 
´oûss
 
has
 
™s


205 
own
 
´iv©e
 
	gpe
.

206 <
	gP
>

208 <
A
 
	gNAME
="intra">

209 <
H3
>
IÁ¿
-
Proûss
 
SynchrÚiz©iÚ
</H3>

210 
Due
 
to
 
the
 
ev’t
-
driv’
 
Çtu»
 
of
h
lib¿ry
 
scheduËr
,h
th»ad
 
cÚ‹xt


211 
´oûss
 
¡©e
 
chªge
è
ÿn
 
Úly
 
h­³n
 
š
 
a
 
w–l
-
known
 
£t
 
of


212 
lib¿ry
 
funùiÚs
. 
This
 
£t
 
šşudes
 funùiÚ 
š
 
which
 
a
 
th»ad
 
may


213 "block":<
TT
> </TT>
I
/
O
 
	`funùiÚs
 (<TT>
	`¡_»ad
(), 
	`¡_wr™e
(), </TT>
‘c
.),

214 
¦“p
 
	`funùiÚs
 (<
TT
>
	`¡_¦“p
(), </TT>
‘c
.), 
ªd
 
th»ad
 
synchrÚiz©iÚ


215 
	`funùiÚs
 (<
TT
>
	`¡_th»ad_još
(), 
	`¡_cÚd_wa™
(), </TT>
‘c
.). 
As
 
a
 
»suÉ
,

216 
´oûss
-
¥ecific
 
glob®
 
d©a
 
Ãed
 
nÙ
 
to
 
be
 
´Ùeùed
 
by
 
locks
 
sšû
 
a
 
th»ad


217 
ÿÂÙ
 
be
 
»scheduËd
 
š
 
a
 
ü™iÿl
 
	`£ùiÚ
 (
ªd
 
Úly
 
Úe
 
th»ad
 
©
‡

218 
time
 
ÿn
 
acûss
 
the
 
§me
 
memÜy
 
loÿtiÚ
). 
By
h§m
tok’
,

219 
nÚ
 
th»ad
-
§ã
 
	$funùiÚs
 (
š
 
a
 
Œad™iÚ®
 
£n£
è
ÿn
 
be
 
§ãly
 
u£d
 
w™h


220 
the
 
S‹
 
Th»ads
. 
The
 
lib¿ry
's mutex facilities‡re…ractically useless

221 
a
 
cÜ»ùly
 
wr™‹n
 
	$­¶iÿtiÚ
 (
no
 
blockšg
 
funùiÚs
 
š
 
ü™iÿl


222 
£ùiÚ
è
ªd
 
¬e
 
´ovided
 
mo¡ly
 
com¶‘’ess
. 
This
 
ab£nû
 
of
 
lockšg


223 
g»©ly
 
sim¶if›s
 
ª
 
­¶iÿtiÚ
 
design
 
ªd
 
´ovides
 
a
 
found©iÚ
 

224 
sÿÏb™y
.

225 <
P
>

227 <
A
 
NAME
="inter">

228 <
H3
>
IÁ”
-
Proûss
 
SynchrÚiz©iÚ
</H3>

229 
The
 
S‹
 
Th»ads
 
lib¿ry
 
makes
 
™
 
possibË
 
to
 
muÉËx
 
a
 
Ïrge
 
numb”


230 
of
 
simuÉªeous
 
cÚÃùiÚs
 
Úto
 
a
 
much
 
sm®Ër
 
numb”
 oà
£·¿‹


231 
´oûs£s
, 
wh”e
 
—ch
 
´oûss
 
u£s
 
a
 
mªy
-
to
-
Úe
 
u£r
-
Ëv–
 
th»adšg


232 
	`im¶em’tiÚ
 (<
B
>
N
</B> 
of
 <B>
M
:1</B> 
m­pšgs
 
¿th”
 
thª
 
Úe
 <B>M:N</B>

233 
m­pšg
 
u£d
 
š
 
Çtive
 
th»adšg
 
lib¿r›s
 
Ú
 
some
 
¶©fÜms
). 
This
 
design


234 
is
 
key
 
to
 
the
 
­¶iÿtiÚ
's scalability. One canhink‡bout it‡s if‡

235 
£t
 
of
 
®l
 
th»ads
 
is
 
·¹™iÚed
 
što
 
£·¿‹
 
	$groups
 (
´oûs£s
è
wh”e


236 
—ch
 
group
 
has
 
a
 
£·¿‹
 
poŞ
 
of
 
	`»sourûs
 (
vœtu®
 
add»ss
 
¥aû
, 
fe


237 
desütÜs
, 
‘c
.). 
An
 
­¶iÿtiÚ
 
desigÃr
 
has
 
fuÎ
 
cÚŒŞ
 
of
 
how
 
mªy


238 
	$groups
 (
´oûs£s
è
ª
 
­¶iÿtiÚ
 
ü—‹s
 
ªd
 
wh©
 
»sourûs
, 
ªy
,

239 
¬e
 
sh¬ed
 
amÚg
 
difã»Á
 
groups
 
vŸ
 
¡ªd¬d
 
UNIX
 
š‹r
-
´oûss


240 
	$communiÿtiÚ
 (
IPC
è
çc™›s
.<
P
>

241 
Th”e
 
¬e
 
£v”®
 
»asÚs
 
ü—tšg
 
muÉË
 
´oûs£s
:

242 <
P
>

243 <
UL
>

244 <
LI
>
To
 
ke
 
advªge
 
of
 
muÉË
 
h¬dw¬e
 
	$’t™›s
 (
CPUs
, 
disks
, 
‘c
.)

245 
avaabË
 
š
 
the
 
	`sy¡em
 (
h¬dw¬e
 
·¿Î–ism
).</
LI
>

246 <
P
>

247 <
LI
>
To
 
»duû
 
risk
 
of
 
losšg
 
a
 
Ïrge
 
numb”
 oà
u£r
 
cÚÃùiÚs
 
wh’
 
Úe
 of

248 
the
 
´oûs£s
 
üashes
. 
FÜ
 
exam¶e
, <
B
>
C
</B> 
u£r
 
	$cÚÃùiÚs
 (
th»ads
)

249 
¬e
 
muÉËxed
 
Úto
 <
B
>
P
</B> 
´oûs£s
 
ªd
 
Úe
 
of
 
the
…roûs£ 
üashes
,

250 
Úly
 
a
 
	`äaùiÚ
 (<
B
>
C
/
P
</B>è
of
 
®l
 
cÚÃùiÚs
 
wl
 
be
 
lo¡
.</
LI
>

251 <
P
>

252 <
LI
>
To
 
ov”come
 
³r
-
´oûss
 
»sourû
 
lim™©iÚs
 
impo£d
 
by
 
the
 
OS
. 
FÜ


253 
exam¶e
, <
TT
>
	`£Ëù
(2)</TT> 
is
 
u£d
 
ev’t
 
pŞlšg
, 
the
 
numb”
 
of


254 
simuÉªeous
 
	$cÚÃùiÚs
 (
th»ads
è
³r
 
´oûss
 
is


255 
lim™ed
 
by
 
the
 <
TT
>
FD_SETSIZE
</TT> 
	`·¿m‘”
 (
£e
 <TT>
	`£Ëù
(2)</TT>).

256 
If
 <
TT
>
FD_SETSIZE
</TT> 
is
 
equ®
 
to
 1024 
ªd
 
—ch
 
cÚÃùiÚ
 
Ãeds
 
Úe
 
fe


257 
desütÜ
, 
th’
 
ª
 
­¶iÿtiÚ
 
should
 
ü—‹
 10 
´oûs£s
 
to
 
suµÜt
 10,000

258 
simuÉªeous
 
cÚÃùiÚs
.</
LI
>

259 </
UL
>

260 <
P
>

261 
Id—Îy
 
®l
 
u£r
 
£ssiÚs
 
¬e
 
com¶‘–y
 
šd•’d’t
, 
so
 
th”e
 
is
 
no
 
Ãed
 

262 
š‹r
-
´oûss
 
communiÿtiÚ
. 
It
 
is
 
®ways
 
b‘‹r
 
to
 
have
 
£v”®
 
£·¿‹


263 
sm®Ër
 
´oûss
-
¥ecific
 
	$»sourûs
 (
e
.
g
., 
d©a
 
ÿches
è
thª
 
to
 
have
 
Úe
 
Ïrge


264 
»sourû
 
	$sh¬ed
 (
ªd
 
modif›d
è
by
 
®l
 
´oûs£s
. 
Som‘imes
, 
howev”
, 
th”e


265 
is
 
a
 
Ãed
 
to
 
sh¬e
‡ 
commÚ
 
»sourû
 
amÚg
 
difã»Á
 
´oûs£s
. 
In
 
th©
 ,

266 
¡ªd¬d
 
UNIX
 
IPC
 
çc™›s
 
ÿn
 
be
 
u£d
. 
In
 
add™iÚ
 
to
 
th©
, 
th”e
 
is
 
a
 
way


267 
to
 
synchrÚize
 
difã»Á
 
´oûs£s
 
so
 
th©
 
Úly
 
the
 
th»ad
 
acûssšg
he

268 
sh¬ed
 
»sourû
 
wl
 
be
 
	$su¥’ded
 (
but
 
nÙ
 
the
 
’tœe
 
´oûss
è
th©
 
»sourû


269 
is
 
uÇvaabË
. 
In
 
the
 
fŞlowšg
 
code
 
äagm’t
 
a
 
pe
 i 
u£d
 
as
‡ 
couÁšg


270 
£m­hÜe
 
š‹r
-
´oûss
 
synchrÚiz©iÚ
:

271 <
PRE
>

272 #iâdeà
PIPE_BUF


273 
	#PIPE_BUF
 512

	)

277 
	sc_£m
 {

278 
¡_Ãtfd_t
 
rdfd
;

279 
¡_Ãtfd_t
 
wrfd
;

280 } 
	tc_£m_t
;

285 
c_£m_t
 *
	$c_£m_ü—‹
(
v®ue
)

287 
c_£m_t
 *
£m
;

288 
p
[2];

289 
b
[
PIPE_BUF
];

292 
£m
 = 
	`m®loc
((
c_£m_t
));

295 
	`pe
(
p
);

296 
£m
->
rdfd
 = 
	`¡_Ãtfd_İ’
(
p
[0]);

297 
£m
->
wrfd
 = 
	`¡_Ãtfd_İ’
(
p
[1]);

300 
	`wr™e
(
p
[1], 
b
, 
v®ue
);

302  
£m
;

303 
	}
}

307 
	$c_£m_wa™
(
c_£m_t
 *
£m
)

309 
c
;

312 ià(
	`¡_»ad
(
£m
->
rdfd
, &
c
, 1, 
ST_UTIME_NO_TIMEOUT
) != 1)

316 
	}
}

319 
	$c_£m_po¡
(
c_£m_t
 *
£m
)

321 
c
;

323 ià(
	`¡_wr™e
(
£m
->
wrfd
, &
c
, 1, 
ST_UTIME_NO_TIMEOUT
) != 1)

327 
	}
}

329 </
	gPRE
>

330 <
	gP
>

332 
	gG’”®ly
, 
the
 
fŞlowšg
 
¡•s
 
should
 
be
 
fŞlowed
 
wh’
 
wr™šg
 
ª
 
­¶iÿtiÚ


333 
usšg
 
the
 
S‹
 
Th»ads
 
	glib¿ry
:

334 <
P
>

335 <
OL
>

336 <
LI
>
In™Ÿlize
 
the
 
lib¿ry
 (<
TT
>
¡_š™
()</TT>).</LI>

337 <
P
>

338 <
LI
>
C»©e
 
»sourûs
 
th©
 
wl
 
be
 
sh¬ed
 
amÚg
 
difã»Á
 
´oûs£s
:

339 
ü—‹
 
ªd
 
bšd
 
li¡’šg
 
sock‘s
, c»©
sh¬ed
 
memÜy
 
	g£gm’ts
, 
IPC


340 
	gchªÃls
, 
synchrÚiz©iÚ
 
	g´im™ives
, 
	g‘c
.</
	gLI
>

341 <
	gP
>

342 <
	gLI
>
C»©e
 
£v”®
 
´oûs£s
 (<
TT
>
fÜk
(2)</TT>). 
The
 
·»Á
 
´oûss
 
should


343 
e™h”
 
ex™
 
Ü
 
become
 
	ga
 "w©chdog" (
	ge
.
	gg
., 
™
 
¡¬ts
 
a
 
Ãw
 
´oûss
 
wh’


344 
ª
 
exi¡šg
 
Úe
 
	güashes
, 
dÛs
 
a
 
ş—nup
 
upÚ
 
­¶iÿtiÚ
 
	g‹rmš©iÚ
,

345 
	g‘c
.).</
	gLI
>

346 <
	gP
>

347 <
	gLI
>
In
 
—ch
 
chd
 
´oûss
 
ü—‹
 
a
 
poŞ
 
of
 
	gth»ads


348 (<
	gTT
>
¡_th»ad_ü—‹
()</TT>è
to
 
hªdË
 
u£r
 
	gcÚÃùiÚs
.</
	gLI
>

349 </
	gOL
>

350 <
	gP
>

352 <
A
 
	gNAME
="nonnet">

353 <
H3
>
NÚ
-
N‘wÜk
 
I
/
O
</H3>

355 
The
 
S‹
 
Th»ads
 
¬ch™eùu»
 
u£s
 
nÚ
-
blockšg
 
I
/
O
 
Ú


356 <
TT
>
¡_Ãtfd_t
</TT> 
objeùs
 
cÚcu¼’t
 
´oûssšg
 
of
 
muÉË
 
u£r


357 
cÚÃùiÚs
. 
This
 
¬ch™eùu»
 
has
 
a
 
d¿wback
: 
the
 
’tœe
 
´oûss
 
ªd


358 
®l
 
™s
 
th»ads
 
may
 
block
 
the
 
du¿tiÚ
 
of
 
a
 <
I
>
disk
</I> 
Ü
 
Ùh”


359 
nÚ
-
ÃtwÜk
 
I
/
O
 
İ”©iÚ
, 
wh‘h”
 
through
 
S‹
 
Th»ads
 
	gI
/O 
	gfunùiÚs
,

360 
dœeù
 
sy¡em
 
	gÿÎs
, 
Ü
 
¡ªd¬d
 
	gI
/
O
 
	gfunùiÚs
. (
This
 
is
 
­¶iÿbË


361 
mo¡ly
 
to
 
	gdisk
 <
	gI
>
	g»ads
</I>; disk <I>
	gwr™es
</I> 
¬e
 
usu®ly
 
³rfÜmed


362 
	gasynchrÚou¦y
 -- 
d©a
 
gÛs
 
to
 
the
 
bufãr
 
ÿche
Ø
be
 
wr™‹n
Ø
disk


363 
	gÏ‹r
.è
	gFÜtuÇ‹ly
, 
disk
 
	gI
/
O
 (
uÆike
 
ÃtwÜk
 
I
/Oè
usu®ly
 
kes
 
a


364 
fš™e
 
ªd
 
´ediùabË
 
amouÁ
 
of
 
	gtime
, 
but
 
this
 
may
 
nÙ
 
be
 
Œue
 

365 
¥ecŸl
 
deviûs
 
Ü
 
u£r
 
šput
 deviû (
šşudšg
 
¡dš
). 
	gNev”th–ess
,

366 
such
 
	gI
/
O
 
»duûs
 
throughput
 
of
 
the
 
sy¡em
 
ªd
 
šü—£s
 
»¥Ú£
 
	gtimes
.

367 
Th”e
 
¬e
 
£v”®
 
ways
 
to
 
design
 
ª
 
­¶iÿtiÚ
Ø
ov”come
 
this


368 
	gd¿wback
:

370 <
P
>

371 <
UL
>

372 <
LI
>
C»©e
 
£v”®
 
id’tiÿl
 
maš
 
´oûs£s
 
as
 
desüibed
 
above
 (
symm‘ric


373 
¬ch™eùu»
). 
This
 
wl
 
im´ove
 
CPU
 
utiz©iÚ
 
ªd
 
thus
 im´ov
the


374 
ov”®l
 
throughput
 
of
 
the
 
sy¡em
.</
LI
>

375 <
P
>

376 <
LI
>
C»©e
 
muÉË
 "h–³r" 
´oûs£s
 
š
 
add™iÚ
 
to
 
the
 
maš
 
´oûss
 
th©


377 
wl
 
hªdË
 
blockšg
 
I
/
O
 
İ”©iÚs
 (
asymm‘ric
 
¬ch™eùu»
).

378 
This
 
­´ßch
 
was
 
sugge¡ed
 
Web
 
£rv”s
 
š
 
a


379 <
A
 
HREF
="h‰p://www.cs.riû.edu/~vivek/æash99/">
·³r
</A> 
by
 
P‘”


380 
Drusch–
 
‘
 
®
. 
In
 
this
 
¬ch™eùu»
 
the
 
maš
 
´oûss
 
communiÿ‹s
 
w™h


381 
a
 
h–³r
 
´oûss
 
vŸ
 
ª
 
IPC
 
chªÃl
 (<
TT
>
pe
(2), 
sock‘·œ
(2)</TT>).

382 
The
 
maš
 
´oûss
 
š¡ruùs
 
a
 
h–³r
 
to
 
³rfÜm
 
the
 
pÙ’tŸÎy
 
blockšg


383 
	gİ”©iÚ
. 
Onû
 
the
 
İ”©iÚ
 
	gcom¶‘es
,h
h–³r
 
»tuºs
 
a


384 
nÙifiÿtiÚ
 
vŸ
 
	gIPC
.

385 </
	gUL
>

386 <
	gP
>

388 <
A
 
	gNAME
="timeouts">

389 <
H3
>
Timeouts
</H3>

391 
The
 <
TT
>
timeout
</TT> 
·¿m‘”
 
to
 <TT>
¡_cÚd_timedwa™
()</TT> 
ªd
 
the


392 
I
/
O
 
funùiÚs
, 
ªd
 
the
 
¬gum’ts
 
	gto
 <
	gTT
>
¡_¦“p
()</TT> 
	gªd


393 <
	gTT
>
¡_u¦“p
()</TT> 
¥ecify
 
a
 
maximum
 
time
 
to
 
	gwa™
 <
	gI
>
sšû
 
the
 
Ï¡


394 
cÚ‹xt
 </
	gI
> 
nÙ
 
sšû
 
the
 
begšnšg
 
of
h
funùiÚ
 
	gÿÎ
.

396 <
	gP
>
The
 
S‹
 
	gTh»ads
'ime„esolution is‡ctuallyheime interval

397 
b‘w“n
 
cÚ‹xt
 
	gsw™ches
. 
Th©
 
time
 
š‹rv®
 
may
 
be
 
Ïrge
 
š
 
some


398 
	gs™u©iÚs
, 
	gexam¶e
, 
wh’
 
a
 
sšgË
 
th»ad
 
dÛs
‡ 
lÙ
 
of
 
wÜk


399 
	gcÚtšuou¦y
. 
NÙe
 
th©
 
a
 
	g¡—dy
, 
unš‹¼u±ed
 
¡»am
 
of
 
ÃtwÜk
 
	gI
/
O


400 
qu®if›s
 
this
 
	gdesütiÚ
; 
a
 
cÚ‹xt
 
occurs
 
Úly
 
wh’
‡

401 
th»ad
 
	gblocks
.

403 <
	gP
>
If
 
a
 
¥ecif›d
 
	gI
/
O
 
timeout
 
is
 
Ëss
 
thª
 
the
 
time
 
š‹rv®
 
b‘w“n


404 
cÚ‹xt
 
sw™ches
 
the
 
funùiÚ
 
may
  
w™h
 
a
 
timeout
 
”rÜ
 
befÜe


405 
th©
 
amouÁ
 
of
 
time
 
has
 
–­£d
 
sšû
 
the
 
begšnšg
 oàth
funùiÚ


406 
	gÿÎ
. 
FÜ
 
	gexam¶e
, 
eight
 
mli£cÚds
 
have
 
·s£d
 
sšû
 
the
 
Ï¡


407 
cÚ‹xt
 
ªd
 
ª
 
	gI
/
O
 
funùiÚ
 
w™h
 
a
 
timeout
 
	gof
 10 
mli£cÚds


408 
	gblocks
, 
ÿusšg
 
a
 , 
the
 
ÿÎ
 
may
  
w™h
‡ 
timeout
 
”rÜ
 
as


409 
l™e
 
as
 
two
 
mli£cÚds
 
aá”
 
™
 
was
 
	gÿÎed
. (
On
 
	gLšux
,

410 <
	gTT
>
£Ëù
()</TT>'simeout is‡n <I>upper</I> bound onhe‡mount of

411 
time
 
–­£d
 
befÜe
 
£Ëù
 
	g»tuºs
.è
	gSim¬ly
, 12 
ms
 
have
 
·s£d


412 
	g®»ady
, 
the
 
funùiÚ
 
may
  
	gimmedŸ‹ly
.

414 <
	gP
>
In
 
®mo¡
 
®l
 
ÿ£s
 
	gI
/
O
 
timeouts
 
should
 
be
 
u£d
 
Úly
 
d‘eùšg
 
a


415 
brok’
 
ÃtwÜk
 
cÚÃùiÚ
 
Ü
 
´ev’tšg
 
a
 
³”
 
äom
 
hŞdšg
 
ª
 
idË


416 
cÚÃùiÚ
 
too
 . 
Th”efÜe
 
mo¡
 
­¶iÿtiÚs
 
»®i¡ic
 
	gI
/
O


417 
timeouts
 
should
 
be
 
Ú
 
the
 
Üd”
 
of
 
	g£cÚds
. 
	gFu¹h”mÜe
, 
	gth”e
's

418 
´obably
 
no
 
pošt
 
š
 
»Œyšg
 
İ”©iÚs
 
th©
 
time
 
	gout
. 
R©h”
 
thª


419 
»Œyšg
 
sim¶y
 
u£
 
a
 
Ïrg”
 
timeout
 
š
 
the
 
fœ¡
 
	g¶aû
.

421 <
	gP
>
The
 
Ïrge¡
 
v®id
 
timeout
 
v®ue
 
is
 
	g¶©fÜm
-
d•’d’t
 
ªd
 
may
 
be


422 
signifiÿÁly
 
Ëss
 
	gthª
 <
	gTT
>
	gINT_MAX
</TT> 
£cÚds
 <TT>
£Ëù
()</TT>

423 
	gÜ
 <
	gTT
>
	gINT_MAX
</TT> 
mli£cÚds
 <TT>
pŞl
()</TT>. 
	gG’”®ly
, 
you


424 
should
 
nÙ
 
u£
 
timeouts
 
exûedšg
 
£v”®
 
	ghours
. 
	gU£


425 <
	g‰
>
	gST_UTIME_NO_TIMEOUT
</‰> (<‰>-1</‰>è
as
 
a
 
¥ecŸl
 
v®ue
 
to


426 
šdiÿ‹
 
šfš™e
 
timeout
 
Ü
 
šdefš™e
 
	g¦“p
. 
	gU£


427 <
	g‰
>
	gST_UTIME_NO_WAIT
</‰> (<‰>0</‰>è
to
 
šdiÿ‹
 
no
 
wa™šg
 
©
 
	g®l
.

429 <
	gP
>

430 <
	gHR
>

431 <
	gP
>

432 </
	gBODY
>

433 </
	gHTML
>

	@trunk/objs/st-1.9/docs/reference.html

1 <
	gHTML
>

2 <
	gHEAD
>

3 <
	gTITLE
>
S‹
 
Th»ads
 
Lib¿ry
 
	gReã»nû
</TITLE>

4 </
	gHEAD
>

5 <
BODY
 
	gBGCOLOR
=#FFFFFF>

7 <
H2
>
S‹
 
Th»ads
 
Lib¿ry
 
Reã»nû
</H2>

9 <
DL
>

10 <
DD
><
A
 
HREF
=#ty³s><
B
>
Ty³s
</B></A></DD>

11 <
DL
><
DD
><
A
 
HREF
=#th»ad_t>
¡_th»ad_t
</A></DD></DL>

12 <
DL
><
DD
><
A
 
HREF
=#cÚd_t>
¡_cÚd_t
</A></DD></DL>

13 <
DL
><
DD
><
A
 
HREF
=#mu‹x_t>
¡_mu‹x_t
</A></DD></DL>

14 <
DL
><
DD
><
A
 
HREF
=#utime_t>
¡_utime_t
</A></DD></DL>

15 <
DL
><
DD
><
A
 
HREF
=#Ãtfd_t>
¡_Ãtfd_t
</A></DD></DL>

16 <
DL
><
DD
><
A
 
HREF
=#sw™ch_cb_t>
¡_sw™ch_cb_t
</A></DD></DL>

17 <
P
>

18 <
DD
><
A
 
HREF
=#”rÜs><
B
>
E¼Ü
 
Hªdlšg
</B></A></DD>

19 <
P
>

20 <
DD
><
A
 
HREF
=#š™><
B
>
Lib¿ry
 
In™Ÿliz©iÚ
</B></A></DD>

21 <
P
>

22 <
DL
><
DD
><
A
 
HREF
=#¡_š™>
¡_š™
()</A></DD></DL>

23 <
DL
><
DD
><
A
 
HREF
=#g‘fdlim™>
¡_g‘fdlim™
()</A></DD></DL>

24 <
DL
><
DD
><
A
 
HREF
=#£t_ev’tsys>
¡_£t_ev’tsys
()</A></DD></DL>

25 <
DL
><
DD
><
A
 
HREF
=#g‘_ev’tsys>
¡_g‘_ev’tsys
()</A></DD></DL>

26 <
DL
><
DD
><
A
 
HREF
=#g‘_ev’tsys_Çme>
¡_g‘_ev’tsys_Çme
()</A></DD></DL>

27 <
DL
><
DD
><
A
 
HREF
=#£t_utime_funùiÚ>
¡_£t_utime_funùiÚ
()</A></DD></DL>

28 <
DL
><
DD
><
A
 
HREF
=#timeÿche_£t>
¡_timeÿche_£t
()</A></DD></DL>

29 <
DL
><
DD
><
A
 
HREF
=#¿ndomize_¡acks>
¡_¿ndomize_¡acks
()</A></DD></DL>

30 <
P
>

31 <
DL
><
DD
><
A
 
HREF
=#sw™ch_cb_t><
B
>
¡_sw™ch_cb_t
</B> 
ty³
</A></DD></DL>

32 <
DL
><
DD
><
A
 
HREF
=#£t_sw™ch_š_cb>
¡_£t_sw™ch_š_cb
()</A></DD></DL>

33 <
DL
><
DD
><
A
 
HREF
=#£t_sw™ch_out_cb>
¡_£t_sw™ch_out_cb
()</A></DD></DL>

34 <
P
>

35 <
DD
><
A
 
HREF
=#th»ads><
B
>
Th»ad
 
CÚŒŞ
 
ªd
 
Id’tifiÿtiÚ
</B></A></DD>

36 <
P
>

37 <
DL
><
DD
><
A
 
HREF
=#th»ad_t><
B
>
¡_th»ad_t
</B> 
ty³
</A></DD></DL>

38 <
DL
><
DD
><
A
 
HREF
=#th»ad_ü—‹>
¡_th»ad_ü—‹
()</A></DD></DL>

39 <
DL
><
DD
><
A
 
HREF
=#th»ad_ex™>
¡_th»ad_ex™
()</A></DD></DL>

40 <
DL
><
DD
><
A
 
HREF
=#th»ad_još>
¡_th»ad_još
()</A></DD></DL>

41 <
DL
><
DD
><
A
 
HREF
=#th»ad_£lf>
¡_th»ad_£lf
()</A></DD></DL>

42 <
DL
><
DD
><
A
 
HREF
=#th»ad_š‹¼u±>
¡_th»ad_š‹¼u±
()</A></DD></DL>

43 <
DL
><
DD
><
A
 
HREF
=#¦“p>
¡_¦“p
()</A></DD></DL>

44 <
DL
><
DD
><
A
 
HREF
=#¦“p>
¡_u¦“p
()</A></DD></DL>

45 <
DL
><
DD
><
A
 
HREF
=#¿ndomize_¡acks>
¡_¿ndomize_¡acks
()</A></DD></DL>

46 <
P
>

47 <
DD
><
A
 
HREF
=#´iv><
B
>
P”
-
Th»ad
 
Priv©e
 
D©a
</B></A></DD>

48 <
P
>

49 <
DL
><
DD
><
A
 
HREF
=#key_ü—‹>
¡_key_ü—‹
()</A></DD></DL>

50 <
DL
><
DD
><
A
 
HREF
=#key_g‘lim™>
¡_key_g‘lim™
()</A></DD></DL>

51 <
DL
><
DD
><
A
 
HREF
=#th»ad_£t¥ecific>
¡_th»ad_£t¥ecific
()</A></DD></DL>

52 <
DL
><
DD
><
A
 
HREF
=#th»ad_g‘¥ecific>
¡_th»ad_g‘¥ecific
()</A></DD></DL>

53 <
P
>

54 <
DD
><
A
 
HREF
=#sync><
B
>
SynchrÚiz©iÚ
</B></A></DD>

55 <
P
>

56 <
DL
><
DD
><
A
 
HREF
=#cÚd_t><
B
>
¡_cÚd_t
</B> 
ty³
</A></DD></DL>

57 <
DL
><
DD
><
A
 
HREF
=#cÚd_Ãw>
¡_cÚd_Ãw
()</A></DD></DL>

58 <
DL
><
DD
><
A
 
HREF
=#cÚd_de¡roy>
¡_cÚd_de¡roy
()</A></DD></DL>

59 <
DL
><
DD
><
A
 
HREF
=#cÚd_wa™>
¡_cÚd_wa™
()</A></DD></DL>

60 <
DL
><
DD
><
A
 
HREF
=#cÚd_timedwa™>
¡_cÚd_timedwa™
()</A></DD></DL>

61 <
DL
><
DD
><
A
 
HREF
=#cÚd_sigÇl>
¡_cÚd_sigÇl
()</A></DD></DL>

62 <
DL
><
DD
><
A
 
HREF
=#cÚd_brßdÿ¡>
¡_cÚd_brßdÿ¡
()</A></DD></DL>

63 <
P
>

64 <
DL
><
DD
><
A
 
HREF
=#mu‹x_t><
B
>
¡_mu‹x_t
</B> 
ty³
</A></DD></DL>

65 <
DL
><
DD
><
A
 
HREF
=#mu‹x_Ãw>
¡_mu‹x_Ãw
()</A></DD></DL>

66 <
DL
><
DD
><
A
 
HREF
=#mu‹x_de¡roy>
¡_mu‹x_de¡roy
()</A></DD></DL>

67 <
DL
><
DD
><
A
 
HREF
=#mu‹x_lock>
¡_mu‹x_lock
()</A></DD></DL>

68 <
DL
><
DD
><
A
 
HREF
=#mu‹x_Œylock>
¡_mu‹x_Œylock
()</A></DD></DL>

69 <
DL
><
DD
><
A
 
HREF
=#mu‹x_uÆock>
¡_mu‹x_uÆock
()</A></DD></DL>

70 <
P
>

71 <
DD
><
A
 
HREF
=#timšg><
B
>
Timšg
</B></A></DD>

72 <
P
>

73 <
DL
><
DD
><
A
 
HREF
=#utime_t><
B
>
¡_utime_t
</B> 
ty³
</A></DD></DL>

74 <
DL
><
DD
><
A
 
HREF
=#utime>
¡_utime
()</A></DD></DL>

75 <
DL
><
DD
><
A
 
HREF
=#£t_utime_funùiÚ>
¡_£t_utime_funùiÚ
()</A></DD></DL>

76 <
DL
><
DD
><
A
 
HREF
=#timeÿche_£t>
¡_timeÿche_£t
()</A></DD></DL>

77 <
DL
><
DD
><
A
 
HREF
=#time>
¡_time
()</A></DD></DL>

78 <
P
>

79 <
DD
><
A
 
HREF
=#io><
B
>
I
/
O
 
FunùiÚs
</B></A></DD>

80 <
P
>

81 <
DL
><
DD
><
A
 
HREF
=#Ãtfd_t><
B
>
¡_Ãtfd_t
</B> 
ty³
</A></DD></DL>

82 <
DL
><
DD
><
A
 
HREF
=#Ãtfd_İ’>
¡_Ãtfd_İ’
()</A></DD></DL>

83 <
DL
><
DD
><
A
 
HREF
=#Ãtfd_İ’_sock‘>
¡_Ãtfd_İ’_sock‘
()</A></DD></DL>

84 <
DL
><
DD
><
A
 
HREF
=#Ãtfd_ä“>
¡_Ãtfd_ä“
()</A></DD></DL>

85 <
DL
><
DD
><
A
 
HREF
=#Ãtfd_şo£>
¡_Ãtfd_şo£
()</A></DD></DL>

86 <
DL
><
DD
><
A
 
HREF
=#Ãtfd_f’o>
¡_Ãtfd_f’o
()</A></DD></DL>

87 <
DL
><
DD
><
A
 
HREF
=#Ãtfd_£t¥ecific>
¡_Ãtfd_£t¥ecific
()</A></DD></DL>

88 <
DL
><
DD
><
A
 
HREF
=#Ãtfd_g‘¥ecific>
¡_Ãtfd_g‘¥ecific
()</A></DD></DL>

89 <
DL
><
DD
><
A
 
HREF
=#Ãtfd_£rŸlize_acû±>
¡_Ãtfd_£rŸlize_acû±
()</A></DD>

90 </
DL
>

91 <
DL
><
DD
><
A
 
HREF
=#Ãtfd_pŞl>
¡_Ãtfd_pŞl
()</A></DD></DL>

92 <
P
>

93 <
DL
><
DD
><
A
 
HREF
=#acû±>
¡_acû±
()</A></DD></DL>

94 <
DL
><
DD
><
A
 
HREF
=#cÚÃù>
¡_cÚÃù
()</A></DD></DL>

95 <
DL
><
DD
><
A
 
HREF
=#»ad>
¡_»ad
()</A></DD></DL>

96 <
DL
><
DD
><
A
 
HREF
=#»ad_fuÎy>
¡_»ad_fuÎy
()</A></DD></DL>

97 <
DL
><
DD
><
A
 
HREF
=#»ad_»sid>
¡_»ad_»sid
()</A></DD></DL>

98 <
DL
><
DD
><
A
 
HREF
=#»adv>
¡_»adv
()</A></DD></DL>

99 <
DL
><
DD
><
A
 
HREF
=#»adv_»sid>
¡_»adv_»sid
()</A></DD></DL>

100 <
DL
><
DD
><
A
 
HREF
=#wr™e>
¡_wr™e
()</A></DD></DL>

101 <
DL
><
DD
><
A
 
HREF
=#wr™e_»sid>
¡_wr™e_»sid
()</A></DD></DL>

102 <
DL
><
DD
><
A
 
HREF
=#wr™ev>
¡_wr™ev
()</A></DD></DL>

103 <
DL
><
DD
><
A
 
HREF
=#wr™ev_»sid>
¡_wr™ev_»sid
()</A></DD></DL>

104 <
DL
><
DD
><
A
 
HREF
=#»cväom>
¡_»cväom
()</A></DD></DL>

105 <
DL
><
DD
><
A
 
HREF
=#£ndto>
¡_£ndto
()</A></DD></DL>

106 <
DL
><
DD
><
A
 
HREF
=#»cvmsg>
¡_»cvmsg
()</A></DD></DL>

107 <
DL
><
DD
><
A
 
HREF
=#£ndmsg>
¡_£ndmsg
()</A></DD></DL>

108 <
P
>

109 <
DL
><
DD
><
A
 
HREF
=#İ’>
¡_İ’
()</A></DD></DL>

110 <
DL
><
DD
><
A
 
HREF
=#pŞl>
¡_pŞl
()</A></DD></DL>

111 <
P
>

112 <
DD
><
A
 
HREF
=#´ogr><
B
>
Prog¿m
 
SŒuùu»
</B></A></DD>

113 <
P
>

114 <
DD
><
A
 
HREF
=#block><
B
>
Li¡
 
of
 
Blockšg
 
FunùiÚs
</B></A></DD>

115 <
P
>

116 </
DL
>

117 <
P
>

118 <
HR
>

119 <
P
>

122 <
A
 
NAME
="types">

123 <
H2
>
Ty³s
</H2>

124 </
A
>

125 
The
 
S‹
 
Th»ad
 
lib¿ry
 
defšes
 
the
 
fŞlowšg
 
ty³s
 
š
h<
TT
>
¡
.
h
</TT>

126 
h—d”
 
fe
:

127 <
P
>

128 <
DL
>

129 <
DD
><
A
 
HREF
=#th»ad_t>
¡_th»ad_t
</A></DD>

130 <
DD
><
A
 
HREF
=#cÚd_t>
¡_cÚd_t
</A></DD>

131 <
DD
><
A
 
HREF
=#mu‹x_t>
¡_mu‹x_t
</A></DD>

132 <
DD
><
A
 
HREF
=#utime_t>
¡_utime_t
</A></DD>

133 <
DD
><
A
 
HREF
=#Ãtfd_t>
¡_Ãtfd_t
</A></DD>

134 </
DL
>

135 <
P
>

136 <
HR
>

137 <
P
>

139 <
A
 
NAME
="thread_t">

140 <
H4
>
¡_th»ad_t
</H4>

141 </
A
>

142 
Th»ad
 
ty³
.

143 <
P
>

144 <
H5
>
SyÁax
</H5>

146 <
PRE
>

147 #šşud&
É
;
¡
.
h
&
gt
;

149 * 
	t¡_th»ad_t
;

150 </
	gPRE
>

151 <
	gP
>

152 <
	gH5
>
	gDesütiÚ
</H5>

154 
A
 
th»ad
 
is
 
»´e£Áed
 
ªd
 
id’tif›d
 
by
 
a
 
poš‹r
 
to
 
ª
 
İaque
 
d©a


155 
	g¡ruùu»
. 
This
 
poš‹r
 
is
 
a
 
»quœed
 
·¿m‘”
 
mo¡
 
of
 
the
 
funùiÚs


156 
th©
 
İ”©e
 
Ú
 
	gth»ads
.

157 <
	gP
>

158 
The
 
th»ad
 
id’tif›r
 
»mašs
 
v®id
 
uÁ
 
the
h»ad 
»tuºs
 
äom
 
™s
 
roÙ


159 
funùiÚ
 
	gªd
, 
the
 
th»ad
 
was
 
ü—‹d
 
	gjošabË
, 
is
 
	gjošed
.

160 <
	gP
>

161 <
	gHR
>

162 <
	gP
>

164 <
A
 
	gNAME
="cond_t">

165 <
H4
>
¡_cÚd_t
</H4>

166 </
A
>

167 
CÚd™iÚ
 
v¬ŸbË
 
ty³
.

168 <
P
>

169 <
H5
>
SyÁax
</H5>

171 <
PRE
>

172 #šşud&
É
;
¡
.
h
&
gt
;

174 * 
	t¡_cÚd_t
;

175 </
	gPRE
>

176 <
	gP
>

177 <
	gH5
>
	gDesütiÚ
</H5>

179 
A
 
cÚd™iÚ
 
v¬ŸbË
 
is
 
ª
 
İaque
 
objeù
 
id’tif›d
 
by
 
a
 
	gpoš‹r
.

180 
CÚd™iÚ
 
v¬ŸbËs
 
´ovide
 
synchrÚiz©iÚ
 
´im™ives
 
to
 
wa™
 
Ü
 
wake


181 
up
 
th»ads
 
wa™šg
 
û¹aš
 
cÚd™iÚs
 
to
 
be
 
	g§tisf›d
.

182 <
	gP
>

183 
In
 
the
 
S‹
 
Th»ads
 
lib¿ry
 
th”e
 
is
 
no
 
Ãed
 
to
 
lock
 
a
 
mu‹x
 
befÜe


184 
wa™šg
 
Ú
 
a
 
cÚd™iÚ
 
	gv¬ŸbË
.

185 <
	gP
>

186 <
	gHR
>

187 <
	gP
>

189 <
A
 
	gNAME
="mutex_t">

190 <
H4
>
¡_mu‹x_t
</H4>

191 </
A
>

192 
Mu‹x
 
ty³
.

193 <
P
>

194 <
H5
>
SyÁax
</H5>

196 <
PRE
>

197 #šşud&
É
;
¡
.
h
&
gt
;

199 * 
	t¡_mu‹x_t
;

200 </
	gPRE
>

201 <
	gP
>

202 <
	gH5
>
	gDesütiÚ
</H5>

204 
A
 
mu‹x
 
is
 
ª
 
İaque
 
objeù
 
id’tif›d
 
by
 
a
 
	gpoš‹r
.

205 
Mutu®
 
exşusiÚ
 
	$locks
 (
mu‹xes
è
¬e
 
u£d
 
to
 
£rŸlize
 
the
 
executiÚ
 
of


206 
th»ads
 
through
 
ü™iÿl
 
£ùiÚs
 
of
 
code
.

207 <
P
>

208 
If
 
­¶iÿtiÚ
 
usšg
 
the
 
S‹
 
Th»ads
 
lib¿ry
 
is
 
wr™‹n
 
w™h
 
no


209 
I
/
O
 
Ü
 
cÚŒŞ
 
y›ldšg
 
š
 
ü™iÿl
 
	`£ùiÚs
 (
th©
 
is
 
no


210 <
A
 
HREF
=#block>
blockšg
 
funùiÚs
</A> 
š
 
ü™iÿl
 
£ùiÚs
), 
th’
 
th”e
 
is


211 
no
 
Ãed
 
mu‹xes
.<
P
>

212 
The£
 
mu‹xes
 
ÿn
 
Úly
 
be
 
u£d
 
šŒa
-
´oûss
 
th»ad
 
synchrÚiz©iÚ
.

213 
They
 
ÿÂÙ
 
be
 
u£d
 
š‹r
-
´oûss
 
synchrÚiz©iÚ
.

214 <
P
>

215 <
HR
>

216 <
P
>

218 <
A
 
NAME
="utime_t">

219 <
H4
>
¡_utime_t
</H4>

220 </
A
>

221 
High
 
»sŞutiÚ
 
time
 
	`ty³
 ("u" 
¡ªds
 "micro").

222 <
P
>

223 <
H5
>
SyÁax
</H5>

225 <
PRE
>

226 #šşud&
É
;
¡
.
h
&
gt
;

228 
	t¡_utime_t
;

229 </
PRE
>

230 <
P
>

231 <
H5
>
DesütiÚ
</H5>

233 
This
 
	`d©©y³
 (64-
b™
 
š‹g”
è
»´e£Ás
 
high
-
»sŞutiÚ
 
»®
 
time


234 
ex´es£d
 
š
 
miüo£cÚds
 
sšû
 
some
 
¬b™¿ry
 
time
 iÀ
the
 
·¡
. 
It
 
is
 
nÙ


235 
cÜ»Ï‹d
 
š
 
ªy
 
way
 
to
 
the
 
time
 
of
 
day
.

236 <
P
>

237 <
HR
>

238 <
P
>

240 <
A
 
NAME
="netfd_t">

241 <
H4
>
¡_Ãtfd_t
</H4>

242 </
A
>

243 
Fe
 
desütÜ
 
ty³
.

244 <
P
>

245 <
H5
>
SyÁax
</H5>

247 <
PRE
>

248 #šşud&
É
;
¡
.
h
&
gt
;

250 * 
	t¡_Ãtfd_t
;

251 </
PRE
>

252 <
P
>

253 <
H5
>
DesütiÚ
</H5>

255 
This
 
d©©y³
 
typiÿÎy
 
»´e£Ás
 
ªy
 
İ’
 
’d
 
pošt
 
of
 
ÃtwÜk


256 
	$communiÿtiÚ
 (
sock‘
, 
’d
 
pošt
 
of
 
a
 
pe
, 
FIFO
, 
‘c
.è
but
 
ÿn


257 
’ÿpsuÏ‹
 
ªy
 
İ’
 
fe
 
desütÜ
. 
Objeùs
 
of
 
this
 
ty³
 
¬e


258 
id’tif›d
 
by
 
a
 
poš‹r
 
to
 
ª
 
İaque
 
d©a
 
¡ruùu»
.

260 <
P
>

261 <
HR
>

262 <
P
>

264 <
A
 
NAME
="switch_cb_t">

265 <
H4
>
¡_sw™ch_cb_t
</H4>

266 </
A
>

267 
CÚ‹xt
 
ÿÎback
 
funùiÚ
 
ty³
.

268 <
P
>

269 <
H5
>
SyÁax
</H5>

271 <
PRE
>

272 #šşud&
É
;
¡
.
h
&
gt
;

274 (*
	t¡_sw™ch_cb_t
)();

275 </
PRE
>

276 <
P
>

277 <
H5
>
DesütiÚ
</H5>

279 
This
 
d©©y³
 
is
 
a
 
cÚv’›nû
 
ty³
 
desüibšg
‡ 
poš‹r


280 
to
 
a
 
funùiÚ
 
th©
 
wl
 
be
 
ÿÎed
 
wh’
‡ 
th»ad
 
is
 
£t
Ø
¡İ


281 
Ü
 
£t
 
to
 
run
.

282 
This
 
ã©u»
 
is
 
avaabË
 
Úly
 
wh’
 <
TT
>
ST_SWITCH_CB
</TT> i 
defšed


283 
š
 <
TT
>&
É
;
¡
.
h
&
gt
;</TT>.

285 <
P
>

286 <
HR
>

287 <
P
>

289 <
A
 
NAME
="errors">

290 <
H2
>
E¼Ü
 
Hªdlšg
</H2>

291 </
A
>

293 
AÎ
 
S‹
 
Th»ads
 
lib¿ry
 
nÚ
-
funùiÚs
  
Ú
 
sucûss
 
e™h”
 
a


294 
nÚ
-
Ãg©ive
 
š‹g”
 
Ü
 
a
 
poš‹r
 
to
‡ 
Ãwly
 
ü—‹d
 
	`objeù
 (
cÚ¡ruùÜ
-
ty³


295 
funùiÚs
). 
On
 
çu»
 
they
  
e™h”
 <
TT
>-1</TT> 
Ü
 
a
 <TT>
NULL
</TT>

296 
poš‹r
 
»¥eùiv–y
 
ªd
 
£t
 
glob®
 <
TT
>
”ºo
</TT> 
to
 
šdiÿ‹
 
the
 
”rÜ
.

297 
It
 
is
 
§ã
 
to
 
u£
 <
TT
>
”ºo
</TT> 
beÿu£
 
™
 i 
£t
 
right
 
befÜe
 
the
 
funùiÚ


298  
ªd
 
Úly
 
Úe
 
th»ad
 
©
 
a
 
time
 
ÿn
 
modify
 
™s
 
v®ue
.<
P
>

299 
The
 <
TT
>
	`³¼Ü
(3)</TT> 
funùiÚ
 
ÿn
 
be
 
u£d
 
to
 
´oduû
 
ª
 
”rÜ
 
mes§ge
 
Ú
 
the


300 
¡ªd¬d
 
”rÜ
 
ouut
.

301 <
P
>

302 <
HR
>

303 <
P
>

305 <
A
 
NAME
="init">

306 <
H2
>
Lib¿ry
 
In™Ÿliz©iÚ
</H2>

307 </
A
>

308 <
P
>

309 <
DL
>

310 <
DD
><
A
 
HREF
=#¡_š™>
	`¡_š™
()</A></DD>

311 <
DD
><
A
 
HREF
=#g‘fdlim™>
	`¡_g‘fdlim™
()</A></DD>

312 <
DD
><
A
 
HREF
=#£t_ev’tsys>
	`¡_£t_ev’tsys
()</A></DD>

313 <
DD
><
A
 
HREF
=#g‘_ev’tsys>
	`¡_g‘_ev’tsys
()</A></DD>

314 <
DD
><
A
 
HREF
=#g‘_ev’tsys_Çme>
	`¡_g‘_ev’tsys_Çme
()</A></DD>

315 <
P
>

316 
The£
 
funùiÚs
 
İ”©e
 
Ú
 
a
 
ÿÎback
 
funùiÚ
 
of
 
ty³


317 <
A
 
HREF
=#sw™ch_cb_t><
B
>
¡_sw™ch_cb_t
</B></A>:

318 <
DD
><
A
 
HREF
=#£t_sw™ch_š_cb>
	`¡_£t_sw™ch_š_cb
()</A></DD>

319 <
DD
><
A
 
HREF
=#£t_sw™ch_out_cb>
	`¡_£t_sw™ch_out_cb
()</A></DD>

320 </
DL
>

321 <
P
>

322 <
HR
>

323 <
P
>

325 <
A
 
NAME
="st_init">

326 <
H4
>
	`¡_š™
()</H4>

327 </
A
>

328 
In™Ÿlizes
 
the
 
ruÁime
.

329 <
P
>

330 <
H5
>
SyÁax
</H5>

332 <
PRE
>

333 #šşud&
É
;
¡
.
h
&
gt
;

335 
	`¡_š™
();

336 </
PRE
>

337 <
P
>

338 <
H5
>
P¬am‘”s
</H5>

339 
NÚe
.

340 <
P
>

341 <
H5
>
R‘uºs
</H5>

342 
UpÚ
 
sucûssful
 
com¶‘iÚ
, 
a
 
v®ue
 
of
 <
TT
>0</TT> 
is
 
»tuºed
.

343 
Oth”wi£
, 
a
 
v®ue
 
of
 <
TT
>-1</TT> 
is
 
»tuºed
 
ªd
 <TT>
”ºo
</TT> i 
£t


344 
to
 
šdiÿ‹
 
the
 
”rÜ
.

345 <
P
>

346 <
H5
>
DesütiÚ
</H5>

347 
This
 
funùiÚ
 
š™Ÿlizes
 
the
 
lib¿ry
 
ruÁime
. 
It
 
should
 
be
 
ÿÎed
 
Ã¬


348 
the
 
begšnšg
 
of
h
­¶iÿtiÚ
's <TT>main()</TT> function before‡ny other

349 
S‹
 
Th»ads
 
lib¿ry
 
funùiÚ
 
is
 
ÿÎed
.<
P
>

350 
AmÚg
 
Ùh”
 
thšgs
, 
this
 
funùiÚ
 
lim™s
 
the
 
numb”
 
of
 
İ’
 
fe
 
desütÜs


351 
to
 
the
 
OS
 
impo£d
 
³r
-
´oûss
 
maximum
 
numb”
 
Ü
, <
TT
>
	`£Ëù
(2)</TT> 
is


352 
u£d
, 
to
 <
TT
>
FD_SETSIZE
</TT>, 
whichev”
 
is
 
	`Ëss
 (<TT>
	`g‘¾im™
(2)</TT>).

353 
This
 
lim™
 
ÿn
 
be


354 
»Œ›ved
 
by
 <
A
 
HREF
=#g‘fdlim™>
	`¡_g‘fdlim™
()</A>. 
It
 
®so
 
£ts
 
the


355 
di¥os™iÚ
 
of
 
the
 <
TT
>
SIGPIPE
</TT> 
sigÇl
 
to
 <TT>
SIG_IGN
</TT> (tØ
be
 
ignÜed
)

356 (<
TT
>
	`sigÇl
(5)</TT>).

357 <
P
>

358 
UÆike
 
POSIX
 
th»ads
, 
a
 
Ãw
 
´oûss
 
ü—‹d
 
by
 
the
 <
TT
>
	`fÜk
(2)</TT> 
sy¡em


359 
ÿÎ
 
is
 
ª
 <
I
>
exaù
</I> 
cİy
 
of
 
the
 
ÿÎšg
 
´oûss
 
ªd
 
®l
 
¡©e
 
th»ads


360 
which
 
¬e
 
ruÂšg
 
š
 
the
 
·»Á
 dØ
exi¡
 iÀth
chd
. 
Th©
 
m—ns
 
th©


361 <
TT
>
	`¡_š™
()</TT> 
may
 
be
 
ÿÎed
 
e™h”
 
befÜe
 
Ü
 
aá”
 
muÉË
 
´oûs£s


362 
¬e
 
ü—‹d
 
by
 <
TT
>
	`fÜk
(2)</TT>.

363 <
P
>

364 
If
 
the
 
lib¿ry
 
ruÁime
 
is
 
nÙ
 
´İ”ly
 
	`š™Ÿlized
 (
e
.
g
., <
TT
>
	`¡_š™
()</TT>

365 
is
 
accid’Îy
 
om™‹d
), 
th’
 
the
 
´oûss
 
wl
 
»ûive
 
e™h”
 
ª
 
¬™hm‘ic


366 
	$exû±iÚ
 (
SIGFPE
 
Ü
 
SIGTRAP
èÜ 
£gm’tiÚ
 
	$çuÉ
 (
SIGSEGV
è
sigÇl
 
upÚ


367 
Ãw
 
th»ad
 
ü—tiÚ
 
Ü
 
the
 
fœ¡
 
cÚ‹xt
 , 
»¥eùiv–y
.

368 <
P
>

369 <
HR
>

370 <
P
>

371 <
A
 
NAME
="getfdlimit">

372 <
H4
>
	`¡_g‘fdlim™
()</H4>

373 </
A
>

374 
R‘uºs
 
the
 
maximum
 
numb”
 
of
 
fe
 
desütÜs
 
th©
h
ÿÎšg
 
´oûss


375 
ÿn
 
İ’
.

376 <
P
>

377 <
H5
>
SyÁax
</H5>

379 <
PRE
>

380 #šşud&
É
;
¡
.
h
&
gt
;

382 
	`¡_g‘fdlim™
();

383 </
PRE
>

384 <
P
>

385 <
H5
>
P¬am‘”s
</H5>

386 
NÚe
.

387 <
P
>

388 <
H5
>
R‘uºs
</H5>

389 
The
 
maximum
 
numb”
 
of
 
fe
 
desütÜs
 
th©
 
the
 
ÿÎšg
 
´oûss
 
ÿn
 
İ’
.

390 
If
 
this
 
funùiÚ
 
is
 
ÿÎed
 
befÜe
 
the
 
lib¿ry
 i 
sucûssfuÎy
 
š™Ÿlized
 
by


391 <
A
 
HREF
=#¡_š™>
	`¡_š™
()</A>, 
a
 
v®ue
 
of
 <
TT
>-1</TT> 
is
 
»tuºed
.

392 <
P
>

393 <
H5
>
DesütiÚ
</H5>

394 
This
 
funùiÚ
 
»tuºs
 
the
 
lim™
 
Ú
h
numb”
 
of
 
İ’
 
fe
 
desütÜs
 
which


395 
is
 
£t
 
by
 
the
 <
A
 
HREF
=#¡_š™>
	`¡_š™
()</A> 
funùiÚ
.

396 <
P
>

397 <
HR
>

398 <
P
>

400 <
A
 
NAME
="set_eventsys">

401 <
H4
>
	`¡_£t_ev’tsys
()</H4>

402 </
A
>

403 
S‘s
 
ev’t
 
nÙifiÿtiÚ
 
mechªism
.

404 <
P
>

405 <
H5
>
SyÁax
</H5>

407 <
PRE
>

408 #šşud&
É
;
¡
.
h
&
gt
;

410 
	`¡_£t_ev’tsys
(
ev’tsys
);

411 </
PRE
>

412 <
P
>

413 <
H5
>
P¬am‘”s
</H5>

414 <
TT
>
	`¡_£t_ev’tsys
()</TT> 
has
 
the
 
fŞlowšg
 
·¿m‘”
:<
P
>

415 <
TT
>
ev’tsys
</TT><
P
>

416 
An
 
š‹g”
 
v®ue
 
id’tifyšg
 
£Ëùed
 
ev’t
 
nÙifiÿtiÚ
 
mechªism
. 
The


417 
fŞlowšg
 
v®ues
 
¬e
 
defšed
 
š
 
the
 <
TT
>
¡
.
h
</TT> 
h—d”
 
fe
:

418 <
P
>

419 <
TABLE
 
BORDER
=0 
CELLPADDING
=5 
CELLSPACING
=15>

420 <
TR
>

421 <
TD
 
VALIGN
=
TOP
><
TT
>
ST_EVENTSYS_DEFAULT
</TT></TD>

422 <
TD
>
U£
  
ev’t
 
nÙifiÿtiÚ
 
mechªism
. 
Usu®ly
 
™
's <TT>select(2)</TT>

423 
but
 
the
 
lib¿ry
 
was
 
comped
 
w™h
h<
TT
>
USE_POLL
</TT> 
maüo
 
defšed


424 
th’
 
the
  
is
 <
TT
>
	`pŞl
(2)</TT>.</
TD
>

425 </
TR
>

426 <
TR
>

427 <
TD
 
VALIGN
=
TOP
><
TT
>
ST_EVENTSYS_SELECT
</TT></TD>

428 <
TD
>
U£
 <
TT
>
	`£Ëù
(2)</TT> 
as
 
ª
 
ev’t
 
nÙifiÿtiÚ
 
mechªism
.</TD>

429 </
TR
>

430 <
TD
 
VALIGN
=
TOP
><
TT
>
ST_EVENTSYS_POLL
</TT></TD>

431 <
TD
>
U£
 <
TT
>
	`pŞl
(2)</TT> 
as
 
ª
 
ev’t
 
nÙifiÿtiÚ
 
mechªism
.</TD>

432 </
TR
>

433 <
TD
 
VALIGN
=
TOP
><
TT
>
ST_EVENTSYS_ALT
</TT></TD>

434 <
TD
>
U£
 
ª
 
®‹º©ive
 
ev’t
 
nÙifiÿtiÚ
 
mechªism
. 
The
 
aùu®


435 
mechªism
 
£Ëùed
 
d•’ds
 
Ú
 
OS
 
suµÜt
. 
FÜ
 
exam¶e
, <
TT
>
	`•Şl
(4)</TT>

436 
wl
 
be
 
u£d
 
Ú
 
Lšux
 
suµÜ‹d
 
ªd
 <
TT
>
	`kqueue
(2)</TT> will be used

437 
Ú
 
F»eBSD
/
O³nBSD
. 
If
 
the
 
OS
 
suµÜts
 
no
 
®‹º©ive
 
ev’t


438 
nÙifiÿtiÚ
 
mechªism
, 
£‰šg
 <
TT
>
ST_EVENTSYS_ALT
</TT> 
has
 
no
 
efãù


439 
ªd
 
the
 <
TT
>
ST_EVENTSYS_DEFAULT
</TT> 
mechªism
 
wl
 
be
 
u£d
.</
TD
>

440 </
TR
>

441 </
TABLE
>

442 <
P
>

443 <
H5
>
R‘uºs
</H5>

444 
UpÚ
 
sucûssful
 
com¶‘iÚ
, 
a
 
v®ue
 
of
 <
TT
>0</TT> 
is
 
»tuºed
.

445 
Oth”wi£
, 
a
 
v®ue
 
of
 <
TT
>-1</TT> 
is
 
»tuºed
 
ªd
 <TT>
”ºo
</TT> i 
£t


446 
to
 
šdiÿ‹
 
the
 
”rÜ
:<
P
>

447 <
TABLE
 
BORDER
=0 
CELLSPACING
=15>

448 <
TR
><
TD
><
TT
>
EINVAL
</TT></TD>

449 <
TD
>

450 
The
 
suµl›d
 <
TT
>
ev’tsys
</TT> 
·¿m‘”
 
has
 
ª
 
šv®id
 
v®ue
.

451 </
TD
></
TR
>

452 <
TR
><
TD
><
TT
>
EBUSY
</TT></TD>

453 <
TD
>

454 
The
 
ev’t
 
nÙifiÿtiÚ
 
mechªism
 
has
 
®»ady
 
b“n
 
£t
.

455 </
TD
></
TR
>

456 </
TABLE
>

457 <
P
>

458 <
H5
>
DesütiÚ
</H5>

459 
This
 
funùiÚ
 
£ts
 
the
 
ev’t
 
nÙifiÿtiÚ
 
mechªism
 
th©
 
wl
 
be
 
u£d
 
by


460 
the
 
S‹
 
Th»ads
 
lib¿ry
. 
To
 
have
 
ªy
 
efãù
, 
™
 
mu¡
 
be
 
ÿÎed


461 <
i
>
befÜe
</i> 
the
 <
A
 
HREF
=#¡_š™>
	`¡_š™
()</A> 
funùiÚ
 
which
 
³rfÜms


462 
the
 
aùu®
 
š™Ÿliz©iÚ
. 
If
 <
TT
>
	`¡_£t_ev’tsys
()</TT> 
is
 
nÙ
 
ÿÎed
,

463 <
A
 
HREF
=#¡_š™>
	`¡_š™
()</A> 
wl
 
£t
 
the
 <
TT
>
ST_EVENTSYS_DEFAULT
</TT>

464 
mechªism
. 
The
 mechªism 
ÿÂÙ
 
be
 
chªged
 
Úû
 
£t
.

465 <
P
>

466 
Th”e
 
¬e
 
no
 
¡riù
 
ruËs
 
£Ëùšg
 
ª
 
ev’t
 
nÙifiÿtiÚ


467 
mechªism
. 
The
 "be¡" 
Úe
 
d•’ds
 
Ú
 
how
 
your
 
­¶iÿtiÚ
 
behaves
.

468 
Try
 
a
 
ãw
 
to
 
£e
 
which
 
Úe
 
wÜks
 
be¡
 
you
. 
As
‡ 
ruË
 
of


469 
thumb
, 
you
 
should
 
u£
 
the
 <
TT
>
ST_EVENTSYS_ALT
</TT> 
mechªism
 
your


470 
­¶iÿtiÚ
 
d—ls
 
w™h
 
a
 
v”y
 
Ïrge
 
numb”
 
of
 
ÃtwÜk
 
cÚÃùiÚs
 of

471 
which
 
Úly
 
a
 
ãw
 
¬e
 
aùive
 
©
 
Úû
.

472 <
P
>

473 <
HR
>

474 <
P
>

475 <
A
 
NAME
="get_eventsys">

476 <
H4
>
	`¡_g‘_ev’tsys
()</H4>

477 </
A
>

478 
R‘uºs
 
the
 
š‹g”
 
v®ue
 
id’tifyšg
h
ev’t
 
nÙifiÿtiÚ
 
mechªism


479 
bešg
 
u£d
 
by
 
the
 
S‹
 
Th»ads
 
lib¿ry
.

480 <
P
>

481 <
H5
>
SyÁax
</H5>

483 <
PRE
>

484 #šşud&
É
;
¡
.
h
&
gt
;

486 
	`¡_g‘_ev’tsys
();

487 </
PRE
>

488 <
P
>

489 <
H5
>
P¬am‘”s
</H5>

490 
NÚe
.

491 <
P
>

492 <
H5
>
R‘uºs
</H5>

493 
The
 
š‹g”
 
v®ue
 
id’tifyšg
 
the
 
cu¼’t
 
ev’t
 
nÙifiÿtiÚ
 
mechªism
.

494 
This
 
v®ue
 
ÿn
 
be
 
Úe
 
of
 
the
 
	`fŞlowšg
 (
£e
 <
A


495 
HREF
=#£t_ev’tsys>
	`¡_£t_ev’tsys
()</
A
>):

496 <
TT
>
ST_EVENTSYS_SELECT
</TT>, <TT>
ST_EVENTSYS_POLL
</TT>, 
Ü


497 <
TT
>
ST_EVENTSYS_ALT
</TT>. 
Futu»
 
v”siÚs
 
of
 
the
 
lib¿ry
 
may
  
Ùh”


498 
v®ues
. 
If
 
a
 
mechªism
 
ha¢
't been set yet,‡ value of <TT>-1</TT> is„eturned.

499 <
P
>

500 <
H5
>
DesütiÚ
</H5>

501 
This
 
funùiÚ
 
»tuºs
 
the
 
š‹g”
 
v®ue
 
id’tifyšg
h
ev’t
 
nÙifiÿtiÚ


502 
mechªism
 
which
 
is
 
aùu®ly
 
bešg
 
u£d
 
by
 
the
 
S‹
 
Th»ads
 
lib¿ry
.

503 <
P
>

504 <
HR
>

505 <
P
>

506 <
A
 
NAME
="get_eventsys_name">

507 <
H4
>
	`¡_g‘_ev’tsys_Çme
()</H4>

508 </
A
>

509 
R‘uºs
 
the
 
Çme
 
of
h
ev’t
 
nÙifiÿtiÚ
 
mechªism
 
bešg
 
u£d
 
by
he

510 
S‹
 
Th»ads
 
lib¿ry
.

511 <
P
>

512 <
H5
>
SyÁax
</H5>

514 <
PRE
>

515 #šşud&
É
;
¡
.
h
&
gt
;

517 cÚ¡ *
	`¡_g‘_ev’tsys_Çme
();

518 </
PRE
>

519 <
P
>

520 <
H5
>
P¬am‘”s
</H5>

521 
NÚe
.

522 <
P
>

523 <
H5
>
R‘uºs
</H5>

524 
The
 
¡ršg
 
id’tifyšg
 
the
 
cu¼’t
 
ev’t
 
nÙifiÿtiÚ
 
mechªism
. 
If
 
a


525 
mechªism
 
ha¢
't been set yet (see <A

526 
HREF
=#£t_ev’tsys>
	`¡_£t_ev’tsys
()</
A
>), 
ª
 
em±y
 
¡ršg
 
is


527 
»tuºed
. 
PossibË
  
v®ues
 
¬e
 <
TT
>"select"</TT>,

528 <
TT
>"pŞl"</TT>, <TT>"kqueue"</TT>, 
Ü
 <TT>"•Şl"</TT>. 
Futu»
 
v”siÚs


529 
of
 
the
 
lib¿ry
 
may
  
Ùh”
 
v®ues
.

530 <
P
>

531 <
H5
>
DesütiÚ
</H5>

532 
This
 
funùiÚ
 
»tuºs
 
the
 
¡ršg
 
id’tifyšg
h
ev’t
 
nÙifiÿtiÚ


533 
mechªism
 
which
 
is
 
aùu®ly
 
bešg
 
u£d
 
by
 
the
 
S‹
 
Th»ads
 
lib¿ry
.

534 <
P
>

535 <
HR
>

536 <
P
>

538 <
A
 
NAME
="set_switch_in_cb">

539 <
H4
>
	`¡_£t_sw™ch_š_cb
()</H4>

540 </
A
>

541 <
A
 
NAME
="set_switch_out_cb">

542 <
H4
>
	`¡_£t_sw™ch_out_cb
()</H4>

543 </
A
>

544 
S‘
 
the
 
İtiÚ®
 
ÿÎback
 
funùiÚ
 
th»ad
 
sw™ches
.

545 <
P
>

546 <
H5
>
SyÁax
</H5>

548 <
PRE
>

549 #šşud&
É
;
¡
.
h
&
gt
;

551 
¡_sw™ch_cb_t
 
	`¡_£t_sw™ch_š_cb
(¡_sw™ch_cb_ˆ
cb
);

552 
¡_sw™ch_cb_t
 
	`¡_£t_sw™ch_out_cb
(¡_sw™ch_cb_ˆ
cb
);

553 </
PRE
>

554 <
P
>

555 <
H5
>
P¬am‘”s
</H5>

556 <
TT
>
	`¡_£t_sw™ch_š_cb
()</TT> 
ªd
 <TT>
	`¡_£t_sw™ch_out_cb
()</TT> 
have
 
the


557 
fŞlowšg
 
·¿m‘”
:<
P
>

558 <
TT
>
cb
</TT><
P
>

559 
A
 
funùiÚ
 
to
 
be
 
ÿÎed
 
wh’
 
a
 
th»ad
 
is
 
»sumed
 
ªd
 
¡İ³d
 
»¥eùiv–y
.<
P
>

560 <
H5
>
R‘uºs
</H5>

561 
The
 
´evious
 
ÿÎback
 
funùiÚ
 
poš‹r
.

562 <
P
>

563 <
H5
>
DesütiÚ
</H5>

564 
The£
 
funùiÚs
 
£t
 
the
 
ÿÎback
 
wh’
 
a
 
th»ad
 
is
 
»sumed
 
ªd
 
¡İ³d


565 
»¥eùiv–y
. 
Aá”
 
bešg
 
ÿÎed
 
ªy
 
th»ad
 
wl
 
ÿÎ
 
the
 
ÿÎback
.

566 
U£
 
a
 <
TT
>
NULL
</TT> 
poš‹r
 
to
 
di§bË
 
the
 
	`ÿÎback
 (
this
 
is
he ).

567 
U£
 <
A
 
HREF
=#th»ad_£lf>
	`¡_th»ad_£lf
()</A> 
Ü
 <A HREF=#´iv>
th»ad


568 
¥ecific
 
d©a
</
A
> 
to
 
difã»ÁŸ‹
 
b‘w“n
 
th»ads
.<
P
>

569 
The£
 
funùiÚs
 
ÿn
 
be
 
ÿÎed
 
©
 
ªy
 
time
.<
P
>

570 
This
 
ã©u»
 
is
 
avaabË
 
Úly
 
wh’
 <
TT
>
ST_SWITCH_CB
</TT> i 
defšed


571 
š
 <
TT
>&
É
;
¡
.
h
&
gt
;</TT>.

572 <
P
>

573 <
HR
>

574 <
P
>

576 <
A
 
NAME
="threads">

577 <
H2
>
Th»ad
 
CÚŒŞ
 
ªd
 
Id’tifiÿtiÚ
</H2>

578 </
A
>

579 <
P
>

580 
The£
 
funùiÚs
 
İ”©e
 
Ú
 
a
 
th»ad
 
objeù
 
of
 
ty³


581 <
A
 
HREF
=#th»ad_t><
B
>
¡_th»ad_t
</B></A>.

582 <
P
>

583 <
DL
>

584 <
DD
><
A
 
HREF
=#th»ad_ü—‹>
	`¡_th»ad_ü—‹
()</A></DD>

585 <
DD
><
A
 
HREF
=#th»ad_ex™>
	`¡_th»ad_ex™
()</A></DD>

586 <
DD
><
A
 
HREF
=#th»ad_još>
	`¡_th»ad_još
()</A></DD>

587 <
DD
><
A
 
HREF
=#th»ad_£lf>
	`¡_th»ad_£lf
()</A></DD>

588 <
DD
><
A
 
HREF
=#th»ad_š‹¼u±>
	`¡_th»ad_š‹¼u±
()</A></DD>

589 <
DD
><
A
 
HREF
=#¦“p>
	`¡_¦“p
()</A></DD>

590 <
DD
><
A
 
HREF
=#¦“p>
	`¡_u¦“p
()</A></DD>

591 <
DD
><
A
 
HREF
=#¿ndomize_¡acks>
	`¡_¿ndomize_¡acks
()</A></DD>

592 </
DL
>

593 <
P
>

594 <
HR
>

595 <
P
>

596 <
A
 
NAME
="thread_create">

597 <
H4
>
	`¡_th»ad_ü—‹
()</H4>

598 </
A
>

599 
C»©es
 
a
 
Ãw
 
th»ad
.

600 <
P
>

601 <
H5
>
SyÁax
</H5>

603 <
PRE
>

604 #šşud&
É
;
¡
.
h
&
gt
;

606 
¡_th»ad_t
 
	`¡_th»ad_ü—‹
(*(*
¡¬t
)(*
¬g
), *arg,

607 
jošabË
, 
¡ack_size
);

609 </
PRE
>

610 <
P
>

611 <
H5
>
P¬am‘”s
</H5>

612 <
TT
>
	`¡_th»ad_ü—‹
()</TT> 
has
 
the
 
fŞlowšg
 
·¿m‘”s
:<
P
>

613 <
TT
>
¡¬t
</TT><
P
>

614 
A
 
poš‹r
 
to
 
the
 
th»ad
's start function, which is called‡she„oot ofhe

615 
Ãw
 
th»ad
. 
R‘uº
 
äom
 
this
 
funùiÚ
 
‹rmš©es
 
a
h»ad.<
P
>

616 <
TT
>
¬g
</TT><
P
>

617 
A
 
poš‹r
 
to
 
the
 
roÙ
 
funùiÚ
's only…arameter.<P>

618 <
TT
>
jošabË
</TT><
P
>

619 
S³cif›s
 
wh‘h”
 
the
 
th»ad
 
is
 
jošabË
 
Ü
 
unjošabË
. 
If
 
this
 
·¿m‘”


620 
is
 
z”o
, 
the
 
th»ad
 i 
unjošabË
. 
Oth”wi£
, 
™
 i 
jošabË
.

621 
S“
 
®so
 <
A
 
HREF
=#th»ad_još>
	`¡_th»ad_još
()</A>.<
P
>

622 <
TT
>
¡ack_size
</TT><
P
>

623 
S³cif›s
 
your
 
´eã»nû
 
the
 
size
 
of
h
¡ack
, 
š
 
by‹s
, 
assocŸ‹d


624 
w™h
 
the
 
Ãwly
 
ü—‹d
 
th»ad
. 
If
 
you
 
·ss
 
z”o
 
š
 
this
 
·¿m‘”
,he

625  
¡ack
 
size
 
wl
 
be
 
u£d
. 
The
  sck siz
is
 128 
KB
 
Ú
 
IA
-64

626 
ªd
 64 
KB
 
Ú
 
®l
 
Ùh”
 
¶©fÜms
. 
On
 
IA
-64 
Úly
 
a
 
h®f
 
of
 <
TT
>
¡ack_size
</TT>

627 
by‹s
 
is
 
u£d
 
the
 
memÜy
 
¡ack
. 
The
 
Ùh”
 
h®f
 is used the 

628 
¡ack
 
backšg
 
¡Üe
.

629 <
P
>

630 <
H5
>
R‘uºs
</H5>

631 
UpÚ
 
sucûssful
 
com¶‘iÚ
, 
a
 
Ãw
 
th»ad
 
id’tif›r
 
is
 
	`»tuºed
 (
this


632 
id’tif›r
 
»mašs
 
v®id
 
uÁ
 
the
 
th»ad
 
»tuºs
 
äom
 
™s
 
¡¬t
 
funùiÚ
).

633 
Oth”wi£
, <
TT
>
NULL
</TT> 
is
 
»tuºed
 
ªd
 <TT>
”ºo
</TT> i 
£t


634 
to
 
šdiÿ‹
 
the
 
”rÜ
.

635 <
P
>

636 <
H5
>
DesütiÚ
</H5>

637 
This
 
funùiÚ
 
ü—‹s
 
a
 
Ãw
 
th»ad
. 
NÙe
 
th©
 
the
 
tÙ®
 
numb”
 
of
 
th»ads


638 
ü—‹d
 
by
 
the
 
­¶iÿtiÚ
 
is
 
lim™ed
 byh
amouÁ
 
of
 
sw­
 
¥aû
 
avaabË
.

639 
UpÚ
 
th»ad
 
ü—tiÚ
, <
TT
>
¡ack_size
</TT> 
by‹s
 
¬e
 
»£rved
 
Ú
 
the
 
sw­


640 
¥aû
. 
The
 
¡ack
 
·ges
 
¬e
 
nÙ
 
aùu®ly
 
	$u£d
 (
v®id
è
uÁ
 
touched
 
by
 
the


641 
­¶iÿtiÚ
.

642 <
P
>

643 <
HR
>

644 <
P
>

645 <
A
 
NAME
="thread_exit">

646 <
H4
>
	`¡_th»ad_ex™
()</H4>

647 </
A
>

648 
T”mš©es
 
the
 
ÿÎšg
 
th»ad
.

649 <
P
>

650 <
H5
>
SyÁax
</H5>

652 <
PRE
>

653 #šşud&
É
;
¡
.
h
&
gt
;

655 
	`¡_th»ad_ex™
(*
»tv®
);

656 </
PRE
>

657 <
P
>

658 <
H5
>
P¬am‘”s
</H5>

659 <
TT
>
	`¡_th»ad_ex™
()</TT> 
has
 
the
 
fŞlowšg
 
·¿m‘”s
:<
P
>

660 <
TT
>
»tv®
</TT><
P
>

661 
If
 
the
 
th»ad
 
is
 
jošabË
, 
th’
h
v®ue
 <
TT
>
»tv®
</TT> 
may
 
be
 
»Œ›ved


662 
by
 <
A
 
HREF
=#th»ad_još>
	`¡_th»ad_još
()</A>. 
If
 
a
 
th»ad
 
»tuºs
 
äom
 
™s


663 
¡¬t
 
funùiÚ
, 
™
 
aùs
 
as
 ™ 
had
 
ÿÎed
 <
TT
>
	`¡_th»ad_ex™
()</TT> 
w™h


664 <
TT
>
»tv®
</TT> 
as
 
the
 
v®ue
 
»tuºed
.

665 <
P
>

666 <
H5
>
R‘uºs
</H5>

667 
NÙhšg
.

668 <
P
>

669 <
H5
>
DesütiÚ
</H5>

670 
This
 
funùiÚ
 
‹rmš©es
 
the
 
ÿÎšg
 
th»ad
. 
Wh’
 
a
h»ad 
ex™s
, 
³r
-thread

671 
´iv©e
 
d©a
 
is
 
de¡royed
 
by
 
švokšg
 
the
 
de¡ruùÜ
 
funùiÚ
 
ªy


672 
nÚ
-<
TT
>
NULL
</TT> 
th»ad
 
¥ecific
 
v®ues
 
assocŸ‹d
 
w™h
 
aùive
 
	`keys
 (
£e


673 <
A
 
HREF
=#key_ü—‹>
	`¡_key_ü—‹
()</A>). 
This
 
funùiÚ
 
is
 
im¶ic™ly
 
ÿÎed


674 
wh’
 
a
 
th»ad
 
»tuºs
 
äom
 
™s
 
¡¬t
 
funùiÚ
.<
P
>

675 
Wh’
 
the
 
Ï¡
 
th»ad
 
‹rmš©es
h
´oûss
 
ex™s
 
w™h
 
a
 
z”o
 
¡©us
 
v®ue
.

676 <
P
>

677 <
HR
>

678 <
P
>

679 <
A
 
NAME
="thread_join">

680 <
H4
>
	`¡_th»ad_još
()</H4>

681 </
A
>

682 
Blocks
 
the
 
ÿÎšg
 
th»ad
 
uÁ
 
a
 
¥ecif›d
h»ad 
‹rmš©es
.

683 <
P
>

684 <
H5
>
SyÁax
</H5>

686 <
PRE
>

687 #šşud&
É
;
¡
.
h
&
gt
;

689 
	`¡_th»ad_još
(
¡_th»ad_t
 
th»ad
, **
»tv®p
);

690 </
PRE
>

691 <
P
>

692 <
H5
>
P¬am‘”s
</H5>

693 <
TT
>
	`¡_th»ad_još
()</TT> 
has
 
the
 
fŞlowšg
 
·¿m‘”s
:<
P
>

694 <
TT
>
th»ad
</TT><
P
>

695 
A
 
v®id
 
id’tif›r
 
the
 
th»ad
 
th©
 
is
 
to
 
be
 
jošed
.<
P
>

696 <
TT
>
»tv®p
</TT><
P
>

697 
If
 
this
 
·¿m‘”
 
is
 
nÙ
 <
TT
>
NULL
</TT>, 
th’
 
the
 
ex™
 
v®ue
 
of
he

698 <
TT
>
th»ad
</TT> 
wl
 
be
 
¶aûd
 
š
 
the
 
loÿtiÚ
 
»ã»nûd
 
by
 
this
 
·¿m‘”


699 (
£e
 <
A
 
HREF
=#th»ad_ex™>
	`¡_th»ad_ex™
()</A>).

700 <
P
>

701 <
H5
>
R‘uºs
</H5>

702 
UpÚ
 
sucûssful
 
com¶‘iÚ
, 
a
 
v®ue
 
of
 <
TT
>0</TT> 
is
 
»tuºed
.

703 
Oth”wi£
, 
a
 
v®ue
 
of
 <
TT
>-1</TT> 
is
 
»tuºed
 
ªd
 <TT>
”ºo
</TT> i 
£t


704 
to
 
šdiÿ‹
 
the
 
”rÜ
:<
P
>

705 <
TABLE
 
BORDER
=0>

706 <
TR
><
TD
><
TT
>
EINVAL
</TT></TD><TD>
T¬g‘
 
th»ad
 
is
 
unjošabË
.</TD></TR>

707 <
TR
><
TD
><
TT
>
EINVAL
</TT></TD><TD>
Oth”
 
th»ad
 
®»ady
 
wa™s
 
Ú
 
the
 
§me


708 
jošabË
 
th»ad
.</
TD
></
TR
>

709 <
TR
><
TD
><
TT
>
EDEADLK
</TT></TD><TD>
T¬g‘
 
th»ad
 
is
 
the
 
§me
 
as
he

710 
ÿÎšg
 
th»ad
.</
TD
></
TR
>

711 <
TR
><
TD
><
TT
>
EINTR
</TT></TD><TD>
Cu¼’t
 
th»ad
 
was
 
š‹¼u±ed
 
by


712 <
A
 
HREF
=#th»ad_š‹¼u±>
	`¡_th»ad_š‹¼u±
()</A>.</
TD
></
TR
>

713 </
TABLE
>

714 <
P
>

715 <
H5
>
DesütiÚ
</H5>

716 
This
 
funùiÚ
 
is
 
u£d
 
to
 
synchrÚize
 
the
 
‹rmš©iÚ
 
of
 
a
 
th»ad
 
ªd
 
possibly


717 
»Œ›ve
 
™s
 
ex™
 
v®ue
. 
Sev”®
 
th»ads
 
ÿÂÙ
 
wa™
 
the
 
§me
 
th»ad


718 
to
 
com¶‘e
 - 
Úe
 
of
 
the
 
ÿÎšg
 
th»ads
 
İ”©es
 
sucûssfuÎy
, 
ªd
h
Ùh”s


719 
‹rmš©e
 
w™h
 
the
 
”rÜ
. 
The
 
ÿÎšg
 
th»ad
 
is
 
nÙ
 
blocked
 th
rg‘


720 
th»ad
 
has
 
®»ady
 
‹rmš©ed
.

721 <
P
>

722 <
HR
>

723 <
P
>

724 <
A
 
NAME
="thread_self">

725 <
H4
>
	`¡_th»ad_£lf
()</H4>

726 </
A
>

727 
Id’tif›s
 
the
 
ÿÎšg
 
th»ad
.

728 <
P
>

729 <
H5
>
SyÁax
</H5>

731 <
PRE
>

732 #šşud&
É
;
¡
.
h
&
gt
;

734 
¡_th»ad_t
 
	`¡_th»ad_£lf
();

735 </
PRE
>

736 <
P
>

737 <
H5
>
P¬am‘”s
</H5>

738 
NÚe
.

739 <
P
>

740 <
H5
>
R‘uºs
</H5>

741 
Always
 
»tuºs
 
a
 
v®id
 
»ã»nû
 
to
 
the
 
ÿÎšg
 
th»ad
 -‡ 
£lf
-
id’t™y
.

742 <
P
>

743 <
H5
>
DesütiÚ
</H5>

744 
This
 
funùiÚ
 
id’tif›s
 
the
 
ÿÎšg
 
th»ad
. Thi 
is
h
§me
 
id’tif›r


745 
th©
 
the
 
ü—tšg
 
th»ad
 
obšs
 
äom


746 <
A
 
HREF
=#th»ad_ü—‹>
	`¡_th»ad_ü—‹
()</A>.

747 <
P
>

748 <
HR
>

749 <
P
>

750 <
A
 
NAME
="thread_interrupt">

751 <
H4
>
	`¡_th»ad_š‹¼u±
()</H4>

752 </
A
>

753 
IÁ”ru±s
 
a
 
rg‘
 
th»ad
.

754 <
P
>

755 <
H5
>
SyÁax
</H5>

757 <
PRE
>

758 #šşud&
É
;
¡
.
h
&
gt
;

760 
	`¡_th»ad_š‹¼u±
(
¡_th»ad_t
 
th»ad
);

761 </
PRE
>

762 <
P
>

763 <
H5
>
P¬am‘”s
</H5>

764 <
TT
>
	`¡_th»ad_š‹¼u±
()</TT> 
has
 
the
 
fŞlowšg
 
·¿m‘”s
:<
P
>

765 <
TT
>
th»ad
</TT><
P
>

766 
A
 
v®id
 
id’tif›r
 
the
 
th»ad
 
bešg
 
š‹¼u±ed
.

767 <
P
>

768 <
H5
>
R‘uºs
</H5>

769 
NÙhšg
.

770 <
P
>

771 <
H5
>
DesütiÚ
</H5>

772 
This
 
funùiÚ
 
	$š‹¼u±s
 (
unblocks
è
a
 
rg‘
 
th»ad
 
th©
 
is
 
blocked
 
š
 
Úe


773 
of
 
the
 <
A
 
HREF
=#block>
blockšg
 
funùiÚs
</A>. A 
funùiÚ
 
th©
 
was
 
š‹¼u±ed


774 
»tuºs
 
ª
 
”rÜ
 
ªd
 
£ts
 <
TT
>
”ºo
</TT> 
to
 <TT>
EINTR
</TT>. 
It
 
is
 
up
o

775 
the
 
rg‘
 
th»ad
 
to
 
aù
 
upÚ
 
ª
 
	`š‹¼u±
 (
e
.
g
., 
™
 
may
 
ex™
 
Ü
 
ju¡


776 
abÜt
 
the
 
cu¼’t
 
Œª§ùiÚ
).<
P
>

777 <
B
>
NÙe
: </B> 
S‹
 
Th»ads
 
lib¿ry
 
funùiÚs
 
¬e
 
Ãv”
 
š‹¼u±ed
 
by
 
a


778 
ÿught
 
sigÇl
. 
A
 
blockšg
 
lib¿ry
 
funùiÚ
 
»tuºs
 
ª
 
”rÜ
 
ªd
 
£ts


779 <
TT
>
”ºo
</TT> 
to
 <TT>
EINTR
</TT> <
I
>
Úly
</I> 
the
 
cu¼’t
 
th»ad
 
was


780 
š‹¼u±ed
 
vŸ
 <
TT
>
	`¡_th»ad_š‹¼u±
()</TT>.

781 <
P
>

782 
If
 
a
 
rg‘
 
th»ad
 
is
 
®»ady
 
ruÂabË
 
Ü
 
	`ruÂšg
 (
e
.
g
., 
™
 i ¨
Ãwly


783 
ü—‹d
 
th»ad
 
Ü
 
ÿÎšg
h»ad 
™£lf
), 
this
 
funùiÚ
 
wl
 
´ev’t
 
™


784 
äom
 
sub£qu’t
 
blockšg
. 
In
 
Ùh”
 
wÜds
, 
the
 
š‹¼u±
 
wl
 
be
 "delivered"

785 
Úly
 
wh’
 
a
 
rg‘
 
th»ad
 
is
 
about
 
to
 
block
.

786 <
P
>

787 <
HR
>

788 <
P
>

789 <
A
 
NAME
="sleep">

790 <
H4
>
	`¡_¦“p
(), 
	`¡_u¦“p
()</H4>

791 </
A
>

792 
Su¥’ds
 
cu¼’t
 
th»ad
 
a
 
¥ecif›d
 
amouÁ
 
of
 
time
.

793 <
P
>

794 <
H5
>
SyÁax
</H5>

796 <
PRE
>

797 #šşud&
É
;
¡
.
h
&
gt
;

799 
	`¡_¦“p
(
£cs
);

801 
	`¡_u¦“p
(
¡_utime_t
 
u£cs
);

802 </
PRE
>

803 <
P
>

804 <
H5
>
P¬am‘”s
</H5>

805 <
TT
>
	`¡_¦“p
()</TT> 
has
 
the
 
fŞlowšg
 
·¿m‘”s
:<
P
>

806 <
TT
>
£cs
</TT><
P
>

807 
The
 
numb”
 
of
 
£cÚds
 
you
 
wªt
 
the
 
th»ad
 
to
 
¦“p
 .

808 <
P
>

809 <
TT
>
	`¡_u¦“p
()</TT> 
has
 
the
 
fŞlowšg
 
·¿m‘”s
:<
P
>

810 <
TT
>
u£cs
</TT><
P
>

811 
The
 
numb”
 
of
 
miüo£cÚds
 
you
 
wªt
 
the
 
th»ad
 
to
 
¦“p
 . 
This
 
·¿m‘”


812 
is
 
a
 
v¬ŸbË
 
of
 
ty³
 <
A
 
HREF
=#utime_t><
B
>
¡_utime_t
</B></A>.

813 <
P
>

814 <
H5
>
R‘uºs
</H5>

815 
UpÚ
 
sucûssful
 
com¶‘iÚ
, 
a
 
v®ue
 
of
 <
TT
>0</TT> 
is
 
»tuºed
.

816 
Oth”wi£
, 
a
 
v®ue
 
of
 <
TT
>-1</TT> 
is
 
»tuºed
 
ªd
 <TT>
”ºo
</TT> i 
£t


817 
to
 
šdiÿ‹
 
the
 
”rÜ
:<
P
>

818 <
TABLE
 
BORDER
=0>

819 <
TR
><
TD
><
TT
>
EINTR
</TT></TD><TD>
The
 
cu¼’t
 
th»ad
 
was
 
š‹¼u±ed
 
by


820 <
A
 
HREF
=#th»ad_š‹¼u±>
	`¡_th»ad_š‹¼u±
()</A>.</
TD
></
TR
>

821 </
TABLE
>

822 <
P
>

823 <
H5
>
DesütiÚ
</H5>

824 
The£
 
funùiÚs
 
su¥’d
 
the
 
ÿÎšg
 
th»ad
 
äom
 
executiÚ
 
a
 
¥ecif›d


825 
numb”
 
of
 
	`£cÚds
 (<
TT
>
	`¡_¦“p
()</TT>è
Ü
 
	`miüo£cÚds
 (<TT>
	`¡_u¦“p
()</TT>).

826 <
P
>

828 
If
 
z”o
 
is
 
·s£d
 
as
 
a
 
·¿m‘”
 
to
 <
‰
>
	`¡_¦“p
()</‰>, 
Ü


829 <
‰
>
ST_UTIME_NO_WAIT
</‰> (<‰>0</‰>è
is
 
·s£d
 
to


830 <
‰
>
	`¡_u¦“p
()</‰>, 
the
 
ÿÎšg
 
th»ad
 
y›lds
, 
thus
 
pÙ’tŸÎy


831 
®lowšg
 
ªÙh”
 
th»ad
 
to
 
run
.

833 <
P
>

835 
If
 <
TT
>-1</TT> 
is
 
·s£d
 
as
 
a
 
·¿m‘”
 
to
 <
‰
>
	`¡_¦“p
()</‰>, 
Ü


836 <
‰
>
ST_UTIME_NO_TIMEOUT
</‰> (<‰>-1</‰>è
is
 
·s£d
 
to


837 <
‰
>
	`¡_u¦“p
()</‰>, 
the
 
ÿÎšg
 
th»ad
 
wl
 
be
 
su¥’ded
 
³rmª’y
.

838 
It
 
ÿn
 
be
 
»sumed
 
agaš
 
by
 
š‹¼u±šg
 
™
 
vŸ
 <
A


839 
HREF
=#th»ad_š‹¼u±>
	`¡_th»ad_š‹¼u±
()</
A
>.

841 <
P
>

842 <
HR
>

843 <
P
>

844 <
A
 
NAME
="randomize_stacks">

845 <
H4
>
	`¡_¿ndomize_¡acks
()</H4>

846 </
A
>

847 
Tuºs
 
¡ack
 
ba£
 
add»ss
 
¿ndomiz©iÚ
 
Ú
 
Ü
 
off
.

848 <
P
>

849 <
H5
>
SyÁax
</H5>

851 <
PRE
>

852 #šşud&
É
;
¡
.
h
&
gt
;

854 
	`¡_¿ndomize_¡acks
(
Ú
);

855 </
PRE
>

856 <
P
>

857 <
H5
>
P¬am‘”s
</H5>

858 <
TT
>
	`¡_¿ndomize_¡acks
()</TT> 
has
 
the
 
fŞlowšg
 
·¿m‘”s
:<
P
>

859 <
TT
>
Ú
</TT><
P
>

860 
If
 
this
 
·¿m‘”
 
has
 
a
 
nÚ
-
z”o
 
v®ue
, 
the
 
S‹
 
Th»ads
 
lib¿ry


861 
¿ndomizes
 
the
 
ba£
 
add»s£s
 
of
 
¡acks
 
®loÿ‹d
 
th»ads
 
ü—‹d


862 
aá”
 
this
 
ÿÎ
. 
Oth”wi£
 
Ãw
 
th»ads
' stacks‡reypically…age

863 
®igÃd
.

864 <
P
>

865 <
H5
>
R‘uºs
</H5>

866 
The
 
´evious
 
¡©e
 
of
 
¡ack
 
	`¿ndomiz©iÚ
 (
a
 
v®ue
 oà<
TT
>0</TT> 
™


867 
was
 
off
 
ªd
 
a
 
nÚ
-
z”o
 
v®ue
 
Ùh”wi£
).

868 <
P
>

869 <
H5
>
DesütiÚ
</H5>

870 
Rªdomizšg
 
¡©e
 
th»ads
' stack bases may improve cache…erformance on

871 
some
 
sy¡ems
 
wh’
 
Ïrge
 
numb”s
 
of
 
¡©e
 
th»ads
 
®l
 
³rfÜm
 
roughly
 
the


872 
§me
 
wÜk
, 
as
 
wh’
 
they
 
®l
 
¡¬t
 
äom
 
the
 sam
roÙ
 
funùiÚ
. 
On
 
mªy


873 
mod”n
 
sy¡ems
 
the
 
³rfÜmªû
 
šü—£
 
is
 
ÃgligibË
. 
You
 
should


874 
com·»
 
your
 
­¶iÿtiÚ
's…erformance withhis feature on‡nd offo

875 
£e
 
you
 
»®ly
 
Ãed
 
™
.

876 <
P
>

877 
Wh’
 
¿ndomiz©iÚ
 
is
 
’abËd
, 
Ãw
 
¡acks
 
¬e
 
®loÿ‹d
 
Úe
 
·ge
 
Ïrg”


878 
to
 
accomod©e
 
the
 
¿ndomiz©iÚ
.

879 <
P
>

880 
This
 
ÿÎ
 
afãùs
 
Úly
 
th»ads
 
ü—‹d
 
aá”w¬d
. 
It
 
has
 
no
 
efãù
 
Ú


881 
exi¡šg
 
th»ads
.

882 <
P
>

883 <
HR
>

884 <
P
>

886 <
A
 
NAME
="priv">

887 <
H2
>
P”
-
Th»ad
 
Priv©e
 
D©a
</H2>

888 </
A
>

889 
The£
 
funùiÚs
 
®low
 
to
 
assocŸ‹
 
´iv©e
 
d©a
 
w™h
 
—ch
 
of
 
the
 
th»ads
 
š


890 
a
 
´oûss
.

891 <
P
>

892 <
DL
>

893 <
DD
><
A
 
HREF
=#key_ü—‹>
	`¡_key_ü—‹
()</A></DD>

894 <
DD
><
A
 
HREF
=#key_g‘lim™>
	`¡_key_g‘lim™
()</A></DD>

895 <
DD
><
A
 
HREF
=#th»ad_£t¥ecific>
	`¡_th»ad_£t¥ecific
()</A></DD>

896 <
DD
><
A
 
HREF
=#th»ad_g‘¥ecific>
	`¡_th»ad_g‘¥ecific
()</A></DD>

897 </
DL
>

898 <
P
>

899 <
HR
>

900 <
P
>

901 <
A
 
NAME
="key_create">

902 <
H4
>
	`¡_key_ü—‹
()</H4>

903 </
A
>

904 
C»©es
 
a
 
	`key
 (
nÚ
-
Ãg©ive
 
š‹g”
è
th©
 
ÿn
 
be
 
u£d
 
by
 
®l


905 
th»ads
 
š
 
the
 
´oûss
 
to
 
g‘
 
ªd
 
£t
 
th»ad
-
¥ecific
 
d©a
.

906 <
P
>

907 <
H5
>
SyÁax
</H5>

909 <
PRE
>

910 #šşud&
É
;
¡
.
h
&
gt
;

912 
	`¡_key_ü—‹
(*
keyp
, (*
de¡ruùÜ
)(*));

913 </
PRE
>

914 <
P
>

915 <
H5
>
P¬am‘”s
</H5>

916 <
TT
>
	`¡_key_ü—‹
()</TT> 
has
 
the
 
fŞlowšg
 
·¿m‘”s
:<
P
>

917 <
TT
>
keyp
</TT><
P
>

918 
The
 
Ãwly
 
ü—‹d
 
key
 
is
 
»tuºed
 
š
 
the
 
memÜy
 
poš‹d
 
to
 
by
 
this
 
·¿m‘”
.

919 
The
 
Ãw
 
key
 
ÿn
 
be
 
u£d
 
w™h


920 <
A
 
HREF
=#th»ad_£t¥ecific>
	`¡_th»ad_£t¥ecific
()</A> 
ªd


921 <
A
 
HREF
=#th»ad_g‘¥ecific>
	`¡_th»ad_g‘¥ecific
()</A>.<
P
>

922 <
TT
>
de¡ruùÜ
</TT><
P
>

923 
S³cif›s
 
ª
 
İtiÚ®
 
de¡ruùÜ
 
funùiÚ
 
the
 
´iv©e
 
d©a
 
assocŸ‹d


924 
w™h
 
the
 
key
. 
This
 
funùiÚ
 
ÿn
 
be
 
¥ecif›d
 
as
 <
TT
>
NULL
</TT>.

925 
UpÚ
 
th»ad
 
	`ex™
 (
£e
 <
A
 
HREF
=#th»ad_ex™>
	`¡_th»ad_ex™
()</A>), 
a
 
key


926 
has
 
a
 
nÚ
-<
TT
>
NULL
</TT> <TT>
de¡ruùÜ
</TT> 
ªd
 ha ¨nÚ-<TT>NULL</TT> 
v®ue


927 
assocŸ‹d
 
w™h
 
th©
 
key
, 
th’
 
the
 <
TT
>
de¡ruùÜ
</TT> 
funùiÚ
 
wl
 
be


928 
ÿÎed
 
w™h
 
the
 
assocŸ‹d
 
v®ue
.

929 <
P
>

930 <
H5
>
R‘uºs
</H5>

931 
UpÚ
 
sucûssful
 
com¶‘iÚ
, 
a
 
v®ue
 
of
 <
TT
>0</TT> 
is
 
»tuºed
.

932 
Oth”wi£
, 
a
 
v®ue
 
of
 <
TT
>-1</TT> 
is
 
»tuºed
 
ªd
 <TT>
”ºo
</TT> i 
£t


933 
to
 
šdiÿ‹
 
the
 
”rÜ
:<
P
>

934 <
TABLE
 
BORDER
=0>

935 <
TR
><
TD
><
TT
>
EAGAIN
</TT></TD><TD>
The
 
lim™
 
Ú
 
the
 
tÙ®
 
numb”
 
of
 
keys
 
³r


936 
´oûss
 
has
 
b“n
 
	`exûeded
 (
£e
 <
A
 
HREF
=#key_g‘lim™>
	`¡_key_g‘lim™
()</A>).

937 </
TD
></
TR
>

938 </
TABLE
>

939 <
P
>

940 <
H5
>
DesütiÚ
</H5>

941 
If
 
this
 
funùiÚ
 
is
 
sucûssful
, 
ev”y
 
th»ad
 
š
 
the
 
§me
 
´oûss
 i 
ÿ·bË


942 
of
 
assocŸtšg
 
´iv©e
 
d©a
 
w™h
 
the
 
Ãw
 
key
. 
Aá”
 
a
‚ew key 
is
 
ü—‹d
, 
®l


943 
aùive
 
th»ads
 
have
 
the
 
v®ue
 <
TT
>
NULL
</TT> 
assocŸ‹d
 
w™h
 
th©
 
key
.

944 
Aá”
 
a
 
Ãw
 
th»ad
 
is
 
ü—‹d
, 
the
 
v®ue
 <
TT
>
NULL
</TT> i 
assocŸ‹d
 
w™h


945 
®l
 
keys
 
th©
 
th»ad
. 
If
 
a
 
nÚ
-<
TT
>
NULL
</TT> 
de¡ruùÜ
 
funùiÚ
 
is


946 
»gi¡”ed
 
w™h
 
a
 
Ãw
 
key
, 
™
 
wl
 
be
 
ÿÎed
 
©
 
Úe
 
of
 
two
 
times
, 
as
 as

947 
the
 
´iv©e
 
d©a
 
is
 
nÙ
 <
TT
>
NULL
</TT>:

948 <
UL
>

949 <
LI
>
wh’
 
»¶aûm’t
 
´iv©e
 
d©a
 
is
 
£t
 
w™h


950 <
A
 
HREF
=#th»ad_£t¥ecific>
	`¡_th»ad_£t¥ecific
()</A></
LI
>

951 <
LI
>
wh’
 
a
 
th»ad
 
	`ex™s
 (
£e
 <
A
 
HREF
=#th»ad_ex™>
	`¡_th»ad_ex™
()</A>)</LI>

952 </
UL
>

953 <
P
>

954 
The
 
key
 
maššs
 
šd•’d’t
 
d©a
 
v®ues
 
—ch
 
bšdšg
 
th»ad
. 
A
hread

955 
ÿn
 
g‘
 
acûss
 
Úly
 
to
 
™s
 
own
 
th»ad
-
¥ecific
 
d©a
. 
Th”e
 
is
 
no
 
way
o

956 
d—Îoÿ‹
 
a
 
´iv©e
 
d©a
 
key
 
Úû
 
™
 
is
 
®loÿ‹d
.

957 <
P
>

958 <
HR
>

959 <
P
>

960 <
A
 
NAME
="key_getlimit">

961 <
H4
>
	`¡_key_g‘lim™
()</H4>

962 </
A
>

963 
R‘uºs
 
the
 
key
 
lim™
.

964 <
P
>

965 <
H5
>
SyÁax
</H5>

967 <
PRE
>

968 #šşud&
É
;
¡
.
h
&
gt
;

970 
	`¡_key_g‘lim™
();

971 </
PRE
>

972 <
P
>

973 <
H5
>
P¬am‘”s
</H5>

974 
NÚe
.

975 <
P
>

976 <
H5
>
R‘uºs
</H5>

977 
The
 
lim™
 
Ú
 
the
 
tÙ®
 
numb”
 
of
 
keys
 
³r
 
´oûss
.

978 <
P
>

979 <
H5
>
DesütiÚ
</H5>

980 
This
 
funùiÚ
 
ÿn
 
be
 
u£d
 
to
 
obš
 
the
 
lim™
 
Ú
h
tÙ®
 
numb”
 
of
 
keys


981 
³r
 
	`´oûss
 (
£e
 <
A
 
HREF
=#key_ü—‹>
	`¡_key_ü—‹
()</A>).

982 <
P
>

983 <
HR
>

984 <
P
>

985 <
A
 
NAME
="thread_setspecific">

986 <
H4
>
	`¡_th»ad_£t¥ecific
()</H4>

987 </
A
>

988 
S‘s
 
³r
-
th»ad
 
´iv©e
 
d©a
.

989 <
P
>

990 <
H5
>
SyÁax
</H5>

992 <
PRE
>

993 #šşud&
É
;
¡
.
h
&
gt
;

995 
	`¡_th»ad_£t¥ecific
(
key
, *
v®ue
);

996 </
PRE
>

997 <
P
>

998 <
H5
>
P¬am‘”s
</H5>

999 <
TT
>
	`¡_th»ad_£t¥ecific
()</TT> 
has
 
the
 
fŞlowšg
 
·¿m‘”s
:<
P
>

1000 <
TT
>
key
</TT><
P
>

1001 
This
 
·¿m‘”
 
»´e£Ás
 
a
 
key
 
w™h
 
which
 
th»ad
-
¥ecific
 
d©a
 
is
 
assocŸ‹d
.

1002 <
P
>

1003 <
TT
>
v®ue
</TT><
P
>

1004 
The
 
³r
-
th»ad
 
´iv©e
 
d©a
, 
Ü
 
mÜe
 
lik–y
, 
a
 
poš‹r
 
to
 
the
 d©¨
which
 
is


1005 
assocŸ‹d
 
w™h
 <
TT
>
key
</TT>.

1006 <
P
>

1007 <
H5
>
R‘uºs
</H5>

1008 
UpÚ
 
sucûssful
 
com¶‘iÚ
, 
a
 
v®ue
 
of
 <
TT
>0</TT> 
is
 
»tuºed
.

1009 
Oth”wi£
, 
a
 
v®ue
 
of
 <
TT
>-1</TT> 
is
 
»tuºed
 
ªd
 <TT>
”ºo
</TT> i 
£t


1010 
to
 
šdiÿ‹
 
the
 
”rÜ
:<
P
>

1011 <
TABLE
 
BORDER
=0>

1012 <
TR
><
TD
><
TT
>
EINVAL
</TT></TD><TD>
The
 
¥ecif›d
 <TT>
key
</TT> 
is
 
šv®id
.</TD>

1013 </
TR
>

1014 </
TABLE
>

1015 <
P
>

1016 <
H5
>
DesütiÚ
</H5>

1017 
This
 
funùiÚ
 
assocŸ‹s
 
a
 
th»ad
-
¥ecific
 <
TT
>
v®ue
</TT> 
w™h
 <TT>
key
</TT>.

1018 
Difã»Á
 
th»ads
 
may
 
bšd
 
difã»Á
 
v®ues
 
to
 
the
 
§me
 
key
.<
P
>

1019 
If
 
the
 
th»ad
 
®»ady
 
has
 
nÚ
-<
TT
>
NULL
</TT> 
´iv©e
 
d©a
 
assocŸ‹d
 
w™h


1020 <
TT
>
key
</TT>, 
ªd
 
the
 
de¡ruùÜ
 
funùiÚ
 
th©
 key 
is
 
nÙ


1021 <
TT
>
NULL
</TT>, 
this
 
de¡ruùÜ
 
funùiÚ
 
wl
 
be
 
ÿÎed
 
befÜe
 
£‰šg
 
the


1022 
Ãw
 
d©a
 
v®ue
.

1023 <
P
>

1024 <
HR
>

1025 <
P
>

1026 <
A
 
NAME
="thread_getspecific">

1027 <
H4
>
	`¡_th»ad_g‘¥ecific
()</H4>

1028 </
A
>

1029 
R‘r›ves
 
the
 
³r
-
th»ad
 
´iv©e
 
d©a
 th
cu¼’t
hread.

1030 <
P
>

1031 <
H5
>
SyÁax
</H5>

1033 <
PRE
>

1034 #šşud&
É
;
¡
.
h
&
gt
;

1036 *
	`¡_th»ad_g‘¥ecific
(
key
);

1037 </
PRE
>

1038 <
P
>

1039 <
H5
>
P¬am‘”s
</H5>

1040 <
TT
>
	`¡_th»ad_g‘¥ecific
()</TT> 
has
 
the
 
fŞlowšg
 
·¿m‘”s
:<
P
>

1041 <
TT
>
key
</TT><
P
>

1042 
This
 
·¿m‘”
 
»´e£Ás
 
a
 
key
 
w™h
 
which
 
th»ad
-
¥ecific
 
d©a
 
is
 
assocŸ‹d
.

1043 <
P
>

1044 <
H5
>
R‘uºs
</H5>

1045 
The
 
th»ad
-
¥ecific
 
d©a
 
assocŸ‹d
 
w™h
 <
TT
>
key
</TT>. 
If
 
no
 d©¨
is


1046 
assocŸ‹d
 
w™h
 <
TT
>
key
</TT>, 
th’
 <TT>
NULL
</TT> 
is
 
»tuºed
.

1047 <
P
>

1048 <
H5
>
DesütiÚ
</H5>

1049 
This
 
funùiÚ
 
»tuºs
 
the
 
ÿÎšg
 
th»ad
's valuehat is boundohe

1050 
¥ecif›d
 <
TT
>
key
</TT> (
£e


1051 <
A
 
HREF
=#th»ad_£t¥ecific>
	`¡_th»ad_£t¥ecific
()</A>).

1052 <
P
>

1053 <
HR
>

1054 <
P
>

1056 <
A
 
NAME
="sync">

1057 <
H2
>
SynchrÚiz©iÚ
</H2>

1058 </
A
>

1059 <
P
>

1060 
The£
 
funùiÚs
 
İ”©e
 
Ú
 <
A
 
HREF
=#cÚd_t>
cÚd™iÚ
 
v¬ŸbËs
</A>

1061 
ªd
 <
A
 
HREF
=#mu‹x_t>
mutu®
 
exşusiÚ
 
locks
</A> (
mu‹xes
).<
P
>

1062 
FunùiÚs
 
¬e
 
´ovided
 
to
 
wa™
 
Ú
 
a
 
cÚd™iÚ
 
v¬ŸbË
 
ªd
Ø
wake
 
up


1063 (
sigÇl
è
th»ads
 
th©
 
¬e
 
wa™šg
 
Ú
 
the
 
cÚd™iÚ
 
v¬ŸbË
.

1064 <
P
>

1065 <
DL
>

1066 <
DD
><
A
 
HREF
=#cÚd_Ãw>
	`¡_cÚd_Ãw
()</A></DD>

1067 <
DD
><
A
 
HREF
=#cÚd_de¡roy>
	`¡_cÚd_de¡roy
()</A></DD>

1068 <
DD
><
A
 
HREF
=#cÚd_wa™>
	`¡_cÚd_wa™
()</A></DD>

1069 <
DD
><
A
 
HREF
=#cÚd_timedwa™>
	`¡_cÚd_timedwa™
()</A></DD>

1070 <
DD
><
A
 
HREF
=#cÚd_sigÇl>
	`¡_cÚd_sigÇl
()</A></DD>

1071 <
DD
><
A
 
HREF
=#cÚd_brßdÿ¡>
	`¡_cÚd_brßdÿ¡
()</A></DD>

1072 <
P
>

1073 <
DD
><
A
 
HREF
=#mu‹x_Ãw>
	`¡_mu‹x_Ãw
()</A></DD>

1074 <
DD
><
A
 
HREF
=#mu‹x_de¡roy>
	`¡_mu‹x_de¡roy
()</A></DD>

1075 <
DD
><
A
 
HREF
=#mu‹x_lock>
	`¡_mu‹x_lock
()</A></DD>

1076 <
DD
><
A
 
HREF
=#mu‹x_Œylock>
	`¡_mu‹x_Œylock
()</A></DD>

1077 <
DD
><
A
 
HREF
=#mu‹x_uÆock>
	`¡_mu‹x_uÆock
()</A></DD>

1078 </
DL
>

1079 <
P
>

1080 <
HR
>

1081 <
P
>

1082 <
A
 
NAME
="cond_new">

1083 <
H4
>
	`¡_cÚd_Ãw
()</H4>

1084 </
A
>

1085 
C»©es
 
a
 
Ãw
 
cÚd™iÚ
 
v¬ŸbË
.

1086 <
P
>

1087 <
H5
>
SyÁax
</H5>

1089 <
PRE
>

1090 #šşud&
É
;
¡
.
h
&
gt
;

1092 
¡_cÚd_t
 
	`¡_cÚd_Ãw
();

1093 </
PRE
>

1094 <
P
>

1095 <
H5
>
P¬am‘”s
</H5>

1096 
NÚe
.

1097 <
P
>

1098 <
H5
>
R‘uºs
</H5>

1099 
UpÚ
 
sucûssful
 
com¶‘iÚ
, 
a
 
Ãw
 
cÚd™iÚ
 
v¬ŸbË
 
id’tif›r
 
is
 
»tuºed
.

1100 
Oth”wi£
, <
TT
>
NULL
</TT> 
is
 
»tuºed
 
ªd
 <TT>
”ºo
</TT> i 
£t


1101 
to
 
šdiÿ‹
 
the
 
”rÜ
.

1102 <
P
>

1103 <
H5
>
DesütiÚ
</H5>

1104 
This
 
funùiÚ
 
ü—‹s
 
a
 
Ãw
 
cÚd™iÚ
 
v¬ŸbË
.

1105 <
P
>

1106 <
HR
>

1107 <
P
>

1108 <
A
 
NAME
="cond_destroy">

1109 <
H4
>
	`¡_cÚd_de¡roy
()</H4>

1110 </
A
>

1111 
De¡roys
 
a
 
cÚd™iÚ
 
v¬ŸbË
.

1112 <
P
>

1113 <
H5
>
SyÁax
</H5>

1115 <
PRE
>

1116 #šşud&
É
;
¡
.
h
&
gt
;

1118 
	`¡_cÚd_de¡roy
(
¡_cÚd_t
 
cv¬
);

1119 </
PRE
>

1120 <
P
>

1121 <
H5
>
P¬am‘”s
</H5>

1122 <
TT
>
	`¡_cÚd_de¡roy
()</TT> 
has
 
the
 
fŞlowšg
 
·¿m‘”s
:<
P
>

1123 <
TT
>
cv¬
</TT><
P
>

1124 
An
 
id’tif›r
 
of
 
the
 
cÚd™iÚ
 
v¬ŸbË
 
objeù
 
to
 
be
 
de¡royed
.

1125 <
P
>

1126 <
H5
>
R‘uºs
</H5>

1127 
UpÚ
 
sucûssful
 
com¶‘iÚ
, 
a
 
v®ue
 
of
 <
TT
>0</TT> 
is
 
»tuºed
.

1128 
Oth”wi£
, 
a
 
v®ue
 
of
 <
TT
>-1</TT> 
is
 
»tuºed
 
ªd
 <TT>
”ºo
</TT> i 
£t


1129 
to
 
šdiÿ‹
 
the
 
”rÜ
:<
P
>

1130 <
TABLE
 
BORDER
=0>

1131 <
TR
><
TD
><
TT
>
EBUSY
</TT></TD><TD>
The
 
cÚd™iÚ
 
v¬ŸbË
 
is
 
cu¼’y
 
bešg


1132 
u£d
 
by
 
Úe
 
Ü
 
mÜe
 
th»ads
.</
TD
>

1133 </
TR
>

1134 </
TABLE
>

1135 <
P
>

1136 <
H5
>
DesütiÚ
</H5>

1137 
This
 
funùiÚ
 
de¡roys
 
a
 
cÚd™iÚ
 
v¬ŸbË
. 
The
 
ÿÎ”
 
is
 
»¥ÚsibË
 

1138 
’suršg
 
th©
 
the
 
cÚd™iÚ
 
v¬ŸbË
 
is
 
no
 
lÚg”
 
š
 
u£
.

1139 <
P
>

1140 <
HR
>

1141 <
P
>

1142 <
A
 
NAME
="cond_wait">

1143 <
H4
>
	`¡_cÚd_wa™
()</H4>

1144 </
A
>

1145 
Wa™s
 
Ú
 
a
 
cÚd™iÚ
.

1146 <
P
>

1147 <
H5
>
SyÁax
</H5>

1149 <
PRE
>

1150 #šşud&
É
;
¡
.
h
&
gt
;

1152 
	`¡_cÚd_wa™
(
¡_cÚd_t
 
cv¬
);

1153 </
PRE
>

1154 <
P
>

1155 <
H5
>
P¬am‘”s
</H5>

1156 <
TT
>
	`¡_cÚd_wa™
()</TT> 
has
 
the
 
fŞlowšg
 
·¿m‘”s
:<
P
>

1157 <
TT
>
cv¬
</TT><
P
>

1158 
The
 
cÚd™iÚ
 
v¬ŸbË
 
Ú
 
which
 
to
 
wa™
.

1159 <
P
>

1160 <
H5
>
R‘uºs
</H5>

1161 
UpÚ
 
sucûssful
 
com¶‘iÚ
, 
a
 
v®ue
 
of
 <
TT
>0</TT> 
is
 
»tuºed
.

1162 
Oth”wi£
, 
a
 
v®ue
 
of
 <
TT
>-1</TT> 
is
 
»tuºed
 
ªd
 <TT>
”ºo
</TT> i 
£t


1163 
to
 
šdiÿ‹
 
the
 
”rÜ
:<
P
>

1164 <
TABLE
 
BORDER
=0>

1165 <
TR
><
TD
><
TT
>
EINTR
</TT></TD><TD>
The
 
cu¼’t
 
th»ad
 
was
 
š‹¼u±ed
 
by


1166 <
A
 
HREF
=#th»ad_š‹¼u±>
	`¡_th»ad_š‹¼u±
()</A>.</
TD
></
TR
>

1167 </
TABLE
>

1168 <
P
>

1169 <
H5
>
DesütiÚ
</H5>

1170 
This
 
funùiÚ
 
is
 
u£d
 
to
 
block
 
Ú
 
a
 
cÚd™iÚ
 
v¬ŸbË
. 
A
  
äom
 
this


1171 
funùiÚ
 
dÛs
 
nÙ
 
gu¬ª‹e
 
th©
 
the
 
cÚd™iÚ
 
Ü
 
ev’t
 
which
h
ÿÎ”


1172 
was
 
wa™šg
 
aùu®ly
 
occu¼ed
. 
It
 
is
 
the
 
»¥Úsib™y
 
of
h
ÿÎ”


1173 
to
 
»check
 
the
 
cÚd™iÚ
 
wa™
 
´ediÿ‹
 
befÜe
 
´oûedšg
.<
P
>

1174 <
B
>
NÙe
:</B> 
The
 
S‹
 
Th»ads
 
lib¿ry
 
schedulšg
 
gu¬ª‹es
 
th©
 
the


1175 
cÚd™iÚ
 
ÿÂÙ
 
chªge
 
b‘w“n
 
the
 
checkšg
 
ªd
 
blockšg
, 
th”efÜe
 
th”e


1176 
is
 
no
 
Ãed
 
mu‹x
 
´ÙeùiÚ
. 
You
 
mu¡
 
nÙ
 
ÿÎ
 
ªy


1177 <
A
 
HREF
=#block>
blockšg
 
funùiÚs
</A> 
b‘w“n
 
the
 
cÚd™iÚ
 
checkšg
 
ªd


1178 
the
 <
TT
>
	`¡_cÚd_wa™
()</TT> 
ÿÎ
.

1179 <
P
>

1180 <
HR
>

1181 <
P
>

1182 <
A
 
NAME
="cond_timedwait">

1183 <
H4
>
	`¡_cÚd_timedwa™
()</H4>

1184 </
A
>

1185 
Wa™s
 
Ú
 
a
 
cÚd™iÚ
.

1186 <
P
>

1187 <
H5
>
SyÁax
</H5>

1189 <
PRE
>

1190 #šşud&
É
;
¡
.
h
&
gt
;

1192 
	`¡_cÚd_timedwa™
(
¡_cÚd_t
 
cv¬
, 
¡_utime_t
 
timeout
);

1193 </
PRE
>

1194 <
P
>

1195 <
H5
>
P¬am‘”s
</H5>

1196 <
TT
>
	`¡_cÚd_timedwa™
()</TT> 
has
 
the
 
fŞlowšg
 
·¿m‘”s
:<
P
>

1197 <
TT
>
cv¬
</TT><
P
>

1198 
The
 
cÚd™iÚ
 
v¬ŸbË
 
Ú
 
which
 
to
 
wa™
.<
P
>

1199 <
TT
>
timeout
</TT><
P
>

1200 
If
 
the
 
numb”
 
of
 
miüo£cÚds
 
¥ecif›d
 
by
 
this
 
·¿m‘”
 
·s£s
 
befÜe
he

1201 
wa™šg
 
th»ad
 
is
 
sigÇÎed
, 
ª
 
”rÜ
 i 
»tuºed
. 
This
 
·¿m‘”
 i 
a


1202 
v¬ŸbË
 
of
 
ty³
 <
A
 
HREF
=#utime_t><
B
>
¡_utime_t
</B></A>. 
NÙe
 
th©
 
this


1203 
time
 
v®ue
 
is
 
a
 <
I
>tim
d–
</I>; 
™
 i 
nÙ
 
ª
 <I>
absŞu‹
ime</I>.

1204 
Also
 
nÙe
 
th©
 
timeouts
 
¬e
 
m—su»d
 <
A
 
HREF
="nÙes.html#timeouts">
sšû


1205 
the
 
Ï¡
 
cÚ‹xt
 </
A
>.

1206 <
P
>

1207 <
H5
>
R‘uºs
</H5>

1208 
UpÚ
 
sucûssful
 
com¶‘iÚ
, 
a
 
v®ue
 
of
 <
TT
>0</TT> 
is
 
»tuºed
.

1209 
Oth”wi£
, 
a
 
v®ue
 
of
 <
TT
>-1</TT> 
is
 
»tuºed
 
ªd
 <TT>
”ºo
</TT> i 
£t


1210 
to
 
šdiÿ‹
 
the
 
”rÜ
:<
P
>

1211 <
TABLE
 
BORDER
=0>

1212 <
TR
><
TD
><
TT
>
EINTR
</TT></TD><TD>
The
 
cu¼’t
 
th»ad
 
was
 
š‹¼u±ed
 
by


1213 <
A
 
HREF
=#th»ad_š‹¼u±>
	`¡_th»ad_š‹¼u±
()</A>.</
TD
></
TR
>

1214 <
TR
><
TD
><
TT
>
ETIME
</TT></TD><TD>
The
 
timeout
 
occu¼ed
 
befÜe
 
the
 
th»ad
 
was


1215 
awak’ed
 
by
 <
A
 
HREF
=#cÚd_sigÇl>
	`¡_cÚd_sigÇl
()</A> 
Ü


1216 <
A
 
HREF
=#cÚd_brßdÿ¡>
	`¡_cÚd_brßdÿ¡
()</A>.</
TD
></
TR
>

1217 </
TABLE
>

1218 <
P
>

1219 <
H5
>
DesütiÚ
</H5>

1220 
This
 
funùiÚ
 
wÜks
 
the
 
§me
 
way
 
as
 <
A
 
HREF
=#cÚd_wa™>
	`¡_cÚd_wa™
()</A>,

1221 
exû±
 
th©
 
ª
 
”rÜ
 
is
 
»tuºed
 
the
 
numb”
 
of
 
miüo£cÚds
 
¥ecif›d
 
by


1222 <
TT
>
timeout
</TT> 
·s£s
 
befÜe
 
the
 
wa™šg
 
th»ad
 
is
 
sigÇÎed
.

1223 <
P
>

1224 <
HR
>

1225 <
P
>

1226 <
A
 
NAME
="cond_signal">

1227 <
H4
>
	`¡_cÚd_sigÇl
()</H4>

1228 </
A
>

1229 
Unblocks
 
a
 
th»ad
 
wa™šg
 
Ú
‡ 
cÚd™iÚ
 
v¬ŸbË
.

1230 <
P
>

1231 <
H5
>
SyÁax
</H5>

1233 <
PRE
>

1234 #šşud&
É
;
¡
.
h
&
gt
;

1236 
	`¡_cÚd_sigÇl
(
¡_cÚd_t
 
cv¬
);

1237 </
PRE
>

1238 <
P
>

1239 <
H5
>
P¬am‘”s
</H5>

1240 <
TT
>
	`¡_cÚd_sigÇl
()</TT> 
has
 
the
 
fŞlowšg
 
·¿m‘”s
:<
P
>

1241 <
TT
>
cv¬
</TT><
P
>

1242 
The
 
cÚd™iÚ
 
v¬ŸbË
 
to
 
sigÇl
.

1243 <
P
>

1244 <
H5
>
R‘uºs
</H5>

1245 
Always
 
z”o
.

1246 <
P
>

1247 <
H5
>
DesütiÚ
</H5>

1248 
This
 
funùiÚ
 
	$unblocks
 (
sigÇls
è
Úe
 
of
 
the
 
th»ads
 
th©
 
¬e
 
blocked
 
Ú


1249 <
TT
>
cv¬
</TT> 
©
 
the
 
time
 
of
h
ÿÎ
. 
If
 
no
 
th»ad
 
is
 
wa™šg
 
Ú
he

1250 
cÚd™iÚ
 
v¬ŸbË
, 
the
 
sigÇl
 
İ”©iÚ
 
is
 
a
 
no
-
İ
.

1251 <
P
>

1252 <
HR
>

1253 <
P
>

1254 <
A
 
NAME
="cond_broadcast">

1255 <
H4
>
	`¡_cÚd_brßdÿ¡
()</H4>

1256 </
A
>

1257 
Unblocks
 
®l
 
th»ads
 
wa™šg
 
Ú
 
a
 
cÚd™iÚ
 
v¬ŸbË
.

1258 <
P
>

1259 <
H5
>
SyÁax
</H5>

1261 <
PRE
>

1262 #šşud&
É
;
¡
.
h
&
gt
;

1264 
	`¡_cÚd_brßdÿ¡
(
¡_cÚd_t
 
cv¬
);

1265 </
PRE
>

1266 <
P
>

1267 <
H5
>
P¬am‘”s
</H5>

1268 <
TT
>
	`¡_cÚd_brßdÿ¡
()</TT> 
has
 
the
 
fŞlowšg
 
·¿m‘”s
:<
P
>

1269 <
TT
>
cv¬
</TT><
P
>

1270 
The
 
cÚd™iÚ
 
v¬ŸbË
 
to
 
brßdÿ¡
.

1271 <
P
>

1272 <
H5
>
R‘uºs
</H5>

1273 
Always
 
z”o
.

1274 <
P
>

1275 <
H5
>
DesütiÚ
</H5>

1276 
This
 
funùiÚ
 
unblocks
 
®l
 
th»ads
 
blocked
 
Ú
 
the
 
¥ecif›d
 
cÚd™iÚ


1277 
v¬ŸbË
 
©
 
the
 
time
 
of
h
ÿÎ
. 
If
 
no
 
th»ads
 
¬e
 
wa™šg
, 
this
 
İ”©iÚ


1278 
is
 
a
 
no
-
İ
.

1279 <
P
>

1280 <
HR
>

1281 <
P
>

1283 <
A
 
NAME
="mutex_new">

1284 <
H4
>
	`¡_mu‹x_Ãw
()</H4>

1285 </
A
>

1286 
C»©es
 
a
 
Ãw
 
mutu®
 
exşusiÚ
 
	`lock
 (
mu‹x
).

1287 <
P
>

1288 <
H5
>
SyÁax
</H5>

1290 <
PRE
>

1291 #šşud&
É
;
¡
.
h
&
gt
;

1293 
¡_mu‹x_t
 
	`¡_mu‹x_Ãw
();

1294 </
PRE
>

1295 <
P
>

1296 <
H5
>
P¬am‘”s
</H5>

1297 
NÚe
.

1298 <
P
>

1299 <
H5
>
R‘uºs
</H5>

1300 
UpÚ
 
sucûssful
 
com¶‘iÚ
, 
a
 
Ãw
 
mu‹x
 
id’tif›r
 
is
 
»tuºed
.

1301 
Oth”wi£
, <
TT
>
NULL
</TT> 
is
 
»tuºed
 
ªd
 <TT>
”ºo
</TT> i 
£t
 
to


1302 
šdiÿ‹
 
the
 
”rÜ
.

1303 <
P
>

1304 <
H5
>
DesütiÚ
</H5>

1305 
This
 
funùiÚ
 
ü—‹s
 
a
 
Ãw
 
İaque
 
mutu®
 
exşusiÚ
 
	`lock
 (
£e


1306 <
A
 
HREF
=#mu‹x_t><
B
>
¡_mu‹x_t
</B></A>).

1307 <
P
>

1308 <
HR
>

1309 <
P
>

1310 <
A
 
NAME
="mutex_destroy">

1311 <
H4
>
	`¡_mu‹x_de¡roy
()</H4>

1312 </
A
>

1313 
De¡roys
 
a
 
¥ecif›d
 
mu‹x
 
objeù
.

1314 <
P
>

1315 <
H5
>
SyÁax
</H5>

1317 <
PRE
>

1318 #šşud&
É
;
¡
.
h
&
gt
;

1320 
	`¡_mu‹x_de¡roy
(
¡_mu‹x_t
 
lock
);

1321 </
PRE
>

1322 <
P
>

1323 <
H5
>
P¬am‘”s
</H5>

1324 <
TT
>
	`¡_mu‹x_de¡roy
()</TT> 
has
 
the
 
fŞlowšg
 
·¿m‘”s
:<
P
>

1325 <
TT
>
lock
</TT><
P
>

1326 
An
 
id’tif›r
 
of
 
the
 
mu‹x
 
objeù
 
to
 
be
 
de¡royed
.

1327 <
P
>

1328 <
H5
>
R‘uºs
</H5>

1329 
UpÚ
 
sucûssful
 
com¶‘iÚ
, 
a
 
v®ue
 
of
 <
TT
>0</TT> 
is
 
»tuºed
.

1330 
Oth”wi£
, 
a
 
v®ue
 
of
 <
TT
>-1</TT> 
is
 
»tuºed
 
ªd
 <TT>
”ºo
</TT> i 
£t


1331 
to
 
šdiÿ‹
 
the
 
”rÜ
:<
P
>

1332 <
TABLE
 
BORDER
=0>

1333 <
TR
><
TD
><
TT
>
EBUSY
</TT></TD><TD>
The
 
mu‹x
 
is
 
cu¼’y
 
bešg
 
u£d
 
by


1334 
Ùh”
 
th»ads
.</
TD
>

1335 </
TR
>

1336 </
TABLE
>

1337 <
P
>

1338 <
H5
>
DesütiÚ
</H5>

1339 
This
 
funùiÚ
 
de¡roys
 
a
 
mu‹x
. 
The
 
ÿÎ”
 
is
 
»¥ÚsibË
 
’suršg


1340 
th©
 
the
 
mu‹x
 
is
 
no
 
lÚg”
 
š
 
u£
.

1341 <
P
>

1342 <
HR
>

1343 <
P
>

1344 <
A
 
NAME
="mutex_lock">

1345 <
H4
>
	`¡_mu‹x_lock
()</H4>

1346 </
A
>

1347 
Locks
 
a
 
¥ecif›d
 
mu‹x
 
objeù
.

1348 <
P
>

1349 <
H5
>
SyÁax
</H5>

1351 <
PRE
>

1352 #šşud&
É
;
¡
.
h
&
gt
;

1354 
	`¡_mu‹x_lock
(
¡_mu‹x_t
 
lock
);

1355 </
PRE
>

1356 <
P
>

1357 <
H5
>
P¬am‘”s
</H5>

1358 <
TT
>
	`¡_mu‹x_lock
()</TT> 
has
 
the
 
fŞlowšg
 
·¿m‘”s
:<
P
>

1359 <
TT
>
lock
</TT><
P
>

1360 
An
 
id’tif›r
 
of
 
the
 
mu‹x
 
objeù
 
to
 
be
 
locked
.

1361 <
P
>

1362 <
H5
>
R‘uºs
</H5>

1363 
UpÚ
 
sucûssful
 
com¶‘iÚ
, 
a
 
v®ue
 
of
 <
TT
>0</TT> 
is
 
»tuºed
.

1364 
Oth”wi£
, 
a
 
v®ue
 
of
 <
TT
>-1</TT> 
is
 
»tuºed
 
ªd
 <TT>
”ºo
</TT> i 
£t


1365 
to
 
šdiÿ‹
 
the
 
”rÜ
:<
P
>

1366 <
TABLE
 
BORDER
=0>

1367 <
TR
><
TD
><
TT
>
EDEADLK
</TT></TD><TD>
The
 
cu¼’t
 
th»ad
 
®»ady
 
owns
 
the
 
mu‹x
.

1368 </
TD
></
TR
>

1369 <
TR
><
TD
><
TT
>
EINTR
</TT></TD><TD>
The
 
cu¼’t
 
th»ad
 
was
 
š‹¼u±ed
 
by


1370 <
A
 
HREF
=#th»ad_š‹¼u±>
	`¡_th»ad_š‹¼u±
()</A>.</
TD
></
TR
>

1371 </
TABLE
>

1372 <
P
>

1373 <
H5
>
DesütiÚ
</H5>

1374 
A
 
th»ad
 
th©
 
ÿÎs
 
this
 
funùiÚ
 
wl
 
block
 
uÁ
 
™
 
ÿn
 
gaš
 
exşusive


1375 
owÃrsh
 
of
 
a
 
mu‹x
, 
ªd
 
»šs
 owÃrsh 
uÁ
 
™
 
ÿÎs


1376 <
A
 
HREF
=#mu‹x_uÆock>
	`¡_mu‹x_uÆock
()</A>.

1377 <
P
>

1378 <
HR
>

1379 <
P
>

1380 <
A
 
NAME
="mutex_trylock">

1381 <
H4
>
	`¡_mu‹x_Œylock
()</H4>

1382 </
A
>

1383 
A‰em±s
 
to
 
acquœe
 
a
 
mu‹x
.

1384 <
P
>

1385 <
H5
>
SyÁax
</H5>

1387 <
PRE
>

1388 #šşud&
É
;
¡
.
h
&
gt
;

1390 
	`¡_mu‹x_Œylock
(
¡_mu‹x_t
 
lock
);

1391 </
PRE
>

1392 <
P
>

1393 <
H5
>
P¬am‘”s
</H5>

1394 <
TT
>
	`¡_mu‹x_Œylock
()</TT> 
has
 
the
 
fŞlowšg
 
·¿m‘”s
:<
P
>

1395 <
TT
>
lock
</TT><
P
>

1396 
An
 
id’tif›r
 
of
 
the
 
mu‹x
 
objeù
 
to
 
be
 
locked
.

1397 <
P
>

1398 <
H5
>
R‘uºs
</H5>

1399 
UpÚ
 
sucûssful
 
com¶‘iÚ
, 
a
 
v®ue
 
of
 <
TT
>0</TT> 
is
 
»tuºed
.

1400 
Oth”wi£
, 
a
 
v®ue
 
of
 <
TT
>-1</TT> 
is
 
»tuºed
 
ªd
 <TT>
”ºo
</TT> i 
£t


1401 
to
 
šdiÿ‹
 
the
 
”rÜ
:<
P
>

1402 <
TABLE
 
BORDER
=0>

1403 <
TR
><
TD
><
TT
>
EBUSY
</TT></TD><TD>
The
 
mu‹x
 
is
 
cu¼’y
 
h–d
 
by
 
ªÙh”


1404 
th»ad
.</
TD
></
TR
>

1405 </
TABLE
>

1406 <
P
>

1407 <
H5
>
DesütiÚ
</H5>

1408 
This
 
funùiÚ
 
©‹m±s
 
to
 
acquœe
 
a
 
mu‹x
. 
If
 
the
 mu‹x 
objeù
 
is
 
locked


1409 (
by
 
ªy
 
th»ad
, 
šşudšg
 
the
 
cu¼’t
h»ad),h
ÿÎ
 
»tuºs
 
immedŸ‹ly


1410 
w™h
 
ª
 
”rÜ
.

1411 <
P
>

1412 <
HR
>

1413 <
P
>

1414 <
A
 
NAME
="mutex_unlock">

1415 <
H4
>
	`¡_mu‹x_uÆock
()</H4>

1416 </
A
>

1417 
R–—£s
 
a
 
¥ecif›d
 
mu‹x
 
objeù
.

1418 <
P
>

1419 <
H5
>
SyÁax
</H5>

1421 <
PRE
>

1422 #šşud&
É
;
¡
.
h
&
gt
;

1424 
	`¡_mu‹x_uÆock
(
¡_mu‹x_t
 
lock
);

1425 </
PRE
>

1426 <
P
>

1427 <
H5
>
P¬am‘”s
</H5>

1428 <
TT
>
	`¡_mu‹x_uÆock
()</TT> 
has
 
the
 
fŞlowšg
 
·¿m‘”s
:<
P
>

1429 <
TT
>
lock
</TT><
P
>

1430 
An
 
id’tif›r
 
of
 
the
 
mu‹x
 
objeù
 
to
 
be
 
uÆocked
.

1431 <
P
>

1432 <
H5
>
R‘uºs
</H5>

1433 
UpÚ
 
sucûssful
 
com¶‘iÚ
, 
a
 
v®ue
 
of
 <
TT
>0</TT> 
is
 
»tuºed
.

1434 
Oth”wi£
, 
a
 
v®ue
 
of
 <
TT
>-1</TT> 
is
 
»tuºed
 
ªd
 <TT>
”ºo
</TT> i 
£t


1435 
to
 
šdiÿ‹
 
the
 
”rÜ
:<
P
>

1436 <
TABLE
 
BORDER
=0>

1437 <
TR
><
TD
><
TT
>
EPERM
</TT></TD><TD>
The
 
cu¼’t
 
th»ad
 
dÛs
 
nÙ
 
own
 
the
 
mu‹x
.

1438 </
TD
></
TR
>

1439 </
TABLE
>

1440 <
P
>

1441 <
H5
>
DesütiÚ
</H5>

1442 
This
 
funùiÚ
 
»Ëa£s
 
a
 
¥ecif›d
 
mu‹x
 
objeù
 
´eviou¦y
 
acquœed
 
by


1443 <
A
 
HREF
=#mu‹x_lock>
	`¡_mu‹x_lock
()</A> 
Ü


1444 <
A
 
HREF
=#mu‹x_Œylock>
	`¡_mu‹x_Œylock
()</A>. 
OÆy
 
the
 
th»ad
 
th©
 
locked


1445 
a
 
mu‹x
 
should
 
uÆock
 
™
.

1446 <
P
>

1447 <
HR
>

1448 <
P
>

1450 <
A
 
NAME
="timing">

1451 <
H2
>
Timšg
</H2>

1452 </
A
>

1453 <
P
>

1454 <
DL
>

1455 <
DD
><
A
 
HREF
=#utime>
	`¡_utime
()</A></DD>

1456 <
DD
><
A
 
HREF
=#£t_utime_funùiÚ>
	`¡_£t_utime_funùiÚ
()</A></DD>

1457 <
DD
><
A
 
HREF
=#timeÿche_£t>
	`¡_timeÿche_£t
()</A></DD>

1458 <
DD
><
A
 
HREF
=#time>
	`¡_time
()</A></DD>

1459 </
DL
>

1460 <
P
>

1461 <
HR
>

1462 <
P
>

1463 <
A
 
NAME
="utime">

1464 <
H4
>
	`¡_utime
()</H4>

1465 </
A
>

1466 
R‘uºs
 
cu¼’t
 
high
-
»sŞutiÚ
 
time
.

1467 <
P
>

1468 <
H5
>
SyÁax
</H5>

1470 <
PRE
>

1471 #šşud&
É
;
¡
.
h
&
gt
;

1473 
¡_utime_t
 
	`¡_utime
();

1474 </
PRE
>

1475 <
P
>

1476 <
H5
>
P¬am‘”s
</H5>

1477 
NÚe
.

1478 <
P
>

1479 <
H5
>
R‘uºs
</H5>

1480 
Cu¼’t
 
high
-
»sŞutiÚ
 
time
 
v®ue
 
of
 
ty³


1481 <
A
 
HREF
=#utime_t><
B
>
¡_utime_t
</B></A>.

1482 <
P
>

1483 <
H5
>
DesütiÚ
</H5>

1484 
This
 
funùiÚ
 
»tuºs
 
the
 
cu¼’t
 
high
-
»sŞutiÚ
 
time
. 
Time
 
is


1485 
ex´es£d
 
as
 
miüo£cÚds
 
sšû
 
some
 
¬b™¿ry
 
time
 
š
 
the
 
·¡
. 
It
 
is


1486 
nÙ
 
cÜ»Ï‹d
 
š
 
ªy
 
way
 
to
 
the
 
time
 
of
 
day
. 
S“
 
®so
 <
A


1487 
HREF
=#utime_t><
B
>
¡_utime_t
</B></
A
> 
ªd
 <A

1488 
HREF
="#time"><
B
>
	`¡_time
()</B></
A
>.

1489 <
P
>

1490 <
HR
>

1491 <
P
>

1492 <
A
 
NAME
="set_utime_function">

1493 <
H4
>
	`¡_£t_utime_funùiÚ
()</H4>

1494 </
A
>

1495 
S‘
 
high
-
»sŞutiÚ
 
time
 
funùiÚ
.

1496 <
P
>

1497 <
H5
>
SyÁax
</H5>

1499 <
PRE
>

1500 #šşud&
É
;
¡
.
h
&
gt
;

1502 
	`¡_£t_utime_funùiÚ
(
	$¡_utime_t
 (*
func
)());

1503 </
PRE
>

1504 <
P
>

1505 <
H5
>
P¬am‘”s
</H5>

1506 <
TT
>
	`¡_£t_utime_funùiÚ
()</TT> 
has
 
the
 
fŞlowšg
 
·¿m‘”s
:<
P
>

1507 <
TT
>
func
</TT><
P
>

1508 
This
 
funùiÚ
 
wl
 
be
 
ÿÎed
 
to
 
g‘
 
high
-
»sŞutiÚ
 
time
 
š¡—d
 
of
 
the


1509  <
A
 
HREF
=#utime>
	`¡_utime
()</A> 
funùiÚ
. 
It
 
mu¡
 

1510 
numb”
 
of
 
miüo£cÚds
 
sšû
 
some
 
¬b™¿ry
 
time
 
š
 
the
 
·¡
.

1511 <
P
>

1512 <
H5
>
R‘uºs
</H5>

1513 
UpÚ
 
sucûssful
 
com¶‘iÚ
, 
a
 
v®ue
 
of
 <
TT
>0</TT> 
is
 
»tuºed
.

1514 
Oth”wi£
, 
a
 
v®ue
 
of
 <
TT
>-1</TT> 
is
 
»tuºed
 
ªd
 <TT>
”ºo
</TT> i 
£t


1515 
to
 <
TT
>
EINVAL
</TT>Ø
šdiÿ‹
 
the
 
”rÜ
.

1516 <
P
>

1517 <
H5
>
DesütiÚ
</H5>

1518 
This
 
funùiÚ
 
may
 
be
 
ÿÎed
 
to
 
»¶aû
 
the
  
im¶em’tiÚ
 
of
he

1519 <
A
 
HREF
=#utime>
	`¡_utime
()</A> 
funùiÚ
. 
It
 
mu¡
 
be
 
ÿÎed
 
befÜe
 
the
 
ST


1520 
lib¿ry
 
has
 
b“n
 
	`š™Ÿlized
 (
£e
 <
A
 
HREF
=#¡_š™>
	`¡_š™
()</A>).

1521 
The
 
u£r
-
´ovided
 
funùiÚ
 <
TT
>
func
</TT> 
wl
 
be
 
švoked
 
wh’ev”


1522 <
A
 
HREF
=#utime>
	`¡_utime
()</A> 
is
 
ÿÎed
 
to
 
obš
 
cu¼’t
 
high
-
»sŞutiÚ
 
time
.

1523 
R•Ïcšg
  
im¶em’tiÚ
 
may
 
be
 
u£ful
, 
exam¶e
, 
kšg


1524 
advªge
 
of
 
high
 
³rfÜmªû
 
CPU
 
cyşe
 
couÁ”s
.

1525 <
P
>

1526 <
HR
>

1527 <
P
>

1528 <
A
 
NAME
="timecache_set">

1529 <
H4
>
	`¡_timeÿche_£t
()</H4>

1530 </
A
>

1531 
Tuºs
 
the
 
time
 
ÿchšg
 
Ú
 
Ü
 
off
.

1532 <
P
>

1533 <
H5
>
SyÁax
</H5>

1535 <
PRE
>

1536 #šşud&
É
;
¡
.
h
&
gt
;

1538 
	`¡_timeÿche_£t
(
Ú
);

1539 </
PRE
>

1540 <
P
>

1541 <
H5
>
P¬am‘”s
</H5>

1542 <
TT
>
	`¡_timeÿche_£t
()</TT> 
has
 
the
 
fŞlowšg
 
·¿m‘”s
:<
P
>

1543 <
TT
>
Ú
</TT><
P
>

1544 
If
 
this
 
·¿m‘”
 
has
 
a
 
nÚ
-
z”o
 
v®ue
, 
the
 
time
 
ÿchšg
 
is
 
tuºed
 
Ú


1545 (
’abËd
). 
Oth”wi£
, 
the
 
time
 
ÿchšg
 
is
 
tuºed
 
	`off
 (
di§bËd
).

1546 
By
  
time
 
ÿchšg
 
is
 
di§bËd
.

1547 <
P
>

1548 <
H5
>
R‘uºs
</H5>

1549 
The
 
´evious
 
¡©e
 
of
 
time
 
	`ÿchšg
 (
a
 
v®ue
 oà<
TT
>0</TT> 
™
 
was
 
off
 
ªd


1550 
a
 
v®ue
 
of
 <
TT
>1</TT> 
Ùh”wi£
).

1551 <
P
>

1552 <
H5
>
DesütiÚ
</H5>

1553 
The
 
S‹
 
Th»ads
 
lib¿ry
 
has
 
the
 
ab™y
 
to
 "ÿche"h
time
 
v®ue
 
th©
 
is


1554 
»pÜ‹d
 
by
 
the
 <
TT
>
	`time
(2)</TT> 
sy¡em
 
ÿÎ
. 
If
h
time
 
ÿchšg
 
is
 
’abËd


1555 
by
 
ÿÎšg
 
this
 
funùiÚ
 
w™h
 
a
 
nÚ
-
z”o
 
¬gum’t
, 
th’
 
the
 
»suÉ
 
v®ue


1556 
of
 <
TT
>
	`time
(2)</TT> 
wl
 
be
 
¡Üed
 
ªd
 
upd©ed
 
©
 
mo¡
 
Úû
 
³r
 
£cÚd
. 
The


1557 
ÿched
 
time
 
ÿn
 
be
 
»Œ›ved
 
by
 <
A
 
HREF
=#time>
	`¡_time
()</A>.

1558 
By
  
time
 
ÿchšg
 
is
 
di§bËd
.

1559 
You
 
may
 
’abË
 
Ü
 
di§bË
 
time
 
ÿchšg
 
©
 
ªy
im
but
 
g’”®ly


1560 
you
 
’abË
 
™
 
	$Úû
 (
desœed
è
duršg
 
´og¿m
 
š™Ÿliz©iÚ
.<
P
>

1561 <
B
>
NÙe
:</B> 
Th”e
 
¬e
 
some
 
·thŞogiÿl
 
	$ÿ£s
 (
e
.
g
., 
v”y
 
h—vy
 
lßds
 
duršg


1562 
­¶iÿtiÚ
 
b’chm¬kšg
è
wh’
 
a
 
sšgË
 
th»ad
 
runs
 ¨
time
 
w™hout


1563 
givšg
 
up
 
cÚŒŞ
 
ªd
 
the
 
ÿched
 
time
 
v®ue
 
is
 
nÙ
 
upd©ed
 
´İ”ly
. 
If
 
you


1564 <
I
>
®ways
</I> 
Ãed
 "»®-time" 
time
 
v®ues
, 
dÚ
'tƒnableheime caching.

1565 <
P
>

1566 <
HR
>

1567 <
P
>

1568 <
A
 
NAME
="time">

1569 <
H4
>
	`¡_time
()</H4>

1570 </
A
>

1571 
R‘uºs
 
the
 
v®ue
 
of
 
time
 
š
 
£cÚds
 
sšû
 00:00:00 
UTC
, 
Jªu¬y
 1, 1970.

1572 <
P
>

1573 <
H5
>
SyÁax
</H5>

1575 <
PRE
>

1576 #šşud&
É
;
¡
.
h
&
gt
;

1578 
time_t
 
	`¡_time
();

1579 </
PRE
>

1580 <
P
>

1581 <
H5
>
P¬am‘”s
</H5>

1582 
NÚe
.

1583 <
P
>

1584 <
H5
>
R‘uºs
</H5>

1585 
The
 
v®ue
 
of
 
time
 
š
 
£cÚds
 
sšû
 00:00:00 
UTC
, 
Jªu¬y
 1, 1970 
as
 
»pÜ‹d


1586 
by
 
the
 <
TT
>
	`time
(2)</TT> 
sy¡em
 
ÿÎ
.

1587 <
P
>

1588 <
H5
>
DesütiÚ
</H5>

1589 
If
 
the
 
time
 
ÿchšg
 
was
 
’abËd
 
by


1590 <
A
 
HREF
=#timeÿche_£t>
	`¡_timeÿche_£t
()</A>, 
th’
 
this
 
funùiÚ
 
»tuºs


1591 
the
 
ÿched
 
»suÉ
. 
Oth”wi£
, 
™
 
ju¡
 
ÿÎs
 <
TT
>
	`time
(2)</TT>.

1592 <
P
>

1593 <
HR
>

1594 <
P
>

1596 <
A
 
NAME
="io">

1597 <
H2
>
I
/
O
 
FunùiÚs
</H2>

1598 </
A
>

1599 <
P
>

1600 
Mo¡
 
S‹
 
Th»ads
 
lib¿ry
 
I
/
O
 
funùiÚs
 
look
 
like
 
cÜ»¥Údšg
 
C
†ibrary

1601 
funùiÚs
 
w™h
 
two
 
exû±iÚs
:

1602 <
UL
>

1603 <
LI
>
They
 
İ”©e
 
Ú
 
fe
 
desütÜ
 
objeùs
 
of
 
ty³


1604 <
A
 
HREF
=#Ãtfd_t><
B
>
¡_Ãtfd_t
</B></A>.</
LI
>

1605 <
LI
>
They
 
ke
 
ª
 
add™iÚ®
 
¬gum’t
 
of
 
ty³


1606 <
A
 
HREF
=#utime_t><
B
>
¡_utime_t
</B></A> 
which
 
»´e£Ás
 
ª
 <
I
>
šaùiv™y


1607 
timeout
</
I
>: 
no
 I/
O
 
is
 
possibË
 
duršg
 
this
 
amouÁ
 
of
 
time
, I/O 
funùiÚs


1608  
ª
 
”rÜ
 
code
 
ªd
 
£t
 <
TT
>
”ºo
</TT> 
to
 <TT>
ETIME
</TT>.

1610 
The
 
bound¬y
 
v®ues
 <
‰
>
ST_UTIME_NO_WAIT
</‰> (<
TT
>0</TT>è
ªd


1611 <
‰
>
ST_UTIME_NO_TIMEOUT
</‰> (<
TT
>-1</TT>è
this
 
¬gum’t
 
šdiÿ‹


1612 
th©
 
the
 
th»ad
 
should
 
wa™
 
no
 
	$time
 (
funùiÚ
 
»tuºs
 
immedŸ‹ly
è
Ü


1613 
wa™
 
	`fÜev”
 (
Ãv”
 
time
 
out
), 
»¥eùiv–y
.

1615 
NÙe
 
th©
 
timeouts
 
¬e
 
m—su»d
 <
A
 
HREF
="nÙes.html#timeouts">
sšû
 
the


1616 
Ï¡
 
cÚ‹xt
 </
A
>.

1617 </
LI
>

1618 </
UL
>

1619 <
P
>

1620 <
DL
>

1621 <
DD
><
A
 
HREF
=#Ãtfd_İ’>
	`¡_Ãtfd_İ’
()</A></DD>

1622 <
DD
><
A
 
HREF
=#Ãtfd_İ’_sock‘>
	`¡_Ãtfd_İ’_sock‘
()</A></DD>

1623 <
DD
><
A
 
HREF
=#Ãtfd_ä“>
	`¡_Ãtfd_ä“
()</A></DD>

1624 <
DD
><
A
 
HREF
=#Ãtfd_şo£>
	`¡_Ãtfd_şo£
()</A></DD>

1625 <
DD
><
A
 
HREF
=#Ãtfd_f’o>
	`¡_Ãtfd_f’o
()</A></DD>

1626 <
DD
><
A
 
HREF
=#Ãtfd_£t¥ecific>
	`¡_Ãtfd_£t¥ecific
()</A></DD>

1627 <
DD
><
A
 
HREF
=#Ãtfd_g‘¥ecific>
	`¡_Ãtfd_g‘¥ecific
()</A></DD>

1628 <
DD
><
A
 
HREF
=#Ãtfd_£rŸlize_acû±>
	`¡_Ãtfd_£rŸlize_acû±
()</A></DD>

1629 <
DD
><
A
 
HREF
=#Ãtfd_pŞl>
	`¡_Ãtfd_pŞl
()</A></DD>

1630 <
P
>

1631 <
DD
><
A
 
HREF
=#acû±>
	`¡_acû±
()</A></DD>

1632 <
DD
><
A
 
HREF
=#cÚÃù>
	`¡_cÚÃù
()</A></DD>

1633 <
DD
><
A
 
HREF
=#»ad>
	`¡_»ad
()</A></DD>

1634 <
DD
><
A
 
HREF
=#»ad_fuÎy>
	`¡_»ad_fuÎy
()</A></DD>

1635 <
DD
><
A
 
HREF
=#»ad_»sid>
	`¡_»ad_»sid
()</A></DD>

1636 <
DD
><
A
 
HREF
=#»adv>
	`¡_»adv
()</A></DD>

1637 <
DD
><
A
 
HREF
=#»adv_»sid>
	`¡_»ad_»sid
()</A></DD>

1638 <
DD
><
A
 
HREF
=#wr™e>
	`¡_wr™e
()</A></DD>

1639 <
DD
><
A
 
HREF
=#wr™e_»sid>
	`¡_wr™e_»sid
()</A></DD>

1640 <
DD
><
A
 
HREF
=#wr™ev>
	`¡_wr™ev
()</A></DD>

1641 <
DD
><
A
 
HREF
=#wr™ev_»sid>
	`¡_wr™ev_»sid
()</A></DD>

1642 <
DD
><
A
 
HREF
=#»cväom>
	`¡_»cväom
()</A></DD>

1643 <
DD
><
A
 
HREF
=#£ndto>
	`¡_£ndto
()</A></DD>

1644 <
DD
><
A
 
HREF
=#»cvmsg>
	`¡_»cvmsg
()</A></DD>

1645 <
DD
><
A
 
HREF
=#£ndmsg>
	`¡_£ndmsg
()</A></DD>

1646 <
DD
><
A
 
HREF
=#İ’>
	`¡_İ’
()</A></DD>

1647 <
DD
><
A
 
HREF
=#pŞl>
	`¡_pŞl
()</A></DD>

1648 </
DL
>

1649 <
P
>

1650 <
HR
>

1651 <
P
>

1652 <
A
 
NAME
="netfd_open">

1653 <
H4
>
	`¡_Ãtfd_İ’
()</H4>

1654 </
A
>

1655 
C»©es
 
a
 
Ãw
 
fe
 
desütÜ
 
objeù
.

1656 <
P
>

1657 <
H5
>
SyÁax
</H5>

1659 <
PRE
>

1660 #šşud&
É
;
¡
.
h
&
gt
;

1662 
¡_Ãtfd_t
 
	`¡_Ãtfd_İ’
(
osfd
);

1663 </
PRE
>

1664 <
P
>

1665 <
H5
>
P¬am‘”s
</H5>

1666 <
TT
>
	`¡_Ãtfd_İ’
()</TT> 
has
 
the
 
fŞlowšg
 
·¿m‘”s
:<
P
>

1667 <
TT
>
osfd
</TT><
P
>

1669 
Any
 
İ’
 
OS
 
fe
 
desütÜ
; 
ÿn
 
be
 
obšed
 
äom
 
ÿÎs
 
to


1670 
funùiÚs
 
šşudšg
, 
but
 
nÙ
 
»¡riùed
 
to
, <
TT
>
	`pe
(2), 
	`sock‘
(3),

1671 
	`sock‘·œ
(3), 
	`fú
(2), 
	`dup
(2),</
TT
> 
‘c
.

1674 <
P
>

1675 <
H5
>
R‘uºs
</H5>

1676 
UpÚ
 
sucûssful
 
com¶‘iÚ
, 
a
 
Ãw
 
fe
 
desütÜ
 
objeù
 
id’tif›r
 
is


1677 
»tuºed
. 
Oth”wi£
, <
TT
>
NULL
</TT> 
is
„‘uºed 
ªd
 <TT>
”ºo
</TT> i 
£t


1678 
to
 
šdiÿ‹
 
the
 
”rÜ
.

1679 <
P
>

1680 <
H5
>
DesütiÚ
</H5>

1681 
This
 
funùiÚ
 
ü—‹s
 
a
 
Ãw
 
fe
 
desütÜ
 
objeù
 
of
 
ty³


1682 <
A
 
HREF
=#Ãtfd_t><
B
>
¡_Ãtfd_t
</B></A>.<
P
>

1684 <
B
>
NÙe
:</B> 
AmÚg
 
Ùh”
 
thšgs
, 
this
 
funùiÚ
 
£ts
 
a
 
nÚ
-
blockšg


1685 
æag
 
Ú
 
the
 
und”lyšg
 
OS
 
fe
 
desütÜ
. 
You
 
should
 
nÙ
 
modify
 
this


1686 
æag
 
dœeùly
. 
Also
, 
Úû
 
ª
 <
A
 
HREF
=#Ãtfd_t><
B
>
¡_Ãtfd_t
</B></A>

1687 
has
 
b“n
 
ü—‹d
 
w™h
 
a
 
giv’
 
fe
 
desütÜ
, 
you
 
should
 
avoid


1688 
·ssšg
 
th©
 
desütÜ
 
to
 
nÜm®
 
I
/
O
 
Ü
 
¡dio
 
funùiÚs
. 
Sšû
 
the


1689 
O_NONBLOCK
 
æag
 
is
 
sh¬ed
 
aüoss
 <
TT
>
	`dup
(2)</TT>, 
this
 
­¶›s
 
to


1690 <
TT
>
	`dup
()</TT>'ed file descriptors‡s well - for instance, if you…ass

1691 
¡ªd¬d
 
ouut
 
Ü
 snd¬d 
šput
 
to
 <
TT
>
	`¡_Ãtfd_İ’
()</TT>, 
th’


1692 
you
 
should
 
u£
 <
A
 
HREF
=#wr™e>
	`¡_wr™e
()</A> 
š¡—d
 
of
 <
TT
>
wr™e
</TT>

1693 
Ü
 <
TT
>
årštf
</TT> 
wh’
 
wr™šg
 
to
 
¡ªd¬d
 
”rÜ
 
as
 
w–l
 - 
sšû
 
®l


1694 
th»e
 
desütÜs
 
could
 
pošt
 
to
 
the
 
§me
 
‹rmš®
. 
If
 
Ãûs§ry
, 
you


1695 
ÿn
 
¡l
 
u£
 <
TT
>
wr™e
</TT> 
dœeùly
 
you
 
»memb”
 
to
 
check


1696 <
TT
>
”ºo
</TT> <TT>
EAGAIN
</TT>, 
but
 <TT>
årštf
</TT> 
ªd
 
Ùh”


1697 
¡dio
 
funùiÚs
 
should
 
be
 
avoided
 
com¶‘–y
 
beÿu£
, 
©
 
Ëa¡
 
Ú


1698 
Lšux
, 
the
 
¡dio
 
lib¿ry
 
ÿÂÙ
 
be
 
made
 
to
 
wÜk
 
»lŸbly
 
w™h


1699 
nÚ
-
blockšg
 
fes
. (
This
 
Úly
 
­¶›s
 
to
 
fe
 
desütÜs
 
which
 
¬e


1700 
·s£d
 
to
 <
TT
>
	`¡_Ãtfd_İ’
()</TT> 
Ü
 <
A


1701 
HREF
=#Ãtfd_İ’_sock‘>
	`¡_Ãtfd_İ’_sock‘
()</
A
>, 
Ü
 
which
 
¬e


1702 
»Ï‹d
 
to
 
such
 
desütÜs
 
through
 <
TT
>
	`dup
()</TT>; 
Ùh”
 
fe


1703 
desütÜs
 
¬e
 
uÁouched
 
by
 
S‹
 
Th»ads
.)

1704 <
P
>

1705 <
HR
>

1706 <
P
>

1707 <
A
 
NAME
="netfd_open_socket">

1708 <
H4
>
	`¡_Ãtfd_İ’_sock‘
()</H4>

1709 </
A
>

1710 
C»©es
 
a
 
Ãw
 
fe
 
desütÜ
 
objeù
 
äom
‡ 
sock‘
.

1711 <
P
>

1712 <
H5
>
SyÁax
</H5>

1714 <
PRE
>

1715 #šşud&
É
;
¡
.
h
&
gt
;

1717 
¡_Ãtfd_t
 
	`¡_Ãtfd_İ’_sock‘
(
osfd
);

1718 </
PRE
>

1719 <
P
>

1720 <
H5
>
P¬am‘”s
</H5>

1721 <
TT
>
	`¡_Ãtfd_İ’_sock‘
()</TT> 
has
 
the
 
fŞlowšg
 
·¿m‘”s
:<
P
>

1722 <
TT
>
osfd
</TT><
P
>

1723 
An
 
İ’
 
OS
 
fe
 
desütÜ
 
which
 
is
 
a
 
sock‘
 
š™ŸÎy
 
obšed
 
äom
‡<
TT
>

1724 
	$sock‘
(3è
Ü
 
	`sock‘·œ
(3)</
TT
> 
ÿÎ
.

1725 <
P
>

1726 <
H5
>
R‘uºs
</H5>

1727 
UpÚ
 
sucûssful
 
com¶‘iÚ
, 
a
 
Ãw
 
fe
 
desütÜ
 
objeù
 
id’tif›r
 
is


1728 
»tuºed
. 
Oth”wi£
, <
TT
>
NULL
</TT> 
is
„‘uºed 
ªd
 <TT>
”ºo
</TT> i 
£t


1729 
to
 
šdiÿ‹
 
the
 
”rÜ
.

1730 <
P
>

1731 <
H5
>
DesütiÚ
</H5>

1732 
This
 
funùiÚ
 
ü—‹s
 
a
 
Ãw
 
fe
 
desütÜ
 
objeù
 
of
 
ty³


1733 <
A
 
HREF
=#Ãtfd_t><
B
>
¡_Ãtfd_t
</B></A> 
which
 
»´e£Ás
 
ª
 
İ’
 
’d


1734 
pošt
 
of
 
ÃtwÜk
 
communiÿtiÚ
.<
P
>

1735 
UÆike
 
the
 <
A
 
HREF
=#Ãtfd_İ’>
	`¡_Ãtfd_İ’
()</A> 
funùiÚ
 
which
 
may
 
be
 
u£d


1736 
Ú
 
OS
 
fe
 
desütÜs
 
of
 
ªy
 
Üigš
, <
TT
>
	`¡_Ãtfd_İ’_sock‘
()</TT> 
mu¡


1737 
be
 
u£d
 
Úly
 
Ú
 
sock‘s
. 
It
 
is
 
¦ighy
 
mÜe
 
effic›Á
 
thª


1738 <
A
 
HREF
=#Ãtfd_İ’>
	`¡_Ãtfd_İ’
()</A>.<
P
>

1739 <
B
>
NÙe
:</B> 
AmÚg
 
Ùh”
 
thšgs
, 
this
 
funùiÚ
 
£ts
 
a
 
nÚ
-
blockšg
 
æag


1740 
Ú
 
the
 
und”lyšg
 
OS
 
sock‘
. 
You
 
should
 
nÙ
 
modify
 
this
 
æag
 
dœeùly
.

1741 
S“
 <
A
 
HREF
=#Ãtfd_İ’>
	`¡_Ãtfd_İ’
()</A>.

1742 <
P
>

1743 <
HR
>

1744 <
P
>

1745 <
A
 
NAME
="netfd_free">

1746 <
H4
>
	`¡_Ãtfd_ä“
()</H4>

1747 </
A
>

1748 
F»es
 
a
 
fe
 
desütÜ
 
objeù
 
w™hout
 
şosšg
 
the
 
und”lyšg
 
OS
 file

1749 
desütÜ
.

1750 <
P
>

1751 <
H5
>
SyÁax
</H5>

1753 <
PRE
>

1754 #šşud&
É
;
¡
.
h
&
gt
;

1756 
	`¡_Ãtfd_ä“
(
¡_Ãtfd_t
 
fd
);

1757 </
PRE
>

1758 <
P
>

1759 <
H5
>
P¬am‘”s
</H5>

1760 <
TT
>
	`¡_Ãtfd_ä“
()</TT> 
has
 
the
 
fŞlowšg
 
·¿m‘”s
:<
P
>

1761 <
TT
>
fd
</TT><
P
>

1762 
A
 
fe
 
desütÜ
 
objeù
 
	`id’tif›r
 (
£e


1763 <
A
 
HREF
=#Ãtfd_t><
B
>
¡_Ãtfd_t
</B></A>).

1764 <
P
>

1765 <
H5
>
R‘uºs
</H5>

1766 
NÙhšg
.

1767 <
P
>

1768 <
H5
>
DesütiÚ
</H5>

1769 
This
 
funùiÚ
 
ä“s
 
the
 
memÜy
 
ªd
 
Ùh”
 
»sourûs
 
id’tif›d
 
by
he

1770 <
TT
>
fd
</TT> 
·¿m‘”
 
w™hout
 
şosšg
 
the
 
und”lyšg
 
OS
 
fe
 
desütÜ
.

1771 
Any
 
nÚ
-<
TT
>
NULL
</TT> 
desütÜ
-
¥ecific
 
d©a
 
is
 
de¡royed
 
by
 
švokšg


1772 
the
 
¥ecif›d
 
de¡ruùÜ
 
	`funùiÚ
 (
£e
 <
A


1773 
HREF
=#Ãtfd_£t¥ecific>
	`¡_Ãtfd_£t¥ecific
()</
A
>).<
P
> A 
th»ad
 
should


1774 
nÙ
 
ä“
 
fe
 
desütÜ
 
objeùs
 
th©
 
¬e
 
š
 
u£
 
by
 
Ùh”
 
th»ads


1775 
beÿu£
 
™
 
may
 
Ëad
 
to
 
uÅ»diùabË
 
	`»suÉs
 (
e
.
g
., 
a
 
ä“d
 
fe


1776 
desütÜ
 
may
 
be
 
»u£d
 
w™hout
 
Ùh”
 
th»ads
 
knowšg
 
th©
).

1777 <
P
>

1778 <
HR
>

1779 <
P
>

1780 <
A
 
NAME
="netfd_close">

1781 <
H4
>
	`¡_Ãtfd_şo£
()</H4>

1782 </
A
>

1783 
Clo£s
 
a
 
fe
 
desütÜ
.

1784 <
P
>

1785 <
H5
>
SyÁax
</H5>

1787 <
PRE
>

1788 #šşud&
É
;
¡
.
h
&
gt
;

1790 
	`¡_Ãtfd_şo£
(
¡_Ãtfd_t
 
fd
);

1791 </
PRE
>

1792 <
P
>

1793 <
H5
>
P¬am‘”s
</H5>

1794 <
TT
>
	`¡_Ãtfd_şo£
()</TT> 
has
 
the
 
fŞlowšg
 
·¿m‘”s
:<
P
>

1795 <
TT
>
fd
</TT><
P
>

1796 
A
 
fe
 
desütÜ
 
objeù
 
	`id’tif›r
 (
£e


1797 <
A
 
HREF
=#Ãtfd_t><
B
>
¡_Ãtfd_t
</B></A>).

1798 <
P
>

1799 <
H5
>
R‘uºs
</H5>

1800 
UpÚ
 
sucûssful
 
com¶‘iÚ
, 
a
 
v®ue
 
of
 <
TT
>0</TT> 
is
 
»tuºed
.

1801 
Oth”wi£
, 
a
 
v®ue
 
of
 <
TT
>-1</TT> 
is
 
»tuºed
 
ªd
 <TT>
”ºo
</TT> i 
£t


1802 
to
 
šdiÿ‹
 
the
 
”rÜ
.

1803 <
P
>

1804 <
H5
>
DesütiÚ
</H5>

1805 
This
 
funùiÚ
 
şo£s
 
the
 
und”lyšg
 
OS
 
fe
 
desütÜ
, 
ä“s
h
memÜy
 
ªd


1806 
Ùh”
 
»sourûs
 
id’tif›d
 
by
 
the
 <
TT
>
fd
</TT> 
·¿m‘”
. 
Any
 
nÚ
-<TT>
NULL
</TT>

1807 
desütÜ
-
¥ecific
 
d©a
 
is
 
de¡royed
 
by
 
švokšg
 
the
 
¥ecif›d
 
de¡ruùÜ


1808 
	`funùiÚ
 (
£e
 <
A
 
HREF
=#Ãtfd_£t¥ecific>
	`¡_Ãtfd_£t¥ecific
()</A>).<
P
>

1809 
A
 
th»ad
 
should
 
nÙ
 
şo£
 
fe
 
desütÜ
 
objeùs
 
th©
 
¬e
 
š
 
u£
 
by
 
Ùh”


1810 
th»ads
 
beÿu£
 
™
 
may
 
Ëad
 
to
 
uÅ»diùabË
 
	`»suÉs
 (
e
.
g
., 
a
 
şo£d


1811 
fe
 
desütÜ
 
may
 
be
 
»u£d
 
w™hout
 
Ùh”
 
th»ads
 
knowšg
 
th©
).

1812 <
P
>

1813 <
HR
>

1814 <
P
>

1815 <
A
 
NAME
="netfd_fileno">

1816 <
H4
>
	`¡_Ãtfd_f’o
()</H4>

1817 </
A
>

1818 
R‘uºs
 
ª
 
und”lyšg
 
OS
 
fe
 
desütÜ
.

1819 <
P
>

1820 <
H5
>
SyÁax
</H5>

1822 <
PRE
>

1823 #šşud&
É
;
¡
.
h
&
gt
;

1825 
	`¡_Ãtfd_f’o
(
¡_Ãtfd_t
 
fd
);

1826 </
PRE
>

1827 <
P
>

1828 <
H5
>
P¬am‘”s
</H5>

1829 <
TT
>
	`¡_Ãtfd_f’o
()</TT> 
has
 
the
 
fŞlowšg
 
·¿m‘”s
:<
P
>

1830 <
TT
>
fd
</TT><
P
>

1831 
A
 
fe
 
desütÜ
 
objeù
 
	`id’tif›r
 (
£e


1832 <
A
 
HREF
=#Ãtfd_t><
B
>
¡_Ãtfd_t
</B></A>).

1833 <
P
>

1834 <
H5
>
R‘uºs
</H5>

1835 
An
 
und”lyšg
 
OS
 
fe
 
desütÜ
.

1836 <
P
>

1837 <
H5
>
DesütiÚ
</H5>

1838 
This
 
funùiÚ
 
»tuºs
 
the
 
š‹g”
 
OS
 
fe
 
desütÜ
 
assocŸ‹d
 
w™h
h
Çmed


1839 
fe
 
desütÜ
 
objeù
.

1840 <
P
>

1841 <
HR
>

1842 <
P
>

1843 <
A
 
NAME
="netfd_setspecific">

1844 <
H4
>
	`¡_Ãtfd_£t¥ecific
()</H4>

1845 </
A
>

1846 
S‘s
 
³r
-
desütÜ
 
´iv©e
 
d©a
.

1847 <
P
>

1848 <
H5
>
SyÁax
</H5>

1850 <
PRE
>

1851 #šşud&
É
;
¡
.
h
&
gt
;

1853 
	`¡_Ãtfd_£t¥ecific
(
¡_Ãtfd_t
 
fd
, *
v®ue
,

1854 (*
de¡ruùÜ
)(*));

1855 </
PRE
>

1856 <
P
>

1857 <
H5
>
P¬am‘”s
</H5>

1858 <
TT
>
	`¡_Ãtfd_£t¥ecific
()</TT> 
has
 
the
 
fŞlowšg
 
·¿m‘”s
:<
P
>

1859 <
TT
>
fd
</TT><
P
>

1860 
A
 
v®id
 
fe
 
desütÜ
 
objeù
 
	`id’tif›r
 (
£e


1861 <
A
 
HREF
=#Ãtfd_t><
B
>
¡_Ãtfd_t
</B></A>).

1862 <
P
>

1863 <
TT
>
v®ue
</TT><
P
>

1864 
The
 
³r
-
desütÜ
 
´iv©e
 
d©a
, 
Ü
 
mÜe
 
lik–y
, 
a
 
poš‹r
 
to
 
the
 d©¨
which


1865 
is
 
bešg
 
assocŸ‹d
 
w™h
 
the
 
Çmed
 
fe
 
desütÜ
 
objeù
.

1866 <
P
>

1867 <
TT
>
de¡ruùÜ
</TT><
P
>

1868 
S³cif›s
 
ª
 
İtiÚ®
 
de¡ruùÜ
 
funùiÚ
 
the
 
´iv©e
 
d©a
 
assocŸ‹d


1869 
w™h
 <
TT
>
fd
</TT>. 
This
 
funùiÚ
 
ÿn
 
be
 
¥ecif›d
 
as
 <TT>
NULL
</TT>.

1870 
If
 <
TT
>
v®ue
</TT> 
is
 
nÙ
 <TT>
NULL
</TT>, 
th’
 
this
 
de¡ruùÜ
 
funùiÚ
 
wl


1871 
be
 
ÿÎed
 
w™h
 <
TT
>
v®ue
</TT> 
as
 
ª
 
¬gum’t
 
upÚ
 
ä“šg
 
the
 
fe
 
desütÜ


1872 
	`objeù
 (
£e
 <
A
 
HREF
=#Ãtfd_ä“>
	`¡_Ãtfd_ä“
()</A> 
ªd


1873 <
A
 
HREF
=#Ãtfd_şo£>
	`¡_Ãtfd_şo£
()</A>).

1874 <
P
>

1875 <
H5
>
R‘uºs
</H5>

1876 
NÙhšg
.

1877 <
P
>

1878 <
H5
>
DesütiÚ
</H5>

1879 
This
 
funùiÚ
 
®lows
 
to
 
assocŸ‹
 
ªy
 
d©a
 
w™h
 
the
 
¥ecif›d
 
fe


1880 
desütÜ
 
	`objeù
 (
ÃtwÜk
 
cÚÃùiÚ
). 
If
 
a
 
nÚ
-<
TT
>
NULL
</TT> 
de¡ruùÜ


1881 
funùiÚ
 
is
 
»gi¡”ed
, 
™
 
wl
 
be
 
ÿÎed
 
©
 
Úe
 
of
 
two
 
times
, 
as
 as

1882 
the
 
assocŸ‹d
 
d©a
 
is
 
nÙ
 <
TT
>
NULL
</TT>:

1883 <
UL
>

1884 <
LI
>
wh’
 
´iv©e
 
d©a
 
is
 
»¶aûd
 
by
 
ÿÎšg


1885 <
TT
>
	`¡_Ãtfd_£t¥ecific
()</TT> 
agaš


1886 <
LI
>
upÚ
 
ä“šg
 
the
 
fe
 
desütÜ
 
	`objeù
 (
£e


1887 <
A
 
HREF
=#Ãtfd_ä“>
	`¡_Ãtfd_ä“
()</A> 
ªd


1888 <
A
 
HREF
=#Ãtfd_şo£>
	`¡_Ãtfd_şo£
()</A>)

1889 </
UL
>

1890 <
P
>

1891 <
HR
>

1892 <
P
>

1893 <
A
 
NAME
="netfd_getspecific">

1894 <
H4
>
	`¡_Ãtfd_g‘¥ecific
()</H4>

1895 </
A
>

1896 
R‘r›ves
 
the
 
³r
-
desütÜ
 
´iv©e
 
d©a
.

1897 <
P
>

1898 <
H5
>
SyÁax
</H5>

1900 <
PRE
>

1901 #šşud&
É
;
¡
.
h
&
gt
;

1903 *
	`¡_Ãtfd_g‘¥ecific
(
¡_Ãtfd_t
 
fd
);

1904 </
PRE
>

1905 <
P
>

1906 <
H5
>
P¬am‘”s
</H5>

1907 <
TT
>
	`¡_Ãtfd_g‘¥ecific
()</TT> 
has
 
the
 
fŞlowšg
 
·¿m‘”s
:<
P
>

1908 <
TT
>
fd
</TT><
P
>

1909 
A
 
v®id
 
fe
 
desütÜ
 
objeù
 
	`id’tif›r
 (
£e


1910 <
A
 
HREF
=#Ãtfd_t><
B
>
¡_Ãtfd_t
</B></A>).

1911 <
P
>

1912 <
H5
>
R‘uºs
</H5>

1913 
The
 
d©a
 
assocŸ‹d
 
w™h
 
the
 
Çmed
 
fe
 
desütÜ
 
objeù
. 
If
 
no
 d©¨
is


1914 
assocŸ‹d
 
w™h
 <
TT
>
fd
</TT>, 
th’
 <TT>
NULL
</TT> 
is
 
»tuºed
.

1915 <
P
>

1916 <
H5
>
DesütiÚ
</H5>

1917 
This
 
funùiÚ
 
®lows
 
to
 
»Œ›ve
 
the
 
d©a
 
th©
 
was
 
assocŸ‹d
 
w™h
he

1918 
¥ecif›d
 
fe
 
desütÜ
 
	`objeù
 (
£e


1919 <
A
 
HREF
=#Ãtfd_£t¥ecific>
	`¡_Ãtfd_£t¥ecific
()</A>).

1920 <
P
>

1921 <
HR
>

1922 <
P
>

1923 <
A
 
NAME
="netfd_serialize_accept">

1924 <
H4
>
	`¡_Ãtfd_£rŸlize_acû±
()</H4>

1925 </
A
>

1926 
S”Ÿlizes
 
®l
 
sub£qu’t
 <
TT
>
	`acû±
(3)</TT> 
ÿÎs
 
Ú
 
a
 
¥ecif›d
 
fe


1927 
desütÜ
 
objeù
.

1928 <
P
>

1929 <
H5
>
SyÁax
</H5>

1931 <
PRE
>

1932 #šşud&
É
;
¡
.
h
&
gt
;

1934 
	`¡_Ãtfd_£rŸlize_acû±
(
¡_Ãtfd_t
 
fd
);

1935 </
PRE
>

1936 <
P
>

1937 <
H5
>
P¬am‘”s
</H5>

1938 <
TT
>
	`¡_Ãtfd_£rŸlize_acû±
()</TT> 
has
 
the
 
fŞlowšg
 
·¿m‘”s
:<
P
>

1939 <
TT
>
fd
</TT><
P
>

1940 
A
 
fe
 
desütÜ
 
objeù
 
	`id’tif›r
 (
£e


1941 <
A
 
HREF
=#Ãtfd_t><
B
>
¡_Ãtfd_t
</B></A>è
which
 
has
 
b“n
 
sucûssfuÎy
 
ü—‹d


1942 
äom
 
a
 
v®id
 
li¡’šg
 
sock‘
 
by
 <
A
 
HREF
=#Ãtfd_İ’>
	`¡_Ãtfd_İ’
()</A> 
Ü


1943 <
A
 
HREF
=#Ãtfd_İ’_sock‘>
	`¡_Ãtfd_İ’_sock‘
()</A>.

1944 <
P
>

1945 <
H5
>
R‘uºs
</H5>

1946 
UpÚ
 
sucûssful
 
com¶‘iÚ
, 
a
 
v®ue
 
of
 <
TT
>0</TT> 
is
 
»tuºed
.

1947 
Oth”wi£
, 
a
 
v®ue
 
of
 <
TT
>-1</TT> 
is
 
»tuºed
 
ªd
 <TT>
”ºo
</TT> i 
£t


1948 
to
 
šdiÿ‹
 
the
 
”rÜ
.

1949 <
P
>

1950 <
H5
>
DesütiÚ
</H5>

1951 
On
 
some
 
	`¶©fÜms
 (
e
.
g
., 
SŞ¬is
 2.5 
ªd
 
possibly
 
Ùh”
 
SVR4
 
im¶em’tiÚs
)

1952 <
TT
>
	`acû±
(3)</TT> 
ÿÎs
 
äom
 
difã»Á
 
´oûs£s
 
Ú


1953 
the
 
§me
 
li¡’šg
 
	`sock‘
 (
£e
 <
TT
>
	`bšd
(3)</TT>, <TT>
	`li¡’
(3)</TT>è
mu¡
 
be


1954 
£rŸlized
. 
This
 
funùiÚ
 
ÿu£s
 
®l
 
sub£qu’t
 <
TT
>
	`acû±
(3)</TT> 
ÿÎs


1955 
made
 
by
 <
A
 
HREF
=#acû±>
	`¡_acû±
()</A> 
Ú
 
the
 
¥ecif›d
 
fe
 
desütÜ


1956 
objeù
 
to
 
be
 
£rŸlized
.

1957 <
P
>

1958 <
TT
>
	`¡_Ãtfd_£rŸlize_acû±
()</TT> 
mu¡
 
be
 
ÿÎed
 <
I
>
befÜe
</I>

1959 
ü—tšg
 
muÉË
 
£rv”
 
´oûs£s
 
vŸ
 <
TT
>
	`fÜk
(2)</TT>. 
If
 
the
 
­¶iÿtiÚ


1960 
dÛs
 
nÙ
 
ü—‹
 
muÉË
 
´oûs£s
 
to
 
acû±
 
ÃtwÜk
 
cÚÃùiÚs
 
Ú


1961 
the
 
§me
 
li¡’šg
 
sock‘
, 
th”e
 
is
 
no
 
Ãed
 
to
 
ÿÎ
 
this
 
funùiÚ
.

1962 <
P
>

1963 
Decidšg
 
wh‘h”
 
Ü
 
nÙ
 
to
 
£rŸlize
 
acû±s
 
is
 
Œicky
. 
On
 
some


1964 
	$¶©fÜms
 (
IRIX
, 
Lšux
è
™
's‚ot‚eeded‡t‡ll‡nd

1965 <
TT
>
	`¡_Ãtfd_£rŸlize_acû±
()</TT> 
is
 
a
 
no
-
İ
. 
On
 
Ùh”
 
¶©fÜms


1966 
™
 
d•’ds
 
Ú
 
the
 
v”siÚ
 
of
h
	`OS
 (
SŞ¬is
 2.6 
dÛ¢
't‚eed it but

1967 
—¾›r
 
v”siÚs
 do). 
S”Ÿlizšg
 
acû±s
 
dÛs
 
šcur
 
a
 
¦ight


1968 
³rfÜmªû
 
³ÇÉy
 
so
 
you
 
wªt
 
to
 
’abË
 
™
 
Úly
 
Ãûs§ry
. 
R—d


1969 
your
 
sy¡em
's manual…ages for <tt>accept(2)</tt>‡nd <tt>select(2)</tt>

1970 
to
 
£e
 
acû±
 
£rŸliz©iÚ
 
is
 
Ãûs§ry
 
Ú
 
your
 
sy¡em
.

1971 <
P
>

1972 <
TT
>
	`¡_Ãtfd_£rŸlize_acû±
()</TT> 
®loÿ‹s
 
»sourûs
 
th©
 
¬e


1973 
ä“d
 
upÚ
 
ä“šg
 
of
 
the
 
¥ecif›d
 
fe
 
desütÜ
 
	`objeù
 (
£e


1974 <
A
 
HREF
=#Ãtfd_ä“>
	`¡_Ãtfd_ä“
()</A> 
ªd


1975 <
A
 
HREF
=#Ãtfd_şo£>
	`¡_Ãtfd_şo£
()</A>).

1976 <
P
>

1977 <
HR
>

1978 <
P
>

1979 <
A
 
NAME
="netfd_poll">

1980 <
H4
>
	`¡_Ãtfd_pŞl
()</H4>

1981 </
A
>

1982 
Wa™s
 
I
/
O
 
Ú
 
a
 
sšgË
 
fe
 
desütÜ
 
objeù
.

1983 <
P
>

1984 <
H5
>
SyÁax
</H5>

1986 <
PRE
>

1987 #šşud&
É
;
¡
.
h
&
gt
;

1989 
	`¡_Ãtfd_pŞl
(
¡_Ãtfd_t
 
fd
, 
how
, 
¡_utime_t
 
timeout
);

1990 </
PRE
>

1991 <
P
>

1992 <
H5
>
P¬am‘”s
</H5>

1993 <
TT
>
	`¡_Ãtfd_pŞl
()</TT> 
has
 
the
 
fŞlowšg
 
·¿m‘”s
:<
P
>

1994 <
TT
>
fd
</TT><
P
>

1995 
A
 
fe
 
desütÜ
 
objeù
 
	`id’tif›r
 (
£e


1996 <
A
 
HREF
=#Ãtfd_t><
B
>
¡_Ãtfd_t
</B></A>).

1997 <
P
>

1998 <
TT
>
how
</TT><
P
>

1999 
S³cif›s
 
I
/
O
 
ev’ts
 
of
 
š‹»¡
. 
This
 
·¿m‘”
 
ÿn
 
be
 
cÚ¡ruùed
 
by


2000 
OR
-
šg
 
ªy
 
combš©iÚ
 
of
 
the
 
fŞlowšg
 
ev’t
 
æags
 
which
 
¬e
 
defšed


2001 
š
 
the
 <
TT
>
pŞl
.
h
</TT> 
h—d”
 
fe
:<
P
>

2002 <
TABLE
 
BORDER
=0>

2003 <
TR
><
TD
><
TT
>
POLLIN
</TT></TD><TD><TT>
fd
</TT> 
is
 
»adabË
.</TD></TR>

2004 <
TR
><
TD
><
TT
>
POLLOUT
</TT></TD><TD><TT>
fd
</TT> 
is
 i 
wr™abË
.</TD></TR>

2005 <
TR
><
TD
><
TT
>
POLLPRI
</TT></TD><TD><TT>
fd
</TT> 
has
 
ª
 
exû±iÚ
 
cÚd™iÚ
.</TD>

2006 </
TR
>

2007 </
TABLE
>

2008 <
P
>

2009 <
TT
>
timeout
</TT><
P
>

2010 
AmouÁ
 
of
 
time
 
š
 
miüo£cÚds
 
the
 
ÿÎ
 
wl
 
block
 
wa™šg
 
I
/
O


2011 
to
 
become
 
»ady
. 
This
 
·¿m‘”
 
is
 
a
 
v¬ŸbË
 
of
 
ty³


2012 <
A
 
HREF
=#utime_t><
B
>
¡_utime_t
</B></A>. 
If
 
this
 
time
 
expœes
 
w™hout
 
ªy


2013 
I
/
O
 
becomšg
 
»ady
, <
TT
>
	`¡_Ãtfd_pŞl
()</TT> 
»tuºs
 
ª
 
”rÜ
 
ªd
 
£ts


2014 <
TT
>
”ºo
</TT> 
to
 <TT>
ETIME
</TT>.

2015 
NÙe
 
th©
 
timeouts
 
¬e
 
m—su»d
 <
A
 
HREF
="nÙes.html#timeouts">
sšû
 
the


2016 
Ï¡
 
cÚ‹xt
 </
A
>.

2017 <
P
>

2018 <
H5
>
R‘uºs
</H5>

2019 
If
 
the
 
Çmed
 
fe
 
desütÜ
 
objeù
 
is
 
»ady
 
I
/
O
 
w™hš
h
¥ecif›d


2020 
amouÁ
 
of
 
time
, 
a
 
v®ue
 oà<
TT
>0</TT> 
is
 
»tuºed
. 
Oth”wi£
,‡ value

2021 
of
 <
TT
>-1</TT> 
is
 
»tuºed
 
ªd
 <TT>
”ºo
</TT> i 
£t
 
to
 
šdiÿ‹
 
the
 
”rÜ
:

2022 <
P
>

2023 <
TABLE
 
BORDER
=0>

2024 <
TR
><
TD
><
TT
>
EBADF
</TT></TD><TD>
The
 
und”lyšg
 
OS
 
fe
 
desütÜ
 
is
 
šv®id
.

2025 </
TD
></
TR
>

2026 <
TR
><
TD
><
TT
>
EINTR
</TT></TD><TD>
The
 
cu¼’t
 
th»ad
 
was
 
š‹¼u±ed
 
by


2027 <
A
 
HREF
=#th»ad_š‹¼u±>
	`¡_th»ad_š‹¼u±
()</A>.</
TD
></
TR
>

2028 <
TR
><
TD
><
TT
>
ETIME
</TT></TD><TD>
The
 
timeout
 
occu¼ed
 
w™hout
 
ªy
 
I
/
O


2029 
becomšg
 
»ady
.</
TD
></
TR
>

2030 </
TABLE
>

2031 <
P
>

2032 <
H5
>
DesütiÚ
</H5>

2033 
This
 
funùiÚ
 
»tuºs
 
as
 
soÚ
‡ 
I
/
O
 
is
 
»ady
 
Ú
 
the
 
Çmed
 
fe


2034 
desütÜ
 
objeù
 
Ü
 
the
 
¥ecif›d
 
amouÁ
 
of
 
time
 
expœes
. 
The


2035 <
TT
>
how
</TT> 
·¿m‘”
 
should
 
be
 
£t
 
to
 
the
 
I
/
O
 
	$ev’ts
 (
»adabË
,

2036 
wr™abË
, 
exû±iÚ
, 
Ü
 
some
 
combš©iÚ
è
th©
 
the
 
ÿÎ”
 
is
 
š‹»¡ed


2037 
š
. 
If
 
the
 
v®ue
 
of
 <
TT
>
timeout
</TT> 
is
 <
‰
>
ST_UTIME_NO_TIMEOUT
</tt>

2038 (<
TT
>-1</TT>), 
this
 
funùiÚ
 
blocks
 
uÁ
 
a
 
»que¡ed
 
I
/
O
 
ev’t
 
occurs


2039 
Ü
 
uÁ
 
the
 
ÿÎ
 
is
 
š‹¼u±ed
 
by
 <
A


2040 
HREF
=#th»ad_š‹¼u±>
	`¡_th»ad_š‹¼u±
()</
A
>.<
p
>

2041 
De¥™e
 
havšg
 
ª
 
š‹rçû
 
like
 <
‰
>
	`pŞl
(2)</‰>, 
this
 
funùiÚ
 
u£s


2042 
the
 
§me
 
ev’t
 
nÙifiÿtiÚ
 
mechªism
 
as
h
»¡
 
of
h
lib¿ry
. 
FÜ


2043 
š¡ªû
 
ª
 
®‹º©ive
 
ev’t
 
nofiÿtiÚ
 
mechªism
 
was
 
£t
 
usšg
 <
a


2044 
h»f
=#£t_ev’tsys>
	`¡_£t_ev’tsys
()</
a
>, 
this
 
funùiÚ
 
u£s
 
th©


2045 
mechªism
 
to
 
check
 
ev’ts
.<
p
>

2046 <
b
>
NÙe
: </b> <
TT
>
	`kqueue
(2)</TT> 
is
 
u£d
 
as
 
ª
 
®‹º©ive
 
ev’t


2047 
nÙifiÿtiÚ
 
	`mechªism
 (
£e
 <
A


2048 
HREF
=#£t_ev’tsys>
	`¡_£t_ev’tsys
()</
A
>), 
the
 <
TT
>
POLLPRI
</TT>

2049 
ev’t
 
æag
 
is
 
nÙ
 
suµÜ‹d
 
ªd
 <
TT
>
	`¡_Ãtfd_pŞl
()</TT> 
wl
  
ª
 
”rÜ


2050 
™
's set (<TT>errno</TT> will be seto <TT>EINVAL</TT>).

2051 <
P
>

2052 <
HR
>

2053 <
P
>

2054 <
A
 
NAME
="accept">

2055 <
H4
>
	`¡_acû±
()</H4>

2056 </
A
>

2057 
Acû±s
 
a
 
cÚÃùiÚ
 
Ú
‡ 
¥ecif›d
 
fe
 
desütÜ
 
objeù
.

2058 <
P
>

2059 <
H5
>
SyÁax
</H5>

2061 <
PRE
>

2062 #šşud&
É
;
¡
.
h
&
gt
;

2064 
¡_Ãtfd_t
 
	`¡_acû±
(¡_Ãtfd_ˆ
fd
, 
sockaddr
 *
addr
, *
add¾’
,

2065 
¡_utime_t
 
timeout
);

2066 </
PRE
>

2067 <
P
>

2068 <
H5
>
P¬am‘”s
</H5>

2069 <
TT
>
	`¡_acû±
()</TT> 
has
 
the
 
fŞlowšg
 
·¿m‘”s
:<
P
>

2070 <
TT
>
fd
</TT><
P
>

2071 
A
 
fe
 
desütÜ
 
objeù
 
	`id’tif›r
 (
£e


2072 <
A
 
HREF
=#Ãtfd_t><
B
>
¡_Ãtfd_t
</B></A>è
»´e£Ášg
 
the
 
»ndezvous
 
sock‘


2073 
Ú
 
which
 
the
 
ÿÎ”
 
is
 
wlšg
 
to
 
acû±
 
Ãw
 
cÚÃùiÚs
. 
This
 
objeù
 
has
 
b“n


2074 
ü—‹d
 
äom
 
a
 
v®id
 
li¡’šg
 
sock‘
 
by


2075 <
A
 
HREF
=#Ãtfd_İ’>
	`¡_Ãtfd_İ’
()</A> 
Ü


2076 <
A
 
HREF
=#Ãtfd_İ’_sock‘>
	`¡_Ãtfd_İ’_sock‘
()</A>.<
P
>

2077 <
TT
>
addr
</TT><
P
>

2078 
If
 
this
 
v®ue
 
is
 
nÚ
-
z”o
, 
™
 i 
a
 
»suÉ
 
·¿m‘”
 
th©
 i 
fËd


2079 
š
 
w™h
 
the
 
add»ss
 
of
h
cÚÃùšg
 
’t™y
, 
as
 
known
 
to
h
communiÿtiÚs


2080 
	`Ïy”
 (
£e
 <
TT
>
	`acû±
(3)</TT>).<
P
>

2081 <
TT
>
add¾’
</TT><
P
>

2082 
This
 
·¿m‘”
 
should
 
š™ŸÎy
 
cÚš
 
the
 
amouÁ
 
of
 
¥aû
 
poš‹d
 
to
 
by


2083 <
TT
>
addr
</TT>; 
Ú
  
™
 
wl
 
cÚš
 
the
 
aùu®
 
	$Ëngth
 (
š
 
by‹s
è
of
 
the


2084 
add»ss
 
	`»tuºed
 (
£e
 <
TT
>
	`acû±
(3)</TT>).<
P
>

2085 <
TT
>
timeout
</TT><
P
>

2086 
A
 
v®ue
 
of
 
ty³
 <A 
HREF
=#utime_t><
B
>
¡_utime_t
</B></A> 
¥ecifyšg
 
the
 
time


2087 
lim™
 
š
 
miüo£cÚds
 
com¶‘iÚ
 
of
 
the
 
acû±
 
İ”©iÚ
.

2088 
NÙe
 
th©
 
timeouts
 
¬e
 
m—su»d
 <
A
 
HREF
="nÙes.html#timeouts">
sšû
 
the


2089 
Ï¡
 
cÚ‹xt
 </
A
>.

2090 <
P
>

2091 <
H5
>
R‘uºs
</H5>

2092 
UpÚ
 
sucûssful
 
com¶‘iÚ
, 
a
 
Ãw
 
fe
 
desütÜ
 
objeù
 
id’tif›r


2093 
»´e£Ášg
 
the
 
Ãwly
 
acû±ed
 
cÚÃùiÚ
 
is
 
»tuºed
. 
Oth”wi£
,

2094 <
TT
>
NULL
</TT> 
is
 
»tuºed
 
ªd
 <TT>
”ºo
</TT> i 
£t
 
to
 
šdiÿ‹
 
the
 
”rÜ
.

2095 
PossibË
 <
TT
>
”ºo
</TT> 
v®ues
 
¬e
 
the
 
§me
 
as
 
£t
 
by
h<TT>
	`acû±
(3)</TT>

2096 
ÿÎ
 
w™h
 
two
 
exû±iÚs
:<
P
>

2097 <
TABLE
 
BORDER
=0>

2098 <
TR
><
TD
><
TT
>
EINTR
</TT></TD><TD>
The
 
cu¼’t
 
th»ad
 
was
 
š‹¼u±ed
 
by


2099 <
A
 
HREF
=#th»ad_š‹¼u±>
	`¡_th»ad_š‹¼u±
()</A>.</
TD
></
TR
>

2100 <
TR
><
TD
><
TT
>
ETIME
</TT></TD><TD>
The
 
timeout
 
occu¼ed
 
ªd
 
no
 
³ndšg


2101 
cÚÃùiÚ
 
was
 
acû±ed
.</
TD
></
TR
>

2102 </
TABLE
>

2103 <
P
>

2104 <
H5
>
DesütiÚ
</H5>

2105 
This
 
funùiÚ
 
acû±s
 
the
 
fœ¡
 
cÚÃùiÚ
 
äom
h
queue
 
of
 
³ndšg


2106 
cÚÃùiÚs
 
ªd
 
ü—‹s
 
a
 
Ãw
 
fe
 
desütÜ
 
objeù
 
the
 
Ãwly


2107 
acû±ed
 
cÚÃùiÚ
. 
The
 
»ndezvous
 
sock‘
 
ÿn
 
¡l
 
be
 
u£d
 
to
 
acû±


2108 
mÜe
 
cÚÃùiÚs
.<
P
>

2109 <
TT
>
	`¡_acû±
()</TT> 
blocks
 
the
 
ÿÎšg
 
th»ad
 
uÁ
 
e™h”
 
a
 
Ãw
 
cÚÃùiÚ


2110 
is
 
sucûssfuÎy
 
acû±ed
 
Ü
 
ª
 
”rÜ
 
occurs
. 
If
 
no
 
³ndšg
 
cÚÃùiÚ
 
ÿn


2111 
be
 
acû±ed
 
befÜe
 
the
 
time
 
lim™
, 
this
 
funùiÚ
 
»tuºs
 <
TT
>
NULL
</TT>

2112 
ªd
 
£ts
 <
TT
>
”ºo
</TT> 
to
 <TT>
ETIME
</TT>.

2113 <
P
>

2114 <
HR
>

2115 <
P
>

2116 <
A
 
NAME
="connect">

2117 <
H4
>
	`¡_cÚÃù
()</H4>

2118 </
A
>

2119 
In™Ÿ‹s
 
a
 
cÚÃùiÚ
 
Ú
‡ 
¥ecif›d
 
fe
 
desütÜ
 
objeù
.

2120 <
P
>

2121 <
H5
>
SyÁax
</H5>

2123 <
PRE
>

2124 #šşud&
É
;
¡
.
h
&
gt
;

2126 
	`¡_cÚÃù
(
¡_Ãtfd_t
 
fd
, 
sockaddr
 *
addr
, 
add¾’
,

2127 
¡_utime_t
 
timeout
);

2128 </
PRE
>

2129 <
P
>

2130 <
H5
>
P¬am‘”s
</H5>

2131 <
TT
>
	`¡_cÚÃù
()</TT> 
has
 
the
 
fŞlowšg
 
·¿m‘”s
:<
P
>

2132 <
TT
>
fd
</TT><
P
>

2133 
A
 
fe
 
desütÜ
 
objeù
 
	`id’tif›r
 (
£e


2134 <
A
 
HREF
=#Ãtfd_t><
B
>
¡_Ãtfd_t
</B></A>è
»´e£Ášg
 
a
 
sock‘
.<
P
>

2135 <
TT
>
addr
</TT><
P
>

2136 
A
 
poš‹r
 
to
 
the
 
add»ss
 
of
h
³”
Ø
which
h
sock‘
 
is
Ø
be
 
cÚÃùed
.

2137 <
P
>

2138 <
TT
>
add¾’
</TT><
P
>

2139 
This
 
·¿m‘”
 
¥ecif›s
 
the
 
amouÁ
 
of
 
¥aû
 
poš‹d
 
to
 
by
 <
TT
>
addr
</TT>.

2140 <
P
>

2141 <
TT
>
timeout
</TT><
P
>

2142 
A
 
v®ue
 
of
 
ty³
 <A 
HREF
=#utime_t><
B
>
¡_utime_t
</B></A> 
¥ecifyšg
 
the
 
time


2143 
lim™
 
š
 
miüo£cÚds
 
com¶‘iÚ
 
of
 
the
 
cÚÃù
 
İ”©iÚ
.

2144 
NÙe
 
th©
 
timeouts
 
¬e
 
m—su»d
 <
A
 
HREF
="nÙes.html#timeouts">
sšû
 
the


2145 
Ï¡
 
cÚ‹xt
 </
A
>.

2146 <
P
>

2147 <
H5
>
R‘uºs
</H5>

2148 
UpÚ
 
sucûssful
 
com¶‘iÚ
, 
a
 
v®ue
 
of
 <
TT
>0</TT> 
is
 
»tuºed
.

2149 
Oth”wi£
, 
a
 
v®ue
 
of
 <
TT
>-1</TT> 
is
 
»tuºed
 
ªd
 <TT>
”ºo
</TT> i 
£t


2150 
to
 
šdiÿ‹
 
the
 
”rÜ
. 
PossibË
 <
TT
>
”ºo
</TT> 
v®ues
 
¬e
h
§me
 
as
 
£t


2151 
by
 
the
 <
TT
>
	`cÚÃù
(3)</TT> 
ÿÎ
 
w™h
 
two
 
exû±iÚs
:<
P
>

2152 <
TABLE
 
BORDER
=0>

2153 <
TR
><
TD
><
TT
>
EINTR
</TT></TD><TD>
The
 
cu¼’t
 
th»ad
 
was
 
š‹¼u±ed
 
by


2154 <
A
 
HREF
=#th»ad_š‹¼u±>
	`¡_th»ad_š‹¼u±
()</A>.</
TD
></
TR
>

2155 <
TR
><
TD
><
TT
>
ETIME
</TT></TD><TD>
The
 
timeout
 
occu¼ed
 
ªd
 
cÚÃùiÚ
 
£tup


2156 
was
 
nÙ
 
com¶‘ed
.</
TD
></
TR
>

2157 </
TABLE
>

2158 <
P
>

2159 <
H5
>
DesütiÚ
</H5>

2160 
This
 
funùiÚ
 
is
 
usu®ly
 
švoked
 
Ú
 
a
 
fe
 
desütÜ
 
objeù
 
»´e£Ášg


2161 
a
 
TCP
 
sock‘
. 
UpÚ
 
com¶‘iÚ
 
™
 
e¡ablishes
‡ TCP 
cÚÃùiÚ
 
to
 
the
 
³”
.

2162 
If
 
the
 
und”lyšg
 
OS
 
sock‘
 
is
 
nÙ
 
bound
, 
™
 
wl
 
be
 bound 
to
 
ª
 
¬b™¿ry


2163 
loÿl
 
	`add»ss
 (
£e
 <
TT
>
	`cÚÃù
(3)</TT>).<
P
>

2164 <
TT
>
	`¡_cÚÃù
()</TT> 
blocks
 
the
 
ÿÎšg
 
th»ad
 
uÁ
 
e™h”
h
cÚÃùiÚ


2165 
is
 
sucûssfuÎy
 
e¡ablished
 
Ü
 
ª
 
”rÜ
 
occurs
. 
If
 
the
 
cÚÃùiÚ
 
£tup


2166 
ÿÂÙ
 
com¶‘e
 
befÜe
 
the
 
¥ecif›d
 
time
 
lim™
, 
this
 
funùiÚ
 
çs
 
w™h


2167 <
TT
>
”ºo
</TT> 
£t
 
to
 <TT>
ETIME
</TT>.

2168 <
P
>

2169 <
HR
>

2170 <
P
>

2171 <
A
 
NAME
="read">

2172 <
H4
>
	`¡_»ad
()</H4>

2173 </
A
>

2174 
R—ds
 
d©a
 
äom
 
a
 
¥ecif›d
 
fe
 
desütÜ
 
objeù
.

2175 <
P
>

2176 <
H5
>
SyÁax
</H5>

2178 <
PRE
>

2179 #šşud&
É
;
¡
.
h
&
gt
;

2181 
ssize_t
 
	`¡_»ad
(
¡_Ãtfd_t
 
fd
, *
buf
, 
size_t
 
nby‹
, 
¡_utime_t
 
timeout
);

2182 </
PRE
>

2183 <
P
>

2184 <
H5
>
P¬am‘”s
</H5>

2185 <
TT
>
	`¡_»ad
()</TT> 
has
 
the
 
fŞlowšg
 
·¿m‘”s
:<
P
>

2186 <
TT
>
fd
</TT><
P
>

2187 
A
 
fe
 
desütÜ
 
objeù
 
	`id’tif›r
 (
£e


2188 <
A
 
HREF
=#Ãtfd_t><
B
>
¡_Ãtfd_t
</B></A>).<
P
>

2189 <
TT
>
buf
</TT><
P
>

2190 
A
 
poš‹r
 
to
 
a
 
bufãr
Ø
hŞd
 
the
 
d©a
 
»ad
 
š
. 
On
 
ouut
he buffer

2191 
cÚšs
 
the
 
d©a
.<
P
>

2192 <
TT
>
nby‹
</TT><
P
>

2193 
The
 
size
 
of
 <
TT
>
buf
</TT> 
š
 
by‹s
.<
P
>

2194 <
TT
>
timeout
</TT><
P
>

2195 
A
 
v®ue
 
of
 
ty³
 <A 
HREF
=#utime_t><
B
>
¡_utime_t
</B></A> 
¥ecifyšg
 
the
 
time


2196 
lim™
 
š
 
miüo£cÚds
 
com¶‘iÚ
 
of
 
the
 
»ad
 
İ”©iÚ
.

2197 
NÙe
 
th©
 
timeouts
 
¬e
 
m—su»d
 <
A
 
HREF
="nÙes.html#timeouts">
sšû
 
the


2198 
Ï¡
 
cÚ‹xt
 </
A
>.

2199 <
P
>

2200 <
H5
>
R‘uºs
</H5>

2201 
On
 
sucûss
 
a
 
nÚ
-
Ãg©ive
 
š‹g”
 
šdiÿtšg
 
the
 
numb”
 
of
 
by‹s
 
aùu®ly


2202 
»ad
 
is
 
	`»tuºed
 (
a
 
v®ue
 
of
 <
TT
>0</TT> 
m—ns
 
the
 
ÃtwÜk
 
cÚÃùiÚ
 is

2203 
şo£d
 
Ü
 
’d
 
of
 
fe
 
is
 
»ached
). 
Oth”wi£
, 
a
 
v®ue
 oà<
TT
>-1</TT> is

2204 
»tuºed
 
ªd
 <
TT
>
”ºo
</TT> 
is
 
£t
 
to
 
šdiÿ‹
 
the
 
”rÜ
.

2205 
PossibË
 <
TT
>
”ºo
</TT> 
v®ues
 
¬e
 
the
 
§me
 
as
 
£t
 
by
h<TT>
	`»ad
(2)</TT>

2206 
ÿÎ
 
w™h
 
two
 
exû±iÚs
:<
P
>

2207 <
TABLE
 
BORDER
=0>

2208 <
TR
><
TD
><
TT
>
EINTR
</TT></TD><TD>
The
 
cu¼’t
 
th»ad
 
was
 
š‹¼u±ed
 
by


2209 <
A
 
HREF
=#th»ad_š‹¼u±>
	`¡_th»ad_š‹¼u±
()</A>.</
TD
></
TR
>

2210 <
TR
><
TD
><
TT
>
ETIME
</TT></TD><TD>
The
 
timeout
 
occu¼ed
 
ªd
 
no
 
d©a
 
was
 
»ad
.

2211 </
TD
></
TR
>

2212 </
TABLE
>

2213 <
P
>

2214 <
H5
>
DesütiÚ
</H5>

2215 
This
 
funùiÚ
 
blocks
 
the
 
ÿÎšg
 
th»ad
 
uÁ
 
™
 
’couÁ”s
 
ª
 
’d
-
of
-
¡»am


2216 
šdiÿtiÚ
, 
some
 
pos™ive
 
numb”
 
of
 
	`by‹s
 (
but
 
no
 
mÜe
 
thª
 <
TT
>
nby‹
</TT>

2217 
by‹s
è
¬e
 
»ad
 
š
, 
a
 
timeout
 
occurs
, 
Ü
 
ª
 
”rÜ
 occurs.

2218 <
P
>

2219 <
HR
>

2220 <
P
>

2221 <
A
 
NAME
="read_fully">

2222 <
H4
>
	`¡_»ad_fuÎy
()</H4>

2223 </
A
>

2224 
R—ds
 
the
 
¥ecif›d
 
amouÁ
 
of
 
d©a
 
š
 
fuÎ
 
äom
 
a
 
fe
 
desütÜ
 
objeù
.

2225 <
P
>

2226 <
H5
>
SyÁax
</H5>

2228 <
PRE
>

2229 #šşud&
É
;
¡
.
h
&
gt
;

2231 
ssize_t
 
	`¡_»ad_fuÎy
(
¡_Ãtfd_t
 
fd
, *
buf
, 
size_t
 
nby‹
,

2232 
¡_utime_t
 
timeout
);

2233 </
PRE
>

2234 <
P
>

2235 <
H5
>
P¬am‘”s
</H5>

2236 <
TT
>
	`¡_»ad_fuÎy
()</TT> 
has
 
the
 
fŞlowšg
 
·¿m‘”s
:<
P
>

2237 <
TT
>
fd
</TT><
P
>

2238 
A
 
fe
 
desütÜ
 
objeù
 
	`id’tif›r
 (
£e


2239 <
A
 
HREF
=#Ãtfd_t><
B
>
¡_Ãtfd_t
</B></A>).<
P
>

2240 <
TT
>
buf
</TT><
P
>

2241 
A
 
poš‹r
 
to
 
a
 
bufãr
Ø
hŞd
 
the
 
d©a
 
»ad
 
š
. 
On
 
ouut
he buffer

2242 
cÚšs
 
the
 
d©a
.<
P
>

2243 <
TT
>
nby‹
</TT><
P
>

2244 
The
 
amouÁ
 
of
 
d©a
 
to
 
be
 
»ad
 
š
 
	`fuÎ
 (š 
by‹s
). 
It
 
mu¡
 
nÙ
 
exûed
 
the


2245 
size
 
of
 <
TT
>
buf
</TT>.<
P
>

2246 <
TT
>
timeout
</TT><
P
>

2247 
A
 
v®ue
 
of
 
ty³
 <A 
HREF
=#utime_t><
B
>
¡_utime_t
</B></A> 
¥ecifyšg
 
the


2248 
šaùiv™y
 
	`timeout
 (
š
 
miüo£cÚds
).

2249 
NÙe
 
th©
 
timeouts
 
¬e
 
m—su»d
 <
A
 
HREF
="nÙes.html#timeouts">
sšû
 
the


2250 
Ï¡
 
cÚ‹xt
 </
A
>.

2251 <
P
>

2252 <
H5
>
R‘uºs
</H5>

2253 
On
 
sucûss
 
a
 
nÚ
-
Ãg©ive
 
š‹g”
 
šdiÿtšg
 
the
 
numb”
 
of
 
by‹s
 
aùu®ly


2254 
»ad
 
is
 
	`»tuºed
 (
a
 
v®ue
 
Ëss
 
thª
 <
TT
>
nby‹
</TT> 
m—ns
 
the
 
ÃtwÜk


2255 
cÚÃùiÚ
 
is
 
şo£d
 
Ü
 
’d
 
of
 
fe
 i 
»ached
). 
Oth”wi£
, 
a
 
v®ue
 of

2256 <
TT
>-1</TT> 
is
 
»tuºed
 
ªd
 <TT>
”ºo
</TT> i 
£t
 
to
 
šdiÿ‹
 
the
 
”rÜ
.

2257 
PossibË
 <
TT
>
”ºo
</TT> 
v®ues
 
¬e
 
the
 
§me
 
as
 
£t
 
by
h<TT>
	`»ad
(2)</TT>

2258 
ÿÎ
 
w™h
 
two
 
exû±iÚs
:<
P
>

2259 <
TABLE
 
BORDER
=0>

2260 <
TR
><
TD
><
TT
>
EINTR
</TT></TD><TD>
The
 
cu¼’t
 
th»ad
 
was
 
š‹¼u±ed
 
by


2261 <
A
 
HREF
=#th»ad_š‹¼u±>
	`¡_th»ad_š‹¼u±
()</A>.</
TD
></
TR
>

2262 <
TR
><
TD
><
TT
>
ETIME
</TT></TD><TD>
The
 
timeout
 
occu¼ed
.

2263 </
TD
></
TR
>

2264 </
TABLE
>

2265 <
P
>

2266 <
H5
>
DesütiÚ
</H5>

2267 
This
 
funùiÚ
 
blocks
 
the
 
ÿÎšg
 
th»ad
 
uÁ
h
¥ecif›d
 
amouÁ
 
of
 
d©a


2268 
is
 
»ad
 
š
 
fuÎ
, 
™
 
’couÁ”s
 
ª
 
’d
-
of
-
¡»am
 
šdiÿtiÚ
, 
a
 
timeout
 
occurs
,

2269 
Ü
 
ª
 
”rÜ
 
occurs
.

2270 <
P
>

2271 <
HR
>

2272 <
P
>

2273 <
A
 
NAME
="read_resid">

2274 <
H4
>
	`¡_»ad_»sid
()</H4>

2275 </
A
>

2276 
R—ds
 
the
 
¥ecif›d
 
amouÁ
 
of
 
d©a
 
š
 
fuÎ
 
äom
 
a
 
fe
 
desütÜ
 
objeù
.

2277 <
P
>

2278 <
H5
>
SyÁax
</H5>

2280 <
PRE
>

2281 #šşud&
É
;
¡
.
h
&
gt
;

2283 
	`¡_»ad_»sid
(
¡_Ãtfd_t
 
fd
, *
buf
, 
size_t
 *
»sid
,

2284 
¡_utime_t
 
timeout
);

2285 </
PRE
>

2286 <
P
>

2287 <
H5
>
P¬am‘”s
</H5>

2288 <
TT
>
	`¡_»ad_»sid
()</TT> 
has
 
the
 
fŞlowšg
 
·¿m‘”s
:<
P
>

2289 <
TT
>
fd
</TT><
P
>

2290 
A
 
fe
 
desütÜ
 
objeù
 
	`id’tif›r
 (
£e


2291 <
A
 
HREF
=#Ãtfd_t><
B
>
¡_Ãtfd_t
</B></A>).<
P
>

2292 <
TT
>
buf
</TT><
P
>

2293 
A
 
poš‹r
 
to
 
a
 
bufãr
Ø
hŞd
 
the
 
d©a
 
»ad
 
š
. 
On
 
ouut
he buffer

2294 
cÚšs
 
the
 
d©a
.<
P
>

2295 <
TT
>
»sid
</TT><
P
>

2296 
A
 
poš‹r
 
to
 
a
 
numb”
 
of
 
by‹s
.

2297 
On
 
’Œy
, 
the
 
amouÁ
 
of
 
d©a
 
to
 
be
 
»ad
 
š
 
fuÎ
.

2298 
It
 
mu¡
 
nÙ
 
exûed
 
the
 
size
 
of
 <
TT
>
buf
</TT>.

2299 
On
 , 
the
 
amouÁ
 
of
 
d©a
 
»maššg
 
to
 
be
 
»ad
.

2300 (
A
 
nÚ
-
z”o
 
»tuºed
 
v®ue
 
m—ns
 
some
 
but
 
nÙ
 
®l
 
of
 
the
 
d©a
 
was
 
»ad
.)<
P
>

2301 <
TT
>
timeout
</TT><
P
>

2302 
A
 
v®ue
 
of
 
ty³
 <A 
HREF
=#utime_t><
B
>
¡_utime_t
</B></A> 
¥ecifyšg
 
the


2303 
šaùiv™y
 
	`timeout
 (
š
 
miüo£cÚds
).

2304 
NÙe
 
th©
 
timeouts
 
¬e
 
m—su»d
 <
A
 
HREF
="nÙes.html#timeouts">
sšû
 
the


2305 
Ï¡
 
cÚ‹xt
 </
A
>.

2306 <
P
>

2307 <
H5
>
R‘uºs
</H5>

2308 
On
 
sucûss
, 
z”o
 
is
 
»tuºed
. <
TT
>*
»sid
</TT> 
may
 
be
 z”o, 
šdiÿtšg


2309 
a
 
com¶‘e
 
»ad
, 
Ü
 
nÚ
-
z”o
, 
šdiÿtšg
 
the
 
ÃtwÜk


2310 
cÚÃùiÚ
 
is
 
şo£d
 
Ü
 
’d
 
of
 
fe
 i 
»ached
.

2311 <
P
>

2312 
Oth”wi£
, 
a
 
v®ue
 
of
 <
TT
>-1</TT> 
is
 
»tuºed
, <TT>*
»sid
</TT> i 
nÚ
-
z”o
,

2313 
ªd
 <
TT
>
”ºo
</TT> 
is
 
£t
 
to
 
šdiÿ‹
 
the
 
”rÜ
.

2314 
PossibË
 <
TT
>
”ºo
</TT> 
v®ues
 
¬e
 
the
 
§me
 
as
 
£t
 
by
h<TT>
	`»ad
(2)</TT>

2315 
ÿÎ
 
w™h
 
two
 
exû±iÚs
:<
P
>

2316 <
TABLE
 
BORDER
=0>

2317 <
TR
><
TD
><
TT
>
EINTR
</TT></TD><TD>
The
 
cu¼’t
 
th»ad
 
was
 
š‹¼u±ed
 
by


2318 <
A
 
HREF
=#th»ad_š‹¼u±>
	`¡_th»ad_š‹¼u±
()</A>.</
TD
></
TR
>

2319 <
TR
><
TD
><
TT
>
ETIME
</TT></TD><TD>
The
 
timeout
 
occu¼ed
.

2320 </
TD
></
TR
>

2321 </
TABLE
>

2322 <
P
>

2323 <
H5
>
DesütiÚ
</H5>

2324 
This
 
funùiÚ
 
blocks
 
the
 
ÿÎšg
 
th»ad
 
uÁ
h
¥ecif›d
 
amouÁ
 
of
 
d©a


2325 
is
 
»ad
 
š
 
fuÎ
, 
™
 
’couÁ”s
 
ª
 
’d
-
of
-
¡»am
 
šdiÿtiÚ
, 
a
 
timeout
 
occurs
,

2326 
Ü
 
ª
 
”rÜ
 
occurs
. 
It
 
difãrs
 
äom
 <
TT
>
	`¡_»ad_fuÎy
()</TT> 
Úly
 
š
 
th©


2327 
™
 
®lows
 
the
 
ÿÎ”
 
to
 
know
 
how
 
mªy
 
by‹s
 
w”e
 
Œªsã¼ed
 
befÜe
 
ª
 
”rÜ


2328 
occu¼ed
.

2329 <
P
>

2330 <
HR
>

2331 <
P
>

2332 <
A
 
NAME
="readv">

2333 <
H4
>
	`¡_»adv
()</H4>

2334 </
A
>

2335 
R—ds
 
d©a
 
äom
 
a
 
¥ecif›d
 
fe
 
desütÜ
 
objeù
 
što
 
muÉË
 
bufãrs
.

2336 <
P
>

2337 <
H5
>
SyÁax
</H5>

2339 <
PRE
>

2340 #šşud&
É
;
¡
.
h
&
gt
;

2342 
ssize_t
 
	`¡_»adv
(
¡_Ãtfd_t
 
fd
, cÚ¡ 
iovec
 *
iov
, 
iov_size
,

2343 
¡_utime_t
 
timeout
);

2344 </
PRE
>

2345 <
P
>

2346 <
H5
>
P¬am‘”s
</H5>

2347 <
TT
>
	`¡_»adv
()</TT> 
has
 
the
 
fŞlowšg
 
·¿m‘”s
:<
P
>

2348 <
TT
>
fd
</TT><
P
>

2349 
A
 
fe
 
desütÜ
 
objeù
 
	`id’tif›r
 (
£e


2350 <
A
 
HREF
=#Ãtfd_t><
B
>
¡_Ãtfd_t
</B></A>).<
P
>

2351 <
TT
>
iov
</TT><
P
>

2352 
An
 
¬¿y
 
of
 <
‰
>
iovec
</‰> 
¡ruùu»s
 
th©
 
id’tify
 
the
 
bufãrs
 
hŞdšg


2353 
the
 
d©a
 
»ad
 
š
.

2354 
On
  
the
 
bufãrs
 
cÚš
h
d©a
.<
P
>

2355 <
TT
>
iov_size
</TT><
P
>

2356 
The
 
numb”
 
of
 <
‰
>
iovec
</‰> 
¡ruùu»s
 
š
 
the
 <‰>
iov
</‰> 
¬¿y
.<
P
>

2357 <
TT
>
timeout
</TT><
P
>

2358 
A
 
v®ue
 
of
 
ty³
 <A 
HREF
=#utime_t><
B
>
¡_utime_t
</B></A> 
¥ecifyšg
 
the
 
time


2359 
lim™
 
š
 
miüo£cÚds
 
com¶‘iÚ
 
of
 
the
 
»ad
 
İ”©iÚ
.

2360 
NÙe
 
th©
 
timeouts
 
¬e
 
m—su»d
 <
A
 
HREF
="nÙes.html#timeouts">
sšû
 
the


2361 
Ï¡
 
cÚ‹xt
 </
A
>.

2362 <
P
>

2363 <
H5
>
R‘uºs
</H5>

2364 
On
 
sucûss
 
a
 
nÚ
-
Ãg©ive
 
š‹g”
 
šdiÿtšg
 
the
 
numb”
 
of
 
by‹s
 
aùu®ly


2365 
»ad
 
is
 
	`»tuºed
 (
a
 
v®ue
 
of
 <
TT
>0</TT> 
m—ns
 
the
 
ÃtwÜk
 
cÚÃùiÚ
 is

2366 
şo£d
 
Ü
 
’d
 
of
 
fe
 
is
 
»ached
). 
Oth”wi£
, 
a
 
v®ue
 oà<
TT
>-1</TT> is

2367 
»tuºed
 
ªd
 <
TT
>
”ºo
</TT> 
is
 
£t
 
to
 
šdiÿ‹
 
the
 
”rÜ
.

2368 
PossibË
 <
TT
>
”ºo
</TT> 
v®ues
 
¬e
 
the
 
§me
 
as
 
£t
 
by
h<TT>
	`»adv
(2)</TT>

2369 
ÿÎ
 
w™h
 
two
 
exû±iÚs
:<
P
>

2370 <
TABLE
 
BORDER
=0>

2371 <
TR
><
TD
><
TT
>
EINTR
</TT></TD><TD>
The
 
cu¼’t
 
th»ad
 
was
 
š‹¼u±ed
 
by


2372 <
A
 
HREF
=#th»ad_š‹¼u±>
	`¡_th»ad_š‹¼u±
()</A>.</
TD
></
TR
>

2373 <
TR
><
TD
><
TT
>
ETIME
</TT></TD><TD>
The
 
timeout
 
occu¼ed
 
ªd
 
no
 
d©a
 
was
 
»ad
.

2374 </
TD
></
TR
>

2375 </
TABLE
>

2376 <
P
>

2377 <
H5
>
DesütiÚ
</H5>

2378 
This
 
funùiÚ
 
blocks
 
the
 
ÿÎšg
 
th»ad
 
uÁ
 
™
 
’couÁ”s
 
ª
 
’d
-
of
-
¡»am


2379 
šdiÿtiÚ
, 
some
 
pos™ive
 
numb”
 
of
 
	$by‹s
 (
but
 
no
 
mÜe
 
thª
 
f™
 
š
 
the
 
bufãrs
)

2380 
¬e
 
»ad
 
š
, 
a
 
timeout
 
occurs
, 
Ü
 
ª
 
”rÜ
 occurs.

2381 <
P
>

2382 <
HR
>

2383 <
P
>

2384 <
A
 
NAME
="readv_resid">

2385 <
H4
>
	`¡_»adv_»sid
()</H4>

2386 </
A
>

2387 
R—ds
 
the
 
¥ecif›d
 
amouÁ
 
of
 
d©a
 
š
 
fuÎ
 
äom
 
a
 
fe
 
desütÜ
 
objeù


2388 
što
 
muÉË
 
bufãrs
.

2389 <
P
>

2390 <
H5
>
SyÁax
</H5>

2392 <
PRE
>

2393 #šşud&
É
;
¡
.
h
&
gt
;

2395 
	`¡_»adv_»sid
(
¡_Ãtfd_t
 
fd
, 
iovec
 **
iov
, *
iov_size
,

2396 
¡_utime_t
 
timeout
);

2397 </
PRE
>

2398 <
P
>

2399 <
H5
>
P¬am‘”s
</H5>

2400 <
TT
>
	`¡_»adv_»sid
()</TT> 
has
 
the
 
fŞlowšg
 
·¿m‘”s
:<
P
>

2401 <
TT
>
fd
</TT><
P
>

2402 
A
 
fe
 
desütÜ
 
objeù
 
	`id’tif›r
 (
£e


2403 <
A
 
HREF
=#Ãtfd_t><
B
>
¡_Ãtfd_t
</B></A>).<
P
>

2404 <
TT
>
iov
</TT><
P
>

2405 
A
 
poš‹r
 
to
 
ª
 
¬¿y
 
of
 <
‰
>
iovec
</‰> 
¡ruùu»s
.

2406 
On
 
’Œy
, 
the
 
iovecs
 
id’tify
h
bufãrs
 
hŞdšg
h
d©a
 
»ad
 
š
.

2407 
On
 , 
the
 
šcom¶‘e
 
iovecs
.

2408 
This
 
funùiÚ
 
modif›s
 
bÙh
 
the
 
poš‹r
 
ªd
h
¬¿y
 
to
 
which
 
™
 
pošts
.<
P
>

2409 <
TT
>
iov_size
</TT><
P
>

2410 
A
 
poš‹r
 
to
 
a
 
numb”
 
of
 
iovec
 
¡ruùu»s
.

2411 
On
 
’Œy
, 
the
 
numb”
 
of
 
iovec
 
¡ruùu»s
 
poš‹d
 
to
 
by
 <
‰
>*
iov
</tt>.

2412 
On
 , 
the
 
numb”
 
of
 
šcom¶‘e
 
Ü
 
unu£d
 
iovec
 
¡ruùu»s
.

2413 (
A
 
nÚ
-
z”o
 
»tuºed
 
v®ue
 
m—ns
 
some
 
but
 
nÙ
 
®l
 
of
 
the
 
d©a
 
was
 
»ad
.)<
P
>

2414 <
TT
>
timeout
</TT><
P
>

2415 
A
 
v®ue
 
of
 
ty³
 <A 
HREF
=#utime_t><
B
>
¡_utime_t
</B></A> 
¥ecifyšg
 
the


2416 
šaùiv™y
 
	`timeout
 (
š
 
miüo£cÚds
).

2417 
NÙe
 
th©
 
timeouts
 
¬e
 
m—su»d
 <
A
 
HREF
="nÙes.html#timeouts">
sšû
 
the


2418 
Ï¡
 
cÚ‹xt
 </
A
>.

2419 <
P
>

2420 <
H5
>
R‘uºs
</H5>

2421 
On
 
sucûss
, 
z”o
 
is
 
»tuºed
. <
TT
>*
iov_size
</TT> 
may
 
be
 z”o, 
šdiÿtšg


2422 
a
 
com¶‘e
 
»ad
, 
Ü
 
nÚ
-
z”o
, 
šdiÿtšg
 
the
 
ÃtwÜk
 
cÚÃùiÚ
 
is


2423 
şo£d
 
Ü
 
’d
 
of
 
fe
 
is
 
»ached
. <
‰
>*
iov
</‰> 
pošts
 
to
 
the
 
fœ¡


2424 
iovec
 
aá”
 
the
 
’d
 
of
h
Üigš®
 
¬¿y
 
Ú
 
a
 
com¶‘e
 
»ad
, 
Ü
 
to
he

2425 
fœ¡
 
šcom¶‘e
 
iovec
 
Ú
 
ª
 incom¶‘
»ad
.

2426 <
P
>

2427 
Oth”wi£
, 
a
 
v®ue
 
of
 <
TT
>-1</TT> 
is
 
»tuºed
, <TT>*
iov_size
</TT> i 
nÚ
-
z”o
,

2428 
ªd
 <
TT
>
”ºo
</TT> 
is
 
£t
 
to
 
šdiÿ‹
 
the
 
”rÜ
. <
‰
>*
iov
</‰> 
pošts
ohe

2429 
fœ¡
 
unu£d
 
iovec
.

2430 
PossibË
 <
TT
>
”ºo
</TT> 
v®ues
 
¬e
 
the
 
§me
 
as
 
£t
 
by
h<TT>
	`»adv
(2)</TT>

2431 
ÿÎ
 
w™h
 
two
 
exû±iÚs
:<
P
>

2432 <
TABLE
 
BORDER
=0>

2433 <
TR
><
TD
><
TT
>
EINTR
</TT></TD><TD>
The
 
cu¼’t
 
th»ad
 
was
 
š‹¼u±ed
 
by


2434 <
A
 
HREF
=#th»ad_š‹¼u±>
	`¡_th»ad_š‹¼u±
()</A>.</
TD
></
TR
>

2435 <
TR
><
TD
><
TT
>
ETIME
</TT></TD><TD>
The
 
timeout
 
occu¼ed
.

2436 </
TD
></
TR
>

2437 </
TABLE
>

2438 <
P
>
AÎ
 
of
 
the
 
iovecs
 
befÜe
 <
‰
>*
iov
</‰> 
¬e
 
modif›d
 
such
 
th©


2439 <
‰
>
iov_ba£
</‰> 
pošts
 
to
 
the
 
’d
 
of
h
Üigš®
 
bufãr
 
ªd


2440 <
‰
>
iov_Ën
</‰> 
is
 
z”o
.

2441 <
P
>

2442 <
H5
>
DesütiÚ
</H5>

2443 
This
 
funùiÚ
 
blocks
 
the
 
ÿÎšg
 
th»ad
 
uÁ
h
¥ecif›d
 
amouÁ
 
of
 
d©a


2444 
is
 
»ad
 
š
 
fuÎ
, 
™
 
’couÁ”s
 
ª
 
’d
-
of
-
¡»am
 
šdiÿtiÚ
, 
a
 
timeout
 
occurs
,

2445 
Ü
 
ª
 
”rÜ
 
occurs
. 
Like
 <
‰
>
	`¡_»ad_»sid
()</‰> 
™
 
blocks
 
the
 
th»ad
 
uÁ


2446 <
i
>
®l
</i> 
of
 
the
 
»que¡ed
 
d©a
 
is
 
»ad
 
Ü
 
ª
 
”rÜ
 
occurs
. 
U£


2447 <
‰
>
	`¡_»adv
()</‰> 
to
 
»ad
 <
i
>
up
o</i> 
the
 
»que¡ed
 
amouÁ
 
of
 
d©a
.

2448 <
P
>

2449 <
HR
>

2450 <
P
>

2451 <
A
 
NAME
="write">

2452 <
H4
>
	`¡_wr™e
()</H4>

2453 </
A
>

2454 
Wr™es
 
a
 
bufãr
 
of
 
d©a
 
to
‡ 
¥ecif›d
 
fe
 
desütÜ
 
objeù
.

2455 <
P
>

2456 <
H5
>
SyÁax
</H5>

2458 <
PRE
>

2459 #šşud&
É
;
¡
.
h
&
gt
;

2461 
ssize_t
 
	`¡_wr™e
(
¡_Ãtfd_t
 
fd
, cÚ¡ *
buf
, 
size_t
 
nby‹
,

2462 
¡_utime_t
 
timeout
);

2463 </
PRE
>

2464 <
P
>

2465 <
H5
>
P¬am‘”s
</H5>

2466 <
TT
>
	`¡_wr™e
()</TT> 
has
 
the
 
fŞlowšg
 
·¿m‘”s
:<
P
>

2467 <
TT
>
fd
</TT><
P
>

2468 
A
 
fe
 
desütÜ
 
objeù
 
	`id’tif›r
 (
£e


2469 <
A
 
HREF
=#Ãtfd_t><
B
>
¡_Ãtfd_t
</B></A>).<
P
>

2470 <
TT
>
buf
</TT><
P
>

2471 
A
 
poš‹r
 
to
 
the
 
bufãr
 
hŞdšg
h
d©a
Ø
be
 
wr™‹n
.<
P
>

2472 <
TT
>
nby‹
</TT><
P
>

2473 
The
 
amouÁ
 
of
 
d©a
 
š
 
by‹s
 
to
 
be
 
wr™‹n
 
äom
 
the
 
bufãr
.<
P
>

2474 <
TT
>
timeout
</TT><
P
>

2475 
A
 
v®ue
 
of
 
ty³
 <A 
HREF
=#utime_t><
B
>
¡_utime_t
</B></A> 
¥ecifyšg
 
the


2476 
šaùiv™y
 
	`timeout
 (
š
 
miüo£cÚds
).

2477 
NÙe
 
th©
 
timeouts
 
¬e
 
m—su»d
 <
A
 
HREF
="nÙes.html#timeouts">
sšû
 
the


2478 
Ï¡
 
cÚ‹xt
 </
A
>.

2479 <
P
>

2480 <
H5
>
R‘uºs
</H5>

2481 
On
 
sucûss
 
a
 
nÚ
-
Ãg©ive
 
š‹g”
 
equ®
 
to
 <
TT
>
nby‹
</TT> 
is
 
»tuºed
.

2482 
Oth”wi£
, 
a
 
v®ue
 
of
 <
TT
>-1</TT> 
is
 
»tuºed
 
ªd
 <TT>
”ºo
</TT> i 
£t


2483 
to
 
šdiÿ‹
 
the
 
”rÜ
. 
PossibË
 <
TT
>
”ºo
</TT> 
v®ues
 
¬e
h
§me
 
as
 
£t


2484 
by
 
the
 <
TT
>
	`wr™e
(2)</TT> 
ÿÎ
 
w™h
 
two
 
exû±iÚs
:<
P
>

2485 <
TABLE
 
BORDER
=0>

2486 <
TR
><
TD
><
TT
>
EINTR
</TT></TD><TD>
The
 
cu¼’t
 
th»ad
 
was
 
š‹¼u±ed
 
by


2487 <
A
 
HREF
=#th»ad_š‹¼u±>
	`¡_th»ad_š‹¼u±
()</A>.</
TD
></
TR
>

2488 <
TR
><
TD
><
TT
>
ETIME
</TT></TD><TD>
The
 
timeout
 
occu¼ed
.

2489 </
TD
></
TR
>

2490 </
TABLE
>

2491 <
P
>

2492 <
H5
>
DesütiÚ
</H5>

2493 
This
 
funùiÚ
 
blocks
 
the
 
ÿÎšg
 
th»ad
 
uÁ
 <
I
>
®l
</I>h
d©a
 
is
 
wr™‹n
,

2494 
a
 
timeout
 
occurs
, 
Ü
 
the
 
wr™e
 
İ”©iÚ
 
çs
. 
The
  
v®ue
 
is
 
equ®
 
to


2495 
e™h”
 <
TT
>
nby‹
</TT> (
Ú
 
sucûss
è
Ü
 <TT>-1</TT> (Ú 
çu»
). 
NÙe
 
th©
 

2496 <
TT
>
	`¡_wr™e
()</TT> 
»tuºs
 <TT>-1</TT>, 
some
 
	`d©a
 (
Ëss
 
thª
 <TT>
nby‹
</TT>

2497 
by‹s
è
may
 
have
 
b“n
 
wr™‹n
 
befÜe
 
ª
 
”rÜ
 
occu¼ed
.

2498 <
P
>

2499 <
HR
>

2500 <
P
>

2501 <
A
 
NAME
="write_resid">

2502 <
H4
>
	`¡_wr™e_»sid
()</H4>

2503 </
A
>

2504 
Wr™es
 
a
 
bufãr
 
of
 
d©a
 
to
‡ 
¥ecif›d
 
fe
 
desütÜ
 
objeù
.

2505 <
P
>

2506 <
H5
>
SyÁax
</H5>

2508 <
PRE
>

2509 #šşud&
É
;
¡
.
h
&
gt
;

2511 
	`¡_wr™e_»sid
(
¡_Ãtfd_t
 
fd
, cÚ¡ *
buf
, 
size_t
 *
»sid
,

2512 
¡_utime_t
 
timeout
);

2513 </
PRE
>

2514 <
P
>

2515 <
H5
>
P¬am‘”s
</H5>

2516 <
TT
>
	`¡_wr™e_»sid
()</TT> 
has
 
the
 
fŞlowšg
 
·¿m‘”s
:<
P
>

2517 <
TT
>
fd
</TT><
P
>

2518 
A
 
fe
 
desütÜ
 
objeù
 
	`id’tif›r
 (
£e


2519 <
A
 
HREF
=#Ãtfd_t><
B
>
¡_Ãtfd_t
</B></A>).<
P
>

2520 <
TT
>
buf
</TT><
P
>

2521 
A
 
poš‹r
 
to
 
the
 
bufãr
 
hŞdšg
h
d©a
Ø
be
 
wr™‹n
.<
P
>

2522 <
TT
>
»sid
</TT><
P
>

2523 
A
 
poš‹r
 
to
 
a
 
numb”
 
of
 
by‹s
.

2524 
On
 
’Œy
, 
the
 
amouÁ
 
of
 
d©a
 
to
 
be
 
wr™‹n
 
äom
h
bufãr
.

2525 
On
 , 
the
 
amouÁ
 
of
 
d©a
 
»maššg
 
to
 
be
 
wr™‹n
.

2526 (
A
 
nÚ
-
z”o
 
»tuºed
 
v®ue
 
m—ns
 
some
 
but
 
nÙ
 
®l
 
of
 
the
 
d©a
 
was
 
wr™‹n
.)<
P
>

2527 <
TT
>
timeout
</TT><
P
>

2528 
A
 
v®ue
 
of
 
ty³
 <A 
HREF
=#utime_t><
B
>
¡_utime_t
</B></A> 
¥ecifyšg
 
the


2529 
šaùiv™y
 
	`timeout
 (
š
 
miüo£cÚds
).

2530 
NÙe
 
th©
 
timeouts
 
¬e
 
m—su»d
 <
A
 
HREF
="nÙes.html#timeouts">
sšû
 
the


2531 
Ï¡
 
cÚ‹xt
 </
A
>.

2532 <
P
>

2533 <
H5
>
R‘uºs
</H5>

2534 
On
 
sucûss
, 
z”o
 
is
 
»tuºed
 
ªd
 <
TT
>*
»sid
</TT> is zero.

2535 
Oth”wi£
, 
a
 
v®ue
 
of
 <
TT
>-1</TT> 
is
 
»tuºed
, <TT>*
»sid
</TT> i 
nÚ
-
z”o
,

2536 
ªd
 <
TT
>
”ºo
</TT> 
is
 
£t


2537 
to
 
šdiÿ‹
 
the
 
”rÜ
. 
PossibË
 <
TT
>
”ºo
</TT> 
v®ues
 
¬e
h
§me
 
as
 
£t


2538 
by
 
the
 <
TT
>
	`wr™e
(2)</TT> 
ÿÎ
 
w™h
 
two
 
exû±iÚs
:<
P
>

2539 <
TABLE
 
BORDER
=0>

2540 <
TR
><
TD
><
TT
>
EINTR
</TT></TD><TD>
The
 
cu¼’t
 
th»ad
 
was
 
š‹¼u±ed
 
by


2541 <
A
 
HREF
=#th»ad_š‹¼u±>
	`¡_th»ad_š‹¼u±
()</A>.</
TD
></
TR
>

2542 <
TR
><
TD
><
TT
>
ETIME
</TT></TD><TD>
The
 
timeout
 
occu¼ed
.

2543 </
TD
></
TR
>

2544 </
TABLE
>

2545 <
P
>

2546 <
H5
>
DesütiÚ
</H5>

2547 
This
 
funùiÚ
 
blocks
 
the
 
ÿÎšg
 
th»ad
 
uÁ
 <
I
>
®l
</I>h
d©a
 
is
 
wr™‹n
,

2548 
a
 
timeout
 
occurs
, 
Ü
 
the
 
wr™e
 
İ”©iÚ
 
çs
. 
It
 
difãrs
 
äom


2549 <
TT
>
	`¡_wr™e
()</TT> 
Úly
 
š
 
th©
 
™
 
®lows
 
the
 
ÿÎ”
 
to
 
know
 
how
 
mªy
 
by‹s


2550 
w”e
 
Œªsã¼ed
 
befÜe
 
ª
 
”rÜ
 
occu¼ed
.

2551 <
P
>

2552 <
HR
>

2553 <
P
>

2554 <
A
 
NAME
="writev">

2555 <
H4
>
	`¡_wr™ev
()</H4>

2556 </
A
>

2557 
Wr™es
 
d©a
 
to
 
a
 
¥ecif›d
 
fe
 
desütÜ
 
objeù
 
äom
 
muÉË
 
bufãrs
.

2558 <
P
>

2559 <
H5
>
SyÁax
</H5>

2561 <
PRE
>

2562 #šşud&
É
;
¡
.
h
&
gt
;

2564 
ssize_t
 
	`¡_wr™ev
(
¡_Ãtfd_t
 
fd
, cÚ¡ 
iovec
 *
iov
, 
iov_size
,

2565 
¡_utime_t
 
timeout
);

2566 </
PRE
>

2567 <
P
>

2568 <
H5
>
P¬am‘”s
</H5>

2569 <
TT
>
	`¡_wr™ev
()</TT> 
has
 
the
 
fŞlowšg
 
·¿m‘”s
:<
P
>

2570 <
TT
>
fd
</TT><
P
>

2571 
A
 
fe
 
desütÜ
 
objeù
 
	`id’tif›r
 (
£e


2572 <
A
 
HREF
=#Ãtfd_t><
B
>
¡_Ãtfd_t
</B></A>).<
P
>

2573 <
TT
>
iov
</TT><
P
>

2574 
An
 
¬¿y
 
of
 <
TT
>
iovec
</TT> 
¡ruùu»s
 
th©
 
desüibe
 
the
 
bufãrs
 
to
 
wr™e


2575 
	`äom
 (
£e
 <
TT
>
	`wr™ev
(2)</TT>).<
P
>

2576 <
TT
>
iov_size
</TT><
P
>

2577 
Numb”
 
of
 <
TT
>
iovec
</TT> 
¡ruùu»s
 
š
 
the
 <TT>
iov
</TT> 
¬¿y
.<
P
>

2578 <
TT
>
timeout
</TT><
P
>

2579 
A
 
v®ue
 
of
 
ty³
 <A 
HREF
=#utime_t><
B
>
¡_utime_t
</B></A> 
¥ecifyšg
 
the


2580 
šaùiv™y
 
	`timeout
 (
š
 
miüo£cÚds
).

2581 
NÙe
 
th©
 
timeouts
 
¬e
 
m—su»d
 <
A
 
HREF
="nÙes.html#timeouts">
sšû
 
the


2582 
Ï¡
 
cÚ‹xt
 </
A
>.

2583 <
P
>

2584 <
H5
>
R‘uºs
</H5>

2585 
On
 
sucûss
 
a
 
nÚ
-
Ãg©ive
 
š‹g”
 
equ®
 
to
 
the
 
sum
 
of
 
®l
h
bufãr
 
Ëngths


2586 
is
 
»tuºed
. 
Oth”wi£
, 
a
 
v®ue
 
of
 <
TT
>-1</TT> i »tuºed 
ªd
 <TT>
”ºo
</TT>

2587 
is
 
£t
 
to
 
šdiÿ‹
 
the
 
”rÜ
. 
PossibË
 <
TT
>
”ºo
</TT> 
v®ues
 
¬e
h
§me
 
as


2588 
£t
 
by
 
the
 <
TT
>
	`wr™ev
(2)</TT> 
ÿÎ
 
w™h
 
two
 
exû±iÚs
:<
P
>

2589 <
TABLE
 
BORDER
=0>

2590 <
TR
><
TD
><
TT
>
EINTR
</TT></TD><TD>
The
 
cu¼’t
 
th»ad
 
was
 
š‹¼u±ed
 
by


2591 <
A
 
HREF
=#th»ad_š‹¼u±>
	`¡_th»ad_š‹¼u±
()</A>.</
TD
></
TR
>

2592 <
TR
><
TD
><
TT
>
ETIME
</TT></TD><TD>
The
 
timeout
 
occu¼ed
.

2593 </
TD
></
TR
>

2594 </
TABLE
>

2595 <
P
>

2596 <
H5
>
DesütiÚ
</H5>

2597 
This
 
funùiÚ
 
blocks
 
the
 
ÿÎšg
 
th»ad
 
uÁ
 <
I
>
®l
</I>h
d©a
 
is
 
wr™‹n
,

2598 
a
 
timeout
 
occurs
, 
Ü
 
the
 
wr™e
 
İ”©iÚ
 
çs
. 
The
  
v®ue
 
is
 
equ®
 
to


2599 
e™h”
 
the
 
sum
 
of
 
®l
h
bufãr
 
	$Ëngths
 (
Ú
 
sucûss
è
Ü
 <
TT
>-1</TT> (on

2600 
çu»
). 
NÙe
 
th©
 <
TT
>
	`¡_wr™ev
()</TT> 
»tuºs
 <TT>-1</TT>, 
·¹
 
of
 
the


2601 
d©a
 
may
 
have
 
b“n
 
wr™‹n
 
befÜe
 
ª
 
”rÜ
 
occu¼ed
.

2602 <
P
>

2603 <
HR
>

2604 <
P
>

2605 <
A
 
NAME
="writev_resid">

2606 <
H4
>
	`¡_wr™ev_»sid
()</H4>

2607 </
A
>

2608 
Wr™es
 
muÉË
 
bufãrs
 
of
 
d©a
 
to
 
a
 
¥ecif›d
 
fe
 
desütÜ
 
objeù
.

2609 <
P
>

2610 <
H5
>
SyÁax
</H5>

2612 <
PRE
>

2613 #šşud&
É
;
¡
.
h
&
gt
;

2615 
	`¡_wr™ev_»sid
(
¡_Ãtfd_t
 
fd
, 
iovec
 **
iov
, *
iov_size
,

2616 
¡_utime_t
 
timeout
);

2617 </
PRE
>

2618 <
P
>

2619 <
H5
>
P¬am‘”s
</H5>

2620 <
TT
>
	`¡_wr™ev_»sid
()</TT> 
has
 
the
 
fŞlowšg
 
·¿m‘”s
:<
P
>

2621 <
TT
>
fd
</TT><
P
>

2622 
A
 
fe
 
desütÜ
 
objeù
 
	`id’tif›r
 (
£e


2623 <
A
 
HREF
=#Ãtfd_t><
B
>
¡_Ãtfd_t
</B></A>).<
P
>

2624 <
TT
>
iov
</TT><
P
>

2625 
A
 
poš‹r
 
to
 
ª
 
¬¿y
 
of
 <
‰
>
iovec
</‰> 
¡ruùu»s
.

2626 
On
 
’Œy
, 
the
 
iovecs
 
id’tify
h
bufãrs
 
hŞdšg
h
d©a
 
to
 
wr™e
.

2627 
On
 , 
the
 
šcom¶‘e
 
iovecs
.

2628 
This
 
funùiÚ
 
modif›s
 
bÙh
 
the
 
poš‹r
 
ªd
h
¬¿y
 
to
 
which
 
™
 
pošts
.<
P
>

2629 <
TT
>
iov_size
</TT><
P
>

2630 
A
 
poš‹r
 
to
 
a
 
numb”
 
of
 
iovec
 
¡ruùu»s
.

2631 
On
 
’Œy
, 
the
 
numb”
 
of
 
iovec
 
¡ruùu»s
 
poš‹d
 
to
 
by
 <
‰
>*
iov
</tt>.

2632 
On
 , 
the
 
numb”
 
of
 
šcom¶‘e
 
Ü
 
unu£d
 
iovec
 
¡ruùu»s
.

2633 (
A
 
nÚ
-
z”o
 
»tuºed
 
v®ue
 
m—ns
 
some
 
but
 
nÙ
 
®l
 
of
 
the
 
d©a
 
was
 
wr™‹n
.)<
P
>

2634 <
TT
>
timeout
</TT><
P
>

2635 
A
 
v®ue
 
of
 
ty³
 <A 
HREF
=#utime_t><
B
>
¡_utime_t
</B></A> 
¥ecifyšg
 
the


2636 
šaùiv™y
 
	`timeout
 (
š
 
miüo£cÚds
).

2637 
NÙe
 
th©
 
timeouts
 
¬e
 
m—su»d
 <
A
 
HREF
="nÙes.html#timeouts">
sšû
 
the


2638 
Ï¡
 
cÚ‹xt
 </
A
>.

2639 <
P
>

2640 <
H5
>
R‘uºs
</H5>

2641 
On
 
sucûss
, 
z”o
 
is
 
»tuºed
, <
TT
>*
iov_size
</TT> i z”o, 
ªd
 <
‰
>*
iov
</tt>

2642 
pošts
 
to
 
the
 
fœ¡
 
iovec
 
aá”
h
’d
 
of
h
Üigš®
 
¬¿y
.

2643 
Oth”wi£
, 
a
 
v®ue
 
of
 <
TT
>-1</TT> 
is
 
»tuºed
, <TT>*
iov_size
</TT> i 
nÚ
-
z”o
,

2644 <
‰
>*
iov
</‰> 
pošts
 
to
 
the
 
fœ¡
 
šcom¶‘e
 
iovec
, 
ªd
 <
TT
>
”ºo
</TT> 
is
 
£t


2645 
to
 
šdiÿ‹
 
the
 
”rÜ
. 
PossibË
 <
TT
>
”ºo
</TT> 
v®ues
 
¬e
h
§me
 
as
 
£t


2646 
by
 
the
 <
TT
>
	`wr™ev
(2)</TT> 
ÿÎ
 
w™h
 
two
 
exû±iÚs
:<
P
>

2647 <
TABLE
 
BORDER
=0>

2648 <
TR
><
TD
><
TT
>
EINTR
</TT></TD><TD>
The
 
cu¼’t
 
th»ad
 
was
 
š‹¼u±ed
 
by


2649 <
A
 
HREF
=#th»ad_š‹¼u±>
	`¡_th»ad_š‹¼u±
()</A>.</
TD
></
TR
>

2650 <
TR
><
TD
><
TT
>
ETIME
</TT></TD><TD>
The
 
timeout
 
occu¼ed
.

2651 </
TD
></
TR
>

2652 </
TABLE
>

2653 <
P
>

2654 
AÎ
 
of
 
the
 
iovecs
 
befÜe
 <
‰
>*
iov
</‰> 
¬e
 
modif›d
 
such
 
th©


2655 <
‰
>
iov_ba£
</‰> 
pošts
 
to
 
the
 
’d
 
of
h
Üigš®
 
bufãr
 
ªd


2656 <
‰
>
iov_Ën
</‰> 
is
 
z”o
.

2657 <
P
>

2658 <
H5
>
DesütiÚ
</H5>

2659 
This
 
funùiÚ
 
blocks
 
the
 
ÿÎšg
 
th»ad
 
uÁ
 <
I
>
®l
</I>h
d©a
 
is
 
wr™‹n
,

2660 
a
 
timeout
 
occurs
, 
Ü
 
the
 
wr™e
 
İ”©iÚ
 
çs
. 
It
 
difãrs
 
äom


2661 <
TT
>
	`¡_wr™ev
()</TT> 
Úly
 
š
 
th©
 
™
 
®lows
 
the
 
ÿÎ”
 
to
 
know
 
how
 
mªy
 
by‹s


2662 
w”e
 
Œªsã¼ed
 
befÜe
 
ª
 
”rÜ
 
occu¼ed
.

2663 <
P
>

2664 <
HR
>

2665 <
P
>

2666 <
A
 
NAME
="recvfrom">

2667 <
H4
>
	`¡_»cväom
()</H4>

2668 </
A
>

2669 
Reûives
 
by‹s
 
äom
 
a
 
fe
 
desütÜ
 
objeù
 
ªd
 
¡Ües
 
the
 
£ndšg
 
³”
's

2670 
add»ss
.

2671 <
P
>

2672 <
H5
>
SyÁax
</H5>

2674 <
PRE
>

2675 #šşud&
É
;
¡
.
h
&
gt
;

2677 
	`¡_»cväom
(
¡_Ãtfd_t
 
fd
, *
buf
, 
Ën
, 
sockaddr
 *
äom
,

2678 *
äomËn
, 
¡_utime_t
 
timeout
);

2679 </
PRE
>

2680 <
P
>

2681 <
H5
>
P¬am‘”s
</H5>

2682 <
TT
>
	`¡_»cväom
()</TT> 
has
 
the
 
fŞlowšg
 
·¿m‘”s
:<
P
>

2683 <
TT
>
fd
</TT><
P
>

2684 
A
 
fe
 
desütÜ
 
objeù
 
	`id’tif›r
 (
£e


2685 <
A
 
HREF
=#Ãtfd_t><
B
>
¡_Ãtfd_t
</B></A>è
»´e£Ášg
 
a
 
UDP
 
sock‘
.<
P
>

2686 <
TT
>
buf
</TT><
P
>

2687 
A
 
poš‹r
 
to
 
a
 
bufãr
Ø
hŞd
 
the
 
d©a
 
»ûived
.<
P
>

2688 <
TT
>
Ën
</TT><
P
>

2689 
The
 
size
 
of
 <
TT
>
buf
</TT> 
š
 
by‹s
.<
P
>

2690 <
TT
>
äom
</TT><
P
>

2691 
If
 
this
 
·¿m‘”
 
is
 
nÙ
 
a
 <
TT
>
NULL
</TT> 
poš‹r
, 
the
 
sourû
 
add»ss
 
of
he

2692 
mes§ge
 
is
 
fËd
 
	`š
 (
£e
 <
TT
>
	`»cväom
(3)</TT>).<
P
>

2693 <
TT
>
äomËn
</TT><
P
>

2694 
This
 
is
 
a
 
v®ue
-
»suÉ
 
·¿m‘”
, 
š™Ÿlized
 
to
 
the
 
size
 
of
h
bufãr


2695 
assocŸ‹d
 
w™h
 <
TT
>
äom
</TT>, 
ªd
 
modif›d
 
Ú
  
to
 
šdiÿ‹
 
the
 
aùu®


2696 
size
 
of
 
the
 
add»ss
 
¡Üed
 
th”e
.<
P
>

2697 <
TT
>
timeout
</TT><
P
>

2698 
A
 
v®ue
 
of
 
ty³
 <A 
HREF
=#utime_t><
B
>
¡_utime_t
</B></A> 
¥ecifyšg
 
the
 
time


2699 
lim™
 
š
 
miüo£cÚds
 
com¶‘iÚ
 
of
 
the
 
»ûive
 
İ”©iÚ
.

2700 
NÙe
 
th©
 
timeouts
 
¬e
 
m—su»d
 <
A
 
HREF
="nÙes.html#timeouts">
sšû
 
the


2701 
Ï¡
 
cÚ‹xt
 </
A
>.

2702 <
P
>

2703 <
H5
>
R‘uºs
</H5>

2704 
On
 
sucûss
 
a
 
nÚ
-
Ãg©ive
 
š‹g”
 
šdiÿtšg
 
the
 
Ëngth
 
of
h
»ûived


2705 
mes§ge
 
š
 
by‹s
 
is
 
»tuºed
. 
Oth”wi£
, 
a
 
v®ue
 
of
 <
TT
>-1</TT> is„eturned

2706 
ªd
 <
TT
>
”ºo
</TT> 
is
 
£t
 
to
 
šdiÿ‹
 
the
 
”rÜ
. 
PossibË
 <TT>errno</TT>

2707 
v®ues
 
¬e
 
the
 
§me
 
as
 
£t
 
by
h<
TT
>
	`»cväom
(3)</TT> 
ÿÎ
 
w™h
 
two


2708 
exû±iÚs
:<
P
>

2709 <
TABLE
 
BORDER
=0>

2710 <
TR
><
TD
><
TT
>
EINTR
</TT></TD><TD>
The
 
cu¼’t
 
th»ad
 
was
 
š‹¼u±ed
 
by


2711 <
A
 
HREF
=#th»ad_š‹¼u±>
	`¡_th»ad_š‹¼u±
()</A>.</
TD
></
TR
>

2712 <
TR
><
TD
><
TT
>
ETIME
</TT></TD><TD>
The
 
timeout
 
occu¼ed
 
ªd
 
no
 
d©a
 
was
 
»ûived
.

2713 </
TD
></
TR
>

2714 </
TABLE
>

2715 <
P
>

2716 <
H5
>
DesütiÚ
</H5>

2717 
This
 
funùiÚ
 
»ûives
 
up
 
to
 
a
 
¥ecif›d
 
numb”
 
of
 
by‹s
 
äom
 
the
 specified

2718 
fe
 
desütÜ
 
objeù
 
»´e£Ášg
 
a
 
UDP
 
sock‘
.<
P
>

2719 <
TT
>
	`¡_»cväom
()</TT> 
blocks
 
the
 
ÿÎšg
 
th»ad
 
uÁ
 
Úe
 
Ü
 
mÜe
 
by‹s
 
¬e


2720 
Œªsã¼ed
, 
a
 
timeout
 
has
 
occu¼ed
, 
Ü
 
th”e
 
is
 
ª
 
”rÜ
. 
No
 
mÜe
 
thª


2721 <
TT
>
Ën
</TT> 
by‹s
 
wl
 
be
 
Œªsã¼ed
.

2722 <
P
>

2723 <
HR
>

2724 <
P
>

2725 <
A
 
NAME
="sendto">

2726 <
H4
>
	`¡_£ndto
()</H4>

2727 </
A
>

2728 
S’ds
 
by‹s
 
to
 
a
 
¥ecif›d
 
de¡š©iÚ
.

2729 <
P
>

2730 <
H5
>
SyÁax
</H5>

2732 <
PRE
>

2733 #šşud&
É
;
¡
.
h
&
gt
;

2735 
	`¡_£ndto
(
¡_Ãtfd_t
 
fd
, cÚ¡ *
msg
, 
Ën
, 
sockaddr
 *
to
,

2736 
tŞ’
, 
¡_utime_t
 
timeout
);

2737 </
PRE
>

2738 <
P
>

2739 <
H5
>
P¬am‘”s
</H5>

2740 <
TT
>
	`¡_£ndto
()</TT> 
has
 
the
 
fŞlowšg
 
·¿m‘”s
:<
P
>

2741 <
TT
>
fd
</TT><
P
>

2742 
A
 
fe
 
desütÜ
 
objeù
 
	`id’tif›r
 (
£e


2743 <
A
 
HREF
=#Ãtfd_t><
B
>
¡_Ãtfd_t
</B></A>è
»´e£Ášg
 
a
 
UDP
 
sock‘
.<
P
>

2744 <
TT
>
msg
</TT><
P
>

2745 
A
 
poš‹r
 
to
 
a
 
bufãr
 
cÚššg
 
the
 
mes§ge
Ø
be
 
£Á
.<
P
>

2746 <
TT
>
Ën
</TT><
P
>

2747 
The
 
Ëngth
 
of
 
the
 
mes§ge
 
to
 
be
 
	`£Á
 (
š
 
by‹s
).<
P
>

2748 <
TT
>
to
</TT><
P
>

2749 
A
 
poš‹r
 
to
 
the
 
add»ss
 
of
h
	`de¡š©iÚ
 (
£e
 <
TT
>
	`£ndto
(3)</TT>).<
P
>

2750 <
TT
>
tŞ’
</TT><
P
>

2751 
This
 
·¿m‘”
 
¥ecif›s
 
the
 
size
 
of
h
de¡š©iÚ
 
add»ss
.<
P
>

2752 <
TT
>
timeout
</TT><
P
>

2753 
A
 
v®ue
 
of
 
ty³
 <A 
HREF
=#utime_t><
B
>
¡_utime_t
</B></A> 
¥ecifyšg
 
the
 
time


2754 
lim™
 
š
 
miüo£cÚds
 
com¶‘iÚ
 
of
 
the
 
£nd
 
İ”©iÚ
.

2755 
NÙe
 
th©
 
timeouts
 
¬e
 
m—su»d
 <
A
 
HREF
="nÙes.html#timeouts">
sšû
 
the


2756 
Ï¡
 
cÚ‹xt
 </
A
>.

2757 <
P
>

2758 <
H5
>
R‘uºs
</H5>

2759 
On
 
sucûss
 
a
 
nÚ
-
Ãg©ive
 
š‹g”
 
šdiÿtšg
 
the
 
numb”
 
of
 
by‹s
 
£Á
 
is


2760 
»tuºed
. 
Oth”wi£
, 
a
 
v®ue
 
of
 <
TT
>-1</TT> 
is
„‘uºed 
ªd
 <TT>
”ºo
</TT> is

2761 
£t
 
to
 
šdiÿ‹
 
the
 
”rÜ
. 
PossibË
 <
TT
>
”ºo
</TT> 
v®ues
 
¬e
h
§me
 
as


2762 
£t
 
by
 
the
 <
TT
>
	`£ndto
(3)</TT> 
ÿÎ
 
w™h
 
two
 
exû±iÚs
:<
P
>

2763 <
TABLE
 
BORDER
=0>

2764 <
TR
><
TD
><
TT
>
EINTR
</TT></TD><TD>
The
 
cu¼’t
 
th»ad
 
was
 
š‹¼u±ed
 
by


2765 <
A
 
HREF
=#th»ad_š‹¼u±>
	`¡_th»ad_š‹¼u±
()</A>.</
TD
></
TR
>

2766 <
TR
><
TD
><
TT
>
ETIME
</TT></TD><TD>
The
 
timeout
 
occu¼ed
 
ªd
 
no
 
d©a
 
was
 
£Á
.

2767 </
TD
></
TR
>

2768 </
TABLE
>

2769 <
P
>

2770 <
H5
>
DesütiÚ
</H5>

2771 
This
 
funùiÚ
 
£nds
 
a
 
¥ecif›d
 
numb”
 
of
 
by‹s
 
äom
‡ 
fe
 
desütÜ


2772 
objeù
 
»´e£Ášg
 
a
 
UDP
 
sock‘
 
to
 
the
 
¥ecif›d
 
de¡š©iÚ
 
add»ss
.

2773 
If
 
no
 
bufãr
 
¥aû
 
is
 
avaabË
 
©
 
the
 
und”lyšg
 
OS
 
sock‘
 
to
 
hŞd
he

2774 
mes§ge
 
to
 
be
 
Œªsm™‹d
, 
th’
 <
TT
>
	`¡_£ndto
()</TT> 
blocks
 
the
 
ÿÎšg


2775 
th»ad
 
uÁ
 
the
 
¥aû
 
becomes
 
avaabË
, 
a
 
timeout
 
occurs
, 
Ü
 
ª
 
”rÜ


2776 
occurs
.

2777 <
P
>

2778 <
HR
>

2779 <
P
>

2780 <
A
 
NAME
="recvmsg">

2781 <
H4
>
	`¡_»cvmsg
()</H4>

2782 </
A
>

2783 
Reûives
 
a
 
mes§ge
 
äom
‡ 
fe
 
desütÜ
 
objeù
.

2784 <
P
>

2785 <
H5
>
SyÁax
</H5>

2787 <
PRE
>

2788 #šşud&
É
;
¡
.
h
&
gt
;

2790 
	`¡_»cvmsg
(
¡_Ãtfd_t
 
fd
, 
msghdr
 *
msg
, 
æags
,

2791 
¡_utime_t
 
timeout
);

2792 </
PRE
>

2793 <
P
>

2794 <
H5
>
P¬am‘”s
</H5>

2795 <
TT
>
	`¡_»cvmsg
()</TT> 
has
 
the
 
fŞlowšg
 
·¿m‘”s
:<
P
>

2796 <
TT
>
fd
</TT><
P
>

2797 
A
 
fe
 
desütÜ
 
objeù
 
	`id’tif›r
 (
£e


2798 <
A
 
HREF
=#Ãtfd_t><
B
>
¡_Ãtfd_t
</B></A>è
»´e£Ášg
 
a
 
UDP
 
sock‘
.<
P
>

2799 <
TT
>
msg
</TT><
P
>

2800 
A
 
poš‹r
 
to
 
a
 <
TT
>
msghdr
</TT> 
¡ruùu»
Ø
desüibe
 
the
 
d©a
 
»ûived
.<
P
>

2801 <
TT
>
æags
</TT><
P
>

2802 
CÚŒŞ
 
æags
 <
TT
>
	`»cvmsg
(3)</TT>.<
P
>

2803 <
TT
>
timeout
</TT><
P
>

2804 
A
 
v®ue
 
of
 
ty³
 <A 
HREF
=#utime_t><
B
>
¡_utime_t
</B></A> 
¥ecifyšg
 
the
 
time


2805 
lim™
 
š
 
miüo£cÚds
 
com¶‘iÚ
 
of
 
the
 
»ûive
 
İ”©iÚ
.

2806 
NÙe
 
th©
 
timeouts
 
¬e
 
m—su»d
 <
A
 
HREF
="nÙes.html#timeouts">
sšû
 
the


2807 
Ï¡
 
cÚ‹xt
 </
A
>.

2808 <
P
>

2809 <
H5
>
R‘uºs
</H5>

2810 
On
 
sucûss
 
a
 
nÚ
-
Ãg©ive
 
š‹g”
 
šdiÿtšg
 
the
 
numb”
 
of
 
by‹s
 
»ûived


2811 
is
 
»tuºed
. 
Oth”wi£
, 
a
 
v®ue
 
of
 <
TT
>-1</TT> is„eturned

2812 
ªd
 <
TT
>
”ºo
</TT> 
is
 
£t
 
to
 
šdiÿ‹
 
the
 
”rÜ
. 
PossibË
 <TT>errno</TT>

2813 
v®ues
 
¬e
 
the
 
§me
 
as
 
£t
 
by
h<
TT
>
	`»cvmsg
(3)</TT> 
ÿÎ
 
w™h
 
two


2814 
exû±iÚs
:<
P
>

2815 <
TABLE
 
BORDER
=0>

2816 <
TR
><
TD
><
TT
>
EINTR
</TT></TD><TD>
The
 
cu¼’t
 
th»ad
 
was
 
š‹¼u±ed
 
by


2817 <
A
 
HREF
=#th»ad_š‹¼u±>
	`¡_th»ad_š‹¼u±
()</A>.</
TD
></
TR
>

2818 <
TR
><
TD
><
TT
>
ETIME
</TT></TD><TD>
The
 
timeout
 
occu¼ed
 
ªd
 
no
 
d©a
 
was
 
»ûived
.

2819 </
TD
></
TR
>

2820 </
TABLE
>

2821 <
P
>

2822 <
H5
>
DesütiÚ
</H5>

2823 
This
 
funùiÚ
 
»ûives
 
by‹s
 
äom
 
the
 
¥ecif›d
 
fe
 
desütÜ
 
objeù


2824 
»´e£Ášg
 
a
 
UDP
 
sock‘
. 
The
 
İ”©iÚ
 
is
 
cÚŒŞËd
 
by
 
the
 
š
/
out


2825 <
TT
>
msg
</TT> 
·¿m‘”
.<
P
>

2826 <
TT
>
	`¡_»cvmsg
()</TT> 
blocks
 
the
 
ÿÎšg
 
th»ad
 
uÁ
 
Úe
 
Ü
 
mÜe
 
by‹s
 
¬e


2827 
Œªsã¼ed
, 
a
 
timeout
 
has
 
occu¼ed
, 
Ü
 
th”e
 
is
 
ª
 
”rÜ
.

2828 <
P
>

2829 <
HR
>

2830 <
P
>

2831 <
A
 
NAME
="sendmsg">

2832 <
H4
>
	`¡_£ndmsg
()</H4>

2833 </
A
>

2834 
S’ds
 
a
 
mes§ge
 
to
‡ 
fe
 
desütÜ
 
objeù
.

2835 <
P
>

2836 <
H5
>
SyÁax
</H5>

2838 <
PRE
>

2839 #šşud&
É
;
¡
.
h
&
gt
;

2841 
	`¡_£ndmsg
(
¡_Ãtfd_t
 
fd
, cÚ¡ 
msghdr
 *
msg
, 
æags
,

2842 
¡_utime_t
 
timeout
);

2843 </
PRE
>

2844 <
P
>

2845 <
H5
>
P¬am‘”s
</H5>

2846 <
TT
>
	`¡_£ndmsg
()</TT> 
has
 
the
 
fŞlowšg
 
·¿m‘”s
:<
P
>

2847 <
TT
>
fd
</TT><
P
>

2848 
A
 
fe
 
desütÜ
 
objeù
 
	`id’tif›r
 (
£e


2849 <
A
 
HREF
=#Ãtfd_t><
B
>
¡_Ãtfd_t
</B></A>è
»´e£Ášg
 
a
 
UDP
 
sock‘
.<
P
>

2850 <
TT
>
msg
</TT><
P
>

2851 
A
 
poš‹r
 
to
 
a
 <
TT
>
msghdr
</TT> 
¡ruùu»
 
desüibšg
 
the
 
mes§ge
Ø
be
 
£Á
.<
P
>

2852 <
TT
>
æags
</TT><
P
>

2853 
CÚŒŞ
 
æags
 <
TT
>
	`£ndmsg
(3)</TT>.<
P
>

2854 <
TT
>
timeout
</TT><
P
>

2855 
A
 
v®ue
 
of
 
ty³
 <A 
HREF
=#utime_t><
B
>
¡_utime_t
</B></A> 
¥ecifyšg
 
the
 
time


2856 
lim™
 
š
 
miüo£cÚds
 
com¶‘iÚ
 
of
 
the
 
£nd
 
İ”©iÚ
.

2857 
NÙe
 
th©
 
timeouts
 
¬e
 
m—su»d
 <
A
 
HREF
="nÙes.html#timeouts">
sšû
 
the


2858 
Ï¡
 
cÚ‹xt
 </
A
>.

2859 <
P
>

2860 <
H5
>
R‘uºs
</H5>

2861 
On
 
sucûss
 
a
 
nÚ
-
Ãg©ive
 
š‹g”
 
šdiÿtšg
 
the
 
numb”
 
of
 
by‹s
 
£Á
 
is


2862 
»tuºed
. 
Oth”wi£
, 
a
 
v®ue
 
of
 <
TT
>-1</TT> 
is
„‘uºed 
ªd
 <TT>
”ºo
</TT> is

2863 
£t
 
to
 
šdiÿ‹
 
the
 
”rÜ
. 
PossibË
 <
TT
>
”ºo
</TT> 
v®ues
 
¬e
h
§me
 
as


2864 
£t
 
by
 
the
 <
TT
>
	`£ndmsg
(3)</TT> 
ÿÎ
 
w™h
 
two
 
exû±iÚs
:<
P
>

2865 <
TABLE
 
BORDER
=0>

2866 <
TR
><
TD
><
TT
>
EINTR
</TT></TD><TD>
The
 
cu¼’t
 
th»ad
 
was
 
š‹¼u±ed
 
by


2867 <
A
 
HREF
=#th»ad_š‹¼u±>
	`¡_th»ad_š‹¼u±
()</A>.</
TD
></
TR
>

2868 <
TR
><
TD
><
TT
>
ETIME
</TT></TD><TD>
The
 
timeout
 
occu¼ed
 
ªd
 
no
 
d©a
 
was
 
£Á
.

2869 </
TD
></
TR
>

2870 </
TABLE
>

2871 <
P
>

2872 <
H5
>
DesütiÚ
</H5>

2873 
This
 
funùiÚ
 
£nds
 
by‹s
 
to
 
a
 
fe
 
desütÜ
 
objeù
 
»´e£Ášg
‡ 
UDP


2874 
sock‘
. 
The
 
İ”©iÚ
 
is
 
cÚŒŞËd
 
by
 
the
 <
TT
>
msg
</TT> 
·¿m‘”
.

2875 
If
 
no
 
bufãr
 
¥aû
 
is
 
avaabË
 
©
 
the
 
und”lyšg
 
OS
 
sock‘
 
to
 
hŞd
he

2876 
mes§ge
 
to
 
be
 
Œªsm™‹d
, 
th’
 <
TT
>
	`¡_£ndmsg
()</TT> 
blocks
 
the
 
ÿÎšg


2877 
th»ad
 
uÁ
 
the
 
¥aû
 
becomes
 
avaabË
, 
a
 
timeout
 
occurs
, 
Ü
 
ª
 
”rÜ


2878 
occurs
.

2879 <
P
>

2880 <
HR
>

2881 <
P
>

2882 <
A
 
NAME
="open">

2883 <
H4
>
	`¡_İ’
()</H4>

2884 </
A
>

2885 
O³ns
 
a
 
fe
 
»adšg
, 
wr™šg
, 
Ü
 
bÙh
.

2886 <
P
>

2887 <
H5
>
SyÁax
</H5>

2889 <
PRE
>

2890 #šşud&
É
;
¡
.
h
&
gt
;

2892 
¡_Ãtfd_t
 
	`¡_İ’
(cÚ¡ *
·th
, 
oæags
, 
mode_t
 
mode
);

2893 </
PRE
>

2894 <
P
>

2895 <
H5
>
P¬am‘”s
</H5>

2896 <
TT
>
	`¡_İ’
()</TT> 
has
 
the
 
fŞlowšg
 
·¿m‘”s
:<
P
>

2897 <
TT
>
·th
</TT><
P
>

2898 
The
 
·thÇme
 
of
 
the
 
fe
 
to
 
be
 
İ’ed
.<
P
>

2899 <
TT
>
oæags
</TT><
P
>

2900 
Fe
 
¡©us
 
æags
. 
The£
 
¬e
 
the
 
§me
 fÏg 
th©
‡» 
u£d
 
by
he

2901 <
TT
>
	`İ’
(2)</TT> 
sy¡em
 
ÿÎ
.<
P
>

2902 <
TT
>
mode
</TT><
P
>

2903 
Acûss
 
³rmissiÚ
 
b™s
 
of
 
the
 
fe
 
mode
, thf
is
 
ü—‹d
 
wh’


2904 <
TT
>
O_CREAT
</TT> 
is
 
£t
 
š
 <TT>
oæags
</TT> (
£e
 <TT>
	`İ’
(2)</TT>).

2905 <
P
>

2906 <
H5
>
R‘uºs
</H5>

2907 
UpÚ
 
sucûssful
 
com¶‘iÚ
, 
a
 
Ãw
 
fe
 
desütÜ
 
objeù
 
id’tif›r
 
is


2908 
»tuºed
. 
Oth”wi£
, <
TT
>
NULL
</TT> 
is
„‘uºed 
ªd
 <TT>
”ºo
</TT> i 
£t


2909 
to
 
šdiÿ‹
 
the
 
”rÜ
.

2910 <
P
>

2911 <
H5
>
DesütiÚ
</H5>

2912 
This
 
funùiÚ
 
ü—‹s
 
a
 
Ãw
 
fe
 
desütÜ
 
objeù
 
of
 
ty³


2913 <
A
 
HREF
=#Ãtfd_t><
B
>
¡_Ãtfd_t
</B></A> 
the
 
fe
 
w™h
h
·thÇme


2914 <
TT
>
·th
</TT>. 
This
 
objeù
 
ÿn
 
be
 
ä“d
 
by


2915 <
A
 
HREF
=#Ãtfd_ä“>
	`¡_Ãtfd_ä“
()</A> 
Ü


2916 <
A
 
HREF
=#Ãtfd_şo£>
	`¡_Ãtfd_şo£
()</A>.<
P
>

2917 
The
 
´im¬y
 
pu½o£
 
of
 
this
 
funùiÚ
 
is
 
to
 
İ’
 
	$FIFOs
 (
Çmed
 
pes
è
Ü


2918 
Ùh”
 
¥ecŸl
 
fes
 
š
 
Üd”
 
to
 
ü—‹
 
ª
 
’d
 
pošt
 
of
 
communiÿtiÚ
.

2919 
Howev”
, 
™
 
ÿn
 
be
 
u£d
 
Ú
 
»guÏr
 
fes
 
as
 
w–l
.<
P
>

2920 
AmÚg
 
Ùh”
 
thšgs
, 
this
 
funùiÚ
 
®ways
 
£ts
 
a
 
nÚ
-
blockšg
 
æag
 
Ú
 
the


2921 
und”lyšg
 
OS
 
fe
 
desütÜ
, 
so
 
th”e
 
is
 
no
 
Ãed
 
to
 
šşude
 
th©
 
æag
 
š


2922 <
TT
>
oæags
</TT>.

2923 <
P
>

2924 <
HR
>

2925 <
P
>

2926 <
A
 
NAME
="poll">

2927 <
H4
>
	`¡_pŞl
()</H4>

2928 </
A
>

2929 
D‘eùs
 
wh’
 
I
/
O
 
is
 
»ady
 
a
 
£t
 
of
 
OS
 
fe
 
desütÜs
.

2930 <
P
>

2931 <
H5
>
SyÁax
</H5>

2933 <
PRE
>

2934 #šşud&
É
;
¡
.
h
&
gt
;

2936 
	`¡_pŞl
(
pŞlfd
 *
pds
, 
Åds
, 
¡_utime_t
 
timeout
);

2937 </
PRE
>

2938 <
P
>

2939 <
H5
>
P¬am‘”s
</H5>

2940 <
TT
>
	`¡_pŞl
()</TT> 
has
 
the
 
fŞlowšg
 
·¿m‘”s
:<
P
>

2941 <
TT
>
pds
</TT><
P
>

2942 
A
 
poš‹r
 
to
 
ª
 
¬¿y
 
of
 <
TT
>
pŞlfd
</TT> 
	`¡ruùu»s
 (
£e
 <TT>
	`pŞl
(2)</TT>).

2943 <
P
>

2944 <
TT
>
Åds
</TT><
P
>

2945 
The
 
numb”
 
of
 
–em’ts
 
š
 
the
 <
TT
>
pds
</TT> 
¬¿y
.<
P
>

2946 <
TT
>
timeout
</TT><
P
>

2947 
A
 
v®ue
 
of
 
ty³
 <A 
HREF
=#utime_t><
B
>
¡_utime_t
</B></A> 
¥ecifyšg
 
the


2948 
amouÁ
 
of
 
time
 
š
 <
I
>
miüo£cÚds
</I> 
the
 
ÿÎ
 
wl
 
block
 
wa™šg
 I/
O


2949 
to
 
become
 
»ady
. 
If
 
this
 
time
 
expœes
 
w™hout
 
ªy
 
I
/
O
 
becomšg
„eady,

2950 <
TT
>
	`¡_pŞl
()</TT> 
»tuºs
 
z”o
.

2951 
NÙe
 
th©
 
timeouts
 
¬e
 
m—su»d
 <
A
 
HREF
="nÙes.html#timeouts">
sšû
 
the


2952 
Ï¡
 
cÚ‹xt
 </
A
>.

2953 <
P
>

2954 <
H5
>
R‘uºs
</H5>

2955 
UpÚ
 
sucûssful
 
com¶‘iÚ
, 
a
 
nÚ
-
Ãg©ive
 
v®ue
 
is
 
»tuºed
. 
A
 
pos™ive


2956 
v®ue
 
šdiÿ‹s
 
the
 
tÙ®
 
numb”
 
of
 
OS
 
fe
 
desütÜs
 
š
 <
TT
>
pds
</TT>

2957 
th©
 
have
 
ev’ts
. 
A
 
v®ue
 
of
 <
TT
>0</TT> 
šdiÿ‹s
h© 
the
 
ÿÎ
 
timed
 
out
.

2958 
UpÚ
 
çu»
, 
a
 
v®ue
 
of
 <
TT
>-1</TT> 
is
 
»tuºed
 
ªd
 <TT>
”ºo
</TT> i 
£t


2959 
to
 
šdiÿ‹
 
the
 
”rÜ
:<
P
>

2960 <
TABLE
 
BORDER
=0>

2961 <
TR
><
TD
><
TT
>
EINTR
</TT></TD><TD>
The
 
cu¼’t
 
th»ad
 
was
 
š‹¼u±ed
 
by


2962 <
A
 
HREF
=#th»ad_š‹¼u±>
	`¡_th»ad_š‹¼u±
()</A>.</
TD
></
TR
>

2963 </
TABLE
>

2964 <
P
>

2965 
If
 
ª
 
®‹º©ive
 
ev’t
 
nÙifiÿtiÚ
 
mechªism
 
has
 
b“n
 
£t
 
by


2966 <
A
 
HREF
=#£t_ev’tsys>
	`¡_£t_ev’tsys
()</A>, 
Ùh”
 
v®ues
 
of


2967 <
TT
>
”ºo
</TT> 
could
 
be
 
£t
 
upÚ
 
çu»
 
as
 
w–l
. 
The
 
v®ues


2968 
d•’d
 
Ú
 
the
 
¥ecific
 
mechªism
 
š
 
u£
.

2969 <
P
>

2970 <
H5
>
DesütiÚ
</H5>

2971 
This
 
funùiÚ
 
»tuºs
 
as
 
soÚ
‡ 
I
/
O
 
is
 
»ady
 
Ú
 
Úe
 
Ü
 
mÜe
 
of
 
the
 
¥ecif›d


2972 
OS
 
fe
 
desütÜs
. 
A
 
couÁ
 
of
 
the
 
numb”
 oà
»ady
 desütÜ 
is
 
»tuºed


2973 
uÆess
 
a
 
timeout
 
occurs
, 
š
 
which
 
z”o
 
is
 
»tuºed
.<
P
>

2974 
The
 <
TT
>
pŞlfd
</TT> 
¡ruùu»
 
is
 
defšed
 
š
 
the
 <TT>
pŞl
.
h
</TT> 
h—d”
 
fe


2975 
ªd
 
cÚšs
 
the
 
fŞlowšg
 
memb”s
:<
P
>

2976 <
PRE
>

2977 
fd
;

2978 
ev’ts
;

2979 
»v’ts
;

2980 </
PRE
>

2981 
The
 <
TT
>
ev’ts
</TT> 
f›ld
 
should
 
be
 
£t
 
to
 
the
 
I
/
O
 
	$ev’ts
 (
»adabË
,

2982 
wr™abË
, 
exû±iÚ
, 
Ü
 
some
 
combš©iÚ
è
th©
 
the
 
ÿÎ”
 
is
 
š‹»¡ed
 
š
.

2983 
On
 , 
the
 <
TT
>
»v’ts
</TT> 
f›ld
 
is
 
£t
 
to
 
šdiÿ‹
 
wh©
 
kšd
 
of
 
I
/
O


2984 
is
 
»ady
 
Ú
 
the
 
»¥eùive
 
desütÜ
.<
P
>

2985 
The
 <
TT
>
ev’ts
</TT> 
ªd
 <TT>
»v’ts
</TT> 
f›lds
 
¬e
 
cÚ¡ruùed
 
by
 
OR
-
šg


2986 
ªy
 
combš©iÚ
 
of
 
the
 
fŞlowšg
 
ev’t
 
	`æags
 (
defšed
 
š
 <
TT
>
pŞl
.
h
</TT>):

2987 <
P
>

2988 <
TABLE
 
BORDER
=0>

2989 <
TR
><
TD
><
TT
>
POLLIN
</TT></TD><TD><TT>
fd
</TT> 
is
 
»adabË
.</TD></TR>

2990 <
TR
><
TD
><
TT
>
POLLOUT
</TT></TD><TD><TT>
fd
</TT> 
is
 i 
wr™abË
.</TD></TR>

2991 <
TR
><
TD
><
TT
>
POLLPRI
</TT></TD><TD><TT>
fd
</TT> 
has
 
ª
 
exû±iÚ
 
cÚd™iÚ
.</TD>

2992 </
TR
>

2993 <
TR
><
TD
><
TT
>
POLLNVAL
</TT></TD><TD><TT>
fd
</TT> 
is
 
bad
.</TD></TR>

2994 </
TABLE
>

2995 <
P
>

2996 
The
 <
TT
>
POLLNVAL
</TT> 
æag
 
is
 
Úly
 
v®id
 
š
 
the
 <TT>
»v’ts
</TT> 
f›ld
;

2997 
™
 
is
 
nÙ
 
u£d
 
š
 
the
 <
TT
>
ev’ts
</TT> 
f›ld
.<
P
>

2998 
De¥™e
 
havšg
 
ª
 
š‹rçû
 
like
 <
‰
>
	`pŞl
(2)</‰>, 
this
 
funùiÚ
 
u£s


2999 
the
 
§me
 
ev’t
 
nÙifiÿtiÚ
 
mechªism
 
as
h
»¡
 
of
h
lib¿ry
. 
FÜ


3000 
š¡ªû
 
ª
 
®‹º©ive
 
ev’t
 
nofiÿtiÚ
 
mechªism
 
was
 
£t
 
usšg
 <
a


3001 
h»f
=#£t_ev’tsys>
	`¡_£t_ev’tsys
()</
a
>, 
this
 
funùiÚ
 
u£s
 
th©


3002 
mechªism
 
to
 
check
 
ev’ts
.<
p
>

3003 
NÙe
 
th©
 
uÆike
 
the
 <
TT
>
	`pŞl
(2)</TT> 
ÿÎ
, 
this
 
funùiÚ
 
has
he

3004 <
TT
>
timeout
</TT> 
·¿m‘”
 
ex´es£d
 
š
 
miüo£cÚds
. 
If
 
the
 
v®ue
 
of


3005 <
TT
>
timeout
</TT> 
is
 <
‰
>
ST_UTIME_NO_TIMEOUT
</tt>

3006 (<
TT
>-1</TT>), 
this
 
funùiÚ
 
blocks
 
uÁ
 
a
 
»que¡ed
 
I
/
O


3007 
ev’t
 
occurs
 
Ü
 
uÁ
 
the
 
ÿÎ
 
is
 
š‹¼u±ed
 
by


3008 <
A
 
HREF
=#th»ad_š‹¼u±>
	`¡_th»ad_š‹¼u±
()</A>.

3009 <
P
>

3010 <
b
>
NÙe
: </b> <
TT
>
	`kqueue
(2)</TT> 
is
 
u£d
 
as
 
ª
 
®‹º©ive
 
ev’t


3011 
nÙifiÿtiÚ
 
	`mechªism
 (
£e
 <
A


3012 
HREF
=#£t_ev’tsys>
	`¡_£t_ev’tsys
()</
A
>), 
the
 <
TT
>
POLLPRI
</TT>

3013 
ev’t
 
æag
 
is
 
nÙ
 
suµÜ‹d
 
ªd
 <
TT
>
	`¡_pŞl
()</TT> 
wl
  
ª
 
”rÜ


3014 
™
's set (<TT>errno</TT> will be seto <TT>EINVAL</TT>).

3015 <
P
>

3016 <
HR
>

3017 <
P
>

3019 <
A
 
NAME
="progr">

3020 <
H2
>
Prog¿m
 
SŒuùu»
</H2>

3021 </
A
>

3022 <
P
>

3023 
G’”®ly
, 
the
 
fŞlowšg
 
¡•s
 
should
 
be
 
fŞlowed
 
wh’
 
wr™šg
 
ª
 
­¶iÿtiÚ


3024 
usšg
 
the
 
S‹
 
Th»ads
 
lib¿ry
:

3025 <
P
>

3026 <
OL
>

3027 <
LI
>
CÚfigu»
 
the
 
lib¿ry
 
by
 
ÿÎšg
 
the£
 
´e
-
š™
 
funùiÚs
, 
desœed
.

3028 <
ul
>

3029 <
li
><
A
 
HREF
="#£t_utime_funùiÚ">
	`¡_£t_utime_funùiÚ
()</A></li>

3030 <
li
><
A
 
HREF
="#£t_ev’tsys">
	`¡_£t_ev’tsys
()</A></li>

3031 </
ul
>

3032 </
LI
>

3033 <
P
>

3034 <
LI
>
In™Ÿlize
 
the
 
lib¿ry
 
by
 
ÿÎšg
 <
A
 
HREF
=#¡_š™>
	`¡_š™
()</A>.</LI>

3035 <
P
>

3036 <
LI
>
CÚfigu»
 
the
 
lib¿ry
 
by
 
ÿÎšg
 
the£
 
po¡
-
š™
 
funùiÚs
, 
desœed
.

3037 <
ul
>

3038 <
li
><
A
 
HREF
="#timeÿche_£t">
	`¡_timeÿche_£t
()</A></li>

3039 <
li
><
A
 
HREF
="#¿ndomize_¡acks">
	`¡_¿ndomize_¡acks
()</A></li>

3040 <
li
><
A
 
HREF
="#£t_sw™ch_š_cb">
	`¡_£t_sw™ch_š_cb
()</A></li>

3041 <
li
><
A
 
HREF
="#£t_sw™ch_out_cb">
	`¡_£t_sw™ch_out_cb
()</A></li>

3042 </
ul
>

3043 </
LI
>

3044 <
P
>

3045 <
LI
>
C»©e
 
»sourûs
 
th©
 
wl
 
be
 
sh¬ed
 
amÚg
 
difã»Á
 
´oûs£s
:

3046 
ü—‹
 
ªd
 
bšd
 
li¡’šg
 
	`sock‘s
 (
£e
 <
TT
>
	`sock‘
(3)</TT>,

3047 <
TT
>
	`bšd
(3)</TT>, <TT>
	`li¡’
(3)</TT>,

3048 <
A
 
HREF
=#Ãtfd_İ’_sock‘>
	`¡_Ãtfd_İ’_sock‘
()</A>, 
ªd
 
possibly


3049 <
A
 
HREF
=#Ãtfd_£rŸlize_acû±>
	`¡_Ãtfd_£rŸlize_acû±
()</A>),

3050 
ü—‹
 
sh¬ed
 
memÜy
 
£gm’ts
, 
š‹r
-
´oûss
 
	$communiÿtiÚ
 (
IPC
)

3051 
chªÃls
 
ªd
 
synchrÚiz©iÚ
 
	`´im™ives
 (
ªy
).</
LI
>

3052 <
P
>

3053 <
LI
>
C»©e
 
£v”®
 
´oûs£s
 
vŸ
 <
TT
>
	`fÜk
(2)</TT>. 
The
 
·»Á
 
´oûss
 
should


3054 
e™h”
 
ex™
 
Ü
 
become
 
a
 "w©chdog" (
e
.
g
., 
™
 
¡¬ts
‡ 
Ãw
 
´oûss
 
wh’


3055 
ª
 
exi¡šg
 
Úe
 
üashes
, 
dÛs
 
a
 
ş—nup
 
upÚ
 
­¶iÿtiÚ
 
‹rmš©iÚ
,

3056 
‘c
.).</
LI
>

3057 <
P
>

3058 <
LI
>
In
 
—ch
 
chd
 
´oûss
 
ü—‹
 
a
 
poŞ
 
of
 
	`th»ads
 (
£e


3059 <
A
 
HREF
=#th»ad_ü—‹>
	`¡_th»ad_ü—‹
()</A>è
to
 
hªdË
 
u£r


3060 
cÚÃùiÚs
. 
Each
 
th»ad
 
š
 
the
 
poŞ
 
may
 
acû±
 
ş›Á
 connections

3061 (<
A
 
HREF
=#acû±>
	`¡_acû±
()</A>), 
cÚÃù
 
to
 
Ùh”
 
£rv”s


3062 (<
A
 
HREF
=#cÚÃù>
	`¡_cÚÃù
()</A>), 
³rfÜm
 
v¬ious
 
ÃtwÜk
 
I
/
O


3063 (<
A
 
HREF
=#»ad>
	`¡_»ad
()</A>, <A HREF=#wr™e>
	`¡_wr™e
()</A>, 
‘c
.).</
LI
>

3064 </
OL
>

3065 <
P
>

3066 
NÙe
 
th©
 
Úly
 
S‹
 
Th»ads
 
lib¿ry
 <
A
 
HREF
=#io>
I
/
O
 
funùiÚs
</A> 
should


3067 
be
 
u£d
 
a
 
ÃtwÜk
 
I
/
O
: 
ªy
 
Ùh”
 I/O 
ÿÎs
 
may
 
block
 
the
 
ÿÎšg
 
´oûss


3068 
šdefš™–y
. 
FÜ
 
exam¶e
, 
¡ªd¬d
 
I
/
O
 
	`funùiÚs
 (<
TT
>
	`fg‘s
(3)</TT>,

3069 <
TT
>
	`ä—d
(3)</TT>, <TT>
	`fwr™e
(3)</TT>, <TT>
	`årštf
(3)</TT>, 
‘c
.è
ÿÎ


3070 <
TT
>
	`»ad
(2)</TT> 
ªd
 <TT>
	`wr™e
(2)</TT> 
dœeùly
‡nd 
th”efÜe
 
should
 
nÙ
 
be


3071 
u£d
 
Ú
 
sock‘s
 
Ü
 
pes
.

3072 <
P
>

3073 
Also
 
nÙe
 
th©
 <
A


3074 
HREF
="nÙes.html#timeouts">
timeouts
</
A
> 
to
 
wÜk
 
the
 
´og¿m


3075 
should
 dØ
cÚ‹xt
 
	`sw™ches
 (
exam¶e
 
by
 
ÿÎšg


3076 <
TT
>
	`¡_u¦“p
()</TT>è
Ú
 
a
 
»guÏr
 
basis
.

3077 <
P
>

3078 <
HR
>

3079 <
P
>

3081 <
A
 
NAME
="block">

3082 <
H2
>
Li¡
 
of
 
Blockšg
 
FunùiÚs
</H2>

3083 </
A
>

3084 <
P
>

3085 
The
 
th»ad
 
cÚ‹xt
 
´oûss
 
¡©e
 
chªge
è
ÿn
 <
I
>
Úly
</I> 
h­³n


3086 
š
 
a
 
w–l
-
known
 
£t
 
of
 
blockšg
 
funùiÚs
.

3087 
OÆy
 
the
 
fŞlowšg
 
funùiÚs
 
ÿn
 
block
h
ÿÎšg
 
th»ad
:

3088 <
P
>

3089 <
DL
>

3090 <
DD
><
A
 
HREF
=#th»ad_još>
	`¡_th»ad_još
()</A></DD>

3091 <
DD
><
A
 
HREF
=#¦“p>
	`¡_¦“p
()</A></DD>

3092 <
DD
><
A
 
HREF
=#¦“p>
	`¡_u¦“p
()</A></DD>

3093 <
DD
><
A
 
HREF
=#cÚd_wa™>
	`¡_cÚd_wa™
()</A></DD>

3094 <
DD
><
A
 
HREF
=#cÚd_timedwa™>
	`¡_cÚd_timedwa™
()</A></DD>

3095 <
DD
><
A
 
HREF
=#mu‹x_lock>
	`¡_mu‹x_lock
()</A></DD>

3096 <
DD
><
A
 
HREF
=#Ãtfd_pŞl>
	`¡_Ãtfd_pŞl
()</A></DD>

3097 <
DD
><
A
 
HREF
=#acû±>
	`¡_acû±
()</A></DD>

3098 <
DD
><
A
 
HREF
=#cÚÃù>
	`¡_cÚÃù
()</A></DD>

3099 <
DD
><
A
 
HREF
=#»ad>
	`¡_»ad
()</A></DD>

3100 <
DD
><
A
 
HREF
=#»ad_fuÎy>
	`¡_»ad_fuÎy
()</A></DD>

3101 <
DD
><
A
 
HREF
=#»ad_»sid>
	`¡_»ad_»sid
()</A></DD>

3102 <
DD
><
A
 
HREF
=#»adv>
	`¡_»adv
()</A></DD>

3103 <
DD
><
A
 
HREF
=#»adv_»sid>
	`¡_»adv_»sid
()</A></DD>

3104 <
DD
><
A
 
HREF
=#wr™e>
	`¡_wr™e
()</A></DD>

3105 <
DD
><
A
 
HREF
=#wr™e_»sid>
	`¡_wr™e_»sid
()</A></DD>

3106 <
DD
><
A
 
HREF
=#wr™ev>
	`¡_wr™ev
()</A></DD>

3107 <
DD
><
A
 
HREF
=#wr™ev_»sid>
	`¡_wr™ev_»sid
()</A></DD>

3108 <
DD
><
A
 
HREF
=#»cväom>
	`¡_»cväom
()</A></DD>

3109 <
DD
><
A
 
HREF
=#£ndto>
	`¡_£ndto
()</A></DD>

3110 <
DD
><
A
 
HREF
=#»cvmsg>
	`¡_»cvmsg
()</A></DD>

3111 <
DD
><
A
 
HREF
=#£ndmsg>
	`¡_£ndmsg
()</A></DD>

3112 <
DD
><
A
 
HREF
=#pŞl>
	`¡_pŞl
()</A></DD>

3113 </
DL
>

3114 <
P
>

3115 <
HR
>

3116 <
P
>

3118 </
BODY
>

3119 </
HTML
>

	@trunk/objs/st-1.9/docs/st.html

1 <
	gHTML
>

2 <
	gHEAD
>

3 <
	gTITLE
>
S‹
 
Th»ads
 
IÁ”Ãt
 
	gAµliÿtiÚs
</TITLE>

4 </
	gHEAD
>

5 <
BODY
 
	gBGCOLOR
=#FFFFFF>

6 <
H2
>
S‹
 
Th»ads
 
IÁ”Ãt
 
AµliÿtiÚs
</H2>

7 <
H3
>
IÁroduùiÚ
</H3>

8 <
P
>

9 
S‹
 
Th»ads
 
is
 
ª
 
­¶iÿtiÚ
 
lib¿ry
 
which
 
´ovides
 
a


10 
found©iÚ
 
wr™šg
 
ç¡
 
ªd
 
highly
 
sÿÏbË
 
IÁ”Ãt
 
AµliÿtiÚs


11 
Ú
 
UNIX
-
like
 
¶©fÜms
. 
It
 
combšes
 
the
 
sim¶ic™y
 
of
h
muÉ™h»aded


12 
´og¿mmšg
 
·¿digm
, 
š
 
which
 
Úe
 
th»ad
 
suµÜts
 
—ch
 
simuÉªeous


13 
	gcÚÃùiÚ
, 
w™h
 
the
 
³rfÜmªû
 
ªd
 
sÿÏb™y
 
of
 
ª
 
	gev’t
-
driv’


14 
¡©e
 
machše
 
	g¬ch™eùu»
.</
	gP
>

16 <
	gH3
>1. 
	gDefš™iÚs
</H3>

17 <
	gP
>

18 <
A
 
	gNAME
="IA">

19 <
H4
>1.1 
IÁ”Ãt
 
AµliÿtiÚs
</H4>

20 </
A
>

21 <
P
>

22 
An
 <
I
>
IÁ”Ãt
 
AµliÿtiÚ
</I> (
IA
è
is
 
e™h”
 
a
 
£rv”
 
Ü
 
ş›Á
 
ÃtwÜk


23 
­¶iÿtiÚ
 
th©
 
acû±s
 
cÚÃùiÚs
 
äom
 
ş›Ás
 
ªd
 
may
 
Ü
 may 
nÙ


24 
cÚÃù
 
to
 
£rv”s
. 
In
 
ª
 
IA
 
the
 
¬riv®
 
Ü
 
d•¬tu»
 
of
 
ÃtwÜk
 
d©a


25 
oá’
 
cÚŒŞs
 
´oûssšg
 (
th©
 
is
, 
IA
 i 
a
 <
I
>
d©a
-
driv’
</I> 
­¶iÿtiÚ
).

26 
FÜ
 
—ch
 
	gcÚÃùiÚ
, 
ª
 
IA
 
dÛs
 
some
 
fš™e
 
amouÁ
 
of
 
wÜk


27 
švŞvšg
 
d©a
 
exchªge
 
w™h
 
™s
 
	g³”
, 
wh”e
 it 
³”
 
may
 
be
 
e™h”


28 
a
 
ş›Á
 
Ü
‡ 
	g£rv”
.

29 
The
 
typiÿl
 
Œª§ùiÚ
 
¡•s
 
of
 
ª
 
IA
 
¬e
 
to
 
acû±
 
a
 
	gcÚÃùiÚ
,

30 
»ad
 
a
 
	g»que¡
, dØ
some
 
fš™e
 
ªd
 
´ediùabË
 
amouÁ
 
of
 
wÜk
 
to


31 
´oûss
 
the
 
	g»que¡
, 
th’
 
wr™e
 
a
 
»¥Ú£
 
to
h
³”
 
th©
 
£Á
he

32 
	g»que¡
. 
OÃ
 
exam¶e
 
of
 
ª
 
IA
 
is
 
a
 
Web
 
	g£rv”
;

33 
the
 
mo¡
 
g’”®
 
exam¶e
 
of
 
ª
 
IA
 
is
 
a
 
´oxy
 
	g£rv”
, 
beÿu£
 
™
 
bÙh


34 
acû±s
 
cÚÃùiÚs
 
äom
 
ş›Ás
 
ªd
 
cÚÃùs
 
to
 
Ùh”
 
	g£rv”s
.</
	gP
>

35 <
	gP
>

36 
We
 
assume
 
th©
 
the
 
³rfÜmªû
 
of
 
ª
 
IA
 
is
 
cÚ¡¿šed
 
by
 
avaabË
 
CPU


37 
cyşes
 
¿th”
 
thª
 
ÃtwÜk
 
bªdwidth
 
Ü
 
disk
 
	gI
/
O
 (
th©
 
is
, 
CPU


38 
is
 
a
 
bÙ’eck
 
»sourû
).

39 <
	gP
>

41 <
A
 
	gNAME
="PS">

42 <
H4
>1.2 
P”fÜmªû
 
ªd
 
SÿÏb™y
</H4>

43 </
A
>

44 <
P
>

45 
The
 <
I
>
³rfÜmªû
</I> 
of
 
ª
 
IA
 
is
 
usu®ly
 
ev®u©ed
 
as
 
™s


46 
throughput
 
m—su»d
 
š
 
Œª§ùiÚs
 
³r
 
£cÚd
 
Ü
 
by‹s
…” secÚd (
Úe


47 
ÿn
 
be
 
cÚv”‹d
 
to
 
the
 
Ùh”
, 
giv’
h
av”age
 
Œª§ùiÚ
 
size
). 
Th”e
 
¬e


48 
£v”®
 
b’chm¬ks
 
th©
 
ÿn
 
be
 
u£d
 
to
 
m—su»
 
throughput
 
of
 
Web
 
£rvšg


49 
­¶iÿtiÚs
 
¥ecific
 
wÜklßds
 (
such
 
as


50 <
A
 
HREF
="h‰p://www.¥ec.Üg/osg/web96/">
SPECweb96
</A>,

51 <
A
 
HREF
="h‰p://www.mšdüaá.com/web¡Úe/">
WebStÚe
</A>,

52 <
A
 
HREF
="h‰p://www.zdÃt.com/zdbİ/webb’ch/">
WebB’ch
</A>).

53 
AÉhough
 
th”e
 
is
 
no
 
commÚ
 
defš™iÚ
 <
I
>
sÿÏb™y
</I>, 
š
 
g’”®
 
™


54 
ex´es£s
 
the
 
ab™y
 
of
 
ª
 
­¶iÿtiÚ
 
to
 
su¡aš
 
™s
 
³rfÜmªû
 
wh’
 
some


55 
ex‹º®
 
cÚd™iÚ
 
	gchªges
. 
FÜ
 
IAs
 
this
ƒx‹º® cÚd™iÚ 
is
 
e™h”
 
the


56 
numb”
 
of
 
ş›Ás
 (
®so
 
known
 
as
 "u£rs," "simuÉªeou cÚÃùiÚs," 
Ü
 "load

57 
g’”©Üs
") orhe underlying hardware system size (number of CPUs, memory

58 
size
, 
ªd
 
so
 
Ú
). 
Thus
 
th”e
 
¬e
 
two
 
ty³s
 
of
 
	gsÿÏb™y
: <
I
>
lßd


59 
sÿÏb™y
</
I
> 
ªd
 <I>
sy¡em
 sÿÏb™y</I>, 
	g»¥eùiv–y
.

60 <
	gP
>

61 
The
 
figu»
 
b–ow
 
shows
 
how
 
the
 
throughput
 
of
 
ª
 
id—lized
 
IA
 
chªges
 
w™h


62 
the
 
šü—sšg
 
numb”
 
of
 
ş›Ás
 (
sŞid
 
blue
 
lše
). 
In™ŸÎy
h
throughput


63 
grows
 
lš—¾y
 (
the
 
¦İe
 
»´e£Ás
h
maxim®
 
throughput
 
th©
 
Úe
 
ş›Á


64 
ÿn
 
´ovide
). 
W™hš
 
this
 
š™Ÿl
 
	g¿nge
, 
the
 
IA
 
is
 
und”utized
 
ªd
 
CPUs
 
¬e


65 
·¹ŸÎy
 
	gidË
. 
Fu¹h”
 
šü—£
 
š
 
the
 
numb”
 
of
 
ş›Ás
 
Ëads
 
to
 
a
 
sy¡em


66 
	g§tu¿tiÚ
, 
ªd
 
the
 
throughput
 
g¿du®ly
 
¡İs
 
growšg
 
as
 
®l
 
CPUs
 
become
 
fuÎy


67 
	gutized
. 
Aá”
 
th©
 
	gpošt
, 
the
 
throughput
 
¡ays
 
æ©
 
beÿu£
 
th”e
 
¬e
 
no


68 
mÜe
 
CPU
 
cyşes
 
	gavaabË
.

69 
In
 
the
 
»®
 
	gwÜld
, 
	ghowev”
, 
—ch
 
simuÉªeous
 
cÚÃùiÚ


70 
cÚsumes
 
some
 
computiÚ®
 
ªd
 
memÜy
 
	g»sourûs
, 
ev’
 
wh’
 
	gidË
,‡nd 
this


71 
ov”h—d
 
grows
 
w™h
 
the
 
numb”
 
of
 
	gş›Ás
. 
	gTh”efÜe
,h
throughput
 ofhe

72 
»®
 
wÜld
 
IA
 
¡¬ts
 
drİpšg
 
aá”
 
some
 
pošt
 (
dashed
 
blue
 
lše
 
š
 
the
 
figu»


73 
b–ow
). 
The
 
¿‹
 
©
 
which
 
the
 
throughput
 
drİs
 
	gd•’ds
, 
amÚg
 
Ùh”
 
	gthšgs
, 
Ú


74 
­¶iÿtiÚ
 
	gdesign
.

75 <
	gP
>

76 
We
 
§y
 
th©
 
ª
 
­¶iÿtiÚ
 
has
 
a
 
	ggood
 <
	gI
>
lßd
 
	gsÿÏb™y
</I> 
™
 
ÿn


77 
su¡aš
 
™s
 
throughput
 
ov”
 
a
 
wide
 
¿nge
 
of
 
	glßds
.

78 
	gIÁ”e¡šgly
, 
	gthe
 <
A
 
	gHREF
="h‰p://www.¥ec.Üg/osg/web99/">
SPECweb99
</A>

79 
b’chm¬k
 
somewh©
 
»æeùs
 
the
 
Web
 
£rv”
's†oad scalability because it

80 
m—su»s
 
the
 
numb”
 
of
 
	$ş›Ás
 (
lßd
 
g’”©Üs
è
giv’
 
a
 
mªd©Üy
 
mšim®


81 
throughput
 
³r
 
	`ş›Á
 (
th©
 
is
, 
™
 
m—su»s
 
the
 
£rv”
's <I>capacity</I>).

82 
This
 
is
 
uÆike
 <
A
 
HREF
="h‰p://www.¥ec.Üg/osg/web96/">
SPECweb96
</A> 
ªd


83 
Ùh”
 
b’chm¬ks
 
th©
 
u£
 
the
 
throughput
 
as
 
theœ
 
maš
 
	`m‘ric
 (
£e
h
figu»


84 
b–ow
).

85 <
P
>

86 <
CENTER
><
IMG
 
SRC
="fig.gif" 
ALT
="Figure: Throughput vs. Number of clients">

87 </
CENTER
>

88 <
P
>

89 <
I
>
Sy¡em
 
sÿÏb™y
</I> 
is
 
the
 
ab™y
 
of
 
ª
 
­¶iÿtiÚ
 
to
 
su¡aš
 
™s


90 
³rfÜmªû
 
³r
 
h¬dw¬e
 
	$un™
 (
such
 
as
 
a
 
CPU
è
w™h
 
the
 
šü—sšg
 
numb”
 
of


91 
the£
 
un™s
. 
In
 
Ùh”
 
wÜds
, 
good
 
sy¡em
 
sÿÏb™y
 
m—ns
 
th©
 
doublšg
 
the


92 
numb”
 
of
 
´oûssÜs
 
wl
 
roughly
 
the
 
­¶iÿtiÚ
'shroughput (dashed

93 
g»’
 
lše
). 
We
 
assume
 
h”e
 
th©
 
the
 
und”lyšg
 
İ”©šg
 
sy¡em
 
®so
 
sÿËs


94 
w–l
. 
Good
 
sy¡em
 
sÿÏb™y
 
®lows
 
you
 
to
 
š™ŸÎy
 
run
 
ª
 
­¶iÿtiÚ
 
Ú


95 
the
 
sm®Ë¡
 
sy¡em
 
possibË
, 
»ššg
h
ab™y
 
to
 
move
 
th©


96 
­¶iÿtiÚ
 
to
 
a
 
Ïrg”
 
sy¡em
 
Ãûs§ry
, 
w™hout
 
exûssive
 
effÜt
 
Ü


97 
ex³n£
. 
Th©
 
is
, 
ª
 
­¶iÿtiÚ
 
Ãed
 
nÙ
 
be
 
»wr™‹n
 
Ü
 
ev’
 
und”go
 
a


98 
majÜ
 
pÜtšg
 
effÜt
 
wh’
 
chªgšg
 
sy¡em
 
size
.

99 <
P
>

100 
AÉhough
 
sÿÏb™y
 
ªd
 
³rfÜmªû
 
¬e
 
mÜe
 
impÜÁ
 
š
 
the
 
of
 
£rv”


101 
IAs
, 
they
 
should
 
®so
 
be
 
cÚsid”ed
 
some
 
ş›Á
 
	`­¶iÿtiÚs
 (
such
 
as


102 
b’chm¬k
 
lßd
 
g’”©Üs
).

103 <
P
>

105 <
A
 
NAME
="CONC">

106 <
H4
>1.3 
CÚcu¼’cy
</H4>

107 </
A
>

108 <
P
>

109 
CÚcu¼’cy
 
»æeùs
 
the
 
·¿Î–ism
 
š
 
a
 
sy¡em
. 
The
 
two
 
uÄ–©ed
 
ty³s


110 
¬e
 <
I
>
vœtu®
</I> 
cÚcu¼’cy
 
ªd
 <I>
»®
</I> concurrency.

111 <
UL
>

112 <
LI
>
	$Vœtu®
 (
Ü
 
­·»Á
è
cÚcu¼’cy
 
is
 
the
 
numb”
 
of
 
simuÉªeous


113 
cÚÃùiÚs
 
th©
 
a
 
sy¡em
 
suµÜts
.

114 <
BR
><BR>

115 <
LI
>
R—l
 
cÚcu¼’cy
 
is
 
the
 
numb”
 
of
 
h¬dw¬e
 
deviûs
, 
šşudšg


116 
CPUs
, 
ÃtwÜk
 
ÿrds
, 
ªd
 
disks
, 
th©
 
aùu®ly
 
®low
 
a
 
sy¡em
 
to
 
³rfÜm


117 
sks
 
š
 
·¿Î–
.

118 </
UL
>

119 <
P
>

120 
An
 
IA
 
mu¡
 
´ovide
 
vœtu®
 
cÚcu¼’cy
 
š
 
Üd”
 
to
 
£rve
 
mªy
 
u£rs


121 
simuÉªeou¦y
.

122 
To
 
ach›ve
 
maximum
 
³rfÜmªû
 
ªd
 
sÿÏb™y
 
š
 
došg
 
so
, 
the
 
numb”
 
of


123 
´og¿mmšg
 
’t™›s
 
thª
 
ª
 
IA
 
ü—‹s
 
to
 
be
 
scheduËd
 
by
 
the
 
OS
 
k”Ãl


124 
should
 
be


125 
k•t
 
şo£
 
	$to
 (
w™hš
 
ª
 
Üd”
 
of
 
magn™ude
 ofè
the
 
»®
 
cÚcu¼’cy
 
found
 
Ú


126 
the
 
sy¡em
. 
The£
 
´og¿mmšg
 
’t™›s
 
scheduËd
 
by
h
k”Ãl
 
¬e
 
known
 
as


127 <
I
>
k”Ãl
 
executiÚ
 
vehişes
</I>. 
Exam¶es
 
of
 kernelƒxecution vehicles

128 
šşude
 
SŞ¬is
 
lightweight
 
´oûs£s
 
ªd
 
IRIX
 
k”Ãl
 
th»ads
.

129 
In
 
Ùh”
 
wÜds
, 
the
 
numb”
 
of
 
k”Ãl
 
executiÚ
 
vehişes
 
should
 
be
 
diù©ed
 
by


130 
the
 
sy¡em
 
size
 
ªd
 
nÙ
 
by
h
numb”
 
of
 
simuÉªeous
 
cÚÃùiÚs
.

131 <
P
>

133 <
H3
>2. 
Exi¡šg
 
Arch™eùu»s
</H3>

134 <
P
>

135 
Th”e
 
¬e
 
a
 
ãw
 
difã»Á
 
¬ch™eùu»s
 
th©
‡» 
commÚly
 
u£d
 
by
 
IAs
.

136 
The£
 
šşude
 
the
 <
I
>
MuÉi
-
Proûss
</I>,

137 <
I
>
MuÉi
-
Th»aded
</I>, 
ªd
 <I>
Ev’t
-
Driv’
 
S‹
 
Machše
</I>

138 
¬ch™eùu»s
.

139 <
P
>

140 <
A
 
NAME
="MP">

141 <
H4
>2.1 
MuÉi
-
Proûss
 
Arch™eùu»
</H4>

142 </
A
>

143 <
P
>

144 
In
 
the
 
MuÉi
-
	$Proûss
 (
MP
è
¬ch™eùu»
, 
ª
 
šdividu®
 
´oûss
 
is


145 
dediÿ‹d
 
to
 
—ch
 
simuÉªeous
 
cÚÃùiÚ
.

146 
A
 
´oûss
 
³rfÜms
 
®l
 
of
 
a
 
Œª§ùiÚ
's initialization steps

147 
ªd
 
£rviûs
 
a
 
cÚÃùiÚ
 
com¶‘–y
 
befÜe
 
movšg
 
Ú
 
to
 
£rviû


148 
a
 
Ãw
 
cÚÃùiÚ
.

149 <
P
>

150 
U£r
 
£ssiÚs
 
š
 
IAs
 
¬e
 
»Ïtiv–y
 
šd•’d’t
; 
th”efÜe
, 
no


151 
synchrÚiz©iÚ
 
b‘w“n
 
´oûs£s
 
hªdlšg
 
difã»Á
 
cÚÃùiÚs
 
is


152 
Ãûs§ry
. 
Beÿu£
 
—ch
 
´oûss
 
has
 
™s
 
own
 
´iv©e
 
add»ss
 
¥aû
,

153 
this
 
¬ch™eùu»
 
is
 
v”y
 
robu¡
. 
If
 
a
 
´oûss
 
£rvšg
 
Úe
 
of
 
the
 
cÚÃùiÚs


154 
üashes
, 
the
 
Ùh”
 
£ssiÚs
 
wl
 
nÙ
 
be
 
afãùed
. 
Howev”
, 
to
 
£rve
 
mªy


155 
cÚcu¼’t
 
cÚÃùiÚs
, 
ª
 
equ®
 
numb”
 
of
 
´oûs£s
 
mu¡
 
be
 
em¶oyed
.

156 
Beÿu£
 
´oûs£s
 
¬e
 
k”Ãl
 
	`’t™›s
 (
ªd
‡» 
š
 
çù
 
the
 
h—v›¡
 
Úes
),

157 
the
 
numb”
 
of
 
k”Ãl
 
’t™›s
 
wl
 
be
 
©
 
Ëa¡
 
as
 
Ïrge
‡she‚umber of

158 
cÚcu¼’t
 
£ssiÚs
. 
On
 
mo¡
 
sy¡ems
, 
good
 
³rfÜmªû
 
wl
 
nÙ
 
be
 
ach›ved


159 
wh’
 
mÜe
 
thª
 
a
 
ãw
 
hund»d
 
´oûs£s
 
¬e
 
ü—‹d
 
beÿu£
 
of
 
the
 
high


160 
cÚ‹xt
-
sw™chšg
 
ov”h—d
. 
In
 
Ùh”
 
wÜds
, 
MP
 
­¶iÿtiÚs
 
have
 
poÜ
 
lßd


161 
sÿÏb™y
.

162 <
P
>

163 
On
 
the
 
Ùh”
 
hªd
, 
MP
 
­¶iÿtiÚs
 
have
 
v”y
 
good
 
sy¡em
 
sÿÏb™y
, 
beÿu£


164 
no
 
»sourûs
 
¬e
 
sh¬ed
 
amÚg
 
difã»Á
 
´oûs£s
 
ªd
 
th”e
 
is
‚o

165 
synchrÚiz©iÚ
 
ov”h—d
.

166 <
P
>

167 
The
 
A·che
 
Web
 
S”v”
 1.x (<
A
 
HREF
=#»fs1>[
Reã»nû
 1]</A>è
u£s
 
the
 
MP


168 
¬ch™eùu»
 
Ú
 
UNIX
 
sy¡ems
.

169 <
P
>

170 <
A
 
NAME
="MT">

171 <
H4
>2.2 
MuÉi
-
Th»aded
 
Arch™eùu»
</H4>

172 </
A
>

173 <
P
>

174 
In
 
the
 
MuÉi
-
	$Th»aded
 (
MT
è
¬ch™eùu»
, 
muÉË
 
šd•’d’t
 
th»ads


175 
of
 
cÚŒŞ
 
¬e
 
em¶oyed
 
w™hš
 
a
 
sšgË
 
sh¬ed
 
add»ss
 
¥aû
. 
Like
‡

176 
´oûss
 
š
 
the
 
MP
 
¬ch™eùu»
, 
—ch
 
th»ad
 
³rfÜms
 
®l
 
of
 
a


177 
Œª§ùiÚ
's initialization steps‡nd services‡ connection completely

178 
befÜe
 
movšg
 
Ú
 
to
 
£rviû
 
a
 
Ãw
 
cÚÃùiÚ
.

179 <
P
>

180 
Mªy
 
mod”n
 
UNIX
 
İ”©šg
 
sy¡ems
 
im¶em’t
 
a
 <
I
>
mªy
-
to
-
ãw
</I> 
mod–
 
wh’


181 
m­pšg
 
u£r
-
Ëv–
 
th»ads
 
to
 
k”Ãl
 
’t™›s
. 
In
 
this
 
mod–
, 
ª


182 
¬b™¿ry
 
Ïrge
 
numb”
 
of
 
u£r
-
Ëv–
 
th»ads
 
is
 
muÉËxed
 
Úto
 
a


183 
Ës£r
 
numb”
 
of
 
k”Ãl
 
executiÚ
 
vehişes
. 
K”Ãl
ƒxecution

184 
vehişes
 
¬e
 
®so
 
known
 
as
 <
I
>
vœtu®
 
´oûssÜs
</I>. 
Wh’ev”
 
a
 
u£r
-
Ëv–


185 
th»ad
 
makes
 
a
 
blockšg
 
sy¡em
 
ÿÎ
, 
the
 
k”Ãl
 
executiÚ
 
vehişe
 
™
 
is
 
usšg


186 
wl
 
become
 
blocked
 
š
 
the
 
k”Ãl
. 
If
 
th”e
 
¬e
 
no
 
Ùh”
 
nÚ
-blocked kernel

187 
executiÚ
 
vehişes
 
ªd
 
th”e
 
¬e
 
Ùh”
 
ruÂabË
 
u£r
-
Ëv–
 
th»ads
, 
a
 
Ãw


188 
k”Ãl
 
executiÚ
 
vehişe
 
wl
 
be
 
ü—‹d
 
autom©iÿÎy
. 
This
 
´ev’ts
 
the


189 
­¶iÿtiÚ
 
äom
 
blockšg
 
wh’
 
™
 
ÿn
  
to
 
make
 
u£ful
 
fÜw¬d


190 
´og»ss
.

191 <
P
>

192 
Beÿu£
 
IAs
 
¬e
 
by
 
Çtu»
 
ÃtwÜk
 
I
/
O
 
driv’
, 
®l
 
cÚcu¼’t
 
£ssiÚs
 
block
 
Ú


193 
ÃtwÜk
 
I
/
O
 
©
 
v¬ious
 
pošts
. 
As
 
a
 
»suÉ
, 
the
 
numb”
 
of
 
vœtu®
 
´oûssÜs


194 
ü—‹d
 
š
 
the
 
k”Ãl
 
grows
 
şo£
 
to
h
numb”
 
of
 
u£r
-
Ëv–
 
th»ads


195 (
Ü
 
simuÉªeous
 
cÚÃùiÚs
). 
Wh’
 
this
 
occurs
, 
the
 
mªy
-
to
-
ãw
 
mod–


196 
efãùiv–y
 
deg’”©es
 
to
 
a
 <
I
>
Úe
-to-Úe</I> 
mod–
. 
Agaš
, 
like
 
š


197 
the
 
MP
 
¬ch™eùu»
,h
numb”
 
of
 
k”Ãl
 
executiÚ
 
vehişes
 
is
 
diù©ed
 
by


198 
the
 
numb”
 
of
 
simuÉªeous
 
cÚÃùiÚs
 
¿th”
 
thª
 
by
‚umb” oà
CPUs
. 
This


199 
»duûs
 
ª
 
­¶iÿtiÚ
's†oad scalability. However, because kernelhreads

200 (
lightweight
 
´oûs£s
è
u£
 
ãw”
 
»sourûs
 
ªd
 
¬e
 
mÜe
 
light
-
weight
 
thª


201 
Œad™iÚ®
 
UNIX
 
´oûs£s
, 
ª
 
MT
 
­¶iÿtiÚ
 
should
 
sÿË
 
b‘‹r
 
w™h
 
lßd


202 
thª
 
ª
 
MP
 
­¶iÿtiÚ
.

203 <
P
>

204 
UÃx³ùedly
, 
the
 
sm®l
 
numb”
 
of
 
vœtu®
 
´oûssÜs
 
sh¬šg
h
§me
 
add»ss


205 
¥aû
 
š
 
the
 
MT
 
¬ch™eùu»
 
de¡roys
 
ª
 
­¶iÿtiÚ
's system scalability

206 
beÿu£
 
of
 
cÚ‹ÁiÚ
 
amÚg
 
the
 
th»ads
 
Ú
 
v¬ious
 
locks
. 
Ev’
 
ª


207 
­¶iÿtiÚ
 
™£lf
 
is
 
ÿ»fuÎy


208 
İtimized
 
to
 
avoid
 
lock
 
cÚ‹ÁiÚ
 
¬ound
 
™s
 
own
 
glob®
 
	`d©a
 (
a
 
nÚ
-
ŒivŸl


209 
sk
), 
th”e
 
¬e
 
¡l
 
¡ªd¬d
 
lib¿ry
 
funùiÚs
 
ªd
 
sy¡em
 
ÿÎs


210 
th©
 
u£
 
commÚ
 
»sourûs
 
hidd’
 
äom
 
the
 
­¶iÿtiÚ
. 
FÜ
 
exam¶e
,

211 
Ú
 
mªy
 
¶©fÜms
 
th»ad
 
§ãty
 
of
 
memÜy
 
®loÿtiÚ
 
routšes


212 (<
TT
>
	`m®loc
(3)</TT>, <TT>
	`ä“
(3)</TT>, 
ªd
 
so
 
Ú
è
is
 
ach›ved
 
by
 
usšg
 
a
 
sšgË


213 
glob®
 
lock
. 
AnÙh”
 
exam¶e
 
is
 
a
 
³r
-
´oûss
 
fe
 
desütÜ
 
bË
.

214 
This
 
commÚ
 
»sourû
 
bË
 
is
 
sh¬ed
 
by
 
®l
 
k”Ãl
 
executiÚ
 
vehişes
 
w™hš


215 
the
 
§me
 
´oûss
 
ªd
 
mu¡
 
be
 
´Ùeùed
 
wh’
 
Úe
 
modif›s
 
™
 
vŸ


216 
û¹aš
 
sy¡em
 
	`ÿÎs
 (
such
 
as
 <
TT
>
	`İ’
(2)</TT>, <TT>
	`şo£
(2)</TT>, 
ªd
 
so
 
Ú
).

217 
In
 
add™iÚ
 
to
 
th©
, 
mašššg
 
the
 
ÿches
 
coh”’t


218 
amÚg
 
CPUs
 
Ú
 
muÉroûssÜ
 
sy¡ems
 
hu¹s
 
³rfÜmªû
 
wh’
 
difã»Á
 
th»ads


219 
ruÂšg
 
Ú
 
difã»Á
 
CPUs
 
modify
 
d©a
 
™ems
 oÀ
the
 
§me
 
ÿche
 
lše
.

220 <
P
>

221 
In
 
Üd”
 
to
 
im´ove
 
lßd
 
sÿÏb™y
, 
some
 
­¶iÿtiÚs
 
em¶oy
 
a
 
difã»Á


222 
ty³
 
of
 
MT
 
¬ch™eùu»
: 
they
 
ü—‹
 
Úe
 
Ü
 
mÜe
 
	`th»ad
(
s
è<
I
>
³r
 
sk
</I>

223 
¿th”
 
thª
 
Úe
 
th»ad
 <
I
>
³r
 
cÚÃùiÚ
</I>. 
FÜ
 
exam¶e
, oÃ 
sm®l
 
group


224 
of
 
th»ads
 
may
 
be
 
»¥ÚsibË
 
acû±šg
 
ş›Á
 
cÚÃùiÚs
, 
ªÙh”


225 
»que¡
 
´oûssšg
, 
ªd
 
y‘
 
ªÙh”
 
£rvšg
 
»¥Ú£s
. 
The
 
maš


226 
advªge
 
of
 
this
 
¬ch™eùu»
 
is
 
th©
 
™
 
–imš©es
 
the
 
tight
 
cou¶šg


227 
b‘w“n
 
the
 
numb”
 
of
 
th»ads
 
ªd
‚umb” oà
simuÉªeous
 
cÚÃùiÚs
. 
Howev”
,

228 
š
 
this
 
¬ch™eùu»
, 
difã»Á
 
sk
-
¥ecific
 
th»ad
 
groups
 
mu¡
 
sh¬e
 
commÚ


229 
wÜk
 
queues
 
th©
 
mu¡
 
be
 
´Ùeùed
 
by
 
mutu®
 
exşusiÚ
 
	`locks
 (
a
 
typiÿl


230 
´oduûr
-
cÚsum”
 
´obËm
). 
This
 
adds
 
synchrÚiz©iÚ
 
ov”h—d
 
th©
 
ÿu£s
 
ª


231 
­¶iÿtiÚ
 
to
 
³rfÜm
 
badly
 
Ú
 
muÉroûssÜ
 
sy¡ems
. 
In
 
Ùh”
 
wÜds
, 
š


232 
this
 
¬ch™eùu»
, 
the
 
­¶iÿtiÚ
's system scalability is sacrificed forhe

233 
§ke
 
of
 
lßd
 
sÿÏb™y
.

234 <
P
>

235 
Of
 
cour£
, 
the
 
usu®
 
nightm¬es
 
of
 
th»aded
 
´og¿mmšg
, 
šşudšg
 
d©a


236 
cÜru±iÚ
, 
d—dlocks
, 
ªd
 
¿û
 
cÚd™iÚs
, 
®so
 
make
 
MT
 
	$¬ch™eùu»
 (
š
 
ªy


237 
fÜm
è
nÚ
-
sim¶i¡ic
 
to
 
u£
.

238 <
P
>

240 <
A
 
NAME
="EDSM">

241 <
H4
>2.3 
Ev’t
-
Driv’
 
S‹
 
Machše
 
Arch™eùu»
</H4>

242 </
A
>

243 <
P
>

244 
In
 
the
 
Ev’t
-
Driv’
 
S‹
 
	$Machše
 (
EDSM
è
¬ch™eùu»
, 
a
 
sšgË
 
´oûss


245 
is
 
em¶oyed
 
to
 
cÚcu¼’y
 
´oûss
 
muÉË
 
cÚÃùiÚs
. 
The
 
basics
 
of
 
this


246 
¬ch™eùu»
 
¬e
 
desüibed
 
š
 
Com”
 
ªd
 
S‹v’s


247 <
A
 
HREF
=#»fs2>[
Reã»nû
 2]</A>.

248 
The
 
EDSM
 
¬ch™eùu»
 
³rfÜms
 
Úe
 
basic
 
d©a
-
driv’
 
¡•
 
assocŸ‹d
 
w™h


249 
a
 
·¹icuÏr
 
cÚÃùiÚ
 
©
‡ 
time
, 
thus
 
muÉËxšg
 
mªy
 
cÚcu¼’t


250 
cÚÃùiÚs
. 
The
 
´oûss
 
İ”©es
 
as
 
a
 
¡©e
 
machše
 
th©
 
»ûives
 
ª
 
ev’t


251 
ªd
 
th’
 
»aùs
 
to
 
™
.

252 <
P
>

253 
In
 
the
 
idË
 
¡©e
h
EDSM
 
ÿÎs
 <
TT
>
	`£Ëù
(2)</TT> 
Ü
 <TT>
	`pŞl
(2)</TT> 
to


254 
wa™
 
ÃtwÜk
 
I
/
O
 
ev’ts
. 
Wh’
 
a
 
·¹icuÏr
 
fe
 
desütÜ
 
is
 
»ady
 

255 
I
/
O
, 
the
 
EDSM
 
com¶‘es
h
cÜ»¥Údšg
 
basic
 
	$¡•
 (
usu®ly
 
by
 
švokšg
 
a


256 
hªdËr
 
funùiÚ
è
ªd
 
¡¬ts
 
the
 
Ãxt
 
Úe
. 
This
 
¬ch™eùu»
 
u£s


257 
nÚ
-
blockšg
 
sy¡em
 
ÿÎs
 
to
 
³rfÜm
 
asynchrÚous
 
ÃtwÜk
 
I
/
O
 
İ”©iÚs
.

258 
FÜ
 
mÜe
 
d‘as
 
Ú
 
nÚ
-
blockšg
 
I
/
O
 
£e
 
S‹v’s


259 <
A
 
HREF
=#»fs3>[
Reã»nû
 3]</A>.

260 <
P
>

261 
To
 
ke
 
advªge
 
of
 
h¬dw¬e
 
	`·¿Î–ism
 (
»®
 
cÚcu¼’cy
), 
muÉË


262 
id’tiÿl
 
´oûs£s
 
may
 
be
 
ü—‹d
. 
This
 
is
 
ÿÎed
 
Symm‘ric
 
MuÉi
-
Proûss


263 
EDSM
 
ªd
 
is
 
u£d
, 
exam¶e
, 
š
 
the
 
Zeus
 
Web
 
S”v”


264 (<
A
 
HREF
=#»fs4>[
Reã»nû
 4]</A>). 
To
 
mÜe
 
effic›Ály
 
muÉËx
 
disk
 
I
/
O
,

265 
¥ecŸl
 "h–³r" 
´oûs£s
 
may
 
be
 
ü—‹d
. 
This
 
is
 
ÿÎed
 
Asymm‘ric


266 
MuÉi
-
Proûss
 
EDSM
 
ªd
 
was
 
´İo£d
 
Web
 
£rv”s
 
by
 
Drusch–


267 
ªd
 
Ùh”s
 <
A
 
HREF
=#»fs5>[
Reã»nû
 5]</A>.

268 <
P
>

269 
EDSM
 
is
 
´obably
 
the
 
mo¡
 
sÿÏbË
 
¬ch™eùu»
 
IAs
.

270 
Beÿu£
 
the
 
numb”
 
of
 
simuÉªeous
 
	$cÚÃùiÚs
 (
vœtu®
 
cÚcu¼’cy
è
is


271 
com¶‘–y
 
decou¶ed
 
äom
 
the
 
numb”
 
of
 
k”Ãl
 
executiÚ
 
	`vehişes
 (
´oûs£s
),

272 
this
 
¬ch™eùu»
 
has
 
v”y
 
good
 
lßd
 
sÿÏb™y
. 
It
 
»quœes
 
Úly
 
mšim®


273 
u£r
-
Ëv–
 
»sourûs
 
to
 
ü—‹
 
ªd
 
mašš
 
add™iÚ®
 
cÚÃùiÚ
.

274 <
P
>

275 
Like
 
MP
 
­¶iÿtiÚs
, 
MuÉi
-
Proûss
 
EDSM
 
has
 
v”y
 
good
 
sy¡em
 
sÿÏb™y


276 
beÿu£
 
no
 
»sourûs
 
¬e
 
sh¬ed
 
amÚg
 
difã»Á
 
´oûs£s
 
ªd
 
th”e
 
is
‚o

277 
synchrÚiz©iÚ
 
ov”h—d
.

278 <
P
>

279 
UnfÜtuÇ‹ly
, 
the
 
EDSM
 
¬ch™eùu»
 
is
 
mÚŞ™hic
 
¿th”
 
thª
 
ba£d
 
Ú
he

280 
cÚû±
 
of
 
th»ads
, 
so
 
Ãw
 
­¶iÿtiÚs
 
g’”®ly
 
Ãed
 
to
 
be
 
im¶em’‹d
 
äom


281 
the
 
ground
 
up
. 
In
 
efãù
,h
EDSM
 
¬ch™eùu»
 
simuÏ‹s
 
th»ads
 
ªd
 
theœ


282 
¡acks
 
the
 
h¬d
 
way
.

283 <
P
>

285 <
A
 
NAME
="ST">

286 <
H3
>3. 
S‹
 
Th»ads
 
Lib¿ry
</H3>

287 </
A
>

288 <
P
>

289 
The
 
S‹
 
Th»ads
 
lib¿ry
 
combšes
 
the
 
advªges
 
of
 
®l
 oàth
above


290 
¬ch™eùu»s
. 
The
 
š‹rçû
 
´e£rves
 
the
 
´og¿mmšg
 
sim¶ic™y
 
of
 
th»ad


291 
ab¡¿ùiÚ
, 
®lowšg
 
—ch
 
simuÉªeous
 
cÚÃùiÚ
 
to
 
be
 
Œ—‹d
 
as
 
a
 
£·¿‹


292 
th»ad
 
of
 
executiÚ
 
w™hš
 
a
 
sšgË
 
´oûss
. 
The
 
und”lyšg
 
im¶em’tiÚ
 
is


293 
şo£
 
to
 
the
 
EDSM
 
¬ch™eùu»
 
as
h
¡©e
 
of
 
—ch
 
·¹icuÏr
 
cÚcu¼’t


294 
£ssiÚ
 
is
 
§ved
 
š
 
a
 
£·¿‹
 
memÜy
 
£gm’t
.

295 <
P
>

297 <
H4
>3.1 
S‹
 
Chªges
 
ªd
 
Schedulšg
</H4>

298 <
P
>

299 
The
 
¡©e
 
of
 
—ch
 
cÚcu¼’t
 
£ssiÚ
 
šşudes
 
™s
 
¡ack
 
’vœÚm’t


300 (
¡ack
 
poš‹r
, 
´og¿m
 
couÁ”
, 
CPU
 
»gi¡”s
è
ªd
 
™s
 sck. 
CÚû±u®ly
,

301 
a
 
th»ad
 
cÚ‹xt
 
ÿn
 
be
 
v›wed
 
as
‡ 
´oûss
 
chªgšg
 
™s
 
¡©e
. 
Th”e


302 
¬e
 
no
 
k”Ãl
 
’t™›s
 
švŞved
 
Ùh”
 
thª
 
´oûs£s
.

303 
UÆike
 
Ùh”
 
g’”®
-
pu½o£
 
th»adšg
 
lib¿r›s
, 
the
 
S‹
 
Th»ads
 
lib¿ry


304 
is
 
fuÎy
 
d‘”mši¡ic
. 
The
 
th»ad
 
cÚ‹xt
 
´oûss
 
¡©e
 
chªge
è
ÿn


305 
Úly
 
h­³n
 
š
 
a
 
w–l
-
known
 
£t
 
of
 
	`funùiÚs
 (
©
 
I
/
O
 
pošts
 
Ü
‡ˆ
ex¶ic™


306 
synchrÚiz©iÚ
 
pošts
). 
As
 
a
 
»suÉ
, 
´oûss
-
¥ecific
 
glob®
 
d©a
 
dÛs
 
nÙ


307 
have
 
to
 
be
 
´Ùeùed
 
by
 
mutu®
 
exşusiÚ
 
locks
 
š
 
mo¡
 
ÿ£s
. 
The
 
’tœe


308 
­¶iÿtiÚ
 
is
 
ä“
 
to
 
u£
 
®l
 
the
 
v¬ŸbËs
 
ªd
 
nÚ
-
»’Œªt
 
lib¿ry


309 
funùiÚs
 
™
 
wªts
, 
g»©ly
 
sim¶ifyšg
 
´og¿mmšg
 
ªd
 
debuggšg
 

310 
šü—sšg
 
³rfÜmªû
. 
This
 
is
 
somewh©
 
sim¬
 
to
 
a
 <
I
>
co
-
routše
</I> 
mod–


311 (
co
-
İ”©iv–y
 
muÉ™asked
 
th»ads
), 
exû±
 
th©
 
no
 
ex¶ic™
 
y›ld
 
is
 
Ãeded


313 
soÚ”
 
Ü
 
Ï‹r
, 
a
 
th»ad
 
³rfÜms
‡ 
blockšg
 
I
/
O
 
İ”©iÚ
 
ªd
 
thus
 
su¼’d”s


314 
cÚŒŞ
. 
AÎ
 
th»ads
 
of
 
	$executiÚ
 (
simuÉªeous
 
cÚÃùiÚs
è
have
 
the


315 
§me
 
´iÜ™y
, 
so
 
schedulšg
 
is
 
nÚ
-
´“m±ive
, 
like
 
š
 
the
 
EDSM
 
¬ch™eùu»
.

316 
Beÿu£
 
IAs
 
¬e
 
d©a
-
	`driv’
 (
´oûssšg
 
is
 
lim™ed
 
by
 
the
 
size
 
of
 
ÃtwÜk


317 
bufãrs
 
ªd
 
d©a
 
¬riv®
 
¿‹s
), 
schedulšg
 
is
 
nÚ
-
time
-
¦icšg
.

318 <
P
>

319 
OÆy
 
two
 
ty³s
 
of
 
ex‹º®
 
ev’ts
 
¬e
 
hªdËd
 
by
 
the
 
lib¿ry
's

320 
scheduËr
, 
beÿu£
 
Úly
 
the£
 
ev’ts
 
ÿn
 
be
 
d‘eùed
 
by


321 <
TT
>
	`£Ëù
(2)</TT> 
Ü
 <TT>
	`pŞl
(2)</TT>: 
I
/
O
 
	`ev’ts
 (
a
 
fe
 
desütÜ
 
is
 
»ady


322 
I
/
O
è
ªd
 
time
 
ev’ts


323 (
some
 
timeout
 
has
 
expœed
). 
Howev”
, 
Ùh”
 
ty³s
 
of
 
	$ev’ts
 (
such
 
as


324 
a
 
sigÇl
 
£Á
 
to
‡ 
´oûss
è
ÿn
 
®so
 
be
 
hªdËd
 
by
 
cÚv”tšg
 
them
Ø
I
/
O


325 
ev’ts
. 
FÜ
 
exam¶e
, 
a
 
sigÇl
 
hªdlšg
 
funùiÚ
 
ÿn
 
³rfÜm
‡ 
wr™e
 
to
‡ 
pe


326 (<
TT
>
	`wr™e
(2)</TT> 
is
 
»’Œªt
/
asynchrÚous
-
§ã
), 
thus
 
cÚv”tšg
 
a
 
sigÇl


327 
ev’t
 
to
 
ª
 
I
/
O
ƒvent.

328 <
P
>

329 
To
 
ke
 
advªge
 
of
 
h¬dw¬e
 
·¿Î–ism
, 
as
 
š
 
the
 
EDSM
 
¬ch™eùu»
,

330 
muÉË
 
´oûs£s
 
ÿn
 
be
 
ü—‹d
 
š
 
e™h”
 
a
 
symm‘ric
 
Ü
 
asymm‘ric
 
mªÃr
.

331 
Proûss
 
mªagem’t
 
is
 
nÙ
 
š
 
the
 
lib¿ry
's scope but instead is†eft upohe

332 
­¶iÿtiÚ
.

333 <
P
>

334 
Th”e
 
¬e
 
£v”®
 
g’”®
-
pu½o£
 
th»adšg
 
lib¿r›s
 
th©
 
im¶em’t
 
a


335 <
I
>
mªy
-
to
-
Úe
</I> 
	`mod–
 (mªy 
u£r
-
Ëv–
 
th»ads
ØÚ
k”Ãl
 
executiÚ


336 
vehişe
), 
usšg
 
the
 
§me
 
basic
 
‹chniques
 
as
h
S‹
 
Th»ads
 
lib¿ry


337 (
nÚ
-
blockšg
 
I
/
O
, 
ev’t
-
driv’
 
scheduËr
, 
ªd
 
so
 
Ú
). 
FÜ
 
ª
 
exam¶e
, 
£e
 
GNU


338 
PÜbË
 
	`Th»ads
 (<
A
 
HREF
=#»fs6>[
Reã»nû
 6]</A>). 
Beÿu£
 
they
 
¬e


339 
g’”®
-
pu½o£
, 
the£
 
lib¿r›s
 
have
 
difã»Á
 
objeùives
 
thª
 
the
 
S‹


340 
Th»ads
 
lib¿ry
. 
The
 
S‹
 Th»ad lib¿ry 
is
 <
I
>
nÙ
</I> 
a
 
g’”®
-
pu½o£


341 
th»adšg
 
lib¿ry
,

342 
but
 
¿th”
 
ª
 
­¶iÿtiÚ
 
lib¿ry
 
th©
 
rg‘s
 
Úly
 
û¹aš
 
ty³s
 
of


343 
	$­¶iÿtiÚs
 (
IAs
è
š
 
Üd”
 
to
 
ach›ve
 
the
 
highe¡
 
possibË
 
³rfÜmªû
 
ªd


344 
sÿÏb™y
 
tho£
 
­¶iÿtiÚs
.

345 <
P
>

347 <
H4
>3.2 
SÿÏb™y
</H4>

348 <
P
>

349 
S‹
 
th»ads
 
¬e
 
v”y
 
lightweight
 
u£r
-
Ëv–
 
’t™›s
, 
ªd
 
th”efÜe
 
ü—tšg


350 
ªd
 
mašššg
 
u£r
 
cÚÃùiÚs
 
»quœes
 
mšim®
 
»sourûs
. 
An
 
­¶iÿtiÚ


351 
usšg
 
the
 
S‹
 
Th»ads
 
lib¿ry
 
sÿËs
 
v”y
 
w–l
 
w™h
h
šü—sšg
 
numb”


352 
of
 
cÚÃùiÚs
.

353 <
P
>

354 
On
 
muÉroûssÜ
 
sy¡ems
 
ª
 
­¶iÿtiÚ
 
should
 
ü—‹
 
muÉË
 
´oûs£s


355 
to
 
ke
 
advªge
 
of
 
h¬dw¬e
 
·¿Î–ism
. 
Usšg
 
muÉË
 
£·¿‹
 
´oûs£s


356 
is
 
the
 <
I
>
Úly
</I> 
way
 
to
 
ach›ve
h
highe¡
 
possibË
 
sy¡em
 
sÿÏb™y
.

357 
This
 
is
 
beÿu£
 
du¶iÿtšg
 
³r
-
´oûss
 
»sourûs
 i 
the
 
Úly
 
way
 
to
 
avoid


358 
signifiÿÁ
 
synchrÚiz©iÚ
 
ov”h—d
 
Ú
 
muÉroûssÜ
 
sy¡ems
. 
C»©šg


359 
£·¿‹
 
UNIX
 
´oûs£s
 
Çtu¿Îy
 
ofãrs
 
»sourû
 
du¶iÿtiÚ
. 
Agaš
,

360 
as
 
š
 
the
 
EDSM
 
¬ch™eùu»
, 
th”e
 
is
 
no
 
cÚÃùiÚ
 
b‘w“n
h
numb”
 
of


361 
simuÉªeous
 
	$cÚÃùiÚs
 (
which
 
may
 
be
 
v”y
 
Ïrge
 
ªd
 
chªges
 
w™hš
 
a
 
wide


362 
¿nge
è
ªd
 
the
 
numb”
 
of
 
k”Ãl
 
	`’t™›s
 (
which
 
is
 
usu®ly
 
sm®l
‡nd 
cÚ¡ªt
).

363 
In
 
Ùh”
 
wÜds
, 
the
 
S‹
 
Th»ads
 
lib¿ry
 
makes
 
™
 
possibË
 
to
 
muÉËx
 
a


364 
Ïrge
 
numb”
 
of
 
simuÉªeous
 
cÚÃùiÚs
 
Úto
 
a
 
much
 
sm®Ër
‚umber of

365 
£·¿‹
 
´oûs£s
, 
thus
 
®lowšg
 
ª
 
­¶iÿtiÚ
 
to
 
sÿË
 
w–l
 
w™h
 
bÙh


366 
the
 
lßd
 
ªd
 
sy¡em
 
size
.

367 <
P
>

369 <
H4
>3.3 
P”fÜmªû
</H4>

370 <
P
>

371 
P”fÜmªû
 
is
 
Úe
 
of
 
the
 
lib¿ry
's main objectives. The State Threads

372 
lib¿ry
 
is
 
im¶em’‹d
 
to
 
mšimize
 
the
 
numb”
 
of
 
sy¡em
 
ÿÎs
 
ªd


373 
to
 
make
 
th»ad
 
ü—tiÚ
 
ªd
 
cÚ‹xt
 
sw™chšg
 
as
 
ç¡
‡ 
possibË
.

374 
FÜ
 
exam¶e
, 
³r
-
th»ad
 
sigÇl
 
mask
 
dÛs
 
nÙ
 
	`exi¡
 (
uÆike


375 
POSIX
 
th»ads
), 
so
 
th”e
 
is
 
no
 
Ãed
 
to
 
§ve
 
ªd
 
»¡Üe
 
a
 
´oûss
's

376 
sigÇl
 
mask
 
Ú
 
ev”y
 
th»ad
 
cÚ‹xt
 . 
This
 
–imš©es
 
two
 
sy¡em


377 
ÿÎs
 
³r
 
cÚ‹xt
 . 
SigÇl
 
ev’ts
 
ÿn
 
be
 
hªdËd
 
much
 
mÜe


378 
effic›Ály
 
by
 
cÚv”tšg
 
them
 
to
 
I
/
O
 
	`ev’ts
 (
£e
 
above
).

379 <
P
>

381 <
H4
>3.4 
PÜb™y
</H4>

382 <
P
>

383 
The
 
lib¿ry
 
u£s
 
the
 
§me
 
g’”®
, 
und”lyšg
 
cÚû±s
 
as
h
EDSM


384 
¬ch™eùu»
, 
šşudšg
 
nÚ
-
blockšg
 
I
/
O
, 
fe
 
desütÜs
, 
ªd


385 
I
/
O
 
muÉËxšg
. 
The£
 
cÚû±s
 
¬e
 
avaabË
 
š
 
some
 
fÜm
 
Ú
 
mo¡


386 
UNIX
 
¶©fÜms
, 
makšg
 
the
 
lib¿ry
 
v”y
 
pÜbË
 
aüoss
 
mªy


387 
æavÜs
 
of
 
UNIX
. 
Th”e
 
¬e
 
Úly
 
a
 
ãw
 
¶©fÜm
-
d•’d’t
 
£ùiÚs
 
š
 
the


388 
sourû
.

389 <
P
>

391 <
H4
>3.5 
S‹
 
Th»ads
 
ªd
 
NSPR
</H4>

392 <
P
>

393 
The
 
S‹
 
Th»ads
 
lib¿ry
 
is
 
a
 
d”iv©ive
 
of
 
the
 
N‘sÿ³
 
PÜbË


394 
RuÁime
 
	`lib¿ry
 (
NSPR
è<
A
 
HREF
=#»fs7>[
Reã»nû
 7]</A>. 
The
 
´im¬y
 
gßl
 
of


395 
NSPR
 
is
 
to
 
´ovide
 
a
 
¶©fÜm
-
šd•’d’t
 
Ïy”
 
sy¡em
 
çc™›s
,

396 
wh”e
 
sy¡em
 
çc™›s
 
šşude
 
th»ads
, 
th»ad
 
synchrÚiz©iÚ
, 
ªd
 
I
/
O
.

397 
P”fÜmªû
 
ªd
 
sÿÏb™y
 
¬e
 
nÙ
 
the
 
maš
 
cÚûº
 
of
 
NSPR
. 
The


398 
S‹
 
Th»ads
 
lib¿ry
 
add»s£s
 
³rfÜmªû
 
ªd
 
sÿÏb™y
 

399 
»maššg
 
much
 
sm®Ër
 
thª
 
NSPR
. 
It
 
is
 
cÚšed
 
š
 8 
sourû
 
fes


400 
as
 
İpo£d
 
to
 
mÜe
 
thª
 400, 
but
 
´ovides
 
®l
 
the
 
funùiÚ®™y
 
th©


401 
is
 
Ãeded
 
to
 
wr™e
 
effic›Á
 
IAs
 
Ú
 
UNIX
-
like
 
¶©fÜms
.

402 <
P
>

404 <
TABLE
 
CELLPADDING
=3>

405 <
TR
>

406 <
TD
></TD>

407 <
TH
>
NSPR
</TH>

408 <
TH
>
S‹
 
Th»ads
</TH>

409 </
TR
>

410 <
TR
>

411 <
TD
><
B
>
Lšes
 
of
 
code
</B></TD>

412 <
TD
 
ALIGN
=
RIGHT
>~150,000</TD>

413 <
TD
 
ALIGN
=
RIGHT
>~3000</TD>

414 </
TR
>

415 <
TR
>

416 <
TD
><
B
>
DyÇmic
 
lib¿ry
 
size
&
nb¥
;&nb¥;<
BR
>(
debug
 
v”siÚ
)</B></TD>

417 <
TD
></TD>

418 <
TD
></TD>

419 </
TR
>

420 <
TR
>

421 <
TD
>
IRIX
</TD>

422 <
TD
 
ALIGN
=
RIGHT
>~700 
KB
</TD>

423 <
TD
 
ALIGN
=
RIGHT
>~60 
KB
</TD>

424 </
TR
>

425 <
TR
>

426 <
TD
>
Lšux
</TD>

427 <
TD
 
ALIGN
=
RIGHT
>~900 
KB
</TD>

428 <
TD
 
ALIGN
=
RIGHT
>~70 
KB
</TD>

429 </
TR
>

430 </
TABLE
>

431 <
P
>

433 <
H3
>
CÚşusiÚ
</H3>

434 <
P
>

435 
S‹
 
Th»ads
 
is
 
ª
 
­¶iÿtiÚ
 
lib¿ry
 
which
 
´ovides
 
a
 
found©iÚ
 

436 
wr™šg
 <
A
 
HREF
=#IA>
IÁ”Ãt
 
AµliÿtiÚs
</A>. 
To
 
summ¬ize
, 
™
 
has
 
the


437 
fŞlowšg
 <
I
>
advªges
</I>:

438 <
P
>

439 <
UL
>

440 <
LI
>
It
 
®lows
 
the
 
design
 
of
 
ç¡
 
ªd
 
highly
 
sÿÏbË
 
­¶iÿtiÚs
. 
An


441 
­¶iÿtiÚ
 
wl
 
sÿË
 
w–l
 
w™h
 
bÙh
 
lßd
 
ªd
 
numb”
 
of
 
CPUs
.

442 <
P
>

443 <
LI
>
It
 
g»©ly
 
sim¶if›s
 
­¶iÿtiÚ
 
´og¿mmšg
 
ªd
 
debuggšg
 
beÿu£
, 
as
 
a


444 
ruË
, 
no
 
mutu®
 
exşusiÚ
 
lockšg
 
is
 
Ãûs§ry
 
ªd
 
the
 
’tœe
 
­¶iÿtiÚ
 is

445 
ä“
 
to
 
u£
 
v¬ŸbËs
 
ªd
 
nÚ
-
»’Œªt
 
lib¿ry
 
funùiÚs
.

446 </
UL
>

447 <
P
>

448 
The
 
lib¿ry
's main <I>limitation</I>:

449 <
P
>

450 <
UL
>

451 <
LI
>
AÎ
 
I
/
O
 
İ”©iÚs
 
Ú
 
sock‘s
 
mu¡
 
u£
 
the
 
S‹
 
Th»ad
 
lib¿ry
's I/O

452 
funùiÚs
 
beÿu£
 
Úly
 
tho£
 funùiÚ 
³rfÜm
 
th»ad
 
schedulšg
 
ªd
 
´ev’t


453 
the
 
­¶iÿtiÚ
's…rocesses from blocking.

454 </
UL
>

455 <
P
>

457 <
H3
>
Reã»nûs
</H3>

458 <
OL
>

459 <
A
 
NAME
="refs1">

460 <
LI
> 
A·che
 
Soáw¬e
 
Found©iÚ
,

461 <
A
 
HREF
="h‰p://www.­ache.Üg">
h‰p
:

462 <
A
 
NAME
="refs2">

463 <
LI
> 
DougÏs
 
E
. 
Com”
, 
David
 
L
. 
S‹v’s
, <
I
>
IÁ”ÃtwÜkšg
 
W™h
 
TCP
/
IP
,

464 
VŞ
. 
III
: 
Cl›Á
-
S”v”
 
Prog¿mmšg
 
And
 
AµliÿtiÚs
</
I
>, 
SecÚd
 
Ed™iÚ
,

465 
Ch
. 8, 12.

466 <
A
 
NAME
="refs3">

467 <
LI
> 
W
. 
Rich¬d
 
S‹v’s
, <
I
>
UNIX
 
N‘wÜk
 
Prog¿mmšg
</I>, 
SecÚd
 
Ed™iÚ
,

468 
VŞ
. 1, 
Ch
. 15.

469 <
A
 
NAME
="refs4">

470 <
LI
> 
Zeus
 
TechnŞogy
 
Lim™ed
,

471 <
A
 
HREF
="h‰p://www.zeus.co.uk/">
h‰p
:

472 <
A
 
NAME
="refs5">

473 <
LI
> 
P‘”
 
Drusch–
, 
Vivek
 
S
. 
Pai
, 
Wly
 
Zw«ÃpÛl
,

474 <
A
 
HREF
="http://www.cs.rice.edu/~druschel/usenix99flash.ps.gz">

475 
FÏsh
: 
An
 
Effic›Á
 
ªd
 
PÜbË
 
Web
 
S”v”
</
A
>. 
In
 <
I
>
Proûedšgs
 
of
 
the


476 
USENIX
 1999 
AÂu®
 
Techniÿl
 
CÚã»nû
</
I
>, 
MÚ‹»y
, 
CA
, 
JuÃ
 1999.

477 <
A
 
NAME
="refs6">

478 <
LI
> 
GNU
 
PÜbË
 
Th»ads
,

479 <
A
 
HREF
="h‰p://www.gnu.Üg/soáw¬e/±h/">
h‰p
:

480 <
A
 
NAME
="refs7">

481 <
LI
> 
N‘sÿ³
 
PÜbË
 
RuÁime
,

482 <
A
 
HREF
="h‰p://www.mozÏ.Üg/docs/»fLi¡/»fNSPR/">
h‰p
:

483 </
OL
>

485 <
H3
>
Oth”
 
»sourûs
 
cov”šg
 
v¬ious
 
¬ch™eùu¿l
 
issues
 
š
 
IAs
</H3>

486 <
OL
 
START
=8>

487 <
LI
> 
Dª
 
Keg–
, <
I
>
The
 
C10K
 
´obËm
</I>,

488 <
A
 
HREF
="h‰p://www.keg–.com/c10k.html">
h‰p
:

489 </
LI
>

490 <
LI
> 
James
 
C
. 
Hu
, 
DougÏs
 C. 
Schmidt
, 
Irçn
 
Py¬®i
, <
I
>
JAWS
: 
Und”¡ªdšg


491 
High
 
P”fÜmªû
 
Web
 
Sy¡ems
</
I
>,

492 <
A
 
HREF
="h‰p://www.cs.wu¡l.edu/~jxh/»£¬ch/»£¬ch.html">
h‰p
:

493 </
OL
>

494 <
P
>

495 <
HR
>

496 <
P
>

498 <
CENTER
><
FONT
 
SIZE
=-1>
PÜtiÚs
 
ü—‹d
 
by
 
SGI
 
¬e
 
Cİyright
 &
cİy
; 2000

499 
SicÚ
 
G¿phics
, 
Inc
. 
AÎ
 
rights
 
»£rved
.</
FONT
></
CENTER
>

500 <
P
>

502 </
BODY
>

503 </
HTML
>

	@trunk/objs/st-1.9/osguess.sh

1 #
#Thi 
süt
 
ÿn
 
be
 
u£d
 
to
 
autom©iÿÎy
 
guess
 
rg‘
 
OS
.

2 #Iˆ
»quœes
 
the
 
cÚfig
.
guess
 
ut™y
 
which
 
is
 
a
 
·¹
 
of
 
GNU
 
AutocÚf
.

3 #GNU 
AutocÚf
 
ÿn
 
be
 
dowÆßded
 
äom
 
áp
:

4 #
#U£ "deçuÉ" 
as
 
a
 
make
 
rg‘
 
autom©ic
 
buds
.

7 #S³cify 
·th
 
to
 
the
 
cÚfig
.
guess
 
ut™y
 (
uÆess
 
£t
 
vŸ
 
’vœÚm’t
)

11 [ 
x
"$CONFIG_GUESS_PATH" = x ]; 
th’


12 
	gecho
 "Error: CONFIG_GUESS_PATH variable is‚ot set"

13 
	gex™
 1

14 
fi


16 [ ! -
f
 "$CONFIG_GUESS_PATH/cÚfig.guess" ]; 
th’


17 
	gecho
 "Can't find $CONFIG_GUESS_PATH/config.guess utility. Wrong…ath?"

18 
	gex™
 1

19 
fi


21 
	gsys_šfo
=`/
bš
/
sh
 
$CONFIG_GUESS_PATH
/
cÚfig
.
guess
`

23 
echo
 "Building for $sys_info"

25 "$sys_šfo" 
š


26 *-
ibm
-
aix4
* ) 
OS
=
AIX
 ;;

27 *-
	gä“bsd
* ) 
	gOS
=
FREEBSD
 ;;

28 
	ghµa
*-
	ghp
-
	ghpux11
*è
	gOS
=
HPUX
 ;;

29 *-
	gsgi
-
	gœix6
* ) 
	gOS
=
IRIX
 ;;

30 *-
	glšux
* ) 
	gOS
=
LINUX
 ;;

31 *-
	gÃtbsd
* ) 
	gOS
=
NETBSD
 ;;

32 *-
	gİ’bsd
* ) 
	gOS
=
OPENBSD
 ;;

33 *-
	gdec
-
	gosf
* ) 
	gOS
=
OSF1
 ;;

34 *-
	gsŞ¬is2
* ) 
	gOS
=
SOLARIS
 ;;

35 *-
	gd¬wš
* ) 
	gOS
=
DARWIN
 ;;

36 * ) 
	gOS
=

37 
echo
 "Sorry, unsupported OS"

38 
ex™
 1 ;;

39 
e§c


41 
	gecho
 "Making with OS=$OS"

	@trunk/research/api-server/server.py

1 #!/
u¤
/
bš
/
pythÚ


3 
The
 
MIT
 
	$Liûn£
 (
MIT
)

5 
	`Cİyright
 (
c
è2013-2015 
	$SRS
(
os¤s
)

7 
P”missiÚ
 
is
 
h”eby
 
g¿Áed
, 
ä“
 
of
 
ch¬ge
, 
to
 
ªy
 
³rsÚ
 
obššg
 
a
 
cİy
 of

8 
this
 
soáw¬e
 
ªd
 
assocŸ‹d
 
docum’tiÚ
 
	`fes
 (
the
 "Soáw¬e"), 
to
 
d—l
 
š


9 
the
 
Soáw¬e
 
w™hout
 
»¡riùiÚ
, 
šşudšg
 w™houˆ
lim™©iÚ
h
rights
 
to


10 
u£
, 
cİy
, 
modify
, 
m”ge
, 
publish
, 
di¡ribu‹
, 
subliûn£
, 
ªd
/
Ü
 
£Î
 
cİ›s
 
of


11 
the
 
Soáw¬e
, 
ªd
 
to
 
³rm™
 
³rsÚs
Ø
whom
hSoáw¬
is
 
fuºished
ØdØ
so
,

12 
subjeù
 
to
 
the
 
fŞlowšg
 
cÚd™iÚs
:

14 
The
 
above
 
cİyright
 
nÙiû
 
ªd
 
this
 
³rmissiÚ
‚Ùiû 
sh®l
 
be
 
šşuded
 
š
 
®l


15 
cİ›s
 
Ü
 
sub¡ªtŸl
 
pÜtiÚs
 
of
 
the
 
Soáw¬e
.

17 
THE
 
SOFTWARE
 
IS
 
PROVIDED
 "AS IS", 
WITHOUT
 
WARRANTY
 
OF
 
ANY
 
KIND
, 
EXPRESS
 
OR


18 
IMPLIED
, 
INCLUDING
 
BUT
 
NOT
 
LIMITED
 
TO
 
THE
 
WARRANTIES
 
OF
 
MERCHANTABILITY
, 
FITNESS


19 
FOR
 
A
 
PARTICULAR
 
PURPOSE
 
AND
 
NONINFRINGEMENT
. 
IN
 
NO
 
EVENT
 
SHALL
 
THE
 
AUTHORS
 
OR


20 
COPYRIGHT
 
HOLDERS
 
BE
 
LIABLE
 
FOR
 
ANY
 
CLAIM
, 
DAMAGES
 
OR
 
OTHER
 
LIABILITY
, 
WHETHER


21 
IN
 
AN
 
ACTION
 
OF
 
CONTRACT
, 
TORT
 
OR
 
OTHERWISE
, 
ARISING
 
FROM
, 
OUT
 OF OR IN

22 
CONNECTION
 
WITH
 
THE
 
SOFTWARE
 
OR
 THE 
USE
 OR 
OTHER
 
DEALINGS
 
IN
 THE SOFTWARE.

26 
the
 
­i
-
£rv”
 
is
 
a
  
demo
 s”v” 
¤s
 
to
 
ÿÎ


27 
wh’
 
¤s
 
g‘
 
some
 
ev’t
, 
exam¶e
, wh’ 
ş›Á
 
cÚÃù


28 
to
 
¤s
, sr 
ÿn
 
švoke
 
the
 
h‰p
 
­i
 
of
h­i-
£rv”


31 
impÜt
 
sys


32 #»lßd 
sys
 
mod–
 
to
 
’abË
 
the
 
g‘deçuÉ’codšg
 
m‘hod
.

33 
	$»lßd
(
sys
)

34 #£ˆ
the
  
’codšg
 
to
 
utf
-8

35 #usšg 
exec
 
to
 
£t
 
the
 
’codšg
,Ø
avoid
 
”rÜ
 
š
 
IDE
.

36 
	`exec
("sys.setdefaultencoding('utf-8')")

37 
as£¹
 
sys
.
	`g‘deçuÉ’codšg
().
	`low”
() == "utf-8"

39 
impÜt
 
os
, 
jsÚ
, 
time
, 
d©‘ime
, 
ch”rypy
, 
th»adšg
, 
u¾lib2


41 #sim¶
log
 
funùiÚs
.

42 
def
 
	$Œaû
(
msg
):

43 
d©e
 = 
d©‘ime
.d©‘ime.
	`now
().
	`¡ráime
("%Y-%m-%d %H:%M:%S")

44 
´št
 "[%s][Œaû] %s"%(
d©e
, 
msg
)

46 #’abË 
üossdomaš
 
acûss
 
js
-
ş›Á


47 
	#the
 
fŞlowšg
 
m‘hod
:

	)

48 #deà
	`OPTIONS
(
£lf
, *
¬gs
, **
kw¬gs
)

50 #švok
this
 
m‘hod
 
to
 
’abË
 
js
Ø
»que¡
 
üossdomaš
.

51 
def
 
	$’abË_üossdomaš
():

52 
ch”rypy
.
»¥Ú£
.
h—d”s
["Access-Control-Allow-Origin"] = "*"

53 
ch”rypy
.
»¥Ú£
.
h—d”s
["Access-Control-Allow-Methods"] = "GET, POST, HEAD, PUT, DELETE"

54 #g’”©
®low
 
h—d”s
 
üossdomaš
.

55 
®low_h—d”s
 = ["Cache-Control", "X-Proxy-Authorization", "X-Requested-With", "Content-Type"]

56 
ch”rypy
.
»¥Ú£
.
h—d”s
["Acûss-CÚŒŞ-AÎow-H—d”s"] = ",".
	$još
(
®low_h—d”s
)

58 #”rÜ 
codes
 
defš™iÚ


59 
şass
 
E¼Ü
:

60 #ok, 
sucûss
, 
com¶‘ed
.

61 
sucûss
 = 0

62 #”rÜ 
wh’
 
·r£
 
jsÚ


63 
sy¡em_·r£_jsÚ
 = 100

64 #»que¡ 
aùiÚ
 
šv®id


65 
»que¡_šv®id_aùiÚ
 = 200

66 #cdÀ
node
 
nÙ
 
exi¡s


67 
cdn_node_nÙ_exi¡s
 = 201

70 
hªdË
 
the
 
ş›Ás
 
»que¡s
: 
cÚÃù
/
discÚÃù
 
vho¡
/
­p
.

72 
şass
 
	$RESTCl›Ás
(
objeù
):

73 
expo£d
 = 
True


75 
def
 
	$GET
(
£lf
):

76 
	$’abË_üossdomaš
()

78 
ş›Ás
 = {
	}
}

79  
jsÚ
.
dumps
(
ş›Ás
)

82 
SRS
 
hook
: 
Ú_cÚÃù
/
Ú_şo£


83 
Ú_cÚÃù
:

84 
wh’
 
ş›Á
 
cÚÃù
 
to
 
vho¡
/
­p
, 
ÿÎ
 
the
 
	ghook
,

85 
the
 
»que¡
 
š
h
POST
 
d©a
 
¡ršg
 
is
 
a
 
objeù
 
’code
 
by
 
	gjsÚ
:

93 
Ú_şo£
:

94 
wh’
 
ş›Á
 
şo£
/
discÚÃù
 
to
 
vho¡
/
­p
/
¡»am
, 
ÿÎ
 
the
 
	ghook
,

95 
the
 
»que¡
 
š
h
POST
 
d©a
 
¡ršg
 
is
 
a
 
objeù
 
’code
 
by
 
	gjsÚ
:

102 
v®id
, 
the
 
hook
 
mu¡
  
HTTP
 
	gcode
 200(
Suts
 
	gOK
è
ªd
 
»¥Ú£


103 
ª
 
v®ue
 
¥ecif›s
 
the
 
”rÜ
 
	$code
(0 
cÜ»¥Údšg
 
to
 
sucûss
):

106 
def
 
	$POST
(
£lf
):

107 
	$’abË_üossdomaš
()

109 #»tuº 
the
 
”rÜ
 
code
 
š
 
¡r


110 
code
 = 
E¼Ü
.
sucûss


112 
»q
 = 
ch”rypy
.
»que¡
.
body
.
	$»ad
()

113 
	`Œaû
("po¡Øş›Ás,„eq=%s"%(
»q
))

114 
Œy
:

115 
jsÚ_»q
 = 
jsÚ
.
	$lßds
(
»q
)

116 
exû±
 
Exû±iÚ
, 
ex
:

117 
code
 = 
E¼Ü
.
sy¡em_·r£_jsÚ


118 
	`Œaû
("·r£h»que¡ØjsÚ faed,„eq=%s,ƒx=%s, code=%s"%(
»q
, 
ex
, 
code
))

119  
	$¡r
(
code
)

121 
aùiÚ
 = 
jsÚ_»q
["action"]

122 
aùiÚ
 == "on_connect":

123 
code
 = 
£lf
.
	$__Ú_cÚÃù
(
jsÚ_»q
)

124 
–if
 
aùiÚ
 == "on_close":

125 
code
 = 
£lf
.
	$__Ú_şo£
(
jsÚ_»q
)

127 
	`Œaû
("šv®id„eque¡‡ùiÚ: %s"%(
jsÚ_»q
["action"]))

128 
code
 = 
E¼Ü
.
»que¡_šv®id_aùiÚ


130  
	$¡r
(
code
)

132 
def
 
	$OPTIONS
(
£lf
, *
¬gs
, **
kw¬gs
):

133 
	$’abË_üossdomaš
()

135 
def
 
	$__Ú_cÚÃù
(
£lf
, 
»q
):

136 
code
 = 
E¼Ü
.
sucûss


138 
	`Œaû
("srs %s: client id=%s, ip=%s, vhost=%s,‡pp=%s,cUrl=%s,…ageUrl=%s"%(

139 
»q
["action"],„eq["client_id"],„eq["ip"],„eq["vhost"],„eq["app"],„eq["tcUrl"],„eq["pageUrl"]

142 #TODO: 
´oûss
 
the
 
Ú_cÚÃù
 
ev’t


144  
code


146 
def
 
	$__Ú_şo£
(
£lf
, 
»q
):

147 
code
 = 
E¼Ü
.
sucûss


149 
	`Œaû
("srs %s: client id=%s, ip=%s, vhost=%s,‡pp=%s, send_bytes=%s,„ecv_bytes=%s"%(

150 
»q
["action"],„eq["client_id"],„eq["ip"],„eq["vhost"],„eq["app"],„eq["send_bytes"],„eq["recv_bytes"]

153 #TODO: 
´oûss
 
the
 
Ú_şo£
 
ev’t


155  
code


158 
hªdË
 
the
 
¡»ams
 
»que¡s
: 
publish
/
uÅublish
 
¡»am
.

160 
şass
 
	$RESTSŒ—ms
(
objeù
):

161 
expo£d
 = 
True


163 
def
 
	$GET
(
£lf
):

164 
	$’abË_üossdomaš
()

166 
¡»ams
 = {
	}
}

167  
jsÚ
.
dumps
(
¡»ams
)

170 
SRS
 
hook
: 
Ú_publish
/
Ú_uÅublish


171 
Ú_publish
:

172 
wh’
 
	$ş›Á
(
’cod”
è
publish
 
to
 
vho¡
/
­p
/
¡»am
, 
ÿÎ
 
the
 
hook
,

173 
the
 
»que¡
 
š
h
POST
 
d©a
 
¡ršg
 
is
 
a
 
objeù
 
’code
 
by
 
jsÚ
:

179 
	}
}

180 
Ú_uÅublish
:

181 
wh’
 
	$ş›Á
(
’cod”
è
¡İ
 
publish
 
to
 
vho¡
/
­p
/
¡»am
, 
ÿÎ
 
the
 
hook
,

182 
the
 
»que¡
 
š
h
POST
 
d©a
 
¡ršg
 
is
 
a
 
objeù
 
’code
 
by
 
jsÚ
:

188 
	}
}

189 
v®id
, 
the
 
hook
 
mu¡
  
HTTP
 
	gcode
 200(
Suts
 
	gOK
è
ªd
 
»¥Ú£


190 
ª
 
v®ue
 
¥ecif›s
 
the
 
”rÜ
 
	$code
(0 
cÜ»¥Údšg
 
to
 
sucûss
):

193 
def
 
	$POST
(
£lf
):

194 
	$’abË_üossdomaš
()

196 #»tuº 
the
 
”rÜ
 
code
 
š
 
¡r


197 
code
 = 
E¼Ü
.
sucûss


199 
»q
 = 
ch”rypy
.
»que¡
.
body
.
	$»ad
()

200 
	`Œaû
("po¡Ø¡»ams,„eq=%s"%(
»q
))

201 
Œy
:

202 
jsÚ_»q
 = 
jsÚ
.
	$lßds
(
»q
)

203 
exû±
 
Exû±iÚ
, 
ex
:

204 
code
 = 
E¼Ü
.
sy¡em_·r£_jsÚ


205 
	`Œaû
("·r£h»que¡ØjsÚ faed,„eq=%s,ƒx=%s, code=%s"%(
»q
, 
ex
, 
code
))

206  
	$¡r
(
code
)

208 
aùiÚ
 = 
jsÚ_»q
["action"]

209 
aùiÚ
 == "on_publish":

210 
code
 = 
£lf
.
	$__Ú_publish
(
jsÚ_»q
)

211 
–if
 
aùiÚ
 == "on_unpublish":

212 
code
 = 
£lf
.
	$__Ú_uÅublish
(
jsÚ_»q
)

214 
	`Œaû
("šv®id„eque¡‡ùiÚ: %s"%(
jsÚ_»q
["action"]))

215 
code
 = 
E¼Ü
.
»que¡_šv®id_aùiÚ


217  
	$¡r
(
code
)

219 
def
 
	$OPTIONS
(
£lf
, *
¬gs
, **
kw¬gs
):

220 
	$’abË_üossdomaš
()

222 
def
 
	$__Ú_publish
(
£lf
, 
»q
):

223 
code
 = 
E¼Ü
.
sucûss


225 
	`Œaû
("srs %s: client id=%s, ip=%s, vhost=%s,‡pp=%s, stream=%s"%(

226 
»q
["action"],„eq["client_id"],„eq["ip"],„eq["vhost"],„eq["app"],„eq["stream"]

229 #TODO: 
´oûss
 
the
 
Ú_publish
 
ev’t


231  
code


233 
def
 
	$__Ú_uÅublish
(
£lf
, 
»q
):

234 
code
 = 
E¼Ü
.
sucûss


236 
	`Œaû
("srs %s: client id=%s, ip=%s, vhost=%s,‡pp=%s, stream=%s"%(

237 
»q
["action"],„eq["client_id"],„eq["ip"],„eq["vhost"],„eq["app"],„eq["stream"]

240 #TODO: 
´oûss
 
the
 
Ú_uÅublish
 
ev’t


242  
code


245 
hªdË
 
the
 
dvrs
 
»que¡s
: 
dvr
 
¡»am
.

247 
şass
 
	$RESTDvrs
(
objeù
):

248 
expo£d
 = 
True


250 
def
 
	$GET
(
£lf
):

251 
	$’abË_üossdomaš
()

253 
dvrs
 = {
	}
}

254  
jsÚ
.
dumps
(
dvrs
)

257 
SRS
 
hook
: 
Ú_dvr


258 
Ú_dvr
:

259 
wh’
 
¤s
 
»­
 
a
 
dvr
 
fe
, 
ÿÎ
 
the
 
	ghook
,

260 
the
 
»que¡
 
š
h
POST
 
d©a
 
¡ršg
 
is
 
a
 
objeù
 
’code
 
by
 
	gjsÚ
:

269 
v®id
, 
the
 
hook
 
mu¡
  
HTTP
 
	gcode
 200(
Suts
 
	gOK
è
ªd
 
»¥Ú£


270 
ª
 
v®ue
 
¥ecif›s
 
the
 
”rÜ
 
	$code
(0 
cÜ»¥Údšg
 
to
 
sucûss
):

273 
def
 
	$POST
(
£lf
):

274 
	$’abË_üossdomaš
()

276 #»tuº 
the
 
”rÜ
 
code
 
š
 
¡r


277 
code
 = 
E¼Ü
.
sucûss


279 
»q
 = 
ch”rypy
.
»que¡
.
body
.
	$»ad
()

280 
	`Œaû
("po¡Ødvrs,„eq=%s"%(
»q
))

281 
Œy
:

282 
jsÚ_»q
 = 
jsÚ
.
	$lßds
(
»q
)

283 
exû±
 
Exû±iÚ
, 
ex
:

284 
code
 = 
E¼Ü
.
sy¡em_·r£_jsÚ


285 
	`Œaû
("·r£h»que¡ØjsÚ faed,„eq=%s,ƒx=%s, code=%s"%(
»q
, 
ex
, 
code
))

286  
	$¡r
(
code
)

288 
aùiÚ
 = 
jsÚ_»q
["action"]

289 
aùiÚ
 == "on_dvr":

290 
code
 = 
£lf
.
	$__Ú_dvr
(
jsÚ_»q
)

292 
	`Œaû
("šv®id„eque¡‡ùiÚ: %s"%(
jsÚ_»q
["action"]))

293 
code
 = 
E¼Ü
.
»que¡_šv®id_aùiÚ


295  
	$¡r
(
code
)

297 
def
 
	$OPTIONS
(
£lf
, *
¬gs
, **
kw¬gs
):

298 
	$’abË_üossdomaš
()

300 
def
 
	$__Ú_dvr
(
£lf
, 
»q
):

301 
code
 = 
E¼Ü
.
sucûss


303 
	`Œaû
("srs %s: client id=%s, ip=%s, vhost=%s,‡pp=%s, stream=%s, cwd=%s, file=%s"%(

304 
»q
["action"],„eq["client_id"],„eq["ip"],„eq["vhost"],„eq["app"],„eq["stream"],

305 
»q
["cwd"],„eq["file"]

308 #TODO: 
´oûss
 
the
 
Ú_dvr
 
ev’t


310  
code


314 
hªdË
 
the
 
hls
 
´oxy
 
»que¡s
: hl 
¡»am
.

316 
şass
 
	$RESTProxy
(
objeù
):

317 
expo£d
 = 
True


320 
SRS
 
hook
: 
Ú_hls_nÙify


321 
Ú_hls_nÙify
:

322 
wh’
 
¤s
 
»­
 
a
 
ts
 
fe
 
of
 
hls
, 
ÿÎ
 
this
 
hook
,

323 
u£d
 
to
 
push
 
fe
Ø
cdn
 
ÃtwÜk
, 
by
 
g‘
 
the
 
ts
 f
äom
 cdn‚etwork.

324 
so
 
we
 
u£
 
HTTP
 
GET
 
ªd
 u£ 
the
 
v¬ŸbË
 
fŞlowšg
:

325 [
­p
], 
»¶aû
 
w™h
 
the
‡pp.

326 [
¡»am
], 
»¶aû
 
w™h
 
the
 stream.

327 [
ts_u¾
], 
»¶aû
 
w™h
 
the
 
ts
 
u¾
.

328 
ignÜe
 
ªy
  
d©a
 
of
 
£rv”
.

330 
def
 
	$GET
(
£lf
, *
¬gs
, **
kw¬gs
):

331 
	$’abË_üossdomaš
()

333 
u¾
 = "h‰p://" + "/".
	`još
(
¬gs
);

334 
´št
 "¡¬ˆtØ´oxy u¾: %s"%
u¾


336 
f
 = 
NÚe


337 
Œy
:

338 
f
 = 
u¾lib2
.
	$u¾İ’
(
u¾
)

339 
f
.
	$»ad
()

340 
exû±
:

341 
´št
 "”rÜ…roxy u¾: %s"%
u¾


342 
fš®ly
:

343 
f
: f.
	$şo£
()

344 
´št
 "com¶‘ed…roxy u¾: %s"%
u¾


345  
u¾


348 
hªdË
 
the
 
hls
 
»que¡s
: hl 
¡»am
.

350 
şass
 
	$RESTHls
(
objeù
):

351 
expo£d
 = 
True


354 
SRS
 
hook
: 
Ú_hls_nÙify


355 
Ú_hls_nÙify
:

356 
wh’
 
¤s
 
»­
 
a
 
ts
 
fe
 
of
 
hls
, 
ÿÎ
 
this
 
hook
,

357 
u£d
 
to
 
push
 
fe
Ø
cdn
 
ÃtwÜk
, 
by
 
g‘
 
the
 
ts
 f
äom
 cdn‚etwork.

358 
so
 
we
 
u£
 
HTTP
 
GET
 
ªd
 u£ 
the
 
v¬ŸbË
 
fŞlowšg
:

359 [
­p
], 
»¶aû
 
w™h
 
the
‡pp.

360 [
¡»am
], 
»¶aû
 
w™h
 
the
 stream.

361 [
ts_u¾
], 
»¶aû
 
w™h
 
the
 
ts
 
u¾
.

362 
ignÜe
 
ªy
  
d©a
 
of
 
£rv”
.

364 
def
 
	$GET
(
£lf
, *
¬gs
, **
kw¬gs
):

365 
	$’abË_üossdomaš
()

367 
hls
 = {

368 "¬gs": 
¬gs
,

369 "kw¬gs": 
kw¬gs


370 
	}
}

371  
jsÚ
.
dumps
(
hls
)

374 
SRS
 
hook
: 
Ú_hls


375 
Ú_hls
:

376 
wh’
 
¤s
 
»­
 
a
 
dvr
 
fe
, 
ÿÎ
 
the
 
	ghook
,

377 
the
 
»que¡
 
š
h
POST
 
d©a
 
¡ršg
 
is
 
a
 
objeù
 
’code
 
by
 
	gjsÚ
:

390 
v®id
, 
the
 
hook
 
mu¡
  
HTTP
 
	gcode
 200(
Suts
 
	gOK
è
ªd
 
»¥Ú£


391 
ª
 
v®ue
 
¥ecif›s
 
the
 
”rÜ
 
	$code
(0 
cÜ»¥Údšg
 
to
 
sucûss
):

394 
def
 
	$POST
(
£lf
):

395 
	$’abË_üossdomaš
()

397 #»tuº 
the
 
”rÜ
 
code
 
š
 
¡r


398 
code
 = 
E¼Ü
.
sucûss


400 
»q
 = 
ch”rypy
.
»que¡
.
body
.
	$»ad
()

401 
	`Œaû
("po¡Øhls,„eq=%s"%(
»q
))

402 
Œy
:

403 
jsÚ_»q
 = 
jsÚ
.
	$lßds
(
»q
)

404 
exû±
 
Exû±iÚ
, 
ex
:

405 
code
 = 
E¼Ü
.
sy¡em_·r£_jsÚ


406 
	`Œaû
("·r£h»que¡ØjsÚ faed,„eq=%s,ƒx=%s, code=%s"%(
»q
, 
ex
, 
code
))

407  
	$¡r
(
code
)

409 
aùiÚ
 = 
jsÚ_»q
["action"]

410 
aùiÚ
 == "on_hls":

411 
code
 = 
£lf
.
	$__Ú_hls
(
jsÚ_»q
)

413 
	`Œaû
("šv®id„eque¡‡ùiÚ: %s"%(
jsÚ_»q
["action"]))

414 
code
 = 
E¼Ü
.
»que¡_šv®id_aùiÚ


416  
	$¡r
(
code
)

418 
def
 
	$OPTIONS
(
£lf
, *
¬gs
, **
kw¬gs
):

419 
	$’abË_üossdomaš
()

421 
def
 
	$__Ú_hls
(
£lf
, 
»q
):

422 
code
 = 
E¼Ü
.
sucûss


424 
	`Œaû
("srs %s: client id=%s, ip=%s, vhost=%s,‡pp=%s, stream=%s, duration=%s, cwd=%s, file=%s, seq_no=%s"%(

425 
»q
["action"],„eq["client_id"],„eq["ip"],„eq["vhost"],„eq["app"],„eq["stream"],„eq["duration"],

426 
»q
["cwd"],„eq["file"],„eq["seq_no"]

429 #TODO: 
´oûss
 
the
 
Ú_hls
 
ev’t


431  
code


434 
hªdË
 
the
 
£ssiÚs
 
»que¡s
: 
ş›Á
 
¶ay
/
¡İ
 
¡»am


436 
şass
 
	$RESTSessiÚs
(
objeù
):

437 
expo£d
 = 
True


439 
def
 
	$GET
(
£lf
):

440 
	$’abË_üossdomaš
()

442 
£ssiÚs
 = {
	}
}

443  
jsÚ
.
dumps
(
£ssiÚs
)

446 
SRS
 
hook
: 
Ú_¶ay
/
Ú_¡İ


447 
Ú_¶ay
:

448 
wh’
 
	$ş›Á
(
’cod”
è
publish
 
to
 
vho¡
/
­p
/
¡»am
, 
ÿÎ
 
the
 
hook
,

449 
the
 
»que¡
 
š
h
POST
 
d©a
 
¡ršg
 
is
 
a
 
objeù
 
’code
 
by
 
jsÚ
:

456 
	}
}

457 
Ú_¡İ
:

458 
wh’
 
	$ş›Á
(
’cod”
è
¡İ
 
publish
 
to
 
vho¡
/
­p
/
¡»am
, 
ÿÎ
 
the
 
hook
,

459 
the
 
»que¡
 
š
h
POST
 
d©a
 
¡ršg
 
is
 
a
 
objeù
 
’code
 
by
 
jsÚ
:

465 
	}
}

466 
v®id
, 
the
 
hook
 
mu¡
  
HTTP
 
	gcode
 200(
Suts
 
	gOK
è
ªd
 
»¥Ú£


467 
ª
 
v®ue
 
¥ecif›s
 
the
 
”rÜ
 
	$code
(0 
cÜ»¥Údšg
 
to
 
sucûss
):

470 
def
 
	$POST
(
£lf
):

471 
	$’abË_üossdomaš
()

473 #»tuº 
the
 
”rÜ
 
code
 
š
 
¡r


474 
code
 = 
E¼Ü
.
sucûss


476 
»q
 = 
ch”rypy
.
»que¡
.
body
.
	$»ad
()

477 
	`Œaû
("po¡Ø£ssiÚs,„eq=%s"%(
»q
))

478 
Œy
:

479 
jsÚ_»q
 = 
jsÚ
.
	$lßds
(
»q
)

480 
exû±
 
Exû±iÚ
, 
ex
:

481 
code
 = 
E¼Ü
.
sy¡em_·r£_jsÚ


482 
	`Œaû
("·r£h»que¡ØjsÚ faed,„eq=%s,ƒx=%s, code=%s"%(
»q
, 
ex
, 
code
))

483  
	$¡r
(
code
)

485 
aùiÚ
 = 
jsÚ_»q
["action"]

486 
aùiÚ
 == "on_play":

487 
code
 = 
£lf
.
	$__Ú_¶ay
(
jsÚ_»q
)

488 
–if
 
aùiÚ
 == "on_stop":

489 
code
 = 
£lf
.
	$__Ú_¡İ
(
jsÚ_»q
)

491 
	`Œaû
("šv®id„eque¡‡ùiÚ: %s"%(
jsÚ_»q
["action"]))

492 
code
 = 
E¼Ü
.
»que¡_šv®id_aùiÚ


494  
	$¡r
(
code
)

496 
def
 
	$OPTIONS
(
£lf
, *
¬gs
, **
kw¬gs
):

497 
	$’abË_üossdomaš
()

499 
def
 
	$__Ú_¶ay
(
£lf
, 
»q
):

500 
code
 = 
E¼Ü
.
sucûss


502 
	`Œaû
("srs %s: client id=%s, ip=%s, vhost=%s,‡pp=%s, stream=%s,…ageUrl=%s"%(

503 
»q
["action"],„eq["client_id"],„eq["ip"],„eq["vhost"],„eq["app"],„eq["stream"],„eq["pageUrl"]

506 #TODO: 
´oûss
 
the
 
Ú_¶ay
 
ev’t


508  
code


510 
def
 
	$__Ú_¡İ
(
£lf
, 
»q
):

511 
code
 = 
E¼Ü
.
sucûss


513 
	`Œaû
("srs %s: client id=%s, ip=%s, vhost=%s,‡pp=%s, stream=%s"%(

514 
»q
["action"],„eq["client_id"],„eq["ip"],„eq["vhost"],„eq["app"],„eq["stream"]

517 #TODO: 
´oûss
 
the
 
Ú_¡İ
 
ev’t


519  
code


521 
glob®_¬m_£rv”_id
 = 
os
.
	`g‘pid
();

522 
şass
 
ArmS”v”
:

523 
def
 
	$__š™__
(
£lf
):

524 
glob®
 
glob®_¬m_£rv”_id


525 
glob®_¬m_£rv”_id
 += 1

527 
£lf
.
id
 = 
	$¡r
(
glob®_¬m_£rv”_id
)

528 
£lf
.

 = 
NÚe


529 
£lf
.
deviû_id
 = 
NÚe


530 
£lf
.
summ¬›s
 = 
NÚe


532 
£lf
.
public_
 = 
ch”rypy
.
»que¡
.
»mÙe
.



533 
£lf
.
h—¹b—t
 = 
time
.
	$time
()

535 
£lf
.
ş›Ás
 = 0

537 
def
 
	$d—d
(
£lf
):

538 
d—d_time_£cÚds
 = 20

539 
time
.
	`time
(è- 
£lf
.
h—¹b—t
 > 
d—d_time_£cÚds
:

540  
True


541  
F®£


543 
def
 
	$jsÚ_dump
(
£lf
):

544 
d©a
 = {
	}
}

545 
d©a
["id"] = 
£lf
.
id


546 
d©a
[""] = 
£lf
.



547 
d©a
["deviû_id"] = 
£lf
.
deviû_id


548 
d©a
["summ¬›s"] = 
£lf
.
summ¬›s


549 
d©a
["public_"] = 
£lf
.
public_


550 
d©a
["h—¹b—t"] = 
£lf
.
h—¹b—t


551 
d©a
["h—¹b—t_h"] = 
time
.
¡ráime
("%Y-%m-%d %H:%M:%S",time.
	$loÿÉime
(
£lf
.
h—¹b—t
))

552 
d©a
["­i"] = "h‰p://%s:1985/­i/v1/summ¬›s"%(
£lf
.

)

553 
d©a
["cÚsŞe"] = "h‰p://os¤s.Ãt/cÚsŞe/ng_šdex.html#/summ¬›s?ho¡=%s&pÜt=1985"%(
£lf
.

)

554  
d©a


557 
the
 
£rv”
 
li¡


559 
şass
 
	$RESTS”v”s
(
objeù
):

560 
expo£d
 = 
True


562 
def
 
	$__š™__
(
£lf
):

563 
£lf
.
__nodes
 = []

565 
£lf
.
__Ï¡_upd©e
 = 
d©‘ime
.d©‘ime.
	`now
();

567 
£lf
.
__lock
 = 
th»adšg
.
	$Lock
()

569 
def
 
	$__g‘_node
(
£lf
, 
deviû_id
):

570 
node
 
š
 
£lf
.
__nodes
:

571 
node
.
deviû_id
 == device_id:

572  
node


573  
NÚe


575 
def
 
	$__»äesh_nodes
(
£lf
):

576 
	`Ën
(
£lf
.
__nodes
) > 0:

577 
has_d—d_node
 = 
F®£


578 
node
 
š
 
£lf
.
__nodes
:

579 
node
.
	$d—d
():

580 
£lf
.
__nodes
.
	$»move
(
node
)

581 
has_d—d_node
 = 
True


582 
nÙ
 
has_d—d_node
:

586 
po¡
 
to
 
upd©e
 
£rv”
 

.

587 
»que¡
 
body
: 
the
 
Ãw
 
¿¥b”ry
-
pi
 
£rv”
 

. 
TODO
: 
FIXME
: 
mÜe
 
šfo
.

589 
def
 
	$POST
(
£lf
):

590 
	$’abË_üossdomaš
()

592 
Œy
:

593 
£lf
.
__lock
.
	$acquœe
()

595 
»q
 = 
ch”rypy
.
»que¡
.
body
.
	$»ad
()

596 
	`Œaû
("po¡Ønodes,„eq=%s"%(
»q
))

597 
Œy
:

598 
jsÚ_»q
 = 
jsÚ
.
	$lßds
(
»q
)

599 
exû±
 
Exû±iÚ
, 
ex
:

600 
code
 = 
E¼Ü
.
sy¡em_·r£_jsÚ


601 
	`Œaû
("·r£h»que¡ØjsÚ faed,„eq=%s,ƒx=%s, code=%s"%(
»q
, 
ex
, 
code
))

602  
jsÚ
.
	`dumps
({"code":
code
, "d©a": 
NÚe
})

604 
deviû_id
 = 
jsÚ_»q
["device_id"]

605 
node
 = 
£lf
.
	$__g‘_node
(
deviû_id
)

606 
node
 
is
 
NÚe
:

607 
node
 = 
	$ArmS”v”
()

608 
£lf
.
__nodes
.
	$­³nd
(
node
)

610 
node
.

 = 
jsÚ_»q
["ip"]

611 "summ¬›s" 
š
 
jsÚ_»q
:

612 
node
.
summ¬›s
 = 
jsÚ_»q
["summaries"]

613 
node
.
deviû_id
 = device_id

614 
node
.
public_
 = 
ch”rypy
.
»que¡
.
»mÙe
.



615 
node
.
h—¹b—t
 = 
time
.
	$time
()

617  
jsÚ
.
	`dumps
({"code":
E¼Ü
.
sucûss
, "d©a": {"id":
node
.
id
}
	}
})

618 
fš®ly
:

619 
£lf
.
__lock
.
»Ëa£
()

622 
g‘
 
®l
 
£rv”s
 
which
 
»pÜt
 
to
 
this
 
­i
-
£rv”
.

624 
def
 
	$GET
(
£lf
, 
id
=
NÚe
):

625 
	$’abË_üossdomaš
()

627 
Œy
:

628 
£lf
.
__lock
.
	$acquœe
()

630 
£lf
.
	$__»äesh_nodes
()

632 
d©a
 = []

633 
node
 
š
 
£lf
.
__nodes
:

634 
id
 =ğ
NÚe
 
Ü
 
node
.id =ğ
	$¡r
(
id
è
Ü
 
node
.
deviû_id
 =ğ
	$¡r
(
id
):

635 
d©a
.
	`­³nd
(
node
.
	$jsÚ_dump
())

637  
jsÚ
.
	$dumps
(
d©a
)

638 
fš®ly
:

639 
£lf
.
__lock
.
	$»Ëa£
()

641 
def
 
	$DELETE
(
£lf
, 
id
):

642 
	$’abË_üossdomaš
()

643 
¿i£
 
ch”rypy
.
	`HTTPE¼Ü
(405, "Not‡llowed.")

645 
def
 
	$PUT
(
£lf
, 
id
):

646 
	$’abË_üossdomaš
()

647 
¿i£
 
ch”rypy
.
	`HTTPE¼Ü
(405, "Not‡llowed.")

649 
def
 
	$OPTIONS
(
£lf
, *
¬gs
, **
kw¬gs
):

650 
	$’abË_üossdomaš
()

652 
glob®_ch©_id
 = 
os
.
	`g‘pid
();

654 
the
 
ch©
 
¡»ams
, 
public
 ch© 
room
.

656 
şass
 
	$RESTCh©s
(
objeù
):

657 
expo£d
 = 
True


658 
glob®_id
 = 100

660 
def
 
	$__š™__
(
£lf
):

661 #objeù 
f›lds
:

662 #id: 
ª
 
v®ue
 
šdiÿ‹s
 
the
 
id
 
of
 
u£r
.

663 #u£ºame: 
a
 
¡r
 
šdiÿ‹s
 
the
 
u£r
 
Çme
.

664 #u¾: 
a
 
¡r
 
šdiÿ‹s
 
the
 
u¾
 
of
 
u£r
 
¡»am
.

665 #ag’t: 
a
 
¡r
 
šdiÿ‹s
 
the
 
ag’t
 
of
 
u£r
.

666 #još_d©e: 
a
 
numb”
 
šdiÿ‹s
 
the
 
još
 
time¡amp
 
š
 
£cÚds
.

667 #još_d©e_¡r: 
a
 
¡r
 
¥ecif›s
 
the
 
fÜm©ed
 
ä›ndly
 
time
.

668 #h—tb—t: 
a
 
numb”
 
šdiÿ‹s
 
the
 
h—¹b—t
 
time¡amp
 
š
 
£cÚds
.

669 #vcodec: 
a
 
diù
 
šdiÿ‹s
 
the
 
video
 
codec
 
šfo
.

670 #acodec: 
a
 
diù
 
šdiÿ‹s
 
the
 
audio
 
codec
 
šfo
.

671 
£lf
.
__ch©s
 = [];

672 
£lf
.
__ch©_lock
 = 
th»adšg
.
	`Lock
();

674 #d—d 
time
 
š
 
£cÚds
, 
exûed
, 
»move
 
the
 
ch©
.

675 
£lf
.
__d—d_time
 = 15;

678 
g‘
 
the
 
¹mp
 
u¾
 
of
 
ch©
 
objeù
. 
NÚe
 
ov”æow
.

680 
def
 
	$g‘_u¾_by_šdex
(
£lf
, 
šdex
):

681 
šdex
 = (index)

682 
šdex
 
is
 
NÚe
 
Ü
 index >ğ
	$Ën
(
£lf
.
__ch©s
):

683  
NÚe
;

684  
£lf
.
__ch©s
[
šdex
]["url"];

686 
def
 
	$GET
(
£lf
):

687 
	$’abË_üossdomaš
()

689 
Œy
:

690 
£lf
.
__ch©_lock
.
	`acquœe
();

692 
ch©s
 = [];

693 
cİy
 = 
£lf
.
__ch©s
[:];

694 
ch©
 
š
 
cİy
:

695 
time
.
	`time
(è- 
ch©
["h—¹b—t"] > 
£lf
.
__d—d_time
:

696 
£lf
.
__ch©s
.
	`»move
(
ch©
);

699 
ch©s
.
	`­³nd
({

700 "id": 
ch©
["id"],

701 "u£ºame": 
ch©
["username"],

702 "u¾": 
ch©
["url"],

703 "još_d©e_¡r": 
ch©
["join_date_str"],

704 "h—¹b—t": 
ch©
["heartbeat"],

705 
	}
});

706 
	gfš®ly
:

707 
£lf
.
__ch©_lock
.
»Ëa£
();

709  
	gjsÚ
.
dumps
({"code":0, "d©a": {"now": 
time
.time(), "ch©s": 
ch©s
}})

711 
def
 
	$POST
(
£lf
):

712 
	$’abË_üossdomaš
()

714 
»q
 = 
ch”rypy
.
»que¡
.
body
.
	$»ad
()

715 
ch©
 = 
jsÚ
.
	$lßds
(
»q
)

717 
glob®
 
glob®_ch©_id
;

718 
ch©
["id"] = 
glob®_ch©_id


719 
glob®_ch©_id
 += 1

721 
ch©
["još_d©e"] = 
time
.
	`time
();

722 
ch©
["h—¹b—t"] = 
time
.
	`time
();

723 
ch©
["još_d©e_¡r"] = 
time
.
	`¡ráime
("%Y-%m-%d %H:%M:%S");

725 
Œy
:

726 
£lf
.
__ch©_lock
.
	`acquœe
();

728 
£lf
.
__ch©s
.
	$­³nd
(
ch©
)

729 
fš®ly
:

730 
£lf
.
__ch©_lock
.
	`»Ëa£
();

732 
	`Œaû
("ü—‹ ch© sucûss, id=%s"%(
ch©
["id"]))

734  
jsÚ
.
	`dumps
({"code":0, "d©a": 
ch©
["id"]
	}
})

736 
def
 
	$DELETE
(
£lf
, 
id
):

737 
	$’abË_üossdomaš
()

739 
Œy
:

740 
£lf
.
__ch©_lock
.
	`acquœe
();

742 
ch©
 
š
 
£lf
.
__ch©s
:

743 
	`¡r
(
id
è!ğ¡r(
ch©
["id"]):

746 
£lf
.
__ch©s
.
	$»move
(
ch©
)

747 
	`Œaû
("d–‘ch© sucûss, id=%s"%(
id
))

749  
jsÚ
.
	`dumps
({"code":0, "d©a": 
NÚe
})

750 
fš®ly
:

751 
£lf
.
__ch©_lock
.
»Ëa£
();

753 
¿i£
 
	gch”rypy
.
HTTPE¼Ü
(405, "Not‡llowed.")

755 
def
 
	$PUT
(
£lf
, 
id
):

756 
	$’abË_üossdomaš
()

758 
Œy
:

759 
£lf
.
__ch©_lock
.
	`acquœe
();

761 
ch©
 
š
 
£lf
.
__ch©s
:

762 
	`¡r
(
id
è!ğ¡r(
ch©
["id"]):

765 
ch©
["h—¹b—t"] = 
time
.
	`time
();

766 
	`Œaû
("h—¹b—ˆch© sucûss, id=%s"%(
id
))

768  
jsÚ
.
	`dumps
({"code":0, "d©a": 
NÚe
})

769 
fš®ly
:

770 
£lf
.
__ch©_lock
.
»Ëa£
();

772 
¿i£
 
	gch”rypy
.
HTTPE¼Ü
(405, "Not‡llowed.")

774 
def
 
	$OPTIONS
(
£lf
, *
¬gs
, **
kw¬gs
):

775 
	$’abË_üossdomaš
()

777 #HTTP 
RESTful
 
·th
.

778 
şass
 
	$RoÙ
(
objeù
):

779 
expo£d
 = 
True


781 
def
 
	$__š™__
(
£lf
):

782 
£lf
.
­i
 = 
	$Api
()

783 
def
 
	$GET
(
£lf
):

784 
	`’abË_üossdomaš
();

785  
jsÚ
.
	`dumps
({"code":
E¼Ü
.
sucûss
, "u¾s":{"­i":"th­˜roÙ"}
	}
})

786 
def
 
	$OPTIONS
(
£lf
, *
¬gs
, **
kw¬gs
):

787 
	`’abË_üossdomaš
();

788 #HTTP 
RESTful
 
·th
.

789 
şass
 
	$Api
(
objeù
):

790 
expo£d
 = 
True


792 
def
 
	$__š™__
(
£lf
):

793 
£lf
.
v1
 = 
	$V1
()

794 
def
 
	$GET
(
£lf
):

795 
	`’abË_üossdomaš
();

796  
jsÚ
.
	`dumps
({"code":
E¼Ü
.
sucûss
,

800 
	}
});

801 
def
 
	$OPTIONS
(
£lf
, *
¬gs
, **
kw¬gs
):

802 
	`’abË_üossdomaš
();

803 #HTTP 
RESTful
 
·th
. 
to
 
acûss
 
as
:

805 
şass
 
	$V1
(
objeù
):

806 
expo£d
 = 
True


808 
def
 
	$__š™__
(
£lf
):

809 
£lf
.
ş›Ás
 = 
	$RESTCl›Ás
()

810 
£lf
.
¡»ams
 = 
	$RESTSŒ—ms
()

811 
£lf
.
£ssiÚs
 = 
	$RESTSessiÚs
()

812 
£lf
.
dvrs
 = 
	$RESTDvrs
()

813 
£lf
.
hls
 = 
	$RESTHls
()

814 
£lf
.
´oxy
 = 
	$RESTProxy
()

815 
£lf
.
ch©s
 = 
	$RESTCh©s
()

816 
£lf
.
£rv”s
 = 
	$RESTS”v”s
()

817 
def
 
	$GET
(
£lf
):

818 
	`’abË_üossdomaš
();

819  
jsÚ
.
	`dumps
({"code":
E¼Ü
.
sucûss
, "urls":{

830 }
	}
});

831 
def
 
	$OPTIONS
(
£lf
, *
¬gs
, **
kw¬gs
):

832 
	`’abË_üossdomaš
();

835 
maš
 
code
 
¡¬t
.

837 #dÚÙ 
suµÜt
 
u£
 
this
 
moduË
 
as
 
lib¿ry
.

838 
__Çme__
 != "__main__":

839 
¿i£
 
	`Exû±iÚ
("embed‚ot support")

841 #check 
the
 
u£r
 
İtiÚs


842 
	`Ën
(
sys
.
¬gv
) <= 1:

843 
´št
 "SRS‡pi callback server, Copyright (c) 2013-2015 SRS(ossrs)"

844 
´št
 "U§ge:…ythÚ % <pÜt>"%(
sys
.
¬gv
[0])

845 
´št
 "…ort:he…orto†isten‡t."

846 
´št
 "Forƒxample:"

847 
´št
 "…ythÚ % 8085"%(
sys
.
¬gv
[0])

848 
´št
 ""

849 
´št
 "See‡lso: https://github.com/ossrs/srs"

850 
sys
.
	$ex™
(1)

852 #·r£ 
pÜt
 
äom
 
u£r
 
İtiÚs
.

853 
pÜt
 = (
sys
.
¬gv
[1])

854 
¡©ic_dœ
 = 
os
.
·th
.
	`ab¥©h
(os.·th.
	`još
(os.·th.
	`dœÇme
(
sys
.
¬gv
[0]), "static-dir"))

855 
	`Œaû
("­˜£rv”†i¡’‡ˆpÜt: %s, stic_dœ: %s"%(
pÜt
, 
¡©ic_dœ
))

857 #ch”rypy 
cÚfig
.

858 
cÚf
 = {

862 '£rv”.sock‘_pÜt': 
pÜt
,

863 'toŞs.’code.Ú': 
True
,

864 'toŞs.¡©icdœ.Ú': 
True
,

866 #'
£rv”
.
th»ad_poŞ
': 2, # singlehread server.

869 'toŞs.¡©icdœ.dœ': 
¡©ic_dœ
,

871 #fÜ 
ch”rypy
 
RESTful
 
­i
 
suµÜt


872 '»que¡.di¥©ch': 
ch”rypy
.
di¥©ch
.
	`M‘hodDi¥©ch”
()

874 
	}
}

876 #¡¬ˆ
ch”rypy
 
web
 
’gše


877 
Œaû
("start cherrypy server")

878 
roÙ
 = 
	$RoÙ
()

879 
ch”rypy
.
	`quick¡¬t
(
roÙ
, '/', 
cÚf
)

	@trunk/research/api-server/static-dir/index.html

1 <!
DOCTYPE
 
	ghtml
>

2 <
	ghtml
>

3 <
	gh—d
>

4 <
	gt™Ë
>
	gSRS
</title>

5 <
m‘a
 
	gch¬£t
="utf-8">

6 <
lšk
 
»l
="¡yËsh“t" 
ty³
="‹xt/css" 
h»f
="players/css/bootstrap.min.css"/>

7 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="players/js/jquery-1.10.2.min.js"></script>

8 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="players/js/bootstrap.min.js"></script>

9 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="players/js/swfobject.js"></script>

10 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="players/js/srs.page.js"></script>

11 <
¡yË
>

12 
body
{

13 
·ddšg
-
tİ
: 55
px
;

15 </
	g¡yË
>

16 <
süt
 
	gty³
="text/javascript">

17 
$
(
	$funùiÚ
(){

18 
	`upd©e_Çv
();

21 
wšdow
.
loÿtiÚ
.
h»f
 = "¶ay”s/šdex.html" + wšdow.loÿtiÚ.
£¬ch
;

22 
	}
});

23 </
	gsüt
>

24 </
	gh—d
>

25 <
	gbody
>

26 <
div
 
	gşass
="navbar‚avbar-fixed-top">

27 <
div
 
şass
="navbar-inner">

28 <
div
 
şass
="container">

29 <
a
 
şass
="b¿nd" 
h»f
="šdex.html">
SRS
</a>

30 <
div
 
şass
="nav-collapse collapse">

31 <
ul
 
şass
="nav">

32 <
li
><
a
 
id
="Çv_¤s_¶ay”" 
h»f
="¤s_¶ay”.html">
SRS
æ’­æ”¾å™¨</a></li>

33 <
li
><
a
 
id
="Çv_¤s_publish”" 
h»f
="¤s_publish”.html">
SRS
ç¼–ç å™¨</a></li>

34 <
li
><
a
 
id
="Çv_¤s_ch©" 
h»f
="¤s_ch©.html">
SRS
ä¼šè®®</a></li>

35 <
li
><
a
 
id
="Çv_¤s_bwt" 
h»f
="¤s_bwt.html">
SRS
æµ‹ç½‘é€Ÿ</a></li>

36 <
li
><
a
 
id
="Çv_jw¶ay”6" 
h»f
="jw¶ay”6.html">
JWPÏy”6
æ’­æ”¾å™¨</a></li>

37 <
li
><
a
 
id
="Çv_osmf" 
h»f
="osmf.html">
AdobeOSMF
æ’­æ”¾å™¨</a></li>

38 <
li
><
a
 
id
="Çv_vlc" 
h»f
="vlc.html">
VLC
æ’­æ”¾å™¨</a></li>

39 </
ul
>

40 </
div
>

41 </
div
>

42 </
div
>

43 </
div
>

44 <
div
 
şass
="container">

45 <
hr
>

46 <
foÙ”
>

47 <
p
><
a
 
h»f
="h‰ps://g™hub.com/os¤s/¤s">
SRS
 
T—m
 &
cİy
; 2013</
	ga
></
	gp
>

48 </
	gfoÙ”
>

49 </
	gdiv
>

50 </
	gbody
>

	@trunk/research/code-statistic/cs.py

1 #!/
u¤
/
bš
/
pythÚ


3 
The
 
MIT
 
	$Liûn£
 (
MIT
)

5 
	`Cİyright
 (
c
è2013-2015 
	$SRS
(
os¤s
)

7 
P”missiÚ
 
is
 
h”eby
 
g¿Áed
, 
ä“
 
of
 
ch¬ge
, 
to
 
ªy
 
³rsÚ
 
obššg
 
a
 
cİy
 of

8 
this
 
soáw¬e
 
ªd
 
assocŸ‹d
 
docum’tiÚ
 
	`fes
 (
the
 "Soáw¬e"), 
to
 
d—l
 
š


9 
the
 
Soáw¬e
 
w™hout
 
»¡riùiÚ
, 
šşudšg
 w™houˆ
lim™©iÚ
h
rights
 
to


10 
u£
, 
cİy
, 
modify
, 
m”ge
, 
publish
, 
di¡ribu‹
, 
subliûn£
, 
ªd
/
Ü
 
£Î
 
cİ›s
 
of


11 
the
 
Soáw¬e
, 
ªd
 
to
 
³rm™
 
³rsÚs
Ø
whom
hSoáw¬
is
 
fuºished
ØdØ
so
,

12 
subjeù
 
to
 
the
 
fŞlowšg
 
cÚd™iÚs
:

14 
The
 
above
 
cİyright
 
nÙiû
 
ªd
 
this
 
³rmissiÚ
‚Ùiû 
sh®l
 
be
 
šşuded
 
š
 
®l


15 
cİ›s
 
Ü
 
sub¡ªtŸl
 
pÜtiÚs
 
of
 
the
 
Soáw¬e
.

17 
THE
 
SOFTWARE
 
IS
 
PROVIDED
 "AS IS", 
WITHOUT
 
WARRANTY
 
OF
 
ANY
 
KIND
, 
EXPRESS
 
OR


18 
IMPLIED
, 
INCLUDING
 
BUT
 
NOT
 
LIMITED
 
TO
 
THE
 
WARRANTIES
 
OF
 
MERCHANTABILITY
, 
FITNESS


19 
FOR
 
A
 
PARTICULAR
 
PURPOSE
 
AND
 
NONINFRINGEMENT
. 
IN
 
NO
 
EVENT
 
SHALL
 
THE
 
AUTHORS
 
OR


20 
COPYRIGHT
 
HOLDERS
 
BE
 
LIABLE
 
FOR
 
ANY
 
CLAIM
, 
DAMAGES
 
OR
 
OTHER
 
LIABILITY
, 
WHETHER


21 
IN
 
AN
 
ACTION
 
OF
 
CONTRACT
, 
TORT
 
OR
 
OTHERWISE
, 
ARISING
 
FROM
, 
OUT
 OF OR IN

22 
CONNECTION
 
WITH
 
THE
 
SOFTWARE
 
OR
 THE 
USE
 OR 
OTHER
 
DEALINGS
 
IN
 THE SOFTWARE.

25 #################################################################################
#tØ
¡©
 
the
 
code
 
ªd
 
comm’ts
 
lšes


26 #################################################################################
 sys

28 
def
 
	$Œaû
(
msg
):

29 
´št
 
msg


30 
·ss


31 
def
 
	$šfo
(
msg
):

32 
´št
 
msg


33 
·ss


34 
def
 
	$v”bo£
(
msg
):

35 #´šˆ
msg


36 
·ss


38 
def
 
	$´oûss
(
f
, 
code_fe
):

39 
	`šfo
("process file success")

40 (
¡©_code
, 
¡©_block_comm’ts
, 
¡©_lše_comm’ts
) = (0, 0, 0)

41 
is_block_comm’ts
 = 
F®£


42 
is_lše_comm’ts
 = 
F®£


43 
lše
 
š
 
f
.
	$»adlšes
():

44 
lše
 =†še.
	$¡r
()

45 
is_block_comm’ts
:

46 "*/" 
š
 
lše
:

47 
	`v”bo£
("[block][’d] %s"%
lše
)

48 
is_block_comm’ts
 = 
F®£


49 
is_lše_comm’ts
 = 
F®£


51 
	`v”bo£
("[block][cÚt] %s"%
lše
)

52 
¡©_block_comm’ts
 += 1

54 
lše
.
	`¡¬tsw™h
("/*"):

55 
	`v”bo£
("[block][¡¬t] %s"%
lše
)

56 
is_block_comm’ts
 = 
True


57 
is_lše_comm’ts
 = 
F®£


58 
¡©_block_comm’ts
 += 1

59 #šlš
block
 
comm’ts


60 
is_block_comm’ts
:

61 "*/" 
š
 
lše
:

62 
	`v”bo£
("[block][’d] %s"%
lše
)

63 
is_block_comm’ts
 = 
F®£


64 
is_lše_comm’ts
 = 
F®£


66 
lše
.
	`¡¬tsw™h
("//"):

67 
	`v”bo£
("[lše] %s"%
lše
)

68 
is_block_comm’ts
 = 
F®£


69 
is_lše_comm’ts
 = 
True


70 
¡©_lše_comm’ts
 += 1

72 
	`v”bo£
("[code] %s"%
lše
)

73 
is_block_comm’ts
 = 
F®£


74 
is_lše_comm’ts
 = 
F®£


75 
¡©_code
 += 1

76 
tÙ®
 = 
¡©_code
 + 
¡©_block_comm’ts
 + 
¡©_lše_comm’ts


77 
comm’ts
 = 
¡©_block_comm’ts
 + 
¡©_lše_comm’ts


78 
	`Œaû
("tÙ®:% code:% comm’ts:% block:% lše:% fe:%s"%(
tÙ®
, 
¡©_code
, 
comm’ts
, 
¡©_block_comm’ts
, 
¡©_lše_comm’ts
, 
code_fe
))

79  (0, 
tÙ®
, 
¡©_code
, 
comm’ts
, 
¡©_block_comm’ts
, 
¡©_lše_comm’ts
, 
code_fe
)

81 
def
 
	$do_¡©
(
code_fe
):

82 
f
 = 
NÚe


83 
Œy
:

84 
f
 = 
	`İ’
(
code_fe
, "r")

85 
	`šfo
("open file success");

86  
	$´oûss
(
f
, 
code_fe
)

87 
fš®ly
:

88 
f
 
is
 
nÙ
 
NÚe
:

89 
f
.
	$şo£
()

90 
	`šfo
("close file success")

91  (-1, 0, 0, 0, 0, 0, 
NÚe
)

93 
code_fe
 = 
NÚe


94 
__Çme__
 == "__main__":

95 
	`Ën
(
sys
.
¬gv
) <= 1:

96 
´št
 "to stathe code‡nd comments†ines"

97 
´št
 "U§ge:…ythÚ % <code_fe>"%(
sys
.
¬gv
[0])

98 
´št
 " code_file:he code(header or source) fileo stat"

99 
´št
 "Example:"

100 
´št
 "…ythÚ % ¤c/cÜe/¤s_cÜe.hµ"%(
sys
.
¬gv
[0])

101 
sys
.
	`ex™
(-1)

103 
code_fe
 = 
sys
.
¬gv
[1]

104 
	`šfo
("¡© %s"%(
code_fe
))

105 
	`do_¡©
(
code_fe
)

	@trunk/research/code-statistic/csr.py

1 #!/
u¤
/
bš
/
pythÚ


3 
The
 
MIT
 
	$Liûn£
 (
MIT
)

5 
	`Cİyright
 (
c
è2013-2015 
	$SRS
(
os¤s
)

7 
P”missiÚ
 
is
 
h”eby
 
g¿Áed
, 
ä“
 
of
 
ch¬ge
, 
to
 
ªy
 
³rsÚ
 
obššg
 
a
 
cİy
 of

8 
this
 
soáw¬e
 
ªd
 
assocŸ‹d
 
docum’tiÚ
 
	`fes
 (
the
 "Soáw¬e"), 
to
 
d—l
 
š


9 
the
 
Soáw¬e
 
w™hout
 
»¡riùiÚ
, 
šşudšg
 w™houˆ
lim™©iÚ
h
rights
 
to


10 
u£
, 
cİy
, 
modify
, 
m”ge
, 
publish
, 
di¡ribu‹
, 
subliûn£
, 
ªd
/
Ü
 
£Î
 
cİ›s
 
of


11 
the
 
Soáw¬e
, 
ªd
 
to
 
³rm™
 
³rsÚs
Ø
whom
hSoáw¬
is
 
fuºished
ØdØ
so
,

12 
subjeù
 
to
 
the
 
fŞlowšg
 
cÚd™iÚs
:

14 
The
 
above
 
cİyright
 
nÙiû
 
ªd
 
this
 
³rmissiÚ
‚Ùiû 
sh®l
 
be
 
šşuded
 
š
 
®l


15 
cİ›s
 
Ü
 
sub¡ªtŸl
 
pÜtiÚs
 
of
 
the
 
Soáw¬e
.

17 
THE
 
SOFTWARE
 
IS
 
PROVIDED
 "AS IS", 
WITHOUT
 
WARRANTY
 
OF
 
ANY
 
KIND
, 
EXPRESS
 
OR


18 
IMPLIED
, 
INCLUDING
 
BUT
 
NOT
 
LIMITED
 
TO
 
THE
 
WARRANTIES
 
OF
 
MERCHANTABILITY
, 
FITNESS


19 
FOR
 
A
 
PARTICULAR
 
PURPOSE
 
AND
 
NONINFRINGEMENT
. 
IN
 
NO
 
EVENT
 
SHALL
 
THE
 
AUTHORS
 
OR


20 
COPYRIGHT
 
HOLDERS
 
BE
 
LIABLE
 
FOR
 
ANY
 
CLAIM
, 
DAMAGES
 
OR
 
OTHER
 
LIABILITY
, 
WHETHER


21 
IN
 
AN
 
ACTION
 
OF
 
CONTRACT
, 
TORT
 
OR
 
OTHERWISE
, 
ARISING
 
FROM
, 
OUT
 OF OR IN

22 
CONNECTION
 
WITH
 
THE
 
SOFTWARE
 
OR
 THE 
USE
 OR 
OTHER
 
DEALINGS
 
IN
 THE SOFTWARE.

25 #################################################################################
#tØ
¡©
 
the
 
code
 
ªd
 
comm’ts
 
lšes


26 #################################################################################
 sys, os, cs

27 
äom
 
cs
 
impÜt
 
šfo
, 
Œaû


29 
__Çme__
 != "__main__":

30 
´št
 "donot support†ib"

31 
sys
.
	`ex™
(-1)

33 
f‹rs
="*.*pp,*.h,*.c,*.cc"

34 
exû±_f‹rs
="utest,doc"

35 
	`Ën
(
sys
.
¬gv
) <= 1:

36 
´št
 "to stathe code‡nd comments†ines"

37 
´št
 "U§ge:…ythÚ % <dœ> [f‹rs] [exû±_f‹rs]"%(
sys
.
¬gv
[0])

38 
´št
 " dir:he dir containshe fileso stat"

39 
´št
 " filters:he file filters, default: *.*pp,*.h,*.c,*.cc"

40 
´št
 "ƒxcept_filters:heƒxcept file filters, default: utest,doc"

41 
´št
 "Example:"

42 
´št
 "…ythÚ % ¤c"%(
sys
.
¬gv
[0])

43 
´št
 "…ythÚ % ¤ø*.*µ,*.cøu‹¡,doc"%(
sys
.
¬gv
[0])

44 
sys
.
	`ex™
(-1)

46 
dœ
 = 
sys
.
¬gv
[1]

47 
	`Ën
(
sys
.
¬gv
) > 2:

48 
f‹rs
 = 
sys
.
¬gv
[2]

49 
	`Ën
(
sys
.
¬gv
) > 3:

50 
exû±_f‹rs
 = 
sys
.
¬gv
[3]

51 
	`šfo
("¡© dœ:%s, f‹rs:%s,ƒxû±_f‹rs:%s"%(
dœ
, 
f‹rs
, 
exû±_f‹rs
))

53 #f‹r 
to
 
¬¿y


54 
f‹rs
 = f‹rs.
	`¥l™
(",")

55 
exû±_f‹rs
 =ƒxû±_f‹rs.
	`¥l™
(",")

57 #fšd 
¤c
 -
Çme
 "*.*µ"|
g»p
 -
v
 
u‹¡


58 (
tÙ®s
, 
¡©_codes
, 
comm’tss
, 
¡©_block_comm’tss
, 
¡©_lše_comm’tss
) = (0, 0, 0, 0, 0)

59 
f‹r
 
š
 
f‹rs
:

60 
cmd
 = 'fšd % -Çm"%s"'%(
dœ
, 
f‹r
)

61 
ef
 
š
 
exû±_f‹rs
:

62 
cmd
 = '%s|%s'%(cmd, 'g»°-v "%s"'%(
ef
))

63 
cmd
 = "%s 2>&1"%(cmd)

64 
	`šfo
("sÿÀdœ, cmd:%s"%
cmd
)

66 
pe
 = 
os
.
	$pİ’
(
cmd
)

67 
fes
 = 
pe
.
	$»ad
()

68 
	`šfo
("sÿÀdœ, fes:%s"%
fes
)

69 
pe
.
	$şo£
()

71 
fes
 = fes.
	`¥l™
("\n")

72 
fe
 
š
 
fes
:

73 
fe
 = fe.
	$¡r
()

74 
	`Ën
(
fe
) == 0:

76 
	`šfo
("¡¬ˆ¡© fe:%s"%
fe
)

77 (
code
, 
tÙ®
, 
¡©_code
, 
comm’ts
, 
¡©_block_comm’ts
, 
¡©_lše_comm’ts
, 
code_fe
èğ
cs
.
	$do_¡©
(
fe
)

78 
code
 != 0:

80 
tÙ®s
 +ğ
tÙ®


81 
¡©_codes
 +ğ
¡©_code


82 
comm’tss
 +ğ
comm’ts


83 
¡©_block_comm’tss
 +ğ
¡©_block_comm’ts


84 
¡©_lše_comm’tss
 +ğ
¡©_lše_comm’ts


86 
tÙ®s
 == 0:

87 
	`Œaû
("no code or comments found.")

89 
	`Œaû
("total:%s code:%s comments:%s(%.2f%%) block:%s†ine:%s"%(

90 
tÙ®s
, 
¡©_codes
, 
comm’tss
, comm’ts * 100.0 /Ù®s, 
¡©_block_comm’tss
, 
¡©_lše_comm’tss


	@trunk/research/hls/check_hls_backup.sh

1 [[ 
$
#-
É
 2 ]]; 
th’


2 
	gecho
 "Usage: $0 <hls0> <hls1> [keep_ts]"

3 
	gecho
 " keep_tso keephe downloads, default is off"

4 
	gecho
 "Forƒxample:"

5 
	gecho
 " $0 http://192.168.1.137:1980/hls/live/stone/live.m3u8 http://192.168.1.137:1984/hls/live/stone/live.m3u8"

6 
	gecho
 " $0 http://192.168.1.137:1980/hls/live/livestream/live.m3u8 http://192.168.1.137:1984/hls/live/livestream/live.m3u8"

7 
	gecho
 " $0 http://ossrs.net:1984/hls/live/livestream/live.m3u8 http://ossrs.net:1996/hls/live/livestream/live.m3u8"

8 
	gex™
 1

9 
fi


11 
	ghls0
=
$1


12 
hls1
=
$2


13 
k“p_ts
=
NO


14 [[ 
$
#-
gt
 2 ]]; 
th’


15 
	gk“p_ts
=
YES


16 
fi


19 
hls0_tss
=`
cu¾
 
$hls0
 2>/
dev
/
nuÎ
 |
g»p
 "\.ts"`

20 
hls1_tss
=`
cu¾
 
$hls1
 2>/
dev
/
nuÎ
 |
g»p
 "\.ts"`

22 
hls0_´efix
=`
dœÇme
 
$hls0
`

23 
hls1_´efix
=`
dœÇme
 
$hls1
`

24 
wÜk_dœ
="./hbt_temp_`date +%s`"

26 
md5_toŞ
="md5"

27 `
md5sum
 --
v”siÚ
 >/
dev
/
nuÎ
 2>&1` && 
md5_toŞ
="md5sum"

30 
CHECKED
=
NO


31 
OK
=
YES


32 
ts
 
š
 
$hls0_tss
; do

33 
	gm©ch
=
NO


34 
ts1
 
š
 
$hls1_tss
; do

35 [[ 
$ts
 =ğ
$ts1
 ]]; 
	gth’


37 
	gm©ch
=
YES


39 
fi


40 
dÚe


43 [ 
$m©ch
 = 
NO
 ]; 
th’


44 
	gecho
 "skip $ts"

46 
fi


48 
	gts0_uri
=
$hls0_´efix
/
$ts


49 
ts1_uri
=
$hls1_´efix
/
$ts


50 
ts0_tmp
=
$wÜk_dœ
/
hls0
/`
ba£Çme
 
$ts
`

51 
ts1_tmp
=
$wÜk_dœ
/
hls1
/`
ba£Çme
 
$ts
`

54 
mkdœ
 -
p
 `
dœÇme
 
$ts0_tmp
` &&

55 
cu¾
 
$ts0_uri
 >
$ts0_tmp
 2>/
dev
/
nuÎ
 &&

56 
»t
=
$
?; [[ 
$»t
 -
Ã
 0 ]]; 
th’
 
	gecho
 "dowÆßd $ts0_ur˜tØ$ts0_tm°çed.„‘=$»t"; 
ex™
 
	g$»t
; 
fi


58 
	gmkdœ
 -
	gp
 `
dœÇme
 
	g$ts1_tmp
` &&

59 
cu¾
 
	g$ts1_uri
 >
	g$ts1_tmp
 2>/
	gdev
/
	gnuÎ
 &&

60 
	g»t
=
$
?; [[ 
$»t
 -
Ã
 0 ]]; 
th’
 
	gecho
 "dowÆßd $ts1_ur˜tØ$ts1_tm°çed.„‘=$»t"; 
ex™
 
	g$»t
; 
fi


62 [[ 
$md5_toŞ
 =ğ"md5" ]]; 
th’


63 
	gts0_cs
=`
$md5_toŞ
 
$ts0_tmp
|
awk
 '{print $4}'`

65 
ts0_cs
=`
$md5_toŞ
 
$ts0_tmp
|
awk
 '{print $1}'`

66 
fi


69 [[ 
$md5_toŞ
 =ğ"md5" ]]; 
th’


70 
	gts1_cs
=`
$md5_toŞ
 
$ts1_tmp
|
awk
 '{print $4}'`

72 
ts1_cs
=`
$md5_toŞ
 
$ts1_tmp
|
awk
 '{print $1}'`

73 
fi


76 [[ 
$ts0_cs
 !ğ
$ts1_cs
 ]]; 
th’


77 
	gecho
 "$ts0_uri($ts0_cs)‚otƒqualso $ts1_uri($ts1_cs)"

78 
	gOK
=
NO


79 
fi


80 
CHECKED
=
YES


81 
dÚe


83 [ 
$k“p_ts
 = 
NO
 ]; 
	gth’


85 
	grm
 -
rf
 
$wÜk_dœ


87 
	gecho
 "keep work dir $work_dir"

88 
	gfi


91 [[ 
$OK
 = 
YES
 && 
$CHECKED
 = YES ]]; 
th’


92 
	gecho
 "OK"

93 
	gex™
 0

95 
	gecho
 "FAILED"

96 
	gex™
 1

97 
fi


99 
	gex™
 0

	@trunk/research/players/api-server_index.html

1 <!
DOCTYPE
 
	ghtml
>

2 <
	ghtml
>

3 <
	gh—d
>

4 <
	gt™Ë
>
	gSRS
</title>

5 <
m‘a
 
	gch¬£t
="utf-8">

6 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="players/js/jquery-1.10.2.min.js"></script>

7 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="players/js/srs.page.js"></script>

8 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="players/js/srs.utility.js"></script>

9 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="players/js/winlin.utility.js"></script>

10 </
h—d
>

11 <
body
>

12 <
süt
 
ty³
="text/javascript">

13 
£tTimeout
(
	$funùiÚ
(){

14 
wšdow
.
loÿtiÚ
.
h»f
 = "¶ay”s/šdex.html" + wšdow.loÿtiÚ.
£¬ch
;

15 
	}
}, 500);

16 </
	gsüt
>

17 </
	gbody
>

	@trunk/research/players/css/bootstrap.min.css

9  .
	gş—rfix
{*
	gzoom
:1}.
ş—rfix
:
befÜe
,.ş—rfix:
aá”
{
di¥Ïy
:
bË
;
	glše
-
	gheight
:0;
	gcÚ‹Á
:""}.ş—rfix:aá”{
ş—r
:
bÙh
}.
hide
-
‹xt
{
fÚt
:0/0 
a
;
	gcŞÜ
:
Œª¥¬’t
;
	g‹xt
-
	gshadow
:
nÚe
;
	gbackground
-cŞÜ:Œª¥¬’t;
	gbÜd”
:0}.
šput
-
block
-
Ëv–
{di¥Ïy:block;
	gwidth
:100%;
	gmš
-height:30
px
;-
	gwebk™
-
	gbox
-
	gsizšg
:
bÜd”
-
box
;-
	gmoz
-box-sizšg:bÜd”-box;box-sizšg:bÜd”-box}
¬tişe
,
	gaside
,
	gd‘as
,
	gfigÿ±iÚ
,
	gfigu»
,
	gfoÙ”
,
	gh—d”
,
	ghgroup
,
	gÇv
,
	g£ùiÚ
{
	gdi¥Ïy
:block}
audio
,
	gÿnvas
,
	gvideo
{di¥Ïy:
šlše
-block;*di¥Ïy:šlše;*zoom:1}audio:
	$nÙ
([
cÚŒŞs
]){
di¥Ïy
:
nÚe
}html{fÚt-size:100%;-webk™-‹xt-size-adju¡:100%;-ms-‹xt-size-adju¡:100%}a:focus{ouše:thš dÙ‹d #333;ouše:5px‡utØ-webk™-focus-ršg-cŞÜ;ouše-off£t:-2px}a:hov”,a:aùive{ouše:0}sub,sup{pos™iÚ:»Ïtive;fÚt-size:75%;lše-height:0;v”tiÿl-®ign:ba£lše}sup{tİ:-0.5em}sub{bÙtom:-0.25em}img{width:auto\9;height:auto;max-width:100%;v”tiÿl-®ign:middË;bÜd”:0;-ms-š‹½Ş©iÚ-mode:bicubic}#m­_ÿnva img,.googË-m­ img{max-width:nÚe}bu‰Ú,šput,£Ëù,‹x»a{m¬gš:0;fÚt-size:100%;v”tiÿl-®ign:middË}bu‰Ú,šput{*ov”æow:visibË;lše-height:nÜm®}bu‰Ú::-moz-focus-šÃr,šput::-moz-focus-šÃr{·ddšg:0;bÜd”:0}bu‰Ú,htmÈšput[ty³="bu‰Ú"],šput[ty³="»£t"],šput[ty³="subm™"]{cursÜ:poš‹r;-webk™-­³¬ªû:bu‰Ú}Ïb–,£Ëù,bu‰Ú,šput[ty³="bu‰Ú"],šput[ty³="»£t"],šput[ty³="subm™"],šput[ty³="¿dio"],šput[ty³="checkbox"]{cursÜ:poš‹r}šput[ty³="£¬ch"]{-webk™-box-sizšg:cÚ‹Á-box;-moz-box-sizšg:cÚ‹Á-box;box-sizšg:cÚ‹Á-box;-webk™-­³¬ªû:‹xtf›ld}šput[ty³="£¬ch"]::-webk™-£¬ch-decÜ©iÚ,šput[ty³="£¬ch"]::-webk™-£¬ch-ÿnûl-bu‰Ú{-webk™-­³¬ªû:nÚe}‹x»a{ov”æow:auto;v”tiÿl-®ign:tİ}@medŸ…ršt{*{cŞÜ:#000!impÜÁ;‹xt-shadow:nÚe!impÜÁ;background:Œª¥¬’t!impÜÁ;box-shadow:nÚe!impÜÁ}a,a:vis™ed{‹xt-decÜ©iÚ:und”lše}a[h»f]:aá”{cÚ‹Á:" ("‡‰r(h»fè")"}abbr[t™Ë]:aá”{cÚ‹Á:" ("‡‰rÑ™Ëè")"}.œ‡:aá”,a[h»f^="javasüt:"]:aá”,a[h»f^="#"]:aá”{cÚ‹Á:""}´e,blockquÙe{bÜd”:1px sŞid #999;·ge--šside:avoid}th—d{di¥Ïy:bË-h—d”-group}Œ,img{·ge--šside:avoid}img{max-width:100%!impÜÁ}@·ge{m¬gš:.5cm}p,h2,h3{Üphªs:3;widows:3}h2,h3{·ge--aá”:avoid}}body{m¬gš:0;fÚt-çmy:"H–v‘iÿ Neue",H–v‘iÿ,ArŸl,§ns-£rif;fÚt-size:14px;lše-height:20px;cŞÜ:#333;background-cŞÜ:#fff}a{cŞÜ:#08c;‹xt-decÜ©iÚ:nÚe}a:hov”,a:focus{cŞÜ:#005580;‹xt-decÜ©iÚ:und”lše}.img-rounded{-webk™-bÜd”-¿dius:6px;-moz-bÜd”-¿dius:6px;bÜd”-¿dius:6px}.img-pŞ¬oid{·ddšg:4px;background-cŞÜ:#fff;bÜd”:1px sŞid #ccc;bÜd”:1px sŞid„gba(0,0,0,0.2);-webk™-box-shadow:0 1px 3px„gba(0,0,0,0.1);-moz-box-shadow:0 1px 3px„gba(0,0,0,0.1);box-shadow:0 1px 3px„gba(0,0,0,0.1)}.img-cœşe{-webk™-bÜd”-¿dius:500px;-moz-bÜd”-¿dius:500px;bÜd”-¿dius:500px}.row{m¬gš-Ëá:-20px;*zoom:1}.row:befÜe,.row:aá”{di¥Ïy:bË;lše-height:0;cÚ‹Á:""}.row:aá”{ş—r:bÙh}[şass*="¥ª"]{:Ëá;mš-height:1px;m¬gš-Ëá:20px}.cÚš”,.Çvb¬--tİ .cÚš”,.Çvb¬-fixed-tİ .cÚš”,.Çvb¬-fixed-bÙtom .cÚš”{width:940px}.¥ª12{width:940px}.¥ª11{width:860px}.¥ª10{width:780px}.¥ª9{width:700px}.¥ª8{width:620px}.¥ª7{width:540px}.¥ª6{width:460px}.¥ª5{width:380px}.¥ª4{width:300px}.¥ª3{width:220px}.¥ª2{width:140px}.¥ª1{width:60px}.off£t12{m¬gš-Ëá:980px}.off£t11{m¬gš-Ëá:900px}.off£t10{m¬gš-Ëá:820px}.off£t9{m¬gš-Ëá:740px}.off£t8{m¬gš-Ëá:660px}.off£t7{m¬gš-Ëá:580px}.off£t6{m¬gš-Ëá:500px}.off£t5{m¬gš-Ëá:420px}.off£t4{m¬gš-Ëá:340px}.off£t3{m¬gš-Ëá:260px}.off£t2{m¬gš-Ëá:180px}.off£t1{m¬gš-Ëá:100px}.row-æuid{width:100%;*zoom:1}.row-æuid:befÜe,.row-æuid:aá”{di¥Ïy:bË;lše-height:0;cÚ‹Á:""}.row-æuid:aá”{ş—r:bÙh}.row-æuid [şass*="¥ª"]{di¥Ïy:block;:Ëá;width:100%;mš-height:30px;m¬gš-Ëá:2.127659574468085%;*m¬gš-Ëá:2.074468085106383%;-webk™-box-sizšg:bÜd”-box;-moz-box-sizšg:bÜd”-box;box-sizšg:bÜd”-box}.row-æuid [şass*="¥ª"]:fœ¡-chd{m¬gš-Ëá:0}.row-æuid .cÚŒŞs-row [şass*="¥ª"]+[şass*="¥ª"]{m¬gš-Ëá:2.127659574468085%}.row-æuid .¥ª12{width:100%;*width:99.94680851063829%}.row-æuid .¥ª11{width:91.48936170212765%;*width:91.43617021276594%}.row-æuid .¥ª10{width:82.97872340425532%;*width:82.92553191489361%}.row-æuid .¥ª9{width:74.46808510638297%;*width:74.41489361702126%}.row-æuid .¥ª8{width:65.95744680851064%;*width:65.90425531914893%}.row-æuid .¥ª7{width:57.44680851063829%;*width:57.39361702127659%}.row-æuid .¥ª6{width:48.93617021276595%;*width:48.88297872340425%}.row-æuid .¥ª5{width:40.42553191489362%;*width:40.37234042553192%}.row-æuid .¥ª4{width:31.914893617021278%;*width:31.861702127659576%}.row-æuid .¥ª3{width:23.404255319148934%;*width:23.351063829787233%}.row-æuid .¥ª2{width:14.893617021276595%;*width:14.840425531914894%}.row-æuid .¥ª1{width:6.382978723404255%;*width:6.329787234042553%}.row-æuid .off£t12{m¬gš-Ëá:104.25531914893617%;*m¬gš-Ëá:104.14893617021275%}.row-æuid .off£t12:fœ¡-chd{m¬gš-Ëá:102.12765957446808%;*m¬gš-Ëá:102.02127659574467%}.row-æuid .off£t11{m¬gš-Ëá:95.74468085106382%;*m¬gš-Ëá:95.6382978723404%}.row-æuid .off£t11:fœ¡-chd{m¬gš-Ëá:93.61702127659574%;*m¬gš-Ëá:93.51063829787232%}.row-æuid .off£t10{m¬gš-Ëá:87.23404255319149%;*m¬gš-Ëá:87.12765957446807%}.row-æuid .off£t10:fœ¡-chd{m¬gš-Ëá:85.1063829787234%;*m¬gš-Ëá:84.99999999999999%}.row-æuid .off£t9{m¬gš-Ëá:78.72340425531914%;*m¬gš-Ëá:78.61702127659572%}.row-æuid .off£t9:fœ¡-chd{m¬gš-Ëá:76.59574468085106%;*m¬gš-Ëá:76.48936170212764%}.row-æuid .off£t8{m¬gš-Ëá:70.2127659574468%;*m¬gš-Ëá:70.10638297872339%}.row-æuid .off£t8:fœ¡-chd{m¬gš-Ëá:68.08510638297872%;*m¬gš-Ëá:67.9787234042553%}.row-æuid .off£t7{m¬gš-Ëá:61.70212765957446%;*m¬gš-Ëá:61.59574468085106%}.row-æuid .off£t7:fœ¡-chd{m¬gš-Ëá:59.574468085106375%;*m¬gš-Ëá:59.46808510638297%}.row-æuid .off£t6{m¬gš-Ëá:53.191489361702125%;*m¬gš-Ëá:53.085106382978715%}.row-æuid .off£t6:fœ¡-chd{m¬gš-Ëá:51.063829787234035%;*m¬gš-Ëá:50.95744680851063%}.row-æuid .off£t5{m¬gš-Ëá:44.68085106382979%;*m¬gš-Ëá:44.57446808510638%}.row-æuid .off£t5:fœ¡-chd{m¬gš-Ëá:42.5531914893617%;*m¬gš-Ëá:42.4468085106383%}.row-æuid .off£t4{m¬gš-Ëá:36.170212765957444%;*m¬gš-Ëá:36.06382978723405%}.row-æuid .off£t4:fœ¡-chd{m¬gš-Ëá:34.04255319148936%;*m¬gš-Ëá:33.93617021276596%}.row-æuid .off£t3{m¬gš-Ëá:27.659574468085104%;*m¬gš-Ëá:27.5531914893617%}.row-æuid .off£t3:fœ¡-chd{m¬gš-Ëá:25.53191489361702%;*m¬gš-Ëá:25.425531914893618%}.row-æuid .off£t2{m¬gš-Ëá:19.148936170212764%;*m¬gš-Ëá:19.04255319148936%}.row-æuid .off£t2:fœ¡-chd{m¬gš-Ëá:17.02127659574468%;*m¬gš-Ëá:16.914893617021278%}.row-æuid .off£t1{m¬gš-Ëá:10.638297872340425%;*m¬gš-Ëá:10.53191489361702%}.row-æuid .off£t1:fœ¡-chd{m¬gš-Ëá:8.51063829787234%;*m¬gš-Ëá:8.404255319148938%}[şass*="¥ª"].hide,.row-æuid [şass*="¥ª"].hide{di¥Ïy:nÚe}[şass*="¥ª"].puÎ-right,.row-æuid [şass*="¥ª"].puÎ-right{:right}.cÚš”{m¬gš-right:auto;m¬gš-Ëá:auto;*zoom:1}.cÚš”:befÜe,.cÚš”:aá”{di¥Ïy:bË;lše-height:0;cÚ‹Á:""}.cÚš”:aá”{ş—r:bÙh}.cÚš”-æuid{·ddšg-right:20px;·ddšg-Ëá:20px;*zoom:1}.cÚš”-æuid:befÜe,.cÚš”-æuid:aá”{di¥Ïy:bË;lše-height:0;cÚ‹Á:""}.cÚš”-æuid:aá”{ş—r:bÙh}p{m¬gš:0 0 10px}.Ëad{m¬gš-bÙtom:20px;fÚt-size:21px;fÚt-weight:200;lše-height:30px}sm®l{fÚt-size:85%}¡rÚg{fÚt-weight:bŞd}em{fÚt-¡yË:™®ic}c™e{fÚt-¡yË:nÜm®}.mu‹d{cŞÜ:#999}a.mu‹d:hov”,a.mu‹d:focus{cŞÜ:#808080}.‹xt-w¬nšg{cŞÜ:#c09853}a.‹xt-w¬nšg:hov”,a.‹xt-w¬nšg:focus{cŞÜ:#a47e3c}.‹xt-”rÜ{cŞÜ:#b94a48}a.‹xt-”rÜ:hov”,a.‹xt-”rÜ:focus{cŞÜ:#953b39}.‹xt-šfo{cŞÜ:#3a87ad}a.‹xt-šfo:hov”,a.‹xt-šfo:focus{cŞÜ:#2d6987}.‹xt-sucûss{cŞÜ:#468847}a.‹xt-sucûss:hov”,a.‹xt-sucûss:focus{cŞÜ:#356635}.‹xt-Ëá{‹xt-®ign:Ëá}.‹xt-right{‹xt-®ign:right}.‹xt-ûÁ”{‹xt-®ign:ûÁ”}h1,h2,h3,h4,h5,h6{m¬gš:10px 0;fÚt-çmy:šh”™;fÚt-weight:bŞd;lše-height:20px;cŞÜ:šh”™;‹xt-»nd”šg:İtimiz–egib™y}h1 sm®l,h2 sm®l,h3 sm®l,h4 sm®l,h5 sm®l,h6 sm®l{fÚt-weight:nÜm®;lše-height:1;cŞÜ:#999}h1,h2,h3{lše-height:40px}h1{fÚt-size:38.5px}h2{fÚt-size:31.5px}h3{fÚt-size:24.5px}h4{fÚt-size:17.5px}h5{fÚt-size:14px}h6{fÚt-size:11.9px}h1 sm®l{fÚt-size:24.5px}h2 sm®l{fÚt-size:17.5px}h3 sm®l{fÚt-size:14px}h4 sm®l{fÚt-size:14px}.·ge-h—d”{·ddšg-bÙtom:9px;m¬gš:20px 0 30px;bÜd”-bÙtom:1px sŞid #“e}ul,Ş{·ddšg:0;m¬gš:0 0 10px 25px}uÈul,uÈŞ,Ş ol,Ş ul{m¬gš-bÙtom:0}li{lše-height:20px}ul.un¡yËd,Ş.un¡yËd{m¬gš-Ëá:0;li¡-¡yË:nÚe}ul.šlše,Ş.šlše{m¬gš-Ëá:0;li¡-¡yË:nÚe}ul.šlše>li,Ş.šlše>li{di¥Ïy:šlše-block;*di¥Ïy:šlše;·ddšg-right:5px;·ddšg-Ëá:5px;*zoom:1}dl{m¬gš-bÙtom:20px}dt,dd{lše-height:20px}dt{fÚt-weight:bŞd}dd{m¬gš-Ëá:10px}.dl-hÜizÚl{*zoom:1}.dl-hÜizÚl:befÜe,.dl-hÜizÚl:aá”{di¥Ïy:bË;lše-height:0;cÚ‹Á:""}.dl-hÜizÚl:aá”{ş—r:bÙh}.dl-hÜizÚÈdt{:Ëá;width:160px;ov”æow:hidd’;ş—r:Ëá;‹xt-®ign:right;‹xt-ov”æow:–lsis;wh™e-¥aû:now¿p}.dl-hÜizÚÈdd{m¬gš-Ëá:180px}hr{m¬gš:20px 0;bÜd”:0;bÜd”-tİ:1px sŞid #“e;bÜd”-bÙtom:1px sŞid #fff}abbr[t™Ë],abbr[d©a-Üigš®-t™Ë]{cursÜ:h–p;bÜd”-bÙtom:1px dÙ‹d #999}abbr.š™Ÿlism{fÚt-size:90%;‹xt-ŒªsfÜm:uµ”ÿ£}blockquÙe{·ddšg:0 0 0 15px;m¬gš:0 0 20px;bÜd”-Ëá:5px sŞid #“e}blockquÙp{m¬gš-bÙtom:0;fÚt-size:17.5px;fÚt-weight:300;lše-height:1.25}blockquÙsm®l{di¥Ïy:block;lše-height:20px;cŞÜ:#999}blockquÙsm®l:befÜe{cÚ‹Á:'\2014 \00A0'}blockquÙe.puÎ-right{:right;·ddšg-right:15px;·ddšg-Ëá:0;bÜd”-right:5px sŞid #“e;bÜd”-Ëá:0}blockquÙe.puÎ-righˆp,blockquÙe.puÎ-righˆsm®l{‹xt-®ign:right}blockquÙe.puÎ-righˆsm®l:befÜe{cÚ‹Á:''}blockquÙe.puÎ-righˆsm®l:aá”{cÚ‹Á:'\00A0 \2014'}q:befÜe,q:aá”,blockquÙe:befÜe,blockquÙe:aá”{cÚ‹Á:""}add»ss{di¥Ïy:block;m¬gš-bÙtom:20px;fÚt-¡yË:nÜm®;lše-height:20px}code,´e{·ddšg:0 3px 2px;fÚt-çmy:MÚaco,M’lo,CÚsŞas,"Cour›¸New",mÚo¥aû;fÚt-size:12px;cŞÜ:#333;-webk™-bÜd”-¿dius:3px;-moz-bÜd”-¿dius:3px;bÜd”-¿dius:3px}code{·ddšg:2px 4px;cŞÜ:#d14;wh™e-¥aû:now¿p;background-cŞÜ:#f7f7f9;bÜd”:1px sŞid #e1e1e8}´e{di¥Ïy:block;·ddšg:9.5px;m¬gš:0 0 10px;fÚt-size:13px;lše-height:20px;wÜd-:-®l;wÜd-w¿p:-wÜd;wh™e-¥aû:´e;wh™e-¥aû:´e-w¿p;background-cŞÜ:#f5f5f5;bÜd”:1px sŞid #ccc;bÜd”:1px sŞid„gba(0,0,0,0.15);-webk™-bÜd”-¿dius:4px;-moz-bÜd”-¿dius:4px;bÜd”-¿dius:4px}´e.´‘ty´št{m¬gš-bÙtom:20px}´code{·ddšg:0;cŞÜ:šh”™;wh™e-¥aû:´e;wh™e-¥aû:´e-w¿p;background-cŞÜ:Œª¥¬’t;bÜd”:0}.´e-süŞÏbË{max-height:340px;ov”æow-y:süŞl}fÜm{m¬gš:0 0 20px}f›ld£t{·ddšg:0;m¬gš:0;bÜd”:0}Ëg’d{di¥Ïy:block;width:100%;·ddšg:0;m¬gš-bÙtom:20px;fÚt-size:21px;lše-height:40px;cŞÜ:#333;bÜd”:0;bÜd”-bÙtom:1px sŞid #e5e5e5}Ëg’d sm®l{fÚt-size:15px;cŞÜ:#999}Ïb–,šput,bu‰Ú,£Ëù,‹x»a{fÚt-size:14px;fÚt-weight:nÜm®;lše-height:20px}šput,bu‰Ú,£Ëù,‹x»a{fÚt-çmy:"H–v‘iÿ Neue",H–v‘iÿ,ArŸl,§ns-£rif}Ïb–{di¥Ïy:block;m¬gš-bÙtom:5px}£Ëù,‹x»a,šput[ty³="‹xt"],šput[ty³="·sswÜd"],šput[ty³="d©‘ime"],šput[ty³="d©‘ime-loÿl"],šput[ty³="d©e"],šput[ty³="mÚth"],šput[ty³="time"],šput[ty³="w“k"],šput[ty³="numb”"],šput[ty³="ema"],šput[ty³="u¾"],šput[ty³="£¬ch"],šput[ty³="‹l"],šput[ty³="cŞÜ"],.uÃd™abË-šput{di¥Ïy:šlše-block;height:20px;·ddšg:4px 6px;m¬gš-bÙtom:10px;fÚt-size:14px;lše-height:20px;cŞÜ:#555;v”tiÿl-®ign:middË;-webk™-bÜd”-¿dius:4px;-moz-bÜd”-¿dius:4px;bÜd”-¿dius:4px}šput,‹x»a,.uÃd™abË-šput{width:206px}‹x»a{height:auto}‹x»a,šput[ty³="‹xt"],šput[ty³="·sswÜd"],šput[ty³="d©‘ime"],šput[ty³="d©‘ime-loÿl"],šput[ty³="d©e"],šput[ty³="mÚth"],šput[ty³="time"],šput[ty³="w“k"],šput[ty³="numb”"],šput[ty³="ema"],šput[ty³="u¾"],šput[ty³="£¬ch"],šput[ty³="‹l"],šput[ty³="cŞÜ"],.uÃd™abË-šput{background-cŞÜ:#fff;bÜd”:1px sŞid #ccc;-webk™-box-shadow:š£ˆ0 1px 1px„gba(0,0,0,0.075);-moz-box-shadow:š£ˆ0 1px 1px„gba(0,0,0,0.075);box-shadow:š£ˆ0 1px 1px„gba(0,0,0,0.075);-webk™-Œªs™iÚ:bÜd”†š—¸.2s,box-shadow†š—¸.2s;-moz-Œªs™iÚ:bÜd”†š—¸.2s,box-shadow†š—¸.2s;-o-Œªs™iÚ:bÜd”†š—¸.2s,box-shadow†š—¸.2s;Œªs™iÚ:bÜd”†š—¸.2s,box-shadow†š—¸.2s}‹x»a:focus,šput[ty³="‹xt"]:focus,šput[ty³="·sswÜd"]:focus,šput[ty³="d©‘ime"]:focus,šput[ty³="d©‘ime-loÿl"]:focus,šput[ty³="d©e"]:focus,šput[ty³="mÚth"]:focus,šput[ty³="time"]:focus,šput[ty³="w“k"]:focus,šput[ty³="numb”"]:focus,šput[ty³="ema"]:focus,šput[ty³="u¾"]:focus,šput[ty³="£¬ch"]:focus,šput[ty³="‹l"]:focus,šput[ty³="cŞÜ"]:focus,.uÃd™abË-šput:focus{bÜd”-cŞÜ:rgba(82,168,236,0.8);ouše:0;ouše:thš dÙ‹d \9;-webk™-box-shadow:š£ˆ0 1px 1px„gba(0,0,0,0.075),0 0 8px„gba(82,168,236,0.6);-moz-box-shadow:š£ˆ0 1px 1px„gba(0,0,0,0.075),0 0 8px„gba(82,168,236,0.6);box-shadow:š£ˆ0 1px 1px„gba(0,0,0,0.075),0 0 8px„gba(82,168,236,0.6)}šput[ty³="¿dio"],šput[ty³="checkbox"]{m¬gš:4px 0 0;m¬gš-tİ:1px \9;*m¬gš-tİ:0;lše-height:nÜm®}šput[ty³="fe"],šput[ty³="image"],šput[ty³="subm™"],šput[ty³="»£t"],šput[ty³="bu‰Ú"],šput[ty³="¿dio"],šput[ty³="checkbox"]{width:auto}£Ëù,šput[ty³="fe"]{height:30px;*m¬gš-tİ:4px;lše-height:30px}£Ëù{width:220px;background-cŞÜ:#fff;bÜd”:1px sŞid #ccc}£Ëù[muÉË],£Ëù[size]{height:auto}£Ëù:focus,šput[ty³="fe"]:focus,šput[ty³="¿dio"]:focus,šput[ty³="checkbox"]:focus{ouše:thš dÙ‹d #333;ouše:5px‡utØ-webk™-focus-ršg-cŞÜ;ouše-off£t:-2px}.uÃd™abË-šput,.uÃd™abË-‹x»a{cŞÜ:#999;cursÜ:nÙ-®lowed;background-cŞÜ:#fcfcfc;bÜd”-cŞÜ:#ccc;-webk™-box-shadow:š£ˆ0 1px 2px„gba(0,0,0,0.025);-moz-box-shadow:š£ˆ0 1px 2px„gba(0,0,0,0.025);box-shadow:š£ˆ0 1px 2px„gba(0,0,0,0.025)}.uÃd™abË-šput{ov”æow:hidd’;wh™e-¥aû:now¿p}.uÃd™abË-‹x»a{width:auto;height:auto}šput:-moz-¶aûhŞd”,‹x»a:-moz-¶aûhŞd”{cŞÜ:#999}šput:-ms-šput-¶aûhŞd”,‹x»a:-ms-šput-¶aûhŞd”{cŞÜ:#999}šput::-webk™-šput-¶aûhŞd”,‹x»a::-webk™-šput-¶aûhŞd”{cŞÜ:#999}.¿dio,.checkbox{mš-height:20px;·ddšg-Ëá:20px}.¿diØšput[ty³="¿dio"],.checkbox iÅut[ty³="checkbox"]{:Ëá;m¬gš-Ëá:-20px}.cÚŒŞs>.¿dio:fœ¡-chd,.cÚŒŞs>.checkbox:fœ¡-chd{·ddšg-tİ:5px}.¿dio.šlše,.checkbox.šlše{di¥Ïy:šlše-block;·ddšg-tİ:5px;m¬gš-bÙtom:0;v”tiÿl-®ign:middË}.¿dio.šlše+.¿dio.šlše,.checkbox.šlše+.checkbox.šlše{m¬gš-Ëá:10px}.šput-mši{width:60px}.šput-sm®l{width:90px}.šput-medium{width:150px}.šput-Ïrge{width:210px}.šput-xÏrge{width:270px}.šput-xxÏrge{width:530px}šput[şass*="¥ª"],£Ëù[şass*="¥ª"],‹x»a[şass*="¥ª"],.uÃd™abË-šput[şass*="¥ª"],.row-æuid iÅut[şass*="¥ª"],.row-æuid s–eù[şass*="¥ª"],.row-æuidex»a[şass*="¥ª"],.row-æuid .uÃd™abË-šput[şass*="¥ª"]{:nÚe;m¬gš-Ëá:0}.šput-­³nd iÅut[şass*="¥ª"],.šput-­³nd .uÃd™abË-šput[şass*="¥ª"],.šput-´•’d iÅut[şass*="¥ª"],.šput-´•’d .uÃd™abË-šput[şass*="¥ª"],.row-æuid iÅut[şass*="¥ª"],.row-æuid s–eù[şass*="¥ª"],.row-æuidex»a[şass*="¥ª"],.row-æuid .uÃd™abË-šput[şass*="¥ª"],.row-æuid .šput-´•’d [şass*="¥ª"],.row-æuid .šput-­³nd [şass*="¥ª"]{di¥Ïy:šlše-block}šput,‹x»a,.uÃd™abË-šput{m¬gš-Ëá:0}.cÚŒŞs-row [şass*="¥ª"]+[şass*="¥ª"]{m¬gš-Ëá:20px}šput.¥ª12,‹x»a.¥ª12,.uÃd™abË-šput.¥ª12{width:926px}šput.¥ª11,‹x»a.¥ª11,.uÃd™abË-šput.¥ª11{width:846px}šput.¥ª10,‹x»a.¥ª10,.uÃd™abË-šput.¥ª10{width:766px}šput.¥ª9,‹x»a.¥ª9,.uÃd™abË-šput.¥ª9{width:686px}šput.¥ª8,‹x»a.¥ª8,.uÃd™abË-šput.¥ª8{width:606px}šput.¥ª7,‹x»a.¥ª7,.uÃd™abË-šput.¥ª7{width:526px}šput.¥ª6,‹x»a.¥ª6,.uÃd™abË-šput.¥ª6{width:446px}šput.¥ª5,‹x»a.¥ª5,.uÃd™abË-šput.¥ª5{width:366px}šput.¥ª4,‹x»a.¥ª4,.uÃd™abË-šput.¥ª4{width:286px}šput.¥ª3,‹x»a.¥ª3,.uÃd™abË-šput.¥ª3{width:206px}šput.¥ª2,‹x»a.¥ª2,.uÃd™abË-šput.¥ª2{width:126px}šput.¥ª1,‹x»a.¥ª1,.uÃd™abË-šput.¥ª1{width:46px}.cÚŒŞs-row{*zoom:1}.cÚŒŞs-row:befÜe,.cÚŒŞs-row:aá”{di¥Ïy:bË;lše-height:0;cÚ‹Á:""}.cÚŒŞs-row:aá”{ş—r:bÙh}.cÚŒŞs-row [şass*="¥ª"],.row-æuid .cÚŒŞs-row [şass*="¥ª"]{:Ëá}.cÚŒŞs-row .checkbox[şass*="¥ª"],.cÚŒŞs-row .¿dio[şass*="¥ª"]{·ddšg-tİ:5px}šput[di§bËd],£Ëù[di§bËd],‹x»a[di§bËd],šput[»adÚly],£Ëù[»adÚly],‹x»a[»adÚly]{cursÜ:nÙ-®lowed;background-cŞÜ:#“e}šput[ty³="¿dio"][di§bËd],šput[ty³="checkbox"][di§bËd],šput[ty³="¿dio"][»adÚly],šput[ty³="checkbox"][»adÚly]{background-cŞÜ:Œª¥¬’t}.cÚŒŞ-group.w¬nšg .cÚŒŞ-Ïb–,.cÚŒŞ-group.w¬nšg .h–p-block,.cÚŒŞ-group.w¬nšg .h–p-šlše{cŞÜ:#c09853}.cÚŒŞ-group.w¬nšg .checkbox,.cÚŒŞ-group.w¬nšg .¿dio,.cÚŒŞ-group.w¬nšg iÅut,.cÚŒŞ-group.w¬nšg s–eù,.cÚŒŞ-group.w¬nšgex»a{cŞÜ:#c09853}.cÚŒŞ-group.w¬nšg iÅut,.cÚŒŞ-group.w¬nšg s–eù,.cÚŒŞ-group.w¬nšgex»a{bÜd”-cŞÜ:#c09853;-webk™-box-shadow:š£ˆ0 1px 1px„gba(0,0,0,0.075);-moz-box-shadow:š£ˆ0 1px 1px„gba(0,0,0,0.075);box-shadow:š£ˆ0 1px 1px„gba(0,0,0,0.075)}.cÚŒŞ-group.w¬nšg iÅut:focus,.cÚŒŞ-group.w¬nšg s–eù:focus,.cÚŒŞ-group.w¬nšgex»a:focus{bÜd”-cŞÜ:#a47e3c;-webk™-box-shadow:š£ˆ0 1px 1px„gba(0,0,0,0.075),0 0 6px #dbc59e;-moz-box-shadow:š£ˆ0 1px 1px„gba(0,0,0,0.075),0 0 6px #dbc59e;box-shadow:š£ˆ0 1px 1px„gba(0,0,0,0.075),0 0 6px #dbc59e}.cÚŒŞ-group.w¬nšg .šput-´•’d .add-Ú,.cÚŒŞ-group.w¬nšg .šput-­³nd .add-Ú{cŞÜ:#c09853;background-cŞÜ:#fcf8e3;bÜd”-cŞÜ:#c09853}.cÚŒŞ-group.”rÜ .cÚŒŞ-Ïb–,.cÚŒŞ-group.”rÜ .h–p-block,.cÚŒŞ-group.”rÜ .h–p-šlše{cŞÜ:#b94a48}.cÚŒŞ-group.”rÜ .checkbox,.cÚŒŞ-group.”rÜ .¿dio,.cÚŒŞ-group.”rÜ iÅut,.cÚŒŞ-group.”rÜ s–eù,.cÚŒŞ-group.”rÜex»a{cŞÜ:#b94a48}.cÚŒŞ-group.”rÜ iÅut,.cÚŒŞ-group.”rÜ s–eù,.cÚŒŞ-group.”rÜex»a{bÜd”-cŞÜ:#b94a48;-webk™-box-shadow:š£ˆ0 1px 1px„gba(0,0,0,0.075);-moz-box-shadow:š£ˆ0 1px 1px„gba(0,0,0,0.075);box-shadow:š£ˆ0 1px 1px„gba(0,0,0,0.075)}.cÚŒŞ-group.”rÜ iÅut:focus,.cÚŒŞ-group.”rÜ s–eù:focus,.cÚŒŞ-group.”rÜex»a:focus{bÜd”-cŞÜ:#953b39;-webk™-box-shadow:š£ˆ0 1px 1px„gba(0,0,0,0.075),0 0 6px #d59392;-moz-box-shadow:š£ˆ0 1px 1px„gba(0,0,0,0.075),0 0 6px #d59392;box-shadow:š£ˆ0 1px 1px„gba(0,0,0,0.075),0 0 6px #d59392}.cÚŒŞ-group.”rÜ .šput-´•’d .add-Ú,.cÚŒŞ-group.”rÜ .šput-­³nd .add-Ú{cŞÜ:#b94a48;background-cŞÜ:#f2dede;bÜd”-cŞÜ:#b94a48}.cÚŒŞ-group.sucûs .cÚŒŞ-Ïb–,.cÚŒŞ-group.sucûs .h–p-block,.cÚŒŞ-group.sucûs .h–p-šlše{cŞÜ:#468847}.cÚŒŞ-group.sucûs .checkbox,.cÚŒŞ-group.sucûs .¿dio,.cÚŒŞ-group.sucûs šput,.cÚŒŞ-group.sucûs £Ëù,.cÚŒŞ-group.sucûs ‹x»a{cŞÜ:#468847}.cÚŒŞ-group.sucûs šput,.cÚŒŞ-group.sucûs £Ëù,.cÚŒŞ-group.sucûs ‹x»a{bÜd”-cŞÜ:#468847;-webk™-box-shadow:š£ˆ0 1px 1px„gba(0,0,0,0.075);-moz-box-shadow:š£ˆ0 1px 1px„gba(0,0,0,0.075);box-shadow:š£ˆ0 1px 1px„gba(0,0,0,0.075)}.cÚŒŞ-group.sucûs šput:focus,.cÚŒŞ-group.sucûs £Ëù:focus,.cÚŒŞ-group.sucûs ‹x»a:focus{bÜd”-cŞÜ:#356635;-webk™-box-shadow:š£ˆ0 1px 1px„gba(0,0,0,0.075),0 0 6px #7aba7b;-moz-box-shadow:š£ˆ0 1px 1px„gba(0,0,0,0.075),0 0 6px #7aba7b;box-shadow:š£ˆ0 1px 1px„gba(0,0,0,0.075),0 0 6px #7aba7b}.cÚŒŞ-group.sucûs .šput-´•’d .add-Ú,.cÚŒŞ-group.sucûs .šput-­³nd .add-Ú{cŞÜ:#468847;background-cŞÜ:#dff0d8;bÜd”-cŞÜ:#468847}.cÚŒŞ-group.šfØ.cÚŒŞ-Ïb–,.cÚŒŞ-group.šfØ.h–p-block,.cÚŒŞ-group.šfØ.h–p-šlše{cŞÜ:#3a87ad}.cÚŒŞ-group.šfØ.checkbox,.cÚŒŞ-group.šfØ.¿dio,.cÚŒŞ-group.šfØšput,.cÚŒŞ-group.šfØ£Ëù,.cÚŒŞ-group.šfØ‹x»a{cŞÜ:#3a87ad}.cÚŒŞ-group.šfØšput,.cÚŒŞ-group.šfØ£Ëù,.cÚŒŞ-group.šfØ‹x»a{bÜd”-cŞÜ:#3a87ad;-webk™-box-shadow:š£ˆ0 1px 1px„gba(0,0,0,0.075);-moz-box-shadow:š£ˆ0 1px 1px„gba(0,0,0,0.075);box-shadow:š£ˆ0 1px 1px„gba(0,0,0,0.075)}.cÚŒŞ-group.šfØšput:focus,.cÚŒŞ-group.šfØ£Ëù:focus,.cÚŒŞ-group.šfØ‹x»a:focus{bÜd”-cŞÜ:#2d6987;-webk™-box-shadow:š£ˆ0 1px 1px„gba(0,0,0,0.075),0 0 6px #7ab5d3;-moz-box-shadow:š£ˆ0 1px 1px„gba(0,0,0,0.075),0 0 6px #7ab5d3;box-shadow:š£ˆ0 1px 1px„gba(0,0,0,0.075),0 0 6px #7ab5d3}.cÚŒŞ-group.šfØ.šput-´•’d .add-Ú,.cÚŒŞ-group.šfØ.šput-­³nd .add-Ú{cŞÜ:#3a87ad;background-cŞÜ:#d9edf7;bÜd”-cŞÜ:#3a87ad}šput:focus:šv®id,‹x»a:focus:šv®id,£Ëù:focus:šv®id{cŞÜ:#b94a48;bÜd”-cŞÜ:#“5f5b}šput:focus:šv®id:focus,‹x»a:focus:šv®id:focus,£Ëù:focus:šv®id:focus{bÜd”-cŞÜ:#e9322d;-webk™-box-shadow:0 0 6px #f8b9b7;-moz-box-shadow:0 0 6px #f8b9b7;box-shadow:0 0 6px #f8b9b7}.fÜm-aùiÚs{·ddšg:19px 20px 20px;m¬gš-tİ:20px;m¬gš-bÙtom:20px;background-cŞÜ:#f5f5f5;bÜd”-tİ:1px sŞid #e5e5e5;*zoom:1}.fÜm-aùiÚs:befÜe,.fÜm-aùiÚs:aá”{di¥Ïy:bË;lše-height:0;cÚ‹Á:""}.fÜm-aùiÚs:aá”{ş—r:bÙh}.h–p-block,.h–p-šlše{cŞÜ:#595959}.h–p-block{di¥Ïy:block;m¬gš-bÙtom:10px}.h–p-šlše{di¥Ïy:šlše-block;*di¥Ïy:šlše;·ddšg-Ëá:5px;v”tiÿl-®ign:middË;*zoom:1}.šput-­³nd,.šput-´•’d{di¥Ïy:šlše-block;m¬gš-bÙtom:10px;fÚt-size:0;wh™e-¥aû:now¿p;v”tiÿl-®ign:middË}.šput-­³nd iÅut,.šput-´•’d iÅut,.šput-­³nd s–eù,.šput-´•’d s–eù,.šput-­³nd .uÃd™abË-šput,.šput-´•’d .uÃd™abË-šput,.šput-­³nd .drİdown-m’u,.šput-´•’d .drİdown-m’u,.šput-­³nd .pİov”,.šput-´•’d .pİov”{fÚt-size:14px}.šput-­³nd iÅut,.šput-´•’d iÅut,.šput-­³nd s–eù,.šput-´•’d s–eù,.šput-­³nd .uÃd™abË-šput,.šput-´•’d .uÃd™abË-šput{pos™iÚ:»Ïtive;m¬gš-bÙtom:0;*m¬gš-Ëá:0;v”tiÿl-®ign:tİ;-webk™-bÜd”-¿dius:0 4px 4px 0;-moz-bÜd”-¿dius:0 4px 4px 0;bÜd”-¿dius:0 4px 4px 0}.šput-­³nd iÅut:focus,.šput-´•’d iÅut:focus,.šput-­³nd s–eù:focus,.šput-´•’d s–eù:focus,.šput-­³nd .uÃd™abË-šput:focus,.šput-´•’d .uÃd™abË-šput:focus{z-šdex:2}.šput-­³nd .add-Ú,.šput-´•’d .add-Ú{di¥Ïy:šlše-block;width:auto;height:20px;mš-width:16px;·ddšg:4px 5px;fÚt-size:14px;fÚt-weight:nÜm®;lše-height:20px;‹xt-®ign:ûÁ”;‹xt-shadow:0 1px 0 #fff;background-cŞÜ:#“e;bÜd”:1px sŞid #ccc}.šput-­³nd .add-Ú,.šput-´•’d .add-Ú,.šput-­³nd .bŠ,.šput-´•’d .bŠ,.šput-­³nd .bŠ-group>.drİdown-toggË,.šput-´•’d .bŠ-group>.drİdown-toggË{v”tiÿl-®ign:tİ;-webk™-bÜd”-¿dius:0;-moz-bÜd”-¿dius:0;bÜd”-¿dius:0}.šput-­³nd .aùive,.šput-´•’d .aùive{background-cŞÜ:#a9dba9;bÜd”-cŞÜ:#46a546}.šput-´•’d .add-Ú,.šput-´•’d .bŠ{m¬gš-right:-1px}.šput-´•’d .add-Ú:fœ¡-chd,.šput-´•’d .bŠ:fœ¡-chd{-webk™-bÜd”-¿dius:4px 0 0 4px;-moz-bÜd”-¿dius:4px 0 0 4px;bÜd”-¿dius:4px 0 0 4px}.šput-­³nd iÅut,.šput-­³nd s–eù,.šput-­³nd .uÃd™abË-šput{-webk™-bÜd”-¿dius:4px 0 0 4px;-moz-bÜd”-¿dius:4px 0 0 4px;bÜd”-¿dius:4px 0 0 4px}.šput-­³nd iÅut+.bŠ-grou°.bŠ:Ï¡-chd,.šput-­³nd s–eù+.bŠ-grou°.bŠ:Ï¡-chd,.šput-­³nd .uÃd™abË-šput+.bŠ-grou°.bŠ:Ï¡-chd{-webk™-bÜd”-¿dius:0 4px 4px 0;-moz-bÜd”-¿dius:0 4px 4px 0;bÜd”-¿dius:0 4px 4px 0}.šput-­³nd .add-Ú,.šput-­³nd .bŠ,.šput-­³nd .bŠ-group{m¬gš-Ëá:-1px}.šput-­³nd .add-Ú:Ï¡-chd,.šput-­³nd .bŠ:Ï¡-chd,.šput-­³nd .bŠ-group:Ï¡-chd>.drİdown-toggË{-webk™-bÜd”-¿dius:0 4px 4px 0;-moz-bÜd”-¿dius:0 4px 4px 0;bÜd”-¿dius:0 4px 4px 0}.šput-´•’d.šput-­³nd iÅut,.šput-´•’d.šput-­³nd s–eù,.šput-´•’d.šput-­³nd .uÃd™abË-šput{-webk™-bÜd”-¿dius:0;-moz-bÜd”-¿dius:0;bÜd”-¿dius:0}.šput-´•’d.šput-­³nd iÅut+.bŠ-grou°.bŠ,.šput-´•’d.šput-­³nd s–eù+.bŠ-grou°.bŠ,.šput-´•’d.šput-­³nd .uÃd™abË-šput+.bŠ-grou°.bŠ{-webk™-bÜd”-¿dius:0 4px 4px 0;-moz-bÜd”-¿dius:0 4px 4px 0;bÜd”-¿dius:0 4px 4px 0}.šput-´•’d.šput-­³nd .add-Ú:fœ¡-chd,.šput-´•’d.šput-­³nd .bŠ:fœ¡-chd{m¬gš-right:-1px;-webk™-bÜd”-¿dius:4px 0 0 4px;-moz-bÜd”-¿dius:4px 0 0 4px;bÜd”-¿dius:4px 0 0 4px}.šput-´•’d.šput-­³nd .add-Ú:Ï¡-chd,.šput-´•’d.šput-­³nd .bŠ:Ï¡-chd{m¬gš-Ëá:-1px;-webk™-bÜd”-¿dius:0 4px 4px 0;-moz-bÜd”-¿dius:0 4px 4px 0;bÜd”-¿dius:0 4px 4px 0}.šput-´•’d.šput-­³nd .bŠ-group:fœ¡-chd{m¬gš-Ëá:0}šput.£¬ch-qu”y{·ddšg-right:14px;·ddšg-right:4px \9;·ddšg-Ëá:14px;·ddšg-Ëá:4px \9;m¬gš-bÙtom:0;-webk™-bÜd”-¿dius:15px;-moz-bÜd”-¿dius:15px;bÜd”-¿dius:15px}.fÜm-£¬ch .šput-­³nd .£¬ch-qu”y,.fÜm-£¬ch .šput-´•’d .£¬ch-qu”y{-webk™-bÜd”-¿dius:0;-moz-bÜd”-¿dius:0;bÜd”-¿dius:0}.fÜm-£¬ch .šput-­³nd .£¬ch-qu”y{-webk™-bÜd”-¿dius:14px 0 0 14px;-moz-bÜd”-¿dius:14px 0 0 14px;bÜd”-¿dius:14px 0 0 14px}.fÜm-£¬ch .šput-­³nd .bŠ{-webk™-bÜd”-¿dius:0 14px 14px 0;-moz-bÜd”-¿dius:0 14px 14px 0;bÜd”-¿dius:0 14px 14px 0}.fÜm-£¬ch .šput-´•’d .£¬ch-qu”y{-webk™-bÜd”-¿dius:0 14px 14px 0;-moz-bÜd”-¿dius:0 14px 14px 0;bÜd”-¿dius:0 14px 14px 0}.fÜm-£¬ch .šput-´•’d .bŠ{-webk™-bÜd”-¿dius:14px 0 0 14px;-moz-bÜd”-¿dius:14px 0 0 14px;bÜd”-¿dius:14px 0 0 14px}.fÜm-£¬ch iÅut,.fÜm-šlššput,.fÜm-hÜizÚÈšput,.fÜm-£¬chex»a,.fÜm-šlš‹x»a,.fÜm-hÜizÚÈ‹x»a,.fÜm-£¬ch s–eù,.fÜm-šlš£Ëù,.fÜm-hÜizÚÈ£Ëù,.fÜm-£¬ch .h–p-šlše,.fÜm-šlš.h–p-šlše,.fÜm-hÜizÚÈ.h–p-šlše,.fÜm-£¬ch .uÃd™abË-šput,.fÜm-šlš.uÃd™abË-šput,.fÜm-hÜizÚÈ.uÃd™abË-šput,.fÜm-£¬ch .šput-´•’d,.fÜm-šlš.šput-´•’d,.fÜm-hÜizÚÈ.šput-´•’d,.fÜm-£¬ch .šput-­³nd,.fÜm-šlš.šput-­³nd,.fÜm-hÜizÚÈ.šput-­³nd{di¥Ïy:šlše-block;*di¥Ïy:šlše;m¬gš-bÙtom:0;v”tiÿl-®ign:middË;*zoom:1}.fÜm-£¬ch .hide,.fÜm-šlš.hide,.fÜm-hÜizÚÈ.hide{di¥Ïy:nÚe}.fÜm-£¬ch†ab–,.fÜm-šlšÏb–,.fÜm-£¬ch .bŠ-group,.fÜm-šlš.bŠ-group{di¥Ïy:šlše-block}.fÜm-£¬ch .šput-­³nd,.fÜm-šlš.šput-­³nd,.fÜm-£¬ch .šput-´•’d,.fÜm-šlš.šput-´•’d{m¬gš-bÙtom:0}.fÜm-£¬ch .¿dio,.fÜm-£¬ch .checkbox,.fÜm-šlš.¿dio,.fÜm-šlš.checkbox{·ddšg-Ëá:0;m¬gš-bÙtom:0;v”tiÿl-®ign:middË}.fÜm-£¬ch .¿diØšput[ty³="¿dio"],.fÜm-£¬ch .checkbox iÅut[ty³="checkbox"],.fÜm-šlš.¿diØšput[ty³="¿dio"],.fÜm-šlš.checkbox iÅut[ty³="checkbox"]{:Ëá;m¬gš-right:3px;m¬gš-Ëá:0}.cÚŒŞ-group{m¬gš-bÙtom:10px}Ëg’d+.cÚŒŞ-group{m¬gš-tİ:20px;-webk™-m¬gš-tİ-cŞÏp£:£·¿‹}.fÜm-hÜizÚÈ.cÚŒŞ-group{m¬gš-bÙtom:20px;*zoom:1}.fÜm-hÜizÚÈ.cÚŒŞ-group:befÜe,.fÜm-hÜizÚÈ.cÚŒŞ-group:aá”{di¥Ïy:bË;lše-height:0;cÚ‹Á:""}.fÜm-hÜizÚÈ.cÚŒŞ-group:aá”{ş—r:bÙh}.fÜm-hÜizÚÈ.cÚŒŞ-Ïb–{:Ëá;width:160px;·ddšg-tİ:5px;‹xt-®ign:right}.fÜm-hÜizÚÈ.cÚŒŞs{*di¥Ïy:šlše-block;*·ddšg-Ëá:20px;m¬gš-Ëá:180px;*m¬gš-Ëá:0}.fÜm-hÜizÚÈ.cÚŒŞs:fœ¡-chd{*·ddšg-Ëá:180px}.fÜm-hÜizÚÈ.h–p-block{m¬gš-bÙtom:0}.fÜm-hÜizÚÈšput+.h–p-block,.fÜm-hÜizÚÈ£Ëù+.h–p-block,.fÜm-hÜizÚÈ‹x»a+.h–p-block,.fÜm-hÜizÚÈ.uÃd™abË-šput+.h–p-block,.fÜm-hÜizÚÈ.šput-´•’d+.h–p-block,.fÜm-hÜizÚÈ.šput-­³nd+.h–p-block{m¬gš-tİ:10px}.fÜm-hÜizÚÈ.fÜm-aùiÚs{·ddšg-Ëá:180px}bË{max-width:100%;background-cŞÜ:Œª¥¬’t;bÜd”-cŞÏp£:cŞÏp£;bÜd”-¥acšg:0}.bË{width:100%;m¬gš-bÙtom:20px}.bËh,.bËd{·ddšg:8px;lše-height:20px;‹xt-®ign:Ëá;v”tiÿl-®ign:tİ;bÜd”-tİ:1px sŞid #ddd}.bËh{fÚt-weight:bŞd}.bËh—dh{v”tiÿl-®ign:bÙtom}.bË c­tiÚ+th—dr:fœ¡-chdh,.bË c­tiÚ+th—dr:fœ¡-chdd,.bË cŞgroup+th—dr:fœ¡-chdh,.bË cŞgroup+th—dr:fœ¡-chdd,.bËh—d:fœ¡-chdr:fœ¡-chdh,.bËh—d:fœ¡-chdr:fœ¡-chdd{bÜd”-tİ:0}.bËbody+tbody{bÜd”-tİ:2px sŞid #ddd}.bË .bË{background-cŞÜ:#fff}.bË-cÚd’£dh,.bË-cÚd’£dd{·ddšg:4px 5px}.bË-bÜd”ed{bÜd”:1px sŞid #ddd;bÜd”-cŞÏp£:£·¿‹;*bÜd”-cŞÏp£:cŞÏp£;bÜd”-Ëá:0;-webk™-bÜd”-¿dius:4px;-moz-bÜd”-¿dius:4px;bÜd”-¿dius:4px}.bË-bÜd”edh,.bË-bÜd”edd{bÜd”-Ëá:1px sŞid #ddd}.bË-bÜd”ed c­tiÚ+th—dr:fœ¡-chdh,.bË-bÜd”ed c­tiÚ+tbodyr:fœ¡-chdh,.bË-bÜd”ed c­tiÚ+tbodyr:fœ¡-chdd,.bË-bÜd”ed cŞgroup+th—dr:fœ¡-chdh,.bË-bÜd”ed cŞgroup+tbodyr:fœ¡-chdh,.bË-bÜd”ed cŞgroup+tbodyr:fœ¡-chdd,.bË-bÜd”edh—d:fœ¡-chdr:fœ¡-chdh,.bË-bÜd”edbody:fœ¡-chdr:fœ¡-chdh,.bË-bÜd”edbody:fœ¡-chdr:fœ¡-chdd{bÜd”-tİ:0}.bË-bÜd”edh—d:fœ¡-chdr:fœ¡-chd>th:fœ¡-chd,.bË-bÜd”edbody:fœ¡-chdr:fœ¡-chd>td:fœ¡-chd,.bË-bÜd”edbody:fœ¡-chdr:fœ¡-chd>th:fœ¡-chd{-webk™-bÜd”-tİ-Ëá-¿dius:4px;bÜd”-tİ-Ëá-¿dius:4px;-moz-bÜd”-¿dius-tİËá:4px}.bË-bÜd”edh—d:fœ¡-chdr:fœ¡-chd>th:Ï¡-chd,.bË-bÜd”edbody:fœ¡-chdr:fœ¡-chd>td:Ï¡-chd,.bË-bÜd”edbody:fœ¡-chdr:fœ¡-chd>th:Ï¡-chd{-webk™-bÜd”-tİ-right-¿dius:4px;bÜd”-tİ-right-¿dius:4px;-moz-bÜd”-¿dius-tİright:4px}.bË-bÜd”edh—d:Ï¡-chdr:Ï¡-chd>th:fœ¡-chd,.bË-bÜd”edbody:Ï¡-chdr:Ï¡-chd>td:fœ¡-chd,.bË-bÜd”edbody:Ï¡-chdr:Ï¡-chd>th:fœ¡-chd,.bË-bÜd”edfoÙ:Ï¡-chdr:Ï¡-chd>td:fœ¡-chd,.bË-bÜd”edfoÙ:Ï¡-chdr:Ï¡-chd>th:fœ¡-chd{-webk™-bÜd”-bÙtom-Ëá-¿dius:4px;bÜd”-bÙtom-Ëá-¿dius:4px;-moz-bÜd”-¿dius-bÙtomËá:4px}.bË-bÜd”edh—d:Ï¡-chdr:Ï¡-chd>th:Ï¡-chd,.bË-bÜd”edbody:Ï¡-chdr:Ï¡-chd>td:Ï¡-chd,.bË-bÜd”edbody:Ï¡-chdr:Ï¡-chd>th:Ï¡-chd,.bË-bÜd”edfoÙ:Ï¡-chdr:Ï¡-chd>td:Ï¡-chd,.bË-bÜd”edfoÙ:Ï¡-chdr:Ï¡-chd>th:Ï¡-chd{-webk™-bÜd”-bÙtom-right-¿dius:4px;bÜd”-bÙtom-right-¿dius:4px;-moz-bÜd”-¿dius-bÙtomright:4px}.bË-bÜd”edfoÙ+tbody:Ï¡-chdr:Ï¡-chdd:fœ¡-chd{-webk™-bÜd”-bÙtom-Ëá-¿dius:0;bÜd”-bÙtom-Ëá-¿dius:0;-moz-bÜd”-¿dius-bÙtomËá:0}.bË-bÜd”edfoÙ+tbody:Ï¡-chdr:Ï¡-chdd:Ï¡-chd{-webk™-bÜd”-bÙtom-right-¿dius:0;bÜd”-bÙtom-right-¿dius:0;-moz-bÜd”-¿dius-bÙtomright:0}.bË-bÜd”ed c­tiÚ+th—dr:fœ¡-chdh:fœ¡-chd,.bË-bÜd”ed c­tiÚ+tbodyr:fœ¡-chdd:fœ¡-chd,.bË-bÜd”ed cŞgroup+th—dr:fœ¡-chdh:fœ¡-chd,.bË-bÜd”ed cŞgroup+tbodyr:fœ¡-chdd:fœ¡-chd{-webk™-bÜd”-tİ-Ëá-¿dius:4px;bÜd”-tİ-Ëá-¿dius:4px;-moz-bÜd”-¿dius-tİËá:4px}.bË-bÜd”ed c­tiÚ+th—dr:fœ¡-chdh:Ï¡-chd,.bË-bÜd”ed c­tiÚ+tbodyr:fœ¡-chdd:Ï¡-chd,.bË-bÜd”ed cŞgroup+th—dr:fœ¡-chdh:Ï¡-chd,.bË-bÜd”ed cŞgroup+tbodyr:fœ¡-chdd:Ï¡-chd{-webk™-bÜd”-tİ-right-¿dius:4px;bÜd”-tİ-right-¿dius:4px;-moz-bÜd”-¿dius-tİright:4px}.bË-¡redbody>Œ:Áh-chd(odd)>td,.bË-¡redbody>Œ:Áh-chd(odd)>th{background-cŞÜ:#f9f9f9}.bË-hov”bodyr:hov”>td,.bË-hov”bodyr:hov”>th{background-cŞÜ:#f5f5f5}bËd[şass*="¥ª"],bËh[şass*="¥ª"],.row-æuidabËd[şass*="¥ª"],.row-æuidabËh[şass*="¥ª"]{di¥Ïy:bË-ûÎ;:nÚe;m¬gš-Ëá:0}.bËd.¥ª1,.bËh.¥ª1{:nÚe;width:44px;m¬gš-Ëá:0}.bËd.¥ª2,.bËh.¥ª2{:nÚe;width:124px;m¬gš-Ëá:0}.bËd.¥ª3,.bËh.¥ª3{:nÚe;width:204px;m¬gš-Ëá:0}.bËd.¥ª4,.bËh.¥ª4{:nÚe;width:284px;m¬gš-Ëá:0}.bËd.¥ª5,.bËh.¥ª5{:nÚe;width:364px;m¬gš-Ëá:0}.bËd.¥ª6,.bËh.¥ª6{:nÚe;width:444px;m¬gš-Ëá:0}.bËd.¥ª7,.bËh.¥ª7{:nÚe;width:524px;m¬gš-Ëá:0}.bËd.¥ª8,.bËh.¥ª8{:nÚe;width:604px;m¬gš-Ëá:0}.bËd.¥ª9,.bËh.¥ª9{:nÚe;width:684px;m¬gš-Ëá:0}.bËd.¥ª10,.bËh.¥ª10{:nÚe;width:764px;m¬gš-Ëá:0}.bËd.¥ª11,.bËh.¥ª11{:nÚe;width:844px;m¬gš-Ëá:0}.bËd.¥ª12,.bËh.¥ª12{:nÚe;width:924px;m¬gš-Ëá:0}.bËbodyr.sucûss>td{background-cŞÜ:#dff0d8}.bËbodyr.”rÜ>td{background-cŞÜ:#f2dede}.bËbodyr.w¬nšg>td{background-cŞÜ:#fcf8e3}.bËbodyr.šfo>td{background-cŞÜ:#d9edf7}.bË-hov”bodyr.sucûss:hov”>td{background-cŞÜ:#d0e9c6}.bË-hov”bodyr.”rÜ:hov”>td{background-cŞÜ:#ebcccc}.bË-hov”bodyr.w¬nšg:hov”>td{background-cŞÜ:#çf2cc}.bË-hov”bodyr.šfo:hov”>td{background-cŞÜ:#c4e3f3}[şass^="icÚ-"],[şass*=" icÚ-"]{di¥Ïy:šlše-block;width:14px;height:14px;m¬gš-tİ:1px;*m¬gš-right:.3em;lše-height:14px;v”tiÿl-®ign:‹xt-tİ;background-image:u¾("../img/glyphicÚs-h®æšgs.²g");background-pos™iÚ:14px 14px;background-»³©:no-»³©}.icÚ-wh™e,.Çv-pls>.aùive>a>[şass^="icÚ-"],.Çv-pls>.aùive>a>[şass*=" icÚ-"],.Çv-li¡>.aùive>a>[şass^="icÚ-"],.Çv-li¡>.aùive>a>[şass*=" icÚ-"],.Çvb¬-šv”£ .Çv>.aùive>a>[şass^="icÚ-"],.Çvb¬-šv”£ .Çv>.aùive>a>[şass*=" icÚ-"],.drİdown-m’u>li>a:hov”>[şass^="icÚ-"],.drİdown-m’u>li>a:focus>[şass^="icÚ-"],.drİdown-m’u>li>a:hov”>[şass*=" icÚ-"],.drİdown-m’u>li>a:focus>[şass*=" icÚ-"],.drİdown-m’u>.aùive>a>[şass^="icÚ-"],.drİdown-m’u>.aùive>a>[şass*=" icÚ-"],.drİdown-subm’u:hov”>a>[şass^="icÚ-"],.drİdown-subm’u:focus>a>[şass^="icÚ-"],.drİdown-subm’u:hov”>a>[şass*=" icÚ-"],.drİdown-subm’u:focus>a>[şass*=" icÚ-"]{background-image:u¾("../img/glyphicÚs-h®æšgs-wh™e.²g")}.icÚ-gÏss{background-pos™iÚ:0 0}.icÚ-music{background-pos™iÚ:-24px 0}.icÚ-£¬ch{background-pos™iÚ:-48px 0}.icÚ-’v–İe{background-pos™iÚ:-72px 0}.icÚ-h—¹{background-pos™iÚ:-96px 0}.icÚ-¡¬{background-pos™iÚ:-120px 0}.icÚ-¡¬-em±y{background-pos™iÚ:-144px 0}.icÚ-u£r{background-pos™iÚ:-168px 0}.icÚ-fm{background-pos™iÚ:-192px 0}.icÚ-th-Ïrge{background-pos™iÚ:-216px 0}.icÚ-th{background-pos™iÚ:-240px 0}.icÚ-th-li¡{background-pos™iÚ:-264px 0}.icÚ-ok{background-pos™iÚ:-288px 0}.icÚ-»move{background-pos™iÚ:-312px 0}.icÚ-zoom-š{background-pos™iÚ:-336px 0}.icÚ-zoom-out{background-pos™iÚ:-360px 0}.icÚ-off{background-pos™iÚ:-384px 0}.icÚ-sigÇl{background-pos™iÚ:-408px 0}.icÚ-cog{background-pos™iÚ:-432px 0}.icÚ-Œash{background-pos™iÚ:-456px 0}.icÚ-home{background-pos™iÚ:0 -24px}.icÚ-fe{background-pos™iÚ:-24px -24px}.icÚ-time{background-pos™iÚ:-48px -24px}.icÚ-rßd{background-pos™iÚ:-72px -24px}.icÚ-dowÆßd-®t{background-pos™iÚ:-96px -24px}.icÚ-dowÆßd{background-pos™iÚ:-120px -24px}.icÚ-u¶ßd{background-pos™iÚ:-144px -24px}.icÚ-šbox{background-pos™iÚ:-168px -24px}.icÚ-¶ay-cœşe{background-pos™iÚ:-192px -24px}.icÚ-»³©{background-pos™iÚ:-216px -24px}.icÚ-»äesh{background-pos™iÚ:-240px -24px}.icÚ-li¡-®t{background-pos™iÚ:-264px -24px}.icÚ-lock{background-pos™iÚ:-287px -24px}.icÚ-æag{background-pos™iÚ:-312px -24px}.icÚ-h—dphÚes{background-pos™iÚ:-336px -24px}.icÚ-vŞume-off{background-pos™iÚ:-360px -24px}.icÚ-vŞume-down{background-pos™iÚ:-384px -24px}.icÚ-vŞume-up{background-pos™iÚ:-408px -24px}.icÚ-qrcode{background-pos™iÚ:-432px -24px}.icÚ-b¬code{background-pos™iÚ:-456px -24px}.icÚ-g{background-pos™iÚ:0 -48px}.icÚ-gs{background-pos™iÚ:-25px -48px}.icÚ-book{background-pos™iÚ:-48px -48px}.icÚ-bookm¬k{background-pos™iÚ:-72px -48px}.icÚ-´št{background-pos™iÚ:-96px -48px}.icÚ-ÿm”a{background-pos™iÚ:-120px -48px}.icÚ-fÚt{background-pos™iÚ:-144px -48px}.icÚ-bŞd{background-pos™iÚ:-167px -48px}.icÚ-™®ic{background-pos™iÚ:-192px -48px}.icÚ-‹xt-height{background-pos™iÚ:-216px -48px}.icÚ-‹xt-width{background-pos™iÚ:-240px -48px}.icÚ-®ign-Ëá{background-pos™iÚ:-264px -48px}.icÚ-®ign-ûÁ”{background-pos™iÚ:-288px -48px}.icÚ-®ign-right{background-pos™iÚ:-312px -48px}.icÚ-®ign-ju¡ify{background-pos™iÚ:-336px -48px}.icÚ-li¡{background-pos™iÚ:-360px -48px}.icÚ-šd’t-Ëá{background-pos™iÚ:-384px -48px}.icÚ-šd’t-right{background-pos™iÚ:-408px -48px}.icÚ-çûtime-video{background-pos™iÚ:-432px -48px}.icÚ-piùu»{background-pos™iÚ:-456px -48px}.icÚ-³nc{background-pos™iÚ:0 -72px}.icÚ-m­-m¬k”{background-pos™iÚ:-24px -72px}.icÚ-adju¡{background-pos™iÚ:-48px -72px}.icÚ-tšt{background-pos™iÚ:-72px -72px}.icÚ-ed™{background-pos™iÚ:-96px -72px}.icÚ-sh¬e{background-pos™iÚ:-120px -72px}.icÚ-check{background-pos™iÚ:-144px -72px}.icÚ-move{background-pos™iÚ:-168px -72px}.icÚ-¡•-backw¬d{background-pos™iÚ:-192px -72px}.icÚ-ç¡-backw¬d{background-pos™iÚ:-216px -72px}.icÚ-backw¬d{background-pos™iÚ:-240px -72px}.icÚ-¶ay{background-pos™iÚ:-264px -72px}.icÚ-·u£{background-pos™iÚ:-288px -72px}.icÚ-¡İ{background-pos™iÚ:-312px -72px}.icÚ-fÜw¬d{background-pos™iÚ:-336px -72px}.icÚ-ç¡-fÜw¬d{background-pos™iÚ:-360px -72px}.icÚ-¡•-fÜw¬d{background-pos™iÚ:-384px -72px}.icÚ-ejeù{background-pos™iÚ:-408px -72px}.icÚ-chevrÚ-Ëá{background-pos™iÚ:-432px -72px}.icÚ-chevrÚ-right{background-pos™iÚ:-456px -72px}.icÚ-¶us-sign{background-pos™iÚ:0 -96px}.icÚ-mšus-sign{background-pos™iÚ:-24px -96px}.icÚ-»move-sign{background-pos™iÚ:-48px -96px}.icÚ-ok-sign{background-pos™iÚ:-72px -96px}.icÚ-que¡iÚ-sign{background-pos™iÚ:-96px -96px}.icÚ-šfo-sign{background-pos™iÚ:-120px -96px}.icÚ-sü“nshÙ{background-pos™iÚ:-144px -96px}.icÚ-»move-cœşe{background-pos™iÚ:-168px -96px}.icÚ-ok-cœşe{background-pos™iÚ:-192px -96px}.icÚ-bª-cœşe{background-pos™iÚ:-216px -96px}.icÚ-¬row-Ëá{background-pos™iÚ:-240px -96px}.icÚ-¬row-right{background-pos™iÚ:-264px -96px}.icÚ-¬row-up{background-pos™iÚ:-289px -96px}.icÚ-¬row-down{background-pos™iÚ:-312px -96px}.icÚ-sh¬e-®t{background-pos™iÚ:-336px -96px}.icÚ-»size-fuÎ{background-pos™iÚ:-360px -96px}.icÚ-»size-sm®l{background-pos™iÚ:-384px -96px}.icÚ-¶us{background-pos™iÚ:-408px -96px}.icÚ-mšus{background-pos™iÚ:-433px -96px}.icÚ-a¡”isk{background-pos™iÚ:-456px -96px}.icÚ-exşam©iÚ-sign{background-pos™iÚ:0 -120px}.icÚ-giá{background-pos™iÚ:-24px -120px}.icÚ-Ëaf{background-pos™iÚ:-48px -120px}.icÚ-fœe{background-pos™iÚ:-72px -120px}.icÚ-eye-İ’{background-pos™iÚ:-96px -120px}.icÚ-eye-şo£{background-pos™iÚ:-120px -120px}.icÚ-w¬nšg-sign{background-pos™iÚ:-144px -120px}.icÚ-¶ªe{background-pos™iÚ:-168px -120px}.icÚ-ÿËnd¬{background-pos™iÚ:-192px -120px}.icÚ-¿ndom{width:16px;background-pos™iÚ:-216px -120px}.icÚ-comm’t{background-pos™iÚ:-240px -120px}.icÚ-magÃt{background-pos™iÚ:-264px -120px}.icÚ-chevrÚ-up{background-pos™iÚ:-288px -120px}.icÚ-chevrÚ-down{background-pos™iÚ:-313px -119px}.icÚ-»tw“t{background-pos™iÚ:-336px -120px}.icÚ-shİpšg-ÿ¹{background-pos™iÚ:-360px -120px}.icÚ-fŞd”-şo£{width:16px;background-pos™iÚ:-384px -120px}.icÚ-fŞd”-İ’{width:16px;background-pos™iÚ:-408px -120px}.icÚ-»size-v”tiÿl{background-pos™iÚ:-432px -119px}.icÚ-»size-hÜizÚl{background-pos™iÚ:-456px -118px}.icÚ-hdd{background-pos™iÚ:0 -144px}.icÚ-buÎhÜn{background-pos™iÚ:-24px -144px}.icÚ-b–l{background-pos™iÚ:-48px -144px}.icÚ-û¹ifiÿ‹{background-pos™iÚ:-72px -144px}.icÚ-thumbs-up{background-pos™iÚ:-96px -144px}.icÚ-thumbs-down{background-pos™iÚ:-120px -144px}.icÚ-hªd-right{background-pos™iÚ:-144px -144px}.icÚ-hªd-Ëá{background-pos™iÚ:-168px -144px}.icÚ-hªd-up{background-pos™iÚ:-192px -144px}.icÚ-hªd-down{background-pos™iÚ:-216px -144px}.icÚ-cœşe-¬row-right{background-pos™iÚ:-240px -144px}.icÚ-cœşe-¬row-Ëá{background-pos™iÚ:-264px -144px}.icÚ-cœşe-¬row-up{background-pos™iÚ:-288px -144px}.icÚ-cœşe-¬row-down{background-pos™iÚ:-312px -144px}.icÚ-globe{background-pos™iÚ:-336px -144px}.icÚ-w»nch{background-pos™iÚ:-360px -144px}.icÚ-sks{background-pos™iÚ:-384px -144px}.icÚ-f‹r{background-pos™iÚ:-408px -144px}.icÚ-br›fÿ£{background-pos™iÚ:-432px -144px}.icÚ-fuÎsü“n{background-pos™iÚ:-456px -144px}.drİup,.drİdown{pos™iÚ:»Ïtive}.drİdown-toggË{*m¬gš-bÙtom:-3px}.drİdown-toggË:aùive,.İ’ .drİdown-toggË{ouše:0}.ÿ»t{di¥Ïy:šlše-block;width:0;height:0;v”tiÿl-®ign:tİ;bÜd”-tİ:4px sŞid #000;bÜd”-right:4px sŞid¿n¥¬’t;bÜd”-Ëá:4px sŞid¿n¥¬’t;cÚ‹Á:""}.drİdowÀ.ÿ»t{m¬gš-tİ:8px;m¬gš-Ëá:2px}.drİdown-m’u{pos™iÚ:absŞu‹;tİ:100%;Ëá:0;z-šdex:1000;di¥Ïy:nÚe;:Ëá;mš-width:160px;·ddšg:5px 0;m¬gš:2px 0 0;li¡-¡yË:nÚe;background-cŞÜ:#fff;bÜd”:1px sŞid #ccc;bÜd”:1px sŞid„gba(0,0,0,0.2);*bÜd”-right-width:2px;*bÜd”-bÙtom-width:2px;-webk™-bÜd”-¿dius:6px;-moz-bÜd”-¿dius:6px;bÜd”-¿dius:6px;-webk™-box-shadow:0 5px 10px„gba(0,0,0,0.2);-moz-box-shadow:0 5px 10px„gba(0,0,0,0.2);box-shadow:0 5px 10px„gba(0,0,0,0.2);-webk™-background-ş:·ddšg-box;-moz-background-ş:·ddšg;background-ş:·ddšg-box}.drİdown-m’u.puÎ-right{right:0;Ëá:auto}.drİdown-m’u .divid”{*width:100%;height:1px;m¬gš:9px 1px;*m¬gš:-5px 0 5px;ov”æow:hidd’;background-cŞÜ:#e5e5e5;bÜd”-bÙtom:1px sŞid #fff}.drİdown-m’u>li>a{di¥Ïy:block;·ddšg:3px 20px;ş—r:bÙh;fÚt-weight:nÜm®;lše-height:20px;cŞÜ:#333;wh™e-¥aû:now¿p}.drİdown-m’u>li>a:hov”,.drİdown-m’u>li>a:focus,.drİdown-subm’u:hov”>a,.drİdown-subm’u:focus>a{cŞÜ:#fff;‹xt-decÜ©iÚ:nÚe;background-cŞÜ:#0081c2;background-image:-moz-lš—r-g¿d›ÁÑİ,#08c,#0077b3);background-image:-webk™-g¿d›ÁÖš—r,0 0,0 100%,äom(#08c),to(#0077b3));background-image:-webk™-lš—r-g¿d›ÁÑİ,#08c,#0077b3);background-image:-o-lš—r-g¿d›ÁÑİ,#08c,#0077b3);background-image:lš—r-g¿d›ÁÑØbÙtom,#08c,#0077b3);background-»³©:»³©-x;f‹r:´ogid:DXImageT¿nsfÜm.Miüosoá.g¿d›Á(¡¬tCŞÜ¡r='#ff0088cc',’dCŞÜ¡r='#ff0077b3',G¿d›ÁTy³=0)}.drİdown-m’u>.aùive>a,.drİdown-m’u>.aùive>a:hov”,.drİdown-m’u>.aùive>a:focus{cŞÜ:#fff;‹xt-decÜ©iÚ:nÚe;background-cŞÜ:#0081c2;background-image:-moz-lš—r-g¿d›ÁÑİ,#08c,#0077b3);background-image:-webk™-g¿d›ÁÖš—r,0 0,0 100%,äom(#08c),to(#0077b3));background-image:-webk™-lš—r-g¿d›ÁÑİ,#08c,#0077b3);background-image:-o-lš—r-g¿d›ÁÑİ,#08c,#0077b3);background-image:lš—r-g¿d›ÁÑØbÙtom,#08c,#0077b3);background-»³©:»³©-x;ouše:0;f‹r:´ogid:DXImageT¿nsfÜm.Miüosoá.g¿d›Á(¡¬tCŞÜ¡r='#ff0088cc',’dCŞÜ¡r='#ff0077b3',G¿d›ÁTy³=0)}.drİdown-m’u>.di§bËd>a,.drİdown-m’u>.di§bËd>a:hov”,.drİdown-m’u>.di§bËd>a:focus{cŞÜ:#999}.drİdown-m’u>.di§bËd>a:hov”,.drİdown-m’u>.di§bËd>a:focus{‹xt-decÜ©iÚ:nÚe;cursÜ:;background-cŞÜ:Œª¥¬’t;background-image:nÚe;f‹r:´ogid:DXImageT¿nsfÜm.Miüosoá.g¿d›ÁÓÇbËd=çl£)}.İ’{*z-šdex:1000}.İ’>.drİdown-m’u{di¥Ïy:block}.drİdown-backdrİ{pos™iÚ:fixed;tİ:0;right:0;bÙtom:0;Ëá:0;z-šdex:990}.puÎ-right>.drİdown-m’u{right:0;Ëá:auto}.drİu°.ÿ»t,.Çvb¬-fixed-bÙtom .drİdowÀ.ÿ»t{bÜd”-tİ:0;bÜd”-bÙtom:4px sŞid #000;cÚ‹Á:""}.drİu°.drİdown-m’u,.Çvb¬-fixed-bÙtom .drİdowÀ.drİdown-m’u{tİ:auto;bÙtom:100%;m¬gš-bÙtom:1px}.drİdown-subm’u{pos™iÚ:»Ïtive}.drİdown-subm’u>.drİdown-m’u{tİ:0;Ëá:100%;m¬gš-tİ:-6px;m¬gš-Ëá:-1px;-webk™-bÜd”-¿dius:0 6px 6px 6px;-moz-bÜd”-¿dius:0 6px 6px 6px;bÜd”-¿dius:0 6px 6px 6px}.drİdown-subm’u:hov”>.drİdown-m’u{di¥Ïy:block}.drİu°.drİdown-subm’u>.drİdown-m’u{tİ:auto;bÙtom:0;m¬gš-tİ:0;m¬gš-bÙtom:-2px;-webk™-bÜd”-¿dius:5px 5px 5px 0;-moz-bÜd”-¿dius:5px 5px 5px 0;bÜd”-¿dius:5px 5px 5px 0}.drİdown-subm’u>a:aá”{di¥Ïy:block;:right;width:0;height:0;m¬gš-tİ:5px;m¬gš-right:-10px;bÜd”-cŞÜ:Œª¥¬’t;bÜd”-Ëá-cŞÜ:#ccc;bÜd”-¡yË:sŞid;bÜd”-width:5px 0 5px 5px;cÚ‹Á:" "}.drİdown-subm’u:hov”>a:aá”{bÜd”-Ëá-cŞÜ:#fff}.drİdown-subm’u.puÎ-Ëá{:nÚe}.drİdown-subm’u.puÎ-Ëá>.drİdown-m’u{Ëá:-100%;m¬gš-Ëá:10px;-webk™-bÜd”-¿dius:6px 0 6px 6px;-moz-bÜd”-¿dius:6px 0 6px 6px;bÜd”-¿dius:6px 0 6px 6px}.drİdowÀ.drİdown-m’u .Çv-h—d”{·ddšg-right:20px;·ddšg-Ëá:20px}.ty³ah—d{z-šdex:1051;m¬gš-tİ:2px;-webk™-bÜd”-¿dius:4px;-moz-bÜd”-¿dius:4px;bÜd”-¿dius:4px}.w–l{mš-height:20px;·ddšg:19px;m¬gš-bÙtom:20px;background-cŞÜ:#f5f5f5;bÜd”:1px sŞid #e3e3e3;-webk™-bÜd”-¿dius:4px;-moz-bÜd”-¿dius:4px;bÜd”-¿dius:4px;-webk™-box-shadow:š£ˆ0 1px 1px„gba(0,0,0,0.05);-moz-box-shadow:š£ˆ0 1px 1px„gba(0,0,0,0.05);box-shadow:š£ˆ0 1px 1px„gba(0,0,0,0.05)}.w–ÈblockquÙe{bÜd”-cŞÜ:#ddd;bÜd”-cŞÜ:rgba(0,0,0,0.15)}.w–l-Ïrge{·ddšg:24px;-webk™-bÜd”-¿dius:6px;-moz-bÜd”-¿dius:6px;bÜd”-¿dius:6px}.w–l-sm®l{·ddšg:9px;-webk™-bÜd”-¿dius:3px;-moz-bÜd”-¿dius:3px;bÜd”-¿dius:3px}.çde{İac™y:0;-webk™-Œªs™iÚ:İac™y .15 lš—r;-moz-Œªs™iÚ:İac™y .15 lš—r;-o-Œªs™iÚ:İac™y .15 lš—r;Œªs™iÚ:İac™y .15 lš—r}.çde.š{İac™y:1}.cŞÏp£{pos™iÚ:»Ïtive;height:0;ov”æow:hidd’;-webk™-Œªs™iÚ:heighˆ.35 —£;-moz-Œªs™iÚ:heighˆ.35 —£;-o-Œªs™iÚ:heighˆ.35 —£;Œªs™iÚ:heighˆ.35 —£}.cŞÏp£.š{height:auto}.şo£{:right;fÚt-size:20px;fÚt-weight:bŞd;lše-height:20px;cŞÜ:#000;‹xt-shadow:0 1px 0 #fff;İac™y:.2;f‹r:®pha(İac™y=20)}.şo£:hov”,.şo£:focus{cŞÜ:#000;‹xt-decÜ©iÚ:nÚe;cursÜ:poš‹r;İac™y:.4;f‹r:®pha(İac™y=40)}bu‰Ú.şo£{·ddšg:0;cursÜ:poš‹r;background:Œª¥¬’t;bÜd”:0;-webk™-­³¬ªû:nÚe}.bŠ{di¥Ïy:šlše-block;*di¥Ïy:šlše;·ddšg:4px 12px;m¬gš-bÙtom:0;*m¬gš-Ëá:.3em;fÚt-size:14px;lše-height:20px;cŞÜ:#333;‹xt-®ign:ûÁ”;‹xt-shadow:0 1px 1px„gba(255,255,255,0.75);v”tiÿl-®ign:middË;cursÜ:poš‹r;background-cŞÜ:#f5f5f5;*background-cŞÜ:#e6e6e6;background-image:-moz-lš—r-g¿d›ÁÑİ,#fff,#e6e6e6);background-image:-webk™-g¿d›ÁÖš—r,0 0,0 100%,äom(#fff),to(#e6e6e6));background-image:-webk™-lš—r-g¿d›ÁÑİ,#fff,#e6e6e6);background-image:-o-lš—r-g¿d›ÁÑİ,#fff,#e6e6e6);background-image:lš—r-g¿d›ÁÑØbÙtom,#fff,#e6e6e6);background-»³©:»³©-x;bÜd”:1px sŞid #ccc;*bÜd”:0;bÜd”-cŞÜ:#e6e6e6 #e6e6e6 #bfbfbf;bÜd”-cŞÜ:rgba(0,0,0,0.1èrgba(0,0,0,0.1èrgba(0,0,0,0.25);bÜd”-bÙtom-cŞÜ:#b3b3b3;-webk™-bÜd”-¿dius:4px;-moz-bÜd”-¿dius:4px;bÜd”-¿dius:4px;f‹r:´ogid:DXImageT¿nsfÜm.Miüosoá.g¿d›Á(¡¬tCŞÜ¡r='#ffffffff',’dCŞÜ¡r='#fã6e6e6',G¿d›ÁTy³=0);f‹r:´ogid:DXImageT¿nsfÜm.Miüosoá.g¿d›ÁÓÇbËd=çl£);*zoom:1;-webk™-box-shadow:š£ˆ0 1px 0„gba(255,255,255,0.2),0 1px 2px„gba(0,0,0,0.05);-moz-box-shadow:š£ˆ0 1px 0„gba(255,255,255,0.2),0 1px 2px„gba(0,0,0,0.05);box-shadow:š£ˆ0 1px 0„gba(255,255,255,0.2),0 1px 2px„gba(0,0,0,0.05)}.bŠ:hov”,.bŠ:focus,.bŠ:aùive,.bŠ.aùive,.bŠ.di§bËd,.bŠ[di§bËd]{cŞÜ:#333;background-cŞÜ:#e6e6e6;*background-cŞÜ:#d9d9d9}.bŠ:aùive,.bŠ.aùive{background-cŞÜ:#ccø\9}.bŠ:fœ¡-chd{*m¬gš-Ëá:0}.bŠ:hov”,.bŠ:focus{cŞÜ:#333;‹xt-decÜ©iÚ:nÚe;background-pos™iÚ:0 -15px;-webk™-Œªs™iÚ:background-pos™iÚ .1 lš—r;-moz-Œªs™iÚ:background-pos™iÚ .1 lš—r;-o-Œªs™iÚ:background-pos™iÚ .1 lš—r;Œªs™iÚ:background-pos™iÚ .1 lš—r}.bŠ:focus{ouše:thš dÙ‹d #333;ouše:5px‡utØ-webk™-focus-ršg-cŞÜ;ouše-off£t:-2px}.bŠ.aùive,.bŠ:aùive{background-image:nÚe;ouše:0;-webk™-box-shadow:š£ˆ0 2px 4px„gba(0,0,0,0.15),0 1px 2px„gba(0,0,0,0.05);-moz-box-shadow:š£ˆ0 2px 4px„gba(0,0,0,0.15),0 1px 2px„gba(0,0,0,0.05);box-shadow:š£ˆ0 2px 4px„gba(0,0,0,0.15),0 1px 2px„gba(0,0,0,0.05)}.bŠ.di§bËd,.bŠ[di§bËd]{cursÜ:;background-image:nÚe;İac™y:.65;f‹r:®pha(İac™y=65);-webk™-box-shadow:nÚe;-moz-box-shadow:nÚe;box-shadow:nÚe}.bŠ-Ïrge{·ddšg:11px 19px;fÚt-size:17.5px;-webk™-bÜd”-¿dius:6px;-moz-bÜd”-¿dius:6px;bÜd”-¿dius:6px}.bŠ-Ïrg[şass^="icÚ-"],.bŠ-Ïrg[şass*=" icÚ-"]{m¬gš-tİ:4px}.bŠ-sm®l{·ddšg:2px 10px;fÚt-size:11.9px;-webk™-bÜd”-¿dius:3px;-moz-bÜd”-¿dius:3px;bÜd”-¿dius:3px}.bŠ-sm®È[şass^="icÚ-"],.bŠ-sm®È[şass*=" icÚ-"]{m¬gš-tİ:0}.bŠ-mš˜[şass^="icÚ-"],.bŠ-mš˜[şass*=" icÚ-"]{m¬gš-tİ:-1px}.bŠ-mši{·ddšg:0 6px;fÚt-size:10.5px;-webk™-bÜd”-¿dius:3px;-moz-bÜd”-¿dius:3px;bÜd”-¿dius:3px}.bŠ-block{di¥Ïy:block;width:100%;·ddšg-right:0;·ddšg-Ëá:0;-webk™-box-sizšg:bÜd”-box;-moz-box-sizšg:bÜd”-box;box-sizšg:bÜd”-box}.bŠ-block+.bŠ-block{m¬gš-tİ:5px}šput[ty³="subm™"].bŠ-block,šput[ty³="»£t"].bŠ-block,šput[ty³="bu‰Ú"].bŠ-block{width:100%}.bŠ-´im¬y.aùive,.bŠ-w¬nšg.aùive,.bŠ-dªg”.aùive,.bŠ-sucûss.aùive,.bŠ-šfo.aùive,.bŠ-šv”£.aùive{cŞÜ:rgba(255,255,255,0.75)}.bŠ-´im¬y{cŞÜ:#fff;‹xt-shadow:0 -1px 0„gba(0,0,0,0.25);background-cŞÜ:#006dcc;*background-cŞÜ:#04c;background-image:-moz-lš—r-g¿d›ÁÑİ,#08c,#04c);background-image:-webk™-g¿d›ÁÖš—r,0 0,0 100%,äom(#08c),to(#04c));background-image:-webk™-lš—r-g¿d›ÁÑİ,#08c,#04c);background-image:-o-lš—r-g¿d›ÁÑİ,#08c,#04c);background-image:lš—r-g¿d›ÁÑØbÙtom,#08c,#04c);background-»³©:»³©-x;bÜd”-cŞÜ:#04ø#04ø#002a80;bÜd”-cŞÜ:rgba(0,0,0,0.1èrgba(0,0,0,0.1èrgba(0,0,0,0.25);f‹r:´ogid:DXImageT¿nsfÜm.Miüosoá.g¿d›Á(¡¬tCŞÜ¡r='#ff0088cc',’dCŞÜ¡r='#ff0044cc',G¿d›ÁTy³=0);f‹r:´ogid:DXImageT¿nsfÜm.Miüosoá.g¿d›ÁÓÇbËd=çl£)}.bŠ-´im¬y:hov”,.bŠ-´im¬y:focus,.bŠ-´im¬y:aùive,.bŠ-´im¬y.aùive,.bŠ-´im¬y.di§bËd,.bŠ-´im¬y[di§bËd]{cŞÜ:#fff;background-cŞÜ:#04c;*background-cŞÜ:#003bb3}.bŠ-´im¬y:aùive,.bŠ-´im¬y.aùive{background-cŞÜ:#039 \9}.bŠ-w¬nšg{cŞÜ:#fff;‹xt-shadow:0 -1px 0„gba(0,0,0,0.25);background-cŞÜ:#ça732;*background-cŞÜ:#f89406;background-image:-moz-lš—r-g¿d›ÁÑİ,#fbb450,#f89406);background-image:-webk™-g¿d›ÁÖš—r,0 0,0 100%,äom(#fbb450),to(#f89406));background-image:-webk™-lš—r-g¿d›ÁÑİ,#fbb450,#f89406);background-image:-o-lš—r-g¿d›ÁÑİ,#fbb450,#f89406);background-image:lš—r-g¿d›ÁÑØbÙtom,#fbb450,#f89406);background-»³©:»³©-x;bÜd”-cŞÜ:#f89406 #f89406 #ad6704;bÜd”-cŞÜ:rgba(0,0,0,0.1èrgba(0,0,0,0.1èrgba(0,0,0,0.25);f‹r:´ogid:DXImageT¿nsfÜm.Miüosoá.g¿d›Á(¡¬tCŞÜ¡r='#fffbb450',’dCŞÜ¡r='#fff89406',G¿d›ÁTy³=0);f‹r:´ogid:DXImageT¿nsfÜm.Miüosoá.g¿d›ÁÓÇbËd=çl£)}.bŠ-w¬nšg:hov”,.bŠ-w¬nšg:focus,.bŠ-w¬nšg:aùive,.bŠ-w¬nšg.aùive,.bŠ-w¬nšg.di§bËd,.bŠ-w¬nšg[di§bËd]{cŞÜ:#fff;background-cŞÜ:#f89406;*background-cŞÜ:#df8505}.bŠ-w¬nšg:aùive,.bŠ-w¬nšg.aùive{background-cŞÜ:#c67605 \9}.bŠ-dªg”{cŞÜ:#fff;‹xt-shadow:0 -1px 0„gba(0,0,0,0.25);background-cŞÜ:#da4f49;*background-cŞÜ:#bd362f;background-image:-moz-lš—r-g¿d›ÁÑİ,#“5f5b,#bd362f);background-image:-webk™-g¿d›ÁÖš—r,0 0,0 100%,äom(#“5f5b),to(#bd362f));background-image:-webk™-lš—r-g¿d›ÁÑİ,#“5f5b,#bd362f);background-image:-o-lš—r-g¿d›ÁÑİ,#“5f5b,#bd362f);background-image:lš—r-g¿d›ÁÑØbÙtom,#“5f5b,#bd362f);background-»³©:»³©-x;bÜd”-cŞÜ:#bd362à#bd362à#802420;bÜd”-cŞÜ:rgba(0,0,0,0.1èrgba(0,0,0,0.1èrgba(0,0,0,0.25);f‹r:´ogid:DXImageT¿nsfÜm.Miüosoá.g¿d›Á(¡¬tCŞÜ¡r='#fãe5f5b',’dCŞÜ¡r='#ffbd362f',G¿d›ÁTy³=0);f‹r:´ogid:DXImageT¿nsfÜm.Miüosoá.g¿d›ÁÓÇbËd=çl£)}.bŠ-dªg”:hov”,.bŠ-dªg”:focus,.bŠ-dªg”:aùive,.bŠ-dªg”.aùive,.bŠ-dªg”.di§bËd,.bŠ-dªg”[di§bËd]{cŞÜ:#fff;background-cŞÜ:#bd362f;*background-cŞÜ:#a9302a}.bŠ-dªg”:aùive,.bŠ-dªg”.aùive{background-cŞÜ:#942a25 \9}.bŠ-sucûss{cŞÜ:#fff;‹xt-shadow:0 -1px 0„gba(0,0,0,0.25);background-cŞÜ:#5bb75b;*background-cŞÜ:#51a351;background-image:-moz-lš—r-g¿d›ÁÑİ,#62c462,#51a351);background-image:-webk™-g¿d›ÁÖš—r,0 0,0 100%,äom(#62c462),to(#51a351));background-image:-webk™-lš—r-g¿d›ÁÑİ,#62c462,#51a351);background-image:-o-lš—r-g¿d›ÁÑİ,#62c462,#51a351);background-image:lš—r-g¿d›ÁÑØbÙtom,#62c462,#51a351);background-»³©:»³©-x;bÜd”-cŞÜ:#51a351 #51a351 #387038;bÜd”-cŞÜ:rgba(0,0,0,0.1èrgba(0,0,0,0.1èrgba(0,0,0,0.25);f‹r:´ogid:DXImageT¿nsfÜm.Miüosoá.g¿d›Á(¡¬tCŞÜ¡r='#ff62c462',’dCŞÜ¡r='#ff51a351',G¿d›ÁTy³=0);f‹r:´ogid:DXImageT¿nsfÜm.Miüosoá.g¿d›ÁÓÇbËd=çl£)}.bŠ-sucûss:hov”,.bŠ-sucûss:focus,.bŠ-sucûss:aùive,.bŠ-sucûss.aùive,.bŠ-sucûss.di§bËd,.bŠ-sucûss[di§bËd]{cŞÜ:#fff;background-cŞÜ:#51a351;*background-cŞÜ:#499249}.bŠ-sucûss:aùive,.bŠ-sucûss.aùive{background-cŞÜ:#408140 \9}.bŠ-šfo{cŞÜ:#fff;‹xt-shadow:0 -1px 0„gba(0,0,0,0.25);background-cŞÜ:#49afcd;*background-cŞÜ:#2f96b4;background-image:-moz-lš—r-g¿d›ÁÑİ,#5bc0de,#2f96b4);background-image:-webk™-g¿d›ÁÖš—r,0 0,0 100%,äom(#5bc0de),to(#2f96b4));background-image:-webk™-lš—r-g¿d›ÁÑİ,#5bc0de,#2f96b4);background-image:-o-lš—r-g¿d›ÁÑİ,#5bc0de,#2f96b4);background-image:lš—r-g¿d›ÁÑØbÙtom,#5bc0de,#2f96b4);background-»³©:»³©-x;bÜd”-cŞÜ:#2f96b4 #2f96b4 #1f6377;bÜd”-cŞÜ:rgba(0,0,0,0.1èrgba(0,0,0,0.1èrgba(0,0,0,0.25);f‹r:´ogid:DXImageT¿nsfÜm.Miüosoá.g¿d›Á(¡¬tCŞÜ¡r='#ff5bc0de',’dCŞÜ¡r='#ff2f96b4',G¿d›ÁTy³=0);f‹r:´ogid:DXImageT¿nsfÜm.Miüosoá.g¿d›ÁÓÇbËd=çl£)}.bŠ-šfo:hov”,.bŠ-šfo:focus,.bŠ-šfo:aùive,.bŠ-šfo.aùive,.bŠ-šfo.di§bËd,.bŠ-šfo[di§bËd]{cŞÜ:#fff;background-cŞÜ:#2f96b4;*background-cŞÜ:#2a85a0}.bŠ-šfo:aùive,.bŠ-šfo.aùive{background-cŞÜ:#24748ø\9}.bŠ-šv”£{cŞÜ:#fff;‹xt-shadow:0 -1px 0„gba(0,0,0,0.25);background-cŞÜ:#363636;*background-cŞÜ:#222;background-image:-moz-lš—r-g¿d›ÁÑİ,#444,#222);background-image:-webk™-g¿d›ÁÖš—r,0 0,0 100%,äom(#444),to(#222));background-image:-webk™-lš—r-g¿d›ÁÑİ,#444,#222);background-image:-o-lš—r-g¿d›ÁÑİ,#444,#222);background-image:lš—r-g¿d›ÁÑØbÙtom,#444,#222);background-»³©:»³©-x;bÜd”-cŞÜ:#222 #222 #000;bÜd”-cŞÜ:rgba(0,0,0,0.1èrgba(0,0,0,0.1èrgba(0,0,0,0.25);f‹r:´ogid:DXImageT¿nsfÜm.Miüosoá.g¿d›Á(¡¬tCŞÜ¡r='#ff444444',’dCŞÜ¡r='#ff222222',G¿d›ÁTy³=0);f‹r:´ogid:DXImageT¿nsfÜm.Miüosoá.g¿d›ÁÓÇbËd=çl£)}.bŠ-šv”£:hov”,.bŠ-šv”£:focus,.bŠ-šv”£:aùive,.bŠ-šv”£.aùive,.bŠ-šv”£.di§bËd,.bŠ-šv”£[di§bËd]{cŞÜ:#fff;background-cŞÜ:#222;*background-cŞÜ:#151515}.bŠ-šv”£:aùive,.bŠ-šv”£.aùive{background-cŞÜ:#080808 \9}bu‰Ú.bŠ,šput[ty³="subm™"].bŠ{*·ddšg-tİ:3px;*·ddšg-bÙtom:3px}bu‰Ú.bŠ::-moz-focus-šÃr,šput[ty³="subm™"].bŠ::-moz-focus-šÃr{·ddšg:0;bÜd”:0}bu‰Ú.bŠ.bŠ-Ïrge,šput[ty³="subm™"].bŠ.bŠ-Ïrge{*·ddšg-tİ:7px;*·ddšg-bÙtom:7px}bu‰Ú.bŠ.bŠ-sm®l,šput[ty³="subm™"].bŠ.bŠ-sm®l{*·ddšg-tİ:3px;*·ddšg-bÙtom:3px}bu‰Ú.bŠ.bŠ-mši,šput[ty³="subm™"].bŠ.bŠ-mši{*·ddšg-tİ:1px;*·ddšg-bÙtom:1px}.bŠ-lšk,.bŠ-lšk:aùive,.bŠ-lšk[di§bËd]{background-cŞÜ:Œª¥¬’t;background-image:nÚe;-webk™-box-shadow:nÚe;-moz-box-shadow:nÚe;box-shadow:nÚe}.bŠ-lšk{cŞÜ:#08c;cursÜ:poš‹r;bÜd”-cŞÜ:Œª¥¬’t;-webk™-bÜd”-¿dius:0;-moz-bÜd”-¿dius:0;bÜd”-¿dius:0}.bŠ-lšk:hov”,.bŠ-lšk:focus{cŞÜ:#005580;‹xt-decÜ©iÚ:und”lše;background-cŞÜ:Œª¥¬’t}.bŠ-lšk[di§bËd]:hov”,.bŠ-lšk[di§bËd]:focus{cŞÜ:#333;‹xt-decÜ©iÚ:nÚe}.bŠ-group{pos™iÚ:»Ïtive;di¥Ïy:šlše-block;*di¥Ïy:šlše;*m¬gš-Ëá:.3em;fÚt-size:0;wh™e-¥aû:now¿p;v”tiÿl-®ign:middË;*zoom:1}.bŠ-group:fœ¡-chd{*m¬gš-Ëá:0}.bŠ-group+.bŠ-group{m¬gš-Ëá:5px}.bŠ-toŞb¬{m¬gš-tİ:10px;m¬gš-bÙtom:10px;fÚt-size:0}.bŠ-toŞb¬>.bŠ+.bŠ,.bŠ-toŞb¬>.bŠ-group+.bŠ,.bŠ-toŞb¬>.bŠ+.bŠ-group{m¬gš-Ëá:5px}.bŠ-group>.bŠ{pos™iÚ:»Ïtive;-webk™-bÜd”-¿dius:0;-moz-bÜd”-¿dius:0;bÜd”-¿dius:0}.bŠ-group>.bŠ+.bŠ{m¬gš-Ëá:-1px}.bŠ-group>.bŠ,.bŠ-group>.drİdown-m’u,.bŠ-group>.pİov”{fÚt-size:14px}.bŠ-group>.bŠ-mši{fÚt-size:10.5px}.bŠ-group>.bŠ-sm®l{fÚt-size:11.9px}.bŠ-group>.bŠ-Ïrge{fÚt-size:17.5px}.bŠ-group>.bŠ:fœ¡-chd{m¬gš-Ëá:0;-webk™-bÜd”-bÙtom-Ëá-¿dius:4px;bÜd”-bÙtom-Ëá-¿dius:4px;-webk™-bÜd”-tİ-Ëá-¿dius:4px;bÜd”-tİ-Ëá-¿dius:4px;-moz-bÜd”-¿dius-bÙtomËá:4px;-moz-bÜd”-¿dius-tİËá:4px}.bŠ-group>.bŠ:Ï¡-chd,.bŠ-group>.drİdown-toggË{-webk™-bÜd”-tİ-right-¿dius:4px;bÜd”-tİ-right-¿dius:4px;-webk™-bÜd”-bÙtom-right-¿dius:4px;bÜd”-bÙtom-right-¿dius:4px;-moz-bÜd”-¿dius-tİright:4px;-moz-bÜd”-¿dius-bÙtomright:4px}.bŠ-group>.bŠ.Ïrge:fœ¡-chd{m¬gš-Ëá:0;-webk™-bÜd”-bÙtom-Ëá-¿dius:6px;bÜd”-bÙtom-Ëá-¿dius:6px;-webk™-bÜd”-tİ-Ëá-¿dius:6px;bÜd”-tİ-Ëá-¿dius:6px;-moz-bÜd”-¿dius-bÙtomËá:6px;-moz-bÜd”-¿dius-tİËá:6px}.bŠ-group>.bŠ.Ïrge:Ï¡-chd,.bŠ-group>.Ïrge.drİdown-toggË{-webk™-bÜd”-tİ-right-¿dius:6px;bÜd”-tİ-right-¿dius:6px;-webk™-bÜd”-bÙtom-right-¿dius:6px;bÜd”-bÙtom-right-¿dius:6px;-moz-bÜd”-¿dius-tİright:6px;-moz-bÜd”-¿dius-bÙtomright:6px}.bŠ-group>.bŠ:hov”,.bŠ-group>.bŠ:focus,.bŠ-group>.bŠ:aùive,.bŠ-group>.bŠ.aùive{z-šdex:2}.bŠ-grou°.drİdown-toggË:aùive,.bŠ-group.İ’ .drİdown-toggË{ouše:0}.bŠ-group>.bŠ+.drİdown-toggË{*·ddšg-tİ:5px;·ddšg-right:8px;*·ddšg-bÙtom:5px;·ddšg-Ëá:8px;-webk™-box-shadow:š£ˆ1px 0 0„gba(255,255,255,0.125),š£ˆ0 1px 0„gba(255,255,255,0.2),0 1px 2px„gba(0,0,0,0.05);-moz-box-shadow:š£ˆ1px 0 0„gba(255,255,255,0.125),š£ˆ0 1px 0„gba(255,255,255,0.2),0 1px 2px„gba(0,0,0,0.05);box-shadow:š£ˆ1px 0 0„gba(255,255,255,0.125),š£ˆ0 1px 0„gba(255,255,255,0.2),0 1px 2px„gba(0,0,0,0.05)}.bŠ-group>.bŠ-mši+.drİdown-toggË{*·ddšg-tİ:2px;·ddšg-right:5px;*·ddšg-bÙtom:2px;·ddšg-Ëá:5px}.bŠ-group>.bŠ-sm®l+.drİdown-toggË{*·ddšg-tİ:5px;*·ddšg-bÙtom:4px}.bŠ-group>.bŠ-Ïrge+.drİdown-toggË{*·ddšg-tİ:7px;·ddšg-right:12px;*·ddšg-bÙtom:7px;·ddšg-Ëá:12px}.bŠ-group.İ’ .drİdown-toggË{background-image:nÚe;-webk™-box-shadow:š£ˆ0 2px 4px„gba(0,0,0,0.15),0 1px 2px„gba(0,0,0,0.05);-moz-box-shadow:š£ˆ0 2px 4px„gba(0,0,0,0.15),0 1px 2px„gba(0,0,0,0.05);box-shadow:š£ˆ0 2px 4px„gba(0,0,0,0.15),0 1px 2px„gba(0,0,0,0.05)}.bŠ-group.İ’ .bŠ.drİdown-toggË{background-cŞÜ:#e6e6e6}.bŠ-group.İ’ .bŠ-´im¬y.drİdown-toggË{background-cŞÜ:#04c}.bŠ-group.İ’ .bŠ-w¬nšg.drİdown-toggË{background-cŞÜ:#f89406}.bŠ-group.İ’ .bŠ-dªg”.drİdown-toggË{background-cŞÜ:#bd362f}.bŠ-group.İ’ .bŠ-sucûss.drİdown-toggË{background-cŞÜ:#51a351}.bŠ-group.İ’ .bŠ-šfo.drİdown-toggË{background-cŞÜ:#2f96b4}.bŠ-group.İ’ .bŠ-šv”£.drİdown-toggË{background-cŞÜ:#222}.bŠ .ÿ»t{m¬gš-tİ:8px;m¬gš-Ëá:0}.bŠ-Ïrg.ÿ»t{m¬gš-tİ:6px}.bŠ-Ïrg.ÿ»t{bÜd”-tİ-width:5px;bÜd”-right-width:5px;bÜd”-Ëá-width:5px}.bŠ-mš˜.ÿ»t,.bŠ-sm®È.ÿ»t{m¬gš-tİ:8px}.drİu°.bŠ-Ïrg.ÿ»t{bÜd”-bÙtom-width:5px}.bŠ-´im¬y .ÿ»t,.bŠ-w¬nšg .ÿ»t,.bŠ-dªg” .ÿ»t,.bŠ-šfØ.ÿ»t,.bŠ-sucûs .ÿ»t,.bŠ-šv”£ .ÿ»t{bÜd”-tİ-cŞÜ:#fff;bÜd”-bÙtom-cŞÜ:#fff}.bŠ-group-v”tiÿl{di¥Ïy:šlše-block;*di¥Ïy:šlše;*zoom:1}.bŠ-group-v”tiÿl>.bŠ{di¥Ïy:block;:nÚe;max-width:100%;-webk™-bÜd”-¿dius:0;-moz-bÜd”-¿dius:0;bÜd”-¿dius:0}.bŠ-group-v”tiÿl>.bŠ+.bŠ{m¬gš-tİ:-1px;m¬gš-Ëá:0}.bŠ-group-v”tiÿl>.bŠ:fœ¡-chd{-webk™-bÜd”-¿dius:4px 4px 0 0;-moz-bÜd”-¿dius:4px 4px 0 0;bÜd”-¿dius:4px 4px 0 0}.bŠ-group-v”tiÿl>.bŠ:Ï¡-chd{-webk™-bÜd”-¿dius:0 0 4px 4px;-moz-bÜd”-¿dius:0 0 4px 4px;bÜd”-¿dius:0 0 4px 4px}.bŠ-group-v”tiÿl>.bŠ-Ïrge:fœ¡-chd{-webk™-bÜd”-¿dius:6px 6px 0 0;-moz-bÜd”-¿dius:6px 6px 0 0;bÜd”-¿dius:6px 6px 0 0}.bŠ-group-v”tiÿl>.bŠ-Ïrge:Ï¡-chd{-webk™-bÜd”-¿dius:0 0 6px 6px;-moz-bÜd”-¿dius:0 0 6px 6px;bÜd”-¿dius:0 0 6px 6px}.®”t{·ddšg:8px 35px 8px 14px;m¬gš-bÙtom:20px;‹xt-shadow:0 1px 0„gba(255,255,255,0.5);background-cŞÜ:#fcf8e3;bÜd”:1px sŞid #fb“d5;-webk™-bÜd”-¿dius:4px;-moz-bÜd”-¿dius:4px;bÜd”-¿dius:4px}.®”t,.®”ˆh4{cŞÜ:#c09853}.®”ˆh4{m¬gš:0}.®”ˆ.şo£{pos™iÚ:»Ïtive;tİ:-2px;right:-21px;lše-height:20px}.®”t-sucûss{cŞÜ:#468847;background-cŞÜ:#dff0d8;bÜd”-cŞÜ:#d6e9c6}.®”t-sucûs h4{cŞÜ:#468847}.®”t-dªg”,.®”t-”rÜ{cŞÜ:#b94a48;background-cŞÜ:#f2dede;bÜd”-cŞÜ:#“d3d7}.®”t-dªg” h4,.®”t-”rÜ h4{cŞÜ:#b94a48}.®”t-šfo{cŞÜ:#3a87ad;background-cŞÜ:#d9edf7;bÜd”-cŞÜ:#bû8f1}.®”t-šfØh4{cŞÜ:#3a87ad}.®”t-block{·ddšg-tİ:14px;·ddšg-bÙtom:14px}.®”t-block>p,.®”t-block>ul{m¬gš-bÙtom:0}.®”t-block…+p{m¬gš-tİ:5px}.Çv{m¬gš-bÙtom:20px;m¬gš-Ëá:0;li¡-¡yË:nÚe}.Çv>li>a{di¥Ïy:block}.Çv>li>a:hov”,.Çv>li>a:focus{‹xt-decÜ©iÚ:nÚe;background-cŞÜ:#“e}.Çv>li>a>img{max-width:nÚe}.Çv>.puÎ-right{:right}.Çv-h—d”{di¥Ïy:block;·ddšg:3px 15px;fÚt-size:11px;fÚt-weight:bŞd;lše-height:20px;cŞÜ:#999;‹xt-shadow:0 1px 0„gba(255,255,255,0.5);‹xt-ŒªsfÜm:uµ”ÿ£}.Çv†i+.Çv-h—d”{m¬gš-tİ:9px}.Çv-li¡{·ddšg-right:15px;·ddšg-Ëá:15px;m¬gš-bÙtom:0}.Çv-li¡>li>a,.Çv-li¡ .Çv-h—d”{m¬gš-right:-15px;m¬gš-Ëá:-15px;‹xt-shadow:0 1px 0„gba(255,255,255,0.5)}.Çv-li¡>li>a{·ddšg:3px 15px}.Çv-li¡>.aùive>a,.Çv-li¡>.aùive>a:hov”,.Çv-li¡>.aùive>a:focus{cŞÜ:#fff;‹xt-shadow:0 -1px 0„gba(0,0,0,0.2);background-cŞÜ:#08c}.Çv-li¡ [şass^="icÚ-"],.Çv-li¡ [şass*=" icÚ-"]{m¬gš-right:2px}.Çv-li¡ .divid”{*width:100%;height:1px;m¬gš:9px 1px;*m¬gš:-5px 0 5px;ov”æow:hidd’;background-cŞÜ:#e5e5e5;bÜd”-bÙtom:1px sŞid #fff}.Çv-bs,.Çv-pls{*zoom:1}.Çv-bs:befÜe,.Çv-pls:befÜe,.Çv-bs:aá”,.Çv-pls:aá”{di¥Ïy:bË;lše-height:0;cÚ‹Á:""}.Çv-bs:aá”,.Çv-pls:aá”{ş—r:bÙh}.Çv-bs>li,.Çv-pls>li{:Ëá}.Çv-bs>li>a,.Çv-pls>li>a{·ddšg-right:12px;·ddšg-Ëá:12px;m¬gš-right:2px;lše-height:14px}.Çv-bs{bÜd”-bÙtom:1px sŞid #ddd}.Çv-bs>li{m¬gš-bÙtom:-1px}.Çv-bs>li>a{·ddšg-tİ:8px;·ddšg-bÙtom:8px;lše-height:20px;bÜd”:1px sŞid¿n¥¬’t;-webk™-bÜd”-¿dius:4px 4px 0 0;-moz-bÜd”-¿dius:4px 4px 0 0;bÜd”-¿dius:4px 4px 0 0}.Çv-bs>li>a:hov”,.Çv-bs>li>a:focus{bÜd”-cŞÜ:#“#“#ddd}.Çv-bs>.aùive>a,.Çv-bs>.aùive>a:hov”,.Çv-bs>.aùive>a:focus{cŞÜ:#555;cursÜ:;background-cŞÜ:#fff;bÜd”:1px sŞid #ddd;bÜd”-bÙtom-cŞÜ:Œª¥¬’t}.Çv-pls>li>a{·ddšg-tİ:8px;·ddšg-bÙtom:8px;m¬gš-tİ:2px;m¬gš-bÙtom:2px;-webk™-bÜd”-¿dius:5px;-moz-bÜd”-¿dius:5px;bÜd”-¿dius:5px}.Çv-pls>.aùive>a,.Çv-pls>.aùive>a:hov”,.Çv-pls>.aùive>a:focus{cŞÜ:#fff;background-cŞÜ:#08c}.Çv-¡acked>li{:nÚe}.Çv-¡acked>li>a{m¬gš-right:0}.Çv-bs.Çv-¡acked{bÜd”-bÙtom:0}.Çv-bs.Çv-¡acked>li>a{bÜd”:1px sŞid #ddd;-webk™-bÜd”-¿dius:0;-moz-bÜd”-¿dius:0;bÜd”-¿dius:0}.Çv-bs.Çv-¡acked>li:fœ¡-chd>a{-webk™-bÜd”-tİ-right-¿dius:4px;bÜd”-tİ-right-¿dius:4px;-webk™-bÜd”-tİ-Ëá-¿dius:4px;bÜd”-tİ-Ëá-¿dius:4px;-moz-bÜd”-¿dius-tİright:4px;-moz-bÜd”-¿dius-tİËá:4px}.Çv-bs.Çv-¡acked>li:Ï¡-chd>a{-webk™-bÜd”-bÙtom-right-¿dius:4px;bÜd”-bÙtom-right-¿dius:4px;-webk™-bÜd”-bÙtom-Ëá-¿dius:4px;bÜd”-bÙtom-Ëá-¿dius:4px;-moz-bÜd”-¿dius-bÙtomright:4px;-moz-bÜd”-¿dius-bÙtomËá:4px}.Çv-bs.Çv-¡acked>li>a:hov”,.Çv-bs.Çv-¡acked>li>a:focus{z-šdex:2;bÜd”-cŞÜ:#ddd}.Çv-pls.Çv-¡acked>li>a{m¬gš-bÙtom:3px}.Çv-pls.Çv-¡acked>li:Ï¡-chd>a{m¬gš-bÙtom:1px}.Çv-b .drİdown-m’u{-webk™-bÜd”-¿dius:0 0 6px 6px;-moz-bÜd”-¿dius:0 0 6px 6px;bÜd”-¿dius:0 0 6px 6px}.Çv-pl .drİdown-m’u{-webk™-bÜd”-¿dius:6px;-moz-bÜd”-¿dius:6px;bÜd”-¿dius:6px}.Çv .drİdown-toggË .ÿ»t{m¬gš-tİ:6px;bÜd”-tİ-cŞÜ:#08c;bÜd”-bÙtom-cŞÜ:#08c}.Çv .drİdown-toggË:hov” .ÿ»t,.Çv .drİdown-toggË:focu .ÿ»t{bÜd”-tİ-cŞÜ:#005580;bÜd”-bÙtom-cŞÜ:#005580}.Çv-b .drİdown-toggË .ÿ»t{m¬gš-tİ:8px}.Çv .aùiv.drİdown-toggË .ÿ»t{bÜd”-tİ-cŞÜ:#fff;bÜd”-bÙtom-cŞÜ:#fff}.Çv-b .aùiv.drİdown-toggË .ÿ»t{bÜd”-tİ-cŞÜ:#555;bÜd”-bÙtom-cŞÜ:#555}.Çv>.drİdown.aùive>a:hov”,.Çv>.drİdown.aùive>a:focus{cursÜ:poš‹r}.Çv-b .İ’ .drİdown-toggË,.Çv-pl .İ’ .drİdown-toggË,.Çv>li.drİdown.İ’.aùive>a:hov”,.Çv>li.drİdown.İ’.aùive>a:focus{cŞÜ:#fff;background-cŞÜ:#999;bÜd”-cŞÜ:#999}.Çv†i.drİdown.İ’ .ÿ»t,.Çv†i.drİdown.İ’.aùiv.ÿ»t,.Çv†i.drİdown.İ’‡:hov” .ÿ»t,.Çv†i.drİdown.İ’‡:focu .ÿ»t{bÜd”-tİ-cŞÜ:#fff;bÜd”-bÙtom-cŞÜ:#fff;İac™y:1;f‹r:®pha(İac™y=100)}.bs-¡acked .İ’>a:hov”,.bs-¡acked .İ’>a:focus{bÜd”-cŞÜ:#999}.bbabË{*zoom:1}.bbabË:befÜe,.bbabË:aá”{di¥Ïy:bË;lše-height:0;cÚ‹Á:""}.bbabË:aá”{ş—r:bÙh}.b-cÚ‹Á{ov”æow:auto}.bs-b–ow>.Çv-bs,.bs-right>.Çv-bs,.bs-Ëá>.Çv-bs{bÜd”-bÙtom:0}.b-cÚ‹Á>.b-·Ã,.pl-cÚ‹Á>.pl-·Ã{di¥Ïy:nÚe}.b-cÚ‹Á>.aùive,.pl-cÚ‹Á>.aùive{di¥Ïy:block}.bs-b–ow>.Çv-bs{bÜd”-tİ:1px sŞid #ddd}.bs-b–ow>.Çv-bs>li{m¬gš-tİ:-1px;m¬gš-bÙtom:0}.bs-b–ow>.Çv-bs>li>a{-webk™-bÜd”-¿dius:0 0 4px 4px;-moz-bÜd”-¿dius:0 0 4px 4px;bÜd”-¿dius:0 0 4px 4px}.bs-b–ow>.Çv-bs>li>a:hov”,.bs-b–ow>.Çv-bs>li>a:focus{bÜd”-tİ-cŞÜ:#ddd;bÜd”-bÙtom-cŞÜ:Œª¥¬’t}.bs-b–ow>.Çv-bs>.aùive>a,.bs-b–ow>.Çv-bs>.aùive>a:hov”,.bs-b–ow>.Çv-bs>.aùive>a:focus{bÜd”-cŞÜ:Œª¥¬’ˆ#ddd #ddd #ddd}.bs-Ëá>.Çv-bs>li,.bs-right>.Çv-bs>li{:nÚe}.bs-Ëá>.Çv-bs>li>a,.bs-right>.Çv-bs>li>a{mš-width:74px;m¬gš-right:0;m¬gš-bÙtom:3px}.bs-Ëá>.Çv-bs{:Ëá;m¬gš-right:19px;bÜd”-right:1px sŞid #ddd}.bs-Ëá>.Çv-bs>li>a{m¬gš-right:-1px;-webk™-bÜd”-¿dius:4px 0 0 4px;-moz-bÜd”-¿dius:4px 0 0 4px;bÜd”-¿dius:4px 0 0 4px}.bs-Ëá>.Çv-bs>li>a:hov”,.bs-Ëá>.Çv-bs>li>a:focus{bÜd”-cŞÜ:#“#ddd #“#“e}.bs-Ëá>.Çv-b .aùive>a,.bs-Ëá>.Çv-b .aùive>a:hov”,.bs-Ëá>.Çv-b .aùive>a:focus{bÜd”-cŞÜ:#ddd¿n¥¬’ˆ#ddd #ddd;*bÜd”-right-cŞÜ:#fff}.bs-right>.Çv-bs{:right;m¬gš-Ëá:19px;bÜd”-Ëá:1px sŞid #ddd}.bs-right>.Çv-bs>li>a{m¬gš-Ëá:-1px;-webk™-bÜd”-¿dius:0 4px 4px 0;-moz-bÜd”-¿dius:0 4px 4px 0;bÜd”-¿dius:0 4px 4px 0}.bs-right>.Çv-bs>li>a:hov”,.bs-right>.Çv-bs>li>a:focus{bÜd”-cŞÜ:#“#“#“#ddd}.bs-right>.Çv-b .aùive>a,.bs-right>.Çv-b .aùive>a:hov”,.bs-right>.Çv-b .aùive>a:focus{bÜd”-cŞÜ:#ddd #ddd #ddd¿n¥¬’t;*bÜd”-Ëá-cŞÜ:#fff}.Çv>.di§bËd>a{cŞÜ:#999}.Çv>.di§bËd>a:hov”,.Çv>.di§bËd>a:focus{‹xt-decÜ©iÚ:nÚe;cursÜ:;background-cŞÜ:Œª¥¬’t}.Çvb¬{*pos™iÚ:»Ïtive;*z-šdex:2;m¬gš-bÙtom:20px;ov”æow:visibË}.Çvb¬-šÃr{mš-height:40px;·ddšg-right:20px;·ddšg-Ëá:20px;background-cŞÜ:#ççç;background-image:-moz-lš—r-g¿d›ÁÑİ,#fff,#f2f2f2);background-image:-webk™-g¿d›ÁÖš—r,0 0,0 100%,äom(#fff),to(#f2f2f2));background-image:-webk™-lš—r-g¿d›ÁÑİ,#fff,#f2f2f2);background-image:-o-lš—r-g¿d›ÁÑİ,#fff,#f2f2f2);background-image:lš—r-g¿d›ÁÑØbÙtom,#fff,#f2f2f2);background-»³©:»³©-x;bÜd”:1px sŞid #d4d4d4;-webk™-bÜd”-¿dius:4px;-moz-bÜd”-¿dius:4px;bÜd”-¿dius:4px;f‹r:´ogid:DXImageT¿nsfÜm.Miüosoá.g¿d›Á(¡¬tCŞÜ¡r='#ffffffff',’dCŞÜ¡r='#fff2f2f2',G¿d›ÁTy³=0);*zoom:1;-webk™-box-shadow:0 1px 4px„gba(0,0,0,0.065);-moz-box-shadow:0 1px 4px„gba(0,0,0,0.065);box-shadow:0 1px 4px„gba(0,0,0,0.065)}.Çvb¬-šÃr:befÜe,.Çvb¬-šÃr:aá”{di¥Ïy:bË;lše-height:0;cÚ‹Á:""}.Çvb¬-šÃr:aá”{ş—r:bÙh}.Çvb¬ .cÚš”{width:auto}.Çv-cŞÏp£.cŞÏp£{height:auto;ov”æow:visibË}.Çvb¬ .b¿nd{di¥Ïy:block;:Ëá;·ddšg:10px 20px 10px;m¬gš-Ëá:-20px;fÚt-size:20px;fÚt-weight:200;cŞÜ:#777;‹xt-shadow:0 1px 0 #fff}.Çvb¬ .b¿nd:hov”,.Çvb¬ .b¿nd:focus{‹xt-decÜ©iÚ:nÚe}.Çvb¬-‹xt{m¬gš-bÙtom:0;lše-height:40px;cŞÜ:#777}.Çvb¬-lšk{cŞÜ:#777}.Çvb¬-lšk:hov”,.Çvb¬-lšk:focus{cŞÜ:#333}.Çvb¬ .divid”-v”tiÿl{height:40px;m¬gš:0 9px;bÜd”-right:1px sŞid #fff;bÜd”-Ëá:1px sŞid #f2f2f2}.Çvb¬ .bŠ,.Çvb¬ .bŠ-group{m¬gš-tİ:5px}.Çvb¬ .bŠ-grou°.bŠ,.Çvb¬ .šput-´•’d .bŠ,.Çvb¬ .šput-­³nd .bŠ,.Çvb¬ .šput-´•’d .bŠ-group,.Çvb¬ .šput-­³nd .bŠ-group{m¬gš-tİ:0}.Çvb¬-fÜm{m¬gš-bÙtom:0;*zoom:1}.Çvb¬-fÜm:befÜe,.Çvb¬-fÜm:aá”{di¥Ïy:bË;lše-height:0;cÚ‹Á:""}.Çvb¬-fÜm:aá”{ş—r:bÙh}.Çvb¬-fÜm iÅut,.Çvb¬-fÜm s–eù,.Çvb¬-fÜm .¿dio,.Çvb¬-fÜm .checkbox{m¬gš-tİ:5px}.Çvb¬-fÜm iÅut,.Çvb¬-fÜm s–eù,.Çvb¬-fÜm .bŠ{di¥Ïy:šlše-block;m¬gš-bÙtom:0}.Çvb¬-fÜm iÅut[ty³="image"],.Çvb¬-fÜm iÅut[ty³="checkbox"],.Çvb¬-fÜm iÅut[ty³="¿dio"]{m¬gš-tİ:3px}.Çvb¬-fÜm .šput-­³nd,.Çvb¬-fÜm .šput-´•’d{m¬gš-tİ:5px;wh™e-¥aû:now¿p}.Çvb¬-fÜm .šput-­³nd iÅut,.Çvb¬-fÜm .šput-´•’d iÅut{m¬gš-tİ:0}.Çvb¬-£¬ch{pos™iÚ:»Ïtive;:Ëá;m¬gš-tİ:5px;m¬gš-bÙtom:0}.Çvb¬-£¬ch .£¬ch-qu”y{·ddšg:4px 14px;m¬gš-bÙtom:0;fÚt-çmy:"H–v‘iÿ Neue",H–v‘iÿ,ArŸl,§ns-£rif;fÚt-size:13px;fÚt-weight:nÜm®;lše-height:1;-webk™-bÜd”-¿dius:15px;-moz-bÜd”-¿dius:15px;bÜd”-¿dius:15px}.Çvb¬--tİ{pos™iÚ:;m¬gš-bÙtom:0}.Çvb¬--tİ .Çvb¬-šÃr{-webk™-bÜd”-¿dius:0;-moz-bÜd”-¿dius:0;bÜd”-¿dius:0}.Çvb¬-fixed-tİ,.Çvb¬-fixed-bÙtom{pos™iÚ:fixed;right:0;Ëá:0;z-šdex:1030;m¬gš-bÙtom:0}.Çvb¬-fixed-tİ .Çvb¬-šÃr,.Çvb¬--tİ .Çvb¬-šÃr{bÜd”-width:0 0 1px}.Çvb¬-fixed-bÙtom .Çvb¬-šÃr{bÜd”-width:1px 0 0}.Çvb¬-fixed-tİ .Çvb¬-šÃr,.Çvb¬-fixed-bÙtom .Çvb¬-šÃr{·ddšg-right:0;·ddšg-Ëá:0;-webk™-bÜd”-¿dius:0;-moz-bÜd”-¿dius:0;bÜd”-¿dius:0}.Çvb¬--tİ .cÚš”,.Çvb¬-fixed-tİ .cÚš”,.Çvb¬-fixed-bÙtom .cÚš”{width:940px}.Çvb¬-fixed-tİ{tİ:0}.Çvb¬-fixed-tİ .Çvb¬-šÃr,.Çvb¬--tİ .Çvb¬-šÃr{-webk™-box-shadow:0 1px 10px„gba(0,0,0,0.1);-moz-box-shadow:0 1px 10px„gba(0,0,0,0.1);box-shadow:0 1px 10px„gba(0,0,0,0.1)}.Çvb¬-fixed-bÙtom{bÙtom:0}.Çvb¬-fixed-bÙtom .Çvb¬-šÃr{-webk™-box-shadow:0 -1px 10px„gba(0,0,0,0.1);-moz-box-shadow:0 -1px 10px„gba(0,0,0,0.1);box-shadow:0 -1px 10px„gba(0,0,0,0.1)}.Çvb¬ .Çv{pos™iÚ:»Ïtive;Ëá:0;di¥Ïy:block;:Ëá;m¬gš:0 10px 0 0}.Çvb¬ .Çv.puÎ-right{:right;m¬gš-right:0}.Çvb¬ .Çv>li{:Ëá}.Çvb¬ .Çv>li>a{:nÚe;·ddšg:10px 15px 10px;cŞÜ:#777;‹xt-decÜ©iÚ:nÚe;‹xt-shadow:0 1px 0 #fff}.Çvb¬ .Çv .drİdown-toggË .ÿ»t{m¬gš-tİ:8px}.Çvb¬ .Çv>li>a:focus,.Çvb¬ .Çv>li>a:hov”{cŞÜ:#333;‹xt-decÜ©iÚ:nÚe;background-cŞÜ:Œª¥¬’t}.Çvb¬ .Çv>.aùive>a,.Çvb¬ .Çv>.aùive>a:hov”,.Çvb¬ .Çv>.aùive>a:focus{cŞÜ:#555;‹xt-decÜ©iÚ:nÚe;background-cŞÜ:#e5e5e5;-webk™-box-shadow:š£ˆ0 3px 8px„gba(0,0,0,0.125);-moz-box-shadow:š£ˆ0 3px 8px„gba(0,0,0,0.125);box-shadow:š£ˆ0 3px 8px„gba(0,0,0,0.125)}.Çvb¬ .bŠ-Çvb¬{di¥Ïy:nÚe;:right;·ddšg:7px 10px;m¬gš-right:5px;m¬gš-Ëá:5px;cŞÜ:#fff;‹xt-shadow:0 -1px 0„gba(0,0,0,0.25);background-cŞÜ:#ededed;*background-cŞÜ:#e5e5e5;background-image:-moz-lš—r-g¿d›ÁÑİ,#f2f2f2,#e5e5e5);background-image:-webk™-g¿d›ÁÖš—r,0 0,0 100%,äom(#f2f2f2),to(#e5e5e5));background-image:-webk™-lš—r-g¿d›ÁÑİ,#f2f2f2,#e5e5e5);background-image:-o-lš—r-g¿d›ÁÑİ,#f2f2f2,#e5e5e5);background-image:lš—r-g¿d›ÁÑØbÙtom,#f2f2f2,#e5e5e5);background-»³©:»³©-x;bÜd”-cŞÜ:#e5e5e5 #e5e5e5 #bfbfbf;bÜd”-cŞÜ:rgba(0,0,0,0.1èrgba(0,0,0,0.1èrgba(0,0,0,0.25);f‹r:´ogid:DXImageT¿nsfÜm.Miüosoá.g¿d›Á(¡¬tCŞÜ¡r='#fff2f2f2',’dCŞÜ¡r='#fã5e5e5',G¿d›ÁTy³=0);f‹r:´ogid:DXImageT¿nsfÜm.Miüosoá.g¿d›ÁÓÇbËd=çl£);-webk™-box-shadow:š£ˆ0 1px 0„gba(255,255,255,0.1),0 1px 0„gba(255,255,255,0.075);-moz-box-shadow:š£ˆ0 1px 0„gba(255,255,255,0.1),0 1px 0„gba(255,255,255,0.075);box-shadow:š£ˆ0 1px 0„gba(255,255,255,0.1),0 1px 0„gba(255,255,255,0.075)}.Çvb¬ .bŠ-Çvb¬:hov”,.Çvb¬ .bŠ-Çvb¬:focus,.Çvb¬ .bŠ-Çvb¬:aùive,.Çvb¬ .bŠ-Çvb¬.aùive,.Çvb¬ .bŠ-Çvb¬.di§bËd,.Çvb¬ .bŠ-Çvb¬[di§bËd]{cŞÜ:#fff;background-cŞÜ:#e5e5e5;*background-cŞÜ:#d9d9d9}.Çvb¬ .bŠ-Çvb¬:aùive,.Çvb¬ .bŠ-Çvb¬.aùive{background-cŞÜ:#ccø\9}.Çvb¬ .bŠ-Çvb¬ .icÚ-b¬{di¥Ïy:block;width:18px;height:2px;background-cŞÜ:#f5f5f5;-webk™-bÜd”-¿dius:1px;-moz-bÜd”-¿dius:1px;bÜd”-¿dius:1px;-webk™-box-shadow:0 1px 0„gba(0,0,0,0.25);-moz-box-shadow:0 1px 0„gba(0,0,0,0.25);box-shadow:0 1px 0„gba(0,0,0,0.25)}.bŠ-Çvb¬ .icÚ-b¬+.icÚ-b¬{m¬gš-tİ:3px}.Çvb¬ .Çv>li>.drİdown-m’u:befÜe{pos™iÚ:absŞu‹;tİ:-7px;Ëá:9px;di¥Ïy:šlše-block;bÜd”-right:7px sŞid¿n¥¬’t;bÜd”-bÙtom:7px sŞid #ccc;bÜd”-Ëá:7px sŞid¿n¥¬’t;bÜd”-bÙtom-cŞÜ:rgba(0,0,0,0.2);cÚ‹Á:''}.Çvb¬ .Çv>li>.drİdown-m’u:aá”{pos™iÚ:absŞu‹;tİ:-6px;Ëá:10px;di¥Ïy:šlše-block;bÜd”-right:6px sŞid¿n¥¬’t;bÜd”-bÙtom:6px sŞid #fff;bÜd”-Ëá:6px sŞid¿n¥¬’t;cÚ‹Á:''}.Çvb¬-fixed-bÙtom .Çv>li>.drİdown-m’u:befÜe{tİ:auto;bÙtom:-7px;bÜd”-tİ:7px sŞid #ccc;bÜd”-bÙtom:0;bÜd”-tİ-cŞÜ:rgba(0,0,0,0.2)}.Çvb¬-fixed-bÙtom .Çv>li>.drİdown-m’u:aá”{tİ:auto;bÙtom:-6px;bÜd”-tİ:6px sŞid #fff;bÜd”-bÙtom:0}.Çvb¬ .Çv†i.drİdown>a:hov” .ÿ»t,.Çvb¬ .Çv†i.drİdown>a:focu .ÿ»t{bÜd”-tİ-cŞÜ:#333;bÜd”-bÙtom-cŞÜ:#333}.Çvb¬ .Çv†i.drİdown.İ’>.drİdown-toggË,.Çvb¬ .Çv†i.drİdown.aùive>.drİdown-toggË,.Çvb¬ .Çv†i.drİdown.İ’.aùive>.drİdown-toggË{cŞÜ:#555;background-cŞÜ:#e5e5e5}.Çvb¬ .Çv†i.drİdown>.drİdown-toggË .ÿ»t{bÜd”-tİ-cŞÜ:#777;bÜd”-bÙtom-cŞÜ:#777}.Çvb¬ .Çv†i.drİdown.İ’>.drİdown-toggË .ÿ»t,.Çvb¬ .Çv†i.drİdown.aùive>.drİdown-toggË .ÿ»t,.Çvb¬ .Çv†i.drİdown.İ’.aùive>.drİdown-toggË .ÿ»t{bÜd”-tİ-cŞÜ:#555;bÜd”-bÙtom-cŞÜ:#555}.Çvb¬ .puÎ-right>li>.drİdown-m’u,.Çvb¬ .Çv>li>.drİdown-m’u.puÎ-right{right:0;Ëá:auto}.Çvb¬ .puÎ-right>li>.drİdown-m’u:befÜe,.Çvb¬ .Çv>li>.drİdown-m’u.puÎ-right:befÜe{right:12px;Ëá:auto}.Çvb¬ .puÎ-right>li>.drİdown-m’u:aá”,.Çvb¬ .Çv>li>.drİdown-m’u.puÎ-right:aá”{right:13px;Ëá:auto}.Çvb¬ .puÎ-right>li>.drİdown-m’u .drİdown-m’u,.Çvb¬ .Çv>li>.drİdown-m’u.puÎ-righˆ.drİdown-m’u{right:100%;Ëá:auto;m¬gš-right:-1px;m¬gš-Ëá:0;-webk™-bÜd”-¿dius:6px 0 6px 6px;-moz-bÜd”-¿dius:6px 0 6px 6px;bÜd”-¿dius:6px 0 6px 6px}.Çvb¬-šv”£ .Çvb¬-šÃr{background-cŞÜ:#1b1b1b;background-image:-moz-lš—r-g¿d›ÁÑİ,#222,#111);background-image:-webk™-g¿d›ÁÖš—r,0 0,0 100%,äom(#222),to(#111));background-image:-webk™-lš—r-g¿d›ÁÑİ,#222,#111);background-image:-o-lš—r-g¿d›ÁÑİ,#222,#111);background-image:lš—r-g¿d›ÁÑØbÙtom,#222,#111);background-»³©:»³©-x;bÜd”-cŞÜ:#252525;f‹r:´ogid:DXImageT¿nsfÜm.Miüosoá.g¿d›Á(¡¬tCŞÜ¡r='#ff222222',’dCŞÜ¡r='#ff111111',G¿d›ÁTy³=0)}.Çvb¬-šv”£ .b¿nd,.Çvb¬-šv”£ .Çv>li>a{cŞÜ:#999;‹xt-shadow:0 -1px 0„gba(0,0,0,0.25)}.Çvb¬-šv”£ .b¿nd:hov”,.Çvb¬-šv”£ .Çv>li>a:hov”,.Çvb¬-šv”£ .b¿nd:focus,.Çvb¬-šv”£ .Çv>li>a:focus{cŞÜ:#fff}.Çvb¬-šv”£ .b¿nd{cŞÜ:#999}.Çvb¬-šv”£ .Çvb¬-‹xt{cŞÜ:#999}.Çvb¬-šv”£ .Çv>li>a:focus,.Çvb¬-šv”£ .Çv>li>a:hov”{cŞÜ:#fff;background-cŞÜ:Œª¥¬’t}.Çvb¬-šv”£ .Çv .aùive>a,.Çvb¬-šv”£ .Çv .aùive>a:hov”,.Çvb¬-šv”£ .Çv .aùive>a:focus{cŞÜ:#fff;background-cŞÜ:#111}.Çvb¬-šv”£ .Çvb¬-lšk{cŞÜ:#999}.Çvb¬-šv”£ .Çvb¬-lšk:hov”,.Çvb¬-šv”£ .Çvb¬-lšk:focus{cŞÜ:#fff}.Çvb¬-šv”£ .divid”-v”tiÿl{bÜd”-right-cŞÜ:#222;bÜd”-Ëá-cŞÜ:#111}.Çvb¬-šv”£ .Çv†i.drİdown.İ’>.drİdown-toggË,.Çvb¬-šv”£ .Çv†i.drİdown.aùive>.drİdown-toggË,.Çvb¬-šv”£ .Çv†i.drİdown.İ’.aùive>.drİdown-toggË{cŞÜ:#fff;background-cŞÜ:#111}.Çvb¬-šv”£ .Çv†i.drİdown>a:hov” .ÿ»t,.Çvb¬-šv”£ .Çv†i.drİdown>a:focu .ÿ»t{bÜd”-tİ-cŞÜ:#fff;bÜd”-bÙtom-cŞÜ:#fff}.Çvb¬-šv”£ .Çv†i.drİdown>.drİdown-toggË .ÿ»t{bÜd”-tİ-cŞÜ:#999;bÜd”-bÙtom-cŞÜ:#999}.Çvb¬-šv”£ .Çv†i.drİdown.İ’>.drİdown-toggË .ÿ»t,.Çvb¬-šv”£ .Çv†i.drİdown.aùive>.drİdown-toggË .ÿ»t,.Çvb¬-šv”£ .Çv†i.drİdown.İ’.aùive>.drİdown-toggË .ÿ»t{bÜd”-tİ-cŞÜ:#fff;bÜd”-bÙtom-cŞÜ:#fff}.Çvb¬-šv”£ .Çvb¬-£¬ch .£¬ch-qu”y{cŞÜ:#fff;background-cŞÜ:#515151;bÜd”-cŞÜ:#111;-webk™-box-shadow:š£ˆ0 1px 2px„gba(0,0,0,0.1),0 1px 0„gba(255,255,255,0.15);-moz-box-shadow:š£ˆ0 1px 2px„gba(0,0,0,0.1),0 1px 0„gba(255,255,255,0.15);box-shadow:š£ˆ0 1px 2px„gba(0,0,0,0.1),0 1px 0„gba(255,255,255,0.15);-webk™-Œªs™iÚ:nÚe;-moz-Œªs™iÚ:nÚe;-o-Œªs™iÚ:nÚe;Œªs™iÚ:nÚe}.Çvb¬-šv”£ .Çvb¬-£¬ch .£¬ch-qu”y:-moz-¶aûhŞd”{cŞÜ:#ccc}.Çvb¬-šv”£ .Çvb¬-£¬ch .£¬ch-qu”y:-ms-šput-¶aûhŞd”{cŞÜ:#ccc}.Çvb¬-šv”£ .Çvb¬-£¬ch .£¬ch-qu”y::-webk™-šput-¶aûhŞd”{cŞÜ:#ccc}.Çvb¬-šv”£ .Çvb¬-£¬ch .£¬ch-qu”y:focus,.Çvb¬-šv”£ .Çvb¬-£¬ch .£¬ch-qu”y.focu£d{·ddšg:5px 15px;cŞÜ:#333;‹xt-shadow:0 1px 0 #fff;background-cŞÜ:#fff;bÜd”:0;ouše:0;-webk™-box-shadow:0 0 3px„gba(0,0,0,0.15);-moz-box-shadow:0 0 3px„gba(0,0,0,0.15);box-shadow:0 0 3px„gba(0,0,0,0.15)}.Çvb¬-šv”£ .bŠ-Çvb¬{cŞÜ:#fff;‹xt-shadow:0 -1px 0„gba(0,0,0,0.25);background-cŞÜ:#0e0e0e;*background-cŞÜ:#040404;background-image:-moz-lš—r-g¿d›ÁÑİ,#151515,#040404);background-image:-webk™-g¿d›ÁÖš—r,0 0,0 100%,äom(#151515),to(#040404));background-image:-webk™-lš—r-g¿d›ÁÑİ,#151515,#040404);background-image:-o-lš—r-g¿d›ÁÑİ,#151515,#040404);background-image:lš—r-g¿d›ÁÑØbÙtom,#151515,#040404);background-»³©:»³©-x;bÜd”-cŞÜ:#040404 #040404 #000;bÜd”-cŞÜ:rgba(0,0,0,0.1èrgba(0,0,0,0.1èrgba(0,0,0,0.25);f‹r:´ogid:DXImageT¿nsfÜm.Miüosoá.g¿d›Á(¡¬tCŞÜ¡r='#ff151515',’dCŞÜ¡r='#ff040404',G¿d›ÁTy³=0);f‹r:´ogid:DXImageT¿nsfÜm.Miüosoá.g¿d›ÁÓÇbËd=çl£)}.Çvb¬-šv”£ .bŠ-Çvb¬:hov”,.Çvb¬-šv”£ .bŠ-Çvb¬:focus,.Çvb¬-šv”£ .bŠ-Çvb¬:aùive,.Çvb¬-šv”£ .bŠ-Çvb¬.aùive,.Çvb¬-šv”£ .bŠ-Çvb¬.di§bËd,.Çvb¬-šv”£ .bŠ-Çvb¬[di§bËd]{cŞÜ:#fff;background-cŞÜ:#040404;*background-cŞÜ:#000}.Çvb¬-šv”£ .bŠ-Çvb¬:aùive,.Çvb¬-šv”£ .bŠ-Çvb¬.aùive{background-cŞÜ:#000 \9}.b»adüumb{·ddšg:8px 15px;m¬gš:0 0 20px;li¡-¡yË:nÚe;background-cŞÜ:#f5f5f5;-webk™-bÜd”-¿dius:4px;-moz-bÜd”-¿dius:4px;bÜd”-¿dius:4px}.b»adüumb>li{di¥Ïy:šlše-block;*di¥Ïy:šlše;‹xt-shadow:0 1px 0 #fff;*zoom:1}.b»adüumb>li>.divid”{·ddšg:0 5px;cŞÜ:#ccc}.b»adüumb>.aùive{cŞÜ:#999}.·gš©iÚ{m¬gš:20px 0}.·gš©iÚ ul{di¥Ïy:šlše-block;*di¥Ïy:šlše;m¬gš-bÙtom:0;m¬gš-Ëá:0;-webk™-bÜd”-¿dius:4px;-moz-bÜd”-¿dius:4px;bÜd”-¿dius:4px;*zoom:1;-webk™-box-shadow:0 1px 2px„gba(0,0,0,0.05);-moz-box-shadow:0 1px 2px„gba(0,0,0,0.05);box-shadow:0 1px 2px„gba(0,0,0,0.05)}.·gš©iÚ ul>li{di¥Ïy:šlše}.·gš©iÚ ul>li>a,.·gš©iÚ ul>li>¥ª{:Ëá;·ddšg:4px 12px;lše-height:20px;‹xt-decÜ©iÚ:nÚe;background-cŞÜ:#fff;bÜd”:1px sŞid #ddd;bÜd”-Ëá-width:0}.·gš©iÚ ul>li>a:hov”,.·gš©iÚ ul>li>a:focus,.·gš©iÚ ul>.aùive>a,.·gš©iÚ ul>.aùive>¥ª{background-cŞÜ:#f5f5f5}.·gš©iÚ ul>.aùive>a,.·gš©iÚ ul>.aùive>¥ª{cŞÜ:#999;cursÜ:}.·gš©iÚ ul>.di§bËd>¥ª,.·gš©iÚ ul>.di§bËd>a,.·gš©iÚ ul>.di§bËd>a:hov”,.·gš©iÚ ul>.di§bËd>a:focus{cŞÜ:#999;cursÜ:;background-cŞÜ:Œª¥¬’t}.·gš©iÚ ul>li:fœ¡-chd>a,.·gš©iÚ ul>li:fœ¡-chd>¥ª{bÜd”-Ëá-width:1px;-webk™-bÜd”-bÙtom-Ëá-¿dius:4px;bÜd”-bÙtom-Ëá-¿dius:4px;-webk™-bÜd”-tİ-Ëá-¿dius:4px;bÜd”-tİ-Ëá-¿dius:4px;-moz-bÜd”-¿dius-bÙtomËá:4px;-moz-bÜd”-¿dius-tİËá:4px}.·gš©iÚ ul>li:Ï¡-chd>a,.·gš©iÚ ul>li:Ï¡-chd>¥ª{-webk™-bÜd”-tİ-right-¿dius:4px;bÜd”-tİ-right-¿dius:4px;-webk™-bÜd”-bÙtom-right-¿dius:4px;bÜd”-bÙtom-right-¿dius:4px;-moz-bÜd”-¿dius-tİright:4px;-moz-bÜd”-¿dius-bÙtomright:4px}.·gš©iÚ-ûÁ”ed{‹xt-®ign:ûÁ”}.·gš©iÚ-right{‹xt-®ign:right}.·gš©iÚ-Ïrgul>li>a,.·gš©iÚ-Ïrgul>li>¥ª{·ddšg:11px 19px;fÚt-size:17.5px}.·gš©iÚ-Ïrgul>li:fœ¡-chd>a,.·gš©iÚ-Ïrgul>li:fœ¡-chd>¥ª{-webk™-bÜd”-bÙtom-Ëá-¿dius:6px;bÜd”-bÙtom-Ëá-¿dius:6px;-webk™-bÜd”-tİ-Ëá-¿dius:6px;bÜd”-tİ-Ëá-¿dius:6px;-moz-bÜd”-¿dius-bÙtomËá:6px;-moz-bÜd”-¿dius-tİËá:6px}.·gš©iÚ-Ïrgul>li:Ï¡-chd>a,.·gš©iÚ-Ïrgul>li:Ï¡-chd>¥ª{-webk™-bÜd”-tİ-right-¿dius:6px;bÜd”-tİ-right-¿dius:6px;-webk™-bÜd”-bÙtom-right-¿dius:6px;bÜd”-bÙtom-right-¿dius:6px;-moz-bÜd”-¿dius-tİright:6px;-moz-bÜd”-¿dius-bÙtomright:6px}.·gš©iÚ-mš˜ul>li:fœ¡-chd>a,.·gš©iÚ-sm®Èul>li:fœ¡-chd>a,.·gš©iÚ-mš˜ul>li:fœ¡-chd>¥ª,.·gš©iÚ-sm®Èul>li:fœ¡-chd>¥ª{-webk™-bÜd”-bÙtom-Ëá-¿dius:3px;bÜd”-bÙtom-Ëá-¿dius:3px;-webk™-bÜd”-tİ-Ëá-¿dius:3px;bÜd”-tİ-Ëá-¿dius:3px;-moz-bÜd”-¿dius-bÙtomËá:3px;-moz-bÜd”-¿dius-tİËá:3px}.·gš©iÚ-mš˜ul>li:Ï¡-chd>a,.·gš©iÚ-sm®Èul>li:Ï¡-chd>a,.·gš©iÚ-mš˜ul>li:Ï¡-chd>¥ª,.·gš©iÚ-sm®Èul>li:Ï¡-chd>¥ª{-webk™-bÜd”-tİ-right-¿dius:3px;bÜd”-tİ-right-¿dius:3px;-webk™-bÜd”-bÙtom-right-¿dius:3px;bÜd”-bÙtom-right-¿dius:3px;-moz-bÜd”-¿dius-tİright:3px;-moz-bÜd”-¿dius-bÙtomright:3px}.·gš©iÚ-sm®Èul>li>a,.·gš©iÚ-sm®Èul>li>¥ª{·ddšg:2px 10px;fÚt-size:11.9px}.·gš©iÚ-mš˜ul>li>a,.·gš©iÚ-mš˜ul>li>¥ª{·ddšg:0 6px;fÚt-size:10.5px}.·g”{m¬gš:20px 0;‹xt-®ign:ûÁ”;li¡-¡yË:nÚe;*zoom:1}.·g”:befÜe,.·g”:aá”{di¥Ïy:bË;lše-height:0;cÚ‹Á:""}.·g”:aá”{ş—r:bÙh}.·g”†i{di¥Ïy:šlše}.·g”†i>a,.·g”†i>¥ª{di¥Ïy:šlše-block;·ddšg:5px 14px;background-cŞÜ:#fff;bÜd”:1px sŞid #ddd;-webk™-bÜd”-¿dius:15px;-moz-bÜd”-¿dius:15px;bÜd”-¿dius:15px}.·g”†i>a:hov”,.·g”†i>a:focus{‹xt-decÜ©iÚ:nÚe;background-cŞÜ:#f5f5f5}.·g” .Ãxt>a,.·g” .Ãxt>¥ª{:right}.·g” .´evious>a,.·g” .´evious>¥ª{:Ëá}.·g” .di§bËd>a,.·g” .di§bËd>a:hov”,.·g” .di§bËd>a:focus,.·g” .di§bËd>¥ª{cŞÜ:#999;cursÜ:;background-cŞÜ:#fff}.mod®-backdrİ{pos™iÚ:fixed;tİ:0;right:0;bÙtom:0;Ëá:0;z-šdex:1040;background-cŞÜ:#000}.mod®-backdrİ.çde{İac™y:0}.mod®-backdrİ,.mod®-backdrİ.çde.š{İac™y:.8;f‹r:®pha(İac™y=80)}.mod®{pos™iÚ:fixed;tİ:10%;Ëá:50%;z-šdex:1050;width:560px;m¬gš-Ëá:-280px;background-cŞÜ:#fff;bÜd”:1px sŞid #999;bÜd”:1px sŞid„gba(0,0,0,0.3);*bÜd”:1px sŞid #999;-webk™-bÜd”-¿dius:6px;-moz-bÜd”-¿dius:6px;bÜd”-¿dius:6px;ouše:0;-webk™-box-shadow:0 3px 7px„gba(0,0,0,0.3);-moz-box-shadow:0 3px 7px„gba(0,0,0,0.3);box-shadow:0 3px 7px„gba(0,0,0,0.3);-webk™-background-ş:·ddšg-box;-moz-background-ş:·ddšg-box;background-ş:·ddšg-box}.mod®.çde{tİ:-25%;-webk™-Œªs™iÚ:İac™y .3 lš—r,tİ .3 —£-out;-moz-Œªs™iÚ:İac™y .3 lš—r,tİ .3 —£-out;-o-Œªs™iÚ:İac™y .3 lš—r,tİ .3 —£-out;Œªs™iÚ:İac™y .3 lš—r,tİ .3 —£-out}.mod®.çde.š{tİ:10%}.mod®-h—d”{·ddšg:9px 15px;bÜd”-bÙtom:1px sŞid #“e}.mod®-h—d” .şo£{m¬gš-tİ:2px}.mod®-h—d” h3{m¬gš:0;lše-height:30px}.mod®-body{pos™iÚ:»Ïtive;max-height:400px;·ddšg:15px;ov”æow-y:auto}.mod®-fÜm{m¬gš-bÙtom:0}.mod®-foÙ”{·ddšg:14px 15px 15px;m¬gš-bÙtom:0;‹xt-®ign:right;background-cŞÜ:#f5f5f5;bÜd”-tİ:1px sŞid #ddd;-webk™-bÜd”-¿dius:0 0 6px 6px;-moz-bÜd”-¿dius:0 0 6px 6px;bÜd”-¿dius:0 0 6px 6px;*zoom:1;-webk™-box-shadow:š£ˆ0 1px 0 #fff;-moz-box-shadow:š£ˆ0 1px 0 #fff;box-shadow:š£ˆ0 1px 0 #fff}.mod®-foÙ”:befÜe,.mod®-foÙ”:aá”{di¥Ïy:bË;lše-height:0;cÚ‹Á:""}.mod®-foÙ”:aá”{ş—r:bÙh}.mod®-foÙ” .bŠ+.bŠ{m¬gš-bÙtom:0;m¬gš-Ëá:5px}.mod®-foÙ” .bŠ-grou°.bŠ+.bŠ{m¬gš-Ëá:-1px}.mod®-foÙ” .bŠ-block+.bŠ-block{m¬gš-Ëá:0}.toŞt{pos™iÚ:absŞu‹;z-šdex:1030;di¥Ïy:block;fÚt-size:11px;lše-height:1.4;İac™y:0;f‹r:®pha(İac™y=0);visib™y:visibË}.toŞt.š{İac™y:.8;f‹r:®pha(İac™y=80)}.toŞt.tİ{·ddšg:5px 0;m¬gš-tİ:-3px}.toŞt.right{·ddšg:0 5px;m¬gš-Ëá:3px}.toŞt.bÙtom{·ddšg:5px 0;m¬gš-tİ:3px}.toŞt.Ëá{·ddšg:0 5px;m¬gš-Ëá:-3px}.toŞt-šÃr{max-width:200px;·ddšg:8px;cŞÜ:#fff;‹xt-®ign:ûÁ”;‹xt-decÜ©iÚ:nÚe;background-cŞÜ:#000;-webk™-bÜd”-¿dius:4px;-moz-bÜd”-¿dius:4px;bÜd”-¿dius:4px}.toŞt-¬row{pos™iÚ:absŞu‹;width:0;height:0;bÜd”-cŞÜ:Œª¥¬’t;bÜd”-¡yË:sŞid}.toŞt.tİ .toŞt-¬row{bÙtom:0;Ëá:50%;m¬gš-Ëá:-5px;bÜd”-tİ-cŞÜ:#000;bÜd”-width:5px 5px 0}.toŞt.righˆ.toŞt-¬row{tİ:50%;Ëá:0;m¬gš-tİ:-5px;bÜd”-right-cŞÜ:#000;bÜd”-width:5px 5px 5px 0}.toŞt.Ëá .toŞt-¬row{tİ:50%;right:0;m¬gš-tİ:-5px;bÜd”-Ëá-cŞÜ:#000;bÜd”-width:5px 0 5px 5px}.toŞt.bÙtom .toŞt-¬row{tİ:0;Ëá:50%;m¬gš-Ëá:-5px;bÜd”-bÙtom-cŞÜ:#000;bÜd”-width:0 5px 5px}.pİov”{pos™iÚ:absŞu‹;tİ:0;Ëá:0;z-šdex:1010;di¥Ïy:nÚe;max-width:276px;·ddšg:1px;‹xt-®ign:Ëá;wh™e-¥aû:nÜm®;background-cŞÜ:#fff;bÜd”:1px sŞid #ccc;bÜd”:1px sŞid„gba(0,0,0,0.2);-webk™-bÜd”-¿dius:6px;-moz-bÜd”-¿dius:6px;bÜd”-¿dius:6px;-webk™-box-shadow:0 5px 10px„gba(0,0,0,0.2);-moz-box-shadow:0 5px 10px„gba(0,0,0,0.2);box-shadow:0 5px 10px„gba(0,0,0,0.2);-webk™-background-ş:·ddšg-box;-moz-background-ş:·ddšg;background-ş:·ddšg-box}.pİov”.tİ{m¬gš-tİ:-10px}.pİov”.right{m¬gš-Ëá:10px}.pİov”.bÙtom{m¬gš-tİ:10px}.pİov”.Ëá{m¬gš-Ëá:-10px}.pİov”-t™Ë{·ddšg:8px 14px;m¬gš:0;fÚt-size:14px;fÚt-weight:nÜm®;lše-height:18px;background-cŞÜ:#f7f7f7;bÜd”-bÙtom:1px sŞid #ebebeb;-webk™-bÜd”-¿dius:5px 5px 0 0;-moz-bÜd”-¿dius:5px 5px 0 0;bÜd”-¿dius:5px 5px 0 0}.pİov”-t™Ë:em±y{di¥Ïy:nÚe}.pİov”-cÚ‹Á{·ddšg:9px 14px}.pİov” .¬row,.pİov” .¬row:aá”{pos™iÚ:absŞu‹;di¥Ïy:block;width:0;height:0;bÜd”-cŞÜ:Œª¥¬’t;bÜd”-¡yË:sŞid}.pİov” .¬row{bÜd”-width:11px}.pİov” .¬row:aá”{bÜd”-width:10px;cÚ‹Á:""}.pİov”.tİ .¬row{bÙtom:-11px;Ëá:50%;m¬gš-Ëá:-11px;bÜd”-tİ-cŞÜ:#999;bÜd”-tİ-cŞÜ:rgba(0,0,0,0.25);bÜd”-bÙtom-width:0}.pİov”.tİ .¬row:aá”{bÙtom:1px;m¬gš-Ëá:-10px;bÜd”-tİ-cŞÜ:#fff;bÜd”-bÙtom-width:0}.pİov”.righˆ.¬row{tİ:50%;Ëá:-11px;m¬gš-tİ:-11px;bÜd”-right-cŞÜ:#999;bÜd”-right-cŞÜ:rgba(0,0,0,0.25);bÜd”-Ëá-width:0}.pİov”.righˆ.¬row:aá”{bÙtom:-10px;Ëá:1px;bÜd”-right-cŞÜ:#fff;bÜd”-Ëá-width:0}.pİov”.bÙtom .¬row{tİ:-11px;Ëá:50%;m¬gš-Ëá:-11px;bÜd”-bÙtom-cŞÜ:#999;bÜd”-bÙtom-cŞÜ:rgba(0,0,0,0.25);bÜd”-tİ-width:0}.pİov”.bÙtom .¬row:aá”{tİ:1px;m¬gš-Ëá:-10px;bÜd”-bÙtom-cŞÜ:#fff;bÜd”-tİ-width:0}.pİov”.Ëá .¬row{tİ:50%;right:-11px;m¬gš-tİ:-11px;bÜd”-Ëá-cŞÜ:#999;bÜd”-Ëá-cŞÜ:rgba(0,0,0,0.25);bÜd”-right-width:0}.pİov”.Ëá .¬row:aá”{right:1px;bÙtom:-10px;bÜd”-Ëá-cŞÜ:#fff;bÜd”-right-width:0}.thumbÇs{m¬gš-Ëá:-20px;li¡-¡yË:nÚe;*zoom:1}.thumbÇs:befÜe,.thumbÇs:aá”{di¥Ïy:bË;lše-height:0;cÚ‹Á:""}.thumbÇs:aá”{ş—r:bÙh}.row-æuid .thumbÇs{m¬gš-Ëá:0}.thumbÇs>li{:Ëá;m¬gš-bÙtom:20px;m¬gš-Ëá:20px}.thumbÇ{di¥Ïy:block;·ddšg:4px;lše-height:20px;bÜd”:1px sŞid #ddd;-webk™-bÜd”-¿dius:4px;-moz-bÜd”-¿dius:4px;bÜd”-¿dius:4px;-webk™-box-shadow:0 1px 3px„gba(0,0,0,0.055);-moz-box-shadow:0 1px 3px„gba(0,0,0,0.055);box-shadow:0 1px 3px„gba(0,0,0,0.055);-webk™-Œªs™iÚ:®È.2 —£-š-out;-moz-Œªs™iÚ:®È.2 —£-š-out;-o-Œªs™iÚ:®È.2 —£-š-out;Œªs™iÚ:®È.2 —£-š-out}a.thumbÇ:hov”,a.thumbÇ:focus{bÜd”-cŞÜ:#08c;-webk™-box-shadow:0 1px 4px„gba(0,105,214,0.25);-moz-box-shadow:0 1px 4px„gba(0,105,214,0.25);box-shadow:0 1px 4px„gba(0,105,214,0.25)}.thumbÇ>img{di¥Ïy:block;max-width:100%;m¬gš-right:auto;m¬gš-Ëá:auto}.thumbÇ .ÿ±iÚ{·ddšg:9px;cŞÜ:#555}.medŸ,.medŸ-body{ov”æow:hidd’;*ov”æow:visibË;zoom:1}.medŸ,.medŸ .medŸ{m¬gš-tİ:15px}.medŸ:fœ¡-chd{m¬gš-tİ:0}.medŸ-objeù{di¥Ïy:block}.medŸ-h—dšg{m¬gš:0 0 5px}.medŸ>.puÎ-Ëá{m¬gš-right:10px}.medŸ>.puÎ-right{m¬gš-Ëá:10px}.medŸ-li¡{m¬gš-Ëá:0;li¡-¡yË:nÚe}.Ïb–,.badge{di¥Ïy:šlše-block;·ddšg:2px 4px;fÚt-size:11.844px;fÚt-weight:bŞd;lše-height:14px;cŞÜ:#fff;‹xt-shadow:0 -1px 0„gba(0,0,0,0.25);wh™e-¥aû:now¿p;v”tiÿl-®ign:ba£lše;background-cŞÜ:#999}.Ïb–{-webk™-bÜd”-¿dius:3px;-moz-bÜd”-¿dius:3px;bÜd”-¿dius:3px}.badge{·ddšg-right:9px;·ddšg-Ëá:9px;-webk™-bÜd”-¿dius:9px;-moz-bÜd”-¿dius:9px;bÜd”-¿dius:9px}.Ïb–:em±y,.badge:em±y{di¥Ïy:nÚe}a.Ïb–:hov”,a.Ïb–:focus,a.badge:hov”,a.badge:focus{cŞÜ:#fff;‹xt-decÜ©iÚ:nÚe;cursÜ:poš‹r}.Ïb–-impÜÁ,.badge-impÜÁ{background-cŞÜ:#b94a48}.Ïb–-impÜÁ[h»f],.badge-impÜÁ[h»f]{background-cŞÜ:#953b39}.Ïb–-w¬nšg,.badge-w¬nšg{background-cŞÜ:#f89406}.Ïb–-w¬nšg[h»f],.badge-w¬nšg[h»f]{background-cŞÜ:#c67605}.Ïb–-sucûss,.badge-sucûss{background-cŞÜ:#468847}.Ïb–-sucûss[h»f],.badge-sucûss[h»f]{background-cŞÜ:#356635}.Ïb–-šfo,.badge-šfo{background-cŞÜ:#3a87ad}.Ïb–-šfo[h»f],.badge-šfo[h»f]{background-cŞÜ:#2d6987}.Ïb–-šv”£,.badge-šv”£{background-cŞÜ:#333}.Ïb–-šv”£[h»f],.badge-šv”£[h»f]{background-cŞÜ:#1a1a1a}.bŠ .Ïb–,.bŠ .badge{pos™iÚ:»Ïtive;tİ:-1px}.bŠ-mš˜.Ïb–,.bŠ-mš˜.badge{tİ:0}@-webk™-keyäame ´og»ss-b¬-¡res{äom{background-pos™iÚ:40px 0}to{background-pos™iÚ:0 0}}@-moz-keyäame ´og»ss-b¬-¡res{äom{background-pos™iÚ:40px 0}to{background-pos™iÚ:0 0}}@-ms-keyäame ´og»ss-b¬-¡res{äom{background-pos™iÚ:40px 0}to{background-pos™iÚ:0 0}}@-o-keyäame ´og»ss-b¬-¡res{äom{background-pos™iÚ:0 0}to{background-pos™iÚ:40px 0}}@keyäame ´og»ss-b¬-¡res{äom{background-pos™iÚ:40px 0}to{background-pos™iÚ:0 0}}.´og»ss{height:20px;m¬gš-bÙtom:20px;ov”æow:hidd’;background-cŞÜ:#f7f7f7;background-image:-moz-lš—r-g¿d›ÁÑİ,#f5f5f5,#f9f9f9);background-image:-webk™-g¿d›ÁÖš—r,0 0,0 100%,äom(#f5f5f5),to(#f9f9f9));background-image:-webk™-lš—r-g¿d›ÁÑİ,#f5f5f5,#f9f9f9);background-image:-o-lš—r-g¿d›ÁÑİ,#f5f5f5,#f9f9f9);background-image:lš—r-g¿d›ÁÑØbÙtom,#f5f5f5,#f9f9f9);background-»³©:»³©-x;-webk™-bÜd”-¿dius:4px;-moz-bÜd”-¿dius:4px;bÜd”-¿dius:4px;f‹r:´ogid:DXImageT¿nsfÜm.Miüosoá.g¿d›Á(¡¬tCŞÜ¡r='#fff5f5f5',’dCŞÜ¡r='#fff9f9f9',G¿d›ÁTy³=0);-webk™-box-shadow:š£ˆ0 1px 2px„gba(0,0,0,0.1);-moz-box-shadow:š£ˆ0 1px 2px„gba(0,0,0,0.1);box-shadow:š£ˆ0 1px 2px„gba(0,0,0,0.1)}.´og»s .b¬{:Ëá;width:0;height:100%;fÚt-size:12px;cŞÜ:#fff;‹xt-®ign:ûÁ”;‹xt-shadow:0 -1px 0„gba(0,0,0,0.25);background-cŞÜ:#0e90d2;background-image:-moz-lš—r-g¿d›ÁÑİ,#149bdf,#0480be);background-image:-webk™-g¿d›ÁÖš—r,0 0,0 100%,äom(#149bdf),to(#0480be));background-image:-webk™-lš—r-g¿d›ÁÑİ,#149bdf,#0480be);background-image:-o-lš—r-g¿d›ÁÑİ,#149bdf,#0480be);background-image:lš—r-g¿d›ÁÑØbÙtom,#149bdf,#0480be);background-»³©:»³©-x;f‹r:´ogid:DXImageT¿nsfÜm.Miüosoá.g¿d›Á(¡¬tCŞÜ¡r='#ff149bdf',’dCŞÜ¡r='#ff0480be',G¿d›ÁTy³=0);-webk™-box-shadow:š£ˆ0 -1px 0„gba(0,0,0,0.15);-moz-box-shadow:š£ˆ0 -1px 0„gba(0,0,0,0.15);box-shadow:š£ˆ0 -1px 0„gba(0,0,0,0.15);-webk™-box-sizšg:bÜd”-box;-moz-box-sizšg:bÜd”-box;box-sizšg:bÜd”-box;-webk™-Œªs™iÚ:width .6 —£;-moz-Œªs™iÚ:width .6 —£;-o-Œªs™iÚ:width .6 —£;Œªs™iÚ:width .6 —£}.´og»s .b¬+.b¬{-webk™-box-shadow:š£ˆ1px 0 0„gba(0,0,0,0.15),š£ˆ0 -1px 0„gba(0,0,0,0.15);-moz-box-shadow:š£ˆ1px 0 0„gba(0,0,0,0.15),š£ˆ0 -1px 0„gba(0,0,0,0.15);box-shadow:š£ˆ1px 0 0„gba(0,0,0,0.15),š£ˆ0 -1px 0„gba(0,0,0,0.15)}.´og»ss-¡red .b¬{background-cŞÜ:#149bdf;background-image:-webk™-g¿d›ÁÖš—r,0 100%,100% 0,cŞÜ-¡İ(0.25,rgba(255,255,255,0.15)),cŞÜ-¡İ(0.25,Œª¥¬’t),cŞÜ-¡İ(0.5,Œª¥¬’t),cŞÜ-¡İ(0.5,rgba(255,255,255,0.15)),cŞÜ-¡İ(0.75,rgba(255,255,255,0.15)),cŞÜ-¡İ(0.75,Œª¥¬’t),toÑ¿n¥¬’t));background-image:-webk™-lš—r-g¿d›Á(45deg,rgba(255,255,255,0.15è25%,Œª¥¬’ˆ25%,Œª¥¬’ˆ50%,rgba(255,255,255,0.15è50%,rgba(255,255,255,0.15è75%,Œª¥¬’ˆ75%,Œª¥¬’t);background-image:-moz-lš—r-g¿d›Á(45deg,rgba(255,255,255,0.15è25%,Œª¥¬’ˆ25%,Œª¥¬’ˆ50%,rgba(255,255,255,0.15è50%,rgba(255,255,255,0.15è75%,Œª¥¬’ˆ75%,Œª¥¬’t);background-image:-o-lš—r-g¿d›Á(45deg,rgba(255,255,255,0.15è25%,Œª¥¬’ˆ25%,Œª¥¬’ˆ50%,rgba(255,255,255,0.15è50%,rgba(255,255,255,0.15è75%,Œª¥¬’ˆ75%,Œª¥¬’t);background-image:lš—r-g¿d›Á(45deg,rgba(255,255,255,0.15è25%,Œª¥¬’ˆ25%,Œª¥¬’ˆ50%,rgba(255,255,255,0.15è50%,rgba(255,255,255,0.15è75%,Œª¥¬’ˆ75%,Œª¥¬’t);-webk™-background-size:40px 40px;-moz-background-size:40px 40px;-o-background-size:40px 40px;background-size:40px 40px}.´og»ss.aùiv.b¬{-webk™-ªim©iÚ:´og»ss-b¬-¡re 2 lš—¸šfš™e;-moz-ªim©iÚ:´og»ss-b¬-¡re 2 lš—¸šfš™e;-ms-ªim©iÚ:´og»ss-b¬-¡re 2 lš—¸šfš™e;-o-ªim©iÚ:´og»ss-b¬-¡re 2 lš—¸šfš™e;ªim©iÚ:´og»ss-b¬-¡re 2 lš—¸šfš™e}.´og»ss-dªg” .b¬,.´og»s .b¬-dªg”{background-cŞÜ:#dd514c;background-image:-moz-lš—r-g¿d›ÁÑİ,#“5f5b,#c43c35);background-image:-webk™-g¿d›ÁÖš—r,0 0,0 100%,äom(#“5f5b),to(#c43c35));background-image:-webk™-lš—r-g¿d›ÁÑİ,#“5f5b,#c43c35);background-image:-o-lš—r-g¿d›ÁÑİ,#“5f5b,#c43c35);background-image:lš—r-g¿d›ÁÑØbÙtom,#“5f5b,#c43c35);background-»³©:»³©-x;f‹r:´ogid:DXImageT¿nsfÜm.Miüosoá.g¿d›Á(¡¬tCŞÜ¡r='#fãe5f5b',’dCŞÜ¡r='#ffc43c35',G¿d›ÁTy³=0)}.´og»ss-dªg”.´og»ss-¡red .b¬,.´og»ss-¡red .b¬-dªg”{background-cŞÜ:#“5f5b;background-image:-webk™-g¿d›ÁÖš—r,0 100%,100% 0,cŞÜ-¡İ(0.25,rgba(255,255,255,0.15)),cŞÜ-¡İ(0.25,Œª¥¬’t),cŞÜ-¡İ(0.5,Œª¥¬’t),cŞÜ-¡İ(0.5,rgba(255,255,255,0.15)),cŞÜ-¡İ(0.75,rgba(255,255,255,0.15)),cŞÜ-¡İ(0.75,Œª¥¬’t),toÑ¿n¥¬’t));background-image:-webk™-lš—r-g¿d›Á(45deg,rgba(255,255,255,0.15è25%,Œª¥¬’ˆ25%,Œª¥¬’ˆ50%,rgba(255,255,255,0.15è50%,rgba(255,255,255,0.15è75%,Œª¥¬’ˆ75%,Œª¥¬’t);background-image:-moz-lš—r-g¿d›Á(45deg,rgba(255,255,255,0.15è25%,Œª¥¬’ˆ25%,Œª¥¬’ˆ50%,rgba(255,255,255,0.15è50%,rgba(255,255,255,0.15è75%,Œª¥¬’ˆ75%,Œª¥¬’t);background-image:-o-lš—r-g¿d›Á(45deg,rgba(255,255,255,0.15è25%,Œª¥¬’ˆ25%,Œª¥¬’ˆ50%,rgba(255,255,255,0.15è50%,rgba(255,255,255,0.15è75%,Œª¥¬’ˆ75%,Œª¥¬’t);background-image:lš—r-g¿d›Á(45deg,rgba(255,255,255,0.15è25%,Œª¥¬’ˆ25%,Œª¥¬’ˆ50%,rgba(255,255,255,0.15è50%,rgba(255,255,255,0.15è75%,Œª¥¬’ˆ75%,Œª¥¬’t)}.´og»ss-sucûs .b¬,.´og»s .b¬-sucûss{background-cŞÜ:#5eb95e;background-image:-moz-lš—r-g¿d›ÁÑİ,#62c462,#57a957);background-image:-webk™-g¿d›ÁÖš—r,0 0,0 100%,äom(#62c462),to(#57a957));background-image:-webk™-lš—r-g¿d›ÁÑİ,#62c462,#57a957);background-image:-o-lš—r-g¿d›ÁÑİ,#62c462,#57a957);background-image:lš—r-g¿d›ÁÑØbÙtom,#62c462,#57a957);background-»³©:»³©-x;f‹r:´ogid:DXImageT¿nsfÜm.Miüosoá.g¿d›Á(¡¬tCŞÜ¡r='#ff62c462',’dCŞÜ¡r='#ff57a957',G¿d›ÁTy³=0)}.´og»ss-sucûss.´og»ss-¡red .b¬,.´og»ss-¡red .b¬-sucûss{background-cŞÜ:#62c462;background-image:-webk™-g¿d›ÁÖš—r,0 100%,100% 0,cŞÜ-¡İ(0.25,rgba(255,255,255,0.15)),cŞÜ-¡İ(0.25,Œª¥¬’t),cŞÜ-¡İ(0.5,Œª¥¬’t),cŞÜ-¡İ(0.5,rgba(255,255,255,0.15)),cŞÜ-¡İ(0.75,rgba(255,255,255,0.15)),cŞÜ-¡İ(0.75,Œª¥¬’t),toÑ¿n¥¬’t));background-image:-webk™-lš—r-g¿d›Á(45deg,rgba(255,255,255,0.15è25%,Œª¥¬’ˆ25%,Œª¥¬’ˆ50%,rgba(255,255,255,0.15è50%,rgba(255,255,255,0.15è75%,Œª¥¬’ˆ75%,Œª¥¬’t);background-image:-moz-lš—r-g¿d›Á(45deg,rgba(255,255,255,0.15è25%,Œª¥¬’ˆ25%,Œª¥¬’ˆ50%,rgba(255,255,255,0.15è50%,rgba(255,255,255,0.15è75%,Œª¥¬’ˆ75%,Œª¥¬’t);background-image:-o-lš—r-g¿d›Á(45deg,rgba(255,255,255,0.15è25%,Œª¥¬’ˆ25%,Œª¥¬’ˆ50%,rgba(255,255,255,0.15è50%,rgba(255,255,255,0.15è75%,Œª¥¬’ˆ75%,Œª¥¬’t);background-image:lš—r-g¿d›Á(45deg,rgba(255,255,255,0.15è25%,Œª¥¬’ˆ25%,Œª¥¬’ˆ50%,rgba(255,255,255,0.15è50%,rgba(255,255,255,0.15è75%,Œª¥¬’ˆ75%,Œª¥¬’t)}.´og»ss-šfØ.b¬,.´og»s .b¬-šfo{background-cŞÜ:#4bb1cf;background-image:-moz-lš—r-g¿d›ÁÑİ,#5bc0de,#339bb9);background-image:-webk™-g¿d›ÁÖš—r,0 0,0 100%,äom(#5bc0de),to(#339bb9));background-image:-webk™-lš—r-g¿d›ÁÑİ,#5bc0de,#339bb9);background-image:-o-lš—r-g¿d›ÁÑİ,#5bc0de,#339bb9);background-image:lš—r-g¿d›ÁÑØbÙtom,#5bc0de,#339bb9);background-»³©:»³©-x;f‹r:´ogid:DXImageT¿nsfÜm.Miüosoá.g¿d›Á(¡¬tCŞÜ¡r='#ff5bc0de',’dCŞÜ¡r='#ff339bb9',G¿d›ÁTy³=0)}.´og»ss-šfo.´og»ss-¡red .b¬,.´og»ss-¡red .b¬-šfo{background-cŞÜ:#5bc0de;background-image:-webk™-g¿d›ÁÖš—r,0 100%,100% 0,cŞÜ-¡İ(0.25,rgba(255,255,255,0.15)),cŞÜ-¡İ(0.25,Œª¥¬’t),cŞÜ-¡İ(0.5,Œª¥¬’t),cŞÜ-¡İ(0.5,rgba(255,255,255,0.15)),cŞÜ-¡İ(0.75,rgba(255,255,255,0.15)),cŞÜ-¡İ(0.75,Œª¥¬’t),toÑ¿n¥¬’t));background-image:-webk™-lš—r-g¿d›Á(45deg,rgba(255,255,255,0.15è25%,Œª¥¬’ˆ25%,Œª¥¬’ˆ50%,rgba(255,255,255,0.15è50%,rgba(255,255,255,0.15è75%,Œª¥¬’ˆ75%,Œª¥¬’t);background-image:-moz-lš—r-g¿d›Á(45deg,rgba(255,255,255,0.15è25%,Œª¥¬’ˆ25%,Œª¥¬’ˆ50%,rgba(255,255,255,0.15è50%,rgba(255,255,255,0.15è75%,Œª¥¬’ˆ75%,Œª¥¬’t);background-image:-o-lš—r-g¿d›Á(45deg,rgba(255,255,255,0.15è25%,Œª¥¬’ˆ25%,Œª¥¬’ˆ50%,rgba(255,255,255,0.15è50%,rgba(255,255,255,0.15è75%,Œª¥¬’ˆ75%,Œª¥¬’t);background-image:lš—r-g¿d›Á(45deg,rgba(255,255,255,0.15è25%,Œª¥¬’ˆ25%,Œª¥¬’ˆ50%,rgba(255,255,255,0.15è50%,rgba(255,255,255,0.15è75%,Œª¥¬’ˆ75%,Œª¥¬’t)}.´og»ss-w¬nšg .b¬,.´og»s .b¬-w¬nšg{background-cŞÜ:#ça732;background-image:-moz-lš—r-g¿d›ÁÑİ,#fbb450,#f89406);background-image:-webk™-g¿d›ÁÖš—r,0 0,0 100%,äom(#fbb450),to(#f89406));background-image:-webk™-lš—r-g¿d›ÁÑİ,#fbb450,#f89406);background-image:-o-lš—r-g¿d›ÁÑİ,#fbb450,#f89406);background-image:lš—r-g¿d›ÁÑØbÙtom,#fbb450,#f89406);background-»³©:»³©-x;f‹r:´ogid:DXImageT¿nsfÜm.Miüosoá.g¿d›Á(¡¬tCŞÜ¡r='#fffbb450',’dCŞÜ¡r='#fff89406',G¿d›ÁTy³=0)}.´og»ss-w¬nšg.´og»ss-¡red .b¬,.´og»ss-¡red .b¬-w¬nšg{background-cŞÜ:#fbb450;background-image:-webk™-g¿d›ÁÖš—r,0 100%,100% 0,cŞÜ-¡İ(0.25,rgba(255,255,255,0.15)),cŞÜ-¡İ(0.25,Œª¥¬’t),cŞÜ-¡İ(0.5,Œª¥¬’t),cŞÜ-¡İ(0.5,rgba(255,255,255,0.15)),cŞÜ-¡İ(0.75,rgba(255,255,255,0.15)),cŞÜ-¡İ(0.75,Œª¥¬’t),toÑ¿n¥¬’t));background-image:-webk™-lš—r-g¿d›Á(45deg,rgba(255,255,255,0.15è25%,Œª¥¬’ˆ25%,Œª¥¬’ˆ50%,rgba(255,255,255,0.15è50%,rgba(255,255,255,0.15è75%,Œª¥¬’ˆ75%,Œª¥¬’t);background-image:-moz-lš—r-g¿d›Á(45deg,rgba(255,255,255,0.15è25%,Œª¥¬’ˆ25%,Œª¥¬’ˆ50%,rgba(255,255,255,0.15è50%,rgba(255,255,255,0.15è75%,Œª¥¬’ˆ75%,Œª¥¬’t);background-image:-o-lš—r-g¿d›Á(45deg,rgba(255,255,255,0.15è25%,Œª¥¬’ˆ25%,Œª¥¬’ˆ50%,rgba(255,255,255,0.15è50%,rgba(255,255,255,0.15è75%,Œª¥¬’ˆ75%,Œª¥¬’t);background-image:lš—r-g¿d›Á(45deg,rgba(255,255,255,0.15è25%,Œª¥¬’ˆ25%,Œª¥¬’ˆ50%,rgba(255,255,255,0.15è50%,rgba(255,255,255,0.15è75%,Œª¥¬’ˆ75%,Œª¥¬’t)}.accÜdiÚ{m¬gš-bÙtom:20px}.accÜdiÚ-group{m¬gš-bÙtom:2px;bÜd”:1px sŞid #e5e5e5;-webk™-bÜd”-¿dius:4px;-moz-bÜd”-¿dius:4px;bÜd”-¿dius:4px}.accÜdiÚ-h—dšg{bÜd”-bÙtom:0}.accÜdiÚ-h—dšg .accÜdiÚ-toggË{di¥Ïy:block;·ddšg:8px 15px}.accÜdiÚ-toggË{cursÜ:poš‹r}.accÜdiÚ-šÃr{·ddšg:9px 15px;bÜd”-tİ:1px sŞid #e5e5e5}.ÿrou£l{pos™iÚ:»Ïtive;m¬gš-bÙtom:20px;lše-height:1}.ÿrou£l-šÃr{pos™iÚ:»Ïtive;width:100%;ov”æow:hidd’}.ÿrou£l-šÃr>.™em{pos™iÚ:»Ïtive;di¥Ïy:nÚe;-webk™-Œªs™iÚ:.6 —£-š-ouˆËá;-moz-Œªs™iÚ:.6 —£-š-ouˆËá;-o-Œªs™iÚ:.6 —£-š-ouˆËá;Œªs™iÚ:.6 —£-š-ouˆËá}.ÿrou£l-šÃr>.™em>img,.ÿrou£l-šÃr>.™em>a>img{di¥Ïy:block;lše-height:1}.ÿrou£l-šÃr>.aùive,.ÿrou£l-šÃr>.Ãxt,.ÿrou£l-šÃr>.´ev{di¥Ïy:block}.ÿrou£l-šÃr>.aùive{Ëá:0}.ÿrou£l-šÃr>.Ãxt,.ÿrou£l-šÃr>.´ev{pos™iÚ:absŞu‹;tİ:0;width:100%}.ÿrou£l-šÃr>.Ãxt{Ëá:100%}.ÿrou£l-šÃr>.´ev{Ëá:-100%}.ÿrou£l-šÃr>.Ãxt.Ëá,.ÿrou£l-šÃr>.´ev.right{Ëá:0}.ÿrou£l-šÃr>.aùive.Ëá{Ëá:-100%}.ÿrou£l-šÃr>.aùive.right{Ëá:100%}.ÿrou£l-cÚŒŞ{pos™iÚ:absŞu‹;tİ:40%;Ëá:15px;width:40px;height:40px;m¬gš-tİ:-20px;fÚt-size:60px;fÚt-weight:100;lše-height:30px;cŞÜ:#fff;‹xt-®ign:ûÁ”;background:#222;bÜd”:3px sŞid #fff;-webk™-bÜd”-¿dius:23px;-moz-bÜd”-¿dius:23px;bÜd”-¿dius:23px;İac™y:.5;f‹r:®pha(İac™y=50)}.ÿrou£l-cÚŒŞ.right{right:15px;Ëá:auto}.ÿrou£l-cÚŒŞ:hov”,.ÿrou£l-cÚŒŞ:focus{cŞÜ:#fff;‹xt-decÜ©iÚ:nÚe;İac™y:.9;f‹r:®pha(İac™y=90)}.ÿrou£l-šdiÿtÜs{pos™iÚ:absŞu‹;tİ:15px;right:15px;z-šdex:5;m¬gš:0;li¡-¡yË:nÚe}.ÿrou£l-šdiÿtÜ li{di¥Ïy:block;:Ëá;width:10px;height:10px;m¬gš-Ëá:5px;‹xt-šd’t:-999px;background-cŞÜ:#ccc;background-cŞÜ:rgba(255,255,255,0.25);bÜd”-¿dius:5px}.ÿrou£l-šdiÿtÜ .aùive{background-cŞÜ:#fff}.ÿrou£l-ÿ±iÚ{pos™iÚ:absŞu‹;right:0;bÙtom:0;Ëá:0;·ddšg:15px;background:#333;background:rgba(0,0,0,0.75)}.ÿrou£l-ÿ±iÚ h4,.ÿrou£l-ÿ±iÚ…{lše-height:20px;cŞÜ:#fff}.ÿrou£l-ÿ±iÚ h4{m¬gš:0 0 5px}.ÿrou£l-ÿ±iÚ…{m¬gš-bÙtom:0}.h”o-un™{·ddšg:60px;m¬gš-bÙtom:30px;fÚt-size:18px;fÚt-weight:200;lše-height:30px;cŞÜ:šh”™;background-cŞÜ:#“e;-webk™-bÜd”-¿dius:6px;-moz-bÜd”-¿dius:6px;bÜd”-¿dius:6px}.h”o-un™ h1{m¬gš-bÙtom:0;fÚt-size:60px;lše-height:1;Ë‰”-¥acšg:-1px;cŞÜ:šh”™}.h”o-un™†i{lše-height:30px}.puÎ-right{:right}.puÎ-Ëá{:Ëá}.hide{di¥Ïy:nÚe}.show{di¥Ïy:block}.švisibË{visib™y:hidd’}.affix{pos™iÚ:fixed}

	@trunk/research/players/index.html

1 <!
DOCTYPE
 
	ghtml
>

2 <
	ghtml
>

3 <
	gh—d
>

4 <
	gt™Ë
>
	gSRS
</title>

5 <
m‘a
 
	gch¬£t
="utf-8">

6 <
lšk
 
»l
="¡yËsh“t" 
ty³
="‹xt/css" 
h»f
="css/bootstrap.min.css"/>

7 <
¡yË
>

8 
body
{

9 
·ddšg
-
tİ
: 55
px
;

11 </
	g¡yË
>

12 </
	gh—d
>

13 <
	gbody
>

14 <
div
 
	gşass
="navbar‚avbar-fixed-top">

15 <
div
 
şass
="navbar-inner">

16 <
div
 
şass
="container">

17 <
a
 
id
="¤s_šdex" 
şass
="b¿nd" 
h»f
="#">
SRS
</a>

18 <
div
 
şass
="nav-collapse collapse">

19 <
ul
 
şass
="nav">

20 <
li
><
a
 
id
="Çv_¤s_¶ay”" 
h»f
="¤s_¶ay”.html">
SRS
æ’­æ”¾å™¨</a></li>

21 <
li
><
a
 
id
="Çv_¤s_publish”" 
h»f
="¤s_publish”.html">
SRS
ç¼–ç å™¨</a></li>

22 <
li
><
a
 
id
="Çv_¤s_ch©" 
h»f
="¤s_ch©.html">
SRS
ä¼šè®®</a></li>

23 <
li
><
a
 
id
="Çv_¤s_bwt" 
h»f
="¤s_bwt.html">
SRS
æµ‹ç½‘é€Ÿ</a></li>

24 <
li
><
a
 
id
="Çv_jw¶ay”6" 
h»f
="jw¶ay”6.html">
JWPÏy”6
æ’­æ”¾å™¨</a></li>

25 <
li
><
a
 
id
="Çv_osmf" 
h»f
="osmf.html">
AdobeOSMF
æ’­æ”¾å™¨</a></li>

26 <
li
><
a
 
id
="Çv_vlc" 
h»f
="vlc.html">
VLC
æ’­æ”¾å™¨</a></li>

27 </
ul
>

28 </
div
>

29 </
div
>

30 </
div
>

31 </
div
>

32 <
div
 
şass
="container">

33 <
hr
>

34 <
foÙ”
>

35 <
p
><
a
 
h»f
="h‰ps://g™hub.com/os¤s/¤s">
SRS
 
T—m
 &
cİy
; 2013</
	ga
></
	gp
>

36 </
	gfoÙ”
>

37 </
	gdiv
>

38 <
süt
 
	gty³
="‹xt/javasüt" 
¤c
="js/jquery-1.10.2.min.js"></script>

39 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="js/bootstrap.min.js"></script>

40 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="js/swfobject.js"></script>

41 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="js/srs.page.js"></script>

42 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="js/srs.utility.js"></script>

43 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="js/winlin.utility.js"></script>

44 <
süt
 
ty³
="text/javascript">

45 
$
(
	$funùiÚ
(){

46 
	`upd©e_Çv
();

48 
v¬
 
qu”y
 = 
	`·r£_qu”y_¡ršg
();

49 
v¬
 
u¾
 = "¤s_ch©.html?vho¡=" + 
	`¤s_g‘_¶ay”_vho¡
();

51 
v¬
 
key
 
š
 
qu”y
.
u£r_qu”y
) {

52 ià(
key
 == "vhost") {

55 
u¾
 +ğ"&" + 
key
 + "=" + 
qu”y
[key];

58 
	`£tTimeout
(
	`funùiÚ
(){

59 
wšdow
.
loÿtiÚ
.
h»f
 = 
u¾
;

61 
	}
});

62 </
	gsüt
>

63 </
	gbody
>

	@trunk/research/players/jwplayer6.html

1 <!
DOCTYPE
 
	ghtml
>

2 <
	ghtml
>

3 <
	gh—d
>

4 <
	gt™Ë
>
	gSRS
</title>

5 <
m‘a
 
	gch¬£t
="utf-8">

6 <
lšk
 
»l
="¡yËsh“t" 
ty³
="‹xt/css" 
h»f
="css/bootstrap.min.css"/>

7 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="js/jquery-1.10.2.min.js"></script>

8 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="js/bootstrap.min.js"></script>

9 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="js/srs.page.js"></script>

10 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="js/srs.log.js"></script>

11 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="js/srs.player.js"></script>

12 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="js/srs.publisher.js"></script>

13 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="js/srs.utility.js"></script>

14 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="js/winlin.utility.js"></script>

15 <
¡yË
>

16 
body
{

17 
·ddšg
-
tİ
: 55
px
;

20 
	gwidth
: 700
px
;

21 
	gm¬gš
-
	gËá
: -350
px
;

23 </
	g¡yË
>

24 <
süt
 
	gty³
="‹xt/javasüt" 
¤c
="js/jwplayer.js" ></script>

25 <
süt
 
ty³
='‹xt/javasüt'>
jw¶ay”
.
key
 = 'N8zhkmYvvRwOhz4aTGkySoEri4x+9pQwR7GHIQ=='; </
	gsüt
>

26 <
süt
 
	gty³
="text/javascript">

27 
v¬
 
_¶ay”
 = 
nuÎ
;

28 
v¬
 
	g_u¾
 = 
nuÎ
;

29 
$
(
	$funùiÚ
(){

33 
	`¤s_š™
("#txt_rtmp_url", "#txt_hls_url", "#main_modal");

35 
	`$
("#maš_mod®").
	`Ú
("hide", 
	`funùiÚ
(){

36 
	`$
("#div_cÚš”").
	`»move
();

37 
_¶ay”
.
	`¡İ
();

40 
	`$
("#maš_mod®").
	`Ú
("show", 
	`funùiÚ
(){

41 
	`$
("#div_cÚš”").
	`»move
();

43 
v¬
 
div_cÚš”
 = 
	`$
("<div/>");

44 
	`$
(
div_cÚš”
).
	`©Œ
("id", "div_container");

45 
	`$
("#¶ay”").
	`­³nd
(
div_cÚš”
);

47 
v¬
 
¶ay”
 = 
	`$
("<div/>");

48 
	`$
(
¶ay”
).
	`©Œ
("id", "player_id");

49 
	`$
(
div_cÚš”
).
	`­³nd
(
¶ay”
);

51 
v¬
 
cÚf
 = {

52 
fe
: 
_u¾
,

53 
width
: 
	`¤s_g‘_¶ay”_width
(),

54 
height
: 
	`¤s_g‘_¶ay”_height
(),

55 
auto¡¬t
: 
Œue
,

56 
ª®ytics
: { 
’abËd
: 
çl£
}

58 
_¶ay”
 = 
	`jw¶ay”
('¶ay”_id').
	`£tup
(
cÚf
);

61 
	`$
("#bŠ_¶ay_¹mp").
	`şick
(
	`funùiÚ
(){

62 
_u¾
 = 
	`$
("#txt_¹mp_u¾").
	`v®
();

63 
	`$
("#maš_mod®").
	`mod®
({
show
:
Œue
, 
keybßrd
:
çl£
});

66 
	`$
("#bŠ_¶ay_hls").
	`şick
(
	`funùiÚ
(){

67 
_u¾
 = 
	`$
("#txt_hls_u¾").
	`v®
();

68 
	`$
("#maš_mod®").
	`mod®
({
show
:
Œue
, 
keybßrd
:
çl£
});

71 
v¬
 
qu”y
 = 
	`·r£_qu”y_¡ršg
();

72 ià(
qu”y
.
hls_auto¡¬t
 == "true") {

73 
_u¾
 = 
	`$
("#txt_hls_u¾").
	`v®
();

74 
	`$
("#maš_mod®").
	`mod®
({
show
:
Œue
, 
keybßrd
:
çl£
});

75 } ià(
qu”y
.
¹mp_auto¡¬t
 == "true") {

76 
_u¾
 = 
	`$
("#txt_¹mp_u¾").
	`v®
();

77 
	`$
("#maš_mod®").
	`mod®
({
show
:
Œue
, 
keybßrd
:
çl£
});

79 
	}
});

80 </
	gsüt
>

81 </
	gh—d
>

82 <
	gbody
>

83 <
div
 
	gşass
="navbar‚avbar-fixed-top">

84 <
div
 
şass
="navbar-inner">

85 <
div
 
şass
="container">

86 <
a
 
id
="¤s_šdex" 
şass
="b¿nd" 
h»f
="#">
SRS
</a>

87 <
div
 
şass
="nav-collapse collapse">

88 <
ul
 
şass
="nav">

89 <
li
><
a
 
id
="Çv_¤s_¶ay”" 
h»f
="¤s_¶ay”.html">
SRS
æ’­æ”¾å™¨</a></li>

90 <
li
><
a
 
id
="Çv_¤s_publish”" 
h»f
="¤s_publish”.html">
SRS
ç¼–ç å™¨</a></li>

91 <
li
><
a
 
id
="Çv_¤s_ch©" 
h»f
="¤s_ch©.html">
SRS
ä¼šè®®</a></li>

92 <
li
><
a
 
id
="Çv_¤s_bwt" 
h»f
="¤s_bwt.html">
SRS
æµ‹ç½‘é€Ÿ</a></li>

93 <
li
 
şass
="aùive"><
a
 
id
="Çv_jw¶ay”6" 
h»f
="jw¶ay”6.html">
JWPÏy”6
æ’­æ”¾å™¨</a></li>

94 <
li
><
a
 
id
="Çv_osmf" 
h»f
="osmf.html">
AdobeOSMF
æ’­æ”¾å™¨</a></li>

95 <
li
><
a
 
id
="Çv_vlc" 
h»f
="vlc.html">
VLC
æ’­æ”¾å™¨</a></li>

96 </
ul
>

97 </
div
>

98 </
div
>

99 </
div
>

100 </
div
>

101 <
div
 
şass
="container">

102 <
div
 
şass
="alert‡lert-info fade in">

103 <
bu‰Ú
 
ty³
="bu‰Ú" 
şass
="şo£" 
d©a
-
dismiss
="alert">Ã—</button>

104 <
¡rÚg
><
¥ª
>
U§ge
:</span></strong> <span>è¾“å…¥åœ°å€åç‚¹å‡»æ’­æ”¾æŒ‰é’®</span>

105 </
div
>

106 <
div
 
şass
="form-inline">

107 
URL
:

108 <
šput
 
ty³
="‹xt" 
id
="txt_¹mp_u¾" 
şass
="šput-xxÏrge" 
v®ue
=""></input>

109 <
bu‰Ú
 
şass
="bŠ bŠ-´im¬y" 
id
="bŠ_¶ay_¹mp">æ’­æ”¾
RTMP
</button>

110 </
div
>

111 <
hr
/>

112 <
div
 
şass
="form-inline">

113 
URL
:

114 <
šput
 
ty³
="‹xt" 
id
="txt_hls_u¾" 
şass
="šput-xxÏrge" 
v®ue
=""></input>

115 <
bu‰Ú
 
şass
="bŠ bŠ-´im¬y" 
id
="bŠ_¶ay_hls"> æ’­æ”¾
HLS
 </button>

116 </
div
>

117 <
div
 
id
="maš_mod®" 
şass
="modal hide fade">

118 <
div
 
şass
="modal-header">

119 <
bu‰Ú
 
ty³
="bu‰Ú" 
şass
="şo£" 
d©a
-
dismiss
="mod®" 
¬Ÿ
-
hidd’
="true">Ã—</button>

120 <
h3
>
JWPÏy”6
</h3>

121 </
div
>

122 <
div
 
şass
="mod®-body" 
id
="player">

123 </
div
>

124 <
div
 
şass
="modal-footer">

125 <
bu‰Ú
 
şass
="bŠ bŠ-´im¬y" 
d©a
-
dismiss
="mod®" 
¬Ÿ
-
hidd’
="true"> å…³é—­ </button>

126 </
div
>

127 </
div
>

128 <
hr
>

129 <
foÙ”
>

130 <
p
><
a
 
h»f
="h‰ps://g™hub.com/os¤s/¤s">
SRS
 
T—m
 &
cİy
; 2013</
	ga
></
	gp
>

131 </
	gfoÙ”
>

132 </
	gdiv
>

133 </
	gbody
>

	@trunk/research/players/nginx_index.html

1 <!
DOCTYPE
 
	ghtml
>

2 <
	ghtml
>

3 <
	gh—d
>

4 <
	gt™Ë
>
	gSRS
</title>

5 <
m‘a
 
	gch¬£t
="utf-8">

6 </
h—d
>

7 <
body
>

8 </
body
>

9 <
süt
 
ty³
="text/javascript">

10 
£tTimeout
(
	$funùiÚ
(){

11 
wšdow
.
loÿtiÚ
.
h»f
 = "¶ay”s/šdex.html" + wšdow.loÿtiÚ.
£¬ch
;

12 
	}
}, 500);

13 </
	gsüt
>

14 </
	ghtml
>

	@trunk/research/players/osmf.html

1 <!
DOCTYPE
 
	ghtml
>

2 <
	ghtml
>

3 <
	gh—d
>

4 <
	gt™Ë
>
	gSRS
</title>

5 <
m‘a
 
	gch¬£t
="utf-8">

6 <
lšk
 
»l
="¡yËsh“t" 
ty³
="‹xt/css" 
h»f
="css/bootstrap.min.css"/>

7 <
¡yË
>

8 
body
{

9 
·ddšg
-
tİ
: 55
px
;

12 
	gwidth
: 700
px
;

13 
	gm¬gš
-
	gËá
: -350
px
;

15 </
	g¡yË
>

16 </
	gh—d
>

17 <
	gbody
>

18 <
div
 
	gşass
="navbar‚avbar-fixed-top">

19 <
div
 
şass
="navbar-inner">

20 <
div
 
şass
="container">

21 <
a
 
id
="¤s_šdex" 
şass
="b¿nd" 
h»f
="#">
SRS
</a>

22 <
div
 
şass
="nav-collapse collapse">

23 <
ul
 
şass
="nav">

24 <
li
><
a
 
id
="Çv_¤s_¶ay”" 
h»f
="¤s_¶ay”.html">
SRS
æ’­æ”¾å™¨</a></li>

25 <
li
><
a
 
id
="Çv_¤s_publish”" 
h»f
="¤s_publish”.html">
SRS
ç¼–ç å™¨</a></li>

26 <
li
><
a
 
id
="Çv_¤s_ch©" 
h»f
="¤s_ch©.html">
SRS
ä¼šè®®</a></li>

27 <
li
><
a
 
id
="Çv_¤s_bwt" 
h»f
="¤s_bwt.html">
SRS
æµ‹ç½‘é€Ÿ</a></li>

28 <
li
><
a
 
id
="Çv_jw¶ay”6" 
h»f
="jw¶ay”6.html">
JWPÏy”6
æ’­æ”¾å™¨</a></li>

29 <
li
 
şass
="aùive"><
a
 
id
="Çv_osmf" 
h»f
="osmf.html">
AdobeOSMF
æ’­æ”¾å™¨</a></li>

30 <
li
><
a
 
id
="Çv_vlc" 
h»f
="vlc.html">
VLC
æ’­æ”¾å™¨</a></li>

31 </
ul
>

32 </
div
>

33 </
div
>

34 </
div
>

35 </
div
>

36 <
div
 
şass
="container">

37 <
div
 
şass
="alert‡lert-info fade in">

38 <
bu‰Ú
 
ty³
="bu‰Ú" 
şass
="şo£" 
d©a
-
dismiss
="alert">Ã—</button>

39 <
¡rÚg
><
¥ª
>
U§ge
:</span></strong> <span>è¾“å…¥åœ°å€åç‚¹å‡»æ’­æ”¾æŒ‰é’®</span>

40 </
div
>

41 <
div
 
şass
="form-inline">

42 
URL
:

43 <
šput
 
ty³
="‹xt" 
id
="txt_u¾" 
şass
="šput-xxÏrge" 
v®ue
=""></input>

44 <
bu‰Ú
 
şass
="bŠ bŠ-´im¬y" 
id
="btn_play">æ’­æ”¾è§†é¢‘</button>

45 </
div
>

46 <
div
 
id
="maš_mod®" 
şass
="modal hide fade">

47 <
div
 
şass
="modal-header">

48 <
bu‰Ú
 
ty³
="bu‰Ú" 
şass
="şo£" 
d©a
-
dismiss
="mod®" 
¬Ÿ
-
hidd’
="true">Ã—</button>

49 <
h3
>
AdobeOSMF
</h3>

50 </
div
>

51 <
div
 
şass
="mod®-body" 
id
="player">

52 </
div
>

53 <
div
 
şass
="modal-footer">

54 <
bu‰Ú
 
şass
="bŠ bŠ-´im¬y" 
d©a
-
dismiss
="mod®" 
¬Ÿ
-
hidd’
="true"> å…³é—­ </button>

55 </
div
>

56 </
div
>

57 <
hr
>

58 <
foÙ”
>

59 <
p
><
a
 
h»f
="h‰ps://g™hub.com/os¤s/¤s">
SRS
 
T—m
 &
cİy
; 2013</
	ga
></
	gp
>

60 </
	gfoÙ”
>

61 </
	gdiv
>

62 </
	gbody
>

63 <
süt
 
	gty³
="‹xt/javasüt" 
¤c
="js/jquery-1.10.2.min.js"></script>

64 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="js/bootstrap.min.js"></script>

65 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="js/swfobject.js"></script>

66 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="js/srs.page.js"></script>

67 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="js/srs.log.js"></script>

68 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="js/srs.player.js"></script>

69 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="js/srs.publisher.js"></script>

70 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="js/srs.utility.js"></script>

71 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="js/winlin.utility.js"></script>

72 <
süt
 
ty³
="text/javascript">

73 
funùiÚ
 
	$osmf_¶ay
(
u¾
) {

74 
	`$
("#div_cÚš”").
	`»move
();

76 
v¬
 
div_cÚš”
 = 
	`$
("<div/>");

77 
	`$
(
div_cÚš”
).
	`©Œ
("id", "div_container");

78 
	`$
("#¶ay”").
	`­³nd
(
div_cÚš”
);

80 
v¬
 
¶ay”
 = 
	`$
("<div/>");

81 
	`$
(
¶ay”
).
	`©Œ
("id", "player_id");

82 
	`$
(
div_cÚš”
).
	`­³nd
(
¶ay”
);

84 
v¬
 
æashv¬s
 = {};

85 
æashv¬s
.
¤c
 = 
u¾
;

86 
æashv¬s
.
¡»amTy³
 = "live";

87 
æashv¬s
.
autoPÏy
 = 
Œue
;

88 
æashv¬s
.
cÚŒŞB¬AutoHide
 = 
çl£
;

89 
æashv¬s
.
sÿËMode
 = "stretch";

90 
æashv¬s
.
bufãrTime
 = 0.8;

92 
v¬
 
·¿ms
 = {};

93 
·¿ms
.
®lowFuÎSü“n
 = 
Œue
;

95 
v¬
 
©Œibu‹s
 = {};

97 
swfobjeù
.
	`embedSWF
(

99 
	`¤s_g‘_¶ay”_width
(), 
	`¤s_g‘_¶ay”_height
(),

101 
æashv¬s
, 
·¿ms
, 
©Œibu‹s


103 
	}
}

104 
$
(
	$funùiÚ
(){

108 
	`¤s_š™_¹mp
("#txt_url", "#main_modal");

110 
	`$
("#maš_mod®").
	`Ú
("hide", 
	`funùiÚ
(){

111 
	`osmf_¶ay
("http://localhost");

112 
	`$
("#div_cÚš”").
	`»move
();

114 
	`$
("#maš_mod®").
	`Ú
("show", 
	`funùiÚ
(){

115 
v¬
 
u¾
 = 
	`$
("#txt_u¾").
	`v®
();

116 
	`osmf_¶ay
(
u¾
);

119 
	`$
("#bŠ_¶ay").
	`şick
(
	`funùiÚ
(){

120 
	`$
("#maš_mod®").
	`mod®
({
show
:
Œue
, 
keybßrd
:
çl£
});

122 
	}
});

123 </
	gsüt
>

124 </
	ghtml
>

	@trunk/research/players/srs-http-server_index.html

1 <!
DOCTYPE
 
	ghtml
>

2 <
	ghtml
>

3 <
	gh—d
>

4 <
	gt™Ë
>
	gSRS
</title>

5 <
m‘a
 
	gch¬£t
="utf-8">

6 </
h—d
>

7 <
body
>

8 </
body
>

9 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="players/js/jquery-1.10.2.min.js"></script>

10 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="players/js/srs.page.js"></script>

11 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="players/js/srs.utility.js"></script>

12 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="players/js/winlin.utility.js"></script>

13 <
süt
 
ty³
="text/javascript">

14 
£tTimeout
(
	$funùiÚ
(){

15 
wšdow
.
loÿtiÚ
.
h»f
 = "¶ay”s/šdex.html" + wšdow.loÿtiÚ.
£¬ch
;

16 
	}
}, 500);

17 </
	gsüt
>

18 </
	ghtml
>

	@trunk/research/players/srs_bwt.html

1 <!
DOCTYPE
 
	ghtml
>

2 <
	ghtml
>

3 <
	gh—d
>

4 <
	gt™Ë
>
	gSRS
</title>

5 <
m‘a
 
	gch¬£t
="utf-8">

6 <
lšk
 
»l
="¡yËsh“t" 
ty³
="‹xt/css" 
h»f
="css/bootstrap.min.css"/>

7 <
¡yË
>

8 
body
{

9 
·ddšg
-
tİ
: 55
px
;

12 
	gwidth
: 700
px
;

13 
	gm¬gš
-
	gËá
: -350
px
;

15 </
	g¡yË
>

16 </
	gh—d
>

17 <
	gbody
>

18 <
div
 
	gşass
="navbar‚avbar-fixed-top">

19 <
div
 
şass
="navbar-inner">

20 <
div
 
şass
="container">

21 <
a
 
id
="¤s_šdex" 
şass
="b¿nd" 
h»f
="#">
SRS
</a>

22 <
div
 
şass
="nav-collapse collapse">

23 <
ul
 
şass
="nav">

24 <
li
><
a
 
id
="Çv_¤s_¶ay”" 
h»f
="¤s_¶ay”.html">
SRS
æ’­æ”¾å™¨</a></li>

25 <
li
><
a
 
id
="Çv_¤s_publish”" 
h»f
="¤s_publish”.html">
SRS
ç¼–ç å™¨</a></li>

26 <
li
><
a
 
id
="Çv_¤s_ch©" 
h»f
="¤s_ch©.html">
SRS
ä¼šè®®</a></li>

27 <
li
 
şass
="aùive"><
a
 
id
="Çv_¤s_bwt" 
h»f
="¤s_bwt.html">
SRS
æµ‹ç½‘é€Ÿ</a></li>

28 <
li
><
a
 
id
="Çv_jw¶ay”6" 
h»f
="jw¶ay”6.html">
JWPÏy”6
æ’­æ”¾å™¨</a></li>

29 <
li
><
a
 
id
="Çv_osmf" 
h»f
="osmf.html">
AdobeOSMF
æ’­æ”¾å™¨</a></li>

30 <
li
><
a
 
id
="Çv_vlc" 
h»f
="vlc.html">
VLC
æ’­æ”¾å™¨</a></li>

31 </
ul
>

32 </
div
>

33 </
div
>

34 </
div
>

35 </
div
>

36 <
div
 
şass
="container">

37 <
div
 
şass
="alert‡lert-info fade in">

38 <
bu‰Ú
 
ty³
="bu‰Ú" 
şass
="şo£" 
d©a
-
dismiss
="alert">Ã—</button>

39 <
¡rÚg
><
¥ª
>
U§ge
:</span></strong> <span>ç‚¹å‡»â€œå¼€å§‹æµ‹é€Ÿâ€å³å¯æµ‹å¸¦å®½ï¼Œæœ€å¤§å¯æµ‹è¯•å¸¦å®½ç”±æœåŠ¡å™¨é™åˆ¶</span>

40 </
div
>

41 <
div
 
şass
="form-inline">

42 
URL
:

43 <
šput
 
ty³
="‹xt" 
id
="txt_u¾" 
şass
="šput-xxÏrge" 
v®ue
=""></input>

44 <
bu‰Ú
 
şass
="bŠ bŠ-´im¬y" 
id
="btn_play">å¼€å§‹æµ‹é€Ÿ</button>

45 </
div
>

46 <
div
 
id
="maš_mod®" 
şass
="modal hide fade">

47 <
div
 
şass
="modal-header">

48 <
bu‰Ú
 
ty³
="bu‰Ú" 
şass
="şo£" 
d©a
-
dismiss
="mod®" 
¬Ÿ
-
hidd’
="true">Ã—</button>

49 <
h3
>
SRS
 
Bªdwidth
 
Check
</h3>

50 </
div
>

51 <
div
 
şass
="modal-body">

52 <
div
 
şass
="row-fluid">

53 <
div
 
şass
="span1"></div>

54 <
div
 
şass
="span10">

55 <
div
 
şass
="´og»s ´og»ss-¡red‡ùive" 
id
="pb_buffer_bg">

56 <
div
 
şass
="b¬" 
¡yË
="width: 0%;" 
id
="progress_bar"></div>

57 </
div
>

58 </
div
>

59 <
div
 
şass
="span1"></div>

60 </
div
>

61 <
div
 
id
="check_¡©us">
¡©us
</div>

62 <
div
 
id
="check_šfo">
šfo
</div>

63 </
div
>

64 <
div
 
şass
="modal-footer">

65 <
bu‰Ú
 
şass
="bŠ bŠ-´im¬y" 
d©a
-
dismiss
="mod®" 
¬Ÿ
-
hidd’
="true"> å…³é—­ </button>

66 </
div
>

67 </
div
>

68 <
hr
>

69 <
foÙ”
>

70 <
p
><
a
 
h»f
="h‰ps://g™hub.com/os¤s/¤s">
SRS
 
T—m
 &
cİy
; 2013</
	ga
></
	gp
>

71 </
	gfoÙ”
>

72 <
div
 
	gşass
="container">

73 <
div
 
id
="player"></div>

74 </
div
>

75 </
div
>

76 </
body
>

77 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="js/jquery-1.10.2.min.js"></script>

78 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="js/bootstrap.min.js"></script>

79 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="js/swfobject.js"></script>

80 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="js/srs.page.js"></script>

81 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="js/srs.log.js"></script>

82 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="js/srs.player.js"></script>

83 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="js/srs.publisher.js"></script>

84 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="js/srs.utility.js"></script>

85 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="js/winlin.utility.js"></script>

86 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="srs_bwt/src/srs.bandwidth.js"></script>

87 <
süt
 
ty³
="text/javascript">

88 
v¬
 
bªdwidth
 = 
nuÎ
;

90 
$
(
	$funùiÚ
(){

91 
	`¤s_š™_bwt
("#txt_url");

93 
	`$
("#bŠ_¶ay").
	`şick
(
Ú_şick_¶ay
);

94 
	`$
("#maš_mod®").
	`Ú
("show", 
Ú_¡¬t_bªdwidth_‹¡
);

95 
	`$
("#maš_mod®").
	`Ú
("hide", 
Ú_¡İ_bªdwidth_‹¡
);

96 
	}
});

98 
funùiÚ
 
	$Ú_şick_¶ay
() {

99 
	`$
("#check_¡©us").
	`‹xt
("");

100 
	`$
("#check_šfo").
	`‹xt
("");

101 
	`$
("#´og»ss_b¬").
	`width
("0%");

102 
	`$
("#maš_mod®").
	`mod®
({
show
:
Œue
, 
keybßrd
:
çl£
});

103 
	}
}

104 
funùiÚ
 
	$Ú_¡¬t_bªdwidth_‹¡
() {

105 
	`$
("#div_cÚš”").
	`»move
();

106 
	`$
("#´og»ss_b¬").
	`»moveCÏss
("bar-danger");

108 
v¬
 
div_cÚš”
 = 
	`$
("<div/>");

109 
	`$
(
div_cÚš”
).
	`©Œ
("id", "div_container");

110 
	`$
("#¶ay”").
	`­³nd
(
div_cÚš”
);

112 
v¬
 
¶ay”
 = 
	`$
("<div/>");

113 
	`$
(
¶ay”
).
	`©Œ
("id", "player_id");

114 
	`$
(
div_cÚš”
).
	`­³nd
(
¶ay”
);

116 
v¬
 
u¾
 = 
	`$
("#txt_u¾").
	`v®
();

118 
bªdwidth
 = 
Ãw
 
	`SrsBªdwidth
("player_id", 100, 1);

119 
bªdwidth
.
Ú_bªdwidth_»ady
 = 
	`funùiÚ
() {

120 
this
.
	`check_bªdwidth
(
u¾
);

122 
bªdwidth
.
Ú_upd©e_´og»ss
 = 
	`funùiÚ
(
³rûÁ
) {

123 
	`$
("#´og»ss_b¬").
	`width
(
³rûÁ
 + "%");

125 
bªdwidth
.
Ú_upd©e_¡©us
 = 
	`funùiÚ
(
¡©us
) {

126 
	`$
("#check_¡©us").
	`‹xt
(
¡©us
);

128 
bªdwidth
.
Ú_¤s_šfo
 = 
	`funùiÚ
(
¤s_£rv”
, 
¤s_´im¬y
, 
¤s_authÜs
, 
¤s_id
, 
¤s_pid
, 
¤s_£rv”_
) {

129 
	`$
("#check_šfo").
	`‹xt
(

130 "£rv”:" + 
¤s_£rv”
 + ",…rim¬y:" + 
¤s_´im¬y
 + ",‡uthÜs:" + 
¤s_authÜs
 +

131 ", srs_id:" + 
¤s_id
 + ", srs_pid:" + 
¤s_pid
 + ", ip:" + 
¤s_£rv”_


134 
bªdwidth
.
Ú_”rÜ
 = 
	`funùiÚ
(
code
) {

135 
	`$
("#´og»ss_b¬").
	`addCÏss
("bar-danger");

137 
bªdwidth
.
	`»nd”
(
u¾
);

138 
	}
}

139 
funùiÚ
 
	$Ú_¡İ_bªdwidth_‹¡
() {

140 
bªdwidth
.
	`¡İ
();

141 
	}
}

142 </
	gsüt
>

143 </
	ghtml
>

	@trunk/research/players/srs_chat.html

1 <!
DOCTYPE
 
	ghtml
>

2 <
	ghtml
>

3 <
	gh—d
>

4 <
	gt™Ë
>
	gSRS
</title>

5 <
m‘a
 
	gch¬£t
="utf-8">

6 <
lšk
 
»l
="¡yËsh“t" 
ty³
="‹xt/css" 
h»f
="css/bootstrap.min.css"/>

7 <
¡yË
>

8 
body
{

9 
·ddšg
-
tİ
: 55
px
;

11 .
	gaccÜdiÚ
-
	ggroup
 {

12 
	gwidth
: 310
px
;

14 </
	g¡yË
>

15 </
	gh—d
>

16 <
	gbody
>

17 <
div
 
	gşass
="navbar‚avbar-fixed-top">

18 <
div
 
şass
="navbar-inner">

19 <
div
 
şass
="container">

20 <
a
 
id
="¤s_šdex" 
şass
="b¿nd" 
h»f
="#">
SRS
</a>

21 <
div
 
şass
="nav-collapse collapse">

22 <
ul
 
şass
="nav">

23 <
li
><
a
 
id
="Çv_¤s_¶ay”" 
h»f
="¤s_¶ay”.html">
SRS
æ’­æ”¾å™¨</a></li>

24 <
li
><
a
 
id
="Çv_¤s_publish”" 
h»f
="¤s_publish”.html">
SRS
ç¼–ç å™¨</a></li>

25 <
li
 
şass
="aùive"><
a
 
id
="Çv_¤s_ch©" 
h»f
="¤s_ch©.html">
SRS
ä¼šè®®</a></li>

26 <
li
><
a
 
id
="Çv_¤s_bwt" 
h»f
="¤s_bwt.html">
SRS
æµ‹ç½‘é€Ÿ</a></li>

27 <
li
><
a
 
id
="Çv_jw¶ay”6" 
h»f
="jw¶ay”6.html">
JWPÏy”6
æ’­æ”¾å™¨</a></li>

28 <
li
><
a
 
id
="Çv_osmf" 
h»f
="osmf.html">
AdobeOSMF
æ’­æ”¾å™¨</a></li>

29 <
li
><
a
 
id
="Çv_vlc" 
h»f
="vlc.html">
VLC
æ’­æ”¾å™¨</a></li>

30 </
ul
>

31 </
div
>

32 </
div
>

33 </
div
>

34 </
div
>

35 <
div
 
şass
="container">

36 <!-- 
the
 
log
 -->

37 <
div
 
şass
="®”ˆ®”t-šfØçdš" 
id
="txt_log">

38 <
bu‰Ú
 
ty³
="bu‰Ú" 
şass
="şo£" 
d©a
-
dismiss
="alert">Ã—</button>

39 <
¡rÚg
><
¥ª
 
id
="txt_log_t™Ë">
U§ge
:</span></strong>

40 <
¥ª
 
id
="txt_log_msg">è¾“å…¥åå­—ï¼Œè®¾ç‚¹â€œåŠ å…¥ä¼šè®®â€æŒ‰é’®</span>

41 </
div
>

43 <
div
 
şass
="control-group">

44 <
div
 
şass
="form-inline">

45 <
bu‰Ú
 
şass
="bŠ iÅut-sm®l" 
id
="btn_video_settings">æ‘„åƒå¤´</button>

46 <
bu‰Ú
 
şass
="bŠ iÅut-sm®l" 
id
="btn_audio_settings">éº¦å…‹é£</button>

47 <
šput
 
ty³
="‹xt" 
id
="txt_Çme" 
şass
="šput-Ïrge" 
¶aûhŞd”
="è¯·è¾“å…¥æ‚¨çš„åå­—..." 
v®ue
=""></input>

48 <
bu‰Ú
 
şass
="bŠ iÅut-sm®l" 
id
="btn_join">åŠ å…¥ä¼šè®®</button>

49 <
šput
 
ty³
="‹xt" 
id
="txt_u¾" 
şass
="šput-mš˜hide" 
v®ue
=""></input>

50 </
div
>

51 </
div
>

52 <
bË
 
id
="l¡_ch©s" 
şass
="table">

53 <
Œ
>

54 <
td
 
id
="td_0">

55 <
div
 
şass
="accordion-group">

56 <
div
 
şass
="accordion-heading">

57 <
¥ª
 
şass
="accordion-toggle">

58 <
¡rÚg
>[æˆ‘çš„] æœ¬åœ°æ‘„åƒå¤´</strong>

59 </
¥ª
>

60 </
div
>

61 <
div
 
şass
="accordion-body collapse in">

62 <
div
 
şass
="accordion-inner">

63 <
div
 
id
="local_publisher"></div>

64 </
div
>

65 </
div
>

66 </
div
>

67 </
td
>

68 <
td
 
id
="td_1">

69 <
div
 
şass
="accordion-group">

70 <
div
 
şass
="accordion-heading">

71 <
¥ª
 
şass
="accordion-toggle">

72 <
¡rÚg
>[æˆ‘çš„] è¿œç¨‹æœåŠ¡å™¨æµ</strong>

73 <
a
 
id
="»®time_¶ay”_u¾" 
h»f
="#" 
d©a
-
toggË
="toŞt" d©a-
¶aûm’t
="tİ" 
t™Ë
="">

74 æ’­æ”¾åœ°å€<
img
 
¤c
="img/tooltip.png"/>

75 </
a
>

76 </
¥ª
>

77 </
div
>

78 <
div
 
şass
="accordion-body collapse in">

79 <
div
 
şass
="accordion-inner">

80 <
div
 
id
="realtime_player"></div>

81 </
div
>

82 </
div
>

83 </
div
>

84 </
td
>

85 <
td
 
id
="td_2"></td>

86 </
Œ
>

87 </
bË
>

88 <
div
 
şass
="cÚš” hide" 
id
="template">

89 <
div
 
şass
="accÜdiÚ-group" 
id
="collapse_main">

90 <
div
 
şass
="accÜdiÚ-h—dšg" 
t™Ë
="ç‚¹å‡»å±•å¼€æˆ–æ”¶èµ·ï¼Œæ”¶èµ·ååœæ­¢æ’­æ”¾æµï¼Œå±•å¼€æ—¶ä»æœåŠ¡å™¨è¯·æ±‚æµ">

91 <
¥ª
 
id
="h—d”N" 
şass
="accÜdiÚ-toggË" 
d©a
-
toggË
="cŞÏp£" 
h»f
="#collapseN">

92 <
¡rÚg
>[<
a
 
h»f
="#"><
¥ª
 
id
="u£r_Çme">
XX
</span></a>]</strong>

93 <
¡rÚg
>åŠ å…¥æ—¶é—´</¡rÚg>[<
¥ª
 
id
="join_date"></span>]

94 <
a
 
id
="u£r_¶ay”_u¾" 
h»f
="#" 
d©a
-
toggË
="toŞt" d©a-
¶aûm’t
="tİ" 
t™Ë
="">

95 æ’­æ”¾åœ°å€<
img
 
¤c
="img/tooltip.png"/>

96 </
a
>

97 </
¥ª
>

98 </
div
>

99 <
div
 
id
="cŞÏp£M" 
şass
="accordion-body collapse in">

100 <
div
 
şass
="accordion-inner">

101 <
div
 
id
="chat_player">

102 <
div
 
id
="chat_player_raw">

103 </
div
>

104 </
div
>

105 </
div
>

106 </
div
>

107 </
div
>

108 </
div
>

109 <
bË
 
şass
="table">

110 </
bË
>

111 <
div
 
id
="video_mod®" 
şass
="modal hide fade">

112 <
div
 
şass
="modal-header">

113 <
bu‰Ú
 
ty³
="bu‰Ú" 
şass
="şo£" 
d©a
-
dismiss
="mod®" 
¬Ÿ
-
hidd’
="true">Ã—</button>

114 <
h3
>è§†é¢‘ç¼–ç </h3>

115 </
div
>

116 <
div
 
şass
="modal-body">

117 <
div
 
şass
="form-horizontal">

118 <
div
 
şass
="control-group">

119 <
Ïb–
 
şass
="control-label" ="sl_cameras">

121 <
a
 
id
="¦_ÿm”as_ts" 
h»f
="#" 
d©a
-
toggË
="toŞt" d©a-
¶aûm’t
="right" 
t™Ë
="">

122 <
img
 
¤c
="img/tooltip.png"/>

123 </
a
>

124 </
Ïb–
>

125 <
div
 
şass
="controls">

126 <
£Ëù
 
şass
="¥ª4" 
id
="sl_cameras"></select>

127 </
div
>

128 </
div
>

129 <
div
 
şass
="control-group">

130 <
Ïb–
 
şass
="control-label" ="sl_vcodec">

131 
Codec


132 <
a
 
id
="¦_ÿm”as_ts" 
h»f
="#" 
d©a
-
toggË
="toŞt" d©a-
¶aûm’t
="right" 
t™Ë
="">

133 <
img
 
¤c
="img/tooltip.png"/>

134 </
a
>

135 </
Ïb–
>

136 <
div
 
şass
="controls">

137 <
£Ëù
 
şass
="¥ª2" 
id
="sl_vcodec"></select>

138 </
div
>

139 </
div
>

140 <
div
 
şass
="control-group">

141 <
Ïb–
 
şass
="control-label" ="sl_profile">

142 
Profe


143 <
a
 
id
="¦_´ofe_ts" 
h»f
="#" 
d©a
-
toggË
="toŞt" d©a-
¶aûm’t
="right" 
t™Ë
="">

144 <
img
 
¤c
="img/tooltip.png"/>

145 </
a
>

146 </
Ïb–
>

147 <
div
 
şass
="controls">

148 <
£Ëù
 
şass
="¥ª2" 
id
="sl_profile"></select>

149 </
div
>

150 </
div
>

151 <
div
 
şass
="control-group">

152 <
Ïb–
 
şass
="control-label" ="sl_level">

153 
Lev–


154 <
a
 
id
="¦_Ëv–_ts" 
h»f
="#" 
d©a
-
toggË
="toŞt" d©a-
¶aûm’t
="right" 
t™Ë
="">

155 <
img
 
¤c
="img/tooltip.png"/>

156 </
a
>

157 </
Ïb–
>

158 <
div
 
şass
="controls">

159 <
£Ëù
 
şass
="¥ª2" 
id
="sl_level"></select>

160 </
div
>

161 </
div
>

162 <
div
 
şass
="control-group">

163 <
Ïb–
 
şass
="control-label" ="sl_gop">

164 
GOP


165 <
a
 
id
="¦_gİ_ts" 
h»f
="#" 
d©a
-
toggË
="toŞt" d©a-
¶aûm’t
="right" 
t™Ë
="">

166 <
img
 
¤c
="img/tooltip.png"/>

167 </
a
>

168 </
Ïb–
>

169 <
div
 
şass
="controls">

170 <
£Ëù
 
şass
="¥ª2" 
id
="sl_gop"></select>

171 </
div
>

172 </
div
>

173 <
div
 
şass
="control-group">

174 <
Ïb–
 
şass
="control-label" ="sl_size">

176 <
a
 
id
="¦_size_ts" 
h»f
="#" 
d©a
-
toggË
="toŞt" d©a-
¶aûm’t
="right" 
t™Ë
="">

177 <
img
 
¤c
="img/tooltip.png"/>

178 </
a
>

179 </
Ïb–
>

180 <
div
 
şass
="controls">

181 <
£Ëù
 
şass
="¥ª2" 
id
="sl_size"></select>

182 </
div
>

183 </
div
>

184 <
div
 
şass
="control-group">

185 <
Ïb–
 
şass
="control-label" ="sl_fps">

187 <
a
 
id
="¦_ås_ts" 
h»f
="#" 
d©a
-
toggË
="toŞt" d©a-
¶aûm’t
="right" 
t™Ë
="">

188 <
img
 
¤c
="img/tooltip.png"/>

189 </
a
>

190 </
Ïb–
>

191 <
div
 
şass
="controls">

192 <
£Ëù
 
şass
="¥ª2" 
id
="sl_fps"></select>

193 </
div
>

194 </
div
>

195 <
div
 
şass
="control-group">

196 <
Ïb–
 
şass
="control-label" ="sl_bitrate">

198 <
a
 
id
="¦_b™¿‹_ts" 
h»f
="#" 
d©a
-
toggË
="toŞt" d©a-
¶aûm’t
="right" 
t™Ë
="">

199 <
img
 
¤c
="img/tooltip.png"/>

200 </
a
>

201 </
Ïb–
>

202 <
div
 
şass
="controls">

203 <
£Ëù
 
şass
="¥ª2" 
id
="sl_bitrate"></select>

204 </
div
>

205 </
div
>

206 </
div
>

207 </
div
>

208 <
div
 
şass
="modal-footer">

209 <
bu‰Ú
 
şass
="bŠ bŠ-´im¬y" 
d©a
-
dismiss
="mod®" 
¬Ÿ
-
hidd’
="true">è®¾ç½®</button>

210 </
div
>

211 </
div
>

212 <
div
 
id
="audio_mod®" 
şass
="modal hide fade">

213 <
div
 
şass
="modal-header">

214 <
bu‰Ú
 
ty³
="bu‰Ú" 
şass
="şo£" 
d©a
-
dismiss
="mod®" 
¬Ÿ
-
hidd’
="true">Ã—</button>

215 <
h3
>éŸ³é¢‘ç¼–ç </h3>

216 </
div
>

217 <
div
 
şass
="modal-body">

218 <
div
 
şass
="form-horizontal">

219 <
div
 
şass
="control-group">

220 <
Ïb–
 
şass
="control-label" ="sl_microphones">

222 <
a
 
id
="wÜk”_id_ts" 
h»f
="#" 
d©a
-
toggË
="toŞt" d©a-
¶aûm’t
="right" 
t™Ë
="">

223 <
img
 
¤c
="img/tooltip.png"/>

224 </
a
>

225 </
Ïb–
>

226 <
div
 
şass
="controls">

227 <
£Ëù
 
şass
="¥ª4" 
id
="sl_microphones"></select>

228 </
div
>

229 </
div
>

230 <
div
 
şass
="control-group">

231 <
Ïb–
 
şass
="control-label" ="sl_acodec">

233 <
a
 
id
="¦_acodec_ts" 
h»f
="#" 
d©a
-
toggË
="toŞt" d©a-
¶aûm’t
="right" 
t™Ë
="">

234 <
img
 
¤c
="img/tooltip.png"/>

235 </
a
>

236 </
Ïb–
>

237 <
div
 
şass
="controls">

238 <
£Ëù
 
şass
="¥ª2" 
id
="sl_acodec"></select>

239 </
div
>

240 </
div
>

241 </
div
>

242 </
div
>

243 <
div
 
şass
="modal-footer">

244 <
bu‰Ú
 
şass
="bŠ bŠ-´im¬y" 
d©a
-
dismiss
="mod®" 
¬Ÿ
-
hidd’
="true">è®¾ç½®</button>

245 </
div
>

246 </
div
>

247 <
hr
/>

248 <
foÙ”
>

249 <
p
><
a
 
h»f
="h‰ps://g™hub.com/os¤s/¤s">
SRS
 
T—m
 &
cİy
; 2013</
	ga
></
	gp
>

250 </
	gfoÙ”
>

251 </
	gdiv
>

252 </
	gbody
>

253 <
süt
 
	gty³
="‹xt/javasüt" 
¤c
="js/jquery-1.10.2.min.js"></script>

254 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="js/bootstrap.min.js"></script>

255 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="js/swfobject.js"></script>

256 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="js/json2.js"></script>

257 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="js/srs.page.js"></script>

258 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="js/srs.log.js"></script>

259 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="js/srs.player.js"></script>

260 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="js/srs.publisher.js"></script>

261 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="js/srs.utility.js"></script>

262 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="js/winlin.utility.js"></script>

263 <
süt
 
ty³
="text/javascript">

264 
v¬
 
¤s_publish”
 = 
nuÎ
;

265 
v¬
 
	g»®time_¶ay”
 = 
nuÎ
;

266 
v¬
 
	g­i_£rv”
 = 
nuÎ
;

267 
v¬
 
	g£lf_ch©
 = 
nuÎ
;

268 
v¬
 
	gglob®_ch©_u£r_id
 = 200;

269 
v¬
 
	g´evious_ch©s
 = [];

270 
v¬
 
	gno_¶ay
 = 
çl£
;

272 
v¬
 
	gqu”y
 = 
·r£_qu”y_¡ršg
();

273 
$
(
	$funùiÚ
(){

277 
	`¤s_š™_publish
("#txt_url");

280 
v¬
 
i
 = 0; i < 5; i++) {

281 
v¬
 
Œ
 = 
	`$
("<Œ></Œ>").
	`hide
();

282 
	`$
("#l¡_ch©s").
	`­³nd
(
Œ
);

284 
v¬
 
j
 = 0; j < 3; j++) {

285 
Œ
.
	`­³nd
(
	`$
("<td></td>").
	`©Œ
("id", "td_" + ((
i
+1è* 8 + 
j
)));

289 
	`$
("#l¡_ch©s").
	`fšd
("td").
	`css
("border", "none").css("padding", "2px")

290 .
	`css
("padding-left", "0px").css("width", "327px");

292 ià(
qu”y
.
ag’t
 == "true") {

293 
docum’t
.
	`wr™e
(
Çvig©Ü
.
u£rAg’t
);

297 
	`$
("#»®time_¶ay”_u¾").
	`toŞt
({

298 
t™Ë
: "å³é”®å¤åˆ¶RTMPåœ°å€"

302 ià(
qu”y
.
no_¶ay
 == "true") {

303 
no_¶ay
 = 
Œue
;

306 
	`$
("#bŠ_video_£‰šgs").
	`şick
(
	`funùiÚ
(){

307 
	`$
("#video_mod®").
	`mod®
({
show
:
Œue
});

309 
	`$
("#bŠ_audio_£‰šgs").
	`şick
(
	`funùiÚ
(){

310 
	`$
("#audio_mod®").
	`mod®
({
show
:
Œue
});

312 
	`$
("#bŠ_još").
	`şick
(
Ú_u£r_publish
);

315 
	`$
("#txt_u¾").
	`v®
($("#txt_u¾").v®(è+ "." + 
Ãw
 
	`D©e
().
	`g‘Time
());

318 
¤s_publish”
 = 
Ãw
 
	`SrsPublish”
("local_publisher", 280, 180);

319 
¤s_publish”
.
Ú_publish”_»ady
 = 
	`funùiÚ
(
ÿm”as
, 
miüİhÚes
) {

320 
	`¤s_ch©_š™Ÿlize_·ge
(

321 
ÿm”as
, 
miüİhÚes
,

328 
¤s_publish”
.
Ú_publish”_”rÜ
 = 
	`funùiÚ
(
code
, 
desc
) {

329 ià(!
	`Ú_publish_¡İ
()) {

333 
	`”rÜ
(
code
, 
desc
 + "è¯·é‡è¯•ã€‚");

335 
¤s_publish”
.
Ú_publish”_w¬n
 = 
	`funùiÚ
(
code
, 
desc
) {

336 
	`w¬n
(
code
, 
desc
);

338 
¤s_publish”
.
	`¡¬t
();

340 
	`upd©e_¶ay_u¾
();

342 ià(!
no_¶ay
) {

344 
»®time_¶ay”
 = 
Ãw
 
	`SrsPÏy”
("realtime_player", 280, 180);

345 
»®time_¶ay”
.
Ú_¶ay”_»ady
 = 
	`funùiÚ
() {

346 
this
.
	`£t_bt
(0.5);

348 
»®time_¶ay”
.
Ú_¶ay”_m‘ad©a
 = 
	`funùiÚ
(
m‘ad©a
) {

349 
this
.
	`£t_d¬
(0, 0);

350 
this
.
	`£t_fs
("screen", 100);

352 
	`šfo
("æ¨æµåˆ°æœåŠ¡å™¨æˆåŠŸã€‚è¯·æˆ´è€³æœºèŠå¤©ï¼Œå¦åˆ™éŸ³ç®±çš„å£°éŸ³ä¼šè¿›å…¥éº¦å…‹é£é€ æˆå›å£°ã€‚");

354 
»®time_¶ay”
.
	`¡¬t
();

357 
	`$
("#txt_Çme").
	`focus
();

359 
­i_£rv”
 = "h‰p://" + 
qu”y
.
ho¡Çme
 + ":" + 
	`¤s_g‘_­i_£rv”_pÜt
() + "/api/v1/chats";

360 
	`»äesh
();

361 
	}
});

363 
funùiÚ
 
	$Ú_publish_¡İ
() {

364 ià(!
	`¤s_ÿn_»publish
()) {

365 
	`$
("#bŠ_još").
	`©Œ
("di§bËd", 
Œue
);

366 
	`”rÜ
(0, "æ‚¨ä½¿ç”¨çš„æµè§ˆå™¨å¾ˆå¼±ï¼Œè¯·å…³é—­é¡µé¢åé‡æ–°æ‰“å¼€é¡µé¢ï¼ˆåˆ·æ–°ä¹Ÿä¸ç®¡ç”¨ï¼‰ã€‚<br/>æ¨èä½¿ç”¨Chrome/Firefox/Safari/Operaæµè§ˆå™¨ï¼Œæ”¯æŒé‡è¯•");

368 
¤s_log_di§bËd
 = 
Œue
;

369  
çl£
;

372  
Œue
;

373 
	}
}

375 
funùiÚ
 
	$upd©e_¶ay_u¾
() {

376 
v¬
 
u¾
 = 
	`$
("#txt_u¾").
	`v®
();

378 
	`$
("#»®time_¶ay”_u¾").
	`©Œ
("h»f", 
u¾
).attr("target", "_blank");

379 
	}
}

381 
funùiÚ
 
	$»äesh
() {

382 ià(!
£lf_ch©
) {

383 
	`£tTimeout
(
»äesh
, 1000);

387 
$
.
	`ajax
({

388 
ty³
 : "GET",

389 
async
 : 
Œue
,

390 
u¾
 : 
­i_£rv”
,

391 
cÚ‹ÁTy³
: "text/html",

392 
d©a
 : "",

393 
d©aTy³
 : "json",

394 
com¶‘e
 : 
	`funùiÚ
() {

396 
”rÜ
 : 
	`funùiÚ
(
»t
) {

397 
	`£tTimeout
(
»äesh
, 5000);

398 
	`w¬n
(101, "æŸ¥è¯¢ä¼šè®®å®¤å¤±è´¥ï¼š" + 
JSON
.
	`¡ršgify
(
»t
));

400 
sucûss
 : 
	`funùiÚ
(
»t
) {

401 if(0 !ğ
»t
["code"]) {

402 
	`w¬n
(102, "æŸ¥è¯¢ä¼šè®®å®¤å¤±è´¥: " + 
JSON
.
	`¡ršgify
(
»t
));

403 
	`£tTimeout
(
»äesh
, 5000);

407 
v¬
 
ch©s
 = 
»t
["data"]["chats"];

408 
v¬
 
£rv”_time
 = 
»t
["now"];

410 
	`Ú_g‘_ch©s
(
ch©s
);

411 
	`£tTimeout
(
»äesh
, 5000);

414 
	}
}

415 
funùiÚ
 
	$Ú_g‘_ch©s
(
ch©s
) {

416 ià(!
£lf_ch©
) {

421 
v¬
 
_£lf_ch©
 = 
nuÎ
;

422 
v¬
 
i
 = 0; i < 
ch©s
.
Ëngth
; i++) {

423 
v¬
 
ch©
 = 
ch©s
[
i
];

424 ià(
£lf_ch©
 && s–f_ch©.
id
 =ğ
ch©
.id) {

425 
_£lf_ch©
 = 
ch©
;

430 ià(!
_£lf_ch©
) {

431 
	`Ú_u£r_ex™_ch©
(
	`funùiÚ
(){

432 
	`Ú_u£r_još_ch©
(
	`funùiÚ
(){

433 
	`šfo
("é‡æ–°åŠ å…¥ä¼šè®®å®¤æˆåŠŸ");

439 
	`»nd”_ch©_room
(
ch©s
);

441 ià(!
£lf_ch©
) {

446 
v¬
 
u¾
 = 
­i_£rv”
 + "/" + 
£lf_ch©
.
id
;

448 
v¬
 
ch©
 = {};

449 
ch©
.
loÿÉime
 = 
Ãw
 
	`D©e
().
	`g‘Time
();

452 
$
.
	`ajax
({

453 
ty³
 : "PUT",

454 
async
 : 
Œue
,

455 
u¾
 : url,

456 
cÚ‹ÁTy³
: "text/html",

457 
d©a
 : 
JSON
.
	`¡ršgify
(
ch©
),

458 
d©aTy³
 : "json",

459 
com¶‘e
 : 
	`funùiÚ
() {

461 
”rÜ
 : 
	`funùiÚ
(
»t
) {

462 
	`w¬n
(105, "æ›´æ–°ä¼šè®®å®¤ä¿¡æ¯å¤±è´¥ï¼š" + 
JSON
.
	`¡ršgify
(
»t
));

464 
sucûss
 : 
	`funùiÚ
(
»t
) {

465 if(0 !ğ
»t
["code"]) {

466 
	`w¬n
(106, "æ›´æ–°ä¼šè®®å®¤ä¿¡æ¯å¤±è´¥ï¼š: " + 
JSON
.
	`¡ršgify
(
»t
));

471 
	}
}

472 
funùiÚ
 
	$»nd”_ch©_room
(
Üigš®_ch©s
) {

473 ià(!
£lf_ch©
) {

477 
v¬
 
ch©s
 = [];

478 
v¬
 
i
 = 0; i < 
Üigš®_ch©s
.
Ëngth
; i++) {

479 
v¬
 
ch©
 = 
Üigš®_ch©s
[
i
];

482 ià(
£lf_ch©
 && s–f_ch©.
id
 =ğ
ch©
.id) {

486 
ch©s
.
	`push
(
ch©
);

490 
v¬
 
i
 = 0; i < 
ch©s
.
Ëngth
; i++) {

491 
v¬
 
ch©
 = 
ch©s
[
i
];

494 
v¬
 
´evious_ch©
 = 
	`g‘_´evious_ch©_u£r
(
´evious_ch©s
, 
ch©
.
id
);

495 ià(
´evious_ch©
) {

497 
ch©
.
ui
 = 
´evious_ch©
.ui;

498 
ch©
.
·»Á
 = 
´evious_ch©
.parent;

499 
ch©
.
¶ay”
 = 
´evious_ch©
.player;

500 ià(
ch©
.
¶ay”
) {

501 
ch©
.
¶ay”
.
´iv©e_objeù
 = chat;

508 
v¬
 
i
 = 0; i < 
´evious_ch©s
.
Ëngth
; i++) {

509 
v¬
 
ch©
 = 
´evious_ch©s
[
i
];

511 
v¬
 
Ãw_ch©
 = 
	`g‘_´evious_ch©_u£r
(
ch©s
, 
ch©
.
id
);

512 ià(
Ãw_ch©
) {

516 ià(
ch©
.
¶ay”
) {

517 
ch©
.
¶ay”
.
	`¡İ
();

519 
	`$
("#div_" + 
ch©
.
id
).
	`»move
();

523 
	`$
("#l¡_ch©s").
	`fšd
("Œ").
	`—ch
(
	`funùiÚ
(){

524 
v¬
 
em±y
 = 
Œue
;

526 
	`$
(
this
).
	`fšd
("td").
	`—ch
(
	`funùiÚ
(){

527 ià(
	`$
(
this
).
	`html
() != "") {

528 
em±y
 = 
çl£
;

529  
çl£
;

531  
Œue
;

534 ià(
em±y
) {

535 
	`$
(
this
).
	`hide
();

540 
v¬
 
i
 = 0; i < 
ch©s
.
Ëngth
; i++) {

541 
v¬
 
ch©
 = 
ch©s
[
i
];

544 ià(
ch©
.
·»Á
) {

549 ià(!
ch©
.
ui
) {

550 
glob®_ch©_u£r_id
++;

556 
v¬
 
obj
 = 
	`$
("<div/>").
	`html
($("#template").html());

557 ià(
Œue
) {

559 
ch©
.
ui
 = 
obj
;

561 
	`$
(
obj
).
	`©Œ
("ch©_id", 
ch©
.
id
);

562 
	`$
(
obj
).
	`©Œ
("id", "div_" + 
ch©
.
id
);

563 
	`$
(
obj
).
	`©Œ
("class", "div_chat");

564 
	`$
(
obj
).
	`fšd
("#ch©_¶ay”").
	`©Œ
("id", "½_" + 
ch©
.
id
);

565 
	`$
(
obj
).
	`fšd
("#ch©_¶ay”_¿w").
	`©Œ
("id", "½_¿w_" + 
ch©
.
id
);

566 
	`$
(
obj
).
	`fšd
("#u£r_Çme").
	`‹xt
(
ch©
.
u£ºame
);

567 
	`$
(
obj
).
	`fšd
("#u£r_¶ay”_u¾").
	`©Œ
("h»f", 
ch©
.
u¾
);

568 
	`$
(
obj
).
	`fšd
("#još_d©e").
	`‹xt
(
ch©
.
još_d©e_¡r
.
	`¥l™
(" ")[1]);

569 
	`$
(
obj
).
	`fšd
("#cŞÏp£M").
	`©Œ
("id", "cŞÏp£_" + 
glob®_ch©_u£r_id
);

570 
	`$
(
obj
).
	`fšd
("#h—d”N").
	`©Œ
("h»f", "#cŞÏp£_" + 
glob®_ch©_u£r_id
);

575 
v¬
 
·»Á
 = 
nuÎ
;

576 
	`$
("#l¡_ch©s").
	`fšd
("td").
	`—ch
(
	`funùiÚ
(){

577 ià(
	`$
(
this
).
	`html
() != "") {

578  
Œue
;

581 
·»Á
 = 
	`$
(
this
);

582  
çl£
;

585 ià(!
·»Á
) {

586 
	`w¬n
("æ²¡æœ‰å¯ç”¨çš„ä½ç½®å±•ç¤ºæµã€‚");

589 
	`$
(
·»Á
).
	`­³nd
(
ch©
.
ui
);

590 
	`$
(
·»Á
).
	`·»Á
().
	`show
();

594 ià(!
ch©
.
·»Á
) {

595 
ch©
.
·»Á
 = 
	`$
(parent);

597 ià(!
no_¶ay
) {

599 
v¬
 
_¶ay”
 = 
Ãw
 
	`SrsPÏy”
("½_¿w_" + 
ch©
.
id
, 240, 180, chat);

600 
_¶ay”
.
Ú_¶ay”_»ady
 = 
	`funùiÚ
() {

601 
this
.
	`£t_bt
(0.5);

602 
this
.
	`¶ay
();

604 
_¶ay”
.
Ú_¶ay”_m‘ad©a
 = 
	`funùiÚ
(
m‘ad©a
) {

605 
this
.
	`£t_d¬
(0, 0);

606 
this
.
	`£t_fs
("screen", 100);

608 
_¶ay”
.
	`¡¬t
(
ch©
.
u¾
);

610 
ch©
.
¶ay”
 = 
_¶ay”
;

612 
ch©
.
¶ay”
 = 
nuÎ
;

615 
	`$
(
obj
).
	`fšd
("#cŞÏp£_maš").
	`Ú
('hidd’', 
	`funùiÚ
(){

616 
v¬
 
id
 = 
	`$
(
this
).
	`·»Á
().
	`©Œ
("chat_id");

617 
v¬
 
ch©
 = 
	`g‘_´evious_ch©_u£r
(
´evious_ch©s
, 
id
);

618 ià(!
ch©
 || !ch©.
¶ay”
) {

621 
ch©
.
¶ay”
.
	`¡İ
();

623 
	`$
(
obj
).
	`fšd
("#cŞÏp£_maš").
	`Ú
('shown', 
	`funùiÚ
(){

624 
v¬
 
id
 = 
	`$
(
this
).
	`·»Á
().
	`©Œ
("chat_id");

625 
v¬
 
ch©
 = 
	`g‘_´evious_ch©_u£r
(
´evious_ch©s
, 
id
);

626 ià(!
ch©
 || !ch©.
¶ay”
) {

629 
ch©
.
¶ay”
.
	`¶ay
();

634 
´evious_ch©s
 = 
ch©s
;

635 
	}
}

636 
funùiÚ
 
	$g‘_´evious_ch©_u£r
(
¬r
, 
id
) {

637 
v¬
 
i
 = 0; i < 
¬r
.
Ëngth
; i++) {

638 
v¬
 
ch©
 = 
¬r
[
i
];

639 ià(
id
 =ğ
ch©
.id) {

640  
ch©
;

643  
nuÎ
;

644 
	}
}

646 
funùiÚ
 
	$Ú_u£r_publish
() {

647 ià(
	`$
("#txt_Çme").
	`v®
() == "") {

648 
	`$
("#txt_Çme").
	`focus
().
	`·»Á
().·»Á().
	`addCÏss
("error");

649 
	`w¬n
(100, "è¯·è¾“å…¥æ‚¨çš„åå­—");

653 
	`$
("#txt_Çme").
	`·»Á
().·»Á().
	`»moveCÏss
("error");

656 ià(!
£lf_ch©
) {

657 
	`Ú_u£r_još_ch©
();

659 
	`Ú_u£r_ex™_ch©
();

661 
	}
}

662 
funùiÚ
 
	$Ú_u£r_ex™_ch©
(
com¶‘e_pâ
) {

663 
¤s_publish”
.
	`¡İ
();

664 
	`$
("#bŠ_još").
	`‹xt
("åŠ å…¥ä¼šè®®");

666 ià(
»®time_¶ay”
) {

667 
»®time_¶ay”
.
	`¡İ
();

670 ià(!
£lf_ch©
) {

675 
v¬
 
i
 = 0; i < 
´evious_ch©s
.
Ëngth
; i++) {

676 
v¬
 
ch©
 = 
´evious_ch©s
[
i
];

678 ià(
ch©
.
¶ay”
) {

679 
ch©
.
¶ay”
.
	`¡İ
();

681 
	`$
("#div_" + 
ch©
.
id
).
	`»move
();

683 
´evious_ch©s
 = [];

685 
v¬
 
u¾
 = 
­i_£rv”
 + "/" + 
£lf_ch©
.
id
;

687 
£lf_ch©
 = 
nuÎ
;

689 
	`$
("#bŠ_još").
	`©Œ
("di§bËd", 
Œue
);

692 
$
.
	`ajax
({

693 
ty³
 : "DELETE",

694 
async
 : 
Œue
,

695 
u¾
 : url,

696 
cÚ‹ÁTy³
: "text/html",

697 
d©a
 : "",

698 
d©aTy³
 : "json",

699 
com¶‘e
 : 
	`funùiÚ
() {

700 ià(!
	`Ú_publish_¡İ
()) {

704 
	`$
("#bŠ_još").
	`©Œ
("di§bËd", 
çl£
);

705 ià(
com¶‘e_pâ
) {

706 
	`com¶‘e_pâ
();

709 
”rÜ
 : 
	`funùiÚ
(
»t
) {

710 
	`w¬n
(103, "é€€å‡ºä¼šè®®å®¤å¤±è´¥");

712 
sucûss
 : 
	`funùiÚ
(
»t
) {

713 if(0 !ğ
»t
["code"]) {

714 
	`w¬n
(104, "é€€å‡ºä¼šè®®å®¤å¤±è´¥");

717 
	`šfo
("é€€å‡ºä¼šè®®å®¤æˆåŠŸ");

720 
	}
}

721 
funùiÚ
 
	$Ú_u£r_još_ch©
(
com¶‘e_pâ
) {

722 ià(
£lf_ch©
) {

726 
v¬
 
u¾
 = 
	`$
("#txt_u¾").
	`v®
();

727 
v¬
 
vcodec
 = {};

728 
v¬
 
acodec
 = {};

729 
	`¤s_publi£r_g‘_codec
(

730 
vcodec
, 
acodec
,

737 
v¬
 
ch©
 = {};

738 
ch©
.
id
 = -1;

739 
ch©
.
u£ºame
 = 
	`$
("#txt_Çme").
	`v®
();

740 
ch©
.
ag’t
 = 
Çvig©Ü
.
u£rAg’t
;

741 
ch©
.
u¾
 = url;

742 
ch©
.
vcodec
 = vcodec;

743 
ch©
.
acodec
 =‡codec;

745 
	`$
("#bŠ_još").
	`©Œ
("di§bËd", 
Œue
);

748 
$
.
	`ajax
({

749 
ty³
 : "POST",

750 
async
 : 
Œue
,

751 
u¾
 : 
­i_£rv”
,

752 
cÚ‹ÁTy³
: "text/html",

753 
d©a
 : 
JSON
.
	`¡ršgify
(
ch©
),

754 
d©aTy³
 : "json",

755 
com¶‘e
 : 
	`funùiÚ
() {

756 
	`$
("#bŠ_još").
	`©Œ
("di§bËd", 
çl£
);

757 ià(
com¶‘e_pâ
) {

758 
	`com¶‘e_pâ
();

761 
”rÜ
 : 
	`funùiÚ
(
»t
) {

762 
	`w¬n
(105, "åˆ›å»ºä¼šè®®å®¤å¤±è´¥ï¼š" + 
JSON
.
	`¡ršgify
(
»t
));

764 
sucûss
 : 
	`funùiÚ
(
»t
) {

765 if(0 !ğ
»t
["code"]) {

766 
	`w¬n
(106, "åˆ›å»ºä¼šè®®å®¤å¤±è´¥: " + 
JSON
.
	`¡ršgify
(
»t
));

770 
ch©
.
id
 = 
»t
["data"];

773 
£lf_ch©
 = 
ch©
;

775 
	`$
("#bŠ_još").
	`‹xt
("é€€å‡ºä¼šè®®");

777 
	`šfo
("å¼€å§‹æ¨æµåˆ°æœåŠ¡å™¨ã€‚è¯·æˆ´è€³æœºèŠå¤©ï¼Œå¦åˆ™éŸ³ç®±çš„å£°éŸ³ä¼šè¿›å…¥éº¦å…‹é£é€ æˆå›å£°ã€‚");

778 
¤s_publish”
.
	`publish
(
u¾
, 
vcodec
, 
acodec
);

780 ià(
»®time_¶ay”
) {

782 
»®time_¶ay”
.
	`¡İ
();

783 
»®time_¶ay”
.
	`¶ay
(
u¾
, 0);

787 
	}
}

788 </
	gsüt
>

789 </
	ghtml
>

	@trunk/research/players/srs_player.html

1 <!
DOCTYPE
 
	ghtml
>

2 <
	ghtml
>

3 <
	gh—d
>

4 <
	gt™Ë
>
	gSRS
</title>

5 <
m‘a
 
	gch¬£t
="utf-8">

6 <
lšk
 
»l
="¡yËsh“t" 
ty³
="‹xt/css" 
h»f
="css/bootstrap.min.css"/>

7 <
¡yË
>

8 
body
{

9 
·ddšg
-
tİ
: 55
px
;

12 
	gm¬gš
-
	gtİ
: -20
px
;

13 
	g·ddšg
-
	gtİ
: 3
px
;

15 .
	gdiv_¶ay_time
 {

16 
	gm¬gš
-
	gtİ
: 10
px
;

19 
	gm¬gš
-
	gtİ
: -4
px
;

20 
	gm¬gš
-
	gbÙtom
: 10
px
;

22 </
	g¡yË
>

23 </
	gh—d
>

24 <
	gbody
>

25 <
div
 
	gşass
="navbar‚avbar-fixed-top">

26 <
div
 
şass
="navbar-inner">

27 <
div
 
şass
="container">

28 <
a
 
id
="¤s_šdex" 
şass
="b¿nd" 
h»f
="#">
SRS
</a>

29 <
div
 
şass
="nav-collapse collapse">

30 <
ul
 
şass
="nav">

31 <
li
 
şass
="aùive"><
a
 
id
="Çv_¤s_¶ay”" 
h»f
="¤s_¶ay”.html">
SRS
æ’­æ”¾å™¨</a></li>

32 <
li
><
a
 
id
="Çv_¤s_publish”" 
h»f
="¤s_publish”.html">
SRS
ç¼–ç å™¨</a></li>

33 <
li
><
a
 
id
="Çv_¤s_ch©" 
h»f
="¤s_ch©.html">
SRS
ä¼šè®®</a></li>

34 <
li
><
a
 
id
="Çv_¤s_bwt" 
h»f
="¤s_bwt.html">
SRS
æµ‹ç½‘é€Ÿ</a></li>

35 <
li
><
a
 
id
="Çv_jw¶ay”6" 
h»f
="jw¶ay”6.html">
JWPÏy”6
æ’­æ”¾å™¨</a></li>

36 <
li
><
a
 
id
="Çv_osmf" 
h»f
="osmf.html">
AdobeOSMF
æ’­æ”¾å™¨</a></li>

37 <
li
><
a
 
id
="Çv_vlc" 
h»f
="vlc.html">
VLC
æ’­æ”¾å™¨</a></li>

38 </
ul
>

39 </
div
>

40 </
div
>

41 </
div
>

42 </
div
>

43 <
div
 
şass
="container">

44 <
div
 
şass
="alert‡lert-info fade in">

45 <
bu‰Ú
 
ty³
="bu‰Ú" 
şass
="şo£" 
d©a
-
dismiss
="alert">Ã—</button>

46 <
¡rÚg
><
¥ª
>
U§ge
:</¥ª></¡rÚg> <¥ª>è¾“å…¥
RTMP
/
HTTP
åœ°å€åç‚¹å‡»â€œæ’­æ”¾è§†é¢‘â€å³å¯æ’­æ”¾è§†é¢‘</span>

47 </
div
>

48 <
div
 
şass
="form-inline">

49 
URL
:

50 <
šput
 
ty³
="‹xt" 
id
="txt_u¾" 
şass
="šput-xxÏrge" 
v®ue
="">

51 <
bu‰Ú
 
şass
="bŠ bŠ-´im¬y" 
id
="btn_play">æ’­æ”¾è§†é¢‘</button>

52 <
bu‰Ú
 
şass
="bŠ" 
id
="btn_generate_link">ç”Ÿæˆé“¾æ¥</button>

53 </
div
>

54 <
div
 
id
="lšk_mod®" 
şass
="modal hide fade">

55 <
div
 
şass
="modal-header">

56 <
bu‰Ú
 
ty³
="bu‰Ú" 
şass
="şo£" 
d©a
-
dismiss
="mod®" 
¬Ÿ
-
hidd’
="true">Ã—</button>

57 <
h3
><
a
 
h»f
="h‰ps://g™hub.com/os¤s/¤s">
SRS
 
Lšk
 
G’”©Ü
</a></h3>

58 </
div
>

59 <
div
 
şass
="modal-body">

60 <
div
 
şass
="form-horizontal">

61 <
div
 
şass
="control-group">

62 <
Ïb–
 
şass
="control-label" ="link_server">æœåŠ¡å™¨åœ°å€</label>

63 <
div
 
şass
="controls">

64 <
¥ª
 
id
="lšk_£rv”" 
şass
="span4 uneditable-input"></span>

65 </
div
>

66 </
div
>

67 <
div
 
şass
="control-group">

68 <
Ïb–
 
şass
="control-label" ="link_port">æœåŠ¡å™¨ç«¯å£</label>

69 <
div
 
şass
="controls">

70 <
¥ª
 
id
="lšk_pÜt" 
şass
="span2 uneditable-input"></span>

71 </
div
>

72 </
div
>

73 <
div
 
şass
="control-group">

74 <
Ïb–
 
şass
="cÚŒŞ-Ïb–" ="lšk_vho¡">
RTMP
 
Vho¡
</label>

75 <
div
 
şass
="controls">

76 <
¥ª
 
id
="lšk_vho¡" 
şass
="span4 uneditable-input"></span>

77 </
div
>

78 </
div
>

79 <
div
 
şass
="control-group">

80 <
Ïb–
 
şass
="cÚŒŞ-Ïb–" ="lšk_­p">
RTMP
 
Aµ
</label>

81 <
div
 
şass
="controls">

82 <
¥ª
 
id
="lšk_­p" 
şass
="span4 uneditable-input"></span>

83 </
div
>

84 </
div
>

85 <
div
 
şass
="control-group">

86 <
Ïb–
 
şass
="cÚŒŞ-Ïb–" ="lšk_¡»am">
RTMP
 
SŒ—m
</label>

87 <
div
 
şass
="controls">

88 <
¥ª
 
id
="lšk_¡»am" 
şass
="span4 uneditable-input"></span>

89 </
div
>

90 </
div
>

91 <
div
 
şass
="control-group">

92 <
Ïb–
 
şass
="cÚŒŞ-Ïb–" ="lšk_¹mp">
RTMP
åœ°å€</label>

93 <
div
 
şass
="controls">

94 <
¥ª
 
id
="lšk_¹mp" 
şass
="span4 uneditable-input"></span>

95 </
div
>

96 </
div
>

97 <
div
 
şass
="control-group">

98 <
Ïb–
 
şass
="control-label" ="link_url">æ’­æ”¾é“¾æ¥åœ°å€</label>

99 <
div
 
şass
="controls">

100 <
div
 
¡yË
="m¬gš-tİ:5px;"><
a
 
h»f
="#" 
id
="lšk_u¾" 
rg‘
="_blank">è¯·å³é”®æ‹·è´æ­¤é“¾æ¥åœ°å€.</a></div>

101 </
div
>

102 </
div
>

103 </
div
>

104 </
div
>

105 <
div
 
şass
="modal-footer"></div>

106 </
div
>

107 <
div
 
şass
="container">

108 <
hr
/>

109 <
¥ª
>

110 æ³¨æ„ï¼šå¿…é¡»æŒ‰ç…§<
a
 
h»f
="h‰ps://g™hub.com/os¤s/¤s/wiki/Sam¶eDemo">
SRS
 
DEMO
</a>

112 </
¥ª
>

113 <
div
 
şass
="accÜdiÚ" 
id
="main_accordion">

114 <
div
 
şass
="accordion-group">

115 <
div
 
şass
="accordion-heading">

116 <
¥ª
 
şass
="accÜdiÚ-toggË" 
d©a
-
toggË
="cŞÏp£" d©a-
·»Á
="#maš_accÜdiÚ" 
h»f
="#collapse1">

117 <
¡rÚg
>[1] 
SRS
ç¤ºä¾‹æ’­æ”¾æµ: åŸå§‹æµ</strong>

118 </
¥ª
>

119 </
div
>

120 <
div
 
id
="cŞÏp£1" 
şass
="accordion-body collapse">

121 <
div
 
şass
="accordion-inner">

122 <
a
 
h»f
="#" 
id
="¤s_publish">
¹mp
:

123 <
¥ª
>ç”¨æˆ·æ¨é€è¿‡æ¥çš„å”¯ä¸€ä¸€è·¯æµï¼Œç»è¿‡æœåŠ¡å™¨çš„å¤šç§å˜æ¢å’Œå†è½¬å‘ã€‚</span>

124 </
div
>

125 </
div
>

126 </
div
>

127 <
div
 
şass
="accordion-group">

128 <
div
 
şass
="accordion-heading">

129 <
¥ª
 
şass
="accÜdiÚ-toggË" 
d©a
-
toggË
="cŞÏp£" d©a-
·»Á
="#maš_accÜdiÚ" 
h»f
="#collapse10">

130 <
¡rÚg
>[2] 
SRS
ç¤ºä¾‹æ’­æ”¾æµ: åŸå§‹æµ
HLS
</strong>

131 </
¥ª
>

132 </
div
>

133 <
div
 
id
="cŞÏp£10" 
şass
="accordion-body collapse">

134 <
div
 
şass
="accordion-inner">

135 <
a
 
h»f
="#" 
id
="¤s_publish_hls" 
rg‘
="_bÏnk">
h‰p
:

136 <
¥ª
>å¯¹ç”¨æˆ·çš„æµè¿›è¡Œ
HLS
åˆ‡ç‰‡ï¼ˆè‹¥ç¼–ç ä¸ºé
H264
/
AAC
ï¼ŒHLSæµä¼šè‡ªåŠ¨ç¦ç”¨ï¼‰ã€‚</span>

137 </
div
>

138 </
div
>

139 </
div
>

140 <
div
 
şass
="accordion-group">

141 <
div
 
şass
="accordion-heading">

142 <
¥ª
 
şass
="accÜdiÚ-toggË" 
d©a
-
toggË
="cŞÏp£" d©a-
·»Á
="#maš_accÜdiÚ" 
h»f
="#collapse2">

143 <
¡rÚg
>[3] 
SRS
ç¤ºä¾‹æ’­æ”¾æµ: è½¬ç é…ç½®
LD
æµ</strong>

144 </
¥ª
>

145 </
div
>

146 <
div
 
id
="cŞÏp£2" 
şass
="accordion-body collapse">

147 <
div
 
şass
="accordion-inner">

148 <
a
 
h»f
="#" 
id
="¤s_publish_ld">
¹mp
:

149 <
¥ª
>å¯¹åŸå§‹æµåŠ äº†<
a
 
h»f
="h‰p://ffm³g.Üg/ffm³g-f‹rs.html#ov”Ïy">
FFMPEG
å›¾ç‰‡æ°´å°</a></span>

150 </
div
>

151 </
div
>

152 </
div
>

153 <
div
 
şass
="accordion-group">

154 <
div
 
şass
="accordion-heading">

155 <
¥ª
 
şass
="accÜdiÚ-toggË" 
d©a
-
toggË
="cŞÏp£" d©a-
·»Á
="#maš_accÜdiÚ" 
h»f
="#collapse11">

156 <
¡rÚg
>[4] 
SRS
ç¤ºä¾‹æ’­æ”¾æµ: è½¬ç é…ç½®
LD
æµ
HLS
</strong>

157 </
¥ª
>

158 </
div
>

159 <
div
 
id
="cŞÏp£11" 
şass
="accordion-body collapse">

160 <
div
 
şass
="accordion-inner">

161 <
a
 
h»f
="#" 
id
="¤s_publish_ld_hls" 
rg‘
="_bÏnk">
h‰p
:

162 <
¥ª
>å¯¹è½¬ç é…ç½®
LD
æµè¿›è¡Œ
HLS
åˆ‡ç‰‡ã€‚</span>

163 </
div
>

164 </
div
>

165 </
div
>

166 <
div
 
şass
="accordion-group">

167 <
div
 
şass
="accordion-heading">

168 <
¥ª
 
şass
="accÜdiÚ-toggË" 
d©a
-
toggË
="cŞÏp£" d©a-
·»Á
="#maš_accÜdiÚ" 
h»f
="#collapse3">

169 <
¡rÚg
>[5] 
SRS
ç¤ºä¾‹æ’­æ”¾æµ: è½¬ç é…ç½®
SD
æµ</strong>

170 </
¥ª
>

171 </
div
>

172 <
div
 
id
="cŞÏp£3" 
şass
="accordion-body collapse">

173 <
div
 
şass
="accordion-inner">

174 <
a
 
h»f
="#" 
id
="¤s_publish_sd">
¹mp
:

175 <
¥ª
>å¯¹åŸå§‹æµåº”ç”¨äº†<
a
 
h»f
="h‰p://ffm³g.Üg/ffm³g-f‹rs.html#F‹ršg-IÁroduùiÚ">
FFMPEG
ç¿»è½¬æ»¤é•œ</a></span>

176 </
div
>

177 </
div
>

178 </
div
>

179 <
div
 
şass
="accordion-group">

180 <
div
 
şass
="accordion-heading">

181 <
¥ª
 
şass
="accÜdiÚ-toggË" 
d©a
-
toggË
="cŞÏp£" d©a-
·»Á
="#maš_accÜdiÚ" 
h»f
="#collapse12">

182 <
¡rÚg
>[6] 
SRS
ç¤ºä¾‹æ’­æ”¾æµ: è½¬ç é…ç½®
SD
æµ
HLS
</strong>

183 </
¥ª
>

184 </
div
>

185 <
div
 
id
="cŞÏp£12" 
şass
="accordion-body collapse">

186 <
div
 
şass
="accordion-inner">

187 <
a
 
h»f
="#" 
id
="¤s_publish_sd_hls" 
rg‘
="_bÏnk">
h‰p
:

188 <
¥ª
>å¯¹è½¬ç é…ç½®
SD
æµè¿›è¡Œ
HLS
åˆ‡ç‰‡ã€‚</span>

189 </
div
>

190 </
div
>

191 </
div
>

192 <
div
 
şass
="accordion-group">

193 <
div
 
şass
="accordion-heading">

194 <
¥ª
 
şass
="accÜdiÚ-toggË" 
d©a
-
toggË
="cŞÏp£" d©a-
·»Á
="#maš_accÜdiÚ" 
h»f
="#collapse4">

195 <
¡rÚg
>[7] 
SRS
ç¤ºä¾‹æ’­æ”¾æµ: è½¬å‘åŸå§‹æµ</strong>

196 </
¥ª
>

197 </
div
>

198 <
div
 
id
="cŞÏp£4" 
şass
="accordion-body collapse">

199 <
div
 
şass
="accordion-inner">

200 <
a
 
h»f
="#" 
id
="¤s_publish_fw">
¹mp
:

201 <
¥ª
>å°†ç”¨æˆ·æ¨é€çš„æµè½¬å‘åˆ°å¦å¤–çš„
vho¡
æˆ–æœåŠ¡å™¨ï¼Œåšçƒ­å¤‡ç”¨ã€‚</span>

202 </
div
>

203 </
div
>

204 </
div
>

205 <
div
 
şass
="accordion-group">

206 <
div
 
şass
="accordion-heading">

207 <
¥ª
 
şass
="accÜdiÚ-toggË" 
d©a
-
toggË
="cŞÏp£" d©a-
·»Á
="#maš_accÜdiÚ" 
h»f
="#collapse13">

208 <
¡rÚg
>[8] 
SRS
ç¤ºä¾‹æ’­æ”¾æµ: è½¬å‘åŸå§‹æµ
HLS
</strong>

209 </
¥ª
>

210 </
div
>

211 <
div
 
id
="cŞÏp£13" 
şass
="accordion-body collapse">

212 <
div
 
şass
="accordion-inner">

213 <
a
 
h»f
="#" 
id
="¤s_publish_fw_hls" 
rg‘
="_bÏnk">
h‰p
:

214 <
¥ª
>å¯¹è½¬å‘åŸå§‹æµè¿›è¡Œ
HLS
åˆ‡ç‰‡ï¼ˆè‹¥ç¼–ç ä¸ºé
H264
/
AAC
ï¼ŒHLSæµä¼šè‡ªåŠ¨ç¦ç”¨ï¼‰ã€‚</span>

215 </
div
>

216 </
div
>

217 </
div
>

218 <
div
 
şass
="accordion-group">

219 <
div
 
şass
="accordion-heading">

220 <
¥ª
 
şass
="accÜdiÚ-toggË" 
d©a
-
toggË
="cŞÏp£" d©a-
·»Á
="#maš_accÜdiÚ" 
h»f
="#collapse5">

221 <
¡rÚg
>[9] 
SRS
ç¤ºä¾‹æ’­æ”¾æµ: è½¬å‘è½¬ç é…ç½®
LD
æµ</strong>

222 </
¥ª
>

223 </
div
>

224 <
div
 
id
="cŞÏp£5" 
şass
="accordion-body collapse">

225 <
div
 
şass
="accordion-inner">

226 <
a
 
h»f
="#" 
id
="¤s_publish_fw_ld">
¹mp
:

227 <
¥ª
>
FFMPEG
åŠ æ°´å°åçš„æµä¹Ÿä¼šè‡ªåŠ¨è½¬å‘ã€‚</span>

228 </
div
>

229 </
div
>

230 </
div
>

231 <
div
 
şass
="accordion-group">

232 <
div
 
şass
="accordion-heading">

233 <
¥ª
 
şass
="accÜdiÚ-toggË" 
d©a
-
toggË
="cŞÏp£" d©a-
·»Á
="#maš_accÜdiÚ" 
h»f
="#collapse14">

234 <
¡rÚg
>[10] 
SRS
ç¤ºä¾‹æ’­æ”¾æµ: è½¬å‘è½¬ç é…ç½®
LD
æµ
HLS
</strong>

235 </
¥ª
>

236 </
div
>

237 <
div
 
id
="cŞÏp£14" 
şass
="accordion-body collapse">

238 <
div
 
şass
="accordion-inner">

239 <
a
 
h»f
="#" 
id
="¤s_publish_fw_ld_hls" 
rg‘
="_bÏnk">
h‰p
:

240 <
¥ª
>å¯¹è½¬å‘è½¬ç é…ç½®
LD
æµè¿›è¡Œ
HLS
åˆ‡ç‰‡ï¼Œæ‰€æœ‰è½¬å‘çš„æµä¼šè‡ªåŠ¨æ”¯æŒHLSã€‚</span>

241 </
div
>

242 </
div
>

243 </
div
>

244 <
div
 
şass
="accordion-group">

245 <
div
 
şass
="accordion-heading">

246 <
¥ª
 
şass
="accÜdiÚ-toggË" 
d©a
-
toggË
="cŞÏp£" d©a-
·»Á
="#maš_accÜdiÚ" 
h»f
="#collapse6">

247 <
¡rÚg
>[11] 
SRS
ç¤ºä¾‹æ’­æ”¾æµ: è½¬å‘è½¬ç é…ç½®
SD
æµ</strong>

248 </
¥ª
>

249 </
div
>

250 <
div
 
id
="cŞÏp£6" 
şass
="accordion-body collapse">

251 <
div
 
şass
="accordion-inner">

252 <
a
 
h»f
="#" 
id
="¤s_publish_fw_sd">
¹mp
:

253 <
¥ª
>
FFMPEG
ç¿»è½¬åçš„æµä¹Ÿä¼šè‡ªåŠ¨è½¬å‘ã€‚</span>

254 </
div
>

255 </
div
>

256 </
div
>

257 <
div
 
şass
="accordion-group">

258 <
div
 
şass
="accordion-heading">

259 <
¥ª
 
şass
="accÜdiÚ-toggË" 
d©a
-
toggË
="cŞÏp£" d©a-
·»Á
="#maš_accÜdiÚ" 
h»f
="#collapse15">

260 <
¡rÚg
>[12] 
SRS
ç¤ºä¾‹æ’­æ”¾æµ: è½¬å‘è½¬ç é…ç½®
SD
æµ
HLS
</strong>

261 </
¥ª
>

262 </
div
>

263 <
div
 
id
="cŞÏp£15" 
şass
="accordion-body collapse">

264 <
div
 
şass
="accordion-inner">

265 <
a
 
h»f
="#" 
id
="¤s_publish_fw_sd_hls" 
rg‘
="_bÏnk">
h‰p
:

266 <
¥ª
>å¯¹è½¬å‘è½¬ç é…ç½®
SD
æµè¿›è¡Œ
HLS
åˆ‡ç‰‡ï¼Œæ‰€æœ‰è½¬å‘çš„æµä¼šè‡ªåŠ¨æ”¯æŒHLSã€‚</span>

267 </
div
>

268 </
div
>

269 </
div
>

270 </
div
>

271 </
div
>

272 <
div
 
id
="maš_mod®" 
şass
="modal hide fade">

273 <
div
 
şass
="modal-header">

274 <
bu‰Ú
 
ty³
="bu‰Ú" 
şass
="şo£" 
d©a
-
dismiss
="mod®" 
¬Ÿ
-
hidd’
="true">Ã—</button>

275 <
h3
><
a
 
h»f
="h‰ps://g™hub.com/os¤s/¤s">
SrsPÏy”
</a></h3>

276 </
div
>

277 <
div
 
şass
="modal-body">

278 <
div
 
id
="player"></div>

279 <
div
 
şass
="´og»s ´og»ss-¡red‡ùive" 
id
="pb_buffer_bg">

280 <
div
 
şass
="b¬" 
¡yË
="width: 0%;" 
id
="pb_buffer"></div>

281 </
div
>

282 </
div
>

283 <
div
 
şass
="mod®-foÙ”" 
id
="my_modal_footer">

284 <
div
>

285 <
div
 
şass
="btn-group dropup">

286 <
bu‰Ú
 
şass
="bŠ drİdown-toggË" 
d©a
-
toggË
="dropdown">

287 è®¾ç½®å…¨å±æ¯”ä¾‹å¤§å°<
¥ª
 
şass
="caret"></span>

288 </
bu‰Ú
>

289 <
ul
 
şass
="dropdown-menu">

290 <
li
><
a
 
id
="bŠ_fs_size_sü“n_100" 
h»f
="#">å±å¹•å¤§å°(100%)</a></li>

291 <
li
><
a
 
id
="bŠ_fs_size_sü“n_75" 
h»f
="#">å±å¹•å¤§å°(75%)</a></li>

292 <
li
><
a
 
id
="bŠ_fs_size_sü“n_50" 
h»f
="#">å±å¹•å¤§å°(50%)</a></li>

293 <
li
><
a
 
id
="bŠ_fs_size_video_100" 
h»f
="#">è§†é¢‘å¤§å°(100%)</a></li>

294 <
li
><
a
 
id
="bŠ_fs_size_video_75" 
h»f
="#">è§†é¢‘å¤§å°(75%)</a></li>

295 <
li
><
a
 
id
="bŠ_fs_size_video_50" 
h»f
="#">è§†é¢‘å¤§å°(50%)</a></li>

296 </
ul
>

297 </
div
>

298 <
div
 
şass
="btn-group dropup">

299 <
bu‰Ú
 
şass
="bŠ drİdown-toggË" 
d©a
-
toggË
="drİdown">è®¾ç½®æ˜¾ç¤ºæ¯”ä¾‹<
¥ª
 class="caret"></span></button>

300 <
ul
 
şass
="dropdown-menu">

301 <
li
><
a
 
id
="bŠ_d¬_Üigš®" 
h»f
="#">è§†é¢‘åŸå§‹æ¯”ä¾‹</a></li>

302 <
li
><
a
 
id
="bŠ_d¬_21_9" 
h»f
="#">å®½å±å½±é™¢(21:9)</a></li>

303 <
li
><
a
 
id
="bŠ_d¬_16_9" 
h»f
="#">å®½å±ç”µè§†(16:9)</a></li>

304 <
li
><
a
 
id
="bŠ_d¬_4_3" 
h»f
="#">çª„å±(4:3)</a></li>

305 <
li
><
a
 
id
="bŠ_d¬_fl" 
h»f
="#">å¡«å……(å®¹å™¨æ¯”ä¾‹)</a></li>

306 </
ul
>

307 </
div
>

308 <
div
 
şass
="btn-group dropup">

309 <
bu‰Ú
 
şass
="bŠ drİdown-toggË" 
d©a
-
toggË
="drİdown">è®¾ç½®ç¼“å†²åŒºå¤§å°<
¥ª
 class="caret"></span></button>

310 <
ul
 
şass
="dropdown-menu">

311 <
li
><
a
 
id
="bŠ_bt_0_1" 
h»f
="#">0.1ç§’(å®æ—¶)</a></li>

312 <
li
><
a
 
id
="bŠ_bt_0_2" 
h»f
="#">0.2ç§’(å®æ—¶)</a></li>

313 <
li
><
a
 
id
="bŠ_bt_0_3" 
h»f
="#">0.3ç§’(å®æ—¶)</a></li>

314 <
li
><
a
 
id
="bŠ_bt_0_5" 
h»f
="#">0.5ç§’(å®æ—¶)</a></li>

315 <
li
><
a
 
id
="bŠ_bt_0_8" 
h»f
="#">0.8ç§’(ä¼šè®®)</a></li>

316 <
li
><
a
 
id
="bŠ_bt_1" 
h»f
="#">1ç§’(ä½å»¶è¿Ÿ)</a></li>

317 <
li
><
a
 
id
="bŠ_bt_2" 
h»f
="#">2ç§’(è¾ƒä½å»¶æ—¶)</a></li>

318 <
li
><
a
 
id
="bŠ_bt_3" 
h»f
="#">3ç§’(æµç•…æ’­æ”¾)</a></li>

319 <
li
><
a
 
id
="bŠ_bt_5" 
h»f
="#">5ç§’(ç½‘é€Ÿè¾ƒä½)</a></li>

320 <
li
><
a
 
id
="bŠ_bt_10" 
h»f
="#">10ç§’(æ— æ‰€è°“å»¶è¿Ÿ)</a></li>

321 <
li
><
a
 
id
="bŠ_bt_30" 
h»f
="#">30ç§’(æµç•…ç¬¬ä¸€)</a></li>

322 </
ul
>

323 </
div
>

324 <
div
 
şass
="btn-group dropup">

325 <
a
 
id
="bŠ_fuÎsü“n" 
şass
="btn">è¿›å…¥å…¨å±</a>

326 </
div
>

327 <
div
 
şass
="btn-group dropup">

328 <
bu‰Ú
 
id
="bŠ_·u£" 
şass
="btn">æš‚åœæ’­æ”¾</button>

329 <
bu‰Ú
 
id
="bŠ_»sume" 
şass
="btn hide">ç»§ç»­æ’­æ”¾</button>

330 </
div
>

331 <
div
 
şass
="btn-group dropup">

332 <
bu‰Ú
 
şass
="bŠ bŠ-´im¬y" 
d©a
-
dismiss
="mod®" 
¬Ÿ
-
hidd’
="true">å…³é—­æ’­æ”¾å™¨</button>

333 </
div
>

334 </
div
>

335 <
div
 
şass
="hide" 
id
="fullscreen_tips">

336 è¯·<
fÚt
 
cŞÜ
="»d">ç‚¹å‡»è§†é¢‘</fÚt>è¿›å…¥å…¨å±æ¨¡å¼~<
br
/>

337 ç”±äºå®‰å…¨åŸå› ï¼Œ
FÏsh
å…¨å±æ— æ³•ä½¿ç”¨
JS
è§¦å‘

338 </
div
>

339 <
div
>

340 <
div
 
şass
="šput-´•’d div_¶ay_time" 
t™Ë
="è§†é¢‘çš„æ’­æ”¾æµç•…åº¦">

341 <
¥ª
 
şass
="add-Ú">@
F
</span>

342 <
šput
 
şass
="¥ª2" 
¡yË
="width:57px" 
id
="txt_æu’cy" 
ty³
="‹xt" 
¶aûhŞd”
="100%">

343 </
div
>

344 <
div
 
şass
="šput-´•’d div_¶ay_time" 
t™Ë
="è§†é¢‘æ€»å…±å¡é¡¿æ¬¡æ•°">

345 <
¥ª
 
şass
="add-Ú">@
E
</span>

346 <
šput
 
şass
="¥ª2" 
¡yË
="width:85px" 
id
="txt_em±y_couÁ" 
ty³
="‹xt" 
¶aûhŞd”
="0">

347 </
div
>

348 <
div
 
şass
="šput-´•’d div_¶ay_time" 
t™Ë
="è§†é¢‘å½“å‰çš„å¸§ç‡FPS">

349 <
¥ª
 
şass
="add-Ú">@
F
</span>

350 <
šput
 
şass
="¥ª2" 
¡yË
="width:85px" 
id
="txt_ås" 
ty³
="‹xt" 
¶aûhŞd”
="fps">

351 </
div
>

352 <
div
 
şass
="šput-´•’d div_¶ay_time" 
t™Ë
="è§†é¢‘å½“å‰çš„ç ç‡(è§†é¢‘+éŸ³é¢‘)ï¼Œå•ä½ï¼šKbps">

353 <
¥ª
 
şass
="add-Ú">@
B
</span>

354 <
šput
 
şass
="¥ª2" 
¡yË
="width:85px" 
id
="txt_b™¿‹" 
ty³
="‹xt" 
¶aûhŞd”
="kbps">

355 </
div
>

356 <
div
 
şass
="šput-´•’d div_¶ay_time" 
t™Ë
="æ’­æ”¾æ—¶é•¿ï¼Œæ ¼å¼ï¼šå¤© æ—¶:åˆ†:ç§’">

357 <
¥ª
 
şass
="add-Ú">@
T
</span>

358 <
šput
 
şass
="¥ª2" 
¡yË
="width:85px" 
id
="txt_time" 
ty³
="‹xt" 
¶aûhŞd”
="å¤© æ—¶:åˆ†:ç§’">

359 </
div
>

360 </
div
>

361 <
div
 
¡yË
="margin-top:-12px;">

362 
URL
: <
a
 
h»f
="#" 
id
="player_url"></a>

363 <
div
 
şass
="šput-´•’d div_¶ay_time" 
t™Ë
="å½“å‰æ—¶é—´ï¼šå¹´-æœˆ-æ—¥ æ—¶:åˆ†:ç§’">

364 <
¥ª
 
şass
="add-Ú">@
N
</span>

365 <
šput
 
şass
="¥ª2" 
¡yË
="width:135px" 
id
="¶ay”_şock" 
ty³
="‹xt" 
¶aûhŞd”
="å¹´-æœˆ-æ—¥ æ—¶:åˆ†:ç§’">

366 </
div
>

367 </
div
>

368 </
div
>

369 </
div
>

370 <
foÙ”
>

371 <
p
><
a
 
h»f
="h‰ps://g™hub.com/os¤s/¤s">
SRS
 
T—m
 &
cİy
; 2013</
	ga
></
	gp
>

372 </
	gfoÙ”
>

373 </
	gdiv
>

374 </
	gbody
>

375 <
süt
 
	gty³
="‹xt/javasüt" 
¤c
="js/jquery-1.10.2.min.js"></script>

376 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="js/bootstrap.min.js"></script>

377 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="js/swfobject.js"></script>

378 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="js/json2.js"></script>

379 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="js/srs.page.js"></script>

380 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="js/srs.log.js"></script>

381 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="js/srs.player.js"></script>

382 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="js/srs.publisher.js"></script>

383 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="js/srs.utility.js"></script>

384 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="js/winlin.utility.js"></script>

385 <
süt
 
ty³
="text/javascript">

386 
v¬
 
¤s_¶ay”
 = 
nuÎ
;

387 
v¬
 
	gu¾
 = 
nuÎ
;

389 
v¬
 
	g__aùive_d¬
 = 
nuÎ
;

390 
funùiÚ
 
	$£Ëù_d¬
(
d¬_id
, 
num
, 
d’
) {

391 
¤s_¶ay”
.
	`£t_d¬
(
num
, 
d’
);

393 ià(
__aùive_d¬
) {

394 
__aùive_d¬
.
	`»moveCÏss
("active");

397 
__aùive_d¬
 = 
	`$
(
d¬_id
).
	`·»Á
();

398 
__aùive_d¬
.
	`addCÏss
("active");

399 
	}
}

401 
v¬
 
	g__aùive_size
 = 
nuÎ
;

402 
funùiÚ
 
	$£Ëù_fs_size
(
size_id
, 
»ãr
, 
³rûÁ
) {

403 
¤s_¶ay”
.
	`£t_fs
(
»ãr
, 
³rûÁ
);

405 ià(
__aùive_size
) {

406 
__aùive_size
.
	`»moveCÏss
("active");

409 
__aùive_size
 = 
	`$
(
size_id
).
	`·»Á
();

410 
__aùive_size
.
	`addCÏss
("active");

411 
	}
}

413 
v¬
 
	g__aùive_bt
 = 
nuÎ
;

414 
funùiÚ
 
	$£Ëù_bufãr_time
(
bt_id
, 
bufãr_time
) {

415 
¤s_¶ay”
.
	`£t_bt
(
bufãr_time
);

417 ià(
__aùive_bt
) {

418 
__aùive_bt
.
	`»moveCÏss
("active");

421 
__aùive_bt
 = 
	`$
(
bt_id
).
	`·»Á
();

422 
__aùive_bt
.
	`addCÏss
("active");

423 
	}
}

425 
$
(
	$funùiÚ
(){

426 
v¬
 
qu”y
 = 
	`·r£_qu”y_¡ršg
();

431 
	`¤s_š™_¹mp
("#txt_url", "#main_modal");

433 
	`$
("#maš_mod®").
	`Ú
("show", 
	`funùiÚ
(){

434 ià(
¤s_¶ay”
) {

438 
	`$
("#div_cÚš”").
	`»move
();

440 
v¬
 
div_cÚš”
 = 
	`$
("<div/>");

441 
	`$
(
div_cÚš”
).
	`©Œ
("id", "div_container");

442 
	`$
("#¶ay”").
	`­³nd
(
div_cÚš”
);

444 
v¬
 
¶ay”
 = 
	`$
("<div/>");

445 
	`$
(
¶ay”
).
	`©Œ
("id", "player_id");

446 
	`$
(
div_cÚš”
).
	`­³nd
(
¶ay”
);

448 
¤s_¶ay”
 = 
Ãw
 
	`SrsPÏy”
("¶ay”_id", 
	`¤s_g‘_¶ay”_width
(), 
	`¤s_g‘_¶ay”_height
());

449 
¤s_¶ay”
.
Ú_¶ay”_»ady
 = 
	`funùiÚ
() {

450 
	`£Ëù_bufãr_time
("#btn_bt_0_1", 0.1);

451 
this
.
	`¶ay
(
u¾
);

453 
¤s_¶ay”
.
Ú_¶ay”_m‘ad©a
 = 
	`funùiÚ
(
m‘ad©a
) {

454 
	`$
("#bŠ_d¬_Üigš®").
	`‹xt
("è§†é¢‘åŸå§‹æ¯”ä¾‹" + "(" + 
m‘ad©a
.
width
 + ":" + m‘ad©a.
height
 + ")");

455 
	`£Ëù_d¬
("#btn_dar_original", 0, 0);

456 
	`£Ëù_fs_size
("#btn_fs_size_screen_100", "screen", 100);

458 
¤s_¶ay”
.
Ú_¶ay”_tim”
 = 
	`funùiÚ
(
time
, 
bufãr_Ëngth
, 
kbps
, 
ås
, 
¹ime
) {

459 
v¬
 
bufãr
 = 
bufãr_Ëngth
 / 
this
.
bufãr_time
 * 100;

460 
	`$
("#pb_bufãr").
	`width
(
	`Numb”
(
bufãr
).
	`toFixed
(1) + "%");

462 
	`$
("#pb_bufãr_bg").
	`©Œ
("title",

463 "ç¼“å†²åŒºé•¿åº¦:" + 
	`Numb”
(
bufãr_Ëngth
).
	`toFixed
(1) + "ç§’("

464 + 
	`Numb”
(
bufãr
).
	`toFixed
(1) + "%)");

466 
	`$
("#txt_b™¿‹").
	`v®
(
kbps
.
	`toFixed
(1) + "kbps");

467 
	`$
("#txt_ås").
	`v®
(
ås
.
	`toFixed
(1) + "fps");

468 
	`$
("#txt_em±y_couÁ").
	`v®
(
¤s_¶ay”
.
	`em±y_couÁ
() + "æ¬¡å¡é¡¿");

469 
	`$
("#txt_æu’cy").
	`v®
(
¤s_¶ay”
.
	`æu’cy
().
	`toFixed
(2) + "%");

471 
v¬
 
time_¡r
 = "";

473 
time_¡r
 = 
	`·ddšg
(
	`·r£IÁ
(
time
 / 24 / 3600), 2, '0') + " ";

475 
time
 =ime % (24 * 3600);

476 
time_¡r
 +ğ
	`·ddšg
(
	`·r£IÁ
(
time
 / 3600), 2, '0') + ":";

478 
time
 =ime % (3600);

479 
time_¡r
 +ğ
	`·ddšg
(
	`·r£IÁ
(
time
 / 60), 2, '0') + ":";

481 
time
 =ime % (60);

482 
time_¡r
 +ğ
	`·ddšg
(
	`·r£IÁ
(
time
), 2, '0');

484 
	`$
("#txt_time").
	`v®
(
time_¡r
);

486 
v¬
 
şock
 = 
Ãw
 
	`D©e
().
	`g‘Time
() / 1000;

487 
	`$
("#¶ay”_şock").
	`v®
(
	`absŞu‹_£cÚds_to_YYYYmmdd
(
şock
è+ " " + 
	`absŞu‹_£cÚds_to_HHMMSS
(clock));

489 
¤s_¶ay”
.
	`¡¬t
();

492 
	`$
("#maš_mod®").
	`Ú
("hide", 
	`funùiÚ
(){

493 ià(
¤s_¶ay”
) {

494 
¤s_¶ay”
.
	`¡İ
();

495 
¤s_¶ay”
 = 
nuÎ
;

499 
v¬
 
­¶y_u¾_chªge
 = 
	`funùiÚ
() {

500 
v¬
 
¹mp
 = 
	`·r£_¹mp_u¾
(
	`$
("#txt_u¾").
	`v®
());

501 
v¬
 
u¾
 = "h‰p://" + 
qu”y
.
ho¡
 + qu”y.
·thÇme
 + "?"

502 + "vho¡=" + 
¹mp
.
vho¡
 + "&­p=" +„tmp.
­p
 + "&¡»am=" +„tmp.
¡»am


503 + "&£rv”=" + 
¹mp
.
£rv”
 + "&pÜt=" +„tmp.
pÜt


505 
	`$
("#¶ay”_u¾").
	`‹xt
($("#txt_u¾").
	`v®
()).
	`©Œ
("h»f", 
u¾
);

507 
	`$
("#lšk_£rv”").
	`‹xt
(
¹mp
.
£rv”
);

508 
	`$
("#lšk_pÜt").
	`‹xt
(
¹mp
.
pÜt
);

509 
	`$
("#lšk_vho¡").
	`‹xt
(
¹mp
.
vho¡
);

510 
	`$
("#lšk_­p").
	`‹xt
(
¹mp
.
­p
);

511 
	`$
("#lšk_¡»am").
	`‹xt
(
¹mp
.
¡»am
);

512 
	`$
("#lšk_¹mp").
	`‹xt
($("#txt_u¾").
	`v®
());

513 
	`$
("#lšk_u¾").
	`©Œ
("h»f", 
u¾
);

516 
	`$
("#txt_u¾").
	`chªge
(
	`funùiÚ
(){

517 
	`­¶y_u¾_chªge
();

520 
	`$
("#bŠ_g’”©e_lšk").
	`şick
(
	`funùiÚ
(){

521 
	`$
("#lšk_mod®").
	`mod®
({
show
:
Œue
, 
keybßrd
:true});

524 
	`$
("#bŠ_¶ay").
	`şick
(
	`funùiÚ
(){

525 
u¾
 = 
	`$
("#txt_u¾").
	`v®
();

526 
	`$
("#maš_mod®").
	`mod®
({
show
:
Œue
, 
keybßrd
:true});

529 
	`$
("#bŠ_fuÎsü“n").
	`şick
(
	`funùiÚ
(){

530 
	`$
("#fuÎsü“n_ts").
	`toggË
();

533 
	`$
("#bŠ_·u£").
	`şick
(
	`funùiÚ
() {

534 
	`$
("#bŠ_»sume").
	`toggË
();

535 
	`$
("#bŠ_·u£").
	`toggË
();

536 
¤s_¶ay”
.
	`·u£
();

538 
	`$
("#bŠ_»sume").
	`şick
(
	`funùiÚ
(){

539 
	`$
("#bŠ_»sume").
	`toggË
();

540 
	`$
("#bŠ_·u£").
	`toggË
();

541 
¤s_¶ay”
.
	`»sume
();

544 ià(
Œue
) {

545 
	`$
("#¤s_publish").
	`şick
(
	`funùiÚ
 () {

546 
u¾
 = 
	`$
("#¤s_publish").
	`‹xt
();

547 
	`$
("#maš_mod®").
	`mod®
({
show
: 
Œue
, 
keybßrd
: 
çl£
});

549 
	`$
("#¤s_publish_ld").
	`şick
(
	`funùiÚ
 () {

550 
u¾
 = 
	`$
("#¤s_publish_ld").
	`‹xt
();

551 
	`$
("#maš_mod®").
	`mod®
({
show
: 
Œue
, 
keybßrd
: 
çl£
});

553 
	`$
("#¤s_publish_sd").
	`şick
(
	`funùiÚ
 () {

554 
u¾
 = 
	`$
("#¤s_publish_sd").
	`‹xt
();

555 
	`$
("#maš_mod®").
	`mod®
({
show
: 
Œue
, 
keybßrd
: 
çl£
});

557 
	`$
("#¤s_publish_fw").
	`şick
(
	`funùiÚ
 () {

558 
u¾
 = 
	`$
("#¤s_publish_fw").
	`‹xt
();

559 
	`$
("#maš_mod®").
	`mod®
({
show
: 
Œue
, 
keybßrd
: 
çl£
});

561 
	`$
("#¤s_publish_fw_ld").
	`şick
(
	`funùiÚ
 () {

562 
u¾
 = 
	`$
("#¤s_publish_fw_ld").
	`‹xt
();

563 
	`$
("#maš_mod®").
	`mod®
({
show
: 
Œue
, 
keybßrd
: 
çl£
});

565 
	`$
("#¤s_publish_fw_sd").
	`şick
(
	`funùiÚ
 () {

566 
u¾
 = 
	`$
("#¤s_publish_fw_sd").
	`‹xt
();

567 
	`$
("#maš_mod®").
	`mod®
({
show
: 
Œue
, 
keybßrd
: 
çl£
});

571 
v¬
 
jw¶ay”_u¾
 = "h‰p://" + 
qu”y
.
ho¡
 + qu”y.
dœ
 + "/jwplayer6.html?vhost=demo.srs.com&app=live&hls_autostart=true";

572 ià(
Œue
) {

573 
	`$
("#¤s_publish_hls").
	`©Œ
("h»f", 
jw¶ay”_u¾
 + "&stream=livestream");

574 
	`$
("#¤s_publish_ld_hls").
	`©Œ
("h»f", 
jw¶ay”_u¾
 + "&stream=livestream_ld");

575 
	`$
("#¤s_publish_sd_hls").
	`©Œ
("h»f", 
jw¶ay”_u¾
 + "&stream=livestream_sd");

576 
v¬
 
jw¶ay”_u¾
 = "h‰p://" + 
qu”y
.
ho¡
 + qu”y.
dœ
 + "/jwplayer6.html?vhost=demo.srs.com&app=forward/live&hls_autostart=true";

577 
	`$
("#¤s_publish_fw_hls").
	`©Œ
("h»f", 
jw¶ay”_u¾
 + "&stream=livestream");

578 
	`$
("#¤s_publish_fw_ld_hls").
	`©Œ
("h»f", 
jw¶ay”_u¾
 + "&stream=livestream_ld");

579 
	`$
("#¤s_publish_fw_sd_hls").
	`©Œ
("h»f", 
jw¶ay”_u¾
 + "&stream=livestream_sd");

582 ià(
Œue
) {

583 
	`$
("#bŠ_d¬_Üigš®").
	`şick
(
	`funùiÚ
(){

584 
	`£Ëù_d¬
("#btn_dar_original", 0, 0);

586 
	`$
("#bŠ_d¬_21_9").
	`şick
(
	`funùiÚ
(){

587 
	`£Ëù_d¬
("#btn_dar_21_9", 21, 9);

589 
	`$
("#bŠ_d¬_16_9").
	`şick
(
	`funùiÚ
(){

590 
	`£Ëù_d¬
("#btn_dar_16_9", 16, 9);

592 
	`$
("#bŠ_d¬_4_3").
	`şick
(
	`funùiÚ
(){

593 
	`£Ëù_d¬
("#btn_dar_4_3", 4, 3);

595 
	`$
("#bŠ_d¬_fl").
	`şick
(
	`funùiÚ
(){

596 
	`£Ëù_d¬
("#btn_dar_fill", -1, -1);

600 ià(
Œue
) {

601 
	`$
("#bŠ_fs_size_video_100").
	`şick
(
	`funùiÚ
(){

602 
	`£Ëù_fs_size
("#btn_fs_size_video_100", "video", 100);

604 
	`$
("#bŠ_fs_size_video_75").
	`şick
(
	`funùiÚ
(){

605 
	`£Ëù_fs_size
("#btn_fs_size_video_75", "video", 75);

607 
	`$
("#bŠ_fs_size_video_50").
	`şick
(
	`funùiÚ
(){

608 
	`£Ëù_fs_size
("#btn_fs_size_video_50", "video", 50);

610 
	`$
("#bŠ_fs_size_sü“n_100").
	`şick
(
	`funùiÚ
(){

611 
	`£Ëù_fs_size
("#btn_fs_size_screen_100", "screen", 100);

613 
	`$
("#bŠ_fs_size_sü“n_75").
	`şick
(
	`funùiÚ
(){

614 
	`£Ëù_fs_size
("#btn_fs_size_screen_75", "screen", 75);

616 
	`$
("#bŠ_fs_size_sü“n_50").
	`şick
(
	`funùiÚ
(){

617 
	`£Ëù_fs_size
("#btn_fs_size_screen_50", "screen", 50);

621 ià(
Œue
) {

622 
	`$
("#bŠ_bt_0_1").
	`şick
(
	`funùiÚ
(){

623 
	`£Ëù_bufãr_time
("#btn_bt_0_1", 0.1);

625 
	`$
("#bŠ_bt_0_2").
	`şick
(
	`funùiÚ
(){

626 
	`£Ëù_bufãr_time
("#btn_bt_0_2", 0.2);

628 
	`$
("#bŠ_bt_0_3").
	`şick
(
	`funùiÚ
(){

629 
	`£Ëù_bufãr_time
("#btn_bt_0_3", 0.3);

631 
	`$
("#bŠ_bt_0_5").
	`şick
(
	`funùiÚ
(){

632 
	`£Ëù_bufãr_time
("#btn_bt_0_5", 0.5);

634 
	`$
("#bŠ_bt_0_8").
	`şick
(
	`funùiÚ
(){

635 
	`£Ëù_bufãr_time
("#btn_bt_0_8", 0.8);

637 
	`$
("#bŠ_bt_1").
	`şick
(
	`funùiÚ
(){

638 
	`£Ëù_bufãr_time
("#btn_bt_1", 1);

640 
	`$
("#bŠ_bt_2").
	`şick
(
	`funùiÚ
(){

641 
	`£Ëù_bufãr_time
("#btn_bt_2", 2);

643 
	`$
("#bŠ_bt_3").
	`şick
(
	`funùiÚ
(){

644 
	`£Ëù_bufãr_time
("#btn_bt_3", 3);

646 
	`$
("#bŠ_bt_5").
	`şick
(
	`funùiÚ
(){

647 
	`£Ëù_bufãr_time
("#btn_bt_5", 5);

649 
	`$
("#bŠ_bt_10").
	`şick
(
	`funùiÚ
(){

650 
	`£Ëù_bufãr_time
("#btn_bt_10", 10);

652 
	`$
("#bŠ_bt_30").
	`şick
(
	`funùiÚ
(){

653 
	`£Ëù_bufãr_time
("#btn_bt_30", 30);

657 
v¬
 
qu”y
 = 
	`·r£_qu”y_¡ršg
();

658 ià(
qu”y
.
auto¡¬t
 == "true") {

659 
u¾
 = 
	`$
("#txt_u¾").
	`v®
();

660 
	`$
("#maš_mod®").
	`mod®
({
show
:
Œue
, 
keybßrd
:
çl£
});

663 
	`­¶y_u¾_chªge
();

664 
	}
});

665 </
	gsüt
>

666 </
	ghtml
>

	@trunk/research/players/srs_publisher.html

1 <!
DOCTYPE
 
	ghtml
>

2 <
	ghtml
>

3 <
	gh—d
>

4 <
	gt™Ë
>
	gSRS
</title>

5 <
m‘a
 
	gch¬£t
="utf-8">

6 <
lšk
 
»l
="¡yËsh“t" 
ty³
="‹xt/css" 
h»f
="css/bootstrap.min.css"/>

7 <
¡yË
>

8 
body
{

9 
·ddšg
-
tİ
: 55
px
;

11 </
	g¡yË
>

12 </
	gh—d
>

13 <
	gbody
>

14 <
div
 
	gşass
="navbar‚avbar-fixed-top">

15 <
div
 
şass
="navbar-inner">

16 <
div
 
şass
="container">

17 <
a
 
id
="¤s_šdex" 
şass
="b¿nd" 
h»f
="#">
SRS
</a>

18 <
div
 
şass
="nav-collapse collapse">

19 <
ul
 
şass
="nav">

20 <
li
><
a
 
id
="Çv_¤s_¶ay”" 
h»f
="¤s_¶ay”.html">
SRS
æ’­æ”¾å™¨</a></li>

21 <
li
 
şass
="aùive"><
a
 
id
="Çv_¤s_publish”" 
h»f
="¤s_publish”.html">
SRS
ç¼–ç å™¨</a></li>

22 <
li
><
a
 
id
="Çv_¤s_ch©" 
h»f
="¤s_ch©.html">
SRS
ä¼šè®®</a></li>

23 <
li
><
a
 
id
="Çv_¤s_bwt" 
h»f
="¤s_bwt.html">
SRS
æµ‹ç½‘é€Ÿ</a></li>

24 <
li
><
a
 
id
="Çv_jw¶ay”6" 
h»f
="jw¶ay”6.html">
JWPÏy”6
æ’­æ”¾å™¨</a></li>

25 <
li
><
a
 
id
="Çv_osmf" 
h»f
="osmf.html">
AdobeOSMF
æ’­æ”¾å™¨</a></li>

26 <
li
><
a
 
id
="Çv_vlc" 
h»f
="vlc.html">
VLC
æ’­æ”¾å™¨</a></li>

27 </
ul
>

28 </
div
>

29 </
div
>

30 </
div
>

31 </
div
>

32 <
div
 
şass
="container">

33 <
div
 
şass
="®”ˆ®”t-šfØçdš" 
id
="txt_log">

34 <
bu‰Ú
 
ty³
="bu‰Ú" 
şass
="şo£" 
d©a
-
dismiss
="alert">Ã—</button>

35 <
¡rÚg
><
¥ª
 
id
="txt_log_t™Ë">
U§ge
:</span></strong>

36 <
¥ª
 
id
="txt_log_msg">è®¾ç½®ç¼–ç å‚æ•°ï¼Œç‚¹â€œå‘å¸ƒè§†é¢‘â€ï¼Œå…è®¸
FÏsh
è®¿é—®æ‘„åƒå¤´å³å¯æ¨æµ</span>

37 </
div
>

38 <
div
 
şass
="control-group">

39 <
div
 
şass
="form-inline">

40 <
bu‰Ú
 
şass
="bŠ" 
id
="btn_video_settings">è§†é¢‘ç¼–ç é…ç½®</button>

41 <
bu‰Ú
 
şass
="bŠ" 
id
="btn_audio_settings">éŸ³é¢‘ç¼–ç é…ç½®</button>

42 </
div
>

43 </
div
>

44 <
div
 
şass
="control-group">

45 <
div
 
şass
="form-inline">

47 <
šput
 
ty³
="‹xt" 
id
="txt_u¾" 
şass
="šput-xxÏrge" 
v®ue
=""></input>

48 <
bu‰Ú
 
şass
="bŠ bŠ-´im¬y" 
id
="btn_publish">å‘å¸ƒè§†é¢‘</button>

49 </
div
>

50 </
div
>

51 <
div
 
şass
="control-group">

52 <
div
 
şass
="form-inline">

54 1.<
a
 
id
="txt_¶ay_»®time" 
şass
="šput-xxÏrge" 
h»f
="#">
RTMP
ä½å»¶æ—¶(è¯·å‘å¸ƒè§†é¢‘)</a>

55 2.<
a
 
id
="txt_¶ay_u¾" 
şass
="šput-xxÏrge" 
h»f
="#">
RTMP
å·²è½¬ç (è¯·å‘å¸ƒè§†é¢‘)</a>

56 3.<
a
 
id
="txt_¶ay_hls" 
şass
="šput-xxÏrge" 
h»f
="#">
HLS
-
m3u8
(è¯·å‘å¸ƒè§†é¢‘)</a>

57 4.<
a
 
id
="txt_¶ay_jw¶ay”" 
şass
="šput-xxÏrge" 
h»f
="#">
HLS
-
JWPÏy”
(è¯·å‘å¸ƒè§†é¢‘)</a>

58 </
div
>

59 </
div
>

60 <
div
 
id
="video_mod®" 
şass
="modal hide fade">

61 <
div
 
şass
="modal-header">

62 <
bu‰Ú
 
ty³
="bu‰Ú" 
şass
="şo£" 
d©a
-
dismiss
="mod®" 
¬Ÿ
-
hidd’
="true">Ã—</button>

63 <
h3
>è§†é¢‘ç¼–ç </h3>

64 </
div
>

65 <
div
 
şass
="modal-body">

66 <
div
 
şass
="form-horizontal">

67 <
div
 
şass
="control-group">

68 <
Ïb–
 
şass
="control-label" ="sl_cameras">

70 <
a
 
id
="¦_ÿm”as_ts" 
h»f
="#" 
d©a
-
toggË
="toŞt" d©a-
¶aûm’t
="right" 
t™Ë
="">

71 <
img
 
¤c
="img/tooltip.png"/>

72 </
a
>

73 </
Ïb–
>

74 <
div
 
şass
="controls">

75 <
£Ëù
 
şass
="¥ª4" 
id
="sl_cameras"></select>

76 </
div
>

77 </
div
>

78 <
div
 
şass
="control-group">

79 <
Ïb–
 
şass
="control-label" ="sl_vcodec">

80 
Codec


81 <
a
 
id
="¦_ÿm”as_ts" 
h»f
="#" 
d©a
-
toggË
="toŞt" d©a-
¶aûm’t
="right" 
t™Ë
="">

82 <
img
 
¤c
="img/tooltip.png"/>

83 </
a
>

84 </
Ïb–
>

85 <
div
 
şass
="controls">

86 <
£Ëù
 
şass
="¥ª2" 
id
="sl_vcodec"></select>

87 </
div
>

88 </
div
>

89 <
div
 
şass
="control-group">

90 <
Ïb–
 
şass
="control-label" ="sl_profile">

91 
Profe


92 <
a
 
id
="¦_´ofe_ts" 
h»f
="#" 
d©a
-
toggË
="toŞt" d©a-
¶aûm’t
="right" 
t™Ë
="">

93 <
img
 
¤c
="img/tooltip.png"/>

94 </
a
>

95 </
Ïb–
>

96 <
div
 
şass
="controls">

97 <
£Ëù
 
şass
="¥ª2" 
id
="sl_profile"></select>

98 </
div
>

99 </
div
>

100 <
div
 
şass
="control-group">

101 <
Ïb–
 
şass
="control-label" ="sl_level">

102 
Lev–


103 <
a
 
id
="¦_Ëv–_ts" 
h»f
="#" 
d©a
-
toggË
="toŞt" d©a-
¶aûm’t
="right" 
t™Ë
="">

104 <
img
 
¤c
="img/tooltip.png"/>

105 </
a
>

106 </
Ïb–
>

107 <
div
 
şass
="controls">

108 <
£Ëù
 
şass
="¥ª2" 
id
="sl_level"></select>

109 </
div
>

110 </
div
>

111 <
div
 
şass
="control-group">

112 <
Ïb–
 
şass
="control-label" ="sl_gop">

113 
GOP


114 <
a
 
id
="¦_gİ_ts" 
h»f
="#" 
d©a
-
toggË
="toŞt" d©a-
¶aûm’t
="right" 
t™Ë
="">

115 <
img
 
¤c
="img/tooltip.png"/>

116 </
a
>

117 </
Ïb–
>

118 <
div
 
şass
="controls">

119 <
£Ëù
 
şass
="¥ª2" 
id
="sl_gop"></select>

120 </
div
>

121 </
div
>

122 <
div
 
şass
="control-group">

123 <
Ïb–
 
şass
="control-label" ="sl_size">

125 <
a
 
id
="¦_size_ts" 
h»f
="#" 
d©a
-
toggË
="toŞt" d©a-
¶aûm’t
="right" 
t™Ë
="">

126 <
img
 
¤c
="img/tooltip.png"/>

127 </
a
>

128 </
Ïb–
>

129 <
div
 
şass
="controls">

130 <
£Ëù
 
şass
="¥ª2" 
id
="sl_size"></select>

131 </
div
>

132 </
div
>

133 <
div
 
şass
="control-group">

134 <
Ïb–
 
şass
="control-label" ="sl_fps">

136 <
a
 
id
="¦_ås_ts" 
h»f
="#" 
d©a
-
toggË
="toŞt" d©a-
¶aûm’t
="right" 
t™Ë
="">

137 <
img
 
¤c
="img/tooltip.png"/>

138 </
a
>

139 </
Ïb–
>

140 <
div
 
şass
="controls">

141 <
£Ëù
 
şass
="¥ª2" 
id
="sl_fps"></select>

142 </
div
>

143 </
div
>

144 <
div
 
şass
="control-group">

145 <
Ïb–
 
şass
="control-label" ="sl_bitrate">

147 <
a
 
id
="¦_b™¿‹_ts" 
h»f
="#" 
d©a
-
toggË
="toŞt" d©a-
¶aûm’t
="right" 
t™Ë
="">

148 <
img
 
¤c
="img/tooltip.png"/>

149 </
a
>

150 </
Ïb–
>

151 <
div
 
şass
="controls">

152 <
£Ëù
 
şass
="¥ª2" 
id
="sl_bitrate"></select>

153 </
div
>

154 </
div
>

155 </
div
>

156 </
div
>

157 <
div
 
şass
="modal-footer">

158 <
bu‰Ú
 
şass
="bŠ bŠ-´im¬y" 
d©a
-
dismiss
="mod®" 
¬Ÿ
-
hidd’
="true">è®¾ç½®</button>

159 </
div
>

160 </
div
>

161 <
div
 
id
="audio_mod®" 
şass
="modal hide fade">

162 <
div
 
şass
="modal-header">

163 <
bu‰Ú
 
ty³
="bu‰Ú" 
şass
="şo£" 
d©a
-
dismiss
="mod®" 
¬Ÿ
-
hidd’
="true">Ã—</button>

164 <
h3
>éŸ³é¢‘ç¼–ç </h3>

165 </
div
>

166 <
div
 
şass
="modal-body">

167 <
div
 
şass
="form-horizontal">

168 <
div
 
şass
="control-group">

169 <
Ïb–
 
şass
="control-label" ="sl_microphones">

171 <
a
 
id
="wÜk”_id_ts" 
h»f
="#" 
d©a
-
toggË
="toŞt" d©a-
¶aûm’t
="right" 
t™Ë
="">

172 <
img
 
¤c
="img/tooltip.png"/>

173 </
a
>

174 </
Ïb–
>

175 <
div
 
şass
="controls">

176 <
£Ëù
 
şass
="¥ª4" 
id
="sl_microphones"></select>

177 </
div
>

178 </
div
>

179 <
div
 
şass
="control-group">

180 <
Ïb–
 
şass
="control-label" ="sl_acodec">

182 <
a
 
id
="¦_acodec_ts" 
h»f
="#" 
d©a
-
toggË
="toŞt" d©a-
¶aûm’t
="right" 
t™Ë
="">

183 <
img
 
¤c
="img/tooltip.png"/>

184 </
a
>

185 </
Ïb–
>

186 <
div
 
şass
="controls">

187 <
£Ëù
 
şass
="¥ª2" 
id
="sl_acodec"></select>

188 </
div
>

189 </
div
>

190 </
div
>

191 </
div
>

192 <
div
 
şass
="modal-footer">

193 <
bu‰Ú
 
şass
="bŠ bŠ-´im¬y" 
d©a
-
dismiss
="mod®" 
¬Ÿ
-
hidd’
="true">è®¾ç½®</button>

194 </
div
>

195 </
div
>

196 <
div
 
şass
="container">

197 <
div
 
şass
="row-fluid">

198 <
div
 
şass
="span6">

199 <
div
 
şass
="accordion-group">

200 <
div
 
şass
="accordion-heading">

201 <
¥ª
 
şass
="accordion-toggle">

202 <
¡rÚg
>æœ¬åœ°æ‘„åƒå¤´</strong>

203 </
¥ª
>

204 </
div
>

205 <
div
 
şass
="accordion-body collapse in">

206 <
div
 
şass
="accordion-inner">

207 <
div
 
id
="local_publisher"></div>

208 </
div
>

209 </
div
>

210 </
div
>

211 </
div
>

212 <
div
 
şass
="span6">

213 <
div
 
şass
="accordion-group">

214 <
div
 
şass
="accordion-heading">

215 <
¥ª
 
şass
="accordion-toggle">

216 <
¡rÚg
>è¿œç¨‹æœåŠ¡å™¨</strong>

217 <
a
 
id
="»mÙe_ts" 
h»f
="#" 
d©a
-
toggË
="toŞt" d©a-
¶aûm’t
="tİ" 
t™Ë
="">

218 é»‘å±<
img
 
¤c
="img/tooltip.png"/>

219 </
a
>

220 <
a
 
id
="»mÙe_¶ay”_u¾" 
h»f
="#" 
d©a
-
toggË
="toŞt" d©a-
¶aûm’t
="tİ" 
t™Ë
="">

221 æ’­æ”¾åœ°å€<
img
 
¤c
="img/tooltip.png"/>

222 </
a
>

223 </
¥ª
>

224 </
div
>

225 <
div
 
şass
="accordion-body collapse in">

226 <
div
 
şass
="accordion-inner">

227 <
div
 
id
="remote_player"></div>

228 </
div
>

229 </
div
>

230 </
div
>

231 </
div
>

232 </
div
>

233 </
div
>

234 <
div
 
şass
="container">

235 <
div
 
şass
="row-fluid">

236 <
div
 
şass
="span6">

237 <
div
 
şass
="accordion-group">

238 <
div
 
şass
="accordion-heading">

239 <
¥ª
 
şass
="accordion-toggle">

240 <
¡rÚg
>è¿œç¨‹æœåŠ¡å™¨</strong>

241 <
a
 
id
="low_Ï‹cy_ts" 
h»f
="#" 
d©a
-
toggË
="toŞt" d©a-
¶aûm’t
="tİ" 
t™Ë
="">

242 ä½å»¶æ—¶<
img
 
¤c
="img/tooltip.png"/>

243 </
a
>

244 <
a
 
id
="»®time_¶ay”_u¾" 
h»f
="#" 
d©a
-
toggË
="toŞt" d©a-
¶aûm’t
="tİ" 
t™Ë
="">

245 æ’­æ”¾åœ°å€<
img
 
¤c
="img/tooltip.png"/>

246 </
a
>

247 </
¥ª
>

248 </
div
>

249 <
div
 
şass
="accordion-body collapse in">

250 <
div
 
şass
="accordion-inner">

251 <
div
 
id
="realtime_player"></div>

252 </
div
>

253 </
div
>

254 </
div
>

255 </
div
>

256 <
div
 
şass
="span6">

257 </
div
>

258 </
div
>

259 </
div
>

260 <
foÙ”
>

261 <
p
><
a
 
h»f
="h‰ps://g™hub.com/os¤s/¤s">
SRS
 
T—m
 &
cİy
; 2013</
	ga
></
	gp
>

262 </
	gfoÙ”
>

263 </
	gdiv
>

264 </
	gbody
>

265 <
süt
 
	gty³
="‹xt/javasüt" 
¤c
="js/jquery-1.10.2.min.js"></script>

266 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="js/bootstrap.min.js"></script>

267 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="js/swfobject.js"></script>

268 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="js/json2.js"></script>

269 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="js/srs.page.js"></script>

270 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="js/srs.log.js"></script>

271 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="js/srs.player.js"></script>

272 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="js/srs.publisher.js"></script>

273 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="js/srs.utility.js"></script>

274 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="js/winlin.utility.js"></script>

275 <
süt
 
ty³
="text/javascript">

276 
v¬
 
¤s_publish”
 = 
nuÎ
;

277 
v¬
 
	g»mÙe_¶ay”
 = 
nuÎ
;

278 
v¬
 
	g»®time_¶ay”
 = 
nuÎ
;

280 
v¬
 
	gqu”y
 = 
·r£_qu”y_¡ršg
();

281 
$
(
	$funùiÚ
(){

285 
	`¤s_š™_¹mp
("#txt_u¾", 
nuÎ
);

287 ià(
qu”y
.
ag’t
 == "true") {

288 
docum’t
.
	`wr™e
(
Çvig©Ü
.
u£rAg’t
);

292 
	`$
("#bŠ_video_£‰šgs").
	`şick
(
	`funùiÚ
(){

293 
	`$
("#video_mod®").
	`mod®
({
show
:
Œue
});

295 
	`$
("#bŠ_audio_£‰šgs").
	`şick
(
	`funùiÚ
(){

296 
	`$
("#audio_mod®").
	`mod®
({
show
:
Œue
});

299 
	`$
("#»mÙe_ts").
	`toŞt
({

300 
t™Ë
: "ä¸ºäº†æ”¯æŒHLSè¾“å‡ºï¼ŒFLASHç¼–ç å™¨è¾“å‡ºçš„æµéœ€è¦ç»è¿‡è½¬ç (VP6=>H264,MP3=>aac)ï¼Œæ‰€ä»¥ä¼šé»‘å±è¾ƒé•¿æ—¶é—´ï¼Œè¯·è€å¿ƒç­‰å¾…"

302 
	`$
("#low_Ï‹cy_ts").
	`toŞt
({

303 
t™Ë
: "æœåŠ¡å™¨ä¸è½¬ç ç›´æ¥è½¬å‘FLASHç¼–ç å™¨çš„æµï¼Œæ‰€ä»¥å»¶è¿Ÿæ¯”æ”¯æŒHLSçš„æµè¦ä½å¾ˆå¤š"

305 
	`$
("#»®time_¶ay”_u¾").
	`toŞt
({

306 
t™Ë
: "å³é”®å¤åˆ¶RTMPåœ°å€"

308 
	`$
("#»mÙe_¶ay”_u¾").
	`toŞt
({

309 
t™Ë
: "å³é”®å¤åˆ¶RTMPåœ°å€"

312 
	`$
("#bŠ_publish").
	`şick
(
Ú_u£r_publish
);

315 
	`$
("#txt_u¾").
	`v®
($("#txt_u¾").v®(è+ "." + 
Ãw
 
	`D©e
().
	`g‘Time
());

318 
¤s_publish”
 = 
Ãw
 
	`SrsPublish”
("local_publisher", 430, 185);

319 
¤s_publish”
.
Ú_publish”_»ady
 = 
	`funùiÚ
(
ÿm”as
, 
miüİhÚes
) {

320 
	`¤s_publish”_š™Ÿlize_·ge
(

321 
ÿm”as
, 
miüİhÚes
,

328 
¤s_publish”
.
Ú_publish”_”rÜ
 = 
	`funùiÚ
(
code
, 
desc
) {

329 ià(!
	`Ú_publish_¡İ
()) {

332 
	`”rÜ
(
code
, 
desc
 + "è¯·é‡è¯•ã€‚");

334 
¤s_publish”
.
Ú_publish”_w¬n
 = 
	`funùiÚ
(
code
, 
desc
) {

335 
	`w¬n
(
code
, 
desc
);

337 
¤s_publish”
.
	`¡¬t
();

339 
	`upd©e_¶ay_u¾
();

342 ià(
qu”y
.
no_¶ay
 != "true") {

344 
»mÙe_¶ay”
 = 
Ãw
 
	`SrsPÏy”
("remote_player", 430, 185);

345 
»mÙe_¶ay”
.
Ú_¶ay”_»ady
 = 
	`funùiÚ
() {

346 
this
.
	`£t_bt
(0.8);

348 
»mÙe_¶ay”
.
Ú_¶ay”_m‘ad©a
 = 
	`funùiÚ
(
m‘ad©a
) {

349 
this
.
	`£t_d¬
(0, 0);

350 
this
.
	`£t_fs
("screen", 100);

352 
»mÙe_¶ay”
.
	`¡¬t
();

355 
»®time_¶ay”
 = 
Ãw
 
	`SrsPÏy”
("realtime_player", 430, 185);

356 
»®time_¶ay”
.
Ú_¶ay”_»ady
 = 
	`funùiÚ
() {

357 
this
.
	`£t_bt
(0.8);

359 
»®time_¶ay”
.
Ú_¶ay”_m‘ad©a
 = 
	`funùiÚ
(
m‘ad©a
) {

360 
this
.
	`£t_d¬
(0, 0);

361 
this
.
	`£t_fs
("screen", 100);

363 
»®time_¶ay”
.
	`¡¬t
();

365 
	}
});

367 
funùiÚ
 
	$Ú_publish_¡İ
() {

368 ià(!
	`¤s_ÿn_»publish
()) {

369 
	`$
("#bŠ_još").
	`©Œ
("di§bËd", 
Œue
);

370 
	`”rÜ
(0, "æ‚¨ä½¿ç”¨çš„æµè§ˆå™¨å¾ˆå¼±ï¼Œè¯·å…³é—­é¡µé¢åé‡æ–°æ‰“å¼€é¡µé¢ï¼ˆåˆ·æ–°ä¹Ÿä¸ç®¡ç”¨ï¼‰ã€‚<br/>æ¨èä½¿ç”¨Chrome/Firefox/Safari/Operaæµè§ˆå™¨ï¼Œæ”¯æŒé‡è¯•");

372 
¤s_log_di§bËd
 = 
Œue
;

373  
çl£
;

376  
Œue
;

377 
	}
}

387 
funùiÚ
 
	$upd©e_¶ay_u¾
() {

388 
v¬
 
u¾
 = 
	`$
("#txt_u¾").
	`v®
();

389 
v¬
 
»t
 = 
	`¤s_·r£_¹mp_u¾
(
u¾
);

391 
v¬
 
»mÙe_u¾
 = "¹mp://" + 
»t
.
£rv”
 + ":" +„‘.
pÜt
 + "/" +„‘.
­p
 + "...vho¡..." + 
	`¤s_g‘_¶ay”_publish_vho¡
Ô‘.
vho¡
è+ "/" +„‘.
¡»am
;

392 
	`$
("#»®time_¶ay”_u¾").
	`©Œ
("h»f", 
u¾
).attr("target", "_blank");

393 
	`$
("#»mÙe_¶ay”_u¾").
	`©Œ
("h»f", 
»mÙe_u¾
).attr("target", "_blank");

395 
v¬
 
¤s_¶ay”_u¾
 = "h‰p://" + 
qu”y
.
ho¡
 + qu”y.
dœ
 + "/srs_player.html?";

396 
¤s_¶ay”_u¾
 +ğ"vho¡=" + 
	`¤s_g‘_¶ay”_publish_vho¡
(
»t
.
vho¡
è+ "&pÜt=" +„‘.
pÜt
 + "&­p=" +„‘.
­p
 + "&¡»am=" +„‘.
¡»am
;

397 
¤s_¶ay”_u¾
 += "&autostart=true";

399 
v¬
 
¤s_¶ay”_¹_u¾
 = "h‰p://" + 
qu”y
.
ho¡
 + qu”y.
dœ
 + "/srs_player.html?";

400 
¤s_¶ay”_¹_u¾
 +ğ"vho¡=" + 
»t
.
vho¡
 + "&pÜt=" +„‘.
pÜt
 + "&­p=" +„‘.
­p
 + "&¡»am=" +„‘.
¡»am
;

401 
¤s_¶ay”_¹_u¾
 += "&autostart=true";

403 
v¬
 
jw¶ay”_u¾
 = "h‰p://" + 
qu”y
.
ho¡
 + qu”y.
dœ
 + "/jwplayer6.html?";

404 
jw¶ay”_u¾
 +ğ"vho¡=" + 
	`¤s_g‘_¶ay”_publish_vho¡
(
»t
.
vho¡
è+ "&pÜt=" +„‘.
pÜt
 + "&­p=" +„‘.
­p
 + "&¡»am=" +„‘.
¡»am
;

405 
jw¶ay”_u¾
 += "&hls_autostart=true";

407 
v¬
 
hls_u¾
 = "h‰p://" + 
»t
.
£rv”
 + ":" + 
qu”y
.
h‰p_pÜt
 + "/" +„‘.
­p
 + "/" +„‘.
¡»am
 + ".m3u8";

409 
	`$
("#txt_¶ay_»®time").
	`‹xt
("RTMPä½å»¶æ—¶(ç‚¹å‡»æ‰“å¼€)").
	`©Œ
("h»f", 
¤s_¶ay”_¹_u¾
).attr("target", "_blank");

410 
	`$
("#txt_¶ay_u¾").
	`‹xt
("RTMPå·²è½¬ç (ç‚¹å‡»æ‰“å¼€)").
	`©Œ
("h»f", 
¤s_¶ay”_u¾
).attr("target", "_blank");

411 
	`$
("#txt_¶ay_hls").
	`‹xt
("HLS-m3u8(ç‚¹å‡»æ‰“å¼€æˆ–å³é”®å¤åˆ¶)").
	`©Œ
("h»f", 
hls_u¾
).attr("target", "_blank");

412 
	`$
("#txt_¶ay_jw¶ay”").
	`‹xt
("HLS-JWPÏy”(ç‚¹å‡»æ‰“å¼€)").
	`©Œ
("h»f", 
jw¶ay”_u¾
).attr("target", "_blank");

413 
	}
}

414 
funùiÚ
 
	$Ú_u£r_publish
() {

415 ià(
	`$
("#bŠ_publish").
	`‹xt
() == "åœæ­¢å‘å¸ƒ") {

416 
¤s_publish”
.
	`¡İ
();

417 
	`$
("#bŠ_publish").
	`‹xt
("å‘å¸ƒè§†é¢‘");

425 ià(!
	`Ú_publish_¡İ
()) {

431 
	`$
("#bŠ_publish").
	`‹xt
("åœæ­¢å‘å¸ƒ");

433 
	`upd©e_¶ay_u¾
();

435 
v¬
 
u¾
 = 
	`$
("#txt_u¾").
	`v®
();

436 
v¬
 
vcodec
 = {};

437 
v¬
 
acodec
 = {};

438 
	`¤s_publi£r_g‘_codec
(

439 
vcodec
, 
acodec
,

446 
	`šfo
("å¼€å§‹æ¨æµåˆ°æœåŠ¡å™¨");

447 
¤s_publish”
.
	`publish
(
u¾
, 
vcodec
, 
acodec
);

449 ià(
»®time_¶ay”
) {

451 
»®time_¶ay”
.
	`¡İ
();

452 
»®time_¶ay”
.
	`¶ay
(
u¾
);

455 ià(
»mÙe_¶ay”
) {

460 
v¬
 
»t
 = 
	`¤s_·r£_¹mp_u¾
(
u¾
);

461 
v¬
 
pub_u¾
 = "¹mp://" + 
»t
.
£rv”
 + ":" +„‘.
pÜt
 + "/" +„‘.
­p
;

462 
pub_u¾
 +ğ"?vho¡=" + 
	`¤s_g‘_¶ay”_publish_vho¡
(
»t
.
vho¡
è+ "/" +„‘.
¡»am
;

463 
»mÙe_¶ay”
.
	`¡İ
();

464 
»mÙe_¶ay”
.
	`¶ay
(
pub_u¾
);

466 
	}
}

467 </
	gsüt
>

468 </
	ghtml
>

	@trunk/research/players/vlc.html

1 <!
DOCTYPE
 
	ghtml
>

2 <
	ghtml
>

3 <
	gh—d
>

4 <
	gt™Ë
>
	gSRS
</title>

5 <
m‘a
 
	gch¬£t
="utf-8">

6 <
lšk
 
»l
="¡yËsh“t" 
ty³
="‹xt/css" 
h»f
="css/bootstrap.min.css"/>

7 <
¡yË
>

8 
body
{

9 
·ddšg
-
tİ
: 55
px
;

11 </
	g¡yË
>

12 </
	gh—d
>

13 <
	gbody
>

14 <
div
 
	gşass
="navbar‚avbar-fixed-top">

15 <
div
 
şass
="navbar-inner">

16 <
div
 
şass
="container">

17 <
a
 
id
="¤s_šdex" 
şass
="b¿nd" 
h»f
="#">
SRS
</a>

18 <
div
 
şass
="nav-collapse collapse">

19 <
ul
 
şass
="nav">

20 <
li
><
a
 
id
="Çv_¤s_¶ay”" 
h»f
="¤s_¶ay”.html">
SRS
æ’­æ”¾å™¨</a></li>

21 <
li
><
a
 
id
="Çv_¤s_publish”" 
h»f
="¤s_publish”.html">
SRS
ç¼–ç å™¨</a></li>

22 <
li
><
a
 
id
="Çv_¤s_ch©" 
h»f
="¤s_ch©.html">
SRS
ä¼šè®®</a></li>

23 <
li
><
a
 
id
="Çv_¤s_bwt" 
h»f
="¤s_bwt.html">
SRS
æµ‹ç½‘é€Ÿ</a></li>

24 <
li
><
a
 
id
="Çv_jw¶ay”6" 
h»f
="jw¶ay”6.html">
JWPÏy”6
æ’­æ”¾å™¨</a></li>

25 <
li
><
a
 
id
="Çv_osmf" 
h»f
="osmf.html">
AdobeOSMF
æ’­æ”¾å™¨</a></li>

26 <
li
 
şass
="aùive"><
a
 
id
="Çv_vlc" 
h»f
="vlc.html">
VLC
æ’­æ”¾å™¨</a></li>

27 </
ul
>

28 </
div
>

29 </
div
>

30 </
div
>

31 </
div
>

32 <
div
 
şass
="container">

33 <
iäame
 
id
="maš_äame" 
width
="100%" 
height
="600" 
äameBÜd”
="0"></iframe>

34 </
div
>

35 <
div
 
şass
="container">

36 <
hr
>

37 <
foÙ”
>

38 <
p
><
a
 
h»f
="h‰ps://g™hub.com/os¤s/¤s">
SRS
 
T—m
 &
cİy
; 2013</
	ga
></
	gp
>

39 </
	gfoÙ”
>

40 </
	gdiv
>

41 </
	gbody
>

42 <
süt
 
	gty³
="‹xt/javasüt" 
¤c
="js/jquery-1.10.2.min.js"></script>

43 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="js/bootstrap.min.js"></script>

44 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="js/swfobject.js"></script>

45 <
süt
 
ty³
="‹xt/javasüt" 
¤c
="js/srs.page.js"></script>

46 <
süt
 
ty³
="text/javascript">

47 
$
(
	$funùiÚ
(){

48 
	`upd©e_Çv
();

49 
	`$
("#maš_äame").
	`©Œ
("src", "http://www.videolan.org/vlc/");

50 
	}
});

51 </
	gsüt
>

52 </
	ghtml
>

	@trunk/research/python-subprocess/main.py

1 #!/
u¤
/
bš
/
pythÚ


2 #-*- 
codšg
: 
utf
-8 -*-

4 
impÜt
 
	gsys
, 
	gshËx
, 
	gtime
, 
sub´oûss


6 
	gcmd
 = "./python.subprocess 0 80000"

7 
¬gs
 = 
shËx
.
¥l™
(
	$¡r
(
cmd
))

8 
´št
 "cmd: %s,‡rgs: %s"%(
cmd
, 
¬gs
)

10 #th
communiÿ‹
 
wl
 
»ad
 
®l
 
d©a
 
ªd
 
wa™
 
sub
 
´oûss
 
to
 
qu™
.

11 
def
 
	$u£_communiÿ‹
(
¬gs
, 
fout
, 
ã¼
):

12 
´oûss
 = 
sub´oûss
.
	$Pİ’
(
¬gs
, 
¡dout
=
fout
, 
¡d”r
=
ã¼
)

13 (
¡dout_¡r
, 
¡d”r_¡r
èğ
´oûss
.
	$communiÿ‹
()

14  (
¡dout_¡r
, 
¡d”r_¡r
)

16 #ià
u£
 
sub´oûss
.
PIPE
, 
the
 
pe
 
wl
 
fuÎ
 
about
 50
KB
 
d©a
,

17 #ªd 
sub
 
´oûss
 
wl
 
blocked
, 
th’
 
timeout
 wÈ
kl
 
™
.

18 
def
 
	$u£_pŞl
(
¬gs
, 
fout
, 
ã¼
, 
timeout
):

19 (
¡dout_¡r
, 
¡d”r_¡r
èğ(
NÚe
, None)

20 
´oûss
 = 
sub´oûss
.
	$Pİ’
(
¬gs
, 
¡dout
=
fout
, 
¡d”r
=
ã¼
)

21 
¡¬‰ime
 = 
time
.
	$time
()

22 
True
:

23 
´oûss
.
	$pŞl
()

24 
´oûss
.
»tuºcode
 
is
 
nÙ
 
NÚe
:

25 (
¡dout_¡r
, 
¡d”r_¡r
èğ
´oûss
.
	$communiÿ‹
()

27 
timeout
 > 0 
ªd
 
time
.
	`time
(è- 
¡¬‰ime
 >=imeout:

28 
´št
 "timeout, kÈ´oûss.imeout=%s"%(
timeout
)

29 
´oûss
.
	$kl
()

31 
time
.
	$¦“p
(1)

32 
´oûss
.
	$wa™
()

33  (
¡dout_¡r
, 
¡d”r_¡r
)

35 #¡dout/
¡d”r
 
ÿn
 
be
 
fd
, 
feobjeù
, 
sub´oûss
.
PIPE
, 
NÚe


36 
âuÎ
 = 
	`İ’
("/dev/null", "rw")

37 
fout
 = 
âuÎ
.
	$f’o
()#sub´oûss.
PIPE
#âuÎ#âuÎ.
	$f’o
()

38 
ã¼
 = 
âuÎ
.
	$f’o
()#sub´oûss.
PIPE
#âuÎ#âuÎ.
	$f’o
()

39 
´št
 "fout=%s, f”r=%s"%(
fout
, 
ã¼
)

40 #(
¡dout_¡r
, 
¡d”r_¡r
èğ
	`u£_communiÿ‹
(
¬gs
, 
fout
, 
ã¼
)

41 (
¡dout_¡r
, 
¡d”r_¡r
èğ
	$u£_pŞl
(
¬gs
, 
fout
, 
ã¼
, 10)

43 
def
 
	$´št_»suÉ
(
¡dout_¡r
, 
¡d”r_¡r
):

44 
¡dout_¡r
 
is
 
NÚe
:

45 
¡dout_¡r
 = ""

46 
¡d”r_¡r
 
is
 
NÚe
:

47 
¡d”r_¡r
 = ""

48 
´št
 "‹rmš©ed, sizoà¡dout=%s, std”r=%s"%(
	`Ën
(
¡dout_¡r
), 
	$Ën
(
¡d”r_¡r
))

49 
True
:

50 
time
.
	$¦“p
(1)

52 
	`´št_»suÉ
(
¡dout_¡r
, 
¡d”r_¡r
)

	@trunk/scripts/_log.sh

1 #impÜˆ
log
 
ut™y
 
ªd
 
check
 
the
 
d‘a
†og 
fe
 
is
 
ok


2 #@
·¿m
 
log
 
the
†og 
fe
 
·th
,  
to
 /
dev
/
nuÎ


4 #######################################
#cŞÜ 
echo
.

5 #######################################
="\\033[31m"

6 
	gGREEN
="\\033[32m"

7 
YELLOW
="\\033[33m"

8 
BLACK
="\\033[0m"

9 
POS
="\\033[94G"

11 #ià
Ãed
 
to
 
log
Ø
fe
, 
chªge
 
the
†og 
·th
.

12 [[ ! 
$log
 ]]; 
th’


13 
	glog
=/
dev
/
nuÎ
;

14 
fi


16 
	$ok_msg
(){

17 
echo
 -
e
 "${1}${POS}${BLACK}[${GREEN} OK ${BLACK}]"

19 #wr™
to
 
log
 
fe
.

20 
echo
 "[šfo] ${1}" >> 
$log


21 
	}
}

23 
	$w¬n_msg
(){

24 
echo
 -
e
 "${1}${POS}${BLACK}[ ${YELLOW}WARN${BLACK} ]"

26 #wr™
to
 
log
 
fe
.

27 
echo
 "[”rÜ] ${1}" >> 
$log


28 
	}
}

30 
	$çed_msg
(){

31 
echo
 -
e
 "${1}${POS}${BLACK}[${RED}FAILED${BLACK}]"

33 #wr™
to
 
log
 
fe
.

34 
echo
 "[”rÜ] ${1}" >> 
$log


35 
	}
}

37 
funùiÚ
 
	$check_log
(){

38 
log_dœ
="`dirname $log`"

39 (
mkdœ
 -
p
 
$
{
log_dœ
} && 
chmod
 777 ${log_dœ} && 
touch
 
$log
)

40 
»t
=
$
?; [[ 
$»t
 -
Ã
 0 ]]; 
th’
 
çed_msg
 "ü—‹†og faed,„‘=$»t";  $»t; 
fi


41 
ok_msg
 "create†og( ${log} ) success"

43 
echo
 "b¿vo-vm £tu°`d©e`" >> 
$log


44 
ok_msg
 "see detail†og:ailf ${log}"

47 
	}
}

	@trunk/scripts/build.sh

1 #!/
bš
/
bash


2 
	g¤c_dœ
='src'

3 [[ ! -
d
 
$¤c_dœ
 ]]; 
th’
 
	gecho
 "é”™è¯¯ï¼šå¿…é¡»åœ¨¤cåŒç›®å½•æ‰§è¡Œè„šæœ¬"; 
	gex™
 1; 
	gfi


5 #¡• 1: 
bud
 
¤s


6 #ngšx 
is
 
nÙ
 
Ãeded
, 
we
 
u£
 
ch”rypy
 
to
 
d–iv”y
 
hls
.

7 #demØ
Ãeds
 
ffm³g
 
to
 
Œªscode
 
the
 
live
 
¡»am
.

8 
	gecho
 "ç¼–è¯‘SRS"

9 ./
	gcÚfigu»
 --
	gdemo
 && 
make


10 
	g»t
=
$
?; [[ 0 -
Ã
 
$»t
 ]]; 
th’
 
	gecho
 "é”™è¯¯ï¼šç¼–è¯‘SRSå¤±è´¥"; 
ex™
 
	g$»t
; 
fi


12 
	gecho
 "ç¼–è¯‘SRSæˆåŠŸ"

13 
	gecho
 "ä½ å¯ä»¥å¯åŠ¨SRSï¼š"

14 
	gecho
 " bash scripts/run.sh"

	@trunk/scripts/git.commit.sh

1 #!/
bš
/
bash


3 
	gÿt
 <<
	gEND
 >>/
	gdev
/
nuÎ


4 
touch
 
	gg™
-
	g’su»
-
	gcomm™
 &&

5 
	gecho
 "cd `pwd` &&" >
	gg™
-
	g’su»
-
	gcomm™
 &&

6 
	gecho
 "bash `pwd`/g™.comm™.sh" >>
	gg™
-
	g’su»
-
	gcomm™
 &&

7 
	gchmod
 +
x
 
	gg™
-
	g’su»
-
	gcomm™
 &&

8 
sudo
 
	grm
 -
	gf
 /
	gbš
/
	gg™
-
	g’su»
-
	gcomm™
 &&

9 
sudo
 
mv
 
	gg™
-
	g’su»
-
	gcomm™
 /
	gu¤
/
	gloÿl
/
	gbš
/g™-’su»-
comm™


10 
END


12 
	gecho
 "submit codeo github.com"

14 
	gecho
 "argv[0]=$0"

15 [[ ! -
f
 
$0
 ]]; 
th’


16 
	gecho
 "directlyƒxecutehe scripts on shell.";

17 
	gwÜk_dœ
=`
pwd
`

19 
echo
 "execute scripts in file: $0";

20 
	gwÜk_dœ
=`
dœÇme
 
$0
`; wÜk_dœ=`(
cd
 
$
{
wÜk_dœ
} && 
pwd
)`

21 
fi


22 
wÜk_dœ
=`(
cd
 
$
{wÜk_dœ}/.. && 
pwd
)`

23 
´oduù_dœ
=
$wÜk_dœ


25 #®low 
¡¬t
 
süt
 
äom
 
ªy
 
dœ


26 
cd
 
$wÜk_dœ
 && 
wÜk_b¿nch
=`
g™
 
b¿nch
|
g»p
 "*"|
awk
 '{´šˆ$2}'` && 
comm™_b¿nch
=2.0
»Ëa£
 && g™ 
checkout
 
$comm™_b¿nch


27 
»t
=
$»t
; [[ $»ˆ-
Ã
 0 ]]; 
th’
 
	gecho
 "sw™ch b¿nch faed.„‘=$»t"; 
ex™
 
	g$»t
; 
fi


28 
	gecho
 "work branch is $work_branch"

29 
	gecho
 "commit branch is $commit_branch"

31 . 
	g$
{
	g´oduù_dœ
}/
	gsüts
/
	g_log
.
sh


32 
	g»t
=
$
?; [[ 
$»t
 -
Ã
 0 ]]; 
th’
 
ex™
 
	g$»t
; 
fi


33 
	gok_msg
 "å¯¼å…¥è„šæœ¬æˆåŠŸ"

35 
funùiÚ
 
	$»mÙe_check
()

37 
»mÙe
=
$1


38 
u¾
=
$2


39 
g™
 
»mÙe
 -
v
| 
g»p
 "$u¾" >/
dev
/
nuÎ
 2>&1

40 
»t
=
$
?; [[ 0 -
Ã
 
$»t
 ]]; 
th’


41 
echo
 "remote $remote‚ot found,‡dd by:"

42 
echo
 " git„emote‡dd $remote $url"

43 
ex™
 -1

44 
fi


45 
ok_msg
 "remote $remote ok, url is $url"

46 
	}
}

47 
»mÙe_check
 
Üigš
 
	gg™
@
	gg™hub
.
	gcom
:
os¤s
/
¤s
.
g™


48 
»mÙe_check
 
¤s
.
wšlš
 
g™
@
g™hub
.
com
:
wšlšv
/
sim¶e
-
¹mp
-
£rv”
.git

49 
»mÙe_check
 
¤s
.
csdn
 
g™
@
code
.csdn.
Ãt
:
wšlšv
/srs-csdn.git

50 
»mÙe_check
 
¤s
.
oschša
 
g™
@g™.oschša.
Ãt
:
wšlšv
/srs.oschina.git

51 
»mÙe_check
 
¤s
.
g™Ïb
 
g™
@g™Ïb.
com
:
wšlšv
/srs-gitlab.git

52 
ok_msg
 "remote check ok"

54 
funùiÚ
 
	$sync_push
()

57 
g™
 
push
 
$
*

58 
»t
=
$
?; [[ 0 -
Ã
 
$»t
 ]]; 
th’


59 
çed_msg
 "Retry for failed: git…ush $*"

60 
¦“p
 3

63 
ok_msg
 "Success: git…ush $*"

64 
fi


66 
dÚe


67 
	}
}

69 
sync_push
 
Üigš


70 
sync_push
 
	g¤s
.
wšlš


71 
sync_push
 
	g¤s
.
csdn


72 
sync_push
 
	g¤s
.
oschša


73 
sync_push
 
	g¤s
.
g™Ïb


74 
	gok_msg
 "push branches ok"

76 
	gsync_push
 --
gs
 
	g¤s
.
wšlš


77 
	gsync_push
 --
gs
 
	g¤s
.
csdn


78 
	gsync_push
 --
gs
 
	g¤s
.
oschša


79 
	gsync_push
 --
gs
 
	g¤s
.
g™Ïb


80 
	gok_msg
 "pushags ok"

82 
g™
 
checkout
 
$wÜk_b¿nch


83 
	gok_msg
 "switcho work branch $work_branch"

85 
	gex™
 0

	@trunk/scripts/git2unix.sh

1 #!/
bš
/
bash


3 
	gÿt
 <<
	gEND
 >>/
	gdev
/
nuÎ


4 
touch
 
	gg™2unix
 &&

5 
	gecho
 "bash `pwd`/g™2unix.sh" >
	gg™2unix
 &&

6 
	gchmod
 +
x
 
	gg™2unix
 &&

7 
sudo
 
	grm
 -
	gf
 /
	gbš
/
	gg™2unix
 &&

8 
sudo
 
mv
 
	gg™2unix
 /
	gbš
/
g™2unix


9 
END


11 
	gdos2unix
 -
	gV
>/
	gdev
/
	gnuÎ
 2>&1

12 
	g»t
=
$
?; [[ 0 -
Ã
 
$»t
 ]]; 
th’


13 
	gecho
 "dos2unix‚ot found."

14 
	gecho
 " sudo yum install -y dos2unix"

15 
ex™
 
$»t


16 
fi


18 
	gfes
=`
g™
 
¡©us
|
eg»p
 "(modif›d|Ãw fe)"|
awk
 -
F
 ':' '{print $2}'|awk '{print $1}'|egrep "(.hpp$|.cpp$|.cc$|.h$|.c$|.txt$|.sh|.conf$)"`;

19 
fe
 
š
 
	g$fes
; do

20 
dos2unix
 
	g$fe
;

21 
echo
 
	g$fe
|
	gg»p
 ".sh$" >/
	gdev
/
	gnuÎ
 2>&1; 
	gEOF_SH
=
$
?

22 [[ 
$EOF_SH
 -
Ã
 0 && -
f
 
$fe
 ]]; 
th’


23 
	gecho
 "chmod -x $file"

24 
	gchmod
 -
x
 
	g$fe
;

25 
fi


26 
	gdÚe


	@trunk/scripts/install.sh

1 #!/
bš
/
bash


3 #u£¸
ÿn
 
cÚfig
 
the
 
fŞlowšg
 
cÚfigs
, 
th’
 
·ckage
.

4 
	gINSTALL
=/
u¤
/
loÿl
/
¤s


9 #discov” 
the
 
cu¼’t
 
wÜk
 
dœ
,h
log
 
ªd
 
acûss
.

10 
	gecho
 "argv[0]=$0"

11 [[ ! -
f
 
$0
 ]]; 
th’


12 
	gecho
 "directlyƒxecutehe scripts on shell.";

13 
	gwÜk_dœ
=`
pwd
`

15 
echo
 "execute scripts in file: $0";

16 
	gwÜk_dœ
=`
dœÇme
 
$0
`; wÜk_dœ=`(
cd
 
$
{
wÜk_dœ
} && 
pwd
)`

17 
fi


18 
´oduù_dœ
=
$wÜk_dœ


20 
log
="${wÜk_dœ}/logs/·ckage.`d©+%s`.log" && . 
$
{
´oduù_dœ
}/
süts
/
_log
.
sh
 && 
check_log


21 
»t
=
$
?; [[ 
$»t
 -
Ã
 0 ]]; 
th’
 
ex™
 
	g$»t
; 
	gfi


23 #u£¸
mu¡
 
¡İ
 
£rviû
 
fœ¡
.

24 
	gok_msg
 "check…revious install"

25 [[ -
f
 /
‘c
/
š™
.
d
/
¤s
 ]]; 
	gth’


26 /
	g‘c
/
	gš™
.
	gd
/
¤s
 
	g¡©us
 >/
	gdev
/
	gnuÎ
 2>&1

27 
	g»t
=
$
?; [[ 0 -
eq
 ${
»t
} ]]; 
th’


28 
	gçed_msg
 "you must stophe service first: sudo /etc/init.d/srs stop";

29 
	gex™
 1;

30 
fi


31 
fi


32 
	gok_msg
 "previous install checked"

34 #backu°
Şd
 
¤s


35 
	gok_msg
 "backup old srs"

36 
	gš¡®l_roÙ
=
$INSTALL


37 
š¡®l_bš
=
$š¡®l_roÙ
/
objs
/
¤s


38 [[ -
d
 
$š¡®l_roÙ
 ]]; 
th’


39 
	gv”siÚ
="unknown"

40 [[ -
f
 
$š¡®l_bš
 ]]; 
th’


41 
	gv”siÚ
=`
$š¡®l_bš
 -
v
 2>/
dev
/
¡dout
 1>/dev/
nuÎ
`

42 
fi


44 
backup_dœ
=
$
{
š¡®l_roÙ
}.`
d©e
 "+%Y-%m-%d_%H-%M-%S"`.
v
-
$v”siÚ


45 
ok_msg
 "backup installed dir, version=$version"

46 
ok_msg
 "o=$backup_dir"

47 
mv
 
$š¡®l_roÙ
 
$backup_dœ
 >>
$log
 2>&1

48 
»t
=
$
?; [[ 0 -
Ã
 ${»t} ]]; 
th’
 
	gçed_msg
 "backu°š¡®Ëd dœ faed"; 
ex™
 
	g$»t
; 
fi


49 
	gok_msg
 "backup installed dir success"

50 
fi


51 
	gok_msg
 "old srs backuped"

53 #´•¬
fes
.

54 
	gok_msg
 "prepare files"

56 
	g£d
 -
	gi
 "s|^ROOT=.*|ROOT=\"${INSTALL}\"|g" 
	g$wÜk_dœ
/
	g$
{
	gINSTALL
}/
	g‘c
/
	gš™
.
	gd
/
	g¤s


57 è>> 
	g$log
 2>&1

58 
	g»t
=
$
?; [[ 0 -
Ã
 ${
»t
} ]]; 
th’
 
	gçed_msg
 "´•¬fe çed"; 
ex™
 
	g$»t
; 
fi


59 
	gok_msg
 "prepare files success"

61 #cİy 
cÜe
 
fes


62 
	gok_msg
 "copy core components"

64 
	gmkdœ
 -
p
 
$š¡®l_roÙ


65 
	gı
 -
r
 
	g$wÜk_dœ
/
	g$
{
	gINSTALL
}/
cÚf
 
	g$š¡®l_roÙ
 &&

66 
	gı
 -
r
 
	g$wÜk_dœ
/
	g$
{
	gINSTALL
}/
‘c
 
	g$š¡®l_roÙ
 &&

67 
	gı
 -
r
 
	g$wÜk_dœ
/
	g$
{
	gINSTALL
}/
objs
 
	g$š¡®l_roÙ


68 è>>
	g$log
 2>&1

69 
	g»t
=
$
?; [[ 0 -
Ã
 ${
»t
} ]]; 
th’
 
	gçed_msg
 "cİy cÜcompÚ’t çed"; 
ex™
 
	g$»t
; 
fi


70 
	gok_msg
 "copy core components success"

72 #š¡®È
š™
.
d
 
süts


73 
	gok_msg
 "install init.d scripts"

75 
	grm
 -
	grf
 /
	g‘c
/
	gš™
.
	gd
/
	g¤s
 &&

76 
	gÊ
 -
sf
 
	g$š¡®l_roÙ
/
	g‘c
/
	gš™
.
	gd
/
	g¤s
 /etc/init.d/srs

77 è>>
	g$log
 2>&1

78 
	g»t
=
$
?; [[ 0 -
Ã
 ${
»t
} ]]; 
th’
 
	gçed_msg
 "š¡®Èš™.d süt çed"; 
ex™
 
	g$»t
; 
fi


79 
	gok_msg
 "install init.d scripts success"

81 #š¡®È
sy¡em
 
£rviû


82 
	glsb_»Ëa£
 --
	gid
|
	gg»p
 "C’tOS" >/
	gdev
/
	gnuÎ
 2>&1; 
	gos_id_ûÁos
=
$
?

83 
lsb_»Ëa£
 --
id
|
g»p
 "UbuÁu" >/
dev
/
nuÎ
 2>&1; 
	gos_id_ubuÁu
=
$
?

84 
lsb_»Ëa£
 --
id
|
g»p
 "DebŸn" >/
dev
/
nuÎ
 2>&1; 
	gos_id_debŸn
=
$
?

85 
lsb_»Ëa£
 --
id
|
g»p
 "Ra¥bŸn" >/
dev
/
nuÎ
 2>&1; 
	gos_id_¿§bŸn
=
$
?

86 [[ 0 -
eq
 
$os_id_ûÁos
 ]]; 
th’


87 
	gok_msg
 "install system service for CentOS"

88 /
	gsbš
/
	gchkcÚfig
 --
add
 
	g¤s
 && /sbš/
chkcÚfig
 
¤s
 
Ú


89 
	g»t
=
$
?; [[ 0 -
Ã
 ${
»t
} ]]; 
th’
 
	gçed_msg
 "š¡®Èsy¡em s”viû faed"; 
ex™
 
	g$»t
; 
fi


90 
	gok_msg
 "install system service success"

91 
	g–if
 [[ 0 -
eq
 
$os_id_ubuÁu
 ]]; 
th’


92 
	gok_msg
 "install system service for Ubuntu"

93 
	gupd©e
-
	grc
.
d
 
¤s
 
deçuÉs


94 
	g»t
=
$
?; [[ 0 -
Ã
 ${
»t
} ]]; 
th’
 
	gçed_msg
 "š¡®Èsy¡em s”viû faed"; 
ex™
 
	g$»t
; 
fi


95 
	gok_msg
 "install system service success"

96 
	g–if
 [[ 0 -
eq
 
$os_id_debŸn
 ]]; 
th’


97 
	gok_msg
 "install system service for Debian"

98 
	gupd©e
-
	grc
.
d
 
¤s
 
deçuÉs


99 
	g»t
=
$
?; [[ 0 -
Ã
 ${
»t
} ]]; 
th’
 
	gçed_msg
 "š¡®Èsy¡em s”viû faed"; 
ex™
 
	g$»t
; 
fi


100 
	gok_msg
 "install system service success"

101 
	g–if
 [[ 0 -
eq
 
$os_id_¿§bŸn
 ]]; 
th’


102 
	gok_msg
 "install system service for RaspberryPi"

103 
	gupd©e
-
	grc
.
d
 
¤s
 
deçuÉs


104 
	g»t
=
$
?; [[ 0 -
Ã
 ${
»t
} ]]; 
th’
 
	gçed_msg
 "š¡®Èsy¡em s”viû faed"; 
ex™
 
	g$»t
; 
fi


105 
	gok_msg
 "install system service success"

107 
	gw¬n_msg
 "ignore‡nd donot install system service for `lsb_release --id|awk '{print $3}'`."

108 
fi


110 
	gecho
 ""

111 
	gecho
 "see: https://github.com/ossrs/srs/wiki/v1_CN_LinuxService"

112 
	gecho
 "install success, you can:"

113 
	gecho
 -
	ge
 "${GREEN} sudo /etc/init.d/srs start${BLACK}"

114 
	gecho
 "srs„oot is ${INSTALL}"

116 
	gex™
 0

	@trunk/scripts/package.sh

1 #!/
bš
/
bash


3 
	gecho
 "é€šç”¨æ‰“åŒ…è„šæœ¬ï¼Œ--helpæŸ¥çœ‹å‚æ•°"

6 #bash 
·ckage
.
sh
 [--
h–p
]

7 #İtiÚ 
¬m
, 
wh‘h”
 
bud
 ¬m, 
»quœes
 
ubuÁu12
.

9 #u£¸
ÿn
 
cÚfig
 
the
 
fŞlowšg
 
cÚfigs
, 
th’
 
·ckage
.

10 
	gINSTALL
=/
u¤
/
loÿl
/
¤s


11 #wh‘h” 
bud
 
¬m
, 
Úly
 
ubuÁu12
.

12 
	gh–p
=
NO


13 
X86_X64
=
NO


14 
ARM
=
NO


15 
PI
=
NO


16 
MIPS
=
NO


17 #
=NO

22 #·r£ 
İtiÚs
.

23 
İtiÚ


25 "$İtiÚ" 
š


27 
v®ue
=`
echo
 "$İtiÚ" | 
£d
 -
e
 's|[-_a-zA-Z0-9/]*=||'`

28 
İtiÚ
=`
echo
 "$İtiÚ" | 
£d
 -
e
 's|=[-_a-zA-Z0-9/]*||'`

30 *è
	gv®ue
="" ;;

31 
e§c


33 "$İtiÚ" 
	gš


34 --
	gh–p
èh–p=
yes
 ;;

36 --
	gx86
-
	gx64
è
	gX86_X64
=
YES
 ;;

37 --
	gms
è
	gMIPS
=
YES
 ;;

38 --
	g¬m
è
	gARM
=
YES
 ;;

39 --
	gpi
è
	gPI
=
YES
 ;;

42 
	gecho
 "$0:ƒrror: invalid option \"$option\", @see $0 --help"

43 
	gex™
 1

45 
e§c


46 
dÚe


47 [ 
$h–p
 = 
yes
 ]; 
th’


48 
	gÿt
 << 
	gEND


50 --
h–p
 
´št
 
this
 
	gmes§ge


52 --
	gx86
-
x64
 x86-x64 
	g¶©fÜm
, 
	gcÚfigu»
/
	gmake
/
	g·ckage
.

53 --
¬m
 ¬m 
	güoss
-
bud
 
	g¶©fÜm
, 
	gcÚfigu»
/
	gmake
/
	g·ckage
.

54 --
ms
 m 
	güoss
-
bud
 
	g¶©fÜm
, 
	gcÚfigu»
/
	gmake
/
	g·ckage
.

55 --
pi
 p˜
	g¶©fÜm
, 
	gcÚfigu»
/
	gmake
/
	g·ckage
.

56 
END


57 
	gex™
 0

58 
	gfi


60 #embeded(
¬m
/
ms
)

61 [ 
$ARM
 = 
YES
 ]; 
th’
 
	gEMBEDED
=YES; 
fi


62 [ 
$MIPS
 = 
YES
 ]; 
th’
 
	gEMBEDED
=YES; 
	gfi


64 #discov” 
the
 
cu¼’t
 
wÜk
 
dœ
,h
log
 
ªd
 
acûss
.

65 
	gecho
 "argv[0]=$0"

66 [[ ! -
f
 
$0
 ]]; 
th’


67 
	gecho
 "directlyƒxecutehe scripts on shell.";

68 
	gwÜk_dœ
=`
pwd
`

70 
echo
 "execute scripts in file: $0";

71 
	gwÜk_dœ
=`
dœÇme
 
$0
`; wÜk_dœ=`(
cd
 
$
{
wÜk_dœ
} && 
pwd
)`

72 
fi


73 
wÜk_dœ
=`(
cd
 
$
{wÜk_dœ}/.. && 
pwd
)`

74 
´oduù_dœ
=
$wÜk_dœ


75 
bud_objs
=
$
{
wÜk_dœ
}/
objs


76 
·ckage_dœ
=
$
{
bud_objs
}/
·ckage


78 
log
="${bud_objs}/logs/·ckage.`d©+%s`.log" && . 
$
{
´oduù_dœ
}/
süts
/
_log
.
sh
 && 
check_log


79 
»t
=
$
?; [[ 
$»t
 -
Ã
 0 ]]; 
th’
 
ex™
 
	g$»t
; 
	gfi


81 #check 
lsb_»Ëa£


82 
	glsb_»Ëa£
 -
	ga
 >/
	gdev
/
	gnuÎ
 2>&1

83 
	g»t
=
$
?; [[ 
$»t
 -
Ã
 0 ]]; 
th’


84 
	gçed_msg
 "lsb_release‚ot found. "

85 
	gçed_msg
 "to install on centos/debian(ubuntu/respberry-pi):";

86 
	gçed_msg
 " sudo yum install -y†sb-release";

87 
	gçed_msg
 " sudo‡ptitude install -y†sb-release";

88 
ex™
 
	g$»t
;

89 
	gfi


91 #check 
os
 
v”siÚ


92 
	gos_Çme
=`
lsb_»Ëa£
 --
id
|
awk
 '{print $3}'` &&

93 
os_»Ëa£
=`
lsb_»Ëa£
 --
»Ëa£
|
awk
 '{print $2}'` &&

94 
os_majÜ_v”siÚ
=`
echo
 
$os_»Ëa£
|
awk
 -
F
 '.' '{print $1}'` &&

95 
os_machše
=`
uÇme
 -
i
`

96 
»t
=
$
?; [[ 
$»t
 -
Ã
 0 ]]; 
th’
 
	gçed_msg
 "lsb_»Ëa£ g‘ o šfØçed."; 
ex™
 
	g$»t
; 
fi


97 
	gok_msg
 "target os is ${os_name}-${os_major_version} ${os_release} ${os_machine}"

99 #fÜ 
¿¥b”ry
-
pi


100 #u£ 
¿sb”ry
-
pi
 
š¡—d
 
®l
 
»Ëa£


101 [ 
$PI
 = 
YES
 ]; 
th’


102 
	guÇme
 -
	ga
|
	gg»p
 "¿¥b”rypi"; [[ 0 -
eq
 
$
? ]]; 
th’
 
	gos_Çme
="Ra¥b”ryPi"; 
fi


103 [[ "Ra¥bŸn" =ğ
$os_Çme
 ]]; 
th’
 
	gos_Çme
="Ra¥b”ryPi"; 
	gfi


104 #check 
the
 
ıu
 
machše


105 [[ "unknown" =ğ
$os_machše
 ]]; 
th’
 
	gos_machše
=`
uÇme
 -
m
`; 
fi


106 
fi


107 
	gok_msg
 "real os is ${os_name}-${os_major_version} ${os_release} ${os_machine}"

109 #bud 
¤s


110 #@
£e
 
h‰ps
:

111 
	gok_msg
 "start build srs"

112 [ 
$ARM
 = 
YES
 ]; 
	gth’


114 
cd
 
	g$wÜk_dœ
 &&

115 ./
	gcÚfigu»
 --
	g¬m
 --
	g´efix
=
$INSTALL
 && 
make


116 è>> 
$log
 2>&1

117 
–if
 [ 
$MIPS
 = 
YES
 ]; 
	gth’


119 
cd
 
	g$wÜk_dœ
 &&

120 ./
	gcÚfigu»
 --
	gms
 --
	g´efix
=
$INSTALL
 && 
make


121 è>> 
$log
 2>&1

122 
–if
 [ 
$PI
 = 
YES
 ]; 
	gth’


124 
cd
 
	g$wÜk_dœ
 &&

125 ./
	gcÚfigu»
 --
	gpi
 --
	g´efix
=
$INSTALL
 && 
make


126 è>> 
$log
 2>&1

127 
–if
 [ 
$X86_X64
 = 
YES
 ]; 
	gth’


129 
cd
 
	g$wÜk_dœ
 &&

130 ./
	gcÚfigu»
 --
	gx86
-
	gx64
 --
	g´efix
=
$INSTALL
 && 
make


131 è>> 
$log
 2>&1

133 
çed_msg
 "šv®id o±iÚ, mu¡ b--x86-x64/--¬m/--ms/--pi, s“ --h–p"; 
	gex™
 1;

134 
fi


135 
	g»t
=
$
?; [[ 0 -
Ã
 ${
»t
} ]]; 
th’
 
	gçed_msg
 "bud sr çed"; 
ex™
 
	g$»t
; 
fi


136 
	gok_msg
 "build srs success"

138 #š¡®È
¤s


139 
	gok_msg
 "start install srs"

141 
cd
 
	g$wÜk_dœ
 && 
	grm
 -
rf
 
	g$·ckage_dœ
 && 
make
 
	gDESTDIR
=
$·ckage_dœ
 
š¡®l


142 è>> 
$log
 2>&1

143 
»t
=
$
?; [[ 0 -
Ã
 ${»t} ]]; 
th’
 
	gçed_msg
 "š¡®È¤ çed"; 
ex™
 
	g$»t
; 
fi


144 
	gok_msg
 "install srs success"

146 #cİy 
exŒa
 
fes
 
to
 
·ckage
.

147 
	gok_msg
 "start copyƒxtra fileso…ackage"

149 
ı
 
	g$wÜk_dœ
/
	gsüts
/
	gš¡®l
.
sh
 
	g$·ckage_dœ
/
	gINSTALL
 &&

150 
	g£d
 -
	gi
 "s|^INSTALL=.*|INSTALL=${INSTALL}|g" 
	g$·ckage_dœ
/
	gINSTALL
 &&

151 
	gmkdœ
 -
p
 
	g$·ckage_dœ
/
	gsüts
 &&

152 
ı
 
	g$wÜk_dœ
/
	gsüts
/
	g_log
.
sh
 
	g$·ckage_dœ
/süts/_log.
	gsh
 &&

153 
	gchmod
 +
x
 
	g$·ckage_dœ
/
	gINSTALL


154 è>> 
	g$log
 2>&1

155 
	g»t
=
$
?; [[ 0 -
Ã
 ${
»t
} ]]; 
th’
 
	gçed_msg
 "cİyƒxŒ¨fe çed"; 
ex™
 
	g$»t
; 
fi


156 
	gok_msg
 "copyƒxtra files success"

158 #d‘eù 
¬m
.

159 [ 
$ARM
 = 
YES
 ]; 
th’


160 
	g¬m_ıu
=`
¬m
-
lšux
-
gnu—bi
-
»ad–f
 --
¬ch
-
¥ecific
 
$
{
bud_objs
}/
¤s
|
g»p
 
Tag_CPU_¬ch
:|
awk
 '{print $2}'`

161 
os_machše
=
¬m$
{
¬m_ıu
}
ıu


162 
fi


163 [ 
$MIPS
 = 
YES
 ]; 
th’


164 
	gos_machše
=
ms


165 
fi


166 
ok_msg
 "machine: $os_machine"

168 #g’”©
z
 
dœ
 
ªd
 z 
f’ame


169 [ 
$EMBEDED
 = 
YES
 ]; 
th’


170 
	g¤s_v”siÚ_majÜ
=`
ÿt
 
$wÜk_dœ
/
¤c
/
cÜe
/
¤s_cÜe
.
hµ
| 
g»p
 '#defšVERSION_MAJOR'| 
awk
 '{´šˆ$3}'|
x¬gs
 
echo
` &&

171 
¤s_v”siÚ_mšÜ
=`
ÿt
 
$wÜk_dœ
/
¤c
/
cÜe
/
¤s_cÜe
.
hµ
| 
g»p
 '#defšVERSION_MINOR'| 
awk
 '{´šˆ$3}'|
x¬gs
 
echo
` &&

172 
¤s_v”siÚ_»visiÚ
=`
ÿt
 
$wÜk_dœ
/
¤c
/
cÜe
/
¤s_cÜe
.
hµ
| 
g»p
 '#defšVERSION_REVISION'| 
awk
 '{´šˆ$3}'|
x¬gs
 
echo
` &&

173 
¤s_v”siÚ
=
$¤s_v”siÚ_majÜ
.
$¤s_v”siÚ_mšÜ
.
$¤s_v”siÚ_»visiÚ


175 
¤s_v”siÚ
=`
$
{
bud_objs
}/
¤s
 -
v
 2>/
dev
/
¡dout
 1>/dev/
nuÎ
`

176 
fi


177 
»t
=
$
?; [[ 0 -
Ã
 ${»t} ]]; 
th’
 
	gçed_msg
 "g‘ sr v”siÚ faed"; 
ex™
 
	g$»t
; 
fi


178 
	gok_msg
 "get srs version $srs_version"

180 
	gz_dœ
="SRS-${os_name}${os_major_version}-${os_machine}-${srs_version}"

181 
»t
=
$
?; [[ 0 -
Ã
 ${»t} ]]; 
th’
 
	gçed_msg
 "g’”©z f’amçed"; 
ex™
 
	g$»t
; 
fi


182 
	gok_msg
 "target zip filename $zip_dir"

184 #z 
·ckage
.

185 
	gok_msg
 "start zip…ackage"

187 
mv
 
$·ckage_dœ
 
	g$
{
	gbud_objs
}/${
	gz_dœ
} &&

188 
cd
 
	g$
{
	gbud_objs
} && 
	grm
 -
rf
 ${
	gz_dœ
}.
	gz
 && z -
	gq
 -
r
 ${z_dœ}.
z
 ${zip_dir} &&

189 
mv
 
	g$
{
	gbud_objs
}/${
	gz_dœ
} 
	g$·ckage_dœ


190 è>> 
	g$log
 2>&1

191 
	g»t
=
$
?; [[ 0 -
Ã
 ${
»t
} ]]; 
th’
 
	gçed_msg
 "z…ackagçed"; 
ex™
 
	g$»t
; 
fi


192 
	gok_msg
 "zip…ackage success"

194 
	gok_msg
 "srs…ackage success"

195 
	gecho
 ""

196 
	gecho
 "package: ${build_objs}/${zip_dir}.zip"

197 
	gecho
 "install:"

198 
	gecho
 " unzip -q ${zip_dir}.zip &&"

199 
	gecho
 " cd ${zip_dir} &&"

200 
	gecho
 " sudo bash INSTALL"

202 
	gex™
 0

	@trunk/scripts/run.sh

1 #!/
bš
/
bash


2 
	g¤c_dœ
='src'

3 [[ ! -
d
 
$¤c_dœ
 ]]; 
th’
 
	gecho
 "é”™è¯¯ï¼šå¿…é¡»åœ¨¤cåŒç›®å½•æ‰§è¡Œè„šæœ¬"; 
	gex™
 1; 
	gfi


5 #lšux 
sh–l
 
cŞÜ
 
suµÜt
.

6 
	gRED
="\\033[31m"

7 
GREEN
="\\033[32m"

8 
YELLOW
="\\033[33m"

9 
BLACK
="\\033[0m"

11 ./
‘c
/
š™
.
d
/
¤s
-
demo
 
»¡¬t
; 
	g»t
=
$
?; [[ 0 -
Ã
 
$»t
 ]]; 
th’
 
	gecho
 "é”™è¯¯ï¼šå¯åŠ¨SRSå¤±è´¥"; 
ex™
 
	g$»t
; 
fi


12 
	gecho
 "å¯åŠ¨SRSæœåŠ¡å™¨æˆåŠŸ"

14 ./
	g‘c
/
	gš™
.
	gd
/
	g¤s
-
	gdemo
-19350 
	g»¡¬t
; 
	g»t
=
$
?; [[ 0 -
Ã
 
$»t
 ]]; 
th’
 
	gecho
 "é”™è¯¯ï¼šå¯åŠ¨SRSè½¬å‘æœåŠ¡å™¨å¤±è´¥"; 
ex™
 
	g$»t
; 
fi


15 
	gecho
 "å¯åŠ¨SRSè½¬å‘æœåŠ¡å™¨æˆåŠŸ"

17 ./
	g‘c
/
	gš™
.
	gd
/
	g¤s
-
­i
 
	g»¡¬t
; 
	g»t
=
$
?; [[ 0 -
Ã
 
$»t
 ]]; 
th’
 
	gecho
 "é”™è¯¯ï¼šå¯åŠ¨APIæœåŠ¡å™¨å¤±è´¥"; 
ex™
 
	g$»t
; 
fi


18 
	gecho
 "å¯åŠ¨APIæœåŠ¡å™¨æˆåŠŸ"

20 
	g
=`
ifcÚfig
|
g»p
 "š‘ "|g»°-
v
 "127.0.0.1"|
awk
 -
F
 'š‘ ' 'NR==1 {´šˆ$2}'|awk '{´šˆ$1}'|
£d
 "s/addr://g"`

21 
pÜt
=8085

22 
ÿt
<<
END


24 
h‰p
:

26 
h‰p
:

28 
h‰p
:

30 
h‰p
:

32 
h‰p
:

33 
END


35 
which
 
g‘’fÜû
 >/
dev
/
nuÎ
 2>&1

36 [[ 0 -
eq
 
$
? && `
g‘’fÜû
` !ğ'Di§bËd' ]]; 
th’


37 
	gecho
 -
	ge
 "${RED}è¯·å…³é—­selinuxï¼š${BLACK}";

38 
	gecho
 -
	ge
 "${RED} æ‰“å¼€é…ç½®æ–‡ä»¶ï¼šsudo vi /etc/sysconfig/selinux${BLACK}";

39 
	gecho
 -
	ge
 "${RED} ä¿®æ”¹ä¸ºï¼šSELINUX=disabled${BLACK}";

40 
	gecho
 -
	ge
 "${RED} é‡å¯ç³»ç»Ÿï¼šsudo„eboot${BLACK}";

41 
fi


43 [[ -
f
 /
‘c
/
š™
.
d
/
bËs
 ]]; 
th’


44 
	gsudo
 /
	g‘c
/
	gš™
.
	gd
/
bËs
 
	g¡©us
 >/
	gdev
/
	gnuÎ
 2>&1;

45 [[ 
$
? -
Ã
 3 ]]; 
th’


46 
	gecho
 -
	ge
 "${RED}è¯·å…³é—­é˜²ç«å¢™ï¼š${BLACK}";

47 
	gecho
 -
	ge
 "${RED} sudo /etc/init.d/iptables stop${BLACK}";

48 
fi


49 
fi


51 
	gecho
 -
	ge
 "${GREEN}è¯·åœ¨hostsä¸­æ·»åŠ ä¸€è¡Œï¼š${BLACK}"

52 
	gecho
 -
	ge
 "${RED} $ip demo.srs.com${BLACK}"

53 
	gecho
 -
	ge
 "${GREEN}æ¼”ç¤ºåœ°å€ï¼š${BLACK}"

54 
	gecho
 -
	ge
 "${RED} http://$ip:$port${BLACK}"

55 
	gecho
 -
	ge
 "@see https://github.com/ossrs/srs/wiki/v1_CN_SampleDemo"

	@trunk/scripts/stop.sh

1 #!/
bš
/
bash


3 ./
	g‘c
/
	gš™
.
	gd
/
	g¤s
-
demo
 
	g¡İ
; 
	g»t
=
$
?; [[ 0 -
Ã
 
$»t
 ]]; 
th’
 
	gecho
 "é”™è¯¯ï¼šåœæ­¢SRSå¤±è´¥"; 
ex™
 
	g$»t
; 
fi


4 
	gecho
 "åœæ­¢SRSæœåŠ¡å™¨æˆåŠŸ"

6 ./
	g‘c
/
	gš™
.
	gd
/
	g¤s
-
	gdemo
-19350 
	g¡İ
; 
	g»t
=
$
?; [[ 0 -
Ã
 
$»t
 ]]; 
th’
 
	gecho
 "é”™è¯¯ï¼šåœæ­¢SRSè½¬å‘æœåŠ¡å™¨å¤±è´¥"; 
ex™
 
	g$»t
; 
fi


7 
	gecho
 "åœæ­¢SRSè½¬å‘æœåŠ¡å™¨æˆåŠŸ"

9 ./
	g‘c
/
	gš™
.
	gd
/
	g¤s
-
­i
 
	g¡İ
; 
	g»t
=
$
?; [[ 0 -
Ã
 
$»t
 ]]; 
th’
 
	gecho
 "é”™è¯¯ï¼šåœæ­¢APIæœåŠ¡å™¨å¤±è´¥"; 
ex™
 
	g$»t
; 
fi


10 
	gecho
 "åœæ­¢APIæœåŠ¡å™¨æˆåŠŸ"

12 
	gecho
 "SRSç³»ç»ŸæœåŠ¡å‡å·²åœæ­¢"

	@trunk/scripts/test_configure.sh

1 #!/
bš
/
bash


3 
	g·¿ms
="$@"

4 
echo
 "params is: $params"

6 #discov” 
the
 
cu¼’t
 
wÜk
 
dœ
,h
log
 
ªd
 
acûss
.

7 
	gecho
 "argv[0]=$0"

8 [[ ! -
f
 
$0
 ]]; 
th’


9 
	gecho
 "directlyƒxecutehe scripts on shell.";

10 
	gwÜk_dœ
=`
pwd
`

12 
echo
 "execute scripts in file: $0";

13 
	gwÜk_dœ
=`
dœÇme
 
$0
`; wÜk_dœ=`(
cd
 
$
{
wÜk_dœ
} && 
pwd
)`

14 
fi


15 
wÜk_dœ
=`(
cd
 
$
{wÜk_dœ}/.. && 
pwd
)`

16 
´oduù_dœ
=
$wÜk_dœ


17 
bud_objs
=
$
{
wÜk_dœ
}/
objs


18 
·ckage_dœ
=
$
{
bud_objs
}/
·ckage


20 
log
="${bud_objs}/‹¡.`d©+%s`.log" && . 
$
{
´oduù_dœ
}/
süts
/
_log
.
sh
 && 
check_log


21 
»t
=
$
?; [[ 
$»t
 -
Ã
 0 ]]; 
th’
 
ex™
 
	g$»t
; 
fi


23 
	g™em
="./configure"

24 
ok_msg
 "test \" ${item} \""

25 (
$™em
 && 
make
 
$·¿ms
è>>
$log
 2>&1

26 
»t
=
$
?; [[ 
$»t
 -
Ã
 0 ]]; 
th’
 
	gçed_msg
 "‹¡ \" ${™em} \" faed.„‘=$»t"; 
ex™
 
	g$»t
; 
fi


27 
	gok_msg
 "test \" ${item} \" success"

29 
	g™em
="./configure --x86-x64"

30 
ok_msg
 "test \" ${item} \""

31 (
$™em
 && 
make
 
$·¿ms
è>>
$log
 2>&1

32 
»t
=
$
?; [[ 
$»t
 -
Ã
 0 ]]; 
th’
 
	gçed_msg
 "‹¡ \" ${™em} \" faed.„‘=$»t"; 
ex™
 
	g$»t
; 
fi


33 
	gok_msg
 "test \" ${item} \" success"

35 
	g™em
="./configure --disable-all"

36 
ok_msg
 "test \" ${item} \""

37 (
$™em
 && 
make
 
$·¿ms
è>>
$log
 2>&1

38 
»t
=
$
?; [[ 
$»t
 -
Ã
 0 ]]; 
th’
 
	gçed_msg
 "‹¡ \" ${™em} \" faed.„‘=$»t"; 
ex™
 
	g$»t
; 
fi


39 
	gok_msg
 "test \" ${item} \" success"

41 
	g™em
="./configure --fast"

42 
ok_msg
 "test \" ${item} \""

43 (
$™em
 && 
make
 
$·¿ms
è>>
$log
 2>&1

44 
»t
=
$
?; [[ 
$»t
 -
Ã
 0 ]]; 
th’
 
	gçed_msg
 "‹¡ \" ${™em} \" faed.„‘=$»t"; 
ex™
 
	g$»t
; 
fi


45 
	gok_msg
 "test \" ${item} \" success"

47 
	g™em
="./configure --pure-rtmp"

48 
ok_msg
 "test \" ${item} \""

49 (
$™em
 && 
make
 
$·¿ms
è>>
$log
 2>&1

50 
»t
=
$
?; [[ 
$»t
 -
Ã
 0 ]]; 
th’
 
	gçed_msg
 "‹¡ \" ${™em} \" faed.„‘=$»t"; 
ex™
 
	g$»t
; 
fi


51 
	gok_msg
 "test \" ${item} \" success"

53 
	g™em
="./configure --rtmp-hls"

54 
ok_msg
 "test \" ${item} \""

55 (
$™em
 && 
make
 
$·¿ms
è>>
$log
 2>&1

56 
»t
=
$
?; [[ 
$»t
 -
Ã
 0 ]]; 
th’
 
	gçed_msg
 "‹¡ \" ${™em} \" faed.„‘=$»t"; 
ex™
 
	g$»t
; 
fi


57 
	gok_msg
 "test \" ${item} \" success"

59 
	g™em
="./configure --fast --with-ssl"

60 
ok_msg
 "test \" ${item} \""

61 (
$™em
 && 
make
 
$·¿ms
è>>
$log
 2>&1

62 
»t
=
$
?; [[ 
$»t
 -
Ã
 0 ]]; 
th’
 
	gçed_msg
 "‹¡ \" ${™em} \" faed.„‘=$»t"; 
ex™
 
	g$»t
; 
fi


63 
	gok_msg
 "test \" ${item} \" success"

65 
	g™em
="./configure --fast --with-hls"

66 
ok_msg
 "test \" ${item} \""

67 (
$™em
 && 
make
 
$·¿ms
è>>
$log
 2>&1

68 
»t
=
$
?; [[ 
$»t
 -
Ã
 0 ]]; 
th’
 
	gçed_msg
 "‹¡ \" ${™em} \" faed.„‘=$»t"; 
ex™
 
	g$»t
; 
fi


69 
	gok_msg
 "test \" ${item} \" success"

71 
	g™em
="./configure --fast --with-dvr"

72 
ok_msg
 "test \" ${item} \""

73 (
$™em
 && 
make
 
$·¿ms
è>>
$log
 2>&1

74 
»t
=
$
?; [[ 
$»t
 -
Ã
 0 ]]; 
th’
 
	gçed_msg
 "‹¡ \" ${™em} \" faed.„‘=$»t"; 
ex™
 
	g$»t
; 
fi


75 
	gok_msg
 "test \" ${item} \" success"

77 
	g™em
="./configure --fast --with-nginx"

78 
ok_msg
 "test \" ${item} \""

79 (
$™em
 && 
make
 
$·¿ms
è>>
$log
 2>&1

80 
»t
=
$
?; [[ 
$»t
 -
Ã
 0 ]]; 
th’
 
	gçed_msg
 "‹¡ \" ${™em} \" faed.„‘=$»t"; 
ex™
 
	g$»t
; 
fi


81 
	gok_msg
 "test \" ${item} \" success"

83 
	g™em
="./configure --fast --with-http-callback"

84 
ok_msg
 "test \" ${item} \""

85 (
$™em
 && 
make
 
$·¿ms
è>>
$log
 2>&1

86 
»t
=
$
?; [[ 
$»t
 -
Ã
 0 ]]; 
th’
 
	gçed_msg
 "‹¡ \" ${™em} \" faed.„‘=$»t"; 
ex™
 
	g$»t
; 
fi


87 
	gok_msg
 "test \" ${item} \" success"

89 
	g™em
="./configure --fast --with-http-server"

90 
ok_msg
 "test \" ${item} \""

91 (
$™em
 && 
make
 
$·¿ms
è>>
$log
 2>&1

92 
»t
=
$
?; [[ 
$»t
 -
Ã
 0 ]]; 
th’
 
	gçed_msg
 "‹¡ \" ${™em} \" faed.„‘=$»t"; 
ex™
 
	g$»t
; 
fi


93 
	gok_msg
 "test \" ${item} \" success"

95 
	g™em
="./configure --fast --with-http-api"

96 
ok_msg
 "test \" ${item} \""

97 (
$™em
 && 
make
 
$·¿ms
è>>
$log
 2>&1

98 
»t
=
$
?; [[ 
$»t
 -
Ã
 0 ]]; 
th’
 
	gçed_msg
 "‹¡ \" ${™em} \" faed.„‘=$»t"; 
ex™
 
	g$»t
; 
fi


99 
	gok_msg
 "test \" ${item} \" success"

101 
	g™em
="./configure --fast --with-ffmpeg"

102 
ok_msg
 "test \" ${item} \""

103 (
$™em
 && 
make
 
$·¿ms
è>>
$log
 2>&1

104 
»t
=
$
?; [[ 
$»t
 -
Ã
 0 ]]; 
th’
 
	gçed_msg
 "‹¡ \" ${™em} \" faed.„‘=$»t"; 
ex™
 
	g$»t
; 
fi


105 
	gok_msg
 "test \" ${item} \" success"

107 
	g™em
="./configure --fast --with-transcode"

108 
ok_msg
 "test \" ${item} \""

109 (
$™em
 && 
make
 
$·¿ms
è>>
$log
 2>&1

110 
»t
=
$
?; [[ 
$»t
 -
Ã
 0 ]]; 
th’
 
	gçed_msg
 "‹¡ \" ${™em} \" faed.„‘=$»t"; 
ex™
 
	g$»t
; 
fi


111 
	gok_msg
 "test \" ${item} \" success"

113 
	g™em
="./configure --fast --with-ingest"

114 
ok_msg
 "test \" ${item} \""

115 (
$™em
 && 
make
 
$·¿ms
è>>
$log
 2>&1

116 
»t
=
$
?; [[ 
$»t
 -
Ã
 0 ]]; 
th’
 
	gçed_msg
 "‹¡ \" ${™em} \" faed.„‘=$»t"; 
ex™
 
	g$»t
; 
fi


117 
	gok_msg
 "test \" ${item} \" success"

119 
	g™em
="./configure --fast --with-librtmp"

120 
ok_msg
 "test \" ${item} \""

121 (
$™em
 && 
make
 
$·¿ms
è>>
$log
 2>&1

122 
»t
=
$
?; [[ 
$»t
 -
Ã
 0 ]]; 
th’
 
	gçed_msg
 "‹¡ \" ${™em} \" faed.„‘=$»t"; 
ex™
 
	g$»t
; 
fi


123 
	gok_msg
 "test \" ${item} \" success"

125 
	g™em
="./configure --fast --with-research"

126 
ok_msg
 "test \" ${item} \""

127 (
$™em
 && 
make
 
$·¿ms
è>>
$log
 2>&1

128 
»t
=
$
?; [[ 
$»t
 -
Ã
 0 ]]; 
th’
 
	gçed_msg
 "‹¡ \" ${™em} \" faed.„‘=$»t"; 
ex™
 
	g$»t
; 
fi


129 
	gok_msg
 "test \" ${item} \" success"

131 
	g™em
="./configure --fast --with-stream-caster --with-http-api"

132 
ok_msg
 "test \" ${item} \""

133 (
$™em
 && 
make
 
$·¿ms
è>>
$log
 2>&1

134 
»t
=
$
?; [[ 
$»t
 -
Ã
 0 ]]; 
th’
 
	gçed_msg
 "‹¡ \" ${™em} \" faed.„‘=$»t"; 
ex™
 
	g$»t
; 
fi


135 
	gok_msg
 "test \" ${item} \" success"

137 
	g™em
="./configure --fast --with-utest"

138 
ok_msg
 "test \" ${item} \""

139 (
$™em
 && 
make
 
$·¿ms
è>>
$log
 2>&1

140 
»t
=
$
?; [[ 
$»t
 -
Ã
 0 ]]; 
th’
 
	gçed_msg
 "‹¡ \" ${™em} \" faed.„‘=$»t"; 
ex™
 
	g$»t
; 
fi


141 
	gok_msg
 "test \" ${item} \" success"

143 
	g™em
="./configure --fast --with-ssl --with-utest"

144 
ok_msg
 "test \" ${item} \""

145 (
$™em
 && 
make
 
$·¿ms
è>>
$log
 2>&1

146 
»t
=
$
?; [[ 
$»t
 -
Ã
 0 ]]; 
th’
 
	gçed_msg
 "‹¡ \" ${™em} \" faed.„‘=$»t"; 
ex™
 
	g$»t
; 
fi


147 
	gok_msg
 "test \" ${item} \" success"

149 
	g™em
="./configure --fast --with-gperf"

150 
ok_msg
 "test \" ${item} \""

151 (
$™em
 && 
make
 
$·¿ms
è>>
$log
 2>&1

152 
»t
=
$
?; [[ 
$»t
 -
Ã
 0 ]]; 
th’
 
	gçed_msg
 "‹¡ \" ${™em} \" faed.„‘=$»t"; 
ex™
 
	g$»t
; 
fi


153 
	gok_msg
 "test \" ${item} \" success"

155 
	g™em
="./configure --fast --with-gperf --with-gmc"

156 
ok_msg
 "test \" ${item} \""

157 (
$™em
 && 
make
 
$·¿ms
è>>
$log
 2>&1

158 
»t
=
$
?; [[ 
$»t
 -
Ã
 0 ]]; 
th’
 
	gçed_msg
 "‹¡ \" ${™em} \" faed.„‘=$»t"; 
ex™
 
	g$»t
; 
fi


159 
	gok_msg
 "test \" ${item} \" success"

161 
	g™em
="./configure --fast --with-gperf --with-gmp"

162 
ok_msg
 "test \" ${item} \""

163 (
$™em
 && 
make
 
$·¿ms
è>>
$log
 2>&1

164 
»t
=
$
?; [[ 
$»t
 -
Ã
 0 ]]; 
th’
 
	gçed_msg
 "‹¡ \" ${™em} \" faed.„‘=$»t"; 
ex™
 
	g$»t
; 
fi


165 
	gok_msg
 "test \" ${item} \" success"

167 
	g™em
="./configure --fast --with-gperf --with-gcp"

168 
ok_msg
 "test \" ${item} \""

169 (
$™em
 && 
make
 
$·¿ms
è>>
$log
 2>&1

170 
»t
=
$
?; [[ 
$»t
 -
Ã
 0 ]]; 
th’
 
	gçed_msg
 "‹¡ \" ${™em} \" faed.„‘=$»t"; 
ex™
 
	g$»t
; 
fi


171 
	gok_msg
 "test \" ${item} \" success"

173 
	g™em
="./configure --fast --with-gprof"

174 
ok_msg
 "test \" ${item} \""

175 (
$™em
 && 
make
 
$·¿ms
è>>
$log
 2>&1

176 
»t
=
$
?; [[ 
$»t
 -
Ã
 0 ]]; 
th’
 
	gçed_msg
 "‹¡ \" ${™em} \" faed.„‘=$»t"; 
ex™
 
	g$»t
; 
fi


177 
	gok_msg
 "test \" ${item} \" success"

179 
	g™em
="./configure --fast --log-verbose"

180 
ok_msg
 "test \" ${item} \""

181 (
$™em
 && 
make
 
$·¿ms
è>>
$log
 2>&1

182 
»t
=
$
?; [[ 
$»t
 -
Ã
 0 ]]; 
th’
 
	gçed_msg
 "‹¡ \" ${™em} \" faed.„‘=$»t"; 
ex™
 
	g$»t
; 
fi


183 
	gok_msg
 "test \" ${item} \" success"

185 
	g™em
="./configure --fast --log-info"

186 
ok_msg
 "test \" ${item} \""

187 (
$™em
 && 
make
 
$·¿ms
è>>
$log
 2>&1

188 
»t
=
$
?; [[ 
$»t
 -
Ã
 0 ]]; 
th’
 
	gçed_msg
 "‹¡ \" ${™em} \" faed.„‘=$»t"; 
ex™
 
	g$»t
; 
fi


189 
	gok_msg
 "test \" ${item} \" success"

191 
	g™em
="./configure --fast --log-trace"

192 
ok_msg
 "test \" ${item} \""

193 (
$™em
 && 
make
 
$·¿ms
è>>
$log
 2>&1

194 
»t
=
$
?; [[ 
$»t
 -
Ã
 0 ]]; 
th’
 
	gçed_msg
 "‹¡ \" ${™em} \" faed.„‘=$»t"; 
ex™
 
	g$»t
; 
fi


195 
	gok_msg
 "test \" ${item} \" success"

197 
	g™em
="./configure --fast --log-info --log-verbose --log-trace"

198 
ok_msg
 "test \" ${item} \""

199 (
$™em
 && 
make
 
$·¿ms
è>>
$log
 2>&1

200 
»t
=
$
?; [[ 
$»t
 -
Ã
 0 ]]; 
th’
 
	gçed_msg
 "‹¡ \" ${™em} \" faed.„‘=$»t"; 
ex™
 
	g$»t
; 
fi


201 
	gok_msg
 "test \" ${item} \" success"

203 #######################################################################################################
#######################################################################################################
#######################################################################################################
="./cÚfigu» --dev"

204 
	gok_msg
 "test \" ${item} \""

205 (
	g$™em
 && 
make
 
	g$·¿ms
è>>
	g$log
 2>&1

206 
	g»t
=
$
?; [[ 
$»t
 -
Ã
 0 ]]; 
th’
 
	gçed_msg
 "‹¡ \" ${™em} \" faed.„‘=$»t"; 
ex™
 
	g$»t
; 
fi


207 
	gok_msg
 "test \" ${item} \" success"

209 
	g™em
="./configure --fast-dev"

210 
ok_msg
 "test \" ${item} \""

211 (
$™em
 && 
make
 
$·¿ms
è>>
$log
 2>&1

212 
»t
=
$
?; [[ 
$»t
 -
Ã
 0 ]]; 
th’
 
	gçed_msg
 "‹¡ \" ${™em} \" faed.„‘=$»t"; 
ex™
 
	g$»t
; 
fi


213 
	gok_msg
 "test \" ${item} \" success"

215 
	g™em
="./configure --demo"

216 
ok_msg
 "test \" ${item} \""

217 (
$™em
 && 
make
 
$·¿ms
è>>
$log
 2>&1

218 
»t
=
$
?; [[ 
$»t
 -
Ã
 0 ]]; 
th’
 
	gçed_msg
 "‹¡ \" ${™em} \" faed.„‘=$»t"; 
ex™
 
	g$»t
; 
fi


219 
	gok_msg
 "test \" ${item} \" success"

221 
	g™em
="./configure --full"

222 
ok_msg
 "test \" ${item} \""

223 (
$™em
 && 
make
 
$·¿ms
è>>
$log
 2>&1

224 
»t
=
$
?; [[ 
$»t
 -
Ã
 0 ]]; 
th’
 
	gçed_msg
 "‹¡ \" ${™em} \" faed.„‘=$»t"; 
ex™
 
	g$»t
; 
fi


225 
	gok_msg
 "test \" ${item} \" success"

227 #######################################################################################################
#######################################################################################################
#######################################################################################################
="./cÚfigu» --di§bË-®È--w™h-s¦"

228 
	gok_msg
 "test \" ${item} \""

229 (
	g$™em
 && 
make
 
	g$·¿ms
è>>
	g$log
 2>&1

230 
	g»t
=
$
?; [[ 
$»t
 -
Ã
 0 ]]; 
th’
 
	gçed_msg
 "‹¡ \" ${™em} \" faed.„‘=$»t"; 
ex™
 
	g$»t
; 
fi


231 
	gok_msg
 "test \" ${item} \" success"

233 
	g™em
="./configure --disable-all --with-hls --with-ssl --with-http-server --with-http-api"

234 
ok_msg
 "test \" ${item} \""

235 (
$™em
 && 
make
 
$·¿ms
è>>
$log
 2>&1

236 
»t
=
$
?; [[ 
$»t
 -
Ã
 0 ]]; 
th’
 
	gçed_msg
 "‹¡ \" ${™em} \" faed.„‘=$»t"; 
ex™
 
	g$»t
; 
fi


237 
	gok_msg
 "test \" ${item} \" success"

239 
	g™em
="./configure --disable-all --with-ssl --with-hls --with-nginx"

240 
ok_msg
 "test \" ${item} \""

241 (
$™em
 && 
make
 
$·¿ms
è>>
$log
 2>&1

242 
»t
=
$
?; [[ 
$»t
 -
Ã
 0 ]]; 
th’
 
	gçed_msg
 "‹¡ \" ${™em} \" faed.„‘=$»t"; 
ex™
 
	g$»t
; 
fi


243 
	gok_msg
 "test \" ${item} \" success"

245 
	g™em
="./configure --disable-all --with-ssl --with-hls --with-nginx --with-ffmpeg --with-transcode"

246 
ok_msg
 "test \" ${item} \""

247 (
$™em
 && 
make
 
$·¿ms
è>>
$log
 2>&1

248 
»t
=
$
?; [[ 
$»t
 -
Ã
 0 ]]; 
th’
 
	gçed_msg
 "‹¡ \" ${™em} \" faed.„‘=$»t"; 
ex™
 
	g$»t
; 
fi


249 
	gok_msg
 "test \" ${item} \" success"

251 
	g™em
="./configure --disable-all --with-ssl --with-ffmpeg --with-transcode"

252 
ok_msg
 "test \" ${item} \""

253 (
$™em
 && 
make
 
$·¿ms
è>>
$log
 2>&1

254 
»t
=
$
?; [[ 
$»t
 -
Ã
 0 ]]; 
th’
 
	gçed_msg
 "‹¡ \" ${™em} \" faed.„‘=$»t"; 
ex™
 
	g$»t
; 
fi


255 
	gok_msg
 "test \" ${item} \" success"

257 
	g™em
="./configure --disable-all --with-ssl --with-ffmpeg --with-ingest"

258 
ok_msg
 "test \" ${item} \""

259 (
$™em
 && 
make
 
$·¿ms
è>>
$log
 2>&1

260 
»t
=
$
?; [[ 
$»t
 -
Ã
 0 ]]; 
th’
 
	gçed_msg
 "‹¡ \" ${™em} \" faed.„‘=$»t"; 
ex™
 
	g$»t
; 
fi


261 
	gok_msg
 "test \" ${item} \" success"

263 
	g™em
="./configure --disable-all --with-hls --with-ssl --with-http-server"

264 
ok_msg
 "test \" ${item} \""

265 (
$™em
 && 
make
 
$·¿ms
è>>
$log
 2>&1

266 
»t
=
$
?; [[ 
$»t
 -
Ã
 0 ]]; 
th’
 
	gçed_msg
 "‹¡ \" ${™em} \" faed.„‘=$»t"; 
ex™
 
	g$»t
; 
fi


267 
	gok_msg
 "test \" ${item} \" success"

269 
	gecho
 "success"

	@/usr/include/assert.h

24 #ifdef 
_ASSERT_H


26 #undeà
_ASSERT_H


27 #undeà
as£¹


28 #undeà
__ASSERT_VOID_CAST


30 #ifdef 
__USE_GNU


31 #undeà
as£¹_³¼Ü


36 
	#_ASSERT_H
 1

	)

37 
	~<ã©u»s.h
>

39 #ià
defšed
 
__ılu¥lus
 && 
__GNUC_PREREQ
 (2,95)

40 
	#__ASSERT_VOID_CAST
 
¡©ic_ÿ¡
<>

	)

42 
	#__ASSERT_VOID_CAST
 ()

	)

50 #ifdef 
NDEBUG


52 
	#as£¹
(
ex´
è(
	`__ASSERT_VOID_CAST
 (0))

	)

60 #ifdef 
__USE_GNU


61 
	#as£¹_³¼Ü
(
”ºum
è(
	`__ASSERT_VOID_CAST
 (0))

	)

66 
__BEGIN_DECLS


69 
	$__as£¹_ç
 (
__cÚ¡
 *
__as£¹iÚ
, __cÚ¡ *
__fe
,

70 
__lše
, 
__cÚ¡
 *
__funùiÚ
)

71 
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

74 
	$__as£¹_³¼Ü_ç
 (
__”ºum
, 
__cÚ¡
 *
__fe
,

75 
__lše
,

76 
__cÚ¡
 *
__funùiÚ
)

77 
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

82 
	$__as£¹
 (cÚ¡ *
__as£¹iÚ
, cÚ¡ *
__fe
, 
__lše
)

83 
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

86 
__END_DECLS


88 
	#as£¹
(
ex´
) \

89 ((
ex´
) \

90 ? 
	`__ASSERT_VOID_CAST
 (0) \

91 : 
	`__as£¹_ç
 (
	`__STRING
(
ex´
), 
__FILE__
, 
__LINE__
, 
__ASSERT_FUNCTION
))

	)

93 #ifdef 
__USE_GNU


94 
	#as£¹_³¼Ü
(
”ºum
) \

95 (!(
”ºum
) \

96 ? 
	`__ASSERT_VOID_CAST
 (0) \

97 : 
	`__as£¹_³¼Ü_ç
 ((
”ºum
), 
__FILE__
, 
__LINE__
, 
__ASSERT_FUNCTION
))

	)

105 #ià
defšed
 
__ılu¥lus
 ? 
	`__GNUC_PREREQ
 (2, 6) : __GNUC_PREREQ (2, 4)

106 
	#__ASSERT_FUNCTION
 
__PRETTY_FUNCTION__


	)

108 #ià
defšed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L

109 
	#__ASSERT_FUNCTION
 
__func__


	)

111 
	#__ASSERT_FUNCTION
 ((
__cÚ¡
 *è0)

	)

	@/usr/include/ctype.h

24 #iâdef 
_CTYPE_H


25 
	#_CTYPE_H
 1

	)

27 
	~<ã©u»s.h
>

28 
	~<b™s/ty³s.h
>

30 
	g__BEGIN_DECLS


32 #iâdeà
_ISb™


41 
	~<’dŸn.h
>

42 #ià
__BYTE_ORDER
 =ğ
__BIG_ENDIAN


43 
	#_ISb™
(
b™
è(1 << (b™))

	)

45 
	#_ISb™
(
b™
è((b™è< 8 ? ((1 << (b™)è<< 8è: ((1 << (b™)è>> 8))

	)

50 
	m_ISuµ”
 = 
_ISb™
 (0),

51 
	m_ISlow”
 = 
_ISb™
 (1),

52 
	m_IS®pha
 = 
_ISb™
 (2),

53 
	m_ISdig™
 = 
_ISb™
 (3),

54 
	m_ISxdig™
 = 
_ISb™
 (4),

55 
	m_IS¥aû
 = 
_ISb™
 (5),

56 
	m_IS´št
 = 
_ISb™
 (6),

57 
	m_ISg¿ph
 = 
_ISb™
 (7),

58 
	m_ISbÏnk
 = 
_ISb™
 (8),

59 
	m_ISúŒl
 = 
_ISb™
 (9),

60 
	m_ISpunù
 = 
_ISb™
 (10),

61 
	m_IS®num
 = 
_ISb™
 (11)

81 
__cÚ¡
 **
	$__ùy³_b_loc
 ()

82 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡
));

83 
__cÚ¡
 
__št32_t
 **
	$__ùy³_tŞow”_loc
 ()

84 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡
));

85 
__cÚ¡
 
__št32_t
 **
	$__ùy³_touµ”_loc
 ()

86 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡
));

88 
	#__isùy³
(
c
, 
ty³
) \

89 ((*
	`__ùy³_b_loc
 ())[(è(
c
)] & (è
ty³
)

	)

91 
	#__i§scii
(
c
è(((cè& ~0x7fè=ğ0è

	)

92 
	#__tßscii
(
c
è((cè& 0x7fè

	)

94 
	#__exùy³
(
Çme
è
	`Çme
 (è
__THROW


	)

96 
__BEGIN_NAMESPACE_STD


102 
	`__exùy³
 (
i§Êum
);

103 
	`__exùy³
 (
i§Íha
);

104 
	`__exùy³
 (
isúŒl
);

105 
	`__exùy³
 (
isdig™
);

106 
	`__exùy³
 (
i¦ow”
);

107 
	`__exùy³
 (
isg¿ph
);

108 
	`__exùy³
 (
i¥ršt
);

109 
	`__exùy³
 (
i¥unù
);

110 
	`__exùy³
 (
is¥aû
);

111 
	`__exùy³
 (
isuµ”
);

112 
	`__exùy³
 (
isxdig™
);

116 
	$tŞow”
 (
__c
è
__THROW
;

119 
	$touµ”
 (
__c
è
__THROW
;

121 
__END_NAMESPACE_STD


125 #ifdef 
__USE_ISOC99


126 
__BEGIN_NAMESPACE_C99


128 
	`__exùy³
 (
isbÏnk
);

130 
__END_NAMESPACE_C99


133 #ifdeà
__USE_GNU


135 
	$isùy³
 (
__c
, 
__mask
è
__THROW
;

138 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_MISC
 || defšed 
__USE_XOPEN


142 
	$i§scii
 (
__c
è
__THROW
;

146 
	$tßscii
 (
__c
è
__THROW
;

150 
	`__exùy³
 (
_touµ”
);

151 
	`__exùy³
 (
_tŞow”
);

155 
	#__tobody
(
c
, 
f
, 
a
, 
¬gs
) \

156 (
__ex‹nsiÚ__
 \

157 ({ 
__»s
; \

158 ià( (
c
) > 1) \

160 ià(
	`__butš_cÚ¡ªt_p
 (
c
)) \

162 
__c
 = (
c
); \

163 
__»s
 = 
__c
 < -128 || __ø> 255 ? __ø: (
a
)[__c]; \

166 
__»s
 = 
f
 
¬gs
; \

169 
__»s
 = (
a
)[(è(
c
)]; \

170 
__»s
; 
	}
}))

	)

172 #ià!
defšed
 
__NO_CTYPE
 && !defšed 
__ılu¥lus


173 
	#i§Êum
(
c
è
	`__isùy³
((c), 
_IS®num
)

	)

174 
	#i§Íha
(
c
è
	`__isùy³
((c), 
_IS®pha
)

	)

175 
	#isúŒl
(
c
è
	`__isùy³
((c), 
_ISúŒl
)

	)

176 
	#isdig™
(
c
è
	`__isùy³
((c), 
_ISdig™
)

	)

177 
	#i¦ow”
(
c
è
	`__isùy³
((c), 
_ISlow”
)

	)

178 
	#isg¿ph
(
c
è
	`__isùy³
((c), 
_ISg¿ph
)

	)

179 
	#i¥ršt
(
c
è
	`__isùy³
((c), 
_IS´št
)

	)

180 
	#i¥unù
(
c
è
	`__isùy³
((c), 
_ISpunù
)

	)

181 
	#is¥aû
(
c
è
	`__isùy³
((c), 
_IS¥aû
)

	)

182 
	#isuµ”
(
c
è
	`__isùy³
((c), 
_ISuµ”
)

	)

183 
	#isxdig™
(
c
è
	`__isùy³
((c), 
_ISxdig™
)

	)

185 #ifdeà
__USE_ISOC99


186 
	#isbÏnk
(
c
è
	`__isùy³
((c), 
_ISbÏnk
)

	)

189 #ifdeà
__USE_EXTERN_INLINES


190 
__ex‹º_šlše
 

191 
__NTH
 (
	$tŞow”
 (
__c
))

193  
__c
 >ğ-128 && __ø< 256 ? (*
	`__ùy³_tŞow”_loc
 ())[__c] : __c;

194 
	}
}

196 
__ex‹º_šlše
 

197 
__NTH
 (
	$touµ”
 (
__c
))

199  
__c
 >ğ-128 && __ø< 256 ? (*
	`__ùy³_touµ”_loc
 ())[__c] : __c;

200 
	}
}

203 #ià
__GNUC__
 >ğ2 && 
defšed
 
__OPTIMIZE__
 && !defšed 
__ılu¥lus


204 
	#tŞow”
(
c
è
	`__tobody
 (c, 
tŞow”
, *
	`__ùy³_tŞow”_loc
 (), (c))

	)

205 
	#touµ”
(
c
è
	`__tobody
 (c, 
touµ”
, *
	`__ùy³_touµ”_loc
 (), (c))

	)

208 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_MISC
 || defšed 
__USE_XOPEN


209 
	#i§scii
(
c
è
	`__i§scii
 (c)

	)

210 
	#tßscii
(
c
è
	`__tßscii
 (c)

	)

212 
	#_tŞow”
(
c
è((è(*
	`__ùy³_tŞow”_loc
 ())[(è(c)])

	)

213 
	#_touµ”
(
c
è((è(*
	`__ùy³_touµ”_loc
 ())[(è(c)])

	)

219 #ifdeà
__USE_XOPEN2K8


233 
	~<xloÿË.h
>

237 
	#__isùy³_l
(
c
, 
ty³
, 
loÿË
) \

238 ((
loÿË
)->
__ùy³_b
[(è(
c
)] & (è
ty³
)

	)

240 
	#__exùy³_l
(
Çme
) \

241 
	`Çme
 (, 
__loÿË_t
è
__THROW


	)

247 
__exùy³_l
 (
i§Êum_l
);

248 
__exùy³_l
 (
i§Íha_l
);

249 
__exùy³_l
 (
isúŒl_l
);

250 
__exùy³_l
 (
isdig™_l
);

251 
__exùy³_l
 (
i¦ow”_l
);

252 
__exùy³_l
 (
isg¿ph_l
);

253 
__exùy³_l
 (
i¥ršt_l
);

254 
__exùy³_l
 (
i¥unù_l
);

255 
__exùy³_l
 (
is¥aû_l
);

256 
__exùy³_l
 (
isuµ”_l
);

257 
__exùy³_l
 (
isxdig™_l
);

259 
__exùy³_l
 (
isbÏnk_l
);

263 
	$__tŞow”_l
 (
__c
, 
__loÿË_t
 
__l
è
__THROW
;

264 
	$tŞow”_l
 (
__c
, 
__loÿË_t
 
__l
è
__THROW
;

267 
	$__touµ”_l
 (
__c
, 
__loÿË_t
 
__l
è
__THROW
;

268 
	$touµ”_l
 (
__c
, 
__loÿË_t
 
__l
è
__THROW
;

270 #ià
__GNUC__
 >ğ2 && 
defšed
 
__OPTIMIZE__
 && !defšed 
__ılu¥lus


271 
	#__tŞow”_l
(
c
, 
loÿË
) \

272 
	`__tobody
 (
c
, 
__tŞow”_l
, (
loÿË
)->
__ùy³_tŞow”
, (c,†oÿË))

	)

273 
	#__touµ”_l
(
c
, 
loÿË
) \

274 
	`__tobody
 (
c
, 
__touµ”_l
, (
loÿË
)->
__ùy³_touµ”
, (c,†oÿË))

	)

275 
	#tŞow”_l
(
c
, 
loÿË
è
	`__tŞow”_l
 ((c), (loÿË))

	)

276 
	#touµ”_l
(
c
, 
loÿË
è
	`__touµ”_l
 ((c), (loÿË))

	)

280 #iâdeà
__NO_CTYPE


281 
	#__i§Êum_l
(
c
,
l
è
	`__isùy³_l
((c), 
_IS®num
, (l))

	)

282 
	#__i§Íha_l
(
c
,
l
è
	`__isùy³_l
((c), 
_IS®pha
, (l))

	)

283 
	#__isúŒl_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISúŒl
, (l))

	)

284 
	#__isdig™_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISdig™
, (l))

	)

285 
	#__i¦ow”_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISlow”
, (l))

	)

286 
	#__isg¿ph_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISg¿ph
, (l))

	)

287 
	#__i¥ršt_l
(
c
,
l
è
	`__isùy³_l
((c), 
_IS´št
, (l))

	)

288 
	#__i¥unù_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISpunù
, (l))

	)

289 
	#__is¥aû_l
(
c
,
l
è
	`__isùy³_l
((c), 
_IS¥aû
, (l))

	)

290 
	#__isuµ”_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISuµ”
, (l))

	)

291 
	#__isxdig™_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISxdig™
, (l))

	)

293 
	#__isbÏnk_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISbÏnk
, (l))

	)

295 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_MISC


296 
	#__i§scii_l
(
c
,
l
è(Ö), 
	`__i§scii
 (c))

	)

297 
	#__tßscii_l
(
c
,
l
è(Ö), 
	`__tßscii
 (c))

	)

300 
	#i§Êum_l
(
c
,
l
è
	`__i§Êum_l
 ((c), (l))

	)

301 
	#i§Íha_l
(
c
,
l
è
	`__i§Íha_l
 ((c), (l))

	)

302 
	#isúŒl_l
(
c
,
l
è
	`__isúŒl_l
 ((c), (l))

	)

303 
	#isdig™_l
(
c
,
l
è
	`__isdig™_l
 ((c), (l))

	)

304 
	#i¦ow”_l
(
c
,
l
è
	`__i¦ow”_l
 ((c), (l))

	)

305 
	#isg¿ph_l
(
c
,
l
è
	`__isg¿ph_l
 ((c), (l))

	)

306 
	#i¥ršt_l
(
c
,
l
è
	`__i¥ršt_l
 ((c), (l))

	)

307 
	#i¥unù_l
(
c
,
l
è
	`__i¥unù_l
 ((c), (l))

	)

308 
	#is¥aû_l
(
c
,
l
è
	`__is¥aû_l
 ((c), (l))

	)

309 
	#isuµ”_l
(
c
,
l
è
	`__isuµ”_l
 ((c), (l))

	)

310 
	#isxdig™_l
(
c
,
l
è
	`__isxdig™_l
 ((c), (l))

	)

312 
	#isbÏnk_l
(
c
,
l
è
	`__isbÏnk_l
 ((c), (l))

	)

314 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_MISC


315 
	#i§scii_l
(
c
,
l
è
	`__i§scii_l
 ((c), (l))

	)

316 
	#tßscii_l
(
c
,
l
è
	`__tßscii_l
 ((c), (l))

	)

323 
__END_DECLS


	@/usr/include/errno.h

23 #iâdef 
_ERRNO_H


27 #iâdef 
__Ãed_Em©h


28 
	#_ERRNO_H
 1

	)

29 
	~<ã©u»s.h
>

32 
	g__BEGIN_DECLS


36 
	~<b™s/”ºo.h
>

37 #undeà
__Ãed_Em©h


39 #ifdef 
_ERRNO_H


46 #iâdef 
”ºo


47 
”ºo
;

50 #ifdeà
__USE_GNU


55 *
´og¿m_švoÿtiÚ_Çme
, *
´og¿m_švoÿtiÚ_shÜt_Çme
;

59 
	g__END_DECLS


67 #ià
defšed
 
__USE_GNU
 || defšed 
__Ãed_”rÜ_t


68 #iâdeà
__”rÜ_t_defšed


69 
	t”rÜ_t
;

70 
	#__”rÜ_t_defšed
 1

	)

72 #undeà
__Ãed_”rÜ_t


	@/usr/include/fcntl.h

24 #iâdef 
_FCNTL_H


25 
	#_FCNTL_H
 1

	)

27 
	~<ã©u»s.h
>

30 
	g__BEGIN_DECLS


34 
	~<b™s/fú.h
>

37 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8


38 
	~<b™s/ty³s.h
>

39 
	#__Ãed_time¥ec


	)

40 
	~<time.h
>

41 
	~<b™s/¡©.h
>

43 
	#S_IFMT
 
__S_IFMT


	)

44 
	#S_IFDIR
 
__S_IFDIR


	)

45 
	#S_IFCHR
 
__S_IFCHR


	)

46 
	#S_IFBLK
 
__S_IFBLK


	)

47 
	#S_IFREG
 
__S_IFREG


	)

48 #ifdeà
__S_IFIFO


49 
	#S_IFIFO
 
__S_IFIFO


	)

51 #ifdeà
__S_IFLNK


52 
	#S_IFLNK
 
__S_IFLNK


	)

54 #ià(
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K8
è&& defšed 
__S_IFSOCK


55 
	#S_IFSOCK
 
__S_IFSOCK


	)

60 
	#S_ISUID
 
__S_ISUID


	)

61 
	#S_ISGID
 
__S_ISGID


	)

63 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_MISC
 || defšed 
__USE_XOPEN


65 
	#S_ISVTX
 
__S_ISVTX


	)

68 
	#S_IRUSR
 
__S_IREAD


	)

69 
	#S_IWUSR
 
__S_IWRITE


	)

70 
	#S_IXUSR
 
__S_IEXEC


	)

72 
	#S_IRWXU
 (
__S_IREAD
|
__S_IWRITE
|
__S_IEXEC
)

	)

74 
	#S_IRGRP
 (
S_IRUSR
 >> 3è

	)

75 
	#S_IWGRP
 (
S_IWUSR
 >> 3è

	)

76 
	#S_IXGRP
 (
S_IXUSR
 >> 3è

	)

78 
	#S_IRWXG
 (
S_IRWXU
 >> 3)

	)

80 
	#S_IROTH
 (
S_IRGRP
 >> 3è

	)

81 
	#S_IWOTH
 (
S_IWGRP
 >> 3è

	)

82 
	#S_IXOTH
 (
S_IXGRP
 >> 3è

	)

84 
	#S_IRWXO
 (
S_IRWXG
 >> 3)

	)

87 #ifdef 
__USE_MISC


88 #iâdeà
R_OK


91 
	#R_OK
 4

	)

92 
	#W_OK
 2

	)

93 
	#X_OK
 1

	)

94 
	#F_OK
 0

	)

99 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8


100 
	#SEEK_SET
 0

	)

101 
	#SEEK_CUR
 1

	)

102 
	#SEEK_END
 2

	)

105 #ifdeà
__USE_ATFILE


106 
	#AT_FDCWD
 -100

	)

109 
	#AT_SYMLINK_NOFOLLOW
 0x100

	)

110 
	#AT_REMOVEDIR
 0x200

	)

112 
	#AT_SYMLINK_FOLLOW
 0x400

	)

113 
	#AT_EACCESS
 0x200

	)

122 
fú
 (
__fd
, 
__cmd
, ...);

130 #iâdeà
__USE_FILE_OFFSET64


131 
	$İ’
 (
__cÚ¡
 *
__fe
, 
__oæag
, ...è
	`__nÚnuÎ
 ((1));

133 #ifdeà
__REDIRECT


134 
	`__REDIRECT
 (
İ’
, (
__cÚ¡
 *
__fe
, 
__oæag
, ...), 
İ’64
)

135 
	`__nÚnuÎ
 ((1));

137 
	#İ’
 
İ’64


	)

140 #ifdeà
__USE_LARGEFILE64


141 
	$İ’64
 (
__cÚ¡
 *
__fe
, 
__oæag
, ...è
	`__nÚnuÎ
 ((1));

144 #ifdeà
__USE_ATFILE


154 #iâdeà
__USE_FILE_OFFSET64


155 
	$İ’©
 (
__fd
, 
__cÚ¡
 *
__fe
, 
__oæag
, ...)

156 
	`__nÚnuÎ
 ((2));

158 #ifdeà
__REDIRECT


159 
	`__REDIRECT
 (
İ’©
, (
__fd
, 
__cÚ¡
 *
__fe
, 
__oæag
,

160 ...), 
İ’©64
è
	`__nÚnuÎ
 ((2));

162 
	#İ’©
 
İ’©64


	)

165 #ifdeà
__USE_LARGEFILE64


166 
	$İ’©64
 (
__fd
, 
__cÚ¡
 *
__fe
, 
__oæag
, ...)

167 
	`__nÚnuÎ
 ((2));

176 #iâdeà
__USE_FILE_OFFSET64


177 
	$ü—t
 (
__cÚ¡
 *
__fe
, 
__mode_t
 
__mode
è
	`__nÚnuÎ
 ((1));

179 #ifdeà
__REDIRECT


180 
	`__REDIRECT
 (
ü—t
, (
__cÚ¡
 *
__fe
, 
__mode_t
 
__mode
),

181 
ü—t64
è
	`__nÚnuÎ
 ((1));

183 
	#ü—t
 
ü—t64


	)

186 #ifdeà
__USE_LARGEFILE64


187 
	$ü—t64
 (
__cÚ¡
 *
__fe
, 
__mode_t
 
__mode
è
	`__nÚnuÎ
 ((1));

190 #ià!
defšed
 
F_LOCK
 && (defšed 
__USE_MISC
 || (defšed 
__USE_XOPEN_EXTENDED
 \

191 && !
defšed
 
__USE_POSIX
))

200 
	#F_ULOCK
 0

	)

201 
	#F_LOCK
 1

	)

202 
	#F_TLOCK
 2

	)

203 
	#F_TEST
 3

	)

205 #iâdeà
__USE_FILE_OFFSET64


206 
	`lockf
 (
__fd
, 
__cmd
, 
__off_t
 
__Ën
);

208 #ifdeà
__REDIRECT


209 
	`__REDIRECT
 (
lockf
, (
__fd
, 
__cmd
, 
__off64_t
 
__Ën
), 
lockf64
);

211 
	#lockf
 
lockf64


	)

214 #ifdeà
__USE_LARGEFILE64


215 
	`lockf64
 (
__fd
, 
__cmd
, 
__off64_t
 
__Ën
);

219 #ifdeà
__USE_XOPEN2K


222 #iâdeà
__USE_FILE_OFFSET64


223 
	$posix_çdvi£
 (
__fd
, 
__off_t
 
__off£t
, __off_ˆ
__Ën
,

224 
__advi£
è
__THROW
;

226 #ifdeà
__REDIRECT_NTH


227 
	`__REDIRECT_NTH
 (
posix_çdvi£
, (
__fd
, 
__off64_t
 
__off£t
,

228 
__off64_t
 
__Ën
, 
__advi£
),

229 
posix_çdvi£64
);

231 
	#posix_çdvi£
 
posix_çdvi£64


	)

234 #ifdeà
__USE_LARGEFILE64


235 
	$posix_çdvi£64
 (
__fd
, 
__off64_t
 
__off£t
, __off64_ˆ
__Ën
,

236 
__advi£
è
__THROW
;

244 #iâdeà
__USE_FILE_OFFSET64


245 
	`posix_çÎoÿ‹
 (
__fd
, 
__off_t
 
__off£t
, __off_ˆ
__Ën
);

247 #ifdeà
__REDIRECT


248 
	`__REDIRECT
 (
posix_çÎoÿ‹
, (
__fd
, 
__off64_t
 
__off£t
,

249 
__off64_t
 
__Ën
),

250 
posix_çÎoÿ‹64
);

252 
	#posix_çÎoÿ‹
 
posix_çÎoÿ‹64


	)

255 #ifdeà
__USE_LARGEFILE64


256 
	`posix_çÎoÿ‹64
 (
__fd
, 
__off64_t
 
__off£t
, __off64_ˆ
__Ën
);

262 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__ex‹º_®ways_šlše
 \

263 && 
defšed
 
__va_¬g_·ck_Ën


264 
	~<b™s/fú2.h
>

267 
__END_DECLS


	@/usr/include/malloc.h

21 #iâdeà
_MALLOC_H


22 
	#_MALLOC_H
 1

	)

24 
	~<ã©u»s.h
>

25 
	~<¡ddef.h
>

26 
	~<¡dio.h
>

27 
	#__m®loc_±r_t
 *

	)

30 
	#__m®loc_size_t
 
size_t


	)

31 
	#__m®loc_±rdiff_t
 
±rdiff_t


	)

33 #ifdeà
__GNUC__


35 
	#__MALLOC_P
(
¬gs
è¬g 
__THROW


	)

38 
	#__MALLOC_PMT
(
¬gs
è
	)
args

42 
	#__MALLOC_P
(
¬gs
è
	)
args

43 
	#__MALLOC_PMT
(
¬gs
è
	)
args

48 
__BEGIN_DECLS


51 *
m®loc
 
__MALLOC_P
 ((
size_t
 
__size
)è
__©Œibu‹_m®loc__
 
__wur
;

54 *
ÿÎoc
 
__MALLOC_P
 ((
size_t
 
__nmemb
, size_ˆ
__size
))

55 
__©Œibu‹_m®loc__
 
__wur
;

62 *
»®loc
 
__MALLOC_P
 ((*
__±r
, 
size_t
 
__size
))

63 
__©Œibu‹_w¬n_unu£d_»suÉ__
;

66 
ä“
 
__MALLOC_P
 ((*
__±r
));

69 
cä“
 
__MALLOC_P
 ((*
__±r
));

72 *
mem®ign
 
__MALLOC_P
 ((
size_t
 
__®ignm’t
, size_ˆ
__size
))

73 
__©Œibu‹_m®loc__
 
__wur
;

76 *
v®loc
 
__MALLOC_P
 ((
size_t
 
__size
))

77 
__©Œibu‹_m®loc__
 
__wur
;

81 * 
pv®loc
 
__MALLOC_P
 ((
size_t
 
__size
))

82 
__©Œibu‹_m®loc__
 
__wur
;

86 *(*
__mÜecÜe
è
__MALLOC_PMT
 ((
±rdiff_t
 
__size
));

89 *
__deçuÉ_mÜecÜe
 
__MALLOC_P
 ((
±rdiff_t
 
__size
))

90 
__©Œibu‹_m®loc__
;

94 
	sm®lšfo
 {

95 
	m¬’a
;

96 
	mÜdblks
;

97 
	msmblks
;

98 
	mhblks
;

99 
	mhblkhd
;

100 
	musmblks
;

101 
	mfsmblks
;

102 
	muÜdblks
;

103 
	mfÜdblks
;

104 
	mk“pco¡
;

108 
m®lšfo
 m®lšfØ
__MALLOC_P
 (());

111 #iâdeà
M_MXFAST


112 
	#M_MXFAST
 1

	)

114 #iâdeà
M_NLBLKS


115 
	#M_NLBLKS
 2

	)

117 #iâdeà
M_GRAIN


118 
	#M_GRAIN
 3

	)

120 #iâdeà
M_KEEP


121 
	#M_KEEP
 4

	)

125 
	#M_TRIM_THRESHOLD
 -1

	)

126 
	#M_TOP_PAD
 -2

	)

127 
	#M_MMAP_THRESHOLD
 -3

	)

128 
	#M_MMAP_MAX
 -4

	)

129 
	#M_CHECK_ACTION
 -5

	)

130 
	#M_PERTURB
 -6

	)

131 
	#M_ARENA_TEST
 -7

	)

132 
	#M_ARENA_MAX
 -8

	)

135 
m®lİt
 
__MALLOC_P
 ((
__·¿m
, 
__v®
));

139 
m®loc_Œim
 
__MALLOC_P
 ((
size_t
 
__·d
));

143 
size_t
 
m®loc_u§bË_size
 
__MALLOC_P
 ((*
__±r
));

146 
m®loc_¡©s
 
__MALLOC_P
 (());

149 
m®loc_šfo
 (
__İtiÚs
, 
FILE
 *
__å
);

152 *
m®loc_g‘_¡©e
 
__MALLOC_P
 (());

156 
m®loc_£t_¡©e
 
__MALLOC_P
 ((*
__±r
));

161 (*
__m®loc_š™Ÿlize_hook
è
	`__MALLOC_PMT
 (());

163 (*
__ä“_hook
è
	`__MALLOC_PMT
 ((*
__±r
,

164 
__cÚ¡
 
__m®loc_±r_t
));

165 *(*
__m®loc_hook
è
	`__MALLOC_PMT
 ((
size_t
 
__size
,

166 
__cÚ¡
 
__m®loc_±r_t
));

167 *(*
__»®loc_hook
è
	`__MALLOC_PMT
 ((*
__±r
, 
size_t
 
__size
,

168 
__cÚ¡
 
__m®loc_±r_t
));

169 *(*
__mem®ign_hook
è
	`__MALLOC_PMT
 ((
size_t
 
__®ignm’t
,

170 
size_t
 
__size
,

171 
__cÚ¡
 
__m®loc_±r_t
));

172 (*
__aá”_mÜecÜe_hook
è
	`__MALLOC_PMT
 (());

175 
__m®loc_check_š™
 
	`__MALLOC_P
 (());

178 
__END_DECLS


	@/usr/include/stdint.h

23 #iâdeà
_STDINT_H


24 
	#_STDINT_H
 1

	)

26 
	~<ã©u»s.h
>

27 
	~<b™s/wch¬.h
>

28 
	~<b™s/wÜdsize.h
>

35 #iâdeà
__št8_t_defšed


36 
	#__št8_t_defšed


	)

37 sigÃd 
	tšt8_t
;

38 
	tšt16_t
;

39 
	tšt32_t
;

40 #ià
__WORDSIZE
 == 64

41 
	tšt64_t
;

43 
__ex‹nsiÚ__


44 
	tšt64_t
;

49 
	tušt8_t
;

50 
	tušt16_t
;

51 #iâdeà
__ušt32_t_defšed


52 
	tušt32_t
;

53 
	#__ušt32_t_defšed


	)

55 #ià
__WORDSIZE
 == 64

56 
	tušt64_t
;

58 
__ex‹nsiÚ__


59 
	tušt64_t
;

66 sigÃd 
	tšt_Ëa¡8_t
;

67 
	tšt_Ëa¡16_t
;

68 
	tšt_Ëa¡32_t
;

69 #ià
__WORDSIZE
 == 64

70 
	tšt_Ëa¡64_t
;

72 
__ex‹nsiÚ__


73 
	tšt_Ëa¡64_t
;

77 
	tušt_Ëa¡8_t
;

78 
	tušt_Ëa¡16_t
;

79 
	tušt_Ëa¡32_t
;

80 #ià
__WORDSIZE
 == 64

81 
	tušt_Ëa¡64_t
;

83 
__ex‹nsiÚ__


84 
	tušt_Ëa¡64_t
;

91 sigÃd 
	tšt_ç¡8_t
;

92 #ià
__WORDSIZE
 == 64

93 
	tšt_ç¡16_t
;

94 
	tšt_ç¡32_t
;

95 
	tšt_ç¡64_t
;

97 
	tšt_ç¡16_t
;

98 
	tšt_ç¡32_t
;

99 
__ex‹nsiÚ__


100 
	tšt_ç¡64_t
;

104 
	tušt_ç¡8_t
;

105 #ià
__WORDSIZE
 == 64

106 
	tušt_ç¡16_t
;

107 
	tušt_ç¡32_t
;

108 
	tušt_ç¡64_t
;

110 
	tušt_ç¡16_t
;

111 
	tušt_ç¡32_t
;

112 
__ex‹nsiÚ__


113 
	tušt_ç¡64_t
;

118 #ià
__WORDSIZE
 == 64

119 #iâdeà
__šŒ_t_defšed


120 
	tšŒ_t
;

121 
	#__šŒ_t_defšed


	)

123 
	tušŒ_t
;

125 #iâdeà
__šŒ_t_defšed


126 
	tšŒ_t
;

127 
	#__šŒ_t_defšed


	)

129 
	tušŒ_t
;

134 #ià
__WORDSIZE
 == 64

135 
	tštmax_t
;

136 
	tuštmax_t
;

138 
__ex‹nsiÚ__


139 
	tštmax_t
;

140 
__ex‹nsiÚ__


141 
	tuštmax_t
;

147 #ià!
defšed
 
__ılu¥lus
 || defšed 
__STDC_LIMIT_MACROS


149 #ià
__WORDSIZE
 == 64

150 
	#__INT64_C
(
c
èø## 
L


	)

151 
	#__UINT64_C
(
c
èø## 
UL


	)

153 
	#__INT64_C
(
c
èø## 
LL


	)

154 
	#__UINT64_C
(
c
èø## 
ULL


	)

160 
	#INT8_MIN
 (-128)

	)

161 
	#INT16_MIN
 (-32767-1)

	)

162 
	#INT32_MIN
 (-2147483647-1)

	)

163 
	#INT64_MIN
 (-
	`__INT64_C
(9223372036854775807)-1)

	)

165 
	#INT8_MAX
 (127)

	)

166 
	#INT16_MAX
 (32767)

	)

167 
	#INT32_MAX
 (2147483647)

	)

168 
	#INT64_MAX
 (
	`__INT64_C
(9223372036854775807))

	)

171 
	#UINT8_MAX
 (255)

	)

172 
	#UINT16_MAX
 (65535)

	)

173 
	#UINT32_MAX
 (4294967295U)

	)

174 
	#UINT64_MAX
 (
	`__UINT64_C
(18446744073709551615))

	)

178 
	#INT_LEAST8_MIN
 (-128)

	)

179 
	#INT_LEAST16_MIN
 (-32767-1)

	)

180 
	#INT_LEAST32_MIN
 (-2147483647-1)

	)

181 
	#INT_LEAST64_MIN
 (-
	`__INT64_C
(9223372036854775807)-1)

	)

183 
	#INT_LEAST8_MAX
 (127)

	)

184 
	#INT_LEAST16_MAX
 (32767)

	)

185 
	#INT_LEAST32_MAX
 (2147483647)

	)

186 
	#INT_LEAST64_MAX
 (
	`__INT64_C
(9223372036854775807))

	)

189 
	#UINT_LEAST8_MAX
 (255)

	)

190 
	#UINT_LEAST16_MAX
 (65535)

	)

191 
	#UINT_LEAST32_MAX
 (4294967295U)

	)

192 
	#UINT_LEAST64_MAX
 (
	`__UINT64_C
(18446744073709551615))

	)

196 
	#INT_FAST8_MIN
 (-128)

	)

197 #ià
__WORDSIZE
 == 64

198 
	#INT_FAST16_MIN
 (-9223372036854775807L-1)

	)

199 
	#INT_FAST32_MIN
 (-9223372036854775807L-1)

	)

201 
	#INT_FAST16_MIN
 (-2147483647-1)

	)

202 
	#INT_FAST32_MIN
 (-2147483647-1)

	)

204 
	#INT_FAST64_MIN
 (-
	`__INT64_C
(9223372036854775807)-1)

	)

206 
	#INT_FAST8_MAX
 (127)

	)

207 #ià
__WORDSIZE
 == 64

208 
	#INT_FAST16_MAX
 (9223372036854775807L)

	)

209 
	#INT_FAST32_MAX
 (9223372036854775807L)

	)

211 
	#INT_FAST16_MAX
 (2147483647)

	)

212 
	#INT_FAST32_MAX
 (2147483647)

	)

214 
	#INT_FAST64_MAX
 (
	`__INT64_C
(9223372036854775807))

	)

217 
	#UINT_FAST8_MAX
 (255)

	)

218 #ià
__WORDSIZE
 == 64

219 
	#UINT_FAST16_MAX
 (18446744073709551615UL)

	)

220 
	#UINT_FAST32_MAX
 (18446744073709551615UL)

	)

222 
	#UINT_FAST16_MAX
 (4294967295U)

	)

223 
	#UINT_FAST32_MAX
 (4294967295U)

	)

225 
	#UINT_FAST64_MAX
 (
	`__UINT64_C
(18446744073709551615))

	)

229 #ià
__WORDSIZE
 == 64

230 
	#INTPTR_MIN
 (-9223372036854775807L-1)

	)

231 
	#INTPTR_MAX
 (9223372036854775807L)

	)

232 
	#UINTPTR_MAX
 (18446744073709551615UL)

	)

234 
	#INTPTR_MIN
 (-2147483647-1)

	)

235 
	#INTPTR_MAX
 (2147483647)

	)

236 
	#UINTPTR_MAX
 (4294967295U)

	)

241 
	#INTMAX_MIN
 (-
	`__INT64_C
(9223372036854775807)-1)

	)

243 
	#INTMAX_MAX
 (
	`__INT64_C
(9223372036854775807))

	)

246 
	#UINTMAX_MAX
 (
	`__UINT64_C
(18446744073709551615))

	)

252 #ià
__WORDSIZE
 == 64

253 
	#PTRDIFF_MIN
 (-9223372036854775807L-1)

	)

254 
	#PTRDIFF_MAX
 (9223372036854775807L)

	)

256 
	#PTRDIFF_MIN
 (-2147483647-1)

	)

257 
	#PTRDIFF_MAX
 (2147483647)

	)

261 
	#SIG_ATOMIC_MIN
 (-2147483647-1)

	)

262 
	#SIG_ATOMIC_MAX
 (2147483647)

	)

265 #ià
__WORDSIZE
 == 64

266 
	#SIZE_MAX
 (18446744073709551615UL)

	)

268 
	#SIZE_MAX
 (4294967295U)

	)

272 #iâdeà
WCHAR_MIN


274 
	#WCHAR_MIN
 
__WCHAR_MIN


	)

275 
	#WCHAR_MAX
 
__WCHAR_MAX


	)

279 
	#WINT_MIN
 (0u)

	)

280 
	#WINT_MAX
 (4294967295u)

	)

287 #ià!
defšed
 
__ılu¥lus
 || defšed 
__STDC_CONSTANT_MACROS


290 
	#INT8_C
(
c
è
	)
c

291 
	#INT16_C
(
c
è
	)
c

292 
	#INT32_C
(
c
è
	)
c

293 #ià
__WORDSIZE
 == 64

294 
	#INT64_C
(
c
èø## 
L


	)

296 
	#INT64_C
(
c
èø## 
LL


	)

300 
	#UINT8_C
(
c
è
	)
c

301 
	#UINT16_C
(
c
è
	)
c

302 
	#UINT32_C
(
c
èø## 
U


	)

303 #ià
__WORDSIZE
 == 64

304 
	#UINT64_C
(
c
èø## 
UL


	)

306 
	#UINT64_C
(
c
èø## 
ULL


	)

310 #ià
__WORDSIZE
 == 64

311 
	#INTMAX_C
(
c
èø## 
L


	)

312 
	#UINTMAX_C
(
c
èø## 
UL


	)

314 
	#INTMAX_C
(
c
èø## 
LL


	)

315 
	#UINTMAX_C
(
c
èø## 
ULL


	)

	@/usr/include/stdio.h

24 #iâdeà
_STDIO_H


26 #ià!
defšed
 
__Ãed_FILE
 && !defšed 
__Ãed___FILE


27 
	#_STDIO_H
 1

	)

28 
	~<ã©u»s.h
>

30 
	g__BEGIN_DECLS


32 
	#__Ãed_size_t


	)

33 
	#__Ãed_NULL


	)

34 
	~<¡ddef.h
>

36 
	~<b™s/ty³s.h
>

37 
	#__Ãed_FILE


	)

38 
	#__Ãed___FILE


	)

42 #ià!
defšed
 
__FILE_defšed
 && defšed 
__Ãed_FILE


45 
	g_IO_FILE
;

47 
__BEGIN_NAMESPACE_STD


49 
_IO_FILE
 
	tFILE
;

50 
	g__END_NAMESPACE_STD


51 #ià
defšed
 
__USE_LARGEFILE64
 || defšed 
__USE_SVID
 || defšed 
__USE_POSIX
 \

52 || 
defšed
 
	g__USE_BSD
 || defšed 
	g__USE_ISOC99
 || defšed 
	g__USE_XOPEN
 \

53 || 
defšed
 
__USE_POSIX2


54 
	$__USING_NAMESPACE_STD
(
FILE
)

57 
	#__FILE_defšed
 1

	)

59 #undeà
__Ãed_FILE


62 #ià!
defšed
 
____FILE_defšed
 && defšed 
__Ãed___FILE


65 
_IO_FILE
 
	t__FILE
;

67 
	#____FILE_defšed
 1

	)

69 #undeà
__Ãed___FILE


72 #ifdef 
_STDIO_H


73 
	#_STDIO_USES_IOSTREAM


	)

75 
	~<libio.h
>

77 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8


78 #ifdeà
__GNUC__


79 #iâdeà
_VA_LIST_DEFINED


80 
_G_va_li¡
 
	tva_li¡
;

81 
	#_VA_LIST_DEFINED


	)

84 
	~<¡d¬g.h
>

88 #ifdeà
__USE_XOPEN2K8


89 #iâdeà
__off_t_defšed


90 #iâdeà
__USE_FILE_OFFSET64


91 
__off_t
 
	toff_t
;

93 
__off64_t
 
	toff_t
;

95 
	#__off_t_defšed


	)

97 #ià
defšed
 
__USE_LARGEFILE64
 && !defšed 
__off64_t_defšed


98 
__off64_t
 
	toff64_t
;

99 
	#__off64_t_defšed


	)

102 #iâdeà
__ssize_t_defšed


103 
__ssize_t
 
	tssize_t
;

104 
	#__ssize_t_defšed


	)

109 
__BEGIN_NAMESPACE_STD


110 #iâdeà
__USE_FILE_OFFSET64


111 
_G_åos_t
 
	tåos_t
;

113 
_G_åos64_t
 
	tåos_t
;

115 
__END_NAMESPACE_STD


116 #ifdeà
__USE_LARGEFILE64


117 
_G_åos64_t
 
	tåos64_t
;

121 
	#_IOFBF
 0

	)

122 
	#_IOLBF
 1

	)

123 
	#_IONBF
 2

	)

127 #iâdeà
BUFSIZ


128 
	#BUFSIZ
 
_IO_BUFSIZ


	)

134 #iâdeà
EOF


135 
	#EOF
 (-1)

	)

141 
	#SEEK_SET
 0

	)

142 
	#SEEK_CUR
 1

	)

143 
	#SEEK_END
 2

	)

146 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN


148 
	#P_tmpdœ
 "/tmp"

	)

161 
	~<b™s/¡dio_lim.h
>

165 
_IO_FILE
 *
¡dš
;

166 
_IO_FILE
 *
¡dout
;

167 
_IO_FILE
 *
¡d”r
;

168 #ifdeà
__STDC__


170 
	#¡dš
 
¡dš


	)

171 
	#¡dout
 
¡dout


	)

172 
	#¡d”r
 
¡d”r


	)

175 
__BEGIN_NAMESPACE_STD


177 
	$»move
 (
__cÚ¡
 *
__f’ame
è
__THROW
;

179 
	$»Çme
 (
__cÚ¡
 *
__Şd
, __cÚ¡ *
__Ãw
è
__THROW
;

180 
__END_NAMESPACE_STD


182 #ifdeà
__USE_ATFILE


184 
	$»Çm—t
 (
__Şdfd
, 
__cÚ¡
 *
__Şd
, 
__Ãwfd
,

185 
__cÚ¡
 *
__Ãw
è
__THROW
;

188 
__BEGIN_NAMESPACE_STD


193 #iâdeà
__USE_FILE_OFFSET64


194 
FILE
 *
	$tmpfe
 (è
__wur
;

196 #ifdeà
__REDIRECT


197 
FILE
 *
	`__REDIRECT
 (
tmpfe
, (), 
tmpfe64
è
__wur
;

199 
	#tmpfe
 
tmpfe64


	)

203 #ifdeà
__USE_LARGEFILE64


204 
FILE
 *
	$tmpfe64
 (è
__wur
;

208 *
	$tm²am
 (*
__s
è
__THROW
 
__wur
;

209 
__END_NAMESPACE_STD


211 #ifdeà
__USE_MISC


214 *
	$tm²am_r
 (*
__s
è
__THROW
 
__wur
;

218 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN


226 *
	$‹m²am
 (
__cÚ¡
 *
__dœ
, __cÚ¡ *
__pfx
)

227 
__THROW
 
__©Œibu‹_m®loc__
 
__wur
;

231 
__BEGIN_NAMESPACE_STD


236 
	`fşo£
 (
FILE
 *
__¡»am
);

241 
	`fæush
 (
FILE
 *
__¡»am
);

242 
__END_NAMESPACE_STD


244 #ifdeà
__USE_MISC


251 
	`fæush_uÆocked
 (
FILE
 *
__¡»am
);

254 #ifdeà
__USE_GNU


261 
	`fşo£®l
 ();

265 
__BEGIN_NAMESPACE_STD


266 #iâdeà
__USE_FILE_OFFSET64


271 
FILE
 *
	$fİ’
 (
__cÚ¡
 *
__»¡riù
 
__f’ame
,

272 
__cÚ¡
 *
__»¡riù
 
__modes
è
__wur
;

277 
FILE
 *
	$äeİ’
 (
__cÚ¡
 *
__»¡riù
 
__f’ame
,

278 
__cÚ¡
 *
__»¡riù
 
__modes
,

279 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

281 #ifdeà
__REDIRECT


282 
FILE
 *
	`__REDIRECT
 (
fİ’
, (
__cÚ¡
 *
__»¡riù
 
__f’ame
,

283 
__cÚ¡
 *
__»¡riù
 
__modes
), 
fİ’64
)

284 
__wur
;

285 
FILE
 *
	`__REDIRECT
 (
äeİ’
, (
__cÚ¡
 *
__»¡riù
 
__f’ame
,

286 
__cÚ¡
 *
__»¡riù
 
__modes
,

287 
FILE
 *
__»¡riù
 
__¡»am
), 
äeİ’64
)

288 
__wur
;

290 
	#fİ’
 
fİ’64


	)

291 
	#äeİ’
 
äeİ’64


	)

294 
__END_NAMESPACE_STD


295 #ifdeà
__USE_LARGEFILE64


296 
FILE
 *
	$fİ’64
 (
__cÚ¡
 *
__»¡riù
 
__f’ame
,

297 
__cÚ¡
 *
__»¡riù
 
__modes
è
__wur
;

298 
FILE
 *
	$äeİ’64
 (
__cÚ¡
 *
__»¡riù
 
__f’ame
,

299 
__cÚ¡
 *
__»¡riù
 
__modes
,

300 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

303 #ifdef 
__USE_POSIX


305 
FILE
 *
	$fdİ’
 (
__fd
, 
__cÚ¡
 *
__modes
è
__THROW
 
__wur
;

308 #ifdef 
__USE_GNU


311 
FILE
 *
	$fİ’cook›
 (*
__»¡riù
 
__magic_cook›
,

312 
__cÚ¡
 *
__»¡riù
 
__modes
,

313 
_IO_cook›_io_funùiÚs_t
 
__io_funcs
è
__THROW
 
__wur
;

316 #ifdeà
__USE_XOPEN2K8


318 
FILE
 *
	$fmemİ’
 (*
__s
, 
size_t
 
__Ën
, 
__cÚ¡
 *
__modes
)

319 
__THROW
 
__wur
;

324 
FILE
 *
	$İ’_mem¡»am
 (**
__buæoc
, 
size_t
 *
__siz–oc
è
__THROW
 
__wur
;

328 
__BEGIN_NAMESPACE_STD


331 
	$£tbuf
 (
FILE
 *
__»¡riù
 
__¡»am
, *__»¡riù 
__buf
è
__THROW
;

335 
	$£tvbuf
 (
FILE
 *
__»¡riù
 
__¡»am
, *__»¡riù 
__buf
,

336 
__modes
, 
size_t
 
__n
è
__THROW
;

337 
__END_NAMESPACE_STD


339 #ifdef 
__USE_BSD


342 
	$£tbufãr
 (
FILE
 *
__»¡riù
 
__¡»am
, *__»¡riù 
__buf
,

343 
size_t
 
__size
è
__THROW
;

346 
	$£šebuf
 (
FILE
 *
__¡»am
è
__THROW
;

350 
__BEGIN_NAMESPACE_STD


355 
	`årštf
 (
FILE
 *
__»¡riù
 
__¡»am
,

356 
__cÚ¡
 *
__»¡riù
 
__fÜm©
, ...);

361 
	`´štf
 (
__cÚ¡
 *
__»¡riù
 
__fÜm©
, ...);

363 
	$¥rštf
 (*
__»¡riù
 
__s
,

364 
__cÚ¡
 *
__»¡riù
 
__fÜm©
, ...è
__THROW
;

370 
	`vårštf
 (
FILE
 *
__»¡riù
 
__s
, 
__cÚ¡
 *__»¡riù 
__fÜm©
,

371 
_G_va_li¡
 
__¬g
);

376 
	`v´štf
 (
__cÚ¡
 *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__¬g
);

378 
	$v¥rštf
 (*
__»¡riù
 
__s
, 
__cÚ¡
 *__»¡riù 
__fÜm©
,

379 
_G_va_li¡
 
__¬g
è
__THROW
;

380 
__END_NAMESPACE_STD


382 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_ISOC99
 || defšed 
__USE_UNIX98


383 
__BEGIN_NAMESPACE_C99


385 
	$¢´štf
 (*
__»¡riù
 
__s
, 
size_t
 
__maxËn
,

386 
__cÚ¡
 *
__»¡riù
 
__fÜm©
, ...)

387 
__THROW
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 3, 4)));

389 
	$v¢´štf
 (*
__»¡riù
 
__s
, 
size_t
 
__maxËn
,

390 
__cÚ¡
 *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__¬g
)

391 
__THROW
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 3, 0)));

392 
__END_NAMESPACE_C99


395 #ifdeà
__USE_GNU


398 
	$va¥rštf
 (**
__»¡riù
 
__±r
, 
__cÚ¡
 *__»¡riù 
__f
,

399 
_G_va_li¡
 
__¬g
)

400 
__THROW
 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__´štf__
, 2, 0))è
__wur
;

401 
	$__a¥rštf
 (**
__»¡riù
 
__±r
,

402 
__cÚ¡
 *
__»¡riù
 
__fmt
, ...)

403 
__THROW
 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__´štf__
, 2, 3))è
__wur
;

404 
	$a¥rštf
 (**
__»¡riù
 
__±r
,

405 
__cÚ¡
 *
__»¡riù
 
__fmt
, ...)

406 
__THROW
 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__´štf__
, 2, 3))è
__wur
;

409 #ifdeà
__USE_XOPEN2K8


416 
	$vd´štf
 (
__fd
, 
__cÚ¡
 *
__»¡riù
 
__fmt
,

417 
_G_va_li¡
 
__¬g
)

418 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 2, 0)));

419 
	$d´štf
 (
__fd
, 
__cÚ¡
 *
__»¡riù
 
__fmt
, ...)

420 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 2, 3)));

424 
__BEGIN_NAMESPACE_STD


429 
	$fsÿnf
 (
FILE
 *
__»¡riù
 
__¡»am
,

430 
__cÚ¡
 *
__»¡riù
 
__fÜm©
, ...è
__wur
;

435 
	$sÿnf
 (
__cÚ¡
 *
__»¡riù
 
__fÜm©
, ...è
__wur
;

437 
	$ssÿnf
 (
__cÚ¡
 *
__»¡riù
 
__s
,

438 
__cÚ¡
 *
__»¡riù
 
__fÜm©
, ...è
__THROW
;

440 #ià
defšed
 
__USE_ISOC99
 && !defšed 
__USE_GNU
 \

441 && (!
defšed
 
__LDBL_COMPAT
 || !defšed 
__REDIRECT
) \

442 && (
defšed
 
__STRICT_ANSI__
 || defšed 
__USE_XOPEN2K
)

443 #ifdeà
__REDIRECT


447 
	`__REDIRECT
 (
fsÿnf
, (
FILE
 *
__»¡riù
 
__¡»am
,

448 
__cÚ¡
 *
__»¡riù
 
__fÜm©
, ...),

449 
__isoc99_fsÿnf
è
__wur
;

450 
	`__REDIRECT
 (
sÿnf
, (
__cÚ¡
 *
__»¡riù
 
__fÜm©
, ...),

451 
__isoc99_sÿnf
è
__wur
;

452 
	`__REDIRECT
 (
ssÿnf
, (
__cÚ¡
 *
__»¡riù
 
__s
,

453 
__cÚ¡
 *
__»¡riù
 
__fÜm©
, ...),

454 
__isoc99_ssÿnf
è
__THROW
;

456 
	$__isoc99_fsÿnf
 (
FILE
 *
__»¡riù
 
__¡»am
,

457 
__cÚ¡
 *
__»¡riù
 
__fÜm©
, ...è
__wur
;

458 
	$__isoc99_sÿnf
 (
__cÚ¡
 *
__»¡riù
 
__fÜm©
, ...è
__wur
;

459 
	$__isoc99_ssÿnf
 (
__cÚ¡
 *
__»¡riù
 
__s
,

460 
__cÚ¡
 *
__»¡riù
 
__fÜm©
, ...è
__THROW
;

461 
	#fsÿnf
 
__isoc99_fsÿnf


	)

462 
	#sÿnf
 
__isoc99_sÿnf


	)

463 
	#ssÿnf
 
__isoc99_ssÿnf


	)

467 
__END_NAMESPACE_STD


469 #ifdef 
__USE_ISOC99


470 
__BEGIN_NAMESPACE_C99


475 
	$vfsÿnf
 (
FILE
 *
__»¡riù
 
__s
, 
__cÚ¡
 *__»¡riù 
__fÜm©
,

476 
_G_va_li¡
 
__¬g
)

477 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__sÿnf__
, 2, 0))è
__wur
;

483 
	$vsÿnf
 (
__cÚ¡
 *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__¬g
)

484 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__sÿnf__
, 1, 0))è
__wur
;

487 
	$vssÿnf
 (
__cÚ¡
 *
__»¡riù
 
__s
,

488 
__cÚ¡
 *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__¬g
)

489 
__THROW
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__sÿnf__
, 2, 0)));

491 #ià!
defšed
 
__USE_GNU
 \

492 && (!
defšed
 
__LDBL_COMPAT
 || !defšed 
__REDIRECT
) \

493 && (
defšed
 
__STRICT_ANSI__
 || defšed 
__USE_XOPEN2K
)

494 #ifdeà
__REDIRECT


498 
	`__REDIRECT
 (
vfsÿnf
,

499 (
FILE
 *
__»¡riù
 
__s
,

500 
__cÚ¡
 *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__¬g
),

501 
__isoc99_vfsÿnf
)

502 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__sÿnf__
, 2, 0))è
__wur
;

503 
	`__REDIRECT
 (
vsÿnf
, (
__cÚ¡
 *
__»¡riù
 
__fÜm©
,

504 
_G_va_li¡
 
__¬g
), 
__isoc99_vsÿnf
)

505 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__sÿnf__
, 1, 0))è
__wur
;

506 
	`__REDIRECT
 (
vssÿnf
,

507 (
__cÚ¡
 *
__»¡riù
 
__s
,

508 
__cÚ¡
 *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__¬g
),

509 
__isoc99_vssÿnf
)

510 
__THROW
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__sÿnf__
, 2, 0)));

512 
	$__isoc99_vfsÿnf
 (
FILE
 *
__»¡riù
 
__s
,

513 
__cÚ¡
 *
__»¡riù
 
__fÜm©
,

514 
_G_va_li¡
 
__¬g
è
__wur
;

515 
	$__isoc99_vsÿnf
 (
__cÚ¡
 *
__»¡riù
 
__fÜm©
,

516 
_G_va_li¡
 
__¬g
è
__wur
;

517 
	$__isoc99_vssÿnf
 (
__cÚ¡
 *
__»¡riù
 
__s
,

518 
__cÚ¡
 *
__»¡riù
 
__fÜm©
,

519 
_G_va_li¡
 
__¬g
è
__THROW
;

520 
	#vfsÿnf
 
__isoc99_vfsÿnf


	)

521 
	#vsÿnf
 
__isoc99_vsÿnf


	)

522 
	#vssÿnf
 
__isoc99_vssÿnf


	)

526 
__END_NAMESPACE_C99


530 
__BEGIN_NAMESPACE_STD


535 
	`fg‘c
 (
FILE
 *
__¡»am
);

536 
	`g‘c
 (
FILE
 *
__¡»am
);

542 
	`g‘ch¬
 ();

543 
__END_NAMESPACE_STD


547 
	#g‘c
(
_å
è
	`_IO_g‘c
 (_å)

	)

549 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC


554 
	`g‘c_uÆocked
 (
FILE
 *
__¡»am
);

555 
	`g‘ch¬_uÆocked
 ();

558 #ifdeà
__USE_MISC


565 
	`fg‘c_uÆocked
 (
FILE
 *
__¡»am
);

569 
__BEGIN_NAMESPACE_STD


577 
	`åutc
 (
__c
, 
FILE
 *
__¡»am
);

578 
	`putc
 (
__c
, 
FILE
 *
__¡»am
);

584 
	`putch¬
 (
__c
);

585 
__END_NAMESPACE_STD


589 
	#putc
(
_ch
, 
_å
è
	`_IO_putc
 (_ch, _å)

	)

591 #ifdeà
__USE_MISC


598 
	`åutc_uÆocked
 (
__c
, 
FILE
 *
__¡»am
);

601 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC


606 
	`putc_uÆocked
 (
__c
, 
FILE
 *
__¡»am
);

607 
	`putch¬_uÆocked
 (
__c
);

611 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_MISC
 \

612 || (
defšed
 
__USE_XOPEN
 && !defšed 
__USE_XOPEN2K
)

614 
	`g‘w
 (
FILE
 *
__¡»am
);

617 
	`putw
 (
__w
, 
FILE
 *
__¡»am
);

621 
__BEGIN_NAMESPACE_STD


626 *
	$fg‘s
 (*
__»¡riù
 
__s
, 
__n
, 
FILE
 *__»¡riù 
__¡»am
)

627 
__wur
;

634 *
	$g‘s
 (*
__s
è
__wur
;

635 
__END_NAMESPACE_STD


637 #ifdeà
__USE_GNU


644 *
	$fg‘s_uÆocked
 (*
__»¡riù
 
__s
, 
__n
,

645 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

649 #ifdef 
__USE_XOPEN2K8


660 
_IO_ssize_t
 
	$__g‘d–im
 (**
__»¡riù
 
__lš•Œ
,

661 
size_t
 *
__»¡riù
 
__n
, 
__d–im™”
,

662 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

663 
_IO_ssize_t
 
	$g‘d–im
 (**
__»¡riù
 
__lš•Œ
,

664 
size_t
 *
__»¡riù
 
__n
, 
__d–im™”
,

665 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

673 
_IO_ssize_t
 
	$g‘lše
 (**
__»¡riù
 
__lš•Œ
,

674 
size_t
 *
__»¡riù
 
__n
,

675 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

679 
__BEGIN_NAMESPACE_STD


684 
	`åuts
 (
__cÚ¡
 *
__»¡riù
 
__s
, 
FILE
 *__»¡riù 
__¡»am
);

690 
	`puts
 (
__cÚ¡
 *
__s
);

697 
	`ung‘c
 (
__c
, 
FILE
 *
__¡»am
);

704 
size_t
 
	$ä—d
 (*
__»¡riù
 
__±r
, 
size_t
 
__size
,

705 
size_t
 
__n
, 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

710 
size_t
 
	$fwr™e
 (
__cÚ¡
 *
__»¡riù
 
__±r
, 
size_t
 
__size
,

711 
size_t
 
__n
, 
FILE
 *
__»¡riù
 
__s
è
__wur
;

712 
__END_NAMESPACE_STD


714 #ifdeà
__USE_GNU


721 
	`åuts_uÆocked
 (
__cÚ¡
 *
__»¡riù
 
__s
,

722 
FILE
 *
__»¡riù
 
__¡»am
);

725 #ifdeà
__USE_MISC


732 
size_t
 
	$ä—d_uÆocked
 (*
__»¡riù
 
__±r
, 
size_t
 
__size
,

733 
size_t
 
__n
, 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

734 
size_t
 
	$fwr™e_uÆocked
 (
__cÚ¡
 *
__»¡riù
 
__±r
, 
size_t
 
__size
,

735 
size_t
 
__n
, 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

739 
__BEGIN_NAMESPACE_STD


744 
	`f£ek
 (
FILE
 *
__¡»am
, 
__off
, 
__wh’û
);

749 
	$á–l
 (
FILE
 *
__¡»am
è
__wur
;

754 
	`»wšd
 (
FILE
 *
__¡»am
);

755 
__END_NAMESPACE_STD


762 #ià
defšed
 
__USE_LARGEFILE
 || defšed 
__USE_XOPEN2K


763 #iâdeà
__USE_FILE_OFFSET64


768 
	`f£eko
 (
FILE
 *
__¡»am
, 
__off_t
 
__off
, 
__wh’û
);

773 
__off_t
 
	$á–lo
 (
FILE
 *
__¡»am
è
__wur
;

775 #ifdeà
__REDIRECT


776 
	`__REDIRECT
 (
f£eko
,

777 (
FILE
 *
__¡»am
, 
__off64_t
 
__off
, 
__wh’û
),

778 
f£eko64
);

779 
__off64_t
 
	`__REDIRECT
 (
á–lo
, (
FILE
 *
__¡»am
), 
á–lo64
);

781 
	#f£eko
 
f£eko64


	)

782 
	#á–lo
 
á–lo64


	)

787 
__BEGIN_NAMESPACE_STD


788 #iâdeà
__USE_FILE_OFFSET64


793 
	`fg‘pos
 (
FILE
 *
__»¡riù
 
__¡»am
, 
åos_t
 *__»¡riù 
__pos
);

798 
	`f£os
 (
FILE
 *
__¡»am
, 
__cÚ¡
 
åos_t
 *
__pos
);

800 #ifdeà
__REDIRECT


801 
	`__REDIRECT
 (
fg‘pos
, (
FILE
 *
__»¡riù
 
__¡»am
,

802 
åos_t
 *
__»¡riù
 
__pos
), 
fg‘pos64
);

803 
	`__REDIRECT
 (
f£os
,

804 (
FILE
 *
__¡»am
, 
__cÚ¡
 
åos_t
 *
__pos
), 
f£os64
);

806 
	#fg‘pos
 
fg‘pos64


	)

807 
	#f£os
 
f£os64


	)

810 
__END_NAMESPACE_STD


812 #ifdeà
__USE_LARGEFILE64


813 
	`f£eko64
 (
FILE
 *
__¡»am
, 
__off64_t
 
__off
, 
__wh’û
);

814 
__off64_t
 
	$á–lo64
 (
FILE
 *
__¡»am
è
__wur
;

815 
	`fg‘pos64
 (
FILE
 *
__»¡riù
 
__¡»am
, 
åos64_t
 *__»¡riù 
__pos
);

816 
	`f£os64
 (
FILE
 *
__¡»am
, 
__cÚ¡
 
åos64_t
 *
__pos
);

819 
__BEGIN_NAMESPACE_STD


821 
	$ş—»¼
 (
FILE
 *
__¡»am
è
__THROW
;

823 
	$ãof
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

825 
	$ã¼Ü
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

826 
__END_NAMESPACE_STD


828 #ifdeà
__USE_MISC


830 
	$ş—»¼_uÆocked
 (
FILE
 *
__¡»am
è
__THROW
;

831 
	$ãof_uÆocked
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

832 
	$ã¼Ü_uÆocked
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

836 
__BEGIN_NAMESPACE_STD


841 
	`³¼Ü
 (
__cÚ¡
 *
__s
);

842 
__END_NAMESPACE_STD


848 
	~<b™s/sys_”¾i¡.h
>

851 #ifdef 
__USE_POSIX


853 
	$f’o
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

856 #ifdeà
__USE_MISC


858 
	$f’o_uÆocked
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

862 #ià(
defšed
 
__USE_POSIX2
 || defšed 
__USE_SVID
 || defšed 
__USE_BSD
 || \

863 
defšed
 
__USE_MISC
)

868 
FILE
 *
	$pİ’
 (
__cÚ¡
 *
__commªd
, __cÚ¡ *
__modes
è
__wur
;

874 
	`pşo£
 (
FILE
 *
__¡»am
);

878 #ifdef 
__USE_POSIX


880 *
	$ù”mid
 (*
__s
è
__THROW
;

884 #ifdeà
__USE_XOPEN


886 *
	`cu£rid
 (*
__s
);

890 #ifdef 
__USE_GNU


891 
ob¡ack
;

894 
	$ob¡ack_´štf
 (
ob¡ack
 *
__»¡riù
 
__ob¡ack
,

895 
__cÚ¡
 *
__»¡riù
 
__fÜm©
, ...)

896 
__THROW
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 2, 3)));

897 
	$ob¡ack_v´štf
 (
ob¡ack
 *
__»¡riù
 
__ob¡ack
,

898 
__cÚ¡
 *
__»¡riù
 
__fÜm©
,

899 
_G_va_li¡
 
__¬gs
)

900 
__THROW
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 2, 0)));

904 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC


908 
	$æockfe
 (
FILE
 *
__¡»am
è
__THROW
;

912 
	$árylockfe
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

915 
	$fuÆockfe
 (
FILE
 *
__¡»am
è
__THROW
;

918 #ià
defšed
 
__USE_XOPEN
 && !defšed 
__USE_XOPEN2K
 && !defšed 
__USE_GNU


922 
	#__Ãed_g‘İt


	)

923 
	~<g‘İt.h
>

928 #ifdeà
__USE_EXTERN_INLINES


929 
	~<b™s/¡dio.h
>

931 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__ex‹º_®ways_šlše


932 
	~<b™s/¡dio2.h
>

934 #ifdeà
__LDBL_COMPAT


935 
	~<b™s/¡dio-ldbl.h
>

938 
__END_DECLS


	@/usr/include/stdlib.h

23 #iâdef 
_STDLIB_H


25 
	~<ã©u»s.h
>

28 
	#__Ãed_size_t


	)

29 #iâdeà
__Ãed_m®loc_ªd_ÿÎoc


30 
	#__Ãed_wch¬_t


	)

31 
	#__Ãed_NULL


	)

33 
	~<¡ddef.h
>

35 
	g__BEGIN_DECLS


37 #iâdeà
__Ãed_m®loc_ªd_ÿÎoc


38 
	#_STDLIB_H
 1

	)

40 #ià(
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8
è&& !defšed 
_SYS_WAIT_H


42 
	~<b™s/wa™æags.h
>

43 
	~<b™s/wa™¡©us.h
>

45 #ifdeà
__USE_BSD


50 #ià
defšed
 
__GNUC__
 && !defšed 
__ılu¥lus


51 
	#__WAIT_INT
(
¡©us
) \

52 (
	`__ex‹nsiÚ__
 (((uniÚ { 
	`__ty³of
(
¡©us
è
__š
; 
__i
; }) \

53 { .
__š
 = (
¡©us
è}).
__i
))

	)

55 
	#__WAIT_INT
(
¡©us
è(*(*è&(¡©us))

	)

63 #ià!
defšed
 
__GNUC__
 || __GNUC__ < 2 || defšed 
__ılu¥lus


64 
	#__WAIT_STATUS
 *

	)

65 
	#__WAIT_STATUS_DEFN
 *

	)

70 
wa™
 *
	m__u±r
;

71 *
	m__Œ
;

72 } 
	t__WAIT_STATUS
 
	t__©Œibu‹__
 ((
	t__Œª¥¬’t_uniÚ__
));

73 
	#__WAIT_STATUS_DEFN
 *

	)

78 
	#__WAIT_INT
(
¡©us
è(¡©us)

	)

79 
	#__WAIT_STATUS
 *

	)

80 
	#__WAIT_STATUS_DEFN
 *

	)

85 
	#WEXITSTATUS
(
¡©us
è
	`__WEXITSTATUS
 (
	`__WAIT_INT
 (¡©us))

	)

86 
	#WTERMSIG
(
¡©us
è
	`__WTERMSIG
 (
	`__WAIT_INT
 (¡©us))

	)

87 
	#WSTOPSIG
(
¡©us
è
	`__WSTOPSIG
 (
	`__WAIT_INT
 (¡©us))

	)

88 
	#WIFEXITED
(
¡©us
è
	`__WIFEXITED
 (
	`__WAIT_INT
 (¡©us))

	)

89 
	#WIFSIGNALED
(
¡©us
è
	`__WIFSIGNALED
 (
	`__WAIT_INT
 (¡©us))

	)

90 
	#WIFSTOPPED
(
¡©us
è
	`__WIFSTOPPED
 (
	`__WAIT_INT
 (¡©us))

	)

91 #ifdeà
__WIFCONTINUED


92 
	#WIFCONTINUED
(
¡©us
è
	`__WIFCONTINUED
 (
	`__WAIT_INT
 (¡©us))

	)

96 
__BEGIN_NAMESPACE_STD


100 
	mquÙ
;

101 
	m»m
;

102 } 
	tdiv_t
;

105 #iâdeà
__ldiv_t_defšed


108 
	mquÙ
;

109 
	m»m
;

110 } 
	tldiv_t
;

111 
	#__ldiv_t_defšed
 1

	)

113 
	g__END_NAMESPACE_STD


115 #ià
defšed
 
__USE_ISOC99
 && !defšed 
__Îdiv_t_defšed


116 
__BEGIN_NAMESPACE_C99


118 
__ex‹nsiÚ__
 struct

120 
	mquÙ
;

121 
	m»m
;

122 } 
	tÎdiv_t
;

123 
	#__Îdiv_t_defšed
 1

	)

124 
	g__END_NAMESPACE_C99


129 
	#RAND_MAX
 2147483647

	)

134 
	#EXIT_FAILURE
 1

	)

135 
	#EXIT_SUCCESS
 0

	)

139 
	#MB_CUR_MAX
 (
	`__ùy³_g‘_mb_cur_max
 ())

	)

140 
size_t
 
	$__ùy³_g‘_mb_cur_max
 (è
__THROW
 
__wur
;

143 
__BEGIN_NAMESPACE_STD


145 
	$©of
 (
__cÚ¡
 *
__ÅŒ
)

146 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1)è
__wur
;

148 
	$©oi
 (
__cÚ¡
 *
__ÅŒ
)

149 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1)è
__wur
;

151 
	$©Ş
 (
__cÚ¡
 *
__ÅŒ
)

152 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1)è
__wur
;

153 
__END_NAMESPACE_STD


155 #ià
defšed
 
__USE_ISOC99
 || (defšed 
__GLIBC_HAVE_LONG_LONG
 && defšed 
__USE_MISC
)

156 
__BEGIN_NAMESPACE_C99


158 
__ex‹nsiÚ__
 
	$©Şl
 (
__cÚ¡
 *
__ÅŒ
)

159 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1)è
__wur
;

160 
__END_NAMESPACE_C99


163 
__BEGIN_NAMESPACE_STD


165 
	$¡¹od
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

166 **
__»¡riù
 
__’d±r
)

167 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

168 
__END_NAMESPACE_STD


170 #ifdef 
__USE_ISOC99


171 
__BEGIN_NAMESPACE_C99


173 
	$¡¹of
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

174 **
__»¡riù
 
__’d±r
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

176 
	$¡¹Şd
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

177 **
__»¡riù
 
__’d±r
)

178 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

179 
__END_NAMESPACE_C99


182 
__BEGIN_NAMESPACE_STD


184 
	$¡¹Ş
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

185 **
__»¡riù
 
__’d±r
, 
__ba£
)

186 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

188 
	$¡¹oul
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

189 **
__»¡riù
 
__’d±r
, 
__ba£
)

190 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

191 
__END_NAMESPACE_STD


193 #ià
defšed
 
__GLIBC_HAVE_LONG_LONG
 && defšed 
__USE_BSD


195 
__ex‹nsiÚ__


196 
	$¡¹oq
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

197 **
__»¡riù
 
__’d±r
, 
__ba£
)

198 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

200 
__ex‹nsiÚ__


201 
	$¡¹ouq
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

202 **
__»¡riù
 
__’d±r
, 
__ba£
)

203 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

206 #ià
defšed
 
__USE_ISOC99
 || (defšed 
__GLIBC_HAVE_LONG_LONG
 && defšed 
__USE_MISC
)

207 
__BEGIN_NAMESPACE_C99


209 
__ex‹nsiÚ__


210 
	$¡¹Şl
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

211 **
__»¡riù
 
__’d±r
, 
__ba£
)

212 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

214 
__ex‹nsiÚ__


215 
	$¡¹ouÎ
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

216 **
__»¡riù
 
__’d±r
, 
__ba£
)

217 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

218 
__END_NAMESPACE_C99


222 #ifdeà
__USE_GNU


236 
	~<xloÿË.h
>

240 
	$¡¹Ş_l
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

241 **
__»¡riù
 
__’d±r
, 
__ba£
,

242 
__loÿË_t
 
__loc
è
__THROW
 
	`__nÚnuÎ
 ((1, 4)è
__wur
;

244 
	$¡¹oul_l
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

245 **
__»¡riù
 
__’d±r
,

246 
__ba£
, 
__loÿË_t
 
__loc
)

247 
__THROW
 
	`__nÚnuÎ
 ((1, 4)è
__wur
;

249 
__ex‹nsiÚ__


250 
	$¡¹Şl_l
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

251 **
__»¡riù
 
__’d±r
, 
__ba£
,

252 
__loÿË_t
 
__loc
)

253 
__THROW
 
	`__nÚnuÎ
 ((1, 4)è
__wur
;

255 
__ex‹nsiÚ__


256 
	$¡¹ouÎ_l
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

257 **
__»¡riù
 
__’d±r
,

258 
__ba£
, 
__loÿË_t
 
__loc
)

259 
__THROW
 
	`__nÚnuÎ
 ((1, 4)è
__wur
;

261 
	$¡¹od_l
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

262 **
__»¡riù
 
__’d±r
, 
__loÿË_t
 
__loc
)

263 
__THROW
 
	`__nÚnuÎ
 ((1, 3)è
__wur
;

265 
	$¡¹of_l
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

266 **
__»¡riù
 
__’d±r
, 
__loÿË_t
 
__loc
)

267 
__THROW
 
	`__nÚnuÎ
 ((1, 3)è
__wur
;

269 
	$¡¹Şd_l
 (
__cÚ¡
 *
__»¡riù
 
__ÅŒ
,

270 **
__»¡riù
 
__’d±r
,

271 
__loÿË_t
 
__loc
)

272 
__THROW
 
	`__nÚnuÎ
 ((1, 3)è
__wur
;

276 #ifdeà
__USE_EXTERN_INLINES


277 
__BEGIN_NAMESPACE_STD


278 
__ex‹º_šlše
 

279 
	`__NTH
 (
	$©of
 (
__cÚ¡
 *
__ÅŒ
))

281  
	`¡¹od
 (
__ÅŒ
, (**è
NULL
);

282 
	}
}

283 
__ex‹º_šlše
 

284 
__NTH
 (
	$©oi
 (
__cÚ¡
 *
__ÅŒ
))

286  (è
	`¡¹Ş
 (
__ÅŒ
, (**è
NULL
, 10);

287 
	}
}

288 
__ex‹º_šlše
 

289 
__NTH
 (
	$©Ş
 (
__cÚ¡
 *
__ÅŒ
))

291  
	`¡¹Ş
 (
__ÅŒ
, (**è
NULL
, 10);

292 
	}
}

293 
	g__END_NAMESPACE_STD


295 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_ISOC99


296 
__BEGIN_NAMESPACE_C99


297 
__ex‹nsiÚ__
 
__ex‹º_šlše
 

298 
__NTH
 (
	$©Şl
 (
__cÚ¡
 *
__ÅŒ
))

300  
	`¡¹Şl
 (
__ÅŒ
, (**è
NULL
, 10);

301 
	}
}

302 
	g__END_NAMESPACE_C99


307 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN_EXTENDED


311 *
	$l64a
 (
__n
è
__THROW
 
__wur
;

314 
	$a64l
 (
__cÚ¡
 *
__s
)

315 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1)è
__wur
;

319 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_BSD


320 
	~<sys/ty³s.h
>

327 
	$¿ndom
 (è
__THROW
;

330 
	$¤ªdom
 (
__£ed
è
__THROW
;

336 *
	$š™¡©e
 (
__£ed
, *
__¡©ebuf
,

337 
size_t
 
__¡©–’
è
__THROW
 
	`__nÚnuÎ
 ((2));

341 *
	$£t¡©e
 (*
__¡©ebuf
è
__THROW
 
	`__nÚnuÎ
 ((1));

344 #ifdeà
__USE_MISC


349 
	s¿ndom_d©a


351 
št32_t
 *
åŒ
;

352 
št32_t
 *
½Œ
;

353 
št32_t
 *
¡©e
;

354 
¿nd_ty³
;

355 
¿nd_deg
;

356 
¿nd_£p
;

357 
št32_t
 *
’d_±r
;

360 
	$¿ndom_r
 (
¿ndom_d©a
 *
__»¡riù
 
__buf
,

361 
št32_t
 *
__»¡riù
 
__»suÉ
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

363 
	$¤ªdom_r
 (
__£ed
, 
¿ndom_d©a
 *
__buf
)

364 
__THROW
 
	`__nÚnuÎ
 ((2));

366 
	$š™¡©e_r
 (
__£ed
, *
__»¡riù
 
__¡©ebuf
,

367 
size_t
 
__¡©–’
,

368 
¿ndom_d©a
 *
__»¡riù
 
__buf
)

369 
__THROW
 
	`__nÚnuÎ
 ((2, 4));

371 
	$£t¡©e_r
 (*
__»¡riù
 
__¡©ebuf
,

372 
¿ndom_d©a
 *
__»¡riù
 
__buf
)

373 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

378 
__BEGIN_NAMESPACE_STD


380 
	$¿nd
 (è
__THROW
;

382 
	$¤ªd
 (
__£ed
è
__THROW
;

383 
__END_NAMESPACE_STD


385 #ifdeà
__USE_POSIX


387 
	$¿nd_r
 (*
__£ed
è
__THROW
;

391 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN


395 
	$d¿nd48
 (è
__THROW
;

396 
	$”ªd48
 (
__xsubi
[3]è
__THROW
 
	`__nÚnuÎ
 ((1));

399 
	$Ìªd48
 (è
__THROW
;

400 
	$Äªd48
 (
__xsubi
[3])

401 
__THROW
 
	`__nÚnuÎ
 ((1));

404 
	$m¿nd48
 (è
__THROW
;

405 
	$j¿nd48
 (
__xsubi
[3])

406 
__THROW
 
	`__nÚnuÎ
 ((1));

409 
	$¤ªd48
 (
__£edv®
è
__THROW
;

410 *
	$£ed48
 (
__£ed16v
[3])

411 
__THROW
 
	`__nÚnuÎ
 ((1));

412 
	$lcÚg48
 (
__·¿m
[7]è
__THROW
 
	`__nÚnuÎ
 ((1));

414 #ifdeà
__USE_MISC


418 
	sd¿nd48_d©a


420 
__x
[3];

421 
__Şd_x
[3];

422 
__c
;

423 
__š™
;

424 
__a
;

428 
	$d¿nd48_r
 (
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

429 *
__»¡riù
 
__»suÉ
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

430 
	$”ªd48_r
 (
__xsubi
[3],

431 
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

432 *
__»¡riù
 
__»suÉ
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

435 
	$Ìªd48_r
 (
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

436 *
__»¡riù
 
__»suÉ
)

437 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

438 
	$Äªd48_r
 (
__xsubi
[3],

439 
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

440 *
__»¡riù
 
__»suÉ
)

441 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

444 
	$m¿nd48_r
 (
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

445 *
__»¡riù
 
__»suÉ
)

446 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

447 
	$j¿nd48_r
 (
__xsubi
[3],

448 
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

449 *
__»¡riù
 
__»suÉ
)

450 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

453 
	$¤ªd48_r
 (
__£edv®
, 
d¿nd48_d©a
 *
__bufãr
)

454 
__THROW
 
	`__nÚnuÎ
 ((2));

456 
	$£ed48_r
 (
__£ed16v
[3],

457 
d¿nd48_d©a
 *
__bufãr
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

459 
	$lcÚg48_r
 (
__·¿m
[7],

460 
d¿nd48_d©a
 *
__bufãr
)

461 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

467 #iâdeà
__m®loc_ªd_ÿÎoc_defšed


468 
	#__m®loc_ªd_ÿÎoc_defšed


	)

469 
__BEGIN_NAMESPACE_STD


471 *
	$m®loc
 (
size_t
 
__size
è
__THROW
 
__©Œibu‹_m®loc__
 
__wur
;

473 *
	$ÿÎoc
 (
size_t
 
__nmemb
, size_ˆ
__size
)

474 
__THROW
 
__©Œibu‹_m®loc__
 
__wur
;

475 
__END_NAMESPACE_STD


478 #iâdeà
__Ãed_m®loc_ªd_ÿÎoc


479 
__BEGIN_NAMESPACE_STD


485 *
	$»®loc
 (*
__±r
, 
size_t
 
__size
)

486 
__THROW
 
__©Œibu‹_w¬n_unu£d_»suÉ__
;

488 
	$ä“
 (*
__±r
è
__THROW
;

489 
__END_NAMESPACE_STD


491 #ifdef 
__USE_MISC


493 
	$cä“
 (*
__±r
è
__THROW
;

496 #ià
defšed
 
__USE_GNU
 || defšed 
__USE_BSD
 || defšed 
__USE_MISC


497 
	~<®loÿ.h
>

500 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K
) \

501 || 
defšed
 
__USE_BSD


503 *
	$v®loc
 (
size_t
 
__size
è
__THROW
 
__©Œibu‹_m®loc__
 
__wur
;

506 #ifdeà
__USE_XOPEN2K


508 
	$posix_mem®ign
 (**
__mem±r
, 
size_t
 
__®ignm’t
, size_ˆ
__size
)

509 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

512 
__BEGIN_NAMESPACE_STD


514 
	$abÜt
 (è
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

518 
	`©ex™
 ((*
__func
è()è
__THROW
 
	`__nÚnuÎ
 ((1));

520 #ifdeà
__USE_GNU


524 #ifdeà
__ılu¥lus


525 "C++" 
	`©_quick_ex™
 ((*
__func
) ())

526 
__THROW
 
	`__asm
 ("©_quick_ex™"è
	`__nÚnuÎ
 ((1));

528 
	`©_quick_ex™
 ((*
__func
è()è
__THROW
 
	`__nÚnuÎ
 ((1));

531 
__END_NAMESPACE_STD


533 #ifdef 
__USE_MISC


536 
	`Ú_ex™
 ((*
__func
è(
__¡©us
, *
__¬g
), *__arg)

537 
__THROW
 
	`__nÚnuÎ
 ((1));

540 
__BEGIN_NAMESPACE_STD


544 
	$ex™
 (
__¡©us
è
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

546 #ifdeà
__USE_GNU


552 
	$quick_ex™
 (
__¡©us
è
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

554 
__END_NAMESPACE_STD


556 #ifdeà
__USE_ISOC99


557 
__BEGIN_NAMESPACE_C99


560 
	$_Ex™
 (
__¡©us
è
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

561 
__END_NAMESPACE_C99


565 
__BEGIN_NAMESPACE_STD


567 *
	$g‘’v
 (
__cÚ¡
 *
__Çme
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

568 
__END_NAMESPACE_STD


572 *
	$__£cu»_g‘’v
 (
__cÚ¡
 *
__Çme
)

573 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

575 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN


579 
	$pu‹nv
 (*
__¡ršg
è
__THROW
 
	`__nÚnuÎ
 ((1));

582 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN2K


585 
	$£‹nv
 (
__cÚ¡
 *
__Çme
, __cÚ¡ *
__v®ue
, 
__»¶aû
)

586 
__THROW
 
	`__nÚnuÎ
 ((2));

589 
	$un£‹nv
 (
__cÚ¡
 *
__Çme
è
__THROW
 
	`__nÚnuÎ
 ((1));

592 #ifdef 
__USE_MISC


596 
	$ş—»nv
 (è
__THROW
;

600 #ià
defšed
 
__USE_MISC
 \

601 || (
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K
)

606 *
	$mk‹mp
 (*
__‹m¶©e
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

609 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED
 \

610 || 
defšed
 
__USE_XOPEN2K8


619 #iâdeà
__USE_FILE_OFFSET64


620 
	$mk¡emp
 (*
__‹m¶©e
è
	`__nÚnuÎ
 ((1)è
__wur
;

622 #ifdeà
__REDIRECT


623 
	`__REDIRECT
 (
mk¡emp
, (*
__‹m¶©e
), 
mk¡emp64
)

624 
	`__nÚnuÎ
 ((1)è
__wur
;

626 
	#mk¡emp
 
mk¡emp64


	)

629 #ifdeà
__USE_LARGEFILE64


630 
	$mk¡emp64
 (*
__‹m¶©e
è
	`__nÚnuÎ
 ((1)è
__wur
;

634 #ifdeà
__USE_MISC


641 #iâdeà
__USE_FILE_OFFSET64


642 
	$mk¡emps
 (*
__‹m¶©e
, 
__suffixËn
è
	`__nÚnuÎ
 ((1)è
__wur
;

644 #ifdeà
__REDIRECT


645 
	`__REDIRECT
 (
mk¡emps
, (*
__‹m¶©e
, 
__suffixËn
),

646 
mk¡emps64
è
	`__nÚnuÎ
 ((1)è
__wur
;

648 
	#mk¡emps
 
mk¡emps64


	)

651 #ifdeà
__USE_LARGEFILE64


652 
	$mk¡emps64
 (*
__‹m¶©e
, 
__suffixËn
)

653 
	`__nÚnuÎ
 ((1)è
__wur
;

657 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN2K8


663 *
	$mkd‹mp
 (*
__‹m¶©e
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

666 #ifdeà
__USE_GNU


673 #iâdeà
__USE_FILE_OFFSET64


674 
	$mko¡emp
 (*
__‹m¶©e
, 
__æags
è
	`__nÚnuÎ
 ((1)è
__wur
;

676 #ifdeà
__REDIRECT


677 
	`__REDIRECT
 (
mko¡emp
, (*
__‹m¶©e
, 
__æags
), 
mko¡emp64
)

678 
	`__nÚnuÎ
 ((1)è
__wur
;

680 
	#mko¡emp
 
mko¡emp64


	)

683 #ifdeà
__USE_LARGEFILE64


684 
	$mko¡emp64
 (*
__‹m¶©e
, 
__æags
è
	`__nÚnuÎ
 ((1)è
__wur
;

693 #iâdeà
__USE_FILE_OFFSET64


694 
	$mko¡emps
 (*
__‹m¶©e
, 
__suffixËn
, 
__æags
)

695 
	`__nÚnuÎ
 ((1)è
__wur
;

697 #ifdeà
__REDIRECT


698 
	`__REDIRECT
 (
mko¡emps
, (*
__‹m¶©e
, 
__suffixËn
,

699 
__æags
), 
mko¡emps64
)

700 
	`__nÚnuÎ
 ((1)è
__wur
;

702 
	#mko¡emps
 
mko¡emps64


	)

705 #ifdeà
__USE_LARGEFILE64


706 
	$mko¡emps64
 (*
__‹m¶©e
, 
__suffixËn
, 
__æags
)

707 
	`__nÚnuÎ
 ((1)è
__wur
;

712 
__BEGIN_NAMESPACE_STD


717 
	$sy¡em
 (
__cÚ¡
 *
__commªd
è
__wur
;

718 
__END_NAMESPACE_STD


721 #ifdef 
__USE_GNU


724 *
	$ÿnÚiÿlize_fe_Çme
 (
__cÚ¡
 *
__Çme
)

725 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

728 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED


734 *
	$»®·th
 (
__cÚ¡
 *
__»¡riù
 
__Çme
,

735 *
__»¡riù
 
__»sŞved
è
__THROW
 
__wur
;

740 #iâdeà
__COMPAR_FN_T


741 
	#__COMPAR_FN_T


	)

742 (*
	t__com·r_â_t
è(
	t__cÚ¡
 *, __const *);

744 #ifdef 
__USE_GNU


745 
__com·r_â_t
 
	tcom·risÚ_â_t
;

748 #ifdeà
__USE_GNU


749 (*
	t__com·r_d_â_t
è(
	t__cÚ¡
 *, __const *, *);

752 
__BEGIN_NAMESPACE_STD


755 *
	$b£¬ch
 (
__cÚ¡
 *
__key
, __cÚ¡ *
__ba£
,

756 
size_t
 
__nmemb
, size_ˆ
__size
, 
__com·r_â_t
 
__com·r
)

757 
	`__nÚnuÎ
 ((1, 2, 5)è
__wur
;

761 
	$qsÜt
 (*
__ba£
, 
size_t
 
__nmemb
, size_ˆ
__size
,

762 
__com·r_â_t
 
__com·r
è
	`__nÚnuÎ
 ((1, 4));

763 #ifdeà
__USE_GNU


764 
	$qsÜt_r
 (*
__ba£
, 
size_t
 
__nmemb
, size_ˆ
__size
,

765 
__com·r_d_â_t
 
__com·r
, *
__¬g
)

766 
	`__nÚnuÎ
 ((1, 4));

771 
	$abs
 (
__x
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

772 
	$Ïbs
 (
__x
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

773 
__END_NAMESPACE_STD


775 #ifdeà
__USE_ISOC99


776 
__ex‹nsiÚ__
 
	$Îabs
 (
__x
)

777 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

781 
__BEGIN_NAMESPACE_STD


785 
div_t
 
	$div
 (
__num”
, 
__d’om
)

786 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

787 
ldiv_t
 
	$ldiv
 (
__num”
, 
__d’om
)

788 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

789 
__END_NAMESPACE_STD


791 #ifdeà
__USE_ISOC99


792 
__BEGIN_NAMESPACE_C99


793 
__ex‹nsiÚ__
 
Îdiv_t
 
	$Îdiv
 (
__num”
,

794 
__d’om
)

795 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

796 
__END_NAMESPACE_C99


800 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K
) \

801 || 
defšed
 
__USE_SVID


808 *
	$ecvt
 (
__v®ue
, 
__ndig™
, *
__»¡riù
 
__deıt
,

809 *
__»¡riù
 
__sign
è
__THROW
 
	`__nÚnuÎ
 ((3, 4)è
__wur
;

814 *
	$fcvt
 (
__v®ue
, 
__ndig™
, *
__»¡riù
 
__deıt
,

815 *
__»¡riù
 
__sign
è
__THROW
 
	`__nÚnuÎ
 ((3, 4)è
__wur
;

820 *
	$gcvt
 (
__v®ue
, 
__ndig™
, *
__buf
)

821 
__THROW
 
	`__nÚnuÎ
 ((3)è
__wur
;

824 #ifdeà
__USE_MISC


826 *
	$qecvt
 (
__v®ue
, 
__ndig™
,

827 *
__»¡riù
 
__deıt
, *__»¡riù 
__sign
)

828 
__THROW
 
	`__nÚnuÎ
 ((3, 4)è
__wur
;

829 *
	$qfcvt
 (
__v®ue
, 
__ndig™
,

830 *
__»¡riù
 
__deıt
, *__»¡riù 
__sign
)

831 
__THROW
 
	`__nÚnuÎ
 ((3, 4)è
__wur
;

832 *
	$qgcvt
 (
__v®ue
, 
__ndig™
, *
__buf
)

833 
__THROW
 
	`__nÚnuÎ
 ((3)è
__wur
;

838 
	$ecvt_r
 (
__v®ue
, 
__ndig™
, *
__»¡riù
 
__deıt
,

839 *
__»¡riù
 
__sign
, *__»¡riù 
__buf
,

840 
size_t
 
__Ën
è
__THROW
 
	`__nÚnuÎ
 ((3, 4, 5));

841 
	$fcvt_r
 (
__v®ue
, 
__ndig™
, *
__»¡riù
 
__deıt
,

842 *
__»¡riù
 
__sign
, *__»¡riù 
__buf
,

843 
size_t
 
__Ën
è
__THROW
 
	`__nÚnuÎ
 ((3, 4, 5));

845 
	$qecvt_r
 (
__v®ue
, 
__ndig™
,

846 *
__»¡riù
 
__deıt
, *__»¡riù 
__sign
,

847 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
)

848 
__THROW
 
	`__nÚnuÎ
 ((3, 4, 5));

849 
	$qfcvt_r
 (
__v®ue
, 
__ndig™
,

850 *
__»¡riù
 
__deıt
, *__»¡riù 
__sign
,

851 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
)

852 
__THROW
 
	`__nÚnuÎ
 ((3, 4, 5));

857 
__BEGIN_NAMESPACE_STD


860 
	$mbËn
 (
__cÚ¡
 *
__s
, 
size_t
 
__n
è
__THROW
 
__wur
;

863 
	$mbtowc
 (
wch¬_t
 *
__»¡riù
 
__pwc
,

864 
__cÚ¡
 *
__»¡riù
 
__s
, 
size_t
 
__n
è
__THROW
 
__wur
;

867 
	$wùomb
 (*
__s
, 
wch¬_t
 
__wch¬
è
__THROW
 
__wur
;

871 
size_t
 
	$mb¡owcs
 (
wch¬_t
 *
__»¡riù
 
__pwcs
,

872 
__cÚ¡
 *
__»¡riù
 
__s
, 
size_t
 
__n
è
__THROW
;

874 
size_t
 
	$wc¡ombs
 (*
__»¡riù
 
__s
,

875 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__pwcs
, 
size_t
 
__n
)

876 
__THROW
;

877 
__END_NAMESPACE_STD


880 #ifdeà
__USE_SVID


885 
	$½m©ch
 (
__cÚ¡
 *
__»¥Ú£
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

889 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


896 
	$g‘subİt
 (**
__»¡riù
 
__İtiÚp
,

897 *
__cÚ¡
 *
__»¡riù
 
__tok’s
,

898 **
__»¡riù
 
__v®u•
)

899 
__THROW
 
	`__nÚnuÎ
 ((1, 2, 3)è
__wur
;

903 #ifdeà
__USE_XOPEN


905 
	$£tkey
 (
__cÚ¡
 *
__key
è
__THROW
 
	`__nÚnuÎ
 ((1));

911 #ifdeà
__USE_XOPEN2KXSI


913 
	$posix_İ’±
 (
__oæag
è
__wur
;

916 #ifdeà
__USE_XOPEN


921 
	$g¿Á±
 (
__fd
è
__THROW
;

925 
	$uÆock±
 (
__fd
è
__THROW
;

930 *
	$±¢ame
 (
__fd
è
__THROW
 
__wur
;

933 #ifdeà
__USE_GNU


937 
	$±¢ame_r
 (
__fd
, *
__buf
, 
size_t
 
__buæ’
)

938 
__THROW
 
	`__nÚnuÎ
 ((2));

941 
	`g‘±
 ();

944 #ifdeà
__USE_BSD


948 
	$g‘lßdavg
 (
__lßdavg
[], 
__ÃËm
)

949 
__THROW
 
	`__nÚnuÎ
 ((1));

954 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__ex‹º_®ways_šlše


955 
	~<b™s/¡dlib.h
>

957 #ifdeà
__LDBL_COMPAT


958 
	~<b™s/¡dlib-ldbl.h
>

962 #undeà
__Ãed_m®loc_ªd_ÿÎoc


964 
__END_DECLS


	@/usr/include/string.h

24 #iâdef 
_STRING_H


25 
	#_STRING_H
 1

	)

27 
	~<ã©u»s.h
>

29 
	g__BEGIN_DECLS


32 
	#__Ãed_size_t


	)

33 
	#__Ãed_NULL


	)

34 
	~<¡ddef.h
>

37 #ià
defšed
 
__ılu¥lus
 && 
__GNUC_PREREQ
 (4, 4)

38 
	#__CORRECT_ISO_CPP_STRING_H_PROTO


	)

42 
__BEGIN_NAMESPACE_STD


44 *
	$memıy
 (*
__»¡riù
 
__de¡
,

45 
__cÚ¡
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

46 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

49 *
	$memmove
 (*
__de¡
, 
__cÚ¡
 *
__¤c
, 
size_t
 
__n
)

50 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

51 
__END_NAMESPACE_STD


56 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_BSD
 || defšed 
__USE_XOPEN


57 *
	$memcıy
 (*
__»¡riù
 
__de¡
, 
__cÚ¡
 *__»¡riù 
__¤c
,

58 
__c
, 
size_t
 
__n
)

59 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

63 
__BEGIN_NAMESPACE_STD


65 *
	$mem£t
 (*
__s
, 
__c
, 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1));

68 
	$memcmp
 (
__cÚ¡
 *
__s1
, __cÚ¡ *
__s2
, 
size_t
 
__n
)

69 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

72 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


75 *
	`memchr
 (*
__s
, 
__c
, 
size_t
 
__n
)

76 
__THROW
 
	`__asm
 ("memchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

77 
__cÚ¡
 *
	`memchr
 (__cÚ¡ *
__s
, 
__c
, 
size_t
 
__n
)

78 
__THROW
 
	`__asm
 ("memchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

80 #ifdeà
__OPTIMIZE__


81 
__ex‹º_®ways_šlše
 *

82 
	`memchr
 (*
__s
, 
__c
, 
size_t
 
__n
è
__THROW


84  
	`__butš_memchr
 (
__s
, 
__c
, 
__n
);

87 
__ex‹º_®ways_šlše
 
__cÚ¡
 *

88 
	`memchr
 (
__cÚ¡
 *
__s
, 
__c
, 
size_t
 
__n
è
__THROW


90  
	`__butš_memchr
 (
__s
, 
__c
, 
__n
);

93 
	}
}

95 *
	$memchr
 (
__cÚ¡
 *
__s
, 
__c
, 
size_t
 
__n
)

96 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

98 
__END_NAMESPACE_STD


100 #ifdeà
__USE_GNU


103 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


104 "C++" *
	$¿wmemchr
 (*
__s
, 
__c
)

105 
__THROW
 
	`__asm
 ("¿wmemchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

106 "C++" 
__cÚ¡
 *
	$¿wmemchr
 (
__cÚ¡
 *
__s
, 
__c
)

107 
__THROW
 
	`__asm
 ("¿wmemchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

109 *
	$¿wmemchr
 (
__cÚ¡
 *
__s
, 
__c
)

110 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

114 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


115 "C++" *
	$memrchr
 (*
__s
, 
__c
, 
size_t
 
__n
)

116 
__THROW
 
	`__asm
 ("memrchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

117 "C++" 
__cÚ¡
 *
	$memrchr
 (
__cÚ¡
 *
__s
, 
__c
, 
size_t
 
__n
)

118 
__THROW
 
	`__asm
 ("memrchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

120 *
	$memrchr
 (
__cÚ¡
 *
__s
, 
__c
, 
size_t
 
__n
)

121 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

126 
__BEGIN_NAMESPACE_STD


128 *
	$¡rıy
 (*
__»¡riù
 
__de¡
, 
__cÚ¡
 *__»¡riù 
__¤c
)

129 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

131 *
	$¡ºıy
 (*
__»¡riù
 
__de¡
,

132 
__cÚ¡
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

133 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

136 *
	$¡rÿt
 (*
__»¡riù
 
__de¡
, 
__cÚ¡
 *__»¡riù 
__¤c
)

137 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

139 *
	$¡ºÿt
 (*
__»¡riù
 
__de¡
, 
__cÚ¡
 *__»¡riù 
__¤c
,

140 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

143 
	$¡rcmp
 (
__cÚ¡
 *
__s1
, __cÚ¡ *
__s2
)

144 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

146 
	$¡ºcmp
 (
__cÚ¡
 *
__s1
, __cÚ¡ *
__s2
, 
size_t
 
__n
)

147 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

150 
	$¡rcŞl
 (
__cÚ¡
 *
__s1
, __cÚ¡ *
__s2
)

151 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

153 
size_t
 
	$¡rxäm
 (*
__»¡riù
 
__de¡
,

154 
__cÚ¡
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

155 
__THROW
 
	`__nÚnuÎ
 ((2));

156 
__END_NAMESPACE_STD


158 #ifdeà
__USE_XOPEN2K8


162 
	~<xloÿË.h
>

165 
	$¡rcŞl_l
 (
__cÚ¡
 *
__s1
, __cÚ¡ *
__s2
, 
__loÿË_t
 
__l
)

166 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2, 3));

168 
size_t
 
	$¡rxäm_l
 (*
__de¡
, 
__cÚ¡
 *
__¤c
, 
size_t
 
__n
,

169 
__loÿË_t
 
__l
è
__THROW
 
	`__nÚnuÎ
 ((2, 4));

172 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED
 \

173 || 
defšed
 
__USE_XOPEN2K8


175 *
	$¡rdup
 (
__cÚ¡
 *
__s
)

176 
__THROW
 
__©Œibu‹_m®loc__
 
	`__nÚnuÎ
 ((1));

182 #ià
defšed
 
__USE_XOPEN2K8


183 *
	$¡ºdup
 (
__cÚ¡
 *
__¡ršg
, 
size_t
 
__n
)

184 
__THROW
 
__©Œibu‹_m®loc__
 
	`__nÚnuÎ
 ((1));

187 #ià
defšed
 
__USE_GNU
 && defšed 
__GNUC__


189 
	#¡rdu·
(
s
) \

190 (
__ex‹nsiÚ__
 \

192 
__cÚ¡
 *
__Şd
 = (
s
); \

193 
size_t
 
__Ën
 = 
	`¡¾’
 (
__Şd
) + 1; \

194 *
__Ãw
 = (*è
	`__butš_®loÿ
 (
__Ën
); \

195 (*è
	`memıy
 (
__Ãw
, 
__Şd
, 
__Ën
); \

196 
	}
}))

	)

199 
	#¡ºdu·
(
s
, 
n
) \

200 (
__ex‹nsiÚ__
 \

202 
__cÚ¡
 *
__Şd
 = (
s
); \

203 
size_t
 
__Ën
 = 
	`¡ºËn
 (
__Şd
, (
n
)); \

204 *
__Ãw
 = (*è
	`__butš_®loÿ
 (
__Ën
 + 1); \

205 
__Ãw
[
__Ën
] = '\0'; \

206 (*è
	`memıy
 (
__Ãw
, 
__Şd
, 
__Ën
); \

207 }))

	)

210 
	g__BEGIN_NAMESPACE_STD


212 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


215 *
¡rchr
 (*
__s
, 
__c
)

216 
__THROW
 
__asm
 ("¡rchr"è
__©Œibu‹_pu»__
 
__nÚnuÎ
 ((1));

217 
__cÚ¡
 *
¡rchr
 (__cÚ¡ *
__s
, 
__c
)

218 
__THROW
 
__asm
 ("¡rchr"è
__©Œibu‹_pu»__
 
__nÚnuÎ
 ((1));

220 #ifdeà
__OPTIMIZE__


221 
__ex‹º_®ways_šlše
 *

222 
¡rchr
 (*
__s
, 
__c
è
	g__THROW


224  
__butš_¡rchr
 (
__s
, 
__c
);

227 
__ex‹º_®ways_šlše
 
__cÚ¡
 *

228 
¡rchr
 (
__cÚ¡
 *
__s
, 
__c
è
	g__THROW


230  
__butš_¡rchr
 (
__s
, 
__c
);

235 *
	$¡rchr
 (
__cÚ¡
 *
__s
, 
__c
)

236 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

239 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


242 *
	`¡¼chr
 (*
__s
, 
__c
)

243 
__THROW
 
	`__asm
 ("¡¼chr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

244 
__cÚ¡
 *
	`¡¼chr
 (__cÚ¡ *
__s
, 
__c
)

245 
__THROW
 
	`__asm
 ("¡¼chr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

247 #ifdeà
__OPTIMIZE__


248 
__ex‹º_®ways_šlše
 *

249 
	`¡¼chr
 (*
__s
, 
__c
è
__THROW


251  
	`__butš_¡¼chr
 (
__s
, 
__c
);

254 
__ex‹º_®ways_šlše
 
__cÚ¡
 *

255 
	`¡¼chr
 (
__cÚ¡
 *
__s
, 
__c
è
__THROW


257  
	`__butš_¡¼chr
 (
__s
, 
__c
);

260 
	}
}

262 *
	$¡¼chr
 (
__cÚ¡
 *
__s
, 
__c
)

263 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

265 
__END_NAMESPACE_STD


267 #ifdeà
__USE_GNU


270 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


271 "C++" *
	$¡rchºul
 (*
__s
, 
__c
)

272 
__THROW
 
	`__asm
 ("¡rchºul"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

273 "C++" 
__cÚ¡
 *
	$¡rchºul
 (
__cÚ¡
 *
__s
, 
__c
)

274 
__THROW
 
	`__asm
 ("¡rchºul"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

276 *
	$¡rchºul
 (
__cÚ¡
 *
__s
, 
__c
)

277 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

281 
__BEGIN_NAMESPACE_STD


284 
size_t
 
	$¡rc¥n
 (
__cÚ¡
 *
__s
, __cÚ¡ *
__»jeù
)

285 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

288 
size_t
 
	$¡r¥n
 (
__cÚ¡
 *
__s
, __cÚ¡ *
__acû±
)

289 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

291 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


294 *
	`¡½brk
 (*
__s
, 
__cÚ¡
 *
__acû±
)

295 
__THROW
 
	`__asm
 ("¡½brk"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

296 
__cÚ¡
 *
	`¡½brk
 (__cÚ¡ *
__s
, __cÚ¡ *
__acû±
)

297 
__THROW
 
	`__asm
 ("¡½brk"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

299 #ifdeà
__OPTIMIZE__


300 
__ex‹º_®ways_šlše
 *

301 
	`¡½brk
 (*
__s
, 
__cÚ¡
 *
__acû±
è
__THROW


303  
	`__butš_¡½brk
 (
__s
, 
__acû±
);

306 
__ex‹º_®ways_šlše
 
__cÚ¡
 *

307 
	`¡½brk
 (
__cÚ¡
 *
__s
, __cÚ¡ *
__acû±
è
__THROW


309  
	`__butš_¡½brk
 (
__s
, 
__acû±
);

312 
	}
}

314 *
	$¡½brk
 (
__cÚ¡
 *
__s
, __cÚ¡ *
__acû±
)

315 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

318 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


321 *
	`¡r¡r
 (*
__hay¡ack
, 
__cÚ¡
 *
__ÃedË
)

322 
__THROW
 
	`__asm
 ("¡r¡r"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

323 
__cÚ¡
 *
	`¡r¡r
 (__cÚ¡ *
__hay¡ack
,

324 
__cÚ¡
 *
__ÃedË
)

325 
__THROW
 
	`__asm
 ("¡r¡r"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

327 #ifdeà
__OPTIMIZE__


328 
__ex‹º_®ways_šlše
 *

329 
	`¡r¡r
 (*
__hay¡ack
, 
__cÚ¡
 *
__ÃedË
è
__THROW


331  
	`__butš_¡r¡r
 (
__hay¡ack
, 
__ÃedË
);

334 
__ex‹º_®ways_šlše
 
__cÚ¡
 *

335 
	`¡r¡r
 (
__cÚ¡
 *
__hay¡ack
, __cÚ¡ *
__ÃedË
è
__THROW


337  
	`__butš_¡r¡r
 (
__hay¡ack
, 
__ÃedË
);

340 
	}
}

342 *
	$¡r¡r
 (
__cÚ¡
 *
__hay¡ack
, __cÚ¡ *
__ÃedË
)

343 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

348 *
	$¡¹ok
 (*
__»¡riù
 
__s
, 
__cÚ¡
 *__»¡riù 
__d–im
)

349 
__THROW
 
	`__nÚnuÎ
 ((2));

350 
__END_NAMESPACE_STD


354 *
	$__¡¹ok_r
 (*
__»¡riù
 
__s
,

355 
__cÚ¡
 *
__»¡riù
 
__d–im
,

356 **
__»¡riù
 
__§ve_±r
)

357 
__THROW
 
	`__nÚnuÎ
 ((2, 3));

358 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC


359 *
	$¡¹ok_r
 (*
__»¡riù
 
__s
, 
__cÚ¡
 *__»¡riù 
__d–im
,

360 **
__»¡riù
 
__§ve_±r
)

361 
__THROW
 
	`__nÚnuÎ
 ((2, 3));

364 #ifdeà
__USE_GNU


366 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


367 "C++" *
	$¡rÿ£¡r
 (*
__hay¡ack
, 
__cÚ¡
 *
__ÃedË
)

368 
__THROW
 
	`__asm
 ("¡rÿ£¡r"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

369 "C++" 
__cÚ¡
 *
	$¡rÿ£¡r
 (
__cÚ¡
 *
__hay¡ack
,

370 
__cÚ¡
 *
__ÃedË
)

371 
__THROW
 
	`__asm
 ("¡rÿ£¡r"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

373 *
	$¡rÿ£¡r
 (
__cÚ¡
 *
__hay¡ack
, __cÚ¡ *
__ÃedË
)

374 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

378 #ifdeà
__USE_GNU


382 *
	$memmem
 (
__cÚ¡
 *
__hay¡ack
, 
size_t
 
__hay¡ackËn
,

383 
__cÚ¡
 *
__ÃedË
, 
size_t
 
__ÃedËËn
)

384 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 3));

388 *
	$__mempıy
 (*
__»¡riù
 
__de¡
,

389 
__cÚ¡
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

390 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

391 *
	$mempıy
 (*
__»¡riù
 
__de¡
,

392 
__cÚ¡
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

393 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

397 
__BEGIN_NAMESPACE_STD


399 
size_t
 
	$¡¾’
 (
__cÚ¡
 *
__s
)

400 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

401 
__END_NAMESPACE_STD


403 #ifdef 
__USE_XOPEN2K8


406 
size_t
 
	$¡ºËn
 (
__cÚ¡
 *
__¡ršg
, 
size_t
 
__maxËn
)

407 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

411 
__BEGIN_NAMESPACE_STD


413 *
	$¡»¼Ü
 (
__”ºum
è
__THROW
;

414 
__END_NAMESPACE_STD


415 #ià
defšed
 
__USE_XOPEN2K
 || defšed 
__USE_MISC


423 #ià
defšed
 
__USE_XOPEN2K
 && !defšed 
__USE_GNU


426 #ifdeà
__REDIRECT_NTH


427 
	`__REDIRECT_NTH
 (
¡»¼Ü_r
,

428 (
__”ºum
, *
__buf
, 
size_t
 
__buæ’
),

429 
__xpg_¡»¼Ü_r
è
	`__nÚnuÎ
 ((2));

431 
	$__xpg_¡»¼Ü_r
 (
__”ºum
, *
__buf
, 
size_t
 
__buæ’
)

432 
__THROW
 
	`__nÚnuÎ
 ((2));

433 
	#¡»¼Ü_r
 
__xpg_¡»¼Ü_r


	)

438 *
	$¡»¼Ü_r
 (
__”ºum
, *
__buf
, 
size_t
 
__buæ’
)

439 
__THROW
 
	`__nÚnuÎ
 ((2));

443 #ifdeà
__USE_XOPEN2K8


445 *
	$¡»¼Ü_l
 (
__”ºum
, 
__loÿË_t
 
__l
è
__THROW
;

451 
	$__bz”o
 (*
__s
, 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1));

453 #ifdeà
__USE_BSD


455 
	$bcİy
 (
__cÚ¡
 *
__¤c
, *
__de¡
, 
size_t
 
__n
)

456 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

459 
	$bz”o
 (*
__s
, 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1));

462 
	$bcmp
 (
__cÚ¡
 *
__s1
, __cÚ¡ *
__s2
, 
size_t
 
__n
)

463 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

466 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


469 *
	`šdex
 (*
__s
, 
__c
)

470 
__THROW
 
	`__asm
 ("šdex"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

471 
__cÚ¡
 *
	`šdex
 (__cÚ¡ *
__s
, 
__c
)

472 
__THROW
 
	`__asm
 ("šdex"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

474 #ià
defšed
 
__OPTIMIZE__
 && !defšed 
__CORRECT_ISO_CPP_STRINGS_H_PROTO


475 
__ex‹º_®ways_šlše
 *

476 
	`šdex
 (*
__s
, 
__c
è
__THROW


478  
	`__butš_šdex
 (
__s
, 
__c
);

481 
__ex‹º_®ways_šlše
 
__cÚ¡
 *

482 
	`šdex
 (
__cÚ¡
 *
__s
, 
__c
è
__THROW


484  
	`__butš_šdex
 (
__s
, 
__c
);

487 
	}
}

489 *
	$šdex
 (
__cÚ¡
 *
__s
, 
__c
)

490 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

494 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


497 *
	`ršdex
 (*
__s
, 
__c
)

498 
__THROW
 
	`__asm
 ("ršdex"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

499 
__cÚ¡
 *
	`ršdex
 (__cÚ¡ *
__s
, 
__c
)

500 
__THROW
 
	`__asm
 ("ršdex"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

502 #ià
defšed
 
__OPTIMIZE__
 && !defšed 
__CORRECT_ISO_CPP_STRINGS_H_PROTO


503 
__ex‹º_®ways_šlše
 *

504 
	`ršdex
 (*
__s
, 
__c
è
__THROW


506  
	`__butš_ršdex
 (
__s
, 
__c
);

509 
__ex‹º_®ways_šlše
 
__cÚ¡
 *

510 
	`ršdex
 (
__cÚ¡
 *
__s
, 
__c
è
__THROW


512  
	`__butš_ršdex
 (
__s
, 
__c
);

515 
	}
}

517 *
	$ršdex
 (
__cÚ¡
 *
__s
, 
__c
)

518 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

523 
	$ffs
 (
__i
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

527 #ifdef 
__USE_GNU


528 
	$ff¦
 (
__l
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

529 #ifdeà
__GNUC__


530 
__ex‹nsiÚ__
 
	$ff¦l
 (
__Î
)

531 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

536 
	$¡rÿ£cmp
 (
__cÚ¡
 *
__s1
, __cÚ¡ *
__s2
)

537 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

540 
	$¡ºÿ£cmp
 (
__cÚ¡
 *
__s1
, __cÚ¡ *
__s2
, 
size_t
 
__n
)

541 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

544 #ifdef 
__USE_GNU


547 
	$¡rÿ£cmp_l
 (
__cÚ¡
 *
__s1
, __cÚ¡ *
__s2
,

548 
__loÿË_t
 
__loc
)

549 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2, 3));

551 
	$¡ºÿ£cmp_l
 (
__cÚ¡
 *
__s1
, __cÚ¡ *
__s2
,

552 
size_t
 
__n
, 
__loÿË_t
 
__loc
)

553 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2, 4));

556 #ifdef 
__USE_BSD


559 *
	$¡r£p
 (**
__»¡riù
 
__¡ršgp
,

560 
__cÚ¡
 *
__»¡riù
 
__d–im
)

561 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

564 #ifdef 
__USE_XOPEN2K8


566 *
	$¡rsigÇl
 (
__sig
è
__THROW
;

569 *
	$__¡pıy
 (*
__»¡riù
 
__de¡
, 
__cÚ¡
 *__»¡riù 
__¤c
)

570 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

571 *
	$¡pıy
 (*
__»¡riù
 
__de¡
, 
__cÚ¡
 *__»¡riù 
__¤c
)

572 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

576 *
	$__¡²ıy
 (*
__»¡riù
 
__de¡
,

577 
__cÚ¡
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

578 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

579 *
	$¡²ıy
 (*
__»¡riù
 
__de¡
,

580 
__cÚ¡
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

581 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

584 #ifdef 
__USE_GNU


586 
	$¡rv”scmp
 (
__cÚ¡
 *
__s1
, __cÚ¡ *
__s2
)

587 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

590 *
	$¡räy
 (*
__¡ršg
è
__THROW
 
	`__nÚnuÎ
 ((1));

593 *
	$memäob
 (*
__s
, 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1));

595 #iâdeà
ba£Çme


600 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


601 "C++" *
	$ba£Çme
 (*
__f’ame
)

602 
__THROW
 
	`__asm
 ("ba£Çme"è
	`__nÚnuÎ
 ((1));

603 "C++" 
__cÚ¡
 *
	$ba£Çme
 (
__cÚ¡
 *
__f’ame
)

604 
__THROW
 
	`__asm
 ("ba£Çme"è
	`__nÚnuÎ
 ((1));

606 *
	$ba£Çme
 (
__cÚ¡
 *
__f’ame
è
__THROW
 
	`__nÚnuÎ
 ((1));

612 #ià
defšed
 
__GNUC__
 && __GNUC__ >= 2

613 #ià
defšed
 
__OPTIMIZE__
 && !defšed 
__OPTIMIZE_SIZE__
 \

614 && !
defšed
 
__NO_INLINE__
 && !defšed 
__ılu¥lus


634 
	~<b™s/¡ršg.h
>

637 
	~<b™s/¡ršg2.h
>

640 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__ex‹º_®ways_šlše


642 
	~<b™s/¡ršg3.h
>

646 
__END_DECLS


	@/usr/include/sys/stat.h

24 #iâdef 
_SYS_STAT_H


25 
	#_SYS_STAT_H
 1

	)

27 
	~<ã©u»s.h
>

29 
	~<b™s/ty³s.h
>

31 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K
 || defšed 
__USE_MISC
 \

32 || 
defšed
 
	g__USE_ATFILE


33 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K


34 
	#__Ãed_time_t


	)

36 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_ATFILE


37 
	#__Ãed_time¥ec


	)

39 
	~<time.h
>

42 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K


45 #iâdeà
__dev_t_defšed


46 
__dev_t
 
	tdev_t
;

47 
	#__dev_t_defšed


	)

50 #iâdeà
__gid_t_defšed


51 
__gid_t
 
	tgid_t
;

52 
	#__gid_t_defšed


	)

55 #iâdeà
__šo_t_defšed


56 #iâdeà
__USE_FILE_OFFSET64


57 
__šo_t
 
	tšo_t
;

59 
__šo64_t
 
	tšo_t
;

61 
	#__šo_t_defšed


	)

64 #iâdeà
__mode_t_defšed


65 
__mode_t
 
	tmode_t
;

66 
	#__mode_t_defšed


	)

69 #iâdeà
__Æšk_t_defšed


70 
__Æšk_t
 
	tÆšk_t
;

71 
	#__Æšk_t_defšed


	)

74 #iâdeà
__off_t_defšed


75 #iâdeà
__USE_FILE_OFFSET64


76 
__off_t
 
	toff_t
;

78 
__off64_t
 
	toff_t
;

80 
	#__off_t_defšed


	)

83 #iâdeà
__uid_t_defšed


84 
__uid_t
 
	tuid_t
;

85 
	#__uid_t_defšed


	)

89 #ifdeà
__USE_UNIX98


90 #iâdeà
__blkút_t_defšed


91 #iâdeà
__USE_FILE_OFFSET64


92 
__blkút_t
 
	tblkút_t
;

94 
__blkút64_t
 
	tblkút_t
;

96 
	#__blkút_t_defšed


	)

99 #iâdeà
__blksize_t_defšed


100 
__blksize_t
 
	tblksize_t
;

101 
	#__blksize_t_defšed


	)

105 
	g__BEGIN_DECLS


107 
	~<b™s/¡©.h
>

109 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_MISC
 || defšed 
__USE_XOPEN


110 
	#S_IFMT
 
__S_IFMT


	)

111 
	#S_IFDIR
 
__S_IFDIR


	)

112 
	#S_IFCHR
 
__S_IFCHR


	)

113 
	#S_IFBLK
 
__S_IFBLK


	)

114 
	#S_IFREG
 
__S_IFREG


	)

115 #ifdeà
__S_IFIFO


116 
	#S_IFIFO
 
__S_IFIFO


	)

118 #ifdeà
__S_IFLNK


119 
	#S_IFLNK
 
__S_IFLNK


	)

121 #ià(
defšed
 
__USE_BSD
 || defšed 
__USE_MISC
 || defšed 
__USE_UNIX98
) \

122 && 
defšed
 
	g__S_IFSOCK


123 
	#S_IFSOCK
 
__S_IFSOCK


	)

129 
	#__S_ISTYPE
(
mode
, 
mask
è(((modeè& 
__S_IFMT
è=ğ(mask))

	)

131 
	#S_ISDIR
(
mode
è
	`__S_ISTYPE
((mode), 
__S_IFDIR
)

	)

132 
	#S_ISCHR
(
mode
è
	`__S_ISTYPE
((mode), 
__S_IFCHR
)

	)

133 
	#S_ISBLK
(
mode
è
	`__S_ISTYPE
((mode), 
__S_IFBLK
)

	)

134 
	#S_ISREG
(
mode
è
	`__S_ISTYPE
((mode), 
__S_IFREG
)

	)

135 #ifdeà
__S_IFIFO


136 
	#S_ISFIFO
(
mode
è
	`__S_ISTYPE
((mode), 
__S_IFIFO
)

	)

138 #ifdeà
__S_IFLNK


139 
	#S_ISLNK
(
mode
è
	`__S_ISTYPE
((mode), 
__S_IFLNK
)

	)

142 #ià
defšed
 
__USE_BSD
 && !defšed 
__S_IFLNK


143 
	#S_ISLNK
(
mode
è0

	)

146 #ià(
defšed
 
__USE_BSD
 || defšed 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K
) \

147 && 
defšed
 
	g__S_IFSOCK


148 
	#S_ISSOCK
(
mode
è
	`__S_ISTYPE
((mode), 
__S_IFSOCK
)

	)

149 #–ià
defšed
 
__USE_XOPEN2K


150 
	#S_ISSOCK
(
mode
è0

	)

157 #ifdef 
__USE_POSIX199309


158 
	#S_TYPEISMQ
(
buf
è
	`__S_TYPEISMQ
(buf)

	)

159 
	#S_TYPEISSEM
(
buf
è
	`__S_TYPEISSEM
(buf)

	)

160 
	#S_TYPEISSHM
(
buf
è
	`__S_TYPEISSHM
(buf)

	)

166 
	#S_ISUID
 
__S_ISUID


	)

167 
	#S_ISGID
 
__S_ISGID


	)

169 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_MISC
 || defšed 
__USE_XOPEN


171 
	#S_ISVTX
 
__S_ISVTX


	)

174 
	#S_IRUSR
 
__S_IREAD


	)

175 
	#S_IWUSR
 
__S_IWRITE


	)

176 
	#S_IXUSR
 
__S_IEXEC


	)

178 
	#S_IRWXU
 (
__S_IREAD
|
__S_IWRITE
|
__S_IEXEC
)

	)

180 #ià
defšed
 
__USE_MISC
 && defšed 
__USE_BSD


181 
	#S_IREAD
 
S_IRUSR


	)

182 
	#S_IWRITE
 
S_IWUSR


	)

183 
	#S_IEXEC
 
S_IXUSR


	)

186 
	#S_IRGRP
 (
S_IRUSR
 >> 3è

	)

187 
	#S_IWGRP
 (
S_IWUSR
 >> 3è

	)

188 
	#S_IXGRP
 (
S_IXUSR
 >> 3è

	)

190 
	#S_IRWXG
 (
S_IRWXU
 >> 3)

	)

192 
	#S_IROTH
 (
S_IRGRP
 >> 3è

	)

193 
	#S_IWOTH
 (
S_IWGRP
 >> 3è

	)

194 
	#S_IXOTH
 (
S_IXGRP
 >> 3è

	)

196 
	#S_IRWXO
 (
S_IRWXG
 >> 3)

	)

199 #ifdef 
__USE_BSD


201 
	#ACCESSPERMS
 (
S_IRWXU
|
S_IRWXG
|
S_IRWXO
è

	)

202 
	#ALLPERMS
 (
S_ISUID
|
S_ISGID
|
S_ISVTX
|
S_IRWXU
|
S_IRWXG
|
S_IRWXO
)

	)

203 
	#DEFFILEMODE
 (
S_IRUSR
|
S_IWUSR
|
S_IRGRP
|
S_IWGRP
|
S_IROTH
|
S_IWOTH
)

	)

205 
	#S_BLKSIZE
 512

	)

209 #iâdeà
__USE_FILE_OFFSET64


211 
	$¡©
 (
__cÚ¡
 *
__»¡riù
 
__fe
,

212 
¡©
 *
__»¡riù
 
__buf
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

216 
	$f¡©
 (
__fd
, 
¡©
 *
__buf
è
__THROW
 
	`__nÚnuÎ
 ((2));

218 #ifdeà
__REDIRECT_NTH


219 
	`__REDIRECT_NTH
 (
¡©
, (
__cÚ¡
 *
__»¡riù
 
__fe
,

220 
¡©
 *
__»¡riù
 
__buf
), 
¡©64
)

221 
	`__nÚnuÎ
 ((1, 2));

222 
	`__REDIRECT_NTH
 (
f¡©
, (
__fd
, 
¡©
 *
__buf
), 
f¡©64
)

223 
	`__nÚnuÎ
 ((2));

225 
	#¡©
 
¡©64


	)

226 
	#f¡©
 
f¡©64


	)

229 #ifdeà
__USE_LARGEFILE64


230 
	$¡©64
 (
__cÚ¡
 *
__»¡riù
 
__fe
,

231 
¡©64
 *
__»¡riù
 
__buf
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

232 
	$f¡©64
 (
__fd
, 
¡©64
 *
__buf
è
__THROW
 
	`__nÚnuÎ
 ((2));

235 #ifdeà
__USE_ATFILE


239 #iâdeà
__USE_FILE_OFFSET64


240 
	$f¡©©
 (
__fd
, 
__cÚ¡
 *
__»¡riù
 
__fe
,

241 
¡©
 *
__»¡riù
 
__buf
, 
__æag
)

242 
__THROW
 
	`__nÚnuÎ
 ((2, 3));

244 #ifdeà
__REDIRECT_NTH


245 
	`__REDIRECT_NTH
 (
f¡©©
, (
__fd
, 
__cÚ¡
 *
__»¡riù
 
__fe
,

246 
¡©
 *
__»¡riù
 
__buf
,

247 
__æag
),

248 
f¡©©64
è
	`__nÚnuÎ
 ((2, 3));

250 
	#f¡©©
 
f¡©©64


	)

254 #ifdeà
__USE_LARGEFILE64


255 
	$f¡©©64
 (
__fd
, 
__cÚ¡
 *
__»¡riù
 
__fe
,

256 
¡©64
 *
__»¡riù
 
__buf
, 
__æag
)

257 
__THROW
 
	`__nÚnuÎ
 ((2, 3));

261 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K


262 #iâdeà
__USE_FILE_OFFSET64


265 
	$l¡©
 (
__cÚ¡
 *
__»¡riù
 
__fe
,

266 
¡©
 *
__»¡riù
 
__buf
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

268 #ifdeà
__REDIRECT_NTH


269 
	`__REDIRECT_NTH
 (
l¡©
,

270 (
__cÚ¡
 *
__»¡riù
 
__fe
,

271 
¡©
 *
__»¡riù
 
__buf
), 
l¡©64
)

272 
	`__nÚnuÎ
 ((1, 2));

274 
	#l¡©
 
l¡©64


	)

277 #ifdeà
__USE_LARGEFILE64


278 
	$l¡©64
 (
__cÚ¡
 *
__»¡riù
 
__fe
,

279 
¡©64
 *
__»¡riù
 
__buf
)

280 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

286 
	$chmod
 (
__cÚ¡
 *
__fe
, 
__mode_t
 
__mode
)

287 
__THROW
 
	`__nÚnuÎ
 ((1));

289 #ifdeà
__USE_BSD


293 
	$lchmod
 (
__cÚ¡
 *
__fe
, 
__mode_t
 
__mode
)

294 
__THROW
 
	`__nÚnuÎ
 ((1));

298 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


299 
	$fchmod
 (
__fd
, 
__mode_t
 
__mode
è
__THROW
;

302 #ifdeà
__USE_ATFILE


305 
	$fchmod©
 (
__fd
, 
__cÚ¡
 *
__fe
, 
__mode_t
 
__mode
,

306 
__æag
)

307 
__THROW
 
	`__nÚnuÎ
 ((2)è
__wur
;

314 
__mode_t
 
	$umask
 (
__mode_t
 
__mask
è
__THROW
;

316 #ifdef 
__USE_GNU


319 
__mode_t
 
	$g‘umask
 (è
__THROW
;

323 
	$mkdœ
 (
__cÚ¡
 *
__·th
, 
__mode_t
 
__mode
)

324 
__THROW
 
	`__nÚnuÎ
 ((1));

326 #ifdeà
__USE_ATFILE


330 
	$mkdœ©
 (
__fd
, 
__cÚ¡
 *
__·th
, 
__mode_t
 
__mode
)

331 
__THROW
 
	`__nÚnuÎ
 ((2));

337 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED


338 
	$mknod
 (
__cÚ¡
 *
__·th
, 
__mode_t
 
__mode
, 
__dev_t
 
__dev
)

339 
__THROW
 
	`__nÚnuÎ
 ((1));

341 #ifdeà
__USE_ATFILE


345 
	$mknod©
 (
__fd
, 
__cÚ¡
 *
__·th
, 
__mode_t
 
__mode
,

346 
__dev_t
 
__dev
è
__THROW
 
	`__nÚnuÎ
 ((2));

352 
	$mkfifo
 (
__cÚ¡
 *
__·th
, 
__mode_t
 
__mode
)

353 
__THROW
 
	`__nÚnuÎ
 ((1));

355 #ifdeà
__USE_ATFILE


359 
	$mkfifßt
 (
__fd
, 
__cÚ¡
 *
__·th
, 
__mode_t
 
__mode
)

360 
__THROW
 
	`__nÚnuÎ
 ((2));

363 #ifdeà
__USE_ATFILE


366 
	$utim’§t
 (
__fd
, 
__cÚ¡
 *
__·th
,

367 
__cÚ¡
 
time¥ec
 
__times
[2],

368 
__æags
)

369 
__THROW
 
	`__nÚnuÎ
 ((2));

372 #ifdeà
__USE_XOPEN2K8


374 
	$futim’s
 (
__fd
, 
__cÚ¡
 
time¥ec
 
__times
[2]è
__THROW
;

392 #iâdeà
_STAT_VER


393 
	#_STAT_VER
 0

	)

395 #iâdeà
_MKNOD_VER


396 
	#_MKNOD_VER
 0

	)

400 #iâdeà
__USE_FILE_OFFSET64


401 
	$__fx¡©
 (
__v”
, 
__fdes
, 
¡©
 *
__¡©_buf
)

402 
__THROW
 
	`__nÚnuÎ
 ((3));

403 
	$__x¡©
 (
__v”
, 
__cÚ¡
 *
__f’ame
,

404 
¡©
 *
__¡©_buf
è
__THROW
 
	`__nÚnuÎ
 ((2, 3));

405 
	$__lx¡©
 (
__v”
, 
__cÚ¡
 *
__f’ame
,

406 
¡©
 *
__¡©_buf
è
__THROW
 
	`__nÚnuÎ
 ((2, 3));

407 
	$__fx¡©©
 (
__v”
, 
__fdes
, 
__cÚ¡
 *
__f’ame
,

408 
¡©
 *
__¡©_buf
, 
__æag
)

409 
__THROW
 
	`__nÚnuÎ
 ((3, 4));

411 #ifdeà
__REDIRECT_NTH


412 
	`__REDIRECT_NTH
 (
__fx¡©
, (
__v”
, 
__fdes
,

413 
¡©
 *
__¡©_buf
), 
__fx¡©64
)

414 
	`__nÚnuÎ
 ((3));

415 
	`__REDIRECT_NTH
 (
__x¡©
, (
__v”
, 
__cÚ¡
 *
__f’ame
,

416 
¡©
 *
__¡©_buf
), 
__x¡©64
)

417 
	`__nÚnuÎ
 ((2, 3));

418 
	`__REDIRECT_NTH
 (
__lx¡©
, (
__v”
, 
__cÚ¡
 *
__f’ame
,

419 
¡©
 *
__¡©_buf
), 
__lx¡©64
)

420 
	`__nÚnuÎ
 ((2, 3));

421 
	`__REDIRECT_NTH
 (
__fx¡©©
, (
__v”
, 
__fdes
,

422 
__cÚ¡
 *
__f’ame
,

423 
¡©
 *
__¡©_buf
, 
__æag
),

424 
__fx¡©©64
è
	`__nÚnuÎ
 ((3, 4));

427 
	#__fx¡©
 
__fx¡©64


	)

428 
	#__x¡©
 
__x¡©64


	)

429 
	#__lx¡©
 
__lx¡©64


	)

433 #ifdeà
__USE_LARGEFILE64


434 
	$__fx¡©64
 (
__v”
, 
__fdes
, 
¡©64
 *
__¡©_buf
)

435 
__THROW
 
	`__nÚnuÎ
 ((3));

436 
	$__x¡©64
 (
__v”
, 
__cÚ¡
 *
__f’ame
,

437 
¡©64
 *
__¡©_buf
è
__THROW
 
	`__nÚnuÎ
 ((2, 3));

438 
	$__lx¡©64
 (
__v”
, 
__cÚ¡
 *
__f’ame
,

439 
¡©64
 *
__¡©_buf
è
__THROW
 
	`__nÚnuÎ
 ((2, 3));

440 
	$__fx¡©©64
 (
__v”
, 
__fdes
, 
__cÚ¡
 *
__f’ame
,

441 
¡©64
 *
__¡©_buf
, 
__æag
)

442 
__THROW
 
	`__nÚnuÎ
 ((3, 4));

444 
	$__xmknod
 (
__v”
, 
__cÚ¡
 *
__·th
, 
__mode_t
 
__mode
,

445 
__dev_t
 *
__dev
è
__THROW
 
	`__nÚnuÎ
 ((2, 4));

447 
	$__xmknod©
 (
__v”
, 
__fd
, 
__cÚ¡
 *
__·th
,

448 
__mode_t
 
__mode
, 
__dev_t
 *
__dev
)

449 
__THROW
 
	`__nÚnuÎ
 ((3, 5));

451 #ià
defšed
 
__GNUC__
 && __GNUC__ >ğ2 && defšed 
__USE_EXTERN_INLINES


454 
__ex‹º_šlše
 

455 
	`__NTH
 (
	$¡©
 (
__cÚ¡
 *
__·th
, 
¡©
 *
__¡©buf
))

457  
	`__x¡©
 (
_STAT_VER
, 
__·th
, 
__¡©buf
);

458 
	}
}

460 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED


461 
__ex‹º_šlše
 

462 
__NTH
 (
	$l¡©
 (
__cÚ¡
 *
__·th
, 
¡©
 *
__¡©buf
))

464  
	`__lx¡©
 (
_STAT_VER
, 
__·th
, 
__¡©buf
);

465 
	}
}

468 
__ex‹º_šlše
 

469 
__NTH
 (
	$f¡©
 (
__fd
, 
¡©
 *
__¡©buf
))

471  
	`__fx¡©
 (
_STAT_VER
, 
__fd
, 
__¡©buf
);

472 
	}
}

474 #ifdeà
__USE_ATFILE


475 
__ex‹º_šlše
 

476 
__NTH
 (
	$f¡©©
 (
__fd
, 
__cÚ¡
 *
__f’ame
, 
¡©
 *
__¡©buf
,

477 
__æag
))

479  
	`__fx¡©©
 (
_STAT_VER
, 
__fd
, 
__f’ame
, 
__¡©buf
, 
__æag
);

480 
	}
}

483 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_BSD


484 
__ex‹º_šlše
 

485 
__NTH
 (
	$mknod
 (
__cÚ¡
 *
__·th
, 
__mode_t
 
__mode
, 
__dev_t
 
__dev
))

487  
	`__xmknod
 (
_MKNOD_VER
, 
__·th
, 
__mode
, &
__dev
);

488 
	}
}

491 #ifdeà
__USE_ATFILE


492 
__ex‹º_šlše
 

493 
__NTH
 (
	$mknod©
 (
__fd
, 
__cÚ¡
 *
__·th
, 
__mode_t
 
__mode
,

494 
__dev_t
 
__dev
))

496  
	`__xmknod©
 (
_MKNOD_VER
, 
__fd
, 
__·th
, 
__mode
, &
__dev
);

497 
	}
}

500 #ià
defšed
 
__USE_LARGEFILE64
 \

501 && (! 
defšed
 
	g__USE_FILE_OFFSET64
 \

502 || (
defšed
 
	g__REDIRECT_NTH
 && defšed 
	g__OPTIMIZE__
))

503 
__ex‹º_šlše
 

504 
__NTH
 (
	$¡©64
 (
__cÚ¡
 *
__·th
, 
¡©64
 *
__¡©buf
))

506  
	`__x¡©64
 (
_STAT_VER
, 
__·th
, 
__¡©buf
);

507 
	}
}

509 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED


510 
__ex‹º_šlše
 

511 
__NTH
 (
	$l¡©64
 (
__cÚ¡
 *
__·th
, 
¡©64
 *
__¡©buf
))

513  
	`__lx¡©64
 (
_STAT_VER
, 
__·th
, 
__¡©buf
);

514 
	}
}

517 
__ex‹º_šlše
 

518 
__NTH
 (
	$f¡©64
 (
__fd
, 
¡©64
 *
__¡©buf
))

520  
	`__fx¡©64
 (
_STAT_VER
, 
__fd
, 
__¡©buf
);

521 
	}
}

523 #ifdeà
__USE_ATFILE


524 
__ex‹º_šlše
 

525 
__NTH
 (
	$f¡©©64
 (
__fd
, 
__cÚ¡
 *
__f’ame
, 
¡©64
 *
__¡©buf
,

526 
__æag
))

528  
	`__fx¡©©64
 (
_STAT_VER
, 
__fd
, 
__f’ame
, 
__¡©buf
, 
__æag
);

529 
	}
}

536 
	g__END_DECLS


	@/usr/include/unistd.h

23 #iâdef 
_UNISTD_H


24 
	#_UNISTD_H
 1

	)

26 
	~<ã©u»s.h
>

28 
	g__BEGIN_DECLS


33 #ifdeà
__USE_XOPEN2K8


35 
	#_POSIX_VERSION
 200809L

	)

36 #–ià
defšed
 
__USE_XOPEN2K


38 
	#_POSIX_VERSION
 200112L

	)

39 #–ià
defšed
 
__USE_POSIX199506


41 
	#_POSIX_VERSION
 199506L

	)

42 #–ià
defšed
 
__USE_POSIX199309


44 
	#_POSIX_VERSION
 199309L

	)

47 
	#_POSIX_VERSION
 199009L

	)

53 #ifdeà
__USE_XOPEN2K8


54 
	#__POSIX2_THIS_VERSION
 200809L

	)

56 #–ià
defšed
 
__USE_XOPEN2K


58 
	#__POSIX2_THIS_VERSION
 200112L

	)

59 #–ià
defšed
 
__USE_POSIX199506


61 
	#__POSIX2_THIS_VERSION
 199506L

	)

64 
	#__POSIX2_THIS_VERSION
 199209L

	)

68 
	#_POSIX2_VERSION
 
__POSIX2_THIS_VERSION


	)

72 
	#_POSIX2_C_BIND
 
__POSIX2_THIS_VERSION


	)

76 
	#_POSIX2_C_DEV
 
__POSIX2_THIS_VERSION


	)

80 
	#_POSIX2_SW_DEV
 
__POSIX2_THIS_VERSION


	)

84 
	#_POSIX2_LOCALEDEF
 
__POSIX2_THIS_VERSION


	)

87 #ifdeà
__USE_XOPEN2K8


88 
	#_XOPEN_VERSION
 700

	)

89 #–ià
defšed
 
__USE_XOPEN2K


90 
	#_XOPEN_VERSION
 600

	)

91 #–ià
defšed
 
__USE_UNIX98


92 
	#_XOPEN_VERSION
 500

	)

94 
	#_XOPEN_VERSION
 4

	)

98 
	#_XOPEN_XCU_VERSION
 4

	)

101 
	#_XOPEN_XPG2
 1

	)

102 
	#_XOPEN_XPG3
 1

	)

103 
	#_XOPEN_XPG4
 1

	)

106 
	#_XOPEN_UNIX
 1

	)

109 
	#_XOPEN_CRYPT
 1

	)

113 
	#_XOPEN_ENH_I18N
 1

	)

116 
	#_XOPEN_LEGACY
 1

	)

203 
	~<b™s/posix_İt.h
>

206 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K


207 
	~<b™s/’vœÚm’ts.h
>

211 
	#STDIN_FILENO
 0

	)

212 
	#STDOUT_FILENO
 1

	)

213 
	#STDERR_FILENO
 2

	)

218 
	~<b™s/ty³s.h
>

220 #iâdef 
__ssize_t_defšed


221 
__ssize_t
 
	tssize_t
;

222 
	#__ssize_t_defšed


	)

225 
	#__Ãed_size_t


	)

226 
	#__Ãed_NULL


	)

227 
	~<¡ddef.h
>

229 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K


232 #iâdeà
__gid_t_defšed


233 
__gid_t
 
	tgid_t
;

234 
	#__gid_t_defšed


	)

237 #iâdeà
__uid_t_defšed


238 
__uid_t
 
	tuid_t
;

239 
	#__uid_t_defšed


	)

242 #iâdeà
__off_t_defšed


243 #iâdeà
__USE_FILE_OFFSET64


244 
__off_t
 
	toff_t
;

246 
__off64_t
 
	toff_t
;

248 
	#__off_t_defšed


	)

250 #ià
defšed
 
__USE_LARGEFILE64
 && !defšed 
__off64_t_defšed


251 
__off64_t
 
	toff64_t
;

252 
	#__off64_t_defšed


	)

255 #iâdeà
__u£cÚds_t_defšed


256 
__u£cÚds_t
 
	tu£cÚds_t
;

257 
	#__u£cÚds_t_defšed


	)

260 #iâdeà
__pid_t_defšed


261 
__pid_t
 
	tpid_t
;

262 
	#__pid_t_defšed


	)

266 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K


267 #iâdeà
__šŒ_t_defšed


268 
__šŒ_t
 
	tšŒ_t
;

269 
	#__šŒ_t_defšed


	)

273 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN


274 #iâdeà
__sockËn_t_defšed


275 
__sockËn_t
 
	tsockËn_t
;

276 
	#__sockËn_t_defšed


	)

282 
	#R_OK
 4

	)

283 
	#W_OK
 2

	)

284 
	#X_OK
 1

	)

285 
	#F_OK
 0

	)

288 
	$acûss
 (
__cÚ¡
 *
__Çme
, 
__ty³
è
__THROW
 
	`__nÚnuÎ
 ((1));

290 #ifdeà
__USE_GNU


293 
	$euidacûss
 (
__cÚ¡
 *
__Çme
, 
__ty³
)

294 
__THROW
 
	`__nÚnuÎ
 ((1));

297 
	$—cûss
 (
__cÚ¡
 *
__Çme
, 
__ty³
)

298 
__THROW
 
	`__nÚnuÎ
 ((1));

301 #ifdeà
__USE_ATFILE


305 
	$çcûs§t
 (
__fd
, 
__cÚ¡
 *
__fe
, 
__ty³
, 
__æag
)

306 
__THROW
 
	`__nÚnuÎ
 ((2)è
__wur
;

311 #iâdef 
_STDIO_H


312 
	#SEEK_SET
 0

	)

313 
	#SEEK_CUR
 1

	)

314 
	#SEEK_END
 2

	)

317 #ià
defšed
 
__USE_BSD
 && !defšed 
L_SET


319 
	#L_SET
 
SEEK_SET


	)

320 
	#L_INCR
 
SEEK_CUR


	)

321 
	#L_XTND
 
SEEK_END


	)

330 #iâdeà
__USE_FILE_OFFSET64


331 
__off_t
 
	$l£ek
 (
__fd
, 
__off_t
 
__off£t
, 
__wh’û
è
__THROW
;

333 #ifdeà
__REDIRECT_NTH


334 
__off64_t
 
	`__REDIRECT_NTH
 (
l£ek
,

335 (
__fd
, 
__off64_t
 
__off£t
, 
__wh’û
),

336 
l£ek64
);

338 
	#l£ek
 
l£ek64


	)

341 #ifdeà
__USE_LARGEFILE64


342 
__off64_t
 
	$l£ek64
 (
__fd
, 
__off64_t
 
__off£t
, 
__wh’û
)

343 
__THROW
;

350 
	`şo£
 (
__fd
);

357 
ssize_t
 
	$»ad
 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
è
__wur
;

363 
ssize_t
 
	$wr™e
 (
__fd
, 
__cÚ¡
 *
__buf
, 
size_t
 
__n
è
__wur
;

365 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K8


366 #iâdeà
__USE_FILE_OFFSET64


373 
ssize_t
 
	$´—d
 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
,

374 
__off_t
 
__off£t
è
__wur
;

381 
ssize_t
 
	$pwr™e
 (
__fd
, 
__cÚ¡
 *
__buf
, 
size_t
 
__n
,

382 
__off_t
 
__off£t
è
__wur
;

384 #ifdeà
__REDIRECT


385 
ssize_t
 
	`__REDIRECT
 (
´—d
, (
__fd
, *
__buf
, 
size_t
 
__nby‹s
,

386 
__off64_t
 
__off£t
),

387 
´—d64
è
__wur
;

388 
ssize_t
 
	`__REDIRECT
 (
pwr™e
, (
__fd
, 
__cÚ¡
 *
__buf
,

389 
size_t
 
__nby‹s
, 
__off64_t
 
__off£t
),

390 
pwr™e64
è
__wur
;

392 
	#´—d
 
´—d64


	)

393 
	#pwr™e
 
pwr™e64


	)

397 #ifdeà
__USE_LARGEFILE64


401 
ssize_t
 
	$´—d64
 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
,

402 
__off64_t
 
__off£t
è
__wur
;

405 
ssize_t
 
	$pwr™e64
 (
__fd
, 
__cÚ¡
 *
__buf
, 
size_t
 
__n
,

406 
__off64_t
 
__off£t
è
__wur
;

414 
	$pe
 (
__pedes
[2]è
__THROW
 
__wur
;

416 #ifdeà
__USE_GNU


419 
	$pe2
 (
__pedes
[2], 
__æags
è
__THROW
 
__wur
;

429 
	$®¬m
 (
__£cÚds
è
__THROW
;

441 
	`¦“p
 (
__£cÚds
);

443 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K8
) \

444 || 
defšed
 
__USE_BSD


449 
__u£cÚds_t
 
	$u®¬m
 (
__u£cÚds_t
 
__v®ue
, __u£cÚds_ˆ
__š‹rv®
)

450 
__THROW
;

457 
	`u¦“p
 (
__u£cÚds_t
 
__u£cÚds
);

466 
	`·u£
 ();

470 
	$chown
 (
__cÚ¡
 *
__fe
, 
__uid_t
 
__owÃr
, 
__gid_t
 
__group
)

471 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

473 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


475 
	$fchown
 (
__fd
, 
__uid_t
 
__owÃr
, 
__gid_t
 
__group
è
__THROW
 
__wur
;

480 
	$lchown
 (
__cÚ¡
 *
__fe
, 
__uid_t
 
__owÃr
, 
__gid_t
 
__group
)

481 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

485 #ifdeà
__USE_ATFILE


488 
	$fchowÇt
 (
__fd
, 
__cÚ¡
 *
__fe
, 
__uid_t
 
__owÃr
,

489 
__gid_t
 
__group
, 
__æag
)

490 
__THROW
 
	`__nÚnuÎ
 ((2)è
__wur
;

494 
	$chdœ
 (
__cÚ¡
 *
__·th
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

496 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


498 
	$fchdœ
 (
__fd
è
__THROW
 
__wur
;

508 *
	$g‘cwd
 (*
__buf
, 
size_t
 
__size
è
__THROW
 
__wur
;

510 #ifdef 
__USE_GNU


514 *
	$g‘_cu¼’t_dœ_Çme
 (è
__THROW
;

517 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K8
) \

518 || 
defšed
 
__USE_BSD


522 *
	$g‘wd
 (*
__buf
)

523 
__THROW
 
	`__nÚnuÎ
 ((1)è
__©Œibu‹_d•»ÿ‹d__
 
__wur
;

528 
	$dup
 (
__fd
è
__THROW
 
__wur
;

531 
	$dup2
 (
__fd
, 
__fd2
è
__THROW
;

533 #ifdeà
__USE_GNU


536 
	$dup3
 (
__fd
, 
__fd2
, 
__æags
è
__THROW
;

540 **
__’vœÚ
;

541 #ifdeà
__USE_GNU


542 **
’vœÚ
;

548 
	$execve
 (
__cÚ¡
 *
__·th
, *__cÚ¡ 
__¬gv
[],

549 *
__cÚ¡
 
__’vp
[]è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

551 #ifdeà
__USE_XOPEN2K8


554 
	$ãxecve
 (
__fd
, *
__cÚ¡
 
__¬gv
[], *__cÚ¡ 
__’vp
[])

555 
__THROW
 
	`__nÚnuÎ
 ((2));

560 
	$execv
 (
__cÚ¡
 *
__·th
, *__cÚ¡ 
__¬gv
[])

561 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

565 
	$exeşe
 (
__cÚ¡
 *
__·th
, __cÚ¡ *
__¬g
, ...)

566 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

570 
	$exeş
 (
__cÚ¡
 *
__·th
, __cÚ¡ *
__¬g
, ...)

571 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

575 
	$execvp
 (
__cÚ¡
 *
__fe
, *__cÚ¡ 
__¬gv
[])

576 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

581 
	$exeşp
 (
__cÚ¡
 *
__fe
, __cÚ¡ *
__¬g
, ...)

582 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

584 #ifdeà
__USE_GNU


587 
	$execv³
 (
__cÚ¡
 *
__fe
, *__cÚ¡ 
__¬gv
[],

588 *
__cÚ¡
 
__’vp
[])

589 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

593 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


595 
	$niû
 (
__šc
è
__THROW
 
__wur
;

600 
	$_ex™
 (
__¡©us
è
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

606 
	~<b™s/cÚâame.h
>

609 
	$·thcÚf
 (
__cÚ¡
 *
__·th
, 
__Çme
)

610 
__THROW
 
	`__nÚnuÎ
 ((1));

613 
	$å©hcÚf
 (
__fd
, 
__Çme
è
__THROW
;

616 
	$syscÚf
 (
__Çme
è
__THROW
;

618 #ifdef 
__USE_POSIX2


620 
size_t
 
	$cÚf¡r
 (
__Çme
, *
__buf
, 
size_t
 
__Ën
è
__THROW
;

625 
__pid_t
 
	$g‘pid
 (è
__THROW
;

628 
__pid_t
 
	$g‘µid
 (è
__THROW
;

632 #iâdeà
__FAVOR_BSD


633 
__pid_t
 
	$g‘pg½
 (è
__THROW
;

635 #ifdeà
__REDIRECT_NTH


636 
__pid_t
 
	`__REDIRECT_NTH
 (
g‘pg½
, (__pid_ˆ
__pid
), 
__g‘pgid
);

638 
	#g‘pg½
 
__g‘pgid


	)

643 
__pid_t
 
	$__g‘pgid
 (
__pid_t
 
__pid
è
__THROW
;

644 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


645 
__pid_t
 
	$g‘pgid
 (
__pid_t
 
__pid
è
__THROW
;

652 
	$£gid
 (
__pid_t
 
__pid
, __pid_ˆ
__pgid
è
__THROW
;

654 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED


665 #iâdeà
__FAVOR_BSD


669 
	$£g½
 (è
__THROW
;

674 #ifdeà
__REDIRECT_NTH


675 
	`__REDIRECT_NTH
 (
£g½
, (
__pid_t
 
__pid
, __pid_ˆ
__pg½
), 
£gid
);

677 
	#£g½
 
£gid


	)

686 
__pid_t
 
	$£tsid
 (è
__THROW
;

688 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


690 
__pid_t
 
	$g‘sid
 (
__pid_t
 
__pid
è
__THROW
;

694 
__uid_t
 
	$g‘uid
 (è
__THROW
;

697 
__uid_t
 
	$g‘euid
 (è
__THROW
;

700 
__gid_t
 
	$g‘gid
 (è
__THROW
;

703 
__gid_t
 
	$g‘egid
 (è
__THROW
;

708 
	$g‘groups
 (
__size
, 
__gid_t
 
__li¡
[]è
__THROW
 
__wur
;

710 #ifdef 
__USE_GNU


712 
	$group_memb”
 (
__gid_t
 
__gid
è
__THROW
;

719 
	$£tuid
 (
__uid_t
 
__uid
è
__THROW
;

721 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED


724 
	$£Œeuid
 (
__uid_t
 
__ruid
, __uid_ˆ
__euid
è
__THROW
;

727 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN2K


729 
	$£‹uid
 (
__uid_t
 
__uid
è
__THROW
;

736 
	$£tgid
 (
__gid_t
 
__gid
è
__THROW
;

738 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED


741 
	$£Œegid
 (
__gid_t
 
__rgid
, __gid_ˆ
__egid
è
__THROW
;

744 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN2K


746 
	$£‹gid
 (
__gid_t
 
__gid
è
__THROW
;

749 #ifdeà
__USE_GNU


752 
	$g‘»suid
 (
__uid_t
 *
__ruid
, __uid_ˆ*
__euid
, __uid_ˆ*
__suid
)

753 
__THROW
;

757 
	$g‘»sgid
 (
__gid_t
 *
__rgid
, __gid_ˆ*
__egid
, __gid_ˆ*
__sgid
)

758 
__THROW
;

762 
	$£Œesuid
 (
__uid_t
 
__ruid
, __uid_ˆ
__euid
, __uid_ˆ
__suid
)

763 
__THROW
;

767 
	$£Œesgid
 (
__gid_t
 
__rgid
, __gid_ˆ
__egid
, __gid_ˆ
__sgid
)

768 
__THROW
;

775 
__pid_t
 
	$fÜk
 (è
__THROW
;

777 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K8
) \

778 || 
defšed
 
__USE_BSD


783 
__pid_t
 
	$vfÜk
 (è
__THROW
;

789 *
	$‰yÇme
 (
__fd
è
__THROW
;

793 
	$‰yÇme_r
 (
__fd
, *
__buf
, 
size_t
 
__buæ’
)

794 
__THROW
 
	`__nÚnuÎ
 ((2)è
__wur
;

798 
	$i§‰y
 (
__fd
è
__THROW
;

800 #ià
defšed
 
__USE_BSD
 \

801 || (
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_UNIX98
)

804 
	$‰y¦Ù
 (è
__THROW
;

809 
	$lšk
 (
__cÚ¡
 *
__äom
, __cÚ¡ *
__to
)

810 
__THROW
 
	`__nÚnuÎ
 ((1, 2)è
__wur
;

812 #ifdeà
__USE_ATFILE


815 
	$lšk©
 (
__äomfd
, 
__cÚ¡
 *
__äom
, 
__tofd
,

816 
__cÚ¡
 *
__to
, 
__æags
)

817 
__THROW
 
	`__nÚnuÎ
 ((2, 4)è
__wur
;

820 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K


822 
	$symlšk
 (
__cÚ¡
 *
__äom
, __cÚ¡ *
__to
)

823 
__THROW
 
	`__nÚnuÎ
 ((1, 2)è
__wur
;

828 
ssize_t
 
	$»adlšk
 (
__cÚ¡
 *
__»¡riù
 
__·th
,

829 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
)

830 
__THROW
 
	`__nÚnuÎ
 ((1, 2)è
__wur
;

833 #ifdeà
__USE_ATFILE


835 
	$symlšk©
 (
__cÚ¡
 *
__äom
, 
__tofd
,

836 
__cÚ¡
 *
__to
è
__THROW
 
	`__nÚnuÎ
 ((1, 3)è
__wur
;

839 
ssize_t
 
	$»adlšk©
 (
__fd
, 
__cÚ¡
 *
__»¡riù
 
__·th
,

840 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
)

841 
__THROW
 
	`__nÚnuÎ
 ((2, 3)è
__wur
;

845 
	$uÆšk
 (
__cÚ¡
 *
__Çme
è
__THROW
 
	`__nÚnuÎ
 ((1));

847 #ifdeà
__USE_ATFILE


849 
	$uÆšk©
 (
__fd
, 
__cÚ¡
 *
__Çme
, 
__æag
)

850 
__THROW
 
	`__nÚnuÎ
 ((2));

854 
	$rmdœ
 (
__cÚ¡
 *
__·th
è
__THROW
 
	`__nÚnuÎ
 ((1));

858 
__pid_t
 
	$tcg‘pg½
 (
__fd
è
__THROW
;

861 
	$tc£g½
 (
__fd
, 
__pid_t
 
__pg½_id
è
__THROW
;

868 *
	`g‘logš
 ();

869 #ià
defšed
 
__USE_REENTRANT
 || defšed 
__USE_POSIX199506


876 
	$g‘logš_r
 (*
__Çme
, 
size_t
 
__Çme_Ën
è
	`__nÚnuÎ
 ((1));

879 #ifdef 
__USE_BSD


881 
	$£ogš
 (
__cÚ¡
 *
__Çme
è
__THROW
 
	`__nÚnuÎ
 ((1));

885 #ifdef 
__USE_POSIX2


889 
	#__Ãed_g‘İt


	)

890 
	~<g‘İt.h
>

894 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K


898 
	$g‘ho¡Çme
 (*
__Çme
, 
size_t
 
__Ën
è
__THROW
 
	`__nÚnuÎ
 ((1));

902 #ià
defšed
 
__USE_BSD
 || (defšed 
__USE_XOPEN
 && !defšed 
__USE_UNIX98
)

905 
	$£tho¡Çme
 (
__cÚ¡
 *
__Çme
, 
size_t
 
__Ën
)

906 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

910 
	$£tho¡id
 (
__id
è
__THROW
 
__wur
;

916 
	$g‘domašÇme
 (*
__Çme
, 
size_t
 
__Ën
)

917 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

918 
	$£tdomašÇme
 (
__cÚ¡
 *
__Çme
, 
size_t
 
__Ën
)

919 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

925 
	$vhªgup
 (è
__THROW
;

928 
	$»voke
 (
__cÚ¡
 *
__fe
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

936 
	$´of
 (*
__§m¶e_bufãr
, 
size_t
 
__size
,

937 
size_t
 
__off£t
, 
__sÿË
)

938 
__THROW
 
	`__nÚnuÎ
 ((1));

944 
	$acù
 (
__cÚ¡
 *
__Çme
è
__THROW
;

948 *
	$g‘u£rsh–l
 (è
__THROW
;

949 
	$’du£rsh–l
 (è
__THROW
;

950 
	$£tu£rsh–l
 (è
__THROW
;

956 
	$d«mÚ
 (
__nochdœ
, 
__noşo£
è
__THROW
 
__wur
;

960 #ià
defšed
 
__USE_BSD
 || (defšed 
__USE_XOPEN
 && !defšed 
__USE_XOPEN2K
)

963 
	$chroÙ
 (
__cÚ¡
 *
__·th
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

967 *
	$g‘·ss
 (
__cÚ¡
 *
__´om±
è
	`__nÚnuÎ
 ((1));

971 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K


976 
	`fsync
 (
__fd
);

980 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED


983 
	`g‘ho¡id
 ();

986 
	$sync
 (è
__THROW
;

989 #ià
defšed
 
__USE_BSD
 || !defšed 
__USE_XOPEN2K


992 
	$g‘·gesize
 (è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

997 
	$g‘dbËsize
 (è
__THROW
;

1003 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


1006 #iâdeà
__USE_FILE_OFFSET64


1007 
	$Œunÿ‹
 (
__cÚ¡
 *
__fe
, 
__off_t
 
__Ëngth
)

1008 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

1010 #ifdeà
__REDIRECT_NTH


1011 
	`__REDIRECT_NTH
 (
Œunÿ‹
,

1012 (
__cÚ¡
 *
__fe
, 
__off64_t
 
__Ëngth
),

1013 
Œunÿ‹64
è
	`__nÚnuÎ
 ((1)è
__wur
;

1015 
	#Œunÿ‹
 
Œunÿ‹64


	)

1018 #ifdeà
__USE_LARGEFILE64


1019 
	$Œunÿ‹64
 (
__cÚ¡
 *
__fe
, 
__off64_t
 
__Ëngth
)

1020 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

1025 #iâdeà
__USE_FILE_OFFSET64


1026 
	$árunÿ‹
 (
__fd
, 
__off_t
 
__Ëngth
è
__THROW
 
__wur
;

1028 #ifdeà
__REDIRECT_NTH


1029 
	`__REDIRECT_NTH
 (
árunÿ‹
, (
__fd
, 
__off64_t
 
__Ëngth
),

1030 
árunÿ‹64
è
__wur
;

1032 
	#árunÿ‹
 
árunÿ‹64


	)

1035 #ifdeà
__USE_LARGEFILE64


1036 
	$árunÿ‹64
 (
__fd
, 
__off64_t
 
__Ëngth
è
__THROW
 
__wur
;

1042 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K
) \

1043 || 
defšed
 
__USE_MISC


1047 
	$brk
 (*
__addr
è
__THROW
 
__wur
;

1053 *
	$sbrk
 (
šŒ_t
 
__d–
è
__THROW
;

1057 #ifdeà
__USE_MISC


1068 
	$sysÿÎ
 (
__sy¢o
, ...è
__THROW
;

1073 #ià(
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED
è&& !defšed 
F_LOCK


1085 
	#F_ULOCK
 0

	)

1086 
	#F_LOCK
 1

	)

1087 
	#F_TLOCK
 2

	)

1088 
	#F_TEST
 3

	)

1090 #iâdeà
__USE_FILE_OFFSET64


1091 
	$lockf
 (
__fd
, 
__cmd
, 
__off_t
 
__Ën
è
__wur
;

1093 #ifdeà
__REDIRECT


1094 
	`__REDIRECT
 (
lockf
, (
__fd
, 
__cmd
, 
__off64_t
 
__Ën
),

1095 
lockf64
è
__wur
;

1097 
	#lockf
 
lockf64


	)

1100 #ifdeà
__USE_LARGEFILE64


1101 
	$lockf64
 (
__fd
, 
__cmd
, 
__off64_t
 
__Ën
è
__wur
;

1106 #ifdeà
__USE_GNU


1111 
	#TEMP_FAILURE_RETRY
(
ex´essiÚ
) \

1112 (
__ex‹nsiÚ__
 \

1113 ({ 
__»suÉ
; \

1114 dØ
__»suÉ
 = (è(
ex´essiÚ
); \

1115 
__»suÉ
 =ğ-1L && 
”ºo
 =ğ
EINTR
); \

1116 
__»suÉ
; 
	}
}))

	)

1119 #ià
defšed
 
__USE_POSIX199309
 || defšed 
__USE_UNIX98


1122 
fd©async
 (
__fdes
);

1128 #ifdef 
__USE_XOPEN


1130 *
	$üy±
 (
__cÚ¡
 *
__key
, __cÚ¡ *
__§É
)

1131 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

1135 
	$’üy±
 (*
__block
, 
__edæag
è
__THROW
 
	`__nÚnuÎ
 ((1));

1142 
	$swab
 (
__cÚ¡
 *
__»¡riù
 
__äom
, *__»¡riù 
__to
,

1143 
ssize_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

1149 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8


1151 *
	$ù”mid
 (*
__s
è
__THROW
;

1156 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__ex‹º_®ways_šlše


1157 
	~<b™s/uni¡d.h
>

1160 
__END_DECLS


	@/usr/include/alloca.h

19 #iâdef 
_ALLOCA_H


20 
	#_ALLOCA_H
 1

	)

22 
	~<ã©u»s.h
>

24 
	#__Ãed_size_t


	)

25 
	~<¡ddef.h
>

27 
	g__BEGIN_DECLS


30 #undeà
®loÿ


33 *
	$®loÿ
 (
size_t
 
__size
è
__THROW
;

35 #ifdef 
__GNUC__


36 
	#®loÿ
(
size
è
	`__butš_®loÿ
 (size)

	)

39 
__END_DECLS


	@/usr/include/bits/confname.h

21 #iâdeà
_UNISTD_H


28 
	m_PC_LINK_MAX
,

29 
	#_PC_LINK_MAX
 
_PC_LINK_MAX


	)

30 
	m_PC_MAX_CANON
,

31 
	#_PC_MAX_CANON
 
_PC_MAX_CANON


	)

32 
	m_PC_MAX_INPUT
,

33 
	#_PC_MAX_INPUT
 
_PC_MAX_INPUT


	)

34 
	m_PC_NAME_MAX
,

35 
	#_PC_NAME_MAX
 
_PC_NAME_MAX


	)

36 
	m_PC_PATH_MAX
,

37 
	#_PC_PATH_MAX
 
_PC_PATH_MAX


	)

38 
	m_PC_PIPE_BUF
,

39 
	#_PC_PIPE_BUF
 
_PC_PIPE_BUF


	)

40 
	m_PC_CHOWN_RESTRICTED
,

41 
	#_PC_CHOWN_RESTRICTED
 
_PC_CHOWN_RESTRICTED


	)

42 
	m_PC_NO_TRUNC
,

43 
	#_PC_NO_TRUNC
 
_PC_NO_TRUNC


	)

44 
	m_PC_VDISABLE
,

45 
	#_PC_VDISABLE
 
_PC_VDISABLE


	)

46 
	m_PC_SYNC_IO
,

47 
	#_PC_SYNC_IO
 
_PC_SYNC_IO


	)

48 
	m_PC_ASYNC_IO
,

49 
	#_PC_ASYNC_IO
 
_PC_ASYNC_IO


	)

50 
	m_PC_PRIO_IO
,

51 
	#_PC_PRIO_IO
 
_PC_PRIO_IO


	)

52 
	m_PC_SOCK_MAXBUF
,

53 
	#_PC_SOCK_MAXBUF
 
_PC_SOCK_MAXBUF


	)

54 
	m_PC_FILESIZEBITS
,

55 
	#_PC_FILESIZEBITS
 
_PC_FILESIZEBITS


	)

56 
	m_PC_REC_INCR_XFER_SIZE
,

57 
	#_PC_REC_INCR_XFER_SIZE
 
_PC_REC_INCR_XFER_SIZE


	)

58 
	m_PC_REC_MAX_XFER_SIZE
,

59 
	#_PC_REC_MAX_XFER_SIZE
 
_PC_REC_MAX_XFER_SIZE


	)

60 
	m_PC_REC_MIN_XFER_SIZE
,

61 
	#_PC_REC_MIN_XFER_SIZE
 
_PC_REC_MIN_XFER_SIZE


	)

62 
	m_PC_REC_XFER_ALIGN
,

63 
	#_PC_REC_XFER_ALIGN
 
_PC_REC_XFER_ALIGN


	)

64 
	m_PC_ALLOC_SIZE_MIN
,

65 
	#_PC_ALLOC_SIZE_MIN
 
_PC_ALLOC_SIZE_MIN


	)

66 
	m_PC_SYMLINK_MAX
,

67 
	#_PC_SYMLINK_MAX
 
_PC_SYMLINK_MAX


	)

68 
	m_PC_2_SYMLINKS


69 
	#_PC_2_SYMLINKS
 
_PC_2_SYMLINKS


	)

75 
	m_SC_ARG_MAX
,

76 
	#_SC_ARG_MAX
 
_SC_ARG_MAX


	)

77 
	m_SC_CHILD_MAX
,

78 
	#_SC_CHILD_MAX
 
_SC_CHILD_MAX


	)

79 
	m_SC_CLK_TCK
,

80 
	#_SC_CLK_TCK
 
_SC_CLK_TCK


	)

81 
	m_SC_NGROUPS_MAX
,

82 
	#_SC_NGROUPS_MAX
 
_SC_NGROUPS_MAX


	)

83 
	m_SC_OPEN_MAX
,

84 
	#_SC_OPEN_MAX
 
_SC_OPEN_MAX


	)

85 
	m_SC_STREAM_MAX
,

86 
	#_SC_STREAM_MAX
 
_SC_STREAM_MAX


	)

87 
	m_SC_TZNAME_MAX
,

88 
	#_SC_TZNAME_MAX
 
_SC_TZNAME_MAX


	)

89 
	m_SC_JOB_CONTROL
,

90 
	#_SC_JOB_CONTROL
 
_SC_JOB_CONTROL


	)

91 
	m_SC_SAVED_IDS
,

92 
	#_SC_SAVED_IDS
 
_SC_SAVED_IDS


	)

93 
	m_SC_REALTIME_SIGNALS
,

94 
	#_SC_REALTIME_SIGNALS
 
_SC_REALTIME_SIGNALS


	)

95 
	m_SC_PRIORITY_SCHEDULING
,

96 
	#_SC_PRIORITY_SCHEDULING
 
_SC_PRIORITY_SCHEDULING


	)

97 
	m_SC_TIMERS
,

98 
	#_SC_TIMERS
 
_SC_TIMERS


	)

99 
	m_SC_ASYNCHRONOUS_IO
,

100 
	#_SC_ASYNCHRONOUS_IO
 
_SC_ASYNCHRONOUS_IO


	)

101 
	m_SC_PRIORITIZED_IO
,

102 
	#_SC_PRIORITIZED_IO
 
_SC_PRIORITIZED_IO


	)

103 
	m_SC_SYNCHRONIZED_IO
,

104 
	#_SC_SYNCHRONIZED_IO
 
_SC_SYNCHRONIZED_IO


	)

105 
	m_SC_FSYNC
,

106 
	#_SC_FSYNC
 
_SC_FSYNC


	)

107 
	m_SC_MAPPED_FILES
,

108 
	#_SC_MAPPED_FILES
 
_SC_MAPPED_FILES


	)

109 
	m_SC_MEMLOCK
,

110 
	#_SC_MEMLOCK
 
_SC_MEMLOCK


	)

111 
	m_SC_MEMLOCK_RANGE
,

112 
	#_SC_MEMLOCK_RANGE
 
_SC_MEMLOCK_RANGE


	)

113 
	m_SC_MEMORY_PROTECTION
,

114 
	#_SC_MEMORY_PROTECTION
 
_SC_MEMORY_PROTECTION


	)

115 
	m_SC_MESSAGE_PASSING
,

116 
	#_SC_MESSAGE_PASSING
 
_SC_MESSAGE_PASSING


	)

117 
	m_SC_SEMAPHORES
,

118 
	#_SC_SEMAPHORES
 
_SC_SEMAPHORES


	)

119 
	m_SC_SHARED_MEMORY_OBJECTS
,

120 
	#_SC_SHARED_MEMORY_OBJECTS
 
_SC_SHARED_MEMORY_OBJECTS


	)

121 
	m_SC_AIO_LISTIO_MAX
,

122 
	#_SC_AIO_LISTIO_MAX
 
_SC_AIO_LISTIO_MAX


	)

123 
	m_SC_AIO_MAX
,

124 
	#_SC_AIO_MAX
 
_SC_AIO_MAX


	)

125 
	m_SC_AIO_PRIO_DELTA_MAX
,

126 
	#_SC_AIO_PRIO_DELTA_MAX
 
_SC_AIO_PRIO_DELTA_MAX


	)

127 
	m_SC_DELAYTIMER_MAX
,

128 
	#_SC_DELAYTIMER_MAX
 
_SC_DELAYTIMER_MAX


	)

129 
	m_SC_MQ_OPEN_MAX
,

130 
	#_SC_MQ_OPEN_MAX
 
_SC_MQ_OPEN_MAX


	)

131 
	m_SC_MQ_PRIO_MAX
,

132 
	#_SC_MQ_PRIO_MAX
 
_SC_MQ_PRIO_MAX


	)

133 
	m_SC_VERSION
,

134 
	#_SC_VERSION
 
_SC_VERSION


	)

135 
	m_SC_PAGESIZE
,

136 
	#_SC_PAGESIZE
 
_SC_PAGESIZE


	)

137 
	#_SC_PAGE_SIZE
 
_SC_PAGESIZE


	)

138 
	m_SC_RTSIG_MAX
,

139 
	#_SC_RTSIG_MAX
 
_SC_RTSIG_MAX


	)

140 
	m_SC_SEM_NSEMS_MAX
,

141 
	#_SC_SEM_NSEMS_MAX
 
_SC_SEM_NSEMS_MAX


	)

142 
	m_SC_SEM_VALUE_MAX
,

143 
	#_SC_SEM_VALUE_MAX
 
_SC_SEM_VALUE_MAX


	)

144 
	m_SC_SIGQUEUE_MAX
,

145 
	#_SC_SIGQUEUE_MAX
 
_SC_SIGQUEUE_MAX


	)

146 
	m_SC_TIMER_MAX
,

147 
	#_SC_TIMER_MAX
 
_SC_TIMER_MAX


	)

151 
	m_SC_BC_BASE_MAX
,

152 
	#_SC_BC_BASE_MAX
 
_SC_BC_BASE_MAX


	)

153 
	m_SC_BC_DIM_MAX
,

154 
	#_SC_BC_DIM_MAX
 
_SC_BC_DIM_MAX


	)

155 
	m_SC_BC_SCALE_MAX
,

156 
	#_SC_BC_SCALE_MAX
 
_SC_BC_SCALE_MAX


	)

157 
	m_SC_BC_STRING_MAX
,

158 
	#_SC_BC_STRING_MAX
 
_SC_BC_STRING_MAX


	)

159 
	m_SC_COLL_WEIGHTS_MAX
,

160 
	#_SC_COLL_WEIGHTS_MAX
 
_SC_COLL_WEIGHTS_MAX


	)

161 
	m_SC_EQUIV_CLASS_MAX
,

162 
	#_SC_EQUIV_CLASS_MAX
 
_SC_EQUIV_CLASS_MAX


	)

163 
	m_SC_EXPR_NEST_MAX
,

164 
	#_SC_EXPR_NEST_MAX
 
_SC_EXPR_NEST_MAX


	)

165 
	m_SC_LINE_MAX
,

166 
	#_SC_LINE_MAX
 
_SC_LINE_MAX


	)

167 
	m_SC_RE_DUP_MAX
,

168 
	#_SC_RE_DUP_MAX
 
_SC_RE_DUP_MAX


	)

169 
	m_SC_CHARCLASS_NAME_MAX
,

170 
	#_SC_CHARCLASS_NAME_MAX
 
_SC_CHARCLASS_NAME_MAX


	)

172 
	m_SC_2_VERSION
,

173 
	#_SC_2_VERSION
 
_SC_2_VERSION


	)

174 
	m_SC_2_C_BIND
,

175 
	#_SC_2_C_BIND
 
_SC_2_C_BIND


	)

176 
	m_SC_2_C_DEV
,

177 
	#_SC_2_C_DEV
 
_SC_2_C_DEV


	)

178 
	m_SC_2_FORT_DEV
,

179 
	#_SC_2_FORT_DEV
 
_SC_2_FORT_DEV


	)

180 
	m_SC_2_FORT_RUN
,

181 
	#_SC_2_FORT_RUN
 
_SC_2_FORT_RUN


	)

182 
	m_SC_2_SW_DEV
,

183 
	#_SC_2_SW_DEV
 
_SC_2_SW_DEV


	)

184 
	m_SC_2_LOCALEDEF
,

185 
	#_SC_2_LOCALEDEF
 
_SC_2_LOCALEDEF


	)

187 
	m_SC_PII
,

188 
	#_SC_PII
 
_SC_PII


	)

189 
	m_SC_PII_XTI
,

190 
	#_SC_PII_XTI
 
_SC_PII_XTI


	)

191 
	m_SC_PII_SOCKET
,

192 
	#_SC_PII_SOCKET
 
_SC_PII_SOCKET


	)

193 
	m_SC_PII_INTERNET
,

194 
	#_SC_PII_INTERNET
 
_SC_PII_INTERNET


	)

195 
	m_SC_PII_OSI
,

196 
	#_SC_PII_OSI
 
_SC_PII_OSI


	)

197 
	m_SC_POLL
,

198 
	#_SC_POLL
 
_SC_POLL


	)

199 
	m_SC_SELECT
,

200 
	#_SC_SELECT
 
_SC_SELECT


	)

201 
	m_SC_UIO_MAXIOV
,

202 
	#_SC_UIO_MAXIOV
 
_SC_UIO_MAXIOV


	)

203 
	m_SC_IOV_MAX
 = 
_SC_UIO_MAXIOV
,

204 
	#_SC_IOV_MAX
 
_SC_IOV_MAX


	)

205 
	m_SC_PII_INTERNET_STREAM
,

206 
	#_SC_PII_INTERNET_STREAM
 
_SC_PII_INTERNET_STREAM


	)

207 
	m_SC_PII_INTERNET_DGRAM
,

208 
	#_SC_PII_INTERNET_DGRAM
 
_SC_PII_INTERNET_DGRAM


	)

209 
	m_SC_PII_OSI_COTS
,

210 
	#_SC_PII_OSI_COTS
 
_SC_PII_OSI_COTS


	)

211 
	m_SC_PII_OSI_CLTS
,

212 
	#_SC_PII_OSI_CLTS
 
_SC_PII_OSI_CLTS


	)

213 
	m_SC_PII_OSI_M
,

214 
	#_SC_PII_OSI_M
 
_SC_PII_OSI_M


	)

215 
	m_SC_T_IOV_MAX
,

216 
	#_SC_T_IOV_MAX
 
_SC_T_IOV_MAX


	)

219 
	m_SC_THREADS
,

220 
	#_SC_THREADS
 
_SC_THREADS


	)

221 
	m_SC_THREAD_SAFE_FUNCTIONS
,

222 
	#_SC_THREAD_SAFE_FUNCTIONS
 
_SC_THREAD_SAFE_FUNCTIONS


	)

223 
	m_SC_GETGR_R_SIZE_MAX
,

224 
	#_SC_GETGR_R_SIZE_MAX
 
_SC_GETGR_R_SIZE_MAX


	)

225 
	m_SC_GETPW_R_SIZE_MAX
,

226 
	#_SC_GETPW_R_SIZE_MAX
 
_SC_GETPW_R_SIZE_MAX


	)

227 
	m_SC_LOGIN_NAME_MAX
,

228 
	#_SC_LOGIN_NAME_MAX
 
_SC_LOGIN_NAME_MAX


	)

229 
	m_SC_TTY_NAME_MAX
,

230 
	#_SC_TTY_NAME_MAX
 
_SC_TTY_NAME_MAX


	)

231 
	m_SC_THREAD_DESTRUCTOR_ITERATIONS
,

232 
	#_SC_THREAD_DESTRUCTOR_ITERATIONS
 
_SC_THREAD_DESTRUCTOR_ITERATIONS


	)

233 
	m_SC_THREAD_KEYS_MAX
,

234 
	#_SC_THREAD_KEYS_MAX
 
_SC_THREAD_KEYS_MAX


	)

235 
	m_SC_THREAD_STACK_MIN
,

236 
	#_SC_THREAD_STACK_MIN
 
_SC_THREAD_STACK_MIN


	)

237 
	m_SC_THREAD_THREADS_MAX
,

238 
	#_SC_THREAD_THREADS_MAX
 
_SC_THREAD_THREADS_MAX


	)

239 
	m_SC_THREAD_ATTR_STACKADDR
,

240 
	#_SC_THREAD_ATTR_STACKADDR
 
_SC_THREAD_ATTR_STACKADDR


	)

241 
	m_SC_THREAD_ATTR_STACKSIZE
,

242 
	#_SC_THREAD_ATTR_STACKSIZE
 
_SC_THREAD_ATTR_STACKSIZE


	)

243 
	m_SC_THREAD_PRIORITY_SCHEDULING
,

244 
	#_SC_THREAD_PRIORITY_SCHEDULING
 
_SC_THREAD_PRIORITY_SCHEDULING


	)

245 
	m_SC_THREAD_PRIO_INHERIT
,

246 
	#_SC_THREAD_PRIO_INHERIT
 
_SC_THREAD_PRIO_INHERIT


	)

247 
	m_SC_THREAD_PRIO_PROTECT
,

248 
	#_SC_THREAD_PRIO_PROTECT
 
_SC_THREAD_PRIO_PROTECT


	)

249 
	m_SC_THREAD_PROCESS_SHARED
,

250 
	#_SC_THREAD_PROCESS_SHARED
 
_SC_THREAD_PROCESS_SHARED


	)

252 
	m_SC_NPROCESSORS_CONF
,

253 
	#_SC_NPROCESSORS_CONF
 
_SC_NPROCESSORS_CONF


	)

254 
	m_SC_NPROCESSORS_ONLN
,

255 
	#_SC_NPROCESSORS_ONLN
 
_SC_NPROCESSORS_ONLN


	)

256 
	m_SC_PHYS_PAGES
,

257 
	#_SC_PHYS_PAGES
 
_SC_PHYS_PAGES


	)

258 
	m_SC_AVPHYS_PAGES
,

259 
	#_SC_AVPHYS_PAGES
 
_SC_AVPHYS_PAGES


	)

260 
	m_SC_ATEXIT_MAX
,

261 
	#_SC_ATEXIT_MAX
 
_SC_ATEXIT_MAX


	)

262 
	m_SC_PASS_MAX
,

263 
	#_SC_PASS_MAX
 
_SC_PASS_MAX


	)

265 
	m_SC_XOPEN_VERSION
,

266 
	#_SC_XOPEN_VERSION
 
_SC_XOPEN_VERSION


	)

267 
	m_SC_XOPEN_XCU_VERSION
,

268 
	#_SC_XOPEN_XCU_VERSION
 
_SC_XOPEN_XCU_VERSION


	)

269 
	m_SC_XOPEN_UNIX
,

270 
	#_SC_XOPEN_UNIX
 
_SC_XOPEN_UNIX


	)

271 
	m_SC_XOPEN_CRYPT
,

272 
	#_SC_XOPEN_CRYPT
 
_SC_XOPEN_CRYPT


	)

273 
	m_SC_XOPEN_ENH_I18N
,

274 
	#_SC_XOPEN_ENH_I18N
 
_SC_XOPEN_ENH_I18N


	)

275 
	m_SC_XOPEN_SHM
,

276 
	#_SC_XOPEN_SHM
 
_SC_XOPEN_SHM


	)

278 
	m_SC_2_CHAR_TERM
,

279 
	#_SC_2_CHAR_TERM
 
_SC_2_CHAR_TERM


	)

280 
	m_SC_2_C_VERSION
,

281 
	#_SC_2_C_VERSION
 
_SC_2_C_VERSION


	)

282 
	m_SC_2_UPE
,

283 
	#_SC_2_UPE
 
_SC_2_UPE


	)

285 
	m_SC_XOPEN_XPG2
,

286 
	#_SC_XOPEN_XPG2
 
_SC_XOPEN_XPG2


	)

287 
	m_SC_XOPEN_XPG3
,

288 
	#_SC_XOPEN_XPG3
 
_SC_XOPEN_XPG3


	)

289 
	m_SC_XOPEN_XPG4
,

290 
	#_SC_XOPEN_XPG4
 
_SC_XOPEN_XPG4


	)

292 
	m_SC_CHAR_BIT
,

293 
	#_SC_CHAR_BIT
 
_SC_CHAR_BIT


	)

294 
	m_SC_CHAR_MAX
,

295 
	#_SC_CHAR_MAX
 
_SC_CHAR_MAX


	)

296 
	m_SC_CHAR_MIN
,

297 
	#_SC_CHAR_MIN
 
_SC_CHAR_MIN


	)

298 
	m_SC_INT_MAX
,

299 
	#_SC_INT_MAX
 
_SC_INT_MAX


	)

300 
	m_SC_INT_MIN
,

301 
	#_SC_INT_MIN
 
_SC_INT_MIN


	)

302 
	m_SC_LONG_BIT
,

303 
	#_SC_LONG_BIT
 
_SC_LONG_BIT


	)

304 
	m_SC_WORD_BIT
,

305 
	#_SC_WORD_BIT
 
_SC_WORD_BIT


	)

306 
	m_SC_MB_LEN_MAX
,

307 
	#_SC_MB_LEN_MAX
 
_SC_MB_LEN_MAX


	)

308 
	m_SC_NZERO
,

309 
	#_SC_NZERO
 
_SC_NZERO


	)

310 
	m_SC_SSIZE_MAX
,

311 
	#_SC_SSIZE_MAX
 
_SC_SSIZE_MAX


	)

312 
	m_SC_SCHAR_MAX
,

313 
	#_SC_SCHAR_MAX
 
_SC_SCHAR_MAX


	)

314 
	m_SC_SCHAR_MIN
,

315 
	#_SC_SCHAR_MIN
 
_SC_SCHAR_MIN


	)

316 
	m_SC_SHRT_MAX
,

317 
	#_SC_SHRT_MAX
 
_SC_SHRT_MAX


	)

318 
	m_SC_SHRT_MIN
,

319 
	#_SC_SHRT_MIN
 
_SC_SHRT_MIN


	)

320 
	m_SC_UCHAR_MAX
,

321 
	#_SC_UCHAR_MAX
 
_SC_UCHAR_MAX


	)

322 
	m_SC_UINT_MAX
,

323 
	#_SC_UINT_MAX
 
_SC_UINT_MAX


	)

324 
	m_SC_ULONG_MAX
,

325 
	#_SC_ULONG_MAX
 
_SC_ULONG_MAX


	)

326 
	m_SC_USHRT_MAX
,

327 
	#_SC_USHRT_MAX
 
_SC_USHRT_MAX


	)

329 
	m_SC_NL_ARGMAX
,

330 
	#_SC_NL_ARGMAX
 
_SC_NL_ARGMAX


	)

331 
	m_SC_NL_LANGMAX
,

332 
	#_SC_NL_LANGMAX
 
_SC_NL_LANGMAX


	)

333 
	m_SC_NL_MSGMAX
,

334 
	#_SC_NL_MSGMAX
 
_SC_NL_MSGMAX


	)

335 
	m_SC_NL_NMAX
,

336 
	#_SC_NL_NMAX
 
_SC_NL_NMAX


	)

337 
	m_SC_NL_SETMAX
,

338 
	#_SC_NL_SETMAX
 
_SC_NL_SETMAX


	)

339 
	m_SC_NL_TEXTMAX
,

340 
	#_SC_NL_TEXTMAX
 
_SC_NL_TEXTMAX


	)

342 
	m_SC_XBS5_ILP32_OFF32
,

343 
	#_SC_XBS5_ILP32_OFF32
 
_SC_XBS5_ILP32_OFF32


	)

344 
	m_SC_XBS5_ILP32_OFFBIG
,

345 
	#_SC_XBS5_ILP32_OFFBIG
 
_SC_XBS5_ILP32_OFFBIG


	)

346 
	m_SC_XBS5_LP64_OFF64
,

347 
	#_SC_XBS5_LP64_OFF64
 
_SC_XBS5_LP64_OFF64


	)

348 
	m_SC_XBS5_LPBIG_OFFBIG
,

349 
	#_SC_XBS5_LPBIG_OFFBIG
 
_SC_XBS5_LPBIG_OFFBIG


	)

351 
	m_SC_XOPEN_LEGACY
,

352 
	#_SC_XOPEN_LEGACY
 
_SC_XOPEN_LEGACY


	)

353 
	m_SC_XOPEN_REALTIME
,

354 
	#_SC_XOPEN_REALTIME
 
_SC_XOPEN_REALTIME


	)

355 
	m_SC_XOPEN_REALTIME_THREADS
,

356 
	#_SC_XOPEN_REALTIME_THREADS
 
_SC_XOPEN_REALTIME_THREADS


	)

358 
	m_SC_ADVISORY_INFO
,

359 
	#_SC_ADVISORY_INFO
 
_SC_ADVISORY_INFO


	)

360 
	m_SC_BARRIERS
,

361 
	#_SC_BARRIERS
 
_SC_BARRIERS


	)

362 
	m_SC_BASE
,

363 
	#_SC_BASE
 
_SC_BASE


	)

364 
	m_SC_C_LANG_SUPPORT
,

365 
	#_SC_C_LANG_SUPPORT
 
_SC_C_LANG_SUPPORT


	)

366 
	m_SC_C_LANG_SUPPORT_R
,

367 
	#_SC_C_LANG_SUPPORT_R
 
_SC_C_LANG_SUPPORT_R


	)

368 
	m_SC_CLOCK_SELECTION
,

369 
	#_SC_CLOCK_SELECTION
 
_SC_CLOCK_SELECTION


	)

370 
	m_SC_CPUTIME
,

371 
	#_SC_CPUTIME
 
_SC_CPUTIME


	)

372 
	m_SC_THREAD_CPUTIME
,

373 
	#_SC_THREAD_CPUTIME
 
_SC_THREAD_CPUTIME


	)

374 
	m_SC_DEVICE_IO
,

375 
	#_SC_DEVICE_IO
 
_SC_DEVICE_IO


	)

376 
	m_SC_DEVICE_SPECIFIC
,

377 
	#_SC_DEVICE_SPECIFIC
 
_SC_DEVICE_SPECIFIC


	)

378 
	m_SC_DEVICE_SPECIFIC_R
,

379 
	#_SC_DEVICE_SPECIFIC_R
 
_SC_DEVICE_SPECIFIC_R


	)

380 
	m_SC_FD_MGMT
,

381 
	#_SC_FD_MGMT
 
_SC_FD_MGMT


	)

382 
	m_SC_FIFO
,

383 
	#_SC_FIFO
 
_SC_FIFO


	)

384 
	m_SC_PIPE
,

385 
	#_SC_PIPE
 
_SC_PIPE


	)

386 
	m_SC_FILE_ATTRIBUTES
,

387 
	#_SC_FILE_ATTRIBUTES
 
_SC_FILE_ATTRIBUTES


	)

388 
	m_SC_FILE_LOCKING
,

389 
	#_SC_FILE_LOCKING
 
_SC_FILE_LOCKING


	)

390 
	m_SC_FILE_SYSTEM
,

391 
	#_SC_FILE_SYSTEM
 
_SC_FILE_SYSTEM


	)

392 
	m_SC_MONOTONIC_CLOCK
,

393 
	#_SC_MONOTONIC_CLOCK
 
_SC_MONOTONIC_CLOCK


	)

394 
	m_SC_MULTI_PROCESS
,

395 
	#_SC_MULTI_PROCESS
 
_SC_MULTI_PROCESS


	)

396 
	m_SC_SINGLE_PROCESS
,

397 
	#_SC_SINGLE_PROCESS
 
_SC_SINGLE_PROCESS


	)

398 
	m_SC_NETWORKING
,

399 
	#_SC_NETWORKING
 
_SC_NETWORKING


	)

400 
	m_SC_READER_WRITER_LOCKS
,

401 
	#_SC_READER_WRITER_LOCKS
 
_SC_READER_WRITER_LOCKS


	)

402 
	m_SC_SPIN_LOCKS
,

403 
	#_SC_SPIN_LOCKS
 
_SC_SPIN_LOCKS


	)

404 
	m_SC_REGEXP
,

405 
	#_SC_REGEXP
 
_SC_REGEXP


	)

406 
	m_SC_REGEX_VERSION
,

407 
	#_SC_REGEX_VERSION
 
_SC_REGEX_VERSION


	)

408 
	m_SC_SHELL
,

409 
	#_SC_SHELL
 
_SC_SHELL


	)

410 
	m_SC_SIGNALS
,

411 
	#_SC_SIGNALS
 
_SC_SIGNALS


	)

412 
	m_SC_SPAWN
,

413 
	#_SC_SPAWN
 
_SC_SPAWN


	)

414 
	m_SC_SPORADIC_SERVER
,

415 
	#_SC_SPORADIC_SERVER
 
_SC_SPORADIC_SERVER


	)

416 
	m_SC_THREAD_SPORADIC_SERVER
,

417 
	#_SC_THREAD_SPORADIC_SERVER
 
_SC_THREAD_SPORADIC_SERVER


	)

418 
	m_SC_SYSTEM_DATABASE
,

419 
	#_SC_SYSTEM_DATABASE
 
_SC_SYSTEM_DATABASE


	)

420 
	m_SC_SYSTEM_DATABASE_R
,

421 
	#_SC_SYSTEM_DATABASE_R
 
_SC_SYSTEM_DATABASE_R


	)

422 
	m_SC_TIMEOUTS
,

423 
	#_SC_TIMEOUTS
 
_SC_TIMEOUTS


	)

424 
	m_SC_TYPED_MEMORY_OBJECTS
,

425 
	#_SC_TYPED_MEMORY_OBJECTS
 
_SC_TYPED_MEMORY_OBJECTS


	)

426 
	m_SC_USER_GROUPS
,

427 
	#_SC_USER_GROUPS
 
_SC_USER_GROUPS


	)

428 
	m_SC_USER_GROUPS_R
,

429 
	#_SC_USER_GROUPS_R
 
_SC_USER_GROUPS_R


	)

430 
	m_SC_2_PBS
,

431 
	#_SC_2_PBS
 
_SC_2_PBS


	)

432 
	m_SC_2_PBS_ACCOUNTING
,

433 
	#_SC_2_PBS_ACCOUNTING
 
_SC_2_PBS_ACCOUNTING


	)

434 
	m_SC_2_PBS_LOCATE
,

435 
	#_SC_2_PBS_LOCATE
 
_SC_2_PBS_LOCATE


	)

436 
	m_SC_2_PBS_MESSAGE
,

437 
	#_SC_2_PBS_MESSAGE
 
_SC_2_PBS_MESSAGE


	)

438 
	m_SC_2_PBS_TRACK
,

439 
	#_SC_2_PBS_TRACK
 
_SC_2_PBS_TRACK


	)

440 
	m_SC_SYMLOOP_MAX
,

441 
	#_SC_SYMLOOP_MAX
 
_SC_SYMLOOP_MAX


	)

442 
	m_SC_STREAMS
,

443 
	#_SC_STREAMS
 
_SC_STREAMS


	)

444 
	m_SC_2_PBS_CHECKPOINT
,

445 
	#_SC_2_PBS_CHECKPOINT
 
_SC_2_PBS_CHECKPOINT


	)

447 
	m_SC_V6_ILP32_OFF32
,

448 
	#_SC_V6_ILP32_OFF32
 
_SC_V6_ILP32_OFF32


	)

449 
	m_SC_V6_ILP32_OFFBIG
,

450 
	#_SC_V6_ILP32_OFFBIG
 
_SC_V6_ILP32_OFFBIG


	)

451 
	m_SC_V6_LP64_OFF64
,

452 
	#_SC_V6_LP64_OFF64
 
_SC_V6_LP64_OFF64


	)

453 
	m_SC_V6_LPBIG_OFFBIG
,

454 
	#_SC_V6_LPBIG_OFFBIG
 
_SC_V6_LPBIG_OFFBIG


	)

456 
	m_SC_HOST_NAME_MAX
,

457 
	#_SC_HOST_NAME_MAX
 
_SC_HOST_NAME_MAX


	)

458 
	m_SC_TRACE
,

459 
	#_SC_TRACE
 
_SC_TRACE


	)

460 
	m_SC_TRACE_EVENT_FILTER
,

461 
	#_SC_TRACE_EVENT_FILTER
 
_SC_TRACE_EVENT_FILTER


	)

462 
	m_SC_TRACE_INHERIT
,

463 
	#_SC_TRACE_INHERIT
 
_SC_TRACE_INHERIT


	)

464 
	m_SC_TRACE_LOG
,

465 
	#_SC_TRACE_LOG
 
_SC_TRACE_LOG


	)

467 
	m_SC_LEVEL1_ICACHE_SIZE
,

468 
	#_SC_LEVEL1_ICACHE_SIZE
 
_SC_LEVEL1_ICACHE_SIZE


	)

469 
	m_SC_LEVEL1_ICACHE_ASSOC
,

470 
	#_SC_LEVEL1_ICACHE_ASSOC
 
_SC_LEVEL1_ICACHE_ASSOC


	)

471 
	m_SC_LEVEL1_ICACHE_LINESIZE
,

472 
	#_SC_LEVEL1_ICACHE_LINESIZE
 
_SC_LEVEL1_ICACHE_LINESIZE


	)

473 
	m_SC_LEVEL1_DCACHE_SIZE
,

474 
	#_SC_LEVEL1_DCACHE_SIZE
 
_SC_LEVEL1_DCACHE_SIZE


	)

475 
	m_SC_LEVEL1_DCACHE_ASSOC
,

476 
	#_SC_LEVEL1_DCACHE_ASSOC
 
_SC_LEVEL1_DCACHE_ASSOC


	)

477 
	m_SC_LEVEL1_DCACHE_LINESIZE
,

478 
	#_SC_LEVEL1_DCACHE_LINESIZE
 
_SC_LEVEL1_DCACHE_LINESIZE


	)

479 
	m_SC_LEVEL2_CACHE_SIZE
,

480 
	#_SC_LEVEL2_CACHE_SIZE
 
_SC_LEVEL2_CACHE_SIZE


	)

481 
	m_SC_LEVEL2_CACHE_ASSOC
,

482 
	#_SC_LEVEL2_CACHE_ASSOC
 
_SC_LEVEL2_CACHE_ASSOC


	)

483 
	m_SC_LEVEL2_CACHE_LINESIZE
,

484 
	#_SC_LEVEL2_CACHE_LINESIZE
 
_SC_LEVEL2_CACHE_LINESIZE


	)

485 
	m_SC_LEVEL3_CACHE_SIZE
,

486 
	#_SC_LEVEL3_CACHE_SIZE
 
_SC_LEVEL3_CACHE_SIZE


	)

487 
	m_SC_LEVEL3_CACHE_ASSOC
,

488 
	#_SC_LEVEL3_CACHE_ASSOC
 
_SC_LEVEL3_CACHE_ASSOC


	)

489 
	m_SC_LEVEL3_CACHE_LINESIZE
,

490 
	#_SC_LEVEL3_CACHE_LINESIZE
 
_SC_LEVEL3_CACHE_LINESIZE


	)

491 
	m_SC_LEVEL4_CACHE_SIZE
,

492 
	#_SC_LEVEL4_CACHE_SIZE
 
_SC_LEVEL4_CACHE_SIZE


	)

493 
	m_SC_LEVEL4_CACHE_ASSOC
,

494 
	#_SC_LEVEL4_CACHE_ASSOC
 
_SC_LEVEL4_CACHE_ASSOC


	)

495 
	m_SC_LEVEL4_CACHE_LINESIZE
,

496 
	#_SC_LEVEL4_CACHE_LINESIZE
 
_SC_LEVEL4_CACHE_LINESIZE


	)

499 
	m_SC_IPV6
 = 
_SC_LEVEL1_ICACHE_SIZE
 + 50,

500 
	#_SC_IPV6
 
_SC_IPV6


	)

501 
	m_SC_RAW_SOCKETS
,

502 
	#_SC_RAW_SOCKETS
 
_SC_RAW_SOCKETS


	)

504 
	m_SC_V7_ILP32_OFF32
,

505 
	#_SC_V7_ILP32_OFF32
 
_SC_V7_ILP32_OFF32


	)

506 
	m_SC_V7_ILP32_OFFBIG
,

507 
	#_SC_V7_ILP32_OFFBIG
 
_SC_V7_ILP32_OFFBIG


	)

508 
	m_SC_V7_LP64_OFF64
,

509 
	#_SC_V7_LP64_OFF64
 
_SC_V7_LP64_OFF64


	)

510 
	m_SC_V7_LPBIG_OFFBIG
,

511 
	#_SC_V7_LPBIG_OFFBIG
 
_SC_V7_LPBIG_OFFBIG


	)

513 
	m_SC_SS_REPL_MAX
,

514 
	#_SC_SS_REPL_MAX
 
_SC_SS_REPL_MAX


	)

516 
	m_SC_TRACE_EVENT_NAME_MAX
,

517 
	#_SC_TRACE_EVENT_NAME_MAX
 
_SC_TRACE_EVENT_NAME_MAX


	)

518 
	m_SC_TRACE_NAME_MAX
,

519 
	#_SC_TRACE_NAME_MAX
 
_SC_TRACE_NAME_MAX


	)

520 
	m_SC_TRACE_SYS_MAX
,

521 
	#_SC_TRACE_SYS_MAX
 
_SC_TRACE_SYS_MAX


	)

522 
	m_SC_TRACE_USER_EVENT_MAX
,

523 
	#_SC_TRACE_USER_EVENT_MAX
 
_SC_TRACE_USER_EVENT_MAX


	)

525 
	m_SC_XOPEN_STREAMS
,

526 
	#_SC_XOPEN_STREAMS
 
_SC_XOPEN_STREAMS


	)

528 
	m_SC_THREAD_ROBUST_PRIO_INHERIT
,

529 
	#_SC_THREAD_ROBUST_PRIO_INHERIT
 
_SC_THREAD_ROBUST_PRIO_INHERIT


	)

530 
	m_SC_THREAD_ROBUST_PRIO_PROTECT


531 
	#_SC_THREAD_ROBUST_PRIO_PROTECT
 
_SC_THREAD_ROBUST_PRIO_PROTECT


	)

537 
	m_CS_PATH
,

538 
	#_CS_PATH
 
_CS_PATH


	)

540 
	m_CS_V6_WIDTH_RESTRICTED_ENVS
,

541 
	#_CS_V6_WIDTH_RESTRICTED_ENVS
 
_CS_V6_WIDTH_RESTRICTED_ENVS


	)

542 
	#_CS_POSIX_V6_WIDTH_RESTRICTED_ENVS
 
_CS_V6_WIDTH_RESTRICTED_ENVS


	)

544 
	m_CS_GNU_LIBC_VERSION
,

545 
	#_CS_GNU_LIBC_VERSION
 
_CS_GNU_LIBC_VERSION


	)

546 
	m_CS_GNU_LIBPTHREAD_VERSION
,

547 
	#_CS_GNU_LIBPTHREAD_VERSION
 
_CS_GNU_LIBPTHREAD_VERSION


	)

549 
	m_CS_V5_WIDTH_RESTRICTED_ENVS
,

550 
	#_CS_V5_WIDTH_RESTRICTED_ENVS
 
_CS_V5_WIDTH_RESTRICTED_ENVS


	)

551 
	#_CS_POSIX_V5_WIDTH_RESTRICTED_ENVS
 
_CS_V5_WIDTH_RESTRICTED_ENVS


	)

553 
	m_CS_V7_WIDTH_RESTRICTED_ENVS
,

554 
	#_CS_V7_WIDTH_RESTRICTED_ENVS
 
_CS_V7_WIDTH_RESTRICTED_ENVS


	)

555 
	#_CS_POSIX_V7_WIDTH_RESTRICTED_ENVS
 
_CS_V7_WIDTH_RESTRICTED_ENVS


	)

557 
	m_CS_LFS_CFLAGS
 = 1000,

558 
	#_CS_LFS_CFLAGS
 
_CS_LFS_CFLAGS


	)

559 
	m_CS_LFS_LDFLAGS
,

560 
	#_CS_LFS_LDFLAGS
 
_CS_LFS_LDFLAGS


	)

561 
	m_CS_LFS_LIBS
,

562 
	#_CS_LFS_LIBS
 
_CS_LFS_LIBS


	)

563 
	m_CS_LFS_LINTFLAGS
,

564 
	#_CS_LFS_LINTFLAGS
 
_CS_LFS_LINTFLAGS


	)

565 
	m_CS_LFS64_CFLAGS
,

566 
	#_CS_LFS64_CFLAGS
 
_CS_LFS64_CFLAGS


	)

567 
	m_CS_LFS64_LDFLAGS
,

568 
	#_CS_LFS64_LDFLAGS
 
_CS_LFS64_LDFLAGS


	)

569 
	m_CS_LFS64_LIBS
,

570 
	#_CS_LFS64_LIBS
 
_CS_LFS64_LIBS


	)

571 
	m_CS_LFS64_LINTFLAGS
,

572 
	#_CS_LFS64_LINTFLAGS
 
_CS_LFS64_LINTFLAGS


	)

574 
	m_CS_XBS5_ILP32_OFF32_CFLAGS
 = 1100,

575 
	#_CS_XBS5_ILP32_OFF32_CFLAGS
 
_CS_XBS5_ILP32_OFF32_CFLAGS


	)

576 
	m_CS_XBS5_ILP32_OFF32_LDFLAGS
,

577 
	#_CS_XBS5_ILP32_OFF32_LDFLAGS
 
_CS_XBS5_ILP32_OFF32_LDFLAGS


	)

578 
	m_CS_XBS5_ILP32_OFF32_LIBS
,

579 
	#_CS_XBS5_ILP32_OFF32_LIBS
 
_CS_XBS5_ILP32_OFF32_LIBS


	)

580 
	m_CS_XBS5_ILP32_OFF32_LINTFLAGS
,

581 
	#_CS_XBS5_ILP32_OFF32_LINTFLAGS
 
_CS_XBS5_ILP32_OFF32_LINTFLAGS


	)

582 
	m_CS_XBS5_ILP32_OFFBIG_CFLAGS
,

583 
	#_CS_XBS5_ILP32_OFFBIG_CFLAGS
 
_CS_XBS5_ILP32_OFFBIG_CFLAGS


	)

584 
	m_CS_XBS5_ILP32_OFFBIG_LDFLAGS
,

585 
	#_CS_XBS5_ILP32_OFFBIG_LDFLAGS
 
_CS_XBS5_ILP32_OFFBIG_LDFLAGS


	)

586 
	m_CS_XBS5_ILP32_OFFBIG_LIBS
,

587 
	#_CS_XBS5_ILP32_OFFBIG_LIBS
 
_CS_XBS5_ILP32_OFFBIG_LIBS


	)

588 
	m_CS_XBS5_ILP32_OFFBIG_LINTFLAGS
,

589 
	#_CS_XBS5_ILP32_OFFBIG_LINTFLAGS
 
_CS_XBS5_ILP32_OFFBIG_LINTFLAGS


	)

590 
	m_CS_XBS5_LP64_OFF64_CFLAGS
,

591 
	#_CS_XBS5_LP64_OFF64_CFLAGS
 
_CS_XBS5_LP64_OFF64_CFLAGS


	)

592 
	m_CS_XBS5_LP64_OFF64_LDFLAGS
,

593 
	#_CS_XBS5_LP64_OFF64_LDFLAGS
 
_CS_XBS5_LP64_OFF64_LDFLAGS


	)

594 
	m_CS_XBS5_LP64_OFF64_LIBS
,

595 
	#_CS_XBS5_LP64_OFF64_LIBS
 
_CS_XBS5_LP64_OFF64_LIBS


	)

596 
	m_CS_XBS5_LP64_OFF64_LINTFLAGS
,

597 
	#_CS_XBS5_LP64_OFF64_LINTFLAGS
 
_CS_XBS5_LP64_OFF64_LINTFLAGS


	)

598 
	m_CS_XBS5_LPBIG_OFFBIG_CFLAGS
,

599 
	#_CS_XBS5_LPBIG_OFFBIG_CFLAGS
 
_CS_XBS5_LPBIG_OFFBIG_CFLAGS


	)

600 
	m_CS_XBS5_LPBIG_OFFBIG_LDFLAGS
,

601 
	#_CS_XBS5_LPBIG_OFFBIG_LDFLAGS
 
_CS_XBS5_LPBIG_OFFBIG_LDFLAGS


	)

602 
	m_CS_XBS5_LPBIG_OFFBIG_LIBS
,

603 
	#_CS_XBS5_LPBIG_OFFBIG_LIBS
 
_CS_XBS5_LPBIG_OFFBIG_LIBS


	)

604 
	m_CS_XBS5_LPBIG_OFFBIG_LINTFLAGS
,

605 
	#_CS_XBS5_LPBIG_OFFBIG_LINTFLAGS
 
_CS_XBS5_LPBIG_OFFBIG_LINTFLAGS


	)

607 
	m_CS_POSIX_V6_ILP32_OFF32_CFLAGS
,

608 
	#_CS_POSIX_V6_ILP32_OFF32_CFLAGS
 
_CS_POSIX_V6_ILP32_OFF32_CFLAGS


	)

609 
	m_CS_POSIX_V6_ILP32_OFF32_LDFLAGS
,

610 
	#_CS_POSIX_V6_ILP32_OFF32_LDFLAGS
 
_CS_POSIX_V6_ILP32_OFF32_LDFLAGS


	)

611 
	m_CS_POSIX_V6_ILP32_OFF32_LIBS
,

612 
	#_CS_POSIX_V6_ILP32_OFF32_LIBS
 
_CS_POSIX_V6_ILP32_OFF32_LIBS


	)

613 
	m_CS_POSIX_V6_ILP32_OFF32_LINTFLAGS
,

614 
	#_CS_POSIX_V6_ILP32_OFF32_LINTFLAGS
 
_CS_POSIX_V6_ILP32_OFF32_LINTFLAGS


	)

615 
	m_CS_POSIX_V6_ILP32_OFFBIG_CFLAGS
,

616 
	#_CS_POSIX_V6_ILP32_OFFBIG_CFLAGS
 
_CS_POSIX_V6_ILP32_OFFBIG_CFLAGS


	)

617 
	m_CS_POSIX_V6_ILP32_OFFBIG_LDFLAGS
,

618 
	#_CS_POSIX_V6_ILP32_OFFBIG_LDFLAGS
 
_CS_POSIX_V6_ILP32_OFFBIG_LDFLAGS


	)

619 
	m_CS_POSIX_V6_ILP32_OFFBIG_LIBS
,

620 
	#_CS_POSIX_V6_ILP32_OFFBIG_LIBS
 
_CS_POSIX_V6_ILP32_OFFBIG_LIBS


	)

621 
	m_CS_POSIX_V6_ILP32_OFFBIG_LINTFLAGS
,

622 
	#_CS_POSIX_V6_ILP32_OFFBIG_LINTFLAGS
 
_CS_POSIX_V6_ILP32_OFFBIG_LINTFLAGS


	)

623 
	m_CS_POSIX_V6_LP64_OFF64_CFLAGS
,

624 
	#_CS_POSIX_V6_LP64_OFF64_CFLAGS
 
_CS_POSIX_V6_LP64_OFF64_CFLAGS


	)

625 
	m_CS_POSIX_V6_LP64_OFF64_LDFLAGS
,

626 
	#_CS_POSIX_V6_LP64_OFF64_LDFLAGS
 
_CS_POSIX_V6_LP64_OFF64_LDFLAGS


	)

627 
	m_CS_POSIX_V6_LP64_OFF64_LIBS
,

628 
	#_CS_POSIX_V6_LP64_OFF64_LIBS
 
_CS_POSIX_V6_LP64_OFF64_LIBS


	)

629 
	m_CS_POSIX_V6_LP64_OFF64_LINTFLAGS
,

630 
	#_CS_POSIX_V6_LP64_OFF64_LINTFLAGS
 
_CS_POSIX_V6_LP64_OFF64_LINTFLAGS


	)

631 
	m_CS_POSIX_V6_LPBIG_OFFBIG_CFLAGS
,

632 
	#_CS_POSIX_V6_LPBIG_OFFBIG_CFLAGS
 
_CS_POSIX_V6_LPBIG_OFFBIG_CFLAGS


	)

633 
	m_CS_POSIX_V6_LPBIG_OFFBIG_LDFLAGS
,

634 
	#_CS_POSIX_V6_LPBIG_OFFBIG_LDFLAGS
 
_CS_POSIX_V6_LPBIG_OFFBIG_LDFLAGS


	)

635 
	m_CS_POSIX_V6_LPBIG_OFFBIG_LIBS
,

636 
	#_CS_POSIX_V6_LPBIG_OFFBIG_LIBS
 
_CS_POSIX_V6_LPBIG_OFFBIG_LIBS


	)

637 
	m_CS_POSIX_V6_LPBIG_OFFBIG_LINTFLAGS
,

638 
	#_CS_POSIX_V6_LPBIG_OFFBIG_LINTFLAGS
 
_CS_POSIX_V6_LPBIG_OFFBIG_LINTFLAGS


	)

640 
	m_CS_POSIX_V7_ILP32_OFF32_CFLAGS
,

641 
	#_CS_POSIX_V7_ILP32_OFF32_CFLAGS
 
_CS_POSIX_V7_ILP32_OFF32_CFLAGS


	)

642 
	m_CS_POSIX_V7_ILP32_OFF32_LDFLAGS
,

643 
	#_CS_POSIX_V7_ILP32_OFF32_LDFLAGS
 
_CS_POSIX_V7_ILP32_OFF32_LDFLAGS


	)

644 
	m_CS_POSIX_V7_ILP32_OFF32_LIBS
,

645 
	#_CS_POSIX_V7_ILP32_OFF32_LIBS
 
_CS_POSIX_V7_ILP32_OFF32_LIBS


	)

646 
	m_CS_POSIX_V7_ILP32_OFF32_LINTFLAGS
,

647 
	#_CS_POSIX_V7_ILP32_OFF32_LINTFLAGS
 
_CS_POSIX_V7_ILP32_OFF32_LINTFLAGS


	)

648 
	m_CS_POSIX_V7_ILP32_OFFBIG_CFLAGS
,

649 
	#_CS_POSIX_V7_ILP32_OFFBIG_CFLAGS
 
_CS_POSIX_V7_ILP32_OFFBIG_CFLAGS


	)

650 
	m_CS_POSIX_V7_ILP32_OFFBIG_LDFLAGS
,

651 
	#_CS_POSIX_V7_ILP32_OFFBIG_LDFLAGS
 
_CS_POSIX_V7_ILP32_OFFBIG_LDFLAGS


	)

652 
	m_CS_POSIX_V7_ILP32_OFFBIG_LIBS
,

653 
	#_CS_POSIX_V7_ILP32_OFFBIG_LIBS
 
_CS_POSIX_V7_ILP32_OFFBIG_LIBS


	)

654 
	m_CS_POSIX_V7_ILP32_OFFBIG_LINTFLAGS
,

655 
	#_CS_POSIX_V7_ILP32_OFFBIG_LINTFLAGS
 
_CS_POSIX_V7_ILP32_OFFBIG_LINTFLAGS


	)

656 
	m_CS_POSIX_V7_LP64_OFF64_CFLAGS
,

657 
	#_CS_POSIX_V7_LP64_OFF64_CFLAGS
 
_CS_POSIX_V7_LP64_OFF64_CFLAGS


	)

658 
	m_CS_POSIX_V7_LP64_OFF64_LDFLAGS
,

659 
	#_CS_POSIX_V7_LP64_OFF64_LDFLAGS
 
_CS_POSIX_V7_LP64_OFF64_LDFLAGS


	)

660 
	m_CS_POSIX_V7_LP64_OFF64_LIBS
,

661 
	#_CS_POSIX_V7_LP64_OFF64_LIBS
 
_CS_POSIX_V7_LP64_OFF64_LIBS


	)

662 
	m_CS_POSIX_V7_LP64_OFF64_LINTFLAGS
,

663 
	#_CS_POSIX_V7_LP64_OFF64_LINTFLAGS
 
_CS_POSIX_V7_LP64_OFF64_LINTFLAGS


	)

664 
	m_CS_POSIX_V7_LPBIG_OFFBIG_CFLAGS
,

665 
	#_CS_POSIX_V7_LPBIG_OFFBIG_CFLAGS
 
_CS_POSIX_V7_LPBIG_OFFBIG_CFLAGS


	)

666 
	m_CS_POSIX_V7_LPBIG_OFFBIG_LDFLAGS
,

667 
	#_CS_POSIX_V7_LPBIG_OFFBIG_LDFLAGS
 
_CS_POSIX_V7_LPBIG_OFFBIG_LDFLAGS


	)

668 
	m_CS_POSIX_V7_LPBIG_OFFBIG_LIBS
,

669 
	#_CS_POSIX_V7_LPBIG_OFFBIG_LIBS
 
_CS_POSIX_V7_LPBIG_OFFBIG_LIBS


	)

670 
	m_CS_POSIX_V7_LPBIG_OFFBIG_LINTFLAGS
,

671 
	#_CS_POSIX_V7_LPBIG_OFFBIG_LINTFLAGS
 
_CS_POSIX_V7_LPBIG_OFFBIG_LINTFLAGS


	)

673 
	m_CS_V6_ENV
,

674 
	#_CS_V6_ENV
 
_CS_V6_ENV


	)

675 
	m_CS_V7_ENV


676 
	#_CS_V7_ENV
 
_CS_V7_ENV


	)

	@/usr/include/bits/environments.h

19 #iâdeà
_UNISTD_H


23 
	~<b™s/wÜdsize.h
>

43 #ià
__WORDSIZE
 == 64

57 
	#_POSIX_V7_LPBIG_OFFBIG
 -1

	)

58 
	#_POSIX_V6_LPBIG_OFFBIG
 -1

	)

59 
	#_XBS5_LPBIG_OFFBIG
 -1

	)

62 
	#_POSIX_V7_LP64_OFF64
 1

	)

63 
	#_POSIX_V6_LP64_OFF64
 1

	)

64 
	#_XBS5_LP64_OFF64
 1

	)

70 
	#_POSIX_V7_ILP32_OFF32
 1

	)

71 
	#_POSIX_V7_ILP32_OFFBIG
 1

	)

72 
	#_POSIX_V6_ILP32_OFF32
 1

	)

73 
	#_POSIX_V6_ILP32_OFFBIG
 1

	)

74 
	#_XBS5_ILP32_OFF32
 1

	)

75 
	#_XBS5_ILP32_OFFBIG
 1

	)

92 
	#__ILP32_OFF32_CFLAGS
 "-m32"

	)

93 
	#__ILP32_OFFBIG_CFLAGS
 "-m32 -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64"

	)

94 
	#__ILP32_OFF32_LDFLAGS
 "-m32"

	)

95 
	#__ILP32_OFFBIG_LDFLAGS
 "-m32"

	)

96 
	#__LP64_OFF64_CFLAGS
 "-m64"

	)

97 
	#__LP64_OFF64_LDFLAGS
 "-m64"

	)

	@/usr/include/bits/errno.h

20 #ifdeà
_ERRNO_H


22 #undeà
EDOM


23 #undeà
EILSEQ


24 #undeà
ERANGE


25 
	~<lšux/”ºo.h
>

28 
	#ENOTSUP
 
EOPNOTSUPP


	)

31 #iâdeà
ECANCELED


32 
	#ECANCELED
 125

	)

36 #iâdeà
EOWNERDEAD


37 
	#EOWNERDEAD
 130

	)

38 
	#ENOTRECOVERABLE
 131

	)

41 #iâdeà
ERFKILL


42 
	#ERFKILL
 132

	)

45 #iâdeà
__ASSEMBLER__


47 *
	$__”ºo_loÿtiÚ
 (è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

49 #ià!
defšed
 
_LIBC
 || defšed 
_LIBC_REENTRANT


51 
	#”ºo
 (*
	`__”ºo_loÿtiÚ
 ())

	)

56 #ià!
defšed
 
_ERRNO_H
 && defšed 
__Ãed_Em©h


60 
	#EDOM
 33

	)

61 
	#EILSEQ
 84

	)

62 
	#ERANGE
 34

	)

	@/usr/include/bits/fcntl.h

21 #iâdef 
_FCNTL_H


25 
	~<sys/ty³s.h
>

26 
	~<b™s/wÜdsize.h
>

27 #ifdeà
__USE_GNU


28 
	~<b™s/uio.h
>

34 
	#O_ACCMODE
 0003

	)

35 
	#O_RDONLY
 00

	)

36 
	#O_WRONLY
 01

	)

37 
	#O_RDWR
 02

	)

38 
	#O_CREAT
 0100

	)

39 
	#O_EXCL
 0200

	)

40 
	#O_NOCTTY
 0400

	)

41 
	#O_TRUNC
 01000

	)

42 
	#O_APPEND
 02000

	)

43 
	#O_NONBLOCK
 04000

	)

44 
	#O_NDELAY
 
O_NONBLOCK


	)

45 
	#O_SYNC
 04010000

	)

46 
	#O_FSYNC
 
O_SYNC


	)

47 
	#O_ASYNC
 020000

	)

49 #ifdeà
__USE_XOPEN2K8


50 
	#O_DIRECTORY
 0200000

	)

51 
	#O_NOFOLLOW
 0400000

	)

52 
	#O_CLOEXEC
 02000000

	)

54 #ifdeà
__USE_GNU


55 
	#O_DIRECT
 040000

	)

56 
	#O_NOATIME
 01000000

	)

62 #ià
defšed
 
__USE_POSIX199309
 || defšed 
__USE_UNIX98


63 
	#O_DSYNC
 010000

	)

64 
	#O_RSYNC
 
O_SYNC


	)

67 #ifdeà
__USE_LARGEFILE64


68 #ià
__WORDSIZE
 == 64

69 
	#O_LARGEFILE
 0

	)

71 
	#O_LARGEFILE
 0100000

	)

76 
	#F_DUPFD
 0

	)

77 
	#F_GETFD
 1

	)

78 
	#F_SETFD
 2

	)

79 
	#F_GETFL
 3

	)

80 
	#F_SETFL
 4

	)

81 #ià
__WORDSIZE
 == 64

82 
	#F_GETLK
 5

	)

83 
	#F_SETLK
 6

	)

84 
	#F_SETLKW
 7

	)

86 
	#F_GETLK64
 5

	)

87 
	#F_SETLK64
 6

	)

88 
	#F_SETLKW64
 7

	)

90 #iâdeà
__USE_FILE_OFFSET64


91 
	#F_GETLK
 5

	)

92 
	#F_SETLK
 6

	)

93 
	#F_SETLKW
 7

	)

95 
	#F_GETLK
 
F_GETLK64


	)

96 
	#F_SETLK
 
F_SETLK64


	)

97 
	#F_SETLKW
 
F_SETLKW64


	)

99 
	#F_GETLK64
 12

	)

100 
	#F_SETLK64
 13

	)

101 
	#F_SETLKW64
 14

	)

104 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K8


105 
	#F_SETOWN
 8

	)

106 
	#F_GETOWN
 9

	)

109 #ifdeà
__USE_GNU


110 
	#F_SETSIG
 10

	)

111 
	#F_GETSIG
 11

	)

112 
	#F_SETOWN_EX
 15

	)

113 
	#F_GETOWN_EX
 16

	)

116 #ifdeà
__USE_GNU


117 
	#F_SETLEASE
 1024

	)

118 
	#F_GETLEASE
 1025

	)

119 
	#F_NOTIFY
 1026

	)

121 #ifdeà
__USE_XOPEN2K8


122 
	#F_DUPFD_CLOEXEC
 1030

	)

127 
	#FD_CLOEXEC
 1

	)

130 
	#F_RDLCK
 0

	)

131 
	#F_WRLCK
 1

	)

132 
	#F_UNLCK
 2

	)

135 
	#F_EXLCK
 4

	)

136 
	#F_SHLCK
 8

	)

138 #ifdeà
__USE_BSD


140 
	#LOCK_SH
 1

	)

141 
	#LOCK_EX
 2

	)

142 
	#LOCK_NB
 4

	)

144 
	#LOCK_UN
 8

	)

147 #ifdeà
__USE_GNU


148 
	#LOCK_MAND
 32

	)

149 
	#LOCK_READ
 64

	)

150 
	#LOCK_WRITE
 128

	)

151 
	#LOCK_RW
 192

	)

154 #ifdeà
__USE_GNU


156 
	#DN_ACCESS
 0x00000001

	)

157 
	#DN_MODIFY
 0x00000002

	)

158 
	#DN_CREATE
 0x00000004

	)

159 
	#DN_DELETE
 0x00000008

	)

160 
	#DN_RENAME
 0x00000010

	)

161 
	#DN_ATTRIB
 0x00000020

	)

162 
	#DN_MULTISHOT
 0x80000000

	)

165 
	sæock


167 
	ml_ty³
;

168 
	ml_wh’û
;

169 #iâdeà
__USE_FILE_OFFSET64


170 
__off_t
 
	ml_¡¬t
;

171 
__off_t
 
	ml_Ën
;

173 
__off64_t
 
	ml_¡¬t
;

174 
__off64_t
 
	ml_Ën
;

176 
__pid_t
 
	ml_pid
;

179 #ifdeà
__USE_LARGEFILE64


180 
	sæock64


182 
	ml_ty³
;

183 
	ml_wh’û
;

184 
__off64_t
 
	ml_¡¬t
;

185 
__off64_t
 
	ml_Ën
;

186 
__pid_t
 
	ml_pid
;

190 #ifdeà
__USE_GNU


192 
	e__pid_ty³


194 
	mF_OWNER_TID
 = 0,

195 
	mF_OWNER_PID
,

196 
	mF_OWNER_PGRP
,

197 
	mF_OWNER_GID
 = 
F_OWNER_PGRP


201 
	sf_owÃr_ex


203 
__pid_ty³
 
	mty³
;

204 
__pid_t
 
	mpid
;

210 #ifdef 
__USE_BSD


211 
	#FAPPEND
 
O_APPEND


	)

212 
	#FFSYNC
 
O_FSYNC


	)

213 
	#FASYNC
 
O_ASYNC


	)

214 
	#FNONBLOCK
 
O_NONBLOCK


	)

215 
	#FNDELAY
 
O_NDELAY


	)

219 #ifdeà
__USE_XOPEN2K


220 
	#POSIX_FADV_NORMAL
 0

	)

221 
	#POSIX_FADV_RANDOM
 1

	)

222 
	#POSIX_FADV_SEQUENTIAL
 2

	)

223 
	#POSIX_FADV_WILLNEED
 3

	)

224 
	#POSIX_FADV_DONTNEED
 4

	)

225 
	#POSIX_FADV_NOREUSE
 5

	)

229 #ifdeà
__USE_GNU


231 
	#SYNC_FILE_RANGE_WAIT_BEFORE
 1

	)

234 
	#SYNC_FILE_RANGE_WRITE
 2

	)

237 
	#SYNC_FILE_RANGE_WAIT_AFTER
 4

	)

242 
	#SPLICE_F_MOVE
 1

	)

243 
	#SPLICE_F_NONBLOCK
 2

	)

246 
	#SPLICE_F_MORE
 4

	)

247 
	#SPLICE_F_GIFT
 8

	)

250 
	g__BEGIN_DECLS


252 #ifdeà
__USE_GNU


255 
ssize_t
 
	$»adah—d
 (
__fd
, 
__off64_t
 
__off£t
, 
size_t
 
__couÁ
)

256 
__THROW
;

260 
	`sync_fe_¿nge
 (
__fd
, 
__off64_t
 
__off£t
, __off64_ˆ
__couÁ
,

261 
__æags
);

265 
ssize_t
 
	`vm¥liû
 (
__fdout
, cÚ¡ 
iovec
 *
__iov
,

266 
size_t
 
__couÁ
, 
__æags
);

269 
ssize_t
 
	`¥liû
 (
__fdš
, 
__off64_t
 *
__offš
, 
__fdout
,

270 
__off64_t
 *
__offout
, 
size_t
 
__Ën
,

271 
__æags
);

274 
ssize_t
 
	`‹e
 (
__fdš
, 
__fdout
, 
size_t
 
__Ën
,

275 
__æags
);

278 #iâdeà
__USE_FILE_OFFSET64


279 
	`çÎoÿ‹
 (
__fd
, 
__mode
, 
__off_t
 
__off£t
, __off_ˆ
__Ën
);

281 #ifdeà
__REDIRECT


282 
	`__REDIRECT
 (
çÎoÿ‹
, (
__fd
, 
__mode
, 
__off64_t
 
__off£t
,

283 
__off64_t
 
__Ën
),

284 
çÎoÿ‹64
);

286 
	#çÎoÿ‹
 
çÎoÿ‹64


	)

289 #ifdeà
__USE_LARGEFILE64


290 
	`çÎoÿ‹64
 (
__fd
, 
__mode
, 
__off64_t
 
__off£t
,

291 
__off64_t
 
__Ën
);

295 
__END_DECLS


	@/usr/include/bits/fcntl2.h

20 #iâdef 
_FCNTL_H


26 #iâdeà
__USE_FILE_OFFSET64


27 
	$__İ’_2
 (
__cÚ¡
 *
__·th
, 
__oæag
è
	`__nÚnuÎ
 ((1));

28 
	`__REDIRECT
 (
__İ’_®Ÿs
, (
__cÚ¡
 *
__·th
, 
__oæag
, ...),

29 
İ’
è
	`__nÚnuÎ
 ((1));

31 
	`__REDIRECT
 (
__İ’_2
, (
__cÚ¡
 *
__·th
, 
__oæag
),

32 
__İ’64_2
è
	`__nÚnuÎ
 ((1));

33 
	`__REDIRECT
 (
__İ’_®Ÿs
, (
__cÚ¡
 *
__·th
, 
__oæag
, ...),

34 
İ’64
è
	`__nÚnuÎ
 ((1));

36 
	`__”rÜdeş
 (
__İ’_too_mªy_¬gs
,

38 
	`__”rÜdeş
 (
__İ’_missšg_mode
,

41 
__ex‹º_®ways_šlše
 

42 
	$İ’
 (
__cÚ¡
 *
__·th
, 
__oæag
, ...)

44 ià(
	`__va_¬g_·ck_Ën
 () > 1)

45 
	`__İ’_too_mªy_¬gs
 ();

47 ià(
	`__butš_cÚ¡ªt_p
 (
__oæag
))

49 ià((
__oæag
 & 
O_CREAT
è!ğ0 && 
	`__va_¬g_·ck_Ën
 () < 1)

51 
	`__İ’_missšg_mode
 ();

52  
	`__İ’_2
 (
__·th
, 
__oæag
);

54  
	`__İ’_®Ÿs
 (
__·th
, 
__oæag
, 
	`__va_¬g_·ck
 ());

57 ià(
	`__va_¬g_·ck_Ën
 () < 1)

58  
	`__İ’_2
 (
__·th
, 
__oæag
);

60  
	`__İ’_®Ÿs
 (
__·th
, 
__oæag
, 
	`__va_¬g_·ck
 ());

61 
	}
}

64 #ifdeà
__USE_LARGEFILE64


65 
	$__İ’64_2
 (
__cÚ¡
 *
__·th
, 
__oæag
è
	`__nÚnuÎ
 ((1));

66 
	`__REDIRECT
 (
__İ’64_®Ÿs
, (
__cÚ¡
 *
__·th
, 
__oæag
,

67 ...), 
İ’64
è
	`__nÚnuÎ
 ((1));

68 
	`__”rÜdeş
 (
__İ’64_too_mªy_¬gs
,

70 
	`__”rÜdeş
 (
__İ’64_missšg_mode
,

73 
__ex‹º_®ways_šlše
 

74 
	$İ’64
 (
__cÚ¡
 *
__·th
, 
__oæag
, ...)

76 ià(
	`__va_¬g_·ck_Ën
 () > 1)

77 
	`__İ’64_too_mªy_¬gs
 ();

79 ià(
	`__butš_cÚ¡ªt_p
 (
__oæag
))

81 ià((
__oæag
 & 
O_CREAT
è!ğ0 && 
	`__va_¬g_·ck_Ën
 () < 1)

83 
	`__İ’64_missšg_mode
 ();

84  
	`__İ’64_2
 (
__·th
, 
__oæag
);

86  
	`__İ’64_®Ÿs
 (
__·th
, 
__oæag
, 
	`__va_¬g_·ck
 ());

89 ià(
	`__va_¬g_·ck_Ën
 () < 1)

90  
	`__İ’64_2
 (
__·th
, 
__oæag
);

92  
	`__İ’64_®Ÿs
 (
__·th
, 
__oæag
, 
	`__va_¬g_·ck
 ());

93 
	}
}

97 #ifdeà
__USE_ATFILE


98 #iâdeà
__USE_FILE_OFFSET64


99 
	$__İ’©_2
 (
__fd
, 
__cÚ¡
 *
__·th
, 
__oæag
)

100 
	`__nÚnuÎ
 ((2));

101 
	`__REDIRECT
 (
__İ’©_®Ÿs
, (
__fd
, 
__cÚ¡
 *
__·th
,

102 
__oæag
, ...), 
İ’©
)

103 
	`__nÚnuÎ
 ((2));

105 
	`__REDIRECT
 (
__İ’©_2
, (
__fd
, 
__cÚ¡
 *
__·th
,

106 
__oæag
), 
__İ’©64_2
)

107 
	`__nÚnuÎ
 ((2));

108 
	`__REDIRECT
 (
__İ’©_®Ÿs
, (
__fd
, 
__cÚ¡
 *
__·th
,

109 
__oæag
, ...), 
İ’©64
)

110 
	`__nÚnuÎ
 ((2));

112 
	`__”rÜdeş
 (
__İ’©_too_mªy_¬gs
,

114 
	`__”rÜdeş
 (
__İ’©_missšg_mode
,

117 
__ex‹º_®ways_šlše
 

118 
	$İ’©
 (
__fd
, 
__cÚ¡
 *
__·th
, 
__oæag
, ...)

120 ià(
	`__va_¬g_·ck_Ën
 () > 1)

121 
	`__İ’©_too_mªy_¬gs
 ();

123 ià(
	`__butš_cÚ¡ªt_p
 (
__oæag
))

125 ià((
__oæag
 & 
O_CREAT
è!ğ0 && 
	`__va_¬g_·ck_Ën
 () < 1)

127 
	`__İ’©_missšg_mode
 ();

128  
	`__İ’©_2
 (
__fd
, 
__·th
, 
__oæag
);

130  
	`__İ’©_®Ÿs
 (
__fd
, 
__·th
, 
__oæag
, 
	`__va_¬g_·ck
 ());

133 ià(
	`__va_¬g_·ck_Ën
 () < 1)

134  
	`__İ’©_2
 (
__fd
, 
__·th
, 
__oæag
);

136  
	`__İ’©_®Ÿs
 (
__fd
, 
__·th
, 
__oæag
, 
	`__va_¬g_·ck
 ());

137 
	}
}

140 #ifdeà
__USE_LARGEFILE64


141 
	$__İ’©64_2
 (
__fd
, 
__cÚ¡
 *
__·th
, 
__oæag
)

142 
	`__nÚnuÎ
 ((2));

143 
	`__REDIRECT
 (
__İ’©64_®Ÿs
, (
__fd
, 
__cÚ¡
 *
__·th
,

144 
__oæag
, ...), 
İ’©64
)

145 
	`__nÚnuÎ
 ((2));

146 
	`__”rÜdeş
 (
__İ’©64_too_mªy_¬gs
,

148 
	`__”rÜdeş
 (
__İ’©64_missšg_mode
,

151 
__ex‹º_®ways_šlše
 

152 
	$İ’©64
 (
__fd
, 
__cÚ¡
 *
__·th
, 
__oæag
, ...)

154 ià(
	`__va_¬g_·ck_Ën
 () > 1)

155 
	`__İ’©64_too_mªy_¬gs
 ();

157 ià(
	`__butš_cÚ¡ªt_p
 (
__oæag
))

159 ià((
__oæag
 & 
O_CREAT
è!ğ0 && 
	`__va_¬g_·ck_Ën
 () < 1)

161 
	`__İ’©64_missšg_mode
 ();

162  
	`__İ’©64_2
 (
__fd
, 
__·th
, 
__oæag
);

164  
	`__İ’©64_®Ÿs
 (
__fd
, 
__·th
, 
__oæag
, 
	`__va_¬g_·ck
 ());

167 ià(
	`__va_¬g_·ck_Ën
 () < 1)

168  
	`__İ’©64_2
 (
__fd
, 
__·th
, 
__oæag
);

170  
	`__İ’©64_®Ÿs
 (
__fd
, 
__·th
, 
__oæag
, 
	`__va_¬g_·ck
 ());

171 
	}
}

	@/usr/include/bits/posix_opt.h

20 #iâdef 
_BITS_POSIX_OPT_H


21 
	#_BITS_POSIX_OPT_H
 1

	)

24 
	#_POSIX_JOB_CONTROL
 1

	)

27 
	#_POSIX_SAVED_IDS
 1

	)

30 
	#_POSIX_PRIORITY_SCHEDULING
 200809L

	)

33 
	#_POSIX_SYNCHRONIZED_IO
 200809L

	)

36 
	#_POSIX_FSYNC
 200809L

	)

39 
	#_POSIX_MAPPED_FILES
 200809L

	)

42 
	#_POSIX_MEMLOCK
 200809L

	)

45 
	#_POSIX_MEMLOCK_RANGE
 200809L

	)

48 
	#_POSIX_MEMORY_PROTECTION
 200809L

	)

51 
	#_POSIX_CHOWN_RESTRICTED
 0

	)

55 
	#_POSIX_VDISABLE
 '\0'

	)

58 
	#_POSIX_NO_TRUNC
 1

	)

61 
	#_XOPEN_REALTIME
 1

	)

64 
	#_XOPEN_REALTIME_THREADS
 1

	)

67 
	#_XOPEN_SHM
 1

	)

70 
	#_POSIX_THREADS
 200809L

	)

73 
	#_POSIX_REENTRANT_FUNCTIONS
 1

	)

74 
	#_POSIX_THREAD_SAFE_FUNCTIONS
 200809L

	)

77 
	#_POSIX_THREAD_PRIORITY_SCHEDULING
 200809L

	)

80 
	#_POSIX_THREAD_ATTR_STACKSIZE
 200809L

	)

83 
	#_POSIX_THREAD_ATTR_STACKADDR
 200809L

	)

86 
	#_POSIX_THREAD_PRIO_INHERIT
 200809L

	)

90 
	#_POSIX_THREAD_PRIO_PROTECT
 200809L

	)

92 #ifdeà
__USE_XOPEN2K8


94 
	#_POSIX_THREAD_ROBUST_PRIO_INHERIT
 200809L

	)

97 
	#_POSIX_THREAD_ROBUST_PRIO_PROTECT
 -1

	)

101 
	#_POSIX_SEMAPHORES
 200809L

	)

104 
	#_POSIX_REALTIME_SIGNALS
 200809L

	)

107 
	#_POSIX_ASYNCHRONOUS_IO
 200809L

	)

108 
	#_POSIX_ASYNC_IO
 1

	)

110 
	#_LFS_ASYNCHRONOUS_IO
 1

	)

112 
	#_POSIX_PRIORITIZED_IO
 200809L

	)

115 
	#_LFS64_ASYNCHRONOUS_IO
 1

	)

118 
	#_LFS_LARGEFILE
 1

	)

119 
	#_LFS64_LARGEFILE
 1

	)

120 
	#_LFS64_STDIO
 1

	)

123 
	#_POSIX_SHARED_MEMORY_OBJECTS
 200809L

	)

126 
	#_POSIX_CPUTIME
 0

	)

129 
	#_POSIX_THREAD_CPUTIME
 0

	)

132 
	#_POSIX_REGEXP
 1

	)

135 
	#_POSIX_READER_WRITER_LOCKS
 200809L

	)

138 
	#_POSIX_SHELL
 1

	)

141 
	#_POSIX_TIMEOUTS
 200809L

	)

144 
	#_POSIX_SPIN_LOCKS
 200809L

	)

147 
	#_POSIX_SPAWN
 200809L

	)

150 
	#_POSIX_TIMERS
 200809L

	)

153 
	#_POSIX_BARRIERS
 200809L

	)

156 
	#_POSIX_MESSAGE_PASSING
 200809L

	)

159 
	#_POSIX_THREAD_PROCESS_SHARED
 200809L

	)

162 
	#_POSIX_MONOTONIC_CLOCK
 0

	)

165 
	#_POSIX_CLOCK_SELECTION
 200809L

	)

168 
	#_POSIX_ADVISORY_INFO
 200809L

	)

171 
	#_POSIX_IPV6
 200809L

	)

174 
	#_POSIX_RAW_SOCKETS
 200809L

	)

177 
	#_POSIX2_CHAR_TERM
 200809L

	)

180 
	#_POSIX_SPORADIC_SERVER
 -1

	)

181 
	#_POSIX_THREAD_SPORADIC_SERVER
 -1

	)

184 
	#_POSIX_TRACE
 -1

	)

185 
	#_POSIX_TRACE_EVENT_FILTER
 -1

	)

186 
	#_POSIX_TRACE_INHERIT
 -1

	)

187 
	#_POSIX_TRACE_LOG
 -1

	)

190 
	#_POSIX_TYPED_MEMORY_OBJECTS
 -1

	)

193 
	#_XOPEN_STREAMS
 -1

	)

	@/usr/include/bits/stat.h

19 #ià!
defšed
 
_SYS_STAT_H
 && !defšed 
_FCNTL_H


23 #iâdeà
_BITS_STAT_H


24 
	#_BITS_STAT_H
 1

	)

27 
	#_STAT_VER_KERNEL
 0

	)

29 #ià
__WORDSIZE
 == 32

30 
	#_STAT_VER_SVR4
 2

	)

31 
	#_STAT_VER_LINUX
 3

	)

34 
	#_MKNOD_VER_LINUX
 1

	)

35 
	#_MKNOD_VER_SVR4
 2

	)

36 
	#_MKNOD_VER
 
_MKNOD_VER_LINUX


	)

38 
	#_STAT_VER_LINUX
 1

	)

41 
	#_MKNOD_VER_LINUX
 0

	)

44 
	#_STAT_VER
 
_STAT_VER_LINUX


	)

46 
	s¡©


48 
__dev_t
 
	m¡_dev
;

49 #ià
__WORDSIZE
 == 32

50 
	m__·d1
;

52 #ià
__WORDSIZE
 =ğ64 || !
defšed
 
__USE_FILE_OFFSET64


53 
__šo_t
 
	m¡_šo
;

55 
__šo_t
 
	m__¡_šo
;

57 #ià
__WORDSIZE
 == 32

58 
__mode_t
 
	m¡_mode
;

59 
__Æšk_t
 
	m¡_Æšk
;

61 
__Æšk_t
 
	m¡_Æšk
;

62 
__mode_t
 
	m¡_mode
;

64 
__uid_t
 
	m¡_uid
;

65 
__gid_t
 
	m¡_gid
;

66 #ià
__WORDSIZE
 == 64

67 
	m__·d0
;

69 
__dev_t
 
	m¡_rdev
;

70 #ià
__WORDSIZE
 == 32

71 
	m__·d2
;

73 #ià
__WORDSIZE
 =ğ64 || !
defšed
 
__USE_FILE_OFFSET64


74 
__off_t
 
	m¡_size
;

76 
__off64_t
 
	m¡_size
;

78 
__blksize_t
 
	m¡_blksize
;

79 #ià
__WORDSIZE
 =ğ64 || !
defšed
 
__USE_FILE_OFFSET64


80 
__blkút_t
 
	m¡_blocks
;

82 
__blkút64_t
 
	m¡_blocks
;

84 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN2K8


91 
time¥ec
 
	m¡_©im
;

92 
time¥ec
 
	m¡_mtim
;

93 
time¥ec
 
	m¡_ùim
;

94 
	#¡_©ime
 
¡_©im
.
tv_£c


	)

95 
	#¡_mtime
 
¡_mtim
.
tv_£c


	)

96 
	#¡_ùime
 
¡_ùim
.
tv_£c


	)

98 
__time_t
 
	m¡_©ime
;

99 
	m¡_©im’£c
;

100 
__time_t
 
	m¡_mtime
;

101 
	m¡_mtim’£c
;

102 
__time_t
 
	m¡_ùime
;

103 
	m¡_ùim’£c
;

105 #ià
__WORDSIZE
 == 64

106 
	m__unu£d
[3];

108 #iâdeà
__USE_FILE_OFFSET64


109 
	m__unu£d4
;

110 
	m__unu£d5
;

112 
__šo64_t
 
	m¡_šo
;

117 #ifdeà
__USE_LARGEFILE64


119 
	s¡©64


121 
__dev_t
 
	m¡_dev
;

122 #ià
__WORDSIZE
 == 64

123 
__šo64_t
 
	m¡_šo
;

124 
__Æšk_t
 
	m¡_Æšk
;

125 
__mode_t
 
	m¡_mode
;

127 
	m__·d1
;

128 
__šo_t
 
	m__¡_šo
;

129 
__mode_t
 
	m¡_mode
;

130 
__Æšk_t
 
	m¡_Æšk
;

132 
__uid_t
 
	m¡_uid
;

133 
__gid_t
 
	m¡_gid
;

134 #ià
__WORDSIZE
 == 64

135 
	m__·d0
;

136 
__dev_t
 
	m¡_rdev
;

137 
__off_t
 
	m¡_size
;

139 
__dev_t
 
	m¡_rdev
;

140 
	m__·d2
;

141 
__off64_t
 
	m¡_size
;

143 
__blksize_t
 
	m¡_blksize
;

144 
__blkút64_t
 
	m¡_blocks
;

145 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN2K8


152 
time¥ec
 
	m¡_©im
;

153 
time¥ec
 
	m¡_mtim
;

154 
time¥ec
 
	m¡_ùim
;

155 
	#¡_©ime
 
¡_©im
.
tv_£c


	)

156 
	#¡_mtime
 
¡_mtim
.
tv_£c


	)

157 
	#¡_ùime
 
¡_ùim
.
tv_£c


	)

159 
__time_t
 
	m¡_©ime
;

160 
	m¡_©im’£c
;

161 
__time_t
 
	m¡_mtime
;

162 
	m¡_mtim’£c
;

163 
__time_t
 
	m¡_ùime
;

164 
	m¡_ùim’£c
;

166 #ià
__WORDSIZE
 == 64

167 
	m__unu£d
[3];

169 
__šo64_t
 
	m¡_šo
;

175 
	#_STATBUF_ST_BLKSIZE


	)

176 
	#_STATBUF_ST_RDEV


	)

178 
	#_STATBUF_ST_NSEC


	)

182 
	#__S_IFMT
 0170000

	)

185 
	#__S_IFDIR
 0040000

	)

186 
	#__S_IFCHR
 0020000

	)

187 
	#__S_IFBLK
 0060000

	)

188 
	#__S_IFREG
 0100000

	)

189 
	#__S_IFIFO
 0010000

	)

190 
	#__S_IFLNK
 0120000

	)

191 
	#__S_IFSOCK
 0140000

	)

195 
	#__S_TYPEISMQ
(
buf
è((buf)->
¡_mode
 - (buf)->¡_mode)

	)

196 
	#__S_TYPEISSEM
(
buf
è((buf)->
¡_mode
 - (buf)->¡_mode)

	)

197 
	#__S_TYPEISSHM
(
buf
è((buf)->
¡_mode
 - (buf)->¡_mode)

	)

201 
	#__S_ISUID
 04000

	)

202 
	#__S_ISGID
 02000

	)

203 
	#__S_ISVTX
 01000

	)

204 
	#__S_IREAD
 0400

	)

205 
	#__S_IWRITE
 0200

	)

206 
	#__S_IEXEC
 0100

	)

208 #ifdeà
__USE_ATFILE


209 
	#UTIME_NOW
 ((1È<< 30è- 1l)

	)

210 
	#UTIME_OMIT
 ((1È<< 30è- 2l)

	)

	@/usr/include/bits/stdio-ldbl.h

20 #iâdeà
_STDIO_H


24 
__BEGIN_NAMESPACE_STD


25 
	$__LDBL_REDIR_DECL
 (
årštf
)

26 
	$__LDBL_REDIR_DECL
 (
´štf
)

27 
	$__LDBL_REDIR_DECL
 (
¥rštf
)

28 
	$__LDBL_REDIR_DECL
 (
vårštf
)

29 
	$__LDBL_REDIR_DECL
 (
v´štf
)

30 
	$__LDBL_REDIR_DECL
 (
v¥rštf
)

31 #ià
defšed
 
__USE_ISOC99
 && !defšed 
__USE_GNU
 \

32 && !
defšed
 
__REDIRECT
 \

33 && (
defšed
 
__STRICT_ANSI__
 || defšed 
__USE_XOPEN2K
)

34 
	$__LDBL_REDIR1_DECL
 (
fsÿnf
, 
__Ædbl___isoc99_fsÿnf
)

35 
	$__LDBL_REDIR1_DECL
 (
sÿnf
, 
__Ædbl___isoc99_sÿnf
)

36 
	$__LDBL_REDIR1_DECL
 (
ssÿnf
, 
__Ædbl___isoc99_ssÿnf
)

38 
	$__LDBL_REDIR_DECL
 (
fsÿnf
)

39 
	$__LDBL_REDIR_DECL
 (
sÿnf
)

40 
	$__LDBL_REDIR_DECL
 (
ssÿnf
)

42 
__END_NAMESPACE_STD


44 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_ISOC99
 || defšed 
__USE_UNIX98


45 
__BEGIN_NAMESPACE_C99


46 
	$__LDBL_REDIR_DECL
 (
¢´štf
)

47 
	$__LDBL_REDIR_DECL
 (
v¢´štf
)

48 
__END_NAMESPACE_C99


51 #ifdef 
__USE_ISOC99


52 
__BEGIN_NAMESPACE_C99


53 #ià!
defšed
 
__USE_GNU
 && !defšed 
__REDIRECT
 \

54 && (
defšed
 
__STRICT_ANSI__
 || defšed 
__USE_XOPEN2K
)

55 
	$__LDBL_REDIR1_DECL
 (
vfsÿnf
, 
__Ædbl___isoc99_vfsÿnf
)

56 
	$__LDBL_REDIR1_DECL
 (
vsÿnf
, 
__Ædbl___isoc99_vsÿnf
)

57 
	$__LDBL_REDIR1_DECL
 (
vssÿnf
, 
__Ædbl___isoc99_vssÿnf
)

59 
	$__LDBL_REDIR_DECL
 (
vfsÿnf
)

60 
	$__LDBL_REDIR_DECL
 (
vssÿnf
)

61 
	$__LDBL_REDIR_DECL
 (
vsÿnf
)

63 
__END_NAMESPACE_C99


66 #ifdeà
__USE_GNU


67 
	$__LDBL_REDIR_DECL
 (
vd´štf
)

68 
	$__LDBL_REDIR_DECL
 (
d´štf
)

69 
	$__LDBL_REDIR_DECL
 (
va¥rštf
)

70 
	$__LDBL_REDIR_DECL
 (
__a¥rštf
)

71 
	$__LDBL_REDIR_DECL
 (
a¥rštf
)

72 
	$__LDBL_REDIR_DECL
 (
ob¡ack_´štf
)

73 
	$__LDBL_REDIR_DECL
 (
ob¡ack_v´štf
)

76 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__ex‹º_®ways_šlše


77 
	$__LDBL_REDIR_DECL
 (
__¥rštf_chk
)

78 
	$__LDBL_REDIR_DECL
 (
__v¥rštf_chk
)

79 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_ISOC99
 || defšed 
__USE_UNIX98


80 
	$__LDBL_REDIR_DECL
 (
__¢´štf_chk
)

81 
	$__LDBL_REDIR_DECL
 (
__v¢´štf_chk
)

83 #ià
__USE_FORTIFY_LEVEL
 > 1

84 
	$__LDBL_REDIR_DECL
 (
__årštf_chk
)

85 
	$__LDBL_REDIR_DECL
 (
__´štf_chk
)

86 
	$__LDBL_REDIR_DECL
 (
__vårštf_chk
)

87 
	$__LDBL_REDIR_DECL
 (
__v´štf_chk
)

88 #ifdeà
__USE_GNU


89 
	$__LDBL_REDIR_DECL
 (
__a¥rštf_chk
)

90 
	$__LDBL_REDIR_DECL
 (
__va¥rštf_chk
)

91 
	$__LDBL_REDIR_DECL
 (
__d´štf_chk
)

92 
	$__LDBL_REDIR_DECL
 (
__vd´štf_chk
)

93 
	$__LDBL_REDIR_DECL
 (
__ob¡ack_´štf_chk
)

94 
	$__LDBL_REDIR_DECL
 (
__ob¡ack_v´štf_chk
)

	@/usr/include/bits/stdio.h

20 #iâdeà
_STDIO_H


24 #iâdeà
__ex‹º_šlše


25 
	#__STDIO_INLINE
 
šlše


	)

27 
	#__STDIO_INLINE
 
__ex‹º_šlše


	)

31 #ifdeà
__USE_EXTERN_INLINES


34 #ià!(
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__ex‹º_®ways_šlše
)

36 
__STDIO_INLINE
 

37 
	$v´štf
 (
__cÚ¡
 *
__»¡riù
 
__fmt
, 
_G_va_li¡
 
__¬g
)

39  
	`vårštf
 (
¡dout
, 
__fmt
, 
__¬g
);

40 
	}
}

44 
__STDIO_INLINE
 

45 
	$g‘ch¬
 ()

47  
	`_IO_g‘c
 (
¡dš
);

48 
	}
}

51 #ifdeà
__USE_MISC


53 
__STDIO_INLINE
 

54 
	$fg‘c_uÆocked
 (
FILE
 *
__å
)

56  
	`_IO_g‘c_uÆocked
 (
__å
);

57 
	}
}

61 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC


63 
__STDIO_INLINE
 

64 
	$g‘c_uÆocked
 (
FILE
 *
__å
)

66  
	`_IO_g‘c_uÆocked
 (
__å
);

67 
	}
}

70 
__STDIO_INLINE
 

71 
	$g‘ch¬_uÆocked
 ()

73  
	`_IO_g‘c_uÆocked
 (
¡dš
);

74 
	}
}

79 
__STDIO_INLINE
 

80 
	$putch¬
 (
__c
)

82  
	`_IO_putc
 (
__c
, 
¡dout
);

83 
	}
}

86 #ifdeà
__USE_MISC


88 
__STDIO_INLINE
 

89 
	$åutc_uÆocked
 (
__c
, 
FILE
 *
__¡»am
)

91  
	`_IO_putc_uÆocked
 (
__c
, 
__¡»am
);

92 
	}
}

96 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC


98 
__STDIO_INLINE
 

99 
	$putc_uÆocked
 (
__c
, 
FILE
 *
__¡»am
)

101  
	`_IO_putc_uÆocked
 (
__c
, 
__¡»am
);

102 
	}
}

105 
__STDIO_INLINE
 

106 
	$putch¬_uÆocked
 (
__c
)

108  
	`_IO_putc_uÆocked
 (
__c
, 
¡dout
);

109 
	}
}

113 #ifdef 
__USE_GNU


115 
__STDIO_INLINE
 
_IO_ssize_t


116 
	$g‘lše
 (**
__lš•Œ
, 
size_t
 *
__n
, 
FILE
 *
__¡»am
)

118  
	`__g‘d–im
 (
__lš•Œ
, 
__n
, '\n', 
__¡»am
);

119 
	}
}

123 #ifdeà
__USE_MISC


125 
__STDIO_INLINE
 

126 
__NTH
 (
	$ãof_uÆocked
 (
FILE
 *
__¡»am
))

128  
	`_IO_ãof_uÆocked
 (
__¡»am
);

129 
	}
}

132 
__STDIO_INLINE
 

133 
__NTH
 (
	$ã¼Ü_uÆocked
 (
FILE
 *
__¡»am
))

135  
	`_IO_ã¼Ü_uÆocked
 (
__¡»am
);

136 
	}
}

142 #ià
defšed
 
__USE_MISC
 && defšed 
__GNUC__
 && defšed 
__OPTIMIZE__
 \

143 && !
defšed
 
	g__ılu¥lus


145 
	#ä—d_uÆocked
(
±r
, 
size
, 
n
, 
¡»am
) \

146 (
	`__ex‹nsiÚ__
 ((
	`__butš_cÚ¡ªt_p
 (
size
è&& __butš_cÚ¡ªt_°(
n
) \

147 && (
size_t
è(
size
è* (size_tè(
n
) <= 8 \

148 && (
size_t
è(
size
) != 0) \

149 ? ({ *
__±r
 = (*è(
±r
); \

150 
FILE
 *
__¡»am
 = (
¡»am
); \

151 
size_t
 
__út
; \

152 
__út
 = (
size_t
è(
size
è* (size_tè(
n
); \

153 
__út
 > 0; --__cnt) \

155 
__c
 = 
	`_IO_g‘c_uÆocked
 (
__¡»am
); \

156 ià(
__c
 =ğ
EOF
) \

158 *
__±r
++ = 
__c
; \

160 ((
size_t
è(
size
è* (size_tè(
n
è- 
__út
) \

161 / (
size_t
è(
size
); }) \

162 : (((
	`__butš_cÚ¡ªt_p
 (
size
è&& (
size_t
) (size) == 0) \

163 || (
	`__butš_cÚ¡ªt_p
 (
n
è&& (
size_t
) (n) == 0)) \

165 ? ((è(
±r
), (è(
¡»am
), (è(
size
), \

166 (è(
n
), (
size_t
) 0) \

167 : 
	`ä—d_uÆocked
 (
±r
, 
size
, 
n
, 
¡»am
))))

	)

169 
	#fwr™e_uÆocked
(
±r
, 
size
, 
n
, 
¡»am
) \

170 (
	`__ex‹nsiÚ__
 ((
	`__butš_cÚ¡ªt_p
 (
size
è&& __butš_cÚ¡ªt_°(
n
) \

171 && (
size_t
è(
size
è* (size_tè(
n
) <= 8 \

172 && (
size_t
è(
size
) != 0) \

173 ? ({ cÚ¡ *
__±r
 = (cÚ¡ *è(
±r
); \

174 
FILE
 *
__¡»am
 = (
¡»am
); \

175 
size_t
 
__út
; \

176 
__út
 = (
size_t
è(
size
è* (size_tè(
n
); \

177 
__út
 > 0; --__cnt) \

178 ià(
	`_IO_putc_uÆocked
 (*
__±r
++, 
__¡»am
è=ğ
EOF
) \

180 ((
size_t
è(
size
è* (size_tè(
n
è- 
__út
) \

181 / (
size_t
è(
size
); }) \

182 : (((
	`__butš_cÚ¡ªt_p
 (
size
è&& (
size_t
) (size) == 0) \

183 || (
	`__butš_cÚ¡ªt_p
 (
n
è&& (
size_t
) (n) == 0)) \

185 ? ((è(
±r
), (è(
¡»am
), (è(
size
), \

186 (è(
n
), (
size_t
) 0) \

187 : 
	`fwr™e_uÆocked
 (
±r
, 
size
, 
n
, 
¡»am
))))

	)

191 #undeà
__STDIO_INLINE


	@/usr/include/bits/stdio2.h

20 #iâdeà
_STDIO_H


24 
	$__¥rštf_chk
 (*
__»¡riù
 
__s
, 
__æag
, 
size_t
 
__¦’
,

25 
__cÚ¡
 *
__»¡riù
 
__fÜm©
, ...è
__THROW
;

26 
	$__v¥rštf_chk
 (*
__»¡riù
 
__s
, 
__æag
, 
size_t
 
__¦’
,

27 
__cÚ¡
 *
__»¡riù
 
__fÜm©
,

28 
_G_va_li¡
 
__­
è
__THROW
;

30 #ifdeà
__va_¬g_·ck


31 
__ex‹º_®ways_šlše
 

32 
	`__NTH
 (
	$¥rštf
 (*
__»¡riù
 
__s
, 
__cÚ¡
 *__»¡riù 
__fmt
, ...))

34  
	`__butš___¥rštf_chk
 (
__s
, 
__USE_FORTIFY_LEVEL
 - 1,

35 
	`__bos
 (
__s
), 
__fmt
, 
	`__va_¬g_·ck
 ());

36 
	}
}

37 #–ià!
defšed
 
__ılu¥lus


38 
	#¥rštf
(
¡r
, ...) \

39 
	`__butš___¥rštf_chk
 (
¡r
, 
__USE_FORTIFY_LEVEL
 - 1, 
	`__bos
 (str), \

40 
__VA_ARGS__
)

	)

43 
__ex‹º_®ways_šlše
 

44 
__NTH
 (
	$v¥rštf
 (*
__»¡riù
 
__s
, 
__cÚ¡
 *__»¡riù 
__fmt
,

45 
_G_va_li¡
 
__­
))

47  
	`__butš___v¥rštf_chk
 (
__s
, 
__USE_FORTIFY_LEVEL
 - 1,

48 
	`__bos
 (
__s
), 
__fmt
, 
__­
);

49 
	}
}

51 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_ISOC99
 || defšed 
__USE_UNIX98


53 
	$__¢´štf_chk
 (*
__»¡riù
 
__s
, 
size_t
 
__n
, 
__æag
,

54 
size_t
 
__¦’
, 
__cÚ¡
 *
__»¡riù
 
__fÜm©
,

55 ...è
__THROW
;

56 
	$__v¢´štf_chk
 (*
__»¡riù
 
__s
, 
size_t
 
__n
, 
__æag
,

57 
size_t
 
__¦’
, 
__cÚ¡
 *
__»¡riù
 
__fÜm©
,

58 
_G_va_li¡
 
__­
è
__THROW
;

60 #ifdeà
__va_¬g_·ck


61 
__ex‹º_®ways_šlše
 

62 
	`__NTH
 (
	$¢´štf
 (*
__»¡riù
 
__s
, 
size_t
 
__n
,

63 
__cÚ¡
 *
__»¡riù
 
__fmt
, ...))

65  
	`__butš___¢´štf_chk
 (
__s
, 
__n
, 
__USE_FORTIFY_LEVEL
 - 1,

66 
	`__bos
 (
__s
), 
__fmt
, 
	`__va_¬g_·ck
 ());

67 
	}
}

68 #–ià!
defšed
 
__ılu¥lus


69 
	#¢´štf
(
¡r
, 
Ën
, ...) \

70 
	`__butš___¢´štf_chk
 (
¡r
, 
Ën
, 
__USE_FORTIFY_LEVEL
 - 1, 
	`__bos
 (str), \

71 
__VA_ARGS__
)

	)

74 
__ex‹º_®ways_šlše
 

75 
__NTH
 (
	$v¢´štf
 (*
__»¡riù
 
__s
, 
size_t
 
__n
,

76 
__cÚ¡
 *
__»¡riù
 
__fmt
, 
_G_va_li¡
 
__­
))

78  
	`__butš___v¢´štf_chk
 (
__s
, 
__n
, 
__USE_FORTIFY_LEVEL
 - 1,

79 
	`__bos
 (
__s
), 
__fmt
, 
__­
);

80 
	}
}

84 #ià
__USE_FORTIFY_LEVEL
 > 1

86 
__årštf_chk
 (
FILE
 *
__»¡riù
 
__¡»am
, 
__æag
,

87 
__cÚ¡
 *
__»¡riù
 
__fÜm©
, ...);

88 
__´štf_chk
 (
__æag
, 
__cÚ¡
 *
__»¡riù
 
__fÜm©
, ...);

89 
__vårštf_chk
 (
FILE
 *
__»¡riù
 
__¡»am
, 
__æag
,

90 
__cÚ¡
 *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__­
);

91 
__v´štf_chk
 (
__æag
, 
__cÚ¡
 *
__»¡riù
 
__fÜm©
,

92 
_G_va_li¡
 
__­
);

94 #ifdeà
__va_¬g_·ck


95 
__ex‹º_®ways_šlše
 

96 
	$årštf
 (
FILE
 *
__»¡riù
 
__¡»am
, 
__cÚ¡
 *__»¡riù 
__fmt
, ...)

98  
	`__årštf_chk
 (
__¡»am
, 
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
,

99 
	`__va_¬g_·ck
 ());

100 
	}
}

102 
__ex‹º_®ways_šlše
 

103 
	$´štf
 (
__cÚ¡
 *
__»¡riù
 
__fmt
, ...)

105  
	`__´štf_chk
 (
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
, 
	`__va_¬g_·ck
 ());

106 
	}
}

107 #–ià!
defšed
 
__ılu¥lus


108 
	#´štf
(...) \

109 
	`__´štf_chk
 (
__USE_FORTIFY_LEVEL
 - 1, 
__VA_ARGS__
)

	)

110 
	#årštf
(
¡»am
, ...) \

111 
	`__årštf_chk
 (
¡»am
, 
__USE_FORTIFY_LEVEL
 - 1, 
__VA_ARGS__
)

	)

114 
__ex‹º_®ways_šlše
 

115 
	$v´štf
 (
__cÚ¡
 *
__»¡riù
 
__fmt
, 
_G_va_li¡
 
__­
)

117 #ifdeà
__USE_EXTERN_INLINES


118  
	`__vårštf_chk
 (
¡dout
, 
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
, 
__­
);

120  
	`__v´štf_chk
 (
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
, 
__­
);

122 
	}
}

124 
__ex‹º_®ways_šlše
 

125 
	$vårštf
 (
FILE
 *
__»¡riù
 
__¡»am
,

126 
__cÚ¡
 *
__»¡riù
 
__fmt
, 
_G_va_li¡
 
__­
)

128  
	`__vårštf_chk
 (
__¡»am
, 
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
, 
__­
);

129 
	}
}

131 #ifdeà
__USE_GNU


133 
	$__a¥rštf_chk
 (**
__»¡riù
 
__±r
, 
__æag
,

134 
__cÚ¡
 *
__»¡riù
 
__fmt
, ...)

135 
__THROW
 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__´štf__
, 3, 4))è
__wur
;

136 
	$__va¥rštf_chk
 (**
__»¡riù
 
__±r
, 
__æag
,

137 
__cÚ¡
 *
__»¡riù
 
__fmt
, 
_G_va_li¡
 
__¬g
)

138 
__THROW
 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__´štf__
, 3, 0))è
__wur
;

139 
	$__d´štf_chk
 (
__fd
, 
__æag
, 
__cÚ¡
 *
__»¡riù
 
__fmt
,

140 ...è
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 3, 4)));

141 
	$__vd´štf_chk
 (
__fd
, 
__æag
,

142 
__cÚ¡
 *
__»¡riù
 
__fmt
, 
_G_va_li¡
 
__¬g
)

143 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 3, 0)));

144 
	$__ob¡ack_´štf_chk
 (
ob¡ack
 *
__»¡riù
 
__ob¡ack
,

145 
__æag
, 
__cÚ¡
 *
__»¡riù
 
__fÜm©
,

147 
__THROW
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 3, 4)));

148 
	$__ob¡ack_v´štf_chk
 (
ob¡ack
 *
__»¡riù
 
__ob¡ack
,

149 
__æag
,

150 
__cÚ¡
 *
__»¡riù
 
__fÜm©
,

151 
_G_va_li¡
 
__¬gs
)

152 
__THROW
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 3, 0)));

154 #ifdeà
__va_¬g_·ck


155 
__ex‹º_®ways_šlše
 

156 
	`__NTH
 (
	$a¥rštf
 (**
__»¡riù
 
__±r
, 
__cÚ¡
 *__»¡riù 
__fmt
, ...))

158  
	`__a¥rštf_chk
 (
__±r
, 
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
,

159 
	`__va_¬g_·ck
 ());

160 
	}
}

162 
__ex‹º_®ways_šlše
 

163 
__NTH
 (
	$__a¥rštf
 (**
__»¡riù
 
__±r
, 
__cÚ¡
 *__»¡riù 
__fmt
,

166  
	`__a¥rštf_chk
 (
__±r
, 
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
,

167 
	`__va_¬g_·ck
 ());

168 
	}
}

170 
__ex‹º_®ways_šlše
 

171 
	$d´štf
 (
__fd
, 
__cÚ¡
 *
__»¡riù
 
__fmt
, ...)

173  
	`__d´štf_chk
 (
__fd
, 
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
,

174 
	`__va_¬g_·ck
 ());

175 
	}
}

177 
__ex‹º_®ways_šlše
 

178 
__NTH
 (
	$ob¡ack_´štf
 (
ob¡ack
 *
__»¡riù
 
__ob¡ack
,

179 
__cÚ¡
 *
__»¡riù
 
__fmt
, ...))

181  
	`__ob¡ack_´štf_chk
 (
__ob¡ack
, 
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
,

182 
	`__va_¬g_·ck
 ());

183 
	}
}

184 #–ià!
defšed
 
__ılu¥lus


185 
	#a¥rštf
(
±r
, ...) \

186 
	`__a¥rštf_chk
 (
±r
, 
__USE_FORTIFY_LEVEL
 - 1, 
__VA_ARGS__
)

	)

187 
	#__a¥rštf
(
±r
, ...) \

188 
	`__a¥rštf_chk
 (
±r
, 
__USE_FORTIFY_LEVEL
 - 1, 
__VA_ARGS__
)

	)

189 
	#d´štf
(
fd
, ...) \

190 
	`__d´štf_chk
 (
fd
, 
__USE_FORTIFY_LEVEL
 - 1, 
__VA_ARGS__
)

	)

191 
	#ob¡ack_´štf
(
ob¡ack
, ...) \

192 
	`__ob¡ack_´štf_chk
 (
ob¡ack
, 
__USE_FORTIFY_LEVEL
 - 1, 
__VA_ARGS__
)

	)

195 
__ex‹º_®ways_šlše
 

196 
__NTH
 (
	$va¥rštf
 (**
__»¡riù
 
__±r
, 
__cÚ¡
 *__»¡riù 
__fmt
,

197 
_G_va_li¡
 
__­
))

199  
	`__va¥rštf_chk
 (
__±r
, 
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
, 
__­
);

200 
	}
}

202 
__ex‹º_®ways_šlše
 

203 
	$vd´štf
 (
__fd
, 
__cÚ¡
 *
__»¡riù
 
__fmt
, 
_G_va_li¡
 
__­
)

205  
	`__vd´štf_chk
 (
__fd
, 
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
, 
__­
);

206 
	}
}

208 
__ex‹º_®ways_šlše
 

209 
__NTH
 (
	$ob¡ack_v´štf
 (
ob¡ack
 *
__»¡riù
 
__ob¡ack
,

210 
__cÚ¡
 *
__»¡riù
 
__fmt
, 
_G_va_li¡
 
__­
))

212  
	`__ob¡ack_v´štf_chk
 (
__ob¡ack
, 
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
,

213 
__­
);

214 
	}
}

220 *
	$__g‘s_chk
 (*
__¡r
, 
size_t
è
__wur
;

221 *
	`__REDIRECT
 (
__g‘s_w¬n
, (*
__¡r
), 
g‘s
)

222 
__wur
 
	`__w¬Ç‰r
 ("please use fgets or getline instead, gets can't "

225 
__ex‹º_®ways_šlše
 
__wur
 *

226 
	$g‘s
 (*
__¡r
)

228 ià(
	`__bos
 (
__¡r
è!ğ(
size_t
) -1)

229  
	`__g‘s_chk
 (
__¡r
, 
	`__bos
 (__str));

230  
	`__g‘s_w¬n
 (
__¡r
);

231 
	}
}

233 *
	$__fg‘s_chk
 (*
__»¡riù
 
__s
, 
size_t
 
__size
, 
__n
,

234 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

235 *
	`__REDIRECT
 (
__fg‘s_®Ÿs
,

236 (*
__»¡riù
 
__s
, 
__n
,

237 
FILE
 *
__»¡riù
 
__¡»am
), 
fg‘s
è
__wur
;

238 *
	`__REDIRECT
 (
__fg‘s_chk_w¬n
,

239 (*
__»¡riù
 
__s
, 
size_t
 
__size
, 
__n
,

240 
FILE
 *
__»¡riù
 
__¡»am
), 
__fg‘s_chk
)

241 
__wur
 
	`__w¬Ç‰r
 ("fgets called with bigger sizehan†ength "

244 
__ex‹º_®ways_šlše
 
__wur
 *

245 
	$fg‘s
 (*
__»¡riù
 
__s
, 
__n
, 
FILE
 *__»¡riù 
__¡»am
)

247 ià(
	`__bos
 (
__s
è!ğ(
size_t
) -1)

249 ià(!
	`__butš_cÚ¡ªt_p
 (
__n
) || __n <= 0)

250  
	`__fg‘s_chk
 (
__s
, 
	`__bos
 (__s), 
__n
, 
__¡»am
);

252 ià((
size_t
è
__n
 > 
	`__bos
 (
__s
))

253  
	`__fg‘s_chk_w¬n
 (
__s
, 
	`__bos
 (__s), 
__n
, 
__¡»am
);

255  
	`__fg‘s_®Ÿs
 (
__s
, 
__n
, 
__¡»am
);

256 
	}
}

258 
size_t
 
	$__ä—d_chk
 (*
__»¡riù
 
__±r
, 
size_t
 
__±¾’
,

259 
size_t
 
__size
, size_ˆ
__n
,

260 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

261 
size_t
 
	`__REDIRECT
 (
__ä—d_®Ÿs
,

262 (*
__»¡riù
 
__±r
, 
size_t
 
__size
,

263 
size_t
 
__n
, 
FILE
 *
__»¡riù
 
__¡»am
),

264 
ä—d
è
__wur
;

265 
size_t
 
	`__REDIRECT
 (
__ä—d_chk_w¬n
,

266 (*
__»¡riù
 
__±r
, 
size_t
 
__±¾’
,

267 
size_t
 
__size
, size_ˆ
__n
,

268 
FILE
 *
__»¡riù
 
__¡»am
),

269 
__ä—d_chk
)

270 
__wur
 
	`__w¬Ç‰r
 ("fread called with bigger size *‚membhan†ength "

273 
__ex‹º_®ways_šlše
 
__wur
 
size_t


274 
	$ä—d
 (*
__»¡riù
 
__±r
, 
size_t
 
__size
, size_ˆ
__n
,

275 
FILE
 *
__»¡riù
 
__¡»am
)

277 ià(
	`__bos0
 (
__±r
è!ğ(
size_t
) -1)

279 ià(!
	`__butš_cÚ¡ªt_p
 (
__size
)

280 || !
	`__butš_cÚ¡ªt_p
 (
__n
)

281 || (
__size
 | 
__n
è>ğ(((
size_t
) 1) << (8 *  (size_t) / 2)))

282  
	`__ä—d_chk
 (
__±r
, 
	`__bos0
 (__±r), 
__size
, 
__n
, 
__¡»am
);

284 ià(
__size
 * 
__n
 > 
	`__bos0
 (
__±r
))

285  
	`__ä—d_chk_w¬n
 (
__±r
, 
	`__bos0
 (__±r), 
__size
, 
__n
, 
__¡»am
);

287  
	`__ä—d_®Ÿs
 (
__±r
, 
__size
, 
__n
, 
__¡»am
);

288 
	}
}

290 #ifdeà
__USE_GNU


291 *
	$__fg‘s_uÆocked_chk
 (*
__»¡riù
 
__s
, 
size_t
 
__size
,

292 
__n
, 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

293 *
	`__REDIRECT
 (
__fg‘s_uÆocked_®Ÿs
,

294 (*
__»¡riù
 
__s
, 
__n
,

295 
FILE
 *
__»¡riù
 
__¡»am
), 
fg‘s_uÆocked
è
__wur
;

296 *
	`__REDIRECT
 (
__fg‘s_uÆocked_chk_w¬n
,

297 (*
__»¡riù
 
__s
, 
size_t
 
__size
, 
__n
,

298 
FILE
 *
__»¡riù
 
__¡»am
), 
__fg‘s_uÆocked_chk
)

299 
__wur
 
	`__w¬Ç‰r
 ("fgets_unlocked called with bigger sizehan†ength "

302 
__ex‹º_®ways_šlše
 
__wur
 *

303 
	$fg‘s_uÆocked
 (*
__»¡riù
 
__s
, 
__n
, 
FILE
 *__»¡riù 
__¡»am
)

305 ià(
	`__bos
 (
__s
è!ğ(
size_t
) -1)

307 ià(!
	`__butš_cÚ¡ªt_p
 (
__n
) || __n <= 0)

308  
	`__fg‘s_uÆocked_chk
 (
__s
, 
	`__bos
 (__s), 
__n
, 
__¡»am
);

310 ià((
size_t
è
__n
 > 
	`__bos
 (
__s
))

311  
	`__fg‘s_uÆocked_chk_w¬n
 (
__s
, 
	`__bos
 (__s), 
__n
, 
__¡»am
);

313  
	`__fg‘s_uÆocked_®Ÿs
 (
__s
, 
__n
, 
__¡»am
);

314 
	}
}

317 #ifdeà
__USE_MISC


318 #undeà
ä—d_uÆocked


319 
size_t
 
	$__ä—d_uÆocked_chk
 (*
__»¡riù
 
__±r
, 
size_t
 
__±¾’
,

320 
size_t
 
__size
, size_ˆ
__n
,

321 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

322 
size_t
 
	`__REDIRECT
 (
__ä—d_uÆocked_®Ÿs
,

323 (*
__»¡riù
 
__±r
, 
size_t
 
__size
,

324 
size_t
 
__n
, 
FILE
 *
__»¡riù
 
__¡»am
),

325 
ä—d_uÆocked
è
__wur
;

326 
size_t
 
	`__REDIRECT
 (
__ä—d_uÆocked_chk_w¬n
,

327 (*
__»¡riù
 
__±r
, 
size_t
 
__±¾’
,

328 
size_t
 
__size
, size_ˆ
__n
,

329 
FILE
 *
__»¡riù
 
__¡»am
),

330 
__ä—d_uÆocked_chk
)

331 
__wur
 
	`__w¬Ç‰r
 ("fread_unlocked called with bigger size *‚membhan "

334 
__ex‹º_®ways_šlše
 
__wur
 
size_t


335 
	$ä—d_uÆocked
 (*
__»¡riù
 
__±r
, 
size_t
 
__size
, size_ˆ
__n
,

336 
FILE
 *
__»¡riù
 
__¡»am
)

338 ià(
	`__bos0
 (
__±r
è!ğ(
size_t
) -1)

340 ià(!
	`__butš_cÚ¡ªt_p
 (
__size
)

341 || !
	`__butš_cÚ¡ªt_p
 (
__n
)

342 || (
__size
 | 
__n
è>ğ(((
size_t
) 1) << (8 *  (size_t) / 2)))

343  
	`__ä—d_uÆocked_chk
 (
__±r
, 
	`__bos0
 (__±r), 
__size
, 
__n
,

344 
__¡»am
);

346 ià(
__size
 * 
__n
 > 
	`__bos0
 (
__±r
))

347  
	`__ä—d_uÆocked_chk_w¬n
 (
__±r
, 
	`__bos0
 (__±r), 
__size
, 
__n
,

348 
__¡»am
);

351 #ifdeà
__USE_EXTERN_INLINES


352 ià(
	`__butš_cÚ¡ªt_p
 (
__size
)

353 && 
	`__butš_cÚ¡ªt_p
 (
__n
)

354 && (
__size
 | 
__n
è< (((
size_t
) 1) << (8 *  (size_t) / 2))

355 && 
__size
 * 
__n
 <= 8)

357 
size_t
 
__út
 = 
__size
 * 
__n
;

358 *
__ıŒ
 = (*è
__±r
;

359 ià(
__út
 == 0)

362 ; 
__út
 > 0; --__cnt)

364 
__c
 = 
	`_IO_g‘c_uÆocked
 (
__¡»am
);

365 ià(
__c
 =ğ
EOF
)

367 *
__ıŒ
++ = 
__c
;

369  (
__ıŒ
 - (*è
__±r
è/ 
__size
;

372  
	`__ä—d_uÆocked_®Ÿs
 (
__±r
, 
__size
, 
__n
, 
__¡»am
);

373 
	}
}

	@/usr/include/bits/stdio_lim.h

19 #ià!
defšed
 
_STDIO_H
 && !defšed 
__Ãed_FOPEN_MAX
 && !defšed 
__Ãed_IOV_MAX


23 #ifdeà
_STDIO_H


24 
	#L_tm²am
 20

	)

25 
	#TMP_MAX
 238328

	)

26 
	#FILENAME_MAX
 4096

	)

28 #ifdeà
__USE_POSIX


29 
	#L_ù”mid
 9

	)

30 #ià!
defšed
 
__USE_XOPEN2K
 || defšed 
__USE_GNU


31 
	#L_cu£rid
 9

	)

36 #ià
defšed
 
__Ãed_FOPEN_MAX
 || defšed 
_STDIO_H


37 #undeà
FOPEN_MAX


38 
	#FOPEN_MAX
 16

	)

41 #ià
defšed
 
__Ãed_IOV_MAX
 && !defšed 
IOV_MAX


42 
	#IOV_MAX
 1024

	)

	@/usr/include/bits/stdlib-ldbl.h

20 #iâdeà
_STDLIB_H


24 #ifdef 
__USE_ISOC99


25 
__BEGIN_NAMESPACE_C99


26 
	$__LDBL_REDIR1_DECL
 (
¡¹Şd
, 
¡¹od
)

27 
__END_NAMESPACE_C99


30 #ifdeà
__USE_GNU


31 
	$__LDBL_REDIR1_DECL
 (
¡¹Şd_l
, 
¡¹od_l
)

34 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN_EXTENDED


35 #ifdeà
__USE_MISC


36 
	$__LDBL_REDIR1_DECL
 (
qecvt
, 
ecvt
)

37 
	$__LDBL_REDIR1_DECL
 (
qfcvt
, 
fcvt
)

38 
	$__LDBL_REDIR1_DECL
 (
qgcvt
, 
gcvt
)

39 
	$__LDBL_REDIR1_DECL
 (
qecvt_r
, 
ecvt_r
)

40 
	$__LDBL_REDIR1_DECL
 (
qfcvt_r
, 
fcvt_r
)

	@/usr/include/bits/stdlib.h

20 #iâdeà
_STDLIB_H


24 *
	$__»®·th_chk
 (
__cÚ¡
 *
__»¡riù
 
__Çme
,

25 *
__»¡riù
 
__»sŞved
,

26 
size_t
 
__»sŞvedËn
è
__THROW
 
__wur
;

27 *
	`__REDIRECT_NTH
 (
__»®·th_®Ÿs
,

28 (
__cÚ¡
 *
__»¡riù
 
__Çme
,

29 *
__»¡riù
 
__»sŞved
), 
»®·th
è
__wur
;

30 *
	`__REDIRECT_NTH
 (
__»®·th_chk_w¬n
,

31 (
__cÚ¡
 *
__»¡riù
 
__Çme
,

32 *
__»¡riù
 
__»sŞved
,

33 
size_t
 
__»sŞvedËn
), 
__»®·th_chk
è
__wur


34 
	`__w¬Ç‰r
 ("second‡rgument of„ealpath must beƒither NULL or‡t "

37 
__ex‹º_®ways_šlše
 
__wur
 *

38 
	`__NTH
 (
	$»®·th
 (
__cÚ¡
 *
__»¡riù
 
__Çme
, *__»¡riù 
__»sŞved
))

40 ià(
	`__bos
 (
__»sŞved
è!ğ(
size_t
) -1)

42 #ià
defšed
 
_LIBC_LIMITS_H_
 && defšed 
PATH_MAX


43 ià(
	`__bos
 (
__»sŞved
è< 
PATH_MAX
)

44  
	`__»®·th_chk_w¬n
 (
__Çme
, 
__»sŞved
, 
	`__bos
 (__resolved));

46  
	`__»®·th_chk
 (
__Çme
, 
__»sŞved
, 
	`__bos
 (__resolved));

49  
	`__»®·th_®Ÿs
 (
__Çme
, 
__»sŞved
);

50 
	}
}

53 
	$__±¢ame_r_chk
 (
__fd
, *
__buf
, 
size_t
 
__buæ’
,

54 
size_t
 
__Ä—l
è
__THROW
 
	`__nÚnuÎ
 ((2));

55 
	`__REDIRECT_NTH
 (
__±¢ame_r_®Ÿs
, (
__fd
, *
__buf
,

56 
size_t
 
__buæ’
), 
±¢ame_r
)

57 
	`__nÚnuÎ
 ((2));

58 
	`__REDIRECT_NTH
 (
__±¢ame_r_chk_w¬n
,

59 (
__fd
, *
__buf
, 
size_t
 
__buæ’
,

60 
size_t
 
__Ä—l
), 
__±¢ame_r_chk
)

61 
	`__nÚnuÎ
 ((2)è
	`__w¬Ç‰r
 ("ptsname_r called with buflen biggerhan "

64 
__ex‹º_®ways_šlše
 

65 
	`__NTH
 (
	$±¢ame_r
 (
__fd
, *
__buf
, 
size_t
 
__buæ’
))

67 ià(
	`__bos
 (
__buf
è!ğ(
size_t
) -1)

69 ià(!
	`__butš_cÚ¡ªt_p
 (
__buæ’
))

70  
	`__±¢ame_r_chk
 (
__fd
, 
__buf
, 
__buæ’
, 
	`__bos
 (__buf));

71 ià(
__buæ’
 > 
	`__bos
 (
__buf
))

72  
	`__±¢ame_r_chk_w¬n
 (
__fd
, 
__buf
, 
__buæ’
, 
	`__bos
 (__buf));

74  
	`__±¢ame_r_®Ÿs
 (
__fd
, 
__buf
, 
__buæ’
);

75 
	}
}

78 
	$__wùomb_chk
 (*
__s
, 
wch¬_t
 
__wch¬
, 
size_t
 
__buæ’
)

79 
__THROW
 
__wur
;

80 
	`__REDIRECT_NTH
 (
__wùomb_®Ÿs
, (*
__s
, 
wch¬_t
 
__wch¬
),

81 
wùomb
è
__wur
;

83 
__ex‹º_®ways_šlše
 
__wur
 

84 
	`__NTH
 (
	$wùomb
 (*
__s
, 
wch¬_t
 
__wch¬
))

89 
	#__STDLIB_MB_LEN_MAX
 16

	)

90 #ià
defšed
 
MB_LEN_MAX
 && MB_LEN_MAX !ğ
__STDLIB_MB_LEN_MAX


93 ià(
	`__bos
 (
__s
è!ğ(
size_t
è-1 && 
__STDLIB_MB_LEN_MAX
 > __bos (__s))

94  
	`__wùomb_chk
 (
__s
, 
__wch¬
, 
	`__bos
 (__s));

95  
	`__wùomb_®Ÿs
 (
__s
, 
__wch¬
);

96 
	}
}

99 
size_t
 
	$__mb¡owcs_chk
 (
wch¬_t
 *
__»¡riù
 
__d¡
,

100 
__cÚ¡
 *
__»¡riù
 
__¤c
,

101 
size_t
 
__Ën
, size_ˆ
__d¡Ën
è
__THROW
;

102 
size_t
 
	`__REDIRECT_NTH
 (
__mb¡owcs_®Ÿs
,

103 (
wch¬_t
 *
__»¡riù
 
__d¡
,

104 
__cÚ¡
 *
__»¡riù
 
__¤c
,

105 
size_t
 
__Ën
), 
mb¡owcs
);

106 
size_t
 
	`__REDIRECT_NTH
 (
__mb¡owcs_chk_w¬n
,

107 (
wch¬_t
 *
__»¡riù
 
__d¡
,

108 
__cÚ¡
 *
__»¡riù
 
__¤c
,

109 
size_t
 
__Ën
, size_ˆ
__d¡Ën
), 
__mb¡owcs_chk
)

110 
	`__w¬Ç‰r
 ("mbstowcs called with dst buffer smallerhan†en "

113 
__ex‹º_®ways_šlše
 
size_t


114 
	`__NTH
 (
	$mb¡owcs
 (
wch¬_t
 *
__»¡riù
 
__d¡
, 
__cÚ¡
 *__»¡riù 
__¤c
,

115 
size_t
 
__Ën
))

117 ià(
	`__bos
 (
__d¡
è!ğ(
size_t
) -1)

119 ià(!
	`__butš_cÚ¡ªt_p
 (
__Ën
))

120  
	`__mb¡owcs_chk
 (
__d¡
, 
__¤c
, 
__Ën
,

121 
	`__bos
 (
__d¡
è/  (
wch¬_t
));

123 ià(
__Ën
 > 
	`__bos
 (
__d¡
è/  (
wch¬_t
))

124  
	`__mb¡owcs_chk_w¬n
 (
__d¡
, 
__¤c
, 
__Ën
,

125 
	`__bos
 (
__d¡
è/  (
wch¬_t
));

127  
	`__mb¡owcs_®Ÿs
 (
__d¡
, 
__¤c
, 
__Ën
);

128 
	}
}

131 
size_t
 
	$__wc¡ombs_chk
 (*
__»¡riù
 
__d¡
,

132 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__¤c
,

133 
size_t
 
__Ën
, size_ˆ
__d¡Ën
è
__THROW
;

134 
size_t
 
	`__REDIRECT_NTH
 (
__wc¡ombs_®Ÿs
,

135 (*
__»¡riù
 
__d¡
,

136 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__¤c
,

137 
size_t
 
__Ën
), 
wc¡ombs
);

138 
size_t
 
	`__REDIRECT_NTH
 (
__wc¡ombs_chk_w¬n
,

139 (*
__»¡riù
 
__d¡
,

140 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__¤c
,

141 
size_t
 
__Ën
, size_ˆ
__d¡Ën
), 
__wc¡ombs_chk
)

142 
	`__w¬Ç‰r
 ("wcstombs called with dst buffer smallerhan†en");

144 
__ex‹º_®ways_šlše
 
size_t


145 
	`__NTH
 (
	$wc¡ombs
 (*
__»¡riù
 
__d¡
, 
__cÚ¡
 
wch¬_t
 *__»¡riù 
__¤c
,

146 
size_t
 
__Ën
))

148 ià(
	`__bos
 (
__d¡
è!ğ(
size_t
) -1)

150 ià(!
	`__butš_cÚ¡ªt_p
 (
__Ën
))

151  
	`__wc¡ombs_chk
 (
__d¡
, 
__¤c
, 
__Ën
, 
	`__bos
 (__dst));

152 ià(
__Ën
 > 
	`__bos
 (
__d¡
))

153  
	`__wc¡ombs_chk_w¬n
 (
__d¡
, 
__¤c
, 
__Ën
, 
	`__bos
 (__dst));

155  
	`__wc¡ombs_®Ÿs
 (
__d¡
, 
__¤c
, 
__Ën
);

156 
	}
}

	@/usr/include/bits/string.h

20 #iâdeà
_STRING_H


26 
	#_STRING_ARCH_uÇligÃd
 1

	)

	@/usr/include/bits/string2.h

21 #iâdeà
_STRING_H


25 #ià!
defšed
 
__NO_STRING_INLINES
 && !defšed 
__BOUNDED_POINTERS__


42 #iâdeà
__STRING_INLINE


43 #ifdeà
__ılu¥lus


44 
	#__STRING_INLINE
 
šlše


	)

46 
	#__STRING_INLINE
 
__ex‹º_šlše


	)

50 #ià
_STRING_ARCH_uÇligÃd


52 
	~<’dŸn.h
>

53 
	~<b™s/ty³s.h
>

55 #ià
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN


56 
	#__STRING2_SMALL_GET16
(
¤c
, 
idx
) \

57 (((
__cÚ¡
 *è(__cÚ¡ *è(
¤c
))[
idx
 + 1] << 8 \

58 | ((
__cÚ¡
 *è(__cÚ¡ *è(
¤c
))[
idx
])

	)

59 
	#__STRING2_SMALL_GET32
(
¤c
, 
idx
) \

60 (((((
__cÚ¡
 *è(__cÚ¡ *è(
¤c
))[
idx
 + 3] << 8 \

61 | ((
__cÚ¡
 *è(__cÚ¡ *è(
¤c
))[
idx
 + 2]) << 8 \

62 | ((
__cÚ¡
 *è(__cÚ¡ *è(
¤c
))[
idx
 + 1]) << 8 \

63 | ((
__cÚ¡
 *è(__cÚ¡ *è(
¤c
))[
idx
])

	)

65 
	#__STRING2_SMALL_GET16
(
¤c
, 
idx
) \

66 (((
__cÚ¡
 *è(__cÚ¡ *è(
¤c
))[
idx
] << 8 \

67 | ((
__cÚ¡
 *è(__cÚ¡ *è(
¤c
))[
idx
 + 1])

	)

68 
	#__STRING2_SMALL_GET32
(
¤c
, 
idx
) \

69 (((((
__cÚ¡
 *è(__cÚ¡ *è(
¤c
))[
idx
] << 8 \

70 | ((
__cÚ¡
 *è(__cÚ¡ *è(
¤c
))[
idx
 + 1]) << 8 \

71 | ((
__cÚ¡
 *è(__cÚ¡ *è(
¤c
))[
idx
 + 2]) << 8 \

72 | ((
__cÚ¡
 *è(__cÚ¡ *è(
¤c
))[
idx
 + 3])

	)

77 
	#__STRING2_COPY_TYPE
(
N
) \

78 ¡ruù { 
__¬r
[
N
]; } \

79 
	t__©Œibu‹__
 ((
	t__·cked__
)è
	t__STRING2_COPY_ARR
##
	tN


	)

80 
	t__STRING2_COPY_TYPE
 (2);

81 
__STRING2_COPY_TYPE
 (3);

82 
__STRING2_COPY_TYPE
 (4);

83 
__STRING2_COPY_TYPE
 (5);

84 
__STRING2_COPY_TYPE
 (6);

85 
__STRING2_COPY_TYPE
 (7);

86 
__STRING2_COPY_TYPE
 (8);

87 #undeà
__STRING2_COPY_TYPE


93 
	#__¡ršg2_1b±r_p
(
__x
) \

94 ((
size_t
)(cÚ¡ *)((
__x
è+ 1è- (size_t)(cÚ¡ *)(__xè=ğ1)

	)

97 #ià!
defšed
 
_HAVE_STRING_ARCH_mem£t


98 #ià!
__GNUC_PREREQ
 (3, 0)

99 #ià
_STRING_ARCH_uÇligÃd


100 
	#mem£t
(
s
, 
c
, 
n
) \

101 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
n
) && (n) <= 16 \

102 ? ((
n
) == 1 \

103 ? 
	`__mem£t_1
 (
s
, 
c
) \

104 : 
	`__mem£t_gc
 (
s
, 
c
, 
n
)) \

105 : (
	`__butš_cÚ¡ªt_p
 (
c
) && (c) == '\0' \

106 ? ({ *
__s
 = (
s
); 
	`__bz”o
 (__s, 
n
); __s; }) \

107 : 
	`mem£t
 (
s
, 
c
, 
n
))))

	)

109 
	#__mem£t_1
(
s
, 
c
è({ *
__s
 = (s); \

110 *((
__ušt8_t
 *è
__s
èğ(__ušt8_tè
c
; __s; })

	)

112 
	#__mem£t_gc
(
s
, 
c
, 
n
) \

113 ({ *
__s
 = (
s
); \

115 
__ui
; \

116 
__usi
; \

117 
__uc
; \

118 } *
__u
 = 
__s
; \

119 
__ušt8_t
 
__c
 = (__ušt8_tè(
c
); \

122 (è(
n
)) \

125 
__u
->
__ui
 = 
__c
 * 0x01010101; \

126 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

128 
__u
->
__ui
 = 
__c
 * 0x01010101; \

129 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

131 
__u
->
__ui
 = 
__c
 * 0x01010101; \

132 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

134 
__u
->
__usi
 = (è
__c
 * 0x0101; \

135 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 2); \

136 
__u
->
__uc
 = (è
__c
; \

140 
__u
->
__ui
 = 
__c
 * 0x01010101; \

141 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

143 
__u
->
__ui
 = 
__c
 * 0x01010101; \

144 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

146 
__u
->
__ui
 = 
__c
 * 0x01010101; \

147 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

149 
__u
->
__usi
 = (è
__c
 * 0x0101; \

153 
__u
->
__ui
 = 
__c
 * 0x01010101; \

154 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

156 
__u
->
__ui
 = 
__c
 * 0x01010101; \

157 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

159 
__u
->
__ui
 = 
__c
 * 0x01010101; \

160 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

162 
__u
->
__uc
 = (è
__c
; \

166 
__u
->
__ui
 = 
__c
 * 0x01010101; \

167 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

169 
__u
->
__ui
 = 
__c
 * 0x01010101; \

170 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

172 
__u
->
__ui
 = 
__c
 * 0x01010101; \

173 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

175 
__u
->
__ui
 = 
__c
 * 0x01010101; \

180 
__s
; })

	)

182 
	#mem£t
(
s
, 
c
, 
n
) \

183 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
c
) && (c) == '\0' \

184 ? ({ *
__s
 = (
s
); 
	`__bz”o
 (__s, 
n
); __s; }) \

185 : 
	`mem£t
 (
s
, 
c
, 
n
)))

	)

194 #ià
__GNUC_PREREQ
 (2, 91)

195 
	#__bz”o
(
s
, 
n
è
	`__butš_mem£t
 (s, '\0',‚)

	)

203 #ifdeà
__USE_GNU


204 #ià!
defšed
 
_HAVE_STRING_ARCH_mempıy
 || defšed 
_FORCE_INLINES


205 #iâdeà
_HAVE_STRING_ARCH_mempıy


206 #ià
__GNUC_PREREQ
 (3, 4)

207 
	#__mempıy
(
de¡
, 
¤c
, 
n
è
	`__butš_mempıy
 (de¡, src,‚)

	)

208 #–ià
__GNUC_PREREQ
 (3, 0)

209 
	#__mempıy
(
de¡
, 
¤c
, 
n
) \

210 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
¤c
è&& __butš_cÚ¡ªt_°(
n
) \

211 && 
	`__¡ršg2_1b±r_p
 (
¤c
è&& 
n
 <= 8 \

212 ? 
	`__butš_memıy
 (
de¡
, 
¤c
, 
n
) + (n) \

213 : 
	`__mempıy
 (
de¡
, 
¤c
, 
n
)))

	)

215 
	#__mempıy
(
de¡
, 
¤c
, 
n
) \

216 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
¤c
è&& __butš_cÚ¡ªt_°(
n
) \

217 && 
	`__¡ršg2_1b±r_p
 (
¤c
è&& 
n
 <= 8 \

218 ? 
	`__mempıy_sm®l
 (
de¡
, 
	`__mempıy_¬gs
 (
¤c
), 
n
) \

219 : 
	`__mempıy
 (
de¡
, 
¤c
, 
n
)))

	)

223 
	#mempıy
(
de¡
, 
¤c
, 
n
è
	`__mempıy
 (de¡, src,‚)

	)

226 #ià!
__GNUC_PREREQ
 (3, 0è|| 
defšed
 
_FORCE_INLINES


227 #ià
_STRING_ARCH_uÇligÃd


228 #iâdeà
_FORCE_INLINES


229 
	#__mempıy_¬gs
(
¤c
) \

230 ((
__cÚ¡
 *è(
¤c
))[0], ((__const *) (src))[2], \

231 ((
__cÚ¡
 *è(
¤c
))[4], ((__const *) (src))[6], \

232 
__ex‹nsiÚ__
 
	`__STRING2_SMALL_GET16
 (
¤c
, 0), \

233 
__ex‹nsiÚ__
 
	`__STRING2_SMALL_GET16
 (
¤c
, 4), \

234 
__ex‹nsiÚ__
 
	`__STRING2_SMALL_GET32
 (
¤c
, 0), \

235 
__ex‹nsiÚ__
 
	`__STRING2_SMALL_GET32
 (
¤c
, 4)

	)

237 
__STRING_INLINE
 *
__mempıy_sm®l
 (*, , , , ,

238 
__ušt16_t
, __ušt16_t, 
__ušt32_t
,

239 
__ušt32_t
, 
size_t
);

240 
__STRING_INLINE
 *

241 
	$__mempıy_sm®l
 (*
__de¡1
,

242 
__¤c0_1
, 
__¤c2_1
, 
__¤c4_1
, 
__¤c6_1
,

243 
__ušt16_t
 
__¤c0_2
, __ušt16_ˆ
__¤c4_2
,

244 
__ušt32_t
 
__¤c0_4
, __ušt32_ˆ
__¤c4_4
,

245 
size_t
 
__¤ş’
)

248 
__ušt32_t
 
__ui
;

249 
__ušt16_t
 
__usi
;

250 
__uc
;

251 
__c
;

252 } *
__u
 = 
__de¡1
;

253 (è
__¤ş’
)

256 
__u
->
__c
 = 
__¤c0_1
;

257 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 1);

260 
__u
->
__usi
 = 
__¤c0_2
;

261 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 2);

264 
__u
->
__usi
 = 
__¤c0_2
;

265 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 2);

266 
__u
->
__c
 = 
__¤c2_1
;

267 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 1);

270 
__u
->
__ui
 = 
__¤c0_4
;

271 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4);

274 
__u
->
__ui
 = 
__¤c0_4
;

275 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4);

276 
__u
->
__c
 = 
__¤c4_1
;

277 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 1);

280 
__u
->
__ui
 = 
__¤c0_4
;

281 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4);

282 
__u
->
__usi
 = 
__¤c4_2
;

283 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 2);

286 
__u
->
__ui
 = 
__¤c0_4
;

287 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4);

288 
__u
->
__usi
 = 
__¤c4_2
;

289 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 2);

290 
__u
->
__c
 = 
__¤c6_1
;

291 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 1);

294 
__u
->
__ui
 = 
__¤c0_4
;

295 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4);

296 
__u
->
__ui
 = 
__¤c4_4
;

297 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4);

300  (*è
__u
;

301 
	}
}

303 #iâdeà
_FORCE_INLINES


304 
	#__mempıy_¬gs
(
¤c
) \

305 ((
__cÚ¡
 *è(
¤c
))[0], \

306 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR2
) \

307 { { ((
__cÚ¡
 *è(
¤c
))[0], ((__const *) (src))[1] } }), \

308 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR3
) \

309 { { ((
__cÚ¡
 *è(
¤c
))[0], ((__const *) (src))[1], \

310 ((
__cÚ¡
 *è(
¤c
))[2] } }), \

311 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR4
) \

312 { { ((
__cÚ¡
 *è(
¤c
))[0], ((__const *) (src))[1], \

313 ((
__cÚ¡
 *è(
¤c
))[2], ((__const *) (src))[3] } }), \

314 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR5
) \

315 { { ((
__cÚ¡
 *è(
¤c
))[0], ((__const *) (src))[1], \

316 ((
__cÚ¡
 *è(
¤c
))[2], ((__const *) (src))[3], \

317 ((
__cÚ¡
 *è(
¤c
))[4] } }), \

318 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR6
) \

319 { { ((
__cÚ¡
 *è(
¤c
))[0], ((__const *) (src))[1], \

320 ((
__cÚ¡
 *è(
¤c
))[2], ((__const *) (src))[3], \

321 ((
__cÚ¡
 *è(
¤c
))[4], ((__const *) (src))[5] } }), \

322 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR7
) \

323 { { ((
__cÚ¡
 *è(
¤c
))[0], ((__const *) (src))[1], \

324 ((
__cÚ¡
 *è(
¤c
))[2], ((__const *) (src))[3], \

325 ((
__cÚ¡
 *è(
¤c
))[4], ((__const *) (src))[5], \

326 ((
__cÚ¡
 *è(
¤c
))[6] } }), \

327 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR8
) \

328 { { ((
__cÚ¡
 *è(
¤c
))[0], ((__const *) (src))[1], \

329 ((
__cÚ¡
 *è(
¤c
))[2], ((__const *) (src))[3], \

330 ((
__cÚ¡
 *è(
¤c
))[4], ((__const *) (src))[5], \

331 ((
__cÚ¡
 *è(
¤c
))[6], ((__cÚ¡ *è(¤c))[7] } })

	)

333 
__STRING_INLINE
 *
__mempıy_sm®l
 (*, , 
__STRING2_COPY_ARR2
,

334 
__STRING2_COPY_ARR3
,

335 
__STRING2_COPY_ARR4
,

336 
__STRING2_COPY_ARR5
,

337 
__STRING2_COPY_ARR6
,

338 
__STRING2_COPY_ARR7
,

339 
__STRING2_COPY_ARR8
, 
size_t
);

340 
__STRING_INLINE
 *

341 
	$__mempıy_sm®l
 (*
__de¡
, 
__¤c1
,

342 
__STRING2_COPY_ARR2
 
__¤c2
, 
__STRING2_COPY_ARR3
 
__¤c3
,

343 
__STRING2_COPY_ARR4
 
__¤c4
, 
__STRING2_COPY_ARR5
 
__¤c5
,

344 
__STRING2_COPY_ARR6
 
__¤c6
, 
__STRING2_COPY_ARR7
 
__¤c7
,

345 
__STRING2_COPY_ARR8
 
__¤c8
, 
size_t
 
__¤ş’
)

348 
__c
;

349 
__STRING2_COPY_ARR2
 
__sÿ2
;

350 
__STRING2_COPY_ARR3
 
__sÿ3
;

351 
__STRING2_COPY_ARR4
 
__sÿ4
;

352 
__STRING2_COPY_ARR5
 
__sÿ5
;

353 
__STRING2_COPY_ARR6
 
__sÿ6
;

354 
__STRING2_COPY_ARR7
 
__sÿ7
;

355 
__STRING2_COPY_ARR8
 
__sÿ8
;

356 } *
__u
 = 
__de¡
;

357 (è
__¤ş’
)

360 
__u
->
__c
 = 
__¤c1
;

363 
__ex‹nsiÚ__
 
__u
->
__sÿ2
 = 
__¤c2
;

366 
__ex‹nsiÚ__
 
__u
->
__sÿ3
 = 
__¤c3
;

369 
__ex‹nsiÚ__
 
__u
->
__sÿ4
 = 
__¤c4
;

372 
__ex‹nsiÚ__
 
__u
->
__sÿ5
 = 
__¤c5
;

375 
__ex‹nsiÚ__
 
__u
->
__sÿ6
 = 
__¤c6
;

378 
__ex‹nsiÚ__
 
__u
->
__sÿ7
 = 
__¤c7
;

381 
__ex‹nsiÚ__
 
__u
->
__sÿ8
 = 
__¤c8
;

384  
	`__ex‹nsiÚ__
 ((*è
__u
 + 
__¤ş’
);

385 
	}
}

393 #iâdeà
_HAVE_STRING_ARCH_¡rchr


394 *
__¿wmemchr
 (cÚ¡ *
__s
, 
__c
);

395 #ià
__GNUC_PREREQ
 (3, 2)

396 
	#¡rchr
(
s
, 
c
) \

397 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
c
è&& !__butš_cÚ¡ªt_°(
s
) \

398 && (
c
) == '\0' \

399 ? (*è
	`__¿wmemchr
 (
s
, 
c
) \

400 : 
	`__butš_¡rchr
 (
s
, 
c
)))

	)

402 
	#¡rchr
(
s
, 
c
) \

403 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
c
) && (c) == '\0' \

404 ? (*è
	`__¿wmemchr
 (
s
, 
c
) \

405 : 
	`¡rchr
 (
s
, 
c
)))

	)

411 #ià(!
defšed
 
_HAVE_STRING_ARCH_¡rıy
 && !
__GNUC_PREREQ
 (3, 0)) \

412 || 
defšed
 
	g_FORCE_INLINES


413 #ià!
defšed
 
_HAVE_STRING_ARCH_¡rıy
 && !
__GNUC_PREREQ
 (3, 0)

414 
	#¡rıy
(
de¡
, 
¤c
) \

415 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
¤c
) \

416 ? (
	`__¡ršg2_1b±r_p
 (
¤c
è&& 
	`¡¾’
 (src) + 1 <= 8 \

417 ? 
	`__¡rıy_sm®l
 (
de¡
, 
	`__¡rıy_¬gs
 (
¤c
), \

418 
	`¡¾’
 (
¤c
) + 1) \

419 : (*è
	`memıy
 (
de¡
, 
¤c
, 
	`¡¾’
 (src) + 1)) \

420 : 
	`¡rıy
 (
de¡
, 
¤c
)))

	)

423 #ià
_STRING_ARCH_uÇligÃd


424 #iâdeà
_FORCE_INLINES


425 
	#__¡rıy_¬gs
(
¤c
) \

426 
__ex‹nsiÚ__
 
	`__STRING2_SMALL_GET16
 (
¤c
, 0), \

427 
__ex‹nsiÚ__
 
	`__STRING2_SMALL_GET16
 (
¤c
, 4), \

428 
__ex‹nsiÚ__
 
	`__STRING2_SMALL_GET32
 (
¤c
, 0), \

429 
__ex‹nsiÚ__
 
	`__STRING2_SMALL_GET32
 (
¤c
, 4)

	)

431 
__STRING_INLINE
 *
__¡rıy_sm®l
 (*, 
__ušt16_t
, __uint16_t,

432 
__ušt32_t
, __ušt32_t, 
size_t
);

433 
__STRING_INLINE
 *

434 
	$__¡rıy_sm®l
 (*
__de¡
,

435 
__ušt16_t
 
__¤c0_2
, __ušt16_ˆ
__¤c4_2
,

436 
__ušt32_t
 
__¤c0_4
, __ušt32_ˆ
__¤c4_4
,

437 
size_t
 
__¤ş’
)

440 
__ušt32_t
 
__ui
;

441 
__ušt16_t
 
__usi
;

442 
__uc
;

443 } *
__u
 = (*è
__de¡
;

444 (è
__¤ş’
)

447 
__u
->
__uc
 = '\0';

450 
__u
->
__usi
 = 
__¤c0_2
;

453 
__u
->
__usi
 = 
__¤c0_2
;

454 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 2);

455 
__u
->
__uc
 = '\0';

458 
__u
->
__ui
 = 
__¤c0_4
;

461 
__u
->
__ui
 = 
__¤c0_4
;

462 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4);

463 
__u
->
__uc
 = '\0';

466 
__u
->
__ui
 = 
__¤c0_4
;

467 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4);

468 
__u
->
__usi
 = 
__¤c4_2
;

471 
__u
->
__ui
 = 
__¤c0_4
;

472 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4);

473 
__u
->
__usi
 = 
__¤c4_2
;

474 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 2);

475 
__u
->
__uc
 = '\0';

478 
__u
->
__ui
 = 
__¤c0_4
;

479 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4);

480 
__u
->
__ui
 = 
__¤c4_4
;

483  
__de¡
;

484 
	}
}

486 #iâdeà
_FORCE_INLINES


487 
	#__¡rıy_¬gs
(
¤c
) \

488 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR2
) \

489 { { ((
__cÚ¡
 *è(
¤c
))[0], '\0' } }), \

490 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR3
) \

491 { { ((
__cÚ¡
 *è(
¤c
))[0], ((__const *) (src))[1], \

493 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR4
) \

494 { { ((
__cÚ¡
 *è(
¤c
))[0], ((__const *) (src))[1], \

495 ((
__cÚ¡
 *è(
¤c
))[2], '\0' } }), \

496 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR5
) \

497 { { ((
__cÚ¡
 *è(
¤c
))[0], ((__const *) (src))[1], \

498 ((
__cÚ¡
 *è(
¤c
))[2], ((__const *) (src))[3], \

500 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR6
) \

501 { { ((
__cÚ¡
 *è(
¤c
))[0], ((__const *) (src))[1], \

502 ((
__cÚ¡
 *è(
¤c
))[2], ((__const *) (src))[3], \

503 ((
__cÚ¡
 *è(
¤c
))[4], '\0' } }), \

504 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR7
) \

505 { { ((
__cÚ¡
 *è(
¤c
))[0], ((__const *) (src))[1], \

506 ((
__cÚ¡
 *è(
¤c
))[2], ((__const *) (src))[3], \

507 ((
__cÚ¡
 *è(
¤c
))[4], ((__const *) (src))[5], \

509 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR8
) \

510 { { ((
__cÚ¡
 *è(
¤c
))[0], ((__const *) (src))[1], \

511 ((
__cÚ¡
 *è(
¤c
))[2], ((__const *) (src))[3], \

512 ((
__cÚ¡
 *è(
¤c
))[4], ((__const *) (src))[5], \

513 ((
__cÚ¡
 *è(
¤c
))[6], '\0' } })

	)

515 
__STRING_INLINE
 *
__¡rıy_sm®l
 (*, 
__STRING2_COPY_ARR2
,

516 
__STRING2_COPY_ARR3
,

517 
__STRING2_COPY_ARR4
,

518 
__STRING2_COPY_ARR5
,

519 
__STRING2_COPY_ARR6
,

520 
__STRING2_COPY_ARR7
,

521 
__STRING2_COPY_ARR8
, 
size_t
);

522 
__STRING_INLINE
 *

523 
	$__¡rıy_sm®l
 (*
__de¡
,

524 
__STRING2_COPY_ARR2
 
__¤c2
, 
__STRING2_COPY_ARR3
 
__¤c3
,

525 
__STRING2_COPY_ARR4
 
__¤c4
, 
__STRING2_COPY_ARR5
 
__¤c5
,

526 
__STRING2_COPY_ARR6
 
__¤c6
, 
__STRING2_COPY_ARR7
 
__¤c7
,

527 
__STRING2_COPY_ARR8
 
__¤c8
, 
size_t
 
__¤ş’
)

530 
__c
;

531 
__STRING2_COPY_ARR2
 
__sÿ2
;

532 
__STRING2_COPY_ARR3
 
__sÿ3
;

533 
__STRING2_COPY_ARR4
 
__sÿ4
;

534 
__STRING2_COPY_ARR5
 
__sÿ5
;

535 
__STRING2_COPY_ARR6
 
__sÿ6
;

536 
__STRING2_COPY_ARR7
 
__sÿ7
;

537 
__STRING2_COPY_ARR8
 
__sÿ8
;

538 } *
__u
 = (*è
__de¡
;

539 (è
__¤ş’
)

542 
__u
->
__c
 = '\0';

545 
__ex‹nsiÚ__
 
__u
->
__sÿ2
 = 
__¤c2
;

548 
__ex‹nsiÚ__
 
__u
->
__sÿ3
 = 
__¤c3
;

551 
__ex‹nsiÚ__
 
__u
->
__sÿ4
 = 
__¤c4
;

554 
__ex‹nsiÚ__
 
__u
->
__sÿ5
 = 
__¤c5
;

557 
__ex‹nsiÚ__
 
__u
->
__sÿ6
 = 
__¤c6
;

560 
__ex‹nsiÚ__
 
__u
->
__sÿ7
 = 
__¤c7
;

563 
__ex‹nsiÚ__
 
__u
->
__sÿ8
 = 
__¤c8
;

566  
__de¡
;

567 
	}
}

573 #ifdeà
__USE_GNU


574 #ià!
defšed
 
_HAVE_STRING_ARCH_¡pıy
 || defšed 
_FORCE_INLINES


575 #iâdeà
_HAVE_STRING_ARCH_¡pıy


576 #ià
__GNUC_PREREQ
 (3, 4)

577 
	#__¡pıy
(
de¡
, 
¤c
è
	`__butš_¡pıy
 (de¡, src)

	)

578 #–ià
__GNUC_PREREQ
 (3, 0)

579 
	#__¡pıy
(
de¡
, 
¤c
) \

580 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
¤c
) \

581 ? (
	`__¡ršg2_1b±r_p
 (
¤c
è&& 
	`¡¾’
 (src) + 1 <= 8 \

582 ? 
	`__butš_¡rıy
 (
de¡
, 
¤c
è+ 
	`¡¾’
 (src) \

583 : ((*è(
__mempıy
è(
de¡
, 
¤c
, 
	`¡¾’
 (src) + 1) \

585 : 
	`__¡pıy
 (
de¡
, 
¤c
)))

	)

587 
	#__¡pıy
(
de¡
, 
¤c
) \

588 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
¤c
) \

589 ? (
	`__¡ršg2_1b±r_p
 (
¤c
è&& 
	`¡¾’
 (src) + 1 <= 8 \

590 ? 
	`__¡pıy_sm®l
 (
de¡
, 
	`__¡pıy_¬gs
 (
¤c
), \

591 
	`¡¾’
 (
¤c
) + 1) \

592 : ((*è(
__mempıy
è(
de¡
, 
¤c
, 
	`¡¾’
 (src) + 1) \

594 : 
	`__¡pıy
 (
de¡
, 
¤c
)))

	)

598 
	#¡pıy
(
de¡
, 
¤c
è
	`__¡pıy
 (de¡, src)

	)

601 #ià!
__GNUC_PREREQ
 (3, 0è|| 
defšed
 
_FORCE_INLINES


602 #ià
_STRING_ARCH_uÇligÃd


603 #iâdeà
_FORCE_INLINES


604 
	#__¡pıy_¬gs
(
¤c
) \

605 
__ex‹nsiÚ__
 
	`__STRING2_SMALL_GET16
 (
¤c
, 0), \

606 
__ex‹nsiÚ__
 
	`__STRING2_SMALL_GET16
 (
¤c
, 4), \

607 
__ex‹nsiÚ__
 
	`__STRING2_SMALL_GET32
 (
¤c
, 0), \

608 
__ex‹nsiÚ__
 
	`__STRING2_SMALL_GET32
 (
¤c
, 4)

	)

610 
__STRING_INLINE
 *
__¡pıy_sm®l
 (*, 
__ušt16_t
, __uint16_t,

611 
__ušt32_t
, __ušt32_t, 
size_t
);

612 
__STRING_INLINE
 *

613 
	$__¡pıy_sm®l
 (*
__de¡
,

614 
__ušt16_t
 
__¤c0_2
, __ušt16_ˆ
__¤c4_2
,

615 
__ušt32_t
 
__¤c0_4
, __ušt32_ˆ
__¤c4_4
,

616 
size_t
 
__¤ş’
)

619 
__ui
;

620 
__usi
;

621 
__uc
;

622 
__c
;

623 } *
__u
 = (*è
__de¡
;

624 (è
__¤ş’
)

627 
__u
->
__uc
 = '\0';

630 
__u
->
__usi
 = 
__¤c0_2
;

631 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 1);

634 
__u
->
__usi
 = 
__¤c0_2
;

635 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 2);

636 
__u
->
__uc
 = '\0';

639 
__u
->
__ui
 = 
__¤c0_4
;

640 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 3);

643 
__u
->
__ui
 = 
__¤c0_4
;

644 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4);

645 
__u
->
__uc
 = '\0';

648 
__u
->
__ui
 = 
__¤c0_4
;

649 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4);

650 
__u
->
__usi
 = 
__¤c4_2
;

651 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 1);

654 
__u
->
__ui
 = 
__¤c0_4
;

655 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4);

656 
__u
->
__usi
 = 
__¤c4_2
;

657 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 2);

658 
__u
->
__uc
 = '\0';

661 
__u
->
__ui
 = 
__¤c0_4
;

662 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4);

663 
__u
->
__ui
 = 
__¤c4_4
;

664 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 3);

667  &
__u
->
__c
;

668 
	}
}

670 #iâdeà
_FORCE_INLINES


671 
	#__¡pıy_¬gs
(
¤c
) \

672 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR2
) \

673 { { ((
__cÚ¡
 *è(
¤c
))[0], '\0' } }), \

674 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR3
) \

675 { { ((
__cÚ¡
 *è(
¤c
))[0], ((__const *) (src))[1], \

677 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR4
) \

678 { { ((
__cÚ¡
 *è(
¤c
))[0], ((__const *) (src))[1], \

679 ((
__cÚ¡
 *è(
¤c
))[2], '\0' } }), \

680 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR5
) \

681 { { ((
__cÚ¡
 *è(
¤c
))[0], ((__const *) (src))[1], \

682 ((
__cÚ¡
 *è(
¤c
))[2], ((__const *) (src))[3], \

684 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR6
) \

685 { { ((
__cÚ¡
 *è(
¤c
))[0], ((__const *) (src))[1], \

686 ((
__cÚ¡
 *è(
¤c
))[2], ((__const *) (src))[3], \

687 ((
__cÚ¡
 *è(
¤c
))[4], '\0' } }), \

688 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR7
) \

689 { { ((
__cÚ¡
 *è(
¤c
))[0], ((__const *) (src))[1], \

690 ((
__cÚ¡
 *è(
¤c
))[2], ((__const *) (src))[3], \

691 ((
__cÚ¡
 *è(
¤c
))[4], ((__const *) (src))[5], \

693 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR8
) \

694 { { ((
__cÚ¡
 *è(
¤c
))[0], ((__const *) (src))[1], \

695 ((
__cÚ¡
 *è(
¤c
))[2], ((__const *) (src))[3], \

696 ((
__cÚ¡
 *è(
¤c
))[4], ((__const *) (src))[5], \

697 ((
__cÚ¡
 *è(
¤c
))[6], '\0' } })

	)

699 
__STRING_INLINE
 *
__¡pıy_sm®l
 (*, 
__STRING2_COPY_ARR2
,

700 
__STRING2_COPY_ARR3
,

701 
__STRING2_COPY_ARR4
,

702 
__STRING2_COPY_ARR5
,

703 
__STRING2_COPY_ARR6
,

704 
__STRING2_COPY_ARR7
,

705 
__STRING2_COPY_ARR8
, 
size_t
);

706 
__STRING_INLINE
 *

707 
	$__¡pıy_sm®l
 (*
__de¡
,

708 
__STRING2_COPY_ARR2
 
__¤c2
, 
__STRING2_COPY_ARR3
 
__¤c3
,

709 
__STRING2_COPY_ARR4
 
__¤c4
, 
__STRING2_COPY_ARR5
 
__¤c5
,

710 
__STRING2_COPY_ARR6
 
__¤c6
, 
__STRING2_COPY_ARR7
 
__¤c7
,

711 
__STRING2_COPY_ARR8
 
__¤c8
, 
size_t
 
__¤ş’
)

714 
__c
;

715 
__STRING2_COPY_ARR2
 
__sÿ2
;

716 
__STRING2_COPY_ARR3
 
__sÿ3
;

717 
__STRING2_COPY_ARR4
 
__sÿ4
;

718 
__STRING2_COPY_ARR5
 
__sÿ5
;

719 
__STRING2_COPY_ARR6
 
__sÿ6
;

720 
__STRING2_COPY_ARR7
 
__sÿ7
;

721 
__STRING2_COPY_ARR8
 
__sÿ8
;

722 } *
__u
 = (*è
__de¡
;

723 (è
__¤ş’
)

726 
__u
->
__c
 = '\0';

729 
__ex‹nsiÚ__
 
__u
->
__sÿ2
 = 
__¤c2
;

732 
__ex‹nsiÚ__
 
__u
->
__sÿ3
 = 
__¤c3
;

735 
__ex‹nsiÚ__
 
__u
->
__sÿ4
 = 
__¤c4
;

738 
__ex‹nsiÚ__
 
__u
->
__sÿ5
 = 
__¤c5
;

741 
__ex‹nsiÚ__
 
__u
->
__sÿ6
 = 
__¤c6
;

744 
__ex‹nsiÚ__
 
__u
->
__sÿ7
 = 
__¤c7
;

747 
__ex‹nsiÚ__
 
__u
->
__sÿ8
 = 
__¤c8
;

750  
__de¡
 + 
__¤ş’
 - 1;

751 
	}
}

759 #iâdeà
_HAVE_STRING_ARCH_¡ºıy


760 #ià
__GNUC_PREREQ
 (3, 2)

761 
	#¡ºıy
(
de¡
, 
¤c
, 
n
è
	`__butš_¡ºıy
 (de¡, src,‚)

	)

763 
	#¡ºıy
(
de¡
, 
¤c
, 
n
) \

764 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
¤c
è&& __butš_cÚ¡ªt_°(
n
) \

765 ? (
	`¡¾’
 (
¤c
è+ 1 >ğ((
size_t
è(
n
)) \

766 ? (*è
	`memıy
 (
de¡
, 
¤c
, 
n
) \

767 : 
	`¡ºıy
 (
de¡
, 
¤c
, 
n
)) \

768 : 
	`¡ºıy
 (
de¡
, 
¤c
, 
n
)))

	)

774 #iâdeà
_HAVE_STRING_ARCH_¡ºÿt


775 #ifdeà
_USE_STRING_ARCH_¡rchr


776 
	#¡ºÿt
(
de¡
, 
¤c
, 
n
) \

777 (
	`__ex‹nsiÚ__
 ({ *
__de¡
 = (
de¡
); \

778 
	`__butš_cÚ¡ªt_p
 (
¤c
è&& __butš_cÚ¡ªt_°(
n
) \

779 ? (
	`¡¾’
 (
¤c
è< ((
size_t
è(
n
)) \

780 ? 
	`¡rÿt
 (
__de¡
, 
¤c
) \

781 : (*((*è
	`__mempıy
 (
	`¡rchr
 (
__de¡
, '\0'), \

782 
¤c
, 
n
)èğ'\0', 
__de¡
)) \

783 : 
	`¡ºÿt
 (
de¡
, 
¤c
, 
n
); }))

	)

784 #–ià
__GNUC_PREREQ
 (3, 2)

785 
	#¡ºÿt
(
de¡
, 
¤c
, 
n
è
	`__butš_¡ºÿt
 (de¡, src,‚)

	)

787 
	#¡ºÿt
(
de¡
, 
¤c
, 
n
) \

788 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
¤c
è&& __butš_cÚ¡ªt_°(
n
) \

789 ? (
	`¡¾’
 (
¤c
è< ((
size_t
è(
n
)) \

790 ? 
	`¡rÿt
 (
de¡
, 
¤c
) \

791 : 
	`¡ºÿt
 (
de¡
, 
¤c
, 
n
)) \

792 : 
	`¡ºÿt
 (
de¡
, 
¤c
, 
n
)))

	)

798 #iâdeà
_HAVE_STRING_ARCH_¡rcmp


799 #ià
__GNUC_PREREQ
 (3, 2)

800 
	#¡rcmp
(
s1
, 
s2
) \

801 
__ex‹nsiÚ__
 \

802 ({ 
size_t
 
__s1_Ën
, 
__s2_Ën
; \

803 (
	`__butš_cÚ¡ªt_p
 (
s1
è&& __butš_cÚ¡ªt_°(
s2
) \

804 && (
__s1_Ën
 = 
	`¡¾’
 (
s1
), 
__s2_Ën
 = sŒËÀ(
s2
), \

805 (!
	`__¡ršg2_1b±r_p
 (
s1
è|| 
__s1_Ën
 >= 4) \

806 && (!
	`__¡ršg2_1b±r_p
 (
s2
è|| 
__s2_Ën
 >= 4)) \

807 ? 
	`__butš_¡rcmp
 (
s1
, 
s2
) \

808 : (
	`__butš_cÚ¡ªt_p
 (
s1
è&& 
	`__¡ršg2_1b±r_p
 (s1) \

809 && (
__s1_Ën
 = 
	`¡¾’
 (
s1
), __s1_len < 4) \

810 ? (
	`__butš_cÚ¡ªt_p
 (
s2
è&& 
	`__¡ršg2_1b±r_p
 (s2) \

811 ? 
	`__butš_¡rcmp
 (
s1
, 
s2
) \

812 : 
	`__¡rcmp_cg
 (
s1
, 
s2
, 
__s1_Ën
)) \

813 : (
	`__butš_cÚ¡ªt_p
 (
s2
è&& 
	`__¡ršg2_1b±r_p
 (s2) \

814 && (
__s2_Ën
 = 
	`¡¾’
 (
s2
), __s2_len < 4) \

815 ? (
	`__butš_cÚ¡ªt_p
 (
s1
è&& 
	`__¡ršg2_1b±r_p
 (s1) \

816 ? 
	`__butš_¡rcmp
 (
s1
, 
s2
) \

817 : 
	`__¡rcmp_gc
 (
s1
, 
s2
, 
__s2_Ën
)) \

818 : 
	`__butš_¡rcmp
 (
s1
, 
s2
)))); })

	)

820 
	#¡rcmp
(
s1
, 
s2
) \

821 
__ex‹nsiÚ__
 \

822 ({ 
size_t
 
__s1_Ën
, 
__s2_Ën
; \

823 (
	`__butš_cÚ¡ªt_p
 (
s1
è&& __butš_cÚ¡ªt_°(
s2
) \

824 && (
__s1_Ën
 = 
	`¡¾’
 (
s1
), 
__s2_Ën
 = sŒËÀ(
s2
), \

825 (!
	`__¡ršg2_1b±r_p
 (
s1
è|| 
__s1_Ën
 >= 4) \

826 && (!
	`__¡ršg2_1b±r_p
 (
s2
è|| 
__s2_Ën
 >= 4)) \

827 ? 
	`memcmp
 ((
__cÚ¡
 *è(
s1
), (__cÚ¡ *è(
s2
), \

828 (
__s1_Ën
 < 
__s2_Ën
 ? __s1_len : __s2_len) + 1) \

829 : (
	`__butš_cÚ¡ªt_p
 (
s1
è&& 
	`__¡ršg2_1b±r_p
 (s1) \

830 && (
__s1_Ën
 = 
	`¡¾’
 (
s1
), __s1_len < 4) \

831 ? (
	`__butš_cÚ¡ªt_p
 (
s2
è&& 
	`__¡ršg2_1b±r_p
 (s2) \

832 ? 
	`__¡rcmp_cc
 (
s1
, 
s2
, 
__s1_Ën
) \

833 : 
	`__¡rcmp_cg
 (
s1
, 
s2
, 
__s1_Ën
)) \

834 : (
	`__butš_cÚ¡ªt_p
 (
s2
è&& 
	`__¡ršg2_1b±r_p
 (s2) \

835 && (
__s2_Ën
 = 
	`¡¾’
 (
s2
), __s2_len < 4) \

836 ? (
	`__butš_cÚ¡ªt_p
 (
s1
è&& 
	`__¡ršg2_1b±r_p
 (s1) \

837 ? 
	`__¡rcmp_cc
 (
s1
, 
s2
, 
__s2_Ën
) \

838 : 
	`__¡rcmp_gc
 (
s1
, 
s2
, 
__s2_Ën
)) \

839 : 
	`¡rcmp
 (
s1
, 
s2
)))); })

	)

842 
	#__¡rcmp_cc
(
s1
, 
s2
, 
l
) \

843 (
	`__ex‹nsiÚ__
 ({ 
__»suÉ
 = \

844 (((
__cÚ¡
 *è(__cÚ¡ *è(
s1
))[0] \

845 - ((
__cÚ¡
 *è(__cÚ¡ *)(
s2
))[0]);\

846 ià(
l
 > 0 && 
__»suÉ
 == 0) \

848 
__»suÉ
 = (((
__cÚ¡
 *) \

849 (
__cÚ¡
 *è(
s1
))[1] \

850 - ((
__cÚ¡
 *) \

851 (
__cÚ¡
 *è(
s2
))[1]); \

852 ià(
l
 > 1 && 
__»suÉ
 == 0) \

854 
__»suÉ
 = \

855 (((
__cÚ¡
 *) \

856 (
__cÚ¡
 *è(
s1
))[2] \

857 - ((
__cÚ¡
 *) \

858 (
__cÚ¡
 *è(
s2
))[2]); \

859 ià(
l
 > 2 && 
__»suÉ
 == 0) \

860 
__»suÉ
 = \

861 (((
__cÚ¡
 *) \

862 (
__cÚ¡
 *è(
s1
))[3] \

863 - ((
__cÚ¡
 *) \

864 (
__cÚ¡
 *è(
s2
))[3]); \

867 
__»suÉ
; }))

	)

869 
	#__¡rcmp_cg
(
s1
, 
s2
, 
l1
) \

870 (
	`__ex‹nsiÚ__
 ({ 
__cÚ¡
 *
__s2
 = \

871 (
__cÚ¡
 *è(__cÚ¡ *è(
s2
); \

872 
__»suÉ
 = \

873 (((
__cÚ¡
 *è(__cÚ¡ *è(
s1
))[0] \

874 - 
__s2
[0]); \

875 ià(
l1
 > 0 && 
__»suÉ
 == 0) \

877 
__»suÉ
 = (((
__cÚ¡
 *) \

878 (
__cÚ¡
 *è(
s1
))[1] - 
__s2
[1]); \

879 ià(
l1
 > 1 && 
__»suÉ
 == 0) \

881 
__»suÉ
 = (((
__cÚ¡
 *) \

882 (
__cÚ¡
 *è(
s1
))[2] - 
__s2
[2]);\

883 ià(
l1
 > 2 && 
__»suÉ
 == 0) \

884 
__»suÉ
 = (((
__cÚ¡
 *) \

885 (
__cÚ¡
 *è(
s1
))[3] \

886 - 
__s2
[3]); \

889 
__»suÉ
; }))

	)

891 
	#__¡rcmp_gc
(
s1
, 
s2
, 
l2
) \

892 (
	`__ex‹nsiÚ__
 ({ 
__cÚ¡
 *
__s1
 = \

893 (
__cÚ¡
 *è(__cÚ¡ *è(
s1
); \

894 
__»suÉ
 = \

895 
__s1
[0] - ((
__cÚ¡
 *) \

896 (
__cÚ¡
 *è(
s2
))[0]; \

897 ià(
l2
 > 0 && 
__»suÉ
 == 0) \

899 
__»suÉ
 = (
__s1
[1] \

900 - ((
__cÚ¡
 *) \

901 (
__cÚ¡
 *è(
s2
))[1]); \

902 ià(
l2
 > 1 && 
__»suÉ
 == 0) \

904 
__»suÉ
 = \

905 (
__s1
[2] - ((
__cÚ¡
 *) \

906 (
__cÚ¡
 *è(
s2
))[2]); \

907 ià(
l2
 > 2 && 
__»suÉ
 == 0) \

908 
__»suÉ
 = \

909 (
__s1
[3] \

910 - ((
__cÚ¡
 *) \

911 (
__cÚ¡
 *è(
s2
))[3]); \

914 
__»suÉ
; }))

	)

919 #iâdeà
_HAVE_STRING_ARCH_¡ºcmp


920 
	#¡ºcmp
(
s1
, 
s2
, 
n
) \

921 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
n
) \

922 && ((
	`__butš_cÚ¡ªt_p
 (
s1
) \

923 && 
	`¡¾’
 (
s1
è< ((
size_t
è(
n
))) \

924 || (
	`__butš_cÚ¡ªt_p
 (
s2
) \

925 && 
	`¡¾’
 (
s2
è< ((
size_t
è(
n
)))) \

926 ? 
	`¡rcmp
 (
s1
, 
s2
è: 
	`¡ºcmp
 (s1, s2, 
n
)))

	)

932 #ià!
defšed
 
_HAVE_STRING_ARCH_¡rc¥n
 || defšed 
_FORCE_INLINES


933 #iâdeà
_HAVE_STRING_ARCH_¡rc¥n


934 #ià
__GNUC_PREREQ
 (3, 2)

935 
	#¡rc¥n
(
s
, 
»jeù
) \

936 
__ex‹nsiÚ__
 \

937 ({ 
__r0
, 
__r1
, 
__r2
; \

938 (
	`__butš_cÚ¡ªt_p
 (
»jeù
è&& 
	`__¡ršg2_1b±r_p
 (reject) \

939 ? ((
	`__butš_cÚ¡ªt_p
 (
s
è&& 
	`__¡ršg2_1b±r_p
 (s)) \

940 ? 
	`__butš_¡rc¥n
 (
s
, 
»jeù
) \

941 : ((
__r0
 = ((
__cÚ¡
 *è(
»jeù
))[0], __r0 == '\0') \

942 ? 
	`¡¾’
 (
s
) \

943 : ((
__r1
 = ((
__cÚ¡
 *è(
»jeù
))[1], __r1 == '\0') \

944 ? 
	`__¡rc¥n_c1
 (
s
, 
__r0
) \

945 : ((
__r2
 = ((
__cÚ¡
 *è(
»jeù
))[2], __r2 == '\0') \

946 ? 
	`__¡rc¥n_c2
 (
s
, 
__r0
, 
__r1
) \

947 : (((
__cÚ¡
 *è(
»jeù
))[3] == '\0' \

948 ? 
	`__¡rc¥n_c3
 (
s
, 
__r0
, 
__r1
, 
__r2
) \

949 : 
	`__butš_¡rc¥n
 (
s
, 
»jeù
)))))) \

950 : 
	`__butš_¡rc¥n
 (
s
, 
»jeù
)); })

	)

952 
	#¡rc¥n
(
s
, 
»jeù
) \

953 
__ex‹nsiÚ__
 \

954 ({ 
__r0
, 
__r1
, 
__r2
; \

955 (
	`__butš_cÚ¡ªt_p
 (
»jeù
è&& 
	`__¡ršg2_1b±r_p
 (reject) \

956 ? ((
__r0
 = ((
__cÚ¡
 *è(
»jeù
))[0], __r0 == '\0') \

957 ? 
	`¡¾’
 (
s
) \

958 : ((
__r1
 = ((
__cÚ¡
 *è(
»jeù
))[1], __r1 == '\0') \

959 ? 
	`__¡rc¥n_c1
 (
s
, 
__r0
) \

960 : ((
__r2
 = ((
__cÚ¡
 *è(
»jeù
))[2], __r2 == '\0') \

961 ? 
	`__¡rc¥n_c2
 (
s
, 
__r0
, 
__r1
) \

962 : (((
__cÚ¡
 *è(
»jeù
))[3] == '\0' \

963 ? 
	`__¡rc¥n_c3
 (
s
, 
__r0
, 
__r1
, 
__r2
) \

964 : 
	`¡rc¥n
 (
s
, 
»jeù
))))) \

965 : 
	`¡rc¥n
 (
s
, 
»jeù
)); })

	)

969 
__STRING_INLINE
 
size_t
 
__¡rc¥n_c1
 (
__cÚ¡
 *
__s
, 
__»jeù
);

970 
__STRING_INLINE
 
size_t


971 
	$__¡rc¥n_c1
 (
__cÚ¡
 *
__s
, 
__»jeù
)

973 
size_t
 
__»suÉ
 = 0;

974 
__s
[
__»suÉ
] !ğ'\0' && __s[__»suÉ] !ğ
__»jeù
)

975 ++
__»suÉ
;

976  
__»suÉ
;

977 
	}
}

979 
__STRING_INLINE
 
size_t
 
__¡rc¥n_c2
 (
__cÚ¡
 *
__s
, 
__»jeù1
,

980 
__»jeù2
);

981 
__STRING_INLINE
 
size_t


982 
	$__¡rc¥n_c2
 (
__cÚ¡
 *
__s
, 
__»jeù1
, 
__»jeù2
)

984 
size_t
 
__»suÉ
 = 0;

985 
__s
[
__»suÉ
] !ğ'\0' && __s[__»suÉ] !ğ
__»jeù1


986 && 
__s
[
__»suÉ
] !ğ
__»jeù2
)

987 ++
__»suÉ
;

988  
__»suÉ
;

989 
	}
}

991 
__STRING_INLINE
 
size_t
 
__¡rc¥n_c3
 (
__cÚ¡
 *
__s
, 
__»jeù1
,

992 
__»jeù2
, 
__»jeù3
);

993 
__STRING_INLINE
 
size_t


994 
	$__¡rc¥n_c3
 (
__cÚ¡
 *
__s
, 
__»jeù1
, 
__»jeù2
,

995 
__»jeù3
)

997 
size_t
 
__»suÉ
 = 0;

998 
__s
[
__»suÉ
] !ğ'\0' && __s[__»suÉ] !ğ
__»jeù1


999 && 
__s
[
__»suÉ
] !ğ
__»jeù2
 && __s[__»suÉ] !ğ
__»jeù3
)

1000 ++
__»suÉ
;

1001  
__»suÉ
;

1002 
	}
}

1008 #ià!
defšed
 
_HAVE_STRING_ARCH_¡r¥n
 || defšed 
_FORCE_INLINES


1009 #iâdeà
_HAVE_STRING_ARCH_¡r¥n


1010 #ià
__GNUC_PREREQ
 (3, 2)

1011 
	#¡r¥n
(
s
, 
acû±
) \

1012 
__ex‹nsiÚ__
 \

1013 ({ 
__a0
, 
__a1
, 
__a2
; \

1014 (
	`__butš_cÚ¡ªt_p
 (
acû±
è&& 
	`__¡ršg2_1b±r_p
 (accept) \

1015 ? ((
	`__butš_cÚ¡ªt_p
 (
s
è&& 
	`__¡ršg2_1b±r_p
 (s)) \

1016 ? 
	`__butš_¡r¥n
 (
s
, 
acû±
) \

1017 : ((
__a0
 = ((
__cÚ¡
 *è(
acû±
))[0], __a0 == '\0') \

1018 ? ((è(
s
), 0) \

1019 : ((
__a1
 = ((
__cÚ¡
 *è(
acû±
))[1], __a1 == '\0') \

1020 ? 
	`__¡r¥n_c1
 (
s
, 
__a0
) \

1021 : ((
__a2
 = ((
__cÚ¡
 *è(
acû±
))[2], __a2 == '\0') \

1022 ? 
	`__¡r¥n_c2
 (
s
, 
__a0
, 
__a1
) \

1023 : (((
__cÚ¡
 *è(
acû±
))[3] == '\0' \

1024 ? 
	`__¡r¥n_c3
 (
s
, 
__a0
, 
__a1
, 
__a2
) \

1025 : 
	`__butš_¡r¥n
 (
s
, 
acû±
)))))) \

1026 : 
	`__butš_¡r¥n
 (
s
, 
acû±
)); })

	)

1028 
	#¡r¥n
(
s
, 
acû±
) \

1029 
__ex‹nsiÚ__
 \

1030 ({ 
__a0
, 
__a1
, 
__a2
; \

1031 (
	`__butš_cÚ¡ªt_p
 (
acû±
è&& 
	`__¡ršg2_1b±r_p
 (accept) \

1032 ? ((
__a0
 = ((
__cÚ¡
 *è(
acû±
))[0], __a0 == '\0') \

1033 ? ((è(
s
), 0) \

1034 : ((
__a1
 = ((
__cÚ¡
 *è(
acû±
))[1], __a1 == '\0') \

1035 ? 
	`__¡r¥n_c1
 (
s
, 
__a0
) \

1036 : ((
__a2
 = ((
__cÚ¡
 *è(
acû±
))[2], __a2 == '\0') \

1037 ? 
	`__¡r¥n_c2
 (
s
, 
__a0
, 
__a1
) \

1038 : (((
__cÚ¡
 *è(
acû±
))[3] == '\0' \

1039 ? 
	`__¡r¥n_c3
 (
s
, 
__a0
, 
__a1
, 
__a2
) \

1040 : 
	`¡r¥n
 (
s
, 
acû±
))))) \

1041 : 
	`¡r¥n
 (
s
, 
acû±
)); })

	)

1045 
__STRING_INLINE
 
size_t
 
__¡r¥n_c1
 (
__cÚ¡
 *
__s
, 
__acû±
);

1046 
__STRING_INLINE
 
size_t


1047 
	$__¡r¥n_c1
 (
__cÚ¡
 *
__s
, 
__acû±
)

1049 
size_t
 
__»suÉ
 = 0;

1051 
__s
[
__»suÉ
] =ğ
__acû±
)

1052 ++
__»suÉ
;

1053  
__»suÉ
;

1054 
	}
}

1056 
__STRING_INLINE
 
size_t
 
__¡r¥n_c2
 (
__cÚ¡
 *
__s
, 
__acû±1
,

1057 
__acû±2
);

1058 
__STRING_INLINE
 
size_t


1059 
	$__¡r¥n_c2
 (
__cÚ¡
 *
__s
, 
__acû±1
, 
__acû±2
)

1061 
size_t
 
__»suÉ
 = 0;

1063 
__s
[
__»suÉ
] =ğ
__acû±1
 || __s[__»suÉ] =ğ
__acû±2
)

1064 ++
__»suÉ
;

1065  
__»suÉ
;

1066 
	}
}

1068 
__STRING_INLINE
 
size_t
 
__¡r¥n_c3
 (
__cÚ¡
 *
__s
, 
__acû±1
,

1069 
__acû±2
, 
__acû±3
);

1070 
__STRING_INLINE
 
size_t


1071 
	$__¡r¥n_c3
 (
__cÚ¡
 *
__s
, 
__acû±1
, 
__acû±2
, 
__acû±3
)

1073 
size_t
 
__»suÉ
 = 0;

1075 
__s
[
__»suÉ
] =ğ
__acû±1
 || __s[__»suÉ] =ğ
__acû±2


1076 || 
__s
[
__»suÉ
] =ğ
__acû±3
)

1077 ++
__»suÉ
;

1078  
__»suÉ
;

1079 
	}
}

1084 #ià!
defšed
 
_HAVE_STRING_ARCH_¡½brk
 || defšed 
_FORCE_INLINES


1085 #iâdeà
_HAVE_STRING_ARCH_¡½brk


1086 #ià
__GNUC_PREREQ
 (3, 2)

1087 
	#¡½brk
(
s
, 
acû±
) \

1088 
__ex‹nsiÚ__
 \

1089 ({ 
__a0
, 
__a1
, 
__a2
; \

1090 (
	`__butš_cÚ¡ªt_p
 (
acû±
è&& 
	`__¡ršg2_1b±r_p
 (accept) \

1091 ? ((
	`__butš_cÚ¡ªt_p
 (
s
è&& 
	`__¡ršg2_1b±r_p
 (s)) \

1092 ? 
	`__butš_¡½brk
 (
s
, 
acû±
) \

1093 : ((
__a0
 = ((
__cÚ¡
 *è(
acû±
))[0], __a0 == '\0') \

1094 ? ((è(
s
), (*è
NULL
) \

1095 : ((
__a1
 = ((
__cÚ¡
 *è(
acû±
))[1], __a1 == '\0') \

1096 ? 
	`__butš_¡rchr
 (
s
, 
__a0
) \

1097 : ((
__a2
 = ((
__cÚ¡
 *è(
acû±
))[2], __a2 == '\0') \

1098 ? 
	`__¡½brk_c2
 (
s
, 
__a0
, 
__a1
) \

1099 : (((
__cÚ¡
 *è(
acû±
))[3] == '\0' \

1100 ? 
	`__¡½brk_c3
 (
s
, 
__a0
, 
__a1
, 
__a2
) \

1101 : 
	`__butš_¡½brk
 (
s
, 
acû±
)))))) \

1102 : 
	`__butš_¡½brk
 (
s
, 
acû±
)); })

	)

1104 
	#¡½brk
(
s
, 
acû±
) \

1105 
__ex‹nsiÚ__
 \

1106 ({ 
__a0
, 
__a1
, 
__a2
; \

1107 (
	`__butš_cÚ¡ªt_p
 (
acû±
è&& 
	`__¡ršg2_1b±r_p
 (accept) \

1108 ? ((
__a0
 = ((
__cÚ¡
 *è(
acû±
))[0], __a0 == '\0') \

1109 ? ((è(
s
), (*è
NULL
) \

1110 : ((
__a1
 = ((
__cÚ¡
 *è(
acû±
))[1], __a1 == '\0') \

1111 ? 
	`¡rchr
 (
s
, 
__a0
) \

1112 : ((
__a2
 = ((
__cÚ¡
 *è(
acû±
))[2], __a2 == '\0') \

1113 ? 
	`__¡½brk_c2
 (
s
, 
__a0
, 
__a1
) \

1114 : (((
__cÚ¡
 *è(
acû±
))[3] == '\0' \

1115 ? 
	`__¡½brk_c3
 (
s
, 
__a0
, 
__a1
, 
__a2
) \

1116 : 
	`¡½brk
 (
s
, 
acû±
))))) \

1117 : 
	`¡½brk
 (
s
, 
acû±
)); })

	)

1121 
__STRING_INLINE
 *
__¡½brk_c2
 (
__cÚ¡
 *
__s
, 
__acû±1
,

1122 
__acû±2
);

1123 
__STRING_INLINE
 *

1124 
	$__¡½brk_c2
 (
__cÚ¡
 *
__s
, 
__acû±1
, 
__acû±2
)

1127 *
__s
 !ğ'\0' && *__ !ğ
__acû±1
 && *__ !ğ
__acû±2
)

1128 ++
__s
;

1129  *
__s
 =ğ'\0' ? 
NULL
 : (*è(
size_t
) __s;

1130 
	}
}

1132 
__STRING_INLINE
 *
__¡½brk_c3
 (
__cÚ¡
 *
__s
, 
__acû±1
,

1133 
__acû±2
, 
__acû±3
);

1134 
__STRING_INLINE
 *

1135 
	$__¡½brk_c3
 (
__cÚ¡
 *
__s
, 
__acû±1
, 
__acû±2
,

1136 
__acû±3
)

1139 *
__s
 !ğ'\0' && *__ !ğ
__acû±1
 && *__ !ğ
__acû±2


1140 && *
__s
 !ğ
__acû±3
)

1141 ++
__s
;

1142  *
__s
 =ğ'\0' ? 
NULL
 : (*è(
size_t
) __s;

1143 
	}
}

1149 #ià!
defšed
 
_HAVE_STRING_ARCH_¡r¡r
 && !
__GNUC_PREREQ
 (2, 97)

1150 
	#¡r¡r
(
hay¡ack
, 
ÃedË
) \

1151 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
ÃedË
è&& 
	`__¡ršg2_1b±r_p
 (needle) \

1152 ? (((
__cÚ¡
 *è(
ÃedË
))[0] == '\0' \

1153 ? (*è(
size_t
è(
hay¡ack
) \

1154 : (((
__cÚ¡
 *è(
ÃedË
))[1] == '\0' \

1155 ? 
	`¡rchr
 (
hay¡ack
, \

1156 ((
__cÚ¡
 *è(
ÃedË
))[0]) \

1157 : 
	`¡r¡r
 (
hay¡ack
, 
ÃedË
))) \

1158 : 
	`¡r¡r
 (
hay¡ack
, 
ÃedË
)))

	)

1162 #ià!
defšed
 
_HAVE_STRING_ARCH_¡¹ok_r
 || defšed 
_FORCE_INLINES


1163 #iâdeà
_HAVE_STRING_ARCH_¡¹ok_r


1164 
	#__¡¹ok_r
(
s
, 
£p
, 
Ãx
) \

1165 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
£p
è&& 
	`__¡ršg2_1b±r_p
 (sep) \

1166 && ((
__cÚ¡
 *è(
£p
))[0] != '\0' \

1167 && ((
__cÚ¡
 *è(
£p
))[1] == '\0' \

1168 ? 
	`__¡¹ok_r_1c
 (
s
, ((
__cÚ¡
 *è(
£p
))[0], 
Ãx
) \

1169 : 
	`__¡¹ok_r
 (
s
, 
£p
, 
Ãx
)))

	)

1172 
__STRING_INLINE
 *
__¡¹ok_r_1c
 (*
__s
, 
__£p
, **
__Ãx
);

1173 
__STRING_INLINE
 *

1174 
	$__¡¹ok_r_1c
 (*
__s
, 
__£p
, **
__Ãx
)

1176 *
__»suÉ
;

1177 ià(
__s
 =ğ
NULL
)

1178 
__s
 = *
__Ãx
;

1179 *
__s
 =ğ
__£p
)

1180 ++
__s
;

1181 
__»suÉ
 = 
NULL
;

1182 ià(*
__s
 != '\0')

1184 
__»suÉ
 = 
__s
++;

1185 *
__s
 != '\0')

1186 ià(*
__s
++ =ğ
__£p
)

1188 
__s
[-1] = '\0';

1192 *
__Ãx
 = 
__s
;

1193  
__»suÉ
;

1194 
	}
}

1195 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC


1196 
	#¡¹ok_r
(
s
, 
£p
, 
Ãx
è
	`__¡¹ok_r
 (s, s•,‚ex)

	)

1201 #ià!
defšed
 
_HAVE_STRING_ARCH_¡r£p
 || defšed 
_FORCE_INLINES


1202 #iâdeà
_HAVE_STRING_ARCH_¡r£p


1204 *
__¡r£p_g
 (**
__¡ršgp
, 
__cÚ¡
 *
__d–im
);

1205 
	#__¡r£p
(
s
, 
»jeù
) \

1206 
__ex‹nsiÚ__
 \

1207 ({ 
__r0
, 
__r1
, 
__r2
; \

1208 (
	`__butš_cÚ¡ªt_p
 (
»jeù
è&& 
	`__¡ršg2_1b±r_p
 (reject) \

1209 && (
__r0
 = ((
__cÚ¡
 *è(
»jeù
))[0], \

1210 ((
__cÚ¡
 *è(
»jeù
))[0] != '\0') \

1211 ? ((
__r1
 = ((
__cÚ¡
 *è(
»jeù
))[1], \

1212 ((
__cÚ¡
 *è(
»jeù
))[1] == '\0') \

1213 ? 
	`__¡r£p_1c
 (
s
, 
__r0
) \

1214 : ((
__r2
 = ((
__cÚ¡
 *è(
»jeù
))[2], __r2 == '\0') \

1215 ? 
	`__¡r£p_2c
 (
s
, 
__r0
, 
__r1
) \

1216 : (((
__cÚ¡
 *è(
»jeù
))[3] == '\0' \

1217 ? 
	`__¡r£p_3c
 (
s
, 
__r0
, 
__r1
, 
__r2
) \

1218 : 
	`__¡r£p_g
 (
s
, 
»jeù
)))) \

1219 : 
	`__¡r£p_g
 (
s
, 
»jeù
)); })

	)

1222 
__STRING_INLINE
 *
__¡r£p_1c
 (**
__s
, 
__»jeù
);

1223 
__STRING_INLINE
 *

1224 
	$__¡r£p_1c
 (**
__s
, 
__»jeù
)

1226 *
__»tv®
 = *
__s
;

1227 ià(
__»tv®
 !ğ
NULL
 && (*
__s
 = 
	`¡rchr
 (__»tv®, 
__»jeù
)) != NULL)

1228 *(*
__s
)++ = '\0';

1229  
__»tv®
;

1230 
	}
}

1232 
__STRING_INLINE
 *
__¡r£p_2c
 (**
__s
, 
__»jeù1
, 
__»jeù2
);

1233 
__STRING_INLINE
 *

1234 
	$__¡r£p_2c
 (**
__s
, 
__»jeù1
, 
__»jeù2
)

1236 *
__»tv®
 = *
__s
;

1237 ià(
__»tv®
 !ğ
NULL
)

1239 *
__ı
 = 
__»tv®
;

1242 ià(*
__ı
 == '\0')

1244 
__ı
 = 
NULL
;

1247 ià(*
__ı
 =ğ
__»jeù1
 || *__ı =ğ
__»jeù2
)

1249 *
__ı
++ = '\0';

1252 ++
__ı
;

1254 *
__s
 = 
__ı
;

1256  
__»tv®
;

1257 
	}
}

1259 
__STRING_INLINE
 *
__¡r£p_3c
 (**
__s
, 
__»jeù1
, 
__»jeù2
,

1260 
__»jeù3
);

1261 
__STRING_INLINE
 *

1262 
	$__¡r£p_3c
 (**
__s
, 
__»jeù1
, 
__»jeù2
, 
__»jeù3
)

1264 *
__»tv®
 = *
__s
;

1265 ià(
__»tv®
 !ğ
NULL
)

1267 *
__ı
 = 
__»tv®
;

1270 ià(*
__ı
 == '\0')

1272 
__ı
 = 
NULL
;

1275 ià(*
__ı
 =ğ
__»jeù1
 || *__ı =ğ
__»jeù2
 || *__ı =ğ
__»jeù3
)

1277 *
__ı
++ = '\0';

1280 ++
__ı
;

1282 *
__s
 = 
__ı
;

1284  
__»tv®
;

1285 
	}
}

1286 #ifdeà
__USE_BSD


1287 
	#¡r£p
(
s
, 
»jeù
è
	`__¡r£p
 (s,„ejeù)

	)

1294 #ifdeà
__USE_MISC


1296 #ià!
defšed
 
_HAVE_STRING_ARCH_¡rdup
 || !defšed 
_HAVE_STRING_ARCH_¡ºdup


1297 
	#__Ãed_m®loc_ªd_ÿÎoc


	)

1298 
	~<¡dlib.h
>

1301 #iâdeà
_HAVE_STRING_ARCH_¡rdup


1303 *
	$__¡rdup
 (
__cÚ¡
 *
__¡ršg
è
__THROW
 
__©Œibu‹_m®loc__
;

1304 
	#__¡rdup
(
s
) \

1305 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
s
è&& 
	`__¡ršg2_1b±r_p
 (s) \

1306 ? (((
__cÚ¡
 *è(
s
))[0] == '\0' \

1307 ? (*è
	`ÿÎoc
 ((
size_t
) 1, (size_t) 1) \

1308 : ({ 
size_t
 
__Ën
 = 
	`¡¾’
 (
s
) + 1; \

1309 *
__»tv®
 = (*è
	`m®loc
 (
__Ën
); \

1310 ià(
__»tv®
 !ğ
NULL
) \

1311 
__»tv®
 = (*è
	`memıy
 (__»tv®, 
s
, 
__Ën
); \

1312 
__»tv®
; 
	}
})) \

1313 : 
	`__¡rdup
 (
s
)))

	)

1315 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED


1316 
	#¡rdup
(
s
è
	`__¡rdup
 (s)

	)

1320 #iâdeà
_HAVE_STRING_ARCH_¡ºdup


1322 *
	$__¡ºdup
 (
__cÚ¡
 *
__¡ršg
, 
size_t
 
__n
)

1323 
__THROW
 
__©Œibu‹_m®loc__
;

1324 
	#__¡ºdup
(
s
, 
n
) \

1325 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
s
è&& 
	`__¡ršg2_1b±r_p
 (s) \

1326 ? (((
__cÚ¡
 *è(
s
))[0] == '\0' \

1327 ? (*è
	`ÿÎoc
 ((
size_t
) 1, (size_t) 1) \

1328 : ({ 
size_t
 
__Ën
 = 
	`¡¾’
 (
s
) + 1; \

1329 
size_t
 
__n
 = (
n
); \

1330 *
__»tv®
; \

1331 ià(
__n
 < 
__Ën
) \

1332 
__Ën
 = 
__n
 + 1; \

1333 
__»tv®
 = (*è
	`m®loc
 (
__Ën
); \

1334 ià(
__»tv®
 !ğ
NULL
) \

1336 
__»tv®
[
__Ën
 - 1] = '\0'; \

1337 
__»tv®
 = (*è
	`memıy
 (__»tv®, 
s
, \

1338 
__Ën
 - 1); \

1340 
__»tv®
; 
	}
})) \

1341 : 
	`__¡ºdup
 (
s
, 
n
)))

	)

1343 #ifdeà
__USE_GNU


1344 
	#¡ºdup
(
s
, 
n
è
	`__¡ºdup
 (s,‚)

	)

1350 #iâdeà
_FORCE_INLINES


1351 #undeà
__STRING_INLINE


	@/usr/include/bits/string3.h

19 #iâdeà
_STRING_H


23 
__w¬ndeş
 (
__w¬n_mem£t_z”o_Ën
,

26 #iâdeà
__ılu¥lus


30 #undeà
memıy


31 #undeà
memmove


32 #undeà
mem£t


33 #undeà
¡rÿt


34 #undeà
¡rıy


35 #undeà
¡ºÿt


36 #undeà
¡ºıy


37 #ifdeà
__USE_GNU


38 #undeà
mempıy


39 #undeà
¡pıy


41 #ifdeà
__USE_BSD


42 #undeà
bcİy


43 #undeà
bz”o


48 
__ex‹º_®ways_šlše
 *

49 
__NTH
 (
	$memıy
 (*
__»¡riù
 
__de¡
, 
__cÚ¡
 *__»¡riù 
__¤c
,

50 
size_t
 
__Ën
))

52  
	`__butš___memıy_chk
 (
__de¡
, 
__¤c
, 
__Ën
, 
	`__bos0
 (__dest));

53 
	}
}

55 
__ex‹º_®ways_šlše
 *

56 
__NTH
 (
	$memmove
 (*
__de¡
, 
__cÚ¡
 *
__¤c
, 
size_t
 
__Ën
))

58  
	`__butš___memmove_chk
 (
__de¡
, 
__¤c
, 
__Ën
, 
	`__bos0
 (__dest));

59 
	}
}

61 #ifdeà
__USE_GNU


62 
__ex‹º_®ways_šlše
 *

63 
__NTH
 (
	$mempıy
 (*
__»¡riù
 
__de¡
, 
__cÚ¡
 *__»¡riù 
__¤c
,

64 
size_t
 
__Ën
))

66  
	`__butš___mempıy_chk
 (
__de¡
, 
__¤c
, 
__Ën
, 
	`__bos0
 (__dest));

67 
	}
}

76 
__ex‹º_®ways_šlše
 *

77 
__NTH
 (
	$mem£t
 (*
__de¡
, 
__ch
, 
size_t
 
__Ën
))

79 ià(
	`__butš_cÚ¡ªt_p
 (
__Ën
) && __len == 0

80 && (!
	`__butš_cÚ¡ªt_p
 (
__ch
) || __ch != 0))

82 
	`__w¬n_mem£t_z”o_Ën
 ();

83  
__de¡
;

85  
	`__butš___mem£t_chk
 (
__de¡
, 
__ch
, 
__Ën
, 
	`__bos0
 (__dest));

86 
	}
}

88 #ifdeà
__USE_BSD


89 
__ex‹º_®ways_šlše
 

90 
__NTH
 (
	$bcİy
 (
__cÚ¡
 *
__¤c
, *
__de¡
, 
size_t
 
__Ën
))

92 (è
	`__butš___memmove_chk
 (
__de¡
, 
__¤c
, 
__Ën
, 
	`__bos0
 (__dest));

93 
	}
}

95 
__ex‹º_®ways_šlše
 

96 
__NTH
 (
	$bz”o
 (*
__de¡
, 
size_t
 
__Ën
))

98 (è
	`__butš___mem£t_chk
 (
__de¡
, '\0', 
__Ën
, 
	`__bos0
 (__dest));

99 
	}
}

102 
__ex‹º_®ways_šlše
 *

103 
__NTH
 (
	$¡rıy
 (*
__»¡riù
 
__de¡
, 
__cÚ¡
 *__»¡riù 
__¤c
))

105  
	`__butš___¡rıy_chk
 (
__de¡
, 
__¤c
, 
	`__bos
 (__dest));

106 
	}
}

108 #ifdeà
__USE_GNU


109 
__ex‹º_®ways_šlše
 *

110 
__NTH
 (
	$¡pıy
 (*
__»¡riù
 
__de¡
, 
__cÚ¡
 *__»¡riù 
__¤c
))

112  
	`__butš___¡pıy_chk
 (
__de¡
, 
__¤c
, 
	`__bos
 (__dest));

113 
	}
}

117 
__ex‹º_®ways_šlše
 *

118 
__NTH
 (
	$¡ºıy
 (*
__»¡riù
 
__de¡
, 
__cÚ¡
 *__»¡riù 
__¤c
,

119 
size_t
 
__Ën
))

121  
	`__butš___¡ºıy_chk
 (
__de¡
, 
__¤c
, 
__Ën
, 
	`__bos
 (__dest));

122 
	}
}

125 *
	$__¡²ıy_chk
 (*
__de¡
, 
__cÚ¡
 *
__¤c
, 
size_t
 
__n
,

126 
size_t
 
__de¡Ën
è
__THROW
;

127 *
	`__REDIRECT_NTH
 (
__¡²ıy_®Ÿs
, (*
__de¡
,

128 
__cÚ¡
 *
__¤c
,

129 
size_t
 
__n
), 
¡²ıy
);

131 
__ex‹º_®ways_šlše
 *

132 
	`__NTH
 (
	$¡²ıy
 (*
__de¡
, 
__cÚ¡
 *
__¤c
, 
size_t
 
__n
))

134 ià(
	`__bos
 (
__de¡
è!ğ(
size_t
) -1

135 && (!
	`__butš_cÚ¡ªt_p
 (
__n
è|| __À<ğ
	`__bos
 (
__de¡
)))

136  
	`__¡²ıy_chk
 (
__de¡
, 
__¤c
, 
__n
, 
	`__bos
 (__dest));

137  
	`__¡²ıy_®Ÿs
 (
__de¡
, 
__¤c
, 
__n
);

138 
	}
}

141 
__ex‹º_®ways_šlše
 *

142 
__NTH
 (
	$¡rÿt
 (*
__»¡riù
 
__de¡
, 
__cÚ¡
 *__»¡riù 
__¤c
))

144  
	`__butš___¡rÿt_chk
 (
__de¡
, 
__¤c
, 
	`__bos
 (__dest));

145 
	}
}

148 
__ex‹º_®ways_šlše
 *

149 
__NTH
 (
	$¡ºÿt
 (*
__»¡riù
 
__de¡
, 
__cÚ¡
 *__»¡riù 
__¤c
,

150 
size_t
 
__Ën
))

152  
	`__butš___¡ºÿt_chk
 (
__de¡
, 
__¤c
, 
__Ën
, 
	`__bos
 (__dest));

153 
	}
}

	@/usr/include/bits/sys_errlist.h

20 #iâdeà
_STDIO_H


26 #ifdeà 
__USE_BSD


27 
sys_Ã¼
;

28 
__cÚ¡
 *__cÚ¡ 
sys_”¾i¡
[];

30 #ifdeà 
__USE_GNU


31 
_sys_Ã¼
;

32 
__cÚ¡
 *__cÚ¡ 
_sys_”¾i¡
[];

	@/usr/include/bits/types.h

24 #iâdef 
_BITS_TYPES_H


25 
	#_BITS_TYPES_H
 1

	)

27 
	~<ã©u»s.h
>

28 
	~<b™s/wÜdsize.h
>

31 
	t__u_ch¬
;

32 
	t__u_shÜt
;

33 
	t__u_št
;

34 
	t__u_lÚg
;

37 sigÃd 
	t__št8_t
;

38 
	t__ušt8_t
;

39 sigÃd 
	t__št16_t
;

40 
	t__ušt16_t
;

41 sigÃd 
	t__št32_t
;

42 
	t__ušt32_t
;

43 #ià
__WORDSIZE
 == 64

44 sigÃd 
	t__št64_t
;

45 
	t__ušt64_t
;

46 #–ià
defšed
 
__GLIBC_HAVE_LONG_LONG


47 
__ex‹nsiÚ__
 sigÃd 
	t__št64_t
;

48 
__ex‹nsiÚ__
 
	t__ušt64_t
;

52 #ià
__WORDSIZE
 == 64

53 
	t__quad_t
;

54 
	t__u_quad_t
;

55 #–ià
defšed
 
__GLIBC_HAVE_LONG_LONG


56 
__ex‹nsiÚ__
 
	t__quad_t
;

57 
__ex‹nsiÚ__
 
	t__u_quad_t
;

61 
	m__v®
[2];

62 } 
	t__quad_t
;

65 
__u_lÚg
 
	m__v®
[2];

66 } 
	t__u_quad_t
;

99 
	#__S16_TYPE
 

	)

100 
	#__U16_TYPE
 

	)

101 
	#__S32_TYPE
 

	)

102 
	#__U32_TYPE
 

	)

103 
	#__SLONGWORD_TYPE
 

	)

104 
	#__ULONGWORD_TYPE
 

	)

105 #ià
__WORDSIZE
 == 32

106 
	#__SQUAD_TYPE
 
__quad_t


	)

107 
	#__UQUAD_TYPE
 
__u_quad_t


	)

108 
	#__SWORD_TYPE
 

	)

109 
	#__UWORD_TYPE
 

	)

110 
	#__SLONG32_TYPE
 

	)

111 
	#__ULONG32_TYPE
 

	)

112 
	#__S64_TYPE
 
__quad_t


	)

113 
	#__U64_TYPE
 
__u_quad_t


	)

116 
	#__STD_TYPE
 
__ex‹nsiÚ__
 

	)

117 #–ià
__WORDSIZE
 == 64

118 
	t__SQUAD_TYPE
 

	)

119 
	t__UQUAD_TYPE
 

	)

120 
	t__SWORD_TYPE
 

	)

121 
	t__UWORD_TYPE
 

	)

122 
	t__SLONG32_TYPE
 

	)

123 
	t__ULONG32_TYPE
 

	)

124 
	t__S64_TYPE
 

	)

125 
	t__U64_TYPE
 

	)

127 
	t__STD_TYPE
 

	)

131 
	~<b™s/ty³sizes.h
>

134 
__STD_TYPE
 
	t__DEV_T_TYPE
 
	t__dev_t
;

135 
__STD_TYPE
 
__UID_T_TYPE
 
	g__uid_t
;

136 
__STD_TYPE
 
__GID_T_TYPE
 
	g__gid_t
;

137 
__STD_TYPE
 
__INO_T_TYPE
 
	g__šo_t
;

138 
__STD_TYPE
 
__INO64_T_TYPE
 
	g__šo64_t
;

139 
__STD_TYPE
 
__MODE_T_TYPE
 
	g__mode_t
;

140 
__STD_TYPE
 
__NLINK_T_TYPE
 
	g__Æšk_t
;

141 
__STD_TYPE
 
__OFF_T_TYPE
 
	g__off_t
;

142 
__STD_TYPE
 
__OFF64_T_TYPE
 
	g__off64_t
;

143 
__STD_TYPE
 
__PID_T_TYPE
 
	g__pid_t
;

144 
__STD_TYPE
 
__FSID_T_TYPE
 
	g__fsid_t
;

145 
__STD_TYPE
 
__CLOCK_T_TYPE
 
	g__şock_t
;

146 
__STD_TYPE
 
__RLIM_T_TYPE
 
	g__¾im_t
;

147 
__STD_TYPE
 
__RLIM64_T_TYPE
 
	g__¾im64_t
;

148 
__STD_TYPE
 
__ID_T_TYPE
 
	g__id_t
;

149 
__STD_TYPE
 
__TIME_T_TYPE
 
	g__time_t
;

150 
__STD_TYPE
 
__USECONDS_T_TYPE
 
	g__u£cÚds_t
;

151 
__STD_TYPE
 
__SUSECONDS_T_TYPE
 
	g__su£cÚds_t
;

153 
__STD_TYPE
 
__DADDR_T_TYPE
 
	g__daddr_t
;

154 
__STD_TYPE
 
__SWBLK_T_TYPE
 
	g__swblk_t
;

155 
__STD_TYPE
 
__KEY_T_TYPE
 
	g__key_t
;

158 
__STD_TYPE
 
__CLOCKID_T_TYPE
 
	g__şockid_t
;

161 
__STD_TYPE
 
__TIMER_T_TYPE
 
	g__tim”_t
;

164 
__STD_TYPE
 
__BLKSIZE_T_TYPE
 
	g__blksize_t
;

169 
__STD_TYPE
 
__BLKCNT_T_TYPE
 
	g__blkút_t
;

170 
__STD_TYPE
 
__BLKCNT64_T_TYPE
 
	g__blkút64_t
;

173 
__STD_TYPE
 
__FSBLKCNT_T_TYPE
 
	g__fsblkút_t
;

174 
__STD_TYPE
 
__FSBLKCNT64_T_TYPE
 
	g__fsblkút64_t
;

177 
__STD_TYPE
 
__FSFILCNT_T_TYPE
 
	g__fsfút_t
;

178 
__STD_TYPE
 
__FSFILCNT64_T_TYPE
 
	g__fsfút64_t
;

180 
__STD_TYPE
 
__SSIZE_T_TYPE
 
	g__ssize_t
;

184 
__off64_t
 
	t__loff_t
;

185 
__quad_t
 *
	t__qaddr_t
;

186 *
	t__ÿddr_t
;

189 
__STD_TYPE
 
__SWORD_TYPE
 
	g__šŒ_t
;

192 
__STD_TYPE
 
__U32_TYPE
 
	g__sockËn_t
;

195 #undeà
__STD_TYPE


	@/usr/include/bits/unistd.h

20 #iâdeà
_UNISTD_H


24 
ssize_t
 
	$__»ad_chk
 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
,

25 
size_t
 
__buæ’
è
__wur
;

26 
ssize_t
 
	`__REDIRECT
 (
__»ad_®Ÿs
, (
__fd
, *
__buf
,

27 
size_t
 
__nby‹s
), 
»ad
è
__wur
;

28 
ssize_t
 
	`__REDIRECT
 (
__»ad_chk_w¬n
,

29 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
,

30 
size_t
 
__buæ’
), 
__»ad_chk
)

31 
__wur
 
	`__w¬Ç‰r
 ("read called with bigger†engthhan size of "

34 
__ex‹º_®ways_šlše
 
__wur
 
ssize_t


35 
	$»ad
 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
)

37 ià(
	`__bos0
 (
__buf
è!ğ(
size_t
) -1)

39 ià(!
	`__butš_cÚ¡ªt_p
 (
__nby‹s
))

40  
	`__»ad_chk
 (
__fd
, 
__buf
, 
__nby‹s
, 
	`__bos0
 (__buf));

42 ià(
__nby‹s
 > 
	`__bos0
 (
__buf
))

43  
	`__»ad_chk_w¬n
 (
__fd
, 
__buf
, 
__nby‹s
, 
	`__bos0
 (__buf));

45  
	`__»ad_®Ÿs
 (
__fd
, 
__buf
, 
__nby‹s
);

46 
	}
}

48 #ifdeà
__USE_UNIX98


49 
ssize_t
 
	$__´—d_chk
 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
,

50 
__off_t
 
__off£t
, 
size_t
 
__bufsize
è
__wur
;

51 
ssize_t
 
	$__´—d64_chk
 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
,

52 
__off64_t
 
__off£t
, 
size_t
 
__bufsize
è
__wur
;

53 
ssize_t
 
	`__REDIRECT
 (
__´—d_®Ÿs
,

54 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
,

55 
__off_t
 
__off£t
), 
´—d
è
__wur
;

56 
ssize_t
 
	`__REDIRECT
 (
__´—d64_®Ÿs
,

57 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
,

58 
__off64_t
 
__off£t
), 
´—d64
è
__wur
;

59 
ssize_t
 
	`__REDIRECT
 (
__´—d_chk_w¬n
,

60 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
,

61 
__off_t
 
__off£t
, 
size_t
 
__bufsize
), 
__´—d_chk
)

62 
__wur
 
	`__w¬Ç‰r
 ("pread called with bigger†engthhan size of "

64 
ssize_t
 
	`__REDIRECT
 (
__´—d64_chk_w¬n
,

65 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
,

66 
__off64_t
 
__off£t
, 
size_t
 
__bufsize
),

67 
__´—d64_chk
)

68 
__wur
 
	`__w¬Ç‰r
 ("pread64 called with bigger†engthhan size of "

71 #iâdeà
__USE_FILE_OFFSET64


72 
__ex‹º_®ways_šlše
 
__wur
 
ssize_t


73 
	$´—d
 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
, 
__off_t
 
__off£t
)

75 ià(
	`__bos0
 (
__buf
è!ğ(
size_t
) -1)

77 ià(!
	`__butš_cÚ¡ªt_p
 (
__nby‹s
))

78  
	`__´—d_chk
 (
__fd
, 
__buf
, 
__nby‹s
, 
__off£t
, 
	`__bos0
 (__buf));

80 iàĞ
__nby‹s
 > 
	`__bos0
 (
__buf
))

81  
	`__´—d_chk_w¬n
 (
__fd
, 
__buf
, 
__nby‹s
, 
__off£t
,

82 
	`__bos0
 (
__buf
));

84  
	`__´—d_®Ÿs
 (
__fd
, 
__buf
, 
__nby‹s
, 
__off£t
);

85 
	}
}

87 
__ex‹º_®ways_šlše
 
__wur
 
ssize_t


88 
	$´—d
 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
, 
__off64_t
 
__off£t
)

90 ià(
	`__bos0
 (
__buf
è!ğ(
size_t
) -1)

92 ià(!
	`__butš_cÚ¡ªt_p
 (
__nby‹s
))

93  
	`__´—d64_chk
 (
__fd
, 
__buf
, 
__nby‹s
, 
__off£t
, 
	`__bos0
 (__buf));

95 iàĞ
__nby‹s
 > 
	`__bos0
 (
__buf
))

96  
	`__´—d64_chk_w¬n
 (
__fd
, 
__buf
, 
__nby‹s
, 
__off£t
,

97 
	`__bos0
 (
__buf
));

100  
	`__´—d64_®Ÿs
 (
__fd
, 
__buf
, 
__nby‹s
, 
__off£t
);

101 
	}
}

104 #ifdeà
__USE_LARGEFILE64


105 
__ex‹º_®ways_šlše
 
__wur
 
ssize_t


106 
	$´—d64
 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
, 
__off64_t
 
__off£t
)

108 ià(
	`__bos0
 (
__buf
è!ğ(
size_t
) -1)

110 ià(!
	`__butš_cÚ¡ªt_p
 (
__nby‹s
))

111  
	`__´—d64_chk
 (
__fd
, 
__buf
, 
__nby‹s
, 
__off£t
, 
	`__bos0
 (__buf));

113 iàĞ
__nby‹s
 > 
	`__bos0
 (
__buf
))

114  
	`__´—d64_chk_w¬n
 (
__fd
, 
__buf
, 
__nby‹s
, 
__off£t
,

115 
	`__bos0
 (
__buf
));

118  
	`__´—d64_®Ÿs
 (
__fd
, 
__buf
, 
__nby‹s
, 
__off£t
);

119 
	}
}

123 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K


124 
ssize_t
 
	$__»adlšk_chk
 (
__cÚ¡
 *
__»¡riù
 
__·th
,

125 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
,

126 
size_t
 
__buæ’
)

127 
__THROW
 
	`__nÚnuÎ
 ((1, 2)è
__wur
;

128 
ssize_t
 
	`__REDIRECT_NTH
 (
__»adlšk_®Ÿs
,

129 (
__cÚ¡
 *
__»¡riù
 
__·th
,

130 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
), 
»adlšk
)

131 
	`__nÚnuÎ
 ((1, 2)è
__wur
;

132 
ssize_t
 
	`__REDIRECT_NTH
 (
__»adlšk_chk_w¬n
,

133 (
__cÚ¡
 *
__»¡riù
 
__·th
,

134 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
,

135 
size_t
 
__buæ’
), 
__»adlšk_chk
)

136 
	`__nÚnuÎ
 ((1, 2)è
__wur
 
	`__w¬Ç‰r
 ("readlink called with bigger†ength "

139 
__ex‹º_®ways_šlše
 
	`__nÚnuÎ
 ((1, 2)è
__wur
 
ssize_t


140 
	`__NTH
 (
	$»adlšk
 (
__cÚ¡
 *
__»¡riù
 
__·th
, *__»¡riù 
__buf
,

141 
size_t
 
__Ën
))

143 ià(
	`__bos
 (
__buf
è!ğ(
size_t
) -1)

145 ià(!
	`__butš_cÚ¡ªt_p
 (
__Ën
))

146  
	`__»adlšk_chk
 (
__·th
, 
__buf
, 
__Ën
, 
	`__bos
 (__buf));

148 iàĞ
__Ën
 > 
	`__bos
 (
__buf
))

149  
	`__»adlšk_chk_w¬n
 (
__·th
, 
__buf
, 
__Ën
, 
	`__bos
 (__buf));

151  
	`__»adlšk_®Ÿs
 (
__·th
, 
__buf
, 
__Ën
);

152 
	}
}

155 #ifdeà
__USE_ATFILE


156 
ssize_t
 
	$__»adlšk©_chk
 (
__fd
, 
__cÚ¡
 *
__»¡riù
 
__·th
,

157 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
,

158 
size_t
 
__buæ’
)

159 
__THROW
 
	`__nÚnuÎ
 ((2, 3)è
__wur
;

160 
ssize_t
 
	`__REDIRECT_NTH
 (
__»adlšk©_®Ÿs
,

161 (
__fd
, 
__cÚ¡
 *
__»¡riù
 
__·th
,

162 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
),

163 
»adlšk©
)

164 
	`__nÚnuÎ
 ((2, 3)è
__wur
;

165 
ssize_t
 
	`__REDIRECT_NTH
 (
__»adlšk©_chk_w¬n
,

166 (
__fd
, 
__cÚ¡
 *
__»¡riù
 
__·th
,

167 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
,

168 
size_t
 
__buæ’
), 
__»adlšk©_chk
)

169 
	`__nÚnuÎ
 ((2, 3)è
__wur
 
	`__w¬Ç‰r
 ("readlinkat called with bigger "

173 
__ex‹º_®ways_šlše
 
	`__nÚnuÎ
 ((2, 3)è
__wur
 
ssize_t


174 
	`__NTH
 (
	$»adlšk©
 (
__fd
, 
__cÚ¡
 *
__»¡riù
 
__·th
,

175 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
))

177 ià(
	`__bos
 (
__buf
è!ğ(
size_t
) -1)

179 ià(!
	`__butš_cÚ¡ªt_p
 (
__Ën
))

180  
	`__»adlšk©_chk
 (
__fd
, 
__·th
, 
__buf
, 
__Ën
, 
	`__bos
 (__buf));

182 ià(
__Ën
 > 
	`__bos
 (
__buf
))

183  
	`__»adlšk©_chk_w¬n
 (
__fd
, 
__·th
, 
__buf
, 
__Ën
,

184 
	`__bos
 (
__buf
));

186  
	`__»adlšk©_®Ÿs
 (
__fd
, 
__·th
, 
__buf
, 
__Ën
);

187 
	}
}

190 *
	$__g‘cwd_chk
 (*
__buf
, 
size_t
 
__size
, size_ˆ
__buæ’
)

191 
__THROW
 
__wur
;

192 *
	`__REDIRECT_NTH
 (
__g‘cwd_®Ÿs
,

193 (*
__buf
, 
size_t
 
__size
), 
g‘cwd
è
__wur
;

194 *
	`__REDIRECT_NTH
 (
__g‘cwd_chk_w¬n
,

195 (*
__buf
, 
size_t
 
__size
, size_ˆ
__buæ’
),

196 
__g‘cwd_chk
)

197 
__wur
 
	`__w¬Ç‰r
 ("getcwd caller with bigger†engthhan size of "

200 
__ex‹º_®ways_šlše
 
__wur
 *

201 
	`__NTH
 (
	$g‘cwd
 (*
__buf
, 
size_t
 
__size
))

203 ià(
	`__bos
 (
__buf
è!ğ(
size_t
) -1)

205 ià(!
	`__butš_cÚ¡ªt_p
 (
__size
))

206  
	`__g‘cwd_chk
 (
__buf
, 
__size
, 
	`__bos
 (__buf));

208 ià(
__size
 > 
	`__bos
 (
__buf
))

209  
	`__g‘cwd_chk_w¬n
 (
__buf
, 
__size
, 
	`__bos
 (__buf));

211  
	`__g‘cwd_®Ÿs
 (
__buf
, 
__size
);

212 
	}
}

214 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED


215 *
	$__g‘wd_chk
 (*
__buf
, 
size_t
 
buæ’
)

216 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

217 *
	`__REDIRECT_NTH
 (
__g‘wd_w¬n
, (*
__buf
), 
g‘wd
)

218 
	`__nÚnuÎ
 ((1)è
__wur
 
	`__w¬Ç‰r
 ("please use getcwd instead,‡s getwd "

221 
__ex‹º_®ways_šlše
 
	`__nÚnuÎ
 ((1)è
__©Œibu‹_d•»ÿ‹d__
 
__wur
 *

222 
	`__NTH
 (
	$g‘wd
 (*
__buf
))

224 ià(
	`__bos
 (
__buf
è!ğ(
size_t
) -1)

225  
	`__g‘wd_chk
 (
__buf
, 
	`__bos
 (__buf));

226  
	`__g‘wd_w¬n
 (
__buf
);

227 
	}
}

230 
size_t
 
	$__cÚf¡r_chk
 (
__Çme
, *
__buf
, 
size_t
 
__Ën
,

231 
size_t
 
__buæ’
è
__THROW
;

232 
size_t
 
	`__REDIRECT_NTH
 (
__cÚf¡r_®Ÿs
, (
__Çme
, *
__buf
,

233 
size_t
 
__Ën
), 
cÚf¡r
);

234 
size_t
 
	`__REDIRECT_NTH
 (
__cÚf¡r_chk_w¬n
,

235 (
__Çme
, *
__buf
, 
size_t
 
__Ën
,

236 
size_t
 
__buæ’
), 
__cÚf¡r_chk
)

237 
	`__w¬Ç‰r
 ("confstr called with bigger†engthhan size of destination "

240 
__ex‹º_®ways_šlše
 
size_t


241 
	`__NTH
 (
	$cÚf¡r
 (
__Çme
, *
__buf
, 
size_t
 
__Ën
))

243 ià(
	`__bos
 (
__buf
è!ğ(
size_t
) -1)

245 ià(!
	`__butš_cÚ¡ªt_p
 (
__Ën
))

246  
	`__cÚf¡r_chk
 (
__Çme
, 
__buf
, 
__Ën
, 
	`__bos
 (__buf));

248 ià(
	`__bos
 (
__buf
è< 
__Ën
)

249  
	`__cÚf¡r_chk_w¬n
 (
__Çme
, 
__buf
, 
__Ën
, 
	`__bos
 (__buf));

251  
	`__cÚf¡r_®Ÿs
 (
__Çme
, 
__buf
, 
__Ën
);

252 
	}
}

255 
	$__g‘groups_chk
 (
__size
, 
__gid_t
 
__li¡
[], 
size_t
 
__li¡Ën
)

256 
__THROW
 
__wur
;

257 
	`__REDIRECT_NTH
 (
__g‘groups_®Ÿs
, (
__size
, 
__gid_t
 
__li¡
[]),

258 
g‘groups
è
__wur
;

259 
	`__REDIRECT_NTH
 (
__g‘groups_chk_w¬n
,

260 (
__size
, 
__gid_t
 
__li¡
[], 
size_t
 
__li¡Ën
),

261 
__g‘groups_chk
)

262 
__wur
 
	`__w¬Ç‰r
 ("getgroups called with bigger group counthan what "

265 
__ex‹º_®ways_šlše
 

266 
	`__NTH
 (
	$g‘groups
 (
__size
, 
__gid_t
 
__li¡
[]))

268 ià(
	`__bos
 (
__li¡
è!ğ(
size_t
) -1)

270 ià(!
	`__butš_cÚ¡ªt_p
 (
__size
) || __size < 0)

271  
	`__g‘groups_chk
 (
__size
, 
__li¡
, 
	`__bos
 (__list));

273 ià(
__size
 *  (
__gid_t
è> 
	`__bos
 (
__li¡
))

274  
	`__g‘groups_chk_w¬n
 (
__size
, 
__li¡
, 
	`__bos
 (__list));

276  
	`__g‘groups_®Ÿs
 (
__size
, 
__li¡
);

277 
	}
}

280 
	$__‰yÇme_r_chk
 (
__fd
, *
__buf
, 
size_t
 
__buæ’
,

281 
size_t
 
__Ä—l
è
__THROW
 
	`__nÚnuÎ
 ((2));

282 
	`__REDIRECT_NTH
 (
__‰yÇme_r_®Ÿs
, (
__fd
, *
__buf
,

283 
size_t
 
__buæ’
), 
‰yÇme_r
)

284 
	`__nÚnuÎ
 ((2));

285 
	`__REDIRECT_NTH
 (
__‰yÇme_r_chk_w¬n
,

286 (
__fd
, *
__buf
, 
size_t
 
__buæ’
,

287 
size_t
 
__Ä—l
), 
__‰yÇme_r_chk
)

288 
	`__nÚnuÎ
 ((2)è
	`__w¬Ç‰r
 ("ttyname_r called with bigger buflenhan "

291 
__ex‹º_®ways_šlše
 

292 
	`__NTH
 (
	$‰yÇme_r
 (
__fd
, *
__buf
, 
size_t
 
__buæ’
))

294 ià(
	`__bos
 (
__buf
è!ğ(
size_t
) -1)

296 ià(!
	`__butš_cÚ¡ªt_p
 (
__buæ’
))

297  
	`__‰yÇme_r_chk
 (
__fd
, 
__buf
, 
__buæ’
, 
	`__bos
 (__buf));

299 ià(
__buæ’
 > 
	`__bos
 (
__buf
))

300  
	`__‰yÇme_r_chk_w¬n
 (
__fd
, 
__buf
, 
__buæ’
, 
	`__bos
 (__buf));

302  
	`__‰yÇme_r_®Ÿs
 (
__fd
, 
__buf
, 
__buæ’
);

303 
	}
}

306 #ià
defšed
 
__USE_REENTRANT
 || defšed 
__USE_POSIX199506


307 
	$__g‘logš_r_chk
 (*
__buf
, 
size_t
 
__buæ’
, size_ˆ
__Ä—l
)

308 
	`__nÚnuÎ
 ((1));

309 
	`__REDIRECT
 (
__g‘logš_r_®Ÿs
, (*
__buf
, 
size_t
 
__buæ’
),

310 
g‘logš_r
è
	`__nÚnuÎ
 ((1));

311 
	`__REDIRECT
 (
__g‘logš_r_chk_w¬n
,

312 (*
__buf
, 
size_t
 
__buæ’
, size_ˆ
__Ä—l
),

313 
__g‘logš_r_chk
)

314 
	`__nÚnuÎ
 ((1)è
	`__w¬Ç‰r
 ("getlogin_r called with bigger buflenhan "

317 
__ex‹º_®ways_šlše
 

318 
	$g‘logš_r
 (*
__buf
, 
size_t
 
__buæ’
)

320 ià(
	`__bos
 (
__buf
è!ğ(
size_t
) -1)

322 ià(!
	`__butš_cÚ¡ªt_p
 (
__buæ’
))

323  
	`__g‘logš_r_chk
 (
__buf
, 
__buæ’
, 
	`__bos
 (__buf));

325 ià(
__buæ’
 > 
	`__bos
 (
__buf
))

326  
	`__g‘logš_r_chk_w¬n
 (
__buf
, 
__buæ’
, 
	`__bos
 (__buf));

328  
	`__g‘logš_r_®Ÿs
 (
__buf
, 
__buæ’
);

329 
	}
}

333 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_UNIX98


334 
	$__g‘ho¡Çme_chk
 (*
__buf
, 
size_t
 
__buæ’
, size_ˆ
__Ä—l
)

335 
__THROW
 
	`__nÚnuÎ
 ((1));

336 
	`__REDIRECT_NTH
 (
__g‘ho¡Çme_®Ÿs
, (*
__buf
, 
size_t
 
__buæ’
),

337 
g‘ho¡Çme
è
	`__nÚnuÎ
 ((1));

338 
	`__REDIRECT_NTH
 (
__g‘ho¡Çme_chk_w¬n
,

339 (*
__buf
, 
size_t
 
__buæ’
, size_ˆ
__Ä—l
),

340 
__g‘ho¡Çme_chk
)

341 
	`__nÚnuÎ
 ((1)è
	`__w¬Ç‰r
 ("gethostname called with bigger buflenhan "

344 
__ex‹º_®ways_šlše
 

345 
	`__NTH
 (
	$g‘ho¡Çme
 (*
__buf
, 
size_t
 
__buæ’
))

347 ià(
	`__bos
 (
__buf
è!ğ(
size_t
) -1)

349 ià(!
	`__butš_cÚ¡ªt_p
 (
__buæ’
))

350  
	`__g‘ho¡Çme_chk
 (
__buf
, 
__buæ’
, 
	`__bos
 (__buf));

352 ià(
__buæ’
 > 
	`__bos
 (
__buf
))

353  
	`__g‘ho¡Çme_chk_w¬n
 (
__buf
, 
__buæ’
, 
	`__bos
 (__buf));

355  
	`__g‘ho¡Çme_®Ÿs
 (
__buf
, 
__buæ’
);

356 
	}
}

360 #ià
defšed
 
__USE_BSD
 || (defšed 
__USE_XOPEN
 && !defšed 
__USE_UNIX98
)

361 
	$__g‘domašÇme_chk
 (*
__buf
, 
size_t
 
__buæ’
, size_ˆ
__Ä—l
)

362 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

363 
	`__REDIRECT_NTH
 (
__g‘domašÇme_®Ÿs
, (*
__buf
,

364 
size_t
 
__buæ’
),

365 
g‘domašÇme
è
	`__nÚnuÎ
 ((1)è
__wur
;

366 
	`__REDIRECT_NTH
 (
__g‘domašÇme_chk_w¬n
,

367 (*
__buf
, 
size_t
 
__buæ’
, size_ˆ
__Ä—l
),

368 
__g‘domašÇme_chk
)

369 
	`__nÚnuÎ
 ((1)è
__wur
 
	`__w¬Ç‰r
 ("getdomainname called with bigger "

373 
__ex‹º_®ways_šlše
 

374 
	`__NTH
 (
	$g‘domašÇme
 (*
__buf
, 
size_t
 
__buæ’
))

376 ià(
	`__bos
 (
__buf
è!ğ(
size_t
) -1)

378 ià(!
	`__butš_cÚ¡ªt_p
 (
__buæ’
))

379  
	`__g‘domašÇme_chk
 (
__buf
, 
__buæ’
, 
	`__bos
 (__buf));

381 ià(
__buæ’
 > 
	`__bos
 (
__buf
))

382  
	`__g‘domašÇme_chk_w¬n
 (
__buf
, 
__buæ’
, 
	`__bos
 (__buf));

384  
	`__g‘domašÇme_®Ÿs
 (
__buf
, 
__buæ’
);

385 
	}
}

	@/usr/include/bits/waitflags.h

20 #ià!
defšed
 
_SYS_WAIT_H
 && !defšed 
_STDLIB_H


26 
	#WNOHANG
 1

	)

27 
	#WUNTRACED
 2

	)

30 
	#WSTOPPED
 2

	)

31 
	#WEXITED
 4

	)

32 
	#WCONTINUED
 8

	)

33 
	#WNOWAIT
 0x01000000

	)

35 
	#__WNOTHREAD
 0x20000000

	)

37 
	#__WALL
 0x40000000

	)

38 
	#__WCLONE
 0x80000000

	)

	@/usr/include/bits/waitstatus.h

20 #ià!
defšed
 
_SYS_WAIT_H
 && !defšed 
_STDLIB_H


29 
	#__WEXITSTATUS
(
¡©us
è(((¡©usè& 0xff00è>> 8)

	)

32 
	#__WTERMSIG
(
¡©us
è((¡©usè& 0x7f)

	)

35 
	#__WSTOPSIG
(
¡©us
è
	`__WEXITSTATUS
(¡©us)

	)

38 
	#__WIFEXITED
(
¡©us
è(
	`__WTERMSIG
(¡©usè=ğ0)

	)

41 
	#__WIFSIGNALED
(
¡©us
) \

42 (((sigÃd è(((
¡©us
è& 0x7fè+ 1è>> 1è> 0)

	)

45 
	#__WIFSTOPPED
(
¡©us
è(((¡©usè& 0xffè=ğ0x7f)

	)

49 #ifdeà
WCONTINUED


50 
	#__WIFCONTINUED
(
¡©us
è((¡©usè=ğ
__W_CONTINUED
)

	)

54 
	#__WCOREDUMP
(
¡©us
è((¡©usè& 
__WCOREFLAG
)

	)

57 
	#__W_EXITCODE
(
»t
, 
sig
è(Ô‘è<< 8 | (sig))

	)

58 
	#__W_STOPCODE
(
sig
è((sigè<< 8 | 0x7f)

	)

59 
	#__W_CONTINUED
 0xffff

	)

60 
	#__WCOREFLAG
 0x80

	)

63 #ifdef 
__USE_BSD


65 
	~<’dŸn.h
>

67 
	uwa™


69 
	mw_¡©us
;

72 #if 
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN


73 
	m__w_‹rmsig
:7;

74 
	m__w_cÜedump
:1;

75 
	m__w_»tcode
:8;

78 #if 
__BYTE_ORDER
 =ğ
__BIG_ENDIAN


80 
	m__w_»tcode
:8;

81 
	m__w_cÜedump
:1;

82 
	m__w_‹rmsig
:7;

84 } 
	m__wa™_‹rmš©ed
;

87 #if 
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN


88 
	m__w_¡İv®
:8;

89 
	m__w_¡İsig
:8;

92 #if 
__BYTE_ORDER
 =ğ
__BIG_ENDIAN


94 
	m__w_¡İsig
:8;

95 
	m__w_¡İv®
:8;

97 } 
	m__wa™_¡İ³d
;

100 
	#w_‹rmsig
 
__wa™_‹rmš©ed
.
__w_‹rmsig


	)

101 
	#w_cÜedump
 
__wa™_‹rmš©ed
.
__w_cÜedump


	)

102 
	#w_»tcode
 
__wa™_‹rmš©ed
.
__w_»tcode


	)

103 
	#w_¡İsig
 
__wa™_¡İ³d
.
__w_¡İsig


	)

104 
	#w_¡İv®
 
__wa™_¡İ³d
.
__w_¡İv®


	)

	@/usr/include/bits/wchar.h

20 #iâdeà
_BITS_WCHAR_H


21 
	#_BITS_WCHAR_H
 1

	)

23 
	#__WCHAR_MIN
 (-2147483647 - 1)

	)

24 
	#__WCHAR_MAX
 (2147483647)

	)

	@/usr/include/bits/wordsize.h

3 #ià
defšed
 
__x86_64__


4 
	#__WORDSIZE
 64

	)

5 
	#__WORDSIZE_COMPAT32
 1

	)

7 
	#__WORDSIZE
 32

	)

	@/usr/include/endian.h

19 #iâdef 
_ENDIAN_H


20 
	#_ENDIAN_H
 1

	)

22 
	~<ã©u»s.h
>

32 
	#__LITTLE_ENDIAN
 1234

	)

33 
	#__BIG_ENDIAN
 4321

	)

34 
	#__PDP_ENDIAN
 3412

	)

37 
	~<b™s/’dŸn.h
>

41 #iâdeà
__FLOAT_WORD_ORDER


42 
	#__FLOAT_WORD_ORDER
 
__BYTE_ORDER


	)

45 #ifdef 
__USE_BSD


46 
	#LITTLE_ENDIAN
 
__LITTLE_ENDIAN


	)

47 
	#BIG_ENDIAN
 
__BIG_ENDIAN


	)

48 
	#PDP_ENDIAN
 
__PDP_ENDIAN


	)

49 
	#BYTE_ORDER
 
__BYTE_ORDER


	)

52 #ià
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN


53 
	#__LONG_LONG_PAIR
(
HI
, 
LO
èLO, 
	)
HI

54 #–ià
__BYTE_ORDER
 =ğ
__BIG_ENDIAN


55 
	#__LONG_LONG_PAIR
(
HI
, 
LO
èHI, 
	)
LO

59 #ifdeà
__USE_BSD


61 
	~<b™s/by‹sw­.h
>

63 #ià
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN


64 
	#htobe16
(
x
è
	`__bsw­_16
 (x)

	)

65 
	#htŞe16
(
x
è(x)

	)

66 
	#be16toh
(
x
è
	`__bsw­_16
 (x)

	)

67 
	#Ë16toh
(
x
è(x)

	)

69 
	#htobe32
(
x
è
	`__bsw­_32
 (x)

	)

70 
	#htŞe32
(
x
è(x)

	)

71 
	#be32toh
(
x
è
	`__bsw­_32
 (x)

	)

72 
	#Ë32toh
(
x
è(x)

	)

74 
	#htobe64
(
x
è
	`__bsw­_64
 (x)

	)

75 
	#htŞe64
(
x
è(x)

	)

76 
	#be64toh
(
x
è
	`__bsw­_64
 (x)

	)

77 
	#Ë64toh
(
x
è(x)

	)

79 
	#htobe16
(
x
è(x)

	)

80 
	#htŞe16
(
x
è
	`__bsw­_16
 (x)

	)

81 
	#be16toh
(
x
è(x)

	)

82 
	#Ë16toh
(
x
è
	`__bsw­_16
 (x)

	)

84 
	#htobe32
(
x
è(x)

	)

85 
	#htŞe32
(
x
è
	`__bsw­_32
 (x)

	)

86 
	#be32toh
(
x
è(x)

	)

87 
	#Ë32toh
(
x
è
	`__bsw­_32
 (x)

	)

89 
	#htobe64
(
x
è(x)

	)

90 
	#htŞe64
(
x
è
	`__bsw­_64
 (x)

	)

91 
	#be64toh
(
x
è(x)

	)

92 
	#Ë64toh
(
x
è
	`__bsw­_64
 (x)

	)

	@/usr/include/features.h

19 #iâdef 
_FEATURES_H


20 
	#_FEATURES_H
 1

	)

96 #undeà
__USE_ISOC99


97 #undeà
__USE_ISOC95


98 #undeà
__USE_POSIX


99 #undeà
__USE_POSIX2


100 #undeà
__USE_POSIX199309


101 #undeà
__USE_POSIX199506


102 #undeà
__USE_XOPEN


103 #undeà
__USE_XOPEN_EXTENDED


104 #undeà
__USE_UNIX98


105 #undeà
__USE_XOPEN2K


106 #undeà
__USE_XOPEN2KXSI


107 #undeà
__USE_XOPEN2K8


108 #undeà
__USE_XOPEN2K8XSI


109 #undeà
__USE_LARGEFILE


110 #undeà
__USE_LARGEFILE64


111 #undeà
__USE_FILE_OFFSET64


112 #undeà
__USE_BSD


113 #undeà
__USE_SVID


114 #undeà
__USE_MISC


115 #undeà
__USE_ATFILE


116 #undeà
__USE_GNU


117 #undeà
__USE_REENTRANT


118 #undeà
__USE_FORTIFY_LEVEL


119 #undeà
__FAVOR_BSD


120 #undeà
__KERNEL_STRICT_NAMES


124 #iâdeà
_LOOSE_KERNEL_NAMES


125 
	#__KERNEL_STRICT_NAMES


	)

129 
	#__USE_ANSI
 1

	)

138 #ià
defšed
 
__GNUC__
 && defšed 
__GNUC_MINOR__


139 
	#__GNUC_PREREQ
(
maj
, 
mš
) \

140 ((
__GNUC__
 << 16è+ 
__GNUC_MINOR__
 >ğ((
maj
è<< 16è+ (
mš
))

	)

142 
	#__GNUC_PREREQ
(
maj
, 
mš
è0

	)

147 #ià
defšed
 
_BSD_SOURCE
 && \

148 !(
defšed
 
	g_POSIX_SOURCE
 || defšed 
	g_POSIX_C_SOURCE
 || \

149 
defšed
 
	g_XOPEN_SOURCE
 || defšed 
	g_GNU_SOURCE
 || defšed 
	g_SVID_SOURCE
)

150 
	#__FAVOR_BSD
 1

	)

154 #ifdeà
_GNU_SOURCE


155 #undeà
_ISOC95_SOURCE


156 
	#_ISOC95_SOURCE
 1

	)

157 #undeà
_ISOC99_SOURCE


158 
	#_ISOC99_SOURCE
 1

	)

159 #undeà
_POSIX_SOURCE


160 
	#_POSIX_SOURCE
 1

	)

161 #undeà
_POSIX_C_SOURCE


162 
	#_POSIX_C_SOURCE
 200809L

	)

163 #undeà
_XOPEN_SOURCE


164 
	#_XOPEN_SOURCE
 700

	)

165 #undeà
_XOPEN_SOURCE_EXTENDED


166 
	#_XOPEN_SOURCE_EXTENDED
 1

	)

167 #undeà
_LARGEFILE64_SOURCE


168 
	#_LARGEFILE64_SOURCE
 1

	)

169 #undeà
_BSD_SOURCE


170 
	#_BSD_SOURCE
 1

	)

171 #undeà
_SVID_SOURCE


172 
	#_SVID_SOURCE
 1

	)

173 #undeà
_ATFILE_SOURCE


174 
	#_ATFILE_SOURCE
 1

	)

179 #ià(!
defšed
 
__STRICT_ANSI__
 && !defšed 
_ISOC99_SOURCE
 && \

180 !
defšed
 
	g_POSIX_SOURCE
 && !defšed 
	g_POSIX_C_SOURCE
 && \

181 !
defšed
 
	g_XOPEN_SOURCE
 && !defšed 
	g_BSD_SOURCE
 && !defšed 
	g_SVID_SOURCE
)

182 
	#_BSD_SOURCE
 1

	)

183 
	#_SVID_SOURCE
 1

	)

190 #ià(
defšed
 
_ISOC99_SOURCE
 || defšed 
_ISOC9X_SOURCE
 \

191 || (
defšed
 
	g__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L))

192 
	#__USE_ISOC99
 1

	)

196 #ià(
defšed
 
_ISOC99_SOURCE
 || defšed 
_ISOC9X_SOURCE
 \

197 || (
defšed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199409L))

198 
	#__USE_ISOC95
 1

	)

203 #ià((!
defšed
 
__STRICT_ANSI__
 || (
_XOPEN_SOURCE
 - 0) >= 500) && \

204 !
defšed
 
_POSIX_SOURCE
 && !defšed 
_POSIX_C_SOURCE
)

205 
	#_POSIX_SOURCE
 1

	)

206 #ià
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 500

207 
	#_POSIX_C_SOURCE
 2

	)

208 #–ià
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 600

209 
	#_POSIX_C_SOURCE
 199506L

	)

210 #–ià
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 700

211 
	#_POSIX_C_SOURCE
 200112L

	)

213 
	#_POSIX_C_SOURCE
 200809L

	)

215 
	#__USE_POSIX_IMPLICITLY
 1

	)

218 #ià
defšed
 
_POSIX_SOURCE
 || 
_POSIX_C_SOURCE
 >ğ1 || defšed 
_XOPEN_SOURCE


219 
	#__USE_POSIX
 1

	)

222 #ià
defšed
 
_POSIX_C_SOURCE
 && _POSIX_C_SOURCE >ğ2 || defšed 
_XOPEN_SOURCE


223 
	#__USE_POSIX2
 1

	)

226 #ià(
_POSIX_C_SOURCE
 - 0) >= 199309L

227 
	#__USE_POSIX199309
 1

	)

230 #ià(
_POSIX_C_SOURCE
 - 0) >= 199506L

231 
	#__USE_POSIX199506
 1

	)

234 #ià(
_POSIX_C_SOURCE
 - 0) >= 200112L

235 
	#__USE_XOPEN2K
 1

	)

236 #undeà
__USE_ISOC95


237 
	#__USE_ISOC95
 1

	)

238 #undeà
__USE_ISOC99


239 
	#__USE_ISOC99
 1

	)

242 #ià(
_POSIX_C_SOURCE
 - 0) >= 200809L

243 
	#__USE_XOPEN2K8
 1

	)

244 #undeà
_ATFILE_SOURCE


245 
	#_ATFILE_SOURCE
 1

	)

248 #ifdef 
_XOPEN_SOURCE


249 
	#__USE_XOPEN
 1

	)

250 #ià(
_XOPEN_SOURCE
 - 0) >= 500

251 
	#__USE_XOPEN_EXTENDED
 1

	)

252 
	#__USE_UNIX98
 1

	)

253 #undeà
_LARGEFILE_SOURCE


254 
	#_LARGEFILE_SOURCE
 1

	)

255 #ià(
_XOPEN_SOURCE
 - 0) >= 600

256 #ià(
_XOPEN_SOURCE
 - 0) >= 700

257 
	#__USE_XOPEN2K8
 1

	)

258 
	#__USE_XOPEN2K8XSI
 1

	)

260 
	#__USE_XOPEN2K
 1

	)

261 
	#__USE_XOPEN2KXSI
 1

	)

262 #undeà
__USE_ISOC95


263 
	#__USE_ISOC95
 1

	)

264 #undeà
__USE_ISOC99


265 
	#__USE_ISOC99
 1

	)

268 #ifdeà
_XOPEN_SOURCE_EXTENDED


269 
	#__USE_XOPEN_EXTENDED
 1

	)

274 #ifdeà
_LARGEFILE_SOURCE


275 
	#__USE_LARGEFILE
 1

	)

278 #ifdeà
_LARGEFILE64_SOURCE


279 
	#__USE_LARGEFILE64
 1

	)

282 #ià
defšed
 
_FILE_OFFSET_BITS
 && _FILE_OFFSET_BITS == 64

283 
	#__USE_FILE_OFFSET64
 1

	)

286 #ià
defšed
 
_BSD_SOURCE
 || defšed 
_SVID_SOURCE


287 
	#__USE_MISC
 1

	)

290 #ifdef 
_BSD_SOURCE


291 
	#__USE_BSD
 1

	)

294 #ifdef 
_SVID_SOURCE


295 
	#__USE_SVID
 1

	)

298 #ifdef 
_ATFILE_SOURCE


299 
	#__USE_ATFILE
 1

	)

302 #ifdef 
_GNU_SOURCE


303 
	#__USE_GNU
 1

	)

306 #ià
defšed
 
_REENTRANT
 || defšed 
_THREAD_SAFE


307 
	#__USE_REENTRANT
 1

	)

310 #ià
defšed
 
_FORTIFY_SOURCE
 && _FORTIFY_SOURCE > 0 \

311 && 
defšed
 
__OPTIMIZE__
 && __OPTIMIZE__ > 0

312 #ià!
__GNUC_PREREQ
 (4, 1)

313 #ifdeà
__GNUC_RH_RELEASE__


314 #w¬nšg 
_FORTIFY_SOURCE
 
suµÜ‹d
 
Úly
 
w™h
 
GCC
 4.1 
ªd
 
Ï‹r


316 
	#__USE_FORTIFY_LEVEL
 0

	)

317 #–ià
_FORTIFY_SOURCE
 > 1

318 
	#__USE_FORTIFY_LEVEL
 2

	)

320 
	#__USE_FORTIFY_LEVEL
 1

	)

323 
	#__USE_FORTIFY_LEVEL
 0

	)

327 
	#__STDC_IEC_559__
 1

	)

328 
	#__STDC_IEC_559_COMPLEX__
 1

	)

331 
	#__STDC_ISO_10646__
 200009L

	)

339 #undeà
__GNU_LIBRARY__


340 
	#__GNU_LIBRARY__
 6

	)

344 
	#__GLIBC__
 2

	)

345 
	#__GLIBC_MINOR__
 12

	)

347 
	#__GLIBC_PREREQ
(
maj
, 
mš
) \

348 ((
__GLIBC__
 << 16è+ 
__GLIBC_MINOR__
 >ğ((
maj
è<< 16è+ (
mš
))

	)

351 #ià
defšed
 
__GNUC__
 \

352 || (
defšed
 
	g__PGI
 && defšed 
	g__i386__
 ) \

353 || (
defšed
 
	g__INTEL_COMPILER
 && (defšed 
	g__i386__
 || defšed 
	g__Ÿ64__
)) \

354 || (
defšed
 
	g__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L)

355 
	#__GLIBC_HAVE_LONG_LONG
 1

	)

359 #iâdeà
__ASSEMBLER__


360 #iâdeà
_SYS_CDEFS_H


361 
	~<sys/cdefs.h
>

366 #ià
defšed
 
__USE_FILE_OFFSET64
 && !defšed 
__REDIRECT


367 
	#__USE_LARGEFILE
 1

	)

368 
	#__USE_LARGEFILE64
 1

	)

374 #ià
__GNUC_PREREQ
 (2, 7è&& 
defšed
 
__OPTIMIZE__
 \

375 && !
defšed
 
	g__OPTIMIZE_SIZE__
 && !defšed 
	g__NO_INLINE__
 \

376 && 
defšed
 
	g__ex‹º_šlše


377 
	#__USE_EXTERN_INLINES
 1

	)

385 
	~<gnu/¡ubs.h
>

	@/usr/include/getopt.h

21 #iâdeà
_GETOPT_H


23 #iâdeà
__Ãed_g‘İt


24 
	#_GETOPT_H
 1

	)

34 #ià!
defšed
 
__GNU_LIBRARY__


35 
	~<ùy³.h
>

38 #iâdeà
__THROW


39 #iâdeà
__GNUC_PREREQ


40 
	#__GNUC_PREREQ
(
maj
, 
mš
è(0)

	)

42 #ià
defšed
 
__ılu¥lus
 && 
__GNUC_PREREQ
 (2,8)

43 
	#__THROW
 
	`throw
 ()

	)

45 
	#__THROW


	)

49 #ifdef 
__ılu¥lus


59 *
İrg
;

73 
İtšd
;

78 
İ‹¼
;

82 
İtİt
;

84 #iâdeà
__Ãed_g‘İt


106 
	sİtiÚ


108 cÚ¡ *
	gÇme
;

111 
	ghas_¬g
;

112 *
	gæag
;

113 
	gv®
;

118 
	#no_¬gum’t
 0

	)

119 
	#»quœed_¬gum’t
 1

	)

120 
	#İtiÚ®_¬gum’t
 2

	)

148 #ifdeà
__GNU_LIBRARY__


152 
g‘İt
 (
___¬gc
, *cÚ¡ *
___¬gv
, cÚ¡ *
__shÜtİts
)

153 
__THROW
;

155 #ià
defšed
 
__Ãed_g‘İt
 && defšed 
__USE_POSIX2
 \

156 && !
defšed
 
	g__USE_POSIX_IMPLICITLY
 && !defšed 
	g__USE_GNU


160 #ifdeà
__REDIRECT


161 
__REDIRECT
 (
g‘İt
, (
___¬gc
, *cÚ¡ *
___¬gv
,

162 cÚ¡ *
__shÜtİts
),

163 
__posix_g‘İt
è
__THROW
;

165 
__posix_g‘İt
 (
___¬gc
, *cÚ¡ *
___¬gv
,

166 cÚ¡ *
__shÜtİts
è
__THROW
;

167 
	#g‘İt
 
__posix_g‘İt


	)

171 
g‘İt
 ();

174 #iâdeà
__Ãed_g‘İt


175 
g‘İt_lÚg
 (
___¬gc
, *cÚ¡ *
___¬gv
,

176 cÚ¡ *
__shÜtİts
,

177 cÚ¡ 
İtiÚ
 *
__lÚgİts
, *
__lÚgšd
)

178 
__THROW
;

179 
g‘İt_lÚg_Úly
 (
___¬gc
, *cÚ¡ *
___¬gv
,

180 cÚ¡ *
__shÜtİts
,

181 cÚ¡ 
İtiÚ
 *
__lÚgİts
, *
__lÚgšd
)

182 
__THROW
;

186 #ifdef 
__ılu¥lus


191 #undeà
__Ãed_g‘İt


	@/usr/include/libio.h

29 #iâdeà
_IO_STDIO_H


30 
	#_IO_STDIO_H


	)

32 
	~<_G_cÚfig.h
>

34 
	#_IO_pos_t
 
_G_åos_t


	)

35 
	#_IO_åos_t
 
_G_åos_t


	)

36 
	#_IO_åos64_t
 
_G_åos64_t


	)

37 
	#_IO_size_t
 
_G_size_t


	)

38 
	#_IO_ssize_t
 
_G_ssize_t


	)

39 
	#_IO_off_t
 
_G_off_t


	)

40 
	#_IO_off64_t
 
_G_off64_t


	)

41 
	#_IO_pid_t
 
_G_pid_t


	)

42 
	#_IO_uid_t
 
_G_uid_t


	)

43 
	#_IO_icÚv_t
 
_G_icÚv_t


	)

44 
	#_IO_HAVE_SYS_WAIT
 
_G_HAVE_SYS_WAIT


	)

45 
	#_IO_HAVE_ST_BLKSIZE
 
_G_HAVE_ST_BLKSIZE


	)

46 
	#_IO_BUFSIZ
 
_G_BUFSIZ


	)

47 
	#_IO_va_li¡
 
_G_va_li¡


	)

48 
	#_IO_wšt_t
 
_G_wšt_t


	)

50 #ifdeà
_G_NEED_STDARG_H


52 
	#__Ãed___va_li¡


	)

53 
	~<¡d¬g.h
>

54 #ifdeà
__GNUC_VA_LIST


55 #undeà
_IO_va_li¡


56 
	#_IO_va_li¡
 
__gnuc_va_li¡


	)

60 #iâdeà
__P


61 #ià
_G_HAVE_SYS_CDEFS


62 
	~<sys/cdefs.h
>

64 #ifdeà
__STDC__


65 
	#__P
(
p
è
	)
p

66 
	#__PMT
(
p
è
	)
p

68 
	#__P
(
p
è()

	)

69 
	#__PMT
(
p
è()

	)

75 #iâdeà
_PARAMS


76 
	#_PARAMS
(
´Ùos
è
	`__P
ÕrÙos)

	)

79 #iâdeà
__STDC__


81 cÚ¡

	)

84 
	#_IO_UNIFIED_JUMPTABLES
 1

	)

85 #iâdeà
_G_HAVE_PRINTF_FP


86 
	#_IO_USE_DTOA
 1

	)

89 #iâdeà
EOF


90 
	#EOF
 (-1)

	)

92 #iâdeà
NULL


93 #ià
defšed
 
__GNUG__
 && \

94 (
	g__GNUC__
 > 2 || (__GNUC__ =ğ2 && 
__GNUC_MINOR__
 >= 8))

95 
	#NULL
 (
__nuÎ
)

	)

97 #ià!
defšed
(
__ılu¥lus
)

98 
	#NULL
 ((*)0)

	)

100 
	#NULL
 (0)

	)

105 
	#_IOS_INPUT
 1

	)

106 
	#_IOS_OUTPUT
 2

	)

107 
	#_IOS_ATEND
 4

	)

108 
	#_IOS_APPEND
 8

	)

109 
	#_IOS_TRUNC
 16

	)

110 
	#_IOS_NOCREATE
 32

	)

111 
	#_IOS_NOREPLACE
 64

	)

112 
	#_IOS_BIN
 128

	)

120 
	#_IO_MAGIC
 0xFBAD0000

	)

121 
	#_OLD_STDIO_MAGIC
 0xFABC0000

	)

122 
	#_IO_MAGIC_MASK
 0xFFFF0000

	)

123 
	#_IO_USER_BUF
 1

	)

124 
	#_IO_UNBUFFERED
 2

	)

125 
	#_IO_NO_READS
 4

	)

126 
	#_IO_NO_WRITES
 8

	)

127 
	#_IO_EOF_SEEN
 0x10

	)

128 
	#_IO_ERR_SEEN
 0x20

	)

129 
	#_IO_DELETE_DONT_CLOSE
 0x40

	)

130 
	#_IO_LINKED
 0x80

	)

131 
	#_IO_IN_BACKUP
 0x100

	)

132 
	#_IO_LINE_BUF
 0x200

	)

133 
	#_IO_TIED_PUT_GET
 0x400

	)

134 
	#_IO_CURRENTLY_PUTTING
 0x800

	)

135 
	#_IO_IS_APPENDING
 0x1000

	)

136 
	#_IO_IS_FILEBUF
 0x2000

	)

137 
	#_IO_BAD_SEEN
 0x4000

	)

138 
	#_IO_USER_LOCK
 0x8000

	)

140 
	#_IO_FLAGS2_MMAP
 1

	)

141 
	#_IO_FLAGS2_NOTCANCEL
 2

	)

142 #ifdeà
_LIBC


143 
	#_IO_FLAGS2_FORTIFY
 4

	)

145 
	#_IO_FLAGS2_USER_WBUF
 8

	)

146 #ifdeà
_LIBC


147 
	#_IO_FLAGS2_SCANF_STD
 16

	)

151 
	#_IO_SKIPWS
 01

	)

152 
	#_IO_LEFT
 02

	)

153 
	#_IO_RIGHT
 04

	)

154 
	#_IO_INTERNAL
 010

	)

155 
	#_IO_DEC
 020

	)

156 
	#_IO_OCT
 040

	)

157 
	#_IO_HEX
 0100

	)

158 
	#_IO_SHOWBASE
 0200

	)

159 
	#_IO_SHOWPOINT
 0400

	)

160 
	#_IO_UPPERCASE
 01000

	)

161 
	#_IO_SHOWPOS
 02000

	)

162 
	#_IO_SCIENTIFIC
 04000

	)

163 
	#_IO_FIXED
 010000

	)

164 
	#_IO_UNITBUF
 020000

	)

165 
	#_IO_STDIO
 040000

	)

166 
	#_IO_DONT_CLOSE
 0100000

	)

167 
	#_IO_BOOLALPHA
 0200000

	)

170 
_IO_jump_t
; 
	g_IO_FILE
;

173 #ifdeà
_IO_MTSAFE_IO


174 #ià
defšed
 
__GLIBC__
 && __GLIBC__ >= 2

175 
	~<b™s/¡dio-lock.h
>

180 
	t_IO_lock_t
;

186 
	s_IO_m¬k”
 {

187 
_IO_m¬k”
 *
	m_Ãxt
;

188 
_IO_FILE
 *
	m_sbuf
;

192 
	m_pos
;

194 
£t_¡»ampos
(
¡»ampos
 
¥
è{ 
	m_¥os
 = sp; }

195 
£t_off£t
(
off£t
è{ 
	m_pos
 = off£t; 
	m_¥os
 = (
¡»ampos
)(-2); }

196 
	mpublic
:

197 
¡»amm¬k”
(
¡»ambuf
 *
sb
);

198 ~
¡»amm¬k”
();

199 
§všg
(è{  
	m_¥os
 == -2; }

200 
d–
(
¡»amm¬k”
&);

201 
d–
();

206 
	e__codecvt_»suÉ


208 
	m__codecvt_ok
,

209 
	m__codecvt_·¹Ÿl
,

210 
	m__codecvt_”rÜ
,

211 
	m__codecvt_nocÚv


214 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


217 
	s_IO_codecvt


219 (*
	m__codecvt_de¡r
è(
	m_IO_codecvt
 *);

220 
__codecvt_»suÉ
 (*
__codecvt_do_out
è(
	m_IO_codecvt
 *,

221 
	m__mb¡©e_t
 *,

222 cÚ¡ 
	mwch¬_t
 *,

223 cÚ¡ 
	mwch¬_t
 *,

224 cÚ¡ 
	mwch¬_t
 **, *,

226 
__codecvt_»suÉ
 (*
__codecvt_do_unshiá
è(
	m_IO_codecvt
 *,

227 
	m__mb¡©e_t
 *, *,

229 
__codecvt_»suÉ
 (*
__codecvt_do_š
è(
	m_IO_codecvt
 *,

230 
	m__mb¡©e_t
 *,

232 cÚ¡ **, 
	mwch¬_t
 *,

233 
	mwch¬_t
 *, wchar_t **);

234 (*
	m__codecvt_do_’codšg
è(
	m_IO_codecvt
 *);

235 (*
	m__codecvt_do_®ways_nocÚv
è(
	m_IO_codecvt
 *);

236 (*
	m__codecvt_do_Ëngth
è(
	m_IO_codecvt
 *, 
	m__mb¡©e_t
 *,

237 cÚ¡ *, cÚ¡ *, 
	m_IO_size_t
);

238 (*
	m__codecvt_do_max_Ëngth
è(
	m_IO_codecvt
 *);

240 
_IO_icÚv_t
 
	m__cd_š
;

241 
_IO_icÚv_t
 
	m__cd_out
;

245 
	s_IO_wide_d©a


247 
wch¬_t
 *
	m_IO_»ad_±r
;

248 
wch¬_t
 *
	m_IO_»ad_’d
;

249 
wch¬_t
 *
	m_IO_»ad_ba£
;

250 
wch¬_t
 *
	m_IO_wr™e_ba£
;

251 
wch¬_t
 *
	m_IO_wr™e_±r
;

252 
wch¬_t
 *
	m_IO_wr™e_’d
;

253 
wch¬_t
 *
	m_IO_buf_ba£
;

254 
wch¬_t
 *
	m_IO_buf_’d
;

256 
wch¬_t
 *
	m_IO_§ve_ba£
;

257 
wch¬_t
 *
	m_IO_backup_ba£
;

259 
wch¬_t
 *
	m_IO_§ve_’d
;

261 
__mb¡©e_t
 
	m_IO_¡©e
;

262 
__mb¡©e_t
 
	m_IO_Ï¡_¡©e
;

263 
_IO_codecvt
 
	m_codecvt
;

265 
wch¬_t
 
	m_shÜtbuf
[1];

267 cÚ¡ 
_IO_jump_t
 *
	m_wide_vbË
;

271 
	s_IO_FILE
 {

272 
	m_æags
;

273 
	#_IO_fe_æags
 
_æags


	)

277 * 
	m_IO_»ad_±r
;

278 * 
	m_IO_»ad_’d
;

279 * 
	m_IO_»ad_ba£
;

280 * 
	m_IO_wr™e_ba£
;

281 * 
	m_IO_wr™e_±r
;

282 * 
	m_IO_wr™e_’d
;

283 * 
	m_IO_buf_ba£
;

284 * 
	m_IO_buf_’d
;

286 *
	m_IO_§ve_ba£
;

287 *
	m_IO_backup_ba£
;

288 *
	m_IO_§ve_’d
;

290 
_IO_m¬k”
 *
	m_m¬k”s
;

292 
_IO_FILE
 *
	m_chaš
;

294 
	m_f’o
;

296 
	m_blksize
;

298 
	m_æags2
;

300 
_IO_off_t
 
	m_Şd_off£t
;

302 
	#__HAVE_COLUMN


	)

304 
	m_cur_cŞumn
;

305 sigÃd 
	m_vbË_off£t
;

306 
	m_shÜtbuf
[1];

310 
_IO_lock_t
 *
	m_lock
;

311 #ifdeà
_IO_USE_OLD_IO_FILE


314 
	s_IO_FILE_com¶‘e


316 
_IO_FILE
 
	m_fe
;

318 #ià
defšed
 
_G_IO_IO_FILE_VERSION
 && _G_IO_IO_FILE_VERSION == 0x20001

319 
_IO_off64_t
 
	m_off£t
;

320 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


322 
_IO_codecvt
 *
	m_codecvt
;

323 
_IO_wide_d©a
 *
	m_wide_d©a
;

324 
_IO_FILE
 *
	m_ä“»s_li¡
;

325 *
	m_ä“»s_buf
;

326 
size_t
 
	m_ä“»s_size
;

328 *
	m__·d1
;

329 *
	m__·d2
;

330 *
	m__·d3
;

331 *
	m__·d4
;

332 
size_t
 
	m__·d5
;

334 
	m_mode
;

336 
	m_unu£d2
[15 *  (è- 4 *  (*è-  (
size_t
)];

340 #iâdeà
__ılu¥lus


341 
_IO_FILE
 
	t_IO_FILE
;

344 
	g_IO_FILE_¶us
;

346 
_IO_FILE_¶us
 
_IO_2_1_¡dš_
;

347 
_IO_FILE_¶us
 
_IO_2_1_¡dout_
;

348 
_IO_FILE_¶us
 
_IO_2_1_¡d”r_
;

349 #iâdeà
_LIBC


350 
	#_IO_¡dš
 ((
_IO_FILE
*)(&
_IO_2_1_¡dš_
))

	)

351 
	#_IO_¡dout
 ((
_IO_FILE
*)(&
_IO_2_1_¡dout_
))

	)

352 
	#_IO_¡d”r
 ((
_IO_FILE
*)(&
_IO_2_1_¡d”r_
))

	)

354 
_IO_FILE
 *
_IO_¡dš
 
©Œibu‹_hidd’
;

355 
_IO_FILE
 *
_IO_¡dout
 
©Œibu‹_hidd’
;

356 
_IO_FILE
 *
_IO_¡d”r
 
©Œibu‹_hidd’
;

364 
__ssize_t
 
	t__io_»ad_â
 (*
	t__cook›
, *
	t__buf
, 
	tsize_t
 
	t__nby‹s
);

372 
__ssize_t
 
	t__io_wr™e_â
 (*
	t__cook›
, 
	t__cÚ¡
 *
	t__buf
,

373 
	tsize_t
 
	t__n
);

381 
	t__io_£ek_â
 (*
	t__cook›
, 
	t_IO_off64_t
 *
	t__pos
, 
	t__w
);

384 
	t__io_şo£_â
 (*
	t__cook›
);

387 #ifdeà
_GNU_SOURCE


389 
__io_»ad_â
 
	tcook›_»ad_funùiÚ_t
;

390 
__io_wr™e_â
 
	tcook›_wr™e_funùiÚ_t
;

391 
__io_£ek_â
 
	tcook›_£ek_funùiÚ_t
;

392 
__io_şo£_â
 
	tcook›_şo£_funùiÚ_t
;

397 
__io_»ad_â
 *
	m»ad
;

398 
__io_wr™e_â
 *
	mwr™e
;

399 
__io_£ek_â
 *
	m£ek
;

400 
__io_şo£_â
 *
	mşo£
;

401 } 
	t_IO_cook›_io_funùiÚs_t
;

402 
_IO_cook›_io_funùiÚs_t
 
	tcook›_io_funùiÚs_t
;

404 
	g_IO_cook›_fe
;

407 
_IO_cook›_š™
 (
_IO_cook›_fe
 *
__cfe
, 
__»ad_wr™e
,

408 *
__cook›
, 
_IO_cook›_io_funùiÚs_t
 
__âs
);

412 #ifdeà
__ılu¥lus


416 
__und”æow
 (
_IO_FILE
 *);

417 
__uæow
 (
_IO_FILE
 *);

418 
__ov”æow
 (
_IO_FILE
 *, );

419 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


420 
_IO_wšt_t
 
__wund”æow
 (
_IO_FILE
 *);

421 
_IO_wšt_t
 
__wuæow
 (
_IO_FILE
 *);

422 
_IO_wšt_t
 
__wov”æow
 (
_IO_FILE
 *, _IO_wint_t);

425 #ià 
__GNUC__
 >= 3

426 
	#_IO_BE
(
ex´
, 
»s
è
	`__butš_ex³ù
 (Óx´),„es)

	)

428 
	#_IO_BE
(
ex´
, 
»s
èÓx´)

	)

431 
	#_IO_g‘c_uÆocked
(
_å
) \

432 (
	`_IO_BE
 ((
_å
)->
_IO_»ad_±r
 >ğ(_å)->
_IO_»ad_’d
, 0) \

433 ? 
	`__uæow
 (
_å
è: *(*è(_å)->
_IO_»ad_±r
++)

	)

434 
	#_IO_³ekc_uÆocked
(
_å
) \

435 (
	`_IO_BE
 ((
_å
)->
_IO_»ad_±r
 >ğ(_å)->
_IO_»ad_’d
, 0) \

436 && 
	`__und”æow
 (
_å
è=ğ
EOF
 ? EOF \

437 : *(*è(
_å
)->
_IO_»ad_±r
)

	)

438 
	#_IO_putc_uÆocked
(
_ch
, 
_å
) \

439 (
	`_IO_BE
 ((
_å
)->
_IO_wr™e_±r
 >ğ(_å)->
_IO_wr™e_’d
, 0) \

440 ? 
	`__ov”æow
 (
_å
, (è(
_ch
)) \

441 : (è(*(
_å
)->
_IO_wr™e_±r
++ = (
_ch
)))

	)

443 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


444 
	#_IO_g‘wc_uÆocked
(
_å
) \

445 (
	`_IO_BE
 ((
_å
)->
_wide_d©a
 =ğ
NULL
 \

446 || ((
_å
)->
_wide_d©a
->
_IO_»ad_±r
 \

447 >ğ(
_å
)->
_wide_d©a
->
_IO_»ad_’d
), 0) \

448 ? 
	`__wuæow
 (
_å
è: (
_IO_wšt_t
è*(_å)->
_wide_d©a
->
_IO_»ad_±r
++)

	)

449 
	#_IO_putwc_uÆocked
(
_wch
, 
_å
) \

450 (
	`_IO_BE
 ((
_å
)->
_wide_d©a
 =ğ
NULL
 \

451 || ((
_å
)->
_wide_d©a
->
_IO_wr™e_±r
 \

452 >ğ(
_å
)->
_wide_d©a
->
_IO_wr™e_’d
), 0) \

453 ? 
	`__wov”æow
 (
_å
, 
_wch
) \

454 : (
_IO_wšt_t
è(*(
_å
)->
_wide_d©a
->
_IO_wr™e_±r
++ = (
_wch
)))

	)

457 
	#_IO_ãof_uÆocked
(
__å
è(((__å)->
_æags
 & 
_IO_EOF_SEEN
è!ğ0)

	)

458 
	#_IO_ã¼Ü_uÆocked
(
__å
è(((__å)->
_æags
 & 
_IO_ERR_SEEN
è!ğ0)

	)

460 
_IO_g‘c
 (
_IO_FILE
 *
__å
);

461 
_IO_putc
 (
__c
, 
_IO_FILE
 *
__å
);

462 
_IO_ãof
 (
_IO_FILE
 *
__å
è
__THROW
;

463 
_IO_ã¼Ü
 (
_IO_FILE
 *
__å
è
__THROW
;

465 
_IO_³ekc_locked
 (
_IO_FILE
 *
__å
);

468 
	#_IO_PENDING_OUTPUT_COUNT
(
_å
) \

469 ((
_å
)->
_IO_wr™e_±r
 - (_å)->
_IO_wr™e_ba£
)

	)

471 
_IO_æockfe
 (
_IO_FILE
 *è
__THROW
;

472 
_IO_fuÆockfe
 (
_IO_FILE
 *è
__THROW
;

473 
_IO_árylockfe
 (
_IO_FILE
 *è
__THROW
;

475 #ifdeà
_IO_MTSAFE_IO


476 
	#_IO_³ekc
(
_å
è
	`_IO_³ekc_locked
 (_å)

	)

477 
	#_IO_æockfe
(
_å
) \

478 ià(((
_å
)->
_æags
 & 
_IO_USER_LOCK
è=ğ0è
	`_IO_æockfe
 (_å)

	)

479 
	#_IO_fuÆockfe
(
_å
) \

480 ià(((
_å
)->
_æags
 & 
_IO_USER_LOCK
è=ğ0è
	`_IO_fuÆockfe
 (_å)

	)

482 
	#_IO_³ekc
(
_å
è
	`_IO_³ekc_uÆocked
 (_å)

	)

483 
	#_IO_æockfe
(
_å
è

	)

484 
	#_IO_fuÆockfe
(
_å
è

	)

485 
	#_IO_árylockfe
(
_å
è

	)

486 
	#_IO_ş—nup_»giÚ_¡¬t
(
_fù
, 
_å
è

	)

487 
	#_IO_ş—nup_»giÚ_’d
(
_Do™
è

	)

490 
_IO_vfsÿnf
 (
_IO_FILE
 * 
__»¡riù
, const * __restrict,

491 
_IO_va_li¡
, *
__»¡riù
);

492 
_IO_vårštf
 (
_IO_FILE
 *
__»¡riù
, const *__restrict,

493 
_IO_va_li¡
);

494 
_IO_ssize_t
 
_IO_·dn
 (
_IO_FILE
 *, , _IO_ssize_t);

495 
_IO_size_t
 
_IO_sg‘n
 (
_IO_FILE
 *, *, _IO_size_t);

497 
_IO_off64_t
 
_IO_£ekoff
 (
_IO_FILE
 *, _IO_off64_t, , );

498 
_IO_off64_t
 
_IO_£ekpos
 (
_IO_FILE
 *, _IO_off64_t, );

500 
_IO_ä“_backup_¬—
 (
_IO_FILE
 *è
__THROW
;

502 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


503 
_IO_wšt_t
 
_IO_g‘wc
 (
_IO_FILE
 *
__å
);

504 
_IO_wšt_t
 
_IO_putwc
 (
wch¬_t
 
__wc
, 
_IO_FILE
 *
__å
);

505 
_IO_fwide
 (
_IO_FILE
 *
__å
, 
__mode
è
__THROW
;

506 #ià
__GNUC__
 >= 2

509 #ià
defšed
 
_LIBC
 && defšed 
SHARED


510 
	~<shlib-com·t.h
>

511 #ià
SHLIB_COMPAT
 (
libc
, 
GLIBC_2_0
, 
GLIBC_2_1
)

512 
	#_IO_fwide_maybe_šcom·tibË
 \

513 (
	`__butš_ex³ù
 (&
_IO_¡dš_u£d
 =ğ
NULL
, 0))

	)

514 cÚ¡ 
_IO_¡dš_u£d
;

515 
w—k_ex‹º
 (
_IO_¡dš_u£d
);

518 #iâdeà
_IO_fwide_maybe_šcom·tibË


519 
	#_IO_fwide_maybe_šcom·tibË
 (0)

	)

523 
	#_IO_fwide
(
__å
, 
__mode
) \

524 ({ 
__»suÉ
 = (
__mode
); \

525 ià(
__»suÉ
 < 0 && ! 
_IO_fwide_maybe_šcom·tibË
) \

527 ià((
__å
)->
_mode
 == 0) \

529 (
__å
)->
_mode
 = -1; \

530 
__»suÉ
 = (
__å
)->
_mode
; \

532 ià(
	`__butš_cÚ¡ªt_p
 (
__mode
) && (__mode) == 0) \

533 
__»suÉ
 = 
_IO_fwide_maybe_šcom·tibË
 ? -1 : (
__å
)->
_mode
; \

535 
__»suÉ
 = 
	`_IO_fwide
 (
__å
, __result); \

536 
__»suÉ
; })

	)

539 
_IO_vfwsÿnf
 (
_IO_FILE
 * 
__»¡riù
, cÚ¡ 
wch¬_t
 * __restrict,

540 
_IO_va_li¡
, *
__»¡riù
);

541 
_IO_vfw´štf
 (
_IO_FILE
 *
__»¡riù
, cÚ¡ 
wch¬_t
 *__restrict,

542 
_IO_va_li¡
);

543 
_IO_ssize_t
 
_IO_w·dn
 (
_IO_FILE
 *, 
wšt_t
, _IO_ssize_t);

544 
_IO_ä“_wbackup_¬—
 (
_IO_FILE
 *è
__THROW
;

547 #ifdeà
__LDBL_COMPAT


548 
	~<b™s/libio-ldbl.h
>

551 #ifdeà
__ılu¥lus


	@/usr/include/sys/types.h

23 #iâdef 
_SYS_TYPES_H


24 
	#_SYS_TYPES_H
 1

	)

26 
	~<ã©u»s.h
>

28 
	g__BEGIN_DECLS


30 
	~<b™s/ty³s.h
>

32 #ifdef 
__USE_BSD


33 #iâdeà
__u_ch¬_defšed


34 
__u_ch¬
 
	tu_ch¬
;

35 
__u_shÜt
 
	tu_shÜt
;

36 
__u_št
 
	tu_št
;

37 
__u_lÚg
 
	tu_lÚg
;

38 
__quad_t
 
	tquad_t
;

39 
__u_quad_t
 
	tu_quad_t
;

40 
__fsid_t
 
	tfsid_t
;

41 
	#__u_ch¬_defšed


	)

45 
__loff_t
 
	tloff_t
;

47 #iâdeà
__šo_t_defšed


48 #iâdeà
__USE_FILE_OFFSET64


49 
__šo_t
 
	tšo_t
;

51 
__šo64_t
 
	tšo_t
;

53 
	#__šo_t_defšed


	)

55 #ià
defšed
 
__USE_LARGEFILE64
 && !defšed 
__šo64_t_defšed


56 
__šo64_t
 
	tšo64_t
;

57 
	#__šo64_t_defšed


	)

60 #iâdeà
__dev_t_defšed


61 
__dev_t
 
	tdev_t
;

62 
	#__dev_t_defšed


	)

65 #iâdeà
__gid_t_defšed


66 
__gid_t
 
	tgid_t
;

67 
	#__gid_t_defšed


	)

70 #iâdeà
__mode_t_defšed


71 
__mode_t
 
	tmode_t
;

72 
	#__mode_t_defšed


	)

75 #iâdeà
__Æšk_t_defšed


76 
__Æšk_t
 
	tÆšk_t
;

77 
	#__Æšk_t_defšed


	)

80 #iâdeà
__uid_t_defšed


81 
__uid_t
 
	tuid_t
;

82 
	#__uid_t_defšed


	)

85 #iâdeà
__off_t_defšed


86 #iâdeà
__USE_FILE_OFFSET64


87 
__off_t
 
	toff_t
;

89 
__off64_t
 
	toff_t
;

91 
	#__off_t_defšed


	)

93 #ià
defšed
 
__USE_LARGEFILE64
 && !defšed 
__off64_t_defšed


94 
__off64_t
 
	toff64_t
;

95 
	#__off64_t_defšed


	)

98 #iâdeà
__pid_t_defšed


99 
__pid_t
 
	tpid_t
;

100 
	#__pid_t_defšed


	)

103 #ià(
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8
) \

104 && !
defšed
 
__id_t_defšed


105 
__id_t
 
	tid_t
;

106 
	#__id_t_defšed


	)

109 #iâdeà
__ssize_t_defšed


110 
__ssize_t
 
	tssize_t
;

111 
	#__ssize_t_defšed


	)

114 #ifdef 
__USE_BSD


115 #iâdeà
__daddr_t_defšed


116 
__daddr_t
 
	tdaddr_t
;

117 
__ÿddr_t
 
	tÿddr_t
;

118 
	#__daddr_t_defšed


	)

122 #ià(
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN
è&& !defšed 
__key_t_defšed


123 
__key_t
 
	tkey_t
;

124 
	#__key_t_defšed


	)

127 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8


128 
	#__Ãed_şock_t


	)

130 
	#__Ãed_time_t


	)

131 
	#__Ãed_tim”_t


	)

132 
	#__Ãed_şockid_t


	)

133 
	~<time.h
>

135 #ifdeà
__USE_XOPEN


136 #iâdeà
__u£cÚds_t_defšed


137 
__u£cÚds_t
 
	tu£cÚds_t
;

138 
	#__u£cÚds_t_defšed


	)

140 #iâdeà
__su£cÚds_t_defšed


141 
__su£cÚds_t
 
	tsu£cÚds_t
;

142 
	#__su£cÚds_t_defšed


	)

146 
	#__Ãed_size_t


	)

147 
	~<¡ddef.h
>

149 #ifdeà
__USE_MISC


151 
	tulÚg
;

152 
	tushÜt
;

153 
	tušt
;

158 #ià!
__GNUC_PREREQ
 (2, 7)

161 #iâdeà
__št8_t_defšed


162 
	#__št8_t_defšed


	)

163 
	tšt8_t
;

164 
	tšt16_t
;

165 
	tšt32_t
;

166 #ià
__WORDSIZE
 == 64

167 
	tšt64_t
;

168 #–ià
__GLIBC_HAVE_LONG_LONG


169 
__ex‹nsiÚ__
 
	tšt64_t
;

174 
	tu_št8_t
;

175 
	tu_št16_t
;

176 
	tu_št32_t
;

177 #ià
__WORDSIZE
 == 64

178 
	tu_št64_t
;

179 #–ià
__GLIBC_HAVE_LONG_LONG


180 
__ex‹nsiÚ__
 
	tu_št64_t
;

183 
	t»gi¡”_t
;

188 
	#__štN_t
(
N
, 
MODE
) \

189 ##
	tN
##
	t_t
 
	t__©Œibu‹__
 ((
	t__mode__
 (
	tMODE
)))

	)

190 
	t__u_štN_t
(
	tN
, 
	tMODE
) \

191 
	tu_št
##
	tN
##
	t_t
 
	t__©Œibu‹__
 ((
	t__mode__
 (
	tMODE
)))

	)

193 #iâdeà
	t__št8_t_defšed


194 
	t__št8_t_defšed


	)

195 
	t__štN_t
 (8, 
	t__QI__
);

196 
__štN_t
 (16, 
__HI__
);

197 
__štN_t
 (32, 
__SI__
);

198 
__štN_t
 (64, 
__DI__
);

201 
__u_štN_t
 (8, 
__QI__
);

202 
__u_štN_t
 (16, 
__HI__
);

203 
__u_štN_t
 (32, 
__SI__
);

204 
__u_štN_t
 (64, 
__DI__
);

206 
	t»gi¡”_t
 
	t__©Œibu‹__
 ((
	t__mode__
 (
	t__wÜd__
)));

212 
	#__BIT_TYPES_DEFINED__
 1

	)

215 #ifdef 
__USE_BSD


217 
	~<’dŸn.h
>

220 
	~<sys/£Ëù.h
>

223 
	~<sys/sysmaüos.h
>

227 #ià(
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K8
) \

228 && !
defšed
 
__blksize_t_defšed


229 
__blksize_t
 
	tblksize_t
;

230 
	#__blksize_t_defšed


	)

234 #iâdeà
__USE_FILE_OFFSET64


235 #iâdeà
__blkút_t_defšed


236 
__blkút_t
 
	tblkút_t
;

237 
	#__blkút_t_defšed


	)

239 #iâdeà
__fsblkút_t_defšed


240 
__fsblkút_t
 
	tfsblkút_t
;

241 
	#__fsblkút_t_defšed


	)

243 #iâdeà
__fsfút_t_defšed


244 
__fsfút_t
 
	tfsfút_t
;

245 
	#__fsfút_t_defšed


	)

248 #iâdeà
__blkút_t_defšed


249 
__blkút64_t
 
	tblkút_t
;

250 
	#__blkút_t_defšed


	)

252 #iâdeà
__fsblkút_t_defšed


253 
__fsblkút64_t
 
	tfsblkút_t
;

254 
	#__fsblkút_t_defšed


	)

256 #iâdeà
__fsfút_t_defšed


257 
__fsfút64_t
 
	tfsfút_t
;

258 
	#__fsfút_t_defšed


	)

262 #ifdeà
__USE_LARGEFILE64


263 
__blkút64_t
 
	tblkút64_t
;

264 
__fsblkút64_t
 
	tfsblkút64_t
;

265 
__fsfút64_t
 
	tfsfút64_t
;

270 #ià
defšed
 
__USE_POSIX199506
 || defšed 
__USE_UNIX98


271 
	~<b™s/±h»adty³s.h
>

274 
	g__END_DECLS


	@/usr/include/time.h

23 #iâdef 
_TIME_H


25 #ià(! 
defšed
 
__Ãed_time_t
 && !defšed 
__Ãed_şock_t
 && \

26 ! 
defšed
 
	g__Ãed_time¥ec
)

27 
	#_TIME_H
 1

	)

28 
	~<ã©u»s.h
>

30 
	g__BEGIN_DECLS


34 #ifdef 
_TIME_H


36 
	#__Ãed_size_t


	)

37 
	#__Ãed_NULL


	)

38 
	~<¡ddef.h
>

42 
	~<b™s/time.h
>

45 #ià!
defšed
 
__STRICT_ANSI__
 && !defšed 
__USE_XOPEN2K


46 #iâdeà
CLK_TCK


47 
	#CLK_TCK
 
CLOCKS_PER_SEC


	)

53 #ià!
defšed
 
__şock_t_defšed
 && (defšed 
_TIME_H
 || defšed 
__Ãed_şock_t
)

54 
	#__şock_t_defšed
 1

	)

56 
	~<b™s/ty³s.h
>

58 
__BEGIN_NAMESPACE_STD


60 
__şock_t
 
	tşock_t
;

61 
	g__END_NAMESPACE_STD


62 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_POSIX
 || defšed 
__USE_MISC


63 
	$__USING_NAMESPACE_STD
(
şock_t
)

67 #undeà
__Ãed_şock_t


69 #ià!
defšed
 
__time_t_defšed
 && (defšed 
_TIME_H
 || defšed 
__Ãed_time_t
)

70 
	#__time_t_defšed
 1

	)

72 
	~<b™s/ty³s.h
>

74 
__BEGIN_NAMESPACE_STD


76 
__time_t
 
	ttime_t
;

77 
__END_NAMESPACE_STD


78 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC
 || defšed 
__USE_SVID


79 
	$__USING_NAMESPACE_STD
(
time_t
)

83 #undeà
__Ãed_time_t


85 #ià!
defšed
 
__şockid_t_defšed
 && \

86 ((
defšed
 
_TIME_H
 && defšed 
__USE_POSIX199309
è|| defšed 
__Ãed_şockid_t
)

87 
	#__şockid_t_defšed
 1

	)

89 
	~<b™s/ty³s.h
>

92 
__şockid_t
 
	tşockid_t
;

95 #undeà
__şockid_time_t


97 #ià!
defšed
 
__tim”_t_defšed
 && \

98 ((
defšed
 
_TIME_H
 && defšed 
__USE_POSIX199309
è|| defšed 
__Ãed_tim”_t
)

99 
	#__tim”_t_defšed
 1

	)

101 
	~<b™s/ty³s.h
>

104 
__tim”_t
 
	ttim”_t
;

107 #undeà
__Ãed_tim”_t


110 #ià!
defšed
 
__time¥ec_defšed
 && \

111 ((
defšed
 
_TIME_H
 && \

112 (
defšed
 
__USE_POSIX199309
 || defšed 
__USE_MISC
)) || \

113 
defšed
 
__Ãed_time¥ec
)

114 
	#__time¥ec_defšed
 1

	)

116 
	~<b™s/ty³s.h
>

120 
	stime¥ec


122 
__time_t
 
tv_£c
;

123 
tv_n£c
;

127 #undeà
__Ãed_time¥ec


130 #ifdef 
_TIME_H


131 
__BEGIN_NAMESPACE_STD


133 
	stm


135 
tm_£c
;

136 
tm_mš
;

137 
tm_hour
;

138 
tm_mday
;

139 
tm_mÚ
;

140 
tm_y—r
;

141 
tm_wday
;

142 
tm_yday
;

143 
tm_isd¡
;

145 #ifdef 
__USE_BSD


146 
tm_gmtoff
;

147 
__cÚ¡
 *
tm_zÚe
;

149 
__tm_gmtoff
;

150 
__cÚ¡
 *
__tm_zÚe
;

153 
__END_NAMESPACE_STD


154 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_POSIX
 || defšed 
__USE_MISC


155 
	$__USING_NAMESPACE_STD
(
tm
)

159 #ifdeà
__USE_POSIX199309


161 
	s™im”¥ec


163 
time¥ec
 
™_š‹rv®
;

164 
time¥ec
 
™_v®ue
;

168 
sigev’t
;

172 #ifdeà
__USE_XOPEN2K


173 #iâdeà
__pid_t_defšed


174 
__pid_t
 
	tpid_t
;

175 
	#__pid_t_defšed


	)

180 
__BEGIN_NAMESPACE_STD


183 
şock_t
 
	$şock
 (è
__THROW
;

186 
time_t
 
	$time
 (
time_t
 *
__tim”
è
__THROW
;

189 
	$difáime
 (
time_t
 
__time1
,ime_ˆ
__time0
)

190 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

193 
time_t
 
	$mktime
 (
tm
 *
__
è
__THROW
;

199 
size_t
 
	$¡ráime
 (*
__»¡riù
 
__s
, 
size_t
 
__maxsize
,

200 
__cÚ¡
 *
__»¡riù
 
__fÜm©
,

201 
__cÚ¡
 
tm
 *
__»¡riù
 
__
è
__THROW
;

202 
__END_NAMESPACE_STD


204 #ifdeà
__USE_XOPEN


207 *
	$¡½time
 (
__cÚ¡
 *
__»¡riù
 
__s
,

208 
__cÚ¡
 *
__»¡riù
 
__fmt
, 
tm
 *
__
)

209 
__THROW
;

212 #ifdeà
__USE_XOPEN2K8


215 
	~<xloÿË.h
>

217 
size_t
 
	$¡ráime_l
 (*
__»¡riù
 
__s
, 
size_t
 
__maxsize
,

218 
__cÚ¡
 *
__»¡riù
 
__fÜm©
,

219 
__cÚ¡
 
tm
 *
__»¡riù
 
__
,

220 
__loÿË_t
 
__loc
è
__THROW
;

223 #ifdeà
__USE_GNU


224 *
	$¡½time_l
 (
__cÚ¡
 *
__»¡riù
 
__s
,

225 
__cÚ¡
 *
__»¡riù
 
__fmt
, 
tm
 *
__
,

226 
__loÿË_t
 
__loc
è
__THROW
;

230 
__BEGIN_NAMESPACE_STD


233 
tm
 *
	$gmtime
 (
__cÚ¡
 
time_t
 *
__tim”
è
__THROW
;

237 
tm
 *
	$loÿÉime
 (
__cÚ¡
 
time_t
 *
__tim”
è
__THROW
;

238 
__END_NAMESPACE_STD


240 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC


243 
tm
 *
	$gmtime_r
 (
__cÚ¡
 
time_t
 *
__»¡riù
 
__tim”
,

244 
tm
 *
__»¡riù
 
__
è
__THROW
;

248 
tm
 *
	$loÿÉime_r
 (
__cÚ¡
 
time_t
 *
__»¡riù
 
__tim”
,

249 
tm
 *
__»¡riù
 
__
è
__THROW
;

252 
__BEGIN_NAMESPACE_STD


255 *
	$asùime
 (
__cÚ¡
 
tm
 *
__
è
__THROW
;

258 *
	$ùime
 (
__cÚ¡
 
time_t
 *
__tim”
è
__THROW
;

259 
__END_NAMESPACE_STD


261 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC


266 *
	$asùime_r
 (
__cÚ¡
 
tm
 *
__»¡riù
 
__
,

267 *
__»¡riù
 
__buf
è
__THROW
;

270 *
	$ùime_r
 (
__cÚ¡
 
time_t
 *
__»¡riù
 
__tim”
,

271 *
__»¡riù
 
__buf
è
__THROW
;

276 *
__tzÇme
[2];

277 
__daylight
;

278 
__timezÚe
;

281 #ifdef 
__USE_POSIX


283 *
tzÇme
[2];

287 
	$tz£t
 (è
__THROW
;

290 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN


291 
daylight
;

292 
timezÚe
;

295 #ifdeà
__USE_SVID


298 
	$¡ime
 (
__cÚ¡
 
time_t
 *
__wh’
è
__THROW
;

304 
	#__i¦—p
(
y—r
) \

305 ((
y—r
è% 4 =ğ0 && ((y—rè% 100 !ğ0 || (y—rè% 400 =ğ0))

	)

308 #ifdeà
__USE_MISC


313 
time_t
 
	$timegm
 (
tm
 *
__
è
__THROW
;

316 
time_t
 
	$tim–oÿl
 (
tm
 *
__
è
__THROW
;

319 
	$dysize
 (
__y—r
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

323 #ifdeà
__USE_POSIX199309


328 
	`Çno¦“p
 (
__cÚ¡
 
time¥ec
 *
__»que¡ed_time
,

329 
time¥ec
 *
__»maššg
);

333 
	$şock_g‘»s
 (
şockid_t
 
__şock_id
, 
time¥ec
 *
__»s
è
__THROW
;

336 
	$şock_g‘time
 (
şockid_t
 
__şock_id
, 
time¥ec
 *
__
è
__THROW
;

339 
	$şock_£‰ime
 (
şockid_t
 
__şock_id
, 
__cÚ¡
 
time¥ec
 *
__
)

340 
__THROW
;

342 #ifdeà
__USE_XOPEN2K


347 
	`şock_Çno¦“p
 (
şockid_t
 
__şock_id
, 
__æags
,

348 
__cÚ¡
 
time¥ec
 *
__»q
,

349 
time¥ec
 *
__»m
);

352 
	$şock_g‘ıuşockid
 (
pid_t
 
__pid
, 
şockid_t
 *
__şock_id
è
__THROW
;

357 
	$tim”_ü—‹
 (
şockid_t
 
__şock_id
,

358 
sigev’t
 *
__»¡riù
 
__evp
,

359 
tim”_t
 *
__»¡riù
 
__tim”id
è
__THROW
;

362 
	$tim”_d–‘e
 (
tim”_t
 
__tim”id
è
__THROW
;

365 
	$tim”_£‰ime
 (
tim”_t
 
__tim”id
, 
__æags
,

366 
__cÚ¡
 
™im”¥ec
 *
__»¡riù
 
__v®ue
,

367 
™im”¥ec
 *
__»¡riù
 
__ov®ue
è
__THROW
;

370 
	$tim”_g‘time
 (
tim”_t
 
__tim”id
, 
™im”¥ec
 *
__v®ue
)

371 
__THROW
;

374 
	$tim”_g‘ov”run
 (
tim”_t
 
__tim”id
è
__THROW
;

378 #ifdeà
__USE_XOPEN_EXTENDED


390 
g‘d©e_”r
;

399 
tm
 *
	`g‘d©e
 (
__cÚ¡
 *
__¡ršg
);

402 #ifdeà
__USE_GNU


413 
	`g‘d©e_r
 (
__cÚ¡
 *
__»¡riù
 
__¡ršg
,

414 
tm
 *
__»¡riù
 
__»sbuå
);

417 
__END_DECLS


	@/usr/include/xlocale.h

21 #iâdeà
_XLOCALE_H


22 
	#_XLOCALE_H
 1

	)

28 
	s__loÿË_¡ruù


31 
__loÿË_d©a
 *
	m__loÿËs
[13];

34 cÚ¡ *
	m__ùy³_b
;

35 cÚ¡ *
	m__ùy³_tŞow”
;

36 cÚ¡ *
	m__ùy³_touµ”
;

39 cÚ¡ *
	m__Çmes
[13];

40 } *
	t__loÿË_t
;

43 
__loÿË_t
 
	tloÿË_t
;

	@/usr/include/_G_config.h

4 #iâdeà
_G_cÚfig_h


5 
	#_G_cÚfig_h
 1

	)

9 
	~<b™s/ty³s.h
>

10 
	#__Ãed_size_t


	)

11 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


12 
	#__Ãed_wch¬_t


	)

14 
	#__Ãed_NULL


	)

15 
	~<¡ddef.h
>

16 
	#__Ãed_mb¡©e_t


	)

17 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


18 
	#__Ãed_wšt_t


	)

20 
	~<wch¬.h
>

21 
	#_G_size_t
 
size_t


	)

24 
__off_t
 
	m__pos
;

25 
__mb¡©e_t
 
	m__¡©e
;

26 } 
	t_G_åos_t
;

29 
__off64_t
 
	m__pos
;

30 
__mb¡©e_t
 
	m__¡©e
;

31 } 
	t_G_åos64_t
;

32 
	#_G_ssize_t
 
__ssize_t


	)

33 
	#_G_off_t
 
__off_t


	)

34 
	#_G_off64_t
 
__off64_t


	)

35 
	#_G_pid_t
 
__pid_t


	)

36 
	#_G_uid_t
 
__uid_t


	)

37 
	#_G_wch¬_t
 
wch¬_t


	)

38 
	#_G_wšt_t
 
wšt_t


	)

39 
	#_G_¡©64
 
¡©64


	)

40 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


41 
	~<gcÚv.h
>

44 
__gcÚv_šfo
 
	m__cd
;

47 
__gcÚv_šfo
 
	m__cd
;

48 
__gcÚv_¡•_d©a
 
	m__d©a
;

49 } 
	m__combšed
;

50 } 
	t_G_icÚv_t
;

53 
	t_G_št16_t
 
	t__©Œibu‹__
 ((
	t__mode__
 (
	t__HI__
)));

54 
	t_G_št32_t
 
	t__©Œibu‹__
 ((
	t__mode__
 (
	t__SI__
)));

55 
	t_G_ušt16_t
 
	t__©Œibu‹__
 ((
	t__mode__
 (
	t__HI__
)));

56 
	t_G_ušt32_t
 
	t__©Œibu‹__
 ((
	t__mode__
 (
	t__SI__
)));

58 
	#_G_HAVE_BOOL
 1

	)

62 
	#_G_HAVE_ATEXIT
 1

	)

63 
	#_G_HAVE_SYS_CDEFS
 1

	)

64 
	#_G_HAVE_SYS_WAIT
 1

	)

65 
	#_G_NEED_STDARG_H
 1

	)

66 
	#_G_va_li¡
 
__gnuc_va_li¡


	)

68 
	#_G_HAVE_PRINTF_FP
 1

	)

69 
	#_G_HAVE_MMAP
 1

	)

70 
	#_G_HAVE_MREMAP
 1

	)

71 
	#_G_HAVE_LONG_DOUBLE_IO
 1

	)

72 
	#_G_HAVE_IO_FILE_OPEN
 1

	)

73 
	#_G_HAVE_IO_GETLINE_INFO
 1

	)

75 
	#_G_IO_IO_FILE_VERSION
 0x20001

	)

77 
	#_G_OPEN64
 
__İ’64


	)

78 
	#_G_LSEEK64
 
__l£ek64


	)

79 
	#_G_MMAP64
 
__mm­64


	)

80 
	#_G_FSTAT64
(
fd
,
buf
è
	`__fx¡©64
 (
_STAT_VER
, fd, buf)

	)

83 
	#_G_HAVE_ST_BLKSIZE
 
	`defšed
 (
_STATBUF_ST_BLKSIZE
)

	)

85 
	#_G_BUFSIZ
 8192

	)

88 
	#_G_NAMES_HAVE_UNDERSCORE
 0

	)

89 
	#_G_VTABLE_LABEL_HAS_LENGTH
 1

	)

90 
	#_G_USING_THUNKS
 1

	)

91 
	#_G_VTABLE_LABEL_PREFIX
 "__vt_"

	)

92 
	#_G_VTABLE_LABEL_PREFIX_ID
 
__vt_


	)

95 #ià
defšed
 
__ılu¥lus
 || defšed 
__STDC__


96 
	#_G_ARGS
(
ARGLIST
è
	)
ARGLIST

98 
	#_G_ARGS
(
ARGLIST
è()

	)

	@/usr/include/bits/byteswap.h

21 #ià!
defšed
 
_BYTESWAP_H
 && !defšed 
_NETINET_IN_H
 && !defšed 
_ENDIAN_H


25 #iâdeà
_BITS_BYTESWAP_H


26 
	#_BITS_BYTESWAP_H
 1

	)

28 
	~<b™s/wÜdsize.h
>

31 
	#__bsw­_cÚ¡ªt_16
(
x
) \

32 ((è((((
x
è>> 8è& 0xffè| (((xè& 0xffè<< 8)))

	)

34 #ià
defšed
 
__GNUC__
 && __GNUC__ >= 2

35 
	#__bsw­_16
(
x
) \

36 (
__ex‹nsiÚ__
 \

37 ({ 
__v
, 
__x
 = (è(
x
); \

38 ià(
	`__butš_cÚ¡ªt_p
 (
__x
)) \

39 
__v
 = 
	`__bsw­_cÚ¡ªt_16
 (
__x
); \

41 
	`__asm__
 ("rorw $8, %w0" \

42 : "ô" (
__v
) \

43 : "0" (
__x
) \

45 
__v
; }))

	)

48 
	#__bsw­_16
(
x
) \

49 (
__ex‹nsiÚ__
 \

50 ({ 
__x
 = (è(
x
); \

51 
	`__bsw­_cÚ¡ªt_16
 (
__x
); }))

	)

56 
	#__bsw­_cÚ¡ªt_32
(
x
) \

57 ((((
x
) & 0xff000000) >> 24) | (((x) & 0x00ff0000) >> 8) | \

58 (((
x
è& 0x0000ff00è<< 8è| (((xè& 0x000000ffè<< 24))

	)

60 #ià
defšed
 
__GNUC__
 && __GNUC__ >= 2

61 #ià
__WORDSIZE
 =ğ64 || (
defšed
 
__i486__
 || defšed 
__³Áium__
 \

62 || 
defšed
 
	g__³Áium´o__
 || defšed 
	g__³Áium4__
 \

63 || 
defšed
 
	g__k8__
 || defšed 
	g__©hlÚ__
 \

64 || 
defšed
 
	g__k6__
 || defšed 
	g__nocÚa__
 \

65 || 
defšed
 
	g__cÜe2__
 || defšed 
	g__geode__
 \

66 || 
defšed
 
	g__amdçm10__
)

69 
	#__bsw­_32
(
x
) \

70 (
__ex‹nsiÚ__
 \

71 ({ 
__v
, 
__x
 = (
x
); \

72 ià(
	`__butš_cÚ¡ªt_p
 (
__x
)) \

73 
__v
 = 
	`__bsw­_cÚ¡ªt_32
 (
__x
); \

75 
	`__asm__
 ("bsw­ %0" : "ô" (
__v
è: "0" (
__x
)); \

76 
__v
; }))

	)

78 
	#__bsw­_32
(
x
) \

79 (
__ex‹nsiÚ__
 \

80 ({ 
__v
, 
__x
 = (
x
); \

81 ià(
	`__butš_cÚ¡ªt_p
 (
__x
)) \

82 
__v
 = 
	`__bsw­_cÚ¡ªt_32
 (
__x
); \

84 
	`__asm__
 ("rorw $8, %w0;" \

87 : "ô" (
__v
) \

88 : "0" (
__x
) \

90 
__v
; }))

	)

93 
	#__bsw­_32
(
x
) \

94 (
__ex‹nsiÚ__
 \

95 ({ 
__x
 = (
x
); 
	`__bsw­_cÚ¡ªt_32
 (__x); }))

	)

99 #ià
defšed
 
__GNUC__
 && __GNUC__ >= 2

101 
	#__bsw­_cÚ¡ªt_64
(
x
) \

102 ((((
x
) & 0xff00000000000000ull) >> 56) \

103 | (((
x
) & 0x00ff000000000000ull) >> 40) \

104 | (((
x
) & 0x0000ff0000000000ull) >> 24) \

105 | (((
x
) & 0x000000ff00000000ull) >> 8) \

106 | (((
x
) & 0x00000000ff000000ull) << 8) \

107 | (((
x
) & 0x0000000000ff0000ull) << 24) \

108 | (((
x
) & 0x000000000000ff00ull) << 40) \

109 | (((
x
è& 0x00000000000000ffuÎè<< 56))

	)

111 #ià
__WORDSIZE
 == 64

112 
	#__bsw­_64
(
x
) \

113 (
__ex‹nsiÚ__
 \

114 ({ 
__v
, 
__x
 = (
x
); \

115 ià(
	`__butš_cÚ¡ªt_p
 (
__x
)) \

116 
__v
 = 
	`__bsw­_cÚ¡ªt_64
 (
__x
); \

118 
	`__asm__
 ("bsw­ %q0" : "ô" (
__v
è: "0" (
__x
)); \

119 
__v
; }))

	)

121 
	#__bsw­_64
(
x
) \

122 (
__ex‹nsiÚ__
 \

123 ({ uniÚ { 
__ex‹nsiÚ__
 
__Î
; \

124 
__l
[2]; } 
__w
, 
__r
; \

125 ià(
	`__butš_cÚ¡ªt_p
 (
x
)) \

126 
__r
.
__Î
 = 
	`__bsw­_cÚ¡ªt_64
 (
x
); \

129 
__w
.
__Î
 = (
x
); \

130 
__r
.
__l
[0] = 
	`__bsw­_32
 (
__w
.__l[1]); \

131 
__r
.
__l
[1] = 
	`__bsw­_32
 (
__w
.__l[0]); \

133 
__r
.
__Î
; }))

	)

	@/usr/include/bits/endian.h

3 #iâdeà
_ENDIAN_H


7 
	#__BYTE_ORDER
 
__LITTLE_ENDIAN


	)

	@/usr/include/bits/libio-ldbl.h

20 #iâdeà
_IO_STDIO_H


24 
	$__LDBL_REDIR_DECL
 (
_IO_vfsÿnf
)

25 
	`__LDBL_REDIR_DECL
 (
_IO_vårštf
)

	@/usr/include/bits/pthreadtypes.h

20 #iâdeà
_BITS_PTHREADTYPES_H


21 
	#_BITS_PTHREADTYPES_H
 1

	)

23 
	~<b™s/wÜdsize.h
>

25 #ià
__WORDSIZE
 == 64

26 
	#__SIZEOF_PTHREAD_ATTR_T
 56

	)

27 
	#__SIZEOF_PTHREAD_MUTEX_T
 40

	)

28 
	#__SIZEOF_PTHREAD_MUTEXATTR_T
 4

	)

29 
	#__SIZEOF_PTHREAD_COND_T
 48

	)

30 
	#__SIZEOF_PTHREAD_CONDATTR_T
 4

	)

31 
	#__SIZEOF_PTHREAD_RWLOCK_T
 56

	)

32 
	#__SIZEOF_PTHREAD_RWLOCKATTR_T
 8

	)

33 
	#__SIZEOF_PTHREAD_BARRIER_T
 32

	)

34 
	#__SIZEOF_PTHREAD_BARRIERATTR_T
 4

	)

36 
	#__SIZEOF_PTHREAD_ATTR_T
 36

	)

37 
	#__SIZEOF_PTHREAD_MUTEX_T
 24

	)

38 
	#__SIZEOF_PTHREAD_MUTEXATTR_T
 4

	)

39 
	#__SIZEOF_PTHREAD_COND_T
 48

	)

40 
	#__SIZEOF_PTHREAD_CONDATTR_T
 4

	)

41 
	#__SIZEOF_PTHREAD_RWLOCK_T
 32

	)

42 
	#__SIZEOF_PTHREAD_RWLOCKATTR_T
 8

	)

43 
	#__SIZEOF_PTHREAD_BARRIER_T
 20

	)

44 
	#__SIZEOF_PTHREAD_BARRIERATTR_T
 4

	)

50 
	t±h»ad_t
;

55 
	m__size
[
__SIZEOF_PTHREAD_ATTR_T
];

56 
	m__®ign
;

57 } 
	t±h»ad_©Œ_t
;

60 #ià
__WORDSIZE
 == 64

61 
	s__±h»ad_š‹º®_li¡


63 
__±h»ad_š‹º®_li¡
 *
	m__´ev
;

64 
__±h»ad_š‹º®_li¡
 *
	m__Ãxt
;

65 } 
	t__±h»ad_li¡_t
;

67 
	s__±h»ad_š‹º®_¦i¡


69 
__±h»ad_š‹º®_¦i¡
 *
	m__Ãxt
;

70 } 
	t__±h»ad_¦i¡_t
;

78 
	s__±h»ad_mu‹x_s


80 
	m__lock
;

81 
	m__couÁ
;

82 
	m__owÃr
;

83 #ià
__WORDSIZE
 == 64

84 
	m__nu£rs
;

88 
	m__kšd
;

89 #ià
__WORDSIZE
 == 64

90 
	m__¥šs
;

91 
__±h»ad_li¡_t
 
	m__li¡
;

92 
	#__PTHREAD_MUTEX_HAVE_PREV
 1

	)

94 
	m__nu£rs
;

95 
__ex‹nsiÚ__
 union

97 
	m__¥šs
;

98 
__±h»ad_¦i¡_t
 
	m__li¡
;

101 } 
	m__d©a
;

102 
	m__size
[
__SIZEOF_PTHREAD_MUTEX_T
];

103 
	m__®ign
;

104 } 
	t±h»ad_mu‹x_t
;

108 
	m__size
[
__SIZEOF_PTHREAD_MUTEXATTR_T
];

109 
	m__®ign
;

110 } 
	t±h»ad_mu‹x©Œ_t
;

119 
	m__lock
;

120 
	m__fu‹x
;

121 
__ex‹nsiÚ__
 
	m__tÙ®_£q
;

122 
__ex‹nsiÚ__
 
	m__wakeup_£q
;

123 
__ex‹nsiÚ__
 
	m__wok’_£q
;

124 *
	m__mu‹x
;

125 
	m__nwa™”s
;

126 
	m__brßdÿ¡_£q
;

127 } 
	m__d©a
;

128 
	m__size
[
__SIZEOF_PTHREAD_COND_T
];

129 
__ex‹nsiÚ__
 
	m__®ign
;

130 } 
	t±h»ad_cÚd_t
;

134 
	m__size
[
__SIZEOF_PTHREAD_CONDATTR_T
];

135 
	m__®ign
;

136 } 
	t±h»ad_cÚd©Œ_t
;

140 
	t±h»ad_key_t
;

144 
	t±h»ad_Úû_t
;

147 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K


152 #ià
__WORDSIZE
 == 64

155 
	m__lock
;

156 
	m__Ä_»ad”s
;

157 
	m__»ad”s_wakeup
;

158 
	m__wr™”_wakeup
;

159 
	m__Ä_»ad”s_queued
;

160 
	m__Ä_wr™”s_queued
;

161 
	m__wr™”
;

162 
	m__sh¬ed
;

163 
	m__·d1
;

164 
	m__·d2
;

167 
	m__æags
;

168 } 
	m__d©a
;

172 
	m__lock
;

173 
	m__Ä_»ad”s
;

174 
	m__»ad”s_wakeup
;

175 
	m__wr™”_wakeup
;

176 
	m__Ä_»ad”s_queued
;

177 
	m__Ä_wr™”s_queued
;

180 
	m__æags
;

181 
	m__sh¬ed
;

182 
	m__·d1
;

183 
	m__·d2
;

184 
	m__wr™”
;

185 } 
	m__d©a
;

187 
	m__size
[
__SIZEOF_PTHREAD_RWLOCK_T
];

188 
	m__®ign
;

189 } 
	t±h»ad_rwlock_t
;

193 
	m__size
[
__SIZEOF_PTHREAD_RWLOCKATTR_T
];

194 
	m__®ign
;

195 } 
	t±h»ad_rwlock©Œ_t
;

199 #ifdeà
__USE_XOPEN2K


201 vŞ©
	t±h»ad_¥šlock_t
;

208 
	m__size
[
__SIZEOF_PTHREAD_BARRIER_T
];

209 
	m__®ign
;

210 } 
	t±h»ad_b¬r›r_t
;

214 
	m__size
[
__SIZEOF_PTHREAD_BARRIERATTR_T
];

215 
	m__®ign
;

216 } 
	t±h»ad_b¬r›¿‰r_t
;

220 #ià
__WORDSIZE
 == 32

222 
	#__ş—nup_fù_©Œibu‹
 
	`__©Œibu‹__
 ((
	`__»g·rm__
 (1)))

	)

	@/usr/include/bits/stdio-lock.h

20 #iâdeà
_BITS_STDIO_LOCK_H


21 
	#_BITS_STDIO_LOCK_H
 1

	)

23 
	~<b™s/libc-lock.h
>

25 
	$__libc_lock_defše_»cursive
 (, 
_IO_lock_t
)

28 #ifdeà
	t_LIBC_LOCK_RECURSIVE_INITIALIZER


29 
	t_IO_lock_š™Ÿliz”
 
	t_LIBC_LOCK_RECURSIVE_INITIALIZER


	)

30 #–ià
	t_IO_MTSAFE_IO


31 #”rÜ 
	tlibio
 
	tÃeds
 
	t»cursive
 
	tmu‹xes
 
	t_IO_MTSAFE_IO


34 
	t_IO_lock_š™
(
	t_Çme
è
	t__libc_lock_š™_»cursive
 (_Çme)

	)

35 
	t_IO_lock_fši
(
	t_Çme
è
	t__libc_lock_fši_»cursive
 (_Çme)

	)

36 
	t_IO_lock_lock
(
	t_Çme
è
	t__libc_lock_lock_»cursive
 (_Çme)

	)

37 
	t_IO_lock_Œylock
(
	t_Çme
è
	t__libc_lock_Œylock_»cursive
 (_Çme)

	)

38 
	t_IO_lock_uÆock
(
	t_Çme
è
	t__libc_lock_uÆock_»cursive
 (_Çme)

	)

41 
	t_IO_ş—nup_»giÚ_¡¬t
(
	t_fù
, 
	t_å
) \

42 
	t__libc_ş—nup_»giÚ_¡¬t
 (((
	t_å
)->
	t_æags
 & 
	t_IO_USER_LOCK
è=ğ0, 
	t_fù
, _å)

	)

43 
	t_IO_ş—nup_»giÚ_¡¬t_nßrg
(
	t_fù
) \

44 
	t__libc_ş—nup_»giÚ_¡¬t
 (1, 
	t_fù
, 
	tNULL
)

	)

45 
	t_IO_ş—nup_»giÚ_’d
(
	t_do™
) \

46 
	t__libc_ş—nup_»giÚ_’d
 (
	t_do™
)

	)

48 #ià
	tdefšed
 
	t_LIBC
 && !defšed 
	tNOT_IN_libc


49 
	t_IO_acquœe_lock
(
	t_å
) \

50 
	t_IO_ş—nup_»giÚ_¡¬t
 (((*è(*)è
	t_IO_fuÆockfe
, (
	t_å
)); \

51 
	`_IO_æockfe
 (
_å
)

	)

53 
	#_IO_»Ëa£_lock
(
_å
) \

54 
	`_IO_fuÆockfe
 (
_å
); \

55 
	`_IO_ş—nup_»giÚ_’d
 (0)

	)

	@/usr/include/bits/time.h

24 #iâdeà
__Ãed_timev®


25 #iâdeà
_BITS_TIME_H


26 
	#_BITS_TIME_H
 1

	)

34 
	#CLOCKS_PER_SEC
 1000000l

	)

36 #ià!
defšed
 
__STRICT_ANSI__
 && !defšed 
__USE_XOPEN2K


39 
	~<b™s/ty³s.h
>

40 
__syscÚf
 ();

41 
	#CLK_TCK
 ((
__şock_t
è
	`__syscÚf
 (2)è

	)

44 #ifdeà
__USE_POSIX199309


46 
	#CLOCK_REALTIME
 0

	)

48 
	#CLOCK_MONOTONIC
 1

	)

50 
	#CLOCK_PROCESS_CPUTIME_ID
 2

	)

52 
	#CLOCK_THREAD_CPUTIME_ID
 3

	)

54 
	#CLOCK_MONOTONIC_RAW
 4

	)

56 
	#CLOCK_REALTIME_COARSE
 5

	)

58 
	#CLOCK_MONOTONIC_COARSE
 6

	)

61 
	#TIMER_ABSTIME
 1

	)

67 #ifdeà
__Ãed_timev®


68 #undeà
__Ãed_timev®


69 #iâdeà
_STRUCT_TIMEVAL


70 
	#_STRUCT_TIMEVAL
 1

	)

71 
	~<b™s/ty³s.h
>

75 
	stimev®


77 
__time_t
 
	mtv_£c
;

78 
__su£cÚds_t
 
	mtv_u£c
;

	@/usr/include/bits/typesizes.h

20 #iâdeà
_BITS_TYPES_H


24 #iâdef 
_BITS_TYPESIZES_H


25 
	#_BITS_TYPESIZES_H
 1

	)

30 
	#__DEV_T_TYPE
 
__UQUAD_TYPE


	)

31 
	#__UID_T_TYPE
 
__U32_TYPE


	)

32 
	#__GID_T_TYPE
 
__U32_TYPE


	)

33 
	#__INO_T_TYPE
 
__ULONGWORD_TYPE


	)

34 
	#__INO64_T_TYPE
 
__UQUAD_TYPE


	)

35 
	#__MODE_T_TYPE
 
__U32_TYPE


	)

36 
	#__NLINK_T_TYPE
 
__UWORD_TYPE


	)

37 
	#__OFF_T_TYPE
 
__SLONGWORD_TYPE


	)

38 
	#__OFF64_T_TYPE
 
__SQUAD_TYPE


	)

39 
	#__PID_T_TYPE
 
__S32_TYPE


	)

40 
	#__RLIM_T_TYPE
 
__ULONGWORD_TYPE


	)

41 
	#__RLIM64_T_TYPE
 
__UQUAD_TYPE


	)

42 
	#__BLKCNT_T_TYPE
 
__SLONGWORD_TYPE


	)

43 
	#__BLKCNT64_T_TYPE
 
__SQUAD_TYPE


	)

44 
	#__FSBLKCNT_T_TYPE
 
__ULONGWORD_TYPE


	)

45 
	#__FSBLKCNT64_T_TYPE
 
__UQUAD_TYPE


	)

46 
	#__FSFILCNT_T_TYPE
 
__ULONGWORD_TYPE


	)

47 
	#__FSFILCNT64_T_TYPE
 
__UQUAD_TYPE


	)

48 
	#__ID_T_TYPE
 
__U32_TYPE


	)

49 
	#__CLOCK_T_TYPE
 
__SLONGWORD_TYPE


	)

50 
	#__TIME_T_TYPE
 
__SLONGWORD_TYPE


	)

51 
	#__USECONDS_T_TYPE
 
__U32_TYPE


	)

52 
	#__SUSECONDS_T_TYPE
 
__SLONGWORD_TYPE


	)

53 
	#__DADDR_T_TYPE
 
__S32_TYPE


	)

54 
	#__SWBLK_T_TYPE
 
__SLONGWORD_TYPE


	)

55 
	#__KEY_T_TYPE
 
__S32_TYPE


	)

56 
	#__CLOCKID_T_TYPE
 
__S32_TYPE


	)

57 
	#__TIMER_T_TYPE
 *

	)

58 
	#__BLKSIZE_T_TYPE
 
__SLONGWORD_TYPE


	)

59 
	#__FSID_T_TYPE
 sŒuù { 
__v®
[2]; }

	)

60 
	#__SSIZE_T_TYPE
 
__SWORD_TYPE


	)

63 
	#__FD_SETSIZE
 1024

	)

	@/usr/include/bits/uio.h

19 #ià!
defšed
 
_SYS_UIO_H
 && !defšed 
_FCNTL_H


23 #iâdeà
_BITS_UIO_H


24 
	#_BITS_UIO_H
 1

	)

26 
	~<sys/ty³s.h
>

40 
	#UIO_MAXIOV
 1024

	)

44 
	siovec


46 *
	miov_ba£
;

47 
size_t
 
	miov_Ën
;

	@/usr/include/gnu/stubs.h

4 
	~<b™s/wÜdsize.h
>

6 #ià
__WORDSIZE
 == 32

7 
	~<gnu/¡ubs-32.h
>

8 #–ià
__WORDSIZE
 == 64

9 
	~<gnu/¡ubs-64.h
>

	@/usr/include/linux/errno.h

1 #iâdeà
_LINUX_ERRNO_H


2 
	#_LINUX_ERRNO_H


	)

4 
	~<asm/”ºo.h
>

	@/usr/include/sys/cdefs.h

20 #iâdef 
_SYS_CDEFS_H


21 
	#_SYS_CDEFS_H
 1

	)

24 #iâdeà
_FEATURES_H


25 
	~<ã©u»s.h
>

31 #ià
defšed
 
__GNUC__
 && !defšed 
__STDC__


36 #undeà
__P


37 #undeà
__PMT


39 #ifdeà
__GNUC__


46 #ià!
defšed
 
__ılu¥lus
 && 
__GNUC_PREREQ
 (3, 3)

47 
	#__THROW
 
	`__©Œibu‹__
 ((
__nÙhrow__
))

	)

48 
	#__NTH
(
fù
è
	`__©Œibu‹__
 ((
__nÙhrow__
)è
	)
fct

50 #ià
defšed
 
__ılu¥lus
 && 
__GNUC_PREREQ
 (2,8)

51 
	#__THROW
 
	`throw
 ()

	)

52 
	#__NTH
(
fù
èfù 
	`throw
 ()

	)

54 
	#__THROW


	)

55 
	#__NTH
(
fù
è
	)
fct

61 
	#__šlše


	)

63 
	#__THROW


	)

64 
	#__NTH
(
fù
è
	)
fct

66 
	#__cÚ¡
 cÚ¡

	)

67 
	#__sigÃd
 sigÃd

	)

68 
	#__vŞ©e
 vŞ©e

	)

74 
	#__P
(
¬gs
è
	)
args

75 
	#__PMT
(
¬gs
è
	)
args

80 
	#__CONCAT
(
x
,
y
èx ## 
	)
y

81 
	#__STRING
(
x
è#x

	)

84 
	#__±r_t
 *

	)

85 
	#__lÚg_doubË_t
 

	)

89 #ifdef 
__ılu¥lus


90 
	#__BEGIN_DECLS
 "C" {

	)

91 
	#__END_DECLS
 }

	)

93 
	#__BEGIN_DECLS


	)

94 
	#__END_DECLS


	)

103 #ià
defšed
 
__ılu¥lus
 && defšed 
_GLIBCPP_USE_NAMESPACES


104 
	#__BEGIN_NAMESPACE_STD
 
Çme¥aû
 
¡d
 {

	)

105 
	#__END_NAMESPACE_STD
 }

	)

106 
	#__USING_NAMESPACE_STD
(
Çme
è
usšg
 
¡d
::Çme;

	)

107 
	#__BEGIN_NAMESPACE_C99
 
Çme¥aû
 
__c99
 {

	)

108 
	#__END_NAMESPACE_C99
 }

	)

109 
	#__USING_NAMESPACE_C99
(
Çme
è
usšg
 
__c99
::Çme;

	)

114 
	#__BEGIN_NAMESPACE_STD


	)

115 
	#__END_NAMESPACE_STD


	)

116 
	#__USING_NAMESPACE_STD
(
Çme
)

	)

117 
	#__BEGIN_NAMESPACE_C99


	)

118 
	#__END_NAMESPACE_C99


	)

119 
	#__USING_NAMESPACE_C99
(
Çme
)

	)

124 #iâdeà
__BOUNDED_POINTERS__


125 
	#__bounded


	)

126 
	#__unbounded


	)

127 
	#__±rv®ue


	)

132 
	#__bos
(
±r
è
	`__butš_objeù_size
 (±r, 
__USE_FORTIFY_LEVEL
 > 1)

	)

133 
	#__bos0
(
±r
è
	`__butš_objeù_size
 (±r, 0)

	)

135 #ià
__GNUC_PREREQ
 (4,3) \

136 || (
defšed
 
	g__GNUC_RH_RELEASE__
 && 
	g__GNUC__
 == 4 \

137 && 
__GNUC_MINOR__
 =ğ1 && 
__GNUC_PATCHLEVEL__
 == 2 \

138 && 
__GNUC_RH_RELEASE__
 >= 31)

139 
	#__w¬ndeş
(
Çme
, 
msg
) \

140 
	`Çme
 (è
	`__©Œibu‹__
((
	`__w¬nšg__
 (
msg
)))

	)

141 
	#__w¬Ç‰r
(
msg
è
	`__©Œibu‹__
((
	`__w¬nšg__
 (msg)))

	)

142 
	#__”rÜdeş
(
Çme
, 
msg
) \

143 
	`Çme
 (è
	`__©Œibu‹__
((
	`__”rÜ__
 (
msg
)))

	)

145 
	#__w¬ndeş
(
Çme
, 
msg
è
	`Çme
 ()

	)

146 
	#__w¬Ç‰r
(
msg
)

	)

147 
	#__”rÜdeş
(
Çme
, 
msg
è
	`Çme
 ()

	)

151 #ià
__GNUC_PREREQ
 (2,97)

153 
	#__æex¬r
 []

	)

155 #ifdeà
__GNUC__


156 
	#__æex¬r
 [0]

	)

158 #ià
defšed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L

159 
	#__æex¬r
 []

	)

162 
	#__æex¬r
 [1]

	)

178 #ià
defšed
 
__GNUC__
 && __GNUC__ >= 2

180 
	#__REDIRECT
(
Çme
, 
´Ùo
, 
®Ÿs
èÇm´ÙØ
	`__asm__
 (
	`__ASMNAME
 (#®Ÿs))

	)

181 #ifdeà
__ılu¥lus


182 
	#__REDIRECT_NTH
(
Çme
, 
´Ùo
, 
®Ÿs
) \

183 
Çme
 
´Ùo
 
__THROW
 
	`__asm__
 (
	`__ASMNAME
 (#®Ÿs))

	)

185 
	#__REDIRECT_NTH
(
Çme
, 
´Ùo
, 
®Ÿs
) \

186 
Çme
 
´Ùo
 
	`__asm__
 (
	`__ASMNAME
 (#®Ÿs)è
__THROW


	)

188 
	#__ASMNAME
(
úame
è
	`__ASMNAME2
 (
__USER_LABEL_PREFIX__
, cÇme)

	)

189 
	#__ASMNAME2
(
´efix
, 
úame
è
	`__STRING
 (´efixè
	)
cname

202 #ià!
defšed
 
__GNUC__
 || __GNUC__ < 2

203 
	#__©Œibu‹__
(
xyz
è

	)

209 #ià
__GNUC_PREREQ
 (2,96)

210 
	#__©Œibu‹_m®loc__
 
	`__©Œibu‹__
 ((
__m®loc__
))

	)

212 
	#__©Œibu‹_m®loc__


	)

218 #ià
__GNUC_PREREQ
 (2,96)

219 
	#__©Œibu‹_pu»__
 
	`__©Œibu‹__
 ((
__pu»__
))

	)

221 
	#__©Œibu‹_pu»__


	)

227 #ià
__GNUC_PREREQ
 (3,1)

228 
	#__©Œibu‹_u£d__
 
	`__©Œibu‹__
 ((
__u£d__
))

	)

229 
	#__©Œibu‹_nošlše__
 
	`__©Œibu‹__
 ((
__nošlše__
))

	)

231 
	#__©Œibu‹_u£d__
 
	`__©Œibu‹__
 ((
__unu£d__
))

	)

232 
	#__©Œibu‹_nošlše__


	)

236 #ià
__GNUC_PREREQ
 (3,2)

237 
	#__©Œibu‹_d•»ÿ‹d__
 
	`__©Œibu‹__
 ((
__d•»ÿ‹d__
))

	)

239 
	#__©Œibu‹_d•»ÿ‹d__


	)

248 #ià
__GNUC_PREREQ
 (2,8)

249 
	#__©Œibu‹_fÜm©_¬g__
(
x
è
	`__©Œibu‹__
 ((
	`__fÜm©_¬g__
 (x)))

	)

251 
	#__©Œibu‹_fÜm©_¬g__
(
x
è

	)

258 #ià
__GNUC_PREREQ
 (2,97)

259 
	#__©Œibu‹_fÜm©_¡rfmÚ__
(
a
,
b
) \

260 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__¡rfmÚ__
, 
a
, 
b
)))

	)

262 
	#__©Œibu‹_fÜm©_¡rfmÚ__
(
a
,
b
è

	)

267 #ià
__GNUC_PREREQ
 (3,3)

268 
	#__nÚnuÎ
(
·¿ms
è
	`__©Œibu‹__
 ((
__nÚnuÎ__
…¬ams))

	)

270 
	#__nÚnuÎ
(
·¿ms
)

	)

275 #ià
__GNUC_PREREQ
 (3,4)

276 
	#__©Œibu‹_w¬n_unu£d_»suÉ__
 \

277 
	`__©Œibu‹__
 ((
__w¬n_unu£d_»suÉ__
))

	)

278 #ià
__USE_FORTIFY_LEVEL
 > 0

279 
	#__wur
 
__©Œibu‹_w¬n_unu£d_»suÉ__


	)

282 
	#__©Œibu‹_w¬n_unu£d_»suÉ__


	)

284 #iâdeà
__wur


285 
	#__wur


	)

289 #ià
__GNUC_PREREQ
 (3,2)

290 
	#__®ways_šlše
 
__šlše
 
	`__©Œibu‹__
 ((
__®ways_šlše__
))

	)

292 
	#__®ways_šlše
 
__šlše


	)

297 #ià!
defšed
 
__ılu¥lus
 || 
__GNUC_PREREQ
 (4,3) \

298 || (
defšed
 
__GNUC_RH_RELEASE__
 && 
__GNUC__
 == 4 \

299 && 
__GNUC_MINOR__
 =ğ1 && 
__GNUC_PATCHLEVEL__
 == 2 \

300 && 
__GNUC_RH_RELEASE__
 >= 31)

301 #ià
defšed
 
__GNUC_STDC_INLINE__
 || defšed 
__ılu¥lus


302 
	#__ex‹º_šlše
 
__šlše
 
	`__©Œibu‹__
 ((
__gnu_šlše__
))

	)

303 #ià
__GNUC_PREREQ
 (4,3) \

304 || (
defšed
 
__GNUC_RH_RELEASE__
 && 
__GNUC__
 == 4 \

305 && 
__GNUC_MINOR__
 =ğ1 && 
__GNUC_PATCHLEVEL__
 == 2 \

306 && 
__GNUC_RH_RELEASE__
 >= 31)

307 
	#__ex‹º_®ways_šlše
 \

308 
__®ways_šlše
 
	`__©Œibu‹__
 ((
__gnu_šlše__
, 
__¬tificŸl__
))

	)

310 
	#__ex‹º_®ways_šlše
 \

311 
__®ways_šlše
 
	`__©Œibu‹__
 ((
__gnu_šlše__
))

	)

314 
	#__ex‹º_šlše
 
__šlše


	)

315 #ià
__GNUC_PREREQ
 (4,3)

316 
	#__ex‹º_®ways_šlše
 \

317 
__®ways_šlše
 
	`__©Œibu‹__
 ((
__¬tificŸl__
))

	)

319 
	#__ex‹º_®ways_šlše
 
__®ways_šlše


	)

326 #ià
__GNUC_PREREQ
 (4,3) \

327 || (
defšed
 
__GNUC_RH_RELEASE__
 && 
__GNUC__
 == 4 \

328 && 
__GNUC_MINOR__
 =ğ1 && 
__GNUC_PATCHLEVEL__
 == 2 \

329 && 
__GNUC_RH_RELEASE__
 >= 31)

330 
	#__va_¬g_·ck
(è
	`__butš_va_¬g_·ck
 ()

	)

331 
	#__va_¬g_·ck_Ën
(è
	`__butš_va_¬g_·ck_Ën
 ()

	)

338 #ià!
__GNUC_PREREQ
 (2,8)

339 
	#__ex‹nsiÚ__


	)

343 #ià!
__GNUC_PREREQ
 (2,92)

344 
	#__»¡riù


	)

350 #ià
__GNUC_PREREQ
 (3,1è&& !
defšed
 
__GNUG__


351 
	#__»¡riù_¬r
 
__»¡riù


	)

353 #ifdeà
__GNUC__


354 
	#__»¡riù_¬r


	)

356 #ià
defšed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L

357 
	#__»¡riù_¬r
 
»¡riù


	)

360 
	#__»¡riù_¬r


	)

365 #ià
__GNUC__
 >= 3

366 
	#__glibc_uÆik–y
(
cÚd
è
	`__butš_ex³ù
 ((cÚd), 0)

	)

367 
	#__glibc_lik–y
(
cÚd
è
	`__butš_ex³ù
 ((cÚd), 1)

	)

369 
	#__glibc_uÆik–y
(
cÚd
è(cÚd)

	)

370 
	#__glibc_lik–y
(
cÚd
è(cÚd)

	)

373 
	~<b™s/wÜdsize.h
>

375 #ià
defšed
 
__LONG_DOUBLE_MATH_OPTIONAL
 && defšed 
__NO_LONG_DOUBLE_MATH


376 
	#__LDBL_COMPAT
 1

	)

377 #ifdeà
__REDIRECT


378 
	#__LDBL_REDIR1
(
Çme
, 
´Ùo
, 
®Ÿs
è
	`__REDIRECT
 (Çme,…rÙo,‡lŸs)

	)

379 
	#__LDBL_REDIR
(
Çme
, 
´Ùo
) \

380 
	`__LDBL_REDIR1
 (
Çme
, 
´Ùo
, 
__Ædbl_
##Çme)

	)

381 
	#__LDBL_REDIR1_NTH
(
Çme
, 
´Ùo
, 
®Ÿs
è
	`__REDIRECT_NTH
 (Çme,…rÙo,‡lŸs)

	)

382 
	#__LDBL_REDIR_NTH
(
Çme
, 
´Ùo
) \

383 
	`__LDBL_REDIR1_NTH
 (
Çme
, 
´Ùo
, 
__Ædbl_
##Çme)

	)

384 
	#__LDBL_REDIR1_DECL
(
Çme
, 
®Ÿs
) \

385 
	`__ty³of
 (
Çme
èÇm
	`__asm
 (
	`__ASMNAME
 (#®Ÿs));

	)

386 
	#__LDBL_REDIR_DECL
(
Çme
) \

387 
	`__ty³of
 (
Çme
èÇm
	`__asm
 (
	`__ASMNAME
 ("__Ædbl_" #Çme));

	)

388 
	#__REDIRECT_LDBL
(
Çme
, 
´Ùo
, 
®Ÿs
) \

389 
	`__LDBL_REDIR1
 (
Çme
, 
´Ùo
, 
__Ædbl_
##
®Ÿs
)

	)

390 
	#__REDIRECT_NTH_LDBL
(
Çme
, 
´Ùo
, 
®Ÿs
) \

391 
	`__LDBL_REDIR1_NTH
 (
Çme
, 
´Ùo
, 
__Ædbl_
##
®Ÿs
)

	)

394 #ià!
defšed
 
__LDBL_COMPAT
 || !defšed 
__REDIRECT


395 
	#__LDBL_REDIR1
(
Çme
, 
´Ùo
, 
®Ÿs
èÇm
	)
proto

396 
	#__LDBL_REDIR
(
Çme
, 
´Ùo
èÇm
	)
proto

397 
	#__LDBL_REDIR1_NTH
(
Çme
, 
´Ùo
, 
®Ÿs
èÇm´ÙØ
__THROW


	)

398 
	#__LDBL_REDIR_NTH
(
Çme
, 
´Ùo
èÇm´ÙØ
__THROW


	)

399 
	#__LDBL_REDIR_DECL
(
Çme
)

	)

400 #ifdeà
__REDIRECT


401 
	#__REDIRECT_LDBL
(
Çme
, 
´Ùo
, 
®Ÿs
è
	`__REDIRECT
 (Çme,…rÙo,‡lŸs)

	)

402 
	#__REDIRECT_NTH_LDBL
(
Çme
, 
´Ùo
, 
®Ÿs
) \

403 
	`__REDIRECT_NTH
 (
Çme
, 
´Ùo
, 
®Ÿs
)

	)

	@/usr/include/sys/select.h

22 #iâdeà
_SYS_SELECT_H


23 
	#_SYS_SELECT_H
 1

	)

25 
	~<ã©u»s.h
>

28 
	~<b™s/ty³s.h
>

31 
	~<b™s/£Ëù.h
>

34 
	~<b™s/sig£t.h
>

36 #iâdeà
__sig£t_t_defšed


37 
	#__sig£t_t_defšed


	)

38 
__sig£t_t
 
	tsig£t_t
;

42 
	#__Ãed_time_t


	)

43 
	#__Ãed_time¥ec


	)

44 
	~<time.h
>

45 
	#__Ãed_timev®


	)

46 
	~<b™s/time.h
>

48 #iâdeà
__su£cÚds_t_defšed


49 
__su£cÚds_t
 
	tsu£cÚds_t
;

50 
	#__su£cÚds_t_defšed


	)

55 
	t__fd_mask
;

58 #undeà
__NFDBITS


59 #undeà
__FDELT


60 #undeà
__FDMASK


62 
	#__NFDBITS
 (8 * (è (
__fd_mask
))

	)

63 
	#__FDELT
(
d
è((dè/ 
__NFDBITS
)

	)

64 
	#__FDMASK
(
d
è((
__fd_mask
è1 << ((dè% 
__NFDBITS
))

	)

71 #ifdeà
__USE_XOPEN


72 
__fd_mask
 
	mfds_b™s
[
__FD_SETSIZE
 / 
__NFDBITS
];

73 
	#__FDS_BITS
(
£t
è((£t)->
fds_b™s
)

	)

75 
__fd_mask
 
	m__fds_b™s
[
__FD_SETSIZE
 / 
__NFDBITS
];

76 
	#__FDS_BITS
(
£t
è((£t)->
__fds_b™s
)

	)

78 } 
	tfd_£t
;

81 
	#FD_SETSIZE
 
__FD_SETSIZE


	)

83 #ifdeà
__USE_MISC


85 
__fd_mask
 
	tfd_mask
;

88 
	#NFDBITS
 
__NFDBITS


	)

93 
	#FD_SET
(
fd
, 
fd£
è
	`__FD_SET
 (fd, fd£)

	)

94 
	#FD_CLR
(
fd
, 
fd£
è
	`__FD_CLR
 (fd, fd£)

	)

95 
	#FD_ISSET
(
fd
, 
fd£
è
	`__FD_ISSET
 (fd, fd£)

	)

96 
	#FD_ZERO
(
fd£
è
	`__FD_ZERO
 (fd£)

	)

99 
__BEGIN_DECLS


109 
£Ëù
 (
__nfds
, 
fd_£t
 *
__»¡riù
 
__»adfds
,

110 
fd_£t
 *
__»¡riù
 
__wr™efds
,

111 
fd_£t
 *
__»¡riù
 
__exû±fds
,

112 
timev®
 *
__»¡riù
 
__timeout
);

114 #ifdeà
__USE_XOPEN2K


121 
p£Ëù
 (
__nfds
, 
fd_£t
 *
__»¡riù
 
__»adfds
,

122 
fd_£t
 *
__»¡riù
 
__wr™efds
,

123 
fd_£t
 *
__»¡riù
 
__exû±fds
,

124 cÚ¡ 
time¥ec
 *
__»¡riù
 
__timeout
,

125 cÚ¡ 
__sig£t_t
 *
__»¡riù
 
__sigmask
);

128 
	g__END_DECLS


	@/usr/include/sys/sysmacros.h

21 #iâdeà
_SYS_SYSMACROS_H


22 
	#_SYS_SYSMACROS_H
 1

	)

24 
	~<ã©u»s.h
>

29 #ifdeà
__GLIBC_HAVE_LONG_LONG


30 
__ex‹nsiÚ__


31 
	$gnu_dev_majÜ
 (
__dev
)

32 
__THROW
;

33 
__ex‹nsiÚ__


34 
	$gnu_dev_mšÜ
 (
__dev
)

35 
__THROW
;

36 
__ex‹nsiÚ__


37 
	$gnu_dev_makedev
 (
__majÜ
,

38 
__mšÜ
)

39 
__THROW
;

41 #ià
defšed
 
__GNUC__
 && __GNUC__ >ğ2 && defšed 
__USE_EXTERN_INLINES


42 
__ex‹nsiÚ__
 
__ex‹º_šlše
 

43 
	`__NTH
 (
	$gnu_dev_majÜ
 (
__dev
))

45  ((
__dev
 >> 8) & 0xfff) | (() (__dev >> 32) & ~0xfff);

46 
	}
}

48 
__ex‹nsiÚ__
 
__ex‹º_šlše
 

49 
__NTH
 (
	$gnu_dev_mšÜ
 (
__dev
))

51  (
__dev
 & 0xff) | (() (__dev >> 12) & ~0xff);

52 
	}
}

54 
__ex‹nsiÚ__
 
__ex‹º_šlše
 

55 
__NTH
 (
	$gnu_dev_makedev
 (
__majÜ
, 
__mšÜ
))

57  ((
__mšÜ
 & 0xffè| ((
__majÜ
 & 0xfff) << 8)

58 | (((è(
__mšÜ
 & ~0xff)) << 12)

59 | (((è(
__majÜ
 & ~0xfff)) << 32));

60 
	}
}

65 
	#majÜ
(
dev
è
	`gnu_dev_majÜ
 (dev)

	)

66 
	#mšÜ
(
dev
è
	`gnu_dev_mšÜ
 (dev)

	)

67 
	#makedev
(
maj
, 
mš
è
	`gnu_dev_makedev
 (maj, mš)

	)

	@/usr/include/asm/errno.h

1 
	~<asm-g’”ic/”ºo.h
>

	@/usr/include/bits/libc-lock.h

21 #iâdeà
_BITS_LIBC_LOCK_H


22 
	#_BITS_LIBC_LOCK_H
 1

	)

24 
	~<±h»ad.h
>

27 #ifdeà
_IO_MTSAFE_IO


28 
±h»ad_mu‹x_t
 
	t__libc_lock_t
;

29 ¡ruù { 
±h»ad_mu‹x_t
 
	mmu‹x
; } 
	t__libc_lock_»cursive_t
;

30 #ifdeà
__USE_UNIX98


31 
±h»ad_rwlock_t
 
	t__libc_rwlock_t
;

33 
__libc_rwlock_İaque__
 
	t__libc_rwlock_t
;

35 
__libc_lock_»cursive_t
 
	t__¹ld_lock_»cursive_t
;

37 
__libc_lock_İaque__
 
	t__libc_lock_t
;

38 
__libc_lock_»cursive_İaque__
 
	t__libc_lock_»cursive_t
;

39 
__libc_rwlock_İaque__
 
	t__libc_rwlock_t
;

43 
±h»ad_key_t
 
	t__libc_key_t
;

52 
	#__libc_lock_defše
(
CLASS
,
NAME
) \

53 
CLASS
 
__libc_lock_t
 
NAME
;

	)

54 
	#__libc_rwlock_defše
(
CLASS
,
NAME
) \

55 
CLASS
 
__libc_rwlock_t
 
NAME
;

	)

56 
	#__libc_lock_defše_»cursive
(
CLASS
,
NAME
) \

57 
CLASS
 
__libc_lock_»cursive_t
 
NAME
;

	)

58 
	#__¹ld_lock_defše_»cursive
(
CLASS
,
NAME
) \

59 
CLASS
 
__¹ld_lock_»cursive_t
 
NAME
;

	)

70 #ià
__LT_SPINLOCK_INIT
 == 0

71 
	#__libc_lock_defše_š™Ÿlized
(
CLASS
,
NAME
) \

72 
CLASS
 
__libc_lock_t
 
NAME
;

	)

74 
	#__libc_lock_defše_š™Ÿlized
(
CLASS
,
NAME
) \

75 
CLASS
 
__libc_lock_t
 
NAME
 = 
PTHREAD_MUTEX_INITIALIZER
;

	)

78 
	#__libc_rwlock_defše_š™Ÿlized
(
CLASS
,
NAME
) \

79 
CLASS
 
__libc_rwlock_t
 
NAME
 = 
PTHREAD_RWLOCK_INITIALIZER
;

	)

83 
	#__libc_lock_defše_š™Ÿlized_»cursive
(
CLASS
,
NAME
) \

84 
CLASS
 
__libc_lock_»cursive_t
 
NAME
 = 
_LIBC_LOCK_RECURSIVE_INITIALIZER
;

	)

85 
	#_LIBC_LOCK_RECURSIVE_INITIALIZER
 \

86 {
PTHREAD_RECURSIVE_MUTEX_INITIALIZER_NP
}

	)

88 
	#__¹ld_lock_defše_š™Ÿlized_»cursive
(
CLASS
,
NAME
) \

89 
CLASS
 
__¹ld_lock_»cursive_t
 
NAME
 = 
_RTLD_LOCK_RECURSIVE_INITIALIZER
;

	)

90 
	#_RTLD_LOCK_RECURSIVE_INITIALIZER
 \

91 {
PTHREAD_RECURSIVE_MUTEX_INITIALIZER_NP
}

	)

93 #ià
defšed
 
__PIC__


94 
	#__libc_maybe_ÿÎ
(
FUNC
, 
ARGS
, 
ELSE
) \

95 (
	`__ex‹nsiÚ__
 ({ 
	`__ty³of
 (
FUNC
è*
_â
 = (FUNC); \

96 
_â
 !ğ
NULL
 ? (*_âè
ARGS
 : 
ELSE
; }))

	)

98 
	#__libc_maybe_ÿÎ
(
FUNC
, 
ARGS
, 
ELSE
) \

99 (
FUNC
 !ğ
NULL
 ? FUNC 
ARGS
 : 
ELSE
)

	)

101 
	#__libc_maybe_ÿÎ2
(
FUNC
, 
ARGS
, 
ELSE
è
	`__libc_maybe_ÿÎ
 (
__
##FUNC, ARGS, ELSE)

	)

105 
	#__libc_lock_š™
(
NAME
) \

106 (
	`__libc_maybe_ÿÎ2
 (
±h»ad_mu‹x_š™
, (&(
NAME
), 
NULL
), 0))

	)

107 
	#__libc_rwlock_š™
(
NAME
) \

108 (
	`__libc_maybe_ÿÎ
 (
__±h»ad_rwlock_š™
, (&(
NAME
), 
NULL
), 0));

	)

111 
	#__libc_lock_š™_»cursive
(
NAME
) \

113 ià(
__±h»ad_mu‹x_š™
 !ğ
NULL
) \

115 
±h»ad_mu‹x©Œ_t
 
__©Œ
; \

116 
	`__±h»ad_mu‹x©Œ_š™
 (&
__©Œ
); \

117 
	`__±h»ad_mu‹x©Œ_£‰y³
 (&
__©Œ
, 
PTHREAD_MUTEX_RECURSIVE_NP
); \

118 
	`__±h»ad_mu‹x_š™
 (&(
NAME
).
mu‹x
, &
__©Œ
); \

119 
	`__±h»ad_mu‹x©Œ_de¡roy
 (&
__©Œ
); \

121 } 0);

	)

122 
	#__¹ld_lock_š™_»cursive
(
NAME
) \

123 
	`__libc_lock_š™_»cursive
 (
NAME
)

	)

128 
	#__libc_lock_fši
(
NAME
) \

129 (
	`__libc_maybe_ÿÎ2
 (
±h»ad_mu‹x_de¡roy
, (&(
NAME
)), 0));

	)

130 
	#__libc_rwlock_fši
(
NAME
) \

131 (
	`__libc_maybe_ÿÎ
 (
__±h»ad_rwlock_de¡roy
, (&(
NAME
)), 0));

	)

134 
	#__libc_lock_fši_»cursive
(
NAME
è
	`__libc_lock_fši
 ((NAME).
mu‹x
)

	)

135 
	#__¹ld_lock_fši_»cursive
(
NAME
è
	`__libc_lock_fši_»cursive
 (NAME)

	)

138 
	#__libc_lock_lock
(
NAME
) \

139 (
	`__libc_maybe_ÿÎ2
 (
±h»ad_mu‹x_lock
, (&(
NAME
)), 0));

	)

140 
	#__libc_rwlock_rdlock
(
NAME
) \

141 (
	`__libc_maybe_ÿÎ
 (
__±h»ad_rwlock_rdlock
, (&(
NAME
)), 0));

	)

142 
	#__libc_rwlock_w¾ock
(
NAME
) \

143 (
	`__libc_maybe_ÿÎ
 (
__±h»ad_rwlock_w¾ock
, (&(
NAME
)), 0));

	)

146 
	#__libc_lock_lock_»cursive
(
NAME
è
	`__libc_lock_lock
 ((NAME).
mu‹x
)

	)

149 
	#__libc_lock_Œylock
(
NAME
) \

150 (
	`__libc_maybe_ÿÎ2
 (
±h»ad_mu‹x_Œylock
, (&(
NAME
)), 0))

	)

151 
	#__libc_rwlock_Œyrdlock
(
NAME
) \

152 (
	`__libc_maybe_ÿÎ
 (
__±h»ad_rwlock_Œyrdlock
, (&(
NAME
)), 0))

	)

153 
	#__libc_rwlock_Œyw¾ock
(
NAME
) \

154 (
	`__libc_maybe_ÿÎ
 (
__±h»ad_rwlock_Œyw¾ock
, (&(
NAME
)), 0))

	)

157 
	#__libc_lock_Œylock_»cursive
(
NAME
è
	`__libc_lock_Œylock
 ((NAME).
mu‹x
)

	)

158 
	#__¹ld_lock_Œylock_»cursive
(
NAME
) \

159 
	`__libc_lock_Œylock_»cursive
 (
NAME
)

	)

162 
	#__libc_lock_uÆock
(
NAME
) \

163 (
	`__libc_maybe_ÿÎ2
 (
±h»ad_mu‹x_uÆock
, (&(
NAME
)), 0));

	)

164 
	#__libc_rwlock_uÆock
(
NAME
) \

165 (
	`__libc_maybe_ÿÎ
 (
__±h»ad_rwlock_uÆock
, (&(
NAME
)), 0));

	)

168 
	#__libc_lock_uÆock_»cursive
(
NAME
è
	`__libc_lock_uÆock
 ((NAME).
mu‹x
)

	)

170 
	#__¹ld_lock_lock_»cursive
(
NAME
è
	`__libc_lock_lock_»cursive
 (NAME)

	)

171 
	#__¹ld_lock_uÆock_»cursive
(
NAME
è
	`__libc_lock_uÆock_»cursive
 (NAME)

	)

174 #ià
PTHREAD_ONCE_INIT
 == 0

177 
	#__libc_Úû_defše
(
CLASS
, 
NAME
) \

178 
CLASS
 
±h»ad_Úû_t
 
NAME


	)

180 
	#__libc_Úû_defše
(
CLASS
, 
NAME
) \

181 
CLASS
 
±h»ad_Úû_t
 
NAME
 = 
PTHREAD_ONCE_INIT


	)

185 
	#__libc_Úû
(
ONCE_CONTROL
, 
INIT_FUNCTION
) \

187 ià(
__±h»ad_Úû
 !ğ
NULL
) \

188 
	`__±h»ad_Úû
 (&(
ONCE_CONTROL
), (
INIT_FUNCTION
)); \

189 ià((
ONCE_CONTROL
è=ğ
PTHREAD_ONCE_INIT
) { \

190 
	`INIT_FUNCTION
 (); \

191 (
ONCE_CONTROL
) = 2; \

193 } 0)

	)

197 
	#__libc_ş—nup_»giÚ_¡¬t
(
DOIT
, 
FCT
, 
ARG
) \

198 { 
_±h»ad_ş—nup_bufãr
 
_bufãr
; \

199 
_ava
 = (
DOIT
è&& 
_±h»ad_ş—nup_push_deãr
 !ğ
NULL
; \

200 ià(
_ava
) { \

201 
	`_±h»ad_ş—nup_push_deãr
 (&
_bufãr
, (
FCT
), (
ARG
)); \

202 }

	)

205 
	#__libc_ş—nup_»giÚ_’d
(
DOIT
) \

206 ià(
_ava
) { \

207 
	`_±h»ad_ş—nup_pİ_»¡Üe
 (&
_bufãr
, (
DOIT
)); \

209 }

	)

212 
	#__libc_ş—nup_’d
(
DOIT
) \

213 ià(
_ava
) { \

214 
	`_±h»ad_ş—nup_pİ_»¡Üe
 (&
_bufãr
, (
DOIT
)); \

215 }

	)

217 
	#__libc_ş—nup_push
(
fù
, 
¬g
) \

218 { 
_±h»ad_ş—nup_bufãr
 
_bufãr
; \

219 
	`__libc_maybe_ÿÎ
 (
_±h»ad_ş—nup_push
, (&
_bufãr
, (
fù
), (
¬g
)), 0)

	)

221 
	#__libc_ş—nup_pİ
(
execu‹
) \

222 
	`__libc_maybe_ÿÎ
 (
_±h»ad_ş—nup_pİ
, (&
_bufãr
, 
execu‹
), 0); \

223 }

	)

226 
	#__libc_key_ü—‹
(
KEY
, 
DESTRUCTOR
) \

227 (
	`__libc_maybe_ÿÎ
 (
__±h»ad_key_ü—‹
, (
KEY
, 
DESTRUCTOR
), 1))

	)

230 
	#__libc_g‘¥ecific
(
KEY
) \

231 (
	`__libc_maybe_ÿÎ
 (
__±h»ad_g‘¥ecific
, (
KEY
), 
NULL
))

	)

234 
	#__libc_£t¥ecific
(
KEY
, 
VALUE
) \

235 (
	`__libc_maybe_ÿÎ
 (
__±h»ad_£t¥ecific
, (
KEY
, 
VALUE
), 0))

	)

239 
	#__libc_©fÜk
(
PREPARE
, 
PARENT
, 
CHILD
) \

240 (
	`__libc_maybe_ÿÎ
 (
__±h»ad_©fÜk
, (
PREPARE
, 
PARENT
, 
CHILD
), 0))

	)

242 
__BEGIN_DECLS


244 
_±h»ad_ş—nup_push_deãr
 (
_±h»ad_ş—nup_bufãr
 *
__bufãr
,

245 (*
__routše
) (*),

246 *
__¬g
è
__THROW
;

248 
	$_±h»ad_ş—nup_pİ_»¡Üe
 (
_±h»ad_ş—nup_bufãr
 *
__bufãr
,

249 
__execu‹
è
__THROW
;

255 
	`__±h»ad_mu‹x_š™
 (
±h»ad_mu‹x_t
 *
__mu‹x
,

256 
__cÚ¡
 
±h»ad_mu‹x©Œ_t
 *
__mu‹x_©Œ
);

258 
	`__±h»ad_mu‹x_de¡roy
 (
±h»ad_mu‹x_t
 *
__mu‹x
);

260 
	`__±h»ad_mu‹x_Œylock
 (
±h»ad_mu‹x_t
 *
__mu‹x
);

262 
	`__±h»ad_mu‹x_lock
 (
±h»ad_mu‹x_t
 *
__mu‹x
);

264 
	`__±h»ad_mu‹x_uÆock
 (
±h»ad_mu‹x_t
 *
__mu‹x
);

266 
	`__±h»ad_mu‹x©Œ_š™
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
);

268 
	`__±h»ad_mu‹x©Œ_de¡roy
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
);

270 
	`__±h»ad_mu‹x©Œ_£‰y³
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
,

271 
__kšd
);

273 #ifdeà
__USE_UNIX98


274 
	`__±h»ad_rwlock_š™
 (
±h»ad_rwlock_t
 *
__rwlock
,

275 
__cÚ¡
 
±h»ad_rwlock©Œ_t
 *
__©Œ
);

277 
	`__±h»ad_rwlock_de¡roy
 (
±h»ad_rwlock_t
 *
__rwlock
);

279 
	`__±h»ad_rwlock_rdlock
 (
±h»ad_rwlock_t
 *
__rwlock
);

281 
	`__±h»ad_rwlock_Œyrdlock
 (
±h»ad_rwlock_t
 *
__rwlock
);

283 
	`__±h»ad_rwlock_w¾ock
 (
±h»ad_rwlock_t
 *
__rwlock
);

285 
	`__±h»ad_rwlock_Œyw¾ock
 (
±h»ad_rwlock_t
 *
__rwlock
);

287 
	`__±h»ad_rwlock_uÆock
 (
±h»ad_rwlock_t
 *
__rwlock
);

290 
	`__±h»ad_key_ü—‹
 (
±h»ad_key_t
 *
__key
,

291 (*
__de¡r_funùiÚ
) (*));

293 
	`__±h»ad_£t¥ecific
 (
±h»ad_key_t
 
__key
,

294 
__cÚ¡
 *
__poš‹r
);

296 *
	`__±h»ad_g‘¥ecific
 (
±h»ad_key_t
 
__key
);

298 
	`__±h»ad_Úû
 (
±h»ad_Úû_t
 *
__Úû_cÚŒŞ
,

299 (*
__š™_routše
) ());

301 
	`__±h»ad_©fÜk
 ((*
__´•¬e
) (),

302 (*
__·»Á
) (),

303 (*
__chd
) ());

305 
__END_DECLS


309 #iâdeà
__NO_WEAK_PTHREAD_ALIASES


310 #´agm¨
w—k
 
__±h»ad_mu‹x_š™


311 #´agm¨
w—k
 
__±h»ad_mu‹x_de¡roy


312 #´agm¨
w—k
 
__±h»ad_mu‹x_lock


313 #´agm¨
w—k
 
__±h»ad_mu‹x_Œylock


314 #´agm¨
w—k
 
__±h»ad_mu‹x_uÆock


315 #´agm¨
w—k
 
__±h»ad_mu‹x©Œ_š™


316 #´agm¨
w—k
 
__±h»ad_mu‹x©Œ_de¡roy


317 #´agm¨
w—k
 
__±h»ad_mu‹x©Œ_£‰y³


318 #´agm¨
w—k
 
__±h»ad_rwlock_de¡roy


319 #´agm¨
w—k
 
__±h»ad_rwlock_rdlock


320 #´agm¨
w—k
 
__±h»ad_rwlock_Œyrdlock


321 #´agm¨
w—k
 
__±h»ad_rwlock_w¾ock


322 #´agm¨
w—k
 
__±h»ad_rwlock_Œyw¾ock


323 #´agm¨
w—k
 
__±h»ad_rwlock_uÆock


324 #´agm¨
w—k
 
__±h»ad_key_ü—‹


325 #´agm¨
w—k
 
__±h»ad_£t¥ecific


326 #´agm¨
w—k
 
__±h»ad_g‘¥ecific


327 #´agm¨
w—k
 
__±h»ad_Úû


328 #´agm¨
w—k
 
__±h»ad_š™Ÿlize


329 #´agm¨
w—k
 
__±h»ad_©fÜk


330 #´agm¨
w—k
 
_±h»ad_ş—nup_push_deãr


331 #´agm¨
w—k
 
_±h»ad_ş—nup_pİ_»¡Üe


332 #´agm¨
w—k
 
_±h»ad_ş—nup_push


333 #´agm¨
w—k
 
_±h»ad_ş—nup_pİ


338 
	#__libc_mu‹x_uÆock
 
__±h»ad_mu‹x_uÆock


	)

	@/usr/include/bits/select.h

19 #iâdeà
_SYS_SELECT_H


23 
	~<b™s/wÜdsize.h
>

26 #ià
defšed
 
__GNUC__
 && __GNUC__ >= 2

28 #ià
__WORDSIZE
 == 64

29 
	#__FD_ZERO_STOS
 "¡osq"

	)

31 
	#__FD_ZERO_STOS
 "¡o¦"

	)

34 
	#__FD_ZERO
(
fd¥
) \

36 
__d0
, 
__d1
; \

37 
__asm__
 
	`__vŞ©e__
 ("şd;„•; " 
__FD_ZERO_STOS
 \

38 : "=c" (
__d0
), "=D" (
__d1
) \

39 : "a" (0), "0" ( (
fd_£t
) \

40 /  (
__fd_mask
)), \

41 "1" (&
	`__FDS_BITS
 (
fd¥
)[0]) \

43 } 0)

	)

49 
	#__FD_ZERO
(
£t
) \

51 
__i
; \

52 
fd_£t
 *
__¬r
 = (
£t
); \

53 
__i
 = 0; __˜<  (
fd_£t
è/  (
__fd_mask
); ++__i) \

54 
	`__FDS_BITS
 (
__¬r
)[
__i
] = 0; \

55 } 0)

	)

59 
	#__FD_SET
(
d
, 
£t
è(
	`__FDS_BITS
 (£t)[
	`__FDELT
 (d)] |ğ
	`__FDMASK
 (d))

	)

60 
	#__FD_CLR
(
d
, 
£t
è(
	`__FDS_BITS
 (£t)[
	`__FDELT
 (d)] &ğ~
	`__FDMASK
 (d))

	)

61 
	#__FD_ISSET
(
d
, 
£t
) \

62 ((
	`__FDS_BITS
 (
£t
)[
	`__FDELT
 (
d
)] & 
	`__FDMASK
 (d)è!ğ0)

	)

	@/usr/include/bits/sigset.h

21 #iâdef 
_SIGSET_H_ty³s


22 
	#_SIGSET_H_ty³s
 1

	)

24 
	t__sig_©omic_t
;

28 
	#_SIGSET_NWORDS
 (1024 / (8 *  ()))

	)

31 
	m__v®
[
_SIGSET_NWORDS
];

32 } 
	t__sig£t_t
;

43 #ià!
defšed
 
_SIGSET_H_âs
 && defšed 
_SIGNAL_H


44 
	#_SIGSET_H_âs
 1

	)

46 #iâdeà
_EXTERN_INLINE


47 
	#_EXTERN_INLINE
 
__ex‹º_šlše


	)

51 
	#__sigmask
(
sig
) \

52 (((è1è<< (((
sig
è- 1è% (8 *  ())))

	)

55 
	#__sigwÜd
(
sig
è(((sigè- 1è/ (8 *  ()))

	)

57 #ià
defšed
 
__GNUC__
 && __GNUC__ >= 2

58 
	#__sigem±y£t
(
£t
) \

59 (
	`__ex‹nsiÚ__
 ({ 
__út
 = 
_SIGSET_NWORDS
; \

60 
sig£t_t
 *
__£t
 = (
£t
); \

61 --
__út
 >ğ0è
__£t
->
__v®
[__cnt] = 0; \

62 0; }))

	)

63 
	#__sigfl£t
(
£t
) \

64 (
	`__ex‹nsiÚ__
 ({ 
__út
 = 
_SIGSET_NWORDS
; \

65 
sig£t_t
 *
__£t
 = (
£t
); \

66 --
__út
 >ğ0è
__£t
->
__v®
[__cnt] = ~0UL; \

67 0; }))

	)

69 #ifdeà
__USE_GNU


73 
	#__sigi£m±y£t
(
£t
) \

74 (
	`__ex‹nsiÚ__
 ({ 
__út
 = 
_SIGSET_NWORDS
; \

75 cÚ¡ 
sig£t_t
 *
__£t
 = (
£t
); \

76 
__»t
 = 
__£t
->
__v®
[--
__út
]; \

77 !
__»t
 && --
__út
 >= 0) \

78 
__»t
 = 
__£t
->
__v®
[
__út
]; \

79 
__»t
 =ğ0; }))

	)

80 
	#__sigªd£t
(
de¡
, 
Ëá
, 
right
) \

81 (
	`__ex‹nsiÚ__
 ({ 
__út
 = 
_SIGSET_NWORDS
; \

82 
sig£t_t
 *
__de¡
 = (
de¡
); \

83 cÚ¡ 
sig£t_t
 *
__Ëá
 = (
Ëá
); \

84 cÚ¡ 
sig£t_t
 *
__right
 = (
right
); \

85 --
__út
 >= 0) \

86 
__de¡
->
__v®
[
__út
] = (
__Ëá
->__val[__cnt] \

87 & 
__right
->
__v®
[
__út
]); \

88 0; }))

	)

89 
	#__sigÜ£t
(
de¡
, 
Ëá
, 
right
) \

90 (
	`__ex‹nsiÚ__
 ({ 
__út
 = 
_SIGSET_NWORDS
; \

91 
sig£t_t
 *
__de¡
 = (
de¡
); \

92 cÚ¡ 
sig£t_t
 *
__Ëá
 = (
Ëá
); \

93 cÚ¡ 
sig£t_t
 *
__right
 = (
right
); \

94 --
__út
 >= 0) \

95 
__de¡
->
__v®
[
__út
] = (
__Ëá
->__val[__cnt] \

96 | 
__right
->
__v®
[
__út
]); \

97 0; }))

	)

104 
__sigismemb”
 (
__cÚ¡
 
__sig£t_t
 *, );

105 
__sigadd£t
 (
__sig£t_t
 *, );

106 
__sigd–£t
 (
__sig£t_t
 *, );

108 #ifdeà
__USE_EXTERN_INLINES


109 
	#__SIGSETFN
(
NAME
, 
BODY
, 
CONST
) \

110 
_EXTERN_INLINE
 \

111 
	`NAME
 (
CONST
 
__sig£t_t
 *
__£t
, 
__sig
) \

113 
__mask
 = 
	`__sigmask
 (
__sig
); \

114 
__wÜd
 = 
	`__sigwÜd
 (
__sig
); \

115  
BODY
; \

116 }

	)

118 
__SIGSETFN
 (
__sigismemb”
, (
__£t
->
__v®
[
__wÜd
] & 
__mask
è? 1 : 0, 
__cÚ¡
)

119 
__SIGSETFN
 (
__sigadd£t
, ((
__£t
->
__v®
[
__wÜd
] |ğ
__mask
), 0), )

120 
__SIGSETFN
 (
__sigd–£t
, ((
__£t
->
__v®
[
__wÜd
] &ğ~
__mask
), 0), )

122 #undeà
__SIGSETFN


	@/usr/include/gconv.h

23 #iâdeà
_GCONV_H


24 
	#_GCONV_H
 1

	)

26 
	~<ã©u»s.h
>

27 
	#__Ãed_mb¡©e_t


	)

28 
	#__Ãed_wšt_t


	)

29 
	~<wch¬.h
>

30 
	#__Ãed_size_t


	)

31 
	#__Ãed_wch¬_t


	)

32 
	~<¡ddef.h
>

35 
	#__UNKNOWN_10646_CHAR
 ((
wch¬_t
è0xfffd)

	)

40 
	m__GCONV_OK
 = 0,

41 
	m__GCONV_NOCONV
,

42 
	m__GCONV_NODB
,

43 
	m__GCONV_NOMEM
,

45 
	m__GCONV_EMPTY_INPUT
,

46 
	m__GCONV_FULL_OUTPUT
,

47 
	m__GCONV_ILLEGAL_INPUT
,

48 
	m__GCONV_INCOMPLETE_INPUT
,

50 
	m__GCONV_ILLEGAL_DESCRIPTOR
,

51 
	m__GCONV_INTERNAL_ERROR


58 
	m__GCONV_IS_LAST
 = 0x0001,

59 
	m__GCONV_IGNORE_ERRORS
 = 0x0002

64 
	g__gcÚv_¡•
;

65 
	g__gcÚv_¡•_d©a
;

66 
	g__gcÚv_lßded_objeù
;

67 
	g__gcÚv_Œªs_d©a
;

71 (*
	t__gcÚv_fù
è(
	t__gcÚv_¡•
 *, 
	t__gcÚv_¡•_d©a
 *,

72 
	t__cÚ¡
 **, __const *,

73 **, 
	tsize_t
 *, , );

76 
	$wšt_t
 (*
	t__gcÚv_btowc_fù
è(
	t__gcÚv_¡•
 *, );

79 (*
	t__gcÚv_š™_fù
è(
	t__gcÚv_¡•
 *);

80 (*
	t__gcÚv_’d_fù
è(
	t__gcÚv_¡•
 *);

84 (*
	t__gcÚv_Œªs_fù
è(
	t__gcÚv_¡•
 *,

85 
	t__gcÚv_¡•_d©a
 *, *,

86 
	t__cÚ¡
 *,

87 
	t__cÚ¡
 **,

88 
	t__cÚ¡
 *, **,

89 
	tsize_t
 *);

92 (*
	t__gcÚv_Œªs_cÚ‹xt_fù
è(*, 
	t__cÚ¡
 *,

93 
	t__cÚ¡
 *,

97 (*
	t__gcÚv_Œªs_qu”y_fù
è(
	t__cÚ¡
 *, __const ***,

98 
	tsize_t
 *);

101 (*
	t__gcÚv_Œªs_š™_fù
) (**, const *);

102 (*
	t__gcÚv_Œªs_’d_fù
) (*);

104 
	s__gcÚv_Œªs_d©a


107 
__gcÚv_Œªs_fù
 
__Œªs_fù
;

108 
__gcÚv_Œªs_cÚ‹xt_fù
 
__Œªs_cÚ‹xt_fù
;

109 
__gcÚv_Œªs_’d_fù
 
__Œªs_’d_fù
;

110 *
__d©a
;

111 
__gcÚv_Œªs_d©a
 *
__Ãxt
;

116 
	s__gcÚv_¡•


118 
__gcÚv_lßded_objeù
 *
__shlib_hªdË
;

119 
__cÚ¡
 *
__modÇme
;

121 
__couÁ”
;

123 *
__äom_Çme
;

124 *
__to_Çme
;

126 
__gcÚv_fù
 
__fù
;

127 
__gcÚv_btowc_fù
 
__btowc_fù
;

128 
__gcÚv_š™_fù
 
__š™_fù
;

129 
__gcÚv_’d_fù
 
__’d_fù
;

133 
__mš_Ãeded_äom
;

134 
__max_Ãeded_äom
;

135 
__mš_Ãeded_to
;

136 
__max_Ãeded_to
;

139 
__¡©eful
;

141 *
__d©a
;

146 
	s__gcÚv_¡•_d©a


148 *
__outbuf
;

149 *
__outbuãnd
;

153 
__æags
;

157 
__švoÿtiÚ_couÁ”
;

161 
__š‹º®_u£
;

163 
__mb¡©e_t
 *
__¡©•
;

164 
__mb¡©e_t
 
__¡©e
;

168 
__gcÚv_Œªs_d©a
 *
__Œªs
;

173 
	s__gcÚv_šfo


175 
size_t
 
__n¡•s
;

176 
__gcÚv_¡•
 *
__¡•s
;

177 
__ex‹nsiÚ__
 
__gcÚv_¡•_d©a
 
__d©a
 
__æex¬r
;

178 } *
	t__gcÚv_t
;

	@/usr/include/gnu/stubs-32.h

6 #ifdeà
_LIBC


7 #”rÜ 
AµliÿtiÚs
 
may
 
nÙ
 
defše
 
the
 
maüo
 
_LIBC


10 
	#__¡ub___k”Ãl_co¦


	)

11 
	#__¡ub___k”Ãl_sšl


	)

12 
	#__¡ub___k”Ãl_Æ


	)

13 
	#__¡ub_chæags


	)

14 
	#__¡ub_ç‰ach


	)

15 
	#__¡ub_fchæags


	)

16 
	#__¡ub_fd‘ach


	)

17 
	#__¡ub_g‰y


	)

18 
	#__¡ub_lchmod


	)

19 
	#__¡ub_»voke


	)

20 
	#__¡ub_£ogš


	)

21 
	#__¡ub_sig»tuº


	)

22 
	#__¡ub_s¡k


	)

23 
	#__¡ub_¡ty


	)

	@/usr/include/gnu/stubs-64.h

6 #ifdeà
_LIBC


7 #”rÜ 
AµliÿtiÚs
 
may
 
nÙ
 
defše
 
the
 
maüo
 
_LIBC


10 
	#__¡ub_bdæush


	)

11 
	#__¡ub_chæags


	)

12 
	#__¡ub_ç‰ach


	)

13 
	#__¡ub_fchæags


	)

14 
	#__¡ub_fd‘ach


	)

15 
	#__¡ub_g‘msg


	)

16 
	#__¡ub_g‰y


	)

17 
	#__¡ub_lchmod


	)

18 
	#__¡ub_putmsg


	)

19 
	#__¡ub_»voke


	)

20 
	#__¡ub_£ogš


	)

21 
	#__¡ub_sig»tuº


	)

22 
	#__¡ub_s¡k


	)

23 
	#__¡ub_¡ty


	)

	@/usr/include/wchar.h

24 #iâdeà
_WCHAR_H


26 #ià!
defšed
 
__Ãed_mb¡©e_t
 && !defšed 
__Ãed_wšt_t


27 
	#_WCHAR_H
 1

	)

28 
	~<ã©u»s.h
>

31 #ifdeà
_WCHAR_H


33 
	#__Ãed___FILE


	)

34 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K


35 
	#__Ãed_FILE


	)

37 
	~<¡dio.h
>

39 
	#__Ãed___va_li¡


	)

40 
	~<¡d¬g.h
>

42 
	~<b™s/wch¬.h
>

45 
	#__Ãed_size_t


	)

46 
	#__Ãed_wch¬_t


	)

47 
	#__Ãed_NULL


	)

49 #ià
defšed
 
_WCHAR_H
 || defšed 
__Ãed_wšt_t
 || !defšed 
__WINT_TYPE__


50 #undeà
__Ãed_wšt_t


51 
	#__Ãed_wšt_t


	)

52 
	~<¡ddef.h
>

56 #iâdeà
_WINT_T


61 
	#_WINT_T


	)

62 
	twšt_t
;

66 #ià
defšed
 
__ılu¥lus
 && defšed 
_GLIBCPP_USE_NAMESPACES
 \

67 && 
defšed
 
__WINT_TYPE__


68 
__BEGIN_NAMESPACE_STD


69 
__WINT_TYPE__
 
	twšt_t
;

70 
	g__END_NAMESPACE_STD


75 #ià
defšed
 
__ılu¥lus
 && 
__GNUC_PREREQ
 (4, 4)

76 
	#__CORRECT_ISO_CPP_WCHAR_H_PROTO


	)

80 #ià(
defšed
 
_WCHAR_H
 || defšed 
__Ãed_mb¡©e_t
è&& !defšed 
__mb¡©e_t_defšed


81 
	#__mb¡©e_t_defšed
 1

	)

85 
	m__couÁ
;

88 #ifdeà
__WINT_TYPE__


89 
__WINT_TYPE__
 
	m__wch
;

91 
wšt_t
 
	m__wch
;

93 
	m__wchb
[4];

94 } 
	m__v®ue
;

95 } 
	t__mb¡©e_t
;

97 #undeà
__Ãed_mb¡©e_t


102 #ifdeà
_WCHAR_H


104 
__BEGIN_NAMESPACE_C99


106 
__mb¡©e_t
 
	tmb¡©e_t
;

107 
	g__END_NAMESPACE_C99


108 #ifdeà
__USE_GNU


109 
	$__USING_NAMESPACE_C99
(
mb¡©e_t
)

112 #iâdeà
WCHAR_MIN


114 
	#WCHAR_MIN
 
__WCHAR_MIN


	)

115 
	#WCHAR_MAX
 
__WCHAR_MAX


	)

118 #iâdeà
WEOF


119 
	#WEOF
 (0xffffffffu)

	)

124 #ià
defšed
 
__USE_XOPEN
 && !defšed 
__USE_UNIX98


125 
	~<wùy³.h
>

129 
__BEGIN_DECLS


131 
__BEGIN_NAMESPACE_STD


134 
tm
;

135 
__END_NAMESPACE_STD


139 
	$__USING_NAMESPACE_STD
(
tm
)

142 
__BEGIN_NAMESPACE_STD


144 
wch¬_t
 *
	$wcsıy
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

145 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__¤c
è
__THROW
;

147 
wch¬_t
 *
	$wc¢ıy
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

148 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

149 
__THROW
;

152 
wch¬_t
 *
	$wcsÿt
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

153 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__¤c
è
__THROW
;

155 
wch¬_t
 *
	$wc¢ÿt
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

156 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

157 
__THROW
;

160 
	$wcscmp
 (
__cÚ¡
 
wch¬_t
 *
__s1
, __cÚ¡ wch¬_ˆ*
__s2
)

161 
__THROW
 
__©Œibu‹_pu»__
;

163 
	$wc¢cmp
 (
__cÚ¡
 
wch¬_t
 *
__s1
, __cÚ¡ wch¬_ˆ*
__s2
, 
size_t
 
__n
)

164 
__THROW
 
__©Œibu‹_pu»__
;

165 
__END_NAMESPACE_STD


167 #ifdeà
__USE_XOPEN2K8


169 
	$wcsÿ£cmp
 (
__cÚ¡
 
wch¬_t
 *
__s1
, __cÚ¡ wch¬_ˆ*
__s2
è
__THROW
;

172 
	$wc¢ÿ£cmp
 (
__cÚ¡
 
wch¬_t
 *
__s1
, __cÚ¡ wch¬_ˆ*
__s2
,

173 
size_t
 
__n
è
__THROW
;

177 
	~<xloÿË.h
>

179 
	$wcsÿ£cmp_l
 (
__cÚ¡
 
wch¬_t
 *
__s1
, __cÚ¡ wch¬_ˆ*
__s2
,

180 
__loÿË_t
 
__loc
è
__THROW
;

182 
	$wc¢ÿ£cmp_l
 (
__cÚ¡
 
wch¬_t
 *
__s1
, __cÚ¡ wch¬_ˆ*
__s2
,

183 
size_t
 
__n
, 
__loÿË_t
 
__loc
è
__THROW
;

186 
__BEGIN_NAMESPACE_STD


189 
	$wcscŞl
 (
__cÚ¡
 
wch¬_t
 *
__s1
, __cÚ¡ wch¬_ˆ*
__s2
è
__THROW
;

193 
size_t
 
	$wcsxäm
 (
wch¬_t
 *
__»¡riù
 
__s1
,

194 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__s2
, 
size_t
 
__n
è
__THROW
;

195 
__END_NAMESPACE_STD


197 #ifdeà
__USE_XOPEN2K8


203 
	$wcscŞl_l
 (
__cÚ¡
 
wch¬_t
 *
__s1
, __cÚ¡ wch¬_ˆ*
__s2
,

204 
__loÿË_t
 
__loc
è
__THROW
;

209 
size_t
 
	$wcsxäm_l
 (
wch¬_t
 *
__s1
, 
__cÚ¡
 wch¬_ˆ*
__s2
,

210 
size_t
 
__n
, 
__loÿË_t
 
__loc
è
__THROW
;

213 
wch¬_t
 *
	$wcsdup
 (
__cÚ¡
 
wch¬_t
 *
__s
è
__THROW
 
__©Œibu‹_m®loc__
;

216 
__BEGIN_NAMESPACE_STD


218 #ifdeà
__CORRECT_ISO_CPP_WCHAR_H_PROTO


219 "C++" 
wch¬_t
 *
	$wcschr
 (
wch¬_t
 *
__wcs
, wch¬_ˆ
__wc
)

220 
__THROW
 
	`__asm
 ("wcschr"è
__©Œibu‹_pu»__
;

221 "C++" 
__cÚ¡
 
wch¬_t
 *
	$wcschr
 (
__cÚ¡
 
wch¬_t
 *
__wcs
, wch¬_ˆ
__wc
)

222 
__THROW
 
	`__asm
 ("wcschr"è
__©Œibu‹_pu»__
;

224 
wch¬_t
 *
	$wcschr
 (
__cÚ¡
 
wch¬_t
 *
__wcs
, wch¬_ˆ
__wc
)

225 
__THROW
 
__©Œibu‹_pu»__
;

228 #ifdeà
__CORRECT_ISO_CPP_WCHAR_H_PROTO


229 "C++" 
wch¬_t
 *
	$wc¤chr
 (
wch¬_t
 *
__wcs
, wch¬_ˆ
__wc
)

230 
__THROW
 
	`__asm
 ("wc¤chr"è
__©Œibu‹_pu»__
;

231 "C++" 
__cÚ¡
 
wch¬_t
 *
	$wc¤chr
 (
__cÚ¡
 
wch¬_t
 *
__wcs
, wch¬_ˆ
__wc
)

232 
__THROW
 
	`__asm
 ("wc¤chr"è
__©Œibu‹_pu»__
;

234 
wch¬_t
 *
	$wc¤chr
 (
__cÚ¡
 
wch¬_t
 *
__wcs
, wch¬_ˆ
__wc
)

235 
__THROW
 
__©Œibu‹_pu»__
;

237 
__END_NAMESPACE_STD


239 #ifdeà
__USE_GNU


242 
wch¬_t
 *
	$wcschºul
 (
__cÚ¡
 
wch¬_t
 *
__s
, wch¬_ˆ
__wc
)

243 
__THROW
 
__©Œibu‹_pu»__
;

246 
__BEGIN_NAMESPACE_STD


249 
size_t
 
	$wcsc¥n
 (
__cÚ¡
 
wch¬_t
 *
__wcs
, __cÚ¡ wch¬_ˆ*
__»jeù
)

250 
__THROW
 
__©Œibu‹_pu»__
;

253 
size_t
 
	$wcs¥n
 (
__cÚ¡
 
wch¬_t
 *
__wcs
, __cÚ¡ wch¬_ˆ*
__acû±
)

254 
__THROW
 
__©Œibu‹_pu»__
;

256 #ifdeà
__CORRECT_ISO_CPP_WCHAR_H_PROTO


257 "C++" 
wch¬_t
 *
	$wc¥brk
 (
wch¬_t
 *
__wcs
, 
__cÚ¡
 wch¬_ˆ*
__acû±
)

258 
__THROW
 
	`__asm
 ("wc¥brk"è
__©Œibu‹_pu»__
;

259 "C++" 
__cÚ¡
 
wch¬_t
 *
	$wc¥brk
 (
__cÚ¡
 
wch¬_t
 *
__wcs
,

260 
__cÚ¡
 
wch¬_t
 *
__acû±
)

261 
__THROW
 
	`__asm
 ("wc¥brk"è
__©Œibu‹_pu»__
;

263 
wch¬_t
 *
	$wc¥brk
 (
__cÚ¡
 
wch¬_t
 *
__wcs
, __cÚ¡ wch¬_ˆ*
__acû±
)

264 
__THROW
 
__©Œibu‹_pu»__
;

267 #ifdeà
__CORRECT_ISO_CPP_WCHAR_H_PROTO


268 "C++" 
wch¬_t
 *
	$wcs¡r
 (
wch¬_t
 *
__hay¡ack
, 
__cÚ¡
 wch¬_ˆ*
__ÃedË
)

269 
__THROW
 
	`__asm
 ("wcs¡r"è
__©Œibu‹_pu»__
;

270 "C++" 
__cÚ¡
 
wch¬_t
 *
	$wcs¡r
 (
__cÚ¡
 
wch¬_t
 *
__hay¡ack
,

271 
__cÚ¡
 
wch¬_t
 *
__ÃedË
)

272 
__THROW
 
	`__asm
 ("wcs¡r"è
__©Œibu‹_pu»__
;

274 
wch¬_t
 *
	$wcs¡r
 (
__cÚ¡
 
wch¬_t
 *
__hay¡ack
, __cÚ¡ wch¬_ˆ*
__ÃedË
)

275 
__THROW
 
__©Œibu‹_pu»__
;

279 
wch¬_t
 *
	$wc¡ok
 (
wch¬_t
 *
__»¡riù
 
__s
,

280 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__d–im
,

281 
wch¬_t
 **
__»¡riù
 
__±r
è
__THROW
;

284 
size_t
 
	$wc¦’
 (
__cÚ¡
 
wch¬_t
 *
__s
è
__THROW
 
__©Œibu‹_pu»__
;

285 
__END_NAMESPACE_STD


287 #ifdeà
__USE_XOPEN


289 #ifdeà
__CORRECT_ISO_CPP_WCHAR_H_PROTO


290 "C++" 
wch¬_t
 *
	$wcswcs
 (
wch¬_t
 *
__hay¡ack
, 
__cÚ¡
 wch¬_ˆ*
__ÃedË
)

291 
__THROW
 
	`__asm
 ("wcswcs"è
__©Œibu‹_pu»__
;

292 "C++" 
__cÚ¡
 
wch¬_t
 *
	$wcswcs
 (
__cÚ¡
 
wch¬_t
 *
__hay¡ack
,

293 
__cÚ¡
 
wch¬_t
 *
__ÃedË
)

294 
__THROW
 
	`__asm
 ("wcswcs"è
__©Œibu‹_pu»__
;

296 
wch¬_t
 *
	$wcswcs
 (
__cÚ¡
 
wch¬_t
 *
__hay¡ack
, __cÚ¡ wch¬_ˆ*
__ÃedË
)

297 
__THROW
 
__©Œibu‹_pu»__
;

301 #ifdeà
__USE_XOPEN2K8


303 
size_t
 
	$wc¢Ën
 (
__cÚ¡
 
wch¬_t
 *
__s
, 
size_t
 
__maxËn
)

304 
__THROW
 
__©Œibu‹_pu»__
;

308 
__BEGIN_NAMESPACE_STD


310 #ifdeà
__CORRECT_ISO_CPP_WCHAR_H_PROTO


311 "C++" 
wch¬_t
 *
	$wmemchr
 (
wch¬_t
 *
__s
, wch¬_ˆ
__c
, 
size_t
 
__n
)

312 
__THROW
 
	`__asm
 ("wmemchr"è
__©Œibu‹_pu»__
;

313 "C++" 
__cÚ¡
 
wch¬_t
 *
	$wmemchr
 (
__cÚ¡
 
wch¬_t
 *
__s
, wch¬_ˆ
__c
,

314 
size_t
 
__n
)

315 
__THROW
 
	`__asm
 ("wmemchr"è
__©Œibu‹_pu»__
;

317 
wch¬_t
 *
	$wmemchr
 (
__cÚ¡
 
wch¬_t
 *
__s
, wch¬_ˆ
__c
, 
size_t
 
__n
)

318 
__THROW
 
__©Œibu‹_pu»__
;

322 
	$wmemcmp
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__s1
,

323 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__s2
, 
size_t
 
__n
)

324 
__THROW
 
__©Œibu‹_pu»__
;

327 
wch¬_t
 *
	$wmemıy
 (
wch¬_t
 *
__»¡riù
 
__s1
,

328 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__s2
, 
size_t
 
__n
è
__THROW
;

332 
wch¬_t
 *
	$wmemmove
 (
wch¬_t
 *
__s1
, 
__cÚ¡
 wch¬_ˆ*
__s2
, 
size_t
 
__n
)

333 
__THROW
;

336 
wch¬_t
 *
	$wmem£t
 (
wch¬_t
 *
__s
, wch¬_ˆ
__c
, 
size_t
 
__n
è
__THROW
;

337 
__END_NAMESPACE_STD


339 #ifdeà
__USE_GNU


342 
wch¬_t
 *
	$wmempıy
 (
wch¬_t
 *
__»¡riù
 
__s1
,

343 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__s2
, 
size_t
 
__n
)

344 
__THROW
;

348 
__BEGIN_NAMESPACE_STD


351 
wšt_t
 
	$btowc
 (
__c
è
__THROW
;

355 
	$wùob
 (
wšt_t
 
__c
è
__THROW
;

359 
	$mbsš™
 (
__cÚ¡
 
mb¡©e_t
 *
__ps
è
__THROW
 
__©Œibu‹_pu»__
;

363 
size_t
 
	$mb¹owc
 (
wch¬_t
 *
__»¡riù
 
__pwc
,

364 
__cÚ¡
 *
__»¡riù
 
__s
, 
size_t
 
__n
,

365 
mb¡©e_t
 *
__p
è
__THROW
;

368 
size_t
 
	$wütomb
 (*
__»¡riù
 
__s
, 
wch¬_t
 
__wc
,

369 
mb¡©e_t
 *
__»¡riù
 
__ps
è
__THROW
;

372 
size_t
 
	$__mb¾’
 (
__cÚ¡
 *
__»¡riù
 
__s
, 
size_t
 
__n
,

373 
mb¡©e_t
 *
__»¡riù
 
__ps
è
__THROW
;

374 
size_t
 
	$mb¾’
 (
__cÚ¡
 *
__»¡riù
 
__s
, 
size_t
 
__n
,

375 
mb¡©e_t
 *
__»¡riù
 
__ps
è
__THROW
;

376 
__END_NAMESPACE_STD


378 #ifdeà
__USE_EXTERN_INLINES


384 
wšt_t
 
	$__btowc_®Ÿs
 (
__c
è
	`__asm
 ("btowc");

385 
__ex‹º_šlše
 
wšt_t


386 
	`__NTH
 (
	$btowc
 (
__c
))

387 {  (
	`__butš_cÚ¡ªt_p
 (
__c
) && __c >= '\0' && __c <= '\x7f'

388 ? (
wšt_t
è
__c
 : 
	`__btowc_®Ÿs
 (__c)); 
	}
}

390 
	$__wùob_®Ÿs
 (
wšt_t
 
__c
è
	`__asm
 ("wctob");

391 
__ex‹º_šlše
 

392 
	`__NTH
 (
	$wùob
 (
wšt_t
 
__wc
))

393 {  (
	`__butš_cÚ¡ªt_p
 (
__wc
è&& __wø>ğ
L
'\0' && __wc <= L'\x7f'

394 ? (è
__wc
 : 
	`__wùob_®Ÿs
 (__wc)); 
	}
}

396 
__ex‹º_šlše
 
size_t


397 
__NTH
 (
	$mb¾’
 (
__cÚ¡
 *
__»¡riù
 
__s
, 
size_t
 
__n
,

398 
mb¡©e_t
 *
__»¡riù
 
__ps
))

399 {  (
__ps
 !ğ
NULL


400 ? 
	`mb¹owc
 (
NULL
, 
__s
, 
__n
, 
__ps
è: 
	`__mb¾’
 (__s, __n, NULL)); 
	}
}

403 
__BEGIN_NAMESPACE_STD


406 
size_t
 
	$mb¤towcs
 (
wch¬_t
 *
__»¡riù
 
__d¡
,

407 
__cÚ¡
 **
__»¡riù
 
__¤c
, 
size_t
 
__Ën
,

408 
mb¡©e_t
 *
__»¡riù
 
__ps
è
__THROW
;

412 
size_t
 
	$wc¤tombs
 (*
__»¡riù
 
__d¡
,

413 
__cÚ¡
 
wch¬_t
 **
__»¡riù
 
__¤c
, 
size_t
 
__Ën
,

414 
mb¡©e_t
 *
__»¡riù
 
__ps
è
__THROW
;

415 
__END_NAMESPACE_STD


418 #ifdef 
__USE_XOPEN2K8


421 
size_t
 
	$mb¢¹owcs
 (
wch¬_t
 *
__»¡riù
 
__d¡
,

422 
__cÚ¡
 **
__»¡riù
 
__¤c
, 
size_t
 
__nmc
,

423 
size_t
 
__Ën
, 
mb¡©e_t
 *
__»¡riù
 
__ps
è
__THROW
;

427 
size_t
 
	$wc¢¹ombs
 (*
__»¡riù
 
__d¡
,

428 
__cÚ¡
 
wch¬_t
 **
__»¡riù
 
__¤c
,

429 
size_t
 
__nwc
, size_ˆ
__Ën
,

430 
mb¡©e_t
 *
__»¡riù
 
__ps
è
__THROW
;

435 #ifdeà
__USE_XOPEN


437 
	$wcwidth
 (
wch¬_t
 
__c
è
__THROW
;

441 
	$wcswidth
 (
__cÚ¡
 
wch¬_t
 *
__s
, 
size_t
 
__n
è
__THROW
;

445 
__BEGIN_NAMESPACE_STD


448 
	$wc¡od
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

449 
wch¬_t
 **
__»¡riù
 
__’d±r
è
__THROW
;

450 
__END_NAMESPACE_STD


452 #ifdeà
__USE_ISOC99


453 
__BEGIN_NAMESPACE_C99


455 
	$wc¡of
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

456 
wch¬_t
 **
__»¡riù
 
__’d±r
è
__THROW
;

457 
	$wc¡Şd
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

458 
wch¬_t
 **
__»¡riù
 
__’d±r
è
__THROW
;

459 
__END_NAMESPACE_C99


463 
__BEGIN_NAMESPACE_STD


466 
	$wc¡Ş
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

467 
wch¬_t
 **
__»¡riù
 
__’d±r
, 
__ba£
è
__THROW
;

471 
	$wc¡oul
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

472 
wch¬_t
 **
__»¡riù
 
__’d±r
, 
__ba£
)

473 
__THROW
;

474 
__END_NAMESPACE_STD


476 #ià
defšed
 
__USE_ISOC99
 || (defšed 
__GNUC__
 && defšed 
__USE_GNU
)

477 
__BEGIN_NAMESPACE_C99


480 
__ex‹nsiÚ__


481 
	$wc¡Şl
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

482 
wch¬_t
 **
__»¡riù
 
__’d±r
, 
__ba£
)

483 
__THROW
;

487 
__ex‹nsiÚ__


488 
	$wc¡ouÎ
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

489 
wch¬_t
 **
__»¡riù
 
__’d±r
,

490 
__ba£
è
__THROW
;

491 
__END_NAMESPACE_C99


494 #ià
defšed
 
__GNUC__
 && defšed 
__USE_GNU


497 
__ex‹nsiÚ__


498 
	$wc¡oq
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

499 
wch¬_t
 **
__»¡riù
 
__’d±r
, 
__ba£
)

500 
__THROW
;

504 
__ex‹nsiÚ__


505 
	$wc¡ouq
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

506 
wch¬_t
 **
__»¡riù
 
__’d±r
,

507 
__ba£
è
__THROW
;

510 #ifdeà
__USE_GNU


524 
	~<xloÿË.h
>

528 
	$wc¡Ş_l
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

529 
wch¬_t
 **
__»¡riù
 
__’d±r
, 
__ba£
,

530 
__loÿË_t
 
__loc
è
__THROW
;

532 
	$wc¡oul_l
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

533 
wch¬_t
 **
__»¡riù
 
__’d±r
,

534 
__ba£
, 
__loÿË_t
 
__loc
è
__THROW
;

536 
__ex‹nsiÚ__


537 
	$wc¡Şl_l
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

538 
wch¬_t
 **
__»¡riù
 
__’d±r
,

539 
__ba£
, 
__loÿË_t
 
__loc
è
__THROW
;

541 
__ex‹nsiÚ__


542 
	$wc¡ouÎ_l
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

543 
wch¬_t
 **
__»¡riù
 
__’d±r
,

544 
__ba£
, 
__loÿË_t
 
__loc
)

545 
__THROW
;

547 
	$wc¡od_l
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

548 
wch¬_t
 **
__»¡riù
 
__’d±r
, 
__loÿË_t
 
__loc
)

549 
__THROW
;

551 
	$wc¡of_l
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

552 
wch¬_t
 **
__»¡riù
 
__’d±r
, 
__loÿË_t
 
__loc
)

553 
__THROW
;

555 
	$wc¡Şd_l
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

556 
wch¬_t
 **
__»¡riù
 
__’d±r
,

557 
__loÿË_t
 
__loc
è
__THROW
;

562 
wch¬_t
 *
	$wııy
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

563 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__¤c
è
__THROW
;

567 
wch¬_t
 *
	$wınıy
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

568 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

569 
__THROW
;

575 #ifdef 
__USE_XOPEN2K8


578 
__FILE
 *
	$İ’_wmem¡»am
 (
wch¬_t
 **
__buæoc
, 
size_t
 *
__siz–oc
è
__THROW
;

581 #ià
defšed
 
__USE_ISOC95
 || defšed 
__USE_UNIX98


582 
__BEGIN_NAMESPACE_STD


585 
	$fwide
 (
__FILE
 *
__å
, 
__mode
è
__THROW
;

592 
	`fw´štf
 (
__FILE
 *
__»¡riù
 
__¡»am
,

593 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

599 
	`w´štf
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

602 
	$sw´štf
 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__n
,

603 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

604 
__THROW
 ;

610 
	`vfw´štf
 (
__FILE
 *
__»¡riù
 
__s
,

611 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

612 
__gnuc_va_li¡
 
__¬g
)

618 
	`vw´štf
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

619 
__gnuc_va_li¡
 
__¬g
)

623 
	$vsw´štf
 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__n
,

624 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

625 
__gnuc_va_li¡
 
__¬g
)

626 
__THROW
 ;

633 
	`fwsÿnf
 (
__FILE
 *
__»¡riù
 
__¡»am
,

634 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

640 
	`wsÿnf
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

643 
	$swsÿnf
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__s
,

644 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

645 
__THROW
 ;

647 #ià
defšed
 
__USE_ISOC99
 && !defšed 
__USE_GNU
 \

648 && (!
defšed
 
__LDBL_COMPAT
 || !defšed 
__REDIRECT
) \

649 && (
defšed
 
__STRICT_ANSI__
 || defšed 
__USE_XOPEN2K
)

650 #ifdeà
__REDIRECT


654 
	`__REDIRECT
 (
fwsÿnf
, (
__FILE
 *
__»¡riù
 
__¡»am
,

655 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...),

656 
__isoc99_fwsÿnf
)

658 
	`__REDIRECT
 (
wsÿnf
, (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...),

659 
__isoc99_wsÿnf
)

661 
	`__REDIRECT
 (
swsÿnf
, (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__s
,

662 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...),

663 
__isoc99_swsÿnf
)

664 
__THROW
 ;

666 
	`__isoc99_fwsÿnf
 (
__FILE
 *
__»¡riù
 
__¡»am
,

667 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...);

668 
	`__isoc99_wsÿnf
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...);

669 
	$__isoc99_swsÿnf
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__s
,

670 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

671 
__THROW
;

672 
	#fwsÿnf
 
__isoc99_fwsÿnf


	)

673 
	#wsÿnf
 
__isoc99_wsÿnf


	)

674 
	#swsÿnf
 
__isoc99_swsÿnf


	)

678 
__END_NAMESPACE_STD


681 #ifdeà
__USE_ISOC99


682 
__BEGIN_NAMESPACE_C99


687 
	`vfwsÿnf
 (
__FILE
 *
__»¡riù
 
__s
,

688 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

689 
__gnuc_va_li¡
 
__¬g
)

695 
	`vwsÿnf
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

696 
__gnuc_va_li¡
 
__¬g
)

699 
	$vswsÿnf
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__s
,

700 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

701 
__gnuc_va_li¡
 
__¬g
)

702 
__THROW
 ;

704 #ià!
defšed
 
__USE_GNU
 \

705 && (!
defšed
 
__LDBL_COMPAT
 || !defšed 
__REDIRECT
) \

706 && (
defšed
 
__STRICT_ANSI__
 || defšed 
__USE_XOPEN2K
)

707 #ifdeà
__REDIRECT


708 
	`__REDIRECT
 (
vfwsÿnf
, (
__FILE
 *
__»¡riù
 
__s
,

709 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

710 
__gnuc_va_li¡
 
__¬g
), 
__isoc99_vfwsÿnf
)

712 
	`__REDIRECT
 (
vwsÿnf
, (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

713 
__gnuc_va_li¡
 
__¬g
), 
__isoc99_vwsÿnf
)

715 
	`__REDIRECT
 (
vswsÿnf
, (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__s
,

716 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

717 
__gnuc_va_li¡
 
__¬g
), 
__isoc99_vswsÿnf
)

718 
__THROW
 ;

720 
	`__isoc99_vfwsÿnf
 (
__FILE
 *
__»¡riù
 
__s
,

721 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

722 
__gnuc_va_li¡
 
__¬g
);

723 
	`__isoc99_vwsÿnf
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

724 
__gnuc_va_li¡
 
__¬g
);

725 
	$__isoc99_vswsÿnf
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__s
,

726 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

727 
__gnuc_va_li¡
 
__¬g
è
__THROW
;

728 
	#vfwsÿnf
 
__isoc99_vfwsÿnf


	)

729 
	#vwsÿnf
 
__isoc99_vwsÿnf


	)

730 
	#vswsÿnf
 
__isoc99_vswsÿnf


	)

734 
__END_NAMESPACE_C99


738 
__BEGIN_NAMESPACE_STD


743 
wšt_t
 
	`fg‘wc
 (
__FILE
 *
__¡»am
);

744 
wšt_t
 
	`g‘wc
 (
__FILE
 *
__¡»am
);

750 
wšt_t
 
	`g‘wch¬
 ();

757 
wšt_t
 
	`åutwc
 (
wch¬_t
 
__wc
, 
__FILE
 *
__¡»am
);

758 
wšt_t
 
	`putwc
 (
wch¬_t
 
__wc
, 
__FILE
 *
__¡»am
);

764 
wšt_t
 
	`putwch¬
 (
wch¬_t
 
__wc
);

772 
wch¬_t
 *
	`fg‘ws
 (wch¬_ˆ*
__»¡riù
 
__ws
, 
__n
,

773 
__FILE
 *
__»¡riù
 
__¡»am
);

779 
	`åutws
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ws
,

780 
__FILE
 *
__»¡riù
 
__¡»am
);

787 
wšt_t
 
	`ung‘wc
 (wšt_ˆ
__wc
, 
__FILE
 *
__¡»am
);

788 
__END_NAMESPACE_STD


791 #ifdeà
__USE_GNU


799 
wšt_t
 
	`g‘wc_uÆocked
 (
__FILE
 *
__¡»am
);

800 
wšt_t
 
	`g‘wch¬_uÆocked
 ();

808 
wšt_t
 
	`fg‘wc_uÆocked
 (
__FILE
 *
__¡»am
);

816 
wšt_t
 
	`åutwc_uÆocked
 (
wch¬_t
 
__wc
, 
__FILE
 *
__¡»am
);

825 
wšt_t
 
	`putwc_uÆocked
 (
wch¬_t
 
__wc
, 
__FILE
 *
__¡»am
);

826 
wšt_t
 
	`putwch¬_uÆocked
 (
wch¬_t
 
__wc
);

835 
wch¬_t
 *
	`fg‘ws_uÆocked
 (wch¬_ˆ*
__»¡riù
 
__ws
, 
__n
,

836 
__FILE
 *
__»¡riù
 
__¡»am
);

844 
	`åutws_uÆocked
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__ws
,

845 
__FILE
 *
__»¡riù
 
__¡»am
);

849 
__BEGIN_NAMESPACE_C99


853 
size_t
 
	$wcsáime
 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__maxsize
,

854 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

855 
__cÚ¡
 
tm
 *
__»¡riù
 
__
è
__THROW
;

856 
__END_NAMESPACE_C99


858 #ifdeà
__USE_GNU


859 
	~<xloÿË.h
>

863 
size_t
 
	$wcsáime_l
 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__maxsize
,

864 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

865 
__cÚ¡
 
tm
 *
__»¡riù
 
__
,

866 
__loÿË_t
 
__loc
è
__THROW
;

875 #ià
defšed
 
__USE_UNIX98
 && !defšed 
__USE_GNU


876 
	#__Ãed_iswxxx


	)

877 
	~<wùy³.h
>

881 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__ex‹º_®ways_šlše


882 
	~<b™s/wch¬2.h
>

885 #ifdeà
__LDBL_COMPAT


886 
	~<b™s/wch¬-ldbl.h
>

889 
__END_DECLS


897 #undeà
__Ãed_mb¡©e_t


898 #undeà
__Ãed_wšt_t


	@/usr/include/asm-generic/errno.h

1 #iâdeà
_ASM_GENERIC_ERRNO_H


2 
	#_ASM_GENERIC_ERRNO_H


	)

4 
	~<asm-g’”ic/”ºo-ba£.h
>

6 
	#EDEADLK
 35

	)

7 
	#ENAMETOOLONG
 36

	)

8 
	#ENOLCK
 37

	)

9 
	#ENOSYS
 38

	)

10 
	#ENOTEMPTY
 39

	)

11 
	#ELOOP
 40

	)

12 
	#EWOULDBLOCK
 
EAGAIN


	)

13 
	#ENOMSG
 42

	)

14 
	#EIDRM
 43

	)

15 
	#ECHRNG
 44

	)

16 
	#EL2NSYNC
 45

	)

17 
	#EL3HLT
 46

	)

18 
	#EL3RST
 47

	)

19 
	#ELNRNG
 48

	)

20 
	#EUNATCH
 49

	)

21 
	#ENOCSI
 50

	)

22 
	#EL2HLT
 51

	)

23 
	#EBADE
 52

	)

24 
	#EBADR
 53

	)

25 
	#EXFULL
 54

	)

26 
	#ENOANO
 55

	)

27 
	#EBADRQC
 56

	)

28 
	#EBADSLT
 57

	)

30 
	#EDEADLOCK
 
EDEADLK


	)

32 
	#EBFONT
 59

	)

33 
	#ENOSTR
 60

	)

34 
	#ENODATA
 61

	)

35 
	#ETIME
 62

	)

36 
	#ENOSR
 63

	)

37 
	#ENONET
 64

	)

38 
	#ENOPKG
 65

	)

39 
	#EREMOTE
 66

	)

40 
	#ENOLINK
 67

	)

41 
	#EADV
 68

	)

42 
	#ESRMNT
 69

	)

43 
	#ECOMM
 70

	)

44 
	#EPROTO
 71

	)

45 
	#EMULTIHOP
 72

	)

46 
	#EDOTDOT
 73

	)

47 
	#EBADMSG
 74

	)

48 
	#EOVERFLOW
 75

	)

49 
	#ENOTUNIQ
 76

	)

50 
	#EBADFD
 77

	)

51 
	#EREMCHG
 78

	)

52 
	#ELIBACC
 79

	)

53 
	#ELIBBAD
 80

	)

54 
	#ELIBSCN
 81

	)

55 
	#ELIBMAX
 82

	)

56 
	#ELIBEXEC
 83

	)

57 
	#EILSEQ
 84

	)

58 
	#ERESTART
 85

	)

59 
	#ESTRPIPE
 86

	)

60 
	#EUSERS
 87

	)

61 
	#ENOTSOCK
 88

	)

62 
	#EDESTADDRREQ
 89

	)

63 
	#EMSGSIZE
 90

	)

64 
	#EPROTOTYPE
 91

	)

65 
	#ENOPROTOOPT
 92

	)

66 
	#EPROTONOSUPPORT
 93

	)

67 
	#ESOCKTNOSUPPORT
 94

	)

68 
	#EOPNOTSUPP
 95

	)

69 
	#EPFNOSUPPORT
 96

	)

70 
	#EAFNOSUPPORT
 97

	)

71 
	#EADDRINUSE
 98

	)

72 
	#EADDRNOTAVAIL
 99

	)

73 
	#ENETDOWN
 100

	)

74 
	#ENETUNREACH
 101

	)

75 
	#ENETRESET
 102

	)

76 
	#ECONNABORTED
 103

	)

77 
	#ECONNRESET
 104

	)

78 
	#ENOBUFS
 105

	)

79 
	#EISCONN
 106

	)

80 
	#ENOTCONN
 107

	)

81 
	#ESHUTDOWN
 108

	)

82 
	#ETOOMANYREFS
 109

	)

83 
	#ETIMEDOUT
 110

	)

84 
	#ECONNREFUSED
 111

	)

85 
	#EHOSTDOWN
 112

	)

86 
	#EHOSTUNREACH
 113

	)

87 
	#EALREADY
 114

	)

88 
	#EINPROGRESS
 115

	)

89 
	#ESTALE
 116

	)

90 
	#EUCLEAN
 117

	)

91 
	#ENOTNAM
 118

	)

92 
	#ENAVAIL
 119

	)

93 
	#EISNAM
 120

	)

94 
	#EREMOTEIO
 121

	)

95 
	#EDQUOT
 122

	)

97 
	#ENOMEDIUM
 123

	)

98 
	#EMEDIUMTYPE
 124

	)

99 
	#ECANCELED
 125

	)

100 
	#ENOKEY
 126

	)

101 
	#EKEYEXPIRED
 127

	)

102 
	#EKEYREVOKED
 128

	)

103 
	#EKEYREJECTED
 129

	)

106 
	#EOWNERDEAD
 130

	)

107 
	#ENOTRECOVERABLE
 131

	)

109 
	#ERFKILL
 132

	)

111 
	#EHWPOISON
 133

	)

	@/usr/include/bits/wchar-ldbl.h

20 #iâdeà
_WCHAR_H


24 #ià
defšed
 
__USE_ISOC95
 || defšed 
__USE_UNIX98


25 
__BEGIN_NAMESPACE_C99


26 
__LDBL_REDIR_DECL
 (
fw´štf
);

27 
__LDBL_REDIR_DECL
 (
w´štf
);

28 
__LDBL_REDIR_DECL
 (
sw´štf
);

29 
__LDBL_REDIR_DECL
 (
vfw´štf
);

30 
__LDBL_REDIR_DECL
 (
vw´štf
);

31 
__LDBL_REDIR_DECL
 (
vsw´štf
);

32 #ià
defšed
 
__USE_ISOC99
 && !defšed 
__USE_GNU
 \

33 && !
defšed
 
	g__REDIRECT
 \

34 && (
defšed
 
	g__STRICT_ANSI__
 || defšed 
	g__USE_XOPEN2K
)

35 
	$__LDBL_REDIR1_DECL
 (
fwsÿnf
, 
__Ædbl___isoc99_fwsÿnf
)

36 
	$__LDBL_REDIR1_DECL
 (
wsÿnf
, 
__Ædbl___isoc99_wsÿnf
)

37 
	$__LDBL_REDIR1_DECL
 (
swsÿnf
, 
__Ædbl___isoc99_swsÿnf
)

39 
	`__LDBL_REDIR_DECL
 (
fwsÿnf
);

40 
	`__LDBL_REDIR_DECL
 (
wsÿnf
);

41 
	`__LDBL_REDIR_DECL
 (
swsÿnf
);

43 
__END_NAMESPACE_C99


46 #ifdeà
__USE_ISOC99


47 
__BEGIN_NAMESPACE_C99


48 
	`__LDBL_REDIR1_DECL
 (
wc¡Şd
, 
wc¡od
);

49 #ià!
defšed
 
__USE_GNU
 && !defšed 
__REDIRECT
 \

50 && (
defšed
 
__STRICT_ANSI__
 || defšed 
__USE_XOPEN2K
)

51 
	$__LDBL_REDIR1_DECL
 (
vfwsÿnf
, 
__Ædbl___isoc99_vfwsÿnf
)

52 
	$__LDBL_REDIR1_DECL
 (
vwsÿnf
, 
__Ædbl___isoc99_vwsÿnf
)

53 
	$__LDBL_REDIR1_DECL
 (
vswsÿnf
, 
__Ædbl___isoc99_vswsÿnf
)

55 
	`__LDBL_REDIR_DECL
 (
vfwsÿnf
);

56 
	`__LDBL_REDIR_DECL
 (
vwsÿnf
);

57 
	`__LDBL_REDIR_DECL
 (
vswsÿnf
);

59 
__END_NAMESPACE_C99


62 #ifdeà
__USE_GNU


63 
	`__LDBL_REDIR1_DECL
 (
wc¡Şd_l
, 
wc¡od_l
);

66 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__ex‹º_®ways_šlše


67 
	$__LDBL_REDIR_DECL
 (
__sw´štf_chk
)

68 
	$__LDBL_REDIR_DECL
 (
__vsw´štf_chk
)

69 #ià
__USE_FORTIFY_LEVEL
 > 1

70 
	$__LDBL_REDIR_DECL
 (
__fw´štf_chk
)

71 
	$__LDBL_REDIR_DECL
 (
__w´štf_chk
)

72 
	$__LDBL_REDIR_DECL
 (
__vfw´štf_chk
)

73 
	$__LDBL_REDIR_DECL
 (
__vw´štf_chk
)

	@/usr/include/bits/wchar2.h

20 #iâdeà
_WCHAR_H


25 
wch¬_t
 *
	$__wmemıy_chk
 (
wch¬_t
 *
__»¡riù
 
__s1
,

26 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__s2
, 
size_t
 
__n
,

27 
size_t
 
__ns1
è
__THROW
;

28 
wch¬_t
 *
	`__REDIRECT_NTH
 (
__wmemıy_®Ÿs
,

29 (
wch¬_t
 *
__»¡riù
 
__s1
,

30 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__s2
, 
size_t
 
__n
),

31 
wmemıy
);

32 
wch¬_t
 *
	`__REDIRECT_NTH
 (
__wmemıy_chk_w¬n
,

33 (
wch¬_t
 *
__»¡riù
 
__s1
,

34 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__s2
, 
size_t
 
__n
,

35 
size_t
 
__ns1
), 
__wmemıy_chk
)

36 
	`__w¬Ç‰r
 ("wmemcpy called with†ength biggerhan size of destination "

39 
__ex‹º_®ways_šlše
 
wch¬_t
 *

40 
	`__NTH
 (
	$wmemıy
 (
wch¬_t
 *
__»¡riù
 
__s1
, 
__cÚ¡
 wch¬_ˆ*__»¡riù 
__s2
,

41 
size_t
 
__n
))

43 ià(
	`__bos0
 (
__s1
è!ğ(
size_t
) -1)

45 ià(!
	`__butš_cÚ¡ªt_p
 (
__n
))

46  
	`__wmemıy_chk
 (
__s1
, 
__s2
, 
__n
,

47 
	`__bos0
 (
__s1
è/  (
wch¬_t
));

49 ià(
__n
 > 
	`__bos0
 (
__s1
è/  (
wch¬_t
))

50  
	`__wmemıy_chk_w¬n
 (
__s1
, 
__s2
, 
__n
,

51 
	`__bos0
 (
__s1
è/  (
wch¬_t
));

53  
	`__wmemıy_®Ÿs
 (
__s1
, 
__s2
, 
__n
);

54 
	}
}

57 
wch¬_t
 *
	$__wmemmove_chk
 (
wch¬_t
 *
__s1
, 
__cÚ¡
 wch¬_ˆ*
__s2
,

58 
size_t
 
__n
, size_ˆ
__ns1
è
__THROW
;

59 
wch¬_t
 *
	`__REDIRECT_NTH
 (
__wmemmove_®Ÿs
, (wch¬_ˆ*
__s1
,

60 
__cÚ¡
 
wch¬_t
 *
__s2
,

61 
size_t
 
__n
), 
wmemmove
);

62 
wch¬_t
 *
	`__REDIRECT_NTH
 (
__wmemmove_chk_w¬n
,

63 (
wch¬_t
 *
__s1
, 
__cÚ¡
 wch¬_ˆ*
__s2
,

64 
size_t
 
__n
, size_ˆ
__ns1
), 
__wmemmove_chk
)

65 
	`__w¬Ç‰r
 ("wmemmove called with†ength biggerhan size of destination "

68 
__ex‹º_®ways_šlše
 
wch¬_t
 *

69 
	`__NTH
 (
	$wmemmove
 (
wch¬_t
 *
__s1
, 
__cÚ¡
 wch¬_ˆ*
__s2
, 
size_t
 
__n
))

71 ià(
	`__bos0
 (
__s1
è!ğ(
size_t
) -1)

73 ià(!
	`__butš_cÚ¡ªt_p
 (
__n
))

74  
	`__wmemmove_chk
 (
__s1
, 
__s2
, 
__n
,

75 
	`__bos0
 (
__s1
è/  (
wch¬_t
));

77 ià(
__n
 > 
	`__bos0
 (
__s1
è/  (
wch¬_t
))

78  
	`__wmemmove_chk_w¬n
 (
__s1
, 
__s2
, 
__n
,

79 
	`__bos0
 (
__s1
è/  (
wch¬_t
));

81  
	`__wmemmove_®Ÿs
 (
__s1
, 
__s2
, 
__n
);

82 
	}
}

85 #ifdeà
__USE_GNU


86 
wch¬_t
 *
	$__wmempıy_chk
 (
wch¬_t
 *
__»¡riù
 
__s1
,

87 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__s2
, 
size_t
 
__n
,

88 
size_t
 
__ns1
è
__THROW
;

89 
wch¬_t
 *
	`__REDIRECT_NTH
 (
__wmempıy_®Ÿs
,

90 (
wch¬_t
 *
__»¡riù
 
__s1
,

91 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__s2
,

92 
size_t
 
__n
), 
wmempıy
);

93 
wch¬_t
 *
	`__REDIRECT_NTH
 (
__wmempıy_chk_w¬n
,

94 (
wch¬_t
 *
__»¡riù
 
__s1
,

95 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__s2
, 
size_t
 
__n
,

96 
size_t
 
__ns1
), 
__wmempıy_chk
)

97 
	`__w¬Ç‰r
 ("wmempcpy called with†ength biggerhan size of destination "

100 
__ex‹º_®ways_šlše
 
wch¬_t
 *

101 
	`__NTH
 (
	$wmempıy
 (
wch¬_t
 *
__»¡riù
 
__s1
, 
__cÚ¡
 wch¬_ˆ*__»¡riù 
__s2
,

102 
size_t
 
__n
))

104 ià(
	`__bos0
 (
__s1
è!ğ(
size_t
) -1)

106 ià(!
	`__butš_cÚ¡ªt_p
 (
__n
))

107  
	`__wmempıy_chk
 (
__s1
, 
__s2
, 
__n
,

108 
	`__bos0
 (
__s1
è/  (
wch¬_t
));

110 ià(
__n
 > 
	`__bos0
 (
__s1
è/  (
wch¬_t
))

111  
	`__wmempıy_chk_w¬n
 (
__s1
, 
__s2
, 
__n
,

112 
	`__bos0
 (
__s1
è/  (
wch¬_t
));

114  
	`__wmempıy_®Ÿs
 (
__s1
, 
__s2
, 
__n
);

115 
	}
}

119 
wch¬_t
 *
	$__wmem£t_chk
 (
wch¬_t
 *
__s
, wch¬_ˆ
__c
, 
size_t
 
__n
,

120 
size_t
 
__ns
è
__THROW
;

121 
wch¬_t
 *
	`__REDIRECT_NTH
 (
__wmem£t_®Ÿs
, (wch¬_ˆ*
__s
, wch¬_ˆ
__c
,

122 
size_t
 
__n
), 
wmem£t
);

123 
wch¬_t
 *
	`__REDIRECT_NTH
 (
__wmem£t_chk_w¬n
,

124 (
wch¬_t
 *
__s
, wch¬_ˆ
__c
, 
size_t
 
__n
,

125 
size_t
 
__ns
), 
__wmem£t_chk
)

126 
	`__w¬Ç‰r
 ("wmemset called with†ength biggerhan size of destination "

129 
__ex‹º_®ways_šlše
 
wch¬_t
 *

130 
	`__NTH
 (
	$wmem£t
 (
wch¬_t
 *
__s
, wch¬_ˆ
__c
, 
size_t
 
__n
))

132 ià(
	`__bos0
 (
__s
è!ğ(
size_t
) -1)

134 ià(!
	`__butš_cÚ¡ªt_p
 (
__n
))

135  
	`__wmem£t_chk
 (
__s
, 
__c
, 
__n
, 
	`__bos0
 (__sè/  (
wch¬_t
));

137 ià(
__n
 > 
	`__bos0
 (
__s
è/  (
wch¬_t
))

138  
	`__wmem£t_chk_w¬n
 (
__s
, 
__c
, 
__n
,

139 
	`__bos0
 (
__s
è/  (
wch¬_t
));

141  
	`__wmem£t_®Ÿs
 (
__s
, 
__c
, 
__n
);

142 
	}
}

145 
wch¬_t
 *
	$__wcsıy_chk
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

146 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__¤c
,

147 
size_t
 
__n
è
__THROW
;

148 
wch¬_t
 *
	`__REDIRECT_NTH
 (
__wcsıy_®Ÿs
,

149 (
wch¬_t
 *
__»¡riù
 
__de¡
,

150 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__¤c
), 
wcsıy
);

152 
__ex‹º_®ways_šlše
 
wch¬_t
 *

153 
	`__NTH
 (
	$wcsıy
 (
wch¬_t
 *
__»¡riù
 
__de¡
, 
__cÚ¡
 wch¬_ˆ*__»¡riù 
__¤c
))

155 ià(
	`__bos
 (
__de¡
è!ğ(
size_t
) -1)

156  
	`__wcsıy_chk
 (
__de¡
, 
__¤c
, 
	`__bos
 (__de¡è/  (
wch¬_t
));

157  
	`__wcsıy_®Ÿs
 (
__de¡
, 
__¤c
);

158 
	}
}

161 
wch¬_t
 *
	$__wııy_chk
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

162 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__¤c
,

163 
size_t
 
__de¡Ën
è
__THROW
;

164 
wch¬_t
 *
	`__REDIRECT_NTH
 (
__wııy_®Ÿs
,

165 (
wch¬_t
 *
__»¡riù
 
__de¡
,

166 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__¤c
), 
wııy
);

168 
__ex‹º_®ways_šlše
 
wch¬_t
 *

169 
	`__NTH
 (
	$wııy
 (
wch¬_t
 *
__»¡riù
 
__de¡
, 
__cÚ¡
 wch¬_ˆ*__»¡riù 
__¤c
))

171 ià(
	`__bos
 (
__de¡
è!ğ(
size_t
) -1)

172  
	`__wııy_chk
 (
__de¡
, 
__¤c
, 
	`__bos
 (__de¡è/  (
wch¬_t
));

173  
	`__wııy_®Ÿs
 (
__de¡
, 
__¤c
);

174 
	}
}

177 
wch¬_t
 *
	$__wc¢ıy_chk
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

178 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
,

179 
size_t
 
__de¡Ën
è
__THROW
;

180 
wch¬_t
 *
	`__REDIRECT_NTH
 (
__wc¢ıy_®Ÿs
,

181 (
wch¬_t
 *
__»¡riù
 
__de¡
,

182 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__¤c
,

183 
size_t
 
__n
), 
wc¢ıy
);

184 
wch¬_t
 *
	`__REDIRECT_NTH
 (
__wc¢ıy_chk_w¬n
,

185 (
wch¬_t
 *
__»¡riù
 
__de¡
,

186 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__¤c
,

187 
size_t
 
__n
, size_ˆ
__de¡Ën
), 
__wc¢ıy_chk
)

188 
	`__w¬Ç‰r
 ("wcsncpy called with†ength biggerhan size of destination "

191 
__ex‹º_®ways_šlše
 
wch¬_t
 *

192 
	`__NTH
 (
	$wc¢ıy
 (
wch¬_t
 *
__»¡riù
 
__de¡
, 
__cÚ¡
 wch¬_ˆ*__»¡riù 
__¤c
,

193 
size_t
 
__n
))

195 ià(
	`__bos
 (
__de¡
è!ğ(
size_t
) -1)

197 ià(!
	`__butš_cÚ¡ªt_p
 (
__n
))

198  
	`__wc¢ıy_chk
 (
__de¡
, 
__¤c
, 
__n
,

199 
	`__bos
 (
__de¡
è/  (
wch¬_t
));

200 ià(
__n
 > 
	`__bos
 (
__de¡
è/  (
wch¬_t
))

201  
	`__wc¢ıy_chk_w¬n
 (
__de¡
, 
__¤c
, 
__n
,

202 
	`__bos
 (
__de¡
è/  (
wch¬_t
));

204  
	`__wc¢ıy_®Ÿs
 (
__de¡
, 
__¤c
, 
__n
);

205 
	}
}

208 
wch¬_t
 *
	$__wınıy_chk
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

209 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
,

210 
size_t
 
__de¡Ën
è
__THROW
;

211 
wch¬_t
 *
	`__REDIRECT_NTH
 (
__wınıy_®Ÿs
,

212 (
wch¬_t
 *
__»¡riù
 
__de¡
,

213 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__¤c
,

214 
size_t
 
__n
), 
wınıy
);

215 
wch¬_t
 *
	`__REDIRECT_NTH
 (
__wınıy_chk_w¬n
,

216 (
wch¬_t
 *
__»¡riù
 
__de¡
,

217 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__¤c
,

218 
size_t
 
__n
, size_ˆ
__de¡Ën
), 
__wınıy_chk
)

219 
	`__w¬Ç‰r
 ("wcpncpy called with†ength biggerhan size of destination "

222 
__ex‹º_®ways_šlše
 
wch¬_t
 *

223 
	`__NTH
 (
	$wınıy
 (
wch¬_t
 *
__»¡riù
 
__de¡
, 
__cÚ¡
 wch¬_ˆ*__»¡riù 
__¤c
,

224 
size_t
 
__n
))

226 ià(
	`__bos
 (
__de¡
è!ğ(
size_t
) -1)

228 ià(!
	`__butš_cÚ¡ªt_p
 (
__n
))

229  
	`__wınıy_chk
 (
__de¡
, 
__¤c
, 
__n
,

230 
	`__bos
 (
__de¡
è/  (
wch¬_t
));

231 ià(
__n
 > 
	`__bos
 (
__de¡
è/  (
wch¬_t
))

232  
	`__wınıy_chk_w¬n
 (
__de¡
, 
__¤c
, 
__n
,

233 
	`__bos
 (
__de¡
è/  (
wch¬_t
));

235  
	`__wınıy_®Ÿs
 (
__de¡
, 
__¤c
, 
__n
);

236 
	}
}

239 
wch¬_t
 *
	$__wcsÿt_chk
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

240 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__¤c
,

241 
size_t
 
__de¡Ën
è
__THROW
;

242 
wch¬_t
 *
	`__REDIRECT_NTH
 (
__wcsÿt_®Ÿs
,

243 (
wch¬_t
 *
__»¡riù
 
__de¡
,

244 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__¤c
), 
wcsÿt
);

246 
__ex‹º_®ways_šlše
 
wch¬_t
 *

247 
	`__NTH
 (
	$wcsÿt
 (
wch¬_t
 *
__»¡riù
 
__de¡
, 
__cÚ¡
 wch¬_ˆ*__»¡riù 
__¤c
))

249 ià(
	`__bos
 (
__de¡
è!ğ(
size_t
) -1)

250  
	`__wcsÿt_chk
 (
__de¡
, 
__¤c
, 
	`__bos
 (__de¡è/  (
wch¬_t
));

251  
	`__wcsÿt_®Ÿs
 (
__de¡
, 
__¤c
);

252 
	}
}

255 
wch¬_t
 *
	$__wc¢ÿt_chk
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

256 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__¤c
,

257 
size_t
 
__n
, size_ˆ
__de¡Ën
è
__THROW
;

258 
wch¬_t
 *
	`__REDIRECT_NTH
 (
__wc¢ÿt_®Ÿs
,

259 (
wch¬_t
 *
__»¡riù
 
__de¡
,

260 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__¤c
,

261 
size_t
 
__n
), 
wc¢ÿt
);

263 
__ex‹º_®ways_šlše
 
wch¬_t
 *

264 
	`__NTH
 (
	$wc¢ÿt
 (
wch¬_t
 *
__»¡riù
 
__de¡
, 
__cÚ¡
 wch¬_ˆ*__»¡riù 
__¤c
,

265 
size_t
 
__n
))

267 ià(
	`__bos
 (
__de¡
è!ğ(
size_t
) -1)

268  
	`__wc¢ÿt_chk
 (
__de¡
, 
__¤c
, 
__n
,

269 
	`__bos
 (
__de¡
è/  (
wch¬_t
));

270  
	`__wc¢ÿt_®Ÿs
 (
__de¡
, 
__¤c
, 
__n
);

271 
	}
}

274 
	$__sw´štf_chk
 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__n
,

275 
__æag
, 
size_t
 
__s_Ën
,

276 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

277 
__THROW
 ;

279 
	`__REDIRECT_NTH_LDBL
 (
__sw´štf_®Ÿs
,

280 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__n
,

281 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fmt
, ...),

282 
sw´štf
);

284 #ifdeà
__va_¬g_·ck


285 
__ex‹º_®ways_šlše
 

286 
	`__NTH
 (
	$sw´štf
 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__n
,

287 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fmt
, ...))

289 ià(
	`__bos
 (
__s
è!ğ(
size_t
è-1 || 
__USE_FORTIFY_LEVEL
 > 1)

290  
	`__sw´štf_chk
 (
__s
, 
__n
, 
__USE_FORTIFY_LEVEL
 - 1,

291 
	`__bos
 (
__s
è/  (
wch¬_t
),

292 
__fmt
, 
	`__va_¬g_·ck
 ());

293  
	`__sw´štf_®Ÿs
 (
__s
, 
__n
, 
__fmt
, 
	`__va_¬g_·ck
 ());

294 
	}
}

295 #–ià!
defšed
 
__ılu¥lus


297 
	#sw´štf
(
s
, 
n
, ...) \

298 (
	`__bos
 (
s
è!ğ(
size_t
è-1 || 
__USE_FORTIFY_LEVEL
 > 1 \

299 ? 
	`__sw´štf_chk
 (
s
, 
n
, 
__USE_FORTIFY_LEVEL
 - 1, \

300 
	`__bos
 (
s
è/  (
wch¬_t
), 
__VA_ARGS__
) \

301 : 
	`sw´štf
 (
s
, 
n
, 
__VA_ARGS__
))

	)

304 
	$__vsw´štf_chk
 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__n
,

305 
__æag
, 
size_t
 
__s_Ën
,

306 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

307 
__gnuc_va_li¡
 
__¬g
)

308 
__THROW
 ;

310 
	`__REDIRECT_NTH_LDBL
 (
__vsw´štf_®Ÿs
,

311 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__n
,

312 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fmt
,

313 
__gnuc_va_li¡
 
__­
), 
vsw´štf
);

315 
__ex‹º_®ways_šlše
 

316 
	`__NTH
 (
	$vsw´štf
 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__n
,

317 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fmt
, 
__gnuc_va_li¡
 
__­
))

319 ià(
	`__bos
 (
__s
è!ğ(
size_t
è-1 || 
__USE_FORTIFY_LEVEL
 > 1)

320  
	`__vsw´štf_chk
 (
__s
, 
__n
, 
__USE_FORTIFY_LEVEL
 - 1,

321 
	`__bos
 (
__s
è/  (
wch¬_t
), 
__fmt
, 
__­
);

322  
	`__vsw´štf_®Ÿs
 (
__s
, 
__n
, 
__fmt
, 
__­
);

323 
	}
}

326 #ià
__USE_FORTIFY_LEVEL
 > 1

328 
__fw´štf_chk
 (
__FILE
 *
__»¡riù
 
__¡»am
, 
__æag
,

329 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...);

330 
__w´štf_chk
 (
__æag
, 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

332 
__vfw´štf_chk
 (
__FILE
 *
__»¡riù
 
__¡»am
, 
__æag
,

333 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

334 
__gnuc_va_li¡
 
__­
);

335 
__vw´štf_chk
 (
__æag
, 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

336 
__gnuc_va_li¡
 
__­
);

338 #ifdeà
__va_¬g_·ck


339 
__ex‹º_®ways_šlše
 

340 
	$w´štf
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fmt
, ...)

342  
	`__w´štf_chk
 (
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
, 
	`__va_¬g_·ck
 ());

343 
	}
}

345 
__ex‹º_®ways_šlše
 

346 
	$fw´štf
 (
__FILE
 *
__»¡riù
 
__¡»am
, 
__cÚ¡
 
wch¬_t
 *__»¡riù 
__fmt
, ...)

348  
	`__fw´štf_chk
 (
__¡»am
, 
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
,

349 
	`__va_¬g_·ck
 ());

350 
	}
}

351 #–ià!
defšed
 
__ılu¥lus


352 
	#w´štf
(...) \

353 
	`__w´štf_chk
 (
__USE_FORTIFY_LEVEL
 - 1, 
__VA_ARGS__
)

	)

354 
	#fw´štf
(
¡»am
, ...) \

355 
	`__fw´štf_chk
 (
¡»am
, 
__USE_FORTIFY_LEVEL
 - 1, 
__VA_ARGS__
)

	)

358 
__ex‹º_®ways_šlše
 

359 
	$vw´štf
 (
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fmt
, 
__gnuc_va_li¡
 
__­
)

361  
	`__vw´štf_chk
 (
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
, 
__­
);

362 
	}
}

364 
__ex‹º_®ways_šlše
 

365 
	$vfw´štf
 (
__FILE
 *
__»¡riù
 
__¡»am
,

366 
__cÚ¡
 
wch¬_t
 *
__»¡riù
 
__fmt
, 
__gnuc_va_li¡
 
__­
)

368  
	`__vfw´štf_chk
 (
__¡»am
, 
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
, 
__­
);

369 
	}
}

373 
wch¬_t
 *
	$__fg‘ws_chk
 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__size
, 
__n
,

374 
__FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

375 
wch¬_t
 *
	`__REDIRECT
 (
__fg‘ws_®Ÿs
,

376 (
wch¬_t
 *
__»¡riù
 
__s
, 
__n
,

377 
__FILE
 *
__»¡riù
 
__¡»am
), 
fg‘ws
è
__wur
;

378 
wch¬_t
 *
	`__REDIRECT
 (
__fg‘ws_chk_w¬n
,

379 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__size
, 
__n
,

380 
__FILE
 *
__»¡riù
 
__¡»am
), 
__fg‘ws_chk
)

381 
__wur
 
	`__w¬Ç‰r
 ("fgetws called with bigger sizehan†ength "

384 
__ex‹º_®ways_šlše
 
__wur
 
wch¬_t
 *

385 
	$fg‘ws
 (
wch¬_t
 *
__»¡riù
 
__s
, 
__n
, 
__FILE
 *__»¡riù 
__¡»am
)

387 ià(
	`__bos
 (
__s
è!ğ(
size_t
) -1)

389 ià(!
	`__butš_cÚ¡ªt_p
 (
__n
) || __n <= 0)

390  
	`__fg‘ws_chk
 (
__s
, 
	`__bos
 (__sè/  (
wch¬_t
),

391 
__n
, 
__¡»am
);

393 ià((
size_t
è
__n
 > 
	`__bos
 (
__s
è/  (
wch¬_t
))

394  
	`__fg‘ws_chk_w¬n
 (
__s
, 
	`__bos
 (__sè/  (
wch¬_t
),

395 
__n
, 
__¡»am
);

397  
	`__fg‘ws_®Ÿs
 (
__s
, 
__n
, 
__¡»am
);

398 
	}
}

400 #ifdeà
__USE_GNU


401 
wch¬_t
 *
	$__fg‘ws_uÆocked_chk
 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__size
,

402 
__n
, 
__FILE
 *
__»¡riù
 
__¡»am
)

403 
__wur
;

404 
wch¬_t
 *
	`__REDIRECT
 (
__fg‘ws_uÆocked_®Ÿs
,

405 (
wch¬_t
 *
__»¡riù
 
__s
, 
__n
,

406 
__FILE
 *
__»¡riù
 
__¡»am
), 
fg‘ws_uÆocked
)

407 
__wur
;

408 
wch¬_t
 *
	`__REDIRECT
 (
__fg‘ws_uÆocked_chk_w¬n
,

409 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__size
, 
__n
,

410 
__FILE
 *
__»¡riù
 
__¡»am
),

411 
__fg‘ws_uÆocked_chk
)

412 
__wur
 
	`__w¬Ç‰r
 ("fgetws_unlocked called with bigger sizehan†ength "

415 
__ex‹º_®ways_šlše
 
__wur
 
wch¬_t
 *

416 
	$fg‘ws_uÆocked
 (
wch¬_t
 *
__»¡riù
 
__s
, 
__n
, 
__FILE
 *__»¡riù 
__¡»am
)

418 ià(
	`__bos
 (
__s
è!ğ(
size_t
) -1)

420 ià(!
	`__butš_cÚ¡ªt_p
 (
__n
) || __n <= 0)

421  
	`__fg‘ws_uÆocked_chk
 (
__s
, 
	`__bos
 (__sè/  (
wch¬_t
),

422 
__n
, 
__¡»am
);

424 ià((
size_t
è
__n
 > 
	`__bos
 (
__s
è/  (
wch¬_t
))

425  
	`__fg‘ws_uÆocked_chk_w¬n
 (
__s
, 
	`__bos
 (__sè/  (
wch¬_t
),

426 
__n
, 
__¡»am
);

428  
	`__fg‘ws_uÆocked_®Ÿs
 (
__s
, 
__n
, 
__¡»am
);

429 
	}
}

433 
size_t
 
	$__wütomb_chk
 (*
__»¡riù
 
__s
, 
wch¬_t
 
__wch¬
,

434 
mb¡©e_t
 *
__»¡riù
 
__p
,

435 
size_t
 
__buæ’
è
__THROW
 
__wur
;

436 
size_t
 
	`__REDIRECT_NTH
 (
__wütomb_®Ÿs
,

437 (*
__»¡riù
 
__s
, 
wch¬_t
 
__wch¬
,

438 
mb¡©e_t
 *
__»¡riù
 
__ps
), 
wütomb
è
__wur
;

440 
__ex‹º_®ways_šlše
 
__wur
 
size_t


441 
	`__NTH
 (
	$wütomb
 (*
__»¡riù
 
__s
, 
wch¬_t
 
__wch¬
,

442 
mb¡©e_t
 *
__»¡riù
 
__ps
))

447 
	#__WCHAR_MB_LEN_MAX
 16

	)

448 #ià
defšed
 
MB_LEN_MAX
 && MB_LEN_MAX !ğ
__WCHAR_MB_LEN_MAX


451 ià(
	`__bos
 (
__s
è!ğ(
size_t
è-1 && 
__WCHAR_MB_LEN_MAX
 > __bos (__s))

452  
	`__wütomb_chk
 (
__s
, 
__wch¬
, 
__ps
, 
	`__bos
 (__s));

453  
	`__wütomb_®Ÿs
 (
__s
, 
__wch¬
, 
__ps
);

454 
	}
}

457 
size_t
 
	$__mb¤towcs_chk
 (
wch¬_t
 *
__»¡riù
 
__d¡
,

458 
__cÚ¡
 **
__»¡riù
 
__¤c
,

459 
size_t
 
__Ën
, 
mb¡©e_t
 *
__»¡riù
 
__ps
,

460 
size_t
 
__d¡Ën
è
__THROW
;

461 
size_t
 
	`__REDIRECT_NTH
 (
__mb¤towcs_®Ÿs
,

462 (
wch¬_t
 *
__»¡riù
 
__d¡
,

463 
__cÚ¡
 **
__»¡riù
 
__¤c
,

464 
size_t
 
__Ën
, 
mb¡©e_t
 *
__»¡riù
 
__ps
),

465 
mb¤towcs
);

466 
size_t
 
	`__REDIRECT_NTH
 (
__mb¤towcs_chk_w¬n
,

467 (
wch¬_t
 *
__»¡riù
 
__d¡
,

468 
__cÚ¡
 **
__»¡riù
 
__¤c
,

469 
size_t
 
__Ën
, 
mb¡©e_t
 *
__»¡riù
 
__ps
,

470 
size_t
 
__d¡Ën
), 
__mb¤towcs_chk
)

471 
	`__w¬Ç‰r
 ("mbsrtowcs called with dst buffer smallerhan†en "

474 
__ex‹º_®ways_šlše
 
size_t


475 
	`__NTH
 (
	$mb¤towcs
 (
wch¬_t
 *
__»¡riù
 
__d¡
, 
__cÚ¡
 **__»¡riù 
__¤c
,

476 
size_t
 
__Ën
, 
mb¡©e_t
 *
__»¡riù
 
__ps
))

478 ià(
	`__bos
 (
__d¡
è!ğ(
size_t
) -1)

480 ià(!
	`__butš_cÚ¡ªt_p
 (
__Ën
))

481  
	`__mb¤towcs_chk
 (
__d¡
, 
__¤c
, 
__Ën
, 
__ps
,

482 
	`__bos
 (
__d¡
è/  (
wch¬_t
));

484 ià(
__Ën
 > 
	`__bos
 (
__d¡
è/  (
wch¬_t
))

485  
	`__mb¤towcs_chk_w¬n
 (
__d¡
, 
__¤c
, 
__Ën
, 
__ps
,

486 
	`__bos
 (
__d¡
è/  (
wch¬_t
));

488  
	`__mb¤towcs_®Ÿs
 (
__d¡
, 
__¤c
, 
__Ën
, 
__ps
);

489 
	}
}

492 
size_t
 
	$__wc¤tombs_chk
 (*
__»¡riù
 
__d¡
,

493 
__cÚ¡
 
wch¬_t
 **
__»¡riù
 
__¤c
,

494 
size_t
 
__Ën
, 
mb¡©e_t
 *
__»¡riù
 
__ps
,

495 
size_t
 
__d¡Ën
è
__THROW
;

496 
size_t
 
	`__REDIRECT_NTH
 (
__wc¤tombs_®Ÿs
,

497 (*
__»¡riù
 
__d¡
,

498 
__cÚ¡
 
wch¬_t
 **
__»¡riù
 
__¤c
,

499 
size_t
 
__Ën
, 
mb¡©e_t
 *
__»¡riù
 
__ps
),

500 
wc¤tombs
);

501 
size_t
 
	`__REDIRECT_NTH
 (
__wc¤tombs_chk_w¬n
,

502 (*
__»¡riù
 
__d¡
,

503 
__cÚ¡
 
wch¬_t
 **
__»¡riù
 
__¤c
,

504 
size_t
 
__Ën
, 
mb¡©e_t
 *
__»¡riù
 
__ps
,

505 
size_t
 
__d¡Ën
), 
__wc¤tombs_chk
)

506 
	`__w¬Ç‰r
 ("wcsrtombs called with dst buffer smallerhan†en");

508 
__ex‹º_®ways_šlše
 
size_t


509 
	`__NTH
 (
	$wc¤tombs
 (*
__»¡riù
 
__d¡
, 
__cÚ¡
 
wch¬_t
 **__»¡riù 
__¤c
,

510 
size_t
 
__Ën
, 
mb¡©e_t
 *
__»¡riù
 
__ps
))

512 ià(
	`__bos
 (
__d¡
è!ğ(
size_t
) -1)

514 ià(!
	`__butš_cÚ¡ªt_p
 (
__Ën
))

515  
	`__wc¤tombs_chk
 (
__d¡
, 
__¤c
, 
__Ën
, 
__ps
, 
	`__bos
 (__dst));

517 ià(
__Ën
 > 
	`__bos
 (
__d¡
))

518  
	`__wc¤tombs_chk_w¬n
 (
__d¡
, 
__¤c
, 
__Ën
, 
__ps
, 
	`__bos
 (__dst));

520  
	`__wc¤tombs_®Ÿs
 (
__d¡
, 
__¤c
, 
__Ën
, 
__ps
);

521 
	}
}

524 #ifdeà
__USE_GNU


525 
size_t
 
	$__mb¢¹owcs_chk
 (
wch¬_t
 *
__»¡riù
 
__d¡
,

526 
__cÚ¡
 **
__»¡riù
 
__¤c
, 
size_t
 
__nmc
,

527 
size_t
 
__Ën
, 
mb¡©e_t
 *
__»¡riù
 
__ps
,

528 
size_t
 
__d¡Ën
è
__THROW
;

529 
size_t
 
	`__REDIRECT_NTH
 (
__mb¢¹owcs_®Ÿs
,

530 (
wch¬_t
 *
__»¡riù
 
__d¡
,

531 
__cÚ¡
 **
__»¡riù
 
__¤c
, 
size_t
 
__nmc
,

532 
size_t
 
__Ën
, 
mb¡©e_t
 *
__»¡riù
 
__ps
),

533 
mb¢¹owcs
);

534 
size_t
 
	`__REDIRECT_NTH
 (
__mb¢¹owcs_chk_w¬n
,

535 (
wch¬_t
 *
__»¡riù
 
__d¡
,

536 
__cÚ¡
 **
__»¡riù
 
__¤c
, 
size_t
 
__nmc
,

537 
size_t
 
__Ën
, 
mb¡©e_t
 *
__»¡riù
 
__ps
,

538 
size_t
 
__d¡Ën
), 
__mb¢¹owcs_chk
)

539 
	`__w¬Ç‰r
 ("mbsnrtowcs called with dst buffer smallerhan†en "

542 
__ex‹º_®ways_šlše
 
size_t


543 
	`__NTH
 (
	$mb¢¹owcs
 (
wch¬_t
 *
__»¡riù
 
__d¡
, 
__cÚ¡
 **__»¡riù 
__¤c
,

544 
size_t
 
__nmc
, size_ˆ
__Ën
, 
mb¡©e_t
 *
__»¡riù
 
__ps
))

546 ià(
	`__bos
 (
__d¡
è!ğ(
size_t
) -1)

548 ià(!
	`__butš_cÚ¡ªt_p
 (
__Ën
))

549  
	`__mb¢¹owcs_chk
 (
__d¡
, 
__¤c
, 
__nmc
, 
__Ën
, 
__ps
,

550 
	`__bos
 (
__d¡
è/  (
wch¬_t
));

552 ià(
__Ën
 > 
	`__bos
 (
__d¡
è/  (
wch¬_t
))

553  
	`__mb¢¹owcs_chk_w¬n
 (
__d¡
, 
__¤c
, 
__nmc
, 
__Ën
, 
__ps
,

554 
	`__bos
 (
__d¡
è/  (
wch¬_t
));

556  
	`__mb¢¹owcs_®Ÿs
 (
__d¡
, 
__¤c
, 
__nmc
, 
__Ën
, 
__ps
);

557 
	}
}

560 
size_t
 
	$__wc¢¹ombs_chk
 (*
__»¡riù
 
__d¡
,

561 
__cÚ¡
 
wch¬_t
 **
__»¡riù
 
__¤c
,

562 
size_t
 
__nwc
, size_ˆ
__Ën
,

563 
mb¡©e_t
 *
__»¡riù
 
__ps
, 
size_t
 
__d¡Ën
)

564 
__THROW
;

565 
size_t
 
	`__REDIRECT_NTH
 (
__wc¢¹ombs_®Ÿs
,

566 (*
__»¡riù
 
__d¡
,

567 
__cÚ¡
 
wch¬_t
 **
__»¡riù
 
__¤c
,

568 
size_t
 
__nwc
, size_ˆ
__Ën
,

569 
mb¡©e_t
 *
__»¡riù
 
__ps
), 
wc¢¹ombs
);

570 
size_t
 
	`__REDIRECT_NTH
 (
__wc¢¹ombs_chk_w¬n
,

571 (*
__»¡riù
 
__d¡
,

572 
__cÚ¡
 
wch¬_t
 **
__»¡riù
 
__¤c
,

573 
size_t
 
__nwc
, size_ˆ
__Ën
,

574 
mb¡©e_t
 *
__»¡riù
 
__ps
,

575 
size_t
 
__d¡Ën
), 
__wc¢¹ombs_chk
)

576 
	`__w¬Ç‰r
 ("wcsnrtombs called with dst buffer smallerhan†en");

578 
__ex‹º_®ways_šlše
 
size_t


579 
	`__NTH
 (
	$wc¢¹ombs
 (*
__»¡riù
 
__d¡
, 
__cÚ¡
 
wch¬_t
 **__»¡riù 
__¤c
,

580 
size_t
 
__nwc
, size_ˆ
__Ën
, 
mb¡©e_t
 *
__»¡riù
 
__ps
))

582 ià(
	`__bos
 (
__d¡
è!ğ(
size_t
) -1)

584 ià(!
	`__butš_cÚ¡ªt_p
 (
__Ën
))

585  
	`__wc¢¹ombs_chk
 (
__d¡
, 
__¤c
, 
__nwc
, 
__Ën
, 
__ps
,

586 
	`__bos
 (
__d¡
));

588 ià(
__Ën
 > 
	`__bos
 (
__d¡
))

589  
	`__wc¢¹ombs_chk_w¬n
 (
__d¡
, 
__¤c
, 
__nwc
, 
__Ën
, 
__ps
,

590 
	`__bos
 (
__d¡
));

592  
	`__wc¢¹ombs_®Ÿs
 (
__d¡
, 
__¤c
, 
__nwc
, 
__Ën
, 
__ps
);

593 
	}
}

	@/usr/include/pthread.h

20 #iâdeà
_PTHREAD_H


21 
	#_PTHREAD_H
 1

	)

23 
	~<ã©u»s.h
>

24 
	~<’dŸn.h
>

25 
	~<sched.h
>

26 
	~<time.h
>

28 
	~<b™s/±h»adty³s.h
>

29 
	~<b™s/£tjmp.h
>

30 
	~<b™s/wÜdsize.h
>

36 
	mPTHREAD_CREATE_JOINABLE
,

37 
	#PTHREAD_CREATE_JOINABLE
 
PTHREAD_CREATE_JOINABLE


	)

38 
	mPTHREAD_CREATE_DETACHED


39 
	#PTHREAD_CREATE_DETACHED
 
PTHREAD_CREATE_DETACHED


	)

46 
	mPTHREAD_MUTEX_TIMED_NP
,

47 
	mPTHREAD_MUTEX_RECURSIVE_NP
,

48 
	mPTHREAD_MUTEX_ERRORCHECK_NP
,

49 
	mPTHREAD_MUTEX_ADAPTIVE_NP


50 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K8


52 
	mPTHREAD_MUTEX_NORMAL
 = 
PTHREAD_MUTEX_TIMED_NP
,

53 
	mPTHREAD_MUTEX_RECURSIVE
 = 
PTHREAD_MUTEX_RECURSIVE_NP
,

54 
	mPTHREAD_MUTEX_ERRORCHECK
 = 
PTHREAD_MUTEX_ERRORCHECK_NP
,

55 
	mPTHREAD_MUTEX_DEFAULT
 = 
PTHREAD_MUTEX_NORMAL


57 #ifdeà
__USE_GNU


59 , 
	mPTHREAD_MUTEX_FAST_NP
 = 
PTHREAD_MUTEX_TIMED_NP


64 #ifdeà
__USE_XOPEN2K


68 
	mPTHREAD_MUTEX_STALLED
,

69 
	mPTHREAD_MUTEX_STALLED_NP
 = 
PTHREAD_MUTEX_STALLED
,

70 
	mPTHREAD_MUTEX_ROBUST
,

71 
	mPTHREAD_MUTEX_ROBUST_NP
 = 
PTHREAD_MUTEX_ROBUST


76 #ifdeà
__USE_UNIX98


80 
	mPTHREAD_PRIO_NONE
,

81 
	mPTHREAD_PRIO_INHERIT
,

82 
	mPTHREAD_PRIO_PROTECT


88 #ià
__WORDSIZE
 == 64

89 
	#PTHREAD_MUTEX_INITIALIZER
 \

90 { { 0, 0, 0, 0, 0, 0, { 0, 0 } } }

	)

91 #ifdeà
__USE_GNU


92 
	#PTHREAD_RECURSIVE_MUTEX_INITIALIZER_NP
 \

93 { { 0, 0, 0, 0, 
PTHREAD_MUTEX_RECURSIVE_NP
, 0, { 0, 0 } } }

	)

94 
	#PTHREAD_ERRORCHECK_MUTEX_INITIALIZER_NP
 \

95 { { 0, 0, 0, 0, 
PTHREAD_MUTEX_ERRORCHECK_NP
, 0, { 0, 0 } } }

	)

96 
	#PTHREAD_ADAPTIVE_MUTEX_INITIALIZER_NP
 \

97 { { 0, 0, 0, 0, 
PTHREAD_MUTEX_ADAPTIVE_NP
, 0, { 0, 0 } } }

	)

100 
	#PTHREAD_MUTEX_INITIALIZER
 \

101 { { 0, 0, 0, 0, 0, { 0 } } }

	)

102 #ifdeà
__USE_GNU


103 
	#PTHREAD_RECURSIVE_MUTEX_INITIALIZER_NP
 \

104 { { 0, 0, 0, 
PTHREAD_MUTEX_RECURSIVE_NP
, 0, { 0 } } }

	)

105 
	#PTHREAD_ERRORCHECK_MUTEX_INITIALIZER_NP
 \

106 { { 0, 0, 0, 
PTHREAD_MUTEX_ERRORCHECK_NP
, 0, { 0 } } }

	)

107 
	#PTHREAD_ADAPTIVE_MUTEX_INITIALIZER_NP
 \

108 { { 0, 0, 0, 
PTHREAD_MUTEX_ADAPTIVE_NP
, 0, { 0 } } }

	)

114 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K


117 
	mPTHREAD_RWLOCK_PREFER_READER_NP
,

118 
	mPTHREAD_RWLOCK_PREFER_WRITER_NP
,

119 
	mPTHREAD_RWLOCK_PREFER_WRITER_NONRECURSIVE_NP
,

120 
	mPTHREAD_RWLOCK_DEFAULT_NP
 = 
PTHREAD_RWLOCK_PREFER_READER_NP


124 
	#PTHREAD_RWLOCK_INITIALIZER
 \

125 { { 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 } }

	)

126 #ifdeà
__USE_GNU


127 #ià
__WORDSIZE
 == 64

128 
	#PTHREAD_RWLOCK_WRITER_NONRECURSIVE_INITIALIZER_NP
 \

130 
PTHREAD_RWLOCK_PREFER_WRITER_NONRECURSIVE_NP
 } }

	)

132 #ià
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN


133 
	#PTHREAD_RWLOCK_WRITER_NONRECURSIVE_INITIALIZER_NP
 \

134 { { 0, 0, 0, 0, 0, 0, 
PTHREAD_RWLOCK_PREFER_WRITER_NONRECURSIVE_NP
, \

135 0, 0, 0, 0 } }

	)

137 
	#PTHREAD_RWLOCK_WRITER_NONRECURSIVE_INITIALIZER_NP
 \

138 { { 0, 0, 0, 0, 0, 0, 0, 0, 0, 
PTHREAD_RWLOCK_PREFER_WRITER_NONRECURSIVE_NP
,\

139 0 } }

	)

149 
	mPTHREAD_INHERIT_SCHED
,

150 
	#PTHREAD_INHERIT_SCHED
 
PTHREAD_INHERIT_SCHED


	)

151 
	mPTHREAD_EXPLICIT_SCHED


152 
	#PTHREAD_EXPLICIT_SCHED
 
PTHREAD_EXPLICIT_SCHED


	)

159 
	mPTHREAD_SCOPE_SYSTEM
,

160 
	#PTHREAD_SCOPE_SYSTEM
 
PTHREAD_SCOPE_SYSTEM


	)

161 
	mPTHREAD_SCOPE_PROCESS


162 
	#PTHREAD_SCOPE_PROCESS
 
PTHREAD_SCOPE_PROCESS


	)

169 
	mPTHREAD_PROCESS_PRIVATE
,

170 
	#PTHREAD_PROCESS_PRIVATE
 
PTHREAD_PROCESS_PRIVATE


	)

171 
	mPTHREAD_PROCESS_SHARED


172 
	#PTHREAD_PROCESS_SHARED
 
PTHREAD_PROCESS_SHARED


	)

178 
	#PTHREAD_COND_INITIALIZER
 { { 0, 0, 0, 0, 0, (*è0, 0, 0 } }

	)

182 
	s_±h»ad_ş—nup_bufãr


184 (*
	m__routše
) (*);

185 *
	m__¬g
;

186 
	m__ÿnûÉy³
;

187 
_±h»ad_ş—nup_bufãr
 *
	m__´ev
;

193 
	mPTHREAD_CANCEL_ENABLE
,

194 
	#PTHREAD_CANCEL_ENABLE
 
PTHREAD_CANCEL_ENABLE


	)

195 
	mPTHREAD_CANCEL_DISABLE


196 
	#PTHREAD_CANCEL_DISABLE
 
PTHREAD_CANCEL_DISABLE


	)

200 
	mPTHREAD_CANCEL_DEFERRED
,

201 
	#PTHREAD_CANCEL_DEFERRED
 
PTHREAD_CANCEL_DEFERRED


	)

202 
	mPTHREAD_CANCEL_ASYNCHRONOUS


203 
	#PTHREAD_CANCEL_ASYNCHRONOUS
 
PTHREAD_CANCEL_ASYNCHRONOUS


	)

205 
	#PTHREAD_CANCELED
 ((*è-1)

	)

209 
	#PTHREAD_ONCE_INIT
 0

	)

212 #ifdeà
__USE_XOPEN2K


216 
	#PTHREAD_BARRIER_SERIAL_THREAD
 -1

	)

220 
__BEGIN_DECLS


225 
±h»ad_ü—‹
 (
±h»ad_t
 *
__»¡riù
 
__Ãwth»ad
,

226 
__cÚ¡
 
±h»ad_©Œ_t
 *
__»¡riù
 
__©Œ
,

227 *(*
__¡¬t_routše
) (*),

228 *
__»¡riù
 
__¬g
è
__THROW
 
__nÚnuÎ
 ((1, 3));

234 
	$±h»ad_ex™
 (*
__»tv®
è
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

242 
	`±h»ad_još
 (
±h»ad_t
 
__th
, **
__th»ad_»tuº
);

244 #ifdeà
__USE_GNU


247 
	$±h»ad_Œyjoš_Å
 (
±h»ad_t
 
__th
, **
__th»ad_»tuº
è
__THROW
;

255 
	`±h»ad_timedjoš_Å
 (
±h»ad_t
 
__th
, **
__th»ad_»tuº
,

256 
__cÚ¡
 
time¥ec
 *
__ab¡ime
);

263 
	$±h»ad_d‘ach
 (
±h»ad_t
 
__th
è
__THROW
;

267 
±h»ad_t
 
	$±h»ad_£lf
 (è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

270 
	$±h»ad_equ®
 (
±h»ad_t
 
__th»ad1
,…th»ad_ˆ
__th»ad2
è
__THROW
;

278 
	$±h»ad_©Œ_š™
 (
±h»ad_©Œ_t
 *
__©Œ
è
__THROW
 
	`__nÚnuÎ
 ((1));

281 
	$±h»ad_©Œ_de¡roy
 (
±h»ad_©Œ_t
 *
__©Œ
)

282 
__THROW
 
	`__nÚnuÎ
 ((1));

285 
	$±h»ad_©Œ_g‘d‘ach¡©e
 (
__cÚ¡
 
±h»ad_©Œ_t
 *
__©Œ
,

286 *
__d‘ach¡©e
)

287 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

290 
	$±h»ad_©Œ_£td‘ach¡©e
 (
±h»ad_©Œ_t
 *
__©Œ
,

291 
__d‘ach¡©e
)

292 
__THROW
 
	`__nÚnuÎ
 ((1));

296 
	$±h»ad_©Œ_g‘gu¬dsize
 (
__cÚ¡
 
±h»ad_©Œ_t
 *
__©Œ
,

297 
size_t
 *
__gu¬dsize
)

298 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

301 
	$±h»ad_©Œ_£tgu¬dsize
 (
±h»ad_©Œ_t
 *
__©Œ
,

302 
size_t
 
__gu¬dsize
)

303 
__THROW
 
	`__nÚnuÎ
 ((1));

307 
	$±h»ad_©Œ_g‘sched·¿m
 (
__cÚ¡
 
±h»ad_©Œ_t
 *
__»¡riù


308 
__©Œ
,

309 
sched_·¿m
 *
__»¡riù
 
__·¿m
)

310 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

313 
	$±h»ad_©Œ_£tsched·¿m
 (
±h»ad_©Œ_t
 *
__»¡riù
 
__©Œ
,

314 
__cÚ¡
 
sched_·¿m
 *
__»¡riù


315 
__·¿m
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

318 
	$±h»ad_©Œ_g‘schedpŞicy
 (
__cÚ¡
 
±h»ad_©Œ_t
 *
__»¡riù


319 
__©Œ
, *
__»¡riù
 
__pŞicy
)

320 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

323 
	$±h»ad_©Œ_£tschedpŞicy
 (
±h»ad_©Œ_t
 *
__©Œ
, 
__pŞicy
)

324 
__THROW
 
	`__nÚnuÎ
 ((1));

327 
	$±h»ad_©Œ_g‘šh”™sched
 (
__cÚ¡
 
±h»ad_©Œ_t
 *
__»¡riù


328 
__©Œ
, *
__»¡riù
 
__šh”™
)

329 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

332 
	$±h»ad_©Œ_£tšh”™sched
 (
±h»ad_©Œ_t
 *
__©Œ
,

333 
__šh”™
)

334 
__THROW
 
	`__nÚnuÎ
 ((1));

338 
	$±h»ad_©Œ_g‘scİe
 (
__cÚ¡
 
±h»ad_©Œ_t
 *
__»¡riù
 
__©Œ
,

339 *
__»¡riù
 
__scİe
)

340 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

343 
	$±h»ad_©Œ_£tscİe
 (
±h»ad_©Œ_t
 *
__©Œ
, 
__scİe
)

344 
__THROW
 
	`__nÚnuÎ
 ((1));

347 
	$±h»ad_©Œ_g‘¡ackaddr
 (
__cÚ¡
 
±h»ad_©Œ_t
 *
__»¡riù


348 
__©Œ
, **
__»¡riù
 
__¡ackaddr
)

349 
__THROW
 
	`__nÚnuÎ
 ((1, 2)è
__©Œibu‹_d•»ÿ‹d__
;

355 
	$±h»ad_©Œ_£t¡ackaddr
 (
±h»ad_©Œ_t
 *
__©Œ
,

356 *
__¡ackaddr
)

357 
__THROW
 
	`__nÚnuÎ
 ((1)è
__©Œibu‹_d•»ÿ‹d__
;

360 
	$±h»ad_©Œ_g‘¡acksize
 (
__cÚ¡
 
±h»ad_©Œ_t
 *
__»¡riù


361 
__©Œ
, 
size_t
 *
__»¡riù
 
__¡acksize
)

362 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

367 
	$±h»ad_©Œ_£t¡acksize
 (
±h»ad_©Œ_t
 *
__©Œ
,

368 
size_t
 
__¡acksize
)

369 
__THROW
 
	`__nÚnuÎ
 ((1));

371 #ifdeà
__USE_XOPEN2K


373 
	$±h»ad_©Œ_g‘¡ack
 (
__cÚ¡
 
±h»ad_©Œ_t
 *
__»¡riù
 
__©Œ
,

374 **
__»¡riù
 
__¡ackaddr
,

375 
size_t
 *
__»¡riù
 
__¡acksize
)

376 
__THROW
 
	`__nÚnuÎ
 ((1, 2, 3));

381 
	$±h»ad_©Œ_£t¡ack
 (
±h»ad_©Œ_t
 *
__©Œ
, *
__¡ackaddr
,

382 
size_t
 
__¡acksize
è
__THROW
 
	`__nÚnuÎ
 ((1));

385 #ifdeà
__USE_GNU


388 
	$±h»ad_©Œ_£ffš™y_Å
 (
±h»ad_©Œ_t
 *
__©Œ
,

389 
size_t
 
__ıu£tsize
,

390 
__cÚ¡
 
ıu_£t_t
 *
__ıu£t
)

391 
__THROW
 
	`__nÚnuÎ
 ((1, 3));

395 
	$±h»ad_©Œ_g‘affš™y_Å
 (
__cÚ¡
 
±h»ad_©Œ_t
 *
__©Œ
,

396 
size_t
 
__ıu£tsize
,

397 
ıu_£t_t
 *
__ıu£t
)

398 
__THROW
 
	`__nÚnuÎ
 ((1, 3));

404 
	$±h»ad_g‘©Œ_Å
 (
±h»ad_t
 
__th
, 
±h»ad_©Œ_t
 *
__©Œ
)

405 
__THROW
 
	`__nÚnuÎ
 ((2));

413 
	$±h»ad_£tsched·¿m
 (
±h»ad_t
 
__rg‘_th»ad
, 
__pŞicy
,

414 
__cÚ¡
 
sched_·¿m
 *
__·¿m
)

415 
__THROW
 
	`__nÚnuÎ
 ((3));

418 
	$±h»ad_g‘sched·¿m
 (
±h»ad_t
 
__rg‘_th»ad
,

419 *
__»¡riù
 
__pŞicy
,

420 
sched_·¿m
 *
__»¡riù
 
__·¿m
)

421 
__THROW
 
	`__nÚnuÎ
 ((2, 3));

424 
	$±h»ad_£tsched´io
 (
±h»ad_t
 
__rg‘_th»ad
, 
__´io
)

425 
__THROW
;

428 #ifdeà
__USE_GNU


430 
	$±h»ad_g‘Çme_Å
 (
±h»ad_t
 
__rg‘_th»ad
, *
__buf
,

431 
size_t
 
__buæ’
)

432 
__THROW
 
	`__nÚnuÎ
 ((2));

435 
	$±h»ad_£Šame_Å
 (
±h»ad_t
 
__rg‘_th»ad
, 
__cÚ¡
 *
__Çme
)

436 
__THROW
 
	`__nÚnuÎ
 ((2));

440 #ifdeà
__USE_UNIX98


442 
	$±h»ad_g‘cÚcu¼’cy
 (è
__THROW
;

445 
	$±h»ad_£tcÚcu¼’cy
 (
__Ëv–
è
__THROW
;

448 #ifdeà
__USE_GNU


453 
	$±h»ad_y›ld
 (è
__THROW
;

458 
	$±h»ad_£ffš™y_Å
 (
±h»ad_t
 
__th
, 
size_t
 
__ıu£tsize
,

459 
__cÚ¡
 
ıu_£t_t
 *
__ıu£t
)

460 
__THROW
 
	`__nÚnuÎ
 ((3));

463 
	$±h»ad_g‘affš™y_Å
 (
±h»ad_t
 
__th
, 
size_t
 
__ıu£tsize
,

464 
ıu_£t_t
 *
__ıu£t
)

465 
__THROW
 
	`__nÚnuÎ
 ((3));

478 
	`±h»ad_Úû
 (
±h»ad_Úû_t
 *
__Úû_cÚŒŞ
,

479 (*
__š™_routše
è()è
	`__nÚnuÎ
 ((1, 2));

490 
	`±h»ad_£tÿnûl¡©e
 (
__¡©e
, *
__Şd¡©e
);

494 
	`±h»ad_£tÿnûÉy³
 (
__ty³
, *
__Şdty³
);

497 
	`±h»ad_ÿnûl
 (
±h»ad_t
 
__th
);

502 
	`±h»ad_‹¡ÿnûl
 ();

511 
__jmp_buf
 
__ÿnûl_jmp_buf
;

512 
__mask_was_§ved
;

513 } 
__ÿnûl_jmp_buf
[1];

514 *
__·d
[4];

515 } 
	t__±h»ad_unwšd_buf_t
 
	t__©Œibu‹__
 ((
	t__®igÃd__
));

518 #iâdeà
__ş—nup_fù_©Œibu‹


519 
	#__ş—nup_fù_©Œibu‹


	)

524 
	s__±h»ad_ş—nup_äame


526 (*
__ÿnûl_routše
) (*);

527 *
__ÿnûl_¬g
;

528 
__do_™
;

529 
__ÿnûl_ty³
;

532 #ià
defšed
 
__GNUC__
 && defšed 
__EXCEPTIONS


533 #ifdeà
__ılu¥lus


535 şas 
	c__±h»ad_ş—nup_şass


537 (*
__ÿnûl_routše
) (*);

538 *
__ÿnûl_¬g
;

539 
__do_™
;

540 
__ÿnûl_ty³
;

542 
public
:

543 
	`__±h»ad_ş—nup_şass
 ((*
__fù
è(*), *
__¬g
)

544 : 
	`__ÿnûl_routše
 (
__fù
), 
	`__ÿnûl_¬g
 (
__¬g
), 
	$__do_™
 (1) { }

545 ~
	$__±h»ad_ş—nup_şass
 (è{ ià(
__do_™
è
	`__ÿnûl_routše
 (
__ÿnûl_¬g
); 
	}
}

546 
	$__£tdo™
 (
__Ãwv®
è{ 
__do_™
 = __Ãwv®; 
	}
}

547 
	$__deãr
 (è{ 
	`±h»ad_£tÿnûÉy³
 (
PTHREAD_CANCEL_DEFERRED
,

548 &
__ÿnûl_ty³
); 
	}
}

549 
	$__»¡Üe
 (ècÚ¡ { 
	`±h»ad_£tÿnûÉy³
 (
__ÿnûl_ty³
, 0); 
	}
}

559 
	#±h»ad_ş—nup_push
(
routše
, 
¬g
) \

561 
__±h»ad_ş—nup_şass
 
	`__şäame
 (
routše
, 
¬g
)

	)

565 
	#±h»ad_ş—nup_pİ
(
execu‹
) \

566 
__şäame
.
	`__£tdo™
 (
execu‹
); \

567 } 0)

	)

569 #ifdeà
__USE_GNU


573 
	#±h»ad_ş—nup_push_deãr_Å
(
routše
, 
¬g
) \

575 
__±h»ad_ş—nup_şass
 
	`__şäame
 (
routše
, 
¬g
); \

576 
__şäame
.
	`__deãr
 ()

	)

581 
	#±h»ad_ş—nup_pİ_»¡Üe_Å
(
execu‹
) \

582 
__şäame
.
	`__»¡Üe
 (); \

583 
__şäame
.
	`__£tdo™
 (
execu‹
); \

584 } 0)

	)

591 
__ex‹º_šlše
 

592 
	$__±h»ad_ş—nup_routše
 (
__±h»ad_ş—nup_äame
 *
__äame
)

594 ià(
__äame
->
__do_™
)

595 
__äame
->
	`__ÿnûl_routše
 (__äame->
__ÿnûl_¬g
);

596 
	}
}

605 
	#±h»ad_ş—nup_push
(
routše
, 
¬g
) \

607 
__±h»ad_ş—nup_äame
 
__şäame
 \

608 
	`__©Œibu‹__
 ((
	`__ş—nup__
 (
__±h»ad_ş—nup_routše
))) \

609 ğ{ .
__ÿnûl_routše
 = (
routše
), .
__ÿnûl_¬g
 = (
¬g
), \

610 .
__do_™
 = 1 };

	)

614 
	#±h»ad_ş—nup_pİ
(
execu‹
) \

615 
__şäame
.
__do_™
 = (
execu‹
); \

616 } 0)

	)

618 #ifdeà
__USE_GNU


622 
	#±h»ad_ş—nup_push_deãr_Å
(
routše
, 
¬g
) \

624 
__±h»ad_ş—nup_äame
 
__şäame
 \

625 
	`__©Œibu‹__
 ((
	`__ş—nup__
 (
__±h»ad_ş—nup_routše
))) \

626 ğ{ .
__ÿnûl_routše
 = (
routše
), .
__ÿnûl_¬g
 = (
¬g
), \

627 .
__do_™
 = 1 }; \

628 (è
	`±h»ad_£tÿnûÉy³
 (
PTHREAD_CANCEL_DEFERRED
, \

629 &
__şäame
.
__ÿnûl_ty³
)

	)

634 
	#±h»ad_ş—nup_pİ_»¡Üe_Å
(
execu‹
) \

635 (è
	`±h»ad_£tÿnûÉy³
 (
__şäame
.
__ÿnûl_ty³
, 
NULL
); \

636 
__şäame
.
__do_™
 = (
execu‹
); \

637 } 0)

	)

648 
	#±h»ad_ş—nup_push
(
routše
, 
¬g
) \

650 
__±h»ad_unwšd_buf_t
 
__ÿnûl_buf
; \

651 (*
__ÿnûl_routše
è(*èğ(
routše
); \

652 *
__ÿnûl_¬g
 = (
¬g
); \

653 
nÙ_fœ¡_ÿÎ
 = 
	`__sig£tjmp
 ((
__jmp_buf_g
 *) (*) \

654 
__ÿnûl_buf
.
__ÿnûl_jmp_buf
, 0); \

655 ià(
	`__butš_ex³ù
 (
nÙ_fœ¡_ÿÎ
, 0)) \

657 
	`__ÿnûl_routše
 (
__ÿnûl_¬g
); \

658 
	`__±h»ad_unwšd_Ãxt
 (&
__ÿnûl_buf
); \

662 
	`__±h»ad_»gi¡”_ÿnûl
 (&
__ÿnûl_buf
); \

663 dØ{

	)

664 
__±h»ad_»gi¡”_ÿnûl
 (
__±h»ad_unwšd_buf_t
 *
__buf
)

665 
__ş—nup_fù_©Œibu‹
;

669 
	#±h»ad_ş—nup_pİ
(
execu‹
) \

672 
	`__±h»ad_uÄegi¡”_ÿnûl
 (&
__ÿnûl_buf
); \

673 ià(
execu‹
) \

674 
	`__ÿnûl_routše
 (
__ÿnûl_¬g
); \

675 } 0)

	)

676 
	$__±h»ad_uÄegi¡”_ÿnûl
 (
__±h»ad_unwšd_buf_t
 *
__buf
)

677 
__ş—nup_fù_©Œibu‹
;

679 #ifdeà
__USE_GNU


683 
	#±h»ad_ş—nup_push_deãr_Å
(
routše
, 
¬g
) \

685 
__±h»ad_unwšd_buf_t
 
__ÿnûl_buf
; \

686 (*
__ÿnûl_routše
è(*èğ(
routše
); \

687 *
__ÿnûl_¬g
 = (
¬g
); \

688 
nÙ_fœ¡_ÿÎ
 = 
	`__sig£tjmp
 ((
__jmp_buf_g
 *) (*) \

689 
__ÿnûl_buf
.
__ÿnûl_jmp_buf
, 0); \

690 ià(
	`__butš_ex³ù
 (
nÙ_fœ¡_ÿÎ
, 0)) \

692 
	`__ÿnûl_routše
 (
__ÿnûl_¬g
); \

693 
	`__±h»ad_unwšd_Ãxt
 (&
__ÿnûl_buf
); \

697 
	`__±h»ad_»gi¡”_ÿnûl_deãr
 (&
__ÿnûl_buf
); \

698 dØ{

	)

699 
	`__±h»ad_»gi¡”_ÿnûl_deãr
 (
__±h»ad_unwšd_buf_t
 *
__buf
)

700 
__ş—nup_fù_©Œibu‹
;

705 
	#±h»ad_ş—nup_pİ_»¡Üe_Å
(
execu‹
) \

708 
	`__±h»ad_uÄegi¡”_ÿnûl_»¡Üe
 (&
__ÿnûl_buf
); \

709 ià(
execu‹
) \

710 
	`__ÿnûl_routše
 (
__ÿnûl_¬g
); \

711 
	}
} 0)

	)

712 
	$__±h»ad_uÄegi¡”_ÿnûl_»¡Üe
 (
__±h»ad_unwšd_buf_t
 *
__buf
)

713 
__ş—nup_fù_©Œibu‹
;

717 
	$__±h»ad_unwšd_Ãxt
 (
__±h»ad_unwšd_buf_t
 *
__buf
)

718 
__ş—nup_fù_©Œibu‹
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
))

719 #iâdeà
SHARED


720 
	`__©Œibu‹__
 ((
__w—k__
))

726 
__jmp_buf_g
;

727 
	$__sig£tjmp
 (
__jmp_buf_g
 *
__’v
, 
__§vemask
è
__THROW
;

733 
	$±h»ad_mu‹x_š™
 (
±h»ad_mu‹x_t
 *
__mu‹x
,

734 
__cÚ¡
 
±h»ad_mu‹x©Œ_t
 *
__mu‹x©Œ
)

735 
__THROW
 
	`__nÚnuÎ
 ((1));

738 
	$±h»ad_mu‹x_de¡roy
 (
±h»ad_mu‹x_t
 *
__mu‹x
)

739 
__THROW
 
	`__nÚnuÎ
 ((1));

742 
	$±h»ad_mu‹x_Œylock
 (
±h»ad_mu‹x_t
 *
__mu‹x
)

743 
__THROW
 
	`__nÚnuÎ
 ((1));

746 
	$±h»ad_mu‹x_lock
 (
±h»ad_mu‹x_t
 *
__mu‹x
)

747 
__THROW
 
	`__nÚnuÎ
 ((1));

749 #ifdeà
__USE_XOPEN2K


751 
	$±h»ad_mu‹x_timedlock
 (
±h»ad_mu‹x_t
 *
__»¡riù
 
__mu‹x
,

752 
__cÚ¡
 
time¥ec
 *
__»¡riù


753 
__ab¡ime
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

757 
	$±h»ad_mu‹x_uÆock
 (
±h»ad_mu‹x_t
 *
__mu‹x
)

758 
__THROW
 
	`__nÚnuÎ
 ((1));

762 
	$±h»ad_mu‹x_g‘´ioûšg
 (
__cÚ¡
 
±h»ad_mu‹x_t
 *

763 
__»¡riù
 
__mu‹x
,

764 *
__»¡riù
 
__´ioûšg
)

765 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

769 
	$±h»ad_mu‹x_£rioûšg
 (
±h»ad_mu‹x_t
 *
__»¡riù
 
__mu‹x
,

770 
__´ioûšg
,

771 *
__»¡riù
 
__Şd_ûšg
)

772 
__THROW
 
	`__nÚnuÎ
 ((1, 3));

775 #ifdeà
__USE_XOPEN2K8


777 
	$±h»ad_mu‹x_cÚsi¡’t
 (
±h»ad_mu‹x_t
 *
__mu‹x
)

778 
__THROW
 
	`__nÚnuÎ
 ((1));

779 #ifdeà
__USE_GNU


780 
	$±h»ad_mu‹x_cÚsi¡’t_Å
 (
±h»ad_mu‹x_t
 *
__mu‹x
)

781 
__THROW
 
	`__nÚnuÎ
 ((1));

790 
	$±h»ad_mu‹x©Œ_š™
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
)

791 
__THROW
 
	`__nÚnuÎ
 ((1));

794 
	$±h»ad_mu‹x©Œ_de¡roy
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
)

795 
__THROW
 
	`__nÚnuÎ
 ((1));

798 
	$±h»ad_mu‹x©Œ_g‘psh¬ed
 (
__cÚ¡
 
±h»ad_mu‹x©Œ_t
 *

799 
__»¡riù
 
__©Œ
,

800 *
__»¡riù
 
__psh¬ed
)

801 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

804 
	$±h»ad_mu‹x©Œ_£sh¬ed
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
,

805 
__psh¬ed
)

806 
__THROW
 
	`__nÚnuÎ
 ((1));

808 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K8


810 
	$±h»ad_mu‹x©Œ_g‘ty³
 (
__cÚ¡
 
±h»ad_mu‹x©Œ_t
 *
__»¡riù


811 
__©Œ
, *
__»¡riù
 
__kšd
)

812 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

817 
	$±h»ad_mu‹x©Œ_£‰y³
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
, 
__kšd
)

818 
__THROW
 
	`__nÚnuÎ
 ((1));

822 
	$±h»ad_mu‹x©Œ_g‘´ÙocŞ
 (
__cÚ¡
 
±h»ad_mu‹x©Œ_t
 *

823 
__»¡riù
 
__©Œ
,

824 *
__»¡riù
 
__´ÙocŞ
)

825 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

829 
	$±h»ad_mu‹x©Œ_£rÙocŞ
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
,

830 
__´ÙocŞ
)

831 
__THROW
 
	`__nÚnuÎ
 ((1));

834 
	$±h»ad_mu‹x©Œ_g‘´ioûšg
 (
__cÚ¡
 
±h»ad_mu‹x©Œ_t
 *

835 
__»¡riù
 
__©Œ
,

836 *
__»¡riù
 
__´ioûšg
)

837 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

840 
	$±h»ad_mu‹x©Œ_£rioûšg
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
,

841 
__´ioûšg
)

842 
__THROW
 
	`__nÚnuÎ
 ((1));

844 #ifdeà
__USE_XOPEN2K


846 
	$±h»ad_mu‹x©Œ_g‘robu¡
 (
__cÚ¡
 
±h»ad_mu‹x©Œ_t
 *
__©Œ
,

847 *
__robu¡Ãss
)

848 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

849 #ifdeà
__USE_GNU


850 
	$±h»ad_mu‹x©Œ_g‘robu¡_Å
 (
__cÚ¡
 
±h»ad_mu‹x©Œ_t
 *
__©Œ
,

851 *
__robu¡Ãss
)

852 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

856 
	$±h»ad_mu‹x©Œ_£Œobu¡
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
,

857 
__robu¡Ãss
)

858 
__THROW
 
	`__nÚnuÎ
 ((1));

859 #ifdeà
__USE_GNU


860 
	$±h»ad_mu‹x©Œ_£Œobu¡_Å
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
,

861 
__robu¡Ãss
)

862 
__THROW
 
	`__nÚnuÎ
 ((1));

867 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K


872 
	$±h»ad_rwlock_š™
 (
±h»ad_rwlock_t
 *
__»¡riù
 
__rwlock
,

873 
__cÚ¡
 
±h»ad_rwlock©Œ_t
 *
__»¡riù


874 
__©Œ
è
__THROW
 
	`__nÚnuÎ
 ((1));

877 
	$±h»ad_rwlock_de¡roy
 (
±h»ad_rwlock_t
 *
__rwlock
)

878 
__THROW
 
	`__nÚnuÎ
 ((1));

881 
	$±h»ad_rwlock_rdlock
 (
±h»ad_rwlock_t
 *
__rwlock
)

882 
__THROW
 
	`__nÚnuÎ
 ((1));

885 
	$±h»ad_rwlock_Œyrdlock
 (
±h»ad_rwlock_t
 *
__rwlock
)

886 
__THROW
 
	`__nÚnuÎ
 ((1));

888 #ifdeà
__USE_XOPEN2K


890 
	$±h»ad_rwlock_timedrdlock
 (
±h»ad_rwlock_t
 *
__»¡riù
 
__rwlock
,

891 
__cÚ¡
 
time¥ec
 *
__»¡riù


892 
__ab¡ime
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

896 
	$±h»ad_rwlock_w¾ock
 (
±h»ad_rwlock_t
 *
__rwlock
)

897 
__THROW
 
	`__nÚnuÎ
 ((1));

900 
	$±h»ad_rwlock_Œyw¾ock
 (
±h»ad_rwlock_t
 *
__rwlock
)

901 
__THROW
 
	`__nÚnuÎ
 ((1));

903 #ifdeà
__USE_XOPEN2K


905 
	$±h»ad_rwlock_timedw¾ock
 (
±h»ad_rwlock_t
 *
__»¡riù
 
__rwlock
,

906 
__cÚ¡
 
time¥ec
 *
__»¡riù


907 
__ab¡ime
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

911 
	$±h»ad_rwlock_uÆock
 (
±h»ad_rwlock_t
 *
__rwlock
)

912 
__THROW
 
	`__nÚnuÎ
 ((1));

918 
	$±h»ad_rwlock©Œ_š™
 (
±h»ad_rwlock©Œ_t
 *
__©Œ
)

919 
__THROW
 
	`__nÚnuÎ
 ((1));

922 
	$±h»ad_rwlock©Œ_de¡roy
 (
±h»ad_rwlock©Œ_t
 *
__©Œ
)

923 
__THROW
 
	`__nÚnuÎ
 ((1));

926 
	$±h»ad_rwlock©Œ_g‘psh¬ed
 (
__cÚ¡
 
±h»ad_rwlock©Œ_t
 *

927 
__»¡riù
 
__©Œ
,

928 *
__»¡riù
 
__psh¬ed
)

929 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

932 
	$±h»ad_rwlock©Œ_£sh¬ed
 (
±h»ad_rwlock©Œ_t
 *
__©Œ
,

933 
__psh¬ed
)

934 
__THROW
 
	`__nÚnuÎ
 ((1));

937 
	$±h»ad_rwlock©Œ_g‘kšd_Å
 (
__cÚ¡
 
±h»ad_rwlock©Œ_t
 *

938 
__»¡riù
 
__©Œ
,

939 *
__»¡riù
 
__´ef
)

940 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

943 
	$±h»ad_rwlock©Œ_£tkšd_Å
 (
±h»ad_rwlock©Œ_t
 *
__©Œ
,

944 
__´ef
è
__THROW
 
	`__nÚnuÎ
 ((1));

952 
	$±h»ad_cÚd_š™
 (
±h»ad_cÚd_t
 *
__»¡riù
 
__cÚd
,

953 
__cÚ¡
 
±h»ad_cÚd©Œ_t
 *
__»¡riù


954 
__cÚd_©Œ
è
__THROW
 
	`__nÚnuÎ
 ((1));

957 
	$±h»ad_cÚd_de¡roy
 (
±h»ad_cÚd_t
 *
__cÚd
)

958 
__THROW
 
	`__nÚnuÎ
 ((1));

961 
	$±h»ad_cÚd_sigÇl
 (
±h»ad_cÚd_t
 *
__cÚd
)

962 
__THROW
 
	`__nÚnuÎ
 ((1));

965 
	$±h»ad_cÚd_brßdÿ¡
 (
±h»ad_cÚd_t
 *
__cÚd
)

966 
__THROW
 
	`__nÚnuÎ
 ((1));

973 
	$±h»ad_cÚd_wa™
 (
±h»ad_cÚd_t
 *
__»¡riù
 
__cÚd
,

974 
±h»ad_mu‹x_t
 *
__»¡riù
 
__mu‹x
)

975 
	`__nÚnuÎ
 ((1, 2));

984 
	$±h»ad_cÚd_timedwa™
 (
±h»ad_cÚd_t
 *
__»¡riù
 
__cÚd
,

985 
±h»ad_mu‹x_t
 *
__»¡riù
 
__mu‹x
,

986 
__cÚ¡
 
time¥ec
 *
__»¡riù


987 
__ab¡ime
è
	`__nÚnuÎ
 ((1, 2, 3));

992 
	$±h»ad_cÚd©Œ_š™
 (
±h»ad_cÚd©Œ_t
 *
__©Œ
)

993 
__THROW
 
	`__nÚnuÎ
 ((1));

996 
	$±h»ad_cÚd©Œ_de¡roy
 (
±h»ad_cÚd©Œ_t
 *
__©Œ
)

997 
__THROW
 
	`__nÚnuÎ
 ((1));

1000 
	$±h»ad_cÚd©Œ_g‘psh¬ed
 (
__cÚ¡
 
±h»ad_cÚd©Œ_t
 *

1001 
__»¡riù
 
__©Œ
,

1002 *
__»¡riù
 
__psh¬ed
)

1003 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

1006 
	$±h»ad_cÚd©Œ_£sh¬ed
 (
±h»ad_cÚd©Œ_t
 *
__©Œ
,

1007 
__psh¬ed
è
__THROW
 
	`__nÚnuÎ
 ((1));

1009 #ifdeà
__USE_XOPEN2K


1011 
	$±h»ad_cÚd©Œ_g‘şock
 (
__cÚ¡
 
±h»ad_cÚd©Œ_t
 *

1012 
__»¡riù
 
__©Œ
,

1013 
__şockid_t
 *
__»¡riù
 
__şock_id
)

1014 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

1017 
	$±h»ad_cÚd©Œ_£tşock
 (
±h»ad_cÚd©Œ_t
 *
__©Œ
,

1018 
__şockid_t
 
__şock_id
)

1019 
__THROW
 
	`__nÚnuÎ
 ((1));

1023 #ifdeà
__USE_XOPEN2K


1028 
	$±h»ad_¥š_š™
 (
±h»ad_¥šlock_t
 *
__lock
, 
__psh¬ed
)

1029 
__THROW
 
	`__nÚnuÎ
 ((1));

1032 
	$±h»ad_¥š_de¡roy
 (
±h»ad_¥šlock_t
 *
__lock
)

1033 
__THROW
 
	`__nÚnuÎ
 ((1));

1036 
	$±h»ad_¥š_lock
 (
±h»ad_¥šlock_t
 *
__lock
)

1037 
__THROW
 
	`__nÚnuÎ
 ((1));

1040 
	$±h»ad_¥š_Œylock
 (
±h»ad_¥šlock_t
 *
__lock
)

1041 
__THROW
 
	`__nÚnuÎ
 ((1));

1044 
	$±h»ad_¥š_uÆock
 (
±h»ad_¥šlock_t
 *
__lock
)

1045 
__THROW
 
	`__nÚnuÎ
 ((1));

1052 
	$±h»ad_b¬r›r_š™
 (
±h»ad_b¬r›r_t
 *
__»¡riù
 
__b¬r›r
,

1053 
__cÚ¡
 
±h»ad_b¬r›¿‰r_t
 *
__»¡riù


1054 
__©Œ
, 
__couÁ
)

1055 
__THROW
 
	`__nÚnuÎ
 ((1));

1058 
	$±h»ad_b¬r›r_de¡roy
 (
±h»ad_b¬r›r_t
 *
__b¬r›r
)

1059 
__THROW
 
	`__nÚnuÎ
 ((1));

1062 
	$±h»ad_b¬r›r_wa™
 (
±h»ad_b¬r›r_t
 *
__b¬r›r
)

1063 
__THROW
 
	`__nÚnuÎ
 ((1));

1067 
	$±h»ad_b¬r›¿‰r_š™
 (
±h»ad_b¬r›¿‰r_t
 *
__©Œ
)

1068 
__THROW
 
	`__nÚnuÎ
 ((1));

1071 
	$±h»ad_b¬r›¿‰r_de¡roy
 (
±h»ad_b¬r›¿‰r_t
 *
__©Œ
)

1072 
__THROW
 
	`__nÚnuÎ
 ((1));

1075 
	$±h»ad_b¬r›¿‰r_g‘psh¬ed
 (
__cÚ¡
 
±h»ad_b¬r›¿‰r_t
 *

1076 
__»¡riù
 
__©Œ
,

1077 *
__»¡riù
 
__psh¬ed
)

1078 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

1081 
	$±h»ad_b¬r›¿‰r_£sh¬ed
 (
±h»ad_b¬r›¿‰r_t
 *
__©Œ
,

1082 
__psh¬ed
)

1083 
__THROW
 
	`__nÚnuÎ
 ((1));

1095 
	`±h»ad_key_ü—‹
 (
±h»ad_key_t
 *
__key
,

1096 (*
__de¡r_funùiÚ
) (*))

1097 
__THROW
 
	`__nÚnuÎ
 ((1));

1100 
	$±h»ad_key_d–‘e
 (
±h»ad_key_t
 
__key
è
__THROW
;

1103 *
	$±h»ad_g‘¥ecific
 (
±h»ad_key_t
 
__key
è
__THROW
;

1106 
	$±h»ad_£t¥ecific
 (
±h»ad_key_t
 
__key
,

1107 
__cÚ¡
 *
__poš‹r
è
__THROW
 ;

1110 #ifdeà
__USE_XOPEN2K


1112 
	$±h»ad_g‘ıuşockid
 (
±h»ad_t
 
__th»ad_id
,

1113 
__şockid_t
 *
__şock_id
)

1114 
__THROW
 
	`__nÚnuÎ
 ((2));

1129 
	`±h»ad_©fÜk
 ((*
__´•¬e
) (),

1130 (*
__·»Á
) (),

1131 (*
__chd
è()è
__THROW
;

1134 #ifdeà
__USE_EXTERN_INLINES


1136 
__ex‹º_šlše
 

1137 
	`__NTH
 (
	$±h»ad_equ®
 (
±h»ad_t
 
__th»ad1
,…th»ad_ˆ
__th»ad2
))

1139  
__th»ad1
 =ğ
__th»ad2
;

1140 
	}
}

1143 
	g__END_DECLS


	@/usr/include/wctype.h

24 #iâdeà
_WCTYPE_H


26 
	~<ã©u»s.h
>

27 
	~<b™s/ty³s.h
>

29 #iâdeà
__Ãed_iswxxx


30 
	#_WCTYPE_H
 1

	)

33 
	#__Ãed_wšt_t


	)

34 
	~<wch¬.h
>

38 #iâdeà
WEOF


39 
	#WEOF
 (0xffffffffu)

	)

42 #undeà
__Ãed_iswxxx


47 #iâdeà
__iswxxx_defšed


48 
	#__iswxxx_defšed
 1

	)

50 
__BEGIN_NAMESPACE_C99


53 
	twùy³_t
;

54 
	g__END_NAMESPACE_C99


56 #iâdeà
_ISwb™


61 
	~<’dŸn.h
>

62 #ià
__BYTE_ORDER
 =ğ
__BIG_ENDIAN


63 
	#_ISwb™
(
b™
è(1 << (b™))

	)

65 
	#_ISwb™
(
b™
) \

66 ((
b™
) < 8 ? () ((1UL << (bit)) << 24) \

67 : ((
b™
) < 16 ? () ((1UL << (bit)) << 8) \

68 : ((
b™
) < 24 ? () ((1UL << (bit)) >> 8) \

69 : (è((1UL << (
b™
)è>> 24))))

	)

74 
	m__ISwuµ”
 = 0,

75 
	m__ISwlow”
 = 1,

76 
	m__ISw®pha
 = 2,

77 
	m__ISwdig™
 = 3,

78 
	m__ISwxdig™
 = 4,

79 
	m__ISw¥aû
 = 5,

80 
	m__ISw´št
 = 6,

81 
	m__ISwg¿ph
 = 7,

82 
	m__ISwbÏnk
 = 8,

83 
	m__ISwúŒl
 = 9,

84 
	m__ISwpunù
 = 10,

85 
	m__ISw®num
 = 11,

87 
	m_ISwuµ”
 = 
_ISwb™
 (
__ISwuµ”
),

88 
	m_ISwlow”
 = 
_ISwb™
 (
__ISwlow”
),

89 
	m_ISw®pha
 = 
_ISwb™
 (
__ISw®pha
),

90 
	m_ISwdig™
 = 
_ISwb™
 (
__ISwdig™
),

91 
	m_ISwxdig™
 = 
_ISwb™
 (
__ISwxdig™
),

92 
	m_ISw¥aû
 = 
_ISwb™
 (
__ISw¥aû
),

93 
	m_ISw´št
 = 
_ISwb™
 (
__ISw´št
),

94 
	m_ISwg¿ph
 = 
_ISwb™
 (
__ISwg¿ph
),

95 
	m_ISwbÏnk
 = 
_ISwb™
 (
__ISwbÏnk
),

96 
	m_ISwúŒl
 = 
_ISwb™
 (
__ISwúŒl
),

97 
	m_ISwpunù
 = 
_ISwb™
 (
__ISwpunù
),

98 
	m_ISw®num
 = 
_ISwb™
 (
__ISw®num
)

103 
__BEGIN_DECLS


105 
__BEGIN_NAMESPACE_C99


112 
	$isw®num
 (
wšt_t
 
__wc
è
__THROW
;

118 
	$isw®pha
 (
wšt_t
 
__wc
è
__THROW
;

121 
	$iswúŒl
 (
wšt_t
 
__wc
è
__THROW
;

125 
	$iswdig™
 (
wšt_t
 
__wc
è
__THROW
;

129 
	$iswg¿ph
 (
wšt_t
 
__wc
è
__THROW
;

134 
	$iswlow”
 (
wšt_t
 
__wc
è
__THROW
;

137 
	$isw´št
 (
wšt_t
 
__wc
è
__THROW
;

142 
	$iswpunù
 (
wšt_t
 
__wc
è
__THROW
;

147 
	$isw¥aû
 (
wšt_t
 
__wc
è
__THROW
;

152 
	$iswuµ”
 (
wšt_t
 
__wc
è
__THROW
;

157 
	$iswxdig™
 (
wšt_t
 
__wc
è
__THROW
;

162 #ifdeà
__USE_ISOC99


163 
	$iswbÏnk
 (
wšt_t
 
__wc
è
__THROW
;

172 
wùy³_t
 
	$wùy³
 (
__cÚ¡
 *
__´İ”ty
è
__THROW
;

176 
	$iswùy³
 (
wšt_t
 
__wc
, 
wùy³_t
 
__desc
è
__THROW
;

177 
__END_NAMESPACE_C99


184 
__BEGIN_NAMESPACE_C99


187 
__cÚ¡
 
	t__št32_t
 *
	twù¿ns_t
;

188 
__END_NAMESPACE_C99


189 #ifdeà
__USE_GNU


190 
	$__USING_NAMESPACE_C99
(
wù¿ns_t
)

193 
__BEGIN_NAMESPACE_C99


195 
wšt_t
 
	$towlow”
 (
wšt_t
 
__wc
è
__THROW
;

198 
wšt_t
 
	$towuµ”
 (
wšt_t
 
__wc
è
__THROW
;

199 
__END_NAMESPACE_C99


201 
__END_DECLS


208 #ifdeà
_WCTYPE_H


214 
__BEGIN_DECLS


216 
__BEGIN_NAMESPACE_C99


219 
wù¿ns_t
 
	$wù¿ns
 (
__cÚ¡
 *
__´İ”ty
è
__THROW
;

222 
wšt_t
 
	$towù¿ns
 (
wšt_t
 
__wc
, 
wù¿ns_t
 
__desc
è
__THROW
;

223 
__END_NAMESPACE_C99


225 #ifdeà
__USE_XOPEN2K8


227 
	~<xloÿË.h
>

231 
	$isw®num_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

237 
	$isw®pha_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

240 
	$iswúŒl_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

244 
	$iswdig™_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

248 
	$iswg¿ph_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

253 
	$iswlow”_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

256 
	$isw´št_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

261 
	$iswpunù_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

266 
	$isw¥aû_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

271 
	$iswuµ”_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

276 
	$iswxdig™_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

281 
	$iswbÏnk_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

285 
wùy³_t
 
	$wùy³_l
 (
__cÚ¡
 *
__´İ”ty
, 
__loÿË_t
 
__loÿË
)

286 
__THROW
;

290 
	$iswùy³_l
 (
wšt_t
 
__wc
, 
wùy³_t
 
__desc
, 
__loÿË_t
 
__loÿË
)

291 
__THROW
;

299 
wšt_t
 
	$towlow”_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

302 
wšt_t
 
	$towuµ”_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

306 
wù¿ns_t
 
	$wù¿ns_l
 (
__cÚ¡
 *
__´İ”ty
, 
__loÿË_t
 
__loÿË
)

307 
__THROW
;

310 
wšt_t
 
	$towù¿ns_l
 (
wšt_t
 
__wc
, 
wù¿ns_t
 
__desc
,

311 
__loÿË_t
 
__loÿË
è
__THROW
;

315 
__END_DECLS


	@/usr/include/asm-generic/errno-base.h

1 #iâdeà
_ASM_GENERIC_ERRNO_BASE_H


2 
	#_ASM_GENERIC_ERRNO_BASE_H


	)

4 
	#EPERM
 1

	)

5 
	#ENOENT
 2

	)

6 
	#ESRCH
 3

	)

7 
	#EINTR
 4

	)

8 
	#EIO
 5

	)

9 
	#ENXIO
 6

	)

10 
	#E2BIG
 7

	)

11 
	#ENOEXEC
 8

	)

12 
	#EBADF
 9

	)

13 
	#ECHILD
 10

	)

14 
	#EAGAIN
 11

	)

15 
	#ENOMEM
 12

	)

16 
	#EACCES
 13

	)

17 
	#EFAULT
 14

	)

18 
	#ENOTBLK
 15

	)

19 
	#EBUSY
 16

	)

20 
	#EEXIST
 17

	)

21 
	#EXDEV
 18

	)

22 
	#ENODEV
 19

	)

23 
	#ENOTDIR
 20

	)

24 
	#EISDIR
 21

	)

25 
	#EINVAL
 22

	)

26 
	#ENFILE
 23

	)

27 
	#EMFILE
 24

	)

28 
	#ENOTTY
 25

	)

29 
	#ETXTBSY
 26

	)

30 
	#EFBIG
 27

	)

31 
	#ENOSPC
 28

	)

32 
	#ESPIPE
 29

	)

33 
	#EROFS
 30

	)

34 
	#EMLINK
 31

	)

35 
	#EPIPE
 32

	)

36 
	#EDOM
 33

	)

37 
	#ERANGE
 34

	)

	@/usr/include/bits/setjmp.h

20 #iâdeà
_BITS_SETJMP_H


21 
	#_BITS_SETJMP_H
 1

	)

23 #ià!
defšed
 
_SETJMP_H
 && !defšed 
_PTHREAD_H


27 
	~<b™s/wÜdsize.h
>

29 #iâdeà
_ASM


31 #ià
__WORDSIZE
 == 64

32 
	t__jmp_buf
[8];

34 
	t__jmp_buf
[6];

	@/usr/include/sched.h

21 #iâdef 
_SCHED_H


22 
	#_SCHED_H
 1

	)

24 
	~<ã©u»s.h
>

27 
	~<b™s/ty³s.h
>

29 
	#__Ãed_size_t


	)

30 
	~<¡ddef.h
>

32 
	#__Ãed_time_t


	)

33 
	#__Ãed_time¥ec


	)

34 
	~<time.h
>

36 #iâdeà
__pid_t_defšed


37 
__pid_t
 
	tpid_t
;

38 
	#__pid_t_defšed


	)

43 
	~<b™s/sched.h
>

45 
	#sched_´iÜ™y
 
__sched_´iÜ™y


	)

48 
__BEGIN_DECLS


51 
	$sched_£¬am
 (
__pid_t
 
__pid
, 
__cÚ¡
 
sched_·¿m
 *
__·¿m
)

52 
__THROW
;

55 
	$sched_g‘·¿m
 (
__pid_t
 
__pid
, 
sched_·¿m
 *
__·¿m
è
__THROW
;

58 
	$sched_£tscheduËr
 (
__pid_t
 
__pid
, 
__pŞicy
,

59 
__cÚ¡
 
sched_·¿m
 *
__·¿m
è
__THROW
;

62 
	$sched_g‘scheduËr
 (
__pid_t
 
__pid
è
__THROW
;

65 
	$sched_y›ld
 (è
__THROW
;

68 
	$sched_g‘_´iÜ™y_max
 (
__®gÜ™hm
è
__THROW
;

71 
	$sched_g‘_´iÜ™y_mš
 (
__®gÜ™hm
è
__THROW
;

74 
	$sched_¼_g‘_š‹rv®
 (
__pid_t
 
__pid
, 
time¥ec
 *
__t
è
__THROW
;

77 #ifdeà
__USE_GNU


79 
	#CPU_SETSIZE
 
__CPU_SETSIZE


	)

80 
	#CPU_SET
(
ıu
, 
ıu£
è
	`__CPU_SET_S
 (ıu,  (
ıu_£t_t
), cpu£)

	)

81 
	#CPU_CLR
(
ıu
, 
ıu£
è
	`__CPU_CLR_S
 (ıu,  (
ıu_£t_t
), cpu£)

	)

82 
	#CPU_ISSET
(
ıu
, 
ıu£
è
	`__CPU_ISSET_S
 (ıu,  (
ıu_£t_t
), \

83 
ıu£
)

	)

84 
	#CPU_ZERO
(
ıu£
è
	`__CPU_ZERO_S
 ( (
ıu_£t_t
), cpu£)

	)

85 
	#CPU_COUNT
(
ıu£
è
	`__CPU_COUNT_S
 ( (
ıu_£t_t
), cpu£)

	)

87 
	#CPU_SET_S
(
ıu
, 
£tsize
, 
ıu£
è
	`__CPU_SET_S
 (ıu, s‘size, cpu£)

	)

88 
	#CPU_CLR_S
(
ıu
, 
£tsize
, 
ıu£
è
	`__CPU_CLR_S
 (ıu, s‘size, cpu£)

	)

89 
	#CPU_ISSET_S
(
ıu
, 
£tsize
, 
ıu£
è
	`__CPU_ISSET_S
 (cpu, setsize, \

90 
ıu£
)

	)

91 
	#CPU_ZERO_S
(
£tsize
, 
ıu£
è
	`__CPU_ZERO_S
 (£tsize, cpu£)

	)

92 
	#CPU_COUNT_S
(
£tsize
, 
ıu£
è
	`__CPU_COUNT_S
 (£tsize, cpu£)

	)

94 
	#CPU_EQUAL
(
ıu£1
, 
ıu£2
) \

95 
	`__CPU_EQUAL_S
 ( (
ıu_£t_t
), 
ıu£1
, 
ıu£2
)

	)

96 
	#CPU_EQUAL_S
(
£tsize
, 
ıu£1
, 
ıu£2
) \

97 
	`__CPU_EQUAL_S
 (
£tsize
, 
ıu£1
, 
ıu£2
)

	)

99 
	#CPU_AND
(
de¡£t
, 
¤c£t1
, 
¤c£t2
) \

100 
	`__CPU_OP_S
 ( (
ıu_£t_t
), 
de¡£t
, 
¤c£t1
, 
¤c£t2
, &)

	)

101 
	#CPU_OR
(
de¡£t
, 
¤c£t1
, 
¤c£t2
) \

102 
	`__CPU_OP_S
 ( (
ıu_£t_t
), 
de¡£t
, 
¤c£t1
, 
¤c£t2
, |)

	)

103 
	#CPU_XOR
(
de¡£t
, 
¤c£t1
, 
¤c£t2
) \

104 
	`__CPU_OP_S
 ( (
ıu_£t_t
), 
de¡£t
, 
¤c£t1
, 
¤c£t2
, ^)

	)

105 
	#CPU_AND_S
(
£tsize
, 
de¡£t
, 
¤c£t1
, 
¤c£t2
) \

106 
	`__CPU_OP_S
 (
£tsize
, 
de¡£t
, 
¤c£t1
, 
¤c£t2
, &)

	)

107 
	#CPU_OR_S
(
£tsize
, 
de¡£t
, 
¤c£t1
, 
¤c£t2
) \

108 
	`__CPU_OP_S
 (
£tsize
, 
de¡£t
, 
¤c£t1
, 
¤c£t2
, |)

	)

109 
	#CPU_XOR_S
(
£tsize
, 
de¡£t
, 
¤c£t1
, 
¤c£t2
) \

110 
	`__CPU_OP_S
 (
£tsize
, 
de¡£t
, 
¤c£t1
, 
¤c£t2
, ^)

	)

112 
	#CPU_ALLOC_SIZE
(
couÁ
è
	`__CPU_ALLOC_SIZE
 (couÁ)

	)

113 
	#CPU_ALLOC
(
couÁ
è
	`__CPU_ALLOC
 (couÁ)

	)

114 
	#CPU_FREE
(
ıu£t
è
	`__CPU_FREE
 (ıu£t)

	)

118 
	$sched_£ffš™y
 (
__pid_t
 
__pid
, 
size_t
 
__ıu£tsize
,

119 
__cÚ¡
 
ıu_£t_t
 *
__ıu£t
è
__THROW
;

122 
	$sched_g‘affš™y
 (
__pid_t
 
__pid
, 
size_t
 
__ıu£tsize
,

123 
ıu_£t_t
 *
__ıu£t
è
__THROW
;

126 
__END_DECLS


	@/usr/include/bits/sched.h

22 #iâdeà
__Ãed_sched·¿m


24 #iâdeà
_SCHED_H


30 
	#SCHED_OTHER
 0

	)

31 
	#SCHED_FIFO
 1

	)

32 
	#SCHED_RR
 2

	)

33 #ifdeà
__USE_GNU


34 
	#SCHED_BATCH
 3

	)

35 
	#SCHED_IDLE
 5

	)

37 
	#SCHED_RESET_ON_FORK
 0x40000000

	)

40 #ifdeà
__USE_MISC


42 
	#CSIGNAL
 0x000000fà

	)

43 
	#CLONE_VM
 0x00000100

	)

44 
	#CLONE_FS
 0x00000200

	)

45 
	#CLONE_FILES
 0x00000400

	)

46 
	#CLONE_SIGHAND
 0x00000800

	)

47 
	#CLONE_PTRACE
 0x00002000

	)

48 
	#CLONE_VFORK
 0x00004000

	)

50 
	#CLONE_PARENT
 0x00008000

	)

52 
	#CLONE_THREAD
 0x00010000

	)

53 
	#CLONE_NEWNS
 0x00020000

	)

54 
	#CLONE_SYSVSEM
 0x00040000

	)

55 
	#CLONE_SETTLS
 0x00080000

	)

56 
	#CLONE_PARENT_SETTID
 0x00100000

	)

58 
	#CLONE_CHILD_CLEARTID
 0x00200000

	)

60 
	#CLONE_DETACHED
 0x00400000

	)

61 
	#CLONE_UNTRACED
 0x00800000

	)

63 
	#CLONE_CHILD_SETTID
 0x01000000

	)

65 
	#CLONE_NEWUTS
 0x04000000

	)

66 
	#CLONE_NEWIPC
 0x08000000

	)

67 
	#CLONE_NEWUSER
 0x10000000

	)

68 
	#CLONE_NEWPID
 0x20000000

	)

69 
	#CLONE_NEWNET
 0x40000000

	)

70 
	#CLONE_IO
 0x80000000

	)

74 
	ssched_·¿m


76 
	m__sched_´iÜ™y
;

79 
	g__BEGIN_DECLS


81 #ifdeà
__USE_MISC


83 
şÚe
 ((*
__â
è(*
__¬g
), *
__chd_¡ack
,

84 
__æags
, *
__¬g
, ...è
__THROW
;

87 
	$unsh¬e
 (
__æags
è
__THROW
;

90 
	$sched_g‘ıu
 (è
__THROW
;

93 
__END_DECLS


97 #ià!
defšed
 
__defšed_sched·¿m
 \

98 && (
defšed
 
__Ãed_sched·¿m
 || defšed 
_SCHED_H
)

99 
	#__defšed_sched·¿m
 1

	)

101 
	s__sched_·¿m


103 
__sched_´iÜ™y
;

105 #undeà
__Ãed_sched·¿m


109 #ià
defšed
 
_SCHED_H
 && !defšed 
__ıu_£t_t_defšed


110 
	#__ıu_£t_t_defšed


	)

112 
	#__CPU_SETSIZE
 1024

	)

113 
	#__NCPUBITS
 (8 *  (
__ıu_mask
))

	)

116 
	t__ıu_mask
;

119 
	#__CPUELT
(
ıu
è((ıuè/ 
__NCPUBITS
)

	)

120 
	#__CPUMASK
(
ıu
è((
__ıu_mask
è1 << ((ıuè% 
__NCPUBITS
))

	)

125 
__ıu_mask
 
__b™s
[
__CPU_SETSIZE
 / 
__NCPUBITS
];

126 } 
	tıu_£t_t
;

129 #ià
	`__GNUC_PREREQ
 (2, 91)

130 
	#__CPU_ZERO_S
(
£tsize
, 
ıu£
) \

131 dØ
	`__butš_mem£t
 (
ıu£
, '\0', 
£tsize
); 0)

	)

133 
	#__CPU_ZERO_S
(
£tsize
, 
ıu£
) \

135 
size_t
 
__i
; \

136 
size_t
 
__imax
 = (
£tsize
è/  (
__ıu_mask
); \

137 
__ıu_mask
 *
__b™s
 = (
ıu£
)->__bits; \

138 
__i
 = 0; __˜< 
__imax
; ++__i) \

139 
__b™s
[
__i
] = 0; \

140 
	}
} 0)

	)

142 
	#__CPU_SET_S
(
ıu
, 
£tsize
, 
ıu£
) \

143 (
__ex‹nsiÚ__
 \

144 ({ 
size_t
 
__ıu
 = (
ıu
); \

145 
__ıu
 < 8 * (
£tsize
) \

146 ? (((
__ıu_mask
 *è((
ıu£
)->
__b™s
))[
	`__CPUELT
 (
__ıu
)] \

147 |ğ
	`__CPUMASK
 (
__ıu
)) \

148 : 0; }))

	)

149 
	#__CPU_CLR_S
(
ıu
, 
£tsize
, 
ıu£
) \

150 (
__ex‹nsiÚ__
 \

151 ({ 
size_t
 
__ıu
 = (
ıu
); \

152 
__ıu
 < 8 * (
£tsize
) \

153 ? (((
__ıu_mask
 *è((
ıu£
)->
__b™s
))[
	`__CPUELT
 (
__ıu
)] \

154 &ğ~
	`__CPUMASK
 (
__ıu
)) \

155 : 0; }))

	)

156 
	#__CPU_ISSET_S
(
ıu
, 
£tsize
, 
ıu£
) \

157 (
__ex‹nsiÚ__
 \

158 ({ 
size_t
 
__ıu
 = (
ıu
); \

159 
__ıu
 < 8 * (
£tsize
) \

160 ? ((((
__cÚ¡
 
__ıu_mask
 *è((
ıu£
)->
__b™s
))[
	`__CPUELT
 (
__ıu
)] \

161 & 
	`__CPUMASK
 (
__ıu
))) != 0 \

162 : 0; }))

	)

164 
	#__CPU_COUNT_S
(
£tsize
, 
ıu£
) \

165 
	`__sched_ıucouÁ
 (
£tsize
, 
ıu£
)

	)

167 #ià
__GNUC_PREREQ
 (2, 91)

168 
	#__CPU_EQUAL_S
(
£tsize
, 
ıu£1
, 
ıu£2
) \

169 (
	`__butš_memcmp
 (
ıu£1
, 
ıu£2
, 
£tsize
è=ğ0)

	)

171 
	#__CPU_EQUAL_S
(
£tsize
, 
ıu£1
, 
ıu£2
) \

172 (
__ex‹nsiÚ__
 \

173 ({ 
__cÚ¡
 
__ıu_mask
 *
__¬r1
 = (
ıu£1
)->
__b™s
; \

174 
__cÚ¡
 
__ıu_mask
 *
__¬r2
 = (
ıu£2
)->
__b™s
; \

175 
size_t
 
__imax
 = (
£tsize
è/  (
__ıu_mask
); \

176 
size_t
 
__i
; \

177 
__i
 = 0; __˜< 
__imax
; ++__i) \

178 ià(
__b™s
[
__i
] != __bits[__i]) \

180 
__i
 =ğ
__imax
; }))

	)

183 
	#__CPU_OP_S
(
£tsize
, 
de¡£t
, 
¤c£t1
, 
¤c£t2
, 
İ
) \

184 (
__ex‹nsiÚ__
 \

185 ({ 
ıu_£t_t
 *
__de¡
 = (
de¡£t
); \

186 
__cÚ¡
 
__ıu_mask
 *
__¬r1
 = (
¤c£t1
)->
__b™s
; \

187 
__cÚ¡
 
__ıu_mask
 *
__¬r2
 = (
¤c£t2
)->
__b™s
; \

188 
size_t
 
__imax
 = (
£tsize
è/  (
__ıu_mask
); \

189 
size_t
 
__i
; \

190 
__i
 = 0; __˜< 
__imax
; ++__i) \

191 ((
__ıu_mask
 *è
__de¡
->
__b™s
)[
__i
] = 
__¬r1
[__i] 
İ
 
__¬r2
[__i]; \

192 
__de¡
; }))

	)

194 
	#__CPU_ALLOC_SIZE
(
couÁ
) \

195 ((((
couÁ
è+ 
__NCPUBITS
 - 1è/ __NCPUBITSè*  (
__ıu_mask
))

	)

196 
	#__CPU_ALLOC
(
couÁ
è
	`__sched_ıu®loc
 (couÁ)

	)

197 
	#__CPU_FREE
(
ıu£t
è
	`__sched_ıuä“
 (ıu£t)

	)

199 
__BEGIN_DECLS


201 
	$__sched_ıucouÁ
 (
size_t
 
__£tsize
, cÚ¡ 
ıu_£t_t
 *
__£
)

202 
__THROW
;

203 
ıu_£t_t
 *
	$__sched_ıu®loc
 (
size_t
 
__couÁ
è
__THROW
 
__wur
;

204 
	$__sched_ıuä“
 (
ıu_£t_t
 *
__£t
è
__THROW
;

206 
__END_DECLS


	@
1
.
1
/usr/include
451
21179
trunk/3rdparty/ccache/build_ccache.sh
trunk/3rdparty/gprof/build_gprof2dot.sh
trunk/3rdparty/gprof/gprof2dot.py
trunk/auto/apps.sh
trunk/auto/auto_headers.sh
trunk/auto/build_ffmpeg.sh
trunk/auto/depends.sh
trunk/auto/generate-srs-librtmp-project.sh
trunk/auto/generate-srs-librtmp-single.sh
trunk/auto/generate_header.sh
trunk/auto/libs.sh
trunk/auto/local_ip.sh
trunk/auto/modules.sh
trunk/auto/options.sh
trunk/auto/setup_variables.sh
trunk/auto/summary.sh
trunk/auto/utest.sh
trunk/conf/bandwidth.conf
trunk/conf/console.conf
trunk/conf/demo.19350.conf
trunk/conf/demo.conf
trunk/conf/dvr.path.conf
trunk/conf/dvr.segment.conf
trunk/conf/dvr.session.conf
trunk/conf/edge.conf
trunk/conf/edge.token.traverse.conf
trunk/conf/ffmpeg.transcode.conf
trunk/conf/forward.master.conf
trunk/conf/forward.slave.conf
trunk/conf/full.conf
trunk/conf/hds.conf
trunk/conf/hls.conf
trunk/conf/http.aac.live.conf
trunk/conf/http.flv.live.conf
trunk/conf/http.flv.live.edge1.conf
trunk/conf/http.flv.live.edge2.conf
trunk/conf/http.heartbeat.conf
trunk/conf/http.hls.conf
trunk/conf/http.hooks.callback.conf
trunk/conf/http.mp3.live.conf
trunk/conf/http.server.conf
trunk/conf/http.ts.live.conf
trunk/conf/ingest.conf
trunk/conf/mac.dev.conf
trunk/conf/origin.conf
trunk/conf/push.flv.conf
trunk/conf/push.mpegts.over.udp.conf
trunk/conf/push.rtsp.conf
trunk/conf/ram.hls.conf
trunk/conf/realtime.conf
trunk/conf/rtmp.conf
trunk/conf/security.deny.publish.conf
trunk/conf/srs.conf
trunk/conf/transcode2hls.audio.only.conf
trunk/conf/transform.edge.conf
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/__init__.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/_cpchecker.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/_cpcompat.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/_cpcompat_subprocess.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/_cpconfig.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/_cpdispatch.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/_cperror.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/_cplogging.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/_cpmodpy.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/_cpnative_server.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/_cpreqbody.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/_cprequest.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/_cpserver.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/_cpthreadinglocal.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/_cptools.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/_cptree.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/_cpwsgi.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/_cpwsgi_server.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/lib/__init__.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/lib/auth.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/lib/auth_basic.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/lib/auth_digest.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/lib/caching.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/lib/covercp.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/lib/cpstats.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/lib/cptools.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/lib/encoding.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/lib/gctools.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/lib/http.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/lib/httpauth.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/lib/httputil.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/lib/jsontools.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/lib/profiler.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/lib/reprconf.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/lib/sessions.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/lib/static.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/lib/xmlrpcutil.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/process/__init__.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/process/plugins.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/process/servers.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/process/win32.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/process/wspbus.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/scaffold/__init__.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/__init__.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/_test_decorators.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/_test_states_demo.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/benchmark.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/checkerdemo.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/helper.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/logtest.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/modfastcgi.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/modfcgid.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/modpy.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/modwsgi.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/sessiondemo.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/test_auth_basic.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/test_auth_digest.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/test_bus.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/test_caching.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/test_compat.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/test_config.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/test_config_server.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/test_conn.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/test_core.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/test_dynamicobjectmapping.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/test_encoding.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/test_etags.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/test_http.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/test_httpauth.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/test_httplib.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/test_json.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/test_logging.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/test_mime.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/test_misc_tools.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/test_objectmapping.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/test_proxy.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/test_refleaks.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/test_request_obj.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/test_routes.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/test_session.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/test_sessionauthenticate.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/test_states.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/test_static.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/test_tools.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/test_tutorials.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/test_virtualhost.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/test_wsgi_ns.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/test_wsgi_vhost.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/test_wsgiapps.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/test_xmlrpc.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/test/webtest.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/tutorial/__init__.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/tutorial/bonus-sqlobject.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/tutorial/tut01_helloworld.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/tutorial/tut02_expose_methods.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/tutorial/tut03_get_and_post.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/tutorial/tut04_complex_site.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/tutorial/tut05_derived_objects.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/tutorial/tut06_default_method.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/tutorial/tut07_sessions.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/tutorial/tut08_generators_and_yield.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/tutorial/tut09_files.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/tutorial/tut10_http_errors.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/wsgiserver/__init__.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/wsgiserver/ssl_builtin.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/wsgiserver/ssl_pyopenssl.py
trunk/objs/CherryPy-3.2.4/build/lib/cherrypy/wsgiserver/wsgiserver2.py
trunk/objs/CherryPy-3.2.4/cherrypy/__init__.py
trunk/objs/CherryPy-3.2.4/cherrypy/_cpchecker.py
trunk/objs/CherryPy-3.2.4/cherrypy/_cpcompat.py
trunk/objs/CherryPy-3.2.4/cherrypy/_cpcompat_subprocess.py
trunk/objs/CherryPy-3.2.4/cherrypy/_cpconfig.py
trunk/objs/CherryPy-3.2.4/cherrypy/_cpdispatch.py
trunk/objs/CherryPy-3.2.4/cherrypy/_cperror.py
trunk/objs/CherryPy-3.2.4/cherrypy/_cplogging.py
trunk/objs/CherryPy-3.2.4/cherrypy/_cpmodpy.py
trunk/objs/CherryPy-3.2.4/cherrypy/_cpnative_server.py
trunk/objs/CherryPy-3.2.4/cherrypy/_cpreqbody.py
trunk/objs/CherryPy-3.2.4/cherrypy/_cprequest.py
trunk/objs/CherryPy-3.2.4/cherrypy/_cpserver.py
trunk/objs/CherryPy-3.2.4/cherrypy/_cpthreadinglocal.py
trunk/objs/CherryPy-3.2.4/cherrypy/_cptools.py
trunk/objs/CherryPy-3.2.4/cherrypy/_cptree.py
trunk/objs/CherryPy-3.2.4/cherrypy/_cpwsgi.py
trunk/objs/CherryPy-3.2.4/cherrypy/_cpwsgi_server.py
trunk/objs/CherryPy-3.2.4/cherrypy/lib/__init__.py
trunk/objs/CherryPy-3.2.4/cherrypy/lib/auth.py
trunk/objs/CherryPy-3.2.4/cherrypy/lib/auth_basic.py
trunk/objs/CherryPy-3.2.4/cherrypy/lib/auth_digest.py
trunk/objs/CherryPy-3.2.4/cherrypy/lib/caching.py
trunk/objs/CherryPy-3.2.4/cherrypy/lib/covercp.py
trunk/objs/CherryPy-3.2.4/cherrypy/lib/cpstats.py
trunk/objs/CherryPy-3.2.4/cherrypy/lib/cptools.py
trunk/objs/CherryPy-3.2.4/cherrypy/lib/encoding.py
trunk/objs/CherryPy-3.2.4/cherrypy/lib/gctools.py
trunk/objs/CherryPy-3.2.4/cherrypy/lib/http.py
trunk/objs/CherryPy-3.2.4/cherrypy/lib/httpauth.py
trunk/objs/CherryPy-3.2.4/cherrypy/lib/httputil.py
trunk/objs/CherryPy-3.2.4/cherrypy/lib/jsontools.py
trunk/objs/CherryPy-3.2.4/cherrypy/lib/profiler.py
trunk/objs/CherryPy-3.2.4/cherrypy/lib/reprconf.py
trunk/objs/CherryPy-3.2.4/cherrypy/lib/sessions.py
trunk/objs/CherryPy-3.2.4/cherrypy/lib/static.py
trunk/objs/CherryPy-3.2.4/cherrypy/lib/xmlrpcutil.py
trunk/objs/CherryPy-3.2.4/cherrypy/process/__init__.py
trunk/objs/CherryPy-3.2.4/cherrypy/process/plugins.py
trunk/objs/CherryPy-3.2.4/cherrypy/process/servers.py
trunk/objs/CherryPy-3.2.4/cherrypy/process/win32.py
trunk/objs/CherryPy-3.2.4/cherrypy/process/wspbus.py
trunk/objs/CherryPy-3.2.4/cherrypy/scaffold/__init__.py
trunk/objs/CherryPy-3.2.4/cherrypy/scaffold/apache-fcgi.conf
trunk/objs/CherryPy-3.2.4/cherrypy/scaffold/example.conf
trunk/objs/CherryPy-3.2.4/cherrypy/scaffold/site.conf
trunk/objs/CherryPy-3.2.4/cherrypy/test/__init__.py
trunk/objs/CherryPy-3.2.4/cherrypy/test/_test_decorators.py
trunk/objs/CherryPy-3.2.4/cherrypy/test/_test_states_demo.py
trunk/objs/CherryPy-3.2.4/cherrypy/test/benchmark.py
trunk/objs/CherryPy-3.2.4/cherrypy/test/checkerdemo.py
trunk/objs/CherryPy-3.2.4/cherrypy/test/helper.py
trunk/objs/CherryPy-3.2.4/cherrypy/test/logtest.py
trunk/objs/CherryPy-3.2.4/cherrypy/test/modfastcgi.py
trunk/objs/CherryPy-3.2.4/cherrypy/test/modfcgid.py
trunk/objs/CherryPy-3.2.4/cherrypy/test/modpy.py
trunk/objs/CherryPy-3.2.4/cherrypy/test/modwsgi.py
trunk/objs/CherryPy-3.2.4/cherrypy/test/sessiondemo.py
trunk/objs/CherryPy-3.2.4/cherrypy/test/static/index.html
trunk/objs/CherryPy-3.2.4/cherrypy/test/style.css
trunk/objs/CherryPy-3.2.4/cherrypy/test/test_auth_basic.py
trunk/objs/CherryPy-3.2.4/cherrypy/test/test_auth_digest.py
trunk/objs/CherryPy-3.2.4/cherrypy/test/test_bus.py
trunk/objs/CherryPy-3.2.4/cherrypy/test/test_caching.py
trunk/objs/CherryPy-3.2.4/cherrypy/test/test_compat.py
trunk/objs/CherryPy-3.2.4/cherrypy/test/test_config.py
trunk/objs/CherryPy-3.2.4/cherrypy/test/test_config_server.py
trunk/objs/CherryPy-3.2.4/cherrypy/test/test_conn.py
trunk/objs/CherryPy-3.2.4/cherrypy/test/test_core.py
trunk/objs/CherryPy-3.2.4/cherrypy/test/test_dynamicobjectmapping.py
trunk/objs/CherryPy-3.2.4/cherrypy/test/test_encoding.py
trunk/objs/CherryPy-3.2.4/cherrypy/test/test_etags.py
trunk/objs/CherryPy-3.2.4/cherrypy/test/test_http.py
trunk/objs/CherryPy-3.2.4/cherrypy/test/test_httpauth.py
trunk/objs/CherryPy-3.2.4/cherrypy/test/test_httplib.py
trunk/objs/CherryPy-3.2.4/cherrypy/test/test_json.py
trunk/objs/CherryPy-3.2.4/cherrypy/test/test_logging.py
trunk/objs/CherryPy-3.2.4/cherrypy/test/test_mime.py
trunk/objs/CherryPy-3.2.4/cherrypy/test/test_misc_tools.py
trunk/objs/CherryPy-3.2.4/cherrypy/test/test_objectmapping.py
trunk/objs/CherryPy-3.2.4/cherrypy/test/test_proxy.py
trunk/objs/CherryPy-3.2.4/cherrypy/test/test_refleaks.py
trunk/objs/CherryPy-3.2.4/cherrypy/test/test_request_obj.py
trunk/objs/CherryPy-3.2.4/cherrypy/test/test_routes.py
trunk/objs/CherryPy-3.2.4/cherrypy/test/test_session.py
trunk/objs/CherryPy-3.2.4/cherrypy/test/test_sessionauthenticate.py
trunk/objs/CherryPy-3.2.4/cherrypy/test/test_states.py
trunk/objs/CherryPy-3.2.4/cherrypy/test/test_static.py
trunk/objs/CherryPy-3.2.4/cherrypy/test/test_tools.py
trunk/objs/CherryPy-3.2.4/cherrypy/test/test_tutorials.py
trunk/objs/CherryPy-3.2.4/cherrypy/test/test_virtualhost.py
trunk/objs/CherryPy-3.2.4/cherrypy/test/test_wsgi_ns.py
trunk/objs/CherryPy-3.2.4/cherrypy/test/test_wsgi_vhost.py
trunk/objs/CherryPy-3.2.4/cherrypy/test/test_wsgiapps.py
trunk/objs/CherryPy-3.2.4/cherrypy/test/test_xmlrpc.py
trunk/objs/CherryPy-3.2.4/cherrypy/test/webtest.py
trunk/objs/CherryPy-3.2.4/cherrypy/tutorial/__init__.py
trunk/objs/CherryPy-3.2.4/cherrypy/tutorial/bonus-sqlobject.py
trunk/objs/CherryPy-3.2.4/cherrypy/tutorial/custom_error.html
trunk/objs/CherryPy-3.2.4/cherrypy/tutorial/tut01_helloworld.py
trunk/objs/CherryPy-3.2.4/cherrypy/tutorial/tut02_expose_methods.py
trunk/objs/CherryPy-3.2.4/cherrypy/tutorial/tut03_get_and_post.py
trunk/objs/CherryPy-3.2.4/cherrypy/tutorial/tut04_complex_site.py
trunk/objs/CherryPy-3.2.4/cherrypy/tutorial/tut05_derived_objects.py
trunk/objs/CherryPy-3.2.4/cherrypy/tutorial/tut06_default_method.py
trunk/objs/CherryPy-3.2.4/cherrypy/tutorial/tut07_sessions.py
trunk/objs/CherryPy-3.2.4/cherrypy/tutorial/tut08_generators_and_yield.py
trunk/objs/CherryPy-3.2.4/cherrypy/tutorial/tut09_files.py
trunk/objs/CherryPy-3.2.4/cherrypy/tutorial/tut10_http_errors.py
trunk/objs/CherryPy-3.2.4/cherrypy/tutorial/tutorial.conf
trunk/objs/CherryPy-3.2.4/cherrypy/wsgiserver/__init__.py
trunk/objs/CherryPy-3.2.4/cherrypy/wsgiserver/ssl_builtin.py
trunk/objs/CherryPy-3.2.4/cherrypy/wsgiserver/ssl_pyopenssl.py
trunk/objs/CherryPy-3.2.4/cherrypy/wsgiserver/wsgiserver2.py
trunk/objs/CherryPy-3.2.4/cherrypy/wsgiserver/wsgiserver3.py
trunk/objs/CherryPy-3.2.4/setup.py
trunk/objs/_srs_build_summary.sh
trunk/objs/gtest-1.6.0/build-aux/ltmain.sh
trunk/objs/gtest-1.6.0/scripts/fuse_gtest_files.py
trunk/objs/gtest-1.6.0/scripts/gen_gtest_pred_impl.py
trunk/objs/gtest-1.6.0/scripts/pump.py
trunk/objs/gtest-1.6.0/test/gtest_break_on_failure_unittest.py
trunk/objs/gtest-1.6.0/test/gtest_catch_exceptions_test.py
trunk/objs/gtest-1.6.0/test/gtest_color_test.py
trunk/objs/gtest-1.6.0/test/gtest_env_var_test.py
trunk/objs/gtest-1.6.0/test/gtest_filter_unittest.py
trunk/objs/gtest-1.6.0/test/gtest_help_test.py
trunk/objs/gtest-1.6.0/test/gtest_list_tests_unittest.py
trunk/objs/gtest-1.6.0/test/gtest_output_test.py
trunk/objs/gtest-1.6.0/test/gtest_shuffle_test.py
trunk/objs/gtest-1.6.0/test/gtest_test_utils.py
trunk/objs/gtest-1.6.0/test/gtest_throw_on_failure_test.py
trunk/objs/gtest-1.6.0/test/gtest_uninitialized_test.py
trunk/objs/gtest-1.6.0/test/gtest_xml_outfiles_test.py
trunk/objs/gtest-1.6.0/test/gtest_xml_output_unittest.py
trunk/objs/gtest-1.6.0/test/gtest_xml_test_utils.py
trunk/objs/gtest-1.6.0/xcode/Samples/FrameworkSample/runtests.sh
trunk/objs/gtest-1.6.0/xcode/Scripts/runtests.sh
trunk/objs/gtest-1.6.0/xcode/Scripts/versiongenerate.py
trunk/objs/nginx/html/forward/live/livestream.html
trunk/objs/nginx/html/forward/live/livestream_ld.html
trunk/objs/nginx/html/forward/live/livestream_sd.html
trunk/objs/nginx/html/index.html
trunk/objs/nginx/html/live/demo.html
trunk/objs/nginx/html/live/livestream.html
trunk/objs/nginx/html/live/livestream_ld.html
trunk/objs/nginx/html/live/livestream_sd.html
trunk/objs/nginx/html/nginx.html
trunk/objs/openssl-1.0.1f/_release/ssl/misc/CA.sh
trunk/objs/openssl-1.0.1f/apps/CA.sh
trunk/objs/openssl-1.0.1f/crypto/threads/profile.sh
trunk/objs/openssl-1.0.1f/crypto/threads/pthread.sh
trunk/objs/openssl-1.0.1f/crypto/threads/pthread2.sh
trunk/objs/openssl-1.0.1f/crypto/threads/purify.sh
trunk/objs/openssl-1.0.1f/crypto/threads/solaris.sh
trunk/objs/openssl-1.0.1f/demos/ssltest-ecc/ECC-RSAcertgen.sh
trunk/objs/openssl-1.0.1f/demos/ssltest-ecc/ECCcertgen.sh
trunk/objs/openssl-1.0.1f/demos/ssltest-ecc/RSAcertgen.sh
trunk/objs/openssl-1.0.1f/demos/ssltest-ecc/ssltest.sh
trunk/objs/openssl-1.0.1f/demos/tunala/autogunk.sh
trunk/objs/openssl-1.0.1f/demos/tunala/autoungunk.sh
trunk/objs/openssl-1.0.1f/demos/tunala/test.sh
trunk/objs/openssl-1.0.1f/doc/openssl_button.html
trunk/objs/openssl-1.0.1f/shlib/hpux10-cc.sh
trunk/objs/openssl-1.0.1f/shlib/irix.sh
trunk/objs/openssl-1.0.1f/shlib/sco5-shared-gcc.sh
trunk/objs/openssl-1.0.1f/shlib/sco5-shared.sh
trunk/objs/openssl-1.0.1f/shlib/solaris-sc4.sh
trunk/objs/openssl-1.0.1f/shlib/solaris.sh
trunk/objs/openssl-1.0.1f/shlib/sun.sh
trunk/objs/openssl-1.0.1f/shlib/svr5-shared-gcc.sh
trunk/objs/openssl-1.0.1f/shlib/svr5-shared.sh
trunk/objs/openssl-1.0.1f/tools/c89.sh
trunk/objs/openssl-1.0.1f/util/FreeBSD.sh
trunk/objs/openssl-1.0.1f/util/bat.sh
trunk/objs/openssl-1.0.1f/util/cygwin.sh
trunk/objs/openssl-1.0.1f/util/do_ms.sh
trunk/objs/openssl-1.0.1f/util/fixNT.sh
trunk/objs/openssl-1.0.1f/util/install.sh
trunk/objs/openssl-1.0.1f/util/mkcerts.sh
trunk/objs/openssl-1.0.1f/util/opensslwrap.sh
trunk/objs/openssl-1.0.1f/util/point.sh
trunk/objs/openssl-1.0.1f/util/shlib_wrap.sh
trunk/objs/openssl-1.0.1f/util/speed.sh
trunk/objs/openssl-1.0.1f/util/x86asm.sh
trunk/objs/st-1.9/docs/notes.html
trunk/objs/st-1.9/docs/reference.html
trunk/objs/st-1.9/docs/st.html
trunk/objs/st-1.9/osguess.sh
trunk/research/api-server/server.py
trunk/research/api-server/static-dir/index.html
trunk/research/code-statistic/cs.py
trunk/research/code-statistic/csr.py
trunk/research/hls/check_hls_backup.sh
trunk/research/players/api-server_index.html
trunk/research/players/css/bootstrap.min.css
trunk/research/players/index.html
trunk/research/players/jwplayer6.html
trunk/research/players/nginx_index.html
trunk/research/players/osmf.html
trunk/research/players/srs-http-server_index.html
trunk/research/players/srs_bwt.html
trunk/research/players/srs_chat.html
trunk/research/players/srs_player.html
trunk/research/players/srs_publisher.html
trunk/research/players/vlc.html
trunk/research/python-subprocess/main.py
trunk/scripts/_log.sh
trunk/scripts/build.sh
trunk/scripts/git.commit.sh
trunk/scripts/git2unix.sh
trunk/scripts/install.sh
trunk/scripts/package.sh
trunk/scripts/run.sh
trunk/scripts/stop.sh
trunk/scripts/test_configure.sh
/usr/include/assert.h
/usr/include/ctype.h
/usr/include/errno.h
/usr/include/fcntl.h
/usr/include/malloc.h
/usr/include/stdint.h
/usr/include/stdio.h
/usr/include/stdlib.h
/usr/include/string.h
/usr/include/sys/stat.h
/usr/include/unistd.h
/usr/include/alloca.h
/usr/include/bits/confname.h
/usr/include/bits/environments.h
/usr/include/bits/errno.h
/usr/include/bits/fcntl.h
/usr/include/bits/fcntl2.h
/usr/include/bits/posix_opt.h
/usr/include/bits/stat.h
/usr/include/bits/stdio-ldbl.h
/usr/include/bits/stdio.h
/usr/include/bits/stdio2.h
/usr/include/bits/stdio_lim.h
/usr/include/bits/stdlib-ldbl.h
/usr/include/bits/stdlib.h
/usr/include/bits/string.h
/usr/include/bits/string2.h
/usr/include/bits/string3.h
/usr/include/bits/sys_errlist.h
/usr/include/bits/types.h
/usr/include/bits/unistd.h
/usr/include/bits/waitflags.h
/usr/include/bits/waitstatus.h
/usr/include/bits/wchar.h
/usr/include/bits/wordsize.h
/usr/include/endian.h
/usr/include/features.h
/usr/include/getopt.h
/usr/include/libio.h
/usr/include/sys/types.h
/usr/include/time.h
/usr/include/xlocale.h
/usr/include/_G_config.h
/usr/include/bits/byteswap.h
/usr/include/bits/endian.h
/usr/include/bits/libio-ldbl.h
/usr/include/bits/pthreadtypes.h
/usr/include/bits/stdio-lock.h
/usr/include/bits/time.h
/usr/include/bits/typesizes.h
/usr/include/bits/uio.h
/usr/include/gnu/stubs.h
/usr/include/linux/errno.h
/usr/include/sys/cdefs.h
/usr/include/sys/select.h
/usr/include/sys/sysmacros.h
/usr/include/asm/errno.h
/usr/include/bits/libc-lock.h
/usr/include/bits/select.h
/usr/include/bits/sigset.h
/usr/include/gconv.h
/usr/include/gnu/stubs-32.h
/usr/include/gnu/stubs-64.h
/usr/include/wchar.h
/usr/include/asm-generic/errno.h
/usr/include/bits/wchar-ldbl.h
/usr/include/bits/wchar2.h
/usr/include/pthread.h
/usr/include/wctype.h
/usr/include/asm-generic/errno-base.h
/usr/include/bits/setjmp.h
/usr/include/sched.h
/usr/include/bits/sched.h
